<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ğŸŒ å¤§å‚AIGCæŠ€æœ¯ç”Ÿæ€ä¸ä¸­å°Webå¼€å‘è€…çš„â€œå’Œè°å…±ç”Ÿâ€ä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7579489321487089683</link>    <guid>https://juejin.cn/post/7579489321487089683</guid>    <pubDate>2025-12-04T01:46:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579489321487089683" data-draft-id="7579511463054295059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒ å¤§å‚AIGCæŠ€æœ¯ç”Ÿæ€ä¸ä¸­å°Webå¼€å‘è€…çš„â€œå’Œè°å…±ç”Ÿâ€ä¹‹è·¯"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC,æ•æ·å¼€å‘"/> <meta itemprop="datePublished" content="2025-12-04T01:46:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒ å¤§å‚AIGCæŠ€æœ¯ç”Ÿæ€ä¸ä¸­å°Webå¼€å‘è€…çš„â€œå’Œè°å…±ç”Ÿâ€ä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:46:34.000Z" title="Thu Dec 04 2025 01:46:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ§­ ä¸€ã€åºç« ï¼šAIGCç”Ÿæ€çš„å·¨è½®æ­£åœ¨ç¢¾å‹è°ï¼Ÿ</h2>
<p>â€œ<strong>å½“ä½ è¿˜åœ¨åšCRUDæ¥å£æ—¶ï¼ŒAIGCå·²ç»å¼€å§‹å†™å®Œæ•´çš„å‰ç«¯æ¡†æ¶äº†</strong>ã€‚â€</p>
<p>è¿‘å¹´æ¥ï¼Œå¤§å‚çš„AIGCï¼ˆAI Generated Contentï¼‰ç”Ÿæ€å‡ ä¹æ³›æ»¥æˆç¾ã€‚<br/>
ä»OpenAIçš„Copilotç³»ï¼Œåˆ°ç™¾åº¦æ–‡å¿ƒã€é˜¿é‡Œé€šä¹‰ã€å­—èŠ‚è±†åŒ…ï¼Œå†åˆ°Metaçš„å¼€æºAgentæ¡†æ¶â€”â€”<strong>AIå·²ç»æˆä¸ºæ–°çš„ä»£ç ç»æµä½“åº•å±‚è®¾æ–½</strong> ğŸ§©ã€‚</p>
<p>ä½†æ˜¯ï¼<br/>
å¯¹äºä¸­å°Webå¼€å‘è€…è€Œè¨€ï¼Œè¿™æ—¢æ˜¯ä¸€åœºé©å‘½ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡â€œæŠ€æœ¯ç„¦è™‘åŠ èº«â€çš„æ´—ç¤¼ã€‚<br/>
ä½ å¯èƒ½åœ¨æƒ³ï¼š</p>
<blockquote>
<p>â€œæˆ‘è¿TypeScriptè¿˜æ²¡æ•´æ˜ç™½ï¼ŒAIåˆè¦è®©æˆ‘â€˜Prompt Engineeringâ€™ï¼Ÿï¼â€</p>
</blockquote>
<p>åˆ«æ…Œ ğŸ˜ã€‚<br/>
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<strong>ä¸­å°å¼€å‘è€…å¦‚ä½•åœ¨å·¨å¤´çš„AIé£æš´ä¸­æ‘¸åˆ°é€‚é…çš„æ–¹å‘</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸŒ³ äºŒã€å¤§å‚AIGCç”Ÿæ€æ¼”åŒ–çš„æŠ€æœ¯åº•å±‚</h2>
<p>å¤§å‚AIGCç”Ÿæ€çš„æœ¬è´¨æ˜¯ï¼š<strong>æ¨¡å‹ + æ•°æ® + å·¥å…·é“¾ + ç®—åŠ›é—­ç¯</strong>ã€‚</p>
<p>ä¸‹é¢ä»¥é˜¿é‡Œå’ŒOpenAIä½“ç³»ä¸ºä¾‹ç®€è¿°ç”Ÿæ€æ¼”åŒ–é€»è¾‘ğŸ‘‡</p>



































<table><thead><tr><th align="left">å±‚çº§</th><th align="left">æè¿°</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left">åº•å±‚æ¨¡å‹å±‚</td><td align="left">é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</td><td align="left">GPT-5ã€Qwen2ã€Gemini2</td></tr><tr><td align="left">å·¥ç¨‹åŒ–ä¸­é—´å±‚</td><td align="left">æ¨¡å‹æ¨ç†æ¡†æ¶</td><td align="left">vLLMã€MindNLPã€ModelScope</td></tr><tr><td align="left">æ•°æ®é“¾</td><td align="left">é«˜è´¨é‡æŒ‡ä»¤æ•°æ®ä¸åµŒå…¥è¯­æ–™</td><td align="left">AIåŠ©æ‰‹è®­ç»ƒé›†ã€è‡ªé€‚åº”Embedding</td></tr><tr><td align="left">å¼€å‘è€…æ¥å£å±‚</td><td align="left">SDK / API / Agentæ¡†æ¶</td><td align="left">OpenAI SDKã€LangChainã€é˜¿é‡ŒDashScope</td></tr><tr><td align="left">å·¥å…·ç”Ÿæ€å±‚</td><td align="left">AIGCå‰ç«¯ç»„ä»¶åŒ–æ”¯æŒ</td><td align="left">npmåŒ…ã€Web SDKsã€Pluginä½“ç³»</td></tr></tbody></table>
<p>ğŸ§  æ ¸å¿ƒå“²å­¦ï¼š</p>
<blockquote>
<p>â€œæ¨¡å‹å±‚æŠŠç¥ç»å…ƒå˜æˆå¥å­ï¼Œå·¥å…·å±‚æŠŠå¥å­å˜æˆç”Ÿäº§åŠ›ã€‚â€</p>
</blockquote>
<p>è¿™æ„å‘³ç€ï¼Œå¼€å‘è€…åœ¨æœªæ¥çš„è§’è‰²ï¼Œä»<strong>å†™ä»£ç  â†’ ç»„ç»‡æ„å›¾</strong>ï¼Œé€æ¸è¿‡æ¸¡åˆ°ï¼š</p>
<blockquote>
<p>â€œè®©AIå¸®æˆ‘å†™å‡ºèƒ½è‡ªå·±æ”¹è‡ªå·±çš„ä»£ç â€ çš„å¥‡å¦™å¢ƒç•Œã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ğŸ§© ä¸‰ã€ä¸­å°å¼€å‘è€…çš„AIGCé€‚é…è·¯å¾„</h2>
<p>ä¸‹é¢è¿›å…¥æœ¬æ–‡çš„æ ¸å¿ƒæ•™å­¦éƒ¨åˆ†â€”â€”<br/>
<strong>å¦‚ä½•è®©ä½ çš„Webé¡¹ç›®ï¼Œä¸AIGCç”Ÿæ€â€˜ä¼˜é›…åœ°å…±èˆâ€™ï¼Ÿ</strong></p>
<hr/>
<h3 data-id="heading-3">ğŸ¥‡ 1. è®¤çŸ¥é€‚é…ï¼šä»â€œå†™åŠŸèƒ½â€è½¬ä¸ºâ€œå†™è¯­ä¹‰â€</h3>
<blockquote>
<p>ğŸ’¡ <em>åº•å±‚é€»è¾‘ï¼šPrompt æ˜¯æ–°çš„APIè¯­ä¹‰å±‚</em></p>
</blockquote>
<p>åœ¨AIGCä½“ç³»ä¸­ï¼Œä¼ ç»Ÿçš„å‡½æ•°è°ƒç”¨æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯AIä»»åŠ¡æè¿°ã€‚<br/>
ä¸¾ä¸ªä¾‹å­ï¼Œä½ åŸæ¥å¯èƒ½ç”¨ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function">function <span class="hljs-title">generateSummary</span><span class="hljs-params">(text)</span> </span>{
  <span class="hljs-comment">// è°ƒç”¨ä¼ ç»ŸNLP API</span>
  <span class="hljs-keyword">return</span> nlp.<span class="hljs-built_in">summarize</span>(text);
}
</code></pre>
<p>è€Œä»Šï¼Œä½ å¯èƒ½å†™æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateSummaryAI</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">AIGC</span>.<span class="hljs-title function_">call</span>({
    <span class="hljs-attr">prompt</span>: <span class="hljs-string">`è¯·å¸®æˆ‘å°†ä»¥ä¸‹å†…å®¹ç²¾ç‚¼æˆä¸€å¥è¯æ‘˜è¦ï¼š<span class="hljs-subst">${text}</span>`</span>
  });
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">output</span>;
}
</code></pre>
<p>ğŸ” è¿™é‡Œï¼ŒAPIè°ƒç”¨çš„è¯­ä¹‰ä¸å†æ˜¯â€œæ‰§è¡Œå‡½æ•°â€ï¼Œè€Œæ˜¯â€œå¯¹AIæè¿°æ„å›¾â€ã€‚<br/>
ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä½ ä¸å†å†™é€»è¾‘ï¼Œè€Œæ˜¯å†™æ€ç»´è·¯å¾„</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-4">ğŸ¥ˆ 2. å·¥ç¨‹é€‚é…ï¼šä»â€œæ¨¡å—å¯¼å…¥â€åˆ°â€œæ™ºèƒ½ä»£ç†â€</h3>
<p>ä¸­å°å¼€å‘è€…éœ€è¦æŒæ¡çš„ç¬¬äºŒä¸ªè½¬å˜æ˜¯â€”â€”<strong>æŠŠåŠŸèƒ½æ‹†æˆAI Agentä»»åŠ¡å•å…ƒ</strong>ã€‚</p>
<p>ä½ å¯ä»¥æ„å»ºä¸€ä¸ªç®€å•çš„æ™ºèƒ½é¡µé¢å°åŠ©æ‰‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebAgent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">answer</span>(<span class="hljs-params">question</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">AIGC</span>.<span class="hljs-title function_">call</span>({
      <span class="hljs-attr">prompt</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>ï¼Œä½œä¸ºä¸€åWebä¸“å®¶ï¼Œè¯·å›ç­”ï¼š<span class="hljs-subst">${question}</span>`</span>
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ¤– <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>: <span class="hljs-subst">${response.output}</span>`</span>);
  }
}

<span class="hljs-comment">// ç¤ºä¾‹ï¼šæ„é€ ä¸€ä¸ªAIGCç‰ˆ â€œChatè°ƒè¯•åŠ©ç†â€</span>
<span class="hljs-keyword">const</span> xiaoA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebAgent</span>(<span class="hljs-string">"å°A"</span>);
xiaoA.<span class="hljs-title function_">answer</span>(<span class="hljs-string">"å¦‚ä½•åœ¨Reactä¸­ä¼˜é›…åœ°ä½¿ç”¨Hooksï¼Ÿ"</span>);
</code></pre>
<p>ğŸ§  è¿™ä¸€å±‚çš„æ€æƒ³ç±»ä¼¼åº•å±‚ç³»ç»Ÿä¸­çš„â€œ<em>çº¿ç¨‹åä½œæ¨¡å‹ï¼ˆåç¨‹æ€æƒ³ï¼‰</em> â€ï¼Œ<br/>
åªæ˜¯æŠŠçº¿ç¨‹æ¢æˆäº†<strong>Agentä»»åŠ¡æµ</strong>ã€‚<br/>
â€”â€”ä½ å†™çš„æ¯ä¸ªæ™ºèƒ½æ¨¡å—ï¼Œå…¶å®æ˜¯<strong>è¯­ä¹‰ä¸Šçš„å¾®çº¿ç¨‹</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-5">ğŸ¥‰ 3. æŠ€æœ¯ç”Ÿæ€é€‚é…ï¼šåˆ©ç”¨å¹³å°èµ„æºâ€œå€ŸAIä¹‹ç¿¼â€</h3>
<p>åœ¨å¤§å‚ç”Ÿæ€ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸‰æ¡ä¸»æµçš„AIGCæ¥å…¥æ–¹æ¡ˆï¼š</p>

























<table><thead><tr><th align="center">ç±»å‹</th><th align="left">å…¸å‹å¹³å°</th><th align="left">æ¨èåœºæ™¯</th></tr></thead><tbody><tr><td align="center">â˜ï¸ äº‘æ‰˜ç®¡å‹</td><td align="left">é˜¿é‡Œäº‘ã€ç™¾åº¦æ™ºèƒ½äº‘AIå¹³å°</td><td align="left">è¾ƒå¤§é¡¹ç›®ã€éœ€è¦ç¨³å®šæ¨¡å‹æ¨ç†</td></tr><tr><td align="center">ğŸ”Œ SDKæ¥å…¥å‹</td><td align="left">OpenAI SDKã€Claude API</td><td align="left">Webç«¯æ™ºèƒ½åŠŸèƒ½æµ‹è¯•ä¸æ’ä»¶å¼€å‘</td></tr><tr><td align="center">ğŸ§° æœ¬åœ°è½»é‡æ¡†æ¶</td><td align="left">Ollamaã€LM Studio</td><td align="left">è‡ªå»ºå¼€å‘ç¯å¢ƒä¸ç¦»çº¿æ¨¡å‹æµ‹è¯•</td></tr></tbody></table>
<p>ğŸš€ å¼€å‘è€…å¯ä»¥é‡‡å–â€œåŒæ¥å…¥ç­–ç•¥â€ï¼š<br/>
âœ… äº‘ç«¯AIç”¨äºå®æ—¶ç”Ÿæˆå†…å®¹<br/>
âœ… æœ¬åœ°AIç”¨äºä»£ç åŸå‹å’Œå®‰å…¨éªŒè¯</p>
<p>è¿™æ ·ï¼Œä½ çš„æˆæœ¬ä¸é£é™©éƒ½èƒ½æœ‰æ•ˆå¯æ§ã€‚</p>
<hr/>
<h2 data-id="heading-6">âš™ï¸ å››ã€åº•å±‚é€»è¾‘ï¼šAIGCèƒŒåçš„â€œè®¡ç®—å“²å­¦â€</h2>
<p>åœ¨çº¯è®¡ç®—æœºç§‘å­¦è§†è§’ä¸‹ï¼ŒAIGCçš„æ ¸å¿ƒæ˜¯ä¸€ç§<strong>è®¡ç®—èŒƒå¼è¿ç§»</strong>ï¼š</p>
<blockquote>
<p>ä»â€œç¡®å®šæ€§è®¡ç®—â€ â†’ åˆ° â€œæ¦‚ç‡æ€§ç”Ÿæˆâ€</p>
</blockquote>
<p>ä¼ ç»Ÿä»£ç  = è¾“å…¥ + ç¡®å®šç®—æ³• + è¾“å‡º<br/>
AIGCç³»ç»Ÿ = è¾“å…¥è¯­ä¹‰ + æ¨¡å‹åˆ†å¸ƒæƒé‡ + é‡‡æ ·è¾“å‡ºæ¦‚ç‡</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåº•å±‚ä¸å†æ˜¯â€œæ±‚ä¸€ä¸ªç¡®å®šè§£â€ï¼Œè€Œæ˜¯åœ¨â€œæƒé‡ç©ºé—´â€é‡Œé‡‡æ ·<strong>é«˜æ¦‚ç‡æ€ç»´è·¯å¾„</strong>ã€‚</p>
<p>ä½ çœ‹åˆ°çš„æ¯ä¸€æ®µAIè¾“å‡ºï¼Œå…¶å®æ˜¯ä¸€æ¬¡<strong>éšæœºå˜é‡åç¼©æˆé€»è¾‘äº§ç‰©çš„å¥‡è¿¹ç¬é—´</strong>ã€‚<br/>
è¿™ä¸æ¯”çœ‹è¯—è¿˜æµªæ¼«å—ï¼ŸğŸ¤“ğŸ“œ</p>
<hr/>
<h2 data-id="heading-7">ğŸŒˆ äº”ã€é¢å‘æœªæ¥çš„å¼€å‘å®è·µå»ºè®®</h2>






























<table><thead><tr><th align="left">å»ºè®®æ–¹å‘</th><th align="left">å®ç°æ–¹å¼</th><th align="left">å¼€å‘æ”¶ç›Š</th></tr></thead><tbody><tr><td align="left">ğŸ’¬ Promptå·¥ç¨‹åŒ–</td><td align="left">å°è£…ç»Ÿä¸€AIä»»åŠ¡æ¨¡æ¿</td><td align="left">é™ä½AIçš„å›è¯æ­§ä¹‰ç‡</td></tr><tr><td align="left">ğŸ§© æ¨¡å—AIåŒ–</td><td align="left">å°†ç»„ä»¶æ¥å£è¯­ä¹‰åŒ–</td><td align="left">æå‡Webé¡¹ç›®AIè‡ªå®šä¹‰èƒ½åŠ›</td></tr><tr><td align="left">ğŸªœ æ¨¡å‹çº§ç¼“å­˜</td><td align="left">åˆç†ä¿å­˜Embeddingå‘é‡ç»“æœ</td><td align="left">æé«˜å“åº”é€Ÿåº¦ã€èŠ‚çº¦è°ƒç”¨æˆæœ¬</td></tr><tr><td align="left">ğŸª¶ å¼€å‘è€…AIGCç”Ÿæ€å­¦ä¹ </td><td align="left">å­¦LangChainã€AgentFlowã€RAGæœºåˆ¶</td><td align="left">è¿›å…¥ä¸‹ä¸€ä»£æ™ºèƒ½ç¼–ç¨‹</td></tr></tbody></table>
<blockquote>
<p>æœªæ¥çš„Webå·¥ç¨‹ï¼Œå°†ä¸åªæ˜¯â€œå†™é¡µé¢â€ï¼Œè€Œæ˜¯â€œæ•™æœºå™¨å†™é¡µé¢â€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">ğŸ§  å…­ã€æ€»ç»“ï¼šæˆä¸ºâ€œAIç”Ÿæ€ç‰©ç§â€çš„å¼€å‘è€…</h2>
<ul>
<li>ğŸŒ± å¤§å‚çš„AIGCæŠ€æœ¯ç”Ÿæ€åƒæ˜¯æ ‘æœ¨çš„æ ¹ç³»ï¼Œå®ƒç›˜æ ¹é”™èŠ‚ã€ä»äº‘åˆ°ç«¯æ— æ‰€ä¸åœ¨ï¼›</li>
<li>ğŸœ ä¸­å°å¼€å‘è€…åˆ™åƒæ˜¯ç”Ÿæ€ä¸­çš„å°è˜‘è‡ï¼Œçµæ´»ã€äº’è”ï¼Œå´æå…·åˆ›æ–°ï¼›</li>
<li>ğŸ§© é€‚é…çš„æœ¬è´¨åœ¨äºï¼š<strong>å’ŒAIå…±å»ºè€Œéå¯¹æŠ—</strong>ã€‚</li>
</ul>
<p>æœ€ç»ˆï¼Œä½ ä¸éœ€è¦æˆä¸ºâ€œæ›¿ä»£AIçš„äººâ€ï¼Œ<br/>
è€Œæ˜¯â€”â€”</p>
<blockquote>
<p>æˆä¸ºé‚£ä¸ªâ€œæ•™AIå†™æ›´å¥½ä»£ç â€çš„ Web å·«å¸ˆ ğŸ§™â€â™‚ï¸</p>
</blockquote>
<hr/>
<blockquote>
<p>ğŸ’¬ <strong>å½©è›‹ä¸€å¥ï¼š</strong></p>
<p>â€œæœªæ¥å‰ç«¯çš„ç»ˆæå½¢æ€ï¼Œæˆ–è®¸æ˜¯åœ¨æ§åˆ¶å°æ‰“ä¸‹ä¸€è¡Œï¼š<code>AI.build("æˆ‘çš„æ¢¦æƒ³ç½‘ç«™")</code>ï¼Œç„¶åå»å†²æ¯å’–å•¡â˜•ã€‚â€</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ 2025å…¨æ ˆæ¶æ„æ–¹æ¡ˆæ±‡æ€»ä¸æœªæ¥åˆ†æ]]></title>    <link>https://juejin.cn/post/7579489321487138835</link>    <guid>https://juejin.cn/post/7579489321487138835</guid>    <pubDate>2025-12-04T01:54:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579489321487138835" data-draft-id="7579551362154004489" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ 2025å…¨æ ˆæ¶æ„æ–¹æ¡ˆæ±‡æ€»ä¸æœªæ¥åˆ†æ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,æ¶æ„,å…¨æ ˆ"/> <meta itemprop="datePublished" content="2025-12-04T01:54:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ 2025å…¨æ ˆæ¶æ„æ–¹æ¡ˆæ±‡æ€»ä¸æœªæ¥åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:54:23.000Z" title="Thu Dec 04 2025 01:54:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸŒ ä¸€ã€å‰è¨€ï¼šä»â€œä¼šç‚¹å…¨æ ˆâ€åˆ°â€œå…¨æ ˆAIå·¥ç¨‹å¸ˆâ€çš„æ¼”åŒ–</h2>
<p>æ—¶é—´å›åˆ° 2015 å¹´ï¼Œ**â€œå…¨æ ˆå¼€å‘â€**æ„å‘³ç€ï¼š</p>
<blockquote>
<p><em>ä½ èƒ½åœ¨æ—©æ™¨å†™Reactï¼Œåˆé¥­è°ƒAPIï¼Œå‚æ™šéƒ¨ç½²NodeæœåŠ¡ï¼Œæ™šä¸Šä¿®ä¸€ä¿®Nginxé…ç½®ã€‚</em></p>
</blockquote>
<p>è€Œåˆ°äº† <strong>2025 å¹´</strong>ï¼Œå…¨æ ˆçš„å®šä¹‰å·²ç»è¢«AIæ…äº†ä¸ªå¤©ç¿»åœ°è¦†ï¼š</p>
<blockquote>
<p>ğŸ‘¾ â€œå…¨æ ˆâ€ = å‰ç«¯ + åç«¯ + äº‘ + AIç¼–æ’ + æ•°æ®æµæ²»ç† + è‡ªåŠ¨åŒ–è¿ç»´</p>
</blockquote>
<p>è¿™æ„å‘³ç€ä¸€ä¸ªç°ä»£å…¨æ ˆå·¥ç¨‹å¸ˆä¸ä»…éœ€è¦ä»£ç èƒ½åŠ›ï¼Œæ›´è¦å…·å¤‡ï¼š</p>
<ul>
<li><strong>ç³»ç»ŸæŠ½è±¡æ€ç»´</strong></li>
<li><strong>AIç”Ÿæˆè¾…åŠ©å¼€å‘èƒ½åŠ›</strong></li>
<li><strong>å¼‚æ„æœåŠ¡æ¶æ„è®¾è®¡æ„è¯†</strong></li>
</ul>
<hr/>
<h2 data-id="heading-1">ğŸ§© äºŒã€2025ä¸»æµå…¨æ ˆæŠ€æœ¯æ ˆåœ°å›¾</h2>
<p>ä¸‹å›¾å±•ç¤ºäº†å½“å‰ä¸»è¦çš„æŠ€æœ¯ç”Ÿæ€å¸ƒå±€ï¼ˆæŒ‰èŒèƒ½æ¨¡å—åˆ’åˆ†ï¼‰ğŸ‘‡</p>



























































<table><thead><tr><th align="left">å±‚çº§</th><th align="left">æŠ€èƒ½/ç»„ä»¶</th><th align="left">ä»£è¡¨æŠ€æœ¯æ ˆ</th><th align="left">è¶‹åŠ¿</th></tr></thead><tbody><tr><td align="left">å‰ç«¯å±‚</td><td align="left">UIã€äº¤äº’é€»è¾‘ã€ç»„ä»¶æ¸²æŸ“</td><td align="left">React 19 / Vue 4 / Next.js 15 / Solid.js</td><td align="left">âš¡ï¸ å‘å±•ä¸ºâ€œServer Component + Edgeæ¸²æŸ“â€ä¸»å¯¼</td></tr><tr><td align="left">åç«¯æœåŠ¡å±‚</td><td align="left">æ•°æ®ä¸ä¸šåŠ¡é€»è¾‘</td><td align="left">Node.js 22 / Deno 2 / Bun / NestJS</td><td align="left">ğŸ§© TypeScriptæˆä¸»æµã€è½»é‡å¼‚æ­¥ä½“ç³»</td></tr><tr><td align="left">APIä¸æ•°æ®å±‚</td><td align="left">API Gatewayã€GraphQLã€RAGæ•°æ®æ¥å£</td><td align="left">Apollo Server / tRPC / OpenAPI 4.0</td><td align="left">ğŸ”— â€œè¯­ä¹‰APIâ€å´›èµ·ï¼ŒAIé©±åŠ¨æ¥å£ç»“æ„</td></tr><tr><td align="left">æ•°æ®å±‚</td><td align="left">æ•°æ®å­˜å‚¨ä¸æ£€ç´¢</td><td align="left">PostgreSQL 17 / ClickHouse / Redis 8 / Vector DBs (Milvus, Pinecone)</td><td align="left">ğŸª„ ç»“æ„åŒ– + å‘é‡åŒ–å¹¶è¡Œè¶‹åŠ¿</td></tr><tr><td align="left">äº‘åŸç”Ÿå±‚</td><td align="left">å¯éƒ¨ç½²ä¸å¼¹æ€§ç®¡ç†</td><td align="left">Kubernetes / Docker / Cloudflare Workers / Vercel</td><td align="left">â˜ï¸ ä»K8Sèµ°å‘â€œè¾¹ç¼˜ç®—åŠ›+FaaSç¼–æ’â€</td></tr><tr><td align="left">AIæœåŠ¡å±‚</td><td align="left">LLMäº¤äº’ä¸æ™ºèƒ½é€»è¾‘</td><td align="left">OpenAIã€Claudeã€Qwenã€Llama3 + LangChainã€RAGflow</td><td align="left">ğŸ§  æ¶æ„åµŒå…¥AI AgentåŒ–</td></tr><tr><td align="left">DevOpså±‚</td><td align="left">æŒç»­é›†æˆä¸è‡ªåŠ¨åŒ–</td><td align="left">GitHub Actions / ArgoCD / Terraform / Pulumi</td><td align="left">ğŸ› ï¸ â€œIaC + è¯­ä¹‰CI/CD Pipelineâ€ æ–°å½¢æ€</td></tr><tr><td align="left">å®‰å…¨ä¸ç›‘æ§å±‚</td><td align="left">æµé‡åˆ†æã€éšç§ä¿æŠ¤</td><td align="left">OpenTelemetry / Elastic / Sentry / Auth0</td><td align="left">ğŸ§¯ è‡ªåŠ¨å¼‚å¸¸+å®‰å…¨æ£€æµ‹AIåŒ–</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ğŸ§  ä¸‰ã€2025 å¹´å…¸å‹å…¨æ ˆæ¶æ„çš„äº”å¤§æ¨¡å¼</h2>
<p>è®©æˆ‘ä»¬ä»æ¶æ„é£æ ¼çš„è§’åº¦ï¼Œçœ‹å½“å‰å®é™…æœ€å…·ä»£è¡¨æ€§çš„äº”ç§å…¨æ ˆæ¨¡å¼ğŸ‘‡</p>
<hr/>
<h3 data-id="heading-3">ğŸ”¸ 1. <strong>Next.js + NestJS + PostgreSQL + LangChain</strong></h3>
<p>ğŸ§© <strong>é€‚ç”¨åœºæ™¯ï¼šä¸­å‹AIå¢å¼ºWebåº”ç”¨</strong></p>
<p><strong>æ ¸å¿ƒç†å¿µï¼š</strong> å…¨æ ˆåŒæ„ + AIä¸­å°</p>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
  <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[Next.js 15 å‰ç«¯]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[NestJS APIæœåŠ¡å±‚]</span>
  <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[(PostgreSQL)]</span>
  <span class="hljs-selector-tag">B</span> --&gt; D<span class="hljs-selector-attr">[LangChain AIé€»è¾‘å±‚]</span>
  D --&gt; E<span class="hljs-selector-attr">[LLMæ¨¡å‹API]</span>
</code></pre>
<p>âœ¨ ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åˆ©ç”¨ <strong>Next.js Server Actions</strong> é¿å…å¤šå±‚ API å­˜å‚¨</li>
<li>é€šè¿‡ LangChain èåˆè‡ªç„¶è¯­è¨€åŠŸèƒ½</li>
<li>å‰åç«¯ç»Ÿä¸€çš„ TypeScript ç”Ÿæ€ï¼Œ<strong>å¼€å‘ä½“éªŒæè‡´ç»Ÿä¸€</strong></li>
</ul>
<hr/>
<h3 data-id="heading-4">ğŸ”¸ 2. <strong>Remix + Cloudflare Workers + VectorDB (Pinecone/Milvus)</strong></h3>
<p>âš™ï¸ <strong>é€‚ç”¨åœºæ™¯ï¼šé«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„è¾¹ç¼˜AIå†…å®¹å¹³å°</strong></p>
<p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong> æ¯ä¸€æ¬¡è¯·æ±‚å°±æ˜¯ä¸€ä¸ªâ€œæ™ºèƒ½å‡½æ•°â€</p>
<ul>
<li>ğŸ§  æ¯ä¸ªç”¨æˆ·è¯·æ±‚åœ¨è¾¹ç¼˜èŠ‚ç‚¹ä¸Šç›´æ¥æ‰§è¡Œï¼ˆFaaSå‡½æ•°ï¼‰</li>
<li>ğŸ§© æ•°æ®å‘é‡åŒ–å­˜å‚¨ï¼Œæ”¯æŒè¯­ä¹‰æ£€ç´¢</li>
<li>ğŸª¶ å‡ ä¹æ— è¿ç»´æˆæœ¬ï¼Œè‡ªåŠ¨æ‰©å±•</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Cloudflare Worker ç¤ºä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
    <span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">url</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"q"</span>);
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">AI</span>.<span class="hljs-title function_">queryVector</span>(<span class="hljs-string">"my-index"</span>, query);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({ result });
  }
};
</code></pre>
<hr/>
<h3 data-id="heading-5">ğŸ”¸ 3. <strong>Astro + Deno + Supabase + OpenAI</strong></h3>
<p>ğŸŒŸ <strong>é€‚ç”¨åœºæ™¯ï¼šè½»é‡é™æ€ç½‘ç«™ + æ™ºèƒ½å†…å®¹ç”Ÿæˆ</strong></p>
<p>Astro åœ¨ 2025 å¹´å·²ä¸å†æ˜¯â€œé™æ€ç½‘ç«™ç”Ÿæˆå™¨â€ï¼Œè€Œæ˜¯<strong>AIé¡µé¢åˆæˆå¼•æ“</strong>ï¼š</p>
<ul>
<li>å‰ç«¯æç®€ç»„ä»¶æ¸²æŸ“</li>
<li>Deno æä¾›è½»é‡å¼å‡½æ•°æ‰§è¡Œå±‚</li>
<li>é…åˆ Supabase å®ç° Serverless æ•°æ®åŒæ­¥</li>
</ul>
<p>ğŸ¤“ ä¼˜ç‚¹ï¼š<br/>
<strong>æé€Ÿéƒ¨ç½² + é›¶é…ç½®AIæ¥å…¥ + æä½æˆæœ¬</strong></p>
<hr/>
<h3 data-id="heading-6">ğŸ”¸ 4. <strong>Bun Full-Stackï¼ˆBun + Elysia + SQLite + Edgeéƒ¨ç½²ï¼‰</strong></h3>
<p>ğŸ° <strong>é€‚ç”¨åœºæ™¯ï¼šåˆ›ä¸šçº§Webå…¨æ ˆé¡¹ç›®</strong></p>
<p><strong>å…³é”®è¯ï¼šæå¿«å¯åŠ¨ã€æ— ä¾èµ–ç—›ç‚¹</strong></p>
<p>Bun å·²æˆä¸º Node.js çš„â€œæ€§èƒ½ç»§æ‰¿è€…â€ï¼š</p>
<ul>
<li>å†…ç½® HTTPã€æ‰“åŒ…ã€æµ‹è¯•å·¥å…·</li>
<li>Elysia æ¡†æ¶æä¾›ç±»å‹å®‰å…¨çš„ API</li>
<li>SQLite ä½œä¸ºè½»é‡åµŒå…¥å¼æ•°æ®åº“</li>
<li>æ”¯æŒç›´æ¥éƒ¨ç½²è‡³ Vercel Edge Runtime</li>
</ul>
<p>ğŸ§® ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>å¼€å‘ -&gt; éƒ¨ç½²è·¯å¾„æœ€çŸ­</strong></li>
<li><strong>æ€§èƒ½è¾¾åˆ° â€œæ¯æ¯«ç§’éƒ½æ˜¯æµªè´¹â€ çš„å¢ƒç•Œ</strong></li>
</ul>
<hr/>
<h3 data-id="heading-7">ğŸ”¸ 5. <strong>AI-Driven Serverless Meshï¼šAIGC + RAG + FaaSé›†ç¾¤</strong></h3>
<p>ğŸ§  <strong>é€‚ç”¨åœºæ™¯ï¼šä¼ä¸šçº§æ™ºèƒ½åº”ç”¨åå°</strong></p>
<p>æ ¸å¿ƒé€»è¾‘ï¼š</p>
<blockquote>
<p>â€œæ¯ä¸ªä¸šåŠ¡èŠ‚ç‚¹éƒ½æ˜¯å¯å­¦ä¹ çš„AgentèŠ‚ç‚¹ã€‚â€</p>
</blockquote>
<p>æŠ€æœ¯ç»„åˆï¼š</p>
<ul>
<li>å‰ç«¯ï¼šReact / SvelteKit</li>
<li>æœåŠ¡å±‚ï¼šFaaSï¼ˆAWS Lambda / é˜¿é‡ŒServerlessï¼‰</li>
<li>AIæ¥å…¥å±‚ï¼šRAGï¼ˆRetrieval Augmented Generationï¼‰ç»“æ„</li>
<li>å‘é‡æ•°æ®åº“ï¼šMilvus / Chroma</li>
<li>æ™ºèƒ½ç¼–æ’å±‚ï¼šLangGraph / AutoGen</li>
</ul>
<p>ğŸ•¸ï¸ æ¶æ„å›¾ç¤ºæ„ï¼š</p>
<pre><code class="hljs">ç”¨æˆ·è¯·æ±‚
   â†“
Webå‰ç«¯ï¼ˆReactå‰ç«¯AIåŠ©æ‰‹ï¼‰
   â†“
API Gatewayï¼ˆæ£€ç´¢/ç¼“å­˜/è°ƒåº¦ï¼‰
   â†“
RAGæœåŠ¡å±‚ï¼ˆæ–‡æœ¬åµŒå…¥ + ä¸Šä¸‹æ–‡æ··åˆï¼‰
   â†“
LLMè°ƒç”¨æ± ï¼ˆå¤šæ¨¡å‹å¹¶å‘ï¼‰
   â†“
ä¸šåŠ¡å‡½æ•°FaaSï¼ˆæŒ‰ä»»åŠ¡ç±»å‹è‡ªåŠ¨æ¿€æ´»ï¼‰
</code></pre>
<p>è¿™ç§æ¶æ„<strong>å¤©ç„¶æ”¯æŒæ‰©å±•å’Œè‡ªæ²»</strong>ï¼Œ<br/>
å¯ä»¥è®©æ•´ä¸ªç³»ç»Ÿä»¥â€œæ™ºèƒ½å¾®æœåŠ¡ç¾¤â€çš„å½¢å¼æŒç»­è‡ªä¸»æ¼”åŒ–ã€‚ğŸ¤¯</p>
<hr/>
<h2 data-id="heading-8">âš™ï¸ å››ã€æŠ€æœ¯åº•å±‚è¶‹åŠ¿ï¼šå…¨æ ˆ=AI+äº‘åŸç”Ÿ+è¯­ä¹‰æ¥å£</h2>
<p>2025å¹´çš„å…¨æ ˆç¯å¢ƒå˜åŒ–ä¸æ˜¯ç®€å•çš„æŠ€æœ¯å åŠ ï¼Œè€Œæ˜¯<strong>èŒƒå¼è¿ç§»</strong> âš¡ï¸ã€‚</p>



































<table><thead><tr><th align="left">å±‚çº§</th><th align="left">ä¼ ç»Ÿå½¢æ€</th><th align="left">2025æ–°å½¢æ€</th></tr></thead><tbody><tr><td align="left">APIå±‚</td><td align="left">REST / GraphQL</td><td align="left">è¯­ä¹‰Prompt APIï¼ˆAIæ¥å£ç¼–æ’ï¼‰</td></tr><tr><td align="left">æ•°æ®å±‚</td><td align="left">SQL / NoSQL</td><td align="left">å‘é‡æ•°æ®åº“ + æ··åˆå­˜å‚¨å±‚</td></tr><tr><td align="left">å¼€å‘æµç¨‹</td><td align="left">CI/CD</td><td align="left">AIGCé©±åŠ¨çš„æ™ºèƒ½Pipelineï¼ˆè‡ªåŠ¨PRä¸Code Reviewï¼‰</td></tr><tr><td align="left">éƒ¨ç½²å½¢æ€</td><td align="left">äº‘ä¸»æœº / K8S</td><td align="left">Edge + Serverless Mesh</td></tr><tr><td align="left">å‰ç«¯æ¨¡å‹</td><td align="left">CSR/SSR</td><td align="left">æ™ºèƒ½ç»„ä»¶ï¼ˆAIç”ŸæˆåŠ¨æ€UIï¼‰</td></tr></tbody></table>
<p>ğŸ‘‰ æ¢å¥è¯è¯´ï¼Œå…¨æ ˆä¸åªæ˜¯â€œèƒ½å¹²â€ï¼Œè€Œæ˜¯â€œèƒ½æ‡‚ä¸Šä¸‹æ–‡çš„ç³»ç»Ÿâ€ã€‚</p>
<hr/>
<h2 data-id="heading-9">ğŸ§® äº”ã€æœªæ¥æ¶æ„è®¾è®¡æ€ç»´ï¼šä»â€œè°ƒç”¨é€»è¾‘â€åˆ°â€œç³»ç»Ÿæ€è€ƒâ€</h2>
<p>ç°ä»£å…¨æ ˆæ¶æ„å¸ˆéœ€è¦åƒæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨ä¸€æ ·æ€è€ƒï¼š</p>
<blockquote>
<p>â€œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œéƒ½æ˜¯ä¸€æ¬¡ç®—åŠ›è°ƒé…â€<br/>
â€œæ¯ä¸€ä¸ªç»„ä»¶æ¸²æŸ“ï¼Œéƒ½æ˜¯ä¸€æ¬¡èµ„æºå¤ç”¨â€</p>
</blockquote>
<p>åº•å±‚å“²å­¦ï¼š</p>
<ol>
<li><strong>å‡½æ•°å³ä»»åŠ¡å•å…ƒ</strong> â†’ æ— çŠ¶æ€åŒ–ä½¿ç³»ç»Ÿæ›´ä¼˜é›…</li>
<li><strong>æ•°æ®å³è®°å¿†</strong> â†’ åµŒå…¥å¼å­˜å‚¨æ˜¯å…¨æ ˆçš„çµé­‚</li>
<li><strong>AIå³å·¥ç¨‹åŠ©æ‰‹</strong> â†’ è‡ªåŠ¨å®Œæˆæ¨¡å¼åŒ¹é…ä¸ä»£ç ä¼˜åŒ–</li>
</ol>
<p>ğŸ§© ä¸¾ä¾‹ï¼šä½ æœªæ¥å¯èƒ½è¿™æ ·å®šä¹‰å‰åç«¯é€šä¿¡æ¥å£ğŸ‘‡</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AIAction</span> = <span class="hljs-title function_ invoke__">defineAgent</span>({
  <span class="hljs-attr">goal</span>: <span class="hljs-string">"å¸®åŠ©ç”¨æˆ·ç”Ÿæˆç™»é™†é¡µç»„ä»¶"</span>,
  <span class="hljs-attr">inputs</span>: [<span class="hljs-string">"ä¸»é¢˜è‰²"</span>, <span class="hljs-string">"æ’ç‰ˆåå¥½"</span>],
  <span class="hljs-attr">output</span>: <span class="hljs-string">"Reactç»„ä»¶ä»£ç "</span>,
  <span class="hljs-attr">engine</span>: <span class="hljs-string">"GPT-5"</span>
});

AIAction.<span class="hljs-title function_ invoke__">execute</span>({ <span class="hljs-attr">theme</span>: <span class="hljs-string">"dark"</span>, <span class="hljs-attr">layout</span>: <span class="hljs-string">"modern"</span> });
</code></pre>
<p>è¿™ä¸æ˜¯æœªæ¥å¹»æƒ³ï¼Œè€Œæ˜¯<strong>ç°å®ä¸­AI Agentæ¶æ„æ¨¡æ¿åŒ–çš„å…¸å‹ä½“ç°</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-10">ğŸ”® å…­ã€æ€»ç»“ï¼š2025å¹´å…¨æ ˆçš„å…³é”®è¯</h2>

































<table><thead><tr><th align="left">å…³é”®è¯</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">ğŸ§  AI-Enhanced</td><td align="left">è®©AIæˆä¸ºæ¶æ„å‚ä¸è€…ï¼Œè€Œéä»…æ˜¯å·¥å…·</td></tr><tr><td align="left">â˜ï¸ Serverless Everywhere</td><td align="left">æ— æœåŠ¡å™¨é€»è¾‘ç»Ÿæ²»åº”ç”¨æ¶æ„</td></tr><tr><td align="left">ğŸ’¬ Semantic API</td><td align="left">ä»å‡½æ•°æ¥å£è½¬å‹ä¸ºè¯­ä¹‰æ¥å£</td></tr><tr><td align="left">ğŸŒ Edge + Cloud</td><td align="left">æ— ç¼è¾¹ç¼˜éƒ¨ç½²å½¢æˆæ··åˆè®¡ç®—ç½‘</td></tr><tr><td align="left">ğŸ§© Full-Stack Type Safety</td><td align="left">å…¨é“¾è·¯TypeScriptåŒ–</td></tr><tr><td align="left">ğŸª„ AutoDevOps</td><td align="left">è‡ªåŠ¨éƒ¨ç½²ã€è‡ªæˆ‘è°ƒè¯•ã€è‡ªæ„ˆç³»ç»Ÿæˆä¸ºæ ‡é…</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">ğŸ’¬ ç»“è¯­ï¼š</h2>
<p>å¦‚æœè¯´ <strong>2015 å¹´çš„å…¨æ ˆå·¥ç¨‹å¸ˆæ˜¯å·¥åŒ </strong>ï¼Œ<br/>
é‚£ä¹ˆ <strong>2025 å¹´çš„å…¨æ ˆå·¥ç¨‹å¸ˆåˆ™æ˜¯â€œç³»ç»Ÿé©¯å…½å¸ˆâ€</strong> ã€‚</p>
<blockquote>
<p>ä»–ä»¬ç”¨ä»£ç ã€AIä¸ç®—åŠ›è°ƒåº¦ï¼Œ<br/>
è®©æœºå™¨ä¸ä»…æ‰§è¡Œé€»è¾‘ï¼Œæ›´ç†è§£æ„å›¾ã€‚</p>
</blockquote>
<p>åˆ«æ€•AIå–ä»£ä½ ï¼Œ<strong>è®©AIæˆä¸ºä½ çš„ååŒçº¿ç¨‹</strong>ã€‚<br/>
æœªæ¥çš„æ¶æ„ï¼Œä¸ä»…èƒ½è¿è¡Œï¼Œè¿˜èƒ½<strong>è‡ªæˆ‘ä¼˜åŒ–ä¸å­¦ä¹ </strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœ€å…¨éŸ³é¢‘å¤„ç†WaveSurferjsé…ç½®æ–‡æ¡£äºŒï¼ˆäº‹ä»¶ï¼‰]]></title>    <link>https://juejin.cn/post/7579544295344128051</link>    <guid>https://juejin.cn/post/7579544295344128051</guid>    <pubDate>2025-12-04T01:48:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579544295344128051" data-draft-id="7579499567869427762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœ€å…¨éŸ³é¢‘å¤„ç†WaveSurferjsé…ç½®æ–‡æ¡£äºŒï¼ˆäº‹ä»¶ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-04T01:48:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QINS"/> <meta itemprop="url" content="https://juejin.cn/user/3825956196198669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœ€å…¨éŸ³é¢‘å¤„ç†WaveSurferjsé…ç½®æ–‡æ¡£äºŒï¼ˆäº‹ä»¶ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956196198669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QINS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:48:01.000Z" title="Thu Dec 04 2025 01:48:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€äº‹ä»¶åˆ†ç±»æ¦‚è§ˆ</h2>
<h3 data-id="heading-1">äº‹ä»¶ç±»å‹åˆ†ç±»</h3>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</strong> - å®ä¾‹åˆ›å»ºã€é”€æ¯</li>
<li><strong>éŸ³é¢‘åŠ è½½äº‹ä»¶</strong> - éŸ³é¢‘æ–‡ä»¶åŠ è½½è¿‡ç¨‹</li>
<li><strong>æ’­æ”¾æ§åˆ¶äº‹ä»¶</strong> - æ’­æ”¾ã€æš‚åœã€åœæ­¢</li>
<li><strong>æ—¶é—´è¿›åº¦äº‹ä»¶</strong> - æ’­æ”¾è¿›åº¦å˜åŒ–</li>
<li><strong>äº¤äº’äº‹ä»¶</strong> - ç”¨æˆ·äº¤äº’æ“ä½œ</li>
<li><strong>éŸ³é¢‘å¤„ç†äº‹ä»¶</strong> - éŸ³é¢‘æ•°æ®ç›¸å…³</li>
<li><strong>æ’ä»¶äº‹ä»¶</strong> - æ’ä»¶ç‰¹æœ‰äº‹ä»¶</li>
<li><strong>é”™è¯¯äº‹ä»¶</strong> - å¼‚å¸¸æƒ…å†µ</li>
</ol>
<h2 data-id="heading-2">äºŒã€äº‹ä»¶åˆ—è¡¨ï¼ˆè¡¨æ ¼å½¢å¼ï¼‰</h2>
<h3 data-id="heading-3">1. ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</h3>





























<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>ready</code></td><td>éŸ³é¢‘è§£ç å®Œæˆå¹¶å‡†å¤‡å°±ç»ª</td><td><code>duration</code></td><td><code>wavesurfer.on('ready', (duration) =&gt; {})</code></td></tr><tr><td><code>destroy</code></td><td>å®ä¾‹é”€æ¯æ—¶</td><td>æ— </td><td><code>wavesurfer.on('destroy', () =&gt; {})</code></td></tr><tr><td><code>init</code></td><td>åˆå§‹åŒ–å®Œæˆ</td><td>æ— </td><td><code>wavesurfer.on('init', () =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-4">2. éŸ³é¢‘åŠ è½½äº‹ä»¶</h3>









































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>load</code></td><td>å¼€å§‹åŠ è½½éŸ³é¢‘æ—¶</td><td><code>url</code></td><td><code>wavesurfer.on('load', (url) =&gt; {})</code></td></tr><tr><td><code>loading</code></td><td>åŠ è½½è¿‡ç¨‹ä¸­</td><td><code>percent</code></td><td><code>wavesurfer.on('loading', (percent) =&gt; {})</code></td></tr><tr><td><code>decode</code></td><td>éŸ³é¢‘è§£ç å¼€å§‹æ—¶</td><td>æ— </td><td><code>wavesurfer.on('decode', () =&gt; {})</code></td></tr><tr><td><code>waveform-ready</code></td><td>æ³¢å½¢æ•°æ®å‡†å¤‡å®Œæˆ</td><td>æ— </td><td><code>wavesurfer.on('waveform-ready', () =&gt; {})</code></td></tr><tr><td><code>audio-process</code></td><td>Web Audio API å¤„ç†éŸ³é¢‘æ—¶</td><td><code>time</code></td><td><code>wavesurfer.on('audio-process', (time) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-5">3. æ’­æ”¾æ§åˆ¶äº‹ä»¶</h3>









































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>play</code></td><td>å¼€å§‹æ’­æ”¾æ—¶</td><td>æ— </td><td><code>wavesurfer.on('play', () =&gt; {})</code></td></tr><tr><td><code>pause</code></td><td>æš‚åœæ’­æ”¾æ—¶</td><td>æ— </td><td><code>wavesurfer.on('pause', () =&gt; {})</code></td></tr><tr><td><code>finish</code></td><td>æ’­æ”¾ç»“æŸæ—¶</td><td>æ— </td><td><code>wavesurfer.on('finish', () =&gt; {})</code></td></tr><tr><td><code>stop</code></td><td>åœæ­¢æ’­æ”¾æ—¶</td><td>æ— </td><td><code>wavesurfer.on('stop', () =&gt; {})</code></td></tr><tr><td><code>seek</code></td><td>è·³è½¬åˆ°æŒ‡å®šä½ç½®æ—¶</td><td><code>progress</code></td><td><code>wavesurfer.on('seek', (progress) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-6">4. æ—¶é—´è¿›åº¦äº‹ä»¶</h3>





























<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>audioprocess</code></td><td>æ’­æ”¾è¿‡ç¨‹ä¸­æŒç»­è§¦å‘</td><td><code>currentTime</code></td><td><code>wavesurfer.on('audioprocess', (time) =&gt; {})</code></td></tr><tr><td><code>timeupdate</code></td><td>æ’­æ”¾æ—¶é—´æ›´æ–°æ—¶</td><td><code>currentTime</code></td><td><code>wavesurfer.on('timeupdate', (time) =&gt; {})</code></td></tr><tr><td><code>scroll</code></td><td>æ³¢å½¢æ»šåŠ¨æ—¶</td><td><code>scrollLeft</code></td><td><code>wavesurfer.on('scroll', (scroll) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-7">5. äº¤äº’äº‹ä»¶</h3>















































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>click</code></td><td>ç‚¹å‡»æ³¢å½¢å›¾æ—¶</td><td><code>relativeX</code>, <code>relativeY</code></td><td><code>wavesurfer.on('click', (x, y) =&gt; {})</code></td></tr><tr><td><code>dblclick</code></td><td>åŒå‡»æ³¢å½¢å›¾æ—¶</td><td><code>relativeX</code>, <code>relativeY</code></td><td><code>wavesurfer.on('dblclick', (x, y) =&gt; {})</code></td></tr><tr><td><code>dragstart</code></td><td>å¼€å§‹æ‹–åŠ¨æ—¶</td><td><code>relativeX</code></td><td><code>wavesurfer.on('dragstart', (x) =&gt; {})</code></td></tr><tr><td><code>dragmove</code></td><td>æ‹–åŠ¨è¿‡ç¨‹ä¸­</td><td><code>relativeX</code></td><td><code>wavesurfer.on('dragmove', (x) =&gt; {})</code></td></tr><tr><td><code>dragend</code></td><td>æ‹–åŠ¨ç»“æŸæ—¶</td><td><code>relativeX</code></td><td><code>wavesurfer.on('dragend', (x) =&gt; {})</code></td></tr><tr><td><code>interaction</code></td><td>ä»»ä½•äº¤äº’å‘ç”Ÿæ—¶</td><td>æ— </td><td><code>wavesurfer.on('interaction', () =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-8">6. éŸ³é¢‘å¤„ç†äº‹ä»¶</h3>



































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>volume</code></td><td>éŸ³é‡æ”¹å˜æ—¶</td><td><code>volume</code></td><td><code>wavesurfer.on('volume', (vol) =&gt; {})</code></td></tr><tr><td><code>mute</code></td><td>é™éŸ³æ—¶</td><td><code>muted</code></td><td><code>wavesurfer.on('mute', (isMuted) =&gt; {})</code></td></tr><tr><td><code>backend-change</code></td><td>éŸ³é¢‘åç«¯æ”¹å˜æ—¶</td><td><code>backend</code></td><td><code>wavesurfer.on('backend-change', (backend) =&gt; {})</code></td></tr><tr><td><code>rate</code></td><td>æ’­æ”¾é€Ÿç‡æ”¹å˜æ—¶</td><td><code>rate</code></td><td><code>wavesurfer.on('rate', (rate) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-9">7. é”™è¯¯äº‹ä»¶</h3>

















<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>error</code></td><td>å‘ç”Ÿé”™è¯¯æ—¶</td><td><code>error</code></td><td><code>wavesurfer.on('error', (error) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-10">8. åŒºåŸŸæ’ä»¶äº‹ä»¶ (Regions Plugin)</h3>

































































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>region-created</code></td><td>åŒºåŸŸåˆ›å»ºæ—¶</td><td><code>region</code></td><td><code>wavesurfer.on('region-created', (region) =&gt; {})</code></td></tr><tr><td><code>region-updated</code></td><td>åŒºåŸŸæ›´æ–°æ—¶</td><td><code>region</code></td><td><code>wavesurfer.on('region-updated', (region) =&gt; {})</code></td></tr><tr><td><code>region-removed</code></td><td>åŒºåŸŸåˆ é™¤æ—¶</td><td><code>region</code></td><td><code>wavesurfer.on('region-removed', (region) =&gt; {})</code></td></tr><tr><td><code>region-in</code></td><td>æ’­æ”¾è¿›å…¥åŒºåŸŸæ—¶</td><td><code>region</code></td><td><code>wavesurfer.on('region-in', (region) =&gt; {})</code></td></tr><tr><td><code>region-out</code></td><td>æ’­æ”¾ç¦»å¼€åŒºåŸŸæ—¶</td><td><code>region</code></td><td><code>wavesurfer.on('region-out', (region) =&gt; {})</code></td></tr><tr><td><code>region-mouseenter</code></td><td>é¼ æ ‡è¿›å…¥åŒºåŸŸæ—¶</td><td><code>region</code>, <code>e</code></td><td><code>wavesurfer.on('region-mouseenter', (region, e) =&gt; {})</code></td></tr><tr><td><code>region-mouseleave</code></td><td>é¼ æ ‡ç¦»å¼€åŒºåŸŸæ—¶</td><td><code>region</code>, <code>e</code></td><td><code>wavesurfer.on('region-mouseleave', (region, e) =&gt; {})</code></td></tr><tr><td><code>region-click</code></td><td>ç‚¹å‡»åŒºåŸŸæ—¶</td><td><code>region</code>, <code>e</code></td><td><code>wavesurfer.on('region-click', (region, e) =&gt; {})</code></td></tr><tr><td><code>region-dblclick</code></td><td>åŒå‡»åŒºåŸŸæ—¶</td><td><code>region</code>, <code>e</code></td><td><code>wavesurfer.on('region-dblclick', (region, e) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-11">9. æ ‡è®°æ’ä»¶äº‹ä»¶ (Markers Plugin)</h3>









































<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>marker-created</code></td><td>æ ‡è®°åˆ›å»ºæ—¶</td><td><code>marker</code></td><td><code>wavesurfer.on('marker-created', (marker) =&gt; {})</code></td></tr><tr><td><code>marker-updated</code></td><td>æ ‡è®°æ›´æ–°æ—¶</td><td><code>marker</code></td><td><code>wavesurfer.on('marker-updated', (marker) =&gt; {})</code></td></tr><tr><td><code>marker-removed</code></td><td>æ ‡è®°åˆ é™¤æ—¶</td><td><code>marker</code></td><td><code>wavesurfer.on('marker-removed', (marker) =&gt; {})</code></td></tr><tr><td><code>marker-click</code></td><td>ç‚¹å‡»æ ‡è®°æ—¶</td><td><code>marker</code>, <code>e</code></td><td><code>wavesurfer.on('marker-click', (marker, e) =&gt; {})</code></td></tr><tr><td><code>marker-drag</code></td><td>æ‹–åŠ¨æ ‡è®°æ—¶</td><td><code>marker</code>, <code>e</code></td><td><code>wavesurfer.on('marker-drag', (marker, e) =&gt; {})</code></td></tr></tbody></table>
<h3 data-id="heading-12">10. å…‰æ ‡æ’ä»¶äº‹ä»¶ (Cursor Plugin)</h3>





























<table><thead><tr><th>äº‹ä»¶åç§°</th><th>è§¦å‘æ—¶æœº</th><th>å›è°ƒå‚æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>cursor-created</code></td><td>å…‰æ ‡åˆ›å»ºæ—¶</td><td><code>cursor</code></td><td><code>wavesurfer.on('cursor-created', (cursor) =&gt; {})</code></td></tr><tr><td><code>cursor-move</code></td><td>å…‰æ ‡ç§»åŠ¨æ—¶</td><td><code>cursor</code>, <code>time</code></td><td><code>wavesurfer.on('cursor-move', (cursor, time) =&gt; {})</code></td></tr><tr><td><code>cursor-click</code></td><td>ç‚¹å‡»å…‰æ ‡æ—¶</td><td><code>cursor</code>, <code>e</code></td><td><code>wavesurfer.on('cursor-click', (cursor, e) =&gt; {})</code></td></tr></tbody></table>
<h2 data-id="heading-13">ä¸‰ã€äº‹ä»¶ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-14">1. åŸºæœ¬äº‹ä»¶ç›‘å¬</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå®ä¾‹</span>
<span class="hljs-keyword">const</span> wavesurfer = <span class="hljs-title class_">WaveSurfer</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#waveform'</span>,
  <span class="hljs-attr">waveColor</span>: <span class="hljs-string">'violet'</span>,
  <span class="hljs-attr">progressColor</span>: <span class="hljs-string">'purple'</span>
});

<span class="hljs-comment">// ç›‘å¬å•ä¸ªäº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'ready'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'éŸ³é¢‘å‡†å¤‡å°±ç»ª'</span>);
  wavesurfer.<span class="hljs-title function_">play</span>();
});

<span class="hljs-comment">// ç›‘å¬å¤šä¸ªäº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'play'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼€å§‹æ’­æ”¾'</span>));
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pause'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æš‚åœæ’­æ”¾'</span>));
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’­æ”¾ç»“æŸ'</span>));

<span class="hljs-comment">// ç›‘å¬è¿›åº¦äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioprocess'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">currentTime</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰æ—¶é—´:'</span>, currentTime.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>), <span class="hljs-string">'ç§’'</span>);
});

<span class="hljs-comment">// ç›‘å¬é”™è¯¯äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘ç”Ÿé”™è¯¯:'</span>, error);
});
</code></pre>
<h3 data-id="heading-15">2. ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åªè§¦å‘ä¸€æ¬¡çš„äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">once</span>(<span class="hljs-string">'ready'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'éŸ³é¢‘ç¬¬ä¸€æ¬¡å‡†å¤‡å°±ç»ª'</span>);
});

<span class="hljs-comment">// ä½¿ç”¨Promiseé£æ ¼</span>
<span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  wavesurfer.<span class="hljs-title function_">once</span>(<span class="hljs-string">'ready'</span>, resolve);
});
</code></pre>
<h3 data-id="heading-16">3. äº‹ä»¶å‚æ•°ä½¿ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨äº‹ä»¶å‚æ•°</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'loading'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">percent</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åŠ è½½è¿›åº¦: <span class="hljs-subst">${percent}</span>%`</span>);
  <span class="hljs-comment">// æ›´æ–°è¿›åº¦æ¡</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'progress'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = percent + <span class="hljs-string">'%'</span>;
});

wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'seek'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">progress</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·³è½¬åˆ°: <span class="hljs-subst">${(progress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
});

wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'volume'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">volume</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`éŸ³é‡è°ƒæ•´ä¸º: <span class="hljs-subst">${volume}</span>`</span>);
});
</code></pre>
<h3 data-id="heading-17">4. åŒºåŸŸäº‹ä»¶å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŒºåŸŸæ’ä»¶äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'region-created'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">region</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŒºåŸŸåˆ›å»º:'</span>, region.<span class="hljs-property">id</span>);
  
  <span class="hljs-comment">// åŒºåŸŸç‚¹å‡»äº‹ä»¶</span>
  region.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŒºåŸŸè¢«ç‚¹å‡»:'</span>, region.<span class="hljs-property">id</span>);
    wavesurfer.<span class="hljs-title function_">play</span>(region.<span class="hljs-property">start</span>, region.<span class="hljs-property">end</span>);
  });
  
  <span class="hljs-comment">// åŒºåŸŸé¼ æ ‡äº‹ä»¶</span>
  region.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¼ æ ‡è¿›å…¥åŒºåŸŸ'</span>);
    region.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(255, 0, 0, 0.3)'</span> });
  });
  
  region.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¼ æ ‡ç¦»å¼€åŒºåŸŸ'</span>);
    region.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(0, 0, 255, 0.3)'</span> });
  });
});

<span class="hljs-comment">// æ’­æ”¾è¿›å…¥/ç¦»å¼€åŒºåŸŸäº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'region-in'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">region</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿›å…¥åŒºåŸŸ:'</span>, region.<span class="hljs-property">id</span>);
});

wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'region-out'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">region</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¦»å¼€åŒºåŸŸ:'</span>, region.<span class="hljs-property">id</span>);
});
</code></pre>
<h3 data-id="heading-18">5. äº¤äº’äº‹ä»¶å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç‚¹å‡»äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">relativeX, relativeY</span>) {
  <span class="hljs-keyword">const</span> duration = wavesurfer.<span class="hljs-title function_">getDuration</span>();
  <span class="hljs-keyword">const</span> currentTime = relativeX * duration;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç‚¹å‡»ä½ç½®: X=<span class="hljs-subst">${relativeX}</span>, Y=<span class="hljs-subst">${relativeY}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¯¹åº”æ—¶é—´: <span class="hljs-subst">${currentTime.toFixed(<span class="hljs-number">2</span>)}</span>ç§’`</span>);
  
  <span class="hljs-comment">// è·³è½¬åˆ°ç‚¹å‡»ä½ç½®</span>
  wavesurfer.<span class="hljs-title function_">seekTo</span>(relativeX);
});

<span class="hljs-comment">// åŒå‡»äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dblclick'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">relativeX, relativeY</span>) {
  <span class="hljs-comment">// åŒå‡»åˆ›å»ºæ ‡è®°</span>
  <span class="hljs-keyword">const</span> time = relativeX * wavesurfer.<span class="hljs-title function_">getDuration</span>();
  wavesurfer.<span class="hljs-title function_">addMarker</span>({
    <span class="hljs-attr">time</span>: time,
    <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'æ ‡è®°ç‚¹'</span>
  });
});
</code></pre>
<h3 data-id="heading-19">6. è‡ªå®šä¹‰äº‹ä»¶è§¦å‘</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">fireEvent</span>(<span class="hljs-string">'custom-event'</span>, { <span class="hljs-attr">data</span>: <span class="hljs-string">'custom data'</span> });

<span class="hljs-comment">// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'custom-event'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è‡ªå®šä¹‰äº‹ä»¶è§¦å‘:'</span>, data);
});
</code></pre>
<h3 data-id="heading-20">7. äº‹ä»¶ç§»é™¤</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlay</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’­æ”¾ä¸­...'</span>);
}

<span class="hljs-comment">// æ·»åŠ äº‹ä»¶ç›‘å¬</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioprocess'</span>, handlePlay);

<span class="hljs-comment">// ç§»é™¤ç‰¹å®šç›‘å¬å™¨</span>
wavesurfer.<span class="hljs-title function_">un</span>(<span class="hljs-string">'audioprocess'</span>, handlePlay);

<span class="hljs-comment">// ç§»é™¤æ‰€æœ‰audioprocessäº‹ä»¶ç›‘å¬å™¨</span>
wavesurfer.<span class="hljs-title function_">unAll</span>(<span class="hljs-string">'audioprocess'</span>);

<span class="hljs-comment">// ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨</span>
wavesurfer.<span class="hljs-title function_">unAll</span>();
</code></pre>
<h2 data-id="heading-21">å››ã€äº‹ä»¶ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾</h2>
<pre><code class="hljs language-arduino" lang="arduino">éŸ³é¢‘åŠ è½½è¿‡ç¨‹äº‹ä»¶æµï¼š
load â†’ loading â†’ decode â†’ ready â†’ waveform-ready
        â†“
      errorï¼ˆå¦‚æœå‘ç”Ÿé”™è¯¯ï¼‰

æ’­æ”¾è¿‡ç¨‹äº‹ä»¶æµï¼š
play â†’ audioprocessï¼ˆæŒç»­ï¼‰ â†’ pause/stop/finish
        â†“
     seekï¼ˆè·³è½¬æ—¶ï¼‰
        â†“
  volume/rateï¼ˆè®¾ç½®æ—¶ï¼‰

äº¤äº’äº‹ä»¶æµï¼š
click/dblclick â†’ dragstart â†’ dragmove â†’ dragend
      â†“
   interaction
</code></pre>
<h2 data-id="heading-22">äº”ã€äº‹ä»¶é…ç½®å‚æ•°è¡¨æ ¼</h2>
<h3 data-id="heading-23">äº‹ä»¶ç›¸å…³é…ç½®å‚æ•°</h3>






















































<table><thead><tr><th>å‚æ•°å</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th><th>å½±å“çš„äº‹ä»¶</th></tr></thead><tbody><tr><td><code>interact</code></td><td>Boolean</td><td>true</td><td>æ˜¯å¦å¯ç”¨äº¤äº’</td><td><code>click</code>, <code>dblclick</code>, <code>drag*</code></td></tr><tr><td><code>dragToSeek</code></td><td>Boolean</td><td>true</td><td>æ˜¯å¦å…è®¸æ‹–åŠ¨è·³è½¬</td><td><code>dragstart</code>, <code>dragmove</code>, <code>dragend</code></td></tr><tr><td><code>autoScroll</code></td><td>Boolean</td><td>true</td><td>æ’­æ”¾æ—¶è‡ªåŠ¨æ»šåŠ¨</td><td><code>scroll</code></td></tr><tr><td><code>scrollParent</code></td><td>Boolean</td><td>false</td><td>å¯ç”¨æ¨ªå‘æ»šåŠ¨</td><td><code>scroll</code></td></tr><tr><td><code>partialRender</code></td><td>Boolean</td><td>false</td><td>éƒ¨åˆ†æ¸²æŸ“</td><td>å½±å“æ¸²æŸ“ç›¸å…³äº‹ä»¶</td></tr><tr><td><code>splitChannels</code></td><td>Boolean</td><td>false</td><td>åˆ†ç¦»å£°é“æ˜¾ç¤º</td><td>å½±å“æ³¢å½¢æ¸²æŸ“äº‹ä»¶</td></tr></tbody></table>
<h3 data-id="heading-24">æ’­æ”¾æ§åˆ¶é…ç½®å‚æ•°</h3>








































<table><thead><tr><th>å‚æ•°å</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th><th>å½±å“çš„äº‹ä»¶</th></tr></thead><tbody><tr><td><code>audioRate</code></td><td>Number</td><td>1</td><td>æ’­æ”¾é€Ÿåº¦</td><td><code>rate</code></td></tr><tr><td><code>volume</code></td><td>Number</td><td>1</td><td>éŸ³é‡</td><td><code>volume</code>, <code>mute</code></td></tr><tr><td><code>loopSelection</code></td><td>Boolean</td><td>true</td><td>å¾ªç¯é€‰åŒº</td><td><code>region-in</code>, <code>region-out</code></td></tr><tr><td><code>backend</code></td><td>String</td><td>'WebAudio'</td><td>éŸ³é¢‘åç«¯</td><td><code>backend-change</code></td></tr></tbody></table>
<h3 data-id="heading-25">æ’ä»¶é…ç½®å‚æ•°</h3>





























































<table><thead><tr><th>æ’ä»¶</th><th>å‚æ•°å</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th><th>å½±å“çš„äº‹ä»¶</th></tr></thead><tbody><tr><td>Regions</td><td><code>regions</code></td><td>[]</td><td>åˆå§‹åŒºåŸŸ</td><td><code>region-*</code> äº‹ä»¶</td></tr><tr><td>Regions</td><td><code>dragSelection</code></td><td>true</td><td>å¯ç”¨æ‹–åŠ¨é€‰æ‹©</td><td><code>region-created</code></td></tr><tr><td>Regions</td><td><code>maxRegions</code></td><td>null</td><td>æœ€å¤§åŒºåŸŸæ•°</td><td>åŒºåŸŸç®¡ç†äº‹ä»¶</td></tr><tr><td>Markers</td><td><code>markers</code></td><td>[]</td><td>åˆå§‹æ ‡è®°</td><td><code>marker-*</code> äº‹ä»¶</td></tr><tr><td>Markers</td><td><code>markerWidth</code></td><td>2</td><td>æ ‡è®°å®½åº¦</td><td>æ ‡è®°æ¸²æŸ“äº‹ä»¶</td></tr><tr><td>Cursor</td><td><code>showTime</code></td><td>true</td><td>æ˜¾ç¤ºæ—¶é—´</td><td><code>cursor-move</code></td></tr><tr><td>Cursor</td><td><code>followCursorY</code></td><td>false</td><td>è·Ÿéšå…‰æ ‡Yè½´</td><td><code>cursor-move</code></td></tr></tbody></table>
<h2 data-id="heading-26">å…­ã€æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-27">1. äº‹ä»¶ç›‘å¬é¡ºåº</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨èçš„äº‹ä»¶ç›‘å¬é¡ºåº</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, handleError);          <span class="hljs-comment">// é¦–å…ˆç›‘å¬é”™è¯¯</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'load'</span>, handleLoadStart);       <span class="hljs-comment">// åŠ è½½å¼€å§‹</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'loading'</span>, updateProgress);     <span class="hljs-comment">// åŠ è½½è¿›åº¦</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'ready'</span>, initializePlayer);     <span class="hljs-comment">// å‡†å¤‡å°±ç»ª</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'play'</span>, updatePlayState);       <span class="hljs-comment">// æ’­æ”¾çŠ¶æ€</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pause'</span>, updatePlayState);      <span class="hljs-comment">// æš‚åœçŠ¶æ€</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioprocess'</span>, updateTime);    <span class="hljs-comment">// æ—¶é—´æ›´æ–°</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, handlePlaybackEnd);   <span class="hljs-comment">// æ’­æ”¾ç»“æŸ</span>
</code></pre>
<h3 data-id="heading-28">2. å†…å­˜ç®¡ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ç»„ä»¶é”€æ¯æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioPlayer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">wavesurfer</span> = <span class="hljs-title class_">WaveSurfer</span>.<span class="hljs-title function_">create</span>(config);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>();
  }
  
  <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventHandlers</span> = {
      <span class="hljs-attr">ready</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleReady</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">play</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlePlay</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">pause</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">handlePause</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
    };
    
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventHandlers</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[event, handler]</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wavesurfer</span>.<span class="hljs-title function_">on</span>(event, handler);
    });
  }
  
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventHandlers</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[event, handler]</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wavesurfer</span>.<span class="hljs-title function_">un</span>(event, handler);
    });
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">wavesurfer</span>.<span class="hljs-title function_">destroy</span>();
  }
}
</code></pre>
<h3 data-id="heading-29">3. äº‹ä»¶é˜²æŠ–å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯¹é¢‘ç¹è§¦å‘çš„äº‹ä»¶è¿›è¡Œé˜²æŠ–å¤„ç†</span>
<span class="hljs-keyword">let</span> debounceTimer;
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioprocess'</span>, <span class="hljs-function">(<span class="hljs-params">time</span>) =&gt;</span> {
  <span class="hljs-built_in">clearTimeout</span>(debounceTimer);
  debounceTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">updateUI</span>(time);
  }, <span class="hljs-number">100</span>); <span class="hljs-comment">// 100msé˜²æŠ–</span>
});

<span class="hljs-comment">// æˆ–è€…ä½¿ç”¨èŠ‚æµ</span>
<span class="hljs-keyword">let</span> lastUpdate = <span class="hljs-number">0</span>;
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">(<span class="hljs-params">scrollLeft</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">if</span> (now - lastUpdate &gt; <span class="hljs-number">200</span>) { <span class="hljs-comment">// 200msèŠ‚æµ</span>
    lastUpdate = now;
    <span class="hljs-title function_">updateScrollPosition</span>(scrollLeft);
  }
});
</code></pre>
<h3 data-id="heading-30">4. é”™è¯¯å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨é¢çš„é”™è¯¯å¤„ç†</span>
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WaveSurferé”™è¯¯:'</span>, error);
  
  <span class="hljs-comment">// æ ¹æ®é”™è¯¯ç±»å‹å¤„ç†</span>
  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'NetworkError'</span>)) {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶åœ°å€'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'decode'</span>)) {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'éŸ³é¢‘è§£ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'NotSupportedError'</span>)) {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'éŸ³é¢‘æ’­æ”¾é”™è¯¯: '</span> + error.<span class="hljs-property">message</span>);
  }
  
  <span class="hljs-comment">// æ¢å¤UIçŠ¶æ€</span>
  <span class="hljs-title function_">resetPlayerState</span>();
});
</code></pre>
<h2 data-id="heading-31">ä¸ƒã€äº‹ä»¶è°ƒè¯•æŠ€å·§</h2>
<h3 data-id="heading-32">1. äº‹ä»¶æ—¥å¿—è®°å½•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®°å½•æ‰€æœ‰äº‹ä»¶çš„å®ç”¨å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">logAllEvents</span>(<span class="hljs-params">wavesurfer</span>) {
  <span class="hljs-keyword">const</span> events = [
    <span class="hljs-string">'ready'</span>, <span class="hljs-string">'load'</span>, <span class="hljs-string">'loading'</span>, <span class="hljs-string">'play'</span>, <span class="hljs-string">'pause'</span>, <span class="hljs-string">'finish'</span>,
    <span class="hljs-string">'seek'</span>, <span class="hljs-string">'audioprocess'</span>, <span class="hljs-string">'error'</span>, <span class="hljs-string">'volume'</span>, <span class="hljs-string">'mute'</span>, <span class="hljs-string">'rate'</span>,
    <span class="hljs-string">'click'</span>, <span class="hljs-string">'dblclick'</span>, <span class="hljs-string">'dragstart'</span>, <span class="hljs-string">'dragmove'</span>, <span class="hljs-string">'dragend'</span>
  ];
  
  events.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventName</span> =&gt;</span> {
    wavesurfer.<span class="hljs-title function_">on</span>(eventName, <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[WaveSurfer Event] <span class="hljs-subst">${eventName}</span>:`</span>, args);
    });
  });
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">logAllEvents</span>(wavesurfer);
</code></pre>
<h3 data-id="heading-33">2. äº‹ä»¶æ€§èƒ½ç›‘æ§</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç›‘æ§äº‹ä»¶è§¦å‘é¢‘ç‡</span>
<span class="hljs-keyword">const</span> eventStats = {};
wavesurfer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioprocess'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> key = <span class="hljs-string">'audioprocess'</span>;
  
  <span class="hljs-keyword">if</span> (!eventStats[key]) {
    eventStats[key] = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">lastTime</span>: now };
  }
  
  eventStats[key].<span class="hljs-property">count</span>++;
  
  <span class="hljs-comment">// æ¯ç§’ç»Ÿè®¡ä¸€æ¬¡</span>
  <span class="hljs-keyword">if</span> (now - eventStats[key].<span class="hljs-property">lastTime</span> &gt;= <span class="hljs-number">1000</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`äº‹ä»¶ <span class="hljs-subst">${key}</span> è§¦å‘é¢‘ç‡: <span class="hljs-subst">${eventStats[key].count}</span>/ç§’`</span>);
    eventStats[key] = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">lastTime</span>: now };
  }
});
</code></pre>
<p>è¿™æ˜¯å®Œæ•´çš„äº‹ä»¶æ–‡æ¡£æ¶µç›–äº† WaveSurfer.js çš„æ‰€æœ‰äº‹ä»¶ç±»å‹ï¼ŒåŒ…æ‹¬æ ¸å¿ƒäº‹ä»¶å’Œæ’ä»¶äº‹ä»¶ï¼Œæä¾›äº†è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ WaveSurfer çš„äº‹ä»¶ç³»ç»Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿè®¾è®¡ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7579551362154053641</link>    <guid>https://juejin.cn/post/7579551362154053641</guid>    <pubDate>2025-12-04T01:54:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579551362154053641" data-draft-id="7579551362154037257" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿè®¾è®¡ä¸å®ç°"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-04T01:54:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿè®¾è®¡ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:54:03.000Z" title="Thu Dec 04 2025 01:54:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»25åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿè®¾è®¡ä¸å®ç°</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿæ˜¯ä¼ä¸šä¿¡æ¯åŒ–å»ºè®¾çš„æ ¸å¿ƒç³»ç»Ÿä¹‹ä¸€ï¼Œæ‰¿æ‹…ç€è®°å½•ã€åˆ†ç±»ã€æ±‡æ€»ä¼ä¸šç»æµä¸šåŠ¡çš„é‡è¦èŒè´£ã€‚ä¸€ä¸ªå®Œå–„çš„è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿéœ€è¦æ»¡è¶³ä¼šè®¡å‡†åˆ™è¦æ±‚ï¼Œæ”¯æŒå¤šç»´åº¦æ ¸ç®—ï¼Œä¿è¯æ•°æ®å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚æœ¬æ–‡å°†ä»ç³»ç»Ÿæ¶æ„ã€æ ¸å¿ƒæ¨¡å—ã€ä»£ç å®ç°ç­‰æ–¹é¢ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼ä¸šçº§è´¢åŠ¡æ ¸ç®—ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-2">ä¸€ã€è´¢åŠ¡æ ¸ç®—åŸºç¡€æ¦‚å¿µ</h3>
<h4 data-id="heading-3">1.1 ä¼šè®¡æ’ç­‰å¼</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------------------------------------------------------+</span>
|                        ä¼šè®¡æ’ç­‰å¼                                 |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|              èµ„äº§ = è´Ÿå€º + æ‰€æœ‰è€…æƒç›Š                              |
|                                                                   |
|              Assets = Liabilities + Owner's Equity                |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|    å€Ÿæ–¹ï¼ˆDebitï¼‰              |        è´·æ–¹ï¼ˆCreditï¼‰              |
|    èµ„äº§å¢åŠ                    |        èµ„äº§å‡å°‘                   |
|    è´Ÿå€ºå‡å°‘                   |        è´Ÿå€ºå¢åŠ                    |
|    è´¹ç”¨å¢åŠ                    |        æ”¶å…¥å¢åŠ                    |
|    æ‰€æœ‰è€…æƒç›Šå‡å°‘             |        æ‰€æœ‰è€…æƒç›Šå¢åŠ               |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-4">1.2 æ ¸ç®—ä½“ç³»ç»“æ„</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+     +------------------+     +------------------+</span>
|    ç§‘ç›®ä½“ç³»      |     |    è¾…åŠ©æ ¸ç®—      |     |    æœŸé—´ç®¡ç†      |
+<span class="hljs-comment">------------------+     +------------------+     +------------------+</span>
| ä¸€çº§ç§‘ç›®         |     | éƒ¨é—¨æ ¸ç®—         |     | ä¼šè®¡å¹´åº¦         |
| äºŒçº§ç§‘ç›®         |     | é¡¹ç›®æ ¸ç®—         |     | ä¼šè®¡æœŸé—´         |
| ä¸‰çº§ç§‘ç›®         |     | å¾€æ¥æ ¸ç®—         |     | æœŸé—´çŠ¶æ€         |
| æœ«çº§ç§‘ç›®         |     | ç°é‡‘æµæ ¸ç®—       |     | ç»“è´¦/åç»“è´¦      |
+<span class="hljs-comment">------------------+     +------------------+     +------------------+</span>
         |                       |                       |
         +<span class="hljs-comment">-------------------+---+-------------------+---+</span>
                             |
                    +<span class="hljs-comment">--------v--------+</span>
                    |    å‡­è¯ç®¡ç†      |
                    +<span class="hljs-comment">-----------------+</span>
                    | å‡­è¯å½•å…¥         |
                    | å‡­è¯å®¡æ ¸         |
                    | å‡­è¯è¿‡è´¦         |
                    | å‡­è¯å†²é”€         |
                    +<span class="hljs-comment">-----------------+</span>
                             |
                    +<span class="hljs-comment">--------v--------+</span>
                    |    è´¦ç°¿ç®¡ç†      |
                    +<span class="hljs-comment">-----------------+</span>
                    | æ€»è´¦             |
                    | æ˜ç»†è´¦           |
                    | å¤šæ è´¦           |
                    | åºæ—¶è´¦           |
                    +<span class="hljs-comment">-----------------+</span>
                             |
                    +<span class="hljs-comment">--------v--------+</span>
                    |    æŠ¥è¡¨ç®¡ç†      |
                    +<span class="hljs-comment">-----------------+</span>
                    | èµ„äº§è´Ÿå€ºè¡¨       |
                    | åˆ©æ¶¦è¡¨           |
                    | ç°é‡‘æµé‡è¡¨       |
                    +<span class="hljs-comment">-----------------+</span>
</code></pre>
<h4 data-id="heading-5">1.3 æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡</h4>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th><th>è¦æ±‚</th></tr></thead><tbody><tr><td>å€Ÿè´·å¹³è¡¡</td><td>æ¯ç¬”å‡­è¯å€Ÿè´·å¿…é¡»ç›¸ç­‰</td><td>100%å‡†ç¡®</td></tr><tr><td>ç§‘ç›®ä½™é¢</td><td>æœŸåˆ+æœ¬æœŸå‘ç”Ÿ=æœŸæœ«</td><td>100%å‡†ç¡®</td></tr><tr><td>æœŸé—´å®Œæ•´</td><td>æœŸé—´è¿ç»­ä¸æ–­</td><td>100%å®Œæ•´</td></tr><tr><td>å®¡è®¡è¿½è¸ª</td><td>æ‰€æœ‰æ“ä½œå¯è¿½æº¯</td><td>å®Œæ•´æ—¥å¿—</td></tr></tbody></table>
<h3 data-id="heading-6">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-7">2.1 æ•´ä½“æ¶æ„</h4>
<pre><code class="hljs language-lua" lang="lua">                              +<span class="hljs-comment">------------------+</span>
                              |     å‰ç«¯åº”ç”¨      |
                              |  Vue/React/H5   |
                              +<span class="hljs-comment">---------+--------+</span>
                                        |
                              +<span class="hljs-comment">---------v--------+</span>
                              |   API Gateway    |
                              |   è®¤è¯/é™æµ/è·¯ç”±  |
                              +<span class="hljs-comment">---------+--------+</span>
                                        |
         +<span class="hljs-comment">------------------------------+------------------------------+</span>
         |                              |                              |
+<span class="hljs-comment">--------v--------+           +---------v--------+           +---------v--------+</span>
|   æ ¸ç®—æœåŠ¡       |           |    æŠ¥è¡¨æœåŠ¡      |           |    åŸºç¡€æœåŠ¡      |
| Accounting-Svc  |           |  Report-Service  |           |  Base-Service   |
+<span class="hljs-comment">--------+--------+           +---------+--------+           +---------+--------+</span>
         |                              |                              |
         +<span class="hljs-comment">------------------------------+------------------------------+</span>
                                        |
         +<span class="hljs-comment">------------------------------+------------------------------+</span>
         |                              |                              |
+<span class="hljs-comment">--------v--------+           +---------v--------+           +---------v--------+</span>
|   Redisç¼“å­˜     |           |    æ¶ˆæ¯é˜Ÿåˆ—      |           |    æ•°æ®åº“        |
|  ç§‘ç›®/æœŸé—´ç¼“å­˜   |           |  å¼‚æ­¥å¤„ç†/é€šçŸ¥   |           |   æ ¸ç®—æ•°æ®       |
+<span class="hljs-comment">-----------------+           +------------------+           +------------------+</span>
</code></pre>
<h4 data-id="heading-8">2.2 æ ¸ç®—æœåŠ¡æ ¸å¿ƒæ¨¡å—</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------------------+</span>
<span class="hljs-operator">|</span>                        æ ¸ç®—æœåŠ¡                                   <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------------------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> ç§‘ç›®ç®¡ç†    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> å‡­è¯ç®¡ç†    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> æœŸé—´ç®¡ç†    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> è¾…åŠ©æ ¸ç®—  <span class="hljs-operator">|</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Account     <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Voucher     <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">Period</span>      <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Auxiliary <span class="hljs-operator">|</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
<span class="hljs-operator">|</span>                                                                   <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> è´¦ç°¿æŸ¥è¯¢    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> ç»“è´¦å¤„ç†    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> æœŸæœ«ç»“è½¬    <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> å¯¹è´¦æœåŠ¡  <span class="hljs-operator">|</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Ledger      <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Closing     <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Carryover   <span class="hljs-operator">|</span>  <span class="hljs-operator">|</span> Reconcile <span class="hljs-operator">|</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-operator">+</span><span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
<span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€æ•°æ®åº“è®¾è®¡</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒè¡¨ç»“æ„</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè®¡ç§‘ç›®è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_subject` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ç§‘ç›®ID'</span>,
    `subject_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®ç¼–ç '</span>,
    `subject_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®åç§°'</span>,
    `parent_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸Šçº§ç§‘ç›®ç¼–ç '</span>,
    `subject_level` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'ç§‘ç›®çº§æ¬¡'</span>,
    `subject_type` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®ç±»å‹ï¼š1-èµ„äº§ï¼Œ2-è´Ÿå€ºï¼Œ3-æƒç›Šï¼Œ4-æˆæœ¬ï¼Œ5-æŸç›Š'</span>,
    `balance_direction` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä½™é¢æ–¹å‘ï¼š1-å€Ÿæ–¹ï¼Œ2-è´·æ–¹'</span>,
    `is_leaf` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'æ˜¯å¦æœ«çº§ï¼š0-å¦ï¼Œ1-æ˜¯'</span>,
    `is_cash_subject` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ˜¯å¦ç°é‡‘ç§‘ç›®'</span>,
    `is_bank_subject` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æ˜¯å¦é“¶è¡Œç§‘ç›®'</span>,
    `auxiliary_types` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—ç±»å‹ï¼ˆJSONæ•°ç»„ï¼‰'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-åœç”¨ï¼Œ1-å¯ç”¨'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_subject_code` (`subject_code`),
    KEY `idx_parent_code` (`parent_code`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼šè®¡ç§‘ç›®è¡¨'</span>;

<span class="hljs-comment">-- ä¼šè®¡æœŸé—´è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_period` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'æœŸé—´ID'</span>,
    `period_year` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¼šè®¡å¹´åº¦'</span>,
    `period_month` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¼šè®¡æœˆä»½'</span>,
    `period_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœŸé—´ç¼–ç ï¼ˆå¦‚ï¼š202401ï¼‰'</span>,
    `start_date` <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¼€å§‹æ—¥æœŸ'</span>,
    `end_date` <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç»“æŸæ—¥æœŸ'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š0-æœªå¯ç”¨ï¼Œ1-å·²å¯ç”¨ï¼Œ2-å·²ç»“è´¦'</span>,
    `close_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç»“è´¦æ—¶é—´'</span>,
    `close_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç»“è´¦äºº'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_period_code` (`period_code`),
    KEY `idx_year_month` (`period_year`, `period_month`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼šè®¡æœŸé—´è¡¨'</span>;

<span class="hljs-comment">-- ä¼šè®¡å‡­è¯è¡¨ï¼ˆå‡­è¯å¤´ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_voucher` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'å‡­è¯ID'</span>,
    `voucher_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‡­è¯å·'</span>,
    `voucher_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'è®°'</span> COMMENT <span class="hljs-string">'å‡­è¯å­—ï¼ˆè®°/æ”¶/ä»˜/è½¬ï¼‰'</span>,
    `voucher_date` <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‡­è¯æ—¥æœŸ'</span>,
    `period_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ‰€å±æœŸé—´'</span>,
    `attachment_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'é™„ä»¶æ•°'</span>,
    `total_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å€Ÿæ–¹åˆè®¡'</span>,
    `total_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è´·æ–¹åˆè®¡'</span>,
    `summary` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‡­è¯æ‘˜è¦'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š1-æœªå®¡æ ¸ï¼Œ2-å·²å®¡æ ¸ï¼Œ3-å·²è¿‡è´¦ï¼Œ4-å·²ä½œåºŸ'</span>,
    `source_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¥æºç±»å‹ï¼ˆæ‰‹å·¥/å¯¼å…¥/è‡ªåŠ¨ç”Ÿæˆï¼‰'</span>,
    `source_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¥æºå•æ®å·'</span>,
    `create_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¶å•äºº'</span>,
    `audit_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å®¡æ ¸äºº'</span>,
    `audit_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å®¡æ ¸æ—¶é—´'</span>,
    `post_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¿‡è´¦äºº'</span>,
    `post_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¿‡è´¦æ—¶é—´'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_voucher_no` (`voucher_no`),
    KEY `idx_period_code` (`period_code`),
    KEY `idx_voucher_date` (`voucher_date`),
    KEY `idx_status` (`status`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼šè®¡å‡­è¯è¡¨'</span>;

<span class="hljs-comment">-- å‡­è¯åˆ†å½•è¡¨ï¼ˆå‡­è¯æ˜ç»†è¡Œï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_voucher_entry` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'åˆ†å½•ID'</span>,
    `voucher_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‡­è¯ID'</span>,
    `voucher_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‡­è¯å·'</span>,
    `line_no` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¡Œå·'</span>,
    `subject_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®ç¼–ç '</span>,
    `subject_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®åç§°'</span>,
    `summary` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ‘˜è¦'</span>,
    `debit_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å€Ÿæ–¹é‡‘é¢'</span>,
    `credit_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'è´·æ–¹é‡‘é¢'</span>,
    `currency_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'CNY'</span> COMMENT <span class="hljs-string">'å¸ç§'</span>,
    `exchange_rate` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">6</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'æ±‡ç‡'</span>,
    `original_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åŸå¸é‡‘é¢'</span>,
    `auxiliary_data` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—æ•°æ®ï¼ˆJSONï¼‰'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    KEY `idx_voucher_id` (`voucher_id`),
    KEY `idx_subject_code` (`subject_code`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'å‡­è¯åˆ†å½•è¡¨'</span>;

<span class="hljs-comment">-- ç§‘ç›®ä½™é¢è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_subject_balance` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ID'</span>,
    `period_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœŸé—´ç¼–ç '</span>,
    `subject_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®ç¼–ç '</span>,
    `begin_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸåˆå€Ÿæ–¹'</span>,
    `begin_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸåˆè´·æ–¹'</span>,
    `period_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬æœŸå€Ÿæ–¹'</span>,
    `period_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬æœŸè´·æ–¹'</span>,
    `year_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬å¹´ç´¯è®¡å€Ÿæ–¹'</span>,
    `year_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬å¹´ç´¯è®¡è´·æ–¹'</span>,
    `end_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸæœ«å€Ÿæ–¹'</span>,
    `end_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸæœ«è´·æ–¹'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_period_subject` (`period_code`, `subject_code`),
    KEY `idx_subject_code` (`subject_code`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç§‘ç›®ä½™é¢è¡¨'</span>;

<span class="hljs-comment">-- è¾…åŠ©æ ¸ç®—æ˜ç»†è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_auxiliary_balance` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ID'</span>,
    `period_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœŸé—´ç¼–ç '</span>,
    `subject_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç§‘ç›®ç¼–ç '</span>,
    `auxiliary_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—ç±»å‹'</span>,
    `auxiliary_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—ID'</span>,
    `auxiliary_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—ç¼–ç '</span>,
    `auxiliary_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¾…åŠ©æ ¸ç®—åç§°'</span>,
    `begin_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸåˆå€Ÿæ–¹'</span>,
    `begin_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸåˆè´·æ–¹'</span>,
    `period_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬æœŸå€Ÿæ–¹'</span>,
    `period_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœ¬æœŸè´·æ–¹'</span>,
    `end_debit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸæœ«å€Ÿæ–¹'</span>,
    `end_credit` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'æœŸæœ«è´·æ–¹'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_balance` (`period_code`, `subject_code`, `auxiliary_type`, `auxiliary_id`),
    KEY `idx_auxiliary` (`auxiliary_type`, `auxiliary_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'è¾…åŠ©æ ¸ç®—ä½™é¢è¡¨'</span>;

<span class="hljs-comment">-- æ“ä½œæ—¥å¿—è¡¨ï¼ˆå®¡è®¡è¿½è¸ªï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `acc_operation_log` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `operation_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œç±»å‹'</span>,
    `business_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸šåŠ¡ç±»å‹ï¼ˆå‡­è¯/ç§‘ç›®/æœŸé—´ç­‰ï¼‰'</span>,
    `business_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸šåŠ¡ID'</span>,
    `business_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸šåŠ¡å•å·'</span>,
    `operation_content` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œå†…å®¹'</span>,
    `before_data` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œå‰æ•°æ®'</span>,
    `after_data` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œåæ•°æ®'</span>,
    `operator` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œäºº'</span>,
    `operate_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ“ä½œæ—¶é—´'</span>,
    `ip_address` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'IPåœ°å€'</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    KEY `idx_business` (`business_type`, `business_id`),
    KEY `idx_operate_time` (`operate_time`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'æ“ä½œæ—¥å¿—è¡¨'</span>;
</code></pre>
<h4 data-id="heading-11">3.2 ERå…³ç³»å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+       +------------------+       +------------------+</span>
|   acc_subject    |       |   acc_voucher    |       | acc_voucher_entry|
+<span class="hljs-comment">------------------+       +------------------+       +------------------+</span>
| subject_code(PK) |&lt;<span class="hljs-comment">------| subject_code(FK) |       | id (PK)          |</span>
| subject_name     |       | id (PK)          |&lt;<span class="hljs-comment">------| voucher_id (FK)  |</span>
| parent_code      |       | voucher_no (UK)  |       | subject_code     |
| subject_type     |       | period_code      |       | debit_amount     |
| balance_direction|       | total_debit      |       | credit_amount    |
+<span class="hljs-comment">------------------+       | total_credit     |       | auxiliary_data   |</span>
                           | <span class="hljs-built_in">status</span>           |       +<span class="hljs-comment">------------------+</span>
                           +<span class="hljs-comment">------------------+</span>
                                   |
                           +<span class="hljs-comment">-------v--------+</span>
                           |  acc_period    |
                           +<span class="hljs-comment">----------------+</span>
                           | period_code(PK)|
                           | period_year    |
                           | period_month   |
                           | <span class="hljs-built_in">status</span>         |
                           +<span class="hljs-comment">----------------+</span>

+<span class="hljs-comment">------------------+       +------------------------+</span>
|acc_subject_balance|      | acc_auxiliary_balance  |
+<span class="hljs-comment">------------------+       +------------------------+</span>
| period_code      |       | period_code            |
| subject_code     |       | subject_code           |
| begin_debit      |       | auxiliary_type         |
| period_debit     |       | auxiliary_id           |
| end_debit        |       | begin_debit            |
+<span class="hljs-comment">------------------+       | period_debit           |</span>
                           +<span class="hljs-comment">------------------------+</span>
</code></pre>
<h3 data-id="heading-12">å››ã€æ ¸å¿ƒå®ä½“ç±»</h3>
<h4 data-id="heading-13">4.1 ç§‘ç›®å®ä½“</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼šè®¡ç§‘ç›®å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("acc_subject")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccSubject</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-comment">/**
     * ç§‘ç›®ç¼–ç 
     */</span>
    <span class="hljs-keyword">private</span> String subjectCode;

    <span class="hljs-comment">/**
     * ç§‘ç›®åç§°
     */</span>
    <span class="hljs-keyword">private</span> String subjectName;

    <span class="hljs-comment">/**
     * ä¸Šçº§ç§‘ç›®ç¼–ç 
     */</span>
    <span class="hljs-keyword">private</span> String parentCode;

    <span class="hljs-comment">/**
     * ç§‘ç›®çº§æ¬¡
     */</span>
    <span class="hljs-keyword">private</span> Integer subjectLevel;

    <span class="hljs-comment">/**
     * ç§‘ç›®ç±»å‹ï¼š1-èµ„äº§ï¼Œ2-è´Ÿå€ºï¼Œ3-æƒç›Šï¼Œ4-æˆæœ¬ï¼Œ5-æŸç›Š
     */</span>
    <span class="hljs-keyword">private</span> Integer subjectType;

    <span class="hljs-comment">/**
     * ä½™é¢æ–¹å‘ï¼š1-å€Ÿæ–¹ï¼Œ2-è´·æ–¹
     */</span>
    <span class="hljs-keyword">private</span> Integer balanceDirection;

    <span class="hljs-comment">/**
     * æ˜¯å¦æœ«çº§ç§‘ç›®
     */</span>
    <span class="hljs-keyword">private</span> Integer isLeaf;

    <span class="hljs-comment">/**
     * æ˜¯å¦ç°é‡‘ç§‘ç›®
     */</span>
    <span class="hljs-keyword">private</span> Integer isCashSubject;

    <span class="hljs-comment">/**
     * æ˜¯å¦é“¶è¡Œç§‘ç›®
     */</span>
    <span class="hljs-keyword">private</span> Integer isBankSubject;

    <span class="hljs-comment">/**
     * è¾…åŠ©æ ¸ç®—ç±»å‹ï¼ˆJSONæ•°ç»„ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String auxiliaryTypes;

    <span class="hljs-comment">/**
     * çŠ¶æ€ï¼š0-åœç”¨ï¼Œ1-å¯ç”¨
     */</span>
    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;

    <span class="hljs-comment">/**
     * å­ç§‘ç›®åˆ—è¡¨ï¼ˆéæ•°æ®åº“å­—æ®µï¼‰
     */</span>
    <span class="hljs-meta">@TableField(exist = false)</span>
    <span class="hljs-keyword">private</span> List&lt;AccSubject&gt; children;
}
</code></pre>
<h4 data-id="heading-14">4.2 å‡­è¯å®ä½“</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDate;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼šè®¡å‡­è¯å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("acc_voucher")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccVoucher</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-comment">/**
     * å‡­è¯å·
     */</span>
    <span class="hljs-keyword">private</span> String voucherNo;

    <span class="hljs-comment">/**
     * å‡­è¯å­—ï¼ˆè®°/æ”¶/ä»˜/è½¬ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String voucherType;

    <span class="hljs-comment">/**
     * å‡­è¯æ—¥æœŸ
     */</span>
    <span class="hljs-keyword">private</span> LocalDate voucherDate;

    <span class="hljs-comment">/**
     * æ‰€å±æœŸé—´
     */</span>
    <span class="hljs-keyword">private</span> String periodCode;

    <span class="hljs-comment">/**
     * é™„ä»¶æ•°
     */</span>
    <span class="hljs-keyword">private</span> Integer attachmentCount;

    <span class="hljs-comment">/**
     * å€Ÿæ–¹åˆè®¡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal totalDebit;

    <span class="hljs-comment">/**
     * è´·æ–¹åˆè®¡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal totalCredit;

    <span class="hljs-comment">/**
     * å‡­è¯æ‘˜è¦
     */</span>
    <span class="hljs-keyword">private</span> String summary;

    <span class="hljs-comment">/**
     * çŠ¶æ€ï¼š1-æœªå®¡æ ¸ï¼Œ2-å·²å®¡æ ¸ï¼Œ3-å·²è¿‡è´¦ï¼Œ4-å·²ä½œåºŸ
     */</span>
    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-comment">/**
     * æ¥æºç±»å‹
     */</span>
    <span class="hljs-keyword">private</span> String sourceType;

    <span class="hljs-comment">/**
     * æ¥æºå•æ®å·
     */</span>
    <span class="hljs-keyword">private</span> String sourceNo;

    <span class="hljs-keyword">private</span> String createUser;

    <span class="hljs-keyword">private</span> String auditUser;

    <span class="hljs-keyword">private</span> LocalDateTime auditTime;

    <span class="hljs-keyword">private</span> String postUser;

    <span class="hljs-keyword">private</span> LocalDateTime postTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;

    <span class="hljs-comment">/**
     * å‡­è¯åˆ†å½•åˆ—è¡¨ï¼ˆéæ•°æ®åº“å­—æ®µï¼‰
     */</span>
    <span class="hljs-meta">@TableField(exist = false)</span>
    <span class="hljs-keyword">private</span> List&lt;AccVoucherEntry&gt; entries;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * å‡­è¯åˆ†å½•å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("acc_voucher_entry")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccVoucherEntry</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> Long voucherId;

    <span class="hljs-keyword">private</span> String voucherNo;

    <span class="hljs-comment">/**
     * è¡Œå·
     */</span>
    <span class="hljs-keyword">private</span> Integer lineNo;

    <span class="hljs-keyword">private</span> String subjectCode;

    <span class="hljs-keyword">private</span> String subjectName;

    <span class="hljs-comment">/**
     * æ‘˜è¦
     */</span>
    <span class="hljs-keyword">private</span> String summary;

    <span class="hljs-comment">/**
     * å€Ÿæ–¹é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal debitAmount;

    <span class="hljs-comment">/**
     * è´·æ–¹é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal creditAmount;

    <span class="hljs-comment">/**
     * å¸ç§
     */</span>
    <span class="hljs-keyword">private</span> String currencyCode;

    <span class="hljs-comment">/**
     * æ±‡ç‡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal exchangeRate;

    <span class="hljs-comment">/**
     * åŸå¸é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal originalAmount;

    <span class="hljs-comment">/**
     * è¾…åŠ©æ ¸ç®—æ•°æ®ï¼ˆJSONï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String auxiliaryData;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
}
</code></pre>
<h4 data-id="heading-15">4.3 æšä¸¾å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * ç§‘ç›®ç±»å‹æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SubjectTypeEnum</span> {

    ASSET(<span class="hljs-number">1</span>, <span class="hljs-string">"èµ„äº§"</span>),
    LIABILITY(<span class="hljs-number">2</span>, <span class="hljs-string">"è´Ÿå€º"</span>),
    EQUITY(<span class="hljs-number">3</span>, <span class="hljs-string">"æ‰€æœ‰è€…æƒç›Š"</span>),
    COST(<span class="hljs-number">4</span>, <span class="hljs-string">"æˆæœ¬"</span>),
    PROFIT_LOSS(<span class="hljs-number">5</span>, <span class="hljs-string">"æŸç›Š"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    SubjectTypeEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SubjectTypeEnum <span class="hljs-title function_">of</span><span class="hljs-params">(Integer code)</span> {
        <span class="hljs-keyword">for</span> (SubjectTypeEnum value : values()) {
            <span class="hljs-keyword">if</span> (value.getCode().equals(code)) {
                <span class="hljs-keyword">return</span> value;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * å‡­è¯çŠ¶æ€æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">VoucherStatusEnum</span> {

    DRAFT(<span class="hljs-number">1</span>, <span class="hljs-string">"æœªå®¡æ ¸"</span>),
    AUDITED(<span class="hljs-number">2</span>, <span class="hljs-string">"å·²å®¡æ ¸"</span>),
    POSTED(<span class="hljs-number">3</span>, <span class="hljs-string">"å·²è¿‡è´¦"</span>),
    VOID(<span class="hljs-number">4</span>, <span class="hljs-string">"å·²ä½œåºŸ"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    VoucherStatusEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * ä½™é¢æ–¹å‘æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BalanceDirectionEnum</span> {

    DEBIT(<span class="hljs-number">1</span>, <span class="hljs-string">"å€Ÿæ–¹"</span>),
    CREDIT(<span class="hljs-number">2</span>, <span class="hljs-string">"è´·æ–¹"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    BalanceDirectionEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }
}
</code></pre>
<h4 data-id="heading-16">4.4 DTOå®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.validation.constraints.*;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDate;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * åˆ›å»ºå‡­è¯è¯·æ±‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateVoucherRequest</span> {

    <span class="hljs-comment">/**
     * å‡­è¯å­—
     */</span>
    <span class="hljs-meta">@NotBlank(message = "å‡­è¯å­—ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String voucherType;

    <span class="hljs-comment">/**
     * å‡­è¯æ—¥æœŸ
     */</span>
    <span class="hljs-meta">@NotNull(message = "å‡­è¯æ—¥æœŸä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> LocalDate voucherDate;

    <span class="hljs-comment">/**
     * é™„ä»¶æ•°
     */</span>
    <span class="hljs-keyword">private</span> Integer attachmentCount;

    <span class="hljs-comment">/**
     * å‡­è¯æ‘˜è¦
     */</span>
    <span class="hljs-keyword">private</span> String summary;

    <span class="hljs-comment">/**
     * æ¥æºç±»å‹
     */</span>
    <span class="hljs-keyword">private</span> String sourceType;

    <span class="hljs-comment">/**
     * æ¥æºå•æ®å·
     */</span>
    <span class="hljs-keyword">private</span> String sourceNo;

    <span class="hljs-comment">/**
     * å‡­è¯åˆ†å½•
     */</span>
    <span class="hljs-meta">@NotEmpty(message = "å‡­è¯åˆ†å½•ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-meta">@Size(min = 2, message = "å‡­è¯åˆ†å½•è‡³å°‘2è¡Œ")</span>
    <span class="hljs-keyword">private</span> List&lt;VoucherEntryDTO&gt; entries;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.validation.constraints.*;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-comment">/**
 * å‡­è¯åˆ†å½•DTO
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherEntryDTO</span> {

    <span class="hljs-comment">/**
     * ç§‘ç›®ç¼–ç 
     */</span>
    <span class="hljs-meta">@NotBlank(message = "ç§‘ç›®ç¼–ç ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String subjectCode;

    <span class="hljs-comment">/**
     * æ‘˜è¦
     */</span>
    <span class="hljs-meta">@NotBlank(message = "æ‘˜è¦ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String summary;

    <span class="hljs-comment">/**
     * å€Ÿæ–¹é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal debitAmount;

    <span class="hljs-comment">/**
     * è´·æ–¹é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal creditAmount;

    <span class="hljs-comment">/**
     * å¸ç§
     */</span>
    <span class="hljs-keyword">private</span> String currencyCode;

    <span class="hljs-comment">/**
     * æ±‡ç‡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal exchangeRate;

    <span class="hljs-comment">/**
     * åŸå¸é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal originalAmount;

    <span class="hljs-comment">/**
     * è¾…åŠ©æ ¸ç®—æ•°æ®
     */</span>
    <span class="hljs-keyword">private</span> AuxiliaryDataDTO auxiliaryData;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * è¾…åŠ©æ ¸ç®—æ•°æ®DTO
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuxiliaryDataDTO</span> {

    <span class="hljs-comment">/**
     * éƒ¨é—¨
     */</span>
    <span class="hljs-keyword">private</span> Long departmentId;
    <span class="hljs-keyword">private</span> String departmentName;

    <span class="hljs-comment">/**
     * é¡¹ç›®
     */</span>
    <span class="hljs-keyword">private</span> Long projectId;
    <span class="hljs-keyword">private</span> String projectName;

    <span class="hljs-comment">/**
     * å¾€æ¥å•ä½
     */</span>
    <span class="hljs-keyword">private</span> Long partnerId;
    <span class="hljs-keyword">private</span> String partnerName;

    <span class="hljs-comment">/**
     * å‘˜å·¥
     */</span>
    <span class="hljs-keyword">private</span> Long employeeId;
    <span class="hljs-keyword">private</span> String employeeName;

    <span class="hljs-comment">/**
     * ç°é‡‘æµé¡¹ç›®
     */</span>
    <span class="hljs-keyword">private</span> Long cashFlowItemId;
    <span class="hljs-keyword">private</span> String cashFlowItemName;

    <span class="hljs-comment">/**
     * æ‰©å±•å­—æ®µ
     */</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; extFields;
}
</code></pre>
<h3 data-id="heading-17">äº”ã€ç§‘ç›®ç®¡ç†æœåŠ¡</h3>
<h4 data-id="heading-18">5.1 ç§‘ç›®æ ‘ç»“æ„</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">1001</span> <span class="hljs-string">åº“å­˜ç°é‡‘</span>
<span class="hljs-number">1002</span> <span class="hljs-string">é“¶è¡Œå­˜æ¬¾</span>
  <span class="hljs-number">1002.01</span> <span class="hljs-string">å·¥å•†é“¶è¡Œ</span>
  <span class="hljs-number">1002.02</span> <span class="hljs-string">å»ºè®¾é“¶è¡Œ</span>
<span class="hljs-number">1122</span> <span class="hljs-string">åº”æ”¶è´¦æ¬¾</span>
  <span class="hljs-number">1122.01</span> <span class="hljs-string">å®¢æˆ·A</span>
  <span class="hljs-number">1122.02</span> <span class="hljs-string">å®¢æˆ·B</span>
<span class="hljs-number">1403</span> <span class="hljs-string">åŸææ–™</span>
  <span class="hljs-number">1403.01</span> <span class="hljs-string">ä¸»è¦ææ–™</span>
    <span class="hljs-number">1403.01</span><span class="hljs-number">.01</span> <span class="hljs-string">é’¢æ</span>
    <span class="hljs-number">1403.01</span><span class="hljs-number">.02</span> <span class="hljs-string">é“æ</span>
  <span class="hljs-number">1403.02</span> <span class="hljs-string">è¾…åŠ©ææ–™</span>
<span class="hljs-number">1601</span> <span class="hljs-string">å›ºå®šèµ„äº§</span>
  <span class="hljs-number">1601.01</span> <span class="hljs-string">æˆ¿å±‹å»ºç­‘ç‰©</span>
  <span class="hljs-number">1601.02</span> <span class="hljs-string">æœºå™¨è®¾å¤‡</span>
</code></pre>
<h4 data-id="heading-19">5.2 ç§‘ç›®ç®¡ç†æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.accounting.common.exception.AccountingException;
<span class="hljs-keyword">import</span> com.accounting.common.result.ResultCode;
<span class="hljs-keyword">import</span> com.accounting.service.dto.CreateSubjectRequest;
<span class="hljs-keyword">import</span> com.accounting.service.entity.AccSubject;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.AccSubjectMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.cache.annotation.CacheEvict;
<span class="hljs-keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * ç§‘ç›®ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubjectService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccSubjectMapper subjectMapper;

    <span class="hljs-comment">/**
     * è·å–ç§‘ç›®æ ‘
     */</span>
    <span class="hljs-meta">@Cacheable(value = "subject", key = "'tree'")</span>
    <span class="hljs-keyword">public</span> List&lt;AccSubject&gt; <span class="hljs-title function_">getSubjectTree</span><span class="hljs-params">()</span> {
        List&lt;AccSubject&gt; allSubjects = subjectMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubject&gt;()
                .eq(AccSubject::getStatus, <span class="hljs-number">1</span>)
                .orderByAsc(AccSubject::getSubjectCode)
        );

        <span class="hljs-keyword">return</span> buildTree(allSubjects);
    }

    <span class="hljs-comment">/**
     * æ„å»ºç§‘ç›®æ ‘
     */</span>
    <span class="hljs-keyword">private</span> List&lt;AccSubject&gt; <span class="hljs-title function_">buildTree</span><span class="hljs-params">(List&lt;AccSubject&gt; subjects)</span> {
        Map&lt;String, List&lt;AccSubject&gt;&gt; parentMap = subjects.stream()
            .filter(s -&gt; s.getParentCode() != <span class="hljs-literal">null</span>)
            .collect(Collectors.groupingBy(AccSubject::getParentCode));

        List&lt;AccSubject&gt; roots = subjects.stream()
            .filter(s -&gt; s.getParentCode() == <span class="hljs-literal">null</span> || s.getParentCode().isEmpty())
            .collect(Collectors.toList());

        <span class="hljs-keyword">for</span> (AccSubject root : roots) {
            buildChildren(root, parentMap);
        }

        <span class="hljs-keyword">return</span> roots;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildChildren</span><span class="hljs-params">(AccSubject parent, Map&lt;String, List&lt;AccSubject&gt;&gt; parentMap)</span> {
        List&lt;AccSubject&gt; children = parentMap.get(parent.getSubjectCode());
        <span class="hljs-keyword">if</span> (children != <span class="hljs-literal">null</span> &amp;&amp; !children.isEmpty()) {
            parent.setChildren(children);
            <span class="hljs-keyword">for</span> (AccSubject child : children) {
                buildChildren(child, parentMap);
            }
        }
    }

    <span class="hljs-comment">/**
     * æ ¹æ®ç¼–ç è·å–ç§‘ç›®
     */</span>
    <span class="hljs-meta">@Cacheable(value = "subject", key = "#subjectCode")</span>
    <span class="hljs-keyword">public</span> AccSubject <span class="hljs-title function_">getByCode</span><span class="hljs-params">(String subjectCode)</span> {
        <span class="hljs-keyword">return</span> subjectMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubject&gt;()
                .eq(AccSubject::getSubjectCode, subjectCode)
        );
    }

    <span class="hljs-comment">/**
     * è·å–æœ«çº§ç§‘ç›®åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;AccSubject&gt; <span class="hljs-title function_">getLeafSubjects</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> subjectMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubject&gt;()
                .eq(AccSubject::getIsLeaf, <span class="hljs-number">1</span>)
                .eq(AccSubject::getStatus, <span class="hljs-number">1</span>)
                .orderByAsc(AccSubject::getSubjectCode)
        );
    }

    <span class="hljs-comment">/**
     * åˆ›å»ºç§‘ç›®
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-meta">@CacheEvict(value = "subject", allEntries = true)</span>
    <span class="hljs-keyword">public</span> AccSubject <span class="hljs-title function_">createSubject</span><span class="hljs-params">(CreateSubjectRequest request)</span> {
        <span class="hljs-comment">// 1. æ ¡éªŒç§‘ç›®ç¼–ç å”¯ä¸€æ€§</span>
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">existSubject</span> <span class="hljs-operator">=</span> getByCode(request.getSubjectCode());
        <span class="hljs-keyword">if</span> (existSubject != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.SUBJECT_CODE_EXISTS);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒä¸Šçº§ç§‘ç›®</span>
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (request.getParentCode() != <span class="hljs-literal">null</span> &amp;&amp; !request.getParentCode().isEmpty()) {
            parent = getByCode(request.getParentCode());
            <span class="hljs-keyword">if</span> (parent == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PARENT_SUBJECT_NOT_EXIST);
            }
            <span class="hljs-comment">// ä¸Šçº§ç§‘ç›®å¿…é¡»æ˜¯éæœ«çº§</span>
            <span class="hljs-keyword">if</span> (parent.getIsLeaf() == <span class="hljs-number">1</span>) {
                <span class="hljs-comment">// æ£€æŸ¥ä¸Šçº§ç§‘ç›®æ˜¯å¦å·²æœ‰å‘ç”Ÿé¢ï¼Œæœ‰åˆ™ä¸èƒ½æ·»åŠ ä¸‹çº§</span>
                <span class="hljs-keyword">if</span> (hasBalance(parent.getSubjectCode())) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PARENT_HAS_BALANCE);
                }
                <span class="hljs-comment">// æ›´æ–°ä¸Šçº§ä¸ºéæœ«çº§</span>
                parent.setIsLeaf(<span class="hljs-number">0</span>);
                subjectMapper.updateById(parent);
            }
        }

        <span class="hljs-comment">// 3. åˆ›å»ºç§‘ç›®</span>
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccSubject</span>();
        subject.setSubjectCode(request.getSubjectCode());
        subject.setSubjectName(request.getSubjectName());
        subject.setParentCode(request.getParentCode());
        subject.setSubjectLevel(parent != <span class="hljs-literal">null</span> ? parent.getSubjectLevel() + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>);
        subject.setSubjectType(parent != <span class="hljs-literal">null</span> ? parent.getSubjectType() : request.getSubjectType());
        subject.setBalanceDirection(parent != <span class="hljs-literal">null</span> ? parent.getBalanceDirection() : request.getBalanceDirection());
        subject.setIsLeaf(<span class="hljs-number">1</span>);
        subject.setIsCashSubject(request.getIsCashSubject() != <span class="hljs-literal">null</span> ? request.getIsCashSubject() : <span class="hljs-number">0</span>);
        subject.setIsBankSubject(request.getIsBankSubject() != <span class="hljs-literal">null</span> ? request.getIsBankSubject() : <span class="hljs-number">0</span>);
        subject.setAuxiliaryTypes(request.getAuxiliaryTypes());
        subject.setStatus(<span class="hljs-number">1</span>);

        subjectMapper.insert(subject);

        log.info(<span class="hljs-string">"åˆ›å»ºç§‘ç›®æˆåŠŸ: code={}, name={}"</span>, subject.getSubjectCode(), subject.getSubjectName());

        <span class="hljs-keyword">return</span> subject;
    }

    <span class="hljs-comment">/**
     * æ£€æŸ¥ç§‘ç›®æ˜¯å¦æœ‰ä½™é¢
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasBalance</span><span class="hljs-params">(String subjectCode)</span> {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æŸ¥è¯¢ç§‘ç›®ä½™é¢è¡¨åˆ¤æ–­</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * æ ¡éªŒç§‘ç›®æ˜¯å¦å¯ç”¨äºè®°è´¦
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateForVoucher</span><span class="hljs-params">(String subjectCode)</span> {
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> getByCode(subjectCode);
        <span class="hljs-keyword">if</span> (subject == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.SUBJECT_NOT_EXIST);
        }
        <span class="hljs-keyword">if</span> (subject.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.SUBJECT_DISABLED);
        }
        <span class="hljs-keyword">if</span> (subject.getIsLeaf() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.SUBJECT_NOT_LEAF);
        }
    }
}
</code></pre>
<h3 data-id="heading-20">å…­ã€å‡­è¯ç®¡ç†æœåŠ¡</h3>
<h4 data-id="heading-21">6.1 å‡­è¯å¤„ç†æµç¨‹</h4>
<pre><code class="hljs language-rust" lang="rust">+----------+     +----------+     +----------+     +----------+     +----------+
|  å½•å…¥    | -<span class="hljs-punctuation">-&gt;</span> |  ä¿å­˜    | -<span class="hljs-punctuation">-&gt;</span> |  å®¡æ ¸    | -<span class="hljs-punctuation">-&gt;</span> |  è¿‡è´¦    | -<span class="hljs-punctuation">-&gt;</span> |  å®Œæˆ    |
+----------+     +----------+     +----------+     +----------+     +----------+
     |               |               |               |               |
     v               v               v               v               v
  å¡«å†™åˆ†å½•       æ ¡éªŒå€Ÿè´·å¹³è¡¡    å®¡æ ¸äººç¡®è®¤     æ›´æ–°ç§‘ç›®ä½™é¢    å‡­è¯çŠ¶æ€å®Œæˆ
  é€‰æ‹©ç§‘ç›®       ç”Ÿæˆå‡­è¯å·      æ£€æŸ¥åˆè§„æ€§     è®°å½•æ˜ç»†è´¦      ç”Ÿæˆè´¦ç°¿
  è¾…åŠ©æ ¸ç®—       ä¿å­˜æ•°æ®åº“      æ›´æ–°çŠ¶æ€       æ›´æ–°è¾…åŠ©ä½™é¢
</code></pre>
<h4 data-id="heading-22">6.2 å‡­è¯æœåŠ¡å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.accounting.common.exception.AccountingException;
<span class="hljs-keyword">import</span> com.accounting.common.result.ResultCode;
<span class="hljs-keyword">import</span> com.accounting.service.dto.*;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.enums.VoucherStatusEnum;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.*;
<span class="hljs-keyword">import</span> com.accounting.service.utils.VoucherNoGenerator;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * å‡­è¯ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccVoucherMapper voucherMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccVoucherEntryMapper entryMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccPeriodMapper periodMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SubjectService subjectService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PeriodService periodService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BalanceService balanceService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OperationLogService logService;

    <span class="hljs-comment">/**
     * åˆ›å»ºå‡­è¯
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> AccVoucher <span class="hljs-title function_">createVoucher</span><span class="hljs-params">(String operator, CreateVoucherRequest request)</span> {
        <span class="hljs-comment">// 1. æ ¡éªŒæœŸé—´çŠ¶æ€</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">periodCode</span> <span class="hljs-operator">=</span> periodService.getPeriodCode(request.getVoucherDate());
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> periodService.getByCode(periodCode);
        <span class="hljs-keyword">if</span> (period == <span class="hljs-literal">null</span> || period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒåˆ†å½•</span>
        validateEntries(request.getEntries());

        <span class="hljs-comment">// 3. è®¡ç®—å€Ÿè´·åˆè®¡</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalDebit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalCredit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-keyword">for</span> (VoucherEntryDTO entry : request.getEntries()) {
            totalDebit = totalDebit.add(
                entry.getDebitAmount() != <span class="hljs-literal">null</span> ? entry.getDebitAmount() : BigDecimal.ZERO);
            totalCredit = totalCredit.add(
                entry.getCreditAmount() != <span class="hljs-literal">null</span> ? entry.getCreditAmount() : BigDecimal.ZERO);
        }

        <span class="hljs-comment">// 4. æ ¡éªŒå€Ÿè´·å¹³è¡¡</span>
        <span class="hljs-keyword">if</span> (totalDebit.compareTo(totalCredit) != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.DEBIT_CREDIT_NOT_BALANCE);
        }

        <span class="hljs-comment">// 5. ç”Ÿæˆå‡­è¯å·</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">voucherNo</span> <span class="hljs-operator">=</span> VoucherNoGenerator.generate(request.getVoucherType(), periodCode);

        <span class="hljs-comment">// 6. åˆ›å»ºå‡­è¯</span>
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccVoucher</span>();
        voucher.setVoucherNo(voucherNo);
        voucher.setVoucherType(request.getVoucherType());
        voucher.setVoucherDate(request.getVoucherDate());
        voucher.setPeriodCode(periodCode);
        voucher.setAttachmentCount(request.getAttachmentCount() != <span class="hljs-literal">null</span> ? request.getAttachmentCount() : <span class="hljs-number">0</span>);
        voucher.setTotalDebit(totalDebit);
        voucher.setTotalCredit(totalCredit);
        voucher.setSummary(request.getSummary());
        voucher.setStatus(VoucherStatusEnum.DRAFT.getCode());
        voucher.setSourceType(request.getSourceType());
        voucher.setSourceNo(request.getSourceNo());
        voucher.setCreateUser(operator);

        voucherMapper.insert(voucher);

        <span class="hljs-comment">// 7. åˆ›å»ºåˆ†å½•</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">lineNo</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (VoucherEntryDTO entryDTO : request.getEntries()) {
            <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> subjectService.getByCode(entryDTO.getSubjectCode());

            <span class="hljs-type">AccVoucherEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccVoucherEntry</span>();
            entry.setVoucherId(voucher.getId());
            entry.setVoucherNo(voucherNo);
            entry.setLineNo(lineNo++);
            entry.setSubjectCode(entryDTO.getSubjectCode());
            entry.setSubjectName(subject.getSubjectName());
            entry.setSummary(entryDTO.getSummary());
            entry.setDebitAmount(entryDTO.getDebitAmount() != <span class="hljs-literal">null</span> ? entryDTO.getDebitAmount() : BigDecimal.ZERO);
            entry.setCreditAmount(entryDTO.getCreditAmount() != <span class="hljs-literal">null</span> ? entryDTO.getCreditAmount() : BigDecimal.ZERO);
            entry.setCurrencyCode(entryDTO.getCurrencyCode() != <span class="hljs-literal">null</span> ? entryDTO.getCurrencyCode() : <span class="hljs-string">"CNY"</span>);
            entry.setExchangeRate(entryDTO.getExchangeRate() != <span class="hljs-literal">null</span> ? entryDTO.getExchangeRate() : BigDecimal.ONE);
            entry.setOriginalAmount(entryDTO.getOriginalAmount());

            <span class="hljs-keyword">if</span> (entryDTO.getAuxiliaryData() != <span class="hljs-literal">null</span>) {
                entry.setAuxiliaryData(JSON.toJSONString(entryDTO.getAuxiliaryData()));
            }

            entryMapper.insert(entry);
        }

        <span class="hljs-comment">// 8. è®°å½•æ“ä½œæ—¥å¿—</span>
        logService.log(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"VOUCHER"</span>, voucher.getId().toString(), voucherNo,
            <span class="hljs-string">"åˆ›å»ºå‡­è¯"</span>, <span class="hljs-literal">null</span>, JSON.toJSONString(voucher), operator);

        log.info(<span class="hljs-string">"åˆ›å»ºå‡­è¯æˆåŠŸ: voucherNo={}, totalDebit={}"</span>, voucherNo, totalDebit);

        voucher.setEntries(getEntriesByVoucherId(voucher.getId()));
        <span class="hljs-keyword">return</span> voucher;
    }

    <span class="hljs-comment">/**
     * æ ¡éªŒåˆ†å½•
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateEntries</span><span class="hljs-params">(List&lt;VoucherEntryDTO&gt; entries)</span> {
        <span class="hljs-keyword">for</span> (VoucherEntryDTO entry : entries) {
            <span class="hljs-comment">// æ ¡éªŒç§‘ç›®</span>
            subjectService.validateForVoucher(entry.getSubjectCode());

            <span class="hljs-comment">// æ ¡éªŒé‡‘é¢ï¼ˆå€Ÿè´·å¿…é¡»æœ‰ä¸€ä¸ªï¼‰</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasDebit</span> <span class="hljs-operator">=</span> entry.getDebitAmount() != <span class="hljs-literal">null</span> &amp;&amp; entry.getDebitAmount().compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>;
            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasCredit</span> <span class="hljs-operator">=</span> entry.getCreditAmount() != <span class="hljs-literal">null</span> &amp;&amp; entry.getCreditAmount().compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!hasDebit &amp;&amp; !hasCredit) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.ENTRY_AMOUNT_REQUIRED);
            }

            <span class="hljs-keyword">if</span> (hasDebit &amp;&amp; hasCredit) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.ENTRY_DEBIT_CREDIT_BOTH);
            }
        }
    }

    <span class="hljs-comment">/**
     * å®¡æ ¸å‡­è¯
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">auditVoucher</span><span class="hljs-params">(String operator, Long voucherId)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherMapper.selectById(voucherId);
        <span class="hljs-keyword">if</span> (voucher == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_NOT_EXIST);
        }

        <span class="hljs-comment">// æ ¡éªŒçŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (!VoucherStatusEnum.DRAFT.getCode().equals(voucher.getStatus())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_STATUS_ERROR);
        }

        <span class="hljs-comment">// æ ¡éªŒæœŸé—´</span>
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> periodService.getByCode(voucher.getPeriodCode());
        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// åˆ¶å•äººä¸èƒ½å®¡æ ¸è‡ªå·±çš„å‡­è¯</span>
        <span class="hljs-keyword">if</span> (operator.equals(voucher.getCreateUser())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.CANNOT_AUDIT_OWN_VOUCHER);
        }

        <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        voucherMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getId, voucherId)
                .set(AccVoucher::getStatus, VoucherStatusEnum.AUDITED.getCode())
                .set(AccVoucher::getAuditUser, operator)
                .set(AccVoucher::getAuditTime, now)
        );

        logService.log(<span class="hljs-string">"AUDIT"</span>, <span class="hljs-string">"VOUCHER"</span>, voucherId.toString(), voucher.getVoucherNo(),
            <span class="hljs-string">"å®¡æ ¸å‡­è¯"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"å®¡æ ¸å‡­è¯æˆåŠŸ: voucherNo={}, auditor={}"</span>, voucher.getVoucherNo(), operator);
    }

    <span class="hljs-comment">/**
     * å¼ƒå®¡å‡­è¯
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unauditVoucher</span><span class="hljs-params">(String operator, Long voucherId)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherMapper.selectById(voucherId);
        <span class="hljs-keyword">if</span> (voucher == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_NOT_EXIST);
        }

        <span class="hljs-comment">// æ ¡éªŒçŠ¶æ€ï¼ˆåªèƒ½å¼ƒå®¡å·²å®¡æ ¸çš„å‡­è¯ï¼‰</span>
        <span class="hljs-keyword">if</span> (!VoucherStatusEnum.AUDITED.getCode().equals(voucher.getStatus())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_STATUS_ERROR);
        }

        <span class="hljs-comment">// æ ¡éªŒæœŸé—´</span>
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> periodService.getByCode(voucher.getPeriodCode());
        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
        voucherMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getId, voucherId)
                .set(AccVoucher::getStatus, VoucherStatusEnum.DRAFT.getCode())
                .set(AccVoucher::getAuditUser, <span class="hljs-literal">null</span>)
                .set(AccVoucher::getAuditTime, <span class="hljs-literal">null</span>)
        );

        logService.log(<span class="hljs-string">"UNAUDIT"</span>, <span class="hljs-string">"VOUCHER"</span>, voucherId.toString(), voucher.getVoucherNo(),
            <span class="hljs-string">"å¼ƒå®¡å‡­è¯"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"å¼ƒå®¡å‡­è¯æˆåŠŸ: voucherNo={}"</span>, voucher.getVoucherNo());
    }

    <span class="hljs-comment">/**
     * è¿‡è´¦å‡­è¯
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postVoucher</span><span class="hljs-params">(String operator, Long voucherId)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherMapper.selectById(voucherId);
        <span class="hljs-keyword">if</span> (voucher == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_NOT_EXIST);
        }

        <span class="hljs-comment">// æ ¡éªŒçŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (!VoucherStatusEnum.AUDITED.getCode().equals(voucher.getStatus())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_NOT_AUDITED);
        }

        <span class="hljs-comment">// æ ¡éªŒæœŸé—´</span>
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> periodService.getByCode(voucher.getPeriodCode());
        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// è·å–åˆ†å½•</span>
        List&lt;AccVoucherEntry&gt; entries = getEntriesByVoucherId(voucherId);

        <span class="hljs-comment">// æ›´æ–°ç§‘ç›®ä½™é¢</span>
        <span class="hljs-keyword">for</span> (AccVoucherEntry entry : entries) {
            balanceService.updateBalance(voucher.getPeriodCode(), entry);
        }

        <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        voucherMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getId, voucherId)
                .set(AccVoucher::getStatus, VoucherStatusEnum.POSTED.getCode())
                .set(AccVoucher::getPostUser, operator)
                .set(AccVoucher::getPostTime, now)
        );

        logService.log(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"VOUCHER"</span>, voucherId.toString(), voucher.getVoucherNo(),
            <span class="hljs-string">"è¿‡è´¦å‡­è¯"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"è¿‡è´¦å‡­è¯æˆåŠŸ: voucherNo={}"</span>, voucher.getVoucherNo());
    }

    <span class="hljs-comment">/**
     * ä½œåºŸå‡­è¯
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">voidVoucher</span><span class="hljs-params">(String operator, Long voucherId, String reason)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherMapper.selectById(voucherId);
        <span class="hljs-keyword">if</span> (voucher == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.VOUCHER_NOT_EXIST);
        }

        <span class="hljs-comment">// å·²è¿‡è´¦çš„å‡­è¯ä¸èƒ½ç›´æ¥ä½œåºŸ</span>
        <span class="hljs-keyword">if</span> (VoucherStatusEnum.POSTED.getCode().equals(voucher.getStatus())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.POSTED_VOUCHER_CANNOT_VOID);
        }

        <span class="hljs-comment">// æ ¡éªŒæœŸé—´</span>
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> periodService.getByCode(voucher.getPeriodCode());
        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
        voucherMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getId, voucherId)
                .set(AccVoucher::getStatus, VoucherStatusEnum.VOID.getCode())
        );

        logService.log(<span class="hljs-string">"VOID"</span>, <span class="hljs-string">"VOUCHER"</span>, voucherId.toString(), voucher.getVoucherNo(),
            <span class="hljs-string">"ä½œåºŸå‡­è¯ï¼š"</span> + reason, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"ä½œåºŸå‡­è¯æˆåŠŸ: voucherNo={}, reason={}"</span>, voucher.getVoucherNo(), reason);
    }

    <span class="hljs-comment">/**
     * è·å–å‡­è¯åˆ†å½•
     */</span>
    <span class="hljs-keyword">public</span> List&lt;AccVoucherEntry&gt; <span class="hljs-title function_">getEntriesByVoucherId</span><span class="hljs-params">(Long voucherId)</span> {
        <span class="hljs-keyword">return</span> entryMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucherEntry&gt;()
                .eq(AccVoucherEntry::getVoucherId, voucherId)
                .orderByAsc(AccVoucherEntry::getLineNo)
        );
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å‡­è¯è¯¦æƒ…
     */</span>
    <span class="hljs-keyword">public</span> AccVoucher <span class="hljs-title function_">getVoucherDetail</span><span class="hljs-params">(Long voucherId)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherMapper.selectById(voucherId);
        <span class="hljs-keyword">if</span> (voucher != <span class="hljs-literal">null</span>) {
            voucher.setEntries(getEntriesByVoucherId(voucherId));
        }
        <span class="hljs-keyword">return</span> voucher;
    }
}
</code></pre>
<h4 data-id="heading-23">6.3 å‡­è¯å·ç”Ÿæˆå™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.utils;

<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.time.LocalDate;
<span class="hljs-keyword">import</span> java.time.format.DateTimeFormatter;

<span class="hljs-comment">/**
 * å‡­è¯å·ç”Ÿæˆå™¨
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherNoGenerator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RedisTemplate&lt;String, Object&gt; redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VOUCHER_NO_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"accounting:voucher:no:"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VoucherNoGenerator</span><span class="hljs-params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> {
        VoucherNoGenerator.redisTemplate = redisTemplate;
    }

    <span class="hljs-comment">/**
     * ç”Ÿæˆå‡­è¯å·
     * æ ¼å¼ï¼šå‡­è¯å­—-æœŸé—´-åºå·ï¼Œå¦‚ï¼šè®°-202401-0001
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generate</span><span class="hljs-params">(String voucherType, String periodCode)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> VOUCHER_NO_KEY + periodCode + <span class="hljs-string">":"</span> + voucherType;

        <span class="hljs-comment">// ä½¿ç”¨Redisè‡ªå¢ç”Ÿæˆåºå·</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">seq</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);

        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s-%s-%04d"</span>, voucherType, periodCode, seq);
    }

    <span class="hljs-comment">/**
     * é‡ç½®åºå·ï¼ˆæœŸé—´å¯ç”¨æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetSequence</span><span class="hljs-params">(String periodCode, String voucherType)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> VOUCHER_NO_KEY + periodCode + <span class="hljs-string">":"</span> + voucherType;
        redisTemplate.delete(key);
    }
}
</code></pre>
<h3 data-id="heading-24">ä¸ƒã€ä½™é¢ç®¡ç†æœåŠ¡</h3>
<h4 data-id="heading-25">7.1 ä½™é¢è®¡ç®—å…¬å¼</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------------------------------------------------------+</span>
|                        ä½™é¢è®¡ç®—å…¬å¼                               |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|  å€Ÿæ–¹ä½™é¢ç§‘ç›®ï¼ˆèµ„äº§/è´¹ç”¨ï¼‰ï¼š                                       |
|  æœŸæœ«ä½™é¢ = æœŸåˆä½™é¢ + æœ¬æœŸå€Ÿæ–¹ - æœ¬æœŸè´·æ–¹                          |
|                                                                   |
|  è´·æ–¹ä½™é¢ç§‘ç›®ï¼ˆè´Ÿå€º/æƒç›Š/æ”¶å…¥ï¼‰ï¼š                                   |
|  æœŸæœ«ä½™é¢ = æœŸåˆä½™é¢ + æœ¬æœŸè´·æ–¹ - æœ¬æœŸå€Ÿæ–¹                          |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
|                                                                   |
|  æœ¬å¹´ç´¯è®¡å€Ÿæ–¹ = ä¸ŠæœŸæœ¬å¹´ç´¯è®¡å€Ÿæ–¹ + æœ¬æœŸå€Ÿæ–¹                         |
|  æœ¬å¹´ç´¯è®¡è´·æ–¹ = ä¸ŠæœŸæœ¬å¹´ç´¯è®¡è´·æ–¹ + æœ¬æœŸè´·æ–¹                         |
|                                                                   |
<span class="hljs-addition">+------------------------------------------------------------------+</span>
</code></pre>
<h4 data-id="heading-26">7.2 ä½™é¢æœåŠ¡å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.enums.BalanceDirectionEnum;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.*;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä½™é¢ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BalanceService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccSubjectBalanceMapper balanceMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccAuxiliaryBalanceMapper auxiliaryBalanceMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SubjectService subjectService;

    <span class="hljs-comment">/**
     * æ›´æ–°ç§‘ç›®ä½™é¢ï¼ˆå‡­è¯è¿‡è´¦æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateBalance</span><span class="hljs-params">(String periodCode, AccVoucherEntry entry)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">subjectCode</span> <span class="hljs-operator">=</span> entry.getSubjectCode();
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">debitAmount</span> <span class="hljs-operator">=</span> entry.getDebitAmount();
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">creditAmount</span> <span class="hljs-operator">=</span> entry.getCreditAmount();

        <span class="hljs-comment">// 1. æ›´æ–°ç§‘ç›®ä½™é¢</span>
        <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">balance</span> <span class="hljs-operator">=</span> getOrCreateBalance(periodCode, subjectCode);

        <span class="hljs-comment">// æ›´æ–°æœ¬æœŸå‘ç”Ÿé¢</span>
        balance.setPeriodDebit(balance.getPeriodDebit().add(debitAmount));
        balance.setPeriodCredit(balance.getPeriodCredit().add(creditAmount));

        <span class="hljs-comment">// æ›´æ–°æœ¬å¹´ç´¯è®¡</span>
        balance.setYearDebit(balance.getYearDebit().add(debitAmount));
        balance.setYearCredit(balance.getYearCredit().add(creditAmount));

        <span class="hljs-comment">// è®¡ç®—æœŸæœ«ä½™é¢</span>
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> subjectService.getByCode(subjectCode);
        calculateEndBalance(balance, subject.getBalanceDirection());

        balanceMapper.updateById(balance);

        <span class="hljs-comment">// 2. æ›´æ–°è¾…åŠ©æ ¸ç®—ä½™é¢</span>
        <span class="hljs-keyword">if</span> (entry.getAuxiliaryData() != <span class="hljs-literal">null</span> &amp;&amp; !entry.getAuxiliaryData().isEmpty()) {
            updateAuxiliaryBalance(periodCode, entry);
        }

        <span class="hljs-comment">// 3. çº§è”æ›´æ–°ä¸Šçº§ç§‘ç›®ä½™é¢</span>
        updateParentBalance(periodCode, subjectCode, debitAmount, creditAmount);
    }

    <span class="hljs-comment">/**
     * è·å–æˆ–åˆ›å»ºç§‘ç›®ä½™é¢
     */</span>
    <span class="hljs-keyword">private</span> AccSubjectBalance <span class="hljs-title function_">getOrCreateBalance</span><span class="hljs-params">(String periodCode, String subjectCode)</span> {
        <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">balance</span> <span class="hljs-operator">=</span> balanceMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getPeriodCode, periodCode)
                .eq(AccSubjectBalance::getSubjectCode, subjectCode)
        );

        <span class="hljs-keyword">if</span> (balance == <span class="hljs-literal">null</span>) {
            balance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccSubjectBalance</span>();
            balance.setPeriodCode(periodCode);
            balance.setSubjectCode(subjectCode);
            balance.setBeginDebit(BigDecimal.ZERO);
            balance.setBeginCredit(BigDecimal.ZERO);
            balance.setPeriodDebit(BigDecimal.ZERO);
            balance.setPeriodCredit(BigDecimal.ZERO);
            balance.setYearDebit(BigDecimal.ZERO);
            balance.setYearCredit(BigDecimal.ZERO);
            balance.setEndDebit(BigDecimal.ZERO);
            balance.setEndCredit(BigDecimal.ZERO);

            <span class="hljs-comment">// è·å–ä¸ŠæœŸæœŸæœ«ä½œä¸ºæœ¬æœŸæœŸåˆ</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">lastPeriodCode</span> <span class="hljs-operator">=</span> getLastPeriodCode(periodCode);
            <span class="hljs-keyword">if</span> (lastPeriodCode != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">lastBalance</span> <span class="hljs-operator">=</span> balanceMapper.selectOne(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                        .eq(AccSubjectBalance::getPeriodCode, lastPeriodCode)
                        .eq(AccSubjectBalance::getSubjectCode, subjectCode)
                );
                <span class="hljs-keyword">if</span> (lastBalance != <span class="hljs-literal">null</span>) {
                    balance.setBeginDebit(lastBalance.getEndDebit());
                    balance.setBeginCredit(lastBalance.getEndCredit());
                    <span class="hljs-comment">// å¦‚æœæ˜¯å¹´åˆï¼Œæœ¬å¹´ç´¯è®¡ä»0å¼€å§‹</span>
                    <span class="hljs-keyword">if</span> (!periodCode.endsWith(<span class="hljs-string">"01"</span>)) {
                        balance.setYearDebit(lastBalance.getYearDebit());
                        balance.setYearCredit(lastBalance.getYearCredit());
                    }
                }
            }

            balanceMapper.insert(balance);
        }

        <span class="hljs-keyword">return</span> balance;
    }

    <span class="hljs-comment">/**
     * è®¡ç®—æœŸæœ«ä½™é¢
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">calculateEndBalance</span><span class="hljs-params">(AccSubjectBalance balance, Integer balanceDirection)</span> {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">beginBalance</span> <span class="hljs-operator">=</span> balance.getBeginDebit().subtract(balance.getBeginCredit());
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">periodChange</span> <span class="hljs-operator">=</span> balance.getPeriodDebit().subtract(balance.getPeriodCredit());
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">endBalance</span> <span class="hljs-operator">=</span> beginBalance.add(periodChange);

        <span class="hljs-keyword">if</span> (endBalance.compareTo(BigDecimal.ZERO) &gt;= <span class="hljs-number">0</span>) {
            balance.setEndDebit(endBalance);
            balance.setEndCredit(BigDecimal.ZERO);
        } <span class="hljs-keyword">else</span> {
            balance.setEndDebit(BigDecimal.ZERO);
            balance.setEndCredit(endBalance.abs());
        }
    }

    <span class="hljs-comment">/**
     * æ›´æ–°ä¸Šçº§ç§‘ç›®ä½™é¢
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateParentBalance</span><span class="hljs-params">(String periodCode, String subjectCode,
                                      BigDecimal debitAmount, BigDecimal creditAmount)</span> {
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> subjectService.getByCode(subjectCode);
        <span class="hljs-keyword">if</span> (subject.getParentCode() == <span class="hljs-literal">null</span> || subject.getParentCode().isEmpty()) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">parentBalance</span> <span class="hljs-operator">=</span> getOrCreateBalance(periodCode, subject.getParentCode());

        parentBalance.setPeriodDebit(parentBalance.getPeriodDebit().add(debitAmount));
        parentBalance.setPeriodCredit(parentBalance.getPeriodCredit().add(creditAmount));
        parentBalance.setYearDebit(parentBalance.getYearDebit().add(debitAmount));
        parentBalance.setYearCredit(parentBalance.getYearCredit().add(creditAmount));

        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">parentSubject</span> <span class="hljs-operator">=</span> subjectService.getByCode(subject.getParentCode());
        calculateEndBalance(parentBalance, parentSubject.getBalanceDirection());

        balanceMapper.updateById(parentBalance);

        <span class="hljs-comment">// é€’å½’æ›´æ–°æ›´ä¸Šçº§</span>
        updateParentBalance(periodCode, subject.getParentCode(), debitAmount, creditAmount);
    }

    <span class="hljs-comment">/**
     * æ›´æ–°è¾…åŠ©æ ¸ç®—ä½™é¢
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateAuxiliaryBalance</span><span class="hljs-params">(String periodCode, AccVoucherEntry entry)</span> {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> è§£æè¾…åŠ©æ ¸ç®—æ•°æ®å¹¶æ›´æ–°å¯¹åº”ä½™é¢</span>
    }

    <span class="hljs-comment">/**
     * è·å–ä¸ŠæœŸæœŸé—´ç¼–ç 
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getLastPeriodCode</span><span class="hljs-params">(String periodCode)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>));
        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>));

        <span class="hljs-keyword">if</span> (month == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%02d"</span>, year - <span class="hljs-number">1</span>, <span class="hljs-number">12</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%02d"</span>, year, month - <span class="hljs-number">1</span>);
        }
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç§‘ç›®ä½™é¢
     */</span>
    <span class="hljs-keyword">public</span> AccSubjectBalance <span class="hljs-title function_">getBalance</span><span class="hljs-params">(String periodCode, String subjectCode)</span> {
        <span class="hljs-keyword">return</span> balanceMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getPeriodCode, periodCode)
                .eq(AccSubjectBalance::getSubjectCode, subjectCode)
        );
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æœŸé—´æ‰€æœ‰ç§‘ç›®ä½™é¢
     */</span>
    <span class="hljs-keyword">public</span> List&lt;AccSubjectBalance&gt; <span class="hljs-title function_">getBalancesByPeriod</span><span class="hljs-params">(String periodCode)</span> {
        <span class="hljs-keyword">return</span> balanceMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getPeriodCode, periodCode)
                .orderByAsc(AccSubjectBalance::getSubjectCode)
        );
    }

    <span class="hljs-comment">/**
     * è¯•ç®—å¹³è¡¡æ£€æŸ¥
     */</span>
    <span class="hljs-keyword">public</span> TrialBalanceResult <span class="hljs-title function_">checkTrialBalance</span><span class="hljs-params">(String periodCode)</span> {
        List&lt;AccSubjectBalance&gt; balances = getBalancesByPeriod(periodCode);

        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalBeginDebit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalBeginCredit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalPeriodDebit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalPeriodCredit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalEndDebit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalEndCredit</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;

        <span class="hljs-keyword">for</span> (AccSubjectBalance balance : balances) {
            <span class="hljs-comment">// åªç»Ÿè®¡ä¸€çº§ç§‘ç›®</span>
            <span class="hljs-keyword">if</span> (balance.getSubjectCode().length() == <span class="hljs-number">4</span>) {
                totalBeginDebit = totalBeginDebit.add(balance.getBeginDebit());
                totalBeginCredit = totalBeginCredit.add(balance.getBeginCredit());
                totalPeriodDebit = totalPeriodDebit.add(balance.getPeriodDebit());
                totalPeriodCredit = totalPeriodCredit.add(balance.getPeriodCredit());
                totalEndDebit = totalEndDebit.add(balance.getEndDebit());
                totalEndCredit = totalEndCredit.add(balance.getEndCredit());
            }
        }

        <span class="hljs-type">TrialBalanceResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrialBalanceResult</span>();
        result.setPeriodCode(periodCode);
        result.setBeginDebit(totalBeginDebit);
        result.setBeginCredit(totalBeginCredit);
        result.setPeriodDebit(totalPeriodDebit);
        result.setPeriodCredit(totalPeriodCredit);
        result.setEndDebit(totalEndDebit);
        result.setEndCredit(totalEndCredit);

        <span class="hljs-comment">// æ£€æŸ¥å¹³è¡¡</span>
        result.setBeginBalanced(totalBeginDebit.compareTo(totalBeginCredit) == <span class="hljs-number">0</span>);
        result.setPeriodBalanced(totalPeriodDebit.compareTo(totalPeriodCredit) == <span class="hljs-number">0</span>);
        result.setEndBalanced(totalEndDebit.compareTo(totalEndCredit) == <span class="hljs-number">0</span>);

        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h3 data-id="heading-27">å…«ã€æœŸé—´ç®¡ç†ä¸ç»“è´¦</h3>
<h4 data-id="heading-28">8.1 æœŸé—´ç»“è´¦æµç¨‹</h4>
<pre><code class="hljs language-rust" lang="rust">+----------+     +----------+     +----------+     +----------+     +----------+
| ç»“è´¦æ£€æŸ¥  | -<span class="hljs-punctuation">-&gt;</span> | è¯•ç®—å¹³è¡¡  | -<span class="hljs-punctuation">-&gt;</span> | æœŸæœ«ç»“è½¬  | -<span class="hljs-punctuation">-&gt;</span> | æ›´æ–°çŠ¶æ€  | -<span class="hljs-punctuation">-&gt;</span> | ç»“è´¦å®Œæˆ  |
+----------+     +----------+     +----------+     +----------+     +----------+
     |               |               |               |               |
     v               v               v               v               v
  å‡­è¯å…¨è¿‡è´¦     å€Ÿè´·å¿…é¡»å¹³è¡¡    æŸç›Šç»“è½¬æœ¬å¹´åˆ©æ¶¦   æœŸé—´çŠ¶æ€=å·²ç»“è´¦  ç”Ÿæˆä¸‹æœŸæœŸåˆ
  æ— æœªå®¡å‡­è¯     æœŸåˆ+å‘ç”Ÿ=æœŸæœ«   è®¡ææŠ˜æ—§ç­‰        è®°å½•ç»“è´¦æ—¶é—´
</code></pre>
<h4 data-id="heading-29">8.2 æœŸé—´æœåŠ¡å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.accounting.common.exception.AccountingException;
<span class="hljs-keyword">import</span> com.accounting.common.result.ResultCode;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.enums.VoucherStatusEnum;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.*;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.time.LocalDate;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * æœŸé—´ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeriodService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccPeriodMapper periodMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccVoucherMapper voucherMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BalanceService balanceService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CarryoverService carryoverService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OperationLogService logService;

    <span class="hljs-comment">/**
     * æ ¹æ®æ—¥æœŸè·å–æœŸé—´ç¼–ç 
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPeriodCode</span><span class="hljs-params">(LocalDate date)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%02d"</span>, date.getYear(), date.getMonthValue());
    }

    <span class="hljs-comment">/**
     * æ ¹æ®ç¼–ç è·å–æœŸé—´
     */</span>
    <span class="hljs-keyword">public</span> AccPeriod <span class="hljs-title function_">getByCode</span><span class="hljs-params">(String periodCode)</span> {
        <span class="hljs-keyword">return</span> periodMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccPeriod&gt;()
                .eq(AccPeriod::getPeriodCode, periodCode)
        );
    }

    <span class="hljs-comment">/**
     * è·å–å½“å‰æœŸé—´
     */</span>
    <span class="hljs-keyword">public</span> AccPeriod <span class="hljs-title function_">getCurrentPeriod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> periodMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccPeriod&gt;()
                .eq(AccPeriod::getStatus, <span class="hljs-number">1</span>)
                .orderByDesc(AccPeriod::getPeriodCode)
                .last(<span class="hljs-string">"LIMIT 1"</span>)
        );
    }

    <span class="hljs-comment">/**
     * æœŸé—´ç»“è´¦
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closePeriod</span><span class="hljs-params">(String operator, String periodCode)</span> {
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> getByCode(periodCode);
        <span class="hljs-keyword">if</span> (period == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_EXIST);
        }

        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_OPEN);
        }

        <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦æœ‰æœªå®¡æ ¸å‡­è¯</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">draftCount</span> <span class="hljs-operator">=</span> voucherMapper.selectCount(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getPeriodCode, periodCode)
                .eq(AccVoucher::getStatus, VoucherStatusEnum.DRAFT.getCode())
        );
        <span class="hljs-keyword">if</span> (draftCount &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.HAS_UNAUDITED_VOUCHER);
        }

        <span class="hljs-comment">// 2. æ£€æŸ¥æ˜¯å¦æœ‰æœªè¿‡è´¦å‡­è¯</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">unpostedCount</span> <span class="hljs-operator">=</span> voucherMapper.selectCount(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucher&gt;()
                .eq(AccVoucher::getPeriodCode, periodCode)
                .eq(AccVoucher::getStatus, VoucherStatusEnum.AUDITED.getCode())
        );
        <span class="hljs-keyword">if</span> (unpostedCount &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.HAS_UNPOSTED_VOUCHER);
        }

        <span class="hljs-comment">// 3. è¯•ç®—å¹³è¡¡æ£€æŸ¥</span>
        <span class="hljs-type">TrialBalanceResult</span> <span class="hljs-variable">trialResult</span> <span class="hljs-operator">=</span> balanceService.checkTrialBalance(periodCode);
        <span class="hljs-keyword">if</span> (!trialResult.isEndBalanced()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.TRIAL_BALANCE_ERROR);
        }

        <span class="hljs-comment">// 4. æ‰§è¡ŒæœŸæœ«ç»“è½¬ï¼ˆæŸç›Šç»“è½¬ï¼‰</span>
        <span class="hljs-keyword">if</span> (periodCode.endsWith(<span class="hljs-string">"12"</span>)) {
            <span class="hljs-comment">// å¹´æœ«ç»“è½¬</span>
            carryoverService.yearEndCarryover(operator, periodCode);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æœˆæœ«ç»“è½¬</span>
            carryoverService.monthEndCarryover(operator, periodCode);
        }

        <span class="hljs-comment">// 5. æ›´æ–°æœŸé—´çŠ¶æ€</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        periodMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccPeriod&gt;()
                .eq(AccPeriod::getPeriodCode, periodCode)
                .set(AccPeriod::getStatus, <span class="hljs-number">2</span>)
                .set(AccPeriod::getCloseTime, now)
                .set(AccPeriod::getCloseUser, operator)
        );

        <span class="hljs-comment">// 6. åˆ›å»ºä¸‹æœŸæœŸé—´</span>
        createNextPeriod(periodCode);

        logService.log(<span class="hljs-string">"CLOSE"</span>, <span class="hljs-string">"PERIOD"</span>, period.getId().toString(), periodCode,
            <span class="hljs-string">"æœŸé—´ç»“è´¦"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"æœŸé—´ç»“è´¦æˆåŠŸ: periodCode={}, operator={}"</span>, periodCode, operator);
    }

    <span class="hljs-comment">/**
     * åç»“è´¦
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unclosePeriod</span><span class="hljs-params">(String operator, String periodCode)</span> {
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> getByCode(periodCode);
        <span class="hljs-keyword">if</span> (period == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_EXIST);
        }

        <span class="hljs-keyword">if</span> (period.getStatus() != <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.PERIOD_NOT_CLOSED);
        }

        <span class="hljs-comment">// æ£€æŸ¥ä¸‹æœŸæ˜¯å¦æœ‰ä¸šåŠ¡</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">nextPeriodCode</span> <span class="hljs-operator">=</span> getNextPeriodCode(periodCode);
        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">nextPeriod</span> <span class="hljs-operator">=</span> getByCode(nextPeriodCode);
        <span class="hljs-keyword">if</span> (nextPeriod != <span class="hljs-literal">null</span> &amp;&amp; nextPeriod.getStatus() != <span class="hljs-number">0</span>) {
            <span class="hljs-type">long</span> <span class="hljs-variable">voucherCount</span> <span class="hljs-operator">=</span> voucherMapper.selectCount(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucher&gt;()
                    .eq(AccVoucher::getPeriodCode, nextPeriodCode)
            );
            <span class="hljs-keyword">if</span> (voucherCount &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountingException</span>(ResultCode.NEXT_PERIOD_HAS_VOUCHER);
            }
        }

        <span class="hljs-comment">// åˆ é™¤è‡ªåŠ¨ç”Ÿæˆçš„ç»“è½¬å‡­è¯</span>
        carryoverService.deleteCarryoverVouchers(periodCode);

        <span class="hljs-comment">// æ›´æ–°æœŸé—´çŠ¶æ€</span>
        periodMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccPeriod&gt;()
                .eq(AccPeriod::getPeriodCode, periodCode)
                .set(AccPeriod::getStatus, <span class="hljs-number">1</span>)
                .set(AccPeriod::getCloseTime, <span class="hljs-literal">null</span>)
                .set(AccPeriod::getCloseUser, <span class="hljs-literal">null</span>)
        );

        logService.log(<span class="hljs-string">"UNCLOSE"</span>, <span class="hljs-string">"PERIOD"</span>, period.getId().toString(), periodCode,
            <span class="hljs-string">"æœŸé—´åç»“è´¦"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, operator);

        log.info(<span class="hljs-string">"æœŸé—´åç»“è´¦æˆåŠŸ: periodCode={}"</span>, periodCode);
    }

    <span class="hljs-comment">/**
     * åˆ›å»ºä¸‹æœŸæœŸé—´
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createNextPeriod</span><span class="hljs-params">(String currentPeriodCode)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">nextPeriodCode</span> <span class="hljs-operator">=</span> getNextPeriodCode(currentPeriodCode);

        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">existPeriod</span> <span class="hljs-operator">=</span> getByCode(nextPeriodCode);
        <span class="hljs-keyword">if</span> (existPeriod != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¯ç”¨ä¸‹æœŸ</span>
            periodMapper.update(<span class="hljs-literal">null</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;AccPeriod&gt;()
                    .eq(AccPeriod::getPeriodCode, nextPeriodCode)
                    .set(AccPeriod::getStatus, <span class="hljs-number">1</span>)
            );
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> Integer.parseInt(nextPeriodCode.substring(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>));
        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> Integer.parseInt(nextPeriodCode.substring(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>));

        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">startDate</span> <span class="hljs-operator">=</span> LocalDate.of(year, month, <span class="hljs-number">1</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> startDate.plusMonths(<span class="hljs-number">1</span>).minusDays(<span class="hljs-number">1</span>);

        <span class="hljs-type">AccPeriod</span> <span class="hljs-variable">newPeriod</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccPeriod</span>();
        newPeriod.setPeriodYear(year);
        newPeriod.setPeriodMonth(month);
        newPeriod.setPeriodCode(nextPeriodCode);
        newPeriod.setStartDate(startDate);
        newPeriod.setEndDate(endDate);
        newPeriod.setStatus(<span class="hljs-number">1</span>);

        periodMapper.insert(newPeriod);

        log.info(<span class="hljs-string">"åˆ›å»ºä¸‹æœŸæœŸé—´: periodCode={}"</span>, nextPeriodCode);
    }

    <span class="hljs-comment">/**
     * è·å–ä¸‹æœŸæœŸé—´ç¼–ç 
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getNextPeriodCode</span><span class="hljs-params">(String periodCode)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>));
        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>));

        <span class="hljs-keyword">if</span> (month == <span class="hljs-number">12</span>) {
            <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%02d"</span>, year + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%02d"</span>, year, month + <span class="hljs-number">1</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-30">8.3 æœŸæœ«ç»“è½¬æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.accounting.service.dto.*;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.enums.SubjectTypeEnum;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.*;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDate;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * æœŸæœ«ç»“è½¬æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarryoverService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccSubjectMapper subjectMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccSubjectBalanceMapper balanceMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VoucherService voucherService;

    <span class="hljs-comment">// æœ¬å¹´åˆ©æ¶¦ç§‘ç›®ç¼–ç </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PROFIT_SUBJECT_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"4103"</span>;
    <span class="hljs-comment">// åˆ©æ¶¦åˆ†é…-æœªåˆ†é…åˆ©æ¶¦ç§‘ç›®ç¼–ç </span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">RETAINED_EARNINGS_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"4104.01"</span>;

    <span class="hljs-comment">/**
     * æœˆæœ«ç»“è½¬ï¼ˆæŸç›Šç»“è½¬æœ¬å¹´åˆ©æ¶¦ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monthEndCarryover</span><span class="hljs-params">(String operator, String periodCode)</span> {
        log.info(<span class="hljs-string">"å¼€å§‹æœˆæœ«ç»“è½¬: periodCode={}"</span>, periodCode);

        <span class="hljs-comment">// 1. æŸ¥è¯¢æ‰€æœ‰æŸç›Šç±»ç§‘ç›®ä½™é¢</span>
        List&lt;AccSubject&gt; profitLossSubjects = subjectMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubject&gt;()
                .eq(AccSubject::getSubjectType, SubjectTypeEnum.PROFIT_LOSS.getCode())
                .eq(AccSubject::getIsLeaf, <span class="hljs-number">1</span>)
                .eq(AccSubject::getStatus, <span class="hljs-number">1</span>)
        );

        List&lt;VoucherEntryDTO&gt; entries = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalIncome</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;  <span class="hljs-comment">// æ”¶å…¥ç±»è´·æ–¹åˆè®¡</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalExpense</span> <span class="hljs-operator">=</span> BigDecimal.ZERO; <span class="hljs-comment">// è´¹ç”¨ç±»å€Ÿæ–¹åˆè®¡</span>

        <span class="hljs-keyword">for</span> (AccSubject subject : profitLossSubjects) {
            <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">balance</span> <span class="hljs-operator">=</span> balanceMapper.selectOne(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                    .eq(AccSubjectBalance::getPeriodCode, periodCode)
                    .eq(AccSubjectBalance::getSubjectCode, subject.getSubjectCode())
            );

            <span class="hljs-keyword">if</span> (balance == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> balance.getPeriodDebit().subtract(balance.getPeriodCredit());
            <span class="hljs-keyword">if</span> (amount.compareTo(BigDecimal.ZERO) == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// åˆ›å»ºç»“è½¬åˆ†å½•</span>
            <span class="hljs-type">VoucherEntryDTO</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherEntryDTO</span>();
            entry.setSubjectCode(subject.getSubjectCode());
            entry.setSummary(<span class="hljs-string">"æœŸæœ«ç»“è½¬-"</span> + subject.getSubjectName());

            <span class="hljs-comment">// æ”¶å…¥ç±»ç§‘ç›®ï¼ˆè´·æ–¹ä½™é¢ï¼‰ï¼šå€Ÿè®°æ”¶å…¥ï¼Œè´·è®°æœ¬å¹´åˆ©æ¶¦</span>
            <span class="hljs-comment">// è´¹ç”¨ç±»ç§‘ç›®ï¼ˆå€Ÿæ–¹ä½™é¢ï¼‰ï¼šå€Ÿè®°æœ¬å¹´åˆ©æ¶¦ï¼Œè´·è®°è´¹ç”¨</span>
            <span class="hljs-keyword">if</span> (subject.getSubjectCode().startsWith(<span class="hljs-string">"6"</span>)) {
                <span class="hljs-comment">// 6å¼€å¤´ä¸ºæ”¶å…¥ç±»</span>
                <span class="hljs-keyword">if</span> (balance.getPeriodCredit().compareTo(balance.getPeriodDebit()) &gt; <span class="hljs-number">0</span>) {
                    entry.setDebitAmount(balance.getPeriodCredit().subtract(balance.getPeriodDebit()));
                    totalIncome = totalIncome.add(entry.getDebitAmount());
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è´¹ç”¨ç±»</span>
                <span class="hljs-keyword">if</span> (balance.getPeriodDebit().compareTo(balance.getPeriodCredit()) &gt; <span class="hljs-number">0</span>) {
                    entry.setCreditAmount(balance.getPeriodDebit().subtract(balance.getPeriodCredit()));
                    totalExpense = totalExpense.add(entry.getCreditAmount());
                }
            }

            <span class="hljs-keyword">if</span> ((entry.getDebitAmount() != <span class="hljs-literal">null</span> &amp;&amp; entry.getDebitAmount().compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>) ||
                (entry.getCreditAmount() != <span class="hljs-literal">null</span> &amp;&amp; entry.getCreditAmount().compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>)) {
                entries.add(entry);
            }
        }

        <span class="hljs-keyword">if</span> (entries.isEmpty()) {
            log.info(<span class="hljs-string">"æ— æŸç›Šå‘ç”Ÿé¢ï¼Œè·³è¿‡ç»“è½¬"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 2. æ·»åŠ æœ¬å¹´åˆ©æ¶¦åˆ†å½•</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">profit</span> <span class="hljs-operator">=</span> totalIncome.subtract(totalExpense);
        <span class="hljs-type">VoucherEntryDTO</span> <span class="hljs-variable">profitEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherEntryDTO</span>();
        profitEntry.setSubjectCode(PROFIT_SUBJECT_CODE);
        profitEntry.setSummary(<span class="hljs-string">"æœŸæœ«ç»“è½¬-æœ¬å¹´åˆ©æ¶¦"</span>);
        <span class="hljs-keyword">if</span> (profit.compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>) {
            profitEntry.setCreditAmount(profit);
        } <span class="hljs-keyword">else</span> {
            profitEntry.setDebitAmount(profit.abs());
        }
        entries.add(profitEntry);

        <span class="hljs-comment">// 3. ç”Ÿæˆç»“è½¬å‡­è¯</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>));
        <span class="hljs-type">int</span> <span class="hljs-variable">month</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>));
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">lastDay</span> <span class="hljs-operator">=</span> LocalDate.of(year, month, <span class="hljs-number">1</span>).plusMonths(<span class="hljs-number">1</span>).minusDays(<span class="hljs-number">1</span>);

        <span class="hljs-type">CreateVoucherRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateVoucherRequest</span>();
        request.setVoucherType(<span class="hljs-string">"è½¬"</span>);
        request.setVoucherDate(lastDay);
        request.setSummary(<span class="hljs-string">"æœŸæœ«æŸç›Šç»“è½¬"</span>);
        request.setSourceType(<span class="hljs-string">"AUTO_CARRYOVER"</span>);
        request.setEntries(entries);

        voucherService.createVoucher(operator, request);

        log.info(<span class="hljs-string">"æœˆæœ«ç»“è½¬å®Œæˆ: periodCode={}, profit={}"</span>, periodCode, profit);
    }

    <span class="hljs-comment">/**
     * å¹´æœ«ç»“è½¬ï¼ˆæœ¬å¹´åˆ©æ¶¦ç»“è½¬åˆ©æ¶¦åˆ†é…ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">yearEndCarryover</span><span class="hljs-params">(String operator, String periodCode)</span> {
        <span class="hljs-comment">// å…ˆæ‰§è¡Œæœˆæœ«ç»“è½¬</span>
        monthEndCarryover(operator, periodCode);

        log.info(<span class="hljs-string">"å¼€å§‹å¹´æœ«ç»“è½¬: periodCode={}"</span>, periodCode);

        <span class="hljs-comment">// æŸ¥è¯¢æœ¬å¹´åˆ©æ¶¦ä½™é¢</span>
        <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">profitBalance</span> <span class="hljs-operator">=</span> balanceMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getPeriodCode, periodCode)
                .eq(AccSubjectBalance::getSubjectCode, PROFIT_SUBJECT_CODE)
        );

        <span class="hljs-keyword">if</span> (profitBalance == <span class="hljs-literal">null</span>) {
            log.info(<span class="hljs-string">"æœ¬å¹´åˆ©æ¶¦æ— ä½™é¢ï¼Œè·³è¿‡å¹´æœ«ç»“è½¬"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">yearProfit</span> <span class="hljs-operator">=</span> profitBalance.getEndCredit().subtract(profitBalance.getEndDebit());
        <span class="hljs-keyword">if</span> (yearProfit.compareTo(BigDecimal.ZERO) == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// ç”Ÿæˆç»“è½¬å‡­è¯</span>
        List&lt;VoucherEntryDTO&gt; entries = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// æœ¬å¹´åˆ©æ¶¦åˆ†å½•</span>
        <span class="hljs-type">VoucherEntryDTO</span> <span class="hljs-variable">profitEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherEntryDTO</span>();
        profitEntry.setSubjectCode(PROFIT_SUBJECT_CODE);
        profitEntry.setSummary(<span class="hljs-string">"å¹´æœ«ç»“è½¬-æœ¬å¹´åˆ©æ¶¦"</span>);
        <span class="hljs-keyword">if</span> (yearProfit.compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>) {
            profitEntry.setDebitAmount(yearProfit);
        } <span class="hljs-keyword">else</span> {
            profitEntry.setCreditAmount(yearProfit.abs());
        }
        entries.add(profitEntry);

        <span class="hljs-comment">// åˆ©æ¶¦åˆ†é…-æœªåˆ†é…åˆ©æ¶¦åˆ†å½•</span>
        <span class="hljs-type">VoucherEntryDTO</span> <span class="hljs-variable">retainedEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherEntryDTO</span>();
        retainedEntry.setSubjectCode(RETAINED_EARNINGS_CODE);
        retainedEntry.setSummary(<span class="hljs-string">"å¹´æœ«ç»“è½¬-æœªåˆ†é…åˆ©æ¶¦"</span>);
        <span class="hljs-keyword">if</span> (yearProfit.compareTo(BigDecimal.ZERO) &gt; <span class="hljs-number">0</span>) {
            retainedEntry.setCreditAmount(yearProfit);
        } <span class="hljs-keyword">else</span> {
            retainedEntry.setDebitAmount(yearProfit.abs());
        }
        entries.add(retainedEntry);

        <span class="hljs-type">int</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> Integer.parseInt(periodCode.substring(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>));
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">lastDay</span> <span class="hljs-operator">=</span> LocalDate.of(year, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>);

        <span class="hljs-type">CreateVoucherRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateVoucherRequest</span>();
        request.setVoucherType(<span class="hljs-string">"è½¬"</span>);
        request.setVoucherDate(lastDay);
        request.setSummary(<span class="hljs-string">"å¹´æœ«åˆ©æ¶¦ç»“è½¬"</span>);
        request.setSourceType(<span class="hljs-string">"AUTO_CARRYOVER"</span>);
        request.setEntries(entries);

        voucherService.createVoucher(operator, request);

        log.info(<span class="hljs-string">"å¹´æœ«ç»“è½¬å®Œæˆ: periodCode={}, yearProfit={}"</span>, periodCode, yearProfit);
    }

    <span class="hljs-comment">/**
     * åˆ é™¤ç»“è½¬å‡­è¯ï¼ˆåç»“è´¦æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteCarryoverVouchers</span><span class="hljs-params">(String periodCode)</span> {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> åˆ é™¤è‡ªåŠ¨ç”Ÿæˆçš„ç»“è½¬å‡­è¯</span>
    }
}
</code></pre>
<h3 data-id="heading-31">ä¹ã€è´¦ç°¿æŸ¥è¯¢æœåŠ¡</h3>
<h4 data-id="heading-32">9.1 è´¦ç°¿ç±»å‹</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
|     æ€»è´¦         |     æ˜ç»†è´¦       |     å¤šæ è´¦       |     åºæ—¶è´¦       |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
| æŒ‰ç§‘ç›®æ±‡æ€»       | æŒ‰ç§‘ç›®é€ç¬”       | è´¹ç”¨å¤šæ æ˜ç»†     | æŒ‰æ—¥æœŸé¡ºåº       |
| æ˜¾ç¤ºä½™é¢         | æ˜¾ç¤ºæ¯ç¬”åˆ†å½•     | æ”¶å…¥å¤šæ æ˜ç»†     | æ‰€æœ‰å‡­è¯åˆ†å½•     |
| æœŸåˆ/æœ¬æœŸ/æœŸæœ«   | æ‘˜è¦/å€Ÿ/è´·/ä½™é¢  | è‡ªå®šä¹‰æ ç›®       | å‡­è¯å·/æ‘˜è¦/é‡‘é¢ |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
</code></pre>
<h4 data-id="heading-33">9.2 è´¦ç°¿æŸ¥è¯¢æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.accounting.service.dto.*;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.mapper.*;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * è´¦ç°¿æŸ¥è¯¢æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LedgerService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccVoucherMapper voucherMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccVoucherEntryMapper entryMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AccSubjectBalanceMapper balanceMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SubjectService subjectService;

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æ€»è´¦
     */</span>
    <span class="hljs-keyword">public</span> List&lt;GeneralLedgerDTO&gt; <span class="hljs-title function_">queryGeneralLedger</span><span class="hljs-params">(String periodCode, String subjectCode)</span> {
        List&lt;GeneralLedgerDTO&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// è·å–ç§‘ç›®ä¿¡æ¯</span>
        <span class="hljs-type">AccSubject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> subjectService.getByCode(subjectCode);
        <span class="hljs-keyword">if</span> (subject == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-comment">// æŸ¥è¯¢æŒ‡å®šæœŸé—´åŠä¹‹å‰çš„ä½™é¢</span>
        List&lt;AccSubjectBalance&gt; balances = balanceMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getSubjectCode, subjectCode)
                .le(AccSubjectBalance::getPeriodCode, periodCode)
                .orderByAsc(AccSubjectBalance::getPeriodCode)
        );

        <span class="hljs-keyword">for</span> (AccSubjectBalance balance : balances) {
            <span class="hljs-type">GeneralLedgerDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeneralLedgerDTO</span>();
            dto.setPeriodCode(balance.getPeriodCode());
            dto.setSubjectCode(subjectCode);
            dto.setSubjectName(subject.getSubjectName());
            dto.setBeginDebit(balance.getBeginDebit());
            dto.setBeginCredit(balance.getBeginCredit());
            dto.setPeriodDebit(balance.getPeriodDebit());
            dto.setPeriodCredit(balance.getPeriodCredit());
            dto.setEndDebit(balance.getEndDebit());
            dto.setEndCredit(balance.getEndCredit());

            <span class="hljs-comment">// è®¡ç®—ä½™é¢</span>
            dto.setBalance(balance.getEndDebit().subtract(balance.getEndCredit()));
            dto.setBalanceDirection(dto.getBalance().compareTo(BigDecimal.ZERO) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"å€Ÿ"</span> : <span class="hljs-string">"è´·"</span>);

            result.add(dto);
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æ˜ç»†è´¦
     */</span>
    <span class="hljs-keyword">public</span> List&lt;DetailLedgerDTO&gt; <span class="hljs-title function_">queryDetailLedger</span><span class="hljs-params">(String startPeriod, String endPeriod,
                                                    String subjectCode)</span> {
        List&lt;DetailLedgerDTO&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// è·å–æœŸåˆä½™é¢</span>
        <span class="hljs-type">AccSubjectBalance</span> <span class="hljs-variable">beginBalance</span> <span class="hljs-operator">=</span> balanceMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccSubjectBalance&gt;()
                .eq(AccSubjectBalance::getSubjectCode, subjectCode)
                .eq(AccSubjectBalance::getPeriodCode, startPeriod)
        );

        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">runningBalance</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
        <span class="hljs-keyword">if</span> (beginBalance != <span class="hljs-literal">null</span>) {
            runningBalance = beginBalance.getBeginDebit().subtract(beginBalance.getBeginCredit());

            <span class="hljs-comment">// æ·»åŠ æœŸåˆè¡Œ</span>
            <span class="hljs-type">DetailLedgerDTO</span> <span class="hljs-variable">beginRow</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetailLedgerDTO</span>();
            beginRow.setSummary(<span class="hljs-string">"æœŸåˆä½™é¢"</span>);
            beginRow.setBalance(runningBalance);
            beginRow.setBalanceDirection(runningBalance.compareTo(BigDecimal.ZERO) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"å€Ÿ"</span> : <span class="hljs-string">"è´·"</span>);
            result.add(beginRow);
        }

        <span class="hljs-comment">// æŸ¥è¯¢åˆ†å½•æ˜ç»†</span>
        List&lt;AccVoucherEntry&gt; entries = entryMapper.selectEntriesBySubjectAndPeriod(
            subjectCode, startPeriod, endPeriod);

        <span class="hljs-keyword">for</span> (AccVoucherEntry entry : entries) {
            <span class="hljs-type">DetailLedgerDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetailLedgerDTO</span>();
            dto.setVoucherNo(entry.getVoucherNo());
            dto.setSummary(entry.getSummary());
            dto.setDebitAmount(entry.getDebitAmount());
            dto.setCreditAmount(entry.getCreditAmount());

            <span class="hljs-comment">// è®¡ç®—æ»šåŠ¨ä½™é¢</span>
            runningBalance = runningBalance.add(entry.getDebitAmount())
                .subtract(entry.getCreditAmount());
            dto.setBalance(runningBalance.abs());
            dto.setBalanceDirection(runningBalance.compareTo(BigDecimal.ZERO) &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">"å€Ÿ"</span> : <span class="hljs-string">"è´·"</span>);

            result.add(dto);
        }

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢åºæ—¶è´¦ï¼ˆæ—¥è®°è´¦ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> List&lt;JournalDTO&gt; <span class="hljs-title function_">queryJournal</span><span class="hljs-params">(String startDate, String endDate)</span> {
        List&lt;JournalDTO&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// æŸ¥è¯¢æ—¥æœŸèŒƒå›´å†…çš„æ‰€æœ‰å·²è¿‡è´¦å‡­è¯</span>
        List&lt;AccVoucher&gt; vouchers = voucherMapper.selectList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucher&gt;()
                .ge(AccVoucher::getVoucherDate, startDate)
                .le(AccVoucher::getVoucherDate, endDate)
                .eq(AccVoucher::getStatus, <span class="hljs-number">3</span>)  <span class="hljs-comment">// å·²è¿‡è´¦</span>
                .orderByAsc(AccVoucher::getVoucherDate)
                .orderByAsc(AccVoucher::getVoucherNo)
        );

        <span class="hljs-keyword">for</span> (AccVoucher voucher : vouchers) {
            List&lt;AccVoucherEntry&gt; entries = entryMapper.selectList(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;AccVoucherEntry&gt;()
                    .eq(AccVoucherEntry::getVoucherId, voucher.getId())
                    .orderByAsc(AccVoucherEntry::getLineNo)
            );

            <span class="hljs-keyword">for</span> (AccVoucherEntry entry : entries) {
                <span class="hljs-type">JournalDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JournalDTO</span>();
                dto.setVoucherDate(voucher.getVoucherDate());
                dto.setVoucherNo(voucher.getVoucherNo());
                dto.setSubjectCode(entry.getSubjectCode());
                dto.setSubjectName(entry.getSubjectName());
                dto.setSummary(entry.getSummary());
                dto.setDebitAmount(entry.getDebitAmount());
                dto.setCreditAmount(entry.getCreditAmount());

                result.add(dto);
            }
        }

        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h3 data-id="heading-34">åã€æ¥å£å±‚å®ç°</h3>
<h4 data-id="heading-35">10.1 Controller</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.controller;

<span class="hljs-keyword">import</span> com.accounting.common.result.Result;
<span class="hljs-keyword">import</span> com.accounting.service.dto.*;
<span class="hljs-keyword">import</span> com.accounting.service.entity.*;
<span class="hljs-keyword">import</span> com.accounting.service.service.*;
<span class="hljs-keyword">import</span> com.accounting.service.utils.UserContext;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> javax.validation.Valid;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * å‡­è¯æ¥å£
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/voucher")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VoucherService voucherService;

    <span class="hljs-comment">/**
     * åˆ›å»ºå‡­è¯
     */</span>
    <span class="hljs-meta">@PostMapping("/create")</span>
    <span class="hljs-keyword">public</span> Result&lt;AccVoucher&gt; <span class="hljs-title function_">createVoucher</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> CreateVoucherRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> UserContext.getCurrentUser();
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherService.createVoucher(operator, request);
        <span class="hljs-keyword">return</span> Result.success(voucher);
    }

    <span class="hljs-comment">/**
     * å®¡æ ¸å‡­è¯
     */</span>
    <span class="hljs-meta">@PostMapping("/audit/{voucherId}")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">auditVoucher</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long voucherId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> UserContext.getCurrentUser();
        voucherService.auditVoucher(operator, voucherId);
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * å¼ƒå®¡å‡­è¯
     */</span>
    <span class="hljs-meta">@PostMapping("/unaudit/{voucherId}")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">unauditVoucher</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long voucherId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> UserContext.getCurrentUser();
        voucherService.unauditVoucher(operator, voucherId);
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * è¿‡è´¦å‡­è¯
     */</span>
    <span class="hljs-meta">@PostMapping("/post/{voucherId}")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">postVoucher</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long voucherId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> UserContext.getCurrentUser();
        voucherService.postVoucher(operator, voucherId);
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * ä½œåºŸå‡­è¯
     */</span>
    <span class="hljs-meta">@PostMapping("/void/{voucherId}")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">voidVoucher</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long voucherId,
                                     <span class="hljs-meta">@RequestParam</span> String reason)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> UserContext.getCurrentUser();
        voucherService.voidVoucher(operator, voucherId, reason);
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å‡­è¯è¯¦æƒ…
     */</span>
    <span class="hljs-meta">@GetMapping("/{voucherId}")</span>
    <span class="hljs-keyword">public</span> Result&lt;AccVoucher&gt; <span class="hljs-title function_">getVoucherDetail</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long voucherId)</span> {
        <span class="hljs-type">AccVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> voucherService.getVoucherDetail(voucherId);
        <span class="hljs-keyword">return</span> Result.success(voucher);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å‡­è¯åˆ—è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;AccVoucher&gt;&gt; <span class="hljs-title function_">getVoucherList</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> String periodCode,
            <span class="hljs-meta">@RequestParam(required = false)</span> Integer status)</span> {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> å®ç°åˆ†é¡µæŸ¥è¯¢</span>
        <span class="hljs-keyword">return</span> Result.success(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.accounting.service.controller;

<span class="hljs-keyword">import</span> com.accounting.common.result.Result;
<span class="hljs-keyword">import</span> com.accounting.service.dto.*;
<span class="hljs-keyword">import</span> com.accounting.service.service.*;
<span class="hljs-keyword">import</span> com.accounting.service.utils.UserContext;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * è´¦ç°¿æŸ¥è¯¢æ¥å£
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/ledger")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LedgerController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LedgerService ledgerService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BalanceService balanceService;

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æ€»è´¦
     */</span>
    <span class="hljs-meta">@GetMapping("/general")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;GeneralLedgerDTO&gt;&gt; <span class="hljs-title function_">queryGeneralLedger</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> String periodCode,
            <span class="hljs-meta">@RequestParam</span> String subjectCode)</span> {
        List&lt;GeneralLedgerDTO&gt; result = ledgerService.queryGeneralLedger(periodCode, subjectCode);
        <span class="hljs-keyword">return</span> Result.success(result);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢æ˜ç»†è´¦
     */</span>
    <span class="hljs-meta">@GetMapping("/detail")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;DetailLedgerDTO&gt;&gt; <span class="hljs-title function_">queryDetailLedger</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> String startPeriod,
            <span class="hljs-meta">@RequestParam</span> String endPeriod,
            <span class="hljs-meta">@RequestParam</span> String subjectCode)</span> {
        List&lt;DetailLedgerDTO&gt; result = ledgerService.queryDetailLedger(
            startPeriod, endPeriod, subjectCode);
        <span class="hljs-keyword">return</span> Result.success(result);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢åºæ—¶è´¦
     */</span>
    <span class="hljs-meta">@GetMapping("/journal")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;JournalDTO&gt;&gt; <span class="hljs-title function_">queryJournal</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> String startDate,
            <span class="hljs-meta">@RequestParam</span> String endDate)</span> {
        List&lt;JournalDTO&gt; result = ledgerService.queryJournal(startDate, endDate);
        <span class="hljs-keyword">return</span> Result.success(result);
    }

    <span class="hljs-comment">/**
     * è¯•ç®—å¹³è¡¡è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/trial-balance")</span>
    <span class="hljs-keyword">public</span> Result&lt;TrialBalanceResult&gt; <span class="hljs-title function_">getTrialBalance</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String periodCode)</span> {
        <span class="hljs-type">TrialBalanceResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> balanceService.checkTrialBalance(periodCode);
        <span class="hljs-keyword">return</span> Result.success(result);
    }

    <span class="hljs-comment">/**
     * ç§‘ç›®ä½™é¢è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/balance")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;AccSubjectBalance&gt;&gt; <span class="hljs-title function_">getSubjectBalance</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String periodCode)</span> {
        List&lt;AccSubjectBalance&gt; result = balanceService.getBalancesByPeriod(periodCode);
        <span class="hljs-keyword">return</span> Result.success(result);
    }
}
</code></pre>
<h3 data-id="heading-36">åä¸€ã€é…ç½®æ–‡ä»¶</h3>
<h4 data-id="heading-37">11.1 application.yml</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8083</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">accounting-service</span>

  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/accounting?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">50</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">50</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">20</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">3600000</span>

<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>

<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.accounting:</span> <span class="hljs-string">debug</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">"%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"</span>

<span class="hljs-comment"># æ ¸ç®—é…ç½®</span>
<span class="hljs-attr">accounting:</span>
  <span class="hljs-comment"># å‡­è¯è‡ªåŠ¨è¿‡è´¦</span>
  <span class="hljs-attr">auto-post:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># æ˜¯å¦å¼ºåˆ¶å®¡æ ¸</span>
  <span class="hljs-attr">force-audit:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># ç§‘ç›®ç¼–ç è§„åˆ™ï¼ˆçº§æ¬¡é•¿åº¦ï¼‰</span>
  <span class="hljs-attr">subject-code-rule:</span> <span class="hljs-string">"4-2-2-2"</span>
</code></pre>
<h3 data-id="heading-38">åäºŒã€æ€»ç»“</h3>
<h4 data-id="heading-39">12.1 æ ¸å¿ƒæŠ€æœ¯ç‚¹</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|      æ¨¡å—        |      æŠ€æœ¯        |             è¯´æ˜                 |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     ç§‘ç›®ç®¡ç†     |  æ ‘å½¢ç»“æ„+ç¼“å­˜   |   æ”¯æŒå¤šçº§ç§‘ç›®ï¼ŒRedisç¼“å­˜        |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     å‡­è¯ç®¡ç†     |  çŠ¶æ€æœº+äº‹åŠ¡     |   ä¸¥æ ¼çš„çŠ¶æ€æµè½¬æ§åˆ¶              |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     ä½™é¢ç®¡ç†     |  çº§è”æ›´æ–°        |   åˆ†å½•è¿‡è´¦æ—¶çº§è”æ›´æ–°ä¸Šçº§ç§‘ç›®      |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     æœŸé—´ç®¡ç†     |  ç»“è´¦æµç¨‹        |   ç»“è´¦æ£€æŸ¥+è‡ªåŠ¨ç»“è½¬               |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     å®¡è®¡è¿½è¸ª     |  æ“ä½œæ—¥å¿—        |   æ‰€æœ‰æ“ä½œè®°å½•å¯è¿½æº¯              |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
</code></pre>
<h4 data-id="heading-40">12.2 å…³é”®è®¾è®¡è¦ç‚¹</h4>
<ol>
<li><strong>å€Ÿè´·å¹³è¡¡</strong>ï¼šå‡­è¯å½•å…¥æ—¶å¼ºåˆ¶æ ¡éªŒå€Ÿè´·å¹³è¡¡</li>
<li><strong>çŠ¶æ€æµè½¬</strong>ï¼šå‡­è¯çŠ¶æ€ä¸¥æ ¼æŒ‰æµç¨‹æµè½¬</li>
<li><strong>æœŸé—´æ§åˆ¶</strong>ï¼šåªèƒ½åœ¨å·²å¯ç”¨æœŸé—´æ“ä½œ</li>
<li><strong>æƒé™åˆ†ç¦»</strong>ï¼šåˆ¶å•äººä¸èƒ½å®¡æ ¸è‡ªå·±çš„å‡­è¯</li>
<li><strong>ä½™é¢çº§è”</strong>ï¼šåˆ†å½•è¿‡è´¦æ—¶è‡ªåŠ¨æ›´æ–°ä¸Šçº§ç§‘ç›®ä½™é¢</li>
<li><strong>å®¡è®¡è¿½è¸ª</strong>ï¼šæ‰€æœ‰å…³é”®æ“ä½œè®°å½•æ—¥å¿—</li>
</ol>
<h4 data-id="heading-41">12.3 æ‰©å±•æ–¹å‘</h4>
<ol>
<li><strong>å¤šè´¦å¥—</strong>ï¼šæ”¯æŒå¤šä¸ªç‹¬ç«‹è´¦å¥—</li>
<li><strong>å¤šå¸ç§</strong>ï¼šæ”¯æŒå¤–å¸æ ¸ç®—å’Œæ±‡å…‘æŸç›Š</li>
<li><strong>è¾…åŠ©æ ¸ç®—</strong>ï¼šå®Œå–„éƒ¨é—¨/é¡¹ç›®/å¾€æ¥ç­‰æ ¸ç®—</li>
<li><strong>æŠ¥è¡¨ä¸­å¿ƒ</strong>ï¼šèµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµé‡è¡¨</li>
<li><strong>å‡­è¯æ¨¡æ¿</strong>ï¼šå¸¸ç”¨ä¸šåŠ¡å‡­è¯æ¨¡æ¿</li>
<li><strong>æ¥å£å¯¹æ¥</strong>ï¼šä¸ERPã€è´¹æ§ç­‰ç³»ç»Ÿå¯¹æ¥</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£è¯» Claude å¯¹å¼€å‘è€…çš„å½±å“ï¼šAI å¦‚ä½•åœ¨ Anthropic æ”¹å˜å·¥ä½œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579555970594947113</link>    <guid>https://juejin.cn/post/7579555970594947113</guid>    <pubDate>2025-12-04T02:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579555970594947113" data-draft-id="7579555970594914345" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£è¯» Claude å¯¹å¼€å‘è€…çš„å½±å“ï¼šAI å¦‚ä½•åœ¨ Anthropic æ”¹å˜å·¥ä½œï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹,Android"/> <meta itemprop="datePublished" content="2025-12-04T02:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹çŒ«deå°éƒ­"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£è¯» Claude å¯¹å¼€å‘è€…çš„å½±å“ï¼šAI å¦‚ä½•åœ¨ Anthropic æ”¹å˜å·¥ä½œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹çŒ«deå°éƒ­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:27:22.000Z" title="Thu Dec 04 2025 02:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿‘æ—¥ Claude å¼€å‘å…¬å¸ Anthropic å‘å¸ƒäº†ä¸€ç¯‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fresearch%2Fhow-ai-is-transforming-work-at-anthropic" target="_blank" title="https://www.anthropic.com/research/how-ai-is-transforming-work-at-anthropic" ref="nofollow noopener noreferrer">ã€ŠHow AI Is Transforming Work at Anthropicã€‹</a> çš„æ–‡ç« ï¼Œæ–‡ç« æ˜¯ Anthropic åœ¨ 8 æœˆå¯¹å†…éƒ¨å‘˜å·¥è¿›è¡Œè°ƒæŸ¥ï¼Œé€šè¿‡å¯¹ <strong>132 åå·¥ç¨‹å¸ˆå’Œç ”ç©¶äººå‘˜çš„è°ƒæŸ¥ã€53 æ¬¡æ·±åº¦è®¿è°ˆï¼Œä»¥åŠå¯¹ 20 ä¸‡æ¡å†…éƒ¨ Claude Code ä½¿ç”¨è®°å½•çš„åˆ†æ</strong>ï¼ŒæŠ¥å‘Šäº†ç›®å‰ AI å¯¹äºå·¥ç¨‹å¸ˆçš„ç›¸å…³å½±å“ã€‚</p>
<blockquote>
<p>è¿™æ˜¯ä¸€ä»½å¾ˆæœ‰å‚è€ƒä»·å€¼çš„æ•°æ®ã€‚</p>
</blockquote>
<p>åœ¨è¿™é‡Œ Anthropic ä½¿ç”¨ä¸‰ç§äº’è¡¥æ–¹æ³•ï¼Œç¡®ä¿å®šé‡ä¸å®šæ€§æ•°æ®çš„å¹³è¡¡ï¼š</p>
<ul>
<li>é€šè¿‡å†…éƒ¨ Slack æ¸ é“ï¼ˆ68 ä»½å“åº”ï¼‰å’Œç›´æ¥æ¥è§¦ 207 äººï¼ˆ64 ä»½å“åº”ï¼Œ31% å“åº”ç‡ï¼‰è¿›è¡Œï¼Œé—®é¢˜èšç„¦ç¼–ç ä»»åŠ¡é¢‘ç‡ã€ç”Ÿäº§åŠ›å½±å“å’Œå§”æ‰˜ç­–ç•¥</li>
<li>é’ˆå¯¹å‰ 53 åè°ƒæŸ¥å—è®¿è€…ï¼Œè¿›è¡Œä¸»é¢˜åˆ†æï¼Œæ¢è®¨å§”æ‰˜å®è·µã€æŠ€èƒ½å˜åŒ–ã€ç¤¾ä¼šåŠ¨æ€å’ŒèŒä¸šè½¬å˜</li>
<li>ä½¿ç”¨éšç§ä¿æŠ¤å·¥å…·åˆ†æ 20 ä¸‡æ¡å†…éƒ¨è®°å½•ï¼ŒæŒ‰ä»»åŠ¡å¤æ‚åº¦ï¼ˆ1-5 é‡è¡¨ï¼‰ã€ç±»å‹ï¼ˆå¦‚è°ƒè¯•ã€åŠŸèƒ½å®ç°ï¼‰å’Œå›¢é˜Ÿå·®å¼‚åˆ†ç±»</li>
</ul>
<p>æ–‡ç« çš„æ ¸å¿ƒæ˜¯ AI å¦‚ä½•é‡å¡‘å·¥ä½œï¼Œåˆ†ä¸ºç”Ÿäº§åŠ›ã€æ–°ä»»åŠ¡å¯ç”¨ã€å§”æ‰˜å®è·µã€æŠ€èƒ½å˜åŒ–ã€ç¤¾ä¼š/èŒä¸šå½±å“å’Œä½¿ç”¨è¶‹åŠ¿ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç®€å•çœ‹çœ‹æ–‡ç« æä¾›çš„çœŸå®æ•°æ®è¡¨æ ¼ï¼Œæ„Ÿå—ä¸‹ AI å¯¹äºå¼€å‘è€…çš„å½±å“æ•°æ®ï¼š</p>

























<table><thead><tr><th>æ¯æ—¥ä½¿ç”¨ç‡</th><th>å½“å‰å€¼</th><th>æ•°æ®å«ä¹‰/å¤‡æ³¨</th></tr></thead><tbody><tr><td>è°ƒè¯•ï¼ä¿®å¤é”™è¯¯</td><td><strong>55%</strong></td><td>è¶…è¿‡ä¸€åŠçš„å‘˜å·¥æ¯å¤©ç”¨å®ƒä¿® Bug</td></tr><tr><td>ç†è§£/é˜…è¯»ä»£ç </td><td><strong>42%</strong></td><td>ç”¨äºè§£é‡Šå¤æ‚çš„ä»£ç åº“</td></tr><tr><td>æ–°åŠŸèƒ½å¼€å‘</td><td><strong>37%</strong></td><td>ç›´æ¥ç”¨äºå†™æ–° Feature</td></tr></tbody></table>

























<table><thead><tr><th>æ—¶é—´ç‚¹ / ç»Ÿè®¡</th><th>Claude ä½¿ç”¨å æ¯” / é¢‘ç‡</th><th>å¹³å‡è‡ªæŠ¥ç”Ÿäº§åŠ›æå‡</th></tr></thead><tbody><tr><td>ä¸€å¹´å‰</td><td>ä½¿ç”¨ç‡ â‰ˆ 28%</td><td>+20% ç”Ÿäº§åŠ›æå‡</td></tr><tr><td>2025 å¹´ï¼ˆæŠ¥å‘Šæ—¶ç‚¹ï¼‰</td><td>ä½¿ç”¨ç‡ â‰ˆ 59%</td><td>+50% ç”Ÿäº§åŠ›æå‡</td></tr><tr><td>â€œPower Usersâ€ï¼ˆè¡¨ç°æœ€å¥½çš„ä¸€éƒ¨åˆ†ç”¨æˆ·ï¼‰</td><td>â€”</td><td>æœ‰ 14% çš„äººæŠ¥å‘Šç”Ÿäº§åŠ›æå‡è¶…è¿‡ 100%</td></tr></tbody></table>

















<table><thead><tr><th>æ–°ä»»åŠ¡ &amp; æ‚é¡¹æ”¹è¿›æ¯”ä¾‹</th><th>ç™¾åˆ†æ¯” / é¢‘ç‡</th></tr></thead><tbody><tr><td>Claude-assisted work ä¸­ï¼Œâ€œåŸæœ¬ä¸ä¼šåš / è¢«è·³è¿‡â€çš„ä»»åŠ¡ (new work)</td><td>27%</td></tr><tr><td>Claude Code ä»»åŠ¡ä¸­ â€œpapercut fixesâ€ï¼ˆå°ä¿®å°è¡¥ / å¯ç»´æŠ¤æ€§ï¼è´¨é‡æå‡ï¼å·¥å…·ï¼æ–‡æ¡£ç­‰ï¼‰</td><td>8.6%</td></tr></tbody></table>























<table><thead><tr><th>å¤æ‚åº¦ &amp; è‡ªåŠ¨åŒ–ç¨‹åº¦</th><th>å¹³å‡ä»»åŠ¡å¤æ‚åº¦ (1â€“5 é‡è¡¨)</th><th>å¹³å‡æœ€å¤§è¿ç»­å·¥å…·è°ƒç”¨æ•° (tool calls)</th><th>å¹³å‡ Human Turns (äººç±»äº¤äº’æ¬¡æ•°)</th></tr></thead><tbody><tr><td>6 ä¸ªæœˆå‰ (Feb 2025)</td><td>3.2</td><td>9.8 æ¬¡è¿ç»­è°ƒç”¨</td><td>6.2 æ¬¡ Human Turns</td></tr><tr><td>2025 å¹´ August (æŠ¥å‘Šæ—¶ç‚¹)</td><td>3.8</td><td>21.2 æ¬¡è¿ç»­è°ƒç”¨</td><td>4.1 æ¬¡ Human Turns</td></tr></tbody></table>

























<table><thead><tr><th>å„ä»»åŠ¡ç±»åˆ«å æ¯”å˜åŒ–</th><th>Feb 2025 å æ¯”</th><th>Aug 2025 å æ¯”</th></tr></thead><tbody><tr><td>æ–°åŠŸèƒ½å¼€å‘</td><td>14.3%</td><td>36.9%</td></tr><tr><td>è®¾è®¡ï¼è§„åˆ’</td><td>1.0%</td><td>9.9%</td></tr><tr><td>å…¶ä»–ï¼ˆdebugging / code understanding / refactoring / papercuts / â€¦ï¼‰</td><td>å‰©ä½™ â‰ˆ 84.7%</td><td>å‰©ä½™ â‰ˆ 53.2% (å¤§è‡´ = 100 âˆ’ 36.9 âˆ’ 9.9)</td></tr></tbody></table>

































<table><thead><tr><th>å…¨æ ˆåŒ– (è·¨é¢†åŸŸ)</th><th>ä¸»ç”¨ Claude Code ä»»åŠ¡ç±»å‹ / å æ¯” (ä¸»è¦ä»»åŠ¡)</th></tr></thead><tbody><tr><td>Pre-training team</td><td>æ–°åŠŸèƒ½å¼€å‘ (building new features) å æ¯” ~ 54.6%</td></tr><tr><td>å¯¹é½/å®‰å…¨å›¢é˜Ÿ</td><td>å‰ç«¯å¼€å‘ (front-end development / æ•°æ®å¯è§†åŒ–) å æ¯” ~ 7.5%</td></tr><tr><td>Post-training team</td><td>å‰ç«¯å¼€å‘ ~ 7.4%</td></tr><tr><td>Security team</td><td>ä»£ç ç†è§£ / åˆ†æå  ~ 48.9%</td></tr><tr><td>éæŠ€æœ¯äººå‘˜</td><td>Debugging å  ~ 51.5%ï¼›Data science / æ•°æ®åˆ†æå  ~ 12.7% ï¼Œç¼–å†™/è°ƒè¯•è„šæœ¬ï¼Œèƒ½å¤Ÿé€šè¿‡ AI è·å¾—åŸºç¡€ç¼–ç èƒ½åŠ›</td></tr><tr><td>æ‰€æœ‰å›¢é˜Ÿ (â€œAll Teamsâ€ baseline)</td><td>ä¸»è¦ä»»åŠ¡ä¸ºæ–°åŠŸèƒ½å¼€å‘ã€è°ƒè¯• (debugging)ã€code understanding</td></tr></tbody></table>
<p>é€šè¿‡ä¸Šé¢è¿™ä»½æ•°æ®ï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°ï¼š</p>
<p><strong>ç”Ÿäº§åŠ›æå‡</strong>ï¼š</p>
<ul>
<li>å¹³å‡ 50% ç”Ÿäº§åŠ›æå‡ï¼ˆ14% ç”¨æˆ·è¶…è¿‡ 100%ï¼‰ï¼Œåˆå¹¶æ‹‰å–è¯·æ±‚ï¼ˆpull requestsï¼‰æ¯å·¥ç¨‹å¸ˆå¢åŠ  67%ï¼Œä»»åŠ¡æ—¶é—´å‡å°‘ï¼ˆå¦‚è°ƒè¯•æ—¶é—´ç¼©çŸ­ï¼‰ï¼Œè¾“å‡ºé‡å¢åŠ </li>
<li>å‡å°‘çç¢å·¥ä½œï¼ˆå¦‚é‡æ„ï¼‰ï¼Œå¹¶è¡Œæ¢ç´¢æƒ³æ³•ï¼ˆå¦‚åŒæ—¶è¿è¡Œå¤šä¸ª Claude å®ä¾‹ï¼‰ï¼Œå¤æ‚è°ƒè¯•å¯èƒ½éœ€æ›´å¤šå–„åæ¸…ç†æ—¶é—´ï¼Œä½†æ•´ä½“æ•ˆç‡æ›´é«˜</li>
</ul>
<p><strong>å¯ç”¨æ–°å·¥ä½œ</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œ<strong>æŠ¥å‘Šé‡Œ 27% çš„ Claude è¾…åŠ©å·¥ä½œåŸæœ¬ä¸ä¼šå‘ç”Ÿ</strong>ï¼ŒåŒ…æ‹¬æ‰©å±•é¡¹ç›®ã€â€œé”¦ä¸Šæ·»èŠ±â€ä»»åŠ¡ï¼ˆå¦‚äº¤äº’å¼ä»ªè¡¨æ¿ã€æ–‡æ¡£ã€æµ‹è¯•ï¼‰å’Œæ¢ç´¢æ€§å·¥ä½œï¼Œå¦å¤–è¿˜æœ‰ 8.6% ä¸ºâ€œå°ä¿®å°è¡¥â€ï¼ˆå¦‚å¯ç»´æŠ¤æ€§é‡æ„ï¼‰</li>
<li>ä¾‹å¦‚å®‰å…¨å›¢é˜Ÿç”¨ Claude åˆ†ææœªçŸ¥ä»£ç å«ä¹‰ï¼›éæŠ€æœ¯å‘˜å·¥è°ƒè¯•ç½‘ç»œæˆ– Git é—®é¢˜</li>
</ul>
<p><strong>å§”æ‰˜å®è·µ</strong>ï¼š</p>
<ul>
<li>æ•´ä½“ Claude ä½¿ç”¨é¢‘ç¹æå‡ï¼Œä½†å®Œå…¨å§”æ‰˜åªå äº† 0-20%ï¼Œå¤§å¤šæ•°æƒ…å†µè¿˜æ˜¯éœ€ä¸»åŠ¨ç›‘ç£ï¼Œå¼€å‘è€…è¿˜æ˜¯ä¼˜å…ˆå§”æ‰˜æ˜“éªŒè¯ã€ä½é£é™©æˆ–æ¯ç‡¥ä»»åŠ¡ï¼ˆå¦‚æŠ›å¼ƒå¼è°ƒè¯•ä»£ç ï¼‰ï¼Œåœ¨é€æ­¥ä¿¡ä»»é€æ­¥åï¼Œæ‰æœ‰ä»ç®€å•åˆ°å¤æ‚çš„è¿‡ç¨‹ã€‚</li>
<li>è¾¹ç•Œï¼šè°ƒæŸ¥æŠ¥å‘Šé‡Œä¸»è¦åé¦ˆè¿˜æœ‰é«˜é£é™©ã€æˆ˜ç•¥æ€è€ƒæˆ–â€œå“å‘³â€ä»»åŠ¡ï¼ˆå¦‚è®¾è®¡å†³ç­–ï¼‰éœ€è¦ä¿ç•™äººç±»å¤„ç†</li>
</ul>
<p><strong>æŠ€èƒ½æ‰©å±•ä¸é€€åŒ–</strong>ï¼š</p>
<ul>
<li>è¿™ä¹Ÿæ˜¯æ¯”è¾ƒç»å…¸çš„è°ƒæŸ¥ç»“æœï¼Œ<strong>ç°åœ¨çš„å·¥ç¨‹å¸ˆæ›´â€œå…¨æ ˆåŒ–â€</strong> ï¼Œå¤„ç†ä¸“é•¿å¤–ä»»åŠ¡ï¼ˆå¦‚åç«¯å·¥ç¨‹å¸ˆå¿«é€Ÿæ„å»ºå¤æ‚ UIï¼Œç ”ç©¶äººå‘˜ç”¨ Claude åˆ›å»ºå‰ç«¯å¯è§†åŒ–ï¼Œå¯¹é½å›¢é˜Ÿç”¨ Claude å®éªŒï¼Œå®‰å…¨å›¢é˜Ÿåˆ†æä»£ç å½±å“ï¼‰</li>
<li>å½“ç„¶ï¼Œå¯¹äº Claude çš„å¼€å‘è€…è€Œå·²ï¼Œä»–ä»¬ä¹Ÿæœ‰æŠ€èƒ½é€€åŒ–çš„å¿§è™‘ï¼Œæ‹…å¿ƒè¿™æ ·å¤§å¹…åº¦å‡å°‘äº†åŠ¨æ‰‹å®è·µï¼Œèƒ¡å¯¼è‡´ä»£ç ç¼–å†™å’Œå®¡é˜…æŠ€èƒ½å¼±åŒ–ï¼Œå½±å“ç›‘ç£èƒ½åŠ›ï¼Œä¸€äº›å·¥ç¨‹å¸ˆååº”ä¼šé€šè¿‡å®šæœŸâ€œæ—  AI ç»ƒä¹ â€åº”å¯¹ç„¦è™‘</li>
</ul>
<p><strong>ç¤¾ä¼šä¸èŒä¸šè½¬å˜</strong>ï¼š</p>
<ul>
<li>AI å¸¦æ¥çš„æœ€ç›´æ¥å½±å“ä¹‹ä¸€ï¼Œäººä¸äººçš„äº’åŠ¨æ›´å°‘äº†ï¼Œæ¯ä¸ªäººéƒ½æ›´åƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„â€œè¶…çº§ä¸ªä½“â€ä¸ AI ç»“å¯¹ç¼–ç¨‹ï¼Œè€Œéä¸å›¢é˜Ÿåä½œ</li>
<li>å—è®¿è€…æƒ…ç»ªåˆ†è£‚ï¼šçŸ­æœŸå¤šæ•°äººå¯¹æ‰©å±•èƒ½åŠ›ä¸æ•ˆç‡æå‡æŒä¹è§‚ï¼Œä½†ä¹Ÿæœ‰äººæ‹…å¿ƒé•¿è¿œä¼šè¢« AI æ›¿ä»£æˆ–è§’è‰²è¢«å½»åº•æ”¹å†™</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>èŒä¸šè®¤åŒçš„å±æœºä¸åªæ˜¯å¤–éƒ¨å¼€å‘è€…æœ‰ï¼Œ Claude å†…éƒ¨å¼€å‘è€…ä¹Ÿæœ‰è¿™ä¸ªç„¦è™‘</strong>ï¼Œè¿™ç§å¿ƒæ€å¤§æ¦‚æ˜¯ï¼š</p>
<blockquote>
<p>â€œæˆ‘ä»¥ä¸ºæˆ‘å–œæ¬¢å†™ä»£ç ï¼Œå…¶å®æˆ‘åªæ˜¯å–œæ¬¢ä»£ç è·‘é€šçš„ç»“æœâ€ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æœªæ¥ AI å¯¹äºå¼€å‘è€…çš„å½±å“ï¼Œè¿˜å¯èƒ½ä¼šå¸¦æ¥æ–°çš„èŒä¸šä»·å€¼è§‚çš„é‡æ„ï¼Œæ‰€ä»¥æœ‰äººæ„Ÿåˆ°è¿·èŒ«ï¼š<strong>å¦‚æœå†™ä»£ç è¿™ä¸ªåŠ¨ä½œæœ¬èº«ä¸å†é‡è¦ï¼Œé‚£ä¹ˆä»¥åä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆçš„èº«ä»½è®¤åŒå»ºç«‹åœ¨å“ªé‡Œ</strong>ï¼Ÿ</p>
<p>å¦å¤–ï¼ŒAI ä¹Ÿä¸æ˜¯å®Œå®Œå…¨å…¨å°±å‡å°‘äº†å¼€å‘è€…çš„å·¥ä½œæ—¶é—´ï¼Œåœ¨æŠ¥å‘Šé‡Œå¯ä»¥çœ‹åˆ°ï¼Œå› ä¸º AI ä¹Ÿå¯¼è‡´äº†ä¸€äº›å¼€å‘è€…çš„å·¥ä½œéšæœºåç€å¢åŠ äº†ï¼š</p>
<ul>
<li><strong>æ­£å‘çš„â€œæ›´å¤šæ—¶é—´â€</strong> ï¼šä»¥å‰å› ä¸ºå¤ªéš¾æˆ–å¤ªç¹çè€Œé€šè¿‡â€œæ”¾å¼ƒâ€æ¥å¤„ç†çš„ä»»åŠ¡ï¼Œç°åœ¨å·¥ç¨‹å¸ˆæ„¿æ„èŠ±æ—¶é—´å»æ”»å…‹äº†</li>
<li><strong>è´Ÿå‘çš„â€œæ›´å¤šæ—¶é—´â€</strong> ï¼šç›²ç›®ä¿¡ä»» AI ç”Ÿæˆçš„ä»£ç ï¼Œç»“æœæŠŠè‡ªå·±é€¼è¿›äº†æ­»èƒ¡åŒï¼Œæœ€åä¸å¾—ä¸èŠ±å¤§é‡æ—¶é—´å»è°ƒè¯•å’Œæ¸…ç† AI ç•™ä¸‹çš„çƒ‚æ‘Šå­ï¼Œè¿™ä¹Ÿå¢åŠ äº†â€œè®¤çŸ¥è´Ÿè·â€ï¼Œæ¯•ç«Ÿé˜…è¯»å’Œç†è§£åˆ«äººï¼ˆæˆ– AIï¼‰å†™çš„ä»£ç ï¼Œå¾€å¾€æ¯”è‡ªå·±å†™æ›´ç´¯</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒAnthropic è¿™ç¯‡æ•°æ®è™½ç„¶åªæ˜¯å†…éƒ¨è°ƒç ”ï¼Œä½†æ˜¯ä¹Ÿå¾ˆç›´è§‚åæ˜ äº†å½“å‰çš„ä¸€äº›æƒ…å†µï¼Œéšç€ AI çš„æµè¡Œï¼Œæ•´ä¸ªå¼€å‘ç»“æ„ä¹Ÿåœ¨å‘ç”Ÿå˜åŒ–ï¼Œæœ€æ˜æ˜¾å°±æ˜¯å¼€å‘è€…çš„è¾¹ç•Œåœ¨æ…¢æ…¢æ‰“ç ´ï¼š</p>
<ul>
<li>åç«¯å¯ä»¥é€šè¿‡ AI æ„å»º UI ï¼Œç®—æ³•å›¢é˜Ÿå¯ä»¥è‡ªå·±æ­å»ºå¯è§†åŒ–æ•°æ®æ‹“å±•ï¼Œå¼€å‘è€…çš„è¾¹ç•Œè¶Šæ¥è¶Šæ¨¡ç³Šï¼Œå·¥ç¨‹å¸ˆå˜å¾—æ›´ â€œfull-stackâ€ï¼Œæ›´æ•¢å»å¤„ç†ä»¥å¾€ä¸ç†Ÿæ‚‰çš„é¢†åŸŸï¼ˆå‰åç«¯ã€æ•°æ®åº“ã€æ•°æ®å¯è§†åŒ–ç­‰ï¼‰ï¼Œå› ä¸º Claude èƒ½è¦†ç›–å¾ˆå¤šä½ä¸Šä¸‹æ–‡æˆ–æ˜“æ ¡éªŒä»»åŠ¡</li>
<li>AI å¾ˆæ“…é•¿åšå¤§é‡â€œpapercutâ€ï¼ˆå°ä¿®å°è¡¥ã€å±€éƒ¨æ¶ˆé‡æ„ã€å†™æµ‹è¯•ã€ç”Ÿæˆæ–‡æ¡£ï¼‰ä»¥åŠåŠ é€Ÿè°ƒè¯•/ç†è§£ä»£ç ï¼Œä»è€Œè®©åŒä¸€æ—¶é—´æ®µå†…â€œè¾“å‡ºé‡â€æå‡æ˜æ˜¾ï¼Œå¼€å‘è€…æ›´èšç„¦åœ¨éœ€æ±‚ç†è§£å’Œä¸šåŠ¡é¢†åŸŸ</li>
</ul>
<p>å¦å¤–ï¼ŒæŠ¥å‘Šé‡Œä¹Ÿæåˆ°äº†ï¼š</p>
<blockquote>
<p>â€œäººä»¬é€šå¸¸æŠŠ AI å½“ä½œä¸€è¾†æ›´å¿«çš„è½¦ï¼Œä½†å¦‚æœä½ æ‹¥æœ‰ä¸€ç™¾ä¸‡åŒ¹é©¬ï¼Œä½ å¯ä»¥åŒæ—¶æµ‹è¯•æ— æ•°ä¸ªæƒ³æ³•ã€‚â€</p>
</blockquote>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå…¸å‹ä»£è¡¨ï¼Œåœ¨ AI æ—¶ä»£çš„å·¥ç¨‹æ¨¡å¼å‘ç”Ÿäº†è½¬å˜ï¼Œä»¥å‰ä»çº¿æ€§çš„â€œæ„æ€-ç¼–ç -æµ‹è¯•â€ï¼Œå¯ä»¥è½¬å˜ä¸ºå¹¶è¡Œçš„â€œå¤šè·¯å¾„æ¢ç´¢â€ï¼Œå·¥ç¨‹å¸ˆçš„è§’è‰²ä»â€œæ¬ç –è€…â€å˜æˆäº†â€œæŒ‡æŒ¥å®˜â€ï¼ŒæŒ‡æŒ¥ AI ç‰›é©¬å»å°è¯•ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œç„¶åäººç±»æ¥æŒ‘é€‰æœ€å¥½çš„ä¸€ä¸ªã€‚</p>
<blockquote>
<p>è¿™å¯¹äºä¸å·® token çš„ Claude å†…éƒ¨å‘˜å·¥æ¥è¯´æ— ç–‘æ˜¯ Free çš„ã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼ŒAnthropic å‘˜å·¥æ˜¯â€œå†…åœˆâ€æ ·æœ¬ï¼Œç»“è®ºä¸èƒ½ç›´æ¥å¤–æ¨åˆ°éç§‘æŠ€è¡Œä¸šæˆ–ä¸åŒè§„æ¨¡å…¬å¸ï¼Œä½†æ˜¯ä»æŠ¥å‘Šæ‰€åæ˜ çš„çŸ­æœŸ/ä¸­æœŸæ•ˆåº”ï¼Œé•¿æœŸåŠ³åŠ¨åŠ›ç»“æ„å˜åŒ–ã€å·¥èµ„åˆ†é…ä¸èŒä¸šè·¯å¾„å˜åŒ–éƒ½æœ‰ä¸é”™çš„å‚è€ƒä»·å€¼ï¼š</p>
<blockquote>
<p><strong>AI èƒ½æ˜¾è‘—å¢åŠ äº§é‡å¹¶æ‰©å±•ä¸ªäººå¯æ‰¿æ‹…ä»»åŠ¡çš„èŒƒå›´ï¼Œä½†åŒæ—¶å¸¦æ¥æŠ€èƒ½é€€åŒ–é£é™©ã€å›¢é˜Ÿåä½œå‡å°‘ä¸èŒä¸šä¸ç¡®å®šæ„Ÿ</strong>ã€‚</p>
</blockquote>
<p>æ€»çš„æ¥è¯´ï¼ŒAnthropic çš„è¿™ä»½æŠ¥å‘Šå¯ä»¥åå°„å‡ºä¸€ä¸ªæ­£åœ¨å‘ç”Ÿçš„ç°å®ï¼š</p>
<ul>
<li><strong>AI å·²ç»ä¸ä»…ä»…æ˜¯å·¥å…·</strong>ï¼Œå®ƒå·²ç»åœ¨æ…¢æ…¢æ”¹å˜ä½ çš„å·¥ä½œæ–¹å¼å’ŒèŒä¸šç”Ÿæ¶¯</li>
</ul>

<ul>
<li><strong>çº¢åˆ©ä¸å€ºåŠ¡å¹¶å­˜</strong>ï¼šä½¿ç”¨ AI åœ¨è·å¾—äº†å·¨å¤§çš„ç”Ÿäº§åŠ›çº¢åˆ©ï¼ˆäº§å‡ºå¢åŠ ã€é—¨æ§›é™ä½ï¼‰ï¼Œä½†ä¹ŸèƒŒè´Ÿäº†æ½œåœ¨çš„éšæ€§å€ºåŠ¡ï¼ˆæŠ€èƒ½ç©ºå¿ƒåŒ–ã€ç¤¾äº¤éš”ç¦»ï¼‰</li>
</ul>

<ul>
<li><strong>æœªæ¥çš„å…³é”®èƒ½åŠ›</strong>ï¼šåœ¨ AI æ—¶ä»£ï¼Œå·¥ç¨‹å¸ˆçš„æ ¸å¿ƒç«äº‰åŠ›å¯èƒ½ä¸å†æ˜¯â€œå†™å‡ºå®Œç¾çš„è¯­æ³•â€ï¼Œè€Œæ˜¯ <strong>â€œå®šä¹‰é—®é¢˜â€ã€â€œè®¾è®¡éªŒè¯æœºåˆ¶â€ä»¥åŠâ€œè·¨é¢†åŸŸçš„ç³»ç»Ÿæ€§æ€ç»´â€</strong> ç­‰</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>è¿™ä¸ä»…æ˜¯ Anthropic å†…éƒ¨çš„æ•…äº‹ï¼Œä¹Ÿæ˜¯æ•´ä¸ªè½¯ä»¶è¡Œä¸šå³å°†é¢ä¸´çš„â€œé¢„å‘Šç‰‡â€</strong> ã€‚</p>
<h2 data-id="heading-0">åŸæ–‡é“¾æ¥</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fresearch%2Fhow-ai-is-transforming-work-at-anthropic" target="_blank" title="https://www.anthropic.com/research/how-ai-is-transforming-work-at-anthropic" ref="nofollow noopener noreferrer">www.anthropic.com/research/hoâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†ç»™ç»„ä»¶â€œæ‰“æ´â€äº†ï¼šè¿™æ‰æ˜¯ React ç»„ä»¶å¤ç”¨çš„æ­£ç¡®æ‰“å¼€æ–¹å¼]]></title>    <link>https://juejin.cn/post/7579673620940554290</link>    <guid>https://juejin.cn/post/7579673620940554290</guid>    <pubDate>2025-12-04T02:32:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620940554290" data-draft-id="7578876665696190473" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†ç»™ç»„ä»¶â€œæ‰“æ´â€äº†ï¼šè¿™æ‰æ˜¯ React ç»„ä»¶å¤ç”¨çš„æ­£ç¡®æ‰“å¼€æ–¹å¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2025-12-04T02:32:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§å¸ƒå¸ƒå°†å†›"/> <meta itemprop="url" content="https://juejin.cn/user/1535361573994189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†ç»™ç»„ä»¶â€œæ‰“æ´â€äº†ï¼šè¿™æ‰æ˜¯ React ç»„ä»¶å¤ç”¨çš„æ­£ç¡®æ‰“å¼€æ–¹å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535361573994189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§å¸ƒå¸ƒå°†å†›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:32:05.000Z" title="Thu Dec 04 2025 02:32:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šä¸€ç§åä¸ºâ€œé€ä¼ ç„¦è™‘â€çš„æ€ªç—…</h2>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0060acea62e4ff7af25f8841306cfe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5biD5biD5bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420325&amp;x-signature=szf2hPrc4UgGCAzUbJW8HhwYyqg%3D" alt="xiaotu.jpg" loading="lazy"/></p>
<p>æ¥ä¸Šå›ã€‚å¾ˆå¤šå…„å¼Ÿåœ¨è¯´ï¼šâ€œæˆ‘ä¹Ÿæƒ³æŠŠ Redux åˆ äº†ï¼Œä½†æ˜¯æˆ‘ç»„ä»¶å±‚çº§å¤ªæ·±äº†å•Šï¼æˆ‘ä¸æŠŠæ•°æ®æ”¾åœ¨ Store é‡Œï¼Œéš¾é“è¦æˆ‘æŠŠ <code>user</code> å±æ€§ä»çˆ·çˆ·ä¼ ç»™çˆ¸çˆ¸ï¼Œçˆ¸çˆ¸ä¼ ç»™å„¿å­ï¼Œå„¿å­ä¼ ç»™å­™å­ï¼Œå­™å­å†ä¼ ç»™é‚£æ¡ç‹—å—ï¼Ÿâ€</p>
<p>è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ <strong>Props Drillingï¼ˆå±æ€§é€ä¼ /æ‰“æ´ï¼‰</strong>ã€‚</p>
<p>å¬èµ·æ¥ç¡®å®å¾ˆçƒ¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œå¾ˆå¤šäººåæ‰‹å°±æ˜¯ä¸€ä¸ª Contextï¼Œæˆ–è€…æŠŠæ•°æ®æ‰”è¿› Zustandã€‚</p>
<p>ä½†ä»Šå¤©è¦å‘Šè¯‰ä½ ä¸€ä¸ªæ®‹é…·çš„çœŸç›¸ï¼š<strong>å¤§éƒ¨åˆ† Props Drilling æ ¹æœ¬ä¸éœ€è¦ Contextï¼Œä¹Ÿä¸éœ€è¦çŠ¶æ€ç®¡ç†åº“ã€‚</strong></p>
<p>ä½ è§‰å¾—ç—›è‹¦ï¼Œä»…ä»…æ˜¯å› ä¸ºä½ æŠŠç»„ä»¶å†™æˆäº†â€œä¿„ç½—æ–¯å¥—å¨ƒâ€ï¼Œè€Œå¿˜è®°äº† React æœ€åŸæœ¬çš„æ ·å­â€”â€”<strong>ä¹é«˜ç§¯æœ¨ï¼ˆComponent Compositionï¼‰</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">æ¡ˆå‘ç°åœºï¼šç—›è‹¦çš„â€œä¿„ç½—æ–¯å¥—å¨ƒâ€</h2>
<p>å…ˆçœ‹è¿™æ®µè®©ä½ è¡€å‹å‡é«˜çš„ä»£ç ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦åœ¨é¡µé¢æ·±å¤„çš„å¯¼èˆªæ é‡Œå±•ç¤ºå¤´åƒã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// âŒ å…¸å‹çš„æ‰“æ´ç°åœº</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [user] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Jack'</span>, <span class="hljs-attr">avatar</span>: <span class="hljs-string">'...'</span> });
  <span class="hljs-comment">// App åªæƒ³æ¸²æŸ“ä¸ªå¸ƒå±€ï¼Œå´è¢«è¿«è¦æŠŠ user ä¼ ä¸‹å»</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Layout</span> = (<span class="hljs-params">{ user }</span>) =&gt; {
  <span class="hljs-comment">// Layout å†…å¿ƒ OSï¼šæˆ‘åªæ˜¯ä¸ªææ’ç‰ˆçš„ï¼Œä¸ºä»€ä¹ˆè¦æ‹¿ userï¼Ÿ</span>
  <span class="hljs-comment">// åªèƒ½å«æ³ªç»§ç»­å¾€ä¸‹ä¼ </span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"layout"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MainContent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Header</span> = (<span class="hljs-params">{ user }</span>) =&gt; {
  <span class="hljs-comment">// Header å†…å¿ƒ OSï¼šæˆ‘ä¹Ÿä¸ç”¨ userï¼Œæ˜¯é‚£ä¸ªè§’è½é‡Œçš„ Avatar è¦ç”¨å•Šï¼</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Logo</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Avatar</span> = (<span class="hljs-params">{ user }</span>) =&gt; {
  <span class="hljs-comment">// ç»ˆäºåˆ°äº†...</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{user.avatar}</span> /&gt;</span></span>;
};
</code></pre>
<p><strong>ç—›ç‚¹åˆ†æï¼š</strong> <code>Layout</code> å’Œ <code>Header</code> æˆäº†æ— è¾œçš„â€œè¿é’è½¦â€ã€‚å®ƒä»¬æ ¹æœ¬ä¸å…³å¿ƒ <code>user</code> æ˜¯è°ï¼Œä½†ä¸ºäº†è¿™ä¸€è¡Œæ•°æ®ï¼Œå®ƒä»¬è¢«è¿«æ¥å— propsï¼Œå†åŸå°ä¸åŠ¨åœ°ä¼ ä¸‹å»ã€‚å¦‚æœå“ªå¤© <code>Avatar</code> è¿˜éœ€è¦ä¸ª <code>Click</code> äº‹ä»¶ï¼Œè¿™æ•´æ¡é“¾è·¯ä¸Šçš„ç»„ä»¶éƒ½è¦æ”¹ä¸€éã€‚</p>
<p>è¿™å°±æ˜¯<strong>è€¦åˆ</strong>ã€‚</p>
<h2 data-id="heading-2">ç ´å±€ï¼šæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™â€œä¸Šå¸â€</h2>
<p>æ€ä¹ˆè§£ï¼Ÿå…¶å®å¾ˆç®€å•ã€‚ ä½ å›æƒ³ä¸€ä¸‹ï¼ŒHTML é‡Œçš„ <code>&lt;div&gt;</code> æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ</p>
<pre><code class="hljs language-&lt;div" lang="&lt;div">  &lt;header&gt;...&lt;/header&gt;
&lt;/div&gt;
</code></pre>
<p><code>div</code> ä»æ¥ä¸è¿‡é—®é‡Œé¢è£…çš„æ˜¯ <code>header</code> è¿˜æ˜¯ <code>span</code>ã€‚å®ƒåªæ˜¯ä¸ªå®¹å™¨ã€‚</p>
<p>åœ¨ React é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç¥å¥‡çš„å±æ€§å« <strong><code>children</code></strong>ã€‚</p>
<h3 data-id="heading-3">âœ… æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨ <code>children</code> åšâ€œå¡«ç©ºé¢˜â€</h3>
<p>æˆ‘ä»¬æŠŠ <code>Layout</code> å˜æˆä¸€ä¸ªçœŸæ­£çš„å®¹å™¨ï¼Œä¸å†è®©å®ƒè´Ÿè´£ç”Ÿäº§ <code>Header</code>ï¼Œè€Œæ˜¯è´Ÿè´£<strong>å±•ç¤º</strong>ä¼ è¿›æ¥çš„ä¸œè¥¿ã€‚</p>
<pre><code class="hljs language-//" lang="//">const Layout = ({ children }) =&gt; {
  return &lt;div className="layout"&gt;{children}&lt;/div&gt;;
};

// æ”¹é€ åçš„ Appï¼šä¹Ÿå°±æ˜¯â€œä¸Šå¸â€ç»„ä»¶
const App = () =&gt; {
  const [user] = useState({ name: 'Jack' });

  return (
    &lt;Layout&gt;
      {/* ğŸ’¥ è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼ */}
      {/* Header ç›´æ¥åœ¨è¿™é‡Œæ¸²æŸ“ï¼Œuser ç›´æ¥ä¼ ç»™å®ƒï¼Œæ ¹æœ¬ä¸éœ€è¦ç»è¿‡ Layoutï¼ */}
      &lt;Header user={user} /&gt;
    &lt;/Layout&gt;
  );
};
</code></pre>
<p>å‘ç°äº†å—ï¼Ÿ <code>Layout</code> ä¸å†æ¥æ”¶ <code>user</code> å±æ€§äº†ã€‚Props Drilling <strong>æ¶ˆå¤±äº†</strong>ã€‚ æ•°æ®æµå˜æˆäº†ï¼š<code>App -&gt; Header -&gt; Avatar</code>ã€‚ä¸­é—´é‚£ä¸ªâ€œä¸­é—´å•†â€ <code>Layout</code> è¢«æ¶ç©ºäº†ã€‚</p>
<h3 data-id="heading-4">âœ… æ–¹æ¡ˆäºŒï¼šå¦‚æœæœ‰å¤šä¸ªå‘ä½æ€ä¹ˆåŠï¼Ÿï¼ˆSlot æ¨¡å¼ï¼‰</h3>
<p>æœ‰äººä¼šé—®ï¼šâ€œæˆ‘çš„ Layout å¾ˆå¤æ‚ï¼Œé™¤äº†ä¸­é—´çš„å†…å®¹ï¼Œå·¦è¾¹è¿˜è¦ä¸ªä¾§è¾¹æ ï¼Œä¸Šé¢è¿˜è¦ä¸ªå¤´éƒ¨ï¼Œå…‰ä¸€ä¸ª <code>children</code> ä¸å¤Ÿç”¨å•Šã€‚â€</p>
<p>å…„å¼Ÿï¼Œè°å‘Šè¯‰ä½  Props åªèƒ½ä¼ å­—ç¬¦ä¸²çš„ï¼Ÿ<strong>Props å¯ä»¥ä¼ ç»„ä»¶å•Šï¼</strong></p>
<p>è¿™å« <strong>â€œæ§åˆ¶åè½¬â€ (Inversion of Control)</strong> ï¼Œä¿—ç§°â€œæŒ–å‘å¡«èåœâ€ã€‚</p>
<pre><code class="hljs language-//" lang="//">const Layout = ({ topSlot, leftSlot, children }) =&gt; {
  return (
    &lt;div className="layout"&gt;
      &lt;div className="top-bar"&gt;{topSlot}&lt;/div&gt;
      &lt;div className="container"&gt;
        &lt;aside&gt;{leftSlot}&lt;/aside&gt;
        &lt;main&gt;{children}&lt;/main&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// ä¸Šå¸ç»„ä»¶ App
const App = () =&gt; {
  const [user] = useState({ name: 'Jack' });

  return (
    &lt;Layout
      // å°±åƒæ‹¼ä¹é«˜ä¸€æ ·ï¼ŒæŠŠç»„è£…å¥½çš„ç»„ä»¶å¡è¿›å»
      topSlot={&lt;Header user={user} /&gt;} 
      leftSlot={&lt;Sidebar /&gt;}
    &gt;
      &lt;Dashboard /&gt;
    &lt;/Layout&gt;
  );
};
</code></pre>
<p><strong>ç»æ€ï¼</strong> ç°åœ¨ï¼Œ<code>Layout</code> å½»åº•å˜æˆäº†ä¸€ä¸ªçº¯ç²¹çš„ UI éª¨æ¶ã€‚å®ƒå®Œå…¨ä¸çŸ¥é“ <code>user</code> æ•°æ®çš„å­˜åœ¨ã€‚ ä½ æƒ³ç»™ <code>Header</code> åŠ  propsï¼Ÿä½ æƒ³æ¢æ‰ <code>Sidebar</code>ï¼Ÿç›´æ¥åœ¨ <code>App</code> é‡Œæ”¹å°±è¡Œï¼Œ<code>Layout</code> ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨åŠ¨ã€‚</p>
<h2 data-id="heading-5">æ ¸å¿ƒå“²å­¦ï¼šç»„åˆ vs ç»§æ‰¿</h2>
<p>è¿™å°±æ˜¯ React æ–‡æ¡£é‡Œé‚£å¥æ™¦æ¶©çš„**â€œæ¨èä½¿ç”¨ç»„åˆï¼ˆCompositionï¼‰è€Œéç»§æ‰¿â€**çš„çœŸè°›ã€‚</p>
<p>Props Drilling çš„æœ¬è´¨é—®é¢˜ï¼Œä¸æ˜¯å±‚çº§å¤ªæ·±ï¼Œè€Œæ˜¯<strong>èŒè´£åˆ†é…ä¸æ¸…</strong>ã€‚</p>
<ul>
<li>çˆ¶ç»„ä»¶ï¼ˆLayoutï¼‰ï¼šä¸è¯¥ç®¡å®ƒåŒ…å«çš„å†…å®¹å…·ä½“éœ€è¦ä»€ä¹ˆæ•°æ®ã€‚</li>
<li>å­ç»„ä»¶ï¼ˆHeaderï¼‰ï¼šä¸è¯¥ä¾èµ–çˆ¶ç»„ä»¶å»â€œå–‚â€å®ƒæ•°æ®ï¼Œå®ƒåº”è¯¥ç›´æ¥ä»æºå¤´è·å–ï¼Œæˆ–è€…ç”±æ›´ä¸Šå±‚çš„â€œä¸Šå¸â€ç»„è£…å¥½ç»™å®ƒã€‚</li>
</ul>
<p>å½“ä½ å­¦ä¼šäº†ç”¨ <code>children</code> å’Œ <code>ReactNode props</code> æ¥ä¼ é€’ç»„ä»¶æ—¶ï¼Œä½ ä¼šå‘ç° 80% çš„ Context éƒ½æ˜¯å¤šä½™çš„ã€‚</p>
<p>Context æ˜¯ç•™ç»™é‚£äº›<strong>çœŸæ­£çš„</strong>éšå¼å…¨å±€å˜é‡çš„ï¼ˆæ¯”å¦‚ Theme, Locale, CurrentUserContextï¼‰ã€‚ è€Œå¯¹äºé¡µé¢ç»“æ„å±‚çº§çš„ä¼ å€¼ï¼Œ<strong>ç»„åˆï¼ˆCompositionï¼‰</strong> æ‰æ˜¯æ€§èƒ½æœ€å¥½ã€ä»£ç æœ€è§£è€¦çš„æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>åˆ«ä¸€çœ‹åˆ°æ•°æ®è¦ä¼ ä¸¤å±‚ä»¥ä¸Šå°±æƒ³å»º Storeã€‚</p>
<ol>
<li><strong>æƒ³ä¸€æƒ³</strong>ï¼šä¸­é—´é‚£ä¸ªç»„ä»¶çœŸçš„éœ€è¦åœ¨è¿™ä¸ªæ•°æ®é“¾æ¡é‡Œå—ï¼Ÿ</li>
<li><strong>è¯•ä¸€è¯•</strong>ï¼šèƒ½ä¸èƒ½æŠŠä¸‹å±‚ç»„ä»¶â€œæå‡ï¼ˆLift upï¼‰â€ï¼Œåœ¨çˆ¶çº§ç»„è£…å¥½ï¼Œç›´æ¥ä¼ ä¸‹å»ï¼Ÿ</li>
<li><strong>ç”¨ä¸€ç”¨</strong>ï¼š<code>children</code> å’Œâ€œç»„ä»¶æ§½ï¼ˆSlotsï¼‰â€æ˜¯ React ç»™ä½ æœ€å¥½çš„ç¤¼ç‰©ã€‚</li>
</ol>
<p>æŠŠä½ çš„ç»„ä»¶æƒ³è±¡æˆ<strong>ç›¸æ¡†</strong>ï¼Œè€Œä¸æ˜¯<strong>æ°´ç®¡</strong>ã€‚ç›¸æ¡†åªè´Ÿè´£å±•ç¤ºç…§ç‰‡ï¼Œå®ƒä¸ç®¡ç…§ç‰‡é‡Œçš„äººæ˜¯è°ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘è¦å»æŠŠé‚£ä¸ªä¼ äº† 8 å±‚ props çš„å±å±±ä»£ç é‡æ„äº†ï¼Œç¥æˆ‘çš„é”®ç›˜å®‰å¥½ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bc6e9ed23eb42a3ac95c31edcf35864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5biD5biD5bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420325&amp;x-signature=L58Z7RnfKEDwu44wkJLQ5frVSoM%3D" alt="lg_90841_1619336946_60851ef204362.png" loading="lazy"/></p>
<hr/>
<blockquote>
<p><strong>ä¸‹æœŸé¢„å‘Š</strong>ï¼šç°åœ¨ä½ å·²ç»ä¼šæ‹¼ç§¯æœ¨äº†ï¼Œä½†ä½ çš„ç§¯æœ¨ï¼ˆç»„ä»¶ï¼‰å†…éƒ¨æ˜¯ä¸æ˜¯è¿˜å†™äº†ä¸€å † <code>useEffect</code> å’Œä¸šåŠ¡é€»è¾‘ï¼Ÿ ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬è¦èŠèŠ <strong>â€œHeadless ç»„ä»¶â€ä¸â€œè‡ªå®šä¹‰ Hookâ€</strong> ã€‚æ•™ä½ å¦‚ä½•æŠŠ UI å’Œ é€»è¾‘å½»åº•å‰¥ç¦»ï¼Œå†™å‡ºé‚£ç§è®©åŒäº‹çœ‹äº†æƒ³ç»™ä½ ç£•å¤´çš„ä¼˜é›…ä»£ç ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[mysql]å­—ç¬¦ä¸²æˆªå–]]></title>    <link>https://juejin.cn/post/7579555970595012649</link>    <guid>https://juejin.cn/post/7579555970595012649</guid>    <pubDate>2025-12-04T02:32:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579555970595012649" data-draft-id="7579555970594930729" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[mysql]å­—ç¬¦ä¸²æˆªå–"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-12-04T02:32:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [mysql]å­—ç¬¦ä¸²æˆªå–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:32:44.000Z" title="Thu Dec 04 2025 02:32:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨MySQLä¸­ï¼Œæœ€æ ¸å¿ƒå’Œå¸¸ç”¨çš„å­—ç¬¦ä¸²æˆªå–å‡½æ•°æ˜¯ <code>SUBSTRING()</code>ï¼ˆæˆ–å…¶åˆ«å <code>SUBSTR()</code>ã€<code>MID()</code>ï¼‰ï¼Œä½†æ ¹æ®ä¸åŒçš„æˆªå–éœ€æ±‚ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªå®ç”¨çš„å‡½æ•°ã€‚</p>
<p>ä¸‹è¡¨å¯¹æ¯”äº†è¿™äº›å¸¸ç”¨å‡½æ•°ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š</p>






























<table><thead><tr><th align="left">å‡½æ•°</th><th align="left">è¯­æ³•</th><th align="left">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td align="left"><strong><code>SUBSTRING()</code></strong></td><td align="left"><code>SUBSTRING(str, pos, len)</code></td><td align="left">ä»å­—ç¬¦ä¸²<code>str</code>çš„æŒ‡å®šä½ç½®<code>pos</code>å¼€å§‹ï¼Œæˆªå–é•¿åº¦ä¸º<code>len</code>çš„å­ä¸²ã€‚æœ€çµæ´»ã€‚åœ¨mysqlä¸­, posä»1å¼€å§‹</td></tr><tr><td align="left"><strong><code>LEFT()</code></strong></td><td align="left"><code>LEFT(str, len)</code></td><td align="left">ä»å­—ç¬¦ä¸²<code>str</code>çš„<strong>å·¦ä¾§</strong>å¼€å§‹ï¼Œæˆªå–æŒ‡å®šé•¿åº¦<code>len</code>çš„å­ä¸²ã€‚</td></tr><tr><td align="left"><strong><code>RIGHT()</code></strong></td><td align="left"><code>RIGHT(str, len)</code></td><td align="left">ä»å­—ç¬¦ä¸²<code>str</code>çš„<strong>å³ä¾§</strong>å¼€å§‹ï¼Œæˆªå–æŒ‡å®šé•¿åº¦<code>len</code>çš„å­ä¸²ã€‚</td></tr><tr><td align="left"><strong><code>SUBSTRING_INDEX()</code></strong></td><td align="left"><code>SUBSTRING_INDEX(str, delim, count)</code></td><td align="left">æŒ‰åˆ†éš”ç¬¦<code>delim</code>æˆªå–ã€‚<code>count</code>ä¸ºæ­£æ—¶å–å·¦éƒ¨åˆ†ï¼Œä¸ºè´Ÿæ—¶å–å³éƒ¨åˆ†ã€‚</td></tr></tbody></table>
<h3 data-id="heading-0">ğŸ§© æ ¸å¿ƒå‡½æ•°ï¼šSUBSTRING() è¯¦è§£</h3>
<p><code>SUBSTRING()</code> æ˜¯æœ€é€šç”¨çš„æˆªå–å‡½æ•°ï¼Œå…¶å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-built_in">SUBSTRING</span>(str, pos, len)
</code></pre>
<ul>
<li><strong><code>str</code></strong>ï¼šè¦å¤„ç†çš„åŸå§‹å­—ç¬¦ä¸²ã€‚</li>
<li><strong><code>pos</code></strong>ï¼šèµ·å§‹ä½ç½®ã€‚
<ul>
<li>å€¼ä¸º<strong>æ­£æ•°</strong>æ—¶ï¼Œä»å­—ç¬¦ä¸²<strong>å¼€å¤´</strong>çš„ç¬¬<code>pos</code>ä¸ªå­—ç¬¦å¼€å§‹ï¼ˆ<strong>MySQLä¸­ä½ç½®ä»1å¼€å§‹è®¡æ•°</strong>ï¼‰ã€‚</li>
<li>å€¼ä¸º<strong>è´Ÿæ•°</strong>æ—¶ï¼Œä»å­—ç¬¦ä¸²<strong>æœ«å°¾</strong>å€’æ•°çš„ç¬¬<code>pos</code>ä¸ªå­—ç¬¦å¼€å§‹ã€‚</li>
</ul>
</li>
<li><strong><code>len</code></strong>ï¼ˆå¯é€‰ï¼‰ï¼šè¦æˆªå–çš„é•¿åº¦ã€‚å¦‚æœçœç•¥ï¼Œåˆ™æˆªå–ä»<code>pos</code>å¼€å§‹åˆ°å­—ç¬¦ä¸²æœ«å°¾çš„æ‰€æœ‰å­—ç¬¦ã€‚</li>
</ul>
<h3 data-id="heading-1">ğŸ“ ä¸åŒå‡½æ•°çš„å…¸å‹ç”¨æ³•ç¤ºä¾‹</h3>
<p>äº†è§£è¯­æ³•åï¼Œé€šè¿‡å…·ä½“ä¾‹å­èƒ½æ›´æ¸…æ¥šåœ°çŸ¥é“å¦‚ä½•é€‰æ‹©ï¼š</p>
<ul>
<li>
<p><strong>ä½¿ç”¨ <code>SUBSTRING()</code></strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä»ç¬¬4ä¸ªå­—ç¬¦å¼€å§‹æˆªå–åˆ°æœ€å</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">'Hello, World!'</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">-- ç»“æœ: 'World!'</span>
<span class="hljs-comment">-- ä»ç¬¬1ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæˆªå–5ä¸ªå­—ç¬¦</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">'Hello, World!'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">-- ç»“æœ: 'Hello'</span>
<span class="hljs-comment">-- ä»å€’æ•°ç¬¬6ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæˆªå–5ä¸ªå­—ç¬¦</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">'Hello, World!'</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">-- ç»“æœ: 'World'</span>
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨ <code>LEFT()</code> å’Œ <code>RIGHT()</code></strong>ï¼ˆé€‚åˆä»å›ºå®šä¸€ä¾§æˆªå–ï¼‰</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LEFT</span>(<span class="hljs-string">'MySQL'</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">-- ç»“æœ: 'My' (ä»å·¦æˆªå–)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RIGHT</span>(<span class="hljs-string">'MySQL'</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">-- ç»“æœ: 'SQL' (ä»å³æˆªå–)</span>
</code></pre>
</li>
<li>
<p><strong>ä½¿ç”¨ <code>SUBSTRING_INDEX()</code></strong>ï¼ˆé€‚åˆæŒ‰åˆ†éš”ç¬¦æˆªå–ï¼‰</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è·å–é‚®ç®±åŸŸåéƒ¨åˆ†ï¼šæ‰¾åˆ°ç¬¬äºŒä¸ª'.'ä¹‹å‰çš„æ‰€æœ‰å†…å®¹</span>
<span class="hljs-keyword">SELECT</span> SUBSTRING_INDEX(<span class="hljs-string">'www.example.com'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">-- ç»“æœ: 'www.example'</span>
<span class="hljs-comment">-- è·å–æœ€åä¸¤éƒ¨åˆ†ï¼šä»å³ä¾§å¼€å§‹ï¼Œæ‰¾åˆ°ç¬¬äºŒä¸ª'.'ä¹‹åçš„æ‰€æœ‰å†…å®¹</span>
<span class="hljs-keyword">SELECT</span> SUBSTRING_INDEX(<span class="hljs-string">'www.example.com'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-number">-2</span>); <span class="hljs-comment">-- ç»“æœ: 'example.com'</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-2">ğŸ’¡ ä½¿ç”¨æŠ€å·§ä¸æ³¨æ„äº‹é¡¹</h3>
<p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><strong>ç»„åˆä½¿ç”¨</strong>ï¼šå¯ä»¥å°†æˆªå–å‡½æ•°ä¸å…¶ä»–å­—ç¬¦ä¸²å‡½æ•°ï¼ˆå¦‚ <code>LOCATE()</code>ã€<code>LENGTH()</code>ï¼‰ç»„åˆï¼Œåº”å¯¹å¤æ‚åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œæˆªå–é‚®ç®±çš„ç”¨æˆ·åéƒ¨åˆ†ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-string">'user@example.com'</span>, <span class="hljs-number">1</span>, LOCATE(<span class="hljs-string">'@'</span>, <span class="hljs-string">'user@example.com'</span>)<span class="hljs-number">-1</span>);
<span class="hljs-comment">-- LOCATE('@', ...) è¿”å›'@'çš„ä½ç½®ï¼Œå‡1åä½œä¸ºé•¿åº¦å‚æ•°</span>
<span class="hljs-comment">-- ç»“æœ: 'user'</span>
</code></pre>
</li>
<li><strong>å‚æ•°è¾¹ç•Œ</strong>ï¼š
<ul>
<li>å¦‚æœèµ·å§‹ä½ç½® <code>pos</code> è¶…å‡ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œå‡½æ•°å°†è¿”å›ç©ºå­—ç¬¦ä¸² <code>''</code>ã€‚</li>
<li>æˆªå–é•¿åº¦ <code>len</code> ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå¦åˆ™ä¹Ÿä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">ğŸ” å¦‚ä½•é€‰æ‹©å‡½æ•°</h3>
<p>é¢å¯¹ä¸åŒéœ€æ±‚ï¼Œä½ å¯ä»¥è¿™æ ·å¿«é€Ÿé€‰æ‹©ï¼š</p>
<ul>
<li><strong>ä»æŒ‡å®šä½ç½®æˆªå–æŒ‡å®šé•¿åº¦</strong>ï¼šç”¨ <code>SUBSTRING()</code>ã€‚</li>
<li><strong>æ€»æ˜¯ä»å­—ç¬¦ä¸²çš„å·¦ä¾§æˆ–å³ä¾§å¼€å§‹æˆªå–</strong>ï¼šç”¨ <code>LEFT()</code> æˆ– <code>RIGHT()</code>ï¼Œè¯­æ³•æ›´ç®€æ´ã€‚</li>
<li><strong>æŒ‰åˆ†éš”ç¬¦ï¼ˆå¦‚<code>-</code>ã€<code>/</code>ã€<code>.</code>ï¼‰æˆªå–æŸéƒ¨åˆ†</strong>ï¼šç”¨ <code>SUBSTRING_INDEX()</code>ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>SUBSTRING()</code> æ˜¯åŠŸèƒ½æœ€å…¨é¢çš„é¦–é€‰ï¼Œè€Œå…¶ä»–å‡½æ•°åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½è®©ä»£ç æ›´ç®€æ´æ˜“è¯»ã€‚</p>
<p>å¦‚æœä½ èƒ½å‘Šè¯‰æˆ‘ä½ å…·ä½“æƒ³å¤„ç†ä»€ä¹ˆæ ·çš„å­—ç¬¦ä¸²æ•°æ®ï¼ˆæ¯”å¦‚æ˜¯é‚®ç®±ã€ç½‘å€ï¼Œè¿˜æ˜¯æœ‰å›ºå®šæ ¼å¼çš„ç¼–ç ï¼‰ï¼Œæˆ‘å¯ä»¥ç»™ä½ æ›´å…·ä½“çš„æˆªå–æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£è¯»NotebookLMåŸºäºAIçš„PTTç”Ÿæˆ ç¨‹åºåŒ–å¤„ç†æ–¹æ³•]]></title>    <link>https://juejin.cn/post/7579499567869788210</link>    <guid>https://juejin.cn/post/7579499567869788210</guid>    <pubDate>2025-12-04T02:26:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869788210" data-draft-id="7579499567869657138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£è¯»NotebookLMåŸºäºAIçš„PTTç”Ÿæˆ ç¨‹åºåŒ–å¤„ç†æ–¹æ³•"/> <meta itemprop="keywords" content="å‰ç«¯,Google,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-04T02:26:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="500ä½°"/> <meta itemprop="url" content="https://juejin.cn/user/3182441343757755"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£è¯»NotebookLMåŸºäºAIçš„PTTç”Ÿæˆ ç¨‹åºåŒ–å¤„ç†æ–¹æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3182441343757755/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    500ä½°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:26:29.000Z" title="Thu Dec 04 2025 02:26:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹ç­åå›åˆ°å®¶ï¼Œç”¨<code>è°·æ­ŒNotebookLM </code>ç”Ÿæˆäº†ä»¥ä¸‹çš„ä¸€ä¸ªPPTï¼Œæˆ‘æœ¬æ¬¡æºç´ æï¼Œæä¾›äº†ä¸€ä¸ªæœ¬åœ°çš„markdownæ–‡ä»¶ï¼Œæ˜¯æˆ‘ä»¥å‰å…¬ä¼—å·å‘è¡¨çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBwxw2vw6acqPq6R1BSA_mg" target="_blank" title="https://mp.weixin.qq.com/s/Bwxw2vw6acqPq6R1BSA_mg" ref="nofollow noopener noreferrer">TapNowå¯¹æ¥Nano Banana</a> ï¼Œç”Ÿæˆçš„è¿‡ç¨‹æ¯”è¾ƒæ…¢ï¼Œ<code>å¤§æ¦‚3-5åˆ†é’Ÿå®Œæˆ</code>ï¼ˆä¹Ÿå’Œå†…å®¹ç¯‡å¹…é•¿çŸ­æ­£ç›¸å…³ï¼‰ã€‚
åŠå…¬æ•ˆç‡æ˜¾è‘—æå‡å•Šï¼Œæˆ‘å°±åªæ˜¯ä¸Šä¼ äº†ä¸€ä¸ªmdï¼Œä¸Šä¼ ç‚¹å‡»<code>ç”Ÿæˆæ¼”ç¤ºæ–‡ç¨¿</code>å³å¯èººä¸‹å–æ¯çŒ«å±å’–å•¡äº†ã€‚
éšç€å¤§æ¨¡å‹å¯¹å„è¡Œå„ä¸šçš„èµ‹èƒ½ï¼ŒAIåŠå…¬è¡Œä¸šå¦‚ç«å¦‚è¼ï¼ŒAIç”Ÿæˆpptã€AIè¾…åŠ©å†™ä½œç­‰åº”ç”¨å±‚å‡ºä¸ç©·ï¼ŒNano Banana Proä¹Ÿèƒ½ç”ŸæˆPPTäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df6e232d5afe4ce7a53e9afc4712708e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNTAw5L2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765419989&amp;x-signature=UFRAen39JIS3rE%2FZglh3eZtDVHc%3D" alt="image-20251203231531099.png" loading="lazy"/></p>
<p>ç›¸å¯¹äºAIè¾…åŠ©å†™ä½œï¼ŒåŸºäºAIçš„pptç”Ÿæˆéš¾åº¦è¾ƒå¤§ï¼Œç”±äºpptå†…çš„å…ƒç´ è¾ƒå¤šã€å½¢æ€å¤šæ ·ï¼Œå åŠ åŠ¨ç”»ã€åˆ‡æ¢ç­‰æ•ˆæœï¼Œé€ æˆpptçš„ç¨‹åºåŒ–å¤„ç†å›°éš¾ï¼Œå¢åŠ äº†pptç”Ÿæˆçš„éš¾åº¦ã€‚</p>
<p>æˆ‘å»æ‰’äº†ä¸‹ï¼ŒAI pptçš„ç”ŸæˆåŸç†ã€‚æ¶‰åŠäººå·¥æ™ºèƒ½æŠ€æœ¯é¢†åŸŸï¼Œå…·ä½“åœ°è¯´æ˜¯ä¸€ç§é€‚ç”¨äº<code>åŸºäºAIçš„PPTç”Ÿæˆç¨‹åºåŒ–å¤„ç†æ–¹æ³•</code>ã€‚</p>
<p>å¤§è‡´æ˜¯å°†PPTå†…çš„å…ƒç´ ä»¥åŠå„ç§æ•ˆæœå…¨éƒ¨ç¼–è¯‘æˆJsonæ–‡ä»¶ï¼Œé€šè¿‡å¯¹Jsonæ–‡ä»¶çš„æ“ä½œå®ç°å¯¹pptçš„ä¿®æ”¹ï¼Œæœ€åç»è¿‡åå‘æ¸²æŸ“ï¼Œç”Ÿæˆæœ€ç»ˆçš„PPTã€‚</p>
<p><code>NotebookLM</code> çš„æºç´ æä¹Ÿæ”¯æŒæ–‡æ¡£ã€éŸ³é¢‘ã€å›¾ç‰‡ã€çº¯æ–‡å­—ç­‰ç´ æï¼ˆwordã€txtã€markdownã€pdfæ ¼å¼çš„æ–‡ä»¶ï¼‰ï¼Œé‚£ä¹ˆAIé¦–å…ˆå¯¹ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ã€éŸ³é¢‘ã€å›¾ç‰‡ã€çº¯æ–‡å­—æˆ–åœ¨çº¿é€‰æ‹©çš„pptæ¨¡æ¿è¿›è¡Œè§£æï¼Œå¹¶å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œè§£ææŠ½å–æœ‰æ•ˆä¿¡æ¯ï¼Œç”Ÿæˆpptçš„å†…å®¹ç´ æã€‚å°†pptæ¨¡æ¿æ•°æ®æ•´ç†æˆJsonæ–‡ä»¶ï¼Œæºç´ ææ•°æ®åŒ…æ‹¬æ–‡å­—ã€å­—ä½“ã€é…è‰²ã€å½¢çŠ¶ã€ä½ç½®ã€åŠ¨ç”»ã€å›¾ç‰‡æ•°æ®ï¼Œå¹¶å°†å…¶ç¼–è¯‘åˆ°Jsonæ–‡ä»¶ä¸­ã€‚</p>
<p>æ ¹æ®ç”¨æˆ·ä¸Šä¼ çš„å†…å®¹æ–‡ä»¶æˆ–è€…å¤§æ¨¡å‹ç”Ÿæˆçš„pptæ–‡æœ¬å†…å®¹ï¼Œç”Ÿæˆpptåˆå§‹æ–‡ä»¶çš„å†…å®¹ç´ æã€‚</p>
<p>å†æ ¹æ®è·å–åˆ°çš„pptå†…å®¹ç´ æï¼Œç”Ÿæˆpptç›®å½•ã€å†…å®¹ã€æ ‡é¢˜ã€ç« èŠ‚é¡µé¢ï¼Œå°†pptå†…å®¹ç´ æä¿®æ”¹ç”Ÿæˆçš„Jsonæ–‡ä»¶ã€‚ç”¨æˆ·åœ¨åˆå§‹æ–‡ä»¶çš„åŸºç¡€ä¸Šè¿›è¡Œpptåœ¨çº¿ç¼–è¾‘ï¼ˆæ¯”å¦‚<code>WPS AI</code>ï¼Œ å¯æ”¯æŒç¼©çŸ­ç¯‡å¹…ã€æ–‡æ¡ˆé‡å†™ã€ç»­å†™ï¼‰æ“ä½œã€‚æ ¹æ®ç”¨æˆ·åœ¨çº¿ç¼–è¾‘çš„å„é¡¹æ“ä½œï¼ˆåŒ…æ‹¬æ·»åŠ æˆ–ä¿®æ”¹æ–‡æœ¬ã€åŠ¨ç”»ã€å›¾ç‰‡åå®ŒæˆPPTçš„åˆ¶ä½œï¼‰ï¼Œä¿®æ”¹Jsonæ–‡ä»¶ã€‚ä¿®æ”¹åçš„Jsonæ–‡ä»¶è¿›è¡Œåå‘æ¸²æŸ“ï¼Œç”Ÿæˆæœ€ç»ˆçš„pptæ–‡ä»¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8631b97b5d74155865474cc771f95db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNTAw5L2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765419989&amp;x-signature=2BTkab3RmDPh0mtWZ%2Fas3ktTJ%2F8%3D" alt="image-20251204002136737.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c39c26c08642e8a1105fc360a2a1cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNTAw5L2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765419989&amp;x-signature=Vp3kj6jSmoR1FzODSZM2KLeYfoE%3D" alt="image-20251203230805240.png" loading="lazy"/>
åœ¨è¿™ä¸€æ–¹æ¡ˆä¸­ï¼Œé¦–å…ˆå°†å·²æœ‰çš„ PPT æ¨¡æ¿å’Œå…·ä½“å†…å®¹ç»Ÿä¸€è½¬æ¢ä¸º Json æ–‡ä»¶ï¼ŒæŠŠæ¨¡æ¿ä¸­åŸæœ‰çš„å‚æ•°é…ç½®ã€æ ·å¼è°ƒæ•´ç­‰åŠŸèƒ½æ€§ä¿¡æ¯å…¨éƒ¨ç¼–è¯‘è¿› Json ç»“æ„ä¸­ã€‚éšåï¼Œå¯¹ç”¨æˆ·åœ¨ PPT ä¸­å¯ç¼–è¾‘ã€å¯ä¸Šä¼ çš„å„ç±»æ–‡ä»¶å†…å®¹ï¼Œä»¥åŠç”±å¤§æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬å’Œç´ æè¿›è¡Œè§£æï¼Œç”Ÿæˆä¸€ä»½ PPT çš„åˆå§‹ Json æ–‡ä»¶ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä¸€æ–¹é¢å¯¹<code>æ¨¡æ¿ Json</code> è¿›è¡Œç›¸åº”ä¿®æ”¹ï¼Œå¦ä¸€æ–¹é¢å…è®¸ç”¨æˆ·åœ¨å‰ç«¯å¯¹è¯¥åˆå§‹æ–‡ä»¶è¿›è¡Œåœ¨çº¿ç¼–è¾‘å’Œå®Œå–„ã€‚æœ€ç»ˆï¼Œæ ¹æ®ç”¨æˆ·åœ¨çº¿ç¼–è¾‘æ‰€<code>äº§ç”Ÿçš„ Json </code>å˜æ›´è¿›è¡Œåå‘æ¸²æŸ“ï¼Œè‡ªåŠ¨ç”Ÿæˆç¬¦åˆéœ€æ±‚çš„ PPT æ–‡ä»¶ã€‚</p>
<p>å¦‚æœæœ¬æ–‡èƒ½ç»™ä½ æä¾›å¯å‘å’Œå¸®åŠ©ï¼Œè¿˜è¯·ç•™ä¸‹ä½ çš„ä¸€å¥ä¸‰è¿(<code>ç‚¹èµ</code>ã€<code>è½¬å‘</code>ã€<code>è¯„è®º</code>)ï¼Œç»™æˆ‘ä¸€äº›é¼“åŠ±ï¼Œè°¢è°¢ã€‚</p>
<blockquote>
<p>æœ€è¿‘çš„å°å¼€å‘ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwubai-cq.github.io%2Feasycutpro%2F" target="_blank" title="https://wubai-cq.github.io/easycutpro/" ref="nofollow noopener noreferrer">wubai-cq.github.io/easycutpro/</a></p>
<p>ï¼ˆæ¨èä½¿ç”¨ç”µè„‘chromeæµè§ˆå™¨æ‰“å¼€ä½“éªŒæœ€ä½³ï¼Œè½¯ä»¶å¯ä¸‹è½½ï¼‰
éå¸¸é€‚åˆåœ¨èŒåœºä¸­éœ€è¦é¢‘ç¹åˆ‡æ¢å†…ã€å¤–ç½‘çš„æœ‹å‹ä½¿ç”¨</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ç¬”è®°ã€‘dockerå®ç”¨æŠ€å·§ä¸å¸¸è§æ“ä½œ]]></title>    <link>https://juejin.cn/post/7579480677902581795</link>    <guid>https://juejin.cn/post/7579480677902581795</guid>    <pubDate>2025-12-04T02:03:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579480677902581795" data-draft-id="7579427549471899694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ç¬”è®°ã€‘dockerå®ç”¨æŠ€å·§ä¸å¸¸è§æ“ä½œ"/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2025-12-04T02:03:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹Œæ—¥å°¼ä¹"/> <meta itemprop="url" content="https://juejin.cn/user/854736525882123"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ç¬”è®°ã€‘dockerå®ç”¨æŠ€å·§ä¸å¸¸è§æ“ä½œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/854736525882123/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹Œæ—¥å°¼ä¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:03:45.000Z" title="Thu Dec 04 2025 02:03:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç›®å½•</h2>
<ol>
<li>ç”¨æˆ·æƒé™é…ç½®</li>
<li>æ ¼å¼åŒ–è¾“å‡º</li>
<li>æ—¶é—´æ ¼å¼ä¸è¾“å‡ºæ§åˆ¶</li>
<li>å®¹å™¨å’Œé•œåƒ ID ä½¿ç”¨æŠ€å·§</li>
<li>é•œåƒå’Œå®¹å™¨æ¸…ç†</li>
<li>Registry ä¸ Repository ç†è§£</li>
<li>å®¹å™¨å¿«ç…§</li>
<li>å®¹å™¨èµ„æºé™åˆ¶</li>
<li>ç£ç›˜å ç”¨æ£€æŸ¥</li>
<li>å®¹å™¨é‡å‘½å</li>
<li>Docker å‘½ä»¤ç»„åˆ</li>
<li>Docker æ„å»ºé«˜çº§é€‰é¡¹</li>
</ol>
<h2 data-id="heading-1">1ï¼Œæ·»åŠ æ™®é€šç”¨æˆ·dockerç»„æƒé™</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé root ç”¨æˆ·æ— æ³•å¯åŠ¨ Dockerã€‚éœ€è¦å°†ç”¨æˆ·æ·»åŠ åˆ° dockerÂ ç»„ã€‚</p>
<h4 data-id="heading-2">è§£å†³æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. æ£€æŸ¥ docker ç»„æ˜¯å¦å­˜åœ¨</span>
getent group docker
<span class="hljs-meta prompt_"># </span><span class="bash">2. å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»º docker ç»„</span>
sudo groupadd docker
<span class="hljs-meta prompt_"># </span><span class="bash">3. å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„</span>
sudo usermod -aG docker ç”¨æˆ·å
<span class="hljs-meta prompt_"># </span><span class="bash">4. é‡æ–°ç™»å½•æˆ–åˆ·æ–°ç»„æƒé™</span>
newgrp docker
<span class="hljs-meta prompt_"># </span><span class="bash">5. éªŒè¯æƒé™</span>
docker ps
</code></pre>
<h4 data-id="heading-3">æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>ä½¿ç”¨ yum å®‰è£… Docker åï¼Œé»˜è®¤ä¼šåˆ›å»º docker ç»„ï¼Œä½†ä¸ä¼šè‡ªåŠ¨æ·»åŠ ç”¨æˆ·</li>
<li>æ·»åŠ ç”¨æˆ·åˆ° docker ç»„åï¼Œéœ€è¦é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆ</li>
<li>æˆ–è€…ä½¿ç”¨ newgrp docker ä¸´æ—¶åˆ·æ–°ç»„æƒé™</li>
</ul>
<h2 data-id="heading-4">2ï¼Œæ ¼å¼åŒ–è¾“å‡º</h2>
<p>Docker æ”¯æŒä½¿ç”¨ Go æ¨¡æ¿æ ¼å¼åŒ–è¾“å‡ºï¼Œè®©è¾“å‡ºæ›´æ¸…æ™°æ˜“è¯»ã€‚</p>
<h4 data-id="heading-5">å¸¸ç”¨æ ¼å¼å­—æ®µ</h4>



































<table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th><th>å®ä¾‹</th></tr></thead><tbody><tr><td>.ID</td><td>å®¹å™¨/é•œåƒ ID</td><td>a1b2c3d4e5f6</td></tr><tr><td>.Repository</td><td>é•œåƒä»“åº“å</td><td>nginx</td></tr><tr><td>.Tag</td><td>é•œåƒæ ‡ç­¾</td><td>latest</td></tr><tr><td>.Digest</td><td>é•œåƒæ‘˜è¦</td><td>sha256:...</td></tr><tr><td>.Name</td><td>å®¹å™¨åç§°</td><td>my-container</td></tr></tbody></table>
<h4 data-id="heading-6">å®ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åªæ˜¾ç¤ºå®¹å™¨ IDï¼ˆç­‰åŒäº docker ps -qï¼‰</span>
docker ps --format "{{.ID}}"
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºé•œåƒçš„ä»“åº“åå’Œæ ‡ç­¾</span>
docker images --format "{{.Repository}}:{{.Tag}}"
<span class="hljs-meta prompt_"># </span><span class="bash">è‡ªå®šä¹‰æ ¼å¼ï¼šæ˜¾ç¤ºå®¹å™¨åå’ŒçŠ¶æ€</span>
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºé•œåƒçš„å®Œæ•´ä¿¡æ¯</span>
docker images --format "{{.Repository}}:{{.Tag}} ({{.ID}})"
</code></pre>
<h4 data-id="heading-7">é«˜çº§ç”¨æ³•</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®¹å™¨åã€é•œåƒã€çŠ¶æ€å’Œåˆ›å»ºæ—¶é—´</span>
docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.CreatedAt}}"
<span class="hljs-meta prompt_"># </span><span class="bash">åªæ˜¾ç¤ºè¿è¡Œä¸­çš„å®¹å™¨åç§°</span>
docker ps --format "{{.Names}}" --filter "status=running"
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºé•œåƒå¤§å°</span>
docker images --format "{{.Repository}}:{{.Tag}}\t{{.Size}}"
</code></pre>
<h2 data-id="heading-8">3ï¼Œæ—¶é—´æ ¼å¼ä¸è¾“å‡ºæ§åˆ¶</h2>
<h4 data-id="heading-9">æ—¶é—´æ ¼å¼æ§åˆ¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®Œæ•´æ—¶é—´æˆ³ï¼ˆä¸éšè—æ—¶é—´ï¼‰</span>
docker history -H=false imageId
<span class="hljs-meta prompt_"># </span><span class="bash">é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä¼šéšè—æ—¶é—´åˆ—ï¼Œä½¿ç”¨ -H=<span class="hljs-literal">false</span> å¯ä»¥æ˜¾ç¤º</span>
</code></pre>
<h4 data-id="heading-10">æœªæˆªæ–­è¾“å‡º</h4>
<p>å½“è¾“å‡ºè¢«æˆªæ–­æ—¶ï¼Œä½¿ç”¨Â --no-truncÂ æŸ¥çœ‹å®Œæ•´å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®Œæ•´çš„å®¹å™¨ä¿¡æ¯ï¼ˆä¸æˆªæ–­ï¼‰</span>
docker ps --no-trunc
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®Œæ•´çš„é•œåƒå†å²ï¼ˆä¸æˆªæ–­ï¼‰</span>
docker history --no-trunc imageId
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®Œæ•´çš„å®¹å™¨æ—¥å¿—</span>
docker logs --no-trunc containerId
</code></pre>
<h4 data-id="heading-11">ç»„åˆä½¿ç”¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºå®Œæ•´çš„å®¹å™¨ ID å’Œå‘½ä»¤</span>
docker ps --no-trunc --format "{{.ID}}\t{{.Command}}"
</code></pre>
<h2 data-id="heading-12">4ï¼Œå®¹å™¨å’Œé•œåƒ ID ä½¿ç”¨æŠ€å·§</h2>
<p>DockerÂ æ”¯æŒä½¿ç”¨ ID çš„ç¼©å†™å½¢å¼ï¼Œæé«˜æ“ä½œæ•ˆç‡ã€‚</p>
<h4 data-id="heading-13">ID ç¼©å†™è§„åˆ™</h4>
<ul>
<li>Docker ä¼šè‡ªåŠ¨è¯†åˆ« ID çš„å‰ç¼€</li>
<li>åªè¦å‰ç¼€è¶³å¤Ÿå”¯ä¸€ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„é•¿åº¦çš„å‰ç¼€</li>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªå®¹å™¨/é•œåƒï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨ç¬¬ä¸€ä¸ªå­—ç¬¦</li>
</ul>
<h4 data-id="heading-14">å®ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨å®Œæ•´ ID</span>
docker logs a1b2c3d4e5f6
<span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨å‰ 6 ä½ï¼ˆé€šå¸¸è¶³å¤Ÿå”¯ä¸€ï¼‰</span>
docker logs a1b2c3
<span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨å‰ 3 ä½ï¼ˆå¦‚æœå”¯ä¸€ï¼‰</span>
docker logs a1b
<span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœåªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨ç¬¬ä¸€ä¸ªå­—ç¬¦</span>
docker logs a
<span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼ˆä½¿ç”¨çŸ­ IDï¼‰</span>
docker logs --tail 10 -f a
</code></pre>
<h4 data-id="heading-15">æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. å…ˆæŸ¥çœ‹å®¹å™¨åˆ—è¡¨ï¼Œç¡®è®¤ ID</span>
docker ps
<span class="hljs-meta prompt_"># </span><span class="bash">2. ä½¿ç”¨è¶³å¤Ÿé•¿çš„å‰ç¼€ç¡®ä¿å”¯ä¸€æ€§</span>
docker exec -it a1b2c3 bash
<span class="hljs-meta prompt_"># </span><span class="bash">3. åœ¨è„šæœ¬ä¸­ä½¿ç”¨å®Œæ•´ ID æˆ–é•¿å‰ç¼€</span>
CONTAINER_ID=$(docker ps -q --filter "name=myapp")
docker logs $CONTAINER_ID
</code></pre>
<h2 data-id="heading-16">5ï¼Œé•œåƒå’Œå®¹å™¨æ¸…ç†</h2>
<p>å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„èµ„æºå¯ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚</p>
<h4 data-id="heading-17">æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æœªä½¿ç”¨ã€æœªæ‰“æ ‡ç­¾çš„é•œåƒï¼ˆäº¤äº’å¼ï¼‰</span>
docker image prune
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æœªä½¿ç”¨ã€æœªæ‰“æ ‡ç­¾çš„é•œåƒï¼ˆå¼ºåˆ¶ï¼Œä¸è¯¢é—®ï¼‰</span>
docker image prune -f
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æœ‰æ ‡ç­¾ä½†æœªè¢«å®¹å™¨ä½¿ç”¨çš„ï¼‰</span>
docker image prune -a
<span class="hljs-meta prompt_"># </span><span class="bash">å¼ºåˆ¶æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ</span>
docker image prune -af
</code></pre>
<h4 data-id="heading-18">æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰åœæ­¢çš„å®¹å™¨ï¼ˆäº¤äº’å¼ï¼‰</span>
docker container prune
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰åœæ­¢çš„å®¹å™¨ï¼ˆå¼ºåˆ¶ï¼‰</span>
docker container prune -f
</code></pre>
<h4 data-id="heading-19">å…¨é¢æ¸…ç†</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ˆé•œåƒã€å®¹å™¨ã€ç½‘ç»œã€æ„å»ºç¼“å­˜ï¼‰</span>
docker system prune
<span class="hljs-meta prompt_"># </span><span class="bash">å¼ºåˆ¶æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº</span>
docker system prune -f
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ŒåŒ…æ‹¬æœªä½¿ç”¨çš„é•œåƒ</span>
docker system prune -a
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ŒåŒ…æ‹¬å·ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span>
docker system prune -a --volumes
</code></pre>
<h4 data-id="heading-20">æ¸…ç†ç­–ç•¥å»ºè®®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®šæœŸæ¸…ç†è„šæœ¬ç¤ºä¾‹</span>
<span class="hljs-meta prompt_">#</span><span class="bash">!/bin/bash</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨</span>
docker image prune -af
docker container prune -f
<span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹æ¸…ç†åçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</span>
docker system df
</code></pre>
<h2 data-id="heading-21">6ï¼ŒRegistry ä¸ Repository ç†è§£</h2>
<p>ç†è§£ Docker é•œåƒçš„å‘½åè§„èŒƒå¾ˆé‡è¦ã€‚</p>
<h4 data-id="heading-22">é•œåƒå‘½åæ ¼å¼</h4>
<p>{æ³¨å†Œä¸­å¿ƒ}/{å‘½åç©ºé—´}/{é•œåƒä»“åº“åç§°}:{ç‰ˆæœ¬}</p>
<h4 data-id="heading-23">å®Œæ•´ç¤ºä¾‹</h4>
<p>registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85</p>
<p><strong>ç»„æˆéƒ¨åˆ†ï¼š</strong></p>
<ul>
<li>Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰ï¼šregistry.cn-beijing.aliyuncs.com</li>
<li>å‘½åç©ºé—´ï¼šmy_namespace</li>
<li>é•œåƒä»“åº“åç§°ï¼štomcat</li>
<li>ç‰ˆæœ¬æ ‡ç­¾ï¼š8.5.85</li>
</ul>
<h4 data-id="heading-24">å¸¸è§ Registry</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Docker Hubï¼ˆé»˜è®¤ï¼Œå¯çœç•¥ï¼‰</span>
docker.io/library/nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">æˆ–ç®€å†™ä¸º</span>
nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡</span>
registry.cn-beijing.aliyuncs.com/namespace/image:tag
<span class="hljs-meta prompt_"># </span><span class="bash">åä¸ºäº‘</span>
swr.cn-north-4.myhuaweicloud.com/namespace/image:tag
<span class="hljs-meta prompt_"># </span><span class="bash">ç§æœ‰ Registry</span>
registry.example.com:5000/namespace/image:tag
</code></pre>
<h4 data-id="heading-25">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ‹‰å–é•œåƒ</span>
docker pull registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85
<span class="hljs-meta prompt_"># </span><span class="bash">æ¨é€é•œåƒ</span>
docker tag local-image:tag registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85
docker push registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85
</code></pre>
<h2 data-id="heading-26">7ï¼Œå®¹å™¨å¿«ç…§</h2>
<p>å®¹å™¨å¿«ç…§ç”¨äºå¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<h4 data-id="heading-27">å¯¼å‡ºå®¹å™¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¯¼å‡ºå®¹å™¨ä¸º tar æ–‡ä»¶</span>
docker export -o container.tar containerId
<span class="hljs-meta prompt_"># </span><span class="bash">æˆ–ä½¿ç”¨é‡å®šå‘</span>
docker export containerId &gt; container.tar
<span class="hljs-meta prompt_"># </span><span class="bash">å¯¼å‡ºå¹¶å‹ç¼©</span>
docker export containerId | gzip &gt; container.tar.gz
</code></pre>
<h4 data-id="heading-28">å¯¼å…¥å®¹å™¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä» tar æ–‡ä»¶å¯¼å…¥ä¸ºé•œåƒ</span>
docker import container.tar
<span class="hljs-meta prompt_"># </span><span class="bash">å¯¼å…¥å¹¶æŒ‡å®šåç§°å’Œæ ‡ç­¾</span>
docker import container.tar my-image:tag
<span class="hljs-meta prompt_"># </span><span class="bash">ä»å‹ç¼©æ–‡ä»¶å¯¼å…¥</span>
gunzip -c container.tar.gz | docker import - my-image:tag
</code></pre>
<h4 data-id="heading-29">ä½¿ç”¨åœºæ™¯</h4>
<ul>
<li>å¤‡ä»½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</li>
<li>è¿ç§»å®¹å™¨åˆ°å…¶ä»–ç¯å¢ƒ</li>
<li>åˆ›å»ºåŸºç¡€é•œåƒ</li>
</ul>
<h4 data-id="heading-30">æ³¨æ„äº‹é¡¹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">export</span>/import ä¸ save/load çš„åŒºåˆ«ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- <span class="hljs-built_in">export</span>: å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸åŒ…å«å†å²è®°å½•å’Œå…ƒæ•°æ®ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- save: å¯¼å‡ºé•œåƒï¼ˆåŒ…å«å®Œæ•´å†å²å’Œå…ƒæ•°æ®ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å¯¼å‡ºé•œåƒï¼ˆæ¨èç”¨äºé•œåƒè¿ç§»ï¼‰</span>
docker save -o image.tar image:tag
<span class="hljs-meta prompt_"># </span><span class="bash">å¯¼å…¥é•œåƒ</span>
docker load -i image.tar
</code></pre>
<h2 data-id="heading-31">8ï¼Œå®¹å™¨èµ„æºé™åˆ¶</h2>
<p>åˆç†è®¾ç½®èµ„æºé™åˆ¶å¯ä»¥é˜²æ­¢å®¹å™¨å ç”¨è¿‡å¤šç³»ç»Ÿèµ„æºã€‚</p>
<h4 data-id="heading-32">å†…å­˜é™åˆ¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è®¾ç½®å†…å­˜é™åˆ¶ä¸º 300MBï¼Œswap æ— é™åˆ¶ï¼Œå†…æ ¸å†…å­˜ 50MB</span>
docker run -m 300M --memory-swap -1 --kernel-memory 50M centos:latest /bin/bash
<span class="hljs-meta prompt_"># </span><span class="bash">å‚æ•°è¯´æ˜ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">-m, --memory: å®¹å™¨å†…å­˜é™åˆ¶</span>
<span class="hljs-meta prompt_"># </span><span class="bash">--memory-swap: swap é™åˆ¶ï¼ˆ-1 è¡¨ç¤ºæ— é™åˆ¶ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">--kernel-memory: å†…æ ¸å†…å­˜é™åˆ¶</span>
</code></pre>
<h4 data-id="heading-33">å†…å­˜é™åˆ¶ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶å†…å­˜ä¸º 512MBï¼Œswap ä¸º 1GB</span>
docker run -m 512M --memory-swap 1G nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶å†…å­˜ä¸º 1GBï¼Œä¸å…è®¸ä½¿ç”¨ swap</span>
docker run -m 1G --memory-swap 1G nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶å†…å­˜ä¸º 256MBï¼Œswap æ— é™åˆ¶</span>
docker run -m 256M --memory-swap -1 nginx:latest
</code></pre>
<h4 data-id="heading-34">CPU é™åˆ¶</h4>
<p>Docker æä¾›ä¸¤ç§ CPU é™åˆ¶æ–¹å¼ï¼š</p>
<h5 data-id="heading-35">æ–¹å¼Â 1ï¼šCPU æƒé‡ï¼ˆ--cpu-sharesï¼‰</h5>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è®¾ç½® CPU æƒé‡ï¼ˆå¯é€‰å€¼ 0-1024ï¼‰</span>
docker run -c 512 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">æ›´æ–°è¿è¡Œä¸­å®¹å™¨çš„ CPU æƒé‡</span>
docker update -c 1024 containerId
</code></pre>
<p><strong>æƒé‡è¯´æ˜ï¼š</strong></p>
<ul>
<li>é»˜è®¤æƒé‡ä¸º 1024</li>
<li>æƒé‡è¶Šé«˜ï¼Œåˆ†é…çš„ CPU æ—¶é—´è¶Šå¤š</li>
<li>åªåœ¨ CPU èµ„æºç´§å¼ æ—¶ç”Ÿæ•ˆ</li>
</ul>
<h5 data-id="heading-36">æ–¹å¼ 2ï¼šCPU æ•°é‡ï¼ˆ--cpusï¼‰</h5>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶å®¹å™¨ä½¿ç”¨ 1 ä¸ª CPU æ ¸å¿ƒ</span>
docker run --cpus=1 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶å®¹å™¨ä½¿ç”¨ 0.5 ä¸ª CPU æ ¸å¿ƒ</span>
docker run --cpus=0.5 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">æ›´æ–°è¿è¡Œä¸­å®¹å™¨çš„ CPU é™åˆ¶</span>
docker update --cpus=1 containerId
</code></pre>
<h4 data-id="heading-37">CPU é™åˆ¶ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶ä¸º 1 ä¸ª CPU æ ¸å¿ƒ</span>
docker run --cpus=1 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶ä¸º 2 ä¸ª CPU æ ¸å¿ƒ</span>
docker run --cpus=2 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">é™åˆ¶ä¸º 1.5 ä¸ª CPU æ ¸å¿ƒ</span>
docker run --cpus=1.5 nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">åŒæ—¶é™åˆ¶ CPU å’Œå†…å­˜</span>
docker run --cpus=1 -m 512M nginx:latest
</code></pre>
<h4 data-id="heading-38">ç»„åˆèµ„æºé™åˆ¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®Œæ•´çš„èµ„æºé™åˆ¶ç¤ºä¾‹</span>
docker run \
  --cpus=1 \
  -m 512M \
  --memory-swap 1G \
  --kernel-memory 128M \
  nginx:latest
</code></pre>
<h2 data-id="heading-39">9ï¼Œç£ç›˜å ç”¨æ£€æŸ¥</h2>
<p>å®šæœŸæ£€æŸ¥Â Docker ç£ç›˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶æ¸…ç†ã€‚</p>
<h4 data-id="heading-40">æŸ¥çœ‹ç£ç›˜ä½¿ç”¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨æƒ…å†µ</span>
docker system df
<span class="hljs-meta prompt_"># </span><span class="bash">è¾“å‡ºç¤ºä¾‹ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Images          5          3         2.5GB     1.2GB (48%)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Containers      10         2         500MB     400MB (80%)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Local Volumes   3          1         100MB     66.67MB (66%)</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Build Cache     0          0         0B        0B</span>
</code></pre>
<h4 data-id="heading-41">è¯¦ç»†æŸ¥çœ‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹é•œåƒå ç”¨</span>
docker system df -v
<span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹ç‰¹å®šç±»å‹çš„å ç”¨</span>
docker system df --type images
docker system df --type containers
docker system df --type volumes
</code></pre>
<h4 data-id="heading-42">æ¸…ç†å»ºè®®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ ¹æ®ç£ç›˜ä½¿ç”¨æƒ…å†µå†³å®šæ¸…ç†ç­–ç•¥</span>
docker system df
<span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœé•œåƒå ç”¨å¤§</span>
docker image prune -a
<span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœå®¹å™¨å ç”¨å¤§</span>
docker container prune
<span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœå·å ç”¨å¤§</span>
docker volume prune
</code></pre>
<h2 data-id="heading-43">Â 10ï¼Œå®¹å™¨é‡å‘½å</h2>
<p>é‡å‘½åå®¹å™¨å¯ä»¥æ›´å¥½åœ°ç®¡ç†å®¹å™¨ã€‚</p>
<h4 data-id="heading-44">é‡å‘½åå‘½ä»¤</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é‡å‘½åå®¹å™¨</span>
docker rename old_name new_name
<span class="hljs-meta prompt_"># </span><span class="bash">ç¤ºä¾‹</span>
docker rename my-old-container my-new-container
</code></pre>
<p>é‡å‘½åå®¹å™¨å¯ä»¥æ›´å¥½åœ°ç®¡ç†å®¹å™¨ã€‚</p>
<h4 data-id="heading-45">æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>æ–°åç§°å¿…é¡»å”¯ä¸€</li>
<li>é‡å‘½ååï¼Œå®¹å™¨ ID ä¸ä¼šæ”¹å˜</li>
</ul>
<h4 data-id="heading-46">å®ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é‡å‘½å</span>
docker rename old_name new_name
<span class="hljs-meta prompt_"># </span><span class="bash">å¯åŠ¨é‡å‘½ååçš„å®¹å™¨</span>
docker start new_name
</code></pre>
<h2 data-id="heading-47">11ï¼ŒDocker å‘½ä»¤ç»„åˆ</h2>
<p>ç†è§£ Docker å‘½ä»¤çš„ç»„åˆå…³ç³»æœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨ Dockerã€‚</p>
<h4 data-id="heading-48">docker run = docker create + docker start</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">docker run ç­‰ä»·äºä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤çš„ç»„åˆ</span>
docker create [OPTIONS] IMAGE [COMMAND] [ARG...]
docker start [OPTIONS] CONTAINER [CONTAINER...]
<span class="hljs-meta prompt_"># </span><span class="bash">ç¤ºä¾‹å¯¹æ¯”ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æ–¹å¼ 1ï¼šç›´æ¥è¿è¡Œ</span>
docker run -d --name myapp nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">æ–¹å¼ 2ï¼šåˆ†æ­¥æ‰§è¡Œ</span>
docker create -d --name myapp nginx:latest
docker start myapp
</code></pre>
<h4 data-id="heading-49">ä½¿ç”¨åœºæ™¯</h4>
<p>ä½¿ç”¨Â docker runï¼ˆæ¨èï¼‰ï¼š</p>
<ul>
<li>ä¸€æ¬¡æ€§åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</li>
<li>ç®€å•å¿«é€Ÿçš„åœºæ™¯</li>
</ul>
<p>ä½¿ç”¨Â docker create +Â docker startï¼š</p>
<ul>
<li>éœ€è¦å…ˆåˆ›å»ºå®¹å™¨ï¼Œç¨åå¯åŠ¨</li>
<li>éœ€è¦ä¿®æ”¹é…ç½®åå†å¯åŠ¨</li>
<li>æ‰¹é‡åˆ›å»ºå®¹å™¨</li>
</ul>
<h4 data-id="heading-50">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åˆ›å»ºå®¹å™¨ä½†ä¸å¯åŠ¨</span>
docker create --name myapp nginx:latest
<span class="hljs-meta prompt_"># </span><span class="bash">æ£€æŸ¥å®¹å™¨é…ç½®</span>
docker inspect myapp
<span class="hljs-meta prompt_"># </span><span class="bash">ä¿®æ”¹é…ç½®åå¯åŠ¨</span>
docker start myapp
<span class="hljs-meta prompt_"># </span><span class="bash">æˆ–è€…ç›´æ¥è¿è¡Œ</span>
docker run -d --name myapp nginx:latest
</code></pre>
<h2 data-id="heading-51">12ï¼ŒDocker æ„å»ºé«˜çº§é€‰é¡¹</h2>
<p>ä½¿ç”¨é«˜çº§é€‰é¡¹ä¼˜åŒ– Docker æ„å»ºè¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-52">å®Œæ•´æ„å»ºå‘½ä»¤ç¤ºä¾‹</h4>
<pre><code class="hljs language-shell" lang="shell">docker build \
  --pull \
  --ulimit nofile=200000:200000 \
  --ulimit nproc=65535:65535 \
  --rm \
  -t "registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85_openjdk8.222.10" \
  -f "/usr/local/src/docker/Dockerfile" \
  "/usr/local/src/docker"
</code></pre>
<h4 data-id="heading-53">å‚æ•°è¯´æ˜</h4>
<h5 data-id="heading-54">--pull</h5>
<p>ä½œç”¨ï¼šÂ ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„åŸºç¡€é•œåƒ</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ„å»ºå‰æ‹‰å–æœ€æ–°åŸºç¡€é•œåƒ</span>
docker build --pull -t myimage:tag .
</code></pre>
<h5 data-id="heading-55">--ulimit</h5>
<p>ä½œç”¨ï¼šÂ è®¾ç½®å®¹å™¨è¿è¡Œæ—¶çš„èµ„æºé™åˆ¶</p>
<p>æ ¼å¼ï¼šÂ --ulimit &lt;type&gt;=&lt;soft&gt;:&lt;hard&gt;</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è®¾ç½®æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</span>
--ulimit nofile=200000:200000
<span class="hljs-meta prompt_"># </span><span class="bash">è®¾ç½®è¿›ç¨‹æ•°é™åˆ¶</span>
--ulimit nproc=65535:65535
</code></pre>
<h5 data-id="heading-56">--rm</h5>
<p>ä½œç”¨ï¼šÂ è‡ªåŠ¨æ¸…ç†æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶å®¹å™¨</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ„å»ºæˆåŠŸååˆ é™¤ä¸­é—´å®¹å™¨</span>
docker build --rm -t myimage:tag .
</code></pre>
<h5 data-id="heading-57">-t, --tag</h5>
<p>ä½œç”¨ï¼šÂ ä¸ºæ„å»ºçš„é•œåƒæ‰“æ ‡ç­¾</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŒ‡å®šé•œåƒåç§°å’Œæ ‡ç­¾</span>
-t "registry.cn-beijing.aliyuncs.com/my_namespace/tomcat:8.5.85_openjdk8.222.10"
</code></pre>
<h5 data-id="heading-58">-f,Â --file</h5>
<p>ä½œç”¨ï¼šÂ ä½¿ç”¨éé»˜è®¤åç§°çš„ Dockerfile</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŒ‡å®š Dockerfile è·¯å¾„</span>
-f "/usr/local/src/cticloud-docker/Dockerfile"
</code></pre>
<h4 data-id="heading-59">å…¶ä»–å¸¸ç”¨æ„å»ºé€‰é¡¹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ„å»ºæ—¶ä¸ä½¿ç”¨ç¼“å­˜</span>
docker build --no-cache -t myimage:tag .
<span class="hljs-meta prompt_"># </span><span class="bash">æŒ‡å®šæ„å»ºå‚æ•°</span>
docker build --build-arg VERSION=1.0 -t myimage:tag .
<span class="hljs-meta prompt_"># </span><span class="bash">æŒ‡å®šç›®æ ‡å¹³å°</span>
docker build --platform linux/amd64 -t myimage:tag .
<span class="hljs-meta prompt_"># </span><span class="bash">æ˜¾ç¤ºæ„å»ºè¿‡ç¨‹</span>
docker build --progress=plain -t myimage:tag .
</code></pre>
<h2 data-id="heading-60">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†Â Docker çš„å¸¸ç”¨æŠ€å·§å’Œæ“ä½œï¼š</p>
<ol>
<li>ç”¨æˆ·æƒé™é…ç½®ï¼šå°†é root ç”¨æˆ·æ·»åŠ åˆ° docker ç»„</li>
<li>æ ¼å¼åŒ–è¾“å‡ºï¼šä½¿ç”¨ Go æ¨¡æ¿è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼</li>
<li>æ—¶é—´æ ¼å¼å’Œè¾“å‡ºæ§åˆ¶ï¼šæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯å’Œæ—¶é—´æˆ³</li>
<li>ID ç¼©å†™ï¼šä½¿ç”¨çŸ­ ID æé«˜æ“ä½œæ•ˆç‡</li>
<li>èµ„æºæ¸…ç†ï¼šå®šæœŸæ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨</li>
<li>é•œåƒå‘½åï¼šç†è§£ Registry å’Œ Repository çš„æ ¼å¼</li>
<li>å®¹å™¨å¿«ç…§ï¼šå¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿ</li>
<li>èµ„æºé™åˆ¶ï¼šåˆç†è®¾ç½®å†…å­˜å’Œ CPU é™åˆ¶</li>
<li>ç£ç›˜ç®¡ç†ï¼šæ£€æŸ¥å’Œç®¡ç† Docker ç£ç›˜å ç”¨</li>
<li>å®¹å™¨ç®¡ç†ï¼šé‡å‘½åå’Œç»„åˆä½¿ç”¨å‘½ä»¤</li>
<li>æ„å»ºä¼˜åŒ–ï¼šä½¿ç”¨é«˜çº§é€‰é¡¹ä¼˜åŒ–æ„å»ºè¿‡ç¨‹</li>
</ol>
<p>æŒæ¡è¿™äº›æŠ€å·§å¯ä»¥æå‡ Docker ä½¿ç”¨æ•ˆç‡ï¼Œæ›´å¥½åœ°ç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚</p>
<h2 data-id="heading-61">å¿«é€Ÿå‚è€ƒ</h2>
<h4 data-id="heading-62">å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ç”¨æˆ·æƒé™</span>
sudo usermod -aG docker $USER
<span class="hljs-meta prompt_"># </span><span class="bash">æ ¼å¼åŒ–è¾“å‡º</span>
docker ps --format "{{.Names}}\t{{.Status}}"
docker images --format "{{.Repository}}:{{.Tag}}"
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…ç†èµ„æº</span>
docker system prune -af
docker image prune -af
docker container prune -f
<span class="hljs-meta prompt_"># </span><span class="bash">èµ„æºé™åˆ¶</span>
docker run --cpus=1 -m 512M nginx:latest
docker update --cpus=2 containerId
<span class="hljs-meta prompt_"># </span><span class="bash">ç£ç›˜æ£€æŸ¥</span>
docker system df
<span class="hljs-meta prompt_"># </span><span class="bash">å®¹å™¨å¿«ç…§</span>
docker export -o container.tar containerId
docker import container.tar my-image:tag
</code></pre>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚éœ€è¡¥å……æˆ–ä¿®æ”¹ï¼Œè¯·å‘ŠçŸ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æˆ˜æŒ‡å—ï¼šUSearch ä¸ SPL æŸ¥è¯¢è¯­æ³•ï¼Œç©è½¬ Entity Explorer å®ä½“æ£€ç´¢]]></title>    <link>https://juejin.cn/post/7579555970595143721</link>    <guid>https://juejin.cn/post/7579555970595143721</guid>    <pubDate>2025-12-04T02:42:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579555970595143721" data-draft-id="7579436743260143635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æˆ˜æŒ‡å—ï¼šUSearch ä¸ SPL æŸ¥è¯¢è¯­æ³•ï¼Œç©è½¬ Entity Explorer å®ä½“æ£€ç´¢"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-04T02:42:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æˆ˜æŒ‡å—ï¼šUSearch ä¸ SPL æŸ¥è¯¢è¯­æ³•ï¼Œç©è½¬ Entity Explorer å®ä½“æ£€ç´¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:42:05.000Z" title="Thu Dec 04 2025 02:42:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šçµäº¦</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯å®ä½“æ¢ç´¢ï¼ˆEntity Explorerï¼‰</h2>
<h3 data-id="heading-1">1.1 å®ä½“æ¢ç´¢æ¦‚è¿°</h3>
<p>åœ¨å¯è§‚æµ‹æ€§é¢†åŸŸï¼Œå®ä½“ï¼ˆEntityï¼‰æŒ‡çš„æ˜¯ä»»ä½•å¯ä»¥è¢«ç‹¬ç«‹è¯†åˆ«å’Œç›‘æ§çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>åŸºç¡€è®¾æ–½å®ä½“ï¼š</strong> ä¸»æœºã€å®¹å™¨ã€ç½‘ç»œè®¾å¤‡ã€å­˜å‚¨ç³»ç»Ÿ</li>
<li><strong>åº”ç”¨å±‚å®ä½“ï¼š</strong> å¾®æœåŠ¡ã€API æ¥å£ã€æ•°æ®åº“å®ä¾‹ã€æ¶ˆæ¯é˜Ÿåˆ—</li>
<li><strong>ä¸šåŠ¡å®ä½“ï¼š</strong> ç”¨æˆ·ä¼šè¯ã€ä¸šåŠ¡æµç¨‹ã€äº¤æ˜“è®¢å•</li>
<li><strong>è¿ç»´å®ä½“ï¼š</strong> éƒ¨ç½²ç¯å¢ƒã€ä»£ç ä»“åº“ã€è¿ç»´äººå‘˜</li>
</ul>
<p>å®ä½“æŸ¥è¯¢çš„æ ¸å¿ƒä»·å€¼åœ¨äºæ‰“ç ´ä¼ ç»Ÿç›‘æ§ä¸­æŒ‰â€œäº§å“â€æˆ–â€œæŒ‡æ ‡â€åˆ’åˆ†çš„å­¤å²›å¼è§†å›¾ï¼Œæ„å»ºå…¨æ™¯åŒ–çš„å®ä½“èµ„äº§ç›®å½•ã€‚ç”¨æˆ·å¯ä»¥åœ¨å®ä½“æŸ¥è¯¢ä¸­å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ul>
<li>ç»Ÿä¸€ç›˜ç‚¹ï¼šæ¸…æ™°æŸ¥çœ‹ UModel ä¸­å®šä¹‰çš„æ‰€æœ‰å®ä½“ç±»å‹ï¼ˆEntity Typeï¼‰åŠå…·ä½“å®ä½“å®ä¾‹ï¼Œå¹¶æŒ‰åŸŸï¼ˆDomainï¼‰å’Œç±»å‹è¿›è¡Œåˆ†ç±»å±•ç¤ºã€‚</li>
<li>å¿«é€Ÿæ£€ç´¢ï¼šåˆ©ç”¨ USearch æŸ¥è¯¢è¯­è¨€ï¼Œæ”¯æŒå…¨æ–‡æ£€ç´¢ã€ç²¾ç¡®åŒ¹é…ã€æ¡ä»¶è¿‡æ»¤ç­‰å¤šç§æ–¹å¼ï¼Œå¿«é€Ÿå®šä½æ‰€éœ€å®ä½“ã€‚</li>
<li>å…³è”åˆ†æï¼šä»¥ä»»ä¸€å®ä½“ä¸ºèµ·ç‚¹ï¼Œæ¢ç´¢å…¶çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡ã€å…³è”æ—¥å¿—ã€é“¾è·¯è¿½è¸ªå’Œæ‹“æ‰‘å…³ç³»ï¼Œå®ç°ä¸€ç«™å¼é—®é¢˜è¯Šæ–­ä¸åˆ†æã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 å®ä½“æ¢ç´¢çš„éš¾åº¦</h3>
<p>è¦å®ç°é«˜æ•ˆã€ç²¾å‡†çš„å®ä½“æ¢ç´¢ï¼Œæ„å‘³ç€éœ€è¦åœ¨æµ·é‡ã€å¼‚æ„çš„æ•°æ®ä¸­å¿«é€Ÿå®šä½å¹¶åˆ†æç›®æ ‡ã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯æŒ‘æˆ˜ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d83d922021fa44b3824a2a36b4987282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=lGj37Y8BOUljwiyQNwF4aeCj2ss%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-3">1.2.1 æµ·é‡æ•°æ®çš„æ€§èƒ½æŒ‘æˆ˜</h4>
<p>å½“å®ä½“æ•°æ®è¾¾åˆ°äº¿çº§ç”šè‡³æ›´é«˜è§„æ¨¡æ—¶ï¼Œç®€å•çš„å¤„ç†æ–¹å¼ä¼šè¿…é€Ÿå¤±æ•ˆï¼Œå¸¦æ¥ä¸¥å³»çš„æ€§èƒ½ä¸æˆæœ¬é—®é¢˜ã€‚</p>
<p>è®¡ç®—å¤æ‚åº¦çš„çˆ†ç‚¸å¼å¢é•¿ï¼šç†è®ºä¸Šï¼Œä»»æ„ä¸¤ä¸ªå®ä½“è®°å½•éƒ½å¯èƒ½å­˜åœ¨å…³è”ã€‚è‹¥é‡‡ç”¨éå†åŒ¹é…çš„æ–¹å¼ï¼Œè®¡ç®—å¤æ‚åº¦å°†å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚åœ¨æµ·é‡æ•°æ®èƒŒæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ³•è€—æ—¶æé•¿ï¼Œå®Œå…¨ä¸å…·å¤‡å¯è¡Œæ€§ã€‚</p>
<p>å·¨å¤§çš„èµ„æºä¸æˆæœ¬å‹åŠ›ï¼šå¤§è§„æ¨¡æ•°æ®å¤„ç†ä¼šæ€¥å‰§æ¶ˆè€—ç®—åŠ›ã€å­˜å‚¨å’Œç½‘ç»œå¸¦å®½ã€‚ä»»ä½•å¾®å°çš„ç®—æ³•ä½æ•ˆéƒ½ä¼šè¢«æ•°æ®è§„æ¨¡æ— é™æ”¾å¤§ï¼Œç›´æ¥è½¬åŒ–ä¸ºæ˜¾è‘—çš„èµ„æºä¸æ—¶é—´æˆæœ¬ã€‚</p>
<p>ä¸¥è‹›çš„å®æ—¶æ€§è¦æ±‚ï¼šå®ä½“æ¢ç´¢å¹¶éä¸€æ¬¡æ€§ç¦»çº¿åˆ†æã€‚ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿå¯¹æŒç»­æ¶Œå…¥çš„æ–°æ•°æ®è¿›è¡Œå¢é‡å¤„ç†ä¸å®æ—¶æ›´æ–°ï¼Œå¦åˆ™æ¢ç´¢ç»“æœä¼šè¿…é€Ÿè¿‡æ—¶ï¼Œå¤±å»ä¸šåŠ¡ä»·å€¼ã€‚</p>
<h4 data-id="heading-4">1.2.2 æ•°æ®å¼‚æ„ä¸è¯­ä¹‰å¤šæ ·æ€§</h4>
<p>å®ä½“æ•°æ®å¾€å¾€æ¥æºäºå¤šä¸ªç³»ç»Ÿï¼Œæ ¼å¼ä¸ä¸€ã€è´¨é‡å‚å·®ä¸é½ï¼Œè¿™ç»™å®ä½“è¯†åˆ«ä¸å…³è”å¸¦æ¥äº†å·¨å¤§éšœç¢ã€‚</p>
<p>å®ä½“æè¿°ä¸ç»Ÿä¸€ï¼šåŒä¸€å®ä½“åœ¨ä¸åŒæ•°æ®æºä¸­å¯èƒ½å­˜åœ¨å¤šç§å†™æ³•ï¼Œå¦‚åˆ«åã€ç¼©å†™ã€è°éŸ³ã€æ‹¼å†™é”™è¯¯ã€ç¹ç®€ä½“å·®å¼‚ã€ä¸­è‹±æ–‡å¤¹æ‚ç­‰ï¼ˆä¾‹å¦‚ï¼Œâ€œIBMâ€ã€â€œI.B.M.â€ä¸â€œå›½é™…å•†ä¸šæœºå™¨â€æŒ‡å‘åŒä¸€å¯¹è±¡ï¼‰ï¼Œä¸¥é‡å¹²æ‰°äº†å®ä½“çš„å‡†ç¡®å®šä½ã€‚</p>
<p>ä¿¡æ¯ç¼ºå¤±ä¸è´¨é‡é—®é¢˜ï¼šå®ä½“ä¿¡æ¯å¸¸å¸¸å­˜åœ¨æ•°æ®â€œè„â€æˆ–ç¼ºå¤±çš„æƒ…å†µï¼Œä¾‹å¦‚å…³é”®å­—æ®µä¸ºç©ºã€åœ°å€ä¿¡æ¯ä¸å®Œæ•´ã€è”ç³»æ–¹å¼è¿‡æ—¶ã€æ—¶é—´æˆ³ä¸å‡†ç¡®ï¼Œç”šè‡³å­—æ®µå†…å®¹é”™å¡«ï¼ˆå¦‚å°†æ³•äººåå¡«å…¥å…¬å¸ååˆ—ï¼‰ï¼Œå¯¼è‡´æ— æ³•å»ºç«‹å¯ä¿¡çš„å®ä½“ç”»åƒã€‚</p>
<h4 data-id="heading-5">1.2.3 å‰ç«¯å‘ˆç°çš„å®šåˆ¶åŒ–ä¸é«˜è€¦åˆ</h4>
<p>å³ä½¿åç«¯æ•°æ®å¤„ç†å®Œæ¯•ï¼Œå¦‚ä½•å°†å…¶æœ‰æ•ˆå‘ˆç°ç»™ç”¨æˆ·ï¼Œä¹Ÿé¢ä¸´ç€æ¶æ„å±‚é¢çš„å›°å¢ƒï¼Œç›´æ¥å½±å“ç ”å‘æ•ˆç‡å’Œç³»ç»Ÿå¯ç»´æŠ¤æ€§ã€‚</p>
<p>UI å¼€å‘æˆæœ¬é«˜ï¼šç”±äºæ¯ç§å®ä½“éƒ½éœ€è¦ä¸€å¥—ç‹¬ç«‹çš„ UI å‘ˆç°æ–¹æ¡ˆï¼Œå¯¼è‡´å‰ç«¯å¼€å‘å­˜åœ¨å¤§é‡é‡å¤å·¥ä½œï¼Œä¸”éš¾ä»¥ç»Ÿä¸€è®¾è®¡é£æ ¼ä¸äº¤äº’ä½“éªŒã€‚</p>
<p>æ•°æ®é€»è¾‘åˆ†æ•£ï¼šæ•°æ®è·å–é€»è¾‘ä¸å®ä½“ç±»å‹ã€ID æ·±åº¦ç»‘å®šï¼Œæ•°æ®æ¥æºåˆ†æ•£ã€‚è¿™ä¸ä»…å¢åŠ äº†åç«¯æ¥å£èšåˆçš„å¤æ‚åº¦ï¼Œä¹Ÿä½¿å‰ç«¯éœ€è¦å¯¹æ¥å¤šä¸ªæ•°æ®æºï¼Œæ•°æ®ç®¡ç†å˜å¾—å¼‚å¸¸å›°éš¾ã€‚</p>
<p>é…ç½®å™©æ¢¦ä¸é«˜è€¦åˆï¼šå®ä½“é—´çš„å…³è”è·³è½¬é…ç½®æä¸ºå¤æ‚ï¼Œå¸¸å¸¸ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚è¿™ç§ç¡¬ç¼–ç å¼çš„å…³è”é€»è¾‘å¯¼è‡´ç³»ç»Ÿè€¦åˆåº¦æé«˜ï¼Œæ¯æ¬¡éœ€æ±‚å˜æ›´éƒ½ä¼´éšç€å·¨å¤§çš„å¼€å‘ã€æµ‹è¯•æˆæœ¬ä¸æ½œåœ¨é£é™©ã€‚</p>
<h3 data-id="heading-6">1.3 å®ä½“æ¢ç´¢å¹³å°çš„è§£å†³æ€è·¯</h3>
<p>ä¸ºè§£å†³å®ä½“æ¢ç´¢ä¸­æ•°æ®é‡å·¨å¤§ã€å†…å®¹æ··æ‚ã€UI å¼€å‘å¤æ‚è¿™ä¸‰å¤§æ ¸å¿ƒéš¾é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—ç”±å››å¤§æ”¯æŸ±æ„æˆçš„ç»¼åˆè§£å†³æ–¹æ¡ˆã€‚è¿™å¥—æ–¹æ¡ˆä»æŸ¥è¯¢å…¥å£ã€ä¸šåŠ¡èåˆã€å…³è”åˆ†æåˆ° UI å‘ˆç°ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´é—­ç¯ï¼Œæ—¨åœ¨å®ç°é«˜æ•ˆã€æ™ºèƒ½ã€ä½æˆæœ¬çš„å®ä½“å¯è§‚æµ‹æ€§ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aa48becd013485e910b5eb6b495b940~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=uY2rGvyD2qxExqDHLuHTKq2de2U%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-7">1.3.1 ç»Ÿä¸€æŸ¥è¯¢å…¥å£ï¼šåŸºäº USearch çš„å…¨å±€æ£€ç´¢ç»„ä»¶</h4>
<p>æ‰“é€ ä¸€ä¸ªç±»ä¼¼æœç´¢å¼•æ“çš„ã€åŠŸèƒ½å¼ºå¤§çš„ç»Ÿä¸€æŸ¥è¯¢å…¥å£ã€‚ç”¨æˆ·æ— éœ€å…³å¿ƒåº•å±‚æ•°æ®çš„å­˜å‚¨ä½ç½®å’Œå¼‚æ„æ€§ï¼Œåªéœ€é€šè¿‡ç®€å•ã€è‡ªç„¶çš„è¯­è¨€å³å¯å®Œæˆå¯¹æµ·é‡å®ä½“çš„ç²¾å‡†å®šä½å’Œå¿«é€Ÿæ£€ç´¢ã€‚</p>
<ul>
<li>å±è”½åº•å±‚å¤æ‚æ€§ï¼šè¯¥ç»„ä»¶ä½œä¸ºå”¯ä¸€çš„æ•°æ®æŸ¥è¯¢ç»„ä»¶ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯­å¥ï¼ˆåŸºäº USearch è¯­è¨€ï¼‰è§£æå¹¶åˆ†å‘åˆ°ä¸åŒçš„åç«¯æ•°æ®æºï¼ˆå¦‚æ—¥å¿—åº“ã€æŒ‡æ ‡åº“ã€CMDB ç­‰ï¼‰ã€‚å®ƒå°†å¼‚æ„æ•°æ®æºçš„æŸ¥è¯¢ç»“æœè¿›è¡Œèšåˆã€æ¸…æ´—å’Œæ ¼å¼åŒ–ï¼Œæœ€ç»ˆä»¥ç»Ÿä¸€çš„å®ä½“æ¨¡å‹è¿”å›ç»™ä¸Šå±‚åº”ç”¨ã€‚</li>
<li>é«˜æ€§èƒ½æŸ¥è¯¢å¼•æ“ï¼šä¾æ‰˜ USearch åº•å±‚ä¼˜åŒ–çš„ç´¢å¼•å’Œåˆ†å¸ƒå¼è®¡ç®—èƒ½åŠ›ï¼Œå³ä½¿åœ¨ç™¾äº¿çº§çš„æ•°æ®è§„æ¨¡ä¸‹ï¼Œä¹Ÿèƒ½å®ç°ç§’çº§çš„æŸ¥è¯¢å“åº”ã€‚è¿™ç›´æ¥è§£å†³äº†â€œé‡å¤ªå¤§â€å¸¦æ¥çš„æ€§èƒ½ç“¶é¢ˆå’Œå®æ—¶æ€§å‹åŠ›ã€‚</li>
</ul>
<h4 data-id="heading-8">1.3.2 åœºæ™¯é©±åŠ¨ï¼šå®ä½“ä¸ä¸šåŠ¡èåˆçš„åº”ç”¨ï¼ˆAPPï¼‰</h4>
<p>æ‰“ç ´â€œæ•°æ®å­¤å²›â€ï¼Œå°†æŠ€æœ¯å®ä½“ä¸å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ·±åº¦èåˆã€‚æˆ‘ä»¬æä¾›çš„ä¸æ˜¯ä¸€ä¸ªå†°å†·çš„å®ä½“åˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ªé¢å‘ä¸šåŠ¡é—®é¢˜ã€é¢„è®¾äº†åˆ†æè·¯å¾„çš„â€œåº”ç”¨â€ï¼ˆAPPï¼‰ï¼Œè®©æŠ€æœ¯ç›‘æ§æ•°æ®ç›´æ¥æœåŠ¡äºä¸šåŠ¡ä»·å€¼ã€‚</p>
<p>ä¸Šä¸‹æ–‡èšåˆï¼šä¸ºç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚â€œæ•°æ®åº“ç›‘æ§â€ã€â€œåº”ç”¨ç›‘æ§â€ï¼‰åˆ›å»ºä¸€ä¸ªèåˆè§†å›¾ã€‚è¿™ä¸ªè§†å›¾ä¼šè‡ªåŠ¨èšåˆä¸è¯¥åœºæ™¯ç›¸å…³çš„æ‰€æœ‰å®ä½“ä¸é¡µé¢ï¼Œæä¾›ä¸“ä¸šè§†è§’ã€‚</p>
<p>ä¿¡æ¯è¡¥å…¨ä¸ä¸°å¯Œï¼šé€šè¿‡è·¨æ•°æ®æºå…³è”ï¼Œè‡ªåŠ¨è¡¥å…¨å®ä½“ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ IP åœ°å€å…³è”åˆ°ä¸»æœºå®ä½“ï¼Œå†é€šè¿‡ä¸»æœºå®ä½“å…³è”åˆ°å…¶ä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œæœ€ç»ˆå…³è”åˆ°æœåŠ¡çš„è´Ÿè´£äººã€‚è¿™æœ‰æ•ˆè§£å†³äº†â€œä¿¡æ¯ç¼ºå¤±å’Œè„â€çš„é—®é¢˜ï¼Œè®©æ¯ä¸ªå®ä½“éƒ½æ‹¥æœ‰æ›´ä¸°æ»¡çš„ä¸Šä¸‹æ–‡ã€‚</p>
<h4 data-id="heading-9">1.3.3 å¯è§†åŒ–æ¢ç´¢ï¼šå®ä½“æ‹“æ‰‘ä¸å…³è”åˆ†æç»„ä»¶</h4>
<p>å°†å®ä½“é—´é”™ç»¼å¤æ‚çš„å…³ç³»é€šè¿‡ç½‘ç»œæ‹“æ‰‘å›¾çš„å½¢å¼ç›´è§‚åœ°å‘ˆç°å‡ºæ¥ã€‚ç”¨æˆ·å¯ä»¥åƒæ¢ç´¢åœ°å›¾ä¸€æ ·ï¼Œä»¥ä»»æ„å®ä½“ä¸ºä¸­å¿ƒï¼Œäº¤äº’å¼åœ°å‘ç°å…¶ä¸Šä¸‹æ¸¸ä¾èµ–ã€å½±å“èŒƒå›´å’Œæ½œåœ¨å…³è”ï¼Œå°†â€œçœ‹ä¸è§â€çš„å…³ç³»å˜ä¸ºâ€œçœ‹å¾—è§â€çš„æ´å¯Ÿã€‚</p>
<ul>
<li>åŠ¨æ€å…³ç³»å‘ç°ï¼šè¯¥ç»„ä»¶ä¸ä¾èµ–äºç¡¬ç¼–ç çš„é…ç½®ï¼Œè€Œæ˜¯é€šè¿‡åå°æœåŠ¡å®æ—¶è®¡ç®—å’Œå‘ç°å®ä½“é—´çš„å…³è”å…³ç³»ï¼ˆä¾‹å¦‚ï¼ŒæœåŠ¡è°ƒç”¨ã€ä¸»æœºéƒ¨ç½²ã€ç½‘ç»œè®¿é—®ç­‰ï¼‰ã€‚</li>
<li>äº¤äº’å¼æ¢ç´¢ï¼šç”¨æˆ·å¯ä»¥åœ¨æ‹“æ‰‘å›¾ä¸Šè‡ªç”±ç¼©æ”¾ã€æ‹–æ‹½ã€ä¸‹é’»ã€‚ç‚¹å‡»ä»»ä¸€å®ä½“èŠ‚ç‚¹ï¼Œå³å¯æŸ¥çœ‹å…¶è¯¦ç»†ä¿¡æ¯ã€æ€§èƒ½æŒ‡æ ‡ã€å‘Šè­¦å’Œæ—¥å¿—ï¼Œå¹¶å¯ä¸€é”®å±•å¼€å…¶é‚»è¿‘èŠ‚ç‚¹ï¼Œå®ç°â€œä¸€ç«™å¼â€çš„å…³è”åˆ†æã€‚</li>
<li>å½±å“åŸŸå’Œæ ¹å› åˆ†æï¼šå½“æŸä¸ªå®ä½“å‡ºç°æ•…éšœæ—¶ï¼Œæ‹“æ‰‘å›¾èƒ½æ¸…æ™°åœ°å±•ç¤ºå…¶ä¸Šæ¸¸ä¾èµ–ï¼ˆå¸®åŠ©å®šä½æ ¹å› ï¼‰å’Œä¸‹æ¸¸å½±å“ï¼ˆå¸®åŠ©è¯„ä¼°æ•…éšœèŒƒå›´ï¼‰ï¼Œä¸ºå¿«é€Ÿå†³ç­–æä¾›å…³é”®ä¾æ®ã€‚</li>
</ul>
<h4 data-id="heading-10">1.3.4 å»ºæ¨¡é©±åŠ¨ UIï¼šåŸºäºå®ä½“æ¨¡å‹çš„è‡ªåŠ¨åŒ–æ¸²æŸ“å¼•æ“</h4>
<p>é¢ è¦†ä¼ ç»Ÿçš„ UI å¼€å‘æ¨¡å¼ï¼Œå®ç° UI çš„è‡ªåŠ¨åŒ–ç”Ÿæˆã€‚æˆ‘ä»¬ä¸ä¸ºæ¯ä¸€ç§å®ä½“ç±»å‹å®šåˆ¶å¼€å‘ UIï¼Œè€Œæ˜¯é€šè¿‡å®šä¹‰ä¸€å¥—ä¸°å¯Œçš„å®ä½“æ¨¡å‹ï¼ˆSchemaï¼‰ï¼Œç”±ä¸€ä¸ªç»Ÿä¸€çš„æ¸²æŸ“å¼•æ“æ ¹æ®æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å±•ç¤ºç•Œé¢ã€‚</p>
<ul>
<li>å®šä¹‰å³ UIï¼ˆSchema as UIï¼‰ï¼šåœ¨ UModel ä¸­ä¸ºæ¯ç§å®ä½“ç±»å‹å®šä¹‰å…¶å…ƒæ•°æ®æ¨¡å‹ã€‚è¯¥æ¨¡å‹ä¸ä»…åŒ…å«å­—æ®µåå’Œç±»å‹ï¼Œè¿˜åŒ…å«ä¸°å¯Œçš„ UI æŒ‡ä»¤ï¼Œå¦‚â€œæ­¤å­—æ®µåº”å±•ç¤ºä¸ºå›¾è¡¨â€ã€â€œæ­¤å­—æ®µæ˜¯ä¸€ä¸ªé“¾æ¥ï¼ŒæŒ‡å‘å¦ä¸€å®ä½“â€ã€â€œæ­¤å­—æ®µæŒ‰æ—¶é—´æ ¼å¼åŒ–â€ç­‰ã€‚</li>
<li>ç»Ÿä¸€æ¸²æŸ“å¼•æ“ï¼šå¼€å‘ä¸€ä¸ªé€šç”¨çš„å‰ç«¯ç»„ä»¶ï¼Œå®ƒèƒ½æ¥æ”¶ä»»ä½•å®ä½“çš„æ•°æ®å’Œå…¶å¯¹åº”çš„æ¨¡å‹ã€‚è¯¥ç»„ä»¶ä¼šè§£ææ¨¡å‹ä¸­çš„ UI æŒ‡ä»¤ï¼Œå¹¶åŠ¨æ€åœ°æ¸²æŸ“å‡ºç›¸åº”çš„ UI å…ƒç´ ï¼ˆè¯¦æƒ…é¡µã€åˆ—è¡¨ã€è¡¨å•ç­‰ï¼‰ã€‚</li>
<li>ä½ä»£ç ä¸å¯æ‰©å±•ï¼šæ–°å¢ä¸€ç§å®ä½“ç±»å‹ï¼Œå‰ç«¯å¼€å‘å·¥ä½œé‡å‡ ä¹ä¸ºé›¶ï¼Œåªéœ€åœ¨ UModel ä¸­å®šä¹‰å¥½å…¶æ¨¡å‹å³å¯ã€‚åŒæ—¶ï¼Œæ¸²æŸ“å¼•æ“æ”¯æŒæ’ä»¶åŒ–æ‰©å±•ï¼Œå¯ä»¥ä¸æ–­ä¸°å¯Œå…¶æ”¯æŒçš„ UI ç»„ä»¶ç±»å‹ã€‚</li>
</ul>
<h2 data-id="heading-11">å®ä½“æ¢ç´¢æ ¸å¿ƒåŠŸèƒ½ï¼šåŸºäº USearch çš„å…¨å±€æ£€ç´¢ç»„ä»¶</h2>
<h3 data-id="heading-12">2.1 å®ä½“æ€»è§ˆ</h3>
<p>å®ä½“æ¢ç´¢å°† UModel ä¸­å®šä¹‰çš„æ‰€æœ‰å®ä½“æŒ‰ç…§åŸŸï¼ˆDomainï¼‰å’Œç±»å‹ï¼ˆEntity Typeï¼‰ï¼Œå·²ç»æ¥å…¥çš„å®ä½“éƒ½ä¼šåˆ†ç±»åœ¨æ‰€å±çš„åˆ†ç±»ä¸­ã€‚</p>
<ol>
<li>æ”¯æŒæŸ¥çœ‹æ‰€æœ‰å®ä½“çš„æ€»é‡ã€‚</li>
<li>æ”¯æŒæŸ¥çœ‹æ¯ä¸ªå®ä½“çš„å®ä¾‹æ•°é‡ã€‚</li>
<li>å¦‚æœæ˜¯äº‘äº§å“å®ä½“ï¼Œæ”¯æŒæŸ¥çœ‹è¯¥äº‘äº§å“ä¸‹æ‰€æœ‰å®ä½“æ˜¯å¦å…¨é‡æ¥å…¥ã€‚</li>
<li>å•å‡»å®ä½“åé€‰ä¸­è¯¥å®ä½“çš„åŸŸï¼ˆDomainï¼‰å’Œç±»å‹ï¼ˆEntity Typeï¼‰ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/837e1b0272a44977bb7b5671c6b852aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=J7sOHdlIJPQpLtMvUhgD1Y6yRxk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-13">2.2 å®ä½“æŸ¥è¯¢ä¸å±•ç¤º</h3>
<p>æŸ¥è¯¢è¯­è¨€ä»‹ç»å®ä½“æŸ¥è¯¢æ”¯æŒä¸¤ç§æŸ¥è¯¢è¯­è¨€ï¼šUSearch å’Œ SPLï¼Œåœ¨å®ä½“æŸ¥è¯¢é¡µé¢å·¦ä¸Šè§’å¯ä»¥åˆ‡æ¢è¯­è¨€ã€‚ è¯·å‚è€ƒÂ USearch å®ä½“æŸ¥è¯¢è¯­è¨€ <strong>[</strong> <strong>1]</strong> å’ŒÂ SPL æ•°æ®å¤„ç†è¯­è¨€ <strong>[</strong> <strong>2]</strong> ã€‚</p>
<p>åœ¨ USearch æ¨¡å¼ä¸‹ï¼Œå®ä½“æŸ¥è¯¢å·¦ä¸Šè§’å¯ä»¥é€‰æ‹©åŸŸï¼ˆDomainï¼‰å’Œç±»å‹ï¼ˆEntity Typeï¼‰ï¼ŒSPL æ¨¡å¼ä¸æ”¯æŒã€‚</p>
<p>USearch æŸ¥è¯¢ç»“æœä¼šæ ¹æ®å®ä½“çš„ç±»å‹ï¼ˆEntity Typeï¼‰è¿›è¡Œå±•ç¤ºï¼ŒåŒ…æ‹¬å®ä½“çš„ Primary Key å’Œ Name å­—æ®µï¼Œä»¥åŠå®ä½“çš„é»„é‡‘æŒ‡æ ‡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c7512ee46c542849e26b543dd004853~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=TS1xPjwMW55Km8d38JZ0cY8EXoI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>SPL æŸ¥è¯¢ç»“æœä¸ä¼šæŒ‰ç…§å®ä½“çš„ç±»å‹ï¼ˆEntity Typeï¼‰è¿›è¡Œå±•ç¤ºï¼Œè€Œæ˜¯å±•ç¤ºå…·ä½“å­—æ®µã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff5f02e4ef240d89660fc3550b0511d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=6psp3w%2FGbRoPq9buPBpFGjj%2BH28%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-14">2.3 æ‹“æ‰‘æ¦‚è§ˆè§†å›¾</h3>
<p>æ¦‚è§ˆæ‹“æ‰‘å°†æŠ½è±¡çš„ç³»ç»Ÿæ¶æ„è½¬åŒ–ä¸ºå¯è§†åŒ–çš„æ•°å­—æ¨¡å‹ï¼Œå±•ç¤ºäº‘ç¯å¢ƒä¸‹å·²æ¥å…¥çš„æ‰€æœ‰å®ä½“ç±»åˆ«ã€æ¥å…¥æ•°é‡ä»¥åŠå„ç±»å®ä½“çš„ä¾èµ–å…³ç³»ï¼Œé€šè¿‡å…¨å±€æ¶æ„è§†å›¾æ”¯æŒæœåŠ¡æ²»ç†ä¸ä¾èµ–ç®¡ç†ï¼Œä¸ºè¿ç»´å’Œå¼€å‘å›¢é˜Ÿæä¾›äº†ç›´è§‚ç†è§£ç³»ç»Ÿæ¶æ„çš„æœ‰æ•ˆæ‰‹æ®µã€‚</p>
<h4 data-id="heading-15">2.3.1 æ‹“æ‰‘æ¦‚è§ˆä¸»é¡µ</h4>
<p>åœ¨â€˜æ‰€æœ‰å®ä½“â€™çš„å³ä¸Šè§’ç‚¹å‡»â€˜æ‹“æ‰‘â€™ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰ Workspace æ¥å…¥çš„å„ç±»å®ä½“çš„æ€»é‡ä»¥åŠä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c010c3f3614f8c9449454d3f141a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=zgRQIhJV0AARo%2FCNiekqiG0CICM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-16">2.3.2 é“¾è·¯èšç„¦äº¤äº’</h4>
<p>èŠ‚ç‚¹æ”¯æŒâ€˜èšç„¦â€™æ“ä½œï¼Œç‚¹å‡»èšç„¦åï¼Œæ‹“æ‰‘å›¾ä»…ä¿ç•™ä»¥å½“å‰èŠ‚ç‚¹ä¸ºä¸­å¿ƒçš„æ‰€æœ‰ç¥–å…ˆå’Œåä»£èŠ‚ç‚¹ï¼Œæ›´æ¸…æ™°åœ°å±•ç¤ºä¾èµ–å…³ç³»å’Œä¼ æ’­é“¾è·¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f376f7d66804117ac33d3ecf48ea851~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=wrc2S3%2BU%2FlVYYD1Zd6hWgOtaLHI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨èšç„¦çŠ¶æ€ä¸‹ï¼Œå¯é€šè¿‡å·¥å…·æ çš„â€˜å–æ¶ˆèšç„¦â€™å›åˆ°åŸå§‹æ‹“æ‰‘å›¾ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4de5c165b4bd41cfb7404990b1abe602~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=ThZmQmkf6VOVDA70xbQOg5EwPCU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-17">2.3.3 å®ä½“åˆ—è¡¨å±•ç¤º</h4>
<p>å•å‡»å®ä½“ï¼Œå³ä¾§å¼¹å‡ºå½“å‰å®ä½“ç±»å‹ä¸‹æ‰€æœ‰å·²æ¥å…¥çš„å®ä½“åˆ—è¡¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d6b75a8336342dbb7777fad0a7176fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=LqgZak%2Bg5LIqZsLl2Os3dssNfuU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-18">2.3.4 æ‹“æ‰‘æœç´¢</h4>
<p>æ”¯æŒä¸ USearch æŸ¥è¯¢è”åŠ¨ï¼Œå±•ç¤ºæ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„å®ä½“çš„æ‹“æ‰‘å…³è”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b260489bfb048abb2a0159eb41349f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=uN5ZIwqS5hYpsxbGD%2FdmU5ockBo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ USearch æŸ¥è¯¢æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»èŠ‚ç‚¹ä¼šå±•ç¤ºå½“å‰æŸ¥è¯¢åˆ°çš„æ‰€æœ‰ç»“æœçš„åˆ—è¡¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39b86fa5eecb4de2bf4e6ca1c7c98a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=LqOl8B384HMGRvcS%2FG0DtQM9mfg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-19">å®ä½“æ¢ç´¢æ ¸å¿ƒåŠŸèƒ½ï¼šå®ä½“è¯¦æƒ…</h2>
<p>å®ä½“è¯¦æƒ…é¡µæ˜¯æˆ‘ä»¬æ•´ä¸ªå®ä½“æ¢ç´¢ä½“ç³»çš„â€œä»·å€¼äº¤ä»˜çª—å£â€ã€‚å®ƒå¹¶éä¸€ä¸ªé™æ€ã€ç”±å‰ç«¯å·¥ç¨‹å¸ˆé€è¡Œä»£ç å†™æ­»çš„ç•Œé¢ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œå…¨ç”±åç«¯ UModel åŠ¨æ€æ¸²æŸ“ã€è‡ªåŠ¨æ„å»ºçš„æ™ºèƒ½è§†å›¾ã€‚è¿™ç§æ¨¡å¼ä»æ ¹æœ¬ä¸Šè§£å†³äº†å‰é¢æåˆ°çš„ä¸‰å¤§æŒ‘æˆ˜ã€‚</p>
<h3 data-id="heading-20">3.1 å®ä½“æ¦‚è§ˆ</h3>
<p>å®ä½“æ¦‚è§ˆåŒ…å«ä¸€ç»„åŠ¨æ€æ¸²æŸ“çš„ Tabs é¡µé¢ + å…³è”æ‹“æ‰‘ã€UModel Explorer ç­‰è‹¥å¹²å›ºå®šçš„é¡µé¢æ„æˆã€‚å…¶ä¸­åŠ¨æ€çš„ Tabs é¡µé¢å®Œå…¨åŸºäº UModel æ¸²æŸ“ï¼šè‡ªåŠ¨æ¸²æŸ“é€»è¾‘åŒ…å«å¯è§†åŒ–é€‰æ‹©ï¼ˆæ ¹æ®å®ä½“ä¿¡æ¯åŒ¹é…ä»ªè¡¨ç›˜ã€é¡µé¢æ¨¡æ¿ï¼‰ã€æ•°æ®æºé€‰æ‹©ï¼ˆæ ¹æ®å®ä½“ä¿¡æ¯åŒ¹é…é€‰æ‹©çš„é¡µé¢ä½¿ç”¨ä»€ä¹ˆæ•°æ®æºè¿›è¡Œæ¸²æŸ“ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaf312be4f144310859aa1cc6f217e70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=ycGGVYav%2FJuBxGvuTKR8QkusN88%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å…³è”å®ä½“ï¼šå®ä½“æ¦‚è§ˆé¦–é¡µç‚¹å‡»å…³è”å®ä½“å¯ä»¥å¿«æ·æŸ¥çœ‹è¯¥å®ä½“å’Œå…¶ä»–å®ä½“çš„å…³è”å…³ç³»è¡¨æ ¼ï¼Œè¡¨æ ¼æ ¹æ®å…³ç³»çš„åç§°åˆ†ç±»ï¼Œå…³ç³»æœ‰ï¼šåŒ…å«ã€ç­‰åŒã€ä¸Šæ¸¸ã€ä¸‹æ¸¸ç­‰ã€‚ç‚¹å‡»å…³è”å®ä½“ï¼Œå¯ä»¥è·³è½¬åˆ°å¯¹åº”å®ä½“çš„å®ä½“æ¦‚è§ˆã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8364059bd98a4d8dadf851be9d23a15f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=fZyuZqN4sDy%2FQhz3gWzfKnha6qc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-21">3.2 å…³è”æ‹“æ‰‘</h3>
<h4 data-id="heading-22">3.2.1 æ™ºèƒ½åˆ†å±‚æ¶æ„è§†å›¾</h4>
<p>é‡‡ç”¨æ™ºèƒ½åˆ†å±‚å¸ƒå±€ï¼Œå°†å¤æ‚çš„äº‘ç¯å¢ƒæŒ‰ç…§åŸŸï¼ˆDomainï¼‰è¿›è¡Œå‚ç›´åˆ†å±‚ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c99bb05c430c494096e56dc9f888a5e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=uA2WXR19C%2F2c4YZ9oGj%2FSlz3epU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åˆ†å±‚æ¶æ„ï¼š</p>
<ul>
<li>ğŸŒÂ RUM å±‚ï¼šç”¨æˆ·ä½“éªŒç›‘æ§åŸŸï¼Œå…³æ³¨å‰ç«¯æ€§èƒ½å’Œç”¨æˆ·è¡Œä¸º</li>
<li>ğŸ”§Â APM å±‚ï¼šåº”ç”¨ç›‘æ§åŸŸï¼Œç›‘æ§åº”ç”¨æœåŠ¡æ€§èƒ½</li>
<li>â˜¸ï¸Â K8S å±‚ï¼šå®¹å™¨ç¼–æ’åŸŸï¼Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨</li>
<li>â˜ï¸Â ACS å±‚ï¼šäº‘äº§å“åŸŸï¼Œé›†æˆå„ç±»äº‘æœåŠ¡</li>
<li>ğŸ–¥ï¸Â INFRA å±‚ï¼šåŸºç¡€è®¾æ–½åŸŸï¼Œç›‘æ§æœåŠ¡å™¨å’Œç½‘ç»œ</li>
</ul>
<h4 data-id="heading-23">3.2.2 å¤šå±‚çº§ä¾èµ–é€å±‚å±•å¼€</h4>
<p>é€šè¿‡"å±•å¼€ä¸‹ä¸€çº§"åŠŸèƒ½ï¼Œå¯ä»¥é€å±‚æ¢ç´¢æœåŠ¡ä¾èµ–å…³ç³»ï¼Œé€‚ç”¨äºå¤æ‚ç³»ç»Ÿçš„æ¸è¿›å¼åˆ†æï¼›é€šè¿‡å¤šå±‚çº§ä¾èµ–åˆ†æï¼Œå…¨é¢è¯„ä¼°ç³»ç»Ÿä¾èµ–æƒ…å†µï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5432351fba124f9093942103d8d2b852~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=PXso5q8Og5I2LChFG%2FjTCb2QR68%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>ğŸ”Â é€å±‚åˆ†æï¼šä»æ ¸å¿ƒæœåŠ¡å¼€å§‹ï¼Œé€æ­¥å±•å¼€ç›¸å…³ä¾èµ–</li>
<li>ğŸ“ŠÂ æ€§èƒ½è¯Šæ–­ï¼šç»“åˆæŒ‡æ ‡æ•°æ®ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆç‚¹</li>
<li>ğŸ› ï¸Â æ¶æ„æ¢³ç†ï¼šç†æ¸…å¤æ‚ç³»ç»Ÿçš„çœŸå®ä¾èµ–å…³ç³»</li>
</ul>
<h4 data-id="heading-24">3.2.3 èšç„¦è¿½è¸ªæ¨¡å¼</h4>
<p>æ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ul>
<li>ğŸ¯Â æ™ºèƒ½èšç„¦ï¼šä»¥ç›®æ ‡èŠ‚ç‚¹ä¸ºä¸­å¿ƒï¼Œå±•ç¤ºç›´æ¥å…³è”çš„ä¸Šä¸‹æ¸¸</li>
<li>ğŸ”„Â åŠ¨æ€è¿½è¸ªï¼šæ¯æ¬¡å±•å¼€æ“ä½œä¼šè‡ªåŠ¨åˆ‡æ¢èšç„¦ä¸­å¿ƒ</li>
<li>ğŸ’¡Â ä¸Šä¸‹æ–‡ä¿æŒï¼šå–æ¶ˆèšç„¦æ—¶è‡ªåŠ¨ä¿å­˜å·²å±•å¼€çš„èŠ‚ç‚¹çŠ¶æ€</li>
</ul>
<h4 data-id="heading-25">3.2.4 å¤§è§„æ¨¡æœåŠ¡ä¾èµ–åˆ†æ</h4>
<p>é¢å¯¹åŒ…å«æ•°ç™¾ä¸ªå¾®æœåŠ¡çš„å¤æ‚ç³»ç»Ÿï¼Œé€šè¿‡æ™ºèƒ½åˆ†ç»„å’Œæ¸è¿›å¼åˆ†æï¼Œå®ç°ä¾èµ–å…³ç³»çš„æœ‰åºåˆ†æï¼š</p>
<p>æ™ºèƒ½å±•å¼€ç­–ç•¥ï¼šå½“å±•å¼€æ“ä½œäº§ç”Ÿå¤§é‡èŠ‚ç‚¹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œç¡®ä¿ç•Œé¢æ¸…æ™°å¯è¯»ã€‚è¶…è¿‡ 20 ä¸ªèŠ‚ç‚¹çš„ç»„ä¼šè¢«æ™ºèƒ½æ”¶çº³ï¼Œé€šè¿‡æ‹†åˆ†é¢æ¿è¿›è¡Œç²¾ç¡®ç®¡ç†ã€‚</p>
<h2 data-id="heading-26">USearch &amp; SPL å®ä½“æŸ¥è¯¢è¯­è¨€</h2>
<h3 data-id="heading-27">4.1 USearch</h3>
<p>USearch æ˜¯ä¸“é—¨ç”¨äºå®ä½“æŸ¥è¯¢çš„ SPL è¯­æ³•ï¼Œæ”¯æŒå¤šç§æŸ¥è¯¢æ¨¡å¼ï¼ŒåŒ…æ‹¬å…¨æ–‡æ£€ç´¢ã€ç²¾ç¡®æŸ¥æ‰¾ã€æ¡ä»¶è¿‡æ»¤ç­‰ã€‚USearch æ·±åº¦é›†æˆåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fcms%3Fspm%3Da1z389.11499242.0.0.65452413vvcY0e%26utm_content%3Dg_1000408141" target="_blank" title="https://www.aliyun.com/product/cms?spm=a1z389.11499242.0.0.65452413vvcY0e&amp;utm_content=g_1000408141" ref="nofollow noopener noreferrer">äº‘ç›‘æ§ 2.0</a> ä¸­ï¼Œæä¾›å…¨å±€å¿«é€ŸæŸ¥è¯¢ã€å­—æ®µå¿«æ·ä¸‹é’»ã€æŒ‡æ ‡ä¸‹é’»ç­‰åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-28">4.1.1 USearch åŸºç¡€è¯­æ³•</h4>
<pre><code class="hljs language-ini" lang="ini">.entityÂ with(
Â  Â  <span class="hljs-attr">domain</span>=<span class="hljs-string">'domain_pattern'</span>, Â  Â Â -- åŸŸè¿‡æ»¤
Â  Â  <span class="hljs-attr">type</span>=<span class="hljs-string">'type_pattern'</span>, Â  Â  Â  Â Â -- ç±»å‹è¿‡æ»¤
Â  Â  <span class="hljs-attr">query</span>=<span class="hljs-string">'search_query'</span>, Â  Â  Â  Â -- æŸ¥è¯¢æ¡ä»¶
Â  Â  <span class="hljs-attr">topk</span>=<span class="hljs-number">10</span>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â -- æœ€å¤§è¿”å›æ¡æ•°
)
</code></pre>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong></p>
<ul>
<li>å…¨æ–‡æœç´¢ï¼šæ”¯æŒè·¨æ‰€æœ‰å­—æ®µçš„å…³é”®è¯æœç´¢ã€‚</li>
<li>å­—æ®µé™å®šæŸ¥è¯¢ï¼šæ”¯æŒåœ¨ç‰¹å®šå­—æ®µä¸­è¿›è¡Œç²¾ç¡®æœç´¢ã€‚</li>
<li>é€»è¾‘æ¡ä»¶ç»„åˆï¼šæ”¯æŒ ANDã€ORã€NOT ç­‰é€»è¾‘è¿ç®—ç¬¦ã€‚</li>
<li>æ™ºèƒ½æ‰“åˆ†æ’åºï¼šåŸºäº IDF æƒé‡å’Œåˆ—æƒé‡çš„ç›¸å…³æ€§æ‰“åˆ†ã€‚</li>
<li>ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼šè‡ªåŠ¨å¤„ç†æŸ¥è¯¢ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</li>
</ul>
<h4 data-id="heading-29">4.1.2 å…¸å‹åº”ç”¨åœºæ™¯</h4>
<pre><code class="hljs language-ini" lang="ini">-- å…¨æ–‡æœç´¢
.entityÂ with(<span class="hljs-attr">query</span>=<span class="hljs-string">'web service'</span>)
-- å­—æ®µé™å®šæœç´¢
.entityÂ with(<span class="hljs-attr">query</span>=<span class="hljs-string">'status:running'</span>)
-- é€»è¾‘ç»„åˆæŸ¥è¯¢
.entityÂ with(<span class="hljs-attr">query</span>=<span class="hljs-string">'environment:prod AND status:error'</span>)
-- åŸŸå’Œç±»å‹è¿‡æ»¤
.entityÂ with(<span class="hljs-attr">domain</span>=<span class="hljs-string">'apm'</span>, type=<span class="hljs-string">'apm.service'</span>, query=<span class="hljs-string">'production'</span>)
</code></pre>
<h3 data-id="heading-30">4.2 SPL æ•°æ®å¤„ç†è¯­è¨€</h3>
<p>SPLï¼ˆSLS Processing Languageï¼‰æ˜¯æ—¥å¿—æœåŠ¡æä¾›çš„æ•°æ®å¤„ç†è¯­è¨€ï¼Œç”¨äºå¯¹è¯»å–å‡ºçš„åŸå§‹æ•°æ®è¿›è¡Œç»“æ„åŒ–ä¿¡æ¯æå–ã€å­—æ®µæ“ä½œå’Œæ•°æ®è¿‡æ»¤ç­‰æ“ä½œã€‚SPL æ”¯æŒå¤šçº§ç®¡é“çº§è”åŠŸèƒ½ï¼Œå¯ä»¥è¿›è¡Œå¤æ‚çš„æ•°æ®å¤„ç†å’Œåˆ†æã€‚</p>
<h4 data-id="heading-31">4.2.1 å·¥ä½œåŸç†</h4>
<p>SPL é‡‡ç”¨ç®¡é“å¼å¤„ç†æ¶æ„ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€çº§ç®¡é“ï¼š</strong> ç´¢å¼•è¿‡æ»¤æ¡ä»¶ï¼ˆå¦‚ USearch æŸ¥è¯¢ï¼‰</li>
<li><strong>åç»­ç®¡é“ï¼š</strong> SPL æŒ‡ä»¤è¿›è¡Œæ•°æ®å¤„ç†</li>
<li><strong>æœ€ç»ˆè¾“å‡ºï¼š</strong> ç»è¿‡ SPL å¤„ç†åçš„ç»“æœæ•°æ®</li>
</ol>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<p>æ•°æ®è¿‡æ»¤å’Œç­›é€‰</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ¡ä»¶è¿‡æ»¤</span>
<span class="hljs-operator">|</span>Â <span class="hljs-keyword">where</span>Â statusÂ <span class="hljs-operator">=</span>Â "error"
<span class="hljs-operator">|</span>Â <span class="hljs-keyword">where</span>Â cpu_usageÂ <span class="hljs-operator">&gt;</span>Â <span class="hljs-number">0.8</span>
<span class="hljs-comment">-- æ—¶é—´èŒƒå›´è¿‡æ»¤</span>
<span class="hljs-operator">|</span>Â <span class="hljs-keyword">where</span>Â __time__Â <span class="hljs-operator">&gt;</span>Â "2024-01-01 00:00:00"
</code></pre>
<p>å­—æ®µæ“ä½œ</p>
<pre><code class="hljs language-ini" lang="ini">-- å­—æ®µæå–
| extend <span class="hljs-attr">new_field</span> = field1 + field2
-- å­—æ®µé‡å‘½å
| project-rename <span class="hljs-attr">new_name</span> = old_name
-- å­—æ®µé€‰æ‹©
| project field1, field2, field3
</code></pre>
<h4 data-id="heading-32">4.2.2 USearch ä¸ SPL ç»“åˆä½¿ç”¨</h4>
<p>USearch å¯ä»¥ä½œä¸º SPL çš„æ•°æ®æºï¼Œå®ç°ä»å®ä½“æŸ¥è¯¢åˆ°æ•°æ®åˆ†æçš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">-- åŸºç¡€ç»„åˆï¼šå®ä½“æŸ¥è¯¢ + æ•°æ®å¤„ç†
.entityÂ with(<span class="hljs-attr">domain</span>=<span class="hljs-string">'apm'</span>, type=<span class="hljs-string">'apm.service'</span>, query=<span class="hljs-string">'production'</span>)
|Â whereÂ <span class="hljs-attr">language</span>Â =Â <span class="hljs-string">'java'</span>
</code></pre>
<h3 data-id="heading-33">4.3 åœ¨æ§åˆ¶å°ä¸­ä½¿ç”¨ USearch</h3>
<h4 data-id="heading-34">4.3.1 å…¨å±€å¿«é€ŸæŸ¥è¯¢</h4>
<p>åŠŸèƒ½å…¥å£ï¼šç™»å½•å¯è§‚æµ‹å¹³å°æ§åˆ¶å°ï¼Œè¿›å…¥ä»»æ„å·¥ä½œç©ºé—´ï¼ˆWorkSpaceï¼‰ï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ é€‰æ‹©å¿«é€ŸæŸ¥è¯¢ã€‚</p>
<ol>
<li>æ”¯æŒåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å…³æŸ¥è¯¢è¯­å¥ï¼ˆUSearch SPL è¯­æ³•ä¸­çš„ query éƒ¨åˆ†ï¼‰ï¼Œç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ç»“æœåŒºåŸŸã€‚</li>
<li>æ”¯æŒåœ¨å·¦ä¾§é€‰æ‹©åŸŸï¼ˆDomainï¼‰å’Œå®ä½“ç±»å‹ï¼ˆEntitySetï¼‰ï¼Œç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ç»“æœåŒºåŸŸã€‚</li>
<li>æ”¯æŒåœ¨å·¦ä¾§åˆ—è¡¨ä¸Šé€‰æ‹©æŸ¥è¯¢å®ä½“ç»“æœï¼Œå³è¾¹å±•ç¤ºè¯¥å®ä½“çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠç¯å¢ƒæŒ‡æ ‡ã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4df4e3cb2e64bd3b34055b8a0e495b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=6grtzddE%2BUrLay%2BDEqGjsC5Fb%2BE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-35">4.3.2 å®ä½“æŸ¥è¯¢</h4>
<p>åŠŸèƒ½å…¥å£ï¼šç™»å½•å¯è§‚æµ‹å¹³å°æ§åˆ¶å°ï¼Œè¿›å…¥ä»»æ„å·¥ä½œç©ºé—´ï¼ˆWorkSpaceï¼‰ï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ é€‰æ‹©å®ä½“æŸ¥è¯¢ã€‚</p>
<ol>
<li>æ”¯æŒåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å…³æŸ¥è¯¢è¯­å¥ï¼ˆUSearch SPL è¯­æ³•ä¸­çš„ query éƒ¨åˆ†ï¼‰ï¼Œç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ç»“æœåŒºåŸŸï¼Œå’Œå¿«é€ŸæŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœä¸€è‡´ã€‚</li>
<li>æ”¯æŒåˆ‡æ¢åˆ° SPL æŸ¥è¯¢æ¨¡å¼ï¼Œè¾“å…¥ SPL æŸ¥è¯¢è¯­å¥ï¼ˆå®Œæ•´ USearch SPL è¯­æ³•ï¼‰ï¼Œç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ç»“æœåŒºåŸŸã€‚</li>
</ol>
<h4 data-id="heading-36">4.3.3 å­—æ®µå¿«æ·ä¸‹é’»</h4>
<p>åŠŸèƒ½å…¥å£ï¼šç™»å½•å¯è§‚æµ‹å¹³å°æ§åˆ¶å°ï¼Œè¿›å…¥ä»»æ„çš„å®ä½“æŸ¥è¯¢é¡µé¢ã€ä»ªè¡¨ç›˜ç­‰é¡µé¢ï¼Œé¼ æ ‡æ‚¬æµ®åœ¨å­—æ®µä¸Šï¼Œä¼šæ˜¾ç¤º USearch æŒ‰é’®ã€‚ç‚¹å‡» USearch æŒ‰é’®ï¼Œä¼šå¼¹å‡º USearch æŸ¥è¯¢æ¡†ï¼Œè‡ªåŠ¨å¡«å……å­—æ®µå†…å®¹å¹¶æœç´¢ï¼Œç»“æœå’Œå¿«é€ŸæŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœä¸€è‡´ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5ba1041a42424eb2536b3d3262e84c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765420925&amp;x-signature=iNF0wEQkkCc3hz7b0S0ap%2FZTRkc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-37">æ€»ç»“</h2>
<blockquote>
<p>Entity Explorer æ ¸å¿ƒæ„¿æ™¯ï¼šä»æ•°æ®æ··æ²Œåˆ°ä¸šåŠ¡æ´å¯Ÿï¼Œæˆ‘ä»¬ç”¨ç¡®å®šæ€§çš„æ¨¡å‹ï¼Œé©¾é©­ä¸ç¡®å®šæ€§çš„æ•°æ®ä¸–ç•Œã€‚</p>
</blockquote>
<p>åœ¨æ„å»º Entity Explorer ä¹‹åˆï¼Œæˆ‘ä»¬ç›´é¢äº†æ•°æ®æ¢ç´¢é¢†åŸŸçš„ä¸‰åº§å¤§å±±ï¼š</p>
<ul>
<li>æµ·é‡æ•°æ®çš„æ€§èƒ½ç“¶é¢ˆï¼šå¤§é‡å®ä½“å¸¦æ¥çš„æŒ‡æ•°çº§è®¡ç®—å¤æ‚åº¦å’Œå·¨å¤§çš„èµ„æºæˆæœ¬ã€‚</li>
<li>å¼‚æ„æ•°æ®çš„è¯­ä¹‰é¸¿æ²Ÿï¼šå¤šæºã€å¼‚æ„ã€ä½è´¨é‡çš„æ•°æ®å¯¼è‡´å®ä½“éš¾ä»¥è¢«å‡†ç¡®è¯†åˆ«å’Œå…³è”ã€‚</li>
<li>é«˜è€¦åˆæ¶æ„çš„ç»´æŠ¤å™©æ¢¦ï¼šç¡¬ç¼–ç çš„å‰ç«¯å‘ˆç°é€»è¾‘å¯¼è‡´å¼€å‘æ•ˆç‡ä½ä¸‹ã€ç³»ç»Ÿè„†å¼±ä¸”éš¾ä»¥æ‰©å±•ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº† UModelï¼ˆç»Ÿä¸€å®ä½“æ¨¡å‹ï¼‰é©±åŠ¨æ¶æ„ï¼ŒUModel æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œä¸­å¤®å¤§è„‘â€å’Œâ€œè®¾è®¡è“å›¾â€ã€‚å®ƒæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„æ¨¡å‹ï¼Œä¸ä»…å®šä¹‰äº†å®ä½“æ˜¯ä»€ä¹ˆï¼ˆå±æ€§ã€æ ‡ç­¾ã€å…ƒæ•°æ®ï¼‰ï¼Œè¿˜å®šä¹‰äº†å®ä½“é—´çš„å…³ç³»ï¼ˆå…³è”ç±»å‹ã€æ·±åº¦ï¼‰ï¼Œç”šè‡³è§„å®šäº†å®ä½“åº”è¯¥å¦‚ä½•è¢«å‘ˆç°ï¼ˆUI å¸ƒå±€ã€ç»„ä»¶ã€äº¤äº’é€»è¾‘ï¼‰ã€‚</p>
<p>Entity Explorer é€šè¿‡ UModel è¿™ä¸€æ ¸å¿ƒæŠ½è±¡ï¼Œä¸ºæˆ‘ä»¬å¸¦æ¥äº†ï¼š</p>
<p>æè‡´çš„æ•ˆç‡ï¼šå°†æ•°å‘¨çš„å‰ç«¯å¼€å‘æ—¶é—´ç¼©çŸ­ä¸ºæ•°å°æ—¶çš„æ¨¡å‹é…ç½®ã€‚</p>
<p>é«˜åº¦çš„ç²¾å‡†ï¼šæä¾›äº†ä¸€ä¸ªå¯ä¿¡ã€ç»Ÿä¸€ã€360Â° çš„å®ä½“å…¨æ™¯è§†å›¾ã€‚</p>
<p>æ·±åº¦çš„æ´å¯Ÿï¼šèµ‹äºˆå„ç±»äººå‘˜è½»æ¾åˆ†æå¤æ‚æ•°æ®å…³ç³»ã€å‘ç°æ½œåœ¨ä»·å€¼çš„èƒ½åŠ›ã€‚</p>
<p><strong>ç›¸å…³é“¾æ¥ï¼š</strong></p>
<p>[1]Â USearch å®ä½“æŸ¥è¯¢è¯­è¨€</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fcms%2Fcloudmonitor-2-0%2Fuser-guide%2Fentity-explorer-overview%3Fspm%3Da2c4g.11186623.help-menu-28572.d_2_1_0_0.376c3f5b0thNfp%26scm%3D20140722.H_2974636._.OR_help-T_cn~zh-V_1%233250fbab95y2y" target="_blank" title="https://help.aliyun.com/zh/cms/cloudmonitor-2-0/user-guide/entity-explorer-overview?spm=a2c4g.11186623.help-menu-28572.d_2_1_0_0.376c3f5b0thNfp&amp;scm=20140722.H_2974636._.OR_help-T_cn~zh-V_1#3250fbab95y2y" ref="nofollow noopener noreferrer">help.aliyun.com/zh/cms/clouâ€¦</a></p>
<p>[2]Â SPL æ•°æ®å¤„ç†è¯­è¨€</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fcms%2Fcloudmonitor-2-0%2Fuser-guide%2Fentity-explorer-overview%3Fspm%3Da2c4g.11186623.help-menu-28572.d_2_1_0_0.376c3f5b0thNfp%26scm%3D20140722.H_2974636._.OR_help-T_cn~zh-V_1%236e82481ab0637" target="_blank" title="https://help.aliyun.com/zh/cms/cloudmonitor-2-0/user-guide/entity-explorer-overview?spm=a2c4g.11186623.help-menu-28572.d_2_1_0_0.376c3f5b0thNfp&amp;scm=20140722.H_2974636._.OR_help-T_cn~zh-V_1#6e82481ab0637" ref="nofollow noopener noreferrer">help.aliyun.com/zh/cms/clouâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FiddleræŠ“åŒ…ä¸æ¥å£è°ƒè¯•å®æˆ˜ï¼ŒHTTPHTTPSé…ç½®ã€ä»£ç†è®¾ç½®ä¸ç§»åŠ¨ç«¯æŠ“åŒ…è¯¦è§£]]></title>    <link>https://juejin.cn/post/7579485652528136227</link>    <guid>https://juejin.cn/post/7579485652528136227</guid>    <pubDate>2025-12-04T02:46:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579485652528136227" data-draft-id="7579485652528119843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FiddleræŠ“åŒ…ä¸æ¥å£è°ƒè¯•å®æˆ˜ï¼ŒHTTPHTTPSé…ç½®ã€ä»£ç†è®¾ç½®ä¸ç§»åŠ¨ç«¯æŠ“åŒ…è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-04T02:46:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FiddleræŠ“åŒ…ä¸æ¥å£è°ƒè¯•å®æˆ˜ï¼ŒHTTPHTTPSé…ç½®ã€ä»£ç†è®¾ç½®ä¸ç§»åŠ¨ç«¯æŠ“åŒ…è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:46:42.000Z" title="Thu Dec 04 2025 02:46:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å‰åç«¯åˆ†ç¦»å’ŒAPIé©±åŠ¨å¼€å‘çš„æ—¶ä»£ï¼Œç½‘ç»œè¯·æ±‚çš„è°ƒè¯•èƒ½åŠ›ç›´æ¥å†³å®šäº†å¼€å‘æ•ˆç‡ã€‚
æ¥å£ä¸è¿”å›ï¼Ÿæ•°æ®ä¸å¯¹ï¼Ÿå‰ç«¯è°ƒè¯•åŠå¤©å‘ç°åç«¯æ²¡æ”¶åˆ°è¯·æ±‚ï¼Ÿâ€”â€”è¿™äº›é—®é¢˜ï¼Œå¾€å¾€éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæŠ“åŒ…å·¥å…·è½»æ¾è§£å†³ã€‚</p>
<p>è€Œåœ¨ä¼—å¤šæŠ“åŒ…å·¥å…·ä¸­ï¼Œ<strong>FiddleræŠ“åŒ…å·¥å…·</strong> ä»¥å…è´¹ã€å¼ºå¤§ã€å¯æ‰©å±•è‘—ç§°ï¼Œæˆä¸ºå¼€å‘è€…ä¸æµ‹è¯•å·¥ç¨‹å¸ˆçš„â€œç½‘ç»œè°ƒè¯•å¿…å¤‡ç¥å™¨â€ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ ç³»ç»Ÿäº†è§£ <strong>Fiddlerä½¿ç”¨æ•™ç¨‹ã€HTTPSæŠ“åŒ…é…ç½®ã€ä»£ç†è®¾ç½®æ–¹æ³•ã€æ¥å£è°ƒè¯•æŠ€å·§ä¸ç§»åŠ¨ç«¯æŠ“åŒ…å®è·µ</strong>ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŒæ¡æŠ“åŒ…ä¸ç½‘ç»œåˆ†æçš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€ä¸ºä»€ä¹ˆå¼€å‘è€…éƒ½åœ¨ç”¨Fiddlerï¼Ÿ</strong></h2>
<p>åœ¨æ¥å£è”è°ƒã€ç½‘ç»œæ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ–ä¸­ï¼Œ<strong>Fiddler</strong> çš„ä½œç”¨å¯æ€»ç»“ä¸ºä¸‰å¥è¯ï¼š</p>
<ul>
<li><strong>å®ƒèƒ½â€œæŠ“â€åˆ°æ‰€æœ‰HTTP/HTTPSè¯·æ±‚</strong></li>
<li><strong>å®ƒèƒ½â€œæ”¹â€æ‰è¯·æ±‚ä¸å“åº”çš„æ•°æ®</strong></li>
<li><strong>å®ƒèƒ½â€œæµ‹â€å‡ºç½‘ç»œä¸æ¥å£æ€§èƒ½ç“¶é¢ˆ</strong></li>
</ul>
<p>ä¸ Charlesã€Postmanã€Wireshark ç­‰å·¥å…·ç›¸æ¯”ï¼š</p>






























<table><thead><tr><th>å·¥å…·</th><th>ä¼˜åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Fiddler</strong></td><td>åŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒè¯·æ±‚ä¿®æ”¹ä¸Mockæ•°æ®</td><td>æ¥å£è”è°ƒ / æ€§èƒ½è°ƒè¯•</td></tr><tr><td><strong>Charles</strong></td><td>ç•Œé¢ç®€æ´ï¼Œæ“ä½œç›´è§‚</td><td>å…¥é—¨æŠ“åŒ…</td></tr><tr><td><strong>Postman</strong></td><td>è¯·æ±‚æ„é€ çµæ´»ï¼ŒAPIæµ‹è¯•ä¼˜ç§€</td><td>æ¥å£éªŒè¯</td></tr><tr><td><strong>Wireshark</strong></td><td>åº•å±‚æ•°æ®åˆ†æå¼ºå¤§</td><td>ç½‘ç»œå®‰å…¨åˆ†æ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€Fiddlerå®‰è£…ä¸åˆå§‹é…ç½®</strong></h2>
<h3 data-id="heading-2"><strong>1. å®‰è£…ä¸å¯åŠ¨</strong></h3>
<p>Fiddler æ”¯æŒ Windows ä¸ macOSï¼ˆFiddler Everywhere ç‰ˆæœ¬ï¼‰ã€‚
å®‰è£…å®Œæˆåï¼Œå¯åŠ¨è½¯ä»¶ä¼šè‡ªåŠ¨æ¥ç®¡ç³»ç»Ÿä»£ç†å¹¶å¼€å§‹æ•è·æµé‡ã€‚</p>
<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li>çŠ¶æ€æ æ˜¾ç¤º â€œCapturingâ€ è¡¨ç¤ºæ­£åœ¨æŠ“åŒ…ï¼›</li>
<li>è‹¥ä¸º â€œPausedâ€ï¼Œç‚¹å‡»å³å¯æ¢å¤æŠ“åŒ…çŠ¶æ€ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-3"><strong>2. Fiddlerä»£ç†è®¾ç½®ï¼ˆPC + ç§»åŠ¨ç«¯ï¼‰</strong></h3>
<p>Fiddler é»˜è®¤åªæ•è·æœ¬æœºè¯·æ±‚ã€‚
è‹¥ä½ éœ€è¦è°ƒè¯•ç§»åŠ¨ç«¯ Appã€å°ç¨‹åºæˆ– WebView è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ä»£ç†ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>æ‰“å¼€ <code>Tools â†’ Options â†’ Connections</code>ï¼›</li>
<li>å‹¾é€‰ <strong>Allow remote computers to connect</strong>ï¼›</li>
<li>æŸ¥çœ‹ç”µè„‘ IP ä¸ç«¯å£ï¼ˆé»˜è®¤ 8888ï¼‰ï¼›</li>
<li>ä¿è¯æ‰‹æœºä¸ç”µè„‘è¿æ¥åŒä¸€ Wi-Fiï¼›</li>
<li>åœ¨æ‰‹æœº Wi-Fi è®¾ç½®ä¸­æ·»åŠ ä»£ç†ï¼š
<ul>
<li>ä¸»æœºåï¼šç”µè„‘ IP</li>
<li>ç«¯å£å·ï¼š8888ã€‚</li>
</ul>
</li>
</ol>
<p>æ­¤æ—¶ï¼ŒFiddler å³å¯æ•è·ç§»åŠ¨è®¾å¤‡è¯·æ±‚ã€‚</p>
<hr/>
<h3 data-id="heading-4"><strong>3. HTTPS æŠ“åŒ…é…ç½®</strong></h3>
<p>è¦æŠ“ HTTPS è¯·æ±‚ï¼Œéœ€è¦å®‰è£…è¯ä¹¦è§£å¯†åŠ å¯†æµé‡ã€‚</p>
<p><strong>é…ç½®æ­¥éª¤ï¼š</strong></p>
<ul>
<li>æ‰“å¼€ <code>Tools â†’ Options â†’ HTTPS</code>ï¼›</li>
<li>å‹¾é€‰ <strong>Decrypt HTTPS traffic</strong>ï¼›</li>
<li>ç‚¹å‡» â€œActions â†’ Trust Root Certificateâ€ï¼›</li>
<li>å®‰è£…å¹¶ä¿¡ä»»è¯ä¹¦ï¼›</li>
<li>è‹¥æŠ“å–æ‰‹æœºè¯·æ±‚ï¼Œå¯¼å‡ºè¯ä¹¦å¹¶åœ¨ç§»åŠ¨ç«¯ä¿¡ä»»ã€‚</li>
</ul>
<p>é…ç½®å®Œæˆåï¼ŒFiddler å³å¯æŸ¥çœ‹ HTTPS è¯·æ±‚å¤´ä¸å“åº”å†…å®¹ã€‚</p>
<hr/>
<h2 data-id="heading-5"><strong>ä¸‰ã€Fiddleræ ¸å¿ƒåŠŸèƒ½è¯¦è§£</strong></h2>
<h3 data-id="heading-6"><strong>1. è¯·æ±‚ä¸å“åº”åˆ†æ</strong></h3>
<p>ä¸»ç•Œé¢ä¸­æ¯ä¸ªè¯·æ±‚åŒ…å«ä¸°å¯Œçš„ä¿¡æ¯ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹å¼ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰ï¼›</li>
<li>URL ä¸å‚æ•°ï¼›</li>
<li>Headerã€Cookie ä¸ Bodyï¼›</li>
<li>å“åº”çŠ¶æ€ç ä¸æ•°æ®å†…å®¹ï¼›</li>
<li>è¯·æ±‚è€—æ—¶ã€å¤§å°ä¸æ€§èƒ½æŒ‡æ ‡ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7"><strong>2. æ¨¡æ‹Ÿæ¥å£å“åº”ï¼ˆAutoResponderï¼‰</strong></h3>
<p>Fiddler çš„ AutoResponder æ¨¡å—æ˜¯å‰ç«¯å¼€å‘çš„å¥½å¸®æ‰‹ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
<ol>
<li>æ‰“å¼€ AutoResponder é¢æ¿ï¼›</li>
<li>ç‚¹å‡» â€œAdd Ruleâ€ æ·»åŠ è§„åˆ™ï¼›</li>
<li>åŒ¹é…æ¥å£åœ°å€ï¼›</li>
<li>æŒ‡å®šè¿”å› JSON æ–‡ä»¶æˆ–è‡ªå®šä¹‰å“åº”ï¼›</li>
<li>å‹¾é€‰ â€œEnable Rulesâ€ å¯ç”¨è§„åˆ™ã€‚</li>
</ol>
<p><strong>å®æˆ˜ï¼š</strong>
å‰ç«¯å¯æ¨¡æ‹Ÿæ¥å£è¿”å›ï¼š</p>
<pre><code class="hljs language-css" lang="css">{ "<span class="hljs-selector-tag">code</span>":<span class="hljs-number">200</span>, <span class="hljs-string">"data"</span>:{"user":<span class="hljs-string">"test"</span>} }
</code></pre>
<p>æ— éœ€ç­‰å¾…åç«¯æ¥å£å³å¯å®Œæˆå¼€å‘ä¸è”è°ƒã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>3. è¯·æ±‚æ–­ç‚¹ä¸ä¿®æ”¹ï¼ˆBreakpointsï¼‰</strong></h3>
<p>Fiddler æ”¯æŒåœ¨è¯·æ±‚å‘å‡ºå‰æˆ–å“åº”è¿”å›å‰è®¾ç½®æ–­ç‚¹ï¼Œ
ä¾¿äºå¼€å‘è€…åŠ¨æ€ä¿®æ”¹è¯·æ±‚æˆ–å“åº”ã€‚</p>
<p><strong>å‘½ä»¤æŠ€å·§ï¼š</strong></p>
<ul>
<li><code>bpu /api/login</code> â†’ è®¾ç½®ç™»å½•æ¥å£è¯·æ±‚æ–­ç‚¹ï¼›</li>
<li><code>bpafter /api/user</code> â†’ å“åº”æ–­ç‚¹ï¼›</li>
<li><code>bpu</code> â†’ å…³é—­æ–­ç‚¹ã€‚</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ¨¡æ‹Ÿæ¥å£é”™è¯¯ï¼ˆ404ã€500ï¼‰ï¼›</li>
<li>ä¿®æ”¹å‚æ•°æµ‹è¯•å…¼å®¹æ€§ï¼›</li>
<li>éªŒè¯æ¥å£å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9"><strong>4. æ„é€ ä¸é‡æ”¾è¯·æ±‚ï¼ˆComposerï¼‰</strong></h3>
<p>Composer æ¨¡å—å¯æ‰‹åŠ¨æ„é€ ã€ç¼–è¾‘ä¸é‡æ”¾è¯·æ±‚ã€‚</p>
<p><strong>å¸¸è§ç”¨é€”ï¼š</strong></p>
<ul>
<li>éªŒè¯æ¥å£ç­¾åï¼›</li>
<li>æµ‹è¯• Token æœ‰æ•ˆæœŸï¼›</li>
<li>è°ƒè¯•å‚æ•°ä¸Headeré…ç½®ã€‚</li>
</ul>
<p><strong>æŠ€å·§ï¼š</strong>
å³é”®è¯·æ±‚ â†’ â€œReplay â†’ Reissue Requestâ€ï¼Œ
å³å¯å¿«é€Ÿé‡æ”¾ï¼Œæ–¹ä¾¿å¯¹æ¯”åˆ†æã€‚</p>
<hr/>
<h3 data-id="heading-10"><strong>5. æ€§èƒ½åˆ†æï¼ˆTimelineï¼‰</strong></h3>
<p>Timeline æ¨¡å—ç›´è§‚å±•ç¤ºè¯·æ±‚çš„å…¨è¿‡ç¨‹ï¼š
DNS æŸ¥è¯¢ â†’ TCP è¿æ¥ â†’ TLS æ¡æ‰‹ â†’ æœåŠ¡å™¨å“åº” â†’ å†…å®¹ä¸‹è½½ã€‚</p>
<p><strong>å®æˆ˜ï¼š</strong>
é€šè¿‡ Timeline åˆ†æå¯å‘ç°ç“¶é¢ˆåœ¨äºï¼š</p>
<ul>
<li>DNS å»¶è¿Ÿé«˜ï¼›</li>
<li>åç«¯å“åº”æ…¢ï¼›</li>
<li>å‰ç«¯è¯·æ±‚é‡å¤ã€‚</li>
</ul>
<p>é’ˆå¯¹ä¸åŒé—®é¢˜é‡‡å–ç›¸åº”ä¼˜åŒ–æªæ–½ï¼Œæ€§èƒ½æå‡ç«‹ç«¿è§å½±ã€‚</p>
<hr/>
<h2 data-id="heading-11"><strong>å››ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ¥å£è¶…æ—¶é—®é¢˜å®šä½</strong></h2>
<p>æŸç§»åŠ¨ç«¯æ¥å£é¢‘ç¹è¶…æ—¶ã€‚
é€šè¿‡ Fiddler æŠ“åŒ…å‘ç°ï¼š</p>
<ul>
<li>è¯·æ±‚å‘é€æ­£å¸¸ï¼Œä½†å“åº”é˜¶æ®µè€—æ—¶å¼‚å¸¸ï¼›</li>
<li>åç«¯æ—¥å¿—æ˜¾ç¤º Nginx è¶…æ—¶æœªè¿”å›ï¼›</li>
<li>Timeline æ˜¾ç¤º TLS æ¡æ‰‹å¤šæ¬¡é‡è¯•ã€‚</li>
</ul>
<p>æœ€ç»ˆç¡®è®¤æ˜¯ HTTPS è¯ä¹¦é“¾é…ç½®é”™è¯¯å¯¼è‡´ã€‚ ä¿®å¤åå“åº”è€—æ—¶ä» 4.2 ç§’é™è‡³ 1.3 ç§’ã€‚</p>
<hr/>
<h2 data-id="heading-12"><strong>äº”ã€FiddleråŠŸèƒ½æ¨¡å—å¯¹ç…§è¡¨</strong></h2>



































<table><thead><tr><th>æ¨¡å—</th><th>åŠŸèƒ½è¯´æ˜</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Filters</strong></td><td>æŒ‰æ¡ä»¶ç­›é€‰è¯·æ±‚</td><td>èšç„¦ç›®æ ‡æ¥å£è°ƒè¯•</td></tr><tr><td><strong>AutoResponder</strong></td><td>æ¨¡æ‹Ÿæ¥å£å“åº”</td><td>å‰åç«¯åˆ†ç¦»å¼€å‘</td></tr><tr><td><strong>Breakpoints</strong></td><td>æ‹¦æˆªå¹¶ä¿®æ”¹è¯·æ±‚</td><td>æ¨¡æ‹Ÿé”™è¯¯ä¸å®¹é”™æµ‹è¯•</td></tr><tr><td><strong>Composer</strong></td><td>æ„é€ ä¸é‡æ”¾è¯·æ±‚</td><td>API éªŒè¯ä¸æµ‹è¯•</td></tr><tr><td><strong>Timeline</strong></td><td>è¯·æ±‚æ€§èƒ½åˆ†æ</td><td>ä¼˜åŒ–ç½‘ç»œåŠ è½½</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-13"><strong>å…­ã€å­¦ä¹ ä¸èµ„æºæ¨è</strong></h2>
<p>æƒ³æ›´æ·±å…¥å­¦ä¹  Fiddlerï¼Ÿæ¨èè®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fiddler.hk%2F" target="_blank" title="https://www.fiddler.hk/" ref="nofollow noopener noreferrer">Fiddler ä¸­æ–‡ç½‘</a></p>
<p>ç½‘ç«™æä¾›ï¼š</p>
<ul>
<li>Fiddler å®‰è£…ä¸é…ç½®æ•™ç¨‹ï¼›</li>
<li>HTTPS æŠ“åŒ…ä¸è¯ä¹¦å®‰è£…æŒ‡å—ï¼›</li>
<li>ç§»åŠ¨ç«¯ä»£ç†é…ç½®ä¸è°ƒè¯•æŠ€å·§ï¼›</li>
<li>Mock æ•°æ®ä¸æ¥å£è”è°ƒå®æˆ˜ï¼›</li>
<li>å¸¸è§é”™è¯¯ä¸ä¼˜åŒ–æ–¹æ¡ˆã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ–‡ä»¶ä¸Šä¼ å®æˆ˜ï¼šåŸºäºExpressã€åˆ†ç‰‡ã€Web Workerä¸å‹ç¼©çš„å®Œæ•´æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7579499567869935666</link>    <guid>https://juejin.cn/post/7579499567869935666</guid>    <pubDate>2025-12-04T02:48:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869935666" data-draft-id="7579512734297194534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ–‡ä»¶ä¸Šä¼ å®æˆ˜ï¼šåŸºäºExpressã€åˆ†ç‰‡ã€Web Workerä¸å‹ç¼©çš„å®Œæ•´æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-12-04T02:48:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§å‰ç«¯å†é™©è®°"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ–‡ä»¶ä¸Šä¼ å®æˆ˜ï¼šåŸºäºExpressã€åˆ†ç‰‡ã€Web Workerä¸å‹ç¼©çš„å®Œæ•´æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§å‰ç«¯å†é™©è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:48:54.000Z" title="Thu Dec 04 2025 02:48:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æˆ‘æ˜¯å¤§é±¼ï¼Œé™ªä½ ä¸€èµ·åœ¨å‰ç«¯æŠ€æœ¯æ·±æµ·å‰è¡Œã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¤§æ–‡ä»¶ä¸Šä¼ çš„å…¨é“¾è·¯ä¼˜åŒ–æ–¹æ¡ˆï¼Œç»“åˆå‰ç«¯åˆ†ç‰‡ã€Web Workerå¤šçº¿ç¨‹å¤„ç†ã€æ–‡ä»¶å‹ç¼©ä»¥åŠExpressåç«¯å®ç°ï¼Œè§£å†³ä¼ ç»Ÿå¤§æ–‡ä»¶ä¸Šä¼ ä¸­çš„ç½‘ç»œæ³¢åŠ¨ã€æœåŠ¡å™¨å‹åŠ›ä¸ç”¨æˆ·ä½“éªŒå·®ç­‰æ ¸å¿ƒç—›ç‚¹ã€‚</p>
<h3 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡</h3>
<p>å¤§æ–‡ä»¶ä¸Šä¼ çš„ä¼˜åŒ–ä¸»è¦å›´ç»•<strong>åˆ†ç‰‡ä¸Šä¼ </strong>ã€<strong>æ–­ç‚¹ç»­ä¼ </strong>å’Œ<strong>ç§’ä¼ </strong>ä¸‰å¤§æœºåˆ¶å±•å¼€ã€‚æœ¬æ–¹æ¡ˆåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¼•å…¥Web Workerè¿›è¡Œå‰ç«¯å¹¶è¡Œè®¡ç®—ä¸æ–‡ä»¶å‹ç¼©ï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å‰ç«¯</strong>ï¼šé‡‡ç”¨åˆ†ç‰‡ï¼ˆ5MB/ç‰‡ï¼‰å‹ç¼©åï¼Œé€šè¿‡Web Workerè®¡ç®—å“ˆå¸Œï¼Œå®ç°å¹¶å‘ä¸Šä¼ ä¸è¿›åº¦åé¦ˆã€‚</li>
<li><strong>åç«¯</strong>ï¼šä½¿ç”¨Express.js + Multerå¤„ç†åˆ†ç‰‡ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ä¸æ–‡ä»¶åˆå¹¶ã€‚</li>
<li><strong>ä¼ è¾“ä¼˜åŒ–</strong>ï¼šé€šè¿‡å‹ç¼©ç®—æ³•ï¼ˆå¦‚gzipï¼‰å‡å°‘ä¼ è¾“ä½“ç§¯ï¼Œæå‡ç½‘ç»œåˆ©ç”¨ç‡ã€‚</li>
</ul>
<h4 data-id="heading-1">æ–¹æ¡ˆä¼˜åŠ¿å¯¹æ¯”</h4>

























<table><thead><tr><th align="left">ä¼ ç»Ÿæ–¹æ¡ˆ</th><th align="left">æœ¬ä¼˜åŒ–æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td align="left">å•çº¿ç¨‹ä¸Šä¼ ï¼Œæ˜“é˜»å¡ä¸»çº¿ç¨‹</td><td align="left">Web Workerå¤šçº¿ç¨‹å¤„ç†ï¼Œä¸é˜»å¡UI</td></tr><tr><td align="left">ç½‘ç»œä¸­æ–­éœ€é‡ä¼ æ•´ä¸ªæ–‡ä»¶</td><td align="left">åˆ†ç‰‡ä¸Šä¼  + æ–­ç‚¹ç»­ä¼ ï¼Œä»…é‡ä¼ å¤±è´¥åˆ†ç‰‡</td></tr><tr><td align="left">æ— å‹ç¼©ï¼Œä¼ è¾“æ•ˆç‡ä½</td><td align="left">å‰ç«¯å‹ç¼© + åˆ†ç‰‡ï¼Œå‡å°‘å¸¦å®½å ç”¨</td></tr><tr><td align="left">æœåŠ¡å™¨ç›´æ¥å¤„ç†å¤§æ–‡ä»¶æµ</td><td align="left">åˆ†ç‰‡å‡è½»æœåŠ¡å™¨å•æ¬¡å‹åŠ›</td></tr></tbody></table>
<h3 data-id="heading-2">äºŒã€å‰ç«¯å®ç°ï¼šåˆ†ç‰‡ã€å‹ç¼©ä¸Workerå¤šçº¿ç¨‹</h3>
<p>å‰ç«¯æµç¨‹åŒ…æ‹¬<strong>æ–‡ä»¶åˆ†ç‰‡</strong>ã€<strong>å‹ç¼©å¤„ç†</strong>ã€<strong>å“ˆå¸Œè®¡ç®—</strong>å’Œ<strong>å¹¶å‘ä¸Šä¼ </strong>ï¼Œå…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-3">1. æ–‡ä»¶åˆ†ç‰‡ä¸å‹ç¼©</h4>
<p>ä½¿ç”¨<code>File.slice()</code>è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶å¯¹æ¯ä¸ªåˆ†ç‰‡åº”ç”¨å‹ç¼©ï¼ˆç¤ºä¾‹ä½¿ç”¨gzipï¼‰ã€‚åˆ†ç‰‡å¤§å°å»ºè®®5MBï¼Œå¹³è¡¡ç½‘ç»œå¼€é”€ä¸å¹¶å‘æ•ˆç‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–‡ä»¶åˆ†ç‰‡ä¸å‹ç¼©å‡½æ•°</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chunkAndCompressFile</span>(<span class="hljs-params">file, chunkSize = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>) {
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; file.<span class="hljs-property">size</span>; i += chunkSize) {
    <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(i, i + chunkSize);
    <span class="hljs-comment">// ä½¿ç”¨Compression Streams APIè¿›è¡Œå‹ç¼©ï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰</span>
    <span class="hljs-keyword">const</span> compressedStream = chunk.<span class="hljs-title function_">stream</span>().<span class="hljs-title function_">pipeThrough</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionStream</span>(<span class="hljs-string">'gzip'</span>));
    <span class="hljs-keyword">const</span> compressedChunk = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(compressedStream).<span class="hljs-title function_">blob</span>();
    chunks.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">index</span>: i / chunkSize,
      <span class="hljs-attr">file</span>: compressedChunk,
      <span class="hljs-attr">originalSize</span>: chunk.<span class="hljs-property">size</span>,
      <span class="hljs-attr">compressedSize</span>: compressedChunk.<span class="hljs-property">size</span>
    });
  }
  <span class="hljs-keyword">return</span> chunks;
}
</code></pre>
<h4 data-id="heading-4">2. Web Workerè®¡ç®—åˆ†ç‰‡å“ˆå¸Œ</h4>
<p>ä½¿ç”¨<code>file-chunk-worker</code>åº“åœ¨Workerä¸­å¹¶è¡Œè®¡ç®—åˆ†ç‰‡MD5ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼ŒåŒæ—¶æ”¯æŒè¿›åº¦åé¦ˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨Workerå¤„ç†æ–‡ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FileProcessor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'file-chunk-worker'</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processFileWithWorker</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-keyword">const</span> processor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileProcessor</span>(file, {
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
    <span class="hljs-attr">threadCount</span>: <span class="hljs-number">4</span>  <span class="hljs-comment">// å¯ç”¨4ä¸ªWorkerçº¿ç¨‹</span>
  });
  <span class="hljs-keyword">const</span> chunks = <span class="hljs-keyword">await</span> processor.<span class="hljs-title function_">calculateMd5</span>(<span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¤„ç†è¿›åº¦: <span class="hljs-subst">${(progress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
  });
  <span class="hljs-comment">// chunksåŒ…å«æ¯ä¸ªåˆ†ç‰‡çš„hashã€ç´¢å¼•å’ŒBlobæ•°æ®</span>
  <span class="hljs-keyword">return</span> chunks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> ({
    ...chunk,
    <span class="hljs-attr">hash</span>: chunk.<span class="hljs-property">hash</span>  <span class="hljs-comment">// ç”¨äºç§’ä¼ æ ¡éªŒ</span>
  }));
}
</code></pre>
<h4 data-id="heading-5">3. å¹¶å‘ä¸Šä¼ ä¸æ–­ç‚¹ç»­ä¼ </h4>
<p>ä¸Šä¼ å‰å…ˆæŸ¥è¯¢æœåŠ¡å™¨å·²ä¸Šä¼ åˆ†ç‰‡ï¼Œå®ç°æ–­ç‚¹ç»­ä¼ ã€‚ä½¿ç”¨<code>@yuan-toolkit/chunk-uploader</code>æˆ–<code>bigfile-chunk-uploader</code>åº“ç®¡ç†å¹¶å‘ã€é‡è¯•å’Œè¿›åº¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é…ç½®åŒ–çš„åˆ†ç‰‡ä¸Šä¼ ï¼ˆåŸºäºbigfile-chunk-uploaderï¼‰</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BigFileUploader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'bigfile-chunk-uploader'</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-comment">// 1. åˆ†ç‰‡å¹¶è®¡ç®—å“ˆå¸Œ</span>
  <span class="hljs-keyword">const</span> processedChunks = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processFileWithWorker</span>(file);
  <span class="hljs-comment">// 2. åˆå§‹åŒ–ä¸Šä¼ ï¼Œè·å–fileIdï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰</span>
  <span class="hljs-keyword">const</span> fileId = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/init'</span>, {
    <span class="hljs-attr">fileName</span>: file.<span class="hljs-property">name</span>,
    <span class="hljs-attr">fileHash</span>: processedChunks.<span class="hljs-property">overallHash</span>  <span class="hljs-comment">// æ•´ä½“æ–‡ä»¶å“ˆå¸Œï¼Œç”¨äºç§’ä¼ </span>
  }).<span class="hljs-property">data</span>.<span class="hljs-property">uploadId</span>;
  
  <span class="hljs-comment">// 3. æ£€æŸ¥å·²ä¸Šä¼ åˆ†ç‰‡</span>
  <span class="hljs-keyword">const</span> { uploadedChunks } = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/upload/status?fileId=<span class="hljs-subst">${fileId}</span>`</span>);
  <span class="hljs-comment">// 4. å¹¶å‘ä¸Šä¼ æœªå®Œæˆåˆ†ç‰‡</span>
  <span class="hljs-keyword">const</span> uploader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigFileUploader</span>({
    file,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://api.example.com'</span>,
    <span class="hljs-attr">endpoints</span>: { <span class="hljs-attr">chunk</span>: <span class="hljs-string">'/upload/chunk'</span>, <span class="hljs-attr">merge</span>: <span class="hljs-string">'/upload/merge'</span> },
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
    <span class="hljs-attr">concurrent</span>: <span class="hljs-number">3</span>,  <span class="hljs-comment">// æ§åˆ¶å¹¶å‘æ•°</span>
    <span class="hljs-attr">maxRetries</span>: <span class="hljs-number">3</span>,   <span class="hljs-comment">// å¤±è´¥è‡ªåŠ¨é‡è¯•</span>
    <span class="hljs-attr">onProgress</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä¸Šä¼ è¿›åº¦: <span class="hljs-subst">${progress}</span>%`</span>);  <span class="hljs-comment">// å®æ—¶åé¦ˆ</span>
    }
  });
  <span class="hljs-keyword">await</span> uploader.<span class="hljs-title function_">start</span>();
  <span class="hljs-comment">// 5. æ‰€æœ‰åˆ†ç‰‡å®Œæˆåï¼Œè¯·æ±‚åˆå¹¶</span>
  <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/merge'</span>, { fileId });
}
</code></pre>
<h4 data-id="heading-6">å…³é”®ä¼˜åŒ–ç‚¹ï¼š</h4>
<ul>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šæµè§ˆå™¨åŒåŸŸå¹¶å‘é™åˆ¶çº¦ä¸º6ï¼Œå¯é€šè¿‡å¤šå­åŸŸï¼ˆå¦‚<code>upload1.example.com</code>ï¼‰æå‡é€Ÿåº¦ã€‚</li>
<li><strong>è¿›åº¦åé¦ˆ</strong>ï¼šç»“åˆåˆ†ç‰‡è¿›åº¦ä¸å‹ç¼©è¿›åº¦ï¼Œæä¾›ç²¾ç¡®çš„ç™¾åˆ†æ¯”åé¦ˆã€‚</li>
<li><strong>é”™è¯¯é‡è¯•</strong>ï¼šç½‘ç»œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ç‰¹å®šåˆ†ç‰‡ï¼Œå¢å¼ºé²æ£’æ€§ã€‚</li>
</ul>
<h3 data-id="heading-7">ä¸‰ã€åç«¯å®ç°ï¼šExpress.jsåˆ†ç‰‡æ¥æ”¶ä¸åˆå¹¶</h3>
<p>åç«¯ä½¿ç”¨Express + Multerå¤„ç†åˆ†ç‰‡ï¼Œå¹¶å®ç°æ–­ç‚¹ç»­ä¼ é€»è¾‘ã€‚</p>
<h4 data-id="heading-8">1. ç¯å¢ƒæ­å»ºä¸Multeré…ç½®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-comment">// é…ç½®Multerå­˜å‚¨åˆ†ç‰‡</span>
<span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>({
  <span class="hljs-attr">destination</span>: <span class="hljs-string">'uploads/temp/'</span>,  <span class="hljs-comment">// åˆ†ç‰‡ä¸´æ—¶ç›®å½•</span>
  <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { fileId, chunkIndex } = req.<span class="hljs-property">body</span>;
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">`<span class="hljs-subst">${fileId}</span>-<span class="hljs-subst">${chunkIndex}</span>.chunk`</span>);  <span class="hljs-comment">// æŒ‰fileIdå’Œç´¢å¼•å‘½å</span>
  }
});
<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({ storage });
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());
</code></pre>
<h4 data-id="heading-9">2. åˆ†ç‰‡ä¸Šä¼ æ¥å£</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. åˆå§‹åŒ–ä¸Šä¼ ï¼ˆç”ŸæˆfileIdï¼Œæ”¯æŒç§’ä¼ ï¼‰</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/init'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileName, fileHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">const</span> fileId = <span class="hljs-title function_">generateFileId</span>();  <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€ID</span>
  <span class="hljs-comment">// ç§’ä¼ æ£€æŸ¥ï¼šå¦‚æœæ–‡ä»¶å“ˆå¸Œå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›æˆåŠŸ</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkFileExists</span>(fileHash)) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploaded</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">url</span>: <span class="hljs-title function_">getFileUrl</span>(fileHash) });
  }
  <span class="hljs-comment">// è®°å½•ä¸Šä¼ çŠ¶æ€ï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰</span>
  <span class="hljs-title function_">saveUploadStatus</span>(fileId, { fileName, fileHash, <span class="hljs-attr">uploadedChunks</span>: [] });
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploadId</span>: fileId });
});

<span class="hljs-comment">// 2. åˆ†ç‰‡ä¸Šä¼ æ¥å£</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/chunk'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'chunk'</span>), <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileId, chunkIndex, chunkHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-comment">// éªŒè¯åˆ†ç‰‡å“ˆå¸Œï¼ˆé˜²æ­¢æ•°æ®æŸåï¼‰</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">validateChunkHash</span>(req.<span class="hljs-property">file</span>, chunkHash)) {
    <span class="hljs-comment">// è®°å½•å·²ä¸Šä¼ åˆ†ç‰‡ç´¢å¼•</span>
    <span class="hljs-title function_">updateUploadStatus</span>(fileId, chunkIndex);
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'åˆ†ç‰‡æ ¡éªŒå¤±è´¥'</span> });
  }
});

<span class="hljs-comment">// 3. æŸ¥è¯¢ä¸Šä¼ è¿›åº¦ï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/upload/status'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileId } = req.<span class="hljs-property">query</span>;
  <span class="hljs-keyword">const</span> status = <span class="hljs-title function_">getUploadStatus</span>(fileId);
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploadedChunks</span>: status?.<span class="hljs-property">uploadedChunks</span> || [] });
});
</code></pre>
<h4 data-id="heading-10">3. åˆ†ç‰‡åˆå¹¶æ¥å£</h4>
<p>æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆåï¼ŒæŒ‰ç´¢å¼•é¡ºåºåˆå¹¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/merge'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> { fileId } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">const</span> { fileName, fileHash } = <span class="hljs-title function_">getUploadStatus</span>(fileId);
  <span class="hljs-keyword">const</span> chunkDir = <span class="hljs-string">'uploads/temp/'</span>;
  <span class="hljs-keyword">const</span> chunks = fs.<span class="hljs-title function_">readdirSync</span>(chunkDir)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">startsWith</span>(fileId))
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(a.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]) - <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]));
  <span class="hljs-comment">// é¡ºåºåˆå¹¶åˆ†ç‰‡</span>
  <span class="hljs-keyword">const</span> finalPath = <span class="hljs-string">`uploads/final/<span class="hljs-subst">${fileId}</span>-<span class="hljs-subst">${fileName}</span>`</span>;
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(finalPath);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> chunks) {
    <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkDir, chunk);
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(chunkPath);
      readStream.<span class="hljs-title function_">pipe</span>(writeStream, { <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span> });
      readStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
        fs.<span class="hljs-title function_">unlinkSync</span>(chunkPath);  <span class="hljs-comment">// åˆ é™¤ä¸´æ—¶åˆ†ç‰‡</span>
        <span class="hljs-title function_">resolve</span>();
      });
    });
  }
  writeStream.<span class="hljs-title function_">end</span>();
  <span class="hljs-comment">// æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">calculateFileHash</span>(finalPath) === fileHash) {
    <span class="hljs-title function_">saveFileRecord</span>(fileHash, finalPath);  <span class="hljs-comment">// å­˜å‚¨è®°å½•ä¾›ç§’ä¼ ä½¿ç”¨</span>
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">`/files/<span class="hljs-subst">${fileId}</span>`</span>, <span class="hljs-attr">size</span>: fs.<span class="hljs-title function_">statSync</span>(finalPath).<span class="hljs-property">size</span> });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'æ–‡ä»¶åˆå¹¶å¤±è´¥'</span> });
  }
});
</code></pre>
<h4 data-id="heading-11">å…³é”®ä¼˜åŒ–ç‚¹ï¼š</h4>
<ul>
<li><strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼šé€šè¿‡<code>uploadedChunks</code>è®°å½•é¿å…é‡å¤ä¸Šä¼ ã€‚</li>
<li><strong>ç§’ä¼ </strong>ï¼šåŸºäºæ–‡ä»¶å“ˆå¸Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼šåˆå¹¶åæ¸…ç†ä¸´æ—¶åˆ†ç‰‡ï¼Œå®šæœŸæ¸…ç†è¿‡æœŸä¸Šä¼ è®°å½•ã€‚</li>
</ul>
<h3 data-id="heading-12">å››ã€é«˜çº§ä¼˜åŒ–ç­–ç•¥</h3>
<ol>
<li>
<p><strong>å‹ç¼©ç®—æ³•é€‰æ‹©</strong>ï¼š<br/>
å‰ç«¯å‹ç¼©å¯é€‰ç”¨<code>gzip</code>ï¼ˆæµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼‰æˆ–<code>brotli</code>ï¼ˆå‹ç¼©ç‡æ›´é«˜ï¼‰ã€‚å®æµ‹ä¸­ï¼Œå¯¹æ–‡æœ¬/JSONæ•°æ®å‹ç¼©ç‡å¯è¾¾60%-70%ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå·²å‹ç¼©æ–‡ä»¶ï¼ˆå¦‚ZIPã€è§†é¢‘ï¼‰äºŒæ¬¡å‹ç¼©æ”¶ç›Šæœ‰é™ï¼Œå¯å‰ç«¯æ£€æµ‹æ–‡ä»¶ç±»å‹åŠ¨æ€å¯ç”¨å‹ç¼©ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>Web WorkeråŠ¨æ€è°ƒä¼˜</strong>ï¼š<br/>
Workeræ•°é‡å»ºè®®è®¾ä¸º<code>navigator.hardwareConcurrency - 1</code>ï¼ˆä¿ç•™ä¸€ä¸ªæ ¸å¿ƒç»™UIï¼‰ã€‚è¿‡å¤§æ–‡ä»¶ï¼ˆ&gt;1GBï¼‰å¯åˆ†é˜¶æ®µå¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚</p>
</li>
<li>
<p><strong>ä¼ è¾“å®‰å…¨ä¸å®Œæ•´æ€§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“ã€‚</li>
<li>æ¯ä¸ªåˆ†ç‰‡æºå¸¦<code>Content-MD5</code>å¤´ï¼Œåç«¯æ ¡éªŒã€‚</li>
<li>æœ€ç»ˆæ–‡ä»¶å“ˆå¸Œï¼ˆå¦‚SHA-256ï¼‰æ¯”å¯¹ï¼Œé˜²æ­¢åˆå¹¶é”™è¯¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç”¨æˆ·ä½“éªŒå¢å¼º</strong>ï¼š</p>
<ul>
<li>å®æ—¶æ˜¾ç¤ºé€Ÿåº¦ã€å‰©ä½™æ—¶é—´ä¸å‹ç¼©ç‡ã€‚</li>
<li>æš‚åœ/æ¢å¤åŠŸèƒ½ï¼ˆåˆ©ç”¨<code>uploader.pause()</code>/<code>resume()</code>ï¼‰ã€‚</li>
<li>ç½‘ç»œä¸­æ–­åè‡ªåŠ¨æ£€æµ‹å¹¶ç»­ä¼ ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">äº”ã€å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹ä¸ºä¸€ä¸ªè§†é¢‘æ–‡ä»¶ï¼ˆ2GBï¼‰çš„ä¸Šä¼ æµç¨‹ï¼š</p>
<ol>
<li><strong>å‰ç«¯å‡†å¤‡</strong>ï¼š<br/>
æ–‡ä»¶â†’åˆ†ç‰‡ï¼ˆ5MB/ç‰‡ï¼Œå…±çº¦400ç‰‡ï¼‰â†’Web Workerè®¡ç®—åˆ†ç‰‡å“ˆå¸Œï¼ˆ4çº¿ç¨‹å¹¶è¡Œï¼‰â†’gzipå‹ç¼©ï¼ˆä½“ç§¯å‡å°‘çº¦40%ï¼‰ã€‚</li>
<li><strong>ä¸Šä¼ è¿‡ç¨‹</strong>ï¼š
<ol>
<li>åˆå§‹åŒ–è·å–<code>fileId</code>ï¼›2) æŸ¥è¯¢å·²ä¸Šä¼ åˆ†ç‰‡ï¼ˆé¦–æ¬¡ä¸ºç©ºï¼‰ï¼›3) å¹¶å‘ä¸Šä¼ åˆ†ç‰‡ï¼ˆ3ä¸ªå¹¶å‘ï¼‰ï¼›4) å®æ—¶è¿›åº¦æ˜¾ç¤ºã€‚</li>
</ol>
</li>
<li><strong>åç«¯å¤„ç†</strong>ï¼š
<ol>
<li>æ¥æ”¶åˆ†ç‰‡å¹¶å­˜å‚¨ï¼›2) è®°å½•ä¸Šä¼ çŠ¶æ€ï¼›3) åˆå¹¶åˆ†ç‰‡å¹¶æ ¡éªŒï¼›4) è¿”å›æ–‡ä»¶URLã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-14">å…­ã€æ€»ç»“</h3>
<p>æœ¬æ–‡æ–¹æ¡ˆä½¿ç”¨<strong>åˆ†ç‰‡ä¸Šä¼ </strong>ã€<strong>Web Workerå¤šçº¿ç¨‹å¤„ç†</strong>ã€<strong>å‰ç«¯å‹ç¼©</strong>ä¸<strong>Expressåç«¯æ”¯æŒ</strong>ï¼Œç³»ç»Ÿæ€§åœ°è§£å†³äº†å¤§æ–‡ä»¶ä¸Šä¼ çš„ç¨³å®šæ€§ã€æ•ˆç‡ä¸ç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚</p>
<p>å®é™…åº”ç”¨ä¸­ï¼Œå¯æ ¹æ®æ–‡ä»¶ç±»å‹è°ƒæ•´åˆ†ç‰‡å¤§å°ï¼ˆå¦‚å›¾ç‰‡ç”¨2MBï¼Œè§†é¢‘ç”¨5MBï¼‰ï¼Œå¹¶ç›‘æ§æœåŠ¡å™¨è´Ÿè½½ä»¥ä¼˜åŒ–å¹¶å‘å‚æ•°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 20ï¼šå¼€æºä¸ªäººé¡¹ç›®æ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7579553111472291894</link>    <guid>https://juejin.cn/post/7579553111472291894</guid>    <pubDate>2025-12-04T02:47:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579553111472291894" data-draft-id="7579553111472242742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 20ï¼šå¼€æºä¸ªäººé¡¹ç›®æ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-04T02:47:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”³é˜³"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 20ï¼šå¼€æºä¸ªäººé¡¹ç›®æ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”³é˜³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:47:59.000Z" title="Thu Dec 04 2025 02:47:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8822786f79a4980aad2ae5684ab0636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=O7gIBNfViIp79aNDYcZUJFRSQ70%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>é¦–å…ˆå£°æ˜è¿™åªæ˜¯æˆ‘çš„ä¸ªäººç»éªŒï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ä¸Šåƒ <code>star</code> çš„çƒ­é—¨å¼€æºé¡¹ç›®ï¼Œä¹Ÿä¸æ˜¯ä»€ä¹ˆå¼€æºå¤§ä½¬ï¼Œè¿™ç¯‡æ–‡ç« åªæ˜¯ä¸ºäº†åˆ†äº«æˆ‘åœ¨æ‘¸ç´¢å¼€æºçš„æ—¶å€™æ€»ç»“çš„ä¸€äº›å°ç»éªŒã€‚å¦‚æœä½ æœ‰ä¸€äº›æ›´å¥½çš„å»ºè®®ï¼Œå¸Œæœ›å¤§å®¶ä¸€èµ·è®¨è®ºè®¨è®ºã€‚æˆ‘å°†ä»¥æˆ‘çš„è¿™ä¸ªé¡¹ç›®æ¥å±•å¼€ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoshenyang%2Fez-admin-springboot4" target="_blank" title="https://github.com/Caoshenyang/ez-admin-springboot4" ref="nofollow noopener noreferrer">github.com/Caoshenyangâ€¦</a></p>
<h2 data-id="heading-1">äºŒã€é¡¹ç›®å¯åŠ¨å‰ï¼šæƒ³æ¸…æ¥šå†å¼€å§‹</h2>
<blockquote>
<p>æˆ‘è¿™é‡Œè¯´çš„å¼€æºæ˜¯æŒ‡ï¼ŒæŠŠé¡¹ç›®å½“åšä¸€ä¸ªå®Œæ•´çš„äº§å“æ¥åšï¼Œè€Œä¸æ˜¯å°†ä»“åº“è®¾ç½®æˆ <code>public</code> ã€‚</p>
</blockquote>
<h3 data-id="heading-2">2.1. <strong>æ˜ç¡®é¡¹ç›®ç›®æ ‡ä¸ä»·å€¼</strong></h3>
<p>æˆ‘ä»¬åšå¼€æºé¦–å…ˆè¦æ˜ç¡®é¡¹ç›®çš„ç›®æ ‡ä¸ä»·å€¼ã€‚</p>
<p>åœ¨è¿™ä¸ªä¸“æ çš„å¼€ç¯‡æˆ‘å°±æåˆ°è¿‡ï¼Œè¦ä¹ˆæé«˜è‡ªèº«èƒ½åŠ›ï¼Œè¦ä¹ˆæé«˜ä¸ªäººå½±å“åŠ›ï¼Œè¦ä¹ˆå¸¦æ¥æ”¶å…¥ï¼Œå“ªæ€•æ˜¯æ”¶å…¥çš„å¯èƒ½æ€§ï¼Œä¸è¦â€œæ— ç§å¥‰çŒ®â€ï¼Œæˆ‘å¹¶ä¸æ˜¯è¯´â€œæ— ç§å¥‰çŒ®â€ä¸å¥½ï¼Œè€Œæ˜¯å¦‚æœä½ ä¸€ç›´â€œæ— ç§å¥‰çŒ®â€ï¼Œå½“çƒ­æƒ…è¢«æ¶ˆè€—å®Œä¹‹åï¼Œè¿™ä¸ªé¡¹ç›®å¤§æ¦‚ç‡èµ°ä¸é•¿è¿œã€‚</p>
<p>ä»¥æˆ‘è¿™ä¸ªé¡¹ç›®ä¸ºä¾‹ï¼š</p>
<p><strong>é¡¹ç›®çš„ä»·å€¼åœ¨å“ªé‡Œï¼Ÿ</strong></p>
<ol>
<li>ä½œä¸ºè¿™ä¸ªä¸“æ çš„è½åœ°æ¡ˆä¾‹ï¼Œæé«˜è¿™ä¸ªä¸“æ çš„çœŸå®æ€§</li>
<li>å°è¯•ä¸åŒçš„æ¶æ„ï¼Œæå‡è‡ªèº«æŠ€æœ¯èƒ½åŠ›</li>
<li>åšä¸€ä¸ªæœ€å°åŒ–æ¨¡ç‰ˆï¼Œæ–¹ä¾¿åç»­ä¸ªäººä¸šåŠ¡æ‹“å±•</li>
</ol>
<blockquote>
<p>å…¶å®æœ¬è´¨å°±æ˜¯å›´ç»•äº†ä»¥ä¸Šå‡ ç‚¹ï¼Œæé«˜ä¸ªäººå½±å“åŠ›ï¼Œä¸ºä»¥ååšä»˜è´¹æœåŠ¡åšé“ºå«ï¼ˆè¿™é‡Œæˆ‘ä¹Ÿä¸è£…é«˜å°šğŸ˜„ï¼‰ï¼Œæœ¬è´¨å°±æ˜¯å¦‚æ­¤ï¼Œå°Šé‡è‡ªå·±çš„ä»˜å‡ºã€‚</p>
</blockquote>
<h3 data-id="heading-3">2.2. é€‰æ‹©åˆé€‚çš„å¼€æºåè®®</h3>
<p>å¯¹äºå¼€æºåè®®è¿™ä¸ªæˆ‘ä¸ç»†è¯´ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ <code>gitee</code> çš„ä»‹ç»ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒæ¸…æ™°çš„ã€‚æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©å³å¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d7490c9ade4598a9432f0766f818c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=FjS2UeC%2BeK7PFHBvol%2BIgd39ROM%3D" alt="image-20251203173437007" loading="lazy"/></p>
<h3 data-id="heading-4">2.3. åšå¥½å¸‚åœºè°ƒç ”</h3>
<p>ç›¸æ¯”ç›®å‰å¸‚é¢ä¸Šçš„äº§å“ï¼Œä½ çš„ä¸œè¥¿æ˜¯å¦æœ‰äº®ç‚¹ï¼Œå¯¹äºç±»ä¼¼äº§å“ï¼Œä½ çš„é¡¹ç›®æ˜¯æ›¿ä»£ã€è¡¥å……è¿˜æ˜¯ä¸ä»–ä»¬é›†æˆã€‚</p>
<p>è¿˜æ˜¯ä»¥æˆ‘è¿™ä¸ªé¡¹ç›®ä¸ºä¾‹ï¼Œé¦–å…ˆä½œä¸ºä¸“æ çš„è½åœ°é¡¹ç›®ï¼Œæ¯«æ— ç–‘é—®ï¼Œå…·æœ‰ä¸å¯æ›¿ä»£æ€§ï¼Œä»è¿™æ–¹é¢å‡ºå‘æ²¡æœ‰ç«å“ã€‚å…¶æ¬¡ï¼Œç›¸æ¯”äºå¸‚é¢ä¸Šçš„ä¼ä¸šçº§çš„å¼€æºåå°ç®¡ç†ç³»ç»Ÿï¼Œæˆ‘è¿™ä¸ªæ›´å€¾å‘äºä¸ªäººï¼Œæ›´åŠ è½»é‡åŒ–ï¼Œç»“æ„æ›´ç®€å•ï¼Œä¸éœ€è¦ä¸ºäº†å…¼å®¹å„ç§æƒ…å†µåšå¾ˆå¤šå…¼å®¹æ€§å¼€å‘ï¼Œè¿™æ ·ä»£ç ç»“æ„ä¼šå¾ˆæ¸…æ™°ã€‚å¾ˆå®¹æ˜“å¿«é€Ÿä¸Šæ‰‹ï¼Œè€Œä¸”å®Œå…¨åœ¨ä¸ªäººå¯æ§èŒƒå›´å†…ï¼Œä¸€ä¸ªäººä¹Ÿå¯ä»¥ç»´æŠ¤çš„è¿‡æ¥ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€é¡¹ç›®åˆå§‹åŒ–ï¼šæ‰“å¥½åŸºç¡€</h2>
<h3 data-id="heading-6">3.1. <strong>åˆ›å»ºä¸€ä¸ªæ¸…æ™°ä¸“ä¸šçš„ README.md</strong></h3>
<p><code>README</code> æ˜¯ä½ çš„é¡¹ç›®é—¨é¢ï¼Œå¿…é¡»ç²¾å¿ƒè®¾è®¡ã€‚</p>
<p>å®ƒåº”è¯¥åŒ…å«ï¼š</p>
<ul>
<li><strong>é¡¹ç›®åç§°å’Œ Logo</strong></li>
<li><strong>ä¸€å¥è¯ç®€ä»‹</strong></li>
<li><strong>è¯¦ç»†çš„åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨</strong></li>
<li><strong>å®‰è£…å’Œä½¿ç”¨æŒ‡å—</strong>ï¼ˆå¿«é€Ÿå¼€å§‹ï¼‰</li>
<li><strong>æˆªå›¾ã€åŠ¨å›¾æˆ–æ¼”ç¤ºé“¾æ¥</strong>ï¼ˆè§†è§‰æ•ˆæœè‡³å…³é‡è¦ï¼‰</li>
<li><strong>æŒ‡å‘æ›´è¯¦ç»†æ–‡æ¡£çš„é“¾æ¥</strong></li>
</ul>
<blockquote>
<p>ä½ ä¸ç”¨åˆ»æ„å»åšè¿™äº›ï¼Œç­‰åˆ°ä¸Šè¿°ä¸€åˆ‡éƒ½å‡†å¤‡å¥½æ‰å¼€å§‹é¡¹ç›®ï¼Œåº”è¯¥æ˜¯å…ˆæœ‰é¡¹ç›®ï¼Œå†å»æ ¹æ®é¡¹ç›®ä¸æ–­å®Œå–„ä»–ã€‚</p>
</blockquote>
<h2 data-id="heading-7">å››ã€å¼€å‘ä¸ç»´æŠ¤ï¼šä¿æŒé¡¹ç›®å¥åº·</h2>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼šå¦‚æœé¡¹ç›®ä¸»è¦ä½œä¸ºä¸ªäººä½œå“ã€æ•™ç¨‹æˆ–å®éªŒæ€§é¡¹ç›®å­˜åœ¨ï¼Œå…¶ç›®çš„ä¸æ˜¯æ„å»ºç¤¾åŒºï¼Œè€Œæ˜¯å±•ç¤ºæŸç§æŠ€æœ¯æˆ–æ€æƒ³ã€‚æˆ‘å»ºè®®æ˜¯é€‰æ‹©ä¸æ¥å— <code>PR</code> , ä»è¿™ç‚¹æ¥è¯´ï¼Œè¿™ä¸ªé¡¹ç›®å¹¶ä¸èƒ½è¯´æ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œå¼€æºé¡¹ç›®â€ï¼Œè€Œæ˜¯ä¸€ä¸ªâ€œå¼€æ”¾æºç çš„ä¸ªäººä½œå“â€ï¼Œåœ¨æ˜¾çœ¼çš„åœ°æ–¹åŠ ä¸Šå£°æ˜ï¼š<strong>â—ï¸æ³¨æ„ï¼šæœ¬ä»“åº“ä¸æ¥å— Pull Request</strong> ï¼Œè¯·æ”¹ä¸ºæäº¤ <code>Issue</code> æ¥æè¿°ä½ çš„å»ºè®®æˆ–é—®é¢˜ã€‚</p>
</blockquote>
<h2 data-id="heading-8">äº”ã€ä»£ç æäº¤æ—¶çš„ä¸€äº›ç»†èŠ‚</h2>
<h3 data-id="heading-9">5.1. æ³¨æ„æ•°æ®å®‰å…¨</h3>
<p>å½“æˆ‘ä»¬å‡†å¤‡å°†é¡¹ç›®æ‰˜ç®¡åˆ° <code>GitHub</code> ä¸Šçš„æ—¶å€™ï¼Œä¸€å®šä¸€å®šè¦æ³¨æ„ï¼Œç‰¹åˆ«æ˜¯æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰çš„æ—¶å€™æœ¬åœ°å¼€å‘å›¾æ–¹ä¾¿ï¼Œç›´æ¥å°±æŠŠä¸€äº›è´¦å·å¯†ç ï¼Œç­¾åå¯†é’¥ï¼Œç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œäº†ï¼Œç¨æœ‰ç–å¿½å°±ä¼šæäº¤å‡ºå»ï¼Œç›´æ¥è£¸å¥”ã€‚</p>
<p>æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿™æ ·çš„ï¼šé€šè¿‡è¯»å–é…ç½®çš„ç¯å¢ƒå˜é‡æ¥åšã€‚</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">ez-admin-springboot4</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:ez_admin_db}?useUnicode=${DB_USE_UNICODE:true}&amp;characterEncoding=${DB_CHARSET:UTF-8}</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">${DB_USERNAME:postgres}</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">${DB_PASSWORD:postgres}</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">org.postgresql.Driver</span>
  <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">hibernate:</span>
      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span>
    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">hibernate:</span>
        <span class="hljs-attr">dialect:</span> <span class="hljs-string">org.hibernate.dialect.PostgreSQLDialect</span>
        <span class="hljs-attr">format_sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">open-in-view:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># æ˜¾å¼å¯ç”¨ OpenEntityManagerInViewï¼ˆæ¶ˆé™¤è­¦å‘Šï¼‰</span>
</code></pre>
<h3 data-id="heading-10">5.2. æäº¤æ—¶è´¦å·é…ç½®</h3>
<p>å…ˆçœ‹ä¸‹é¢è¿™å¼ å›¾ï¼Œé¦–å…ˆå£°æ˜è¿™ä¸ªé¡¹ç›®åªæœ‰æˆ‘ä¸€ä¸ªäººç»´æŠ¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86d2fbfae1fc405f9ecd7137b6b4f705~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=WuDaxn5uSWXi0pBB2ltxM%2Fc25UM%3D" alt="image-20251204100844915" loading="lazy"/></p>
<p>æ³¨æ„åˆ°ä¸¤ç‚¹ï¼š</p>
<ol>
<li>æ˜æ˜æ˜¯æˆ‘è‡ªå·±çš„ <code>Github</code> è´¦å·æäº¤ä¸Šå»çš„ï¼Œä¸ºä»€ä¹ˆä¸æ˜¾ç¤ºå¤´åƒ</li>
<li>ä¸ºä»€ä¹ˆæœ‰çš„æäº¤è®°å½•ä¸Šæœ‰ <code>Verified</code> æ ‡ç­¾ï¼Œæœ‰çš„æ²¡æœ‰ã€‚</li>
</ol>
<p><strong>ç¬¬ä¸€ç‚¹ï¼š</strong> æˆ‘é…ç½®äº† <code>GitHub</code> çš„æˆæƒï¼Œä½†æ˜¯å› ä¸ºå…¬å¸çš„é¡¹ç›®ï¼Œæˆ‘å…¨å±€è®¾ç½®äº†ç”¨æˆ·åå’Œé‚®ç®±ï¼Œå¯¼è‡´å®é™…çš„ç”¨æˆ·åå’Œé‚®ç®±ä¸ <code>GitHub</code> çš„ç”¨æˆ·åä¸åŒ¹é…äº†ï¼Œæ‰€ä»¥å‡ºç°äº†è¿™ç§æƒ…å†µï¼Œåªéœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œå±€éƒ¨æ›´æ”¹ä¸€ä¸‹</p>
<pre><code class="hljs language-bash" lang="bash">git config user.name <span class="hljs-string">"Your Name"</span>
git config user.email <span class="hljs-string">"project-email@company.com"</span>
</code></pre>
<p>æˆ‘è¯•äº†ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯ç”±é‚®ç®±å†³å®šçš„ï¼Œåç§°å…¶å®ä¸å½±å“ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d12e6904704427f917984d92c2d72e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=DaR%2FCMUykOi7%2BTKc2r7ZVyZ5MjY%3D" alt="image-20251204102933184" loading="lazy"/></p>
<p><strong>ç¬¬äºŒç‚¹ï¼š</strong> å¦‚æœæƒ³è¦æœ‰è¿™ä¸ªéªŒè¯æ ‡ç­¾ï¼Œå¯ä»¥è¯¦ç»†çœ‹ä¸€ä¸‹è¿™é‡Œï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fzh%2Fauthentication%2Fmanaging-commit-signature-verification%2Fabout-commit-signature-verification" target="_blank" title="https://docs.github.com/zh/authentication/managing-commit-signature-verification/about-commit-signature-verification" ref="nofollow noopener noreferrer">docs.github.com/zh/authentiâ€¦</a></p>
<blockquote>
<p>å…¶å®å¯¹äºæˆ‘è¿™ä¸ªé¡¹ç›®æ¥è¯´ï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåªæ˜¯çœ‹åˆ°äº†ï¼Œå°±å»äº†è§£äº†ä¸€ä¸‹ã€‚</p>
</blockquote>
<ul>
<li><strong>SSH å¯†é’¥ï¼šåƒæ˜¯ä½ å®¶çš„ã€é—¨ç¦å¡/é’¥åŒ™ã€‘</strong>
<ul>
<li><strong>ç›®çš„ï¼šèº«ä»½è®¤è¯ã€‚</strong> ç”¨äºè¯æ˜â€œä½ å°±æ˜¯ä½ â€ï¼Œä»è€Œè·å¾—è®¿é—®æƒé™ã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> åœ¨ GitHub/GitLab ä¸Šï¼Œç”¨å®ƒæ¥<strong>å®‰å…¨åœ°æ¨é€ä»£ç </strong>ï¼Œä»£æ›¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚å®ƒè®©ä½ èƒ½å¤Ÿä¸è¿œç¨‹ä»“åº“è¿›è¡Œè¯»å†™æ“ä½œï¼ˆå¦‚ <code>git push</code>, <code>git pull</code>ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>GPG å¯†é’¥ï¼šåƒæ˜¯ä½ æ–‡ä»¶ä¸Šçš„ã€å®˜æ–¹å°ç« å’Œèœ¡å°ã€‘</strong>
<ul>
<li><strong>ç›®çš„ï¼šæ•°å­—ç­¾åã€‚</strong> ç”¨äºè¯æ˜â€œè¿™ä»½æ–‡ä»¶ï¼ˆä»£ç ï¼‰ç¡®å®æ˜¯ä½ æœ¬äººå‘å¸ƒçš„ï¼Œå¹¶ä¸”åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹â€ã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯ï¼š</strong> ä¸ºä½ çš„ <strong>Git æäº¤</strong> å’Œ <strong>Tag</strong> åˆ›å»ºåŠ å¯†ç­¾åï¼Œä½¿å…¶åœ¨ GitHub ä¸Šæ˜¾ç¤ºä¸º <strong>â€œVerifiedâ€</strong> æ ‡è®°ã€‚å®ƒéªŒè¯çš„æ˜¯ä»£ç çš„å®Œæ•´æ€§å’Œæ¥æºã€‚</li>
</ul>
</li>
</ul>
<p><strong>å¯¹æ¯”è¡¨æ ¼ï¼š</strong></p>








































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">SSH å¯†é’¥</th><th align="left">GPG å¯†é’¥</th></tr></thead><tbody><tr><td align="left"><strong>ä¸»è¦ç”¨é€”</strong></td><td align="left"><strong>è®¤è¯</strong> - å®‰å…¨è®¿é—®æœåŠ¡å™¨/ä»£ç ä»“åº“</td><td align="left"><strong>ç­¾å</strong> - éªŒè¯æäº¤/æ ‡ç­¾çš„å®Œæ•´æ€§å’Œä½œè€…</td></tr><tr><td align="left"><strong>GitHub ä¸Šçš„ä½“ç°</strong></td><td align="left">å…è®¸ä½ æ‰§è¡Œ <code>git push</code>ç­‰æ“ä½œ</td><td align="left">åœ¨ä½ çš„æäº¤ä¸Šæ˜¾ç¤º <strong>Verified</strong> æ ‡è®°</td></tr><tr><td align="left"><strong>æ˜¯å¦å¿…é¡»</strong></td><td align="left"><strong>å¼ºçƒˆæ¨è</strong>ï¼ˆå‡ ä¹å¿…å¤‡ï¼Œä¸ºäº†å®‰å…¨å’Œæ–¹ä¾¿ï¼‰</td><td align="left"><strong>å¯é€‰</strong>ï¼ˆä¸ºäº†æ›´é«˜çš„å®‰å…¨æ€§å’Œä¸“ä¸šåº¦ï¼‰</td></tr><tr><td align="left"><strong>é…ç½®å¤æ‚åº¦</strong></td><td align="left">ç®€å•</td><td align="left">ç›¸å¯¹å¤æ‚</td></tr><tr><td align="left"><strong>å¯¹ä¸ªäººé¡¹ç›®çš„ä»·å€¼</strong></td><td align="left">é«˜ï¼ˆå®‰å…¨æ¨é€ä»£ç ï¼‰</td><td align="left">ä¸­ä½ï¼ˆé™¤éé¡¹ç›®éå¸¸ä¸¥è‚ƒæˆ–ç”¨äºåä½œï¼‰</td></tr><tr><td align="left"><strong>å¯¹å¼€æºåä½œé¡¹ç›®çš„ä»·å€¼</strong></td><td align="left">é«˜</td><td align="left">é«˜ï¼ˆå°¤å…¶æ˜¯å¤§å‹é¡¹ç›®ï¼Œç”¨äºç¡®ä¿æäº¤å¯ä¿¡ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-11">å…­ã€æ€»ç»“</h2>
<p>å½“æˆ‘ä»¬æƒ³è¦åšå¥½ä¸€ä¸ªäº§å“çš„æ—¶å€™ï¼Œæ€ç»´åªåœç•™åœ¨ç¼–ç å±‚é¢è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œåœ¨è¿›è¡Œç®¡ç†ï¼Œæ¨å¹¿ç­‰ç­‰ï¼Œå„æ–¹é¢æœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªæ­£åœ¨æ‘¸ç´¢çš„äººï¼Œæˆ‘å°½é‡å°†æˆ‘ç¢°åˆ°çš„é—®é¢˜å‘è¡¨å‡ºæ¥ï¼Œæˆ–è®¸æœ‰äº›ç‰‡é¢ï¼Œå¦‚æœä½ æœ‰ä¸€äº›æ›´å¥½çš„æ„è§æ¬¢è¿è¯„è®ºåŒºåˆ†äº«ã€‚</p>
<p><strong>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚ä½ çš„â€œä¸ªäººå…¬å¸â€ä»è¿™ç¬¬ä¸€ä¸ª2å°æ—¶å¼€å§‹ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„è¿›å±•æˆ–é‡åˆ°çš„å¡ç‚¹ï¼Œæˆ‘ä¼šé€ä¸€æŸ¥çœ‹ï¼Œå°½å¯èƒ½çš„å¸®åŠ©è§£å†³ã€‚æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java å†…éƒ¨ç±»æŒ‡å—]]></title>    <link>https://juejin.cn/post/7579496954252460072</link>    <guid>https://juejin.cn/post/7579496954252460072</guid>    <pubDate>2025-12-04T02:43:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579496954252460072" data-draft-id="7579496954252427304" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java å†…éƒ¨ç±»æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-04T02:43:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å‘¨åœ¨æˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/3632442150752573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java å†…éƒ¨ç±»æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3632442150752573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å‘¨åœ¨æˆé•¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:43:03.000Z" title="Thu Dec 04 2025 02:43:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ“Œ å†…éƒ¨ç±»æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>å®šä¹‰åœ¨<strong>å¦ä¸€ä¸ªç±»å†…éƒ¨</strong>çš„ç±»ï¼Œå¯ä»¥æ›´å¥½åœ°å°è£…å’Œä»£ç ç»„ç»‡ã€‚</p>
<h2 data-id="heading-1">ğŸ¯ å››ç§å†…éƒ¨ç±»ï¼ˆä¸€å¥è¯æ¦‚æ‹¬ï¼‰</h2>






























<table><thead><tr><th>ç±»å‹</th><th>å…³é”®å­—</th><th>ä¸€å¥è¯è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æˆå‘˜å†…éƒ¨ç±»</strong></td><td>æ— ç‰¹æ®Š</td><td>åƒæ™®é€šæˆå‘˜ä¸€æ ·ï¼Œä¾èµ–å¤–éƒ¨å®ä¾‹</td></tr><tr><td><strong>é™æ€å†…éƒ¨ç±»</strong></td><td><code>static</code></td><td>ä¸ä¾èµ–å¤–éƒ¨å®ä¾‹ï¼Œå¸¸ç”¨å·¥å…·ç±»</td></tr><tr><td><strong>å±€éƒ¨å†…éƒ¨ç±»</strong></td><td>å®šä¹‰åœ¨æ–¹æ³•å†…</td><td>æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œä¸èƒ½æœ‰è®¿é—®ä¿®é¥°ç¬¦</td></tr><tr><td><strong>åŒ¿åå†…éƒ¨ç±»</strong></td><td>æ— ç±»å</td><td>ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œç›´æ¥<code>new</code>æ¥å£/ç±»</td></tr></tbody></table>
<h2 data-id="heading-2">ğŸ’¡ 1. æˆå‘˜å†…éƒ¨ç±»ï¼ˆæœ€å¸¸ç”¨ï¼‰</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤–éƒ¨ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">outerField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"å¤–éƒ¨æ•°æ®"</span>;
    
    <span class="hljs-comment">// æˆå‘˜å†…éƒ¨ç±»</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"è®¿é—®å¤–éƒ¨æ•°æ®: "</span> + outerField);
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Outer</span> <span class="hljs-variable">outer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>();
        Outer.<span class="hljs-type">Inner</span> <span class="hljs-variable">inner</span> <span class="hljs-operator">=</span> outer.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>();  <span class="hljs-comment">// å…ˆæœ‰å¤–éƒ¨ï¼Œå†æœ‰å†…éƒ¨</span>
        inner.show();
    }
}
</code></pre>
<h2 data-id="heading-3">ğŸ’¡ 2. é™æ€å†…éƒ¨ç±»ï¼ˆæ¨èï¼‰</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-comment">// é™æ€å†…éƒ¨ç±»</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticInner</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"æˆ‘æ˜¯é™æ€å†…éƒ¨ç±»"</span>);
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ï¼ˆä¸éœ€è¦å¤–éƒ¨å®ä¾‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Outer.<span class="hljs-type">StaticInner</span> <span class="hljs-variable">inner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>.StaticInner();
        inner.show();
    }
}
</code></pre>
<h2 data-id="heading-4">ğŸ’¡ 3. å±€éƒ¨å†…éƒ¨ç±»ï¼ˆæ–¹æ³•å†…å®šä¹‰ï¼‰</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å±€éƒ¨å†…éƒ¨ç±»ï¼ˆåªèƒ½åœ¨æ–¹æ³•å†…ä½¿ç”¨ï¼‰</span>
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalInner</span> {
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"æˆ‘æ˜¯å±€éƒ¨å†…éƒ¨ç±»"</span>);
            }
        }
        
        <span class="hljs-type">LocalInner</span> <span class="hljs-variable">inner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalInner</span>();
        inner.show();
    }
}
</code></pre>
<h2 data-id="heading-5">ğŸ’¡ 4. åŒ¿åå†…éƒ¨ç±»ï¼ˆå¿«é€Ÿå®ç°æ¥å£ï¼‰</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åŒ¿åå†…éƒ¨ç±»ï¼šç›´æ¥newæ¥å£</span>
        <span class="hljs-type">Animal</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"æ±ªæ±ª"</span>);
            }
        };
        
        dog.makeSound();
        
        <span class="hljs-comment">// Java 8+ æ›´ç®€å•çš„å†™æ³•ï¼ˆLambdaï¼‰</span>
        <span class="hljs-type">Animal</span> <span class="hljs-variable">cat</span> <span class="hljs-operator">=</span> () -&gt; System.out.println(<span class="hljs-string">"å–µå–µ"</span>);
        cat.makeSound();
    }
}
</code></pre>
<h2 data-id="heading-6">ğŸ”‘ å…³é”®åŒºåˆ«é€ŸæŸ¥</h2>















































<table><thead><tr><th>ç‰¹æ€§</th><th>æˆå‘˜å†…éƒ¨ç±»</th><th>é™æ€å†…éƒ¨ç±»</th><th>å±€éƒ¨å†…éƒ¨ç±»</th><th>åŒ¿åå†…éƒ¨ç±»</th></tr></thead><tbody><tr><td><strong>éœ€è¦å¤–éƒ¨å®ä¾‹</strong></td><td>âœ… å¿…é¡»</td><td>âŒ ä¸éœ€è¦</td><td>âœ… éœ€è¦</td><td>âœ… éœ€è¦</td></tr><tr><td><strong>è®¿é—®å¤–éƒ¨å­—æ®µ</strong></td><td>âœ… å¯ä»¥</td><td>âŒ ä¸èƒ½*</td><td>âœ… å¯ä»¥</td><td>âœ… å¯ä»¥</td></tr><tr><td><strong>å®šä¹‰ä½ç½®</strong></td><td>ç±»ä¸­</td><td>ç±»ä¸­</td><td>æ–¹æ³•ä¸­</td><td>ç›´æ¥new</td></tr><tr><td><strong>è®¿é—®ä¿®é¥°ç¬¦</strong></td><td>å¯ä»¥æœ‰</td><td>å¯ä»¥æœ‰</td><td>ä¸èƒ½æœ‰</td><td>ä¸èƒ½æœ‰</td></tr><tr><td><strong>ä½¿ç”¨é¢‘ç‡</strong></td><td>ç»å¸¸</td><td>ç»å¸¸</td><td>è¾ƒå°‘</td><td>ç»å¸¸</td></tr></tbody></table>
<p>*é™æ€å†…éƒ¨ç±»å¯ä»¥é€šè¿‡åˆ›å»ºå¤–éƒ¨å®ä¾‹æ¥è®¿é—®</p>
<h2 data-id="heading-7">ğŸš€ å¿«é€Ÿé€‰æ‹©æŒ‡å—</h2>
<pre><code class="hljs language-markdown" lang="markdown">é—®ï¼šç”¨å“ªç§å†…éƒ¨ç±»ï¼Ÿ

<span class="hljs-bullet">1.</span> éœ€è¦å¤šæ¬¡ä½¿ç”¨ï¼Œä¸”å’Œå¤–éƒ¨ç±»ç›¸å…³ï¼Ÿ
<span class="hljs-bullet">   -</span> æ˜¯ â†’ ç”¨æˆå‘˜å†…éƒ¨ç±»
<span class="hljs-bullet">   -</span> å¦ â†’ ç»§ç»­

<span class="hljs-bullet">2.</span> åªæ˜¯å·¥å…·ç±»ï¼Œä¸ä¾èµ–å¤–éƒ¨å®ä¾‹ï¼Ÿ
<span class="hljs-bullet">   -</span> æ˜¯ â†’ ç”¨é™æ€å†…éƒ¨ç±» âœ…ï¼ˆæ¨èï¼‰
<span class="hljs-bullet">   -</span> å¦ â†’ ç»§ç»­

<span class="hljs-bullet">3.</span> åªåœ¨æŸä¸ªæ–¹æ³•é‡Œç”¨ï¼Ÿ
<span class="hljs-bullet">   -</span> æ˜¯ â†’ ç”¨å±€éƒ¨å†…éƒ¨ç±»
<span class="hljs-bullet">   -</span> å¦ â†’ ç»§ç»­

<span class="hljs-bullet">4.</span> ä¸€æ¬¡æ€§ä½¿ç”¨ï¼Œå®ç°æ¥å£ï¼Ÿ
<span class="hljs-bullet">   -</span> æ˜¯ â†’ ç”¨åŒ¿åå†…éƒ¨ç±»
</code></pre>
<h2 data-id="heading-8">ğŸ’ å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-9"><strong>åœºæ™¯1ï¼šè¿­ä»£å™¨ï¼ˆæˆå‘˜å†…éƒ¨ç±»ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyList</span> {
    <span class="hljs-keyword">private</span> String[] data = {<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>};
    
    <span class="hljs-comment">// å†…éƒ¨ç±»å®ç°è¿­ä»£å™¨</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIterator</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> index &lt; data.length; }
        String <span class="hljs-title function_">next</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> data[index++]; }
    }
    
    MyIterator <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyIterator</span>();
    }
}
</code></pre>
<h3 data-id="heading-10"><strong>åœºæ™¯2ï¼šå»ºé€ è€…æ¨¡å¼ï¼ˆé™æ€å†…éƒ¨ç±»ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(Builder builder)</span> { <span class="hljs-comment">/* ... */</span> }
    
    <span class="hljs-comment">// é™æ€å†…éƒ¨ç±»ä½œä¸ºå»ºé€ è€…</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">private</span> String name;
        
        Builder <span class="hljs-title function_">name</span><span class="hljs-params">(String name)</span> {
            <span class="hljs-built_in">this</span>.name = name;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }
        
        Person <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-built_in">this</span>);
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>.Builder().name(<span class="hljs-string">"å¼ ä¸‰"</span>).build();
</code></pre>
<h3 data-id="heading-11"><strong>åœºæ™¯3ï¼šäº‹ä»¶ç›‘å¬ï¼ˆåŒ¿åå†…éƒ¨ç±»ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java">button.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OnClickListener</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"æŒ‰é’®è¢«ç‚¹å‡»"</span>);
    }
});
</code></pre>
<h2 data-id="heading-12">âš ï¸ æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>æˆå‘˜å†…éƒ¨ç±»</strong>æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼Œæ³¨æ„å†…å­˜æ³„æ¼</li>
<li><strong>åŒ¿åå†…éƒ¨ç±»</strong>åªèƒ½è®¿é—®finalå±€éƒ¨å˜é‡</li>
<li><strong>é™æ€å†…éƒ¨ç±»</strong>ä¸èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨å®ä¾‹æˆå‘˜</li>
<li>å†…éƒ¨ç±»ç¼–è¯‘åç”Ÿæˆï¼š<code>Outer$Inner.class</code></li>
</ol>
<h2 data-id="heading-13">ğŸ“ ä¸€å¥è¯æ€»ç»“</h2>
<p><strong>æˆå‘˜å†…éƒ¨ç±»</strong>åƒæˆå‘˜ï¼Œ<strong>é™æ€å†…éƒ¨ç±»</strong>åƒå·¥å…·ï¼Œ<strong>å±€éƒ¨å†…éƒ¨ç±»</strong>åœ¨æ–¹æ³•é‡Œï¼Œ<strong>åŒ¿åå†…éƒ¨ç±»</strong>ä¸€æ¬¡ç”¨ã€‚å¤§éƒ¨åˆ†æƒ…å†µç”¨<strong>é™æ€å†…éƒ¨ç±»</strong>æœ€å®‰å…¨ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½œä¸ºå¼€å‘ï¼Œä½ çœŸçš„æ‡‚ OOM å—ï¼Ÿå®æµ‹ 3 ç§åœºæ™¯ï¼Œææ‡‚ JVM å´©æºƒçœŸç›¸]]></title>    <link>https://juejin.cn/post/7579544918076358691</link>    <guid>https://juejin.cn/post/7579544918076358691</guid>    <pubDate>2025-12-04T02:50:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579544918076358691" data-draft-id="7579485652528152611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½œä¸ºå¼€å‘ï¼Œä½ çœŸçš„æ‡‚ OOM å—ï¼Ÿå®æµ‹ 3 ç§åœºæ™¯ï¼Œææ‡‚ JVM å´©æºƒçœŸç›¸"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-04T02:50:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜è¥¿è¥¿"/> <meta itemprop="url" content="https://juejin.cn/user/326976944214804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½œä¸ºå¼€å‘ï¼Œä½ çœŸçš„æ‡‚ OOM å—ï¼Ÿå®æµ‹ 3 ç§åœºæ™¯ï¼Œææ‡‚ JVM å´©æºƒçœŸç›¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/326976944214804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜è¥¿è¥¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:50:13.000Z" title="Thu Dec 04 2025 02:50:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½œä¸ºäº’è”ç½‘è½¯ä»¶å¼€å‘åŒè¡Œï¼Œä½ æ˜¯ä¸æ˜¯ä¹Ÿé»˜è®¤ â€œä¸€æ—¦ JVM æŠ›å‡º OutOfMemoryErrorï¼Œæ•´ä¸ªåº”ç”¨å°±å‡‰äº†â€ï¼Ÿå‰å‡ å¤©å’Œå›¢é˜Ÿæ–°äººæ’æŸ¥çº¿ä¸Šé—®é¢˜ï¼Œä»–çœ‹åˆ°æ—¥å¿—é‡Œçš„ OOM å°±æ€¥ç€é‡å¯æœåŠ¡ï¼Œç»“æœåè€Œé”™è¿‡äº†å…³é”®çš„æ’æŸ¥æ—¶æœº â€”â€” åæ¥æˆ‘ä»¬æ‰å‘ç°ï¼Œå½“æ—¶åªæ˜¯æŸä¸ªéæ ¸å¿ƒçº¿ç¨‹å†…å­˜æº¢å‡ºï¼Œä¸»çº¿ç¨‹è¿˜åœ¨æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</p>
<p>å…¶å®åœ¨å®é™…å¼€å‘ä¸­ï¼Œâ€œOOM=JVM å´©æºƒâ€ çš„è®¤çŸ¥è¯¯åŒºï¼Œå·²ç»è®©ä¸å°‘äººè¸©è¿‡å‘ã€‚ä»Šå¤©å’±ä»¬å°±ç”¨ 3 ç»„ä»£ç å®éªŒï¼Œç»“åˆ JVM åº•å±‚æœºåˆ¶ï¼ŒæŠŠ â€œOOM å JVM èƒ½å¦è¿è¡Œâ€ è¿™ä»¶äº‹è®²é€ï¼Œä»¥åä¸ç®¡æ˜¯é¢è¯•è¢«é—®ï¼Œè¿˜æ˜¯çº¿ä¸Šæ’éšœï¼Œéƒ½èƒ½å¿ƒé‡Œæœ‰åº•ã€‚</p>
<h2 data-id="heading-1">å…ˆæŠ›ä¸ªé—®é¢˜ï¼šä¸ºå•¥æœ‰äººè¯´ OOM å JVM è¿˜èƒ½æ´»ï¼Ÿ</h2>
<p>ä½ è‚¯å®šé‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šæœ¬åœ°è°ƒè¯•æ—¶ï¼Œç¨‹åºæŠ›å‡º OOM åç›´æ¥é€€å‡ºï¼›ä½†å¶å°”åœ¨çº¿ä¸Šæ—¥å¿—é‡Œï¼Œå´èƒ½çœ‹åˆ° OOM æŠ¥é”™åï¼Œåº”ç”¨è¿˜åœ¨ç»§ç»­æ‰“å°å…¶ä»–çº¿ç¨‹çš„æ—¥å¿—ã€‚è¿™ä¸æ˜¯çŸ›ç›¾å—ï¼Ÿ</p>
<p>ä¹‹å‰æˆ‘ä¹Ÿå›°æƒ‘è¿‡ï¼Œç›´åˆ°ç¿»äº†ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹æ‰å‘ç°å…³é”®ï¼š<strong>OOM æœ¬è´¨æ˜¯ â€œçº¿ç¨‹çº§â€ çš„å†…å­˜å¼‚å¸¸ï¼Œä¸æ˜¯ â€œJVM çº§â€ çš„è‡´å‘½é”™è¯¯</strong>ã€‚ç®€å•è¯´ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨ç”³è¯·å†…å­˜æ—¶è§¦å‘ OOMï¼ŒJVM ä¼šå…ˆæ ‡è®°è¿™ä¸ªçº¿ç¨‹ä¸º â€œå¾…ç»ˆæ­¢â€ çŠ¶æ€ï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸ â€”â€” å¦‚æœè¿™ä¸ªçº¿ç¨‹ä¸æ˜¯ä¸»çº¿ç¨‹ï¼Œä¹Ÿä¸æ˜¯æŒæœ‰å…³é”®èµ„æºï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ï¼‰çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œé‚£å…¶ä»–çº¿ç¨‹å…¶å®èƒ½ç»§ç»­è¿è¡Œã€‚</p>
<p>ä½†è¿™é‡Œæœ‰ä¸ªå‰æï¼šè§¦å‘ OOM çš„å†…å­˜åŒºåŸŸï¼Œä¸èƒ½æ˜¯ â€œJVM è¿è¡Œå¿…éœ€çš„åŒºåŸŸâ€ã€‚æ¯”å¦‚æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰å¦‚æœå‘ç”Ÿ OOMï¼Œå¯èƒ½å¯¼è‡´ç±»åŠ è½½å¤±è´¥ï¼Œåç»­æ–°å¯¹è±¡åˆ›å»ºä¼šå—å½±å“ï¼›è€Œå †å†…å­˜çš„ OOMï¼Œåªè¦ä¸æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨æŠ¢å†…å­˜ï¼Œå°±æœ‰æŒ½å›ç©ºé—´ã€‚</p>
<h2 data-id="heading-2">3 ç»„ä»£ç å®éªŒï¼šçœ¼è§ä¸ºå®çœ‹ OOM å JVM çŠ¶æ€</h2>
<p>å…‰è¯´ç†è®ºä¸å¤Ÿï¼Œå’±ä»¬ç›´æ¥ä¸Šä»£ç ã€‚å®éªŒç¯å¢ƒæ˜¯ JDK 11ï¼ŒJVM å‚æ•°è®¾ç½®ä¸º-Xms16m -Xmx16mï¼ˆå †å†…å­˜å›ºå®š 16Mï¼Œæ–¹ä¾¿å¿«é€Ÿè§¦å‘ OOMï¼‰ï¼Œç”¨ jconsole ç›‘æ§çº¿ç¨‹å’Œå†…å­˜å˜åŒ–ã€‚</p>
<h2 data-id="heading-3">å®éªŒ 1ï¼šåŒå­çº¿ç¨‹ï¼Œä¸€ä¸ª OOMï¼Œä¸€ä¸ªæ­£å¸¸æ‰§è¡Œ</h2>
<p>å…ˆå†™ä¸¤ä¸ªçº¿ç¨‹ï¼šThreadA è´Ÿè´£å¾ªç¯åˆ›å»ºå¤§å¯¹è±¡ï¼ˆè§¦å‘å † OOMï¼‰ï¼ŒThreadB æ¯éš” 1 ç§’æ‰“å°æ—¥å¿—ï¼ˆéªŒè¯æ˜¯å¦å­˜æ´»ï¼‰ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OOMTest1</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// ThreadAï¼šè§¦å‘OOMçš„çº¿ç¨‹</span>
        Thread threadA = <span class="hljs-keyword">new</span> Thread(() -&gt; {
            List&lt;<span class="hljs-built_in">byte</span>[]&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// æ¯æ¬¡åˆ›å»º1Mçš„å­—èŠ‚æ•°ç»„ï¼Œå †å†…å­˜16Må¾ˆå¿«ä¼šæ»¡</span>
                <span class="hljs-built_in">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
                list.<span class="hljs-keyword">add</span>(bytes);
            }
        }, <span class="hljs-string">"OOM-Thread-A"</span>);

        <span class="hljs-comment">// ThreadBï¼šæ­£å¸¸æ‰§è¡Œçš„çº¿ç¨‹</span>
        Thread threadB = <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>);
                    count++;
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ThreadBç¬¬"</span> + count + <span class="hljs-string">"æ¬¡æ‰§è¡Œï¼Œå½“å‰æ—¶é—´ï¼š"</span> + System.currentTimeMillis());
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, <span class="hljs-string">"Normal-Thread-B"</span>);

        threadA.start();
        threadB.start();
    }
}
</code></pre>
<p><strong>å®éªŒç»“æœ</strong>ï¼š</p>
<ul>
<li>è¿è¡Œçº¦ 15 ç§’åï¼ŒThreadA æŠ›å‡ºjava.lang.OutOfMemoryError: Java heap spaceï¼Œéšåçº¿ç¨‹ç»ˆæ­¢ï¼›</li>
<li>ThreadB æ²¡æœ‰å—å½±å“ï¼Œç»§ç»­æ¯ç§’æ‰“å°æ—¥å¿—ï¼Œjconsole æ˜¾ç¤ºå…¶çŠ¶æ€å§‹ç»ˆä¸º â€œRUNNABLEâ€ï¼›</li>
<li>å †å†…å­˜å ç”¨ä» 16M å³°å€¼éª¤é™åˆ° 8M å·¦å³ï¼ˆThreadA çš„å¯¹è±¡è¢«å›æ”¶ï¼‰ï¼ŒJVM è¿›ç¨‹å§‹ç»ˆå­˜æ´»ã€‚</li>
</ul>
<p>è¿™è¯´æ˜ï¼š<strong>å•ä¸ªéæ ¸å¿ƒçº¿ç¨‹ OOMï¼Œä¸ä¼šå¯¼è‡´ JVM å´©æºƒï¼Œå…¶ä»–çº¿ç¨‹å¯æ­£å¸¸è¿è¡Œ</strong>ã€‚</p>
<h2 data-id="heading-4">å®éªŒ 2ï¼šä¸»çº¿ç¨‹ OOMï¼Œå­çº¿ç¨‹è¿˜èƒ½æ´»å—ï¼Ÿ</h2>
<p>é‚£å¦‚æœæ˜¯ä¸»çº¿ç¨‹ï¼ˆmain çº¿ç¨‹ï¼‰è§¦å‘ OOMï¼Œå­çº¿ç¨‹ä¼šä¸ä¼šè·Ÿç€æŒ‚ï¼Ÿå’±ä»¬æŠŠå®éªŒ 1 æ”¹ä¸€ä¸‹ï¼Œè®© main çº¿ç¨‹åˆ›å»ºå¤§å¯¹è±¡ï¼ŒThreadB ä¿æŒä¸å˜ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OOMTest2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// ä¸»çº¿ç¨‹è‡ªå·±åˆ›å»ºå¤§å¯¹è±¡ï¼Œè§¦å‘OOM</span>
        List&lt;<span class="hljs-built_in">byte</span>[]&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        <span class="hljs-comment">// ThreadBï¼šæ­£å¸¸æ‰§è¡Œçš„å­çº¿ç¨‹</span>
        Thread threadB = <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>);
                    count++;
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ThreadBç¬¬"</span> + count + <span class="hljs-string">"æ¬¡æ‰§è¡Œï¼Œå½“å‰æ—¶é—´ï¼š"</span> + System.currentTimeMillis());
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, <span class="hljs-string">"Normal-Thread-B"</span>);
        threadB.start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹å¾ªç¯åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-built_in">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-built_in">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
            list.<span class="hljs-keyword">add</span>(bytes);
        }
    }
}
</code></pre>
<p><strong>å®éªŒç»“æœ</strong>ï¼š</p>
<ul>
<li>ä¸»çº¿ç¨‹æŠ›å‡º OOM åç«‹å³ç»ˆæ­¢ï¼Œæ§åˆ¶å°æ‰“å°Exception in thread "main" java.lang.OutOfMemoryError: Java heap spaceï¼›</li>
<li>ThreadB ç»§ç»­è¿è¡Œäº†çº¦ 3 ç§’ï¼Œç„¶åçªç„¶ç»ˆæ­¢ï¼ŒJVM è¿›ç¨‹é€€å‡ºï¼›</li>
<li>jconsole ç›‘æ§æ˜¾ç¤ºï¼šä¸»çº¿ç¨‹ç»ˆæ­¢åï¼ŒJVM å¼€å§‹é”€æ¯éå®ˆæŠ¤çº¿ç¨‹ï¼ŒThreadB ä½œä¸ºéå®ˆæŠ¤çº¿ç¨‹è¢«å¼ºåˆ¶ä¸­æ–­ã€‚</li>
</ul>
<p>è¿™é‡Œè¦æ³¨æ„ï¼š<strong>Java ä¸­ä¸»çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹å—ï¼Ÿä¸æ˜¯ï¼</strong> Â å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»ˆæ­¢åï¼ŒJVM æ‰ä¼šé€€å‡ºã€‚ä½†ä¸»çº¿ç¨‹ç»ˆæ­¢åï¼Œå­çº¿ç¨‹å¦‚æœæ˜¯æ™®é€šéå®ˆæŠ¤çº¿ç¨‹ï¼Œç†è®ºä¸Šèƒ½ç»§ç»­è¿è¡Œ â€”â€” ä½†å®éªŒä¸­ ThreadB ä¸ºå•¥ä¼šé€€å‡ºï¼Ÿ</p>
<p>æŸ¥äº† JVM æºç æ‰å‘ç°ï¼šä¸»çº¿ç¨‹æŠ›å‡º OOM åï¼Œè™½ç„¶æ²¡æœ‰ä¸»åŠ¨å…³é—­å­çº¿ç¨‹ï¼Œä½† JVM åœ¨å¤„ç†ä¸»çº¿ç¨‹å¼‚å¸¸æ—¶ï¼Œä¼šæ£€æŸ¥ â€œæ˜¯å¦è¿˜æœ‰å…³é”®çº¿ç¨‹å­˜æ´»â€ã€‚å¦‚æœå­çº¿ç¨‹æ²¡æœ‰ç»‘å®šå¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚ Socketã€æ•°æ®åº“è¿æ¥ï¼‰ï¼ŒJVM å¯èƒ½ä¼šè§¦å‘ â€œä¼˜é›…é€€å‡ºâ€ æœºåˆ¶ï¼Œä¸»åŠ¨ä¸­æ–­å­çº¿ç¨‹ã€‚</p>
<h2 data-id="heading-5">å®éªŒ 3ï¼šå…ƒç©ºé—´ OOMï¼ŒJVM è¿˜èƒ½åˆ›å»ºæ–°å¯¹è±¡å—ï¼Ÿ</h2>
<p>å‰é¢æµ‹çš„æ˜¯å †å†…å­˜ OOMï¼Œé‚£æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰OOM å‘¢ï¼Ÿå…ƒç©ºé—´å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± ï¼Œå¦‚æœè¿™é‡Œæº¢å‡ºï¼ŒJVM è¿ç±»éƒ½åŠ è½½ä¸äº†ï¼Œè¿˜èƒ½æ­£å¸¸å·¥ä½œå—ï¼Ÿ</p>
<p>å’±ä»¬ç”¨ CGLIB åŠ¨æ€ç”Ÿæˆç±»ï¼Œè§¦å‘å…ƒç©ºé—´ OOMï¼ˆJVM å‚æ•°è®¾ç½®-XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=10mï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OOMTest3</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer();
        enhancer.setSuperclass(OOMTest3.<span class="hljs-keyword">class</span>);
        enhancer.setUseCache(<span class="hljs-literal">false</span>);
        <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// å­çº¿ç¨‹ï¼šå°è¯•åˆ›å»ºæ–°å¯¹è±¡</span>
        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>);
                    <span class="hljs-comment">// æ¯æ¬¡åˆ›å»ºä¸€ä¸ªOOMTest3çš„å®ä¾‹</span>
                    OOMTest3 test = <span class="hljs-keyword">new</span> OOMTest3();
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æˆåŠŸåˆ›å»ºOOMTest3å®ä¾‹ï¼Œå½“å‰æ—¶é—´ï¼š"</span> + System.currentTimeMillis());
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"åˆ›å»ºå¯¹è±¡å¤±è´¥ï¼š"</span> + e.getMessage());
                    e.printStackTrace();
                }
            }
        }, <span class="hljs-string">"Object-Create-Thread"</span>).start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹ï¼šåŠ¨æ€ç”Ÿæˆç±»ï¼Œè§¦å‘å…ƒç©ºé—´OOM</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            count++;
            enhancer.setCallbackFilter((method) -&gt; <span class="hljs-number">1</span>);
            enhancer.setCallbacks(<span class="hljs-keyword">new</span> Callback[]{NoOp.INSTANCE});
            Class&lt;?&gt; clazz = enhancer.createClass();
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ç¬¬"</span> + count + <span class="hljs-string">"æ¬¡ç”Ÿæˆç±»ï¼š"</span> + clazz.getName());
        }
    }
}
</code></pre>
<p><strong>å®éªŒç»“æœ</strong>ï¼š</p>
<ul>
<li>ä¸»çº¿ç¨‹ç”Ÿæˆçº¦ 500 ä¸ªç±»åï¼ŒæŠ›å‡ºjava.lang.OutOfMemoryError: Metaspaceï¼Œéšåç»ˆæ­¢ï¼›</li>
<li>å­çº¿ç¨‹ä¸€å¼€å§‹èƒ½æ­£å¸¸åˆ›å»º OOMTest3 å®ä¾‹ï¼Œä½†çº¦ 10 ç§’åï¼ŒæŠ›å‡ºjava.lang.OutOfMemoryError: Metaspaceï¼Œæ— æ³•åˆ›å»ºæ–°å¯¹è±¡ï¼›</li>
<li>JVM è¿›ç¨‹æ²¡æœ‰ç«‹å³é€€å‡ºï¼Œä½†å·²æ— æ³•æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡ï¼ˆåˆ›å»ºå¯¹è±¡å¤±è´¥ï¼‰ï¼Œç›¸å½“äº â€œåŠæ­»äº¡â€ çŠ¶æ€ã€‚</li>
</ul>
<p>è¿™è¯´æ˜ï¼š<strong>å…ƒç©ºé—´ç­‰ â€œJVM æ ¸å¿ƒåŒºåŸŸâ€ OOMï¼Œå³ä½¿çº¿ç¨‹æ²¡å…¨æŒ‚ï¼ŒJVM ä¹Ÿä¼šå¤±å»æ ¸å¿ƒåŠŸèƒ½ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦é‡å¯</strong>ã€‚</p>
<h2 data-id="heading-6">é‡åˆ° OOMï¼Œåˆ«å†ç›²ç›®é‡å¯äº†ï¼</h2>
<p>çœ‹å®Œå®éªŒï¼Œä½ åº”è¯¥æ˜ç™½ï¼šOOM åè¦ä¸è¦é‡å¯ï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®ºã€‚è¿™é‡Œç»™ä½  3 ä¸ªå®æˆ˜å¤„ç†æ­¥éª¤ï¼Œå¸®ä½ å‡å°‘ä¸å¿…è¦çš„æœåŠ¡ä¸­æ–­ï¼š</p>
<h2 data-id="heading-7">1. å…ˆåˆ¤æ–­ OOM çš„å†…å­˜åŒºåŸŸå’Œçº¿ç¨‹ç±»å‹</h2>
<ul>
<li>çœ‹æ—¥å¿—é‡Œçš„ OOM ç±»å‹ï¼šå¦‚æœæ˜¯Java heap spaceï¼ˆå †å†…å­˜ï¼‰ï¼Œä¸”æŠ¥é”™çº¿ç¨‹æ˜¯ â€œå®šæ—¶ä»»åŠ¡çº¿ç¨‹â€â€œæ—¥å¿—æ”¶é›†çº¿ç¨‹â€ ç­‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œå¯ä»¥å…ˆä¸é‡å¯ï¼Œè§‚å¯Ÿå…¶ä»–çº¿ç¨‹æ˜¯å¦æ­£å¸¸ï¼›</li>
<li>å¦‚æœæ˜¯Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰ã€Direct buffer memoryï¼ˆç›´æ¥å†…å­˜ï¼‰ï¼Œæˆ–è€…æŠ¥é”™çº¿ç¨‹æ˜¯ â€œä¸»çº¿ç¨‹â€â€œè¯·æ±‚å¤„ç†çº¿ç¨‹â€ï¼Œå»ºè®®ç«‹å³é‡å¯ï¼Œé¿å…æ•…éšœæ‰©å¤§ã€‚</li>
</ul>
<h2 data-id="heading-8">2. ç´§æ€¥æ’æŸ¥ï¼šç”¨å·¥å…·æŠ“å†…å­˜å¿«ç…§</h2>
<p>å¦‚æœå†³å®šä¸ç«‹å³é‡å¯ï¼Œä¸€å®šè¦æŠ“ç´§æ—¶é—´æŠ“å†…å­˜å¿«ç…§ï¼ˆjmapï¼‰å’Œçº¿ç¨‹ dumpï¼ˆjstackï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŠ“å†…å­˜å¿«ç…§ï¼ˆpidæ˜¯JVMè¿›ç¨‹å·ï¼‰</span>
jmap -dump:<span class="hljs-attr">format</span>=b,file=heap.hprof [pid]
<span class="hljs-comment"># æŠ“çº¿ç¨‹dump</span>
jstack <span class="hljs-section">[pid]</span> &gt; thread_dump.txt
</code></pre>
<p>è¿™äº›æ–‡ä»¶èƒ½å¸®ä½ å®šä½ â€œå“ªä¸ªå¯¹è±¡å äº†å¤ªå¤šå†…å­˜â€â€œå“ªä¸ªçº¿ç¨‹åœ¨ç–¯ç‹‚ç”³è¯·èµ„æºâ€ï¼Œåç»­ä¼˜åŒ–æ‰æœ‰çš„æ”¾çŸ¢ã€‚</p>
<h2 data-id="heading-9">3. é•¿æœŸä¼˜åŒ–ï¼šç»™å…³é”®çº¿ç¨‹åŠ  â€œå†…å­˜ä¿æŠ¤â€</h2>
<p>çº¿ä¸ŠæœåŠ¡å¯ä»¥æå‰åšé˜²æŠ¤ï¼š</p>
<ul>
<li>ç»™éæ ¸å¿ƒçº¿ç¨‹è®¾ç½® â€œå†…å­˜ä½¿ç”¨ä¸Šé™â€ï¼Œæ¯”å¦‚ç”¨ThreadLocalæ§åˆ¶å•ä¸ªçº¿ç¨‹çš„å¯¹è±¡åˆ›å»ºæ•°é‡ï¼›</li>
<li>å¯¹æ ¸å¿ƒçº¿ç¨‹ï¼ˆå¦‚è¯·æ±‚å¤„ç†çº¿ç¨‹ï¼‰ï¼Œåœ¨ä»£ç ä¸­åŠ  â€œå†…å­˜æ£€æŸ¥â€ï¼Œæ¯”å¦‚å®šæœŸè°ƒç”¨ManagementFactory.getMemoryMXBean()æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ¥è¿‘é˜ˆå€¼æ—¶ä¸»åŠ¨é‡Šæ”¾èµ„æºã€‚</li>
</ul>
<h2 data-id="heading-10">æ€»ç»“ï¼šè®°ä½è¿™ 3 ä¸ªæ ¸å¿ƒç»“è®ºï¼Œé¢è¯•æ’éšœéƒ½æœ‰ç”¨</h2>
<ol>
<li><strong>OOM ä¸æ˜¯ JVM çš„ â€œæ­»åˆ‘åˆ¤å†³â€</strong> ï¼šå•ä¸ªéæ ¸å¿ƒçº¿ç¨‹çš„å †å†…å­˜ OOMï¼Œä¸ä¼šå¯¼è‡´ JVM å´©æºƒï¼Œå…¶ä»–çº¿ç¨‹å¯æ­£å¸¸è¿è¡Œï¼›</li>
<li><strong>æ ¸å¿ƒåŒºåŸŸ OOM å¿…é¡»é‡å¯</strong>ï¼šå…ƒç©ºé—´ã€ç›´æ¥å†…å­˜ç­‰åŒºåŸŸ OOMï¼Œä¼šè®© JVM å¤±å»æ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ’‘ç€ä¹Ÿæ²¡ç”¨ï¼›</li>
<li><strong>æ’éšœåˆ«æ…Œï¼Œå…ˆçœ‹æ—¥å¿—å’Œçº¿ç¨‹</strong>ï¼šé‡åˆ° OOM å…ˆçœ‹ â€œå“ªä¸ªçº¿ç¨‹ã€å“ªä¸ªå†…å­˜åŒºåŸŸâ€ å‡ºé—®é¢˜ï¼Œå†å†³å®šæ˜¯å¦é‡å¯ï¼Œè®°å¾—æŠ“å¿«ç…§ç•™è¯æ®ã€‚</li>
</ol>
<p>æœ€åæƒ³é—®é—®ä½ ï¼šä½ ä¹‹å‰åœ¨çº¿ä¸Šé‡åˆ°è¿‡ OOM å—ï¼Ÿå½“æ—¶æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿæœ‰æ²¡æœ‰è¸©è¿‡ â€œç›²ç›®é‡å¯â€ çš„å‘ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»å†ï¼Œå’±ä»¬ä¸€èµ·äº¤æµæ›´å¤š JVM æ’éšœæŠ€å·§ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agentå¹³å°æ¶ˆæ¯èŠ‚ç‚¹è¾“å‡ºè®¾è®¡æ€è·¯]]></title>    <link>https://juejin.cn/post/7579673620940701746</link>    <guid>https://juejin.cn/post/7579673620940701746</guid>    <pubDate>2025-12-04T02:50:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620940701746" data-draft-id="7579544295344504883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agentå¹³å°æ¶ˆæ¯èŠ‚ç‚¹è¾“å‡ºè®¾è®¡æ€è·¯"/> <meta itemprop="keywords" content="åç«¯,Python,Agent"/> <meta itemprop="datePublished" content="2025-12-04T02:50:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sivdead"/> <meta itemprop="url" content="https://juejin.cn/user/3579665589488904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agentå¹³å°æ¶ˆæ¯èŠ‚ç‚¹è¾“å‡ºè®¾è®¡æ€è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3579665589488904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sivdead
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:50:01.000Z" title="Thu Dec 04 2025 02:50:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨Agentå¹³å°çš„å·¥ä½œæµç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†å¤šä¸ªèŠ‚ç‚¹çš„è¾“å‡ºç»„åˆæˆä¸€æ¡æ¶ˆæ¯å±•ç¤ºç»™ç”¨æˆ·ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª AI åˆ†æèŠ‚ç‚¹ç”Ÿæˆæµå¼æ–‡æœ¬ï¼Œä¸€ä¸ªä»£ç æ‰§è¡ŒèŠ‚ç‚¹è¿”å›è®¡ç®—ç»“æœï¼Œæˆ‘ä»¬å¸Œæœ›å°†å®ƒä»¬æŒ‰é¡ºåºç»„åˆæˆï¼š"AIåˆ†æï¼š{æµå¼æ–‡æœ¬}\n\nè®¡ç®—ç»“æœï¼š{æ ‡é‡å€¼}"ã€‚</p>
<p>è¿™çœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼Œå®é™…ä¸Šæ¶‰åŠå‡ ä¸ªæ ¸å¿ƒæŒ‘æˆ˜ï¼š</p>
<ol>
<li><strong>æ··åˆæ•°æ®æº</strong>ï¼šå¦‚ä½•åŒæ—¶å¤„ç†æµå¼æ•°æ®ï¼ˆé€å—åˆ°è¾¾ï¼‰å’Œæ ‡é‡æ•°æ®ï¼ˆä¸€æ¬¡æ€§å®Œæˆï¼‰ï¼Ÿ</li>
<li><strong>é¡ºåºä¿è¯</strong>ï¼šå¦‚ä½•ç¡®ä¿è¾“å‡ºä¸¥æ ¼æŒ‰ç…§æ¨¡æ¿ä¸­å˜é‡å‡ºç°çš„é¡ºåºæ¨é€ï¼Ÿ</li>
<li><strong>ä¾èµ–ç®¡ç†</strong>ï¼šå¦‚ä½•çŸ¥é“ä½•æ—¶å¯ä»¥å¼€å§‹æ¨é€ï¼Ÿå¦‚ä½•ç­‰å¾…æœªå°±ç»ªçš„æ•°æ®ï¼Ÿ</li>
<li><strong>è§£è€¦è®¾è®¡</strong>ï¼šå¦‚ä½•è®©æ¶ˆæ¯èŠ‚ç‚¹ä¸éœ€è¦çŸ¥é“å…·ä½“å¼•ç”¨äº†å“ªäº›èŠ‚ç‚¹ï¼Ÿ</li>
</ol>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ä¸€ä¸ªåŸºäº<strong>ç¼–è¯‘æ—¶-è¿è¡Œæ—¶åˆ†ç¦»</strong>å’Œ<strong>æ‹¦æˆªæœºåˆ¶</strong>çš„æµå¼è¾“å‡ºè®¾è®¡æ–¹æ¡ˆã€‚</p>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šæœ¬æ–‡çš„è®¾è®¡æ€è·¯å‚è€ƒäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.dify.ai%2F" target="_blank" title="https://docs.dify.ai/" ref="nofollow noopener noreferrer">Dify</a> çš„ StreamCoordinator æ¨¡å—è®¾è®¡ã€‚Dify æ˜¯ä¸€ä¸ª AI åŸç”Ÿåº”ç”¨å¼€å‘å¹³å°ï¼Œå…¶å·¥ä½œæµå¼•æ“ä¸­çš„å›ç­”èŠ‚ç‚¹ï¼ˆAnswer Nodeï¼‰é‡‡ç”¨äº†ç±»ä¼¼çš„æµå¼è¾“å‡ºåè°ƒæœºåˆ¶ï¼Œé€šè¿‡æ‹¦æˆªä¸Šæ¸¸èŠ‚ç‚¹çš„è¾“å‡ºå¹¶æŒ‰æ¨¡æ¿é¡ºåºæ¨é€ï¼Œå®ç°äº†é«˜æ•ˆçš„æµå¼è¾“å‡ºä½“éªŒã€‚æœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†æ¶æ„ä¼˜åŒ–å’Œå®ç°ç»†èŠ‚çš„é˜è¿°ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">é—®é¢˜åœºæ™¯</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå·¥ä½œæµï¼ŒåŒ…å«ä»¥ä¸‹èŠ‚ç‚¹ï¼š</p>
<ul>
<li><strong>LLM èŠ‚ç‚¹</strong>ï¼šç”Ÿæˆ AI åˆ†æï¼Œè¾“å‡ºæ˜¯æµå¼çš„ï¼ˆé€ token è¿”å›ï¼‰</li>
<li><strong>ä»£ç æ‰§è¡ŒèŠ‚ç‚¹</strong>ï¼šæ‰§è¡Œè®¡ç®—ï¼Œè¾“å‡ºæ˜¯æ ‡é‡çš„ï¼ˆä¸€æ¬¡æ€§è¿”å›ï¼‰</li>
<li><strong>æ¶ˆæ¯èŠ‚ç‚¹</strong>ï¼šå°†ä¸¤è€…ç»„åˆï¼Œæ¨¡æ¿ä¸º <code>"AIåˆ†æï¼š{llm_output}\n\nè®¡ç®—ç»“æœï¼š{code_result}"</code></li>
</ul>
<p>æˆ‘ä»¬å¸Œæœ›å®ç°çš„æ•ˆæœæ˜¯ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">æ—¶é—´è½´ <span class="hljs-operator">â”‚</span> å‰ç«¯æ¥æ”¶åˆ°çš„è¾“å‡º
<span class="hljs-operator">â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
  <span class="hljs-type">T1</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼š"</span>
  <span class="hljs-type">T2</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI"</span>
  <span class="hljs-type">T3</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks"</span>
  <span class="hljs-type">T4</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks..."</span>
  <span class="hljs-type">T5</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks...<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š"</span>
  <span class="hljs-type">T6</span>  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks...<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š42"</span>
</code></pre>
<p>æ³¨æ„å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>æ–‡æœ¬æ®µç«‹å³æ¨é€</strong>ï¼š<code>"AIåˆ†æï¼š"</code> åœ¨ç¬¬ä¸€ä¸ªå˜é‡æ•°æ®åˆ°è¾¾å‰å°±å¯ä»¥æ¨é€</li>
<li><strong>æµå¼æ•°æ®å®æ—¶è½¬å‘</strong>ï¼šLLM çš„æ¯ä¸ª token åˆ°è¾¾åç«‹å³è½¬å‘</li>
<li><strong>ç­‰å¾…æ ‡é‡æ•°æ®</strong>ï¼š<code>"è®¡ç®—ç»“æœï¼š"</code> æ¨é€åï¼Œå¿…é¡»ç­‰å¾…ä»£ç èŠ‚ç‚¹å®Œæˆæ‰èƒ½æ¨é€ <code>42</code></li>
<li><strong>ä¸¥æ ¼é¡ºåº</strong>ï¼šå³ä½¿ä»£ç èŠ‚ç‚¹å…ˆå®Œæˆï¼Œä¹Ÿå¿…é¡»ç­‰ LLM æµå¼è¾“å‡ºå®Œæˆåå†æ¨é€</li>
</ol>
<hr/>
<h2 data-id="heading-2">è®¾è®¡æ€è·¯</h2>
<blockquote>
<p><strong>å‚è€ƒè¯´æ˜</strong>ï¼šæœ¬è®¾è®¡å‚è€ƒäº† Dify çš„ StreamCoordinator è®¾è®¡ç†å¿µï¼Œç‰¹åˆ«æ˜¯å…¶"æŒ‰å˜é‡åœ¨æ¨¡æ¿ä¸­çš„ä½ç½®å†³å®šæµå¼è¾“å‡ºé¡ºåº"çš„æ ¸å¿ƒæ€æƒ³ã€‚</p>
</blockquote>
<h3 data-id="heading-3">æ ¸å¿ƒæ€æƒ³ï¼šæ‹¦æˆªä¸åè°ƒ</h3>
<p>åœ¨çŠ¶æ€é©±åŠ¨çš„å·¥ä½œæµç³»ç»Ÿä¸­ï¼Œä¼ ç»Ÿæ–¹æ¡ˆå¯èƒ½æ˜¯ï¼š</p>
<ul>
<li><strong>ç­‰å¾…æ‰€æœ‰ä¸Šæ¸¸èŠ‚ç‚¹å®Œæˆ</strong>ï¼šæ¶ˆæ¯èŠ‚ç‚¹æ‰§è¡Œæ—¶ï¼Œç­‰å¾…æ‰€æœ‰ä¸Šæ¸¸èŠ‚ç‚¹å®Œæˆåï¼Œä¸€æ¬¡æ€§ç»„è£…æ‰€æœ‰è¾“å‡º</li>
<li><strong>ä¸€æ¬¡æ€§æ¨é€</strong>ï¼šæ— æ³•å®ç°æµå¼è¾“å‡ºï¼Œå› ä¸ºå¿…é¡»ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œæˆæ‰èƒ½æ¨é€</li>
<li><strong>æ—¶åºé™åˆ¶</strong>ï¼šæµå¼èŠ‚ç‚¹ï¼ˆå¦‚ LLMï¼‰çš„è¾“å‡ºå¿…é¡»ç­‰åˆ°æ‰€æœ‰èŠ‚ç‚¹å®Œæˆåæ‰èƒ½å±•ç¤ºï¼Œç”¨æˆ·ä½“éªŒå·®</li>
</ul>
<p>æˆ‘ä»¬çš„æ–¹æ¡ˆåœ¨ <strong>workflow ä¹‹å¤–é¢å¤–è®¾è®¡äº†ä¸€ä¸ªåè°ƒå±‚</strong>ï¼Œå®ƒç‹¬ç«‹äº workflow çš„è¿è¡Œæœºåˆ¶ï¼š</p>
<ul>
<li><strong>ç‹¬ç«‹åè°ƒå±‚</strong>ï¼šåè°ƒå™¨ï¼ˆStreamCoordinatorï¼‰ä¸å‚ä¸ workflow çš„çŠ¶æ€æµè½¬ï¼Œè€Œæ˜¯ä½œä¸ºç‹¬ç«‹çš„åè°ƒç»„ä»¶è¿è¡Œ</li>
<li><strong>æ‹¦æˆªæœºåˆ¶</strong>ï¼šä¸Šæ¸¸èŠ‚ç‚¹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸»åŠ¨é€šçŸ¥åè°ƒå™¨ï¼Œåè°ƒå™¨è´Ÿè´£æŒ‰æ¨¡æ¿é¡ºåºå®æ—¶ç»„è£…å’Œæ¨é€</li>
<li><strong>è§£è€¦è®¾è®¡</strong>ï¼šæ¶ˆæ¯èŠ‚ç‚¹ä¸éœ€è¦çŸ¥é“ä¸Šæ¸¸èŠ‚ç‚¹çš„æ‰§è¡Œç»†èŠ‚ï¼Œåè°ƒå±‚è´Ÿè´£å¤„ç†æ‰€æœ‰ç»„è£…é€»è¾‘</li>
<li><strong>å®æ—¶æ¨é€</strong>ï¼šæµå¼æ•°æ®åˆ°è¾¾æ—¶ç«‹å³æ¨é€ï¼Œæ— éœ€ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œæˆ</li>
<li><strong>çµæ´»ç»„åˆ</strong>ï¼šå¯ä»¥æ··åˆå¤„ç†æµå¼æ•°æ®å’Œæ ‡é‡æ•°æ®ï¼ŒæŒ‰æ¨¡æ¿é¡ºåºé€æ®µæ¨é€</li>
</ul>
<p>è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿åœ¨äºï¼š<strong>åè°ƒå±‚ä¸ workflow è§£è€¦</strong>ï¼Œworkflow ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„æ‰§è¡Œï¼Œåè°ƒå±‚ä¸“æ³¨äºæµå¼è¾“å‡ºçš„ç»„è£…å’Œæ¨é€ï¼Œä¸¤è€…é€šè¿‡è½»é‡çº§çš„æ‹¦æˆªæ¥å£äº¤äº’ã€‚</p>
<h3 data-id="heading-4">æ¶æ„åˆ†å±‚ï¼šç¼–è¯‘æ—¶ vs è¿è¡Œæ—¶</h3>
<p>ç³»ç»Ÿé‡‡ç”¨<strong>ç¼–è¯‘æ—¶-è¿è¡Œæ—¶åˆ†ç¦»</strong>çš„æ¶æ„ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¼–è¯‘æ—¶ï¼ˆGraph Buildï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è§£ææ¨¡æ¿ï¼Œæå–å˜é‡å’Œæ–‡æœ¬æ®µ                            â”‚
â”‚ 2. å»ºç«‹å˜é‡åˆ°èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»                              â”‚
â”‚ 3. æ³¨å†Œæ‹¦æˆªè§„åˆ™ï¼ˆå“ªäº›èŠ‚ç‚¹éœ€è¦è¢«æ‹¦æˆªï¼‰                    â”‚
â”‚ 4. æ„å»ºåå‘ç´¢å¼•ï¼ˆä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½è¢«å¤šä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è¿è¡Œæ—¶ï¼ˆGraph Executionï¼‰                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åˆ›å»ºåè°ƒå™¨å®ä¾‹ï¼ˆç»´æŠ¤è¿è¡Œæ—¶çŠ¶æ€ï¼‰                       â”‚
â”‚ 2. ä¸Šæ¸¸èŠ‚ç‚¹æ‰§è¡Œæ—¶ï¼Œè°ƒç”¨åè°ƒå™¨æ‹¦æˆªè¾“å‡º                     â”‚
â”‚ 3. åè°ƒå™¨æŒ‰æ¨¡æ¿é¡ºåºç»„è£…å¹¶æ¨é€                            â”‚
â”‚ 4. æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾åè°ƒå™¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<ul>
<li><strong>ç¼–è¯‘æ—¶</strong>ï¼šæ— çŠ¶æ€ï¼Œåªå­˜å‚¨"è®¢é˜…å…³ç³»"ï¼Œå¯ä»¥å¤ç”¨ï¼Œæ— éœ€æŒä¹…åŒ–</li>
<li><strong>è¿è¡Œæ—¶</strong>ï¼šæœ‰çŠ¶æ€ï¼Œç»´æŠ¤ç¼“å†²åŒºã€ä¼šè¯ç­‰ï¼Œæ¯æ¬¡æ‰§è¡Œç‹¬ç«‹åˆ›å»ºï¼Œæ”¯æŒåºåˆ—åŒ–ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰</li>
<li><strong>ç‹¬ç«‹äº workflow</strong>ï¼šåè°ƒå±‚ä¸å‚ä¸ workflow çš„çŠ¶æ€æµè½¬ï¼Œè€Œæ˜¯ä½œä¸ºç‹¬ç«‹çš„åè°ƒç»„ä»¶ï¼Œé€šè¿‡æ‹¦æˆªæ¥å£ä¸ workflow äº¤äº’ã€‚è¿™æ · workflow å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œåè°ƒå±‚ä¸“æ³¨äºæµå¼è¾“å‡ºçš„ç»„è£…å’Œæ¨é€</li>
</ul>
<hr/>
<h2 data-id="heading-5">æ ¸å¿ƒç»„ä»¶è®¾è®¡</h2>
<h3 data-id="heading-6">1. æ¨¡æ¿è§£æï¼šä»å­—ç¬¦ä¸²åˆ°æ®µåºåˆ—</h3>
<p>æ¨¡æ¿ <code>"AIåˆ†æï¼š{llm_output}\n\nè®¡ç®—ç»“æœï¼š{code_result}"</code> éœ€è¦è§£æä¸ºæ®µåºåˆ—ï¼š</p>
<pre><code class="hljs language-python" lang="python">[
    TextSegment(text=<span class="hljs-string">"AIåˆ†æï¼š"</span>),
    VariableSegment(variable_name=<span class="hljs-string">"llm_output"</span>, node_id=<span class="hljs-string">"llm_1"</span>, node_variable=<span class="hljs-string">"text"</span>),
    TextSegment(text=<span class="hljs-string">"\n\nè®¡ç®—ç»“æœï¼š"</span>),
    VariableSegment(variable_name=<span class="hljs-string">"code_result"</span>, node_id=<span class="hljs-string">"code_1"</span>, node_variable=<span class="hljs-string">"result"</span>)
]
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ–‡æœ¬æ®µ</strong>ï¼šå›ºå®šæ–‡æœ¬ï¼Œå¯ä»¥ç«‹å³æ¨é€</li>
<li><strong>å˜é‡æ®µ</strong>ï¼šéœ€è¦ç­‰å¾…ä¸Šæ¸¸èŠ‚ç‚¹æ•°æ®ï¼ŒåŒ…å«å˜é‡åã€èŠ‚ç‚¹IDã€è¾“å‡ºå˜é‡è·¯å¾„</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ®µåºåˆ—ï¼Ÿ</strong></p>
<p>æ®µåºåˆ—å®šä¹‰äº†æ¨é€çš„<strong>ä¸¥æ ¼é¡ºåº</strong>ã€‚åè°ƒå™¨æŒ‰ç´¢å¼•é€æ®µå¤„ç†ï¼Œé‡åˆ°æœªå°±ç»ªçš„å˜é‡æ®µæ—¶åœæ­¢ï¼Œä¿è¯é¡ºåºã€‚</p>
<h3 data-id="heading-7">2. æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰ï¼šç¼–è¯‘æ—¶çš„è®¢é˜…å…³ç³»</h3>
<p>æ³¨å†Œè¡¨åœ¨ç¼–è¯‘æ—¶æ„å»ºï¼Œå­˜å‚¨ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamCoordinatorRegistry</span>:
    <span class="hljs-comment"># æ‹¦æˆªè§„åˆ™ï¼š{message_node_id: InterceptionRule}</span>
    _interception_rules: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, InterceptionRule]
    
    <span class="hljs-comment"># åå‘ç´¢å¼•ï¼š{node_id: [message_node_ids]}</span>
    <span class="hljs-comment"># ä¾‹å¦‚ï¼š{"llm_1": ["msg_1", "msg_2"]} è¡¨ç¤º llm_1 è¢«ä¸¤ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</span>
    _node_to_messages: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]]
</code></pre>
<p><strong>å…³é”®æ–¹æ³•ï¼š</strong></p>
<ul>
<li><code>register_interception()</code>ï¼šæ³¨å†Œæ‹¦æˆªè§„åˆ™ï¼ˆæ¶ˆæ¯èŠ‚ç‚¹åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰</li>
<li><code>is_intercepted(node_id)</code>ï¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¢«ä»»ä½•æ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</li>
<li><code>get_message_nodes_for(node_id)</code>ï¼šè·å–å¼•ç”¨äº†æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰æ¶ˆæ¯èŠ‚ç‚¹</li>
</ul>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åå‘ç´¢å¼•</strong>ï¼šå¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦éœ€è¦è¢«æ‹¦æˆªï¼ˆé¿å…ä¸å¿…è¦çš„æ‹¦æˆªå¼€é”€ï¼‰</li>
<li><strong>æ— çŠ¶æ€</strong>ï¼šåªå­˜å‚¨è®¢é˜…å…³ç³»ï¼Œä¸å­˜å‚¨è¿è¡Œæ—¶æ•°æ®</li>
</ul>
<h3 data-id="heading-8">3. åè°ƒå™¨ï¼ˆCoordinatorï¼‰ï¼šè¿è¡Œæ—¶çš„çŠ¶æ€ç®¡ç†</h3>
<p>åè°ƒå™¨åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œç»´æŠ¤ä»¥ä¸‹çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageStreamCoordinator</span>:
    <span class="hljs-comment"># æ´»è·ƒä¼šè¯ï¼š{message_node_id: ResponseSession}</span>
    <span class="hljs-comment"># æ¯ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä¼šè¯ï¼Œç»´æŠ¤å½“å‰å¤„ç†çš„æ®µç´¢å¼•</span>
    _active_sessions: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, ResponseSession]
    
    <span class="hljs-comment"># æµå¼ç¼“å†²åŒºï¼š{(node_id, variable): StreamBuffer}</span>
    <span class="hljs-comment"># ç¼“å­˜ä¸Šæ¸¸èŠ‚ç‚¹çš„æµå¼è¾“å‡ºå—</span>
    _stream_buffers: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>], StreamBuffer]
    
    <span class="hljs-comment"># å·²å®ŒæˆèŠ‚ç‚¹ï¼š{node_id}</span>
    _completed_nodes: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>]
</code></pre>
<p><strong>æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</strong></p>
<h4 data-id="heading-9">ResponseSessionï¼ˆå“åº”ä¼šè¯ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseSession</span>:
    node_id: <span class="hljs-built_in">str</span>              <span class="hljs-comment"># æ¶ˆæ¯èŠ‚ç‚¹ID</span>
    rule: InterceptionRule    <span class="hljs-comment"># æ‹¦æˆªè§„åˆ™ï¼ˆåŒ…å«æ®µåºåˆ—ï¼‰</span>
    index: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>            <span class="hljs-comment"># å½“å‰å¤„ç†çš„æ®µç´¢å¼•</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">current_segment</span>(<span class="hljs-params">self</span>) -&gt; Segment | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""è·å–å½“å‰æ®µ"""</span>
        <span class="hljs-keyword">return</span> self.rule.segments[self.index]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">advance</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ¨è¿›åˆ°ä¸‹ä¸€æ®µ"""</span>
        self.index += <span class="hljs-number">1</span>
</code></pre>
<p>ä¼šè¯ç»´æŠ¤äº†<strong>å½“å‰å¤„ç†è¿›åº¦</strong>ï¼Œç¡®ä¿æŒ‰é¡ºåºæ¨è¿›ã€‚</p>
<h4 data-id="heading-10">StreamBufferï¼ˆæµå¼ç¼“å†²åŒºï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamBuffer</span>:
    chunks: deque[StreamChunk]  <span class="hljs-comment"># å¾…å¤„ç†çš„å—é˜Ÿåˆ—</span>
    is_closed: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>      <span class="hljs-comment"># æµæ˜¯å¦å·²å…³é—­</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">append</span>(<span class="hljs-params">self, chunk: StreamChunk</span>):
        <span class="hljs-string">"""æ·»åŠ æ•°æ®å—"""</span>
        self.chunks.append(chunk)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>) -&gt; StreamChunk | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å¼¹å‡ºæ•°æ®å—ï¼ˆFIFOï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.chunks.popleft() <span class="hljs-keyword">if</span> self.chunks <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
</code></pre>
<p>ç¼“å†²åŒºé‡‡ç”¨<strong>FIFOé˜Ÿåˆ—</strong>ï¼Œä¿è¯æµå¼æ•°æ®çš„é¡ºåºã€‚</p>
<hr/>
<h2 data-id="heading-11">æ‰§è¡Œæµç¨‹</h2>
<h3 data-id="heading-12">é˜¶æ®µ0ï¼šèŠ‚ç‚¹å¼€å§‹æ‰§è¡Œï¼ˆæ”¯æŒå¾ªç¯ï¼‰</h3>
<p>åœ¨èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶ï¼ˆ<code>BaseNode.__call__</code> å¼€å¤´ï¼‰ï¼Œä¼šè°ƒç”¨ <code>on_node_start()</code> è¿›è¡ŒçŠ¶æ€é‡ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># BaseNode.__call__ å¼€å¤´</span>
<span class="hljs-keyword">await</span> self.on_node_start()  <span class="hljs-comment"># é€šçŸ¥åè°ƒå™¨èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ</span>

<span class="hljs-comment"># åè°ƒå™¨å¤„ç†</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_node_start</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-comment"># é‡ç½®è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰bufferï¼Œæ¸…ç©ºä¸Šä¸€è½®æ‰§è¡Œçš„æ•°æ®</span>
    keys_to_reset = [key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self._stream_buffers.keys() <span class="hljs-keyword">if</span> key[<span class="hljs-number">0</span>] == node_id]
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys_to_reset:
        self._stream_buffers[key] = StreamBuffer()
    
    <span class="hljs-comment"># ä»å®ŒæˆèŠ‚ç‚¹é›†åˆä¸­ç§»é™¤ï¼ˆå…è®¸é‡æ–°æµå¼è¾“å‡ºï¼‰</span>
    self._completed_nodes.discard(node_id)
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¾ªç¯æ”¯æŒ</strong>ï¼šåœ¨å¾ªç¯å·¥ä½œæµä¸­ï¼ŒåŒä¸€èŠ‚ç‚¹å¯èƒ½è¢«å¤šæ¬¡æ‰§è¡Œã€‚æ¯æ¬¡æ‰§è¡Œå¼€å§‹æ—¶é‡ç½® bufferï¼Œç¡®ä¿ä¸ä¼šä½¿ç”¨ä¸Šä¸€è½®çš„æ•°æ®</li>
<li><strong>çŠ¶æ€æ¸…ç†</strong>ï¼šä»å®ŒæˆèŠ‚ç‚¹é›†åˆä¸­ç§»é™¤ï¼Œå…è®¸èŠ‚ç‚¹é‡æ–°è¿›è¡Œæµå¼è¾“å‡º</li>
<li><strong>ä»…é‡ç½®è¢«å¼•ç”¨çš„èŠ‚ç‚¹</strong>ï¼šåªæœ‰è¢«æ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨çš„èŠ‚ç‚¹æ‰ä¼šè¢«é‡ç½®ï¼Œé¿å…ä¸å¿…è¦çš„å¼€é”€</li>
</ul>
<h3 data-id="heading-13">é˜¶æ®µ1ï¼šæ‹¦æˆªæµå¼è¾“å‡º</h3>
<p>å½“ LLM èŠ‚ç‚¹äº§ç”Ÿæµå¼è¾“å‡ºæ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># LLM èŠ‚ç‚¹å†…éƒ¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> llm.astream(prompt):
    <span class="hljs-comment"># é€šçŸ¥åè°ƒå™¨</span>
    <span class="hljs-keyword">await</span> coordinator.on_stream_chunk(
        node_id=<span class="hljs-string">"llm_1"</span>,
        variable=<span class="hljs-string">"text"</span>,
        chunk=chunk,
        is_final=<span class="hljs-literal">False</span>
    )
</code></pre>
<p>åè°ƒå™¨çš„å¤„ç†é€»è¾‘ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_stream_chunk</span>(<span class="hljs-params">self, node_id, variable, chunk, is_final</span>):
    <span class="hljs-comment"># 1. æ£€æŸ¥æ˜¯å¦è¢«ä»»ä½•æ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._registry.is_intercepted(node_id):
        <span class="hljs-keyword">return</span>  <span class="hljs-comment"># æœªè¢«å¼•ç”¨ï¼Œå¿½ç•¥</span>
    
    <span class="hljs-comment"># 2. æ‹¦æˆªåˆ°ç¼“å†²åŒº</span>
    selector = (node_id, variable)
    stream_chunk = StreamChunk(selector=selector, chunk=chunk, is_final=is_final)
    self._stream_buffers[selector].append(stream_chunk)
    
    <span class="hljs-keyword">if</span> is_final:
        self._stream_buffers[selector].close()
    
    <span class="hljs-comment"># 3. æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨ä¼šè¯</span>
    <span class="hljs-keyword">await</span> self._check_and_start_sessions(node_id)
    
    <span class="hljs-comment"># 4. å°è¯•æ¨é€</span>
    <span class="hljs-keyword">await</span> self._try_push_streams()
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¿«é€Ÿè¿‡æ»¤</strong>ï¼šé€šè¿‡åå‘ç´¢å¼•å¿«é€Ÿåˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆª</li>
<li><strong>ç¼“å†²æœºåˆ¶</strong>ï¼šæµå¼æ•°æ®å…ˆè¿›å…¥ç¼“å†²åŒºï¼Œç­‰å¾…æ¨é€æ—¶æœº</li>
<li><strong>è§¦å‘æ£€æŸ¥</strong>ï¼šæ¯æ¬¡æ”¶åˆ°æ•°æ®å—åï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨æˆ–ç»§ç»­æ¨é€</li>
</ul>
<h3 data-id="heading-14">é˜¶æ®µ2ï¼šå¯åŠ¨ä¼šè¯</h3>
<p>ä¼šè¯å¯åŠ¨çš„æ—¶æœºï¼š<strong>å½“æ¶ˆæ¯èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªä¾èµ–èŠ‚ç‚¹å‡†å¤‡å¥½æ—¶</strong>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_check_and_start_sessions</span>(<span class="hljs-params">self, node_id</span>):
    <span class="hljs-keyword">for</span> message_node_id, rule <span class="hljs-keyword">in</span> self._registry.get_all_rules().items():
        <span class="hljs-keyword">if</span> message_node_id <span class="hljs-keyword">in</span> self._active_sessions:
            <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># å·²å¯åŠ¨</span>
        
        <span class="hljs-comment"># æ‰¾åˆ°ç¬¬ä¸€ä¸ªå˜é‡æ®µ</span>
        first_var_segment = <span class="hljs-built_in">next</span>(
            (seg <span class="hljs-keyword">for</span> seg <span class="hljs-keyword">in</span> rule.segments <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(seg, VariableSegment)),
            <span class="hljs-literal">None</span>
        )
        
        <span class="hljs-keyword">if</span> first_var_segment <span class="hljs-keyword">and</span> first_var_segment.node_id == node_id:
            selector = (first_var_segment.node_id, first_var_segment.node_variable)
            buffer = self._stream_buffers.get(selector)
            
            <span class="hljs-comment"># æ£€æŸ¥æ•°æ®æ˜¯å¦å‡†å¤‡å¥½</span>
            has_stream_data = buffer <span class="hljs-keyword">and</span> (buffer.has_unread() <span class="hljs-keyword">or</span> buffer.is_closed)
            has_scalar_data = self._get_variable_value(...) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
            
            <span class="hljs-keyword">if</span> has_stream_data <span class="hljs-keyword">or</span> has_scalar_data:
                <span class="hljs-comment"># å¯åŠ¨ä¼šè¯</span>
                session = ResponseSession(node_id=message_node_id, rule=rule)
                self._active_sessions[message_node_id] = session
                
                <span class="hljs-comment"># ç«‹å³å°è¯•æ¨é€</span>
                <span class="hljs-keyword">await</span> self._try_push_streams()
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å»¶è¿Ÿå¯åŠ¨</strong>ï¼šåªæœ‰ç¬¬ä¸€ä¸ªä¾èµ–èŠ‚ç‚¹å‡†å¤‡å¥½æ—¶æ‰å¯åŠ¨ï¼Œé¿å…è¿‡æ—©æ¨é€</li>
<li><strong>æ”¯æŒæµå¼å’Œæ ‡é‡</strong>ï¼šæµå¼æ•°æ®ä»ç¼“å†²åŒºè¯»å–ï¼Œæ ‡é‡æ•°æ®ä»èŠ‚ç‚¹è¾“å‡ºä¸­è¯»å–</li>
</ul>
<h3 data-id="heading-15">é˜¶æ®µ3ï¼šæŒ‰åºæ¨é€</h3>
<p>æ¨é€é€»è¾‘çš„æ ¸å¿ƒæ˜¯<strong>æŒ‰æ®µé¡ºåºå¤„ç†ï¼Œé‡åˆ°æœªå°±ç»ªçš„æ•°æ®æ—¶åœæ­¢</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_try_push_streams</span>(<span class="hljs-params">self</span>):
    <span class="hljs-keyword">for</span> session_id, session <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(self._active_sessions.items()):
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> session.is_complete():
            segment = session.current_segment()
            
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(segment, TextSegment):
                <span class="hljs-comment"># æ–‡æœ¬æ®µï¼šç›´æ¥æ¨é€</span>
                <span class="hljs-keyword">await</span> stream_writer({
                    <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"MESSAGE_CHUNK"</span>,
                    <span class="hljs-string">"chunk"</span>: segment.text,
                    <span class="hljs-string">"is_final"</span>: <span class="hljs-literal">False</span>
                })
                session.advance()  <span class="hljs-comment"># æ¨è¿›åˆ°ä¸‹ä¸€æ®µ</span>
            
            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(segment, VariableSegment):
                selector = (segment.node_id, segment.node_variable)
                buffer = self._stream_buffers.get(selector)
                
                <span class="hljs-keyword">if</span> buffer <span class="hljs-keyword">and</span> buffer.has_unread():
                    <span class="hljs-comment"># æµå¼æ•°æ®ï¼šä»ç¼“å†²åŒºè¯»å–å¹¶æ¨é€</span>
                    <span class="hljs-keyword">while</span> buffer.has_unread():
                        chunk = buffer.pop()
                        <span class="hljs-keyword">await</span> stream_writer({
                            <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"MESSAGE_CHUNK"</span>,
                            <span class="hljs-string">"chunk"</span>: chunk.chunk,
                            <span class="hljs-string">"is_final"</span>: <span class="hljs-literal">False</span>
                        })
                    
                    <span class="hljs-comment"># å¦‚æœæµå·²å…³é—­ï¼Œæ¨è¿›åˆ°ä¸‹ä¸€æ®µ</span>
                    <span class="hljs-keyword">if</span> buffer.is_closed:
                        session.advance()
                    <span class="hljs-keyword">else</span>:
                        <span class="hljs-keyword">break</span>  <span class="hljs-comment"># ç­‰å¾…æ›´å¤šæ•°æ®</span>
                
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-comment"># å°è¯•ä»èŠ‚ç‚¹è¾“å‡ºè·å–æ ‡é‡å€¼</span>
                    value = self._get_variable_value(...)
                    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                        <span class="hljs-comment"># æ ‡é‡å€¼ï¼šç›´æ¥æ¨é€</span>
                        <span class="hljs-keyword">await</span> stream_writer({
                            <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"MESSAGE_CHUNK"</span>,
                            <span class="hljs-string">"chunk"</span>: <span class="hljs-built_in">str</span>(value),
                            <span class="hljs-string">"is_final"</span>: <span class="hljs-literal">False</span>
                        })
                        session.advance()
                    <span class="hljs-keyword">else</span>:
                        <span class="hljs-comment"># æ•°æ®æœªå‡†å¤‡å¥½ï¼Œåœæ­¢æ¨é€</span>
                        <span class="hljs-keyword">break</span>
        
        <span class="hljs-comment"># ä¼šè¯å®Œæˆ</span>
        <span class="hljs-keyword">if</span> session.is_complete():
            <span class="hljs-keyword">await</span> stream_writer({
                <span class="hljs-string">"event_type"</span>: <span class="hljs-string">"MESSAGE_CHUNK"</span>,
                <span class="hljs-string">"chunk"</span>: <span class="hljs-string">""</span>,
                <span class="hljs-string">"is_final"</span>: <span class="hljs-literal">True</span>
            })
            <span class="hljs-keyword">del</span> self._active_sessions[session_id]
</code></pre>
<p><strong>å…³é”®é€»è¾‘ï¼š</strong></p>
<ol>
<li><strong>æ–‡æœ¬æ®µç«‹å³æ¨é€</strong>ï¼šä¸ä¾èµ–ä»»ä½•æ•°æ®ï¼Œç›´æ¥æ¨é€å¹¶æ¨è¿›</li>
<li><strong>æµå¼æ•°æ®å®æ—¶è½¬å‘</strong>ï¼šä»ç¼“å†²åŒºè¯»å–æ‰€æœ‰å¯ç”¨æ•°æ®ï¼Œæµå…³é—­åæ¨è¿›</li>
<li><strong>æ ‡é‡æ•°æ®ç­‰å¾…</strong>ï¼šå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œå°è¯•ä»èŠ‚ç‚¹è¾“å‡ºè¯»å–ï¼Œæœªå°±ç»ªæ—¶åœæ­¢</li>
<li><strong>é˜»å¡æœºåˆ¶</strong>ï¼šé‡åˆ°æœªå°±ç»ªçš„æ•°æ®æ—¶ï¼Œ<code>break</code> è·³å‡ºå¾ªç¯ï¼Œç­‰å¾…ä¸‹æ¬¡è§¦å‘</li>
</ol>
<h3 data-id="heading-16">é˜¶æ®µ4ï¼šèŠ‚ç‚¹å®Œæˆé€šçŸ¥</h3>
<p>å½“æ ‡é‡èŠ‚ç‚¹ï¼ˆå¦‚ä»£ç æ‰§è¡ŒèŠ‚ç‚¹ï¼‰å®Œæˆæ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_node_completed</span>(<span class="hljs-params">self, node_id, outputs</span>):
    <span class="hljs-comment"># è®°å½•èŠ‚ç‚¹å®Œæˆ</span>
    self._completed_nodes.add(node_id)
    
    <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨ä¼šè¯</span>
    <span class="hljs-keyword">await</span> self._check_and_start_sessions(node_id)
    
    <span class="hljs-comment"># å°è¯•æ¨é€ï¼ˆå¯èƒ½æœ‰æ–°çš„æ ‡é‡æ•°æ®å¯ç”¨ï¼‰</span>
    <span class="hljs-keyword">await</span> self._try_push_streams()
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæµå¼èŠ‚ç‚¹å’Œæ ‡é‡èŠ‚ç‚¹éƒ½é€šè¿‡åè°ƒå™¨é€šçŸ¥</li>
<li><strong>è§¦å‘æ¨é€</strong>ï¼šèŠ‚ç‚¹å®Œæˆå¯èƒ½è§¦å‘æ–°çš„æ¨é€ï¼ˆå¦‚æœæŸä¸ªä¼šè¯æ­£åœ¨ç­‰å¾…è¯¥èŠ‚ç‚¹çš„æ•°æ®ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-17">å®Œæ•´æ‰§è¡Œæ—¶åº</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´ä¾‹å­ç†è§£æ•´ä¸ªæµç¨‹ï¼š</p>
<h3 data-id="heading-18">åœºæ™¯é…ç½®</h3>
<pre><code class="hljs language-swift" lang="swift">æ¨¡æ¿: <span class="hljs-string">"AIåˆ†æï¼š{llm_output}<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š{code_result}"</span>
å¼•ç”¨å…³ç³»:
  <span class="hljs-operator">-</span> llm_output <span class="hljs-operator">â†’</span> llm_1.text (æµå¼)
  <span class="hljs-operator">-</span> code_result <span class="hljs-operator">â†’</span> code_1.result (æ ‡é‡)
</code></pre>
<h3 data-id="heading-19">æ‰§è¡Œæ—¶åºå›¾</h3>
<pre><code class="hljs language-swift" lang="swift">æ—¶é—´ <span class="hljs-operator">â”‚</span> <span class="hljs-type">LLMèŠ‚ç‚¹</span>          <span class="hljs-operator">â”‚</span> ä»£ç èŠ‚ç‚¹        <span class="hljs-operator">â”‚</span> åè°ƒå™¨æ“ä½œ                    <span class="hljs-operator">â”‚</span> å‰ç«¯æ¥æ”¶
<span class="hljs-operator">â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="hljs-type">T0</span>   <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> åˆå§‹åŒ–                         <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span>                               <span class="hljs-operator">â”‚</span>
<span class="hljs-type">T1</span>   <span class="hljs-operator">â”‚</span> è¾“å‡º <span class="hljs-string">"AI"</span>        <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">1</span>. æ‹¦æˆªåˆ°ç¼“å†²åŒº                <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">2</span>. æ£€æŸ¥ä¾èµ–ï¼ˆç¬¬ä¸€ä¸ªæ˜¯llm_1ï¼‰  <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">3</span>. å¯åŠ¨ä¼šè¯                   <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">4</span>. æ¨é€ <span class="hljs-type">TextSegment</span>: <span class="hljs-string">"AIåˆ†æï¼š"</span><span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼š"</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">5</span>. æ¨é€ <span class="hljs-type">VariableSegment</span>: <span class="hljs-string">"AI"</span> <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI"</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span>                               <span class="hljs-operator">â”‚</span>
<span class="hljs-type">T2</span>   <span class="hljs-operator">â”‚</span> è¾“å‡º <span class="hljs-string">" thinks"</span>   <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">1</span>. æ‹¦æˆªåˆ°ç¼“å†²åŒº                <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">2</span>. æ¨é€: <span class="hljs-string">" thinks"</span>            <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks"</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span>                               <span class="hljs-operator">â”‚</span>
<span class="hljs-type">T3</span>   <span class="hljs-operator">â”‚</span> è¾“å‡º <span class="hljs-string">"..."</span>       <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">1</span>. æ‹¦æˆªåˆ°ç¼“å†²åŒº                <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">2</span>. æ¨é€: <span class="hljs-string">"..."</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks..."</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span>                               <span class="hljs-operator">â”‚</span>
<span class="hljs-type">T4</span>   <span class="hljs-operator">â”‚</span> æµå…³é—­           <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">1</span>. æ ‡è®°æµå…³é—­                  <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">2</span>. æ¨è¿›åˆ°ä¸‹ä¸€æ®µ                <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">3</span>. æ¨é€ <span class="hljs-type">TextSegment</span>: <span class="hljs-string">"<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š"</span><span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks...<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š"</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">4</span>. æ£€æŸ¥ code_resultï¼ˆæœªå°±ç»ªï¼‰  <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">5</span>. åœæ­¢æ¨é€ï¼Œç­‰å¾…              <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span>                               <span class="hljs-operator">â”‚</span>
<span class="hljs-type">T5</span>   <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span> å®Œæˆï¼Œè¿”å›<span class="hljs-number">42</span>   <span class="hljs-operator">â”‚</span> <span class="hljs-number">1</span>. è®°å½•èŠ‚ç‚¹å®Œæˆ                <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">2</span>. å°è¯•æ¨é€                    <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">3</span>. ä»è¾“å‡ºè·å– code_1.result<span class="hljs-operator">=</span><span class="hljs-number">42</span> <span class="hljs-operator">â”‚</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">4</span>. æ¨é€: <span class="hljs-string">"42"</span>                  <span class="hljs-operator">â”‚</span> <span class="hljs-string">"AIåˆ†æï¼šAI thinks...<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>è®¡ç®—ç»“æœï¼š42"</span>
     <span class="hljs-operator">â”‚</span>                  <span class="hljs-operator">â”‚</span>                <span class="hljs-operator">â”‚</span> <span class="hljs-number">5</span>. ä¼šè¯å®Œæˆï¼Œå‘é€ is_final<span class="hljs-operator">=</span><span class="hljs-type">True</span><span class="hljs-operator">â”‚</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">è®¾è®¡ä¼˜åŠ¿</h2>
<h3 data-id="heading-21">1. è§£è€¦è®¾è®¡</h3>
<ul>
<li><strong>å˜é‡åä¸èŠ‚ç‚¹IDè§£è€¦</strong>ï¼šæ¶ˆæ¯èŠ‚ç‚¹ä½¿ç”¨è¯­ä¹‰åŒ–çš„å˜é‡åï¼ˆå¦‚ <code>llm_output</code>ï¼‰ï¼Œé€šè¿‡ <code>reference_metadata</code> æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹ID</li>
<li><strong>å‰ç«¯æ— éœ€çŸ¥é“èŠ‚ç‚¹ç»†èŠ‚</strong>ï¼šå‰ç«¯åªæ¥æ”¶æ¶ˆæ¯èŠ‚ç‚¹çš„è¾“å‡ºï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“å¼•ç”¨äº†å“ªäº›èŠ‚ç‚¹</li>
</ul>
<h3 data-id="heading-22">2. æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li><strong>å¿«é€Ÿè¿‡æ»¤</strong>ï¼šé€šè¿‡åå‘ç´¢å¼•å¿«é€Ÿåˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼Œé¿å…ä¸å¿…è¦çš„å¼€é”€</li>
<li><strong>æŒ‰éœ€å¯åŠ¨</strong>ï¼šåªæœ‰ç¬¬ä¸€ä¸ªä¾èµ–èŠ‚ç‚¹å‡†å¤‡å¥½æ—¶æ‰å¯åŠ¨ä¼šè¯ï¼Œé¿å…è¿‡æ—©æ¨é€</li>
</ul>
<h3 data-id="heading-23">3. çµæ´»æ€§</h3>
<ul>
<li><strong>æ”¯æŒæ··åˆæ•°æ®æº</strong>ï¼šåŒæ—¶å¤„ç†æµå¼æ•°æ®å’Œæ ‡é‡æ•°æ®</li>
<li><strong>æ”¯æŒæ·±å±‚å±æ€§è®¿é—®</strong>ï¼šå˜é‡è·¯å¾„æ”¯æŒ <code>response.data.user.name</code> ç­‰æ·±å±‚è®¿é—®</li>
<li><strong>æ”¯æŒå¤šæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨åŒä¸€èŠ‚ç‚¹</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºå¯ä»¥è¢«å¤šä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</li>
</ul>
<h3 data-id="heading-24">4. å¯ç»´æŠ¤æ€§</h3>
<ul>
<li><strong>ç¼–è¯‘æ—¶-è¿è¡Œæ—¶åˆ†ç¦»</strong>ï¼šèŒè´£æ¸…æ™°ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤</li>
<li><strong>çŠ¶æ€åºåˆ—åŒ–æ”¯æŒ</strong>ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆåºåˆ—åŒ–åè°ƒå™¨çŠ¶æ€ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-25">å…³é”®è®¾è®¡æ¨¡å¼</h2>
<h3 data-id="heading-26">1. æ‹¦æˆªæ¨¡å¼ï¼ˆInterception Patternï¼‰</h3>
<p>ä¸Šæ¸¸èŠ‚ç‚¹ä¸ç›´æ¥æ¨é€ï¼Œè€Œæ˜¯é€šçŸ¥åè°ƒå™¨ï¼Œç”±åè°ƒå™¨å†³å®šä½•æ—¶ã€å¦‚ä½•æ¨é€ã€‚è¿™å®ç°äº†<strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼š</p>
<ul>
<li><strong>ä¸Šæ¸¸èŠ‚ç‚¹</strong>ï¼šä¸“æ³¨äºç”Ÿæˆæ•°æ®</li>
<li><strong>åè°ƒå™¨</strong>ï¼šä¸“æ³¨äºç»„è£…å’Œæ¨é€é€»è¾‘</li>
</ul>
<h3 data-id="heading-27">2. ä¼šè¯æ¨¡å¼ï¼ˆSession Patternï¼‰</h3>
<p>æ¯ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä¼šè¯ï¼Œç»´æŠ¤å¤„ç†è¿›åº¦ã€‚è¿™å®ç°äº†<strong>çŠ¶æ€éš”ç¦»</strong>ï¼š</p>
<ul>
<li>å¤šä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¯ä»¥å¹¶è¡Œå¤„ç†</li>
<li>æ¯ä¸ªä¼šè¯ç‹¬ç«‹æ¨è¿›ï¼Œäº’ä¸å¹²æ‰°</li>
</ul>
<h3 data-id="heading-28">3. ç¼“å†²åŒºæ¨¡å¼ï¼ˆBuffer Patternï¼‰</h3>
<p>æµå¼æ•°æ®å…ˆè¿›å…¥ç¼“å†²åŒºï¼Œç­‰å¾…æ¨é€æ—¶æœºã€‚è¿™å®ç°äº†<strong>å¼‚æ­¥è§£è€¦</strong>ï¼š</p>
<ul>
<li>æ•°æ®ç”Ÿæˆå’Œæ•°æ®æ¶ˆè´¹è§£è€¦</li>
<li>æ”¯æŒèƒŒå‹ï¼ˆbackpressureï¼‰æ§åˆ¶</li>
</ul>
<h3 data-id="heading-29">4. çŠ¶æ€æœºæ¨¡å¼ï¼ˆState Machine Patternï¼‰</h3>
<p>ä¼šè¯é€šè¿‡æ®µç´¢å¼•æ¨è¿›ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">çŠ¶æ€0: å¤„ç† TextSegment<span class="hljs-section">[0]</span>
  â†“
çŠ¶æ€1: å¤„ç† VariableSegment<span class="hljs-section">[1]</span>ï¼ˆç­‰å¾…æ•°æ®ï¼‰
  â†“
çŠ¶æ€2: å¤„ç† TextSegment<span class="hljs-section">[2]</span>
  â†“
çŠ¶æ€3: å¤„ç† VariableSegment<span class="hljs-section">[3]</span>ï¼ˆç­‰å¾…æ•°æ®ï¼‰
  â†“
å®Œæˆ
</code></pre>
<hr/>
<h2 data-id="heading-30">æ‰©å±•æ€è€ƒ</h2>
<h3 data-id="heading-31">1. å¦‚ä½•æ”¯æŒå¾ªç¯æ‰§è¡Œï¼Ÿ</h3>
<p>åœ¨å·¥ä½œæµä¸­ï¼Œå¯èƒ½å­˜åœ¨å¾ªç¯ç»“æ„ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½è¢«å¤šæ¬¡æ‰§è¡Œã€‚ä¸ºäº†æ”¯æŒè¿™ç§æƒ…å†µï¼Œåè°ƒå™¨åœ¨èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶ä¼šè¿›è¡ŒçŠ¶æ€é‡ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_node_start</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶è°ƒç”¨ï¼ˆåœ¨BaseNode.__call__å¼€å¤´è°ƒç”¨ï¼‰"""</span>
    <span class="hljs-comment"># é‡ç½®è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰bufferï¼Œæ¸…ç©ºä¸Šä¸€è½®æ‰§è¡Œçš„æ•°æ®</span>
    keys_to_reset = [key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self._stream_buffers.keys() <span class="hljs-keyword">if</span> key[<span class="hljs-number">0</span>] == node_id]
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys_to_reset:
        self._stream_buffers[key] = StreamBuffer()
    
    <span class="hljs-comment"># ä»å®ŒæˆèŠ‚ç‚¹é›†åˆä¸­ç§»é™¤ï¼ˆå…è®¸é‡æ–°æµå¼è¾“å‡ºï¼‰</span>
    self._completed_nodes.discard(node_id)
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>èŠ‚ç‚¹çº§é‡ç½®</strong>ï¼šæ¯æ¬¡èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶ï¼Œé‡ç½®è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰ bufferï¼Œç¡®ä¿ä¸ä¼šä½¿ç”¨ä¸Šä¸€è½®çš„æ•°æ®</li>
<li><strong>çŠ¶æ€æ¸…ç†</strong>ï¼šä»å®ŒæˆèŠ‚ç‚¹é›†åˆä¸­ç§»é™¤ï¼Œå…è®¸èŠ‚ç‚¹é‡æ–°è¿›è¡Œæµå¼è¾“å‡º</li>
<li><strong>ä¼šè¯ä¿æŒ</strong>ï¼šæ¶ˆæ¯èŠ‚ç‚¹çš„ä¼šè¯çŠ¶æ€ä¿æŒä¸å˜ï¼Œå› ä¸ºæ¶ˆæ¯èŠ‚ç‚¹æœ¬èº«ä¸ä¼šè¢«å¾ªç¯æ‰§è¡Œ</li>
</ul>
<p><strong>ç¤ºä¾‹åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">å·¥ä½œæµ: LLMèŠ‚ç‚¹ â†’ æ¡ä»¶åˆ¤æ–­ â†’ <span class="hljs-section">[å¾ªç¯]</span> â†’ LLMèŠ‚ç‚¹ â†’ æ¶ˆæ¯èŠ‚ç‚¹
</code></pre>
<p>åœ¨å¾ªç¯ä¸­ï¼ŒLLM èŠ‚ç‚¹å¯èƒ½è¢«å¤šæ¬¡æ‰§è¡Œã€‚æ¯æ¬¡æ‰§è¡Œå¼€å§‹æ—¶ï¼Œåè°ƒå™¨ä¼šé‡ç½® LLM èŠ‚ç‚¹çš„ bufferï¼Œç¡®ä¿æ¯æ¬¡å¾ªç¯éƒ½èƒ½æ­£ç¡®è¿›è¡Œæµå¼è¾“å‡ºã€‚</p>
<h3 data-id="heading-32">2. å¦‚ä½•å¤„ç†å¾ªç¯ä¾èµ–ï¼Ÿ</h3>
<p>å¦‚æœæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸”è¿™äº›èŠ‚ç‚¹ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåè°ƒå™¨ä¼šè‡ªç„¶å¤„ç†ï¼š</p>
<ul>
<li>æŒ‰æ¨¡æ¿é¡ºåºæ¨è¿›ï¼Œé‡åˆ°æœªå°±ç»ªçš„æ•°æ®æ—¶åœæ­¢</li>
<li>èŠ‚ç‚¹å®Œæˆåè§¦å‘æ£€æŸ¥ï¼Œç»§ç»­æ¨è¿›</li>
</ul>
<h3 data-id="heading-33">3. å¦‚ä½•å¤„ç†é”™è¯¯ï¼Ÿ</h3>
<p>å¦‚æœä¸Šæ¸¸èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ï¼š</p>
<ul>
<li>åè°ƒå™¨å¯ä»¥ä»èŠ‚ç‚¹è¾“å‡ºä¸­è¯»å–é”™è¯¯ä¿¡æ¯</li>
<li>æˆ–è€…ç­‰å¾…è¶…æ—¶åæ¨é€é”™è¯¯æç¤º</li>
</ul>
<h3 data-id="heading-34">4. å¦‚ä½•æ”¯æŒæ›´å¤æ‚çš„æ¨¡æ¿è¯­æ³•ï¼Ÿ</h3>
<p>å½“å‰æ–¹æ¡ˆæ”¯æŒç®€å•çš„å˜é‡æ›¿æ¢ã€‚å¦‚æœéœ€è¦æ”¯æŒæ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ç­‰ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>æ‰©å±•æ¨¡æ¿è§£æå™¨ï¼Œç”Ÿæˆæ›´å¤æ‚çš„æ®µåºåˆ—</li>
<li>åœ¨æ¨é€æ—¶æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦è·³è¿‡æŸäº›æ®µ</li>
</ul>
<h3 data-id="heading-35">5. å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</h3>
<ul>
<li><strong>æ‰¹é‡æ¨é€</strong>ï¼šå°†å¤šä¸ªå°å—åˆå¹¶ä¸ºä¸€ä¸ªå¤§å—æ¨é€ï¼ˆå‡å°‘ç½‘ç»œå¼€é”€ï¼‰</li>
<li><strong>é¢„å–æœºåˆ¶</strong>ï¼šæå‰å¯åŠ¨ä¼šè¯ï¼Œé¢„å–ç¬¬ä¸€ä¸ªå˜é‡æ®µçš„æ•°æ®</li>
<li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šç¼“å­˜å·²å®Œæˆçš„èŠ‚ç‚¹è¾“å‡ºï¼Œé¿å…é‡å¤æŸ¥è¯¢</li>
</ul>
<hr/>
<h2 data-id="heading-36">æ€»ç»“</h2>
<p>æ¶ˆæ¯èŠ‚ç‚¹æµå¼è¾“å‡ºçš„æ ¸å¿ƒè®¾è®¡æ€è·¯å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p>
<ol>
<li><strong>ç¼–è¯‘æ—¶æ„å»ºè®¢é˜…å…³ç³»</strong>ï¼šè§£ææ¨¡æ¿ï¼Œå»ºç«‹å˜é‡åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œæ³¨å†Œæ‹¦æˆªè§„åˆ™</li>
<li><strong>è¿è¡Œæ—¶æ‹¦æˆªå’Œåè°ƒ</strong>ï¼šä¸Šæ¸¸èŠ‚ç‚¹é€šçŸ¥åè°ƒå™¨ï¼Œåè°ƒå™¨æŒ‰æ¨¡æ¿é¡ºåºç»„è£…å¹¶æ¨é€</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šé€šè¿‡ä¼šè¯ç»´æŠ¤å¤„ç†è¿›åº¦ï¼Œé€šè¿‡ç¼“å†²åŒºç¼“å­˜æµå¼æ•°æ®</li>
<li><strong>é˜»å¡æœºåˆ¶</strong>ï¼šé‡åˆ°æœªå°±ç»ªçš„æ•°æ®æ—¶åœæ­¢æ¨é€ï¼Œç­‰å¾…æ•°æ®å°±ç»ªåç»§ç»­</li>
</ol>
<p>è¿™ç§è®¾è®¡å®ç°äº†<strong>è§£è€¦ã€çµæ´»ã€é«˜æ•ˆ</strong>çš„æµå¼è¾“å‡ºæœºåˆ¶ï¼Œé€‚ç”¨äºå¤æ‚çš„å·¥ä½œæµåœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-37">å®ç°è¦ç‚¹æ€»ç»“</h2>
<p>åŸºäºæœ¬æ–‡çš„è®¾è®¡æ€è·¯ï¼Œå®ç°ä¸€ä¸ªæµå¼è¾“å‡ºç³»ç»Ÿéœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¥å£ï¼š</p>
<h3 data-id="heading-38">ç¼–è¯‘æ—¶æ¥å£</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ³¨å†Œæ‹¦æˆªè§„åˆ™ï¼ˆåœ¨æ¶ˆæ¯èŠ‚ç‚¹åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰</span>
registry.register_interception(
    message_node_id=<span class="hljs-string">"msg_1"</span>,
    template=<span class="hljs-string">"AIåˆ†æï¼š{llm_output}\n\nè®¡ç®—ç»“æœï¼š{code_result}"</span>,
    variable_to_node_map={
        <span class="hljs-string">"llm_output"</span>: (<span class="hljs-string">"llm_1"</span>, <span class="hljs-string">"text"</span>),
        <span class="hljs-string">"code_result"</span>: (<span class="hljs-string">"code_1"</span>, <span class="hljs-string">"result"</span>)
    }
)
</code></pre>
<h3 data-id="heading-39">è¿è¡Œæ—¶æ¥å£</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶ï¼ˆæ”¯æŒå¾ªç¯ï¼‰</span>
<span class="hljs-keyword">await</span> coordinator.on_node_start(node_id=<span class="hljs-string">"llm_1"</span>)

<span class="hljs-comment"># æ‹¦æˆªæµå¼è¾“å‡ºï¼ˆåœ¨æµå¼èŠ‚ç‚¹äº§ç”Ÿæ•°æ®æ—¶è°ƒç”¨ï¼‰</span>
<span class="hljs-keyword">await</span> coordinator.on_stream_chunk(
    node_id=<span class="hljs-string">"llm_1"</span>,
    variable=<span class="hljs-string">"text"</span>,
    chunk=<span class="hljs-string">"AI"</span>,
    is_final=<span class="hljs-literal">False</span>
)

<span class="hljs-comment"># é€šçŸ¥èŠ‚ç‚¹å®Œæˆï¼ˆåœ¨èŠ‚ç‚¹æ‰§è¡Œå®Œæˆæ—¶è°ƒç”¨ï¼‰</span>
<span class="hljs-keyword">await</span> coordinator.on_node_completed(
    node_id=<span class="hljs-string">"code_1"</span>,
    outputs={<span class="hljs-string">"result"</span>: <span class="hljs-number">42</span>}
)
</code></pre>
<h3 data-id="heading-40">æ ¸å¿ƒæ•°æ®ç»“æ„</h3>
<p>ä»¥ä¸‹æ˜¯æ ¸å¿ƒç±»çš„ç®€åŒ–å®ç°ï¼Œå±•ç¤ºäº†å…³é”®çš„æ•°æ®ç»“æ„å’Œé€»è¾‘ï¼š</p>
<h4 data-id="heading-41">1. StreamBufferï¼ˆæµå¼ç¼“å†²åŒºï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque
<span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, field

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamChunk</span>:
    <span class="hljs-string">"""æµå¼æ•°æ®å—"""</span>
    selector: <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]  <span class="hljs-comment"># (node_id, variable_name)</span>
    chunk: <span class="hljs-built_in">str</span>                 <span class="hljs-comment"># å¢é‡æ–‡æœ¬</span>
    is_final: <span class="hljs-built_in">bool</span>             <span class="hljs-comment"># æ˜¯å¦ä¸ºæœ€åä¸€å—</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamBuffer</span>:
    <span class="hljs-string">"""æµå¼ç¼“å†²åŒºï¼Œç”¨äºç¼“å­˜ä¸Šæ¸¸èŠ‚ç‚¹çš„æµå¼è¾“å‡º"""</span>
    chunks: deque[StreamChunk] = field(default_factory=deque)  <span class="hljs-comment"># FIFOé˜Ÿåˆ—</span>
    is_closed: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>  <span class="hljs-comment"># æµæ˜¯å¦å·²å…³é—­</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">append</span>(<span class="hljs-params">self, chunk: StreamChunk</span>):
        <span class="hljs-string">"""æ·»åŠ æ•°æ®å—åˆ°é˜Ÿåˆ—å°¾éƒ¨"""</span>
        self.chunks.append(chunk)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>) -&gt; StreamChunk | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""ä»é˜Ÿåˆ—å¤´éƒ¨å¼¹å‡ºæ•°æ®å—ï¼ˆFIFOï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.chunks.popleft() <span class="hljs-keyword">if</span> self.chunks <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">has_unread</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""æ£€æŸ¥æ˜¯å¦æœ‰æœªè¯»æ•°æ®"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.chunks) &gt; <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ ‡è®°æµå·²å…³é—­"""</span>
        self.is_closed = <span class="hljs-literal">True</span>
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ <code>deque</code> å®ç° FIFO é˜Ÿåˆ—ï¼Œä¿è¯æµå¼æ•°æ®çš„é¡ºåº</li>
<li><code>is_closed</code> æ ‡è®°æµæ˜¯å¦ç»“æŸï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥æ¨è¿›åˆ°ä¸‹ä¸€æ®µ</li>
</ul>
<h4 data-id="heading-42">2. ResponseSessionï¼ˆå“åº”ä¼šè¯ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Segment</span>:
    <span class="hljs-string">"""æ¨¡æ¿æ®µåŸºç±»"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextSegment</span>(<span class="hljs-title class_ inherited__">Segment</span>):
    <span class="hljs-string">"""æ–‡æœ¬æ®µï¼šå›ºå®šæ–‡æœ¬ï¼Œå¯ä»¥ç›´æ¥æ¨é€"""</span>
    text: <span class="hljs-built_in">str</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VariableSegment</span>(<span class="hljs-title class_ inherited__">Segment</span>):
    <span class="hljs-string">"""å˜é‡æ®µï¼šéœ€è¦ç­‰å¾…ä¸Šæ¸¸èŠ‚ç‚¹æ•°æ®"""</span>
    variable_name: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># æ¨¡æ¿ä¸­çš„å˜é‡åï¼ˆå¦‚ llm_outputï¼‰</span>
    node_id: <span class="hljs-built_in">str</span>        <span class="hljs-comment"># å®é™…çš„èŠ‚ç‚¹IDï¼ˆå¦‚ llm_1ï¼‰</span>
    node_variable: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># èŠ‚ç‚¹çš„è¾“å‡ºå˜é‡åï¼ˆå¦‚ textï¼‰</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptionRule</span>:
    <span class="hljs-string">"""æ‹¦æˆªè§„åˆ™ï¼šè®°å½•æ¶ˆæ¯èŠ‚ç‚¹çš„é…ç½®"""</span>
    message_node_id: <span class="hljs-built_in">str</span>
    template: <span class="hljs-built_in">str</span>
    segments: <span class="hljs-built_in">list</span>[Segment]  <span class="hljs-comment"># è§£æåçš„æ¨¡æ¿æ®µåºåˆ—</span>
    variable_to_node_map: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]]  <span class="hljs-comment"># å˜é‡æ˜ å°„</span>

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseSession</span>:
    <span class="hljs-string">"""å“åº”ä¼šè¯ï¼šç»´æŠ¤å•ä¸ªæ¶ˆæ¯èŠ‚ç‚¹çš„æµå¼è¾“å‡ºçŠ¶æ€"""</span>
    node_id: <span class="hljs-built_in">str</span>              <span class="hljs-comment"># æ¶ˆæ¯èŠ‚ç‚¹ID</span>
    rule: InterceptionRule    <span class="hljs-comment"># æ‹¦æˆªè§„åˆ™ï¼ˆåŒ…å«æ®µåºåˆ—ï¼‰</span>
    index: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>            <span class="hljs-comment"># å½“å‰å¤„ç†çš„æ®µç´¢å¼•</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_complete</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""æ£€æŸ¥æ˜¯å¦å¤„ç†å®Œæ‰€æœ‰æ®µ"""</span>
        <span class="hljs-keyword">return</span> self.index &gt;= <span class="hljs-built_in">len</span>(self.rule.segments)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">current_segment</span>(<span class="hljs-params">self</span>) -&gt; Segment | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""è·å–å½“å‰éœ€è¦å¤„ç†çš„æ®µ"""</span>
        <span class="hljs-keyword">if</span> self.is_complete():
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">return</span> self.rule.segments[self.index]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">advance</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ¨è¿›åˆ°ä¸‹ä¸€æ®µ"""</span>
        self.index += <span class="hljs-number">1</span>
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li>é€šè¿‡ <code>index</code> ç»´æŠ¤å¤„ç†è¿›åº¦ï¼Œç¡®ä¿æŒ‰é¡ºåºæ¨è¿›</li>
<li><code>segments</code> å®šä¹‰äº†æ¨é€çš„ä¸¥æ ¼é¡ºåºï¼ˆæ–‡æœ¬æ®µå’Œå˜é‡æ®µäº¤æ›¿ï¼‰</li>
</ul>
<h4 data-id="heading-43">3. StreamCoordinatorRegistryï¼ˆæ³¨å†Œè¡¨ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamCoordinatorRegistry</span>:
    <span class="hljs-string">"""æµå¼è¾“å‡ºåè°ƒå™¨æ³¨å†Œè¡¨ï¼ˆç¼–è¯‘æ—¶ï¼Œæ— çŠ¶æ€ï¼‰"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># æ‹¦æˆªè§„åˆ™ï¼š{message_node_id: InterceptionRule}</span>
        self._interception_rules: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, InterceptionRule] = {}
        
        <span class="hljs-comment"># åå‘ç´¢å¼•ï¼š{node_id: [message_node_ids]}</span>
        <span class="hljs-comment"># ä¾‹å¦‚ï¼š{"llm_1": ["msg_1", "msg_2"]} è¡¨ç¤º llm_1 è¢«ä¸¤ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</span>
        self._node_to_messages: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]] = defaultdict(<span class="hljs-built_in">list</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">register_interception</span>(<span class="hljs-params">
        self,
        message_node_id: <span class="hljs-built_in">str</span>,
        template: <span class="hljs-built_in">str</span>,
        variable_to_node_map: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]]
    </span>):
        <span class="hljs-string">"""
        æ³¨å†Œæ‹¦æˆªè§„åˆ™ï¼ˆåœ¨æ¶ˆæ¯èŠ‚ç‚¹åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰
        
        Args:
            message_node_id: æ¶ˆæ¯èŠ‚ç‚¹ID
            template: æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå¦‚ "AI: {llm_output}\\nç»“æœ: {code_result}"
            variable_to_node_map: å˜é‡æ˜ å°„ï¼Œå¦‚ {
                "llm_output": ("llm_1", "text"),
                "code_result": ("code_1", "result")
            }
        """</span>
        <span class="hljs-comment"># è§£ææ¨¡æ¿ä¸ºæ®µåºåˆ—</span>
        segments = self._parse_template(template, variable_to_node_map)
        
        <span class="hljs-comment"># åˆ›å»ºæ‹¦æˆªè§„åˆ™</span>
        rule = InterceptionRule(
            message_node_id=message_node_id,
            template=template,
            segments=segments,
            variable_to_node_map=variable_to_node_map
        )
        
        <span class="hljs-comment"># å­˜å‚¨è§„åˆ™</span>
        self._interception_rules[message_node_id] = rule
        
        <span class="hljs-comment"># å»ºç«‹åå‘ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢å“ªäº›èŠ‚ç‚¹éœ€è¦è¢«æ‹¦æˆªï¼‰</span>
        <span class="hljs-keyword">for</span> node_id <span class="hljs-keyword">in</span> rule.referenced_nodes:
            self._node_to_messages[node_id].append(message_node_id)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_template</span>(<span class="hljs-params">self, template: <span class="hljs-built_in">str</span>, variable_to_node_map: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">list</span>[Segment]:
        <span class="hljs-string">"""è§£ææ¨¡æ¿ä¸ºæ®µåºåˆ—"""</span>
        segments: <span class="hljs-built_in">list</span>[Segment] = []
        <span class="hljs-comment"># ... è§£æé€»è¾‘ï¼šæŒ‰å˜é‡ä½ç½®åˆ†å‰²æ¨¡æ¿ï¼Œç”Ÿæˆ TextSegment å’Œ VariableSegment</span>
        <span class="hljs-keyword">return</span> segments
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_intercepted</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦è¢«ä»»ä½•æ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨ï¼ˆå¿«é€Ÿè¿‡æ»¤ï¼‰"""</span>
        <span class="hljs-keyword">return</span> node_id <span class="hljs-keyword">in</span> self._node_to_messages
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_rules</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, InterceptionRule]:
        <span class="hljs-string">"""è·å–æ‰€æœ‰æ‹¦æˆªè§„åˆ™"""</span>
        <span class="hljs-keyword">return</span> self._interception_rules.copy()
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åå‘ç´¢å¼•</strong>ï¼šå¿«é€Ÿåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦éœ€è¦è¢«æ‹¦æˆªï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†</li>
<li><strong>æ— çŠ¶æ€</strong>ï¼šåªå­˜å‚¨è®¢é˜…å…³ç³»ï¼Œä¸å­˜å‚¨è¿è¡Œæ—¶æ•°æ®ï¼Œå¯å¤ç”¨</li>
</ul>
<h4 data-id="heading-44">4. MessageStreamCoordinatorï¼ˆåè°ƒå™¨ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageStreamCoordinator</span>:
    <span class="hljs-string">"""æ¶ˆæ¯æµå¼è¾“å‡ºåè°ƒå™¨ï¼ˆè¿è¡Œæ—¶ï¼Œæœ‰çŠ¶æ€ï¼‰"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, registry: StreamCoordinatorRegistry</span>):
        self._registry = registry
        self._lock = asyncio.Lock()  <span class="hljs-comment"># å¼‚æ­¥é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span>
        
        <span class="hljs-comment"># æ´»è·ƒä¼šè¯ï¼š{message_node_id: ResponseSession}</span>
        <span class="hljs-comment"># æ¯ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä¼šè¯ï¼Œç»´æŠ¤å¤„ç†è¿›åº¦</span>
        self._active_sessions: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, ResponseSession] = {}
        
        <span class="hljs-comment"># æµå¼ç¼“å†²åŒºï¼š{(node_id, variable): StreamBuffer}</span>
        <span class="hljs-comment"># ç¼“å­˜ä¸Šæ¸¸èŠ‚ç‚¹çš„æµå¼è¾“å‡º</span>
        self._stream_buffers: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>], StreamBuffer] = defaultdict(StreamBuffer)
        
        <span class="hljs-comment"># å·²å®ŒæˆèŠ‚ç‚¹ï¼š{node_id}</span>
        self._completed_nodes: <span class="hljs-built_in">set</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-built_in">set</span>()
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_node_start</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œæ—¶è°ƒç”¨ï¼ˆæ”¯æŒå¾ªç¯ï¼‰"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> self._lock:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._registry.is_intercepted(node_id):
                <span class="hljs-keyword">return</span>  <span class="hljs-comment"># æœªè¢«å¼•ç”¨ï¼Œæ— éœ€å¤„ç†</span>
            
            <span class="hljs-comment"># é‡ç½®è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰bufferï¼ˆæ¸…ç©ºä¸Šä¸€è½®æ‰§è¡Œçš„æ•°æ®ï¼‰</span>
            keys_to_reset = [key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self._stream_buffers.keys() <span class="hljs-keyword">if</span> key[<span class="hljs-number">0</span>] == node_id]
            <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys_to_reset:
                self._stream_buffers[key] = StreamBuffer()
            
            <span class="hljs-comment"># ä»å®ŒæˆèŠ‚ç‚¹é›†åˆä¸­ç§»é™¤ï¼ˆå…è®¸é‡æ–°æµå¼è¾“å‡ºï¼‰</span>
            self._completed_nodes.discard(node_id)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_stream_chunk</span>(<span class="hljs-params">
        self,
        node_id: <span class="hljs-built_in">str</span>,
        variable: <span class="hljs-built_in">str</span>,
        chunk: <span class="hljs-built_in">str</span>,
        is_final: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    </span>):
        <span class="hljs-string">"""å¤„ç†æµå¼æ•°æ®å—ï¼ˆåœ¨æµå¼èŠ‚ç‚¹äº§ç”Ÿæ•°æ®æ—¶è°ƒç”¨ï¼‰"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> self._lock:
            <span class="hljs-comment"># å¿«é€Ÿè¿‡æ»¤ï¼šæ£€æŸ¥æ˜¯å¦è¢«ä»»ä½•æ¶ˆæ¯èŠ‚ç‚¹å¼•ç”¨</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self._registry.is_intercepted(node_id):
                <span class="hljs-keyword">return</span>  <span class="hljs-comment"># æœªè¢«å¼•ç”¨ï¼Œå¿½ç•¥</span>
            
            <span class="hljs-comment"># æ‹¦æˆªåˆ°ç¼“å†²åŒº</span>
            selector = (node_id, variable)
            stream_chunk = StreamChunk(selector=selector, chunk=chunk, is_final=is_final)
            self._stream_buffers[selector].append(stream_chunk)
            
            <span class="hljs-keyword">if</span> is_final:
                self._stream_buffers[selector].close()
            
            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨ä¼šè¯ï¼Œå¹¶å°è¯•æ¨é€</span>
            <span class="hljs-keyword">await</span> self._check_and_start_sessions(node_id)
            <span class="hljs-keyword">await</span> self._try_push_streams()
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_node_completed</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span>, outputs: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""å¤„ç†èŠ‚ç‚¹å®Œæˆäº‹ä»¶ï¼ˆåœ¨èŠ‚ç‚¹æ‰§è¡Œå®Œæˆæ—¶è°ƒç”¨ï¼‰"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> self._lock:
            <span class="hljs-comment"># è®°å½•èŠ‚ç‚¹å®Œæˆ</span>
            self._completed_nodes.add(node_id)
            
            <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯åŠ¨ä¼šè¯ï¼Œå¹¶å°è¯•æ¨é€ï¼ˆå¯èƒ½æœ‰æ–°çš„æ ‡é‡æ•°æ®å¯ç”¨ï¼‰</span>
            <span class="hljs-keyword">await</span> self._check_and_start_sessions(node_id)
            <span class="hljs-keyword">await</span> self._try_push_streams()
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_check_and_start_sessions</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""æ£€æŸ¥å¹¶å¯åŠ¨å¯ä»¥å¼€å§‹çš„ä¼šè¯"""</span>
        <span class="hljs-comment"># éå†æ‰€æœ‰æ³¨å†Œçš„æ¶ˆæ¯èŠ‚ç‚¹</span>
        <span class="hljs-keyword">for</span> message_node_id, rule <span class="hljs-keyword">in</span> self._registry.get_all_rules().items():
            <span class="hljs-keyword">if</span> message_node_id <span class="hljs-keyword">in</span> self._active_sessions:
                <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># å·²å¯åŠ¨ï¼Œè·³è¿‡</span>
            
            <span class="hljs-comment"># æ‰¾åˆ°ç¬¬ä¸€ä¸ªå˜é‡æ®µ</span>
            first_var_segment = <span class="hljs-built_in">next</span>(
                (seg <span class="hljs-keyword">for</span> seg <span class="hljs-keyword">in</span> rule.segments <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(seg, VariableSegment)),
                <span class="hljs-literal">None</span>
            )
            
            <span class="hljs-comment"># å¦‚æœç¬¬ä¸€ä¸ªå˜é‡æ®µå¯¹åº”çš„èŠ‚ç‚¹å·²å‡†å¤‡å¥½ï¼Œå¯åŠ¨ä¼šè¯</span>
            <span class="hljs-keyword">if</span> first_var_segment <span class="hljs-keyword">and</span> first_var_segment.node_id == node_id:
                selector = (first_var_segment.node_id, first_var_segment.node_variable)
                buffer = self._stream_buffers.get(selector)
                
                <span class="hljs-comment"># æ£€æŸ¥æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼ˆæµå¼æ•°æ®æˆ–æ ‡é‡æ•°æ®ï¼‰</span>
                has_stream_data = buffer <span class="hljs-keyword">and</span> (buffer.has_unread() <span class="hljs-keyword">or</span> buffer.is_closed)
                has_scalar_data = self._get_variable_value(node_id, ...) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
                
                <span class="hljs-keyword">if</span> has_stream_data <span class="hljs-keyword">or</span> has_scalar_data:
                    <span class="hljs-comment"># å¯åŠ¨ä¼šè¯</span>
                    session = ResponseSession(node_id=message_node_id, rule=rule)
                    self._active_sessions[message_node_id] = session
                    
                    <span class="hljs-comment"># ç«‹å³å°è¯•æ¨é€</span>
                    <span class="hljs-keyword">await</span> self._try_push_streams()
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_try_push_streams</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å°è¯•æ¨é€æµå¼æ•°æ®ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰"""</span>
        <span class="hljs-comment"># éå†æ‰€æœ‰æ´»è·ƒä¼šè¯</span>
        <span class="hljs-keyword">for</span> session_id, session <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(self._active_sessions.items()):
            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> session.is_complete():
                segment = session.current_segment()
                <span class="hljs-keyword">if</span> segment <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                    <span class="hljs-keyword">break</span>
                
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(segment, TextSegment):
                    <span class="hljs-comment"># æ–‡æœ¬æ®µï¼šç›´æ¥æ¨é€</span>
                    <span class="hljs-keyword">await</span> self._push_chunk(session.node_id, segment.text, is_final=<span class="hljs-literal">False</span>)
                    session.advance()  <span class="hljs-comment"># æ¨è¿›åˆ°ä¸‹ä¸€æ®µ</span>
                
                <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(segment, VariableSegment):
                    selector = (segment.node_id, segment.node_variable)
                    buffer = self._stream_buffers.get(selector)
                    
                    <span class="hljs-keyword">if</span> buffer <span class="hljs-keyword">and</span> buffer.has_unread():
                        <span class="hljs-comment"># æµå¼æ•°æ®ï¼šä»ç¼“å†²åŒºè¯»å–å¹¶æ¨é€</span>
                        <span class="hljs-keyword">while</span> buffer.has_unread():
                            chunk = buffer.pop()
                            <span class="hljs-keyword">await</span> self._push_chunk(session.node_id, chunk.chunk, is_final=<span class="hljs-literal">False</span>)
                        
                        <span class="hljs-comment"># å¦‚æœæµå·²å…³é—­ï¼Œæ¨è¿›åˆ°ä¸‹ä¸€æ®µ</span>
                        <span class="hljs-keyword">if</span> buffer.is_closed:
                            session.advance()
                        <span class="hljs-keyword">else</span>:
                            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># ç­‰å¾…æ›´å¤šæ•°æ®</span>
                    <span class="hljs-keyword">else</span>:
                        <span class="hljs-comment"># å°è¯•ä»èŠ‚ç‚¹è¾“å‡ºè·å–æ ‡é‡å€¼</span>
                        value = self._get_variable_value(...)
                        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                            <span class="hljs-keyword">await</span> self._push_chunk(session.node_id, <span class="hljs-built_in">str</span>(value), is_final=<span class="hljs-literal">False</span>)
                            session.advance()
                        <span class="hljs-keyword">else</span>:
                            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ•°æ®æœªå‡†å¤‡å¥½ï¼Œåœæ­¢æ¨é€</span>
            
            <span class="hljs-comment"># ä¼šè¯å®Œæˆ</span>
            <span class="hljs-keyword">if</span> session.is_complete():
                <span class="hljs-keyword">await</span> self._push_chunk(session.node_id, <span class="hljs-string">""</span>, is_final=<span class="hljs-literal">True</span>)
                <span class="hljs-keyword">del</span> self._active_sessions[session_id]
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_push_chunk</span>(<span class="hljs-params">self, node_id: <span class="hljs-built_in">str</span>, chunk: <span class="hljs-built_in">str</span>, is_final: <span class="hljs-built_in">bool</span></span>):
        <span class="hljs-string">"""æ¨é€æ•°æ®å—åˆ°å‰ç«¯ï¼ˆé€šè¿‡äº‹ä»¶ç³»ç»Ÿï¼‰"""</span>
        <span class="hljs-comment"># é€šè¿‡äº‹ä»¶ç³»ç»Ÿå‘é€ MESSAGE_CHUNK äº‹ä»¶</span>
        <span class="hljs-comment"># stream_writer(CustomWorkflowEvent(...))</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¼‚æ­¥é”</strong>ï¼šä¿è¯å¤šçº¿ç¨‹/å¤šåç¨‹ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨</li>
<li><strong>ä¼šè¯ç®¡ç†</strong>ï¼šæ¯ä¸ªæ¶ˆæ¯èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä¼šè¯ï¼Œç‹¬ç«‹æ¨è¿›</li>
<li><strong>é˜»å¡æœºåˆ¶</strong>ï¼šé‡åˆ°æœªå°±ç»ªçš„æ•°æ®æ—¶åœæ­¢æ¨é€ï¼Œç­‰å¾…æ•°æ®å°±ç»ªåç»§ç»­</li>
<li><strong>æ··åˆå¤„ç†</strong>ï¼šåŒæ—¶æ”¯æŒæµå¼æ•°æ®å’Œæ ‡é‡æ•°æ®</li>
</ul>
<p>å¸Œæœ›æœ¬æ–‡çš„è®¾è®¡æ€è·¯å’Œä»£ç ç¤ºä¾‹èƒ½ä¸ºä½ æ„å»ºç±»ä¼¼çš„æµå¼è¾“å‡ºç³»ç»Ÿæä¾›å‚è€ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ã€åœºæ™¯ç­‰]]></title>    <link>https://juejin.cn/post/7579485652528185379</link>    <guid>https://juejin.cn/post/7579485652528185379</guid>    <pubDate>2025-12-04T02:53:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579485652528185379" data-draft-id="7579496954252525608" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ã€åœºæ™¯ç­‰"/> <meta itemprop="keywords" content="äº§å“"/> <meta itemprop="datePublished" content="2025-12-04T02:53:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§‚æµ‹äº‘äº§å“æ›´æ–° | åº”ç”¨æ€§èƒ½ç›‘æµ‹ã€ç”¨æˆ·è®¿é—®ç›‘æµ‹ã€åœºæ™¯ç­‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:53:25.000Z" title="Thu Dec 04 2025 02:53:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è§‚æµ‹äº‘æ›´æ–°</h2>
<h3 data-id="heading-1">åº”ç”¨æ€§èƒ½ç›‘æµ‹</h3>
<p>1ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fapplication-performance-monitoring%2Fservice-manag%2Fservice-map%2F" target="_blank" title="https://docs.guance.com/application-performance-monitoring/service-manag/service-map/" ref="nofollow noopener noreferrer">æœåŠ¡æ‹“æ‰‘</a>ï¼š</p>
<ul>
<li>ç‚¹å‡»èŠ‚ç‚¹ï¼Œæ–°å¢å³ä¾§åˆ’å¯¹åº”æœåŠ¡è¯¦æƒ…ï¼Œé™¤æœåŠ¡åç§°ã€å¯¹åº”å›¢é˜Ÿã€è”ç³»æ–¹å¼ã€å‘Šè­¦æ•°é‡ã€åŸºç¡€æŒ‡æ ‡æ•°æ®å¤–ï¼Œå±•ç¤ºæŒ‡æ ‡ï¼ˆæœåŠ¡è¯·æ±‚å“åº”æ—¶é—´ã€é”™è¯¯è¯·æ±‚åˆ†å¸ƒï¼‰å’Œæ—¥å¿—ï¼ˆé”™è¯¯æ—¥å¿—æ•°ï¼‰çš„å¼‚å¸¸è¶‹åŠ¿å›¾ï¼›</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c1089829d3042e6b028346154d47ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=BBcubFh9%2FUiKb7ATJNH9G5AAyDQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>æ–°å¢æ“ä½œæŒ‰é’®ï¼šå¯ç¼©å°ã€æ”¾å¤§ã€å®Œæ•´æ˜¾ç¤ºæ•´ä½“æ‹“æ‰‘å›¾ï¼›</p>
</li>
<li>
<p>æ–°å¢æ‹“æ‰‘å›¾é…ç½®ï¼š</p>
<ul>
<li>ç”¨æˆ·å¯æ‰‹åŠ¨é…ç½®æ˜¯å¦æŒ‰â€œè¯·æ±‚æ•°â€è®¡ç®—èŠ‚ç‚¹å¤§å°ï¼›</li>
<li>ç”¨æˆ·å¯é€‰æ‹©æ‚¬æµ®é«˜äº®èŒƒå›´ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7c68d92c591438d89d73ed61e06e9fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=uaqoLx%2BYSUeyQMDIzVjO5i19bjE%3D" alt="" loading="lazy"/></p>
<p>2ã€æ€§èƒ½æŒ‡æ ‡ï¼š</p>
<ul>
<li>æ–°å¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fapplication-performance-monitoring%2Fservice-manag%2Fservice-performance%2F%23custom-filter" target="_blank" title="https://docs.guance.com/application-performance-monitoring/service-manag/service-performance/#custom-filter" ref="nofollow noopener noreferrer">ç­›é€‰å­—æ®µé…ç½®</a>ï¼Œé™¤å®˜æ–¹é»˜è®¤ç­›é€‰å­—æ®µå¤–ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰æœ€å¤š 5 ä¸ªå­—æ®µä½œä¸ºç­›é€‰å­—æ®µï¼›</li>
<li>æ–°å¢æ”¯æŒå¯¼å‡ºå½“å‰æ€§èƒ½æŒ‡æ ‡åˆ—è¡¨ä¸º CSV æ–‡ä»¶ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f81ed6dc6a74ad59fa3879df22e73bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=iD%2BLWgB8v1plckkG6q6XH%2B3QV%2B8%3D" alt="" loading="lazy"/></p>
<p>3ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fapplication-performance-monitoring%2Fservice-manag%2Fservice-list-details%2F%23innvocation" target="_blank" title="https://docs.guance.com/application-performance-monitoring/service-manag/service-list-details/#innvocation" ref="nofollow noopener noreferrer">æœåŠ¡æ¸…å• &gt; èµ„æºè°ƒç”¨</a>ï¼š</p>
<ul>
<li>æ–°å¢é‡‡æ ·æç¤ºï¼šå½“èµ„æºåˆ—è¡¨å’Œåˆ†å¸ƒå›¾æŸ¥è¯¢è§¦å‘é‡‡æ ·æ—¶ï¼Œæ˜¾ç¤ºâ€œé‡‡æ ·ç‡ iconâ€ï¼›</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e9712ea511436e8d6578710bb2897a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=XIoxchGZpcmT2GDMQHleudNaMsY%3D" alt="" loading="lazy"/></p>
<ul>
<li>ä¸Šä¸‹æ¸¸æ‹“æ‰‘ï¼šæ–°å¢â€œæŸ¥çœ‹ä¸Šæ¸¸/ä¸‹æ¸¸è°ƒç”¨â€æŒ‰é’®ï¼Œæ”¯æŒåŸºäºå½“å‰æ‹“æ‰‘ç»§ç»­æŸ¥çœ‹ä¸Š/ä¸‹å±‚çº§çš„è°ƒç”¨å…³ç³»ï¼Œå®ç°ä»å½“å‰èµ„æºå‡ºå‘çš„å…¨é“¾è·¯è·¯å¾„åˆ†æã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9a7acb0551b41bca4c18f989fe1da70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=A8UYDgQlk63CO35TqY3lh3aLQT8%3D" alt="" loading="lazy"/></p>
<p>4ã€é“¾è·¯ &gt; æœåŠ¡è°ƒç”¨å…³ç³»ï¼š</p>
<ul>
<li>äº¤äº’ä¼˜åŒ–ï¼šä»…ç»˜åˆ¶ä¸åŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨è·¯å¾„ï¼Œä½¿ä¾èµ–å…³ç³»æ›´æ¸…æ™°ï¼›</li>
<li>èŠ‚ç‚¹ä¿¡æ¯å¢å¼ºï¼šé€šè¿‡å·¦å³ç»“æ„å±•ç¤ºå…¨è·¯å¾„æœåŠ¡è°ƒç”¨å…³ç³»ï¼ŒåŒæ—¶åœ¨æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸Šï¼Œç›´æ¥å±•ç¤ºæ‰§è¡Œæ—¶é—´ã€å¹³å‡å“åº”æ—¶é—´ã€è°ƒç”¨æ¬¡æ•°ã€é”™è¯¯ä¿¡æ¯ï¼›ç‚¹å‡»å¯æŸ¥çœ‹æœçš„çˆ¶çº§ Spanï¼Œç”¨äºè¿½æº¯ä¸Šæ¸¸è°ƒç”¨æ¥æºï¼›è‹¥è¯¥æœåŠ¡å­˜åœ¨é”™è¯¯ï¼Œå°†ç›´æ¥å±•ç¤ºé”™è¯¯è¯¦æƒ…ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48d8ad6157374487a670c2bdec602da1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=6LHqTJ498X178KVpxzxw1cPbPng%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">ç”¨æˆ·è®¿é—®ç›‘æµ‹</h3>
<p>1ã€ä¸ºé€‚é…é¸¿è’™ï¼ˆHarmonyOSï¼‰ç”Ÿæ€å‘å±•ï¼Œæ–°å¢æ”¯æŒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Freal-user-monitoring%2Fharmonyos%2Fapp-access%2F" target="_blank" title="https://docs.guance.com/real-user-monitoring/harmonyos/app-access/" ref="nofollow noopener noreferrer">åº”ç”¨ç±»å‹ HarmonyOS</a>ã€‚ç”¨æˆ·å¯åœ¨åˆ›å»ºåº”ç”¨æ—¶é€‰æ‹© HarmonyOSï¼Œå¹¶è·å–å¯¹åº”çš„ SDK é›†æˆæŒ‡å¼•ä¸é…ç½®æ”¯æŒï¼Œå®ç°é¸¿è’™åº”ç”¨çš„å®Œæ•´å¯è§‚æµ‹æ€§æ¥å…¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8600bf7a56544b1ab92b1c754b9c1642~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=QyAaiND%2B%2BTNSr4uFPLZH%2BsAui9o%3D" alt="" loading="lazy"/></p>
<p>2ã€View æŸ¥çœ‹å™¨é¡µé¢æ”¯æŒ Obsy AI é”™è¯¯åˆ†æã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12e43f8d2ed7411e9767285e75f54908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=juExzwhjRh4kEjdevLqYyupcuOo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">äº‹ä»¶ä¸­å¿ƒ</h3>
<p>æ–°å¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fevents%2Funrecovered-events%2F%23level" target="_blank" title="https://docs.guance.com/events/unrecovered-events/#level" ref="nofollow noopener noreferrer">äº‹ä»¶ç­‰çº§</a>ï¼šè‡´å‘½ï¼ˆ<code>df_status:fatal</code>ï¼‰ï¼Œå®šä¹‰ä¸ºæœ€é«˜ç­‰çº§ã€‚</p>
<h3 data-id="heading-4">MCP Server</h3>
<p>æ–°å¢æ”¯æŒä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmcp-server%2F%23use-case" target="_blank" title="https://docs.guance.com/mcp-server/#use-case" ref="nofollow noopener noreferrer">æ ‡å‡†åŒ–æ–¹å¼</a>æŸ¥è¯¢æŒ‡æ ‡ã€é“¾è·¯ã€RUM æ•°æ®ã€‚</p>
<h3 data-id="heading-5">ç®¡ç†</h3>
<p>1ã€æ•°æ®è½¬å‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Fbackup%2Fmanag-backup%2F%23delete" target="_blank" title="https://docs.guance.com/management/backup/manag-backup/#delete" ref="nofollow noopener noreferrer">åˆ é™¤è§„åˆ™</a>æ—¶ï¼Œéœ€è¾“å…¥è§„åˆ™åç§°ä»¥ç¡®è®¤æ“ä½œï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f90c11ce7f0343d9988732db5bc5cb05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=JRUQs2JmZaXooZy7rOTWztiW%2F3s%3D" alt="" loading="lazy"/></p>
<p>2ã€æˆå‘˜ç®¡ç†ï¼šæ”¯æŒä¸ºå›¢é˜Ÿ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmanagement%2Fmember-management%2F%23edit-team" target="_blank" title="https://docs.guance.com/management/member-management/#edit-team" ref="nofollow noopener noreferrer">èµ‹äºˆè§’è‰²</a>ã€‚å›¢é˜Ÿè§’è‰²ä¼šä½œä¸ºé™„åŠ è§’è‰²è‡ªåŠ¨åº”ç”¨äºå›¢é˜Ÿæˆå‘˜ï¼Œæˆå‘˜æœ€ç»ˆæƒé™åŒ…å«ä¸ªäººè§’è‰²ä¸å›¢é˜Ÿè§’è‰²ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d798d9da53b6487b8e3c964cda999886~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=nd8aJtC0f%2B5OfYTR8aYVx6vAfRw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">åœºæ™¯</h3>
<p>1ã€ä»ªè¡¨æ¿ï¼š</p>
<ul>
<li>æ–°å¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fdashboard%2Fconfig-page%2F%23filter" target="_blank" title="https://docs.guance.com/scene/dashboard/config-page/#filter" ref="nofollow noopener noreferrer">â€œç­›é€‰å™¨â€</a>æŒ‰é’®ï¼Œç”¨äºå¿«é€Ÿæ·»åŠ å…¨å±€è¿‡æ»¤æ¡ä»¶ï¼›</li>
<li>åŸæœ‰â€œå†å²ç‰ˆæœ¬â€ã€â€œå¤§å±æ¨¡å¼â€ã€â€œæŠ¥å‘Šè®°å½•â€ç­‰åŠŸèƒ½ç§»è‡³<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fdashboard%2Fconfig-page%2F%23settings" target="_blank" title="https://docs.guance.com/scene/dashboard/config-page/#settings" ref="nofollow noopener noreferrer">â€œè®¾ç½®â€</a>ä¸‹æ‹‰èœå•ä¸­ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380cfb9b0c83468baf57b997d5a6e2a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=fY0MVydPVUmTlTLwozl3HDdNIoM%3D" alt="" loading="lazy"/></p>
<p>2ã€å›¾è¡¨ï¼š</p>
<ul>
<li>é«˜çº§é…ç½®ï¼šæ–°å¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fvisual-chart%2Ftimeseries-chart%2F%23repeat" target="_blank" title="https://docs.guance.com/scene/visual-chart/timeseries-chart/#repeat" ref="nofollow noopener noreferrer">â€œé‡å¤å›¾è¡¨â€</a>é€‰é¡¹ã€‚å¼€å¯åï¼Œç³»ç»Ÿä¼šæ ¹æ®æ‰€é€‰è§†å›¾å˜é‡çš„å„ä¸ªå€¼ï¼ŒæŒ‰ç›¸åŒç»“æ„ç”Ÿæˆå¤šå¼ å›¾è¡¨ï¼›</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da75d1f2adb24cff880e24e83130e0b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=0eQHHy%2BBfYvz2x8eU7rASeToubo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ca56d9cfbb9459eae68521f79a7267e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=u4EQm1MTK1uUPhsAwK28ZRb3gZU%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç‚¹å‡»æŸä¸€æ•°æ®ç‚¹ï¼Œæ–°å¢æ”¯æŒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fdashboard%2Fconfig-page%2F%23use-case" target="_blank" title="https://docs.guance.com/scene/dashboard/config-page/#use-case" ref="nofollow noopener noreferrer">åº”ç”¨åˆ°ç­›é€‰å™¨</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fvisual-chart%2F%23related-analysis" target="_blank" title="https://docs.guance.com/scene/visual-chart/#related-analysis" ref="nofollow noopener noreferrer">å¤åˆ¶åˆ†ç»„æ ‡ç­¾</a>ï¼›</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa709ab68e864e2182481fb749082e0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421605&amp;x-signature=sGEFpxQREU3zMDNDevXdFE1GGI0%3D" alt="" loading="lazy"/></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fscene%2Fvisual-chart%2Ftable-chart%2F" target="_blank" title="https://docs.guance.com/scene/visual-chart/table-chart/" ref="nofollow noopener noreferrer">è¡¨æ ¼å›¾</a>ï¼šæ‰‹åŠ¨è¾“å…¥è¿”å›æ•°é‡ä¸Šé™å¢åŠ è‡³ 2000ã€‚</li>
</ul>
<h3 data-id="heading-7">ç›‘æ§</h3>
<p>å‘Šè­¦èšåˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fmonitoring%2Falert-template%2F" target="_blank" title="https://docs.guance.com/monitoring/alert-template/" ref="nofollow noopener noreferrer">é€šçŸ¥æ¨¡ç‰ˆä¼˜åŒ–</a>ï¼šåœ¨è§„åˆ™èšåˆä¸æ™ºèƒ½èšåˆçš„é€šçŸ¥ä¸­ï¼Œå±•ç¤ºå½“å‰èšåˆå‘¨æœŸå†…è§¦å‘çš„ä¸åŒäº‹ä»¶æ•°é‡ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿè¯†åˆ«å‘Šè­¦å…³è”çš„äº‹ä»¶è§„æ¨¡ä¸å½±å“èŒƒå›´ã€‚</p>
<h2 data-id="heading-8">é›†æˆæ›´æ–°</h2>
<ul>
<li>
<p>Openresty æ–°å¢ OpenTelemetry é“¾è·¯æ¥å…¥æ–¹å¼ï¼›</p>
</li>
<li>
<p>æ–°å¢ Zabbix é›†æˆï¼ŒåŸºäº api\streamï¼›</p>
</li>
<li>
<p>æ–°å¢é˜¿é‡Œäº‘äº‘åŸç”Ÿ API ç½‘å…³é›†æˆã€é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—é›†æˆï¼›</p>
</li>
<li>
<p>æ–°å¢åä¸ºäº‘ EVS äº‘ç¡¬ç›˜é›†æˆï¼›</p>
</li>
<li>
<p>æ–°å¢è…¾è®¯äº‘ WAF ç›‘æ§å™¨ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ–é˜¿é‡Œäº‘ NLB è§†å›¾&amp;é›†æˆæ–‡æ¡£ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ–é˜¿é‡Œäº‘ SLB è§†å›¾ï¼›</p>
</li>
<li>
<p>ä¿®å¤ iis é›†æˆè§†å›¾ç›‘æ§å™¨ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ–åä¸ºäº‘ ECSã€CSSã€Functiongraph è§†å›¾å’Œç›‘æ§å™¨ï¼›</p>
</li>
<li>
<p>ä¼˜åŒ–è…¾è®¯äº‘ clb ç›‘æ§å™¨/è§†å›¾ï¼›</p>
</li>
<li>
<p>è¡¥å……åä¸ºäº‘ DC/ é˜¿é‡Œäº‘ SLB ç›‘æ§å™¨ï¼›</p>
</li>
<li>
<p>ä¸‹æ¶åä¸ºäº‘ GuassDB ç›¸å…³é›†æˆï¼ˆåä¸ºäº‘ä¸‹æ¶äº†ç›¸å…³äº§å“ï¼‰ï¼›</p>
</li>
<li>
<p>ä¿®å¤åä¸ºäº‘ ROMA è„šæœ¬ï¼›</p>
</li>
<li>
<p>æ–°å¢ CSPM æ¨¡ç‰ˆï¼š</p>
<ul>
<li>S3 å­˜å‚¨æ¡¶åº”å¯ç”¨ â€œMFA åˆ é™¤â€åŠŸèƒ½ï¼›</li>
<li>S3 å­˜å‚¨æ¡¶ ACL åº”é™åˆ¶å…¬ç½‘è®¿é—®ï¼›</li>
<li>S3 å­˜å‚¨æ¡¶å†…å®¹è®¿é—®åº”é™äºæˆæƒä¸»ä½“ï¼›</li>
<li>IAM ç”¨æˆ·ä¸åº”é™„åŠ  â€œAdministratorAccessâ€ ç­–ç•¥ï¼›</li>
<li>IAM ç­–ç•¥åº”åœ¨ç»„çº§åˆ«è¿›è¡Œé™„åŠ å’Œç®¡ç†ã€‚</li>
</ul>
</li>
<li>
<p>æ–°å¢èµ„æºç›®å½•æ¨¡ç‰ˆï¼š</p>
<ul>
<li>åä¸ºäº‘ï¼šddsã€functiongraphã€kafkaã€obsã€rds(mysql)ã€rds_mariadbã€rds_sqlserver</li>
<li>ç«å±±äº‘ï¼špostgresql</li>
<li>é˜¿é‡Œäº‘ï¼šnat</li>
<li>è…¾è®¯äº‘ï¼štdsql_c_mysqlã€mongodbã€eipã€cos</li>
<li>AWSï¼šiam_user</li>
</ul>
</li>
<li>
<p>äº‘é›†æˆæ¨¡ç‰ˆï¼š</p>
<ul>
<li>æ–°å¢è…¾è®¯äº‘ ckafkaã€esã€redisã€waf ç­‰ï¼›</li>
<li>ä¼˜åŒ–åä¸ºäº‘ï¼šrdsã€postgreslã€apigï¼›</li>
<li>ä¼˜åŒ– AWSï¼šWAFã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">DataKit æ›´æ–°</h2>
<ul>
<li>ä¿®å¤ OpenTelemetry/DDtrace é‡‡æ ·æ—¶æŒ‡æ ‡ç»Ÿè®¡é—®é¢˜</li>
<li>cgroup ä¼˜å…ˆä½¿ç”¨ v2 ç‰ˆæœ¬ï¼Œé¿å…æŸäº›æƒ…å†µä¸‹ cgroup ä¸ç”Ÿæ•ˆé—®é¢˜</li>
<li>9529 API å¢åŠ æ›´å¤šè¶…æ—¶ä¿æŠ¤ï¼Œç§»é™¤åŸæ¥ gin timeout ä¸­é—´ä»¶</li>
<li>Redis é‡‡é›†å™¨é…ç½®ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ v2 æŒ‡æ ‡é›†å‘½å</li>
<li>ä¼˜åŒ– eBPF é‡‡é›†å¯¹ Kubernetes API çš„æ¶ˆè€—</li>
<li>logfwd è¡¥å…¨ from-beginning æœ‰å…³çš„é…ç½®</li>
<li>ä¿®æ­£ OpenTelemetry é‡‡é›†å™¨é…ç½®ä¸­çš„æ‹¼å†™é”™è¯¯Â <code>split_service_name</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Vue2-Niubility-Uploaderã€‘ä¸€ä¸ªå¼ºå¤§çš„ Vue2 æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7579573664228573193</link>    <guid>https://juejin.cn/post/7579573664228573193</guid>    <pubDate>2025-12-04T02:46:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579573664228573193" data-draft-id="7579673620940587058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Vue2-Niubility-Uploaderã€‘ä¸€ä¸ªå¼ºå¤§çš„ Vue2 æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-04T02:46:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹¾æ™šéœ"/> <meta itemprop="url" content="https://juejin.cn/user/3597257778413240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Vue2-Niubility-Uploaderã€‘ä¸€ä¸ªå¼ºå¤§çš„ Vue2 æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3597257778413240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹¾æ™šéœ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:46:23.000Z" title="Thu Dec 04 2025 02:46:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•è¨€</h2>
<p>åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä½†åˆå……æ»¡æŒ‘æˆ˜çš„åŠŸèƒ½ã€‚å¼€å‘è€…ç»å¸¸ä¼šé‡åˆ°ä»¥ä¸‹ç—›ç‚¹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9074b55daecd4e7485a2790e0784b09a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ou-5pma6Zye:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421183&amp;x-signature=Z1%2B1BBPHjlh6agF4%2BzOl98qLkqc%3D" alt="poster.png" loading="lazy"/></p>
<ul>
<li>å¤§æ–‡ä»¶ä¸Šä¼ å®¹æ˜“è¶…æ—¶æˆ–å¤±è´¥</li>
<li>ç½‘ç»œä¸ç¨³å®šå¯¼è‡´ä¸Šä¼ ä¸­æ–­åéœ€è¦é‡æ–°ä¸Šä¼ </li>
<li>ç¼ºä¹è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒåé¦ˆï¼ˆè¿›åº¦ã€é€Ÿåº¦ç­‰ï¼‰</li>
<li>éš¾ä»¥æ§åˆ¶å¹¶å‘ä¸Šä¼ æ•°é‡</li>
<li>ä¸åŒåœºæ™¯éœ€è¦ä¸åŒçš„ UI å±•ç¤º</li>
</ul>
<p><code>vue2-niubility-uploader</code> æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹è€Œè¯ç”Ÿçš„ä¸€ä¸ªè½»é‡çº§ã€åŠŸèƒ½å¼ºå¤§çš„ Vue2 ä¸Šä¼ ç»„ä»¶ã€‚å®ƒä¸ä»…æä¾›äº†å®Œæ•´çš„ä¸Šä¼ åŠŸèƒ½ï¼Œè¿˜å…·å¤‡åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ ã€æ‹–æ‹½ä¸Šä¼ ç­‰é«˜çº§ç‰¹æ€§ï¼Œè®©æ–‡ä»¶ä¸Šä¼ å˜å¾—ç®€å•è€Œå¯é ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ <code>vue2-niubility-uploader</code> ç»„ä»¶ï¼Œæ‰“é€ å‡ºè‰²çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F941477276.github.io%2Fvue2-niubility-uploader%2Fdist%2F%23%2Fstart" target="_blank" title="https://941477276.github.io/vue2-niubility-uploader/dist/#/start" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£åŠDemo</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F941477276%2Fvue2-niubility-uploader" target="_blank" title="https://github.com/941477276/vue2-niubility-uploader" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fvue2-niubility-uploader" target="_blank" title="https://www.npmjs.com/package/vue2-niubility-uploader" ref="nofollow noopener noreferrer">NPM åŒ…</a></li>
</ul>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒç‰¹æ€§æ¦‚è§ˆ</h2>
<h3 data-id="heading-2">2.1 åŸºç¡€åŠŸèƒ½</h3>
<p><strong>å•æ–‡ä»¶/å¤šæ–‡ä»¶ä¸Šä¼ </strong></p>
<p>ç»„ä»¶æ”¯æŒä¸¤ç§ä¸Šä¼ æ¨¡å¼ï¼šå•æ–‡ä»¶ä¸Šä¼ å’Œå¤šæ–‡ä»¶æ‰¹é‡ä¸Šä¼ ã€‚é€šè¿‡ç®€å•çš„ <code>multiple</code> å±æ€§å³å¯åˆ‡æ¢ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å•æ–‡ä»¶ä¸Šä¼  --&gt;
&lt;Vue2NiubilityUploader :request-handler="requestHandler" /&gt;

&lt;!-- å¤šæ–‡ä»¶ä¸Šä¼  --&gt;
&lt;Vue2NiubilityUploader :request-handler="requestHandler" multiple /&gt;
</code></pre>
<p><strong>æ–‡ä»¶ç±»å‹å’Œå¤§å°é™åˆ¶</strong></p>
<p>é€šè¿‡ <code>accept</code>ã€<code>limit</code> å’Œ <code>maxSize</code> å±æ€§ï¼Œå¯ä»¥è½»æ¾æ§åˆ¶ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€æ•°é‡å’Œå¤§å°ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Vue2NiubilityUploader
  :request-handler="requestHandler"
  accept="image/*,.pdf,.doc"
  :limit="10"
  :max-size="50*1024*1024"
/&gt;
</code></pre>
<h3 data-id="heading-3">2.2 é«˜çº§åŠŸèƒ½</h3>
<p><strong>å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ </strong></p>
<p>å¯¹äºå¤§æ–‡ä»¶ä¸Šä¼ ï¼Œç»„ä»¶æ”¯æŒè‡ªåŠ¨åˆ†ç‰‡ï¼Œå°†å¤§æ–‡ä»¶åˆ‡åˆ†æˆå¤šä¸ªå°å—å¹¶è¡Œä¸Šä¼ ï¼Œå¤§å¤§æé«˜äº†ä¸Šä¼ çš„å¯é æ€§å’Œé€Ÿåº¦ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5608f0f0b441467f815788463cfd13e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ou-5pma6Zye:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421183&amp;x-signature=ygG%2FjJvrinUKbzpi3TJ0UA%2FYvXA%3D" alt="chunk-upload-demo.gif" loading="lazy"/></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Vue2NiubilityUploader
    ref="fileUploader"
    :request-handler="uploadChunk"
    :before-upload="initChunkUpload"
    :chunk-upload-completed="mergeChunks"
    use-chunked-upload
    :chunk-size="10*1024*1024"
    :max-concurrent-uploads="3"
    @file-upload-progress="onProgress"
  /&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  methods: {
    async initChunkUpload(fileData) {
      if (!fileData.useChunked) return;

      // åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ ï¼Œè·å– uploadId
      const response = await this.$http.post('/api/upload/init', {
        fileName: fileData.file.name,
        fileSize: fileData.file.size,
        totalChunks: fileData.chunks
      });

      // å°† uploadId ä¿å­˜åˆ°æ‰©å±•æ•°æ®ä¸­
      fileData.extendData.uploadId = response.data.uploadId;

      // è®¾ç½®å·²ä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•ï¼Œç»„ä»¶åœ¨ä¸Šä¼ åˆ†ç‰‡æ—¶ä¼šè·³è¿‡è¿™äº›å·²ä¸Šä¼ çš„åˆ†ç‰‡
      // fileData.setUploadedChunks(fileData.id, response.data.uploadedChunks || []);
      // å¦‚æœæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œè¿”å›å·²ä¸Šä¼ çš„åˆ†ç‰‡åˆ—è¡¨
      return response.data;
    },

    uploadChunk({ chunk, chunkIndex, fileData: chunkFileData }) {
      const formData = new FormData();
      formData.append('file', chunk);
      formData.append('uploadId', chunkFileData.extendData.uploadId);
      formData.append('chunkIndex', chunkIndex);
      formData.append('totalChunks', chunkFileData.chunks);

      return {
        url: '/api/upload/chunk',
        method: 'POST',
        data: formData
      };
    },

    async mergeChunks(fileData) {
      // æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆï¼Œåˆå¹¶åˆ†ç‰‡
      const response = await this.$http.post('/api/upload/merge', {
        uploadId: fileData.extendData.uploadId,
        fileName: fileData.file.name,
        totalChunks: fileData.chunks
      });

      return response.data;
    },

    onProgress(fileData) {
      console.log(`${fileData.name} ä¸Šä¼ è¿›åº¦: ${fileData.progress}%`);
      console.log(`ä¸Šä¼ é€Ÿåº¦: ${fileData.speed}`);
      console.log(`å‰©ä½™æ—¶é—´: ${fileData.remainingTime}`);
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-4">2.3 UI å±•ç¤º</h3>
<p><strong>å¤šç§å±•ç¤ºæ¨¡å¼</strong></p>
<p>ç»„ä»¶æä¾›äº†ä¸¤ç§ä¸»è¦çš„å±•ç¤ºæ¨¡å¼ï¼š</p>
<ol>
<li><strong>åˆ—è¡¨æ¨¡å¼ï¼ˆdefaultï¼‰</strong>ï¼šé€‚åˆæ–‡æ¡£ã€è§†é¢‘ç­‰å„ç±»æ–‡ä»¶çš„å±•ç¤º</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f8bbf32e15a4780b08581c83f3632a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ou-5pma6Zye:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421183&amp;x-signature=z4dadIAftaK3MrTU0t3wnoZAe%2BM%3D" alt="list-mode.png" loading="lazy"/></p>
<ol start="2">
<li><strong>å›¾ç‰‡å¡ç‰‡æ¨¡å¼ï¼ˆpicture-cardï¼‰</strong>ï¼šä¸“ä¸ºå›¾ç‰‡ä¸Šä¼ ä¼˜åŒ–ï¼Œæ”¯æŒç¼©ç•¥å›¾é¢„è§ˆ</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0c63876497c48e8a02c4362edd040bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ou-5pma6Zye:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421183&amp;x-signature=tSykz%2BPDDjtkdgJxpfO2MMuSwBs%3D" alt="picture-card.png" loading="lazy"/></p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å›¾ç‰‡å¡ç‰‡æ¨¡å¼ --&gt;
&lt;Vue2NiubilityUploader
  :request-handler="requestHandler"
  list-type="picture-card"
  accept="image/*"
/&gt;
</code></pre>
<p><strong>å®æ—¶è¿›åº¦åé¦ˆ</strong></p>
<p>æ¯ä¸ªä¸Šä¼ æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºï¼š</p>
<ul>
<li>ä¸Šä¼ è¿›åº¦ç™¾åˆ†æ¯”</li>
<li>å®æ—¶ä¸Šä¼ é€Ÿåº¦</li>
<li>é¢„è®¡å‰©ä½™æ—¶é—´</li>
</ul>
<p>è¿™äº›ä¿¡æ¯é€šè¿‡ <code>FileData</code> å¯¹è±¡å®æ—¶æ›´æ–°ï¼Œè®©ç”¨æˆ·æ¸…æ¥šäº†è§£ä¸Šä¼ çŠ¶æ€ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€æŠ€æœ¯å®ç°åŸç†</h2>
<h3 data-id="heading-6">3.1 åˆ†ç‰‡ä¸Šä¼ æœºåˆ¶</h3>
<p>åˆ†ç‰‡ä¸Šä¼ æ˜¯ <code>vue2-niubility-uploader</code> çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚å…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>æ–‡ä»¶åˆ‡ç‰‡</strong>ï¼šå°†å¤§æ–‡ä»¶æŒ‰ç…§æŒ‡å®šçš„ <code>chunkSize</code> åˆ‡åˆ†æˆå¤šä¸ªå°å—</li>
<li><strong>å¹¶å‘ä¸Šä¼ </strong>ï¼šæ ¹æ® <code>maxConcurrentUploads</code> è®¾ç½®ï¼Œå¹¶å‘ä¸Šä¼ å¤šä¸ªåˆ†ç‰‡</li>
<li><strong>è¿›åº¦è¿½è¸ª</strong>ï¼šä¸ºæ¯ä¸ªåˆ†ç‰‡ç»´æŠ¤ç‹¬ç«‹çš„ä¸Šä¼ è¿›åº¦ï¼Œå¹¶æ±‡æ€»è®¡ç®—æ€»ä½“è¿›åº¦</li>
<li><strong>åˆ†ç‰‡åˆå¹¶</strong>ï¼šæ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆåï¼Œè°ƒç”¨æœåŠ¡ç«¯æ¥å£åˆå¹¶åˆ†ç‰‡</li>
</ol>
<p>æ ¸å¿ƒæ•°æ®ç»“æ„ <code>FileData</code> åŒ…å«äº†åˆ†ç‰‡ä¸Šä¼ æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">FileData</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>;
  <span class="hljs-attr">useChunked</span>: <span class="hljs-built_in">boolean</span>;           <span class="hljs-comment">// æ˜¯å¦ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ </span>
  <span class="hljs-attr">chunks</span>: <span class="hljs-built_in">number</span>;                <span class="hljs-comment">// æ€»åˆ†ç‰‡æ•°</span>
  <span class="hljs-attr">currentChunk</span>: <span class="hljs-built_in">number</span>;          <span class="hljs-comment">// å½“å‰ä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•</span>
  <span class="hljs-attr">uploadedChunks</span>: <span class="hljs-built_in">number</span>;        <span class="hljs-comment">// å·²ä¸Šä¼ çš„åˆ†ç‰‡æ•°é‡</span>
  <span class="hljs-attr">chunkQueue</span>: <span class="hljs-built_in">number</span>[];          <span class="hljs-comment">// åˆ†ç‰‡ä¸Šä¼ é˜Ÿåˆ—</span>
  <span class="hljs-attr">activeChunks</span>: <span class="hljs-built_in">number</span>;          <span class="hljs-comment">// å½“å‰æ´»è·ƒçš„åˆ†ç‰‡ä¸Šä¼ æ•°</span>
  <span class="hljs-attr">uploadedChunkSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// å·²ä¸Šä¼ åˆ†ç‰‡çš„é›†åˆï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰</span>
  <span class="hljs-attr">chunkProgressMap</span>: <span class="hljs-title class_">Map</span>;         <span class="hljs-comment">// æ¯ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦</span>
  <span class="hljs-comment">// ... å…¶ä»–å±æ€§</span>
}
</code></pre>
<h3 data-id="heading-7">3.2 æ–­ç‚¹ç»­ä¼ å®ç°</h3>
<p>æ–­ç‚¹ç»­ä¼ çš„å…³é”®åœ¨äºè®°å½•å’Œæ¢å¤ä¸Šä¼ çŠ¶æ€ï¼š</p>
<ol>
<li><strong>çŠ¶æ€è®°å½•</strong>ï¼šä½¿ç”¨ <code>uploadedChunkSet</code> è®°å½•å·²æˆåŠŸä¸Šä¼ çš„åˆ†ç‰‡ç´¢å¼•</li>
<li><strong>è¿›åº¦æ¢å¤</strong>ï¼šæš‚åœåå†æ¬¡ä¸Šä¼ æ—¶ï¼Œè·³è¿‡å·²ä¸Šä¼ çš„åˆ†ç‰‡</li>
<li><strong>åˆ†ç‰‡éªŒè¯</strong>ï¼šå¯é€‰æ‹©åœ¨æœåŠ¡ç«¯éªŒè¯å·²ä¸Šä¼ åˆ†ç‰‡çš„å®Œæ•´æ€§</li>
</ol>
<p>å®ç°æ–­ç‚¹ç»­ä¼ çš„å…³é”®ä»£ç é€»è¾‘ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸Šä¼ å‰æ£€æŸ¥å·²ä¸Šä¼ çš„åˆ†ç‰‡</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">onBeforeUpload</span>(<span class="hljs-params">fileData</span>) {
  <span class="hljs-keyword">if</span> (fileData.<span class="hljs-property">useChunked</span>) {
    <span class="hljs-comment">// åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ ï¼Œè·å–å·²ä¸Šä¼ çš„åˆ†ç‰‡åˆ—è¡¨</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/upload/init'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">fileName</span>: fileData.<span class="hljs-property">file</span>.<span class="hljs-property">name</span>,
        <span class="hljs-attr">fileSize</span>: fileData.<span class="hljs-property">file</span>.<span class="hljs-property">size</span>
      })
    });

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-comment">// å°†å·²ä¸Šä¼ çš„åˆ†ç‰‡ä»é˜Ÿåˆ—ä¸­ç§»é™¤</span>
    fileData.<span class="hljs-property">uploadedChunkSet</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(data.<span class="hljs-property">uploadedChunks</span> || []);
  }
}
</code></pre>
<h3 data-id="heading-8">3.3 å¹¶å‘æ§åˆ¶</h3>
<p>ä¸ºäº†é¿å…è¿‡å¤šå¹¶å‘è¯·æ±‚å¯¼è‡´æµè§ˆå™¨æˆ–æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼Œç»„ä»¶å®ç°äº†æ™ºèƒ½çš„å¹¶å‘æ§åˆ¶ï¼š</p>
<ul>
<li><strong>å…¨å±€å¹¶å‘é™åˆ¶</strong>ï¼š<code>maxConcurrentUploads</code> æ§åˆ¶åŒæ—¶ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡</li>
<li><strong>åˆ†ç‰‡å¹¶å‘æ§åˆ¶</strong>ï¼šå¯¹äºå•ä¸ªå¤§æ–‡ä»¶çš„å¤šä¸ªåˆ†ç‰‡ï¼Œä¹Ÿæœ‰å¹¶å‘é™åˆ¶</li>
<li><strong>é˜Ÿåˆ—ç®¡ç†</strong>ï¼šè¶…å‡ºå¹¶å‘æ•°çš„ä¸Šä¼ ä»»åŠ¡ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…</li>
</ul>
<h3 data-id="heading-9">3.4 è¿›åº¦è®¡ç®—ä¸é€Ÿåº¦é¢„æµ‹</h3>
<p><strong>è¿›åº¦è®¡ç®—</strong></p>
<p>ç»„ä»¶é€šè¿‡ç›‘å¬ XMLHttpRequest çš„ <code>progress</code> äº‹ä»¶ï¼Œå®æ—¶æ›´æ–°ä¸Šä¼ è¿›åº¦ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">xhr.<span class="hljs-property">upload</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'progress'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">lengthComputable</span>) {
    <span class="hljs-keyword">const</span> progress = (event.<span class="hljs-property">loaded</span> / event.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;
    <span class="hljs-comment">// æ›´æ–° FileData çš„ progress å±æ€§</span>
  }
});
</code></pre>
<p>å¯¹äºåˆ†ç‰‡ä¸Šä¼ ï¼Œæ€»è¿›åº¦æ˜¯æ‰€æœ‰åˆ†ç‰‡è¿›åº¦çš„åŠ æƒå¹³å‡å€¼ã€‚</p>
<p><strong>é€Ÿåº¦è®¡ç®—</strong></p>
<p>ä¸Šä¼ é€Ÿåº¦é€šè¿‡é‡‡æ ·è®¡ç®—å¾—å‡ºï¼š</p>
<ol>
<li>å®šæœŸè®°å½•å·²ä¸Šä¼ çš„å­—èŠ‚æ•°å’Œæ—¶é—´æˆ³</li>
<li>è®¡ç®—æ—¶é—´é—´éš”å†…çš„å­—èŠ‚å¢é‡</li>
<li>ä½¿ç”¨ç§»åŠ¨å¹³å‡ç®—æ³•å¹³æ»‘é€Ÿåº¦æ³¢åŠ¨</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é€Ÿåº¦è®¡ç®—ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> currentBytes = fileData.<span class="hljs-property">loaded</span>;
<span class="hljs-keyword">const</span> currentTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">const</span> deltaBytes = currentBytes - fileData.<span class="hljs-property">lastUploadedBytes</span>;
<span class="hljs-keyword">const</span> deltaTime = currentTime - fileData.<span class="hljs-property">lastUpdateTime</span>;
<span class="hljs-keyword">const</span> speed = deltaBytes / (deltaTime / <span class="hljs-number">1000</span>); <span class="hljs-comment">// bytes/s</span>

<span class="hljs-comment">// ä½¿ç”¨æ ·æœ¬æ•°ç»„å¹³æ»‘é€Ÿåº¦</span>
fileData.<span class="hljs-property">speedSamples</span>.<span class="hljs-title function_">push</span>(speed);
<span class="hljs-keyword">if</span> (fileData.<span class="hljs-property">speedSamples</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">5</span>) {
  fileData.<span class="hljs-property">speedSamples</span>.<span class="hljs-title function_">shift</span>();
}
<span class="hljs-keyword">const</span> avgSpeed = fileData.<span class="hljs-property">speedSamples</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b) / fileData.<span class="hljs-property">speedSamples</span>.<span class="hljs-property">length</span>;
</code></pre>
<p><strong>å‰©ä½™æ—¶é—´é¢„æµ‹</strong></p>
<p>åŸºäºå½“å‰é€Ÿåº¦å’Œå‰©ä½™å­—èŠ‚æ•°ï¼Œé¢„æµ‹å‰©ä½™æ—¶é—´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> remainingBytes = fileData.<span class="hljs-property">size</span> - fileData.<span class="hljs-property">loaded</span>;
<span class="hljs-keyword">const</span> remainingTime = remainingBytes / avgSpeed; <span class="hljs-comment">// seconds</span>
</code></pre>
<h2 data-id="heading-10">å››ã€ è‡ªå®šä¹‰ UI å±•ç¤º</h2>
<p>é€šè¿‡æ’æ§½å®Œå…¨è‡ªå®šä¹‰æ–‡ä»¶åˆ—è¡¨çš„å±•ç¤ºï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Vue2NiubilityUploader
    :request-handler="requestHandler"
    multiple
  &gt;
    &lt;!-- è‡ªå®šä¹‰æ–‡ä»¶é¡¹ --&gt;
    &lt;template #file-item="{ fileData }"&gt;
      &lt;div class="custom-file-item"&gt;
        &lt;div class="file-info"&gt;
          &lt;img :src="getFileIcon(fileData.file)" class="file-icon" /&gt;
          &lt;div class="file-details"&gt;
            &lt;div class="file-name"&gt;{{ fileData.name }}&lt;/div&gt;
            &lt;div class="file-size"&gt;{{ formatSize(fileData.size) }}&lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class="file-progress" v-if="fileData.status === 'uploading'"&gt;
          &lt;div class="progress-bar"&gt;
            &lt;div
              class="progress-fill"
              :style="{ width: fileData.progress + '%' }"
            &gt;&lt;/div&gt;
          &lt;/div&gt;
          &lt;div class="progress-info"&gt;
            &lt;span&gt;{{ fileData.speed }}&lt;/span&gt;
            &lt;span&gt;{{ fileData.remainingTime }}&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class="file-actions"&gt;
          &lt;button
            v-if="fileData.status === 'uploading'"
            @click="pauseUpload(fileData)"
          &gt;
            æš‚åœ
          &lt;/button&gt;
          &lt;button
            v-if="fileData.status === 'paused'"
            @click="resumeUpload(fileData)"
          &gt;
            ç»§ç»­
          &lt;/button&gt;
          &lt;button @click="removeFile(fileData)"&gt;åˆ é™¤&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/template&gt;
  &lt;/Vue2NiubilityUploader&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  methods: {
    getFileIcon(file) {
      const ext = file.name.split('.').pop().toLowerCase();
      const iconMap = {
        pdf: '/icons/pdf.png',
        doc: '/icons/word.png',
        docx: '/icons/word.png',
        xls: '/icons/excel.png',
        xlsx: '/icons/excel.png',
      };
      return iconMap[ext] || '/icons/file.png';
    },

    formatSize(bytes) {
      if (bytes &lt; 1024) return bytes + ' B';
      if (bytes &lt; 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
      return (bytes / 1024 / 1024).toFixed(2) + ' MB';
    }
  }
}
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-11">äº”ã€é«˜çº§é…ç½®ä¸ä¼˜åŒ–</h2>
<h3 data-id="heading-12">5.1 å¹¶å‘æ§åˆ¶ä¼˜åŒ–</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåˆç†è®¾ç½®å¹¶å‘æ•°å¯ä»¥æ˜¾è‘—æå‡ä¸Šä¼ æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Vue2NiubilityUploader
  :request-handler="requestHandler"
  :max-concurrent-uploads="5"
  use-chunked-upload
  :chunk-size="5*1024*1024"
/&gt;
</code></pre>
<p><strong>å»ºè®®é…ç½®ï¼š</strong></p>
<ul>
<li>å°æ–‡ä»¶ï¼ˆ&lt; 10MBï¼‰ï¼šå¹¶å‘æ•° 5-10</li>
<li>å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼šå¹¶å‘æ•° 3-5</li>
<li>ç§»åŠ¨ç«¯ç½‘ç»œï¼šå¹¶å‘æ•° 2-3</li>
</ul>
<h3 data-id="heading-13">5.2 è¯·æ±‚å®šåˆ¶</h3>
<p><code>requestHandler</code> æä¾›äº†å®Œå…¨çš„è¯·æ±‚å®šåˆ¶èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">requestHandler</span>(<span class="hljs-params">fileData</span>) {
  <span class="hljs-keyword">const</span> { file, isUploadChunk, chunkIndex, chunk, <span class="hljs-attr">fileData</span>: chunkFileData } = fileData;

  <span class="hljs-comment">// æ ¹æ®ä¸åŒæ¡ä»¶è¿”å›ä¸åŒçš„è¯·æ±‚é…ç½®</span>
  <span class="hljs-keyword">if</span> (isUploadChunk) {
    <span class="hljs-comment">// åˆ†ç‰‡ä¸Šä¼ </span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/upload/chunk'</span>,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildChunkFormData</span>(chunk, chunkFileData, chunkIndex),
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.token}</span>`</span>,
        <span class="hljs-string">'X-Upload-Id'</span>: chunkFileData.<span class="hljs-property">extendData</span>.<span class="hljs-property">uploadId</span>
      },
      <span class="hljs-comment">// è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´</span>
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000</span>,
      <span class="hljs-comment">// è‡ªå®šä¹‰è¯·æ±‚æ‹¦æˆªå™¨</span>
      <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent</span>) =&gt;</span> {
        <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œåšé¢å¤–çš„è¿›åº¦å¤„ç†</span>
      }
    };
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æ™®é€šä¸Šä¼ </span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/upload'</span>,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">data</span>: { file, <span class="hljs-attr">name</span>: file.<span class="hljs-property">name</span> }
    };
  }
}
</code></pre>
<h3 data-id="heading-14">5.3 é”™è¯¯å¤„ç†ä¸é‡è¯•</h3>
<p>ç»„ä»¶å†…ç½®äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡äº‹ä»¶ç›‘å¬è‡ªå®šä¹‰é”™è¯¯å¤„ç†ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Vue2NiubilityUploader
    :request-handler="requestHandler"
    @file-upload-error="onUploadError"
    @file-error="onFileError"
  /&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      retryCount: 0,
      maxRetries: 3
    }
  },

  methods: {
    async onUploadError({ fileData, error }) {
      console.error('ä¸Šä¼ å¤±è´¥:', error);

      // è‡ªåŠ¨é‡è¯•é€»è¾‘
      if (this.retryCount &lt; this.maxRetries) {
        this.retryCount++;
        this.$message.warning(`ä¸Šä¼ å¤±è´¥ï¼Œæ­£åœ¨é‡è¯• (${this.retryCount}/${this.maxRetries})`);

        // å»¶è¿Ÿ 2 ç§’åé‡è¯•
        await new Promise(resolve =&gt; setTimeout(resolve, 2000));
        this.$refs.uploader.retryUpload(fileData);
      } else {
        this.$message.error('ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
        this.retryCount = 0;
      }
    },

    onFileError(errorInfo) {
      // æ–‡ä»¶éªŒè¯é”™è¯¯
      const errorMessages = {
        'exceed-limit': 'æ–‡ä»¶æ•°é‡è¶…å‡ºé™åˆ¶',
        'exceed-size': 'æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶',
        'invalid-type': 'æ–‡ä»¶ç±»å‹ä¸ç¬¦åˆè¦æ±‚'
      };

      this.$message.error(errorMessages[errorInfo.type] || errorInfo.message);
    }
  }
}
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-15">å…­ã€ Node.js ç¤ºä¾‹å®ç°</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> { formidable } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'formidable'</span>);

<span class="hljs-comment">// Create Express app</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3001</span>;

<span class="hljs-comment">// Enable CORS</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-comment">// Middleware to parse JSON</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">limit</span>: <span class="hljs-string">'50mb'</span> }));
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">limit</span>: <span class="hljs-string">'50mb'</span> }));

<span class="hljs-comment">// Create upload directory if it doesn't exist</span>
<span class="hljs-keyword">const</span> uploadDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'temp'</span>);
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
}

<span class="hljs-comment">// Temporary directory for chunked uploads</span>
<span class="hljs-keyword">const</span> tempDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'chunk-temp'</span>);
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(tempDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(tempDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
}

<span class="hljs-comment">// Configure multer for regular file uploads</span>
<span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>({
  <span class="hljs-attr">destination</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> {
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, uploadDir);
  },
  <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> {
    <span class="hljs-comment">// Use original filename with timestamp to avoid conflicts</span>
    <span class="hljs-keyword">const</span> mimeType = file.<span class="hljs-property">mimetype</span>;
    <span class="hljs-keyword">const</span> fileName = <span class="hljs-string">'img.'</span> + mimeType.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'multer.diskStorage, filename'</span>, fileName, file);
    <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(file.<span class="hljs-property">originalname</span> || fileName);
    <span class="hljs-keyword">const</span> name = path.<span class="hljs-title function_">basename</span>(file.<span class="hljs-property">originalname</span> || fileName, ext);
    <span class="hljs-keyword">const</span> filename = <span class="hljs-string">`<span class="hljs-subst">${name}</span>_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span><span class="hljs-subst">${ext}</span>`</span>;
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, filename);
  }
});

<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({
  <span class="hljs-attr">storage</span>: storage,
  <span class="hljs-attr">limits</span>: {
    <span class="hljs-attr">fileSize</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> <span class="hljs-comment">// 10GB max file size</span>
  }
});

<span class="hljs-comment">// In-memory storage for upload sessions (in production, use Redis or database)</span>
<span class="hljs-keyword">const</span> uploadSessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();


<span class="hljs-comment">/**
 * GET /health - Health check endpoint
 */</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/health'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'OK'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>() });
});

<span class="hljs-comment">/**
 * POST /upload - Single file upload endpoint
 */</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'file'</span>), <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">file</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'No file uploaded'</span> });
    }

    <span class="hljs-keyword">let</span> name = req.<span class="hljs-property">name</span>;
    <span class="hljs-comment">// Return success response with file info</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'File uploaded successfully'</span>,
      <span class="hljs-attr">file</span>: {
        <span class="hljs-attr">filename</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">filename</span> || name,
        <span class="hljs-attr">originalName</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">originalname</span> || name,
        <span class="hljs-attr">size</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">size</span>,
        <span class="hljs-attr">path</span>: req.<span class="hljs-property">file</span>.<span class="hljs-property">path</span>
      }
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Upload error:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Failed to upload file'</span> });
  }
});

<span class="hljs-comment">/**
 * POST /upload/init - Initialize a chunked upload session
 */</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/init'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { fileName, fileSize, fileType, uploadId } = req.<span class="hljs-property">body</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'/upload/init'</span>, req.<span class="hljs-property">body</span>);

    <span class="hljs-keyword">if</span> (!fileName || !fileSize) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Missing required fields: fileName, fileSize'</span> });
    }

    <span class="hljs-comment">// Create session data</span>
    <span class="hljs-keyword">const</span> session = {
      uploadId,
      fileName,
      <span class="hljs-attr">fileSize</span>: <span class="hljs-built_in">parseInt</span>(fileSize),
      <span class="hljs-attr">fileType</span>: fileType || <span class="hljs-string">''</span>,
      <span class="hljs-attr">uploadedSize</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">totalChunks</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">uploadedChunks</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(),
      <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
      <span class="hljs-attr">expiresAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>).<span class="hljs-title function_">toISOString</span>(), <span class="hljs-comment">// 1 hours</span>
      <span class="hljs-attr">tempFilePath</span>: path.<span class="hljs-title function_">join</span>(tempDir, uploadId)
    };

    <span class="hljs-keyword">const</span> tempFilePath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`./chunk-temp/<span class="hljs-subst">${uploadId}</span>`</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'/upload/init, tempFilePath'</span>, fs.<span class="hljs-title function_">existsSync</span>(session.<span class="hljs-property">tempFilePath</span>), session.<span class="hljs-property">tempFilePath</span>, tempFilePath);
    <span class="hljs-comment">// Create temporary directory for this upload</span>
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(tempFilePath)) {
      <span class="hljs-keyword">try</span> {
        fs.<span class="hljs-title function_">mkdirSync</span>(tempFilePath, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥'</span>, err);
      }

    }

    <span class="hljs-comment">// Store session</span>
    uploadSessions.<span class="hljs-title function_">set</span>(uploadId, session);

    <span class="hljs-comment">// Clean up expired sessions periodically</span>
    <span class="hljs-keyword">if</span> (uploadSessions.<span class="hljs-property">size</span> &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// Clean up if we have too many sessions</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'/upload/init æ¸…ç©ºsession'</span>)
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [id, session] <span class="hljs-keyword">of</span> uploadSessions) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(session.<span class="hljs-property">expiresAt</span>).<span class="hljs-title function_">getTime</span>() &lt; now) {
          <span class="hljs-title function_">cleanupUploadSession</span>(id);
        }
      }
    }

    <span class="hljs-comment">// Return session info</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      uploadId,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Upload session initialized successfully'</span>
    });

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Init upload error:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Failed to initialize upload session'</span> });
  }
});

<span class="hljs-comment">/**
 * è·¨åˆ†åŒºç§»åŠ¨æ–‡ä»¶
 * <span class="hljs-doctag">@param</span> sourcePath æºæ–‡ä»¶åœ°å€
 * <span class="hljs-doctag">@param</span> targetPath ç›®æ ‡æ–‡ä»¶åœ°å€
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>}
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">moveFileAcrossPartitions</span>(<span class="hljs-params">sourcePath, targetPath</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨</span>
    <span class="hljs-keyword">const</span> targetDir = path.<span class="hljs-title function_">dirname</span>(targetPath);
    fs.<span class="hljs-title function_">mkdirSync</span>(targetDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });

    <span class="hljs-comment">// åˆ›å»ºå¯è¯»æµå’Œå¯å†™æµ</span>
    <span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(sourcePath);
    <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(targetPath);

    <span class="hljs-comment">// ç®¡é“ä¼ è¾“æ•°æ®</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      readStream.<span class="hljs-title function_">pipe</span>(writeStream)
        .<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, resolve)
        .<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, reject);
    });

    <span class="hljs-comment">// åˆ é™¤æºæ–‡ä»¶</span>
    fs.<span class="hljs-title function_">unlinkSync</span>(sourcePath);

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–‡ä»¶ç§»åŠ¨æˆåŠŸï¼ˆè·¨åˆ†åŒºï¼‰ï¼Œæºæ–‡ä»¶ï¼š<span class="hljs-subst">${sourcePath}</span>ï¼Œç›®æ ‡æ–‡ä»¶ï¼š<span class="hljs-subst">${targetPath}</span>`</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ç§»åŠ¨æ–‡ä»¶å¤±è´¥:'</span>, err);
  }
}

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/chunk'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">try</span> {

    <span class="hljs-keyword">const</span> form = <span class="hljs-title function_">formidable</span>({
      <span class="hljs-attr">multiples</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-comment">// maxFileSize: 100 * 1024 * 1024 // 100MB</span>
    });

    form.<span class="hljs-title function_">parse</span>(req, <span class="hljs-keyword">async</span> (err, fields, files) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">'è§£æè¡¨å•å¤±è´¥: '</span> + err.<span class="hljs-property">message</span>
        });
      }

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// console.log('fields', fields);</span>
        <span class="hljs-keyword">const</span> { uploadId, chunkIndex, filename, chunk, totalChunks } = fields;
        <span class="hljs-keyword">const</span> chunkFiles = files.<span class="hljs-property">file</span> || [];

        <span class="hljs-keyword">const</span> chunkIndexInt = <span class="hljs-built_in">parseInt</span>(chunkIndex[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">const</span> totalChunksInt = <span class="hljs-built_in">parseInt</span>(totalChunks[<span class="hljs-number">0</span>]);
        <span class="hljs-comment">// console.log('chunkFiles', chunkFiles);</span>
        <span class="hljs-keyword">if</span> (chunkFiles.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'æœªæ”¶åˆ°åˆ†ç‰‡æ–‡ä»¶'</span>
          });
        }


        <span class="hljs-keyword">if</span> (!uploadId[<span class="hljs-number">0</span>] || <span class="hljs-built_in">isNaN</span>(chunkIndexInt) || <span class="hljs-built_in">isNaN</span>(totalChunks)) {
          <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Missing required fields: uploadId, chunkIndex, totalChunks'</span> });
        }

        <span class="hljs-comment">// Check if upload session exists</span>
        <span class="hljs-keyword">const</span> session = uploadSessions.<span class="hljs-title function_">get</span>(uploadId[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">if</span> (!session) {
          <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Upload session not found'</span> });
        }

        <span class="hljs-comment">// Check if chunk was already uploaded</span>
        <span class="hljs-keyword">if</span> (session.<span class="hljs-property">uploadedChunks</span>.<span class="hljs-title function_">has</span>(chunkIndexInt)) {
          <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'Chunk already uploaded'</span>,
            <span class="hljs-attr">chunkIndex</span>: chunkIndexInt,
            <span class="hljs-attr">status</span>: <span class="hljs-string">'duplicate'</span>
          });
        }

        <span class="hljs-comment">// ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°ç›®æ ‡ä½ç½®</span>
        <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(session.<span class="hljs-property">tempFilePath</span>, <span class="hljs-string">`chunk_<span class="hljs-subst">${chunkIndexInt}</span>.tmp`</span>);
        <span class="hljs-comment">// fs.renameSync(chunkFiles[0].filepath, chunkPath);</span>
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">moveFileAcrossPartitions</span>(chunkFiles[<span class="hljs-number">0</span>].<span class="hljs-property">filepath</span>, chunkPath);


        <span class="hljs-comment">// Update session with chunk info</span>
        session.<span class="hljs-property">uploadedChunks</span>.<span class="hljs-title function_">add</span>(chunkIndexInt);
        <span class="hljs-comment">// session.uploadedSize += req.file.size;</span>
        session.<span class="hljs-property">uploadedSize</span> += chunkFiles[<span class="hljs-number">0</span>].<span class="hljs-property">length</span> || <span class="hljs-number">0</span>;
        session.<span class="hljs-property">totalChunks</span> = totalChunksInt;

        <span class="hljs-comment">// Update expiration time</span>
        session.<span class="hljs-property">expiresAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>).<span class="hljs-title function_">toISOString</span>();

        <span class="hljs-comment">// Return success response</span>
        res.<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">'Chunk uploaded successfully'</span>,
          <span class="hljs-attr">chunkIndex</span>: chunkIndexInt,
          <span class="hljs-attr">totalChunks</span>: totalChunksInt,
          <span class="hljs-attr">uploadedSize</span>: session.<span class="hljs-property">uploadedSize</span>,
          <span class="hljs-attr">progress</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((session.<span class="hljs-property">uploadedSize</span> / session.<span class="hljs-property">fileSize</span>) * <span class="hljs-number">100</span>)
        });

      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆ†ç‰‡ä¸Šä¼ å¤±è´¥: '</span> + error.<span class="hljs-property">message</span>
        });
      }
    });

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Chunk upload error:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Failed to upload chunk'</span> });
  }
});

<span class="hljs-comment">/**
 * POST /upload/finalize - Finalize a chunked upload
 */</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/finalize'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { uploadId, fileName, fileSize } = req.<span class="hljs-property">body</span>;

    <span class="hljs-keyword">if</span> (!uploadId) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Missing required field: uploadId'</span> });
    }

    <span class="hljs-comment">// Check if upload session exists</span>
    <span class="hljs-keyword">const</span> session = uploadSessions.<span class="hljs-title function_">get</span>(uploadId);
    <span class="hljs-comment">// console.log('/upload/finalize, session', uploadId, session, uploadSessions);</span>
    <span class="hljs-keyword">if</span> (!session) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Upload session not found'</span> });
    }

    <span class="hljs-comment">// Verify all chunks were uploaded</span>
    <span class="hljs-keyword">if</span> (session.<span class="hljs-property">uploadedChunks</span>.<span class="hljs-property">size</span> !== session.<span class="hljs-property">totalChunks</span>) {
      <span class="hljs-keyword">const</span> missingChunks = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; session.<span class="hljs-property">totalChunks</span>; i++) {
        <span class="hljs-keyword">if</span> (!session.<span class="hljs-property">uploadedChunks</span>.<span class="hljs-title function_">has</span>(i)) {
          missingChunks.<span class="hljs-title function_">push</span>(i);
        }
      }

      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">error</span>: <span class="hljs-string">'Not all chunks have been uploaded'</span>,
        missingChunks,
        <span class="hljs-attr">uploadedChunks</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(session.<span class="hljs-property">uploadedChunks</span>),
        <span class="hljs-attr">totalChunks</span>: session.<span class="hljs-property">totalChunks</span>
      });
    }

    <span class="hljs-comment">// Verify file size matches</span>
    <span class="hljs-keyword">if</span> (fileSize &amp;&amp; <span class="hljs-built_in">parseInt</span>(fileSize) !== session.<span class="hljs-property">fileSize</span>) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">error</span>: <span class="hljs-string">'File size mismatch'</span>,
        <span class="hljs-attr">expected</span>: session.<span class="hljs-property">fileSize</span>,
        <span class="hljs-attr">actual</span>: fileSize
      });
    }

    <span class="hljs-comment">// Reassemble the file from chunks</span>
    <span class="hljs-keyword">const</span> finalFilePath = path.<span class="hljs-title function_">join</span>(tempDir, session.<span class="hljs-property">fileName</span>);
    <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(finalFilePath);

    <span class="hljs-comment">// Sort chunks by index and pipe them in order</span>
    <span class="hljs-keyword">const</span> chunkFiles = fs.<span class="hljs-title function_">readdirSync</span>(session.<span class="hljs-property">tempFilePath</span>);
    <span class="hljs-keyword">const</span> sortedChunks = chunkFiles
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'chunk_'</span>))
      .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> indexA = <span class="hljs-built_in">parseInt</span>(a.<span class="hljs-title function_">split</span>(<span class="hljs-string">'_'</span>)[<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">const</span> indexB = <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">split</span>(<span class="hljs-string">'_'</span>)[<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">return</span> indexA - indexB;
      });

    <span class="hljs-keyword">let</span> chunksProcessed = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// console.log('/upload/finalize, sortedChunks', sortedChunks);</span>
    <span class="hljs-comment">// Process each chunk in sequence</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunkFile <span class="hljs-keyword">of</span> sortedChunks) {
      <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(session.<span class="hljs-property">tempFilePath</span>, chunkFile);
      <span class="hljs-keyword">const</span> chunkData = fs.<span class="hljs-title function_">readFileSync</span>(chunkPath);

      <span class="hljs-keyword">if</span> (!writeStream.<span class="hljs-title function_">write</span>(chunkData)) {
        <span class="hljs-comment">// If the stream wants us to wait, wait until it's ready</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> writeStream.<span class="hljs-title function_">once</span>(<span class="hljs-string">'drain'</span>, resolve));
      }

      chunksProcessed++;
    }

    <span class="hljs-comment">// Close the write stream</span>
    writeStream.<span class="hljs-title function_">end</span>();

    <span class="hljs-comment">// Wait for the stream to finish writing</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      writeStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, resolve);
      writeStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, reject);
    });

    <span class="hljs-comment">// Verify the final file size</span>
    <span class="hljs-keyword">const</span> finalStats = fs.<span class="hljs-title function_">statSync</span>(finalFilePath);
    <span class="hljs-keyword">if</span> (finalStats.<span class="hljs-property">size</span> !== session.<span class="hljs-property">fileSize</span>) {
      <span class="hljs-comment">// Clean up and return error</span>
      fs.<span class="hljs-title function_">unlinkSync</span>(finalFilePath);
      <span class="hljs-title function_">cleanupUploadSession</span>(uploadId);
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">error</span>: <span class="hljs-string">'Final file size does not match expected size'</span>,
        <span class="hljs-attr">expected</span>: session.<span class="hljs-property">fileSize</span>,
        <span class="hljs-attr">actual</span>: finalStats.<span class="hljs-property">size</span>,
        finalFilePath
      });
    }

    <span class="hljs-comment">// Clean up temporary files</span>
    <span class="hljs-title function_">cleanupUploadSession</span>(uploadId);

    <span class="hljs-comment">// Return success response</span>
    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'File uploaded successfully'</span>,
      <span class="hljs-attr">file</span>: {
        <span class="hljs-attr">filename</span>: session.<span class="hljs-property">fileName</span>,
        <span class="hljs-attr">size</span>: finalStats.<span class="hljs-property">size</span>,
        <span class="hljs-attr">path</span>: finalFilePath
      }
    });

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Finalize upload error:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Failed to finalize upload'</span> });
  }
});

<span class="hljs-comment">/**
 * Clean up upload session and temporary files
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">uploadId</span> - The upload session ID
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupUploadSession</span>(<span class="hljs-params">uploadId</span>) {
  <span class="hljs-keyword">const</span> session = uploadSessions.<span class="hljs-title function_">get</span>(uploadId);
  <span class="hljs-comment">// console.log('cleanupUploadSession', uploadId, session);</span>
  <span class="hljs-keyword">if</span> (session) {
    <span class="hljs-comment">// Remove temporary directory</span>
    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(session.<span class="hljs-property">tempFilePath</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'cleanupUploadSessionåˆ é™¤ä¸´æ—¶ç›®å½•'</span>, session.<span class="hljs-property">tempFilePath</span>);
      <span class="hljs-keyword">try</span> {
        fs.<span class="hljs-title function_">rmSync</span>(session.<span class="hljs-property">tempFilePath</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to remove temp directory for <span class="hljs-subst">${uploadId}</span>:`</span>, error);
      }
    }

    <span class="hljs-comment">// Remove session from map</span>
    uploadSessions.<span class="hljs-title function_">delete</span>(uploadId);
  }
}

<span class="hljs-comment">// Periodic cleanup of expired sessions (every hour)</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [id, session] <span class="hljs-keyword">of</span> uploadSessions) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(session.<span class="hljs-property">expiresAt</span>).<span class="hljs-title function_">getTime</span>() &lt; now) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Cleaning up expired upload session: <span class="hljs-subst">${id}</span>`</span>);
      <span class="hljs-title function_">cleanupUploadSession</span>(id);
    }
  }
}, <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>); <span class="hljs-comment">// Every hour</span>

<span class="hljs-comment">// Start server</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ <span class="hljs-subst">${PORT}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–‡ä»¶ä¸Šä¼ æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ <span class="hljs-subst">${PORT}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡åœ°å€: http://localhost:<span class="hljs-subst">${PORT}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Upload directory: <span class="hljs-subst">${uploadDir}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Temp directory: <span class="hljs-subst">${tempDir}</span>`</span>);
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(tempDir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(tempDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app;

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git å…¥é—¨æ•™ç¨‹ï¼šåˆå§‹åŒ–ã€ä¿®æ”¹ä¸æäº¤]]></title>    <link>https://juejin.cn/post/7579551362154414089</link>    <guid>https://juejin.cn/post/7579551362154414089</guid>    <pubDate>2025-12-04T02:43:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579551362154414089" data-draft-id="7579673620940439602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git å…¥é—¨æ•™ç¨‹ï¼šåˆå§‹åŒ–ã€ä¿®æ”¹ä¸æäº¤"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-04T02:43:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç³»å¤æ™®"/> <meta itemprop="url" content="https://juejin.cn/user/895462143964748"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git å…¥é—¨æ•™ç¨‹ï¼šåˆå§‹åŒ–ã€ä¿®æ”¹ä¸æäº¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895462143964748/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç³»å¤æ™®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:43:27.000Z" title="Thu Dec 04 2025 02:43:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„ C++ â€œHello Worldâ€ ç¨‹åºï¼Œæ¼”ç¤º Git çš„åŸºæœ¬å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–ä»“åº“ã€æ·»åŠ æ–‡ä»¶ã€æäº¤æ›´æ”¹ã€æŸ¥çœ‹çŠ¶æ€ä¸å·®å¼‚ç­‰æ ¸å¿ƒæ“ä½œã€‚</p>
<hr/>
<h2 data-id="heading-0">1. åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶åˆå§‹åŒ– Git ä»“åº“</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> learngit
<span class="hljs-built_in">cd</span> learngit
git init
Initialized empty Git repository <span class="hljs-keyword">in</span> /home/cyk/Desktop/learngit/.git/
</code></pre>
<p>æ­¤æ—¶ï¼Œ<code>learngit</code> ç›®å½•å·²å˜ä¸ºä¸€ä¸ª Git ä»“åº“ï¼ˆåŒ…å«éšè—çš„ <code>.git</code> å­ç›®å½•ï¼‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æœ‰æ–‡ä»¶çš„ç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸ºGitä»“åº“ã€‚</p>
<hr/>
<h2 data-id="heading-1">2. ç¼–å†™æºä»£ç æ–‡ä»¶ hello.cpp</h2>
<p>åˆ›å»ºæ–‡ä»¶å¹¶æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
â€‹
using namespace <span class="hljs-built_in">std</span>;
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
 Â  Â <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello World!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
 Â  Â <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>éªŒè¯å†…å®¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> hello.cpp
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
â€‹
using namespace <span class="hljs-built_in">std</span>;
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
 Â   <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello World!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
 Â   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-2">3. ç¼–è¯‘å¹¶è¿è¡Œç¨‹åº</h2>
<pre><code class="hljs language-bash" lang="bash">g++ hello.cpp -o hello
./hello
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs">Hello World!
</code></pre>
</blockquote>
<p>ç¨‹åºç¼–è¯‘æˆåŠŸå¹¶æ­£å¸¸è¿è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-3">4. æŸ¥çœ‹ Git çŠ¶æ€ï¼ˆé¦–æ¬¡ï¼‰</h2>
<p><code>git status</code>Â æ˜¯ Git ä¸­æœ€å¸¸ç”¨çš„åŸºç¡€å‘½ä»¤ä¹‹ä¸€ï¼Œç”¨äº<strong>æŸ¥çœ‹å½“å‰å·¥ä½œåŒºã€æš‚å­˜åŒºï¼ˆç´¢å¼•ï¼‰ä¸æœ¬åœ°ä»“åº“çš„çŠ¶æ€å·®å¼‚</strong>ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å‘Šè¯‰ä½ ï¼šå½“å‰ä»“åº“çš„æ–‡ä»¶æœ‰å“ªäº›ä¿®æ”¹ã€å“ªäº›å·²æš‚å­˜ã€å“ªäº›æœªè·Ÿè¸ªï¼Œä»¥åŠåˆ†æ”¯çŠ¶æ€ç­‰å…³é”®ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-4">4.1ã€æ ¸å¿ƒåŠŸèƒ½ï¼šå®ƒèƒ½å‘Šè¯‰ä½ ä»€ä¹ˆï¼Ÿ</h3>
<p>æ‰§è¡ŒÂ <code>git status</code>Â åï¼Œè¾“å‡ºä¼šå›´ç»• 4 ç±»æ–‡ä»¶çŠ¶æ€å±•å¼€ï¼Œå¸®ä½ ç†æ¸…ä»£ç å˜æ›´çš„ â€œå½’å±â€ï¼š</p>
<ol>
<li><strong>æœªè·Ÿè¸ªæ–‡ä»¶ï¼ˆUntracked filesï¼‰</strong> ï¼šå·¥ä½œåŒºä¸­æ–°å¢çš„ã€Git ä¹‹å‰ä»æœªç®¡ç†è¿‡çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚æ–°å»ºçš„Â <code>hello.cpp</code>ï¼‰ã€‚Git ä¸ä¼šè‡ªåŠ¨è·Ÿè¸ªè¿™äº›æ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡Â <code>git add æ–‡ä»¶å</code>Â æ‰‹åŠ¨åŠ å…¥æš‚å­˜åŒºã€‚</li>
<li><strong>å·²ä¿®æ”¹ä½†æœªæš‚å­˜ï¼ˆModified but not stagedï¼‰</strong> ï¼šä¹‹å‰å·²è¢« Git è·Ÿè¸ªçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚å·²æäº¤è¿‡çš„Â <code>hello.cpp</code>ï¼‰è¢«ä¿®æ”¹äº†ï¼Œä½†ä¿®æ”¹å†…å®¹è¿˜æ²¡æ·»åŠ åˆ°æš‚å­˜åŒºã€‚éœ€è¦Â <code>git add æ–‡ä»¶å</code>Â å°†ä¿®æ”¹åŒæ­¥åˆ°æš‚å­˜åŒºï¼Œæ‰èƒ½åç»­æäº¤ã€‚</li>
<li><strong>å·²æš‚å­˜ä½†æœªæäº¤ï¼ˆChanges to be committedï¼‰</strong> ï¼šå·²é€šè¿‡Â <code>git add</code>Â å°†ä¿®æ”¹ï¼ˆæˆ–æ–°å¢æ–‡ä»¶ï¼‰åŠ å…¥æš‚å­˜åŒºï¼Œç­‰å¾…é€šè¿‡Â <code>git commit</code>Â æäº¤åˆ°æœ¬åœ°ä»“åº“ã€‚è¿™éƒ¨åˆ†å†…å®¹æ˜¯ â€œå¾…æäº¤â€ çš„ï¼Œæäº¤åä»“åº“ä¼šè®°å½•è¿™æ¬¡å˜æ›´ã€‚</li>
<li><strong>åˆ†æ”¯ä¸æäº¤çŠ¶æ€</strong>ï¼šæœ€åä¼šæ˜¾ç¤ºå½“å‰æ‰€åœ¨åˆ†æ”¯ï¼ˆæ¯”å¦‚Â <code>On branch main</code>ï¼‰ï¼Œä»¥åŠå½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„åŒæ­¥çŠ¶æ€ï¼ˆæ¯”å¦‚Â <code>Your branch is up to date with 'origin/main'</code>ï¼Œæˆ–Â <code>Your branch is ahead by 1 commit</code>ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
â€‹
No commits yet
â€‹
Untracked files:
  (use <span class="hljs-string">"git add &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> include <span class="hljs-keyword">in</span> what will be committed)
 Â  Â  Â   hello
 Â  Â  Â   hello.cpp
â€‹
<span class="hljs-literal">nothing</span> added <span class="hljs-keyword">to</span> commit but untracked files present
</code></pre>
</blockquote>
<p>è¯´æ˜ï¼šå½“å‰æœ‰ä¸¤ä¸ªæœªè¢«è¿½è¸ªçš„æ–‡ä»¶ â€”â€” æºç  <code>hello.cpp</code> å’Œå¯æ‰§è¡Œæ–‡ä»¶ <code>hello</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šé€šå¸¸ä¸å°†ç¼–è¯‘ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ <code>hello</code>ï¼‰çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚ä½†ä¸ºå±•ç¤ºç›®çš„ï¼Œæ­¤å¤„æš‚æ—¶ä¸€å¹¶æäº¤ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">5. æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒºå¹¶æäº¤</h2>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">add</span> .
git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "first commit: hello world source file"
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-sql" lang="sql">[master (root<span class="hljs-operator">-</span><span class="hljs-keyword">commit</span>) e2a5eac] <span class="hljs-keyword">first</span> <span class="hljs-keyword">commit</span>: hello world source file
 <span class="hljs-number">2</span> files changed, <span class="hljs-number">8</span> insertions(<span class="hljs-operator">+</span>)
 <span class="hljs-keyword">create</span> mode <span class="hljs-number">100755</span> hello
 <span class="hljs-keyword">create</span> mode <span class="hljs-number">100644</span> hello.cpp
</code></pre>
</blockquote>
<p>å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
<span class="hljs-literal">nothing</span> <span class="hljs-keyword">to</span> commit, working tree clean
</code></pre>
</blockquote>
<p>å·¥ä½œåŒºå¹²å‡€ï¼Œæ‰€æœ‰æ›´æ”¹å·²æäº¤ã€‚</p>
<hr/>
<h2 data-id="heading-6">6. ä¿®æ”¹æºä»£ç </h2>
<p>ç¼–è¾‘ <code>hello.cpp</code>ï¼Œæ–°å¢ä¸€è¡Œè¾“å‡ºï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
â€‹
using namespace <span class="hljs-built_in">std</span>;
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
 Â   <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello World!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
 Â   <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello Cpp!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;  <span class="hljs-comment">// â† æ–°å¢è¡Œ</span>
 Â   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-7">7. æŸ¥çœ‹ä¿®æ”¹çŠ¶æ€</h2>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
Changes <span class="hljs-built_in">not</span> staged <span class="hljs-keyword">for</span> commit:
  (use <span class="hljs-string">"git add &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> update what will be committed)
  (use <span class="hljs-string">"git restore &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> discard changes <span class="hljs-keyword">in</span> working directory)
 Â  Â  Â   modified: Â  hello.cpp
â€‹
no changes added <span class="hljs-keyword">to</span> commit
</code></pre>
</blockquote>
<p>Git æ£€æµ‹åˆ° <code>hello.cpp</code> å·²è¢«ä¿®æ”¹ï¼Œä½†å°šæœªæš‚å­˜ã€‚</p>
<hr/>
<h2 data-id="heading-8">8. æŸ¥çœ‹å…·ä½“ä¿®æ”¹å†…å®¹ï¼ˆä½¿ç”¨ <code>git diff</code>ï¼‰</h2>
<p>å¦‚æœä½ å¿˜è®°äº†è‡ªå·±ä¿®æ”¹äº†ä»€ä¹ˆå†…å®¹ï¼Œæ­¤æ—¶ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹å¯¹æ¯”ã€‚</p>
<pre><code class="hljs">git diff
</code></pre>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">diff --git a/hello.cpp b/hello.cpp</span>
<span class="hljs-comment">index 338506b..5997ef5 100644</span>
<span class="hljs-comment">--- a/hello.cpp</span>
<span class="hljs-comment">+++ b/hello.cpp</span>
<span class="hljs-meta">@@ -4,5 +4,6 @@</span> using namespace std;
 
 int main(void) {
 Â  Â  Â   cout &lt;&lt; "Hello World!" &lt;&lt; endl;
<span class="hljs-addition">+ Â  Â  Â  cout &lt;&lt; "Hello Cpp!" &lt;&lt; endl;</span>
 Â  Â  Â   return 0;
 }
</code></pre>
</blockquote>
<p>æ¸…æ™°æ˜¾ç¤ºæ–°å¢äº†ä¸€è¡Œä»£ç ï¼Œæ­¤æ—¶ä½ å¯ä»¥æ”¾å¿ƒçš„æäº¤äº†ã€‚</p>
<hr/>
<h2 data-id="heading-9">9. æäº¤ä¿®æ”¹</h2>
<ol>
<li>
<p>å°†ä¿®æ”¹åŠ å…¥æš‚å­˜åŒºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">add</span> hello.cpp
</code></pre>
</li>
<li>
<p>æäº¤æ›´æ”¹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "add 'Hello Cpp!' output"
</code></pre>
</li>
</ol>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">master 0e38978</span>] <span class="hljs-keyword">add</span> <span class="hljs-string">'Hello Cpp!'</span> output
 <span class="hljs-number">1</span> file changed, <span class="hljs-number">1</span> insertion(+)
</code></pre>
</blockquote>
<ol>
<li>
<p>å†æ¬¡æ£€æŸ¥çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
</li>
</ol>
<blockquote>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
<span class="hljs-literal">nothing</span> <span class="hljs-keyword">to</span> commit, working tree clean
</code></pre>
</blockquote>
<p>æ‰€æœ‰æ›´æ”¹å·²æˆåŠŸæäº¤ï¼Œå·¥ä½œåŒºå¹²å‡€ã€‚</p>
<hr/>
<h2 data-id="heading-10">æ€»ç»“ï¼šGit åŸºæœ¬å·¥ä½œæµ</h2>



































<table><thead><tr><th>æ­¥éª¤</th><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–ä»“åº“</td><td><code>git init</code></td><td>åˆ›å»ºæ–°çš„ Git ä»“åº“</td></tr><tr><td>æŸ¥çœ‹çŠ¶æ€</td><td><code>git status</code></td><td>æ˜¾ç¤ºå·¥ä½œåŒºä¸æš‚å­˜åŒºçŠ¶æ€</td></tr><tr><td>æŸ¥çœ‹å·®å¼‚</td><td><code>git diff</code></td><td>æ˜¾ç¤ºæœªæš‚å­˜çš„ä¿®æ”¹å†…å®¹</td></tr><tr><td>æ·»åŠ æ–‡ä»¶</td><td><code>git add &lt;file&gt;</code> æˆ– <code>git add .</code></td><td>å°†æ›´æ”¹åŠ å…¥æš‚å­˜åŒº</td></tr><tr><td>æäº¤æ›´æ”¹</td><td><code>git commit -m "message"</code></td><td>å°†æš‚å­˜åŒºå†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡å¸¦ä½ æŒæ¡MyBatis-Plusä»£ç ç”Ÿæˆå™¨ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œå®ç°åŸç†ä¸è‡ªå®šä¹‰æ¨¡æ¿å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7579494852654219298</link>    <guid>https://juejin.cn/post/7579494852654219298</guid>    <pubDate>2025-12-04T02:57:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579494852654219298" data-draft-id="7579544918076391459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡å¸¦ä½ æŒæ¡MyBatis-Plusä»£ç ç”Ÿæˆå™¨ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œå®ç°åŸç†ä¸è‡ªå®šä¹‰æ¨¡æ¿å…¨è§£æ"/> <meta itemprop="keywords" content="åç«¯,Spring Boot,Java"/> <meta itemprop="datePublished" content="2025-12-04T02:57:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shepherd"/> <meta itemprop="url" content="https://juejin.cn/user/3415500769991869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡å¸¦ä½ æŒæ¡MyBatis-Plusä»£ç ç”Ÿæˆå™¨ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œå®ç°åŸç†ä¸è‡ªå®šä¹‰æ¨¡æ¿å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3415500769991869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shepherd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:57:41.000Z" title="Thu Dec 04 2025 02:57:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆéœ€è¦ä»£ç ç”Ÿæˆå™¨ï¼Ÿ</h2>
<p>è¿‘å¹´æ¥ï¼Œéšç€AIç¼–ç¨‹å’Œä½ä»£ç å¹³å°çš„å…´èµ·ï¼Œå¼€å‘æ•ˆç‡æˆä¸ºæŠ€æœ¯åœˆçš„çƒ­é—¨è¯é¢˜ã€‚è™½ç„¶è¿™äº›å·¥å…·èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡å¼€å‘æ•ˆç‡ï¼Œä½†å¯¹äºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œå®šåˆ¶åŒ–éœ€æ±‚ï¼Œä»ç„¶éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç¼–å†™ä»£ç ã€‚</p>
<p>ç‰¹åˆ«æ˜¯åœ¨åç«¯å¼€å‘ä¸­ï¼Œä¸šåŠ¡æ¥å£çš„ç¼–å†™å¾€å¾€å­˜åœ¨å¤§é‡é‡å¤æ€§å·¥ä½œï¼šå®ä½“ç±»ã€Mapperã€Serviceã€Controllerç­‰åŸºç¡€ä»£ç ç»“æ„ç›¸ä¼¼ï¼Œå´éœ€è¦åå¤ç¼–å†™ã€‚è¿™æ—¶å€™ï¼Œä¸€ä¸ªä¼˜ç§€çš„ä»£ç ç”Ÿæˆå™¨å°±èƒ½å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>ä»Šå¤©æˆ‘è¦è¯¦ç»†ä»‹ç»çš„å°±æ˜¯<strong>MyBatis-Plus Generator</strong>ï¼ˆç®€ç§°<strong>MPG</strong>ï¼‰ï¼Œè¿™æ¬¾å¼ºå¤§çš„ä»£ç ç”Ÿæˆå·¥å…·èƒ½å¤Ÿæ ¹æ®æ•°æ®åº“è¡¨ç»“æ„ï¼Œè‡ªåŠ¨ç”ŸæˆåŒ…æ‹¬Entityã€Mapperã€Serviceã€Controlleråœ¨å†…çš„å…¨å¥—ä»£ç ï¼ŒçœŸæ­£å®ç°"ä¸€é”®ç”Ÿæˆï¼Œå¼€ç®±å³ç”¨"ã€‚</p>
<h2 data-id="heading-1">2.å¿«é€Ÿå…¥é—¨ï¼š5åˆ†é’Ÿä¸Šæ‰‹ä»£ç ç”Ÿæˆ</h2>
<h3 data-id="heading-2">2.1 å¼•å…¥ä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"> Â <span class="hljs-comment">&lt;!-- ä»£ç ç”Ÿæˆå™¨  --&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
 Â <span class="hljs-comment">&lt;!-- æ¨¡æ¿å¼•æ“ï¼ˆFreemarkerç¤ºä¾‹ï¼‰ --&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
 Â  Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2.2 å‡†å¤‡æµ‹è¯•æ•°æ®è¡¨</h3>
<p>åˆ›å»ºä¸€å¼ æµ‹è¯•ç”¨æˆ·è¡¨<code>tb_user</code>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tb_user` (
 Â `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ä¸»é”®'</span>,
 Â `user_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç¼–å·'</span>,
 Â `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ˜µç§°'</span>,
 Â `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é‚®ç®±'</span>,
 Â `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ‰‹æœºå·'</span>,
 Â `gender` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'æ€§åˆ«  0ï¼šç”·ç”Ÿ Â  1ï¼šå¥³ç”Ÿ'</span>,
 Â `birthday` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'å‡ºç”Ÿæ—¥æœŸ'</span>,
 Â `is_delete` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'åˆ é™¤æ ‡å¿— 0ï¼šå¦  1ï¼šæ˜¯'</span>,
 Â `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
 Â `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>,
 Â `creator` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ›å»ºäºº'</span>,
 Â `updater` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ›´æ–°äºº'</span>,
 Â `address` <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åœ°å€'</span>,
 Â `role_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è§’è‰²id'</span>,
 Â `hobby` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'çˆ±å¥½'</span>,
 Â `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸ªäººè¯´æ˜'</span>,
 Â `org_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å…¬å¸id'</span>,
 Â <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE,
 Â <span class="hljs-keyword">UNIQUE</span> KEY `uk_user_no` (`user_no`) <span class="hljs-keyword">USING</span> BTREE
) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 ROW_FORMAT<span class="hljs-operator">=</span><span class="hljs-keyword">DYNAMIC</span>;
</code></pre>
<h3 data-id="heading-4">2.3 åŸºç¡€é…ç½®ç”Ÿæˆä»£ç </h3>
<p>MPGæä¾›äº†æµç•…çš„Builderæ¨¡å¼APIï¼Œè®©é…ç½®è¿‡ç¨‹ç›´è§‚æ˜“æ‡‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">public class CodeGeneratorTest {
â€‹
 Â  Â public static void <span class="hljs-selector-tag">main</span>(String[] args) {
 Â  Â  Â  Â <span class="hljs-comment">// ä½¿ç”¨ FastAutoGenerator å¿«é€Ÿé…ç½®ä»£ç ç”Ÿæˆå™¨</span>
 Â  Â  Â  Â FastAutoGenerator<span class="hljs-selector-class">.create</span>("jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/db_test?useUnicode=true&amp;characterEncoding=utf-<span class="hljs-number">8</span>&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true",
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "root",
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "root")
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.globalConfig</span>(builder -&gt; { Â // å…¨å±€é…ç½®
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â builder.author("ZFJ") <span class="hljs-comment">// è®¾ç½®ä½œè€…</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.commentDate</span>("yyyy-MM-dd") Â <span class="hljs-comment">// è®¾ç½®æ—¥æœŸ</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableSpringdoc</span>() Â <span class="hljs-comment">// å¼€å¯openapi3æ–‡æ¡£æ³¨é‡Š</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.outputDir</span>("src/main/java") Â <span class="hljs-comment">// è¾“å‡ºç›®å½•</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.disableOpenDir</span>(); <span class="hljs-comment">// ä¸æ‰“å¼€è·¯å¾„</span>
 Â  Â  Â  Â  Â  Â  Â   })
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.packageConfig</span>(builder -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â builder.parent("com.shepherd.example") <span class="hljs-comment">// è®¾ç½®çˆ¶åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.entity</span>("entity") <span class="hljs-comment">// è®¾ç½®entityå®ä½“ç±»åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.mapper</span>("dao") <span class="hljs-comment">// è®¾ç½®Mapperæ¥å£åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.service</span>("service") <span class="hljs-comment">// è®¾ç½®Serviceæ¥å£åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.serviceImpl</span>("service.impl") <span class="hljs-comment">// è®¾ç½®Serviceå®ç°ç±»åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.xml</span>("mappers"); <span class="hljs-comment">// è®¾ç½® MapperXMLæ–‡ä»¶åŒ…å</span>
 Â  Â  Â  Â  Â  Â  Â   })
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.strategyConfig</span>(builder -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â builder.addInclude("tb_user") <span class="hljs-comment">// è®¾ç½®éœ€è¦ç”Ÿæˆçš„è¡¨å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.addTablePrefix</span>("tb_") <span class="hljs-comment">// æ·»åŠ è¡¨å‰ç¼€</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®å®ä½“ç±»</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.entityBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableLombok</span>(new ClassAnnotationAttributes("@Data","lombok.Data")) <span class="hljs-comment">// å¯ç”¨ Lombok</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableTableFieldAnnotation</span>() <span class="hljs-comment">// å¯ç”¨å­—æ®µæ³¨è§£</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.javaTemplate</span>("/templates/entity.java") <span class="hljs-comment">// è®¾ç½®å®ä½“ç±»æ¨¡æ¿</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®mapperæ¥å£</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.mapperBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.mapperTemplate</span>("/templates/mapper.java") <span class="hljs-comment">// è®¾ç½®mapperç›®æ ‡</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.convertMapperFileName</span>((entityName -&gt; entityName + "DAO")) <span class="hljs-comment">// è®¾ç½®mapperæ¥å£æ–‡ä»¶å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableBaseResultMap</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableBaseColumnList</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®serviceæ¥å£</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.serviceBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.serviceTemplate</span>("/templates/service.java") <span class="hljs-comment">// è®¾ç½®Serviceæ¨¡æ¿</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.convertServiceFileName</span>((entityName -&gt; entityName + "Service")) <span class="hljs-comment">// è®¾ç½®serviceæ–‡ä»¶å</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.serviceImplTemplate</span>("/templates/serviceImpl.java") <span class="hljs-comment">// è®¾ç½®ServiceImplæ¨¡æ¿</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®controllerç±»</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.controllerBuilder</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.template</span>("/templates/controller.java")
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.enableRestStyle</span>(); <span class="hljs-comment">// å¯ç”¨ REST é£æ ¼</span>
 Â  Â  Â  Â  Â  Â  Â   })
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.templateEngine</span>(new FreemarkerTemplateEngine()) <span class="hljs-comment">// ä½¿ç”¨ Freemarker æ¨¡æ¿å¼•æ“</span>
 Â  Â  Â  Â  Â  Â  Â   <span class="hljs-selector-class">.execute</span>(); <span class="hljs-comment">// æ‰§è¡Œç”Ÿæˆ</span>
 Â   }
}
â€‹
</code></pre>
<p>è¿è¡Œç”Ÿæˆä»£ç æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b54f204e6714cad84ed98c601255951~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421861&amp;x-signature=6uWNkITxeHVQGqNRfn97GG3vgbE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">3.æ ¸å¿ƒé…ç½®</h2>
<h3 data-id="heading-6">3.1 å…¨å±€é…ç½®ï¼ˆGlobalConfigï¼‰</h3>
<p>å…¨å±€é…ç½®æä¾›äº†å¯¹ä»£ç ç”Ÿæˆå™¨æ•´ä½“è¡Œä¸ºçš„è®¾ç½®ï¼ŒåŒ…æ‹¬è¾“å‡ºç›®å½•ã€ä½œè€…ä¿¡æ¯ã€Kotlin æ¨¡å¼ã€Swagger é›†æˆã€Springdocã€æ—¶é—´ç±»å‹ç­–ç•¥ç­‰</p>


















































<table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>disableOpenDir()</td><td>ç¦æ­¢è‡ªåŠ¨æ‰“å¼€è¾“å‡ºç›®å½•</td><td>é»˜è®¤å€¼: <code>true</code></td></tr><tr><td>outputDir(String)</td><td>æŒ‡å®šä»£ç ç”Ÿæˆçš„è¾“å‡ºç›®å½•</td><td>å¦‚ï¼šSystem.getProperty("user.dir") + "/src/main/java"</td></tr><tr><td>author(String)</td><td>è®¾ç½®ä½œè€…å</td><td><code>baomidou</code> é»˜è®¤å€¼: é…ç½®æ–‡ä»¶ä¸­çš„ä½œè€…å</td></tr><tr><td>enableKotlin()</td><td>å¼€å¯ Kotlin æ¨¡å¼</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableSwagger()</td><td>å¼€å¯ Swagger æ¨¡å¼</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>dateType(DateType)</td><td>è®¾ç½®æ—¶é—´ç±»å‹ç­–ç•¥</td><td><code>DateType.ONLY_DATE</code> é»˜è®¤å€¼: <code>DateType.TIME_PACK</code></td></tr><tr><td>commentDate(String)</td><td>è®¾ç½®æ³¨é‡Šæ—¥æœŸæ ¼å¼</td><td>é»˜è®¤å€¼: <code>yyyy-MM-dd</code></td></tr><tr><td>enableSpringdoc</td><td>å¼€å¯Springdocæ–‡æ¡£</td><td>é»˜è®¤å€¼ï¼š<code>false</code></td></tr></tbody></table>
<h3 data-id="heading-7">3.2 ç­–ç•¥é…ç½®ï¼ˆStrategyConfigï¼‰</h3>
<p>ç­–ç•¥é…ç½®æ˜¯MPGçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒå…è®¸å¼€å‘è€…æ ¹æ®é¡¹ç›®éœ€æ±‚å®šåˆ¶ä»£ç ç”Ÿæˆçš„è§„åˆ™ï¼ŒåŒ…æ‹¬å‘½åæ¨¡å¼ã€è¡¨å’Œå­—æ®µçš„è¿‡æ»¤ã€ä»¥åŠå„ä¸ªä»£ç æ¨¡å—çš„ç”Ÿæˆç­–ç•¥ã€‚</p>































































































<table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>enableCapitalMode</td><td>å¼€å¯å¤§å†™å‘½å</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableSkipView</td><td>å¼€å¯è·³è¿‡è§†å›¾</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>disableSqlFilter</td><td>ç¦ç”¨ SQL è¿‡æ»¤</td><td>é»˜è®¤å€¼: <code>true</code>ï¼Œå¦‚æœ SQL è¿‡æ»¤ä¸æ”¯æŒï¼Œå¯ä»¥å…³é—­æ­¤é€‰é¡¹</td></tr><tr><td>enableSchema</td><td>å¯ç”¨ schema</td><td>é»˜è®¤å€¼: <code>false</code>ï¼Œå¤š schema åœºæ™¯æ—¶å¯ç”¨</td></tr><tr><td>likeTable(LikeTable)</td><td>æ¨¡ç³Šè¡¨åŒ¹é…(SQL è¿‡æ»¤)</td><td>ä¸ <code>notLikeTable</code> äº’æ–¥ï¼Œåªèƒ½é…ç½®ä¸€é¡¹</td></tr><tr><td>notLikeTable(LikeTable)</td><td>æ¨¡ç³Šè¡¨æ’é™¤(SQL è¿‡æ»¤)</td><td>ä¸ <code>likeTable</code> äº’æ–¥ï¼Œåªèƒ½é…ç½®ä¸€é¡¹</td></tr><tr><td>addInclude(Stringâ€¦)</td><td>å¢åŠ è¡¨åŒ¹é…(å†…å­˜è¿‡æ»¤)</td><td>ä¸ <code>addExclude</code> äº’æ–¥ï¼Œåªèƒ½é…ç½®ä¸€é¡¹ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…ï¼Œå¦‚ <code>^t_.*</code> åŒ¹é…æ‰€æœ‰ä»¥ <code>t_</code> å¼€å¤´çš„è¡¨å</td></tr><tr><td>addExclude(Stringâ€¦)</td><td>å¢åŠ è¡¨æ’é™¤åŒ¹é…(å†…å­˜è¿‡æ»¤)</td><td>ä¸ <code>addInclude</code> äº’æ–¥ï¼Œåªèƒ½é…ç½®ä¸€é¡¹ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…ï¼Œå¦‚ <code>.*st$</code> åŒ¹é…æ‰€æœ‰ä»¥ <code>st</code> ç»“å°¾çš„è¡¨å</td></tr><tr><td>addTablePrefix(Stringâ€¦)</td><td>å¢åŠ è¿‡æ»¤è¡¨å‰ç¼€</td><td/></tr><tr><td>addTableSuffix(Stringâ€¦)</td><td>å¢åŠ è¿‡æ»¤è¡¨åç¼€</td><td/></tr><tr><td>addFieldPrefix(Stringâ€¦)</td><td>å¢åŠ è¿‡æ»¤å­—æ®µå‰ç¼€</td><td/></tr><tr><td>addFieldSuffix(Stringâ€¦)</td><td>å¢åŠ è¿‡æ»¤å­—æ®µåç¼€</td><td/></tr><tr><td>outputFile</td><td>å†…ç½®æ¨¡æ¿è¾“å‡ºæ–‡ä»¶å¤„ç†</td><td>å‚è€ƒæµ‹è¯•ç”¨ä¾‹ <code>H2CodeGeneratorTest.testOutputFile</code></td></tr><tr><td>entityBuilder</td><td>å®ä½“ç­–ç•¥é…ç½®</td><td/></tr><tr><td>controllerBuilder</td><td>Controller ç­–ç•¥é…ç½®</td><td/></tr><tr><td>mapperBuilder</td><td>Mapper ç­–ç•¥é…ç½®</td><td/></tr><tr><td>serviceBuilder</td><td>Service ç­–ç•¥é…ç½®</td><td/></tr></tbody></table>
<p>å¯ä»¥çœ‹åˆ°ç­–ç•¥é…ç½®å¯¹æä¾›ç»Ÿä¸€çš„ç”Ÿæˆè§„åˆ™é…ç½®ï¼Œè¿˜æ”¯æŒ<code>entity, mapper, service, controller</code>ç­‰ç±»åˆ†åˆ«é…ç½®ï¼Œæ¡ç†æ¸…æ™°ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚ç¢äºç¯‡å¹…é—®é¢˜ï¼Œæˆ‘è¿™é‡Œå°±åªå±•ç¤ºä¸€ä¸‹å®ä½“ç±»entityçš„ç”Ÿæˆç­–ç•¥é…ç½®ï¼Œå…¶ä»–çš„è¯¦è§å®˜ç½‘æ–‡æ¡£ã€‚</p>
<p><strong>Entity ç­–ç•¥é…ç½®</strong></p>
<p>å®ä½“ç­–ç•¥é…ç½®ç”¨äºå®šåˆ¶å®ä½“ç±»çš„ç”Ÿæˆè§„åˆ™ï¼ŒåŒ…æ‹¬çˆ¶ç±»ã€åºåˆ—åŒ–ç‰ˆæœ¬ UIDã€æ–‡ä»¶è¦†ç›–ã€å­—æ®µå¸¸é‡ã€é“¾å¼æ¨¡å‹ã€Lombok æ¨¡å‹ç­‰</p>
































































































































































<table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>nameConvert(INameConvert)</td><td>åç§°è½¬æ¢å®ç°</td><td/></tr><tr><td>superClass(Class&lt;?&gt;)</td><td>è®¾ç½®çˆ¶ç±»</td><td><code>BaseEntity.class</code></td></tr><tr><td>superClass(String)</td><td>è®¾ç½®çˆ¶ç±»</td><td><code>com.baomidou.global.BaseEntity</code></td></tr><tr><td>disableSerialVersionUID</td><td>ç¦ç”¨ç”Ÿæˆ serialVersionUID</td><td>é»˜è®¤å€¼: <code>true</code></td></tr><tr><td>enableFileOverride</td><td>è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableColumnConstant</td><td>å¼€å¯ç”Ÿæˆå­—æ®µå¸¸é‡</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableChainModel</td><td>å¼€å¯é“¾å¼æ¨¡å‹</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableLombok</td><td>å¼€å¯ Lombok æ¨¡å‹</td><td>é»˜è®¤å€¼: <code>false</code> é»˜è®¤åªæœ‰Getter,Setter,è‡ª3.5.10åå¢åŠ ToString</td></tr><tr><td>enableRemoveIsPrefix</td><td>å¼€å¯ Boolean ç±»å‹å­—æ®µç§»é™¤ is å‰ç¼€</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableTableFieldAnnotation</td><td>å¼€å¯ç”Ÿæˆå®ä½“æ—¶ç”Ÿæˆå­—æ®µæ³¨è§£</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>enableActiveRecord</td><td>å¼€å¯ ActiveRecord æ¨¡å‹</td><td>é»˜è®¤å€¼: <code>false</code></td></tr><tr><td>versionColumnName(String)</td><td>ä¹è§‚é”å­—æ®µå(æ•°æ®åº“å­—æ®µ)</td><td><code>versionColumnName</code> ä¸ <code>versionPropertyName</code> äºŒé€‰ä¸€å³å¯</td></tr><tr><td>versionPropertyName(String)</td><td>ä¹è§‚é”å±æ€§å(å®ä½“)</td><td><code>versionColumnName</code> ä¸ <code>versionPropertyName</code> äºŒé€‰ä¸€å³å¯</td></tr><tr><td>logicDeleteColumnName(String)</td><td>é€»è¾‘åˆ é™¤å­—æ®µå(æ•°æ®åº“å­—æ®µ)</td><td><code>logicDeleteColumnName</code> ä¸ <code>logicDeletePropertyName</code> äºŒé€‰ä¸€å³å¯</td></tr><tr><td>logicDeletePropertyName(String)</td><td>é€»è¾‘åˆ é™¤å±æ€§å(å®ä½“)</td><td><code>logicDeleteColumnName</code> ä¸ <code>logicDeletePropertyName</code> äºŒé€‰ä¸€å³å¯</td></tr><tr><td>naming</td><td>æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</td><td>é»˜è®¤ä¸‹åˆ’çº¿è½¬é©¼å³°å‘½å: <code>NamingStrategy.underline_to_camel</code></td></tr><tr><td>columnNaming</td><td>æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</td><td>é»˜è®¤ä¸º <code>null</code>ï¼ŒæœªæŒ‡å®šæŒ‰ç…§ <code>naming</code> æ‰§è¡Œ</td></tr><tr><td>addSuperEntityColumns(Stringâ€¦)</td><td>æ·»åŠ çˆ¶ç±»å…¬å…±å­—æ®µ</td><td/></tr><tr><td>addIgnoreColumns(Stringâ€¦)</td><td>æ·»åŠ å¿½ç•¥å­—æ®µ</td><td/></tr><tr><td>addTableFills(IFillâ€¦)</td><td>æ·»åŠ è¡¨å­—æ®µå¡«å……</td><td/></tr><tr><td>addTableFills(List)</td><td>æ·»åŠ è¡¨å­—æ®µå¡«å……</td><td/></tr><tr><td>idType(IdType)</td><td>å…¨å±€ä¸»é”®ç±»å‹</td><td/></tr><tr><td>convertFileName(ConverterFileName)</td><td>è½¬æ¢æ–‡ä»¶åç§°</td><td/></tr><tr><td>formatFileName(String)</td><td>æ ¼å¼åŒ–æ–‡ä»¶åç§°</td><td/></tr><tr><td>toString(boolean)</td><td>æ˜¯å¦ç”ŸæˆToStringæ–¹æ³•</td><td>é»˜è®¤ä¸ºtrue, è‡ª3.5.10å¼€å§‹</td></tr><tr><td>fieldUseJavaDoc</td><td>å¯ç”¨å­—æ®µæ–‡æ¡£æ³¨é‡Š</td><td>é»˜è®¤ä¸ºtrue, è‡ª3.5.10å¼€å§‹</td></tr><tr><td>classAnnotations(ClassAnnotationAttributes)</td><td>æ·»åŠ å®ä½“ç±»æ³¨è§£</td><td>è‡ª3.5.10å¼€å§‹</td></tr><tr><td>tableAnnotationHandler</td><td>è¡¨æ³¨è§£å¤„ç†å™¨</td><td>è‡ª3.5.10å¼€å§‹</td></tr><tr><td>tableFieldAnnotationHandler</td><td>å­—æ®µæ³¨è§£å¤„ç†å™¨</td><td>è‡ª3.5.10å¼€å§‹</td></tr><tr><td>enableLombok(ClassAnnotationAttributesâ€¦)</td><td>å¼€å¯ Lombok æ¨¡å‹å¹¶è®¾ç½®Lombokæ³¨è§£</td><td>è‡ª3.5.10å¼€å§‹. ä½¿ç”¨@Dataç¤ºä¾‹: enableLombok(new ClassAnnotationAttributes(â€œ@Dataâ€,â€œlombok.Dataâ€))</td></tr></tbody></table>
<p>å½“ç„¶äº†é™¤äº†ä¸Šé¢æåˆ°çš„å…¨å±€é…ç½®å’Œç­–ç•¥é…ç½®ï¼Œè¿˜æœ‰æ•°æ®æºé…ç½®ï¼ŒåŒ…åé…ç½®ç­‰ç­‰ï¼Œä½†è¿™äº›éƒ½æ¯”è¾ƒç®€å•ï¼Œé¡¾åæ€ä¹‰æ•°æ®æºé…ç½®å°±æ˜¯é…ç½®æ•°æ®æºçš„ï¼ŒåŒ…åé…ç½®å°±æ˜¯é…ç½®ç”Ÿæˆä»£ç ç±»çš„åŒ…åè·¯å¾„ï¼Œå…·ä½“æ–¹æ³•apiè¿˜æ˜¯è¯·ç§»æ­¥å®˜ç½‘æŸ¥çœ‹</p>
<h2 data-id="heading-8">4. è‡ªå®šä¹‰æ¨¡æ¿ï¼šæ‰“é€ å›¢é˜Ÿä¸“å±ä»£ç é£æ ¼</h2>
<h3 data-id="heading-9">4.1 è‡ªå®šä¹‰DTOç”Ÿæˆæ¨¡æ¿</h3>
<p>MPGé»˜è®¤ä¸æä¾›DTOæ¨¡æ¿ï¼Œä½†æˆ‘ä»¬å¯ä»¥è½»æ¾æ‰©å±•ã€‚åˆ›å»º<code>templates/entityDTO.java.ftl</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">package <span class="hljs-variable">${package.Entity}</span>;
â€‹
&lt;<span class="hljs-comment">#list importEntityFrameworkPackages as pkg&gt;</span>
import <span class="hljs-variable">${pkg}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
â€‹
&lt;<span class="hljs-comment">#list importEntityJavaPackages as pkg&gt;</span>
import <span class="hljs-variable">${pkg}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
â€‹
/**
 * &lt;p&gt;
 * <span class="hljs-variable">${table.comment!}</span>
 * &lt;/p&gt;
 *
 * @author <span class="hljs-variable">${author}</span>
 * @since <span class="hljs-variable">${date}</span>
 */
@Data
@Schema(description = <span class="hljs-string">"<span class="hljs-variable">${table.comment!}</span>"</span>)
public class <span class="hljs-variable">${entity}</span>DTO {
&lt;<span class="hljs-comment">#-- ----------  BEGIN å­—æ®µå¾ªç¯éå†  ----------&gt;</span>
&lt;<span class="hljs-comment">#list table.fields as field&gt;</span>
 Â   @Schema(description = <span class="hljs-string">"<span class="hljs-variable">${field.comment!}</span>"</span>)
 Â   private <span class="hljs-variable">${field.propertyType}</span> <span class="hljs-variable">${field.propertyName}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
&lt;<span class="hljs-comment">#------------  END å­—æ®µå¾ªç¯éå†  ----------&gt;</span>
}
â€‹
</code></pre>
<p>å…³äºFreemarkeræ¨¡ç‰ˆçš„è¯­æ³•ï¼Œè¯·å¦è¡ŒæŸ¥é˜…èµ„æ–™ã€‚</p>
<p>åœ¨ä¸Šé¢ç”Ÿæˆç¤ºä¾‹ä»£ç ä¸­è¿½åŠ æ³¨å…¥é…ç½®ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.injectionConfig</span>(injectConfig -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">injectConfig</span><span class="hljs-selector-class">.customFile</span>(new CustomFile.<span class="hljs-built_in">Builder</span>()
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   .<span class="hljs-built_in">fileName</span>(<span class="hljs-string">"DTO.java"</span>) <span class="hljs-comment">// æ–‡ä»¶åç§°</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   .<span class="hljs-built_in">templatePath</span>(<span class="hljs-string">"templates/entityDTO.java.ftl"</span>) <span class="hljs-comment">//æŒ‡å®šç”Ÿæˆæ¨¡æ¿è·¯å¾„</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   .<span class="hljs-built_in">packageName</span>(<span class="hljs-string">"model.dto"</span>) <span class="hljs-comment">// åŒ…å,</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   .<span class="hljs-built_in">build</span>());
</code></pre>
<p>å†æ¬¡è¿è¡Œå°±èƒ½ç”Ÿæˆå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@Data
@Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯"</span>)
public class UserDTO {
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"ä¸»é”®"</span>)
 Â  Â private Long id<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"ç¼–å·"</span>)
 Â  Â private String userNo<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"æ˜µç§°"</span>)
 Â  Â private String name<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"é‚®ç®±"</span>)
 Â  Â private String email<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"æ‰‹æœºå·"</span>)
 Â  Â private String phone<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"æ€§åˆ«  0ï¼šç”·ç”Ÿ Â  1ï¼šå¥³ç”Ÿ"</span>)
 Â  Â private Byte gender<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"å‡ºç”Ÿæ—¥æœŸ"</span>)
 Â  Â private LocalDateTime birthday<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"åˆ é™¤æ ‡å¿— 0ï¼šå¦  1ï¼šæ˜¯"</span>)
 Â  Â private Byte isDelete<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"åˆ›å»ºæ—¶é—´"</span>)
 Â  Â private LocalDateTime createTime<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"æ›´æ–°æ—¶é—´"</span>)
 Â  Â private LocalDateTime updateTime<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"åˆ›å»ºäºº"</span>)
 Â  Â private Long creator<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"æ›´æ–°äºº"</span>)
 Â  Â private Long updater<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"åœ°å€"</span>)
 Â  Â private String address<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"è§’è‰²id"</span>)
 Â  Â private String roleId<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"çˆ±å¥½"</span>)
 Â  Â private String hobby<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"ä¸ªäººè¯´æ˜"</span>)
 Â  Â private String remark<span class="hljs-comment">;</span>
 Â  Â @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"å…¬å¸id"</span>)
 Â  Â private Long orgId<span class="hljs-comment">;</span>
}
â€‹
</code></pre>
<h3 data-id="heading-10">4.2 å®šåˆ¶åŠŸèƒ½ä¸°å¯Œçš„Controlleræ¨¡æ¿</h3>
<p>é»˜è®¤ç”Ÿæˆçš„Controlleræ¯”è¾ƒåŸºç¡€ï¼Œå¦‚æœä¸šåŠ¡çš„CRUDä»£ç æ²¡æœ‰åŒ…å«å¤æ‚å¤„ç†é€»è¾‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šåˆ¶ä»£ç å‡å°‘ç¼–ç é‡å¤ï¼Œåˆ›å»ºæ›´å®ç”¨çš„æ¨¡æ¿<code>templates/controller.java.ftl</code>ï¼š</p>
<pre><code class="hljs language-less" lang="less">&lt;<span class="hljs-selector-id">#assign</span> <span class="hljs-selector-tag">serviceNameLower</span> = <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>?<span class="hljs-selector-tag">uncap_first</span>&gt;
&lt;<span class="hljs-selector-id">#assign</span> <span class="hljs-selector-tag">entityNameLower</span> = <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>?<span class="hljs-selector-tag">uncap_first</span>&gt;
â€‹
<span class="hljs-selector-tag">package</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Controller</span>};
â€‹
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Service</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>};
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Param</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span>;
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Query</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Query</span>;
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.VO</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.plasticene</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.pojo</span><span class="hljs-selector-class">.ResponseVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Validated</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
â€‹
â€‹
<span class="hljs-comment">/**
 * &lt;p&gt;
 * ${table.comment!}
 * &lt;/p&gt;
 *
 * @author ${author}
 * @since ${date}
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"&lt;#if package.ModuleName?? &amp;&amp; package.ModuleName != "</span><span class="hljs-string">"&gt;/${package.ModuleName}&lt;/#if&gt;/&lt;#if controllerMappingHyphenStyle&gt;${controllerMappingHyphen}&lt;#else&gt;${table.entityPath}&lt;/#if&gt;"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"${table.comment!}"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.controllerName</span>} {
 Â   <span class="hljs-variable">@Resource</span>
 Â   private ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>} ${<span class="hljs-selector-tag">serviceNameLower</span>};
â€‹
 Â   @<span class="hljs-selector-tag">PostMapping</span>
 Â   @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"åˆ›å»º"</span>)
 Â   <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Long</span>&gt; <span class="hljs-selector-tag">create</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>) {
 Â  Â  Â   <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">id</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.create</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>);
 Â  Â  Â  Â  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(id);
 Â   }
â€‹
 Â   @<span class="hljs-selector-tag">PutMapping</span>
 Â   @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"ä¿®æ”¹"</span>)
 Â   <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>) {
 Â  Â  Â   ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.update</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>);
 Â  Â  Â   <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
 Â   }
â€‹
 Â   @<span class="hljs-selector-tag">DeleteMapping</span>
 Â   @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"åˆ é™¤"</span>)
 Â   <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">delete</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Long&gt; idList) {
 Â  Â  Â   ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.delete</span>(idList);
 Â  Â  Â   <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
 Â   }
â€‹
 Â   @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
 Â   @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"åˆ†é¡µ"</span>)
 Â   <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">PageResult</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt;&gt; <span class="hljs-selector-tag">page</span>(${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Query</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Quey</span>) {
 Â  Â  Â   <span class="hljs-selector-tag">PageResult</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt; <span class="hljs-selector-tag">pageVO</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.page</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Query</span>);
 Â  Â  Â   <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(pageVO);
 Â   }
â€‹
 Â   @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
 Â   @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"è¯¦æƒ…"</span>)
 Â   <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt; <span class="hljs-selector-tag">detail</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id) {
 Â  Â  Â   ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">VO</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.detail</span>(id);
 Â  Â  Â   <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">VO</span>);
 Â   }
â€‹
}
</code></pre>
<p>å†æ¬¡è¿è¡Œä¸Šé¢ç”Ÿæˆç¤ºä¾‹ä»£ç ï¼š<code>UserController</code></p>
<pre><code class="hljs language-less" lang="less">â€‹
<span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.controller</span>;
â€‹
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.UserService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.param</span><span class="hljs-selector-class">.UserParam</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.UserQuery</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.vo</span><span class="hljs-selector-class">.UserVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.plasticene</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.pojo</span><span class="hljs-selector-class">.ResponseVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Validated</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
â€‹
â€‹
<span class="hljs-comment">/**
 * &lt;p&gt;
 * ç”¨æˆ·ä¿¡æ¯
 * &lt;/p&gt;
 *
 * @author ZFJ
 * @since 2025-12-03
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/user"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserController</span> {
 Â  Â <span class="hljs-variable">@Resource</span>
 Â  Â private UserService userService;
â€‹
 Â  Â <span class="hljs-variable">@PostMapping</span>
 Â  Â <span class="hljs-variable">@Operation</span>(summary = <span class="hljs-string">"åˆ›å»º"</span>)
 Â  Â public ResponseVO&lt;Long&gt; <span class="hljs-built_in">create</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> UserParam userParam) {
 Â  Â  Â  Â <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">id</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.create</span>(userParam);
 Â  Â  Â  Â  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(id);
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">PutMapping</span>
 Â  Â @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"ä¿®æ”¹"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> UserParam userParam) {
 Â  Â  Â  Â <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.update</span>(userParam);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">DeleteMapping</span>
 Â  Â @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"åˆ é™¤"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">delete</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Long&gt; idList) {
 Â  Â  Â  Â <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.delete</span>(idList);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
 Â  Â @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"åˆ†é¡µ"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">PageResult</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt;&gt; <span class="hljs-selector-tag">page</span>(UserQuery userQuey) {
 Â  Â  Â  Â <span class="hljs-selector-tag">PageResult</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt; <span class="hljs-selector-tag">pageVO</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.page</span>(userQuery);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(pageVO);
 Â   }
â€‹
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
 Â  Â @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"è¯¦æƒ…"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt; <span class="hljs-selector-tag">detail</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id) {
 Â  Â  Â  Â <span class="hljs-selector-tag">UserVO</span> <span class="hljs-selector-tag">userVO</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.detail</span>(id);
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(userVO);
 Â   }
â€‹
}
â€‹
</code></pre>
<p>è‡³äºserviceå±‚çš„ä¸šåŠ¡å®šåˆ¶ä»£ç ï¼Œå¤§å®¶è‡ªè¡Œå°è¯•å®šåˆ¶ä¸€ä¸‹å“ˆã€‚</p>
<h2 data-id="heading-11">5.æ·±å…¥åŸç†ï¼šMPGæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<h3 data-id="heading-12">5.1 æ ¸å¿ƒç±»ç»“æ„</h3>
<pre><code class="hljs language-arduino" lang="arduino">AutoGenerator Â  Â  Â  Â  Â  Â   <span class="hljs-comment">// ä»£ç ç”Ÿæˆå™¨å…¥å£</span>
â”œâ”€â”€ ConfigBuilder Â  Â  Â  Â   <span class="hljs-comment">// é…ç½®æ„å»ºå™¨</span>
â”œâ”€â”€ TemplateEngine Â  Â  Â  Â  <span class="hljs-comment">// æ¨¡æ¿å¼•æ“æŠ½è±¡</span>
â”‚ Â  â”œâ”€â”€ VelocityTemplateEngine
â”‚ Â  â”œâ”€â”€ FreemarkerTemplateEngine
â”‚ Â  â””â”€â”€ BeetlTemplateEngine
â””â”€â”€ InjectionConfig Â  Â  Â   <span class="hljs-comment">// æ³¨å…¥é…ç½®</span>
</code></pre>
<h3 data-id="heading-13">5.2 ä»£ç ç”Ÿæˆæµç¨‹</h3>
<ol>
<li><strong>é…ç½®è§£æ</strong>ï¼šè§£æå…¨å±€é…ç½®ã€æ•°æ®æºé…ç½®ã€åŒ…é…ç½®ã€ç­–ç•¥é…ç½®</li>
<li><strong>è¡¨ä¿¡æ¯è·å–</strong>ï¼šé€šè¿‡JDBCè·å–æ•°æ®åº“è¡¨ç»“æ„å’Œå­—æ®µä¿¡æ¯</li>
<li><strong>æ¨¡æ¿æ¸²æŸ“</strong>ï¼šä½¿ç”¨æ¨¡æ¿å¼•æ“å°†æ•°æ®æ¨¡å‹æ¸²æŸ“åˆ°æ¨¡æ¿æ–‡ä»¶ä¸­</li>
<li><strong>æ–‡ä»¶è¾“å‡º</strong>ï¼šå°†æ¸²æŸ“ç»“æœå†™å…¥åˆ°æŒ‡å®šç›®å½•</li>
</ol>
<h3 data-id="heading-14">5.3 å…³é”®æºç åˆ†æ</h3>
<p>è°ƒè¯•ä¸Šé¢ç”Ÿæˆä»£ç ç¤ºä¾‹ï¼Œç›´æ¥æ¥åˆ°<code>AutoGenerator</code>çš„æ‰§è¡Œæ–¹æ³•<code>#execute()</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"> <span class="hljs-keyword">public</span> void execute(AbstractTemplateEngine templateEngine) {
 Â  Â  Â  Â logger.debug(<span class="hljs-string">"==========================å‡†å¤‡ç”Ÿæˆæ–‡ä»¶...=========================="</span>);
 Â  Â  Â  Â 
 Â  Â  Â  Â <span class="hljs-comment">// å¦‚æœé…ç½®ä¿¡æ¯ä¸ºç©ºï¼Œåˆ™åˆ›å»ºæ–°çš„é…ç½®æ„å»ºå™¨</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == <span class="hljs-keyword">this</span>.config) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.config = new ConfigBuilder(<span class="hljs-keyword">this</span>.packageInfo, <span class="hljs-keyword">this</span>.dataSource, <span class="hljs-keyword">this</span>.strategy, <span class="hljs-keyword">this</span>.template, <span class="hljs-keyword">this</span>.globalConfig, <span class="hljs-keyword">this</span>.injection);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// å¦‚æœæ¨¡æ¿å¼•æ“ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„Velocityæ¨¡æ¿å¼•æ“</span>
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == templateEngine) {
 Â  Â  Â  Â  Â  Â templateEngine = new VelocityTemplateEngine();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®é…ç½®æ„å»ºå™¨å¹¶æ‰§è¡Œæ‰¹é‡è¾“å‡ºæ“ä½œ</span>
 Â  Â  Â  Â templateEngine.setConfigBuilder(<span class="hljs-keyword">this</span>.config);
 Â  Â  Â  Â templateEngine.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>.config).batchOutput().<span class="hljs-keyword">open</span>();
 Â  Â  Â  Â logger.debug(<span class="hljs-string">"==========================æ–‡ä»¶ç”Ÿæˆå®Œæˆï¼ï¼ï¼=========================="</span>);
 Â   }
</code></pre>
<p>æœ€ååˆ°ç”Ÿæˆå„ç±»ä»£ç æ–‡ä»¶çš„æ–¹æ³•<code>batchOutput()</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"> Â  Â <span class="hljs-comment">/**
 Â  Â  * æ‰¹é‡è¾“å‡ºæ¨¡æ¿æ–‡ä»¶
 Â  Â  * &lt;p&gt;
 Â  Â  * è¯¥æ–¹æ³•æ ¹æ®é…ç½®ä¿¡æ¯æ‰¹é‡ç”Ÿæˆä»£ç æ–‡ä»¶ï¼ŒåŒ…æ‹¬å®ä½“ç±»ã€Mapperã€Serviceã€Controllerç­‰æ–‡ä»¶ã€‚
 Â  Â  * å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š
 Â  Â  * 1. è·å–é…ç½®æ„å»ºå™¨å’Œè¡¨ä¿¡æ¯åˆ—è¡¨
 Â  Â  * 2. éå†æ¯å¼ è¡¨ï¼Œç”Ÿæˆå¯¹åº”çš„å¯¹è±¡æ˜ å°„å…³ç³»
 Â  Â  * 3. æ‰§è¡Œè‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºå‰çš„å›è°ƒå¤„ç†
 Â  Â  * 4. è¾“å‡ºå„ç±»ä»£ç æ–‡ä»¶
 Â  Â  *
 Â  Â  * <span class="hljs-doctag">@return</span> AbstractTemplateEngine æ¨¡æ¿å¼•æ“å®ä¾‹ï¼Œç”¨äºé“¾å¼è°ƒç”¨
 Â  Â  * <span class="hljs-doctag">@throws</span> RuntimeException å½“æ–‡ä»¶åˆ›å»ºå¤±è´¥æˆ–é…ç½®ä¿¡æ¯æœ‰è¯¯æ—¶æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-meta">@NotNull</span> AbstractTemplateEngine batchOutput() {
 Â  Â  Â  Â <span class="hljs-keyword">try</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å–é…ç½®æ„å»ºå™¨å®ä¾‹</span>
 Â  Â  Â  Â  Â  Â ConfigBuilder config = <span class="hljs-keyword">this</span>.getConfigBuilder();
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è·å–æ‰€æœ‰éœ€è¦å¤„ç†çš„è¡¨ä¿¡æ¯åˆ—è¡¨</span>
 Â  Â  Â  Â  Â  Â List&lt;TableInfo&gt; tableInfoList = config.getTableInfoList();
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// éå†æ‰€æœ‰è¡¨ä¿¡æ¯ï¼Œä¸ºæ¯å¼ è¡¨ç”Ÿæˆç›¸åº”çš„ä»£ç æ–‡ä»¶</span>
 Â  Â  Â  Â  Â  Â tableInfoList.forEach((tableInfo) -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ„å»ºå½“å‰è¡¨çš„å¯¹è±¡æ˜ å°„å…³ç³»ï¼Œç”¨äºæ¨¡æ¿æ¸²æŸ“</span>
 Â  Â  Â  Â  Â  Â  Â  Â Map&lt;String, Object&gt; objectMap = <span class="hljs-keyword">this</span>.getObjectMap(config, tableInfo);
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å¤„ç†è‡ªå®šä¹‰æ³¨å…¥é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span>
 Â  Â  Â  Â  Â  Â  Â  Â Optional.ofNullable(config.getInjectionConfig()).ifPresent((t) -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// åœ¨è¾“å‡ºæ–‡ä»¶å‰æ‰§è¡Œè‡ªå®šä¹‰å›è°ƒå¤„ç†</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â t.beforeOutputFile(tableInfo, objectMap);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// è¾“å‡ºè‡ªå®šä¹‰æ–‡ä»¶</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.outputCustomFile(t.getCustomFiles(), tableInfo, objectMap);
 Â  Â  Â  Â  Â  Â  Â   });
 Â  Â  Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æŒ‰é¡ºåºè¾“å‡ºå„ç±»æ ‡å‡†ä»£ç æ–‡ä»¶</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.outputEntity(tableInfo, objectMap);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.outputMapper(tableInfo, objectMap);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.outputService(tableInfo, objectMap);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.outputController(tableInfo, objectMap);
 Â  Â  Â  Â  Â   });
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
 Â  Â  Â   } <span class="hljs-keyword">catch</span> (Exception e) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> new RuntimeException(<span class="hljs-string">"æ— æ³•åˆ›å»ºæ–‡ä»¶ï¼Œè¯·æ£€æŸ¥é…ç½®ä¿¡æ¯ï¼"</span>, e);
 Â  Â  Â   }
 Â   }
â€‹
</code></pre>
<h2 data-id="heading-15">6.æ€»ç»“</h2>
<p>MyBatis-Plusä»£ç ç”Ÿæˆå™¨ä½œä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ã€æ‰©å±•æ€§æä½³çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œé€šè¿‡åˆç†çš„é…ç½®ç­–ç•¥å’Œçµæ´»çš„è‡ªå®šä¹‰æ¨¡æ¿ï¼Œèƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°é¡¹ç›®çš„ä»£ç ç”Ÿæˆéœ€æ±‚ã€‚æ·±å…¥ç†è§£å…¶åº•å±‚åŸç†å¹¶æŒæ¡é«˜çº§åº”ç”¨æŠ€å·§ï¼Œä¸ä»…èƒ½å¤§å¹…æå‡å¼€å‘æ•ˆç‡ï¼Œæ›´èƒ½ç¡®ä¿å›¢é˜Ÿä»£ç çš„è§„èŒƒæ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºåç«¯å¼€å‘è€…è€Œè¨€ï¼Œå®šåˆ¶ç¬¦åˆå›¢é˜Ÿè§„èŒƒçš„ä»£ç ç”Ÿæˆæ–¹æ¡ˆï¼Œä¸»è¦æœ‰ä¸¤ç§å®è·µè·¯å¾„ï¼š</p>
<p><strong>ğŸ“¦ æ–¹æ¡ˆä¸€ï¼šSpring Bootæ·±åº¦é›†æˆ</strong></p>
<ul>
<li>å°†ç”Ÿæˆç­–ç•¥å°è£…ä¸ºé…ç½®æ–‡ä»¶ï¼Œä¸é¡¹ç›®æ— ç¼é›†æˆ</li>
<li>æ”¯æŒä¸€é”®ç”Ÿæˆä»£ç åˆ°æŒ‡å®šé¡¹ç›®ç›®å½•</li>
<li>å¯è¿›ä¸€æ­¥å°è£…ä¸ºStarterï¼Œå®ç°å›¢é˜Ÿçº§æ ‡å‡†åŒ–</li>
</ul>
<p><strong>ğŸ”§ æ–¹æ¡ˆäºŒï¼šå·¥å…·ç±»çµæ´»å®šåˆ¶</strong></p>
<ul>
<li>æä¾›é«˜åº¦å¯é…ç½®çš„ä»£ç ç”Ÿæˆå·¥å…·ç±»</li>
<li>æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è§„åˆ™è®¾ç½®</li>
<li>æ›´é€‚åˆå¤šé¡¹ç›®ã€å·®å¼‚åŒ–çš„ç”Ÿæˆéœ€æ±‚</li>
</ul>
<p><strong>ğŸ’¡ é‡è¦æé†’</strong></p>
<p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œæœ¬æ–‡æ—¨åœ¨ç³»ç»Ÿä»‹ç»MyBatis-Plusä»£ç ç”Ÿæˆå™¨çš„æŠ€æœ¯å®ç°ä¸æœ€ä½³å®è·µï¼Œå¹¶éé¼“åŠ±ç›²ç›®ä¾èµ–ä»£ç ç”Ÿæˆã€‚åœ¨å®é™…é¡¹ç›®ä¸­æ˜¯å¦é‡‡ç”¨ã€å¦‚ä½•é‡‡ç”¨ï¼Œè¿˜éœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡åœºæ™¯ã€å›¢é˜Ÿè§„èŒƒå’ŒæŠ€æœ¯æ¶æ„æ¥å®¡æ…å†³ç­–ã€‚</p>
<p><strong>å…³é”®åœ¨äº</strong>ï¼šå·¥å…·æ˜¯ä¸ºäº†æå‡æ•ˆç‡ï¼Œè€Œå¥½çš„ä»£ç æ›´éœ€è¦å¼€å‘è€…çš„è®¾è®¡æ€ç»´å’Œä¸šåŠ¡ç†è§£ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ åšå‡ºæ›´æ˜æ™ºçš„æŠ€æœ¯é€‰å‹ï¼</p>
<hr/>
<p><strong>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨ç»éªŒï¼å¦‚æœä½ æœ‰æ›´å¥½çš„å®šåˆ¶æ–¹æ¡ˆï¼Œä¹ŸæœŸå¾…ä¸€èµ·äº¤æµæ¢è®¨~</strong></p>
<p><em>è§‰å¾—æ–‡ç« æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘æ”¯æŒï½</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PromiseResolveThenableJobTask å¾®ä»»åŠ¡æ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„]]></title>    <link>https://juejin.cn/post/7579450578293719082</link>    <guid>https://juejin.cn/post/7579450578293719082</guid>    <pubDate>2025-12-03T11:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579450578293719082" data-draft-id="7578582010417020934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PromiseResolveThenableJobTask å¾®ä»»åŠ¡æ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T11:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹‹æ’å›"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PromiseResolveThenableJobTask å¾®ä»»åŠ¡æ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹‹æ’å›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:11:18.000Z" title="Wed Dec 03 2025 11:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"â€¢";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h3 data-id="heading-0">èƒŒæ™¯</h3>
<p>è¦ç†è§£Â <code>NewPromiseResolveThenableJobTask</code>Â è¿™ä¸ªå¾®ä»»åŠ¡çš„ä½œç”¨ï¼Œéœ€è¦å…ˆå›åˆ°å®ƒçš„<strong>åˆ›å»ºåœºæ™¯</strong>ï¼šå½“ä¸€ä¸ª Promise çš„Â <code>then</code>Â å›è°ƒï¼ˆæˆ–å…¶ä»– Promise ç›¸å…³å›è°ƒï¼‰è¿”å›äº†ä¸€ä¸ª <strong>å¯ thenable å¯¹è±¡</strong>ï¼ˆé€šå¸¸æ˜¯å¦ä¸€ä¸ª Promiseï¼Œä½†ä¹ŸåŒ…æ‹¬è‡ªå®šä¹‰çš„ã€æœ‰Â <code>then</code>Â æ–¹æ³•çš„å¯¹è±¡ï¼‰æ—¶ï¼ŒJS å¼•æ“ä¼šåˆ›å»ºè¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæœ¬è´¨æ˜¯ä¸ºäº† <strong>ç¡®ä¿ â€œè¿”å›çš„ thenable å¯¹è±¡â€ çš„çŠ¶æ€å®Œå…¨ç¡®å®šåï¼Œå†ç»§ç»­æ‰§è¡Œåç»­çš„ Promise é“¾</strong>ã€‚</p>
<p>å¦‚ä¸‹ä»£ç ï¼Œåç»­è®¨è®ºä¾æ‰˜äºæ­¤æ®µä»£ç å±•å¼€ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>() 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>); 
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>); 
}) 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); 
});
</code></pre>
<h3 data-id="heading-1">å…ˆæ˜ç¡®å‰æï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå¾®ä»»åŠ¡ï¼Ÿ</h3>
<p>Promise é“¾çš„æ ¸å¿ƒè§„åˆ™æ˜¯ â€œ<strong>åç»­çš„ then å›è°ƒï¼Œå¿…é¡»ç­‰å¾…å‰ä¸€ä¸ª then å›è°ƒçš„ â€œè¿”å›å€¼â€ çŠ¶æ€ç¡®å®šåæ‰æ‰§è¡Œ</strong>â€ã€‚å¦‚æœå‰ä¸€ä¸ª then å›è°ƒè¿”å›çš„æ˜¯ä¸€ä¸ª<strong>æ™®é€šå€¼</strong>ï¼ˆæ¯”å¦‚ 4ã€'a'ï¼‰ï¼Œé‚£å¾ˆç®€å•ï¼šç›´æ¥æŠŠè¿™ä¸ªæ™®é€šå€¼ä½œä¸ºä¸‹ä¸€ä¸ª Promise çš„ â€œæˆåŠŸå€¼â€ï¼Œç«‹åˆ»è§¦å‘ä¸‹ä¸€ä¸ª then çš„å¾®ä»»åŠ¡ã€‚</p>
<p>ä½†å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ª<strong>Promiseï¼ˆæˆ–å¯ thenable å¯¹è±¡ï¼‰</strong> ï¼ˆæ¯”å¦‚ä»£ç ä¸­Â <code>return Promise.resolve(4)</code>ï¼‰ï¼Œæƒ…å†µå°±å¤æ‚äº†ï¼šè¿™ä¸ªè¿”å›çš„ Promise æœ¬èº«æ˜¯ â€œå¼‚æ­¥çŠ¶æ€â€ï¼ˆå³ä½¿æ˜¯Â <code>Promise.resolve(4)</code>Â è¿™ç§ â€œç«‹å³æˆåŠŸâ€ çš„ï¼Œä¹Ÿä¸æ˜¯åŒæ­¥æ‰§è¡Œï¼‰ï¼Œ<strong>å¿…é¡»ç­‰å¾…å®ƒçš„Â <code>then</code>Â å›è°ƒæ‰§è¡Œå®Œï¼ˆçŠ¶æ€å®Œå…¨ç¡®å®šï¼‰ï¼Œæ‰èƒ½æŠŠå®ƒçš„ç»“æœä¼ ç»™ä¸‹ä¸€ä¸ª then</strong>ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œ<code>NewPromiseResolveThenableJobTask</code>Â å°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ª â€œ<strong>ç­‰å¾…å¹¶ä¼ é€’ç»“æœ</strong>â€ çš„æ´»çš„ã€‚</p>
<h3 data-id="heading-2"><code>NewPromiseResolveThenableJobTask</code>Â å¾®ä»»åŠ¡å…·ä½“åšä»€ä¹ˆï¼Ÿ</h3>
<p>å®ƒçš„æ‰§è¡Œé€»è¾‘å¯ä»¥æ‹†è§£ä¸º 3 ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼Œæœ¬è´¨æ˜¯ â€œ<strong>ä»£ç†æ‰§è¡Œè¿”å›çš„ thenable å¯¹è±¡çš„ then æ–¹æ³•ï¼Œå¹¶æŠŠç»“æœåŒæ­¥ç»™å½“å‰ Promise é“¾</strong>â€ï¼š</p>
<h4 data-id="heading-3">1. å…ˆæ˜ç¡®è¿™ä¸ªå¾®ä»»åŠ¡çš„ â€œ3 ä¸ªè¾“å…¥å‚æ•°â€</h4>
<p>åœ¨åˆ›å»ºè¿™ä¸ªå¾®ä»»åŠ¡æ—¶ï¼Œå¼•æ“ä¼šä¼ å…¥ 3 ä¸ªå…³é”®ä¿¡æ¯ï¼ˆå¯¹åº” ECMA è§„èŒƒçš„å®šä¹‰: <a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2Fmultipage%2Fcontrol-abstraction-objects.html%23sec-newpromiseresolvethenablejob" target="_blank" title="https://tc39.es/ecma262/multipage/control-abstraction-objects.html#sec-newpromiseresolvethenablejob" ref="nofollow noopener noreferrer">#sec-newpromiserelovethenablejobtask</a>ï¼‰ï¼š</p>
<ul>
<li><code>promiseToResolve</code>ï¼šå½“å‰ Promise é“¾ä¸­çš„ â€œä¸­é—´ Promiseâ€ï¼ˆå³å‰ä¸€ä¸ªÂ <code>then</code>Â æ‰§è¡Œåè¿”å›çš„æ–° Promiseï¼Œåç»­çš„Â <code>then</code>Â éƒ½æ˜¯æŒ‚åœ¨è¿™ä¸ª Promise ä¸Šçš„ï¼‰ã€‚</li>
<li><code>thenable</code>ï¼šå‰ä¸€ä¸ªÂ <code>then</code>Â å›è°ƒè¿”å›çš„ â€œå¯ thenable å¯¹è±¡â€ï¼ˆæ¯”å¦‚ä»£ç ä¸­Â <code>return Promise.resolve(4)</code>Â é‡Œçš„è¿™ä¸ª Promiseï¼‰ã€‚</li>
<li><code>then</code>ï¼š<code>thenable</code>Â å¯¹è±¡è‡ªèº«çš„Â <code>then</code>Â æ–¹æ³•ï¼ˆæ¯”å¦‚ Promise åŸå‹ä¸Šçš„Â <code>Promise.prototype.then</code>ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> promiseToResolve = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { 
        <span class="hljs-keyword">return</span> [[thenable å¯¹è±¡]]: { 
            [[then æ–¹æ³•]]: <span class="hljs-function">(<span class="hljs-params">onFulfilled, onRejected</span>) =&gt;</span> {}
        }
     })
</code></pre>
<h4 data-id="heading-4">2. å¾®ä»»åŠ¡æ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘</h4>
<p>å½“è¿™ä¸ªå¾®ä»»åŠ¡è¢«æ‰§è¡Œæ—¶ï¼Œä¼šå¹²ä¸¤ä»¶å…³é”®çš„äº‹ï¼š</p>
<h5 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨Â <code>thenable</code>Â çš„Â <code>then</code>Â æ–¹æ³•ï¼Œç»‘å®š â€œç»“æœä¼ é€’å›è°ƒâ€</h5>
<p>å¾®ä»»åŠ¡ä¼šä¸»åŠ¨è°ƒç”¨Â <code>thenable.then(...)</code>ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼ˆç›¸å½“äº â€œä»£ç†å›è°ƒâ€ï¼‰ï¼š</p>
<ul>
<li>æˆåŠŸå›è°ƒï¼ˆ<code>onFulfilled</code>ï¼‰ï¼šå¦‚æœÂ <code>thenable</code>Â æˆåŠŸï¼ˆæ¯”å¦‚Â <code>Promise.resolve(4)</code>Â æˆåŠŸï¼‰ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªå›è°ƒï¼ŒæŠŠÂ <code>thenable</code>Â çš„æˆåŠŸå€¼ï¼ˆæ¯”å¦‚ 4ï¼‰ä¼ ç»™Â <code>promiseToResolve</code>ï¼Œè®©Â <code>promiseToResolve</code>Â ä¹Ÿå˜æˆ â€œæˆåŠŸçŠ¶æ€â€ï¼Œå¹¶æŠŠ 4 ä½œä¸ºå®ƒçš„æˆåŠŸå€¼ã€‚</li>
<li>å¤±è´¥å›è°ƒï¼ˆ<code>onRejected</code>ï¼‰ï¼šå¦‚æœÂ <code>thenable</code>Â å¤±è´¥ï¼ˆæ¯”å¦‚Â <code>Promise.reject(5)</code>ï¼‰ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªå›è°ƒï¼ŒæŠŠÂ <code>thenable</code>Â çš„å¤±è´¥åŸå› ä¼ ç»™Â <code>promiseToResolve</code>ï¼Œè®©Â <code>promiseToResolve</code>Â å˜æˆ â€œå¤±è´¥çŠ¶æ€â€ã€‚</li>
</ul>
<h5 data-id="heading-6">ç¬¬äºŒæ­¥ï¼šè§¦å‘åç»­çš„ Promise é“¾</h5>
<p>ä¸€æ—¦Â <code>promiseToResolve</code>Â çš„çŠ¶æ€è¢«ç¡®å®šï¼ˆæˆåŠŸ / å¤±è´¥ï¼‰ï¼Œå¼•æ“å°±ä¼šä¸ºÂ <code>promiseToResolve</code>Â ä¸ŠæŒ‚è½½çš„åç»­Â <code>then</code>Â å›è°ƒï¼ˆæ¯”å¦‚ä»£ç ä¸­ç¬¬äºŒä¸ªÂ <code>then((res) =&gt; console.log(res))</code>ï¼‰åˆ›å»ºæ–°çš„å¾®ä»»åŠ¡ï¼ŒæŠŠåˆšæ‰ä¼ é€’è¿‡æ¥çš„ç»“æœï¼ˆæ¯”å¦‚ 4ï¼‰ä¼ ç»™è¿™ä¸ªåç»­å›è°ƒï¼Œè®© Promise é“¾ç»§ç»­æ‰§è¡Œã€‚</p>
<h3 data-id="heading-7">ç»“åˆä»£ç ï¼Œçœ‹è¿™ä¸ªå¾®ä»»åŠ¡çš„å…·ä½“ä½œç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>() <span class="hljs-comment">// 1. åˆå§‹ Promiseï¼ˆæˆåŠŸçŠ¶æ€ï¼Œå€¼ä¸º undefinedï¼‰</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 2. ç¬¬ä¸€ä¸ª then å›è°ƒï¼ˆcb1ï¼‰</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 3. åŒæ­¥æ‰“å° 0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// 4. è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼ˆè®°ä¸º P4ï¼‰</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { <span class="hljs-comment">// 5. ç¬¬äºŒä¸ª then å›è°ƒï¼ˆcb2ï¼ŒæŒ‚åœ¨ â€œä¸­é—´ Promiseâ€:P_mid ä¸Šï¼‰</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 6. æœ€ç»ˆæ‰“å° 4</span>
  });
</code></pre>
<p>è¿™é‡ŒÂ <code>NewPromiseResolveThenableJobTask</code>Â çš„æ‰§è¡Œè¿‡ç¨‹å®Œå…¨è´´åˆä¸Šé¢çš„é€»è¾‘ï¼š</p>
<ol>
<li>
<p>æ‰§è¡ŒÂ <code>cb1</code>Â æ—¶ï¼Œè¿”å›äº†Â <code>Promise.resolve(4)</code>ï¼ˆå³Â <code>thenable = P4</code>ï¼‰ï¼Œå¼•æ“åˆ›å»ºÂ <code>NewPromiseResolveThenableJobTask</code>Â å¾®ä»»åŠ¡ï¼Œä¼ å…¥ï¼š</p>
<ul>
<li><code>promiseToResolve = P_mid</code>ï¼ˆç¬¬ä¸€ä¸ª then è¿”å›çš„ä¸­é—´ Promiseï¼Œcb2 æŒ‚åœ¨å®ƒä¸Šé¢ï¼‰</li>
<li><code>thenable = P4</code></li>
<li><code>then = P4.then</code>ï¼ˆå³ Promise åŸå‹çš„ then æ–¹æ³•ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>å½“è¿™ä¸ªå¾®ä»»åŠ¡æ‰§è¡Œæ—¶ï¼š</p>
<ul>
<li>è°ƒç”¨Â <code>P4.then(æˆåŠŸå›è°ƒ, å¤±è´¥å›è°ƒ)</code>ï¼šå› ä¸ºÂ <code>P4</code>Â æ˜¯Â <code>Promise.resolve(4)</code>ï¼ˆå·²æˆåŠŸï¼‰ï¼Œè§¦å‘ <code>PromiseResolveThenableJobTask</code>çš„æ‰§è¡Œæµç¨‹ï¼ˆé‡ç‚¹ï¼‰ã€‚</li>
<li>â€œæˆåŠŸå›è°ƒâ€ æŠŠÂ <code>4</code>Â ä¼ ç»™Â <code>P_mid</code>ï¼Œè®©Â <code>P_mid</code>Â å˜æˆ â€œæˆåŠŸçŠ¶æ€â€ï¼Œå€¼ä¸º 4ã€‚</li>
<li>å¼•æ“ä¸ºÂ <code>P_mid</code>Â ä¸Šçš„Â <code>cb2</code>Â åˆ›å»ºæ–°å¾®ä»»åŠ¡ï¼Œåç»­æ‰§è¡Œè¿™ä¸ªå¾®ä»»åŠ¡æ—¶ï¼Œå°±ä¼šæŠŠÂ <code>4</code>Â ä¼ ç»™Â <code>cb2</code>ï¼Œæ‰“å°å‡ºÂ <code>4</code>ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">é‡ç‚¹æ ¸å¿ƒ(<code>PromiseResolveThenableJobTask</code>è¢«æ‰§è¡Œ)ï¼š</h3>
<p><code>PromiseResolveThenableJobTask</code> çš„è¢«æ‰§è¡Œè¿‡ç¨‹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-promiseresolvethenablejob" target="_blank" title="https://tc39.es/ecma262/#sec-promiseresolvethenablejob" ref="nofollow noopener noreferrer">esma è§„èŒƒ</a> çš„æè¿°</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e37d6ffb8944eb187e2556ba66f587a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=KUVzZExvKAonI9q7VjsNpAKvsvE%3D" alt="image.png" loading="lazy"/></p>
<p><em>å…¶å®å®ƒè§„å®šäº†è¿™ä¸ª <code>PromiseResolveThenableJobTask</code> è¦ä½œä¸ºå¼‚æ­¥ä»»åŠ¡å»æ‰§è¡Œï¼ˆåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼›</em></p>
<p><em>å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-resolve.tq%23177" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-resolve.tq#177" ref="nofollow noopener noreferrer">v8::builtins::promise-resolve.tq</a> çš„å¤„ç†æ˜¯ä¸€æ ·çš„ã€‚v8 æŠŠ å®ƒåŠ å…¥äº† å¾®ä»»åŠ¡é˜Ÿåˆ—</em></p>
<p>ä½†æ˜¯ï¼Œè¿™ä¸ªä»»åŠ¡åç»­çš„è¢«æ‰§è¡Œï¼Œå°±æ²¡æœ‰è¯´äº†ï¼Œè§„èŒƒä¸Šæˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ï¼›</p>
<p>ä½†æ˜¯ï¼Œçœ‹äº† <code>PromiseResolveThenableJobTask</code> çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-jobs.tq%2328" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-jobs.tq#28" ref="nofollow noopener noreferrer">v8 å…·ä½“å®ç°</a>,
å®ƒåˆ†äº†ä¸¤ç§æƒ…å†µæ¥å¤„ç†çš„ï¼š</p>
<ol>
<li><code>thenableå¯¹è±¡</code> æ˜¯ <code>Promiseå¯¹è±¡</code>æ—¶ï¼›æ‰§è¡Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-abstract-operations.tq%23508" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-abstract-operations.tq#508" ref="nofollow noopener noreferrer">PerformPromiseThen</a>çš„å®ç°æ–¹å¼ï¼›
<ul>
<li>å¦‚æœ promise æ˜¯ <code>pendding</code> æ€ï¼Œä¼šåˆ›å»ºä¸€ä¸ª <code>NewPromiseReaction</code> ä»»åŠ¡ï¼Œ ç­‰å¾… promise å…‘ç°ï¼›</li>
<li>å¦‚æœ promise æ˜¯ <code>fulfiled</code>|<code>rejected</code>, åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå¾®ä»»åŠ¡ï¼ŒåŠ å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰å¾…æ‰§è¡Œï¼›</li>
</ul>
</li>
<li><code>thenableå¯¹è±¡</code> æ˜¯ <code>éPromise å¯¹è±¡</code>æ—¶ï¼›ç›´æ¥èµ° resolve function é€»è¾‘ï¼›
<ul>
<li>ç›´æ¥è°ƒç”¨ resolve(ç»“æœ)ï¼Œå…‘ç° promise;</li>
</ul>
</li>
</ol>
<p>å¦‚å›¾(<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-jobs.tq%2328" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-jobs.tq#28" ref="nofollow noopener noreferrer"><code>PromiseResolveThenableJob</code></a>):</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12cbf9ca5ea44c9f9a41933e9d670198~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=F27dN0gDrw%2FidAUbTdwGNqQnPW0%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚å›¾ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-abstract-operations.tq%23451" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-abstract-operations.tq#451" ref="nofollow noopener noreferrer"><code>PerformPromiseThenImpl</code></a>ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0e5699cb6846e692ba2554f4123b48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=0G%2BZ4AM5goEztVrqTjgVpDH2aGw%3D" alt="image.png" loading="lazy"/></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¸‹ä¸¤æ®µä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });
  
<span class="hljs-comment">// è¾“å‡ºï¼š0,1,2,3,4,5 </span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
        <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-number">4</span>);
      },
    };
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });

<span class="hljs-comment">// è¾“å‡ºï¼š0,1,2,4,3,5</span>

</code></pre>
<h3 data-id="heading-9">ä¸€å¥è¯æ€»ç»“</h3>
<p><code>NewPromiseResolveThenableJobTask</code>Â å°±æ˜¯ä¸€ä¸ª â€œ<strong>ç»“æœä¼ é€’ä»£ç†å¾®ä»»åŠ¡</strong>â€ï¼šä¸“é—¨å¤„ç† â€œthen å›è°ƒè¿”å› thenable å¯¹è±¡â€ çš„åœºæ™¯ï¼Œç¡®ä¿è¿™ä¸ª thenable å¯¹è±¡çš„çŠ¶æ€ç¡®å®šåï¼ŒæŠŠå®ƒçš„ç»“æœåŒæ­¥ç»™å½“å‰ Promise é“¾çš„ä¸­é—´ Promiseï¼Œå†è§¦å‘åç»­çš„ then å›è°ƒï¼Œä¿è¯ Promise é“¾çš„é¡ºåºå’ŒçŠ¶æ€æ­£ç¡®æ€§ã€‚</p>
<p><strong>æ³¨æ„çš„ç‚¹æ˜¯ï¼š</strong></p>
<p>thenableå¯¹è±¡æ˜¯ Promiseå¯¹è±¡ å’Œ æ™®é€šåŒ…å«å®ç° then æ–¹æ³•çš„å¯¹è±¡ï¼Œ<code>PromiseResolveThenableJobTask</code> çš„å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼›</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2ç®€å•å®ç°ä¸€ä¸ªæƒé™ç®¡ç†]]></title>    <link>https://juejin.cn/post/7579264485259575311</link>    <guid>https://juejin.cn/post/7579264485259575311</guid>    <pubDate>2025-12-03T12:12:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259575311" data-draft-id="7579088065697447976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2ç®€å•å®ç°ä¸€ä¸ªæƒé™ç®¡ç†"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-03T12:12:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2ç®€å•å®ç°ä¸€ä¸ªæƒé™ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T12:12:53.000Z" title="Wed Dec 03 2025 12:12:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>ä»¥ä¸‹æ˜¯åŸºäº Vue2 å®ç°çš„<strong>åŸºç¡€æƒé™ç®¡ç†æ–¹æ¡ˆ</strong>ï¼Œæ¶µç›–<strong>è·¯ç”±æƒé™æ§åˆ¶ã€æŒ‰é’®æƒé™æ§åˆ¶ã€æŒ‡ä»¤å°è£…</strong>ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œé€‚åˆä¸­å°å‹åå°ç³»ç»Ÿï¼š</p>
<h3 data-id="heading-0">ä¸€ã€æƒé™æ•°æ®è®¾è®¡</h3>
<p>é¦–å…ˆå®šä¹‰ç”¨æˆ·æƒé™ç»“æ„ï¼ˆé€šå¸¸ä»åç«¯æ¥å£è·å–ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/store/modules/auth.js</span>
<span class="hljs-keyword">const</span> state = {
  <span class="hljs-comment">// ç”¨æˆ·è§’è‰²ï¼ˆå¦‚ ['admin', 'editor']ï¼‰</span>
  <span class="hljs-attr">roles</span>: [],
  <span class="hljs-comment">// ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ç ï¼ˆå¦‚ ['user:add', 'user:edit']ï¼‰</span>
  <span class="hljs-attr">permissions</span>: []
};

<span class="hljs-keyword">const</span> mutations = {
  <span class="hljs-title function_">SET_ROLES</span>(<span class="hljs-params">state, roles</span>) {
    state.<span class="hljs-property">roles</span> = roles;
  },
  <span class="hljs-title function_">SET_PERMISSIONS</span>(<span class="hljs-params">state, permissions</span>) {
    state.<span class="hljs-property">permissions</span> = permissions;
  }
};

<span class="hljs-keyword">const</span> actions = {
  <span class="hljs-comment">// æ¨¡æ‹Ÿä»åç«¯è·å–æƒé™ï¼ˆå®é™…é¡¹ç›®ä¸­æ›¿æ¢ä¸ºæ¥å£è¯·æ±‚ï¼‰</span>
  <span class="hljs-title function_">getAuth</span>(<span class="hljs-params">{ commit }</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-comment">// å‡è®¾åç«¯è¿”å›çš„æƒé™æ•°æ®</span>
      <span class="hljs-keyword">const</span> authData = {
        <span class="hljs-attr">roles</span>: [<span class="hljs-string">'editor'</span>],
        <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'dashboard:view'</span>, <span class="hljs-string">'user:view'</span>, <span class="hljs-string">'user:edit'</span>]
      };
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'SET_ROLES'</span>, authData.<span class="hljs-property">roles</span>);
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'SET_PERMISSIONS'</span>, authData.<span class="hljs-property">permissions</span>);
      <span class="hljs-title function_">resolve</span>();
    });
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,
  state,
  mutations,
  actions
};
</code></pre>
<h3 data-id="heading-1">äºŒã€è·¯ç”±æƒé™æ§åˆ¶</h3>
<p>é€šè¿‡<strong>è·¯ç”±å®ˆå«</strong>è¿‡æ»¤æ— æƒé™çš„è·¯ç”±ï¼Œç»“åˆ<code>VueRouter</code>çš„åŠ¨æ€è·¯ç”±æ·»åŠ ï¼š</p>
<h4 data-id="heading-2">1. å®šä¹‰è·¯ç”±è§„åˆ™ï¼ˆåŒºåˆ†å…¬å¼€ / ç§æœ‰è·¯ç”±ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/router/index.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;

<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Router</span>);

<span class="hljs-comment">// å…¬å¼€è·¯ç”±ï¼ˆæ— éœ€æƒé™ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/login'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/404'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/404'</span>)
  }
];

<span class="hljs-comment">// ç§æœ‰è·¯ç”±ï¼ˆéœ€æƒé™ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> asyncRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/layout'</span>),
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'dashboard'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/dashboard'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'é¦–é¡µ'</span>, 
          <span class="hljs-attr">roles</span>: [<span class="hljs-string">'admin'</span>, <span class="hljs-string">'editor'</span>], <span class="hljs-comment">// éœ€è¦çš„è§’è‰²</span>
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'dashboard:view'</span>] <span class="hljs-comment">// éœ€è¦çš„æƒé™ç </span>
        }
      }
    ]
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/layout'</span>),
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'list'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/list'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'ç”¨æˆ·åˆ—è¡¨'</span>, 
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'user:view'</span>] 
        }
      },
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'edit/:id'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/edit'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'ç¼–è¾‘ç”¨æˆ·'</span>, 
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'user:edit'</span>] 
        }
      }
    ]
  },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'*'</span>, <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/404'</span>, <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> }
];

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createRouter</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>({
  <span class="hljs-attr">routes</span>: constantRoutes
});

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>();

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<h4 data-id="heading-3">2. è·¯ç”±å®ˆå«å®ç°æƒé™è¿‡æ»¤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/permission.js</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>;
<span class="hljs-keyword">import</span> { asyncRoutes, constantRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;

<span class="hljs-comment">// æƒé™åˆ¤æ–­å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦æœ‰è§’è‰²/æƒé™</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">hasPermission</span>(<span class="hljs-params">roles, permissions, route</span>) {
  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>) {
    <span class="hljs-comment">// è§’è‰²æ ¡éªŒ</span>
    <span class="hljs-keyword">return</span> roles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>.<span class="hljs-title function_">includes</span>(role));
  }
  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">permissions</span>) {
    <span class="hljs-comment">// æƒé™ç æ ¡éªŒ</span>
    <span class="hljs-keyword">return</span> permissions.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">perm</span> =&gt;</span> route.<span class="hljs-property">meta</span>.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">includes</span>(perm));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ— æƒé™é…ç½®åˆ™é»˜è®¤å¯è§</span>
}

<span class="hljs-comment">// è¿‡æ»¤ç§æœ‰è·¯ç”±</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">filterAsyncRoutes</span>(<span class="hljs-params">routes, roles, permissions</span>) {
  <span class="hljs-keyword">const</span> res = [];
  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> tmp = { ...route };
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasPermission</span>(roles, permissions, tmp)) {
      <span class="hljs-keyword">if</span> (tmp.<span class="hljs-property">children</span>) {
        tmp.<span class="hljs-property">children</span> = <span class="hljs-title function_">filterAsyncRoutes</span>(tmp.<span class="hljs-property">children</span>, roles, permissions);
      }
      res.<span class="hljs-title function_">push</span>(tmp);
    }
  });
  <span class="hljs-keyword">return</span> res;
}

router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; {
  <span class="hljs-comment">// æ¨¡æ‹Ÿå·²ç™»å½•ï¼ˆå®é™…é¡¹ç›®ä¸­ç”¨tokenåˆ¤æ–­ï¼‰</span>
  <span class="hljs-keyword">const</span> hasToken = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (hasToken) {
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">'/login'</span>) {
      <span class="hljs-title function_">next</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span> });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²è·å–æƒé™</span>
      <span class="hljs-keyword">const</span> hasRoles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>].<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (hasRoles) {
        <span class="hljs-title function_">next</span>();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// è·å–æƒé™æ•°æ®</span>
          <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'auth/getAuth'</span>);
          <span class="hljs-keyword">const</span> roles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>];
          <span class="hljs-keyword">const</span> permissions = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/permissions'</span>];
          <span class="hljs-comment">// è¿‡æ»¤å¹¶æ·»åŠ åŠ¨æ€è·¯ç”±</span>
          <span class="hljs-keyword">const</span> accessedRoutes = <span class="hljs-title function_">filterAsyncRoutes</span>(asyncRoutes, roles, permissions);
          router.<span class="hljs-title function_">addRoutes</span>(accessedRoutes);
          <span class="hljs-comment">// ç¡®ä¿è·¯ç”±æ·»åŠ å®Œæˆåè·³è½¬</span>
          <span class="hljs-title function_">next</span>({ ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> });
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
        }
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æœªç™»å½•åˆ™è·³è½¬ç™»å½•é¡µ</span>
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">'/login'</span>) {
      <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
    }
  }
});
</code></pre>
<h3 data-id="heading-4">ä¸‰ã€æŒ‰é’®æƒé™æ§åˆ¶</h3>
<p>é€šè¿‡<strong>è‡ªå®šä¹‰æŒ‡ä»¤</strong>å®ç°æŒ‰é’®çº§åˆ«çš„æƒé™æ§åˆ¶ï¼š</p>
<h4 data-id="heading-5">1. æ³¨å†Œæƒé™æŒ‡ä»¤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/directives/permission.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;

<span class="hljs-comment">/**
 * v-permission: æŒ‰é’®æƒé™æŒ‡ä»¤
 * ä½¿ç”¨ï¼š&lt;button v-permission="'user:add'"&gt;æ–°å¢&lt;/button&gt;
 */</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'permission'</span>, {
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value } = binding;
    <span class="hljs-keyword">const</span> permissions = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/permissions'</span>];
    <span class="hljs-comment">// æ ¡éªŒæƒé™ï¼ˆæ”¯æŒæ•°ç»„ï¼šv-permission="['user:add', 'user:edit']"ï¼‰</span>
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-keyword">const</span> hasPerm = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) 
        ? permissions.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">perm</span> =&gt;</span> value.<span class="hljs-title function_">includes</span>(perm)) 
        : permissions.<span class="hljs-title function_">includes</span>(value);
      <span class="hljs-keyword">if</span> (!hasPerm) {
        el.<span class="hljs-property">parentNode</span> &amp;&amp; el.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(el); <span class="hljs-comment">// æ— æƒé™åˆ™ç§»é™¤å…ƒç´ </span>
      }
    }
  }
});

<span class="hljs-comment">/**
 * v-role: è§’è‰²æƒé™æŒ‡ä»¤
 * ä½¿ç”¨ï¼š&lt;button v-role="'admin'"&gt;ç®¡ç†å‘˜æŒ‰é’®&lt;/button&gt;
 */</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'role'</span>, {
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value } = binding;
    <span class="hljs-keyword">const</span> roles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>];
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-keyword">const</span> hasRole = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) 
        ? roles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> value.<span class="hljs-title function_">includes</span>(role)) 
        : roles.<span class="hljs-title function_">includes</span>(value);
      <span class="hljs-keyword">if</span> (!hasRole) {
        el.<span class="hljs-property">parentNode</span> &amp;&amp; el.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(el);
      }
    }
  }
});
</code></pre>
<h4 data-id="heading-6">2. å…¨å±€å¼•å…¥æŒ‡ä»¤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/main.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./directives/permission'</span>; <span class="hljs-comment">// å¼•å…¥æƒé™æŒ‡ä»¤</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,
  store,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
}).$mount(<span class="hljs-string">'#app'</span>);
</code></pre>
<h3 data-id="heading-7">å››ã€é¡µé¢ä¸­ä½¿ç”¨æƒé™æ§åˆ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript">&lt;!-- src/views/user/list.<span class="hljs-property">vue</span> --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç”¨æˆ·åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- æŒ‰é’®æƒé™æ§åˆ¶ï¼šåªæœ‰user:addæƒé™æ‰æ˜¾ç¤º --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"'user:add'"</span>&gt;</span>æ–°å¢ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- è§’è‰²æ§åˆ¶ï¼šåªæœ‰adminè§’è‰²æ‰æ˜¾ç¤º --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-role</span>=<span class="hljs-string">"'admin'"</span>&gt;</span>åˆ é™¤ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- è¡¨æ ¼å†…å®¹ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"userList"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ“ä½œ"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"scope"</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- ç¼–è¾‘æƒé™æ§åˆ¶ --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"'user:edit'"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"editUser(scope.row)"</span>&gt;</span>ç¼–è¾‘<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-8">äº”ã€æ ¸å¿ƒåŠŸèƒ½æ€»ç»“</h3>
<ol>
<li><strong>è·¯ç”±æƒé™</strong>ï¼šé€šè¿‡<code>router.addRoutes</code>åŠ¨æ€æ·»åŠ æœ‰æƒé™çš„è·¯ç”±ï¼Œç»“åˆ<code>beforeEach</code>å®ˆå«è¿‡æ»¤æ— æƒé™é¡µé¢ï¼›</li>
<li><strong>æŒ‰é’®æƒé™</strong>ï¼šè‡ªå®šä¹‰<code>v-permission</code>/<code>v-role</code>æŒ‡ä»¤ï¼Œæ— æƒé™æ—¶è‡ªåŠ¨ç§»é™¤ DOM å…ƒç´ ï¼›</li>
<li><strong>æƒé™å­˜å‚¨</strong>ï¼šé€šè¿‡ Vuex ç®¡ç†ç”¨æˆ·è§’è‰²å’Œæƒé™ç ï¼Œæ”¯æŒä»åç«¯åŠ¨æ€è·å–ã€‚</li>
</ol>
<h3 data-id="heading-9">æ‰©å±•å»ºè®®</h3>
<ul>
<li>å®é™…é¡¹ç›®ä¸­ï¼Œæƒé™æ•°æ®éœ€ä»åç«¯æ¥å£è·å–ï¼ˆå¦‚ç™»å½•åè¿”å›ï¼‰ï¼›</li>
<li>å¯ç»“åˆ<code>vue-i18n</code>å®ç°æƒé™ç›¸å…³æ–‡æ¡ˆçš„å›½é™…åŒ–ï¼›</li>
<li>å¤æ‚åœºæ™¯å¯å¢åŠ  â€œæ•°æ®æƒé™â€ï¼ˆå¦‚ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„æ•°æ®ï¼‰ï¼Œé€šè¿‡æ¥å£å‚æ•°è¿‡æ»¤ã€‚</li>
</ul>
<p>è¿™å¥—æ–¹æ¡ˆè½»é‡ä¸”æ˜“æ‰©å±•ï¼Œé€‚åˆ Vue2 é¡¹ç›®çš„åŸºç¡€æƒé™ç®¡ç†éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç³»ç»Ÿæ€§æ•´ç†ç»„ä»¶ä¼ å‚14ç§æ–¹å¼]]></title>    <link>https://juejin.cn/post/7579264485259591695</link>    <guid>https://juejin.cn/post/7579264485259591695</guid>    <pubDate>2025-12-03T12:15:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259591695" data-draft-id="7579385656780390434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç³»ç»Ÿæ€§æ•´ç†ç»„ä»¶ä¼ å‚14ç§æ–¹å¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T12:15:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹æ— æ­¢å¢ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/957017941879235"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç³»ç»Ÿæ€§æ•´ç†ç»„ä»¶ä¼ å‚14ç§æ–¹å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/957017941879235/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹æ— æ­¢å¢ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T12:15:03.000Z" title="Wed Dec 03 2025 12:15:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ ‡é¢˜å‰è¨€ï¼š</h2>
<p>åœ¨é¢è¯•æ—¶è¢«é—®åˆ°ç»„ä»¶ä¼ å‚çš„æ–¹å¼æ²¡æœ‰ç­”çš„å¾ˆå®Œæ•´å…¨é¢ï¼Œåœ¨ç»è¿‡å¾ˆå¤šé¢è¯•ä¹‹åå‘ç°ï¼Œé¢è¯•çš„å›ç­”å·²ç»ä¸åœ¨äºä½ æ˜¯å¦ç­”å‡ºæ¥ï¼Œæ›´é«˜çš„ä¸€ä¸ªlevelæ˜¯è¦ç­”å…¨ï¼Œç­”å‡ºå…¶ä»–é¢è¯•è€…ç­”ä¸å‡ºæ¥çš„ï¼Œå¾—æœ‰è‡ªå·±çš„ä¸€ä¸ªæ¡†æ¶ï¼Œäºæ˜¯ç³»ç»Ÿæ€§æ•´ç†äº†14ç§æ–¹å¼
<strong>ç³»ç»ŸåŒ–æ¢³ç†æ¯ä¸€ç§æ–¹å¼çš„åŸç†ã€ç”¨æ³•ã€é€‚ç”¨åœºæ™¯ã€ä¼˜ç¼ºç‚¹åŠæ³¨æ„äº‹é¡¹</strong>ï¼Œå¹¶æ ‡æ³¨å…¶åœ¨ <strong>Vue 2 vs Vue 3</strong> ä¸­çš„æ”¯æŒæƒ…å†µï¼Œå¸®åŠ©ä½ å…¨é¢æŒæ¡ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ“š Vue ç»„ä»¶ä¼ å‚ä¸é€šä¿¡æ–¹å¼å…¨è§£æï¼ˆ14 ç§ï¼‰</h2>
<blockquote>
<p>âœ… è¡¨ç¤ºæ¨è / å®‰å…¨<br/>
âš ï¸ è¡¨ç¤ºè°¨æ…ä½¿ç”¨<br/>
âŒ è¡¨ç¤ºå·²åºŸå¼ƒ / ä¸æ¨è</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">1. <strong>props</strong>ï¼ˆâœ… æ¨èï¼‰</h3>
<ul>
<li><strong>æ–¹å‘</strong>ï¼šçˆ¶ â†’ å­</li>
<li><strong>åŸç†</strong>ï¼šå£°æ˜å¼å±æ€§ä¼ é€’ï¼Œå•å‘æ•°æ®æµ</li>
<li><strong>Vue 2/3</strong>ï¼šâœ… å…¨æ”¯æŒ</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ --&gt;
&lt;Child :title="msg" /&gt;
&lt;!-- å­ --&gt;
defineProps({ title: String })
</code></pre>
</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ¸…æ™°ã€ç±»å‹å®‰å…¨ã€å¯é¢„æµ‹</li>
<li><strong>æ³¨æ„</strong>ï¼šä¸è¦ç›´æ¥ä¿®æ”¹ propï¼ˆVue ä¼šè­¦å‘Šï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. <strong>$emit / v-on</strong>ï¼ˆâœ… æ¨èï¼‰</h3>
<ul>
<li><strong>æ–¹å‘</strong>ï¼šå­ â†’ çˆ¶</li>
<li><strong>åŸç†</strong>ï¼šå­ç»„ä»¶è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶ç›‘å¬</li>
<li><strong>Vue 2</strong>ï¼š<code>this.$emit('event', data)</code></li>
<li><strong>Vue 3</strong>ï¼š<code>const emit = defineEmits(['event'])</code></li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å­ --&gt;
emit('update', newValue)
&lt;!-- çˆ¶ --&gt;
&lt;Child @update="handle" /&gt;
</code></pre>
</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè§£è€¦ã€ç¬¦åˆäº‹ä»¶é©±åŠ¨æ€æƒ³</li>
</ul>
<hr/>
<h3 data-id="heading-4">3. <strong>.sync ä¿®é¥°ç¬¦</strong>ï¼ˆâš ï¸ Vue 2 ä¸“ç”¨ï¼ŒVue 3 å·²ç§»é™¤ï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šè¯­æ³•ç³–ï¼Œç­‰ä»·äº <code>:prop + @update:prop</code></li>
<li><strong>Vue 2 ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-vue" lang="vue">&lt;Child :title.sync="pageTitle" /&gt;
&lt;!-- å­ç»„ä»¶éœ€ emit('update:title', newTitle) --&gt;
</code></pre>
</li>
<li><strong>Vue 3</strong>ï¼šâŒ ä¸æ”¯æŒï¼Œæ”¹ç”¨ <code>v-model:propName</code></li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šå¤š <code>v-model</code>ï¼ˆè§ç¬¬ 4 æ¡ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-5">4. <strong>v-model</strong>ï¼ˆâœ… æ¨èï¼ŒVue 3 å¢å¼ºï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šåŒå‘ç»‘å®šè¯­æ³•ç³–</li>
<li><strong>Vue 2</strong>ï¼šä»…æ”¯æŒå•ä¸ª <code>value</code> + <code>input</code> äº‹ä»¶</li>
<li><strong>Vue 3</strong>ï¼šæ”¯æŒå¤šä¸ª <code>v-model:propName</code>
<pre><code class="hljs language-vue" lang="vue">&lt;Child v-model:name="userName" v-model:age="userAge" /&gt;
&lt;!-- å­ç»„ä»¶éœ€ emit('update:name', ...) --&gt;
</code></pre>
</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€æ´ã€è¯­ä¹‰æ¸…æ™°ï¼Œé€‚åˆè¡¨å•æ§ä»¶</li>
</ul>
<hr/>
<h3 data-id="heading-6">5. <strong>ref</strong>ï¼ˆâœ… æœ‰é™æ¨èï¼‰</h3>
<ul>
<li><strong>æ–¹å‘</strong>ï¼šçˆ¶ â†’ å­ï¼ˆè·å–å­å®ä¾‹æˆ– DOMï¼‰</li>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡ <code>ref</code> å¼•ç”¨å­ç»„ä»¶å®ä¾‹ï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•æˆ–è®¿é—®æ•°æ®</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-vue" lang="vue">&lt;Child ref="childRef" /&gt;
// çˆ¶ç»„ä»¶ä¸­ï¼šthis.$refs.childRef.doSomething()ï¼ˆVue 2ï¼‰
// Vue 3ï¼šconst childRef = ref(); childRef.value.doSomething()
</code></pre>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè°ƒç”¨å­ç»„ä»¶æ–¹æ³•ï¼ˆå¦‚ focusã€validateï¼‰</li>
<li><strong>âš ï¸ æ³¨æ„</strong>ï¼šç ´åå°è£…æ€§ï¼Œåº”é¿å…è¯»å†™å­ç»„ä»¶å†…éƒ¨çŠ¶æ€</li>
</ul>
<hr/>
<h3 data-id="heading-7">6. <strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">children / </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord">/</span></span></span></span></span>parent</strong>ï¼ˆâŒ ä¸æ¨èï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šç›´æ¥è®¿é—®çˆ¶å­ç»„ä»¶å®ä¾‹</li>
<li><strong>é—®é¢˜</strong>ï¼š
<ul>
<li><code>$children</code> é¡ºåºä¸ç¡®å®š</li>
<li>ç ´åç»„ä»¶ç‹¬ç«‹æ€§</li>
<li>éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•</li>
</ul>
</li>
<li><strong>Vue 3</strong>ï¼šâŒ <code>$children</code> å·²ç§»é™¤ï¼Œ<code>$parent</code> ä»å­˜åœ¨ä½†ä¸é¼“åŠ±ä½¿ç”¨</li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šprops / emits / provide-inject</li>
</ul>
<hr/>
<h3 data-id="heading-8">7. <strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs / </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listeners</strong>ï¼ˆâœ… Vue 2ï¼›Vue 3 åˆå¹¶ä¸º <code>$attrs</code>ï¼‰</h3>
<ul>
<li><strong>ç”¨é€”</strong>ï¼šé€ä¼ æœªå£°æ˜çš„ props å’Œäº‹ä»¶ï¼ˆå¸¸ç”¨äºé«˜é˜¶ç»„ä»¶ã€åŒ…è£…ç»„ä»¶ï¼‰</li>
<li><strong>Vue 2</strong>ï¼š
<ul>
<li><code>$attrs</code>ï¼šæœªè¢« props å£°æ˜çš„ attribute</li>
<li><code>$listeners</code>ï¼šæ‰€æœ‰ <code>v-on</code> äº‹ä»¶ç›‘å¬å™¨</li>
</ul>
</li>
<li><strong>Vue 3</strong>ï¼š<code>$listeners</code> è¢«åˆå¹¶è¿› <code>$attrs</code>ï¼ˆåŒ…å« <code>onXxx</code> äº‹ä»¶ï¼‰</li>
<li><strong>å…¸å‹ç”¨æ³•</strong>ï¼šå°è£…ç¬¬ä¸‰æ–¹ UI ç»„ä»¶
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Wrapper.vue --&gt;
&lt;el-input v-bind="$attrs" v-on="$listeners" /&gt;
</code></pre>
</li>
</ul>
<hr/>
<h3 data-id="heading-9">8. <strong>provide / inject</strong>ï¼ˆâœ… æ¨èï¼‰</h3>
<ul>
<li><strong>æ–¹å‘</strong>ï¼šç¥–å…ˆ â†’ åä»£ï¼ˆè·¨å¤šå±‚ï¼‰</li>
<li><strong>åŸç†</strong>ï¼šä¾èµ–æ³¨å…¥ï¼Œç±»ä¼¼ React Context</li>
<li><strong>å“åº”å¼</strong>ï¼šéœ€ä¼ é€’ <code>ref</code> æˆ– <code>reactive</code> å¯¹è±¡
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ç¥–å…ˆ</span>
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'theme'</span>, themeRef)
<span class="hljs-comment">// åä»£</span>
<span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'theme'</span>)
</code></pre>
</li>
<li><strong>é€‚ç”¨</strong>ï¼šä¸»é¢˜ã€è¯­è¨€ã€ç”¨æˆ·ä¿¡æ¯ç­‰å…¨å±€é…ç½®</li>
<li><strong>Vue 2/3</strong>ï¼šâœ… æ”¯æŒï¼ˆVue 3 æ›´ç®€æ´ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-10">9. <strong>EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰</strong>ï¼ˆâš ï¸ è°¨æ…ä½¿ç”¨ï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šåŸºäºå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„å…¨å±€é€šä¿¡</li>
<li><strong>å®ç°</strong>ï¼š
<ul>
<li>Vue 2ï¼š<code>new Vue()</code> ä½œäº‹ä»¶ä¸­å¿ƒ</li>
<li>Vue 3ï¼šéœ€å¼•å…¥ <code>mitt</code> ç­‰åº“</li>
</ul>
</li>
<li><strong>é—®é¢˜</strong>ï¼š
<ul>
<li>éš¾ä»¥è¿½è¸ªæ•°æ®æµ</li>
<li>å®¹æ˜“å†…å­˜æ³„æ¼ï¼ˆå¿˜è®° offï¼‰</li>
<li>ä¸åˆ©äºå¤§å‹é¡¹ç›®ç»´æŠ¤</li>
</ul>
</li>
<li><strong>å»ºè®®</strong>ï¼šä»…ç”¨äºå°å‹é¡¹ç›®æˆ–ä¸´æ—¶è§£è€¦ï¼Œ<strong>ä¼˜å…ˆç”¨ Pinia</strong></li>
</ul>
<hr/>
<h3 data-id="heading-11">10. <strong>Vuex / Piniaï¼ˆçŠ¶æ€ç®¡ç†ï¼‰</strong>ï¼ˆâœ… å¤§å‹é¡¹ç›®æ¨èï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šé›†ä¸­å¼çŠ¶æ€ç®¡ç†</li>
<li><strong>Vuex</strong>ï¼šVue 2 å®˜æ–¹æ–¹æ¡ˆï¼ˆè¾ƒé‡ï¼‰</li>
<li><strong>Pinia</strong>ï¼šVue 3 å®˜æ–¹æ¨èï¼ˆæ›´è½»é‡ã€TypeScript å‹å¥½ï¼‰</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼š
<ul>
<li>çŠ¶æ€å¯é¢„æµ‹</li>
<li>æ”¯æŒ DevTools è°ƒè¯•</li>
<li>é€»è¾‘å¤ç”¨ï¼ˆactions/gettersï¼‰</li>
</ul>
</li>
<li><strong>é€‚ç”¨</strong>ï¼šå¤šç»„ä»¶å…±äº«çŠ¶æ€ã€æŒä¹…åŒ–ã€å¤æ‚ä¸šåŠ¡é€»è¾‘</li>
</ul>
<hr/>
<h3 data-id="heading-12">11. <strong>$root</strong>ï¼ˆâŒ ä¸æ¨èï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šè®¿é—®æ ¹å®ä¾‹ï¼ˆ<code>new Vue()</code>ï¼‰</li>
<li><strong>é—®é¢˜</strong>ï¼š
<ul>
<li>å…¨å±€è€¦åˆ</li>
<li>éš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤</li>
<li>åœ¨ç»„ä»¶åº“æˆ–å¾®å‰ç«¯ä¸­ä¸å¯é </li>
</ul>
</li>
<li><strong>Vue 3</strong>ï¼šâŒ <code>$root</code> ä»å­˜åœ¨ä½†å¼ºçƒˆä¸å»ºè®®ä½¿ç”¨</li>
<li><strong>æ›¿ä»£</strong>ï¼šprovide/inject æˆ– Pinia</li>
</ul>
<hr/>
<h3 data-id="heading-13">12. <strong>slotï¼ˆæ’æ§½ï¼‰</strong>ï¼ˆâœ… æ¨èï¼‰</h3>
<ul>
<li><strong>æ–¹å‘</strong>ï¼šçˆ¶ â†’ å­ï¼ˆå†…å®¹åˆ†å‘ï¼‰</li>
<li><strong>ç±»å‹</strong>ï¼š
<ul>
<li>é»˜è®¤æ’æ§½ <code>&lt;slot /&gt;</code></li>
<li>å…·åæ’æ§½ <code>&lt;slot name="header" /&gt;</code></li>
<li><strong>ä½œç”¨åŸŸæ’æ§½</strong>ï¼ˆå…³é”®ï¼ï¼‰ï¼šå­ â†’ çˆ¶ä¼ æ•°æ®
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å­ --&gt;
&lt;slot :user="currentUser" /&gt;
&lt;!-- çˆ¶ --&gt;
&lt;Child v-slot="{ user }"&gt;{{ user.name }}&lt;/Child&gt;
</code></pre>
</li>
</ul>
</li>
<li><strong>é€‚ç”¨</strong>ï¼šé«˜åº¦å¯å®šåˆ¶ç»„ä»¶ï¼ˆè¡¨æ ¼ã€å¼¹çª—ã€å¡ç‰‡ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-14">13. <strong>sessionStorage / localStorage</strong>ï¼ˆâš ï¸ ç‰¹å®šåœºæ™¯ï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡æµè§ˆå™¨å­˜å‚¨å®ç°â€œä¼ªé€šä¿¡â€</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š
<ul>
<li>é¡µé¢åˆ·æ–°åä¿æŒçŠ¶æ€</li>
<li>å¤š Tab é—´ç®€å•åŒæ­¥ï¼ˆé…åˆ <code>storage</code> äº‹ä»¶ï¼‰</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š
<ul>
<li>éå“åº”å¼ï¼ˆéœ€æ‰‹åŠ¨ç›‘å¬ <code>storage</code> äº‹ä»¶ï¼‰</li>
<li>æ•°æ®ç±»å‹é™åˆ¶ï¼ˆä»…å­—ç¬¦ä¸²ï¼‰</li>
<li>ä¸é€‚åˆå®æ—¶é€šä¿¡</li>
</ul>
</li>
<li><strong>å»ºè®®</strong>ï¼šä»…ç”¨äºæŒä¹…åŒ–ï¼Œ<strong>éç»„ä»¶é€šä¿¡é¦–é€‰</strong></li>
</ul>
<hr/>
<h3 data-id="heading-15">14. <strong>postMessage</strong>ï¼ˆâš ï¸ è·¨æ–‡æ¡£/è·¨åŸŸé€šä¿¡ï¼‰</h3>
<ul>
<li><strong>åŸç†</strong>ï¼šHTML5 æä¾›çš„å®‰å…¨è·¨åŸŸé€šä¿¡æœºåˆ¶</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š
<ul>
<li>iframe ä¸ä¸»é¡µé¢é€šä¿¡</li>
<li>Web Worker ä¸ä¸»çº¿ç¨‹</li>
<li>è·¨åŸŸçª—å£é€šä¿¡</li>
</ul>
</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸»é¡µé¢</span>
iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>)
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, handler)
</code></pre>
</li>
<li><strong>æ³¨æ„</strong>ï¼šéœ€éªŒè¯ <code>event.origin</code> é˜²æ­¢ XSS</li>
<li><strong>ä¸ç»„ä»¶é€šä¿¡å…³ç³»</strong>ï¼šå±äº<strong>è·¨ä¸Šä¸‹æ–‡é€šä¿¡</strong>ï¼Œéç»„ä»¶å†…éƒ¨æœºåˆ¶</li>
</ul>
<hr/>
<h2 data-id="heading-16">ğŸ“Š æ€»ç»“å¯¹æ¯”è¡¨</h2>





























































































































<table><thead><tr><th>æ–¹å¼</th><th>æ–¹å‘</th><th>Vue 2</th><th>Vue 3</th><th>æ¨èåº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>props</td><td>çˆ¶â†’å­</td><td>âœ…</td><td>âœ…</td><td>âœ…âœ…âœ…</td><td>åŸºç¡€æ•°æ®ä¼ é€’</td></tr><tr><td>$emit / v-on</td><td>å­â†’çˆ¶</td><td>âœ…</td><td>âœ…</td><td>âœ…âœ…âœ…</td><td>äº‹ä»¶é€šçŸ¥</td></tr><tr><td>.sync</td><td>åŒå‘</td><td>âœ…</td><td>âŒ</td><td>âš ï¸</td><td>Vue 2 åŒå‘ç»‘å®šï¼ˆå·²æ·˜æ±°ï¼‰</td></tr><tr><td>v-model</td><td>åŒå‘</td><td>âœ…ï¼ˆå•ï¼‰</td><td>âœ…ï¼ˆå¤šï¼‰</td><td>âœ…âœ…âœ…</td><td>è¡¨å•ã€å¯ç¼–è¾‘ç»„ä»¶</td></tr><tr><td>ref</td><td>çˆ¶â†’å­ï¼ˆè°ƒç”¨ï¼‰</td><td>âœ…</td><td>âœ…</td><td>âœ…âœ…</td><td>è°ƒç”¨å­æ–¹æ³•</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">children/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord">/</span></span></span></span></span>parent</td><td>åŒå‘</td><td>âœ…</td><td>âŒ/$parent</td><td>âŒ</td><td>â€”â€”</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listeners</td><td>é€ä¼ </td><td>âœ…</td><td>âœ…ï¼ˆåˆå¹¶ï¼‰</td><td>âœ…âœ…</td><td>é«˜é˜¶ç»„ä»¶å°è£…</td></tr><tr><td>provide/inject</td><td>ç¥–å…ˆâ†’åä»£</td><td>âœ…</td><td>âœ…</td><td>âœ…âœ…âœ…</td><td>è·¨å±‚çº§é…ç½®</td></tr><tr><td>EventBus</td><td>ä»»æ„</td><td>âœ…</td><td>éœ€ mitt</td><td>âš ï¸</td><td>å°å‹é¡¹ç›®ä¸´æ—¶é€šä¿¡</td></tr><tr><td>Vuex/Pinia</td><td>å…¨å±€</td><td>âœ…/âœ…</td><td>Piniaâœ…</td><td>âœ…âœ…âœ…</td><td>å¤æ‚çŠ¶æ€å…±äº«</td></tr><tr><td>$root</td><td>å…¨å±€</td><td>âœ…</td><td>âœ…ï¼ˆä¸æ¨èï¼‰</td><td>âŒ</td><td>â€”â€”</td></tr><tr><td>slot</td><td>çˆ¶â†’å­ï¼ˆå†…å®¹ï¼‰</td><td>âœ…</td><td>âœ…</td><td>âœ…âœ…âœ…</td><td>UI å®šåˆ¶</td></tr><tr><td>sessionStorage</td><td>æŒä¹…åŒ–</td><td>âœ…</td><td>âœ…</td><td>âš ï¸</td><td>åˆ·æ–°ä¿æ´»ã€å¤š Tab</td></tr><tr><td>postMessage</td><td>è·¨ä¸Šä¸‹æ–‡</td><td>âœ…</td><td>âœ…</td><td>âš ï¸</td><td>iframeã€Worker</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">âœ… æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨ props + emits</strong>ï¼šä¿æŒç»„ä»¶æ¸…æ™°ã€‚</li>
<li><strong>è·¨å±‚çº§ç”¨ provide/inject</strong>ï¼Œè€Œé <code>$parent</code>ã€‚</li>
<li><strong>å…±äº«çŠ¶æ€ç”¨ Pinia</strong>ï¼Œè€Œé EventBus æˆ– <code>$root</code>ã€‚</li>
<li><strong>é¿å…ç›´æ¥æ“ä½œå­ç»„ä»¶</strong>ï¼ˆref ä»…ç”¨äºæ–¹æ³•è°ƒç”¨ï¼‰ã€‚</li>
<li><strong>ä½œç”¨åŸŸæ’æ§½</strong>æ˜¯é«˜çº§ç»„ä»¶è®¾è®¡çš„åˆ©å™¨ã€‚</li>
<li><strong>localStorage / postMessage</strong> å±äºç‰¹æ®Šåœºæ™¯ï¼Œå‹¿æ»¥ç”¨ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæ ¸å¿ƒæœºåˆ¶ï¼šæ‰§è¡Œæ ˆã€ä½œç”¨åŸŸä¸thisæŒ‡å‘å®Œå…¨è§£æ]]></title>    <link>https://juejin.cn/post/7579385656780554274</link>    <guid>https://juejin.cn/post/7579385656780554274</guid>    <pubDate>2025-12-03T13:39:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579385656780554274" data-draft-id="7579264485259755535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæ ¸å¿ƒæœºåˆ¶ï¼šæ‰§è¡Œæ ˆã€ä½œç”¨åŸŸä¸thisæŒ‡å‘å®Œå…¨è§£æ"/> <meta itemprop="keywords" content="JavaScript,é¢è¯•,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T13:39:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ç¼˜æ¢¦"/> <meta itemprop="url" content="https://juejin.cn/user/4167568429944347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæ ¸å¿ƒæœºåˆ¶ï¼šæ‰§è¡Œæ ˆã€ä½œç”¨åŸŸä¸thisæŒ‡å‘å®Œå…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4167568429944347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ç¼˜æ¢¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:39:46.000Z" title="Wed Dec 03 2025 13:39:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>JavaScriptä½œä¸ºä¸€é—¨çµæ´»è€Œå¼ºå¤§çš„è¯­è¨€ï¼Œå…¶åº•å±‚è¿è¡Œæœºåˆ¶å¸¸å¸¸è®©å¼€å‘è€…æ„Ÿåˆ°å›°æƒ‘ã€‚ä¸ºä»€ä¹ˆå˜é‡æœ‰æ—¶èƒ½è®¿é—®ï¼Œæœ‰æ—¶ä¸èƒ½ï¼Ÿä¸ºä»€ä¹ˆthisçš„æŒ‡å‘ä¼š"é£˜å¿½ä¸å®š"ï¼Ÿæœ¬æ–‡å°†æ·±å…¥å‰–æJavaScriptçš„ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶â€”â€”<strong>æ‰§è¡Œæ ˆä¸æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ã€<strong>ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾</strong>ã€<strong>thisæŒ‡å‘</strong>ï¼Œå¸®ä½ å½»åº•ç†è§£JavaScriptçš„è¿è¡ŒåŸç†ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€æ‰§è¡Œæ ˆä¸æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šä»£ç æ‰§è¡Œçš„èˆå°</h2>
<h3 data-id="heading-2">1.1 é¢è¯•ç›´å‡»ï¼šè°ˆè°ˆä½ å¯¹JSæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„ç†è§£</h3>
<p>å½“é¢è¯•å®˜é—®è¿™ä¸ªé—®é¢˜æ—¶ï¼Œä»–ä»¬æƒ³è€ƒå¯Ÿçš„æ˜¯ä½ å¯¹<strong>JavaScriptå¼•æ“å¦‚ä½•ç®¡ç†å’Œæ‰§è¡Œä»£ç </strong>çš„ç†è§£æ·±åº¦ã€‚æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆæ˜¯å¼•æ“è¿½è¸ªæ‰€æœ‰å‡½æ•°è°ƒç”¨ã€ç®¡ç†æ‰§è¡Œæµç¨‹çš„<strong>æ ¸å¿ƒè°ƒåº¦ä¸­å¿ƒ</strong>ã€‚</p>
<p>*<strong>ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Ÿ</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯è¯„ä¼°å’Œæ‰§è¡Œ js ä»£ç çš„ç¯å¢ƒçš„æŠ½è±¡æ¦‚å¿µã€‚æ¯å½“ js ä»£ç åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒéƒ½æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚</p>
<p><strong>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹</strong></p>
<p>js ä¸­æœ‰ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹</p>
<ul>
<li>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šè¿™æ˜¯é»˜è®¤æˆ–è€…è¯´åŸºç¡€çš„ä¸Šä¸‹æ–‡ï¼Œä»»ä½•ä¸åœ¨å‡½æ•°å†…éƒ¨çš„ä»£ç éƒ½åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ã€‚å®ƒä¼šæ‰§è¡Œä¸¤ä»¶äº‹ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å±€çš„ window å¯¹è±¡ï¼ˆæµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¹¶ä¸”è®¾ç½® this çš„å€¼ç­‰äºè¿™ä¸ªå…¨å±€å¯¹è±¡ã€‚ä¸€ä¸ªç¨‹åºä¸­åªä¼šæœ‰ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li>
<li>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ã€‚æ¯ä¸ªå‡½æ•°éƒ½æœ‰å®ƒè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä¸è¿‡æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶åˆ›å»ºçš„ã€‚å‡½æ•°ä¸Šä¸‹æ–‡å¯ä»¥æœ‰ä»»æ„å¤šä¸ªã€‚æ¯å•ä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»ºï¼Œå®ƒä¼šæŒ‰å®šä¹‰çš„é¡ºåºæ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤ã€‚</li>
<li>eval å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæ‰§è¡Œåœ¨ eval å‡½æ•°å†…éƒ¨çš„ä»£ç ä¹Ÿä¼šæœ‰å®ƒå±äºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p><strong>è°ƒç”¨æ ˆ</strong></p>
<p>è°ƒç”¨æ ˆæ˜¯è§£æå™¨ï¼ˆå¦‚æµè§ˆå™¨ä¸­çš„ js è§£æå™¨ï¼‰çš„ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥åœ¨è„šæœ¬è°ƒç”¨å¤šä¸ªå‡½æ•°æ—¶ï¼Œè·Ÿè¸ªæ¯ä¸ªå‡½æ•°åœ¨å®Œæˆæ‰§è¡Œæ—¶åº”è¯¥è¿”å›æ§åˆ¶çš„ç‚¹ã€‚ï¼ˆå¦‚ä»€ä¹ˆå‡½æ•°æ­£åœ¨æ‰§è¡Œï¼Œä»€ä¹ˆå‡½æ•°è¢«è¿™ä¸ªå‡½æ•°è°ƒç”¨ï¼Œä¸‹ä¸€ä¸ªè°ƒç”¨çš„å‡½æ•°æ˜¯è°ï¼‰</p>
<ul>
<li>å½“è„šæœ¬è¦è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè§£æå™¨æŠŠè¯¥å‡½æ•°æ·»åŠ åˆ°æ ˆä¸­å¹¶ä¸”æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</li>
<li>ä»»ä½•è¢«è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„å‡½æ•°ä¼šè¿›ä¸€æ­¥æ·»åŠ åˆ°è°ƒç”¨æ ˆä¸­ï¼Œå¹¶ä¸”è¿è¡Œåˆ°å®ƒä»¬è¢«ä¸Šä¸ªç¨‹åºè°ƒç”¨çš„ä½ç½®ã€‚</li>
<li>å½“å‡½æ•°è¿è¡Œç»“æŸåï¼Œè§£é‡Šå™¨å°†å®ƒä»å †æ ˆä¸­å–å‡ºï¼Œå¹¶ä¸”ä¸»ä»£ç åˆ—è¡¨ä¸­ç»§ç»­æ‰§è¡Œä»£ç ã€‚</li>
<li>å¦‚æœæ ˆå ç”¨çš„ç©ºé—´æ¯”åˆ†é…ç»™å®ƒçš„ç©ºé—´è¿˜å¤§ï¼Œé‚£ä¹ˆåˆ™ä¼šå¯¼è‡´â€œæ ˆæº¢å‡ºâ€é”™è¯¯</li>
</ul>
<hr/>
<h3 data-id="heading-3">1.2 ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿ</h3>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯è¯„ä¼°å’Œæ‰§è¡ŒJavaScriptä»£ç çš„ç¯å¢ƒçš„æŠ½è±¡æ¦‚å¿µ</strong>ã€‚æ‰€æœ‰çš„JavaScriptä»£ç éƒ½æ˜¯åœ¨æŸä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„ã€‚</p>
<h3 data-id="heading-4">1.3 æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸‰ç§ç±»å‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">"å…¨å±€å˜é‡"</span>; <span class="hljs-comment">// åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­</span>

<span class="hljs-comment">// 2. å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> localVar = <span class="hljs-string">"å±€éƒ¨å˜é‡"</span>; <span class="hljs-comment">// åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(localVar);
}

<span class="hljs-comment">// 3. Evalå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</span>
<span class="hljs-built_in">eval</span>(<span class="hljs-string">"var evalVar = 'evalå˜é‡'"</span>);
</code></pre>
<p><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>
<p>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</p>
</li>
<li>
<p>åˆ›å»ºæ—¶ä¼šåšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºå…¨å±€å¯¹è±¡<code>window</code></li>
<li>å°†<code>this</code>çš„å€¼è®¾ç½®ä¸ºè¿™ä¸ªå…¨å±€å¯¹è±¡</li>
</ol>
</li>
</ul>
<h3 data-id="heading-5">1.4 æ‰§è¡Œæ ˆï¼ˆè°ƒç”¨æ ˆï¼‰ï¼šåè¿›å…ˆå‡ºçš„ç®¡ç†æœºåˆ¶</h3>
<p>æ‰§è¡Œæ ˆæ˜¯ä¸€ç§LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†ä»£ç æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">first</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬ä¸€ä¸ªå‡½æ•°å¼€å§‹'</span>);
    <span class="hljs-title function_">second</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬ä¸€ä¸ªå‡½æ•°ç»“æŸ'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">second</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬äºŒä¸ªå‡½æ•°å¼€å§‹'</span>);
    <span class="hljs-title function_">third</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬äºŒä¸ªå‡½æ•°ç»“æŸ'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">third</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬ä¸‰ä¸ªå‡½æ•°å¼€å§‹'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç¬¬ä¸‰ä¸ªå‡½æ•°ç»“æŸ'</span>);
}

<span class="hljs-title function_">first</span>();

<span class="hljs-comment">// æ‰§è¡Œæ ˆçš„å˜åŒ–è¿‡ç¨‹ï¼š</span>
<span class="hljs-comment">// 1. å…¨å±€ä¸Šä¸‹æ–‡å…¥æ ˆ</span>
<span class="hljs-comment">// 2. first()è°ƒç”¨ï¼Œfirstä¸Šä¸‹æ–‡å…¥æ ˆ</span>
<span class="hljs-comment">// 3. second()è°ƒç”¨ï¼Œsecondä¸Šä¸‹æ–‡å…¥æ ˆ  </span>
<span class="hljs-comment">// 4. third()è°ƒç”¨ï¼Œthirdä¸Šä¸‹æ–‡å…¥æ ˆ</span>
<span class="hljs-comment">// 5. third()æ‰§è¡Œå®Œæ¯•ï¼Œå‡ºæ ˆ</span>
<span class="hljs-comment">// 6. second()æ‰§è¡Œå®Œæ¯•ï¼Œå‡ºæ ˆ</span>
<span class="hljs-comment">// 7. first()æ‰§è¡Œå®Œæ¯•ï¼Œå‡ºæ ˆ</span>
</code></pre>
<h3 data-id="heading-6">1.5 æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½ç»å†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<h4 data-id="heading-7">åˆ›å»ºé˜¶æ®µï¼ˆæ­¤æ—¶å‡½æ•°è¢«è°ƒç”¨ï¼Œä½†æœªæ‰§è¡Œå†…éƒ¨ä»£ç ï¼‰ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">var</span> c = <span class="hljs-string">"hello"</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">d</span>(<span class="hljs-params"/>) {}
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
}

<span class="hljs-comment">// åœ¨åˆ›å»ºé˜¶æ®µï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¿›è¡Œä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š</span>
exampleExecutionContext = {
    <span class="hljs-comment">// 1. åˆ›å»ºå˜é‡å¯¹è±¡</span>
    <span class="hljs-attr">variableObject</span>: {
        <span class="hljs-attr">arguments</span>: { <span class="hljs-number">0</span>: a, <span class="hljs-number">1</span>: b, <span class="hljs-attr">length</span>: <span class="hljs-number">2</span> },
        <span class="hljs-attr">a</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// å½¢å‚</span>
        <span class="hljs-attr">b</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// å½¢å‚</span>
        <span class="hljs-attr">c</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// å˜é‡å£°æ˜</span>
        <span class="hljs-attr">d</span>: pointer_to_function_d,  <span class="hljs-comment">// å‡½æ•°å£°æ˜</span>
        <span class="hljs-attr">e</span>: <span class="hljs-literal">undefined</span>      <span class="hljs-comment">// å˜é‡å£°æ˜</span>
    },
    <span class="hljs-comment">// 2. å»ºç«‹ä½œç”¨åŸŸé“¾</span>
    <span class="hljs-attr">scopeChain</span>: [...],
    <span class="hljs-comment">// 3. ç¡®å®šthisæŒ‡å‘</span>
    <span class="hljs-attr">this</span>: <span class="hljs-variable language_">window</span>
}
</code></pre>
<h4 data-id="heading-8">æ‰§è¡Œé˜¶æ®µï¼ˆé€è¡Œæ‰§è¡Œä»£ç ï¼‰ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);  <span class="hljs-comment">// undefinedï¼ˆå˜é‡æå‡ï¼‰</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d);  <span class="hljs-comment">// function d() {}ï¼ˆå‡½æ•°æå‡ï¼‰</span>
    
    <span class="hljs-keyword">var</span> c = <span class="hljs-string">"hello"</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">d</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æˆ‘æ˜¯å‡½æ•°d"</span>);
    }
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æˆ‘æ˜¯å‡½æ•°è¡¨è¾¾å¼"</span>);
    };
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);  <span class="hljs-comment">// "hello"</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d);  <span class="hljs-comment">// function d() {}</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);  <span class="hljs-comment">// function() { ... }</span>
}

<span class="hljs-title function_">example</span>();
</code></pre>
<p><strong>é‡è¦è§„åˆ™</strong>ï¼š</p>
<ol>
<li>å‡½æ•°å£°æ˜ä¼š<strong>å®Œå…¨æå‡</strong></li>
<li>å˜é‡å£°æ˜ä¼š<strong>éƒ¨åˆ†æå‡</strong>ï¼ˆåªæå‡å£°æ˜ï¼Œä¸æå‡èµ‹å€¼ï¼‰</li>
<li>å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§é«˜äºå˜é‡å£°æ˜</li>
</ol>
<h3 data-id="heading-9">1.6 æ ˆæº¢å‡ºé”™è¯¯</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é€’å½’è°ƒç”¨æ²¡æœ‰ç»ˆæ­¢æ¡ä»¶ä¼šå¯¼è‡´æ ˆæº¢å‡º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">infiniteRecursion</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">infiniteRecursion</span>(); <span class="hljs-comment">// ä¸æ–­åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡</span>
}

<span class="hljs-comment">// è°ƒç”¨ä¼šæŠ›å‡ºï¼šRangeError: Maximum call stack size exceeded</span>
<span class="hljs-comment">// infiniteRecursion();</span>
</code></pre>
<h2 data-id="heading-10">äºŒã€ä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾ï¼šå˜é‡çš„å¯è§æ€§è§„åˆ™</h2>
<h3 data-id="heading-11">2.1 é¢è¯•é¢˜ï¼šè°ˆè°ˆä½ å¯¹ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾çš„ç†è§£</h3>
<p>ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾å†³å®šäº†<strong>å˜é‡åœ¨ä½•å¤„ä»¥åŠå¦‚ä½•è¢«è®¿é—®</strong>ï¼Œè¿™æ˜¯JavaScriptçš„åŸºç¡€æ¦‚å¿µã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Ÿ</strong></p>
<p>ä½œç”¨åŸŸæ˜¯åœ¨è¿è¡Œæ—¶ä»£ç ä¸­æŸäº›ç‰¹å®šéƒ¨åˆ†å˜é‡ã€å‡½æ•°å’Œå¯¹è±¡çš„å¯è®¿é—®æ€§ï¼Œå†³å®šäº†ä»£ç åŒºå—ä¸­å˜é‡å’Œå…¶ä»–èµ„æºçš„å¯è§æ€§ã€‚ES5 ä¸­åªå­˜åœ¨ä¸¤ç§ä½œç”¨åŸŸï¼šå…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸï¼ŒES6 æ–°å¢äº†å—çº§ä½œç”¨åŸŸã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸé“¾ï¼Ÿ</strong></p>
<p>å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œç¼–è¯‘å™¨åœ¨æ‰§è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä¼šé¦–å…ˆä»å½“å‰çš„ä½œç”¨åŸŸä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰è¿™ä¸ªæ ‡è¯†ç¬¦ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šå»çˆ¶ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œå¦‚æœçˆ¶ä½œç”¨åŸŸè¿˜æ²¡æ‰¾åˆ°ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸä¸ºæ­¢ã€‚</p>
<p>è€Œä½œç”¨åŸŸé“¾ï¼Œå°±æ˜¯æœ‰å½“å‰ä½œç”¨åŸŸä¸ä¸Šå±‚ä½œç”¨åŸŸçš„ä¸€ç³»åˆ—å˜é‡å¯¹è±¡ç»„æˆï¼Œå®ƒä¿è¯äº†å½“å‰æ‰§è¡Œçš„ä½œç”¨åŸŸé“¾å¯¹ç¬¦åˆè®¿é—®æƒé™çš„å˜é‡å’Œå‡½æ•°çš„æœ‰åºè®¿é—®ã€‚</p>
<p>ä½œç”¨åŸŸé“¾æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹å¾ï¼Œé‚£å°±æ˜¯<strong>ä½œç”¨åŸŸä¸­çš„å€¼æ˜¯åœ¨å‡½æ•°åˆ›å»ºçš„æ—¶å€™ï¼Œå°±å·²ç»è¢«å­˜å‚¨äº†ï¼Œæ˜¯é™æ€çš„ã€‚</strong> æ‰€è°“é™æ€ï¼Œå°±æ˜¯æ˜¯ä½œç”¨åŸŸä¸­çš„å€¼ä¸€æ—¦è¢«ç¡®å®šäº†ï¼Œæ°¸è¿œä¸ä¼šå˜ã€‚å‡½æ•°å¯ä»¥æ°¸è¿œä¸è¢«è°ƒç”¨ï¼Œä½†æ˜¯ä½œç”¨åŸŸä¸­çš„å€¼åœ¨å‡½æ•°åˆ›å»ºçš„æ—¶å€™å°±å·²ç»è¢«å†™å…¥äº†ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨å‡½æ•°ä½œç”¨åŸŸé“¾å¯¹è±¡é‡Œé¢ã€‚</p>
<h3 data-id="heading-12">2.2 ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Ÿ</h3>
<p>ä½œç”¨åŸŸå®šä¹‰äº†<strong>å˜é‡ã€å‡½æ•°å’Œå¯¹è±¡çš„å¯è®¿é—®æ€§èŒƒå›´</strong>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">"æˆ‘æ˜¯å…¨å±€å˜é‡"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å‡½æ•°ä½œç”¨åŸŸ</span>
    <span class="hljs-keyword">var</span> outerVar = <span class="hljs-string">"æˆ‘æ˜¯å¤–éƒ¨å‡½æ•°å˜é‡"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸ</span>
        <span class="hljs-keyword">var</span> innerVar = <span class="hljs-string">"æˆ‘æ˜¯å†…éƒ¨å‡½æ•°å˜é‡"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);    <span class="hljs-comment">// å¯ä»¥è®¿é—®</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);     <span class="hljs-comment">// å¯ä»¥è®¿é—®</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(innerVar);     <span class="hljs-comment">// å¯ä»¥è®¿é—®</span>
    }
    
    <span class="hljs-title function_">inner</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);        <span class="hljs-comment">// å¯ä»¥è®¿é—®</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);         <span class="hljs-comment">// å¯ä»¥è®¿é—®</span>
    <span class="hljs-comment">// console.log(innerVar);      // é”™è¯¯ï¼æ— æ³•è®¿é—®å†…éƒ¨å˜é‡</span>
}

<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-13">2.3 ES6çš„å—çº§ä½œç”¨åŸŸ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES5åªæœ‰å…¨å±€å’Œå‡½æ•°ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">es5Example</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">var</span> varVariable = <span class="hljs-string">"varå£°æ˜çš„å˜é‡"</span>;
        <span class="hljs-keyword">let</span> letVariable = <span class="hljs-string">"letå£°æ˜çš„å˜é‡"</span>;
        <span class="hljs-keyword">const</span> constVariable = <span class="hljs-string">"constå£°æ˜çš„å˜é‡"</span>;
    }
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(varVariable);    <span class="hljs-comment">// "varå£°æ˜çš„å˜é‡" - å¯ä»¥è®¿é—®</span>
    <span class="hljs-comment">// console.log(letVariable);  // ReferenceError - ä¸èƒ½è®¿é—®</span>
    <span class="hljs-comment">// console.log(constVariable); // ReferenceError - ä¸èƒ½è®¿é—®</span>
}

<span class="hljs-comment">// ES6çš„å—çº§ä½œç”¨åŸŸ</span>
{
    <span class="hljs-keyword">let</span> blockScoped = <span class="hljs-string">"å—çº§ä½œç”¨åŸŸå˜é‡"</span>;
    <span class="hljs-keyword">const</span> constant = <span class="hljs-string">"å¸¸é‡"</span>;
}
<span class="hljs-comment">// console.log(blockScoped); // ReferenceError</span>
<span class="hljs-comment">// console.log(constant);    // ReferenceError</span>
</code></pre>
<h3 data-id="heading-14">2.4 ä½œç”¨åŸŸé“¾</h3>
<p>å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJavaScriptå¼•æ“ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾ä»å†…åˆ°å¤–æŸ¥æ‰¾ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable language_">global</span> = <span class="hljs-string">"å…¨å±€"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> outer = <span class="hljs-string">"å¤–å±‚"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> inner = <span class="hljs-string">"å†…å±‚"</span>;
        
        <span class="hljs-comment">// æŸ¥æ‰¾é¡ºåºï¼šinner â†’ outer â†’ global</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inner);   <span class="hljs-comment">// "å†…å±‚" - åœ¨å½“å‰ä½œç”¨åŸŸæ‰¾åˆ°</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outer);   <span class="hljs-comment">// "å¤–å±‚" - åœ¨çˆ¶ä½œç”¨åŸŸæ‰¾åˆ°</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">global</span>);  <span class="hljs-comment">// "å…¨å±€" - åœ¨å…¨å±€ä½œç”¨åŸŸæ‰¾åˆ°</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(notExist); <span class="hljs-comment">// ReferenceError - æ‰¾ä¸åˆ°</span>
    }
    
    <span class="hljs-title function_">inner</span>();
}

<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-15">2.5 è‡ªç”±å˜é‡å’Œè¯æ³•ä½œç”¨åŸŸ</h3>
<p><strong>è‡ªç”±å˜é‡</strong>ï¼šåœ¨å½“å‰ä½œç”¨åŸŸæœªå®šä¹‰ï¼Œéœ€è¦å»çˆ¶ä½œç”¨åŸŸæŸ¥æ‰¾çš„å˜é‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> x = <span class="hljs-number">10</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// xæ˜¯è‡ªç”±å˜é‡</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">20</span>;
    <span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// è¾“å‡º10ï¼Œè€Œä¸æ˜¯20ï¼</span>
}

<span class="hljs-title function_">bar</span>();

<span class="hljs-comment">// è¿™æ˜¯å› ä¸ºJavaScripté‡‡ç”¨è¯æ³•ä½œç”¨åŸŸï¼ˆé™æ€ä½œç”¨åŸŸï¼‰</span>
<span class="hljs-comment">// å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å®šä¹‰æ—¶å°±ç¡®å®šäº†ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶</span>
</code></pre>
<h3 data-id="heading-16">2.6 ä½œç”¨åŸŸ vs æ‰§è¡Œä¸Šä¸‹æ–‡</h3>
<p><strong>å…³é”®åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>ä½œç”¨åŸŸ</strong>ï¼šå‡½æ•°<strong>å®šä¹‰æ—¶</strong>ç¡®å®šï¼Œé™æ€ä¸å˜</li>
<li><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šå‡½æ•°<strong>è°ƒç”¨æ—¶</strong>åˆ›å»ºï¼ŒåŠ¨æ€å˜åŒ–</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> color = <span class="hljs-string">"blue"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getColor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>);    <span class="hljs-comment">// æ‰§è¡Œä¸Šä¸‹æ–‡å†³å®šthis</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(color);         <span class="hljs-comment">// ä½œç”¨åŸŸå†³å®šcolorçš„å€¼</span>
}

<span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>,
    <span class="hljs-attr">getColor</span>: getColor
};

<span class="hljs-comment">// åŒæ ·çš„å‡½æ•°ï¼Œä¸åŒçš„è°ƒç”¨æ–¹å¼</span>
<span class="hljs-title function_">getColor</span>();        <span class="hljs-comment">// this: window, color: "blue"</span>
obj.<span class="hljs-title function_">getColor</span>();    <span class="hljs-comment">// this: obj, color: "blue"ï¼ˆä½œç”¨åŸŸä¸å˜ï¼ï¼‰</span>
</code></pre>
<h2 data-id="heading-17">ä¸‰ã€thisæŒ‡å‘ï¼šåŠ¨æ€ç»‘å®šçš„ä¸Šä¸‹æ–‡</h2>
<h3 data-id="heading-18">3.1 thisçš„æœ¬è´¨</h3>
<p><code>this</code>å…³é”®å­—æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå…·ä½“æŒ‡å‘å“ªä¸ªå¯¹è±¡å–å†³äº<strong>å‡½æ•°çš„è°ƒç”¨æ–¹å¼</strong>ã€‚</p>
<p>å…³äº this çš„æŒ‡å‘ï¼Œæœ‰ä¸€ç§å¹¿ä¸ºæµä¼ çš„è¯´æ³•å°±æ˜¯â€œè°è°ƒç”¨å®ƒï¼Œthis å°±æŒ‡å‘è°â€ã€‚</p>
<ul>
<li>åœ¨å‡½æ•°ä½“ä¸­ï¼Œéæ˜¾ç¤ºæˆ–éšå¼åœ°ç®€å•è°ƒç”¨å‡½æ•°æ—¶ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å†…çš„ this ä¼šè¢«ç»‘å®šåˆ° undefined ä¸Šï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹åˆ™ä¼šè¢«ç»‘å®šåˆ°å…¨å±€å¯¹è±¡ window/global ä¸Šã€‚</li>
<li>ä¸€èˆ¬ä½¿ç”¨ new æ–¹æ³•è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œæ„é€ å‡½æ•°å†…çš„ this ä¼šè¢«ç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šã€‚</li>
<li>ä¸€èˆ¬é€šè¿‡ call/apply/bind æ–¹æ³•æ˜¾ç¤ºè°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°ä½“å†…çš„ this ä¼šè¢«ç»‘å®šåˆ°æŒ‡å®šå‚æ•°çš„å¯¹è±¡ä¸Šã€‚</li>
<li>ä¸€èˆ¬é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°ä½“å†…çš„ this ä¼šè¢«ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šã€‚</li>
<li>åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œthis çš„æŒ‡å‘æ˜¯ç”±å¤–å±‚ï¼ˆå‡½æ•°æˆ–å…¨å±€ï¼‰ä½œç”¨åŸŸæ¥å†³å®šçš„ã€‚</li>
</ul>
<h3 data-id="heading-19">3.2 thisçš„ç»‘å®šè§„åˆ™</h3>
<h4 data-id="heading-20">1. é»˜è®¤ç»‘å®šï¼ˆæ™®é€šå‡½æ•°è°ƒç”¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éä¸¥æ ¼æ¨¡å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showThis</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
}

<span class="hljs-title function_">showThis</span>(); <span class="hljs-comment">// æµè§ˆå™¨ä¸­è¾“å‡ºï¼šWindowå¯¹è±¡</span>

<span class="hljs-comment">// ä¸¥æ ¼æ¨¡å¼</span>
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strictShowThis</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
}

<span class="hljs-title function_">strictShowThis</span>(); <span class="hljs-comment">// undefined</span>
</code></pre>
<h4 data-id="heading-21">2. éšå¼ç»‘å®šï¼ˆæ–¹æ³•è°ƒç”¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

obj.<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// "å¼ ä¸‰" - thisæŒ‡å‘obj</span>

<span class="hljs-comment">// éšå¼ä¸¢å¤±çš„å¸¸è§æƒ…å†µ</span>
<span class="hljs-keyword">var</span> sayName = obj.<span class="hljs-property">sayName</span>;
<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// "" æˆ– undefined - thisæŒ‡å‘å…¨å±€</span>

<span class="hljs-comment">// å›è°ƒå‡½æ•°ä¸­çš„éšå¼ä¸¢å¤±</span>
<span class="hljs-built_in">setTimeout</span>(obj.<span class="hljs-property">sayName</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// thisæŒ‡å‘å…¨å±€</span>
</code></pre>
<h4 data-id="heading-22">3. æ˜¾å¼ç»‘å®šï¼ˆcall/apply/bindï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">introduce</span>(<span class="hljs-params">lang, year</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æˆ‘å«<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>ï¼Œæ“…é•¿<span class="hljs-subst">${lang}</span>ï¼Œ<span class="hljs-subst">${year}</span>å¹´å¼€å§‹ç¼–ç¨‹`</span>);
}

<span class="hljs-keyword">var</span> person1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span> };
<span class="hljs-keyword">var</span> person2 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span> };

<span class="hljs-comment">// call - ç«‹å³è°ƒç”¨ï¼Œå‚æ•°é€ä¸ªä¼ é€’</span>
introduce.<span class="hljs-title function_">call</span>(person1, <span class="hljs-string">"JavaScript"</span>, <span class="hljs-number">2015</span>);
<span class="hljs-comment">// è¾“å‡ºï¼šæˆ‘å«Aliceï¼Œæ“…é•¿JavaScriptï¼Œ2015å¹´å¼€å§‹ç¼–ç¨‹</span>

<span class="hljs-comment">// apply - ç«‹å³è°ƒç”¨ï¼Œå‚æ•°æ•°ç»„ä¼ é€’</span>
introduce.<span class="hljs-title function_">apply</span>(person2, [<span class="hljs-string">"Python"</span>, <span class="hljs-number">2018</span>]);
<span class="hljs-comment">// è¾“å‡ºï¼šæˆ‘å«Bobï¼Œæ“…é•¿Pythonï¼Œ2018å¹´å¼€å§‹ç¼–ç¨‹</span>

<span class="hljs-comment">// bind - åˆ›å»ºæ–°å‡½æ•°ï¼Œä¸ç«‹å³è°ƒç”¨</span>
<span class="hljs-keyword">var</span> boundIntroduce = introduce.<span class="hljs-title function_">bind</span>(person1, <span class="hljs-string">"Java"</span>);
<span class="hljs-title function_">boundIntroduce</span>(<span class="hljs-number">2020</span>);
<span class="hljs-comment">// è¾“å‡ºï¼šæˆ‘å«Aliceï¼Œæ“…é•¿Javaï¼Œ2020å¹´å¼€å§‹ç¼–ç¨‹</span>
</code></pre>
<h4 data-id="heading-23">4. newç»‘å®šï¼ˆæ„é€ å‡½æ•°è°ƒç”¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-comment">// newè°ƒç”¨æ—¶ï¼ŒthisæŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä½ å¥½ï¼Œæˆ‘æ˜¯<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
    };
}

<span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">25</span>);
p1.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// "ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ä¸‰"</span>
</code></pre>
<h4 data-id="heading-24">5. ç®­å¤´å‡½æ•°çš„this</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"å¯¹è±¡"</span>,
    <span class="hljs-attr">regularFunc</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ™®é€šå‡½æ•°this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"setTimeoutæ™®é€šå‡½æ•°this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        }, <span class="hljs-number">100</span>);
        
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"setTimeoutç®­å¤´å‡½æ•°this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        }, <span class="hljs-number">200</span>);
    },
    <span class="hljs-attr">arrowFunc</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç®­å¤´å‡½æ•°this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

obj.<span class="hljs-title function_">regularFunc</span>();
<span class="hljs-comment">// æ™®é€šå‡½æ•°this: å¯¹è±¡</span>
<span class="hljs-comment">// setTimeoutæ™®é€šå‡½æ•°this: ï¼ˆå…¨å±€çš„nameï¼Œé€šå¸¸æ˜¯ç©ºï¼‰</span>
<span class="hljs-comment">// setTimeoutç®­å¤´å‡½æ•°this: å¯¹è±¡</span>

obj.<span class="hljs-title function_">arrowFunc</span>();
<span class="hljs-comment">// ç®­å¤´å‡½æ•°this: ï¼ˆå…¨å±€çš„nameï¼‰</span>
</code></pre>
<h3 data-id="heading-25">3.3 thisç»‘å®šçš„ä¼˜å…ˆçº§</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜å…ˆçº§æµ‹è¯•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
}

<span class="hljs-keyword">var</span> obj1 = { <span class="hljs-attr">value</span>: <span class="hljs-string">"obj1"</span>, <span class="hljs-attr">test</span>: test };
<span class="hljs-keyword">var</span> obj2 = { <span class="hljs-attr">value</span>: <span class="hljs-string">"obj2"</span>, <span class="hljs-attr">test</span>: test };

<span class="hljs-comment">// 1. é»˜è®¤ç»‘å®šï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰</span>
<span class="hljs-title function_">test</span>(); <span class="hljs-comment">// undefined æˆ– å…¨å±€çš„value</span>

<span class="hljs-comment">// 2. éšå¼ç»‘å®š</span>
obj1.<span class="hljs-title function_">test</span>(); <span class="hljs-comment">// "obj1"</span>

<span class="hljs-comment">// 3. æ˜¾å¼ç»‘å®š &gt; éšå¼ç»‘å®š</span>
obj1.<span class="hljs-property">test</span>.<span class="hljs-title function_">call</span>(obj2); <span class="hljs-comment">// "obj2"</span>

<span class="hljs-comment">// 4. newç»‘å®š &gt; æ˜¾å¼ç»‘å®š</span>
<span class="hljs-keyword">var</span> boundTest = test.<span class="hljs-title function_">bind</span>(obj1);
<span class="hljs-keyword">var</span> newObj = <span class="hljs-keyword">new</span> <span class="hljs-title function_">boundTest</span>(); <span class="hljs-comment">// undefinedï¼ˆnewç»‘å®šè¦†ç›–äº†bindç»‘å®šï¼‰</span>
</code></pre>
<h3 data-id="heading-26">3.4 å¸¸è§åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-27">DOMäº‹ä»¶å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// HTML: &lt;button id="btn"&gt;ç‚¹å‡»æˆ‘&lt;/button&gt;</span>

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// æŒ‡å‘è¢«ç‚¹å‡»çš„buttonå…ƒç´ </span>
});

<span class="hljs-comment">// ç®­å¤´å‡½æ•°ä¼šæ”¹å˜thisæŒ‡å‘</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// æŒ‡å‘å®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œé€šå¸¸æ˜¯window</span>
});
</code></pre>
<h4 data-id="heading-28">ç±»ä¸­çš„this</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>;
        <span class="hljs-comment">// éœ€è¦ç»‘å®šthisï¼Œå¦åˆ™ä½œä¸ºå›è°ƒæ—¶ä¼šä¸¢å¤±</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">increment</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">increment</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    }
    
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>);
    }
    
    <span class="hljs-comment">// ä½¿ç”¨ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»‘å®š</span>
    decrement = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>);
    }
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'inc'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, counter.<span class="hljs-property">increment</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'dec'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, counter.<span class="hljs-property">decrement</span>);
</code></pre>
<h3 data-id="heading-29">3.5 callã€applyã€bindçš„ç»å…¸åº”ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å€Ÿç”¨æ•°ç»„æ–¹æ³•å¤„ç†ç±»æ•°ç»„å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// argumentsæ˜¯ç±»æ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰æ•°ç»„æ–¹æ³•</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">reduce</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">total, current</span>) {
        <span class="hljs-keyword">return</span> total + current;
    }, <span class="hljs-number">0</span>);
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 2. è·å–æ•°ç»„æœ€å¤§/æœ€å°å€¼</span>
<span class="hljs-keyword">var</span> numbers = [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>];
<span class="hljs-keyword">var</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, numbers); <span class="hljs-comment">// 7</span>
<span class="hljs-keyword">var</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-property">min</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, ...numbers); <span class="hljs-comment">// 2ï¼ˆä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼‰</span>

<span class="hljs-comment">// 3. ç»§æ‰¿å’Œæ„é€ å‡½æ•°é“¾å¼è°ƒç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
}

<span class="hljs-keyword">var</span> myDog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">"æ—ºè´¢"</span>, <span class="hljs-string">"é‡‘æ¯›"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-property">name</span>); <span class="hljs-comment">// "æ—ºè´¢"</span>

<span class="hljs-comment">// 4. å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b, c</span>) {
    <span class="hljs-keyword">return</span> a * b * c;
}

<span class="hljs-keyword">var</span> double = multiply.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">double</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)); <span class="hljs-comment">// 24 (2 * 3 * 4)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">double</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)); <span class="hljs-comment">// 60 (2 * 5 * 6)</span>
</code></pre>
<h2 data-id="heading-30">å››ã€ç»¼åˆæ¡ˆä¾‹åˆ†æ</h2>
<h3 data-id="heading-31">4.1 ç»å…¸é¢è¯•é¢˜è§£æ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> length = <span class="hljs-number">10</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>);
}

<span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">length</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) {
        <span class="hljs-title function_">fn</span>();                    <span class="hljs-comment">// 1. ç›´æ¥è°ƒç”¨ï¼ŒthisæŒ‡å‘å…¨å±€</span>
        <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]();          <span class="hljs-comment">// 2. é€šè¿‡argumentsè°ƒç”¨</span>
        fn.<span class="hljs-title function_">call</span>(obj);            <span class="hljs-comment">// 3. æ˜¾å¼ç»‘å®šåˆ°obj</span>
    }
};

obj.<span class="hljs-title function_">method</span>(fn, <span class="hljs-number">1</span>);
<span class="hljs-comment">// è¾“å‡ºï¼š</span>
<span class="hljs-comment">// 10 ï¼ˆå…¨å±€lengthï¼‰</span>
<span class="hljs-comment">// 2  ï¼ˆarguments.lengthï¼‰</span>
<span class="hljs-comment">// 5  ï¼ˆobj.lengthï¼‰</span>
</code></pre>
<h3 data-id="heading-32">4.2 å¤æ‚åœºæ™¯åˆ†æ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">"å…¨å±€"</span>;
<span class="hljs-keyword">var</span> person = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¤–å±‚this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å†…å±‚this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        };
    },
    <span class="hljs-attr">sayNameArrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¤–å±‚this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å†…å±‚ç®­å¤´å‡½æ•°this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        };
    }
};

<span class="hljs-comment">// æƒ…å†µ1ï¼šæ™®é€šå‡½æ•°åµŒå¥—</span>
<span class="hljs-keyword">var</span> func1 = person.<span class="hljs-title function_">sayName</span>();
<span class="hljs-title function_">func1</span>(); 
<span class="hljs-comment">// å¤–å±‚this: å¼ ä¸‰</span>
<span class="hljs-comment">// å†…å±‚this: å…¨å±€</span>

<span class="hljs-comment">// æƒ…å†µ2ï¼šç®­å¤´å‡½æ•°è§£å†³</span>
<span class="hljs-keyword">var</span> func2 = person.<span class="hljs-title function_">sayNameArrow</span>();
<span class="hljs-title function_">func2</span>();
<span class="hljs-comment">// å¤–å±‚this: å¼ ä¸‰</span>
<span class="hljs-comment">// å†…å±‚ç®­å¤´å‡½æ•°this: å¼ ä¸‰</span>

<span class="hljs-comment">// æƒ…å†µ3ï¼šä½¿ç”¨bindç»‘å®š</span>
<span class="hljs-keyword">var</span> func3 = person.<span class="hljs-title function_">sayName</span>().<span class="hljs-title function_">bind</span>(person);
<span class="hljs-title function_">func3</span>();
<span class="hljs-comment">// å¤–å±‚this: å¼ ä¸‰</span>
<span class="hljs-comment">// å†…å±‚this: å¼ ä¸‰</span>
</code></pre>
<h3 data-id="heading-33">4.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li><strong>é¿å…è¿‡åº¦åµŒå¥—</strong>ï¼šæ·±åº¦åµŒå¥—çš„ä½œç”¨åŸŸé“¾ä¼šå¢åŠ å˜é‡æŸ¥æ‰¾æ—¶é—´</li>
<li><strong>åˆç†ä½¿ç”¨é—­åŒ…</strong>ï¼šä¸å¿…è¦çš„é—­åŒ…ä¼šå»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>æ³¨æ„å†…å­˜æ³„æ¼</strong>ï¼šæ„å¤–çš„å…¨å±€å˜é‡å’Œæœªæ¸…é™¤çš„å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</li>
<li><strong>é€‚å½“ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</strong>ï¼šé¿å…æ„å¤–çš„å…¨å±€ç»‘å®šå’Œä¸å¯é¢„æµ‹çš„this</li>
</ol>
<h2 data-id="heading-34">äº”ã€æ€»ç»“</h2>
<h3 data-id="heading-35">5.1 æ ¸å¿ƒæ¦‚å¿µå›é¡¾</h3>
<ol>
<li><strong>æ‰§è¡Œæ ˆ</strong>ï¼šç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡çš„åè¿›å…ˆå‡ºæ•°æ®ç»“æ„</li>
<li><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šä»£ç æ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒ…å«å˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾å’Œthis</li>
<li><strong>ä½œç”¨åŸŸ</strong>ï¼šå˜é‡å’Œå‡½æ•°çš„å¯è®¿é—®èŒƒå›´ï¼Œåœ¨å®šä¹‰æ—¶ç¡®å®š</li>
<li><strong>ä½œç”¨åŸŸé“¾</strong>ï¼šä»å½“å‰ä½œç”¨åŸŸåˆ°å…¨å±€ä½œç”¨åŸŸçš„é“¾å¼ç»“æ„</li>
<li><strong>thisæŒ‡å‘</strong>ï¼šç”±è°ƒç”¨æ–¹å¼å†³å®šï¼Œéµå¾ªç‰¹å®šçš„ç»‘å®šè§„åˆ™</li>
</ol>
<h3 data-id="heading-36">5.2 è®°å¿†å£è¯€</h3>
<ul>
<li><strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šè°ƒç”¨å‡½æ•°æ‰åˆ›å»ºï¼Œå…¥æ ˆå‡ºæ ˆç®¡æµç¨‹</li>
<li><strong>ä½œç”¨åŸŸé“¾</strong>ï¼šå†…å±‚å¯è®¿å¤–å±‚ï¼Œå®šä¹‰ä½ç½®å°±å†³å®š</li>
<li><strong>thisæŒ‡å‘</strong>ï¼šè°è°ƒç”¨å°±æŒ‡è°ï¼Œç®­å¤´å‡½æ•°çœ‹å¤–å±‚</li>
<li><strong>ç»‘å®šä¼˜å…ˆçº§</strong>ï¼šnew &gt; æ˜¾å¼ &gt; éšå¼ &gt; é»˜è®¤</li>
</ul>
<h3 data-id="heading-37">5.3 å®æˆ˜å»ºè®®</h3>
<ol>
<li>ä½¿ç”¨<code>const</code>å’Œ<code>let</code>æ›¿ä»£<code>var</code>ï¼Œåˆ©ç”¨å—çº§ä½œç”¨åŸŸ</li>
<li>åœ¨å›è°ƒå‡½æ•°ä¸­æ³¨æ„thisç»‘å®šï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–bind</li>
<li>ç†è§£é—­åŒ…åŸç†ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜å ç”¨</li>
<li>æŒæ¡call/apply/bindçš„é€‚ç”¨åœºæ™¯ï¼Œçµæ´»æ”¹å˜thisæŒ‡å‘</li>
</ol>
<p>é€šè¿‡æ·±å…¥ç†è§£è¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>å‡†ç¡®é¢„æµ‹ä»£ç çš„æ‰§è¡Œç»“æœ</li>
<li>é¿å…å¸¸è§çš„thisç»‘å®šé”™è¯¯</li>
<li>ç¼–å†™æ›´é«˜æ•ˆã€å¯ç»´æŠ¤çš„JavaScriptä»£ç </li>
<li>åœ¨é¢è¯•ä¸­ä»å®¹åº”å¯¹ç›¸å…³æŠ€æœ¯é—®é¢˜</li>
</ul>
<p>JavaScriptçš„è¿è¡Œæœºåˆ¶è™½ç„¶å¤æ‚ï¼Œä½†åªè¦æŒæ¡äº†è¿™äº›æ ¸å¿ƒæ¦‚å¿µï¼Œä½ å°±èƒ½ä»"çŸ¥å…¶ç„¶"è¿›é˜¶åˆ°"çŸ¥å…¶æ‰€ä»¥ç„¶"ï¼ŒçœŸæ­£é©¾é©­è¿™é—¨çµæ´»è€Œå¼ºå¤§çš„è¯­è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€URPã€‘Unity[å†…ç½®Shader]ç²’å­ç®€å•å…‰ç…§ParticlesSimpleLit]]></title>    <link>https://juejin.cn/post/7579544295344177203</link>    <guid>https://juejin.cn/post/7579544295344177203</guid>    <pubDate>2025-12-04T01:54:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579544295344177203" data-draft-id="7579673620940374066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€URPã€‘Unity[å†…ç½®Shader]ç²’å­ç®€å•å…‰ç…§ParticlesSimpleLit"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,Unity3D,å›¾å½¢å­¦"/> <meta itemprop="datePublished" content="2025-12-04T01:54:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€URPã€‘Unity[å†…ç½®Shader]ç²’å­ç®€å•å…‰ç…§ParticlesSimpleLit
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:54:31.000Z" title="Thu Dec 04 2025 01:54:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<h2 data-id="heading-0"><strong>ä½œç”¨ä¸åŸç†</strong></h2>
<p>ParticlesSimpleLitæ˜¯Unity URP(Universal Render Pipeline)ä¸­ä¸“é—¨ä¸ºç²’å­ç³»ç»Ÿè®¾è®¡çš„ç®€åŒ–å…‰ç…§ç€è‰²å™¨ï¼Œä¸»è¦ç”¨äºå®ç°é«˜æ€§èƒ½çš„ç²’å­æ¸²æŸ“æ•ˆæœã€‚å…¶æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ç®€åŒ–å…‰ç…§è®¡ç®—æ¨¡å‹ï¼Œç‰ºç‰²éƒ¨åˆ†ç‰©ç†å‡†ç¡®æ€§æ¥æ¢å–æ›´é«˜çš„æ¸²æŸ“æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç§»åŠ¨ç«¯æˆ–ä½ç«¯è®¾å¤‡ä½¿ç”¨ã€‚</p>
<p>è¯¥ç€è‰²å™¨ä¸è®¡ç®—ç‰©ç†æ­£ç¡®æ€§å’Œèƒ½é‡å®ˆæ’ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ä¸ªç®€å•çš„è¿‘ä¼¼ç…§æ˜æ¨¡å‹ï¼Œè¿™ä½¿å¾—å®ƒåœ¨æ¸²æŸ“æ—¶å¯ä»¥å¿½ç•¥å¤æ‚çš„ç‰©ç†è®¡ç®—ã€‚ParticlesSimpleLitä¸»è¦åŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š</p>
<ul>
<li>Surface Optionsï¼šæ§åˆ¶æè´¨çš„åŸºæœ¬æ¸²æŸ“æ–¹å¼ï¼Œå¦‚é¢œè‰²å’Œå…‰ç…§æ¨¡å¼</li>
<li>Surface Inputsï¼šæè¿°è¡¨é¢ç‰¹æ€§ï¼Œå¦‚æ¹¿åº¦ã€ç²—ç³™åº¦ç­‰</li>
<li>Advancedé€‰é¡¹ï¼šæä¾›æ›´åº•å±‚çš„æ¸²æŸ“è®¾ç½®å¦‚é˜´å½±å’Œåå°„</li>
</ul>
<h2 data-id="heading-1"><strong>å‘å±•å†å²</strong></h2>
<p>ParticlesSimpleLitéšç€URPçš„å‘å±•ç»å†äº†å¤šä¸ªç‰ˆæœ¬è¿­ä»£ï¼š</p>
<ul>
<li>æœ€åˆä½œä¸ºURPæ ¸å¿ƒç€è‰²å™¨ä¹‹ä¸€å¼•å…¥ï¼Œæ›¿ä»£äº†ä¼ ç»ŸBuilt-inæ¸²æŸ“ç®¡çº¿ä¸­çš„ç®€å•ç²’å­ç€è‰²å™¨</li>
<li>åœ¨URP 7.xç‰ˆæœ¬ä¸­è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç‰¹åˆ«é’ˆå¯¹ç§»åŠ¨å¹³å°</li>
<li>URP 12.0ç‰ˆæœ¬åå¢åŠ äº†å¯¹Shader Graphçš„æ”¯æŒ</li>
<li>æœ€æ–°ç‰ˆæœ¬(å¦‚URP 16.0.6)è¿›ä¸€æ­¥ä¼˜åŒ–äº†å˜ä½“ç®¡ç†å’ŒGPUå®ä¾‹åŒ–æ”¯æŒ</li>
</ul>
<h2 data-id="heading-2"><strong>å…·ä½“ä½¿ç”¨æ–¹æ³•</strong></h2>
<h3 data-id="heading-3"><strong>åŸºæœ¬åº”ç”¨ç¤ºä¾‹</strong></h3>
<p>åœ¨Unityä¸­ä½¿ç”¨ParticlesSimpleLitçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>åˆ›å»ºæˆ–é€‰æ‹©ç²’å­ç³»ç»Ÿ</li>
<li>åœ¨ç²’å­ç³»ç»Ÿçš„Rendereræ¨¡å—ä¸­æŒ‡å®šæè´¨</li>
<li>åˆ›å»ºæ–°æè´¨æˆ–é€‰æ‹©ç°æœ‰æè´¨</li>
<li>åœ¨æè´¨Inspectorçª—å£çš„Shaderä¸‹æ‹‰èœå•ä¸­é€‰æ‹©"Universal Render Pipeline &gt; Particles &gt; Simple Lit"</li>
</ul>
<p>ä»£ç è¯´æ˜ï¼šè¿™ä¸ªC#è„šæœ¬ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ä»£ç åŠ¨æ€ä¸ºç²’å­ç³»ç»Ÿåº”ç”¨ParticlesSimpleLitç€è‰²å™¨ã€‚</p>
<ul>
<li>
<p>ParticleSimpleLitExample.cs</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®æè´¨Shaderçš„ç¤ºä¾‹</span>
<span class="hljs-keyword">using</span> UnityEngine;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ParticleShaderSetter</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> ParticleSystem particleSystem;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>
    {
        <span class="hljs-keyword">var</span> renderer = particleSystem.GetComponent&lt;ParticleSystemRenderer&gt;();
        Material mat = <span class="hljs-keyword">new</span> Material(Shader.Find(<span class="hljs-string">"Universal Render Pipeline/Particles/Simple Lit"</span>));
        renderer.material = mat;
    }
}
<span class="hljs-comment">// ä»¥ä¸‹æ˜¯Shader Graphçš„èŠ‚ç‚¹è®¾ç½®å‚è€ƒï¼š</span>
<span class="hljs-comment">/*
1. æ·»åŠ Texture2DèŠ‚ç‚¹ä½œä¸ºBase Mapè¾“å…¥
2. æ·»åŠ ColorèŠ‚ç‚¹ä½œä¸ºBase Colorè¾“å…¥
3. æ·»åŠ SliderèŠ‚ç‚¹æ§åˆ¶Specular(0-1èŒƒå›´)
4. æ·»åŠ SliderèŠ‚ç‚¹æ§åˆ¶Smoothness(0-1èŒƒå›´)
5. è¿æ¥è¿™äº›èŠ‚ç‚¹åˆ°PBR Masterçš„å¯¹åº”è¾“å…¥
6. åœ¨PBR MasterèŠ‚ç‚¹ä¸­ç¦ç”¨é«˜çº§å…‰ç…§è®¡ç®—
*/</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-4"><strong>å‚æ•°é…ç½®</strong></h3>
<p>ParticlesSimpleLitæä¾›äº†å¤šä¸ªå¯è°ƒå‚æ•°ï¼š</p>
<ul>
<li>â€Œ<strong>Base Map</strong>â€Œï¼šåŸºç¡€çº¹ç†ï¼Œå®šä¹‰ç²’å­å¤–è§‚</li>
<li>â€Œ<strong>Base Color</strong>â€Œï¼šåŸºç¡€é¢œè‰²ï¼Œä¸çº¹ç†ç›¸ä¹˜</li>
<li>â€Œ<strong>Specular</strong>â€Œï¼šæ§åˆ¶é«˜å…‰å¼ºåº¦</li>
<li>â€Œ<strong>Smoothness</strong>â€Œï¼šæ§åˆ¶è¡¨é¢å…‰æ»‘åº¦</li>
<li>â€Œ<strong>Emission</strong>â€Œï¼šæ§åˆ¶è‡ªå‘å…‰å¼ºåº¦å’Œé¢œè‰²</li>
</ul>
<h2 data-id="heading-5"><strong>Shader Graphä¸­çš„åº”ç”¨</strong></h2>
<p>åœ¨Shader Graphä¸­ä½¿ç”¨ParticlesSimpleLitéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°çš„Shader Graph</li>
<li>åœ¨Graph Inspectorä¸­å°†"Target"è®¾ç½®ä¸º"Universal Render Pipeline"</li>
<li>ä½¿ç”¨"PBR Master"èŠ‚ç‚¹å¹¶è°ƒæ•´è®¾ç½®ä»¥åŒ¹é…SimpleLitç‰¹æ€§</li>
<li>æ·»åŠ å¿…è¦çš„çº¹ç†å’Œå‚æ•°è¾“å…¥</li>
</ul>
<p>ä»£ç è¯´æ˜ï¼šè¿™ä¸ªä¼ªä»£ç æè¿°äº†åœ¨Shader Graphä¸­é‡å»ºParticlesSimpleLitåŸºæœ¬åŠŸèƒ½æ‰€éœ€çš„èŠ‚ç‚¹é…ç½®ã€‚</p>
<ul>
<li>
<p>ParticleSimpleLitExample.cs</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®æè´¨Shaderçš„ç¤ºä¾‹</span>
<span class="hljs-keyword">using</span> UnityEngine;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ParticleShaderSetter</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> ParticleSystem particleSystem;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>
    {
        <span class="hljs-keyword">var</span> renderer = particleSystem.GetComponent&lt;ParticleSystemRenderer&gt;();
        Material mat = <span class="hljs-keyword">new</span> Material(Shader.Find(<span class="hljs-string">"Universal Render Pipeline/Particles/Simple Lit"</span>));
        renderer.material = mat;
    }
}

<span class="hljs-comment">// ä»¥ä¸‹æ˜¯Shader Graphçš„èŠ‚ç‚¹è®¾ç½®å‚è€ƒï¼š</span>
<span class="hljs-comment">/*
1. æ·»åŠ Texture2DèŠ‚ç‚¹ä½œä¸ºBase Mapè¾“å…¥
2. æ·»åŠ ColorèŠ‚ç‚¹ä½œä¸ºBase Colorè¾“å…¥
3. æ·»åŠ SliderèŠ‚ç‚¹æ§åˆ¶Specular(0-1èŒƒå›´)
4. æ·»åŠ SliderèŠ‚ç‚¹æ§åˆ¶Smoothness(0-1èŒƒå›´)
5. è¿æ¥è¿™äº›èŠ‚ç‚¹åˆ°PBR Masterçš„å¯¹åº”è¾“å…¥
6. åœ¨PBR MasterèŠ‚ç‚¹ä¸­ç¦ç”¨é«˜çº§å…‰ç…§è®¡ç®—
*/</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-6"><strong>é«˜çº§åº”ç”¨ç¤ºä¾‹</strong></h2>
<p>ç»“åˆç²’å­ç³»ç»Ÿçš„å…¶ä»–æ¨¡å—ï¼Œå¦‚Lightsæ¨¡å—å’ŒTrailsæ¨¡å—ï¼Œå¯ä»¥åˆ›å»ºæ›´å¤æ‚çš„æ•ˆæœã€‚ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ‹–å°¾æ•ˆæœçš„ç«ç„°ç²’å­ï¼š</p>
<ul>
<li>å¯ç”¨ç²’å­ç³»ç»Ÿçš„Trailsæ¨¡å—</li>
<li>ä½¿ç”¨ParticlesSimpleLitæè´¨å¹¶è®¾ç½®é€‚å½“çš„Emissionå€¼</li>
<li>è°ƒæ•´Base Colorä¸ºæ©™é»„è‰²æ¸å˜</li>
<li>æ ¹æ®éœ€è¦å¯ç”¨Lightsæ¨¡å—ä¸ºéƒ¨åˆ†ç²’å­æ·»åŠ ç‚¹å…‰æºæ•ˆæœ</li>
</ul>
<p>ParticlesSimpleLitå› å…¶é«˜æ•ˆçš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦å¤§é‡ç²’å­çš„åœºæ™¯ï¼Œå¦‚é­”æ³•æ•ˆæœã€çƒŸé›¾ã€ç«ç„°ç­‰è§†è§‰æ•ˆæœ</p>
<h3 data-id="heading-7"><strong>ç«ç„°ä¸çƒŸé›¾æ•ˆæœ</strong></h3>
<p>é€šè¿‡è°ƒæ•´Surface Typeä¸ºTransparentå¹¶é€‰æ‹©Additiveæ··åˆæ¨¡å¼ï¼Œé…åˆå™ªå£°çº¹ç†å®ç°åŠ¨æ€ç«ç„°å½¢æ€ã€‚å…³é”®å‚æ•°åŒ…æ‹¬_Emissionæ§åˆ¶å‘å…‰å¼ºåº¦ã€_MainTexè®¾ç½®ç«ç„°è´´å›¾åºåˆ—å¸§ï¼ŒåŒæ—¶éœ€å¯ç”¨Color over Lifetimeæ¨¡å—å®ç°é¢œè‰²æ¸å˜ã€‚å…·ä½“å®ç°æ­¥éª¤ï¼š</p>
<ul>
<li>åˆ›å»ºParticle Systemï¼Œæè´¨é€‰æ‹©Universal Render Pipeline &gt; Particles &gt; Simple Lit</li>
<li>åœ¨Surface Optionsä¸­è®¾ç½®Blending Modeä¸ºAdditive</li>
<li>é€šè¿‡è„šæœ¬æ§åˆ¶_Emissionå¼ºåº¦æ¨¡æ‹Ÿç‡ƒçƒ§æ³¢åŠ¨</li>
</ul>
<h3 data-id="heading-8"><strong>é›¨é›ªå¤©æ°”æ•ˆæœ</strong></h3>
<p>é‡‡ç”¨Opaqueè¡¨é¢ç±»å‹æå‡æ€§èƒ½ï¼Œç»“åˆGPUå®ä¾‹åŒ–å®ç°å¤§é¢ç§¯ç²’å­æ¸²æŸ“ã€‚éœ€é…ç½®_MainTexä¸ºé›¨æ»´/é›ªèŠ±è´´å›¾ï¼Œä½¿ç”¨_SoftParticlesNearFadeæ§åˆ¶ç²’å­æ·¡å…¥è·ç¦»ï¼Œå¹¶é€šè¿‡Rotation over Lifetimeæ¨¡å—æ·»åŠ éšæœºæ—‹è½¬ã€‚å…¸å‹å‚æ•°ï¼š</p>
<ul>
<li>_MainTex: é›¨æ»´Alphaè´´å›¾
_SoftParticlesNearFade: 0.5
_RenderFace: Both</li>
</ul>
<h3 data-id="heading-9"><strong>é­”æ³•ç²’å­ç‰¹æ•ˆ</strong></h3>
<p>åˆ©ç”¨Color Modeçš„Overlayé€‰é¡¹å®ç°æè´¨ä¸ç²’å­é¢œè‰²æ··åˆï¼Œé…åˆ_Cutoffå‚æ•°åˆ¶ä½œé—ªçƒæ•ˆæœã€‚é€šè¿‡è„šæœ¬åŠ¨æ€ä¿®æ”¹_HitPoså’Œ_HitSizeæ•°ç»„å¯å®ç°å—å‡»æ—¶çš„æ³¢çº¹æ‰©æ•£ã€‚æ ¸å¿ƒä»£ç é€»è¾‘åŒ…æ‹¬ï¼š</p>
<ul>
<li>å£°æ˜Shaderå±æ€§ï¼š<code>_HitPos("HitPos", Vector) = (0,0,0,0)</code></li>
<li>åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è®¡ç®—è·ç¦»è¡°å‡ï¼š<code>float dist = distance(i.worldPos, _HitPos)</code></li>
</ul>
<h3 data-id="heading-10"><strong>è½å¶/èŠ±ç“£æ•ˆæœ</strong></h3>
<p>éœ€å¯ç”¨Alpha Clippingå¹¶è®¾ç½®åˆé€‚é˜ˆå€¼ï¼ˆé€šå¸¸0.3-0.5ï¼‰ï¼Œç»“åˆç²’å­ç³»ç»Ÿçš„Shapeæ¨¡å—è®¾ç½®ä¸ºBoxå‘å°„å™¨è¦†ç›–æ ‘æœ¨èŒƒå›´ã€‚é€šè¿‡Size over Lifetimeå®ç°ä¸‹è½è¿‡ç¨‹ä¸­çš„å°ºå¯¸å˜åŒ–ï¼Œä½¿ç”¨Texture Sheet Animationæ¨¡å—æ·»åŠ é£˜åŠ¨åŠ¨ç”»ã€‚</p>
<h3 data-id="heading-11"><strong>å—å‡»é—ªç™½æ•ˆæœ</strong></h3>
<p>å¤åˆ¶ParticlesSimpleLitç€è‰²å™¨åæ·»åŠ å—å‡»é€»è¾‘ï¼Œé€šè¿‡Lerpå‡½æ•°æ··åˆåŸå§‹é¢œè‰²ä¸ç™½è‰²ï¼Œä½¿ç”¨_SinTimeæ§åˆ¶æ¢å¤é€Ÿåº¦ã€‚å…³é”®å®ç°å‚è€ƒå—å‡»é—ªç™½åŠ¨ç”»æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ·»åŠ å±æ€§ï¼š<code>_FlashAmount("Flash Amount", Range(0,1)) = 0</code></li>
<li>é¢œè‰²æ··åˆï¼š<code>finalColor = lerp(originalColor, white, _FlashAmount)</code></li>
</ul>
<p>æ‰€æœ‰æ•ˆæœå‡éœ€åœ¨URPè®¾ç½®ä¸­å¼€å¯Depth Textureå’ŒOpaque Textureé€‰é¡¹ä»¥ä¿è¯æ·±åº¦äº¤äº’æ­£å¸¸ã€‚å¯¹äºå¤æ‚æ•ˆæœï¼Œå»ºè®®ç»“åˆShader Graphè¿›è¡ŒåŸå‹è®¾è®¡åå†è½¬æ¢ä¸ºä»£ç å®ç°.</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ DeepSeek ç»™ Git æäº¤åšè‡ªåŠ¨ Code Reviewï¼šä» 0 è½åœ°ä¸€ä¸ªæœ¬åœ° AI å®¡æŸ¥æµç¨‹]]></title>    <link>https://juejin.cn/post/7579264485259952143</link>    <guid>https://juejin.cn/post/7579264485259952143</guid>    <pubDate>2025-12-03T14:47:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259952143" data-draft-id="7579494852652826658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ DeepSeek ç»™ Git æäº¤åšè‡ªåŠ¨ Code Reviewï¼šä» 0 è½åœ°ä¸€ä¸ªæœ¬åœ° AI å®¡æŸ¥æµç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T14:47:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GALA"/> <meta itemprop="url" content="https://juejin.cn/user/2893570334268573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ DeepSeek ç»™ Git æäº¤åšè‡ªåŠ¨ Code Reviewï¼šä» 0 è½åœ°ä¸€ä¸ªæœ¬åœ° AI å®¡æŸ¥æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2893570334268573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GALA
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:47:18.000Z" title="Wed Dec 03 2025 14:47:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªç©ºç›®å½•å¼€å§‹ï¼Œæ­å»ºä¸€å¥—åœ¨ git commit å‰è‡ªåŠ¨è°ƒç”¨ DeepSeekÂ åšä»£ç å®¡æŸ¥çš„å·¥ä½œæµï¼š</p>
<ul>
<li>ä½¿ç”¨Â Node.js è„šæœ¬Â è¯»å–æœ¬æ¬¡æäº¤çš„Â git diff</li>
<li>é€šè¿‡Â DeepSeek Chat APIÂ åšä»£ç å®¡æŸ¥ï¼Œå¹¶æŒ‰Â ä¸¥é‡ç¨‹åº¦åˆ†çº§</li>
<li>åœ¨Â pre-commit hookÂ é˜¶æ®µè‡ªåŠ¨æ‰§è¡Œï¼Œæœ‰ä¸¥é‡é—®é¢˜å°±é˜»æ­¢æäº¤</li>
<li>å®¡æŸ¥è§„åˆ™æŠ½è±¡ä¸ºÂ rules.jsonÂ é…ç½®</li>
<li>æ¨¡å‹é…ç½®é€šè¿‡Â .env.localÂ ç®¡ç†ï¼Œæ–¹ä¾¿æœ¬åœ°å¼€å‘<br/>
ä½ å¯ä»¥ç›´æ¥æŠŠè¿™é‡Œçš„æ–¹æ¡ˆæ¬è¿›è‡ªå·±çš„é¡¹ç›®ã€‚</li>
</ul>
<h2 data-id="heading-0">åœºæ™¯ä¸ç›®æ ‡</h2>
<p>é—®é¢˜ï¼šå›¢é˜Ÿæ—¥å¸¸å¼€å‘ä¸­ï¼ŒReview èµ„æºæœ‰é™ï¼Œå°é—®é¢˜å®¹æ˜“è¢«æ¼æ‰ï¼Œå¤§é—®é¢˜åˆå¯èƒ½åœ¨åˆå¹¶åæ‰æš´éœ²ã€‚ç›®æ ‡ï¼šåœ¨æ¯æ¬¡Â git commitÂ ä¹‹å‰ï¼Œè®©Â AI å¸®ä½ å¿«é€Ÿè¿‡ä¸€éå˜æ›´ï¼Œæå‰å‘ç°ä¸¥é‡é—®é¢˜ï¼Œå¹¶ç»™å‡ºå¯æ‰§è¡Œçš„æ”¹è¿›å»ºè®®ã€‚æˆ‘ä»¬è®¾è®¡çš„æ–¹æ¡ˆæ»¡è¶³è¿™äº›è¦æ±‚ï¼š</p>
<ul>
<li>åªå®¡æŸ¥æœ¬æ¬¡æäº¤çš„å·²æš‚å­˜æ”¹åŠ¨ï¼ˆStaged Diffï¼‰</li>
<li>AI æŒ‰Â ä¸¥é‡Â / ä¸€èˆ¬ / å»ºè®®Â ä¸‰ä¸ªçº§åˆ«è¾“å‡ºé—®é¢˜</li>
<li>æœ‰ä¸¥é‡é—®é¢˜æ—¶ï¼šé˜»æ­¢æäº¤</li>
<li>æ‰€æœ‰è§„åˆ™ï¼ˆå…³æ³¨ç‚¹ã€æ–‡æ¡ˆã€é˜»æ–­ç­–ç•¥ï¼‰éƒ½å†™åœ¨Â rules.jsonï¼Œåç»­å¯è‡ªå®šä¹‰</li>
<li>æ¨¡å‹ KeyÂ &amp; åœ°å€æ”¾åœ¨Â .env.localï¼Œä¾¿äºæœ¬åœ°ç¯å¢ƒç®¡ç†</li>
</ul>
<h2 data-id="heading-1">é¡¹ç›®åˆå§‹åŒ–</h2>
<p>åœ¨ä¸€ä¸ªç©ºç›®å½•ï¼ˆä¾‹å¦‚Â AI-Codereviewï¼‰ä¸‹ï¼Œæˆ‘ä»¬å…ˆæ‰‹å†™ä¸€ä¸ªç®€å•çš„Â package.jsonï¼š</p>
<pre><code class="hljs language-js" lang="js">{
Â Â <span class="hljs-string">"name"</span>:Â <span class="hljs-string">"ai-codereview"</span>,
Â Â <span class="hljs-string">"version"</span>:Â <span class="hljs-string">"0.1.0"</span>,
Â Â <span class="hljs-string">"description"</span>:Â <span class="hljs-string">"åœ¨Â gitÂ æäº¤æ—¶è°ƒç”¨Â DeepSeekÂ æ¨¡å‹è¿›è¡Œä»£ç è‡ªåŠ¨å®¡æŸ¥çš„ç®€å•å·¥å…·"</span>,
Â Â <span class="hljs-string">"main"</span>:Â <span class="hljs-string">"scripts/deepseek-review.js"</span>,
Â Â <span class="hljs-string">"bin"</span>:Â {
Â Â Â Â <span class="hljs-string">"deepseek-review"</span>:Â <span class="hljs-string">"scripts/deepseek-review.js"</span>
Â Â },
Â Â <span class="hljs-string">"scripts"</span>:Â {
Â Â Â Â <span class="hljs-string">"review"</span>:Â <span class="hljs-string">"nodeÂ scripts/deepseek-review.js"</span>
Â Â },
Â Â <span class="hljs-string">"license"</span>:Â <span class="hljs-string">"MIT"</span>
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªç‚¹ï¼š</p>
<ul>
<li>binÂ å­—æ®µï¼šå°†æ¥å¯ä»¥é€šè¿‡Â npm install -g .Â å®‰è£…æˆå…¨å±€ CLIï¼Œç›´æ¥ç”¨Â deepseek-reviewÂ å‘½ä»¤ã€‚</li>
</ul>

<ul>
<li>scripts.reviewï¼šæ–¹ä¾¿æœ¬åœ°è°ƒè¯•ï¼ŒnpmÂ run reviewÂ å³å¯æ‰§è¡Œå®¡æŸ¥è„šæœ¬ã€‚</li>
</ul>
<h2 data-id="heading-2">æ ¸å¿ƒï¼šDeepSeekÂ ä»£ç å®¡æŸ¥è„šæœ¬</h2>
<p>æˆ‘ä»¬åœ¨Â scripts/deepseek-review.jsÂ é‡Œå®Œæˆå‡ ä»¶äº‹ï¼š</p>
<ol>
<li>åŠ è½½Â .env.localÂ å’Œè§„åˆ™é…ç½®Â rules.json</li>
<li>ä»Â git diff --cachedÂ è¯»å–å½“å‰å·²æš‚å­˜çš„å˜æ›´</li>
<li>æ„é€ ä¸€ä»½å¸¦æœ‰ã€Œè§„åˆ™è¯´æ˜ + è¾“å‡ºæ ¼å¼ã€çš„ Prompt</li>
<li>è°ƒç”¨ DeepSeek Chat API</li>
<li>è§£æ AI è¾“å‡ºä¸­çš„Â BLOCK: YES/NOï¼Œå†³å®šæ˜¯å¦é˜»æ­¢æäº¤</li>
</ol>
<p>ä¸‹é¢æ˜¯éƒ¨åˆ†ä»£ç å®ç°ç»“æ„ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è¯»å–å½“å‰å·²æš‚å­˜çš„ diff</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">cmd</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">execSync</span>(cmd, { <span class="hljs-attr">encoding</span>: <span class="hljs-string">"utf8"</span> }).<span class="hljs-title function_">trim</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getStagedDiff</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">run</span>(<span class="hljs-string">"git diff --cached --unified=0"</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"[deepseek-review] è¯»å– git diff å¤±è´¥ï¼š"</span>, e.<span class="hljs-property">message</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">// æ„é€  Promptï¼ŒæŠŠè§„åˆ™å’Œè¾“å‡ºæ ¼å¼å–‚ç»™æ¨¡å‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildPrompt</span>(<span class="hljs-params">diff, rules</span>) {
  <span class="hljs-keyword">const</span> focusList = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(rules.<span class="hljs-property">focus</span>) &amp;&amp; rules.<span class="hljs-property">focus</span>.<span class="hljs-property">length</span>
    ? rules.<span class="hljs-property">focus</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-string">`- <span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>)
    : <span class="hljs-string">"- é€»è¾‘æ­£ç¡®æ€§ä¸æ½œåœ¨ Bug\n- è¾¹ç•Œæ¡ä»¶ä¸å¼‚å¸¸å¤„ç†\n- æ€§èƒ½é—®é¢˜\n- å®‰å…¨é—®é¢˜\n- å¯ç»´æŠ¤æ€§ä¸å¯è¯»æ€§"</span>;

  <span class="hljs-keyword">const</span> severeDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">severe</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"å¯èƒ½å¯¼è‡´åŠŸèƒ½ä¸å¯ç”¨ã€æ•°æ®æŸåã€å®‰å…¨æ¼æ´æˆ–æ„å»ºå¤±è´¥çš„é—®é¢˜ã€‚"</span>;
  <span class="hljs-keyword">const</span> majorDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">major</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"å¯ä»¥è¿è¡Œï¼Œä½†å­˜åœ¨æ½œåœ¨ Bugã€æ€§èƒ½éšæ‚£æˆ–è¾ƒå¤§ç»´æŠ¤æˆæœ¬çš„é—®é¢˜ã€‚"</span>;
  <span class="hljs-keyword">const</span> suggestionDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">suggestion</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"é£æ ¼ã€å‘½åã€ç»“æ„ä¼˜åŒ–ã€æ›´ä¼˜å†™æ³•ç­‰ã€‚"</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-keyword">of</span> = rules.<span class="hljs-property">outputFormat</span> || {};

  <span class="hljs-keyword">return</span> <span class="hljs-string">`
ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„èµ„æ·±ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œè¯·å®¡æŸ¥ä¸‹é¢è¿™æ¬¡ git æäº¤çš„å˜æ›´ diffã€‚

ã€å®¡æŸ¥é‡ç‚¹ã€‘
<span class="hljs-subst">${focusList}</span>

ã€åˆ†çº§è§„åˆ™ã€‘
- ä¸¥é‡é—®é¢˜ï¼š<span class="hljs-subst">${severeDesc}</span>
- ä¸€èˆ¬é—®é¢˜ï¼š<span class="hljs-subst">${majorDesc}</span>
- å»ºè®®ä¸ä¼˜åŒ–ï¼š<span class="hljs-subst">${suggestionDesc}</span>

ã€è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œæ–¹ä¾¿å·¥å…·è§£æï¼‰ã€‘
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.overview || <span class="hljs-string">"1. æ€»ä½“è¯„ä»·ï¼ˆ1-2 å¥ï¼‰"</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.severe || <span class="hljs-string">"2. ä¸¥é‡é—®é¢˜ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·å†™â€œæ— ä¸¥é‡é—®é¢˜â€ï¼‰\n   - ã€ä¸¥é‡ã€‘æè¿°é—®é¢˜ + æ¶‰åŠçš„æ–‡ä»¶/å¤§è‡´ä½ç½® + åŸå› "</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.major || <span class="hljs-string">"3. ä¸€èˆ¬é—®é¢˜ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·å†™â€œæ— ä¸€èˆ¬é—®é¢˜â€ï¼‰\n   - ã€ä¸€èˆ¬ã€‘æè¿°é—®é¢˜ + æ¶‰åŠçš„æ–‡ä»¶/å¤§è‡´ä½ç½® + åŸå› "</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.suggestion || <span class="hljs-string">"4. å»ºè®®ä¸ä¼˜åŒ–ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥å†™â€œæš‚æ— æ˜æ˜¾ä¼˜åŒ–å»ºè®®â€ï¼‰"</span>}</span>

<span class="hljs-subst">${<span class="hljs-keyword">of</span>.blockRule || <span class="hljs-string">"5. æœ€ç»ˆç»“è®ºï¼ˆåªä¿ç•™ä¸€è¡Œï¼Œä¸”ç”¨è‹±æ–‡ BLOCK æ ‡è®°ï¼Œå¿…é¡»å¤§å†™ï¼‰ï¼š\n   - è‹¥å¿…é¡»åœ¨æäº¤å‰ä¿®å¤ï¼Œè¯·è¾“å‡ºï¼šBLOCK: YES\n   - è‹¥å…è®¸æäº¤ï¼Œä»…ç»™å‡ºå»ºè®®ï¼Œè¯·è¾“å‡ºï¼šBLOCK: NO"</span>}</span>

æ³¨æ„ï¼š
- ä¸è¦è¾“å‡ºé™¤ä¸Šè¿°æ ¼å¼ä»¥å¤–çš„é¢å¤–æ€»ç»“è¡Œã€‚
- â€œBLOCK: YES/NOâ€ å¿…é¡»æ˜¯ç‹¬ç«‹ä¸€è¡Œï¼Œå‰åä¸è¦åŠ å…¶ä»–å­—ç¬¦ã€‚

ä¸‹é¢æ˜¯æœ¬æ¬¡æäº¤çš„ diffï¼ˆç»Ÿä¸€ diff æ ¼å¼ï¼‰ï¼š

<span class="hljs-subst">${diff}</span>
`</span>;
}

<span class="hljs-comment">// è°ƒç”¨ DeepSeek Chat API</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">callDeepseek</span>(<span class="hljs-params">{ apiKey, baseUrl, model, prompt }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> postData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      model,
      <span class="hljs-attr">messages</span>: [
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"system"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªèµ„æ·±ä»£ç å®¡æŸ¥å·¥ç¨‹å¸ˆï¼Œæ“…é•¿å‘ç°é—®é¢˜å¹¶æå‡ºå¯è¡Œå»ºè®®ã€‚"</span> },
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }
      ],
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.2</span>
    });

    <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">"/v1/chat/completions"</span>, baseUrl);

    <span class="hljs-keyword">const</span> options = {
      <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
      <span class="hljs-attr">hostname</span>: url.<span class="hljs-property">hostname</span>,
      <span class="hljs-attr">path</span>: url.<span class="hljs-property">pathname</span>,
      <span class="hljs-attr">port</span>: url.<span class="hljs-property">port</span> || <span class="hljs-number">443</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${apiKey}</span>`</span>,
        <span class="hljs-string">"Content-Length"</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">byteLength</span>(postData)
      }
    };

    <span class="hljs-keyword">const</span> req = https.<span class="hljs-title function_">request</span>(options, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> data = <span class="hljs-string">""</span>;
      res.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> (data += chunk));
      res.<span class="hljs-title function_">on</span>(<span class="hljs-string">"end"</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; res.<span class="hljs-property">statusCode</span> &lt; <span class="hljs-number">300</span>) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
            <span class="hljs-keyword">const</span> content =
              json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>?.<span class="hljs-property">content</span> ||
              json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">text</span> ||
              <span class="hljs-string">""</span>;
            <span class="hljs-title function_">resolve</span>(content.<span class="hljs-title function_">trim</span>());
          } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"è§£æ DeepSeek å“åº”å¤±è´¥ï¼š"</span> + e.<span class="hljs-property">message</span>));
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">reject</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`DeepSeek API å“åº”é”™è¯¯ï¼š<span class="hljs-subst">${res.statusCode}</span> <span class="hljs-subst">${res.statusMessage}</span> <span class="hljs-subst">${data}</span>`</span>)
          );
        }
      });
    });

    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(err));
    req.<span class="hljs-title function_">write</span>(postData);
    req.<span class="hljs-title function_">end</span>();
  });
}

</code></pre>
<p>ä½ å¯ä»¥ç›´æ¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥ï¼š</p>
<ul>
<li>è°ƒæ•´å®¡æŸ¥å…³æ³¨ç‚¹ï¼ˆä¾‹å¦‚æ¢æˆã€Œæ”¯ä»˜æ­£ç¡®æ€§ã€ã€Œæƒé™æ§åˆ¶ã€ç­‰ï¼‰</li>
<li>æ”¹å†™åˆ†çº§è¯´æ˜ï¼Œè´´è¿‘ä½ ä»¬å›¢é˜Ÿçš„è§„èŒƒ</li>
<li>ä¿®æ”¹è¾“å‡ºæ ¼å¼ï¼Œæ¯”å¦‚å¢åŠ æŸä¸ªæ¨¡å—çš„ä¸“é—¨å°èŠ‚</li>
<li>åˆ‡æ¢é»˜è®¤é˜»æ–­ç­–ç•¥ï¼ˆblockOnSevereDefaultï¼‰</li>
</ul>
<h2 data-id="heading-3">æ¨¡å‹é…ç½®é€šè¿‡Â .env.localÂ ç®¡ç†</h2>
<p>ä¸ºäº†é¿å…æŠŠÂ Key å†™æ­»åœ¨ä»£ç æˆ– shell é…ç½®é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨ Next.js å¸¸è§çš„Â .env.localÂ é£æ ¼ï¼š</p>
<pre><code class="hljs language-js" lang="js"># .<span class="hljs-property">env</span>.<span class="hljs-property">local</span>ï¼ˆä¸æäº¤åˆ°ä»“åº“ï¼‰
<span class="hljs-variable constant_">DEEPSEEK_API_KEY</span>=ä½ çš„_API_Key
<span class="hljs-variable constant_">DEEPSEEK_API_BASE</span>=<span class="hljs-attr">https</span>:<span class="hljs-comment">//api.deepseek.com</span>
<span class="hljs-variable constant_">DEEPSEEK_MODEL</span>=deepseek-chat

# æ˜¯å¦åœ¨ä¸¥é‡é—®é¢˜æ—¶é˜»æ­¢æäº¤ï¼ˆ<span class="hljs-number">1</span> é˜»æ­¢ / <span class="hljs-number">0</span> ä¸é˜»æ­¢ï¼‰
<span class="hljs-variable constant_">DEEPSEEK_BLOCK_ON_SEVERE</span>=<span class="hljs-number">1</span>
</code></pre>
<p>è„šæœ¬å¯åŠ¨æ—¶ä¼šï¼š</p>
<ol>
<li>æŸ¥æ‰¾å½“å‰å·¥ä½œç›®å½•çš„Â .env.local</li>
<li>è§£ææ¯ä¸€è¡ŒÂ KEY=VALUEï¼Œå†™å…¥Â process.env</li>
<li>å¦‚æœç³»ç»Ÿç¯å¢ƒå˜é‡é‡Œå·²ç»æœ‰åŒå KEYï¼Œåˆ™ä»¥ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸ºå‡†</li>
</ol>
<p>è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>é€‚åˆå‰ç«¯/Node é¡¹ç›®ç°æœ‰ä¹ æƒ¯</li>
<li>å¯ä»¥æŒ‰ä»“åº“å­˜å‚¨ä¸åŒ Key/é…ç½®</li>
<li>ä¸éœ€è¦å…¨å±€æ±¡æŸ“ shell ç¯å¢ƒ</li>
</ul>
<h2 data-id="heading-4">Git Hookï¼šåœ¨æäº¤å‰è‡ªåŠ¨æ‰§è¡Œå®¡æŸ¥</h2>
<p>æœ€åä¸€æ­¥ï¼ŒæŠŠè„šæœ¬æ¥åˆ° Git çš„Â pre-commitÂ é˜¶æ®µã€‚<br/>
ç”±äºæ˜¯æ‹¿æœ¬é¡¹ç›®æ¥æ‰§è¡ŒéªŒè¯çš„è¿™é‡Œä½¿ç”¨Â .githooks/pre-commitÂ +Â core.hooksPathÂ çš„æ–¹å¼ï¼Œæ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†ã€‚<br/>
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºÂ .githooks/pre-commitï¼š</p>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>sh

# ç®€å•çš„ pre-commit hook ç¤ºä¾‹ï¼š
# åœ¨æ‰§è¡Œ git commit æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ <span class="hljs-title class_">DeepSeek</span> ä»£ç å®¡æŸ¥è„šæœ¬ã€‚

echo <span class="hljs-string">"[pre-commit] è°ƒç”¨ DeepSeek è¿›è¡Œä»£ç å®¡æŸ¥..."</span>

node scripts/deepseek-review.<span class="hljs-property">js</span>
<span class="hljs-variable constant_">STATUS</span>=$?

<span class="hljs-keyword">if</span> [ $STATUS -ne <span class="hljs-number">0</span> ]; then
  echo <span class="hljs-string">"[pre-commit] DeepSeek ä»£ç å®¡æŸ¥è„šæœ¬æ‰§è¡Œå¤±è´¥æˆ–å‘ç°ä¸¥é‡é—®é¢˜ï¼Œç»ˆæ­¢æäº¤ã€‚"</span>
  exit $STATUS
fi

exit <span class="hljs-number">0</span>
</code></pre>
<p>ç„¶ååœ¨ä»“åº“é‡Œå¯ç”¨å®ƒï¼š</p>
<pre><code class="hljs language-shell" lang="shell">git config core.hooksPath .githooks
chmod +x .githooks/pre-commit
chmod +x scripts/deepseek-review.js
</code></pre>
<p>ä»æ­¤ä»¥åï¼Œæ¯æ¬¡åœ¨è¿™ä¸ªä»“åº“é‡Œæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-js" lang="js">git add .
git commit -m <span class="hljs-string">"feat: xxx"</span>
</code></pre>
<p>éƒ½ä¼šè‡ªåŠ¨è§¦å‘ï¼š</p>
<ol>
<li>pre-commitÂ â†’Â node scripts/deepseek-review.js</li>
<li>è„šæœ¬è¯»å–Â git diff --cached</li>
<li>è°ƒç”¨ DeepSeek â†’ æŒ‰è§„åˆ™åˆ†çº§è¾“å‡ºé—®é¢˜ï¼Œå¹¶åœ¨æœ«å°¾ç»™å‡ºÂ BLOCK: YES/NO</li>
<li>å¦‚æœæ˜¯Â BLOCK: YESÂ ä¸”å½“å‰è§„åˆ™/ç¯å¢ƒè¦æ±‚é˜»æ–­ â†’ æœ¬æ¬¡æäº¤ç›´æ¥å¤±è´¥</li>
</ol>
<h2 data-id="heading-5">å®¡æ ¸ç¤ºä¾‹</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c803d2f19b14939894a2225e81c8693~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0FMQQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380355&amp;x-signature=BkZyB8MTQkArS%2F3xwa80CovcbjI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">æ€»ç»“ä¸ä¸€äº›å»¶ä¼¸æƒ³æ³•</h2>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è½åœ°äº†ä¸€å¥—æœ¬åœ°å¯é…ç½®çš„ AI Code Review æµç¨‹ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>ä¸ Git å¼ºç»‘å®šï¼šåœ¨æäº¤å‰æå‰æ‹¦æˆªä¸¥é‡é—®é¢˜</li>
<li>è§„åˆ™å¯é…ç½®ï¼šé€šè¿‡Â rules.jsonÂ æŠ½è±¡äº†å®¡æŸ¥ç»´åº¦å’Œåˆ†çº§</li>
<li>æ¨¡å‹å¯é…ç½®ï¼šæ¨¡å‹ä¿¡æ¯æ”¾åœ¨Â .env.localï¼Œç¬¦åˆå‰ç«¯/Node ç”Ÿæ€çš„ä¹ æƒ¯</li>
<li>è¡Œä¸ºå¯è°ƒï¼šæ—¢å¯ä»¥å¼ºåˆ¶é˜»æ–­ä¸¥é‡é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨å¼€å‘æ—©æœŸåªåšã€Œæç¤ºä¸é˜»æ–­ã€</li>
</ul>
<p>åŸºäºè¿™å¥—ç»“æ„ï¼Œä½ è¿˜å¯ä»¥ç»§ç»­æ‰©å±•ï¼š</p>
<ul>
<li>é’ˆå¯¹ä¸åŒåˆ†æ”¯ï¼ˆmainÂ /Â devï¼‰é€‰æ‹©ä¸åŒçš„è§„åˆ™æ–‡ä»¶</li>
<li>åœ¨å®¡æŸ¥ç»“æœä¸­å¢åŠ ä»£ç ç¤ºä¾‹æˆ–é‡æ„å»ºè®®æ¨¡æ¿</li>
<li>å°†ç»“æœåŒæ­¥åˆ° Git å¹³å°ï¼ˆGitLab MR comment / GitHub PR commentï¼‰</li>
</ul>
<p>ç”±äºå·¥å…·å½“å‰åªæ˜¯ 0.1.0 ç‰ˆæœ¬è¿˜æœ‰å¾ˆå¤šå¾…æ”¹è¿›çš„åœ°æ–¹ï¼Œåç»­å°†ä¸æ–­ä¼˜åŒ–æ”¹è¿›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue5]]></title>    <link>https://juejin.cn/post/7579496954251231272</link>    <guid>https://juejin.cn/post/7579496954251231272</guid>    <pubDate>2025-12-03T14:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579496954251231272" data-draft-id="7574626451749437440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue5"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T14:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å’ªåº“å’ªåº“å’ª"/> <meta itemprop="url" content="https://juejin.cn/user/3725578141445959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue5
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3725578141445959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å’ªåº“å’ªåº“å’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:35:54.000Z" title="Wed Dec 03 2025 14:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">el-container</h2>
<p>el-containeræ˜¯ElementPlusä¸­çš„<strong>å¸ƒå±€å®¹å™¨ç»„ä»¶</strong>ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿæ„å»ºåŸºç¡€å¸ƒå±€ç»“æ„ï¼Œæ¯”å¦‚ï¼šé¡¶éƒ¨-ä¸»ä½“-åº•éƒ¨ï¼Œä¾§è¾¹æ -ä¸»ä½“ç­‰å¸¸è§é¡µé¢ç»“æ„ã€‚<strong>æŠŠé¡µé¢æŒ‰ç…§ä¸Šä¸‹æˆ–å·¦å³æ–¹å‘ç»„ç»‡èµ·æ¥ï¼Œè®©å¸ƒå±€å˜å¾—ç®€å•ã€æ¸…æ™°ã€å¯è¯»æ€§é«˜ã€‚</strong></p>
<p>å®ƒé€šå¸¸å’Œä»¥ä¸‹ç»„ä»¶ä¸€èµ·ä½¿ç”¨ï¼š</p>
<ul>
<li>el-header: é¡µå¤´åŒºåŸŸ</li>
<li>el-aside: ä¾§è¾¹æ åŒºåŸŸ</li>
<li>el-main: ä¸»ä½“å†…å®¹åŒºåŸŸ</li>
<li>el-footer: é¡µè„šåŒºåŸŸ</li>
</ul>
<h3 data-id="heading-1">åŸºæœ¬ç”¨æ³•ä¸¾ä¾‹</h3>
<h4 data-id="heading-2">ä¸Šä¸‹å¸ƒå±€ï¼ˆHeader + Mainï¼‰</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-header</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">el-header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">å·¦å³å¸ƒå±€ï¼ˆAside + Mainï¼‰</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-aside</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200px"</span>&gt;</span>Aside<span class="hljs-tag">&lt;/<span class="hljs-name">el-aside</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
</code></pre>
<h2 data-id="heading-4">v-if</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!['mixin'].includes(appStore.layoutMode)"</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>om<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>OM OS<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>
</code></pre>
<p>v-if æ˜¯vueæä¾›çš„<strong>æ¡ä»¶æ¸²æŸ“æŒ‡ä»¤</strong>ï¼Œä½œç”¨æ˜¯<strong>æ ¹æ®è¡¨è¾¾å¼çš„çœŸå‡æ¥å†³å®šæ˜¯å¦æ¸²æŸ“è¿™ä¸ªå…ƒç´ ï¼ˆæˆ–ç»„ä»¶ï¼‰</strong>ã€‚å½“è¡¨è¾¾å¼ä¸ºfalseæ—¶ï¼Œvueä¼šå®Œå…¨ç§»é™¤è¿™ä¸ªå…ƒç´ ï¼Œä¸ä¼šå‡ºç°åœ¨DOMä¸­ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“layoutModeä¸­ä¸å«mixinæ—¶ï¼Œomä¸ä¼šè¢«æ¸²æŸ“ï¼Œæ˜¾ç¤ºçš„æ–‡æœ¬æ˜¯OM OS</p>
<p>åŒç†ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mode==='horizontal'"</span>&gt;</span>
......
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mode === 'vertical'"</span>&gt;</span>
......
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>ä¹Ÿæ˜¯åœ¨ç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œtemplateæ‰ä¼šè¢«æ¸²æŸ“</p>
<p>è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆç”¨templateï¼Œä¸»è¦æ˜¯å› ä¸º<strong>v-ifåªèƒ½ç»‘å®šåœ¨ä¸€ä¸ªå…ƒç´ ä¸Š</strong>ï¼Œä½†æœ‰æ—¶ä½ å¿…é¡»åŒ…ä½å¤šä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥vueæä¾›<code>&lt;template v-if="condition"&gt;</code>ç”¨äºå¯¹å¤šä¸ªå­å…ƒç´ ç»Ÿä¸€æ§åˆ¶æ˜¾ç¤º/éšè—</p>
<p>è¿™é‡Œä¸ç”¨divçš„åŸå› æ˜¯ï¼Œ<strong>template ä¸ä¼šæ¸²æŸ“æ ‡ç­¾å†…å®¹ï¼Œåªä¼šæ¸²æŸ“å†…éƒ¨å†…å®¹</strong>ï¼Œè€Œdivä¼šåœ¨é¡µé¢ä¸­æ¸²æŸ“ä¸€ä¸ªå®é™…çš„div</p>
<h2 data-id="heading-5">åŠ¨æ€ç»‘å®šcss</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#373839"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-bar-left-icon"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{'is-active':appStore.sidebar.opened}"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"å±•å¼€"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Expand</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#373839"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-bar-left-icon"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{'is-active':!appStore.sidebar.opened}"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"æŠ˜å "</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Fold</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.bar-left-ex</span> {
Â  Â  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;

Â  Â  <span class="hljs-selector-class">.nav-bar-left-icon</span> {
        â€¦â€¦
Â  Â  Â }

  
Â  Â  <span class="hljs-selector-class">.is-active</span> {
Â  Â  Â  <span class="hljs-attribute">display</span>: none;
Â  Â  }

}
</code></pre>
<p>è¿™é‡Œ<code>:class="{'is-active': appStore.sidebar.opened}</code>æ˜¯åŠ¨æ€Classç»‘å®šï¼Œå†™æ³•å«ä¹‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">'is-active'</span>: appStore.<span class="hljs-property">sidebar</span>.<span class="hljs-property">opened</span>
}
</code></pre>
<ul>
<li>å¦‚æœ<code>appStore.sidebar.opened === true</code> -&gt; ç»™è¿™ä¸ªå…ƒç´ æ·»åŠ <code>is-active</code>class</li>
<li>å¦‚æœä¸ºfalse -&gt; ä¸æ·»åŠ </li>
</ul>
<p>é€šè¿‡æ”¹å˜appStore.sidebar.openedçš„å€¼ï¼Œæ¥ä½¿el-iconæ˜¾ç¤ºæˆ–è€…ä¸æ˜¾ç¤º</p>
<h2 data-id="heading-6">el-scrollbar</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"hor-menu"</span>
        <span class="hljs-attr">:mode</span>=<span class="hljs-string">"mode"</span>
        <span class="hljs-attr">ellipsis</span>
        <span class="hljs-attr">:default-active</span>=<span class="hljs-string">"currentRoute.path"</span>
        <span class="hljs-attr">background-color</span>=<span class="hljs-string">"transparent"</span>
Â  Â  Â  Â  &gt;</span>
Â  Â  Â  Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">MenuItems</span> <span class="hljs-attr">:routes</span>=<span class="hljs-string">"filteredRoutes"</span>/&gt;</span>
Â  Â  Â  Â  <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span>
</code></pre>
<ul>
<li>el-scrollbar</li>
</ul>
<p>ElementPlusæä¾›çš„èœå•æ»šåŠ¨å®¹å™¨ï¼Œå¦‚æœèœå•å¤ªé•¿ï¼Œè¶…è¿‡å±å¹•å®½åº¦ï¼Œä¼šå‡ºç°æ»šåŠ¨åŒºåŸŸï¼Œè€Œä¸æ˜¯æŒ¤åˆ°ä¸€è¡Œæ˜¾ç¤ºä¸ä¸‹ã€‚</p>
<ul>
<li>el-menuï¼šElementPlusèœå•ç»„ä»¶
<ul>
<li>
<p>:mode="mode"
æŒ‡å®šèœå•æ¨¡å¼ï¼Œhorizontal-&gt;æ¨ªå‘èœå•ï¼ˆç”¨äºé¡¶éƒ¨å¯¼èˆªï¼‰ï¼Œvertical-&gt;çºµå‘èœå•ï¼ˆç”¨äºä¾§è¾¹æ ï¼‰</p>
</li>
<li>
<p>ellipsisï¼šElementPlusè‡ªå¸¦å±æ€§ï¼Œå¼€å¯æ–‡å­—è¿‡é•¿æ—¶çš„çœç•¥å·æ•ˆæœ</p>
</li>
<li>
<p><code>:default-active="currentRoute.path"</code>ï¼šèœå•é»˜è®¤é€‰ä¸­å½“å‰è·¯ç”±å¯¹åº”çš„èœå•é¡¹ï¼Œä¾‹å¦‚å½“å‰è·¯ç”± <code>/home</code>ï¼Œé‚£ä¹ˆ <code>"/home"</code> çš„èœå•é¡¹ä¼šé«˜äº®ï¼Œ<strong>èœå•éšç€è·¯ç”±å˜åŒ–è‡ªåŠ¨æ›´æ–°çŠ¶æ€</strong>ã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">å¯¼èˆªæ </h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">mode</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-string">'vertical'</span>
        <span class="hljs-comment">// default: 'horizontal'</span>
    }
})
</code></pre>
<h3 data-id="heading-8">prop</h3>
<p>propï¼š<strong>çˆ¶ç»„ä»¶ä¼ ç»™å­ç»„ä»¶çš„æ•°æ®</strong>ï¼Œå°±åƒå‡½æ•°çš„å‚æ•°ï¼Œç»„ä»¶ä¹Ÿéœ€è¦å‚æ•°æ‰èƒ½çŸ¥é“è¯¥æ€ä¹ˆå·¥ä½œï¼Œè€Œpropså°±æ˜¯è¿™ä¸ªå‚æ•°</p>
<ul>
<li>ä¸ºä»€ä¹ˆéœ€è¦props?</li>
</ul>
<p>å› ä¸ºç»„ä»¶æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä¸èƒ½åœ¨ç»„ä»¶é‡Œå†™æ­»æ•°æ®ï¼Œä¾‹å¦‚åšä¸€ä¸ªæŒ‰é’®ç»„ä»¶<code>&lt;MyButton&gt;</code></p>
<ul>
<li>æœ‰çš„æŒ‰é’®æ˜¯çº¢è‰²</li>
<li>æœ‰çš„æ˜¯ç»¿è‰²</li>
<li>æœ‰çš„æ˜¯å¤§æŒ‰é’®</li>
<li>æœ‰çš„æ˜¯å°æŒ‰é’®</li>
</ul>
<p>å¦‚æœéƒ½å†™æ­»ï¼Œé‚£ç»„ä»¶å°±æ²¡æ³•å¤ç”¨äº†</p>
<p>æ‰€ä»¥propsè®©è¿™æ ·ç”¨ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"red"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"green"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> /&gt;</span>
</code></pre>
<h3 data-id="heading-9">vueä¸­å¦‚ä½•å®šä¹‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">color</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-title class_">String</span>
})
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<p>å­ç»„ä»¶:</p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">mode</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'vertical'</span>
  }
})
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å½“å‰æ¨¡å¼ï¼š{{ props.mode }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<p>çˆ¶ç»„ä»¶åªæ˜¯ä¼ å€¼ï¼Œä¸å®šä¹‰props</p>
<pre><code class="hljs language-js" lang="js">&lt;<span class="hljs-title class_">MyMenu</span> mode=<span class="hljs-string">"horizontal"</span> /&gt;

</code></pre>
<blockquote>
<p>é™¤äº†çˆ¶ç»„ä»¶ï¼Œä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹props
å› ä¸ºvueçš„è®¾è®¡ç†å¿µæ˜¯ï¼šçˆ¶ç»„ä»¶è´Ÿè´£æ•°æ®ï¼Œå­ç»„ä»¶è´Ÿè´£å±•ç¤ºå’Œé€»è¾‘ï¼Œå­ç»„ä»¶ä¸èƒ½ç§è‡ªç¯¡æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®</p>
</blockquote>
<h2 data-id="heading-10">v-model</h2>
<p><strong>v-model = æŠŠç»„ä»¶çš„å€¼å’Œå˜é‡åšåŒå‘ç»‘å®š</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"default"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"appStore.watermarking"</span> Â @<span class="hljs-attr">change</span>=<span class="hljs-string">"appStore.changeWatermarking()"</span>/&gt;</span>
</code></pre>
<p>å³ï¼š</p>
<ul>
<li><code>el-switch</code> æ˜¾ç¤ºçš„å¼€/å…³çŠ¶æ€ = <code>appStore.watermarking</code></li>
<li>ä½ ç‚¹å‡» switch â†’ Element Plus è‡ªåŠ¨æŠŠæ–°å€¼å†™å› <code>appStore.watermarking</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç‚¹switchçš„åŒæ—¶ï¼ŒElementPlusè‡ªåŠ¨æ‰§è¡Œ<code>appStore.watermarking = true/false</code></p>
<p>@changeè¿™é‡Œç”¨æ¥è¿›è¡Œä¸€äº›å­˜æ•°æ®åº“æˆ–å‘æ—¥å¿—ç­‰è¾…åŠ©æ“ä½œï¼š</p>
<pre><code class="hljs language-html" lang="html">const changeWatermarking = () =&gt; {
Â  Â  Â  Â  dbUtils.set('watermarking', watermarking.value);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite ç¯å¢ƒå˜é‡é…ç½®ç»éªŒæ€»ç»“]]></title>    <link>https://juejin.cn/post/7579441333166866441</link>    <guid>https://juejin.cn/post/7579441333166866441</guid>    <pubDate>2025-12-03T14:50:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166866441" data-draft-id="7579641251910123530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite ç¯å¢ƒå˜é‡é…ç½®ç»éªŒæ€»ç»“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T14:50:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¡ç¥é›¾é›¨"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102705000"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite ç¯å¢ƒå˜é‡é…ç½®ç»éªŒæ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102705000/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¡ç¥é›¾é›¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:50:34.000Z" title="Wed Dec 03 2025 14:50:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç›®å½•</h2>
<ol>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" title="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">å¿«é€Ÿå¼€å§‹</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" title="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">æ ¸å¿ƒæ¦‚å¿µ</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" title="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">ç¯å¢ƒå˜é‡æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%AF%B9%E5%BA%94" title="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%AF%B9%E5%BA%94">å‘½ä»¤ä¸ç¯å¢ƒå¯¹åº”</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">æœ€ä½³å®è·µ</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">å¸¸è§é—®é¢˜</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%85%B6%E4%BB%96%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F" title="#%E6%89%A9%E5%B1%95%E5%85%B6%E4%BB%96%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">æ‰©å±•ï¼šå…¶ä»–åŠ è½½æ–¹å¼</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">å¿«é€Ÿå¼€å§‹</h2>
<h3 data-id="heading-2">ä¸‰æ­¥ä¸Šæ‰‹</h3>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º <code>.env</code> æ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .env.development</span>
VITE_API_URL=http://localhost:3000

<span class="hljs-comment"># .env.production</span>
VITE_API_URL=https://api.example.com
</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šåœ¨ä»£ç ä¸­è®¿é—®</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä»»æ„ .vueã€.tsxã€.js æ–‡ä»¶ä¸­</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(apiUrl); <span class="hljs-comment">// å¼€å‘ç¯å¢ƒè¾“å‡º: http://localhost:3000</span>
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œé¡¹ç›®</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm run dev    <span class="hljs-comment"># è‡ªåŠ¨åŠ è½½ .env.development</span>
npm run build  <span class="hljs-comment"># è‡ªåŠ¨åŠ è½½ .env.production</span>
</code></pre>
<h3 data-id="heading-3">æ ¸å¿ƒè¦ç‚¹</h3>
<ul>
<li>âœ… å˜é‡åå¿…é¡»ä»¥ <code>VITE_</code> å¼€å¤´</li>
<li>âœ… ä¿®æ”¹ <code>.env</code> æ–‡ä»¶åéœ€é‡å¯å¼€å‘æœåŠ¡å™¨</li>
<li>âœ… ä½¿ç”¨ <code>import.meta.env.å˜é‡å</code> è®¿é—®</li>
</ul>
<hr/>
<h2 data-id="heading-4">æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-5">Vite ç¯å¢ƒå˜é‡çš„å·¥ä½œåŸç†</h3>
<p>Vite åœ¨æ„å»ºæ—¶ä¼šè¯»å– <code>.env</code> æ–‡ä»¶ï¼Œå¹¶å°†ç¯å¢ƒå˜é‡æ³¨å…¥åˆ°ä½ çš„åº”ç”¨ä¸­ã€‚</p>
<p><strong>å…³é”®ç‰¹æ€§ï¼š</strong></p>
<ol>
<li><strong>å‰ç¼€é™åˆ¶</strong>ï¼šåªæœ‰ä»¥ <code>VITE_</code> å¼€å¤´çš„å˜é‡æ‰ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ä»£ç </li>
<li><strong>æ„å»ºæ—¶æ³¨å…¥</strong>ï¼šç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶å°±å·²ç»è¢«é™æ€æ›¿æ¢åˆ°ä»£ç ä¸­</li>
<li><strong>æ¨¡å¼é©±åŠ¨</strong>ï¼šé€šè¿‡ <code>mode</code> å‚æ•°å†³å®šåŠ è½½å“ªä¸ª <code>.env.[mode]</code> æ–‡ä»¶</li>
</ol>
<h3 data-id="heading-6">ä¸ºä»€ä¹ˆéœ€è¦ <code>VITE_</code> å‰ç¼€ï¼Ÿ</h3>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>å®‰å…¨æœºåˆ¶</strong>ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“å¯†ç ã€API å¯†é’¥ï¼‰æ„å¤–æš´éœ²åˆ°å®¢æˆ·ç«¯ä»£ç ä¸­ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># âœ… ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯</span>
VITE_API_URL=https://api.example.com

<span class="hljs-comment"># âŒ ä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ï¼ˆä»…åœ¨ vite.config.ts ä¸­å¯ç”¨ï¼‰</span>
DATABASE_PASSWORD=secret123
API_SECRET_KEY=xyz789
</code></pre>
<h3 data-id="heading-7">ä¸¤ç§è®¿é—®æ–¹å¼</h3>
<p><strong>å®¢æˆ·ç«¯ä»£ç ï¼ˆæµè§ˆå™¨ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åªèƒ½è®¿é—® VITE_ å¼€å¤´çš„å˜é‡</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;
<span class="hljs-keyword">const</span> mode = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span>;
<span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>;
</code></pre>
<p><strong>é…ç½®æ–‡ä»¶ï¼ˆNode.jsï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts - å¯ä»¥è®¿é—®æ‰€æœ‰å˜é‡</span>
<span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">''</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env.<span class="hljs-property">VITE_API_URL</span>);      <span class="hljs-comment">// âœ… å¯ä»¥è®¿é—®</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env.<span class="hljs-property">DATABASE_PASSWORD</span>);  <span class="hljs-comment">// âœ… ä¹Ÿå¯ä»¥è®¿é—®</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-comment">/* ... */</span> };
});
</code></pre>
<hr/>
<h2 data-id="heading-8">ç¯å¢ƒå˜é‡æ–‡ä»¶ç³»ç»Ÿ</h2>
<h3 data-id="heading-9">æ–‡ä»¶å‘½åè§„åˆ™</h3>
<p>Vite æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆæŒ‰ä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">1. .<span class="hljs-built_in">env</span>                    <span class="hljs-comment"># æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šåŠ è½½ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰</span>
2. .env.local              <span class="hljs-comment"># æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šåŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥</span>
3. .<span class="hljs-built_in">env</span>.[mode]             <span class="hljs-comment"># åªåœ¨æŒ‡å®š mode æ—¶åŠ è½½</span>
4. .<span class="hljs-built_in">env</span>.[mode].<span class="hljs-built_in">local</span>       <span class="hljs-comment"># åªåœ¨æŒ‡å®š mode æ—¶åŠ è½½ï¼Œä½†ä¼šè¢« git å¿½ç•¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰</span>
</code></pre>
<h3 data-id="heading-10">åŠ è½½é¡ºåº</h3>
<p><strong>ååŠ è½½çš„æ–‡ä»¶ä¼šè¦†ç›–å‰é¢åŠ è½½çš„æ–‡ä»¶ä¸­ç›¸åŒçš„å˜é‡</strong></p>
<p>ç¤ºä¾‹ï¼šè¿è¡Œ <code>vite --mode development</code> æ—¶</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> .env                    â†’ åŠ è½½ï¼ˆåŸºç¡€é…ç½®ï¼‰
<span class="hljs-bullet">2.</span> .env.local              â†’ åŠ è½½ï¼ˆæœ¬åœ°è¦†ç›–ï¼Œå¦‚æœå­˜åœ¨ï¼‰
<span class="hljs-bullet">3.</span> .env.development        â†’ åŠ è½½ï¼ˆå¼€å‘ç¯å¢ƒé…ç½®ï¼‰
<span class="hljs-bullet">4.</span> .env.development.local  â†’ åŠ è½½ï¼ˆå¼€å‘ç¯å¢ƒæœ¬åœ°è¦†ç›–ï¼Œå¦‚æœå­˜åœ¨ï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼‰
</code></pre>
<h3 data-id="heading-11">æ–‡ä»¶ä¼˜å…ˆçº§è¡¨</h3>















































<table><thead><tr><th>ä¼˜å…ˆçº§</th><th>æ–‡ä»¶å</th><th>ä½•æ—¶åŠ è½½</th><th>Git çŠ¶æ€</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>1ï¼ˆæœ€ä½ï¼‰</td><td><code>.env</code></td><td>æ‰€æœ‰æ¨¡å¼</td><td>é€šå¸¸æäº¤</td><td>å…¬å…±é…ç½®</td></tr><tr><td>2</td><td><code>.env.local</code></td><td>æ‰€æœ‰æ¨¡å¼</td><td>ä¸æäº¤</td><td>æœ¬åœ°å…¬å…±è¦†ç›–</td></tr><tr><td>3</td><td><code>.env.[mode]</code></td><td>æŒ‡å®š mode</td><td>é€šå¸¸æäº¤</td><td>ç¯å¢ƒç‰¹å®šé…ç½®</td></tr><tr><td>4ï¼ˆæœ€é«˜ï¼‰</td><td><code>.env.[mode].local</code></td><td>æŒ‡å®š mode</td><td>ä¸æäº¤</td><td>ç¯å¢ƒç‰¹å®šæœ¬åœ°è¦†ç›–</td></tr><tr><td>-</td><td><code>.env.example</code></td><td><strong>ä»ä¸åŠ è½½</strong></td><td>æäº¤</td><td>ä»…ä½œç¤ºä¾‹æ¨¡æ¿</td></tr></tbody></table>
<h3 data-id="heading-12"><code>.env.example</code> è¯´æ˜</h3>
<p><strong><code>.env.example</code> æ–‡ä»¶ä¸ä¼šè¢« Vite è‡ªåŠ¨è¯»å–</strong>ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç¤ºä¾‹æ¨¡æ¿æ–‡ä»¶ï¼Œç”¨äºï¼š</p>
<ul>
<li>å‘Šè¯‰å¼€å‘è€…éœ€è¦é…ç½®å“ªäº›ç¯å¢ƒå˜é‡</li>
<li>ä½œä¸ºæ–‡æ¡£è¯´æ˜</li>
<li>é€šå¸¸æäº¤åˆ° Git ä»“åº“</li>
<li>å¼€å‘è€…å¯ä»¥å¤åˆ¶å®ƒæ¥åˆ›å»ºå®é™…çš„ <code>.env</code> æ–‡ä»¶</li>
</ul>
<hr/>
<h2 data-id="heading-13">å‘½ä»¤ä¸ç¯å¢ƒå¯¹åº”</h2>
<h3 data-id="heading-14">é»˜è®¤å‘½ä»¤è¡Œä¸º</h3>



































<table><thead><tr><th>å‘½ä»¤</th><th>NODE_ENV</th><th>mode</th><th>è¯»å–çš„ .env æ–‡ä»¶</th></tr></thead><tbody><tr><td><code>vite</code></td><td><code>development</code></td><td><code>development</code></td><td><code>.env</code> â†’ <code>.env.local</code> â†’ <code>.env.development</code> â†’ <code>.env.development.local</code></td></tr><tr><td><code>vite build</code></td><td><code>production</code></td><td><code>production</code></td><td><code>.env</code> â†’ <code>.env.local</code> â†’ <code>.env.production</code> â†’ <code>.env.production.local</code></td></tr><tr><td><code>vite preview</code></td><td><code>production</code></td><td><code>production</code></td><td><strong>ä¸è¯»å–</strong>ï¼ˆä½¿ç”¨æ„å»ºæ—¶çš„å€¼ï¼‰</td></tr><tr><td><code>vitest</code></td><td><code>test</code></td><td><code>test</code></td><td><code>.env</code> â†’ <code>.env.local</code> â†’ <code>.env.test</code> â†’ <code>.env.test.local</code></td></tr></tbody></table>
<h3 data-id="heading-15">è¡¥å……è¯´æ˜ 1ï¼š<code>vite preview</code> ä¸è¯»å–ç¯å¢ƒå˜é‡</h3>
<p><strong><code>vite preview</code> ä¸ä¼šè¯»å–æ–°çš„ <code>.env</code> æ–‡ä»¶</strong>ï¼ŒåŸå› ï¼š</p>
<ul>
<li><code>vite preview</code> åªæ˜¯é¢„è§ˆå·²ç»æ„å»ºå¥½çš„ <code>dist</code> ç›®å½•</li>
<li>ç¯å¢ƒå˜é‡åœ¨ <code>vite build</code> æ—¶å°±å·²ç»æ³¨å…¥åˆ°ä»£ç ä¸­</li>
<li><code>preview</code> é˜¶æ®µä¸ä¼šé‡æ–°æ„å»ºï¼Œæ‰€ä»¥ä¸ä¼šé‡æ–°è¯»å– <code>.env</code></li>
</ul>
<p>å¦‚æœéœ€è¦ä¸åŒçš„é¢„è§ˆç¯å¢ƒï¼Œéœ€è¦åœ¨æ„å»ºæ—¶æŒ‡å®šä¸åŒçš„ <code>--mode</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ„å»ºæ—¶ä½¿ç”¨ä¸åŒçš„ mode</span>
vite build --mode staging
vite preview
</code></pre>
<h3 data-id="heading-16">è¡¥å……è¯´æ˜ 2ï¼šNODE_ENV vs mode</h3>
<p>ç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œä¸Šé¢çš„è¡¨æ ¼ä¸­æœ‰ <code>NODE_ENV</code> å’Œ <code>mode</code> ä¸¤åˆ—ï¼Œå®ƒä»¬æ˜¯<strong>ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µ</strong>ï¼Œå®¹æ˜“æ··æ·†ï¼š</p>
<p><strong><code>process.env.NODE_ENV</code></strong></p>
<ul>
<li>Node.js ç¯å¢ƒå˜é‡ï¼Œæ§åˆ¶æ„å»ºä¼˜åŒ–ï¼ˆä»£ç å‹ç¼©ã€tree-shakingï¼‰</li>
<li>ç”± Vite æ ¹æ®å‘½ä»¤è‡ªåŠ¨è®¾ç½®ï¼š<code>vite</code> â†’ <code>development</code>ï¼Œ<code>vite build</code> â†’ <code>production</code></li>
<li>åœ¨ <code>vite.config.ts</code> ä¸­é€šè¿‡ <code>process.env.NODE_ENV</code> è®¿é—®</li>
</ul>
<p><strong><code>mode</code>ï¼ˆæ¨¡å¼ï¼‰</strong></p>
<ul>
<li>Vite çš„æ¨¡å¼å‚æ•°ï¼Œå†³å®šåŠ è½½å“ªä¸ª <code>.env.[mode]</code> æ–‡ä»¶</li>
<li>å¯ä»¥æ˜¯ä»»æ„è‡ªå®šä¹‰å€¼ï¼ˆå¦‚ <code>staging</code>ã€<code>test</code>ï¼‰</li>
<li>é€šè¿‡ <code>--mode</code> å‚æ•°æŒ‡å®šï¼Œåœ¨å®¢æˆ·ç«¯é€šè¿‡ <code>import.meta.env.MODE</code> è®¿é—®</li>
</ul>
<p><strong>å…³é”®åŒºåˆ«ï¼š</strong></p>



































<table><thead><tr><th>å‘½ä»¤</th><th>NODE_ENV</th><th>mode</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>vite</code></td><td><code>development</code></td><td><code>development</code></td><td>é»˜è®¤ç›¸åŒ</td></tr><tr><td><code>vite build</code></td><td><code>production</code></td><td><code>production</code></td><td>é»˜è®¤ç›¸åŒ</td></tr><tr><td><code>vite build --mode staging</code></td><td><code>production</code></td><td><code>staging</code></td><td><strong>å¯ä»¥ä¸åŒ</strong> âš ï¸</td></tr><tr><td><code>NODE_ENV=test vite build</code></td><td><code>test</code></td><td><code>production</code></td><td><strong>å¯ä»¥ä¸åŒ</strong> âš ï¸</td></tr></tbody></table>
<p>ğŸ’¡ <strong>æ¨èåšæ³•</strong>ï¼šåœ¨ Vite é¡¹ç›®ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨ <code>import.meta.env.MODE</code> æ¥åˆ¤æ–­ç¯å¢ƒï¼Œè€Œä¸æ˜¯ä¾èµ– <code>process.env.NODE_ENV</code>ã€‚</p>
<hr/>
<h2 data-id="heading-17">æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-18">1. å®Œæ•´çš„æ–‡ä»¶ç»“æ„</h3>
<pre><code class="hljs language-bash" lang="bash">project/
â”œâ”€â”€ .<span class="hljs-built_in">env</span>                    <span class="hljs-comment"># æ‰€æœ‰ç¯å¢ƒçš„å…¬å…±é…ç½®ï¼ˆæäº¤ï¼‰</span>
â”œâ”€â”€ .env.development        <span class="hljs-comment"># å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆæäº¤ï¼‰</span>
â”œâ”€â”€ .env.production         <span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæäº¤ï¼‰</span>
â”œâ”€â”€ .env.local             <span class="hljs-comment"># æœ¬åœ°è¦†ç›–é…ç½®ï¼ˆä¸æäº¤ï¼‰</span>
â”œâ”€â”€ .env.example           <span class="hljs-comment"># ç¤ºä¾‹æ¨¡æ¿ï¼ˆæäº¤ï¼‰</span>
â””â”€â”€ .gitignore             <span class="hljs-comment"># æ·»åŠ  .env*.local</span>
</code></pre>
<p><strong>ç¤ºä¾‹å†…å®¹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .env - å…¬å…±é…ç½®</span>
VITE_APP_NAME=My App

<span class="hljs-comment"># .env.development</span>
VITE_API_URL=http://localhost:3000
VITE_DEBUG=<span class="hljs-literal">true</span>

<span class="hljs-comment"># .env.production</span>
VITE_API_URL=https://api.example.com
VITE_DEBUG=<span class="hljs-literal">false</span>

<span class="hljs-comment"># .env.example - ç¤ºä¾‹æ¨¡æ¿</span>
VITE_API_URL=
VITE_APP_NAME=
</code></pre>
<h3 data-id="heading-19">2. å‘½åè§„èŒƒ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># âœ… æ­£ç¡®å†™æ³•</span>
VITE_API_BASE_URL=https://api.example.com
VITE_APP_TITLE=My App
VITE_ENABLE_MOCK=<span class="hljs-literal">true</span>

<span class="hljs-comment"># âŒ é”™è¯¯å†™æ³•ï¼ˆå®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼‰</span>
API_BASE_URL=https://api.example.com
appTitle=My App
</code></pre>
<p><strong>è§„åˆ™ï¼š</strong></p>
<ul>
<li>å¿…é¡»ä»¥ <code>VITE_</code> å¼€å¤´</li>
<li>ä½¿ç”¨å…¨å¤§å†™å­—æ¯</li>
<li>å•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”</li>
</ul>
<h3 data-id="heading-20">3. å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è®¿é—®ç¯å¢ƒå˜é‡</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;

<span class="hljs-comment">// å†…ç½®å˜é‡</span>
<span class="hljs-keyword">const</span> mode = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span>;       <span class="hljs-comment">// å½“å‰æ¨¡å¼</span>
<span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>;       <span class="hljs-comment">// æ˜¯å¦å¼€å‘ç¯å¢ƒ</span>
<span class="hljs-keyword">const</span> isProd = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span>;     <span class="hljs-comment">// æ˜¯å¦ç”Ÿäº§ç¯å¢ƒ</span>
<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>; <span class="hljs-comment">// å…¬å…±åŸºç¡€è·¯å¾„</span>

<span class="hljs-comment">// å¸¦é»˜è®¤å€¼</span>
<span class="hljs-keyword">const</span> debug = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEBUG</span> || <span class="hljs-string">'false'</span>;
</code></pre>
<h3 data-id="heading-21">4. åœ¨ vite.config.ts ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-comment">// åŠ è½½ç¯å¢ƒå˜é‡</span>
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">''</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// æ–¹å¼1: ä½¿ç”¨ define æ³¨å…¥å…¨å±€å¸¸é‡</span>
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__APP_VERSION__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">'1.0.0'</span>),
      <span class="hljs-attr">__API_URL__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(env.<span class="hljs-property">VITE_API_URL</span>),
    },
  
    <span class="hljs-comment">// æ–¹å¼2: æ ¹æ®ç¯å¢ƒå˜é‡é…ç½®æ’ä»¶</span>
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-title class_">Number</span>(env.<span class="hljs-property">VITE_PORT</span>) || <span class="hljs-number">3000</span>,
      <span class="hljs-attr">proxy</span>: env.<span class="hljs-property">VITE_API_URL</span> ? {
        <span class="hljs-string">'/api'</span>: {
          <span class="hljs-attr">target</span>: env.<span class="hljs-property">VITE_API_URL</span>,
          <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        }
      } : <span class="hljs-literal">undefined</span>,
    },
  };
});
</code></pre>
<h3 data-id="heading-22">5. TypeScript ç±»å‹æ”¯æŒ</h3>
<p>åˆ›å»º <code>env.d.ts</code> ä¸ºç¯å¢ƒå˜é‡æ·»åŠ ç±»å‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/// &lt;reference types="vite/client" /&gt;</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImportMetaEnv</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_API_URL</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_APP_NAME</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_DEBUG</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImportMeta</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">env</span>: <span class="hljs-title class_">ImportMetaEnv</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-23">å¸¸è§é—®é¢˜</h2>
<p><strong>Q: ä¸ºä»€ä¹ˆæˆ‘çš„ç¯å¢ƒå˜é‡åœ¨å®¢æˆ·ç«¯è®¿é—®ä¸åˆ°ï¼Ÿ</strong>
A: ç¡®ä¿å˜é‡åä»¥ <code>VITE_</code> å¼€å¤´ï¼Œå¹¶ä¸”é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚</p>
<p><strong>Q: å¦‚ä½•åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Ÿ</strong>
A: åˆ›å»º <code>.env.development</code>ã€<code>.env.production</code> ç­‰æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨ <code>--mode</code> å‚æ•°ã€‚</p>
<p><strong>Q: <code>vite preview</code> èƒ½è¯»å–æ–°çš„ç¯å¢ƒå˜é‡å—ï¼Ÿ</strong>
A: ä¸èƒ½ï¼Œç¯å¢ƒå˜é‡åœ¨æ„å»ºæ—¶å°±å·²ç»æ³¨å…¥ï¼Œéœ€è¦é‡æ–°æ„å»ºæ‰èƒ½æ›´æ–°ã€‚</p>
<p><strong>Q: <code>.env.example</code> ä¼šè¢« Vite åŠ è½½å—ï¼Ÿ</strong>
A: ä¸ä¼šï¼Œå®ƒåªæ˜¯ç¤ºä¾‹æ¨¡æ¿ï¼Œéœ€è¦å¤åˆ¶ä¸ºå®é™…çš„ <code>.env</code> æ–‡ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-24">æ‰©å±•ï¼šå…¶ä»–åŠ è½½æ–¹å¼</h2>
<p>åœ¨é Vite é¡¹ç›®æˆ– Node.js è„šæœ¬ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å…¶ä»–æ–¹å¼åŠ è½½ç¯å¢ƒå˜é‡ã€‚</p>
<h3 data-id="heading-25">æ–¹å¼å¯¹æ¯”</h3>



































<table><thead><tr><th>æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>ä½¿ç”¨æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Vite å†…ç½®</strong></td><td>Vite é¡¹ç›®</td><td>è‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€é…ç½®</td><td>âœ… æ¨è</td></tr><tr><td><strong>dotenv åº“</strong></td><td>Node.js è„šæœ¬</td><td><code>require('dotenv').config()</code></td><td>éœ€è¦å®‰è£…ä¾èµ–</td></tr><tr><td><strong>Node.js åŸç”Ÿ</strong></td><td>Node.js 20.6+</td><td><code>node --env-file=.env app.js</code></td><td>æ— éœ€ä¾èµ–ï¼ŒåŸç”Ÿæ”¯æŒ</td></tr><tr><td><strong>tsx</strong></td><td>TypeScript æ–‡ä»¶</td><td><code>tsx --env-file=.env app.ts</code></td><td>ç›´æ¥è¿è¡Œ .ts æ–‡ä»¶</td></tr></tbody></table>
<h3 data-id="heading-26">dotenv åº“ä½¿ç”¨</h3>
<pre><code class="hljs language-bash" lang="bash">npm install dotenv
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-comment">// æŒ‡å®šæ–‡ä»¶</span>
dotenv.<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'.env.development'</span> });

<span class="hljs-comment">// è®¿é—®å˜é‡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_HOST</span>);
</code></pre>
<h3 data-id="heading-27">Node.js åŸç”Ÿæ”¯æŒï¼ˆ20.6+ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å‘½ä»¤è¡Œä½¿ç”¨</span>
node --env-file=.<span class="hljs-built_in">env</span> app.js

<span class="hljs-comment"># package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"node --env-file=.env.development src/index.js"</span>
  }
}
</code></pre>
<h3 data-id="heading-28">TypeScript ç±»å‹å£°æ˜</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// env.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">NodeJS</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProcessEnv</span> {
      <span class="hljs-attr">DB_HOST</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-attr">API_KEY</span>: <span class="hljs-built_in">string</span>;
    }
  }
}

<span class="hljs-keyword">export</span> {};
</code></pre>
<hr/>
<p><strong>é€‚ç”¨ç‰ˆæœ¬</strong>ï¼šVite 5.x+, Node.js 20.6+</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript ä¸­ `this` çš„çœŸç›¸ï¼šç”±è°ƒç”¨æ–¹å¼å†³å®šçš„åŠ¨æ€æŒ‡é’ˆ]]></title>    <link>https://juejin.cn/post/7579441333166915593</link>    <guid>https://juejin.cn/post/7579441333166915593</guid>    <pubDate>2025-12-03T15:28:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166915593" data-draft-id="7579494852652990498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript ä¸­ `this` çš„çœŸç›¸ï¼šç”±è°ƒç”¨æ–¹å¼å†³å®šçš„åŠ¨æ€æŒ‡é’ˆ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T15:28:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="izx888"/> <meta itemprop="url" content="https://juejin.cn/user/1241762540820323"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript ä¸­ `this` çš„çœŸç›¸ï¼šç”±è°ƒç”¨æ–¹å¼å†³å®šçš„åŠ¨æ€æŒ‡é’ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1241762540820323/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    izx888
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:28:57.000Z" title="Wed Dec 03 2025 15:28:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript ä¸­ <code>this</code> çš„çœŸç›¸ï¼šç”±è°ƒç”¨æ–¹å¼å†³å®šçš„åŠ¨æ€æŒ‡é’ˆ</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œ<code>this</code> æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•å´ææ˜“è¢«è¯¯è§£çš„æ¦‚å¿µã€‚å®ƒä¸åƒå…¶ä»–è¯­è¨€ä¸­çš„ <code>this</code> é‚£æ ·å›ºå®šæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>è¿è¡Œæ—¶ç»‘å®š</strong>çš„åŠ¨æ€æŒ‡é’ˆâ€”â€”å®ƒçš„å€¼å®Œå…¨å–å†³äºå‡½æ•°<strong>å¦‚ä½•è¢«è°ƒç”¨</strong>ï¼Œè€Œé<strong>åœ¨å“ªé‡Œå®šä¹‰</strong>ã€‚</p>
<p>æœ¬æ–‡å°†ä»ä¸€æ®µå…¸å‹ä»£ç å‡ºå‘ï¼Œæ·±å…¥å‰–æ <code>this</code> çš„è¡Œä¸ºé€»è¾‘ï¼Œå¹¶æ¢³ç†å…¶åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æŒ‡å‘è§„åˆ™ï¼Œå¸®åŠ©ä½ å½»åº•æŒæ¡è¿™ä¸€æ ¸å¿ƒæœºåˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€ä¸€ä¸ªâ€œåç›´è§‰â€çš„ç°è±¡</h3>
<p>è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">bar</span> = { 
  myName: "time.geekbang.com",
  printName: function() {
    console.log(this.myName)<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>

let <span class="hljs-attr">myName</span> = <span class="hljs-string">'æå®¢é‚¦'</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">_printName</span> = bar.printName<span class="hljs-comment">;</span>
_printName()<span class="hljs-comment">; // è¾“å‡º undefinedï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰</span>
bar.printName()<span class="hljs-comment">; // è¾“å‡º "time.geekbang.com"</span>
</code></pre>
<p>ä¸ºä»€ä¹ˆåŒä¸€ä¸ªå‡½æ•°ï¼Œä¸¤æ¬¡è°ƒç”¨ç»“æœå´å®Œå…¨ä¸åŒï¼Ÿ</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1010bfea91a44a2aa2b441299f9ad6dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXp4ODg4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380537&amp;x-signature=M63BQNEk%2BOBhx5TuyUxPnD034vc%3D" alt="å±å¹•æˆªå›¾ 2025-12-03 194836.png" width="39%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53efb751806f47939e7d5a38397642c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXp4ODg4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380537&amp;x-signature=fAxo7hfF8scnsIm8y9D5HRB%2FpnA%3D" alt="å±å¹•æˆªå›¾ 2025-12-03 194830.png" width="59%" loading="lazy"/>
<p>å…³é”®åœ¨äºï¼š</p>
<ul>
<li><code>bar.printName()</code> æ˜¯<strong>ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨</strong>ï¼Œæ­¤æ—¶ <code>this</code> æŒ‡å‘ <code>bar</code>ï¼›</li>
<li><code>_printName()</code> æ˜¯<strong>ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨</strong>ï¼Œæ­¤æ—¶ <code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­ä¸º <code>window</code>ï¼‰ï¼Œè€Œ <code>window.myName</code> å¹¶æœªå®šä¹‰ï¼ˆæ³¨æ„ï¼š<code>let</code> å£°æ˜çš„å˜é‡ä¸ä¼šæŒ‚è½½åˆ° <code>window</code> ä¸Šï¼‰ï¼Œæ‰€ä»¥è¾“å‡º <code>undefined</code>ã€‚</li>
</ul>
<p>è¿™æ­ç¤ºäº† <code>this</code> çš„æœ¬è´¨ï¼š<strong>å®ƒä¸å…³å¿ƒå‡½æ•°åœ¨å“ªå®šä¹‰ï¼Œåªå…³å¿ƒå‡½æ•°æ€ä¹ˆè¢«è°ƒç”¨</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€<code>this</code> çš„å››ç§å¸¸è§ç»‘å®šè§„åˆ™</h3>
<h4 data-id="heading-3">1. é»˜è®¤ç»‘å®šï¼ˆæ™®é€šå‡½æ•°è°ƒç”¨ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">foo</span>() {
  console<span class="hljs-selector-class">.log</span>(this); <span class="hljs-comment">// éä¸¥æ ¼æ¨¡å¼ï¼šwindowï¼›ä¸¥æ ¼æ¨¡å¼ï¼šundefined</span>
}
<span class="hljs-built_in">foo</span>();
</code></pre>
<ul>
<li>åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ï¼›</li>
<li>åœ¨ä¸¥æ ¼æ¨¡å¼ï¼ˆ<code>'use strict'</code>ï¼‰ä¸‹ï¼Œ<code>this</code> ä¸º <code>undefined</code>ï¼Œé¿å…æ„å¤–æ±¡æŸ“å…¨å±€ã€‚</li>
</ul>
<blockquote>
<p>âš ï¸ è¿™ä¹Ÿæ˜¯æ—©æœŸ JavaScript è¢«è¯Ÿç—…çš„è®¾è®¡ä¹‹ä¸€ï¼šå‡½æ•°æœ¬å¯ç‹¬ç«‹å­˜åœ¨ï¼Œå´å¼ºåˆ¶èµ‹äºˆä¸€ä¸ªæ— æ„ä¹‰çš„ <code>this</code>ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">2. éšå¼ç»‘å®šï¼ˆå¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'æå®¢æ—¶é—´'</span>,
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
};
obj.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// "æå®¢æ—¶é—´"</span>
</code></pre>
<p>å½“å‡½æ•°é€šè¿‡ <code>obj.fn()</code> å½¢å¼è°ƒç”¨æ—¶ï¼Œ<code>this</code> è‡ªåŠ¨ç»‘å®šåˆ° <code>obj</code>ã€‚</p>
<p>âš ï¸ <strong>ä¸¢å¤±ç»‘å®š</strong>ï¼šä¸€æ—¦å°†æ–¹æ³•èµ‹å€¼ç»™å˜é‡æˆ–ä¼ å…¥å›è°ƒï¼Œå°±ä¼šé€€åŒ–ä¸ºé»˜è®¤ç»‘å®šï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">fn</span> = obj.greet<span class="hljs-comment">;</span>
fn()<span class="hljs-comment">; // this æŒ‡å‘ windowï¼ˆæˆ– undefinedï¼‰ï¼Œè¾“å‡º undefined</span>
</code></pre>
<hr/>
<h4 data-id="heading-5">3. æ˜¾å¼ç»‘å®šï¼ˆ<code>call</code> / <code>apply</code> / <code>bind</code>ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">function setName(name) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
}

const <span class="hljs-attr">user</span> = {}<span class="hljs-comment">;</span>
setName.call(user, 'æå®¢é‚¦')<span class="hljs-comment">;</span>
console.log(user.name)<span class="hljs-comment">; // "æå®¢é‚¦"</span>
</code></pre>
<p>é€šè¿‡ <code>call</code>ã€<code>apply</code> æˆ– <code>bind</code>ï¼Œæˆ‘ä»¬å¯ä»¥<strong>æ‰‹åŠ¨æŒ‡å®š</strong> <code>this</code> çš„å€¼ï¼Œå®ç°çµæ´»çš„ä¸Šä¸‹æ–‡æ§åˆ¶ã€‚</p>
<hr/>
<h4 data-id="heading-6">4. æ„é€ å‡½æ•°è°ƒç”¨ï¼ˆ<code>new</code> ç»‘å®šï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">function Person(name) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">p</span> = new Person(<span class="hljs-string">'æå®¢æ—¶é—´'</span>)<span class="hljs-comment">;</span>
console.log(p.name)<span class="hljs-comment">; // "æå®¢æ—¶é—´"</span>
</code></pre>
<p>ä½¿ç”¨ <code>new</code> è°ƒç”¨å‡½æ•°æ—¶ï¼ŒJavaScript å¼•æ“ä¼šï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼›</li>
<li>å°† <code>this</code> ç»‘å®šåˆ°è¯¥å¯¹è±¡ï¼›</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°ï¼›</li>
<li>è¿”å›æ–°å¯¹è±¡ã€‚</li>
</ol>
<p>æ­¤æ—¶ <code>this</code> æŒ‡å‘æ–°åˆ›å»ºçš„å®ä¾‹ã€‚</p>
<hr/>
<h3 data-id="heading-7">ä¸‰ã€ç‰¹æ®Šåœºæ™¯ï¼šäº‹ä»¶å¤„ç†å™¨ä¸­çš„ <code>this</code></h3>
<p>åœ¨ DOM äº‹ä»¶å¤„ç†ä¸­ï¼Œ<code>this</code> æŒ‡å‘<strong>è§¦å‘äº‹ä»¶çš„å…ƒç´ </strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"link"</span>&gt;</span>ç‚¹å‡»æˆ‘<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"link"</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// &lt;a id="link"&gt;...&lt;/a&gt;</span>
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™æ˜¯æµè§ˆå™¨å¼•æ“è‡ªåŠ¨å®Œæˆçš„ç»‘å®šï¼Œå±äºéšå¼ç»‘å®šçš„ä¸€ç§å˜ä½“ã€‚</p>
<hr/>
<h3 data-id="heading-8">å››ã€å¦‚ä½•å®‰å…¨åœ°è®¿é—®å¯¹è±¡å±æ€§ï¼Ÿ</h3>
<p>å›åˆ°æœ€åˆçš„é—®é¢˜ï¼š<strong>å¦‚ä½•ç¡®ä¿åœ¨æ–¹æ³•å†…éƒ¨æ­£ç¡®è®¿é—®å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>å§‹ç»ˆé€šè¿‡ <code>this</code> è®¿é—®ï¼Œå¹¶ç¡®ä¿è°ƒç”¨æ–¹å¼ä¸ä¼šå¯¼è‡´ <code>this</code> ä¸¢å¤±</strong>ã€‚</p>
<p>è‹¥éœ€è§£è€¦æ–¹æ³•å¼•ç”¨ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š</p>
<ul>
<li>ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆä½†æ³¨æ„ï¼šç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>ï¼Œä¼šç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸï¼‰ï¼›</li>
<li>ä½¿ç”¨ <code>.bind()</code> æå‰ç»‘å®šä¸Šä¸‹æ–‡ï¼›</li>
<li>åœ¨ç±»æˆ–å¯¹è±¡ä¸­ä½¿ç”¨æ–¹æ³•å¼•ç”¨æ—¶ï¼Œé¿å…ç›´æ¥èµ‹å€¼ï¼Œæ”¹ç”¨é—­åŒ…æˆ–ä»£ç†ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">safePrint</span> = bar.printName.bind(bar)<span class="hljs-comment">;</span>
safePrint()<span class="hljs-comment">; // æ­£ç¡®è¾“å‡º "time.geekbang.com"</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">ç»“è¯­</h3>
<p><code>this</code> æ˜¯ JavaScript ä¸­å°‘æœ‰çš„<strong>è¿è¡Œæ—¶åŠ¨æ€ç»‘å®š</strong>æœºåˆ¶ï¼Œå®ƒæ‰“ç ´äº†â€œè¯æ³•ä½œç”¨åŸŸâ€çš„å¸¸è§„æ€ç»´ã€‚ç†è§£å…¶ç»‘å®šè§„åˆ™ï¼Œä¸ä»…èƒ½é¿å…å¸¸è§ bugï¼Œè¿˜èƒ½æ›´è‡ªå¦‚åœ°æ“æ§å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p>
<p>è®°ä½ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong><code>this</code> ä¸æ˜¯ä½ å†™åœ¨å“ªï¼Œè€Œæ˜¯ä½ å«è°æ¥æ‰§è¡Œã€‚</strong></p>
</blockquote>
<p>æŒæ¡è¿™ä¸€ç‚¹ï¼Œä½ å°±çœŸæ­£è¿ˆå…¥äº† JavaScript è¿›é˜¶ä¹‹é—¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Retrofit æ ¸å¿ƒæµç¨‹æ¨¡æ‹Ÿå®ç°æ·±è§£æ]]></title>    <link>https://juejin.cn/post/7579438351297921060</link>    <guid>https://juejin.cn/post/7579438351297921060</guid>    <pubDate>2025-12-03T10:35:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579438351297921060" data-draft-id="7576955345378836543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Retrofit æ ¸å¿ƒæµç¨‹æ¨¡æ‹Ÿå®ç°æ·±è§£æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T10:35:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ½œé¾™å‹¿ç”¨ä¹‹åŒ–éª¨é¾™"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Retrofit æ ¸å¿ƒæµç¨‹æ¨¡æ‹Ÿå®ç°æ·±è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ½œé¾™å‹¿ç”¨ä¹‹åŒ–éª¨é¾™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:35:30.000Z" title="Wed Dec 03 2025 10:35:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>Retrofit æ˜¯ä¸€æ¬¾å¹¿å—æ¬¢è¿çš„ HTTP å®¢æˆ·ç«¯åº“ï¼Œä»¥å…¶ä¼˜é›…çš„å£°æ˜å¼ API è®¾è®¡æ·±å—å¼€å‘è€…å–œçˆ±ã€‚æœ¬æ–‡å°†é€šè¿‡æ¨¡æ‹Ÿå®ç°ï¼Œé€æ­¥è§£æ Retrofit çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå¸®åŠ©æ‚¨ä»æºç å±‚é¢ç†è§£å…¶è®¾è®¡æ€æƒ³å’ŒæŠ€æœ¯å®ç°ã€‚</p>
<h2 data-id="heading-1">æ¨¡æ‹Ÿçš„ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶</h2>
<h3 data-id="heading-2">1. æ³¨è§£è§£ææœºåˆ¶</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">"user/{id}"</span>)</span>            è§£æè¯·æ±‚æ–¹æ³•å’Œè·¯å¾„æ¨¡æ¿
<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> id: <span class="hljs-built_in">Int</span>          è§£æè·¯å¾„å‚æ•°æ˜ å°„
</code></pre>
<p>ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Target</span>(AnnotationTarget.FUNCTION)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">GET</span>(val <span class="hljs-attribute">path</span>: String)

<span class="hljs-variable">@Target</span>(AnnotationTarget.VALUE_PARAMETER)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">Path</span>(val <span class="hljs-attribute">value</span>: String)
</code></pre>
<p><strong>æ¨¡æ‹Ÿæ•ˆæœ</strong>ï¼šå®ç°äº† Retrofit çš„å£°æ˜å¼æ¥å£å®šä¹‰æ¨¡å¼</p>
<h3 data-id="heading-3">2. åŠ¨æ€ä»£ç†æ‹¦æˆª</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(proxy: <span class="hljs-type">Any</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: Any {
    <span class="hljs-keyword">val</span> getAnnotation = method.getAnnotation(GET::<span class="hljs-keyword">class</span>.java)
    <span class="hljs-comment">// æ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œè½¬æ¢ä¸ºç½‘ç»œè¯·æ±‚é€»è¾‘</span>
}
</code></pre>
<p><strong>æ¨¡æ‹Ÿæ•ˆæœ</strong>ï¼šé‡ç°äº† Retrofit é€šè¿‡åŠ¨æ€ä»£ç†å°†æ¥å£æ–¹æ³•è½¬æ¢ä¸º HTTP è¯·æ±‚çš„æ ¸å¿ƒåŸç†</p>
<p>ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createApiService</span><span class="hljs-params">()</span></span>: ApiServiceMock {
    <span class="hljs-keyword">return</span> Proxy.newProxyInstance(
        ApiServiceMock::<span class="hljs-keyword">class</span>.java.classLoader,
        arrayOf(ApiServiceMock::<span class="hljs-keyword">class</span>.java),
        ApiServiceProxy()
    ) <span class="hljs-keyword">as</span> ApiServiceMock
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiServiceProxy</span> : <span class="hljs-type">InvocationHandler</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(proxy: <span class="hljs-type">Any</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: Any {
        <span class="hljs-keyword">val</span> getAnnotation = method.getAnnotation(GET::<span class="hljs-keyword">class</span>.java)

        args?.forEach {
            log(<span class="hljs-string">"args --&gt;<span class="hljs-variable">$it</span>"</span>)
        }

        <span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java
        log(<span class="hljs-string">"isSuspend--<span class="hljs-variable">$isSuspend</span>"</span>)

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            getAnnotation != <span class="hljs-literal">null</span> -&gt; {
                <span class="hljs-comment">// å¤„ç† GET è¯·æ±‚</span>
                <span class="hljs-keyword">val</span> path = getAnnotation.path
                log(<span class="hljs-string">"åŸå§‹è·¯å¾„--<span class="hljs-variable">$path</span>"</span>)
                <span class="hljs-keyword">val</span> requestParm = resolvePath(path, method, args)
                log(<span class="hljs-string">"è§£æåè·¯å¾„--<span class="hljs-variable">$requestParm</span>"</span>)

                <span class="hljs-keyword">if</span> (isSuspend) {
                    <span class="hljs-comment">// å¦‚æœæ˜¯ suspend æ–¹æ³•ï¼ŒæŒ‚èµ·åç¨‹å¹¶æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ï¼Œè¿™å’ŒçœŸæ­£çš„Retrofitå®ç°å¹¶ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ€æƒ³æ˜¯ä¸€è‡´çš„ã€‚</span>
                    <span class="hljs-keyword">val</span> continuation = args?.last() <span class="hljs-keyword">as</span> Continuation&lt;Any&gt;
                    simulateAsyncOperation {
                        continuation.resume(
                            <span class="hljs-string">"GET request to <span class="hljs-variable">$requestParm</span> - Response: : User:<span class="hljs-subst">${requestParm.pathValue}</span>"</span>
                        )
                    }
                    <span class="hljs-keyword">return</span> kotlin.coroutines.intrinsics.COROUTINE_SUSPENDED <span class="hljs-comment">// æŒ‚èµ·åç¨‹</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// é suspend æ–¹æ³•ï¼Œç›´æ¥è¿”å›ç»“æœ</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"GET request to <span class="hljs-variable">$requestParm</span> - Response:  User:<span class="hljs-subst">${requestParm.pathValue}</span>"</span>
                }
            }

            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> UnsupportedOperationException(<span class="hljs-string">"Unknown method: <span class="hljs-subst">${method.name}</span>"</span>)
        }
    }
}
</code></pre>
<p>åç¨‹æ”¯æŒçš„æ¨¡æ‹Ÿ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å‡†ç¡®è¯†åˆ« suspend å‡½æ•°ç‰¹å¾</span>
<span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java

<span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥å›è°ƒæœºåˆ¶</span>
simulateAsyncOperation {
    continuation.resume(<span class="hljs-string">"Response data"</span>)
}
</code></pre>
<p>è¿™é‡Œå’ŒRetrofit çš„å®ç°ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯æ€æƒ³æ˜¯ä¸€è‡´çš„ï¼Œå¼‚æ­¥è½¬æˆåŒæ­¥çš„å®ç°ã€‚</p>
<p><strong>æ¨¡æ‹Ÿæ•ˆæœ</strong>ï¼šé‡ç°äº† Retrofit é€šè¿‡åŠ¨æ€ä»£ç†å°†æ¥å£æ–¹æ³•è½¬æ¢ä¸º HTTP è¯·æ±‚çš„æ ¸å¿ƒåŸç†</p>
<h3 data-id="heading-4">3. è·¯å¾„å‚æ•°æ›¿æ¢</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åŸå§‹è·¯å¾„: "user/{id}"</span>
<span class="hljs-comment">// ç»è¿‡ resolvePath å¤„ç†å: "user/4"</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resolvePath</span><span class="hljs-params">(path: <span class="hljs-type">String</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: RequestParm
</code></pre>
<p><strong>æ¨¡æ‹Ÿæ•ˆæœ</strong>ï¼šå®ç°äº† Retrofit çš„è·¯å¾„å‚æ•°åŠ¨æ€æ›¿æ¢æœºåˆ¶</p>
<p>ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resolvePath</span><span class="hljs-params">(path: <span class="hljs-type">String</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: RequestParm {
    <span class="hljs-keyword">var</span> absolutePath = path
    <span class="hljs-keyword">val</span> parameters = method.parameters
    <span class="hljs-keyword">var</span> pathName = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> placeholderName = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> pathValue = <span class="hljs-string">""</span>

    parameters.forEachIndexed { index, parameter -&gt;
        <span class="hljs-comment">// è·å–å‚æ•°ä¸Šçš„ @Path æ³¨è§£</span>
        <span class="hljs-keyword">val</span> pathAnnotation = parameter.getAnnotation(Path::<span class="hljs-keyword">class</span>.java)
        <span class="hljs-keyword">if</span> (pathAnnotation != <span class="hljs-literal">null</span>) {
            placeholderName = pathAnnotation.value
            log(<span class="hljs-string">"placeholderName--&gt;<span class="hljs-variable">$placeholderName</span>"</span>)
            pathName = placeholderName
            <span class="hljs-keyword">val</span> placeholder = <span class="hljs-string">"\\{<span class="hljs-variable">$placeholderName</span>\\}"</span>.toRegex()
            log(<span class="hljs-string">"placeholder--&gt;<span class="hljs-variable">$placeholder</span>"</span>)
            <span class="hljs-keyword">if</span> (args != <span class="hljs-literal">null</span> &amp;&amp; index &lt; args.size) {
                log(<span class="hljs-string">"index--&gt;<span class="hljs-variable">$index</span> and args --&gt;<span class="hljs-subst">${args[index].toString()}</span>"</span>)
                pathValue = args[index].toString()
                absolutePath = absolutePath.replace(placeholder, args[index].toString())
                log(<span class="hljs-string">"æ›¿æ¢å ä½ç¬¦ {<span class="hljs-variable">$placeholderName</span>} -&gt; <span class="hljs-subst">${args[index]}</span>"</span>)
            }
        }
    }
    <span class="hljs-keyword">return</span> RequestParm(pathName, absolutePath, pathValue)
}
</code></pre>
<p>å¼‚æ­¥ä»£ç åŒæ­¥åŒ–è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-keyword">val</span> apiService = createApiService()
    <span class="hljs-keyword">val</span> userResponse = apiService.getUserById(<span class="hljs-number">4</span>)
    log(userResponse.toString())
}
</code></pre>
<h2 data-id="heading-5">æ ¸å¿ƒæµç¨‹æ¨¡æ‹Ÿå¯¹æ¯”</h2>
<h3 data-id="heading-6">Retrofit å®é™…æµç¨‹ vs æ‚¨çš„æ¨¡æ‹Ÿå®ç°</h3>








































<table><thead><tr><th>é˜¶æ®µ</th><th>Retrofit å®é™…å®ç°</th><th>æ‚¨çš„æ¨¡æ‹Ÿå®ç°</th></tr></thead><tbody><tr><td><strong>æ¥å£å®šä¹‰</strong></td><td><code>@GET("user/{id}")</code> + <code>@Path("id")</code></td><td>âœ… å®Œå…¨æ¨¡æ‹Ÿ</td></tr><tr><td><strong>ä»£ç†åˆ›å»º</strong></td><td><code>Retrofit.create()</code> åŠ¨æ€ä»£ç†</td><td>âœ… <code>createApiService()</code> åŠ¨æ€ä»£ç†</td></tr><tr><td><strong>æ–¹æ³•æ‹¦æˆª</strong></td><td><code>InvocationHandler.invoke()</code></td><td>âœ… <code>ApiServiceProxy.invoke()</code></td></tr><tr><td><strong>æ³¨è§£è§£æ</strong></td><td><code>ServiceMethod</code> è§£ææ³¨è§£</td><td>âœ… <code>resolvePath()</code> è§£æè·¯å¾„å‚æ•°</td></tr><tr><td><strong>è¯·æ±‚æ„å»º</strong></td><td><code>Request.Builder()</code></td><td>âœ… è·¯å¾„æ¨¡æ¿æ›¿æ¢</td></tr><tr><td><strong>åç¨‹æ”¯æŒ</strong></td><td><code>CallAdapter</code> å¤„ç† suspend</td><td>âœ… æ£€æŸ¥ <code>Continuation</code> å‚æ•°</td></tr></tbody></table>
<h2 data-id="heading-7">Retrofit æ ¸å¿ƒæµç¨‹ç¤ºæ„å›¾</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed5bf7217c194a32a677be054443e3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765362929&amp;x-signature=6HQTVlXkPqZ7umNTbqTLezGQTTc%3D" alt="deepseek_mermaid_20251127_863a9e.png" loading="lazy"/></p>
<h2 data-id="heading-8">æ ¸å¿ƒç±»åä½œæ—¶åºå›¾</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·ä»£ç 
    participant P as åŠ¨æ€ä»£ç†
    participant A as æ³¨è§£è§£æå™¨
    participant R as è¯·æ±‚æ„å»ºå™¨
    participant C as åç¨‹å¤„ç†å™¨

    U-&gt;&gt;P: api.getUserById(4)
    P-&gt;&gt;A: è§£æ@GET("user/{id}")
    A-&gt;&gt;A: æå–è·¯å¾„æ¨¡æ¿
    P-&gt;&gt;A: è§£æ@Path("id")å‚æ•°
    A-&gt;&gt;R: è·¯å¾„æ¨¡æ¿ + å‚æ•°å€¼
    R-&gt;&gt;R: "user/{id}" â†’ "user/4"
    R-&gt;&gt;C: æ£€æµ‹suspendå‡½æ•°
    alt æ˜¯suspendå‡½æ•°
        C-&gt;&gt;C: æŒ‚èµ·åç¨‹ï¼Œå¼‚æ­¥æ‰§è¡Œ
        C-&gt;&gt;U: 4ç§’åresumeç»“æœ
    else æ™®é€šå‡½æ•°
        C-&gt;&gt;U: ç«‹å³è¿”å›ç»“æœ
    end
</code></pre>
<h2 data-id="heading-9">å…³é”®æŠ€æœ¯ç‚¹æ¨¡æ‹Ÿåˆ†æ</h2>
<h3 data-id="heading-10">1. å£°æ˜å¼ API è®¾è®¡</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ‚¨çš„æ¨¡æ‹Ÿ - ä¸ Retrofit é«˜åº¦ç›¸ä¼¼</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiServiceMock</span> {
    <span class="hljs-meta">@GET(<span class="hljs-string">"user/{id}"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> id: <span class="hljs-type">Int</span>)</span></span>: String?
}
</code></pre>
<h3 data-id="heading-11">2. åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒä½œç”¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ‚¨çš„å®ç°å‡†ç¡®æŠ“ä½äº†åŠ¨æ€ä»£ç†çš„æœ¬è´¨</span>
<span class="hljs-keyword">return</span> Proxy.newProxyInstance(
    ApiServiceMock::<span class="hljs-keyword">class</span>.java.classLoader,
    arrayOf(ApiServiceMock::<span class="hljs-keyword">class</span>.java),
    ApiServiceProxy()  <span class="hljs-comment">// å…³é”®ï¼šè‡ªå®šä¹‰è°ƒç”¨å¤„ç†</span>
)
</code></pre>
<h3 data-id="heading-12">3. è·¯å¾„å‚æ•°è§£æçš„ç²¾é«“</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¨¡æ‹Ÿäº† Retrofit çš„è·¯å¾„å‚æ•°æ›¿æ¢é€»è¾‘</span>
absolutePath = absolutePath.replace(placeholder, args[index].toString())
<span class="hljs-comment">// "user/{id}" â†’ "user/4"</span>
</code></pre>
<h3 data-id="heading-13">4. åç¨‹æ”¯æŒçš„æ¨¡æ‹Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å‡†ç¡®è¯†åˆ« suspend å‡½æ•°ç‰¹å¾</span>
<span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java

<span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥å›è°ƒæœºåˆ¶</span>
simulateAsyncOperation {
    continuation.resume(<span class="hljs-string">"Response data"</span>)
}
</code></pre>
<h2 data-id="heading-14">æµç¨‹å›¾è¯¦ç»†è¯´æ˜</h2>
<h3 data-id="heading-15">ç¬¬ä¸€é˜¶æ®µï¼šæ¥å£å®šä¹‰æœŸ</h3>
<pre><code class="hljs">ç”¨æˆ·ä»£ç  â†’ æ³¨è§£å£°æ˜ â†’ Retrofitæ„å»º
</code></pre>
<ul>
<li><strong>ç”¨æˆ·</strong>ï¼šå®šä¹‰æ¥å£æ–¹æ³•å’Œæ³¨è§£</li>
<li><strong>Retrofit</strong>ï¼šåˆ›å»ºåŠ¨æ€ä»£ç†å®ä¾‹</li>
</ul>
<h3 data-id="heading-16">ç¬¬äºŒé˜¶æ®µï¼šæ–¹æ³•è°ƒç”¨æœŸ</h3>
<pre><code class="hljs">æ–¹æ³•è°ƒç”¨ â†’ ä»£ç†æ‹¦æˆª â†’ æ³¨è§£è§£æ â†’ è¯·æ±‚æ„å»º
</code></pre>
<ul>
<li><strong>åŠ¨æ€ä»£ç†</strong>ï¼šæ‹¦æˆªæ‰€æœ‰æ¥å£æ–¹æ³•è°ƒç”¨</li>
<li><strong>æ³¨è§£å¤„ç†å™¨</strong>ï¼šè§£ææ–¹æ³•æ³¨è§£å’Œå‚æ•°æ³¨è§£</li>
<li><strong>è¯·æ±‚æ„å»ºå™¨</strong>ï¼šæ›¿æ¢è·¯å¾„å‚æ•°ï¼Œç”Ÿæˆå®Œæ•´URL</li>
</ul>
<h3 data-id="heading-17">ç¬¬ä¸‰é˜¶æ®µï¼šå“åº”å¤„ç†æœŸ</h3>
<pre><code class="hljs">è¯·æ±‚æ‰§è¡Œ â†’ åç¨‹æ§åˆ¶ â†’ ç»“æœè¿”å›
</code></pre>
<ul>
<li><strong>åç¨‹æ£€æµ‹</strong>ï¼šé€šè¿‡ Continuation å‚æ•°è¯†åˆ«æŒ‚èµ·å‡½æ•°</li>
<li><strong>å¼‚æ­¥æ¨¡æ‹Ÿ</strong>ï¼šä½¿ç”¨å›è°ƒæœºåˆ¶æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</li>
<li><strong>ç»“æœè¿”å›</strong>ï¼šé€šè¿‡ resume æˆ–ç›´æ¥è¿”å›ä¼ é€’ç»“æœ</li>
</ul>
<h2 data-id="heading-18">æ ¸å¿ƒæµç¨‹è¦†ç›–</h2>
<p>æˆ‘å®ç°è¦†ç›–äº† Retrofit æœ€å…³é”®çš„å‡ ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>âœ… æ¥å£æ–¹æ³•åˆ° HTTP è¯·æ±‚çš„è½¬æ¢</li>
<li>âœ… æ³¨è§£ä¿¡æ¯çš„æå–å’Œåº”ç”¨</li>
<li>âœ… è·¯å¾„å‚æ•°çš„åŠ¨æ€æ›¿æ¢</li>
<li>âœ… åç¨‹å¼‚æ­¥æ”¯æŒçš„åŸºç¡€æœºåˆ¶</li>
</ul>
<h2 data-id="heading-19">æ€»ç»“</h2>
<p>æœ¬æ–‡é€šè¿‡æ¨¡æ‹Ÿå®ç°ï¼Œç²¾å‡†å¤ç°äº† Retrofit çš„æ ¸å¿ƒæµç¨‹ï¼ŒåŒ…æ‹¬å£°æ˜å¼æ¥å£ã€åŠ¨æ€ä»£ç†ã€æ³¨è§£å¤„ç†å’Œåç¨‹æ”¯æŒã€‚è¿™ç§ç®€åŒ–å®ç°æ–¹å¼ä¸ä»…å¸®åŠ©æˆ‘ä»¬ç†è§£å¤æ‚æ¡†æ¶çš„è®¾è®¡æ€æƒ³ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†æ·±å…¥å­¦ä¹ çš„å‚è€ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Androidã€‘RecyclerView åˆ·æ–°æ–¹å¼å…¨è§£æï¼šä» notifyDataSetChanged åˆ° DiffUtil]]></title>    <link>https://juejin.cn/post/7579451710303469594</link>    <guid>https://juejin.cn/post/7579451710303469594</guid>    <pubDate>2025-12-03T13:41:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579451710303469594" data-draft-id="7579441333166718985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Androidã€‘RecyclerView åˆ·æ–°æ–¹å¼å…¨è§£æï¼šä» notifyDataSetChanged åˆ° DiffUtil"/> <meta itemprop="keywords" content="Android,Java"/> <meta itemprop="datePublished" content="2025-12-03T13:41:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ³¥åšæ³¥åš"/> <meta itemprop="url" content="https://juejin.cn/user/1197828179492985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Androidã€‘RecyclerView åˆ·æ–°æ–¹å¼å…¨è§£æï¼šä» notifyDataSetChanged åˆ° DiffUtil
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197828179492985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ³¥åšæ³¥åš
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:41:02.000Z" title="Wed Dec 03 2025 13:41:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Androidã€‘RecyclerView åˆ·æ–°æ–¹å¼å…¨è§£æï¼šä» notifyDataSetChanged åˆ° DiffUtil</h2>
<p>RecyclerView æ˜¯ Android å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ UI ç»„ä»¶ä¹‹ä¸€ï¼Œè€Œâ€œå¦‚ä½•åˆ·æ–°åˆ—è¡¨â€æ˜¯æ¯ä¸ªå¼€å‘è€…å¿…ç„¶ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>åˆšå¼€å§‹å­¦ Android æ—¶ï¼Œåªä¼šç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyDataSetChanged();
</code></pre>
<p>ç®€å•ç²—æš´ï¼Œèƒ½è§£å†³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ç¼ºç‚¹å¾ˆå¤šï¼ŒçœŸæ­£é¡¹ç›®ä¸­æˆ‘ä»¬æ›´éœ€è¦æ€§èƒ½æ›´å¥½ã€åŠ¨ç”»æ›´è‡ªç„¶ã€åˆ·æ–°ç²’åº¦æ›´ç²¾å‡†çš„åˆ·æ–°æ–¹å¼ã€‚</p>
<p>æœ¬æ–‡å°†ä»æœ€åŸºç¡€çš„ <code>notifyDataSetChanged()</code> å¼€å§‹ï¼Œä»‹ç» RecyclerView æ‰€æœ‰åˆ·æ–°æ–¹å¼ã€‚</p>
<h3 data-id="heading-1">1. notifyDataSetChanged() â€”â€” å…¨é‡åˆ·æ–°</h3>
<p>è¿™åº”è¯¥æ˜¯æ¯ä¸ªæ–°æ‰‹æœ€å…ˆæŒæ¡çš„ä¸€ç§åˆ·æ–°æ–¹å¼ï¼Œä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyDataSetChanged();
</code></pre>
<p>è°ƒç”¨åï¼Œé€šçŸ¥ RecyclerView æ•´ä¸ªæ•°æ®é›†å·²å˜åŒ–ï¼Œå¼ºåˆ¶é‡æ–°æ‰§è¡Œæ‰€æœ‰ item çš„ onBindViewHolderï¼Œä¸è®¡ç®—å·®å¼‚ã€ä¸åšå±€éƒ¨ä¼˜åŒ–ï¼Œä¼šå¯¼è‡´å…¨é‡åˆ·æ–°ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šè¿™ç§æ–¹å¼ä¼˜ç‚¹éå¸¸æ˜æ˜¾ï¼Œç®€å•æ˜“ç”¨ï¼Œä¸€è¡Œä»£ç æå®šï¼Œä¸éœ€è¦å¤æ‚é€»è¾‘ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ€§èƒ½æœ€å·®ï¼Œæ‰€æœ‰ item éƒ½ä¼šé‡æ–°ç»‘å®šã€é‡ç»˜ï¼›æ— åŠ¨ç”»æ•ˆæœï¼›ä¸èƒ½æŒ‡å®šå˜åŒ–ä½ç½®ï¼›å¯èƒ½å¯¼è‡´ç•Œé¢é—ªçƒã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ•°æ®ç»“æ„å®Œå…¨å˜åŒ–ï¼Œæ—§æ•°æ®ä¸å…¨æ–°æ•°æ®æ— ä»»ä½•å…³è”ï¼›åˆå§‹åŠ è½½ï¼›è°ƒè¯•ã€ä¸´æ—¶ä»£ç ä½¿ç”¨ï¼›æ•°æ®é‡å¾ˆå°ï¼ˆ&lt;10ï¼‰ã€‚</p>
<blockquote>
<p>èƒ½ä¸ç”¨å°±ä¸ç”¨ã€‚å®ƒæ˜¯æœ€ç¬¨çš„æ–¹æ³•ï¼Œä½†ä¹Ÿæœ€ä¸æ¨èã€‚</p>
</blockquote>
<h3 data-id="heading-2">2. notifyItemXXX ç³»åˆ— â€”â€” å±€éƒ¨åˆ·æ–°</h3>
<p>RecyclerView æä¾›äº†å¾ˆå¤šå±€éƒ¨åˆ·æ–°æ–¹æ³•ï¼Œåªè®©â€œå˜åŒ–çš„éƒ¨åˆ†â€åˆ·æ–°ã€‚</p>
<h4 data-id="heading-3">2.1 notifyItemChanged(int position) â€”â€” åˆ·æ–°å•ä¸ªItem</h4>
<p>åªåˆ·æ–°æŒ‡å®š position å¯¹åº” itemã€‚</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyItemChanged(position);
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šåˆ·æ–°å•ä¸ª itemï¼Œæ€§èƒ½å¥½ä¸€äº›ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šé»˜è®¤ä»ä¼šé‡ç»˜æ•´ä¸ª itemï¼Œå¸¸å‡ºç°è½»å¾®é—ªçƒã€‚</p>
<h4 data-id="heading-4">2.2 notifyItemChanged(int position, Object payload) â€”â€” å±€éƒ¨åˆ·æ–°</h4>
<p>åªåˆ·æ–° item å†…éƒ¨çš„<strong>æŸä¸ªæ§ä»¶</strong>ï¼Œä¸ä¼šé‡ç»˜æ•´ä¸ª itemã€‚</p>
<p>éœ€è¦é‡è½½å¸¦ <code>payload</code> çš„ <code>onBindViewHolder</code>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> VH holder, <span class="hljs-type">int</span> position, <span class="hljs-meta">@NonNull</span> List&lt;Object&gt; payloads)</span> {
    <span class="hljs-keyword">if</span> (!payloads.isEmpty()) {
        <span class="hljs-comment">// å±€éƒ¨åˆ·æ–°ï¼šå¤„ç† payloadsï¼ˆå¯åŒ…å«å¤šä¸ªï¼‰</span>
        <span class="hljs-keyword">for</span> (Object payload : payloads) {
            <span class="hljs-keyword">if</span> (payload <span class="hljs-keyword">instanceof</span> String) {
                <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (String) payload;
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"like"</span>.equals(key)) {
                    <span class="hljs-comment">// åªæ›´æ–° like å­—æ®µ</span>
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> data.get(position);
                    holder.tvLike.setText(String.valueOf(user.likeCount));
                    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å±€éƒ¨åˆ·æ–°åç›´æ¥è¿”å›ï¼Œé¿å…å®Œæ•´ç»‘å®š</span>
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (payload <span class="hljs-keyword">instanceof</span> Bundle) {
                <span class="hljs-comment">// å¦‚æœä½ ç”¨ Bundle ä¼ å¤šä¸ªå­—æ®µå˜åŒ–ï¼Œå¯ä»¥è§£æ Bundle</span>
            }
            <span class="hljs-comment">// å…¶å®ƒ payload å¤„ç†...</span>
        }
    }

    <span class="hljs-comment">// payloads ä¸ºç©ºæ—¶å›é€€åˆ°å®Œæ•´ç»‘å®šï¼ˆæˆ–ç›´æ¥è°ƒç”¨ superï¼‰</span>
    <span class="hljs-built_in">super</span>.onBindViewHolder(holder, position, payloads);
}
</code></pre>
<p>ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-java" lang="java">data.get(pos).likeCount += <span class="hljs-number">1</span>;
<span class="hljs-comment">// ä¼ é€’ç®€å•æ ‡è¯†ï¼ˆä¹Ÿå¯ä»¥ä¼  Bundle/è‡ªå®šä¹‰å¯¹è±¡ï¼‰</span>
adapter.notifyItemChanged(pos, <span class="hljs-string">"like"</span>);
</code></pre>
<h4 data-id="heading-5">2.3 notifyItemInserted(int position) â€”â€” æ’å…¥å•ä¸ªItem</h4>
<pre><code class="hljs language-java" lang="java">data.add(position, item);
adapter.notifyItemInserted(position);
</code></pre>
<h4 data-id="heading-6">2.4 notifyItemRemoved(int position) â€”â€” åˆ é™¤å•ä¸ªItem</h4>
<pre><code class="hljs language-java" lang="java">data.remove(position);
adapter.notifyItemRemoved(position);
</code></pre>
<h4 data-id="heading-7">2.5 notifyItemMoved(int fromPosition, int toPosition) â€”â€” ç§»åŠ¨Itemä½ç½®ï¼ˆæ‹–æ‹½æ’åºï¼‰</h4>
<pre><code class="hljs language-java" lang="java">Collections.swap(data, from, to);
adapter.notifyItemMoved(from, to);
</code></pre>
<h4 data-id="heading-8">2.6 notifyItemRangeChanged(int positionStart, int itemCount) â€”â€” æ‰¹é‡æ›´æ–°Item</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; newItems.size(); i++) {
    data.set(startPos + i, newItems.get(i));
}
adapter.notifyItemRangeChanged(startPos, newItems.size());
</code></pre>
<h4 data-id="heading-9">2.7 notifyItemRangeInserted(int positionStart, int itemCount) â€”â€” æ‰¹é‡æ’å…¥Item</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">startPos</span> <span class="hljs-operator">=</span> data.size();
data.addAll(moreItems);
adapter.notifyItemRangeInserted(startPos, moreItems.size());
</code></pre>
<h4 data-id="heading-10">2.8 notifyItemRangeRemoved(int positionStart, int itemCount) â€”â€” æ‰¹é‡åˆ é™¤Item</h4>
<pre><code class="hljs language-java" lang="java">data.subList(startPos, endPos).clear();
adapter.notifyItemRangeRemoved(startPos, endPos - startPos);
</code></pre>
<h3 data-id="heading-11">3. DiffUtil â€”â€” è‡ªåŠ¨è®¡ç®—å·®å¼‚ï¼Œåˆ·æ–°æœ€å°é¡¹</h3>
<p>DiffUtil æ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—ä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´å·®å¼‚çš„å®ç”¨å·¥å…·ç±»ã€‚å®ƒå¯ä»¥ä¼˜åŒ– RecyclerView çš„åˆ·æ–°æ“ä½œï¼Œä»…åˆ·æ–°éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œä»è€Œæé«˜æ€§èƒ½å¹¶å‡å°‘ä¸å¿…è¦çš„æ“ä½œã€‚</p>
<h4 data-id="heading-12">3.1 åŸºæœ¬ä½¿ç”¨æ–¹å¼</h4>
<h5 data-id="heading-13">3.1.1 å®ç°DiffUtil.Callback</h5>
<p>é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªç±»å®ç°<code>DiffUtil.Callback</code>ï¼Œç”¨äºå‘Šè¯‰ DiffUtil ä¸¤ä¸ªåˆ—è¡¨å¦‚ä½•æ¯”è¾ƒã€‚å…¶ä¸­æœ‰ä»¥ä¸‹äº”ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li>
<p><code>int getOldListSize()</code></p>
<p><strong>ä½œç”¨</strong>ï¼šè¿”å›æ—§åˆ—è¡¨é•¿åº¦ã€‚</p>
</li>
<li>
<p><code>int getNewListSize()</code></p>
<p><strong>ä½œç”¨</strong>ï¼šè¿”å›æ–°åˆ—è¡¨é•¿åº¦ã€‚</p>
</li>
<li>
<p><code>boolean areItemsTheSame(int oldItemPosition, int newItemPosition)</code></p>
<p><strong>ä½œç”¨</strong>ï¼šåˆ¤æ–­æ—§åˆ—è¡¨ä¸­ä½ç½® <code>oldItemPosition</code> çš„é¡¹å’Œæ–°åˆ—è¡¨ä¸­ä½ç½® <code>newItemPosition</code> çš„é¡¹ <strong>æ˜¯å¦ä»£è¡¨åŒä¸€ä¸ªå®ä½“</strong>ã€‚</p>
<p><strong>å¸¸ç”¨åšæ³•</strong>ï¼šæ¯”è¾ƒå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚IDã€‚</p>
<p><strong>è¿”å›</strong>ï¼šå¦‚æœè¿”å› <code>true</code>ï¼Œè¯´æ˜æ˜¯â€œåŒä¸€ä¸ª itemâ€ï¼Œæ¥ä¸‹æ¥ä¼šè°ƒç”¨ <code>areContentsTheSame()</code> æ£€æŸ¥å†…å®¹æ˜¯å¦å˜åŒ–ï¼›å¦‚æœè¿”å› <code>false</code>ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ itemï¼ˆinsert/removeï¼‰ã€‚</p>
</li>
<li>
<p><code>boolean areContentsTheSame(int oldItemPosition, int newItemPosition)</code></p>
<p><strong>ä½œç”¨</strong>ï¼šåœ¨ <code>areItemsTheSame()</code> è¿”å› <code>true</code> çš„å‰æä¸‹ï¼Œåˆ¤æ–­<strong>å†…å®¹æ˜¯å¦ç›¸ç­‰</strong>ï¼ˆæ˜¯å¦éœ€è¦åˆ·æ–° UIï¼‰ã€‚</p>
<p><strong>å¸¸ç”¨åšæ³•</strong>ï¼šæ¯”è¾ƒå­—æ®µæˆ–è°ƒç”¨ <code>equals()</code>ï¼ˆä½†è¦ç¡®ä¿ equals çš„è¯­ä¹‰æ˜¯â€œå†…å®¹ç›¸ç­‰â€ï¼‰ã€‚</p>
<p><strong>è¿”å›</strong>ï¼š<code>true</code> è¡¨ç¤ºå†…å®¹ç›¸åŒï¼ˆä¸éœ€è¦åˆ·æ–°ï¼‰ï¼Œ<code>false</code> è¡¨ç¤ºå†…å®¹ä¸åŒï¼ˆä¼šè§¦å‘ <code>notifyItemChanged</code>ï¼‰ã€‚</p>
</li>
<li>
<p><code>@Nullable Object getChangePayload(int oldItemPosition, int newItemPosition)</code><strong>ï¼ˆå¯é€‰ï¼‰</strong></p>
<p><strong>ä½œç”¨</strong>ï¼šå½“ <code>areItemsTheSame()</code> è¿”å› <code>true</code> ä¸” <code>areContentsTheSame()</code> è¿”å› <code>false</code> æ—¶ï¼Œè¿”å›â€œå˜åŒ–çš„<strong>å·®é‡ä¿¡æ¯</strong>â€ã€‚è¯¥å¯¹è±¡ä¼šä½œä¸º <code>payload</code> ä¼ å…¥ Adapter çš„ <code>onBindViewHolder(holder, position, List&lt;Object&gt; payloads)</code>ï¼Œä»¥å®ç°å±€éƒ¨ç»‘å®šï¼ˆé¿å…æ•´æ¡ item é‡ç»‘å®šï¼‰ã€‚</p>
<p><strong>è¿”å›</strong>ï¼šè¿”å›<code>null</code>ç­‰åŒäºâ€œæ²¡æœ‰ payloadâ€ï¼ŒRecyclerView ä¼šåšå®Œæ•´ç»‘å®šã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœè¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œéœ€è¦åœ¨ Adapter é‡å†™<code>onBindViewHolder(..., payloads)</code>ã€‚</p>
</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDiffCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DiffUtil</span>.Callback {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;User&gt; oldList;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;User&gt; newList;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDiffCallback</span><span class="hljs-params">(List&lt;User&gt; oldList, List&lt;User&gt; newList)</span> {
        <span class="hljs-built_in">this</span>.oldList = oldList;
        <span class="hljs-built_in">this</span>.newList = newList;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOldListSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> oldList.size();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNewListSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> newList.size();
    }
    
    <span class="hljs-comment">// åˆ¤æ–­ä¸¤ä¸ªItemæ˜¯å¦ä»£è¡¨åŒä¸€ä¸ªå¯¹è±¡</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areItemsTheSame</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-comment">// é€šå¸¸æ¯”è¾ƒå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦‚ ID</span>
        <span class="hljs-keyword">return</span> oldList.get(oldItemPosition).getId() == newList.get(newItemPosition).getId();
    }
    
    <span class="hljs-comment">// åˆ¤æ–­ä¸¤ä¸ªItemçš„å†…å®¹æ˜¯å¦ç›¸åŒ</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areContentsTheSame</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">oldUser</span> <span class="hljs-operator">=</span> oldList.get(oldItemPosition);
        <span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> newList.get(newItemPosition);
        
        <span class="hljs-keyword">return</span> oldUser.equals(newItem);<span class="hljs-comment">//éœ€é‡å†™Userçš„equals()å’ŒhashCode()æ–¹æ³•</span>
        
        <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥æ¯”è¾ƒæ‰€æœ‰å­—æ®µ</span>
        <span class="hljs-comment">/* return oldUser.getName().equals(newUser.getName()) &amp;&amp;
               oldUser.getAge() == newUser.getAge() &amp;&amp;
               oldUser.getAvatarUrl().equals(newUser.getAvatarUrl());*/</span>
    }
    
    <span class="hljs-comment">// å¯é€‰ï¼šå½“ areItemsTheSame è¿”å› true ä½† areContentsTheSame è¿”å› false æ—¶è°ƒç”¨</span>
    <span class="hljs-comment">// ç”¨äºå±€éƒ¨æ›´æ–°ï¼Œé¿å…é‡æ–°ç»‘å®šæ•´ä¸ª item</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getChangePayload</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">oldUser</span> <span class="hljs-operator">=</span> oldList.get(oldItemPosition);
        <span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> newList.get(newItemPosition);
        
        <span class="hljs-type">Bundle</span> <span class="hljs-variable">diffBundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();
        
        <span class="hljs-keyword">if</span> (!oldUser.getName().equals(newUser.getName())) {
            diffBundle.putString(<span class="hljs-string">"name"</span>, newUser.getName());
        }
        
        <span class="hljs-keyword">if</span> (oldUser.getAge() != newUser.getAge()) {
            diffBundle.putInt(<span class="hljs-string">"age"</span>, newUser.getAge());
        }
        
        <span class="hljs-keyword">if</span> (!oldUser.getAvatarUrl().equals(newUser.getAvatarUrl())) {
            diffBundle.putString(<span class="hljs-string">"avatar"</span>, newUser.getAvatarUrl());
        }
       
        <span class="hljs-keyword">return</span> diffBundle.size() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> :diffBundle;
    }
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>
<p><strong>è¾“å…¥åˆ—è¡¨å¿…é¡»æ˜¯å¿«ç…§</strong>ï¼šåœ¨è®¡ç®— diff æ—¶ä¸è¦ä¿®æ”¹ old/new åˆ—è¡¨ã€‚æœ€ä¿é™©çš„åšæ³•æ˜¯å…ˆ <code>new ArrayList&lt;&gt;(old)</code> å’Œ <code>new ArrayList&lt;&gt;(newData)</code>ã€‚</p>
</li>
<li>
<p><strong>areItemsTheSame ä¸€å®šè¦ç¨³å®šä¸”å”¯ä¸€</strong>ï¼šä¸ç¨³å®šçš„ id ä¼šå¯¼è‡´é”™è¯¯çš„æ’å…¥/åˆ é™¤/ç§»åŠ¨ã€‚</p>
</li>
<li>
<p><strong>areContentsTheSame è¦å°½é‡é«˜æ•ˆ</strong>ï¼šé¿å…å¤æ‚è®¡ç®—ï¼Œæˆ–æå‰è®¡ç®— hash/codeã€‚ï¼ˆä½†è¦æ³¨æ„ equals è¯­ä¹‰ï¼‰</p>
</li>
<li>
<p><strong>getChangePayload è¿”å›è½»é‡å¯¹è±¡</strong>ï¼šä¸è¦è¿”å›å¤§çš„é›†åˆæˆ–å« Context çš„å¯¹è±¡ï¼Œæ¨èè¿”å› Bundle æˆ–ç®€å• POJOã€‚</p>
</li>
</ul>
<h5 data-id="heading-14">3.1.2 è°ƒç”¨ DiffUtil.calculateDiff è®¡ç®—å·®å¼‚ç»“æœ</h5>
<p>ä½¿ç”¨ä½ çš„ <code>Callback</code> å®ä¾‹è°ƒç”¨ <code>DiffUtil.calculateDiff</code>ï¼Œå®ƒå°†è®¡ç®—æ—§åˆ—è¡¨å’Œæ–°åˆ—è¡¨ä¹‹é—´çš„å·®å¼‚ï¼ˆé€šè¿‡ä½ åœ¨ <code>Callback</code> ä¸­çš„è§„åˆ™ï¼‰ï¼Œè¿”å›ä¸€ä¸ª <code>DiffResult</code>ï¼ˆæœ€å°å˜æ›´é›†ï¼‰ã€‚</p>
<p>è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>
<p><code>Callback</code></p>
<p>åŸºäºä½ å®ç°çš„ <code>DiffUtil.Callback</code>ï¼ˆ<code>areItemsTheSame</code> / <code>areContentsTheSame</code> / å¯é€‰ <code>getChangePayload</code>ï¼‰è®¡ç®—å‡ºæŠŠæ—§åˆ—è¡¨å˜æˆæ–°åˆ—è¡¨æ‰€éœ€çš„æœ€å°æ“ä½œåºåˆ—ï¼ˆå¢ã€åˆ ã€æ”¹ã€ç§»ï¼‰ã€‚</p>
</li>
<li>
<p><code>detectMoves</code>ï¼ˆ<strong>å¯é€‰</strong>ï¼‰</p>
<p>é»˜è®¤ä¸º<code>true</code>ï¼Œä¼šå°è¯•æ£€æµ‹**å…ƒç´ çš„ç§»åŠ¨ï¼ˆmoveï¼‰**å¹¶æŠŠå®ƒä½œä¸º <code>move</code> æ“ä½œï¼›æ£€æµ‹ move ä¼šé¢å¤–æ¶ˆè€—æ—¶é—´ã€‚</p>
<p>è®¾ç½®ä¸º<code>false</code>ï¼Œåˆ™ä¸æ£€æµ‹ moveï¼Œåªç”¨ insert/remove/changedï¼Œæ€§èƒ½æ›´å¥½ä½†æ²¡æœ‰ç§»åŠ¨åŠ¨ç”»ã€‚</p>
<p>æ£€æµ‹ç§»åŠ¨ä¼šæ¶ˆè€—æ›´å¤šæ—¶é—´ï¼Œå¦‚æœä½ ä¸å…³å¿ƒ item çš„ç§»åŠ¨åŠ¨ç”»ï¼Œå¯è®¾ä¸º <code>false</code> ä»¥æå‡æ€§èƒ½ã€‚</p>
</li>
</ul>
<p><strong>å¸¸ç”¨ç­¾å</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DiffUtil.DiffResult <span class="hljs-title function_">calculateDiff</span><span class="hljs-params">(DiffUtil.Callback cb)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DiffUtil.DiffResult <span class="hljs-title function_">calculateDiff</span><span class="hljs-params">(DiffUtil.Callback cb, <span class="hljs-type">boolean</span> detectMoves)</span>;
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<strong>å°½é‡é¿å…åœ¨ä¸»çº¿ç¨‹å¤§è§„æ¨¡è®¡ç®—</strong>ã€‚å¤§æ•°æ®é‡æ—¶æŠŠ <code>calculateDiff</code> æ”¾åˆ°åå°çº¿ç¨‹æˆ–ä½¿ç”¨ <code>AsyncListDiffer</code> / <code>ListAdapter</code>ï¼ˆå®ƒä»¬å†…éƒ¨å¼‚æ­¥è®¡ç®—ï¼‰ã€‚</p>
<h5 data-id="heading-15">3.1.3 DiffResult.dispatchUpdatesTo åˆ·æ–°</h5>
<p>ä½¿ç”¨<code>diffResult.dispatchUpdatesTo(target)</code><strong>æŠŠå˜æ›´é›†â€œåº”ç”¨â€åˆ°ç›®æ ‡</strong>ï¼ˆé€šå¸¸æ˜¯ <code>RecyclerView.Adapter</code> æˆ– <code>ListUpdateCallback</code>ï¼‰ï¼Œæœ€ç»ˆè§¦å‘ <code>notifyXXX</code> è°ƒç”¨ä¸ RecyclerView çš„åŠ¨ç”»/åˆ·æ–°ã€‚</p>
<p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠ <code>DiffResult</code> ä¸­çš„å˜æ›´<strong>ä»¥æ­£ç¡®é¡ºåº</strong>åˆ†å‘ç»™ç›®æ ‡ <code>ListUpdateCallback</code>ï¼ˆæˆ–ç›´æ¥ä¼  <code>RecyclerView.Adapter</code>ï¼‰ï¼Œç›®æ ‡æ”¶åˆ°å›è°ƒåé€šå¸¸ä¼šè°ƒç”¨ <code>notifyItemInserted/Removed/Changed/Moved</code>ï¼Œä»è€Œé©±åŠ¨ RecyclerView åšåŠ¨ç”»å’Œå±€éƒ¨æ›´æ–°ã€‚</p>
<p><strong>å¸¸ç”¨ç­¾å</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchUpdatesTo</span><span class="hljs-params">(RecyclerView.Adapter adapter)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchUpdatesTo</span><span class="hljs-params">(ListUpdateCallback updateCallback)</span>;
</code></pre>
<ul>
<li>å¦‚æœä¼  <code>RecyclerView.Adapter</code>ï¼Œå†…éƒ¨ä¼šå°è£…æˆ <code>AdapterListUpdateCallback(adapter)</code>ï¼ˆå®ƒä¼šæŠŠå›è°ƒè½¬æ¢ä¸º <code>adapter.notifyItemInserted(...)</code> ç­‰ï¼‰ã€‚</li>
<li>ä¹Ÿå¯ä»¥ä¼ è‡ªå®šä¹‰çš„ <code>ListUpdateCallback</code>ï¼Œç”¨äºæ‰‹å·¥æ§åˆ¶å¦‚ä½•åº”ç”¨å˜æ›´ï¼ˆä¾‹å¦‚å…ˆæ›´æ–° UI æ•°æ®ç»“æ„ï¼Œå†è°ƒç”¨ notifyï¼‰ã€‚</li>
</ul>
<p><strong>æ¨èåšæ³•</strong>ï¼š</p>
<ol>
<li>åœ¨åå°æˆ–åŒæ­¥åœ°è°ƒç”¨ <code>calculateDiff</code> å¾—åˆ° <code>diffResult</code>ã€‚</li>
<li>åœ¨ <strong>ä¸»çº¿ç¨‹</strong>ï¼ˆUI çº¿ç¨‹ï¼‰å…ˆ<strong>æ›¿æ¢ Adapter çš„ backing data</strong>ï¼ˆ<code>adapter.data = newList</code> æˆ– <code>adapter.setData(newList)</code>ï¼‰ã€‚</li>
<li>ç«‹å³è°ƒç”¨ <code>diffResult.dispatchUpdatesTo(adapter)</code>ã€‚</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateList</span><span class="hljs-params">(List&lt;User&gt; newList)</span> {
    <span class="hljs-comment">// è®¡ç®—å·®å¼‚</span>
    DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">diffResult</span> <span class="hljs-operator">=</span> DiffUtil.calculateDiff(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>(<span class="hljs-built_in">this</span>.userList, newList)
    );

    <span class="hljs-comment">// æ›´æ–°æ•°æ®æº</span>
    <span class="hljs-built_in">this</span>.userList.clear();
    <span class="hljs-built_in">this</span>.userList.addAll(newList);

    <span class="hljs-comment">// åˆ†å‘æ›´æ–°</span>
    diffResult.dispatchUpdatesTo(<span class="hljs-built_in">this</span>);
}
</code></pre>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆå…ˆæ›¿æ¢æ•°æ®ï¼Ÿ</strong></p>
<p>å› ä¸º <code>dispatchUpdatesTo</code> åœ¨å›è°ƒï¼ˆä¾‹å¦‚ <code>notifyItemChanged</code>ï¼‰æ—¶ï¼ŒRecyclerView ä¼šè°ƒç”¨ Adapter çš„ <code>getItemCount()</code> / <code>getItem(position)</code> ç­‰æ–¹æ³•ï¼›è‹¥æ•°æ®è¿˜æ²¡æ›´æ–°ï¼Œä¼šå¯¼è‡´ <code>IndexOutOfBoundsException</code> æˆ–æ˜¾ç¤ºæ—§æ•°æ®ã€‚
å¦‚æœä½ ä¸æƒ³å…ˆæ›¿æ¢æ•°æ®ï¼Œå¯ä»¥ dispatch åˆ°è‡ªå®šä¹‰ <code>ListUpdateCallback</code>ï¼Œåœ¨å›è°ƒé‡ŒæŒ‰ä½ éœ€è¦çš„é¡ºåºå…ˆæ›´æ–°æ•°æ®ç»“æ„å†è°ƒç”¨ <code>adapter.notifyXXX</code>ï¼ˆä½†è¿™æ ·æ›´æ˜“å‡ºé”™ï¼Œæ™®é€šåœºæ™¯ä¸å»ºè®®ï¼‰ã€‚</p>
</blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>dispatchUpdatesTo(...)</code> <strong>åœ¨è°ƒç”¨çº¿ç¨‹ä¸ŠåŒæ­¥æ‰§è¡Œ</strong>ï¼ˆä¼šç«‹å³è§¦å‘å¯¹åº”çš„ <code>notify...</code> è°ƒç”¨ï¼‰ã€‚å› æ­¤ï¼Œ<strong>å¿…é¡»åœ¨ä¸»çº¿ç¨‹</strong>å¯¹ RecyclerView/Adapter è¿›è¡Œ dispatchï¼ˆå¦åˆ™ä¼šæŠ›å¼‚å¸¸æˆ– UI ä¸å®‰å…¨ï¼‰ã€‚</p>
<p>å¦‚æœä½ æƒ³åœ¨æ¯ä¸ªå›è°ƒå‰ååšé¢å¤–å·¥ä½œï¼ˆä¾‹å¦‚æ›´æ–°å…¶ä»–æ•°æ®ç»“æ„ã€ç»Ÿè®¡æ—¥å¿—ã€æˆ–åœ¨ dispatch å‰åç¦ç”¨åŠ¨ç”»ï¼‰ï¼Œå¯ä»¥è‡ªå®šä¹‰ <code>ListUpdateCallback</code>ï¼š</p>
<pre><code class="hljs language-java" lang="java">DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> DiffUtil.calculateDiff(cb, <span class="hljs-literal">true</span>);
result.dispatchUpdatesTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListUpdateCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInserted</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count)</span> {
        <span class="hljs-comment">// å…ˆæ›´æ–° backing list æˆ–åšç»Ÿè®¡</span>
        adapter.notifyItemRangeInserted(position, count);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRemoved</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count)</span> {
        adapter.notifyItemRangeRemoved(position, count);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMoved</span><span class="hljs-params">(<span class="hljs-type">int</span> fromPosition, <span class="hljs-type">int</span> toPosition)</span> {
        adapter.notifyItemMoved(fromPosition, toPosition);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count, Object payload)</span> {
        adapter.notifyItemRangeChanged(position, count, payload);
    }
});
</code></pre>
<p>ä½†è´Ÿè´£æ‰‹åŠ¨åŒæ­¥æ•°æ®å’Œ dispatch çš„å¤æ‚æ€§è¾ƒé«˜ï¼Œä¸å»ºè®®æ»¥ç”¨ã€‚</p>
<h4 data-id="heading-16">3.2 åœ¨åå°çº¿ç¨‹æ‰§è¡Œè®¡ç®—</h4>
<p>å½“æ•°æ®é‡ä¸å¤§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨UIçº¿ç¨‹ä¸­ç›´æ¥æ›´æ–°æ•°æ®ï¼Œæ•°æ®é‡å¤§æ—¶å»ºè®®åœ¨åå°çº¿ç¨‹æ‰§è¡Œè®¡ç®—ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">Executors.newSingleThreadExecutor().execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">diffResult</span> <span class="hljs-operator">=</span>
            DiffUtil.calculateDiff(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemDiffCallback</span>(oldList, newList));

        <span class="hljs-comment">// åˆ‡å›ä¸»çº¿ç¨‹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper()).post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                mData.clear();
                mData.addAll(newList);

                <span class="hljs-comment">// æ›´æ–° RecyclerView</span>
                diffResult.dispatchUpdatesTo(adapter);
            }
        });
    }
});
</code></pre>
<h4 data-id="heading-17">3.3 AsyncListDiffer å’Œ ListAdapter</h4>
<p>ListAdapter å’Œ AsyncListDiffer éƒ½æ˜¯ Android å®˜æ–¹æ¶æ„ç»„ä»¶ä¸­ä¸ºäº†ç®€åŒ– RecyclerView.Adapter çš„æ•°æ®æ›´æ–°å’Œ DiffUtil çš„ä½¿ç”¨è€Œæä¾›çš„å·¥å…·ã€‚
å®ƒä»¬éƒ½æ˜¯åŸºäº DiffUtil çš„ï¼Œä½†å°è£…äº†åå°è®¡ç®—å·®å¼‚å’Œä¸»çº¿ç¨‹æ›´æ–°çš„ç»†èŠ‚ï¼Œè®©æˆ‘ä»¬æ›´å®¹æ˜“ä½¿ç”¨ã€‚</p>
<h5 data-id="heading-18">3.3.1 AsyncListDiffer</h5>
<p>AsyncListDiffer æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ RecyclerView é€‚é…å™¨ä¸­ä½¿ç”¨çš„å·¥å…·ç±»ï¼Œå®ƒè´Ÿè´£æŒæœ‰å½“å‰åˆ—è¡¨çš„æ•°æ®ï¼Œå¹¶ä¸”å½“æäº¤æ–°åˆ—è¡¨æ—¶ï¼Œä¼šè‡ªåŠ¨è®¡ç®—æ–°æ—§åˆ—è¡¨çš„å·®å¼‚ï¼Œç„¶åé€šè¿‡ RecyclerView.Adapter çš„æ›´æ–°æ–¹æ³•ï¼ˆå¦‚ notifyItemInserted ç­‰ï¼‰æ¥æ›´æ–°åˆ—è¡¨ã€‚</p>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª DiffUtil.ItemCallback çš„å®ç°ï¼Œç”¨äºå®šä¹‰å¦‚ä½•æ¯”è¾ƒåˆ—è¡¨ä¸­çš„é¡¹ç›®ã€‚</li>
<li>åœ¨é€‚é…å™¨ä¸­åˆ›å»ºä¸€ä¸ª AsyncListDiffer å®ä¾‹ã€‚</li>
<li>ä½¿ç”¨ AsyncListDiffer çš„ submitList æ–¹æ³•æ¥æ›´æ–°æ•°æ®ã€‚</li>
<li>åœ¨é€‚é…å™¨çš„æ–¹æ³•ä¸­ï¼Œé€šè¿‡ AsyncListDiffer è·å–æ•°æ®ã€‚</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°ã€getterã€setter...</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) o;
        <span class="hljs-keyword">return</span> age == user.age &amp;&amp;
               Objects.equals(id, user.id) &amp;&amp;
               Objects.equals(name, user.name);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Objects.hash(id, name, age);
    }
}

<span class="hljs-comment">// 2. åˆ›å»º DiffUtil.ItemCallback</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDiffCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DiffUtil</span>.ItemCallback&lt;User&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areItemsTheSame</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-keyword">return</span> oldItem.getId().equals(newItem.getId());
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areContentsTheSame</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-keyword">return</span> oldItem.equals(newItem);
    }
    
    <span class="hljs-comment">// å¯é€‰ï¼šè·å–å˜æ›´å†…å®¹ï¼ˆç”¨äºå±€éƒ¨æ›´æ–°ï¼‰</span>
    <span class="hljs-comment">// éœ€è¦åœ¨Adapterä¸­å¤„ç†payload</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getChangePayload</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, 
                                   <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-comment">// ...</span>
    }
}

<span class="hljs-comment">// 3. åœ¨ Adapter ä¸­ä½¿ç”¨ AsyncListDiffer</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;UserViewHolder&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsyncListDiffer&lt;User&gt; differ = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncListDiffer</span>&lt;&gt;(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>());
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitList</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        differ.submitList(users);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getItemCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> differ.getCurrentList().size();
    }
    
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> UserViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> differ.getCurrentList().get(position);
        holder.bind(user);
    }
}

<span class="hljs-comment">// 4. ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-type">UserAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAdapter</span>();
recyclerView.setAdapter(adapter);

<span class="hljs-comment">// æ›´æ–°æ•°æ®ï¼ˆè‡ªåŠ¨è®¡ç®—å·®å¼‚ï¼‰</span>
List&lt;User&gt; newUsers = fetchUsersFromNetwork();
adapter.submitList(newUsers);
</code></pre>
<p>è¿™é‡Œé¢æœ‰å‡ ä¸ªæ–¹æ³•éœ€è¦ä»‹ç»ä¸€ä¸‹ï¼š</p>
<ol>
<li><code>differ.getCurrentList()</code>ï¼ˆè¿”å› Listï¼‰
<ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿”å›å½“å‰å·²â€œæäº¤å¹¶åº”ç”¨â€çš„ä¸å¯å˜å¿«ç…§ï¼ˆ<code>List&lt;T&gt;</code>ï¼‰ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå®‰å…¨åœ¨ä¸»çº¿ç¨‹è¯»å–ï¼Œè¿”å›çš„æ˜¯å†…éƒ¨å¿«ç…§å¼•ç”¨ï¼Œä¸åº”ä¿®æ”¹ï¼›<code>getCurrentList().size()</code> å¯ç”¨äº <code>getItemCount()</code>ã€‚</li>
</ul>
</li>
<li><code>differ.getItem(int position)</code>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿”å› <code>getCurrentList().get(position)</code> çš„å…ƒç´ ï¼Œä¾¿äºåœ¨ <code>onBindViewHolder</code> ä¸­å–æ•°æ®ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼š<code>getItem</code> æ˜¯åªè¯»è§†å›¾ã€‚</li>
</ul>
</li>
<li><code>differ.submitList(List&lt;T&gt; newList)</code>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæäº¤æ–°åˆ—è¡¨ï¼ˆå¯ä»¥ä¸º <code>null</code>ï¼Œè¡¨ç¤ºæ¸…ç©ºåˆ—è¡¨ï¼‰è®© <code>AsyncListDiffer</code> å¼‚æ­¥è®¡ç®—å·®å¼‚å¹¶æŠŠç»“æœ dispatch ç»™ <code>ListUpdateCallback</code>ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šæ¯æ¬¡éƒ½åº”è¯¥æäº¤ä¸€ä¸ªæ–°çš„ List å®ä¾‹ï¼ˆå‰¯æœ¬ï¼‰ï¼Œä¸è¦ä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ã€‚<code>submitList</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä¼šå®‰æ’åå°è®¡ç®—ï¼Œä½†<strong>æœ€å¥½åœ¨ä¸»çº¿ç¨‹è°ƒç”¨</strong>ä»¥é¿å…è¾¹ç•Œæƒ…å†µï¼ˆå°½ç®¡ AsyncListDiffer å…è®¸ä»ä»»æ„çº¿ç¨‹æäº¤ï¼‰ã€‚</li>
<li><strong>å¯é€‰å›è°ƒ</strong>ï¼š<code>void submitList(List&lt;T&gt; list, @Nullable Runnable commitCallback)</code>ï¼Œ<code>commitCallback</code>ä¼šåœ¨å·®å¼‚è®¡ç®—å®Œæˆå¹¶ä¸”æ›´æ–°å·²åˆ†å‘åˆ° Adapter/RecyclerView åè¢«è°ƒç”¨ï¼ˆåœ¨ä¸»çº¿ç¨‹ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<p>AsyncListDifferå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå½“å‰åˆ—è¡¨ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­è®¡ç®—å·®å¼‚æ—¶ï¼Œä¼šæ‹·è´å½“å‰åˆ—è¡¨ä½œä¸ºæ—§åˆ—è¡¨ï¼‰ã€‚å½“ä½ è°ƒç”¨ submitList æäº¤æ–°åˆ—è¡¨æ—¶ï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªåå°ä»»åŠ¡ï¼ˆé€šè¿‡ä¸€ä¸ªåå°Executorï¼‰æ¥æ‰§è¡ŒDiffUtil.calculateDiffï¼Œç„¶åæ ¹æ®è®¡ç®—ç»“æœï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­é€šè¿‡RecyclerView.Adapterçš„æ›´æ–°æ–¹æ³•æ¥æ›´æ–°åˆ—è¡¨ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šAsyncListDiffer è¦æ±‚ RecyclerView.Adapter å®ç° ListUpdateCallback æ¥å£ï¼ˆå®é™…ä¸Š RecyclerView.Adapter å·²ç»å®ç°äº†è¿™ä¸ªæ¥å£ï¼‰ï¼Œä»¥ä¾¿åœ¨è®¡ç®—å¾—åˆ°å·®å¼‚åï¼Œè°ƒç”¨ç›¸åº”çš„æ›´æ–°æ–¹æ³•ã€‚</p>
<h5 data-id="heading-19">3.3.2 ListAdapter</h5>
<p>ListAdapter æ˜¯ Google å®˜æ–¹æä¾›çš„ä¸€ä¸ª RecyclerView.Adapter çš„å­ç±»ï¼Œå®ƒå†…éƒ¨å·²ç»å°è£…äº† AsyncListDifferï¼Œä½¿å¾—æˆ‘ä»¬ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚æˆ‘ä»¬åªéœ€è¦æŒ‡å®šä¸€ä¸ª DiffUtil.ItemCallbackï¼Œç„¶åé€šè¿‡ submitList æ–¹æ³•æ¥æ›´æ–°æ•°æ®å³å¯ã€‚</p>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª DiffUtil.ItemCallback çš„å®ç°ï¼ˆåŒä¸Šï¼‰ã€‚</li>
<li>ç»§æ‰¿ ListAdapterï¼Œå¹¶ä¼ å…¥ ItemCallbackã€‚</li>
<li>å®ç° onCreateViewHolder å’Œ onBindViewHolderã€‚</li>
<li>ä½¿ç”¨submitListæ›´æ–°æ•°æ®ã€‚</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. ç›´æ¥ç»§æ‰¿ ListAdapterï¼ˆæ— éœ€æ‰‹åŠ¨åˆ›å»º AsyncListDifferï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ListAdapter</span>&lt;User, UserViewHolder&gt; {
    
    <span class="hljs-comment">// 2. åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥ DiffCallback</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserListAdapter</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>);
    }
    
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item_user, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> UserViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getItem(position); <span class="hljs-comment">// ListAdapter æä¾›ï¼Œå†…éƒ¨è°ƒç”¨differ</span>
        holder.bind(user);
    }
}

<span class="hljs-comment">// 3. ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-type">UserListAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListAdapter</span>();
recyclerView.setAdapter(adapter);

<span class="hljs-comment">// æäº¤æ–°æ•°æ®ï¼ˆè‡ªåŠ¨åå°è®¡ç®—å·®å¼‚ï¼‰</span>
List&lt;User&gt; users = fetchUsersFromNetwork();
adapter.submitList(users);
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒListAdapter å·²ç»è¦†å†™å¹¶å®ç°äº† getItemCount()ï¼ˆå®ƒè¿”å› getCurrentList().size()ï¼‰ã€‚<strong>ä¸ç”¨é‡å†™ getItemCount()</strong>ï¼Œä¹Ÿä¸è¦å»ç»´æŠ¤è‡ªå·±çš„ data listã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<p>ListAdapter å†…éƒ¨å·²ç»æŒæœ‰ä¸€ä¸ª AsyncListDifferï¼Œå¹¶åœ¨æ„é€ æ—¶ä¼ å…¥ä¸€ä¸ª DiffUtil.ItemCallbackã€‚ListAdapter å·²ç»å®ç°äº† getItemCount() å’Œ getItem() ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯é€šè¿‡å†…éƒ¨çš„ AsyncListDiffer æ¥è·å–æ•°æ®ã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨ submitList æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†å†…éƒ¨ AsyncListDiffer çš„ submitList æ–¹æ³•ã€‚</p>
<h5 data-id="heading-20">æ³¨æ„äº‹é¡¹</h5>
<ul>
<li>ä¸ºäº†ç¡®ä¿ DiffUtil èƒ½å¤Ÿæ­£ç¡®å·¥ä½œï¼Œæ•°æ®æ¨¡å‹ç±»åº”è¯¥æ­£ç¡®å®ç° equals å’Œ hashCode æ–¹æ³•ï¼Œæˆ–è€…åœ¨ ItemCallback ä¸­æ­£ç¡®å®ç° areContentsTheSameã€‚</li>
<li>AsyncListDiffer å’Œ ListAdapter åœ¨æ¯”è¾ƒåˆ—è¡¨æ—¶ï¼Œä¼šæ¯”è¾ƒåˆ—è¡¨çš„å¼•ç”¨ã€‚å¦‚æœä½ æäº¤äº†ä¸€ä¸ªå’Œå½“å‰åˆ—è¡¨ç›¸åŒï¼ˆå¼•ç”¨ç›¸åŒï¼‰çš„åˆ—è¡¨ï¼Œé‚£ä¹ˆä¸ä¼šè§¦å‘è®¡ç®—ã€‚å› æ­¤ï¼Œ<strong>æ¯æ¬¡æ›´æ–°æ•°æ®æ—¶ï¼Œåº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨å¯¹è±¡</strong>ï¼Œæˆ–è€…ç¡®ä¿åœ¨ä¿®æ”¹åˆ—è¡¨åæäº¤ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚</li>
<li>AsyncListDiffer å’Œ ListAdapterçš„submitList æ–¹æ³•å¯ä»¥è¿ç»­è°ƒç”¨ï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡æäº¤çš„åˆ—è¡¨ä¼šè¢«è®¡ç®—å’Œæ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿ç»­æäº¤å¤šæ¬¡ï¼Œå¯èƒ½ä¼šè·³è¿‡ä¸­é—´çŠ¶æ€ã€‚</li>
<li>ç”±äº DiffUtil è®¡ç®—æ˜¯åœ¨åå°çº¿ç¨‹è¿›è¡Œçš„ï¼Œæ‰€ä»¥ç¡®ä¿åœ¨è®¡ç®—æœŸé—´ï¼Œæ—§åˆ—è¡¨å’Œæ–°åˆ—è¡¨ä¸ä¼šè¢«ä¿®æ”¹ã€‚å› æ­¤ï¼Œåœ¨ ItemCallback ä¸­ï¼Œåº”è¯¥åªè¯»å–åˆ—è¡¨ä¸­çš„æ•°æ®ï¼Œè€Œä¸åº”è¯¥ä¿®æ”¹å®ƒä»¬ã€‚</li>
</ul>
<h3 data-id="heading-21">æ€»ç»“</h3>
<p><strong>åˆ·æ–°æ–¹å¼å›é¡¾</strong></p>
<ul>
<li><strong>notifyDataSetChanged()</strong>ï¼šæœ€åŸºç¡€çš„åˆ·æ–°æ–¹å¼ï¼Œä½†æ•ˆç‡æœ€ä½ï¼Œä¼šé‡æ–°ç»‘å®šæ‰€æœ‰å¯è§é¡¹ï¼Œæ²¡æœ‰åŠ¨ç”»æ•ˆæœã€‚é€‚ç”¨äºæ•°æ®å®Œå…¨æ”¹å˜æˆ–åˆ—è¡¨å¾ˆå°çš„æƒ…å†µã€‚</li>
<li><strong>å±€éƒ¨åˆ·æ–°æ–¹æ³•ï¼ˆnotifyItemXxxï¼‰</strong>ï¼šåŒ…æ‹¬<code>notifyItemChanged</code>ã€<code>notifyItemInserted</code>ã€<code>notifyItemRemoved</code>ã€<code>notifyItemMoved</code>ä»¥åŠå¯¹åº”çš„èŒƒå›´æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•é’ˆå¯¹ç‰¹å®šä½ç½®æˆ–èŒƒå›´è¿›è¡Œæ›´æ–°ï¼Œæœ‰åŠ¨ç”»æ•ˆæœï¼Œæ•ˆç‡è¾ƒé«˜ã€‚é€‚ç”¨äºæ˜ç¡®çŸ¥é“å˜åŒ–ä½ç½®çš„æƒ…å†µã€‚</li>
<li><strong>DiffUtil</strong>ï¼šæ™ºèƒ½è®¡ç®—æ–°æ—§åˆ—è¡¨å·®å¼‚ï¼Œå¹¶è‡ªåŠ¨è°ƒç”¨åˆé€‚çš„å±€éƒ¨åˆ·æ–°æ–¹æ³•ã€‚æ•ˆç‡é«˜ï¼Œæœ‰åŠ¨ç”»æ•ˆæœï¼Œä½†éœ€è¦å®ç° DiffUtil.Callbackã€‚é€‚ç”¨äºå¤æ‚çš„æ•°æ®å˜åŒ–ï¼Œç‰¹åˆ«æ˜¯ä»åå°è·å–æ–°æ•°æ®å¹¶æ›´æ–°åˆ—è¡¨æ—¶ã€‚</li>
<li><strong>AsyncListDiffer</strong>ï¼šå°è£…äº†DiffUtilå’Œåå°çº¿ç¨‹è®¡ç®—ï¼Œç®€åŒ–äº†ä½¿ç”¨æ–¹å¼ã€‚éœ€è¦åœ¨ Adapter ä¸­åˆ›å»º AsyncListDiffer å®ä¾‹ï¼Œå¹¶å®ç° ItemCallbackã€‚</li>
<li><strong>ListAdapter</strong>ï¼šGoogle å®˜æ–¹æ¨èçš„ Adapter åŸºç±»ï¼Œå†…éƒ¨ä½¿ç”¨ AsyncListDifferï¼Œè®©å¼€å‘è€…æ›´ä¸“æ³¨äº ViewHolder å’Œç»‘å®šé€»è¾‘ã€‚é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯æ–°é¡¹ç›®ã€‚</li>
<li><strong>Payload</strong>ï¼šé…åˆä½¿ç”¨ï¼Œå…è®¸å±€éƒ¨æ›´æ–°ItemViewä¸­çš„ç‰¹å®šéƒ¨åˆ†ï¼Œé¿å…é‡æ–°ç»‘å®šæ•´ä¸ªItemViewï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚</li>
</ul>
<p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p>
<ul>
<li>å¯¹äºç®€å•çš„åˆ—è¡¨ï¼Œæ•°æ®é‡å°ï¼Œå˜åŒ–ä¸é¢‘ç¹ï¼Œå¯ä»¥ä½¿ç”¨<code>notifyDataSetChanged()</code>æˆ–å±€éƒ¨åˆ·æ–°æ–¹æ³•ã€‚</li>
<li>å¯¹äºæ•°æ®æºå¤æ‚ï¼Œé¢‘ç¹æ›´æ–°ï¼Œä¸”è¿½æ±‚é«˜æ€§èƒ½å’ŒåŠ¨ç”»æ•ˆæœï¼Œæ¨èä½¿ç”¨<code>DiffUtil</code>æˆ–å…¶å°è£…ç±»ï¼ˆ<code>AsyncListDiffer</code>ã€<code>ListAdapter</code>ï¼‰ã€‚</li>
<li>åœ¨æ–°é¡¹ç›®ä¸­ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨<code>ListAdapter</code>ï¼Œå®ƒå·²ç»å°è£…äº†æœ€ä½³å®è·µã€‚</li>
<li>å½“åˆ—è¡¨é¡¹è§†å›¾å¤æ‚ï¼Œä¸”åªæœ‰éƒ¨åˆ†å†…å®¹éœ€è¦æ›´æ–°æ—¶ï¼Œä½¿ç”¨<code>Payload</code>è¿›è¡Œå±€éƒ¨æ›´æ–°ã€‚</li>
</ul>
<hr/>
<p><strong>æœ€åï¼Œæ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app D8 å®æˆ˜ï¼ˆå°å…”é²œï¼‰]]></title>    <link>https://juejin.cn/post/7579641251910221834</link>    <guid>https://juejin.cn/post/7579641251910221834</guid>    <pubDate>2025-12-03T15:53:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579641251910221834" data-draft-id="7579473409748746291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app D8 å®æˆ˜ï¼ˆå°å…”é²œï¼‰ "/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-03T15:53:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çˆ±æ³¡è„šçš„é¸¡è…¿"/> <meta itemprop="url" content="https://juejin.cn/user/4466663535419179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app D8 å®æˆ˜ï¼ˆå°å…”é²œï¼‰ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466663535419179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çˆ±æ³¡è„šçš„é¸¡è…¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:53:28.000Z" title="Wed Dec 03 2025 15:53:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.å¡«å†™è®¢å•</h2>
<h3 data-id="heading-1">1.1 æ¸²æŸ“åŸºæœ¬ä¿¡æ¯</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2e1cdc571bd44fe94be0dbd25bd2b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=oXVQxZVOmDMprP7qxmoLFh74RlY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">1.1.1 è®¾ç½®ç‹¬ç«‹çš„åˆ†åŒ…(é™æ€ç»“æ„)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºåŸŸè·ç¦»</span>
<span class="hljs-keyword">const</span> { safeAreaInsets } = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
<span class="hljs-comment">// è®¢å•å¤‡æ³¨</span>
<span class="hljs-keyword">const</span> buyerMessage = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-comment">// é…é€æ—¶é—´</span>
<span class="hljs-keyword">const</span> deliveryList = <span class="hljs-title function_">ref</span>([
    { <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'æ—¶é—´ä¸é™ (å‘¨ä¸€è‡³å‘¨æ—¥)'</span> },
    { <span class="hljs-attr">type</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'å·¥ä½œæ—¥é€ (å‘¨ä¸€è‡³å‘¨äº”)'</span> },
    { <span class="hljs-attr">type</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'å‘¨æœ«é…é€ (å‘¨å…­è‡³å‘¨æ—¥)'</span> }
]);
<span class="hljs-comment">// å½“å‰é…é€æ—¶é—´ä¸‹æ ‡</span>
<span class="hljs-keyword">const</span> activeIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// å½“å‰é…é€æ—¶é—´</span>
<span class="hljs-keyword">const</span> activeDelivery = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> deliveryList.<span class="hljs-property">value</span>[activeIndex.<span class="hljs-property">value</span>]);
<span class="hljs-comment">// ä¿®æ”¹é…é€æ—¶é—´</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">onChangeDelivery</span>: <span class="hljs-title class_">UniHelper</span>.<span class="hljs-property">SelectorPickerOnChange</span> = <span class="hljs-function">(<span class="hljs-params">ev</span>) =&gt;</span> {
    activeIndex.<span class="hljs-property">value</span> = ev.<span class="hljs-property">detail</span>.<span class="hljs-property">value</span>;
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"viewport"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ”¶è´§åœ°å€ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shipment"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pagesMember/address/address?from=order"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span>&gt;</span>å¼ ä¸‰ 13333333333<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"address"</span>&gt;</span>å¹¿ä¸œçœ å¹¿å·å¸‚ å¤©æ²³åŒº é»‘é©¬ç¨‹åºå‘˜3<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon icon-right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shipment"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pagesMember/address/address?from=order"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"address"</span>&gt;</span>è¯·é€‰æ‹©æ”¶è´§åœ°å€<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon icon-right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- å•†å“ä¿¡æ¯ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"goods"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in 2"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:url</span>=<span class="hljs-string">"`/pages/goods/goods?id=1`"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picture"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://yanxuan-item.nosdn.127.net/c07edde1047fa1bd0b795bed136c2bb2.jpg"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"name ellipsis"</span>&gt;</span>insé£å°ç¢èŠ±æ³¡æ³¡è¢–è¡¬110-160cm<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attrs"</span>&gt;</span>è—é’å°èŠ± 130<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"prices"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pay-price symbol"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price symbol"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"count"</span>&gt;</span>x5<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- é…é€åŠæ”¯ä»˜æ–¹å¼ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"related"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>é…é€æ—¶é—´<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">picker</span> <span class="hljs-attr">:range</span>=<span class="hljs-string">"deliveryList"</span> <span class="hljs-attr">range-key</span>=<span class="hljs-string">"text"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"onChangeDelivery"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-fonts picker"</span>&gt;</span>{{ activeDelivery.text }}<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">picker</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>è®¢å•å¤‡æ³¨<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">:cursor-spacing</span>=<span class="hljs-string">"30"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"é€‰é¢˜ï¼Œå»ºè®®ç•™è¨€å‰å…ˆä¸å•†å®¶æ²Ÿé€šç¡®è®¤"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"buyerMessage"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ”¯ä»˜é‡‘é¢ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"settlement"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>å•†å“æ€»ä»·:<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number symbol"</span>&gt;</span>495.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>è¿è´¹:<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number symbol"</span>&gt;</span>5.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å¸åº•å·¥å…·æ  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"toolbar"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ paddingBottom: safeAreaInsets?.bottom + 'px' }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"total-pay symbol"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ disabled: true }"</span>&gt;</span>æäº¤è®¢å•<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
page {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f4f4f4</span>;
}

<span class="hljs-selector-class">.symbol</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">'Â¥'</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">80%</span>;
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5</span>rpx;
}

<span class="hljs-selector-class">.shipment</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx <span class="hljs-number">30</span>rpx <span class="hljs-number">30</span>rpx <span class="hljs-number">84</span>rpx;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/locate.png</span>) <span class="hljs-number">20</span>rpx center / <span class="hljs-number">50</span>rpx no-repeat <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">position</span>: relative;

    <span class="hljs-selector-class">.icon</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">36</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">50%</span>);
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
        <span class="hljs-attribute">right</span>: <span class="hljs-number">20</span>rpx;
    }

    <span class="hljs-selector-class">.user</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5</span>rpx;
    }

    <span class="hljs-selector-class">.address</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    }
}

<span class="hljs-selector-class">.goods</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx <span class="hljs-number">0</span>;
        <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1</span>rpx solid <span class="hljs-number">#eee</span>;

        &amp;<span class="hljs-selector-pseudo">:first</span>-child {
            <span class="hljs-attribute">border-top</span>: none;
        }

        <span class="hljs-selector-class">.picture</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">170</span>rpx;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">170</span>rpx;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
            <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20</span>rpx;
        }

        <span class="hljs-selector-class">.meta</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">position</span>: relative;
        }

        <span class="hljs-selector-class">.name</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">80</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
        }

        <span class="hljs-selector-class">.attrs</span> {
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">15</span>rpx;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
            <span class="hljs-attribute">align-self</span>: flex-start;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#888</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f7f7f8</span>;
        }

        <span class="hljs-selector-class">.prices</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: baseline;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28</span>rpx;

            <span class="hljs-selector-class">.pay-price</span> {
                <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10</span>rpx;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;
            }

            <span class="hljs-selector-class">.price</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
                <span class="hljs-attribute">text-decoration</span>: line-through;
            }
        }

        <span class="hljs-selector-class">.count</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
        }
    }
}

<span class="hljs-selector-class">.related</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">justify-content</span>: space-between;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">80</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    }

    <span class="hljs-selector-class">.input</span> {
        <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
        <span class="hljs-attribute">text-align</span>: right;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx <span class="hljs-number">0</span>;
        <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">20</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    }

    <span class="hljs-selector-class">.item</span> <span class="hljs-selector-class">.text</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">125</span>rpx;
    }

    <span class="hljs-selector-class">.picker</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    }

    <span class="hljs-selector-class">.picker</span><span class="hljs-selector-pseudo">::after</span> {
        <span class="hljs-attribute">content</span>: <span class="hljs-string">'\e6c2'</span>;
    }
}

<span class="hljs-comment">/* ç»“ç®—æ¸…å• */</span>
<span class="hljs-selector-class">.settlement</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: space-between;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">80</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    }

    <span class="hljs-selector-class">.danger</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;
    }
}

<span class="hljs-comment">/* å¸åº•å·¥å…·æ  */</span>
<span class="hljs-selector-class">.toolbar</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--window-bottom));
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;

    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1</span>rpx solid <span class="hljs-number">#eaeaea</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">box-sizing</span>: content-box;

    <span class="hljs-selector-class">.total-pay</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">40</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;

        <span class="hljs-selector-class">.decimal</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">75%</span>;
        }
    }

    <span class="hljs-selector-class">.button</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">220</span>rpx;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">72</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">72</span>rpx;
        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#27ba9b</span>;
    }

    <span class="hljs-selector-class">.disabled</span> {
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
    }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</code></pre>
<p>ç»“æœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3d7fd78e0104fbfbdbd25737c5b6a57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=Uv7qVx3QKFb7Otbh1qLFXTZZySk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.1.2 å°è£…è®¢å•API</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3cd8a953096427f9b6a20be0e678c32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=oeyE1yIGKCDuDzqYxmh2zvibweE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.1.3 è·å–è®¢å•çš„å‡½æ•°</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/134e29c3a5f9485989e3c4f46134fc29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=5VFsGwg2WnajHFZVX6MCyE0fu24%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">1.1.4 å°è£…ç±»å‹å£°æ˜æ–‡ä»¶</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { AddressItem } from <span class="hljs-string">'./address'</span>

<span class="hljs-comment">/** è·å–é¢„ä»˜è®¢å• è¿”å›ä¿¡æ¯ */</span>
export <span class="hljs-keyword">type</span> OrderPreResult = {
  <span class="hljs-comment">/** å•†å“é›†åˆ [ å•†å“ä¿¡æ¯ ] */</span>
  goods: OrderPreGoods[]
  <span class="hljs-comment">/** ç»“ç®—ä¿¡æ¯ */</span>
  summary: {
    <span class="hljs-comment">/** å•†å“æ€»ä»· */</span>
    totalPrice: number
    <span class="hljs-comment">/** é‚®è´¹ */</span>
    postFee: number
    <span class="hljs-comment">/** åº”ä»˜é‡‘é¢ */</span>
    totalPayPrice: number
  }
  <span class="hljs-comment">/** ç”¨æˆ·åœ°å€åˆ—è¡¨ [ åœ°å€ä¿¡æ¯ ] */</span>
  userAddresses: AddressItem[]
}

<span class="hljs-comment">/** å•†å“ä¿¡æ¯ */</span>
export <span class="hljs-keyword">type</span> OrderPreGoods = {
  <span class="hljs-comment">/** å±æ€§æ–‡å­—ï¼Œä¾‹å¦‚â€œé¢œè‰²:ç“·ç™½è‰² å°ºå¯¸ï¼š8å¯¸â€ */</span>
  attrsText: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** æ•°é‡ */</span>
  count: number
  <span class="hljs-comment">/** id */</span>
  id: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** å•†å“åç§° */</span>
  name: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** å®ä»˜å•ä»· */</span>
  payPrice: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** å›¾ç‰‡ */</span>
  picture: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** åŸå•ä»· */</span>
  price: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** SKUID */</span>
  skuId: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** å®ä»˜ä»·æ ¼å°è®¡ */</span>
  totalPayPrice: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** å°è®¡æ€»ä»· */</span>
  totalPrice: <span class="hljs-type">string</span>
}

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a00dfabd2124e39a354ce95ed1f1357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=V8vdvlRhlZ6dBsYZyPA459XzoY0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">1.1.5 å­˜å‚¨è·å–åˆ°çš„è®¢å•ä¿¡æ¯åˆ°ref</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7f84ccaf7ab494a9ede8fd84011d50c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=r7xiA4TWJYLpJbcQo7HBssqkxCo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">1.1.6 æ¸²æŸ“è·å–åˆ°çš„æ•°æ®åˆ°æ ‡ç­¾ä¸­</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/215a794410ec4272837aa9e3e151239f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=1FeHUTOrnKbvF9TU19gNfemwpVk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74c788b2712d4fb69d659d320cc6e522~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=wJPMduUP7cSyxutxhBeR3aese6o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">1.1.7 å†åœ¨å…ˆå‰çš„è´­ç‰©è½¦ä»£ç ä¸­æ·»åŠ ä¸€è¡Œç»“ç®—ä»£ç </h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe469480e2d4a5687109ef04aa34e80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=5lDUDYX5gXQw5kngt7Rxk83N3mY%3D" alt="image.png" loading="lazy"/>
ç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51f94e774db54bf8b8f7fe426bcd202c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=YtmUkyTlZoScc8LZFR570m%2FJd8c%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">1.2 æ”¶è´§åœ°å€</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Androidã€‘æ·±å…¥ç†è§£Windowå’ŒWindowManager]]></title>    <link>https://juejin.cn/post/7579518059170529306</link>    <guid>https://juejin.cn/post/7579518059170529306</guid>    <pubDate>2025-12-03T15:00:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579518059170529306" data-draft-id="7579473409749254195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Androidã€‘æ·±å…¥ç†è§£Windowå’ŒWindowManager"/> <meta itemprop="keywords" content="Android,Java"/> <meta itemprop="datePublished" content="2025-12-03T15:00:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼¥å··"/> <meta itemprop="url" content="https://juejin.cn/user/1743186606454698"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Androidã€‘æ·±å…¥ç†è§£Windowå’ŒWindowManager
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743186606454698/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼¥å··
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:00:53.000Z" title="Wed Dec 03 2025 15:00:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€Windowç®€ä»‹</h2>
<p>Windowæ˜¯ä¸€ä¸ªæŠ½è±¡çš„â€œçª—å£â€å¯¹è±¡ï¼Œç”¨æ¥æ‰¿è½½è§†å›¾ã€‚å®ƒè´Ÿè´£æ‰¿è½½æ‰€æœ‰UIï¼Œæ‰€æœ‰Viewæœ€ç»ˆéƒ½å¿…é¡»é™„ç€åœ¨ä¸€ä¸ªWindowä¸­æ‰èƒ½æ˜¾ç¤ºã€‚ä¸ç®¡æ˜¯Activityã€Dialogï¼Œè¿˜æ˜¯Toastï¼Œå®ƒä»¬çš„è§†å›¾éƒ½æ˜¯é™„åŠ åœ¨Windowä¸Šé¢çš„ã€‚ä¾‹å¦‚è¦åœ¨æ¡Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ‚¬æµ®çª—ï¼Œå°±éœ€è¦Windowæ¥å®ç°ã€‚</p>
<p>å®é™…ä¸Šï¼ŒWindowæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å”¯ä¸€å®ç°ç±»æ˜¯PhoneWindowï¼ŒActivityä¸­çš„DecorViewï¼ŒDialogä¸­çš„Viewéƒ½æ˜¯åœ¨PhoneWindowä¸­åˆ›å»ºçš„ã€‚å› æ­¤Windowå®é™…æ˜¯Viewçš„ç›´æ¥ç®¡ç†è€…ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>Windowæ˜¯Viewçš„è½½ä½“ï¼ŒViewæ˜¯Windowçš„è¡¨ç°å½¢å¼</strong>ã€‚</p>
<h2 data-id="heading-1">2ã€Windowå’ŒWindowManager</h2>
<p>å…ˆæ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡WindowManageræ·»åŠ ä¸€ä¸ªWindowï¼š</p>
<pre><code class="hljs language-java" lang="java">windowManager = (WindowManager) getSystemService(WINDOW_SERVICE);

<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè¦æ·»åŠ åˆ° Window çš„ View</span>
floatingView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextView</span>(<span class="hljs-built_in">this</span>);
floatingView.setText(<span class="hljs-string">"Window"</span>);
floatingView.setTextSize(<span class="hljs-number">20f</span>);
floatingView.setBackgroundColor(Color.WHITE);
floatingView.setTextColor(Color.BLACK);

<span class="hljs-comment">// Window å‚æ•°</span>
WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManager</span>.LayoutParams(
        WindowManager.LayoutParams.WRAP_CONTENT,
        WindowManager.LayoutParams.WRAP_CONTENT,
        <span class="hljs-number">0</span>,
        <span class="hljs-number">0</span>,
        PixelFormat.TRANSLUCENT
);

<span class="hljs-comment">// Window ç±»å‹ï¼ˆåº”ç”¨å†…çª—å£ï¼‰</span>
params.type = WindowManager.LayoutParams.TYPE_APPLICATION;

<span class="hljs-comment">// ä¸è·å–ç„¦ç‚¹ã€ä¸æ‹¦æˆªäº‹ä»¶</span>
params.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE
| WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;

<span class="hljs-comment">// æ˜¾ç¤ºä½ç½®ï¼ˆå³ä¸‹è§’åç§»ï¼‰</span>
params.gravity = Gravity.END | Gravity.BOTTOM;
params.x = <span class="hljs-number">100</span>;
params.y = <span class="hljs-number">300</span>;

<span class="hljs-comment">// æ·»åŠ åˆ° WindowManager</span>
windowManager.addView(floatingView, params);
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥åœ¨é¡µé¢å³ä¸‹è§’æ˜¾ç¤ºä¸€ä¸ªWindowï¼Œè€Œè¯¥Windowçš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªTextView</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d576ae593540be985941045d64498b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=WO9FCmaMd3B9W33uYajMi%2B2NaqM%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°æœ€åæ˜¯é€šè¿‡<code>addView</code>æ–¹æ³•å°†è¯¥Windowæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šViewå’ŒWindowManager.LayoutParamsï¼ŒViewå°±æ˜¯å¾…ä¼šè¦æ˜¾ç¤ºçš„Viewï¼ŒLayoutParamsæ˜¯è¯¥Viewçš„å¸ƒå±€å‚æ•°ï¼Œå…³äºLayoutParamsæœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å±æ€§ï¼štypeå’Œflagsã€‚</p>
<h3 data-id="heading-2">2.1 typeå±æ€§</h3>
<p>typeå±æ€§è¡¨ç¤ºWindowçš„ç±»å‹ï¼Œç”¨äºå‘Šè¯‰ç³»ç»Ÿè¿™æ˜¯å“ªç§çª—å£ã€‚å®ƒçš„å±‚çº§ã€æƒé™ã€ä½ç½®å¦‚ä½•å¤„ç†ã€‚ç±»å‹åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>åº”ç”¨çª—å£ï¼šå¯¹åº”ä¸€ä¸ªActivity</li>
<li>å­çª—å£ï¼šå­çª—å£ä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œéœ€è¦é™„å±åœ¨ç‰¹å®šçš„çˆ¶çª—å£ä¸­ï¼Œæ¯”å¦‚å¸¸è§çš„Dialogã€‚</li>
<li>ç³»ç»Ÿçª—å£ï¼šæ˜¯éœ€è¦å£°æ˜æƒé™æ‰èƒ½åˆ›å»ºçš„çª—å£ï¼Œæ¯”å¦‚Toastå’Œç³»ç»ŸçŠ¶æ€æ </li>
</ul>
<p>å¸¸ç”¨å±æ€§ï¼š</p>








































<table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>æƒé™</th></tr></thead><tbody><tr><td><strong>TYPE_APPLICATION</strong></td><td>é»˜è®¤ Activity Windowï¼›ä¹Ÿå¯ç”¨æ¥åœ¨ Activity å†…æ·»åŠ æ‚¬æµ® View</td><td>å¦</td></tr><tr><td><strong>TYPE_APPLICATION_PANEL</strong></td><td>é™„ç€åœ¨åº”ç”¨çª—å£ä¸Šçš„é¢æ¿ï¼Œå¦‚ Dialog</td><td>å¦</td></tr><tr><td><strong>TYPE_APPLICATION_ATTACHED_DIALOG</strong></td><td>ä¾é™„åœ¨ Activity ä¸Šçš„å¯¹è¯æ¡†ç±»çª—å£</td><td>å¦</td></tr><tr><td><strong>TYPE_APPLICATION_SUB_PANEL</strong></td><td>å­é¢æ¿ï¼Œæ¯”å¦‚ PopupWindow</td><td>å¦</td></tr><tr><td><strong>TYPE_BASE_APPLICATION</strong></td><td>Activity çš„åŸºç¡€çª—å£</td><td>å¦</td></tr><tr><td><strong>TYPE_APPLICATION_OVERLAY</strong></td><td>ç³»ç»Ÿæ‚¬æµ®çª—ï¼ˆå¾®ä¿¡æ‚¬æµ®çƒã€æ‚¬æµ®è®°äº‹æœ¬ï¼‰ï¼Œéœ€è¦æƒé™ï¼ˆ<strong>SYSTEM_ALERT_WINDOW</strong>ï¼‰</td><td>æ˜¯</td></tr></tbody></table>
<p>å¦å¤–ï¼Œçª—å£ç±»å‹çš„åŒºåˆ†å°±å†³å®šäº†Windowçš„æ˜¾ç¤ºå±‚åºã€‚å¦‚æœä¸€ä¸ªWindowæ˜¯ç³»ç»Ÿçª—å£ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¼šæ˜¾ç¤ºåœ¨å…¶ä»–åº”ç”¨ç¨‹åºWindowä¸Šé¢ã€‚è€Œæ§åˆ¶æ˜¾ç¤ºå±‚çº§é¡ºåºçš„å±æ€§æ˜¯Z-Orderï¼Œå³Zè½´çš„å€¼ã€‚è¿™é‡ŒæŒ‡å®šäº†å“ªç§çª—å£ï¼Œå°±ç›¸å½“äºæŒ‡å®šäº†Zè½´çš„å€¼ï¼š</p>
<ul>
<li>åº”ç”¨çª—å£ï¼š1~99</li>
<li>å­çª—å£ï¼š1000~1999</li>
<li>ç³»ç»Ÿçª—å£ï¼š2000~2999</li>
</ul>
<p>å€¼è¶Šå¤§ï¼Œæ˜¾ç¤ºçš„è¶Šä¸Šé¢ï¼Œå°±æ˜¯è¯´typeå€¼å¤§çš„Windowå¯ä»¥ç›–ä½typeå€¼å°çš„Windowã€‚</p>
<h3 data-id="heading-3">2.2 flagså±æ€§</h3>
<p>flagsè¡¨ç¤ºWindowçš„å±æ€§ï¼Œé€šè¿‡flagså¯ä»¥æ§åˆ¶Windowçš„æ˜¾ç¤ºç‰¹æ€§ã€‚æ¯”å¦‚å†³å®šçª—å£æ˜¯å¦å¯è§¦æ‘¸ï¼Œæ˜¯å¦è¦†ç›–çŠ¶æ€æ ï¼Œæ˜¯å¦ç‚¹å‡»ç©¿é€ç­‰ç­‰ã€‚</p>
<p>å¸¸ç”¨é€‰é¡¹ï¼š</p>









































<table><thead><tr><th>flags</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>FLAG_NOT_FOCUSABLE</strong></td><td>ä¸è·å–ç„¦ç‚¹ ï¼Œ å…¶ä»–æ§ä»¶ä¸ä¼šå—å½±å“ï¼ˆå¸¸ç”¨äºæ‚¬æµ®çª—ï¼‰</td></tr><tr><td><strong>FLAG_NOT_TOUCH_MODAL</strong></td><td>è‡ªå·±èŒƒå›´å¤–çš„è§¦æ‘¸äº‹ä»¶ç»§ç»­ä¼ é€’ç»™åº•å±‚çª—å£ï¼Œåªå¤„ç†è‡ªèº«åŒºåŸŸçš„è§¦æ‘¸</td></tr><tr><td><strong>FLAG_NOT_TOUCHABLE</strong></td><td>ä¸æ¥æ”¶ä»»ä½•è§¦æ‘¸äº‹ä»¶ï¼ˆå®Œå…¨ç©¿é€ï¼‰ï¼Œå¸¸ç”¨äºå±å¹•æ°´å°ã€æç¤ºå±‚</td></tr><tr><td><strong>FLAG_LAYOUT_IN_SCREEN</strong></td><td>å…è®¸ window å¡«æ»¡æ•´ä¸ªå±å¹•åŒºåŸŸï¼Œå…¨å±çª—å£ä½¿ç”¨</td></tr><tr><td><strong>FLAG_FULLSCREEN</strong></td><td>éšè—çŠ¶æ€æ ï¼Œè¿›å…¥å…¨å±æ˜¾ç¤ºï¼Œç”¨äºè§†é¢‘å…¨å±ã€æ¸¸æˆã€æ²‰æµ¸æ¨¡å¼</td></tr><tr><td><strong>FLAG_SHOW_WHEN_LOCKED</strong></td><td>åœ¨é”å±ç•Œé¢ä¸Šæ˜¾ç¤ºWindowï¼Œå¦‚æ¥ç”µç•Œé¢ã€é—¹é’Ÿç•Œé¢</td></tr><tr><td><strong>FLAG_KEEP_SCREEN_ON</strong></td><td>é˜²æ­¢å±å¹•ç†„ç­ï¼Œç”¨äºè§†é¢‘æ’­æ”¾ã€å¯¼èˆªã€é•¿æ—¶é—´å±•ç¤ºçš„çª—å£</td></tr><tr><td><strong>FLAG_TURN_SCREEN_ON</strong></td><td>æ˜¾ç¤ºçª—å£æ—¶è‡ªåŠ¨äº®å±ï¼Œç”¨äºé—¹é’Ÿã€å®šæ—¶æé†’ã€ç‰¹æ®Šè­¦å‘Šç•Œé¢</td></tr></tbody></table>
<p>å¦å¤–è®¾ç½®flagsè¿˜å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åœ¨ç°æœ‰flagsä¸Šâ€œè¿½åŠ â€ä¸€ä¸ªflag</span>
getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);

<span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºâ€œmaskâ€ï¼Œé€šå¸¸ä¸ flags ç›¸åŒã€‚</span>
<span class="hljs-comment">// setFlags ä¼šæ ¹æ® mask è¦†ç›–ï¼Œè€Œä¸æ˜¯è¿½åŠ ã€‚</span>
getWindow().setFlags(
        WindowManager.LayoutParams.FLAG_FULLSCREEN,
        WindowManager.LayoutParams.FLAG_FULLSCREEN
);
</code></pre>
<h3 data-id="heading-4">2.3 WindowManager</h3>
<p>WindowManageræ‰€æä¾›çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå¸¸ç”¨çš„åªæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼šæ·»åŠ Viewã€æ›´æ–°Viewå’Œåˆ é™¤Viewã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bc2e8e0e4d4aa299b2f5a592008513~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=IcJTfRrlVCEiiJDBHJYk5bJ6Fkw%3D" alt="" loading="lazy"/></p>
<p>è¿™è¡¨æ˜WindowManageræ˜¯ç»§æ‰¿ViewManagerè¿™ä¸ªæ¥å£çš„ï¼ŒåŒæ—¶WindowManageræœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ã€‚</p>
<p>è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨ViewManagerä¸­çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ViewManager</span> {     
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span>;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span>;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view)</span>;
}
</code></pre>
<h2 data-id="heading-5">3ã€Windowçš„å†…éƒ¨æœºåˆ¶</h2>
<p>Windowæ˜¯Androidä¸­çš„çª—å£æŠ½è±¡ï¼ŒWindowå¹¶ä¸æ˜¯å®é™…å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ä»¥Viewçš„å½¢å¼å­˜åœ¨ã€‚åœ¨WindowManagerä¸­æä¾›çš„ä¸‰ä¸ªæ¥å£æ–¹æ³•éƒ½æ˜¯é’ˆå¯¹Viewçš„ï¼Œè¿™è¯´æ˜Viewæ‰æ˜¯Windowå­˜åœ¨çš„å®ä½“ã€‚æ¯ä¸ªWindowéƒ½å¯¹åº”ä¸€ä¸ªViewå’Œä¸€ä¸ªViewRootImplï¼Œ<strong>Windowå’ŒViewé€šè¿‡ViewRootImplæ¥å»ºç«‹è”ç³»</strong>ã€‚WindowManageræ˜¯ç®¡ç†Windowçš„æ¥å£ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­æ— æ³•ç›´æ¥è®¿é—®Windowï¼Œå¯¹Windowçš„è®¿é—®å¿…é¡»é€šè¿‡WindowManagerã€‚ä¸ºäº†å¼„æ¸…æ¥šWindowçš„å†…éƒ¨æœºåˆ¶ï¼Œè¿™é‡Œä»Windowçš„æ·»åŠ ã€åˆ é™¤å’Œæ›´æ–°è¯´èµ·ã€‚</p>
<h3 data-id="heading-6">3.1 Windowçš„æ·»åŠ è¿‡ç¨‹</h3>
<p>Windowçš„æ·»åŠ è¿‡ç¨‹æ˜¯é€šè¿‡addViewæ¥å®ç°çš„ï¼š</p>
<pre><code class="hljs language-java" lang="java">windowManager.addView(floatingView, params);
</code></pre>
<p>WindowManageræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„çœŸæ­£å®ç°ç±»æ˜¯WindowManagerImplç±»ï¼Œåœ¨WindowManagerImplä¸­ä¸‰ä¸ªæ“ä½œå®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> {
    applyTokens(params);
    mGlobal.addView(view, params, mContext.getDisplayNoVerify(), mParentWindow,
            mContext.getUserId());
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> {
    applyTokens(params);
    mGlobal.updateViewLayout(view, params);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view)</span> {
    mGlobal.removeView(view, <span class="hljs-literal">false</span>);
}
</code></pre>
<p>å¯ä»¥çœ‹å‡ºï¼ŒWindowManagerImplå¹¶æ²¡æœ‰ç›´æ¥å®ç°Windowçš„ä¸‰å¤§æ“ä½œï¼Œè€Œæ˜¯è°ƒç”¨mGlobalå»å¤„ç†ã€‚è¿™ä¸ªmGlobalæ˜¯WindowManagerGlobalå®ä¾‹ï¼Œè€Œä¸”å®ƒè¿˜æ˜¯ä¸€ä¸ªAPPå…¨å±€å•ä¾‹ã€‚WindowManagerImplè¿™å·¥ä½œæ¨¡å¼æ˜¯å…¸å‹çš„æ¡¥æ¥æ¨¡å¼ï¼Œå°†æ‰€æœ‰æ“ä½œå…¨éƒ¨å§”æ‰˜ç»™WindowManagerGlobalæ¥å®ç°ã€‚</p>
<p>è¿™å°±æ˜¯è¯´WindowManagerGlobalæ˜¯WindowManagerçš„çœŸæ­£é€»è¾‘å®ç°ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹WindowManagerGlobalä¸­çš„addViewæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params,
        Display display, Window parentWindow, <span class="hljs-type">int</span> userId)</span> {
    <span class="hljs-comment">// å‚æ•°æ£€æŸ¥</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (parentWindow != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// å¦‚æœæ˜¯å­çª—å£ï¼Œé‚£ä¹ˆå°±éœ€è¦è°ƒæ•´ä¸€äº›å¸ƒå±€å‚æ•°</span>
        parentWindow.adjustLayoutParamsForSubWindow(wparams);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// ViewRootImplï¼šçª—å£å’Œç³»ç»Ÿäº¤äº’çš„æ¡¥æ¢ï¼ˆäº‹ä»¶åˆ†å‘ã€ç»˜åˆ¶ï¼‰</span>
    <span class="hljs-comment">// panelParentViewï¼šç”¨äºå­˜æ”¾çˆ¶çª—å£çš„ Viewï¼ˆå¦‚æœæ˜¯å­çª—å£ï¼‰</span>
    ViewRootImpl root;
    <span class="hljs-type">View</span> <span class="hljs-variable">panelParentView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// ç»™æ•´ä¸ªWindowæ·»åŠ è¿‡ç¨‹åŠ é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// æ™®é€šçª—å£å’Œçˆ¶çª—å£åˆ†å¼€å¤„ç†ï¼Œåˆ›å»ºViewRootImpl</span>
        <span class="hljs-keyword">if</span> (windowlessSession == <span class="hljs-literal">null</span>) {
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display);
        } <span class="hljs-keyword">else</span> {
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display,
                    windowlessSession, <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowlessWindowLayout</span>());
        }
        <span class="hljs-comment">// å°†çª—å£å‚æ•°ç»‘å®šåˆ°View</span>
        view.setLayoutParams(wparams);
        <span class="hljs-comment">// è®°å½•Viewã€ViewRootImplã€LayoutParamsï¼Œç”¨äºå…¨å±€çª—å£ç®¡ç†å’Œäº‹ä»¶åˆ†å‘</span>
        mViews.add(view);
        mRoots.add(root);
        mParams.add(wparams);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é€šè¿‡ViewRootImplçš„setViewæ–¹æ³•çœŸæ­£æŠŠViewæ·»åŠ åˆ°Window</span>
            root.setView(view, wparams, panelParentView, userId);
            <span class="hljs-comment">// ...</span>
        } <span class="hljs-keyword">catch</span> (RuntimeException e) {
            <span class="hljs-comment">// ...</span>
            }
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<p>æ–¹æ³•å¾ˆé•¿ï¼Œä½†æ˜¯æ•´ä½“é€»è¾‘æ¯”è¾ƒç®€å•ã€‚ç”±äºWindowManagerGlobalæ˜¯WindowManagerçœŸæ­£çš„é€»è¾‘å®ç°ç±»ï¼Œæ‰€ä»¥åœ¨WindowManagerGlobalå†…éƒ¨ä¼šè®°å½•ä¸‹è¦å¤„ç†çš„Windowï¼ŒåŒ…æ‹¬Windowï¼ŒWindowå¯¹åº”çš„Viewï¼ŒWindowå¯¹åº”çš„ViewRootImplã€‚</p>
<p>åœ¨WindowManagerGlobalä¸­é€šè¿‡è¿™ä¹ˆå‡ ä¸ªåˆ—è¡¨æ¥å­˜å‚¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;View&gt;();
<span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ViewRootImpl&gt;();
<span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;WindowManager.LayoutParams&gt;();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArraySet&lt;View&gt; mDyingViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;View&gt;();
</code></pre>
<ul>
<li><code>mViews</code>ï¼šå­˜æ”¾æ‰€æœ‰Windowå¯¹åº”çš„View</li>
<li><code>mRoots</code>ï¼šå­˜æ”¾æ‰€æœ‰Windowå¯¹åº”çš„ViewRootImpl</li>
<li><code>mParams</code>ï¼šæ”¾æ¯ä¸ª View å¯¹åº”çš„çª—å£å‚æ•°</li>
<li><code>mDyingViews</code>ï¼šå­˜æ”¾æ­£åœ¨è¢«ç§»é™¤ä½†è¿˜æœªå®Œæˆé”€æ¯çš„View</li>
</ul>
<p>åœ¨addViewä¸­é€šè¿‡</p>
<pre><code class="hljs language-csharp" lang="csharp">mViews.<span class="hljs-keyword">add</span>(view);
mRoots.<span class="hljs-keyword">add</span>(root);
mParams.<span class="hljs-keyword">add</span>(wparams);
</code></pre>
<p>ä¸‰ä¸ªæ–¹æ³•æ¥æ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œç”¨äºå…¨å±€çª—å£ç®¡ç†å’Œäº‹ä»¶åˆ†å‘ã€‚</p>
<p>æ¥ç€çœ‹çœ‹ViewRootImplä¸­çš„setViewæ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setView</span><span class="hljs-params">(View view, WindowManager.LayoutParams attrs, View panelParentView,
            <span class="hljs-type">int</span> userId)</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (mView == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ...</span>
                <span class="hljs-comment">// åœ¨è¢«æ·»åŠ åˆ°WindowManagerä¹‹å‰è°ƒç”¨ä¸€æ¬¡ï¼Œè§¦å‘Viewçš„æµ‹é‡å’Œå¸ƒå±€</span>
                requestLayout();
                <span class="hljs-comment">// ...</span>

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// ä¿è¯çª—å£å°ºå¯¸ã€å¸ƒå±€ã€Insetsã€å®‰å…¨åŒºåŸŸéƒ½æ­£ç¡®</span>
                    mOrigWindowType = mWindowAttributes.type;
                    mAttachInfo.mRecomputeGlobalAttributes = <span class="hljs-literal">true</span>;
                    collectViewAttributes();
                    adjustLayoutParamsForCompatibility(mWindowAttributes,
                            mInsetsController.getAppearanceControlled(),
                            mInsetsController.isBehaviorControlled());
                    controlInsetsForCompatibility(mWindowAttributes);
                    
                    <span class="hljs-comment">// é€šè¿‡WindowSessionæ¥å®ŒæˆIPCè°ƒç”¨ï¼Œå®Œæˆåˆ›å»ºWindow</span>
                    <span class="hljs-type">Rect</span> <span class="hljs-variable">attachedFrame</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();
                    <span class="hljs-keyword">final</span> <span class="hljs-type">float</span>[] compatScale = { <span class="hljs-number">1f</span> };
                    <span class="hljs-comment">// å‘ç³»ç»Ÿ WindowManagerService æ·»åŠ çª—å£</span>
                    res = mWindowSession.addToDisplayAsUser(mWindow, mWindowAttributes,
                            getHostVisibility(), mDisplay.getDisplayId(), userId,
                            mInsetsController.getRequestedVisibleTypes(), inputChannel, mTempInsets,
                            mTempControls, attachedFrame, compatScale);
                    <span class="hljs-comment">// ...</span>
                } <span class="hljs-keyword">catch</span> (RemoteException | RuntimeException e) {
                    <span class="hljs-comment">// ...</span>
                } <span class="hljs-keyword">finally</span> {
                    <span class="hljs-keyword">if</span> (restore) {
                        attrs.restore();
                    }
                }

                <span class="hljs-comment">// ...</span>
            }
        }
    }
</code></pre>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œåœ¨è¢«æ·»åŠ åˆ°WindowManagerä¹‹å‰ä¼šè°ƒç”¨requestLayout()æ–¹æ³•å®Œæˆå¼‚æ­¥åˆ·æ–°è¯·æ±‚ï¼Œçœ‹çœ‹å®ƒçš„å…·ä½“å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) {
        checkThread();
        mLayoutRequested = <span class="hljs-literal">true</span>;
        scheduleTraversals();
    }
}
</code></pre>
<p>å®é™…ä¸Šï¼ŒscheduleTraversals()æ–¹æ³•å°±æ˜¯Viewç»˜åˆ¶çš„å…¥å£ã€‚</p>
<p>æ¥ç€ä¼šè°ƒç”¨<code>mWindowSession.addToDisplayAsUser</code>æ–¹æ³•æ¥å®ŒæˆWindowçš„æ·»åŠ è¿‡ç¨‹ã€‚<code>mWindowSession</code>çš„ç±»å‹æ˜¯<code>IWindowSession</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªBinderå¯¹è±¡ï¼Œè€Œ<code>IWindowSession</code>æ˜¯ä¸€ä¸ªBinderæ¥å£ã€‚å®ƒçš„å®ç°ç±»åœ¨WindowManagerServiceä¸­ï¼Œè¿™é‡Œé€šè¿‡mWindowSessionå®Œæˆäº†IPCé€šä¿¡ã€‚</p>
<p>è¿™æ ·å°±æŠŠæ·»åŠ Windowçš„é€»è¾‘äº¤ç»™WindowManagerServiceæ¥å¤„ç†äº†ï¼Œç”±äºWindowManagerServiceæ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚</p>
<p>åœ¨WindowManagerServiceä¸­åœ¨Sessionç±»ä¸­å®ŒæˆWindowçš„æ·»åŠ ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addToDisplay</span><span class="hljs-params">(IWindow window, <span class="hljs-type">int</span> seq, WindowManager.LayoutParams attrs,<span class="hljs-type">int</span> viewVisibility, <span class="hljs-type">int</span> displayId, Rect outFrame, Rect outContentInsets,
 Rect outStableInsets, Rect outOutsets, DisplayCutout.ParcelableWrapper outDisplayCutout, InputChannel outInputChannel, InsetsState outInsetsState)</span> {
    <span class="hljs-keyword">return</span> mService.addWindow(<span class="hljs-built_in">this</span>, window, seq, attrs, viewVisibility, displayId, outFrame,outContentInsets, outStableInsets, outOutsets, outDisplayCutout, outInputChannel,outInsetsState);
}
</code></pre>
<p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆè°ƒç”¨<code>WindowManagerImpl.addView()</code>ï¼Œåœ¨addViewä¸­æŠŠå…·ä½“é€»è¾‘å§”æ‰˜ç»™<code>WindowManagerGlobal.addView()</code></li>
<li>åœ¨<code>WindowManagerGlobal.addView()</code>ä¸­åˆ›å»º<code>ViewRootImpl</code> èµ‹å€¼ç»™äº† root ã€‚ç„¶åå°† viewï¼Œparamsï¼Œroot å…¨éƒ¨å­˜å…¥äº†å„è‡ªçš„åˆ—è¡¨ä¸­ã€‚æœ€åè°ƒç”¨äº† <code>ViewRootImpl.setView()</code>ã€‚</li>
<li><code>ViewRootImpl.setView()</code>ä¸­ï¼Œå…ˆè°ƒç”¨<code>requestlayout()</code>å®Œæˆå¼‚æ­¥åˆ·æ–°è¯·æ±‚ï¼Œæ¥ç€ä¼šé€šè¿‡<code>IWindowSession</code>æ¥å®Œæˆæœ€ç»ˆçš„Windowæ·»åŠ è¿‡ç¨‹ï¼Œ<code>IWindowSession</code> æ˜¯ä¸€ä¸ª Binder å¯¹è±¡ï¼ŒçœŸæ­£çš„å®ç°ç±»æ˜¯ <code>Session</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ Window çš„æ·»åŠ è¿‡ç¨‹è¯•ä¸€æ¬¡ IPC çš„è°ƒç”¨ã€‚æœ€ååœ¨ Session ä¸­ä¼šé€šè¿‡ <code>WindowManageServer</code> æ¥å®ç° Window çš„æ·»åŠ ã€‚</li>
</ol>
<h3 data-id="heading-7">3.2 Windowçš„æ›´æ–°è¿‡ç¨‹</h3>
<p>Windowçš„æ›´æ–°è¿‡ç¨‹å’Œåˆ›å»ºè¿‡ç¨‹ä¸€æ ·ï¼Œéƒ½æ˜¯å…ˆé€šè¿‡WindowManagerImplï¼Œå†è¿›ä¸€æ­¥é€šè¿‡WindowManagerGlobalæ¥å®ç°çš„ã€‚ä»WindowManagerGlobalä¸­çš„updateViewLayoutå¼€å§‹çœ‹èµ·ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span> {
    <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"view must not be null"</span>);
    }
    <span class="hljs-keyword">if</span> (!(params <span class="hljs-keyword">instanceof</span> WindowManager.LayoutParams)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Params must be WindowManager.LayoutParams"</span>);
    }
    <span class="hljs-comment">// å¼ºè½¬ç±»å‹</span>
    <span class="hljs-keyword">final</span> WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">wparams</span> <span class="hljs-operator">=</span> (WindowManager.LayoutParams)params;
    <span class="hljs-comment">// æ›´æ–°Viewçš„param</span>
    view.setLayoutParams(wparams);

    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);
        <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);
        mParams.remove(index);
        mParams.add(index, wparams);
        <span class="hljs-comment">// é€šçŸ¥ ViewRootImpl æ›´æ–°å¸ƒå±€å‚æ•°</span>
        root.setLayoutParams(wparams, <span class="hljs-literal">false</span>);
    }
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•åšçš„äº‹æƒ…å°±æ¯”è¾ƒç®€å•äº†ï¼Œé¦–å…ˆæ˜¯æ›´æ–°Viewä¸­çš„LayoutParamsï¼Œæ¥ç€å†æ›´æ–°ViewRootImplä¸­çš„LayoutParamsï¼Œé€šè¿‡ViewRootImplä¸­çš„setLayoutParamsæ–¹æ³•å®Œæˆï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šå¯¹Viewé‡æ–°ç­–ç•¥ï¼Œå¸ƒå±€ï¼Œé‡ç»˜ã€‚</p>
<p>é™¤äº†Viewæœ¬èº«çš„é‡ç»˜ä¹‹å¤–ï¼ŒViewRootImplè¿˜ä¼šé€šè¿‡WindowSessionæ¥æ›´æ–°Windowè§†å›¾ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±WindowManagerServerçš„relayoutWindowæ¥å®ç°çš„ï¼Œè¿™åŒæ ·æ˜¯ä¸€ä¸ªIPCè¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-8">3.3 Windowçš„åˆ é™¤è¿‡ç¨‹</h3>
<p>è¿˜æ˜¯ä»WindowManagerGlobalæ–¹æ³•çœ‹èµ·ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// UnsupportedAppUsageè¡¨ç¤ºè¿™æ˜¯ç³»ç»Ÿå†…éƒ¨APIï¼Œä¸å¯¹ä¸‰æ–¹åº”ç”¨å…¬å¼€ï¼Œä½†åº”ç”¨èƒ½ä½¿ç”¨</span>
<span class="hljs-meta">@UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.R, trackingBug = 170729553)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view, <span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"view must not be null"</span>);
    }

    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);
        <span class="hljs-type">View</span> <span class="hljs-variable">curView</span> <span class="hljs-operator">=</span> mRoots.get(index).getView();
        removeViewLocked(index, immediate);
        <span class="hljs-keyword">if</span> (curView == view) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Calling with view "</span> + view
                + <span class="hljs-string">" but the ViewAncestor is attached to "</span> + curView);
    }
}
</code></pre>
<p>é€»è¾‘å¾ˆç®€å•ï¼Œé€šè¿‡findViewLocked()æ‰¾åˆ°Viewåœ¨viewsåˆ—è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åè°ƒç”¨removeViewLockedæ–¹æ³•æ¥åšè¿›ä¸€æ­¥çš„åˆ é™¤ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeViewLocked</span><span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-comment">// å…ˆæ ¹æ®indexå–å‡ºå¯¹åº”çª—å£ï¼ˆrootå’Œviewï¼‰ </span>
    <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);
    <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> root.getView();

    <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">null</span>) {
        root.getImeFocusController().onWindowDismissed();
    }
    <span class="hljs-comment">// root.die()ï¼šé”€æ¯çª—å£</span>
    <span class="hljs-comment">// immediateä¸ºtrueï¼šç«‹å³é”€æ¯çª—å£</span>
    <span class="hljs-comment">// immediateä¸ºfalseï¼šè¯·æ±‚å»¶è¿Ÿé”€æ¯</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">deferred</span> <span class="hljs-operator">=</span> root.die(immediate);
    <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// æŠŠViewä»å®ƒçš„çˆ¶äº²ï¼ˆViewRootImplï¼‰è§£ç»‘</span>
        view.assignParent(<span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (deferred) {
            <span class="hljs-comment">// å¦‚æœå»¶è¿Ÿé”€æ¯ï¼Œä¸èƒ½é©¬ä¸Šåˆ é™¤Viewï¼Œå› ä¸ºViewRootImplè¿˜æ²¡çœŸæ­£æ­»å®Œ</span>
            <span class="hljs-comment">// å°†å½“å‰Viewæ”¾å…¥mDyingViews</span>
            mDyingViews.add(view);
        }
    }
}
</code></pre>
<p>åœ¨removeViewLockedæ–¹æ³•ä¸­ï¼Œåˆ é™¤æ“ä½œæ˜¯é€šè¿‡ViewRootImplå®ç°çš„ã€‚åœ¨WindowManagerä¸­æä¾›ä¸¤ç§åˆ é™¤æ¥å£<code>removeView</code>å’Œ<code>removeViewImmediate</code>åˆ†åˆ«æ˜¯åŒæ­¥åˆ é™¤å’Œå¼‚æ­¥åˆ é™¤ã€‚</p>
<p>ä¸€èˆ¬ä¸ç”¨removeViewImmediateåˆ é™¤Windowï¼Œä»¥å…å‘ç”Ÿæ„é”™è¯¯ã€‚</p>
<p>è¿™é‡Œä¸»è¦è¯´å¼‚æ­¥åˆ é™¤çš„æƒ…å†µï¼Œå…·ä½“çš„åˆ é™¤æ“ä½œç”±ViewRootImplçš„dieæ–¹æ³•å®Œæˆã€‚åœ¨å¼‚æ­¥åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œdieæ–¹æ³•åªæ˜¯å‘é€äº†ä¸€ä¸ªè¯·æ±‚åˆ é™¤çš„ä¿¡æ¯åå°±ç«‹åˆ»è¿”å›äº†ï¼Œè¿™ä¸ªæ—¶å€™Viewå¹¶æ²¡æœ‰å®Œæˆåˆ é™¤æ“ä½œï¼Œæ‰€ä»¥æœ€åä¼šå°†å…¶æ·»åŠ åˆ°mDyingViewsä¸­ï¼ŒmDyingViewsè¡¨ç¤ºå¾…åˆ é™¤çš„Viewåˆ—è¡¨ã€‚çœ‹çœ‹ViewRootImplä¸­çš„dieæ–¹æ³•å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">die</span><span class="hljs-params">(<span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-comment">// Make sure we do execute immediately if we are in the middle of a traversal or the damage</span>
    <span class="hljs-comment">// done by dispatchDetachedFromWindow will cause havoc on return.</span>
    <span class="hljs-keyword">if</span> (immediate &amp;&amp; !mIsInTraversal) {
        <span class="hljs-comment">// ç«‹å³é”€æ¯ï¼šè°ƒç”¨è€…è¦æ±‚ç«‹å³é”€æ¯å¹¶ä¸”å½“å‰ä¸åœ¨Viewæµ‹é‡/å¸ƒå±€/ç»˜åˆ¶ï¼ˆTraversalï¼‰ä¸­</span>
        <span class="hljs-comment">// æ‰§è¡ŒdoDieæ–¹æ³•ç«‹å³åˆ é™¤çª—å£</span>
        doDie();
        <span class="hljs-comment">// è¿”æ²ªfalseè¡¨ç¤ºä¸éœ€è¦å»¶è¿Ÿå¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// è‹¥ä¸æ˜¯ç«‹å³é”€æ¯ï¼Œå¤„ç†ç¡¬ä»¶åŠ é€Ÿå±‚</span>
    <span class="hljs-keyword">if</span> (!com.android.graphics.hwui.flags.Flags.removeVriSketchyDestroy()) {
        <span class="hljs-keyword">if</span> (!mIsDrawing) {
            destroyHardwareRenderer();
        } <span class="hljs-keyword">else</span> {
            Log.e(mTag, <span class="hljs-string">"Attempting to destroy the window while drawing!\n"</span>
                    + <span class="hljs-string">"  window="</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">", title="</span> + mWindowAttributes.getTitle());
        }
    }
    <span class="hljs-comment">// å‘é€å¼‚æ­¥é”€æ¯æ¶ˆæ¯</span>
    mHandler.sendEmptyMessage(MSG_DIE);
    <span class="hljs-comment">// è¡¨ç¤ºéœ€è¦å»¶è¿Ÿé”€æ¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>dieæ–¹æ³•å†…éƒ¨åªæ˜¯ä¸€ä¸ªç®€å•çš„åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å¼‚æ­¥åˆ é™¤ï¼Œé‚£ä¹ˆå°±å‘é€ä¸€ä¸ª<em>MSG_DIE</em>çš„æ¶ˆæ¯ViewRootImplä¸­çš„Handleä¼šå¤„ç†æ­¤æ¶ˆæ¯å¹¶è°ƒç”¨doDie()æ–¹æ³•ã€‚å¦‚æœæ˜¯åŒæ­¥åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸å‘æ¶ˆæ¯ç›´æ¥è°ƒç”¨doDie()æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸¤ç§åˆ é™¤çš„åŒºåˆ«ã€‚çœ‹çœ‹doDie()æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">doDie</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// Windowæ“ä½œå¿…é¡»åœ¨åˆ›å»ºViewRootImplçš„çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ‰§è¡Œï¼Œå¦åˆ™ä¼šå¯¼è‡´UIçŠ¶æ€é”™ä¹±</span>
        checkThread();
        <span class="hljs-keyword">if</span> (LOCAL_LOGV) Log.v(mTag, <span class="hljs-string">"DIE in "</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">" of "</span> + mSurface);
            <span class="hljs-comment">// è¿›å…¥åŒæ­¥å—ï¼Œé˜²æ­¢å¤šçº¿ç¨‹é‡å¤é”€æ¯ </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (mRemoved) {
                <span class="hljs-keyword">return</span>;
            }
            mRemoved = <span class="hljs-literal">true</span>;
            <span class="hljs-comment">// ...</span>

            <span class="hljs-keyword">if</span> (mAdded) {
                <span class="hljs-comment">// çœŸæ­£çš„åˆ é™¤é€»è¾‘æ˜¯åœ¨æ­¤æ–¹æ³•ä¸­</span>
                dispatchDetachedFromWindow();
            }

            destroyHardwareRenderer();

            <span class="hljs-comment">// ...</span>

            mAdded = <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// ...</span>
        }
        <span class="hljs-comment">// ...</span>
        WindowManagerGlobal.getInstance().doRemoveView(<span class="hljs-built_in">this</span>);
    }
</code></pre>
<p>åœ¨doDieæ–¹æ³•å†…éƒ¨ï¼Œé‡ç‚¹åœ¨dispatchDetachedFromWindowå†…éƒ¨ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå®ç°äº†Windowçš„åˆ é™¤é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchDetachedFromWindow</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Make sure we free-up insets resources if view never received onWindowFocusLost()</span>
    <span class="hljs-comment">// because of a die-signal</span>
    mInsetsController.onWindowFocusLost();
    mFirstInputStage.onDetachedFromWindow();
    <span class="hljs-keyword">if</span> (mView != <span class="hljs-literal">null</span> &amp;&amp; mView.mAttachInfo != <span class="hljs-literal">null</span>) {
        mAttachInfo.mTreeObserver.dispatchOnWindowAttachedChange(<span class="hljs-literal">false</span>);
        <span class="hljs-comment">// åˆ†æ1</span>
        mView.dispatchDetachedFromWindow();
    }
    
    <span class="hljs-comment">// åˆ†æ2</span>
    mAccessibilityInteractionConnectionManager.ensureNoConnection();
    mAccessibilityInteractionConnectionManager.ensureNoDirectConnection();
    removeSendWindowContentChangedCallback();
    <span class="hljs-keyword">if</span> (android.view.accessibility.Flags.preventLeakingViewrootimpl()
            &amp;&amp; mAccessibilityInteractionController != <span class="hljs-literal">null</span>) {
        mAccessibilityInteractionController.destroy();
        mAccessibilityInteractionController = <span class="hljs-literal">null</span>;
    }

    destroyHardwareRenderer();

    setAccessibilityFocus(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

    mInsetsController.cancelExistingAnimations();

    mView.assignParent(<span class="hljs-literal">null</span>);
    mView = <span class="hljs-literal">null</span>;
    mAttachInfo.mRootView = <span class="hljs-literal">null</span>;

    destroySurface();

    <span class="hljs-keyword">if</span> (mInputQueueCallback != <span class="hljs-literal">null</span> &amp;&amp; mInputQueue != <span class="hljs-literal">null</span>) {
        mInputQueueCallback.onInputQueueDestroyed(mInputQueue);
        mInputQueue.dispose();
        mInputQueueCallback = <span class="hljs-literal">null</span>;
        mInputQueue = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åˆ†æ3</span>
        mWindowSession.remove(mWindow.asBinder());
    } <span class="hljs-keyword">catch</span> (RemoteException e) {
    }
    <span class="hljs-comment">// Dispose receiver would dispose client InputChannel, too. That could send out a socket</span>
    <span class="hljs-comment">// broken event, so we need to unregister the server InputChannel when removing window to</span>
    <span class="hljs-comment">// prevent server side receive the event and prompt error.</span>
    <span class="hljs-keyword">if</span> (mInputEventReceiver != <span class="hljs-literal">null</span>) {
        mInputEventReceiver.dispose();
        mInputEventReceiver = <span class="hljs-literal">null</span>;
    }

    unregisterListeners();
    unscheduleTraversals();
}
</code></pre>
<p>ä¸Šé¢æ–¹æ³•ä¸»è¦å¹²äº†ä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>åˆ†æ1å¤„ï¼šè°ƒç”¨Viewçš„dispatchDetachedFromWindowæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨onDeteachedFromWindowæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨åšè‡ªå®šä¹‰Viewæ—¶ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•å†…éƒ¨åšä¸€äº›èµ„æºå›æ”¶å·¥ä½œï¼Œæ¯”å¦‚ç»ˆæ­¢åŠ¨ç”»ã€åœæ­¢çº¿ç¨‹ç­‰ã€‚</li>
<li>åˆ†æ2å¤„ï¼Œåƒåœ¾å›æ”¶ç›¸å…³å·¥ä½œï¼Œæ¯”å¦‚æ¸…é™¤æ•°æ®å’Œæ¶ˆæ¯ï¼Œç§»é™¤å›è°ƒç­‰ã€‚</li>
<li>åˆ†æ3å¤„ï¼Œé€šè¿‡Sessionçš„removeæ–¹æ³•æ¥åˆ é™¤Windowï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªIPCè¿‡ç¨‹ï¼ŒçœŸæ­£åˆ é™¤çš„åœ°æ–¹è¿˜æ˜¯WindowManagerServiceã€‚</li>
</ol>
<h2 data-id="heading-9">4ã€Windowçš„åˆ›å»ºè¿‡ç¨‹</h2>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒViewæ˜¯Windowåœ°è¡¨ç°å½¢å¼ï¼Œè€ŒWindowæ˜¯Viewåœ°è½½ä½“ï¼Œå› æ­¤ä»»ä½•æœ‰è§†å›¾åœ°åœ°æ–¹éƒ½æœ‰Windowï¼Œæ¯”å¦‚Activityã€Dialogã€Toastç­‰ã€‚æœ¬èŠ‚å°†åˆ†æè¿™äº›è§†å›¾å…ƒç´ ä¸­çš„Windowåˆ›å»ºè¿‡ç¨‹ï¼Œè¿™éå¸¸æœ‰åˆ©äºç†è§£Androidç³»ç»Ÿã€‚</p>
<h3 data-id="heading-10">4.1 Activityçš„Windowåˆ›å»ºè¿‡ç¨‹</h3>
<p>è¦åˆ†æActivityçš„Windowåˆ›å»ºè¿‡ç¨‹ï¼Œå¿…é¡»è¦äº†è§£Activityçš„çš„å¯åŠ¨æµç¨‹ï¼Œè¿™é‡Œå°±å…ˆä¸è¿‡å¤šè¯´å¯åŠ¨æµç¨‹ç›¸å…³çš„å†…å®¹äº†ï¼Œåœ¨Activityå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæœ€ç»ˆä¼šç”±ActivityTreadä¸­çš„performLaunchActivity()æ¥å®Œæˆæ•´ä¸ªå¯åŠ¨è¿‡ç¨‹ã€‚</p>
<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šé€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºActivityçš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶attachæ–¹æ³•ä¸ºå…¶å…³è”è¿è¡Œè¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„ä¸€ç³»åˆ—ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Activity <span class="hljs-title function_">performLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent)</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        java.lang.ClassLoader cl;
        <span class="hljs-keyword">if</span> (isSandboxedSdkContextUsed) {
            cl = activityBaseContext.getApplicationContext().getClassLoader();
        } <span class="hljs-keyword">else</span> {
            cl = activityBaseContext.getClassLoader();
        }
        <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ...</span>
            <span class="hljs-type">Window</span> <span class="hljs-variable">window</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-comment">// ...</span>
            activity.attach(activityBaseContext, <span class="hljs-built_in">this</span>, getInstrumentation(), r.token,
                    r.ident, app, r.intent, r.activityInfo, title, r.parent,
                    r.embeddedID, r.lastNonConfigurationInstances, config,
                    r.referrer, r.voiceInteractor, window, r.activityConfigCallback,
                    r.assistToken, r.shareableActivityToken, r.initialCallerInfoAccessToken);

    }
    <span class="hljs-keyword">return</span> activity;
}
</code></pre>
<p>åœ¨attachæ–¹æ³•ä¸­ç³»ç»Ÿä¼šåˆ›å»ºActivityæ‰€å±çš„Windowå¯¹è±¡ï¼Œå¹¶ä¸”ä¸ºå…¶è®¾ç½®å›è°ƒæ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java">mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
mWindow.setWindowControllerCallback(mWindowControllerCallback);
mWindow.setCallback(<span class="hljs-built_in">this</span>);
mWindow.setOnWindowDismissedCallback(<span class="hljs-built_in">this</span>);
mWindow.getLayoutInflater().setPrivateFactory(<span class="hljs-built_in">this</span>);
</code></pre>
<p>è¿™é‡Œåˆ›å»ºäº†PhoneWindowå®ä¾‹ï¼Œè€Œä¸”è®¾ç½®äº†å›è°ƒï¼ŒåŒæ—¶Acivityè‡ªå·±å°±å®ç°äº†æ¥å£ï¼Œæ‰€ä»¥å½“Windowæ¥æ”¶åˆ°å¤–ç•Œçš„çŠ¶æ€æ”¹å˜æ—¶å°±ä¼šå›è°ƒActivityçš„æ–¹æ³•ã€‚Callbackæ¥å£ä¸­æœ‰ä¸€äº›æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span> {
    <span class="hljs-comment">// å¤„ç†é”®ç›˜äº‹ä»¶ï¼ˆç‰©ç†é”®ã€è½¯é”®ã€éŸ³é‡é”®ç­‰ï¼‰ </span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchKeyEvent</span><span class="hljs-params">(KeyEvent event)</span>;
    <span class="hljs-comment">// å½“èœå•è¢«æ‰“å¼€æ—¶å›è°ƒ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">onMenuOpened</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId, <span class="hljs-meta">@NonNull</span> Menu menu)</span>;
    <span class="hljs-comment">// èœå•é¡¹è¢«ç‚¹å‡»æ—¶å›è°ƒ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">onMenuItemSelected</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId, <span class="hljs-meta">@NonNull</span> MenuItem item)</span>;
    <span class="hljs-comment">// çª—å£ç„¦ç‚¹å˜åŒ–æ—¶å›è°ƒ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWindowFocusChanged</span><span class="hljs-params">(<span class="hljs-type">boolean</span> hasFocus)</span>;
    <span class="hljs-comment">// çª—å£è¢«æ·»åŠ åˆ° WindowManager æ—¶å›è°ƒ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAttachedToWindow</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// çª—å£ä» WindowManager ç§»é™¤æ—¶å›è°ƒ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDetachedFromWindow</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™äº›æ–¹æ³•å°±æ˜¯åœ¨attachæ–¹æ³•ä¸­è®¾ç½®çš„å›è°ƒã€‚åˆ°è¿™é‡ŒWindowå·²ç»åˆ›å»ºå®Œæˆäº†ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹Activityè§†å›¾æ˜¯æ€ä¹ˆä¾é™„åˆ°Windowä¸Šçš„ï¼Œç”±äºActivityçš„è§†å›¾æ—¶ä»setContentViewæ–¹æ³•æä¾›çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹setContentViewæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> layoutResID)</span> {
    getWindow().setContentView(layoutResID);
    initWindowDecorActionBar();
}
</code></pre>
<p>è¿™é‡Œå‘ç°å…¶å®æ˜¯è°ƒç”¨äº†PhoneWindowçš„setContentViewæ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-type">int</span> layoutResID)</span> {
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰DecorViewï¼Œé‚£ä¹ˆå°±åˆ›å»ºå®ƒ</span>
    <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">//  è¿™ä¸ªæ–¹æ³•åˆ›å»ºDecorView</span>
        installDecor();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        mContentParent.removeAllViews();
    }
    
    <span class="hljs-comment">// å¸ƒå±€åŠ è½½é€»è¾‘</span>
    <span class="hljs-comment">// ifä¸­åªæ˜¯å¼€å¯äº†è¿‡æ¸¡åŠ¨ç”»ï¼Œelseä¸­ç›´æ¥åŠ è½½å¸ƒå±€ï¼Œæ²¡æœ‰è¿‡æ¸¡åŠ¨ç”»</span>
    <span class="hljs-keyword">if</span> (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">Scene</span> <span class="hljs-variable">newScene</span> <span class="hljs-operator">=</span> Scene.getSceneForLayout(mContentParent, layoutResID,
                getContext());
        transitionTo(newScene);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ™®é€šå¸ƒå±€åŠ è½½ï¼Œç›´æ¥ä½¿ç”¨LayoutInflater.inflate</span>
        <span class="hljs-comment">// æŠŠå¸ƒå±€XMLå¡«å……åˆ°mContentParentä¸­</span>
        mLayoutInflater.inflate(layoutResID, mContentParent);
    }
    mContentParent.requestApplyInsets();
    <span class="hljs-comment">// å›è°ƒActivityçš„onContentChangedæ–¹æ³•é€šçŸ¥Activityè§†å›¾å·²ç»å‘ç”Ÿæ”¹å˜</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Callback</span> <span class="hljs-variable">cb</span> <span class="hljs-operator">=</span> getCallback();
    <span class="hljs-keyword">if</span> (!isDestroyed()) {
        <span class="hljs-keyword">if</span> (cb != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å›è°ƒonContentChangedæ–¹æ³•</span>
            <span class="hljs-comment">// Activityå¯ä»¥åœ¨è¿™é‡ŒåšfindViewById()åˆå§‹åŒ–æ§ä»¶ </span>
            cb.onContentChanged();
        }
        <span class="hljs-keyword">if</span> (mDecorContentParent != <span class="hljs-literal">null</span>) {
            mDecorContentParent.notifyContentChanged();
        }
    }
    mContentParentExplicitlySet = <span class="hljs-literal">true</span>;
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p>
<ul>
<li>å¦‚æœDecorViewä¸å­˜åœ¨å°±åˆ›å»ºDecorViewï¼ŒDecorViewæ˜¯Activityä¸­çš„é¡¶çº§Viewï¼Œä¸€èˆ¬æ¥è¯´å®ƒåŒ…æ‹¬æ ‡é¢˜æ å’Œå†…å®¹æ ã€‚åˆ›å»ºDecorViewç”±<code>installDecor();</code>æ–¹æ³•å®Œæˆã€‚</li>
<li>å°†Viewæ·»åŠ åˆ°DecorViewçš„mContentparentä¸­ï¼šè¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œç¬¬ä¸€æ­¥å·²ç»åˆ›å»ºè¿‡DecorViewäº†ï¼Œè¿™ä¸€æ­¥ç›´æ¥å°†Activityçš„è§†å›¾æ·»åŠ åˆ°DecorViewä¸­çš„mContentParentå³å¯ï¼šé€šè¿‡<code>mLayoutInflater.inflate(layoutResID, mContentParent);</code>å°†å¸ƒå±€XMLå¡«å……åˆ°mContentParentä¸­ã€‚</li>
<li>å›è°ƒActivityçš„onContentChangedæ–¹æ³•é€šçŸ¥Activityè§†å›¾å·²ç»å‘ç”Ÿæ”¹å˜ï¼šä¹Ÿéå¸¸ç®€å•ï¼Œç”±äºActivityå·²ç»å®ç°äº†Windowçš„Callbackæ¥å£ï¼Œå›è°ƒæ­¤æ–¹æ³•è¡¨ç¤ºActivityçš„è§†å›¾å·²ç»è¢«æ·»åŠ åˆ°DecorViewçš„mContentparentä¸­äº†ï¼Œéœ€è¦é€šçŸ¥Activityï¼Œä½¿å…¶åšç›¸åº”çš„å¤„ç†ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šæ–¹çš„æ­¥éª¤ï¼Œç°åœ¨DecorViewå·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å®Œæˆï¼ŒActivityçš„å¸ƒå±€ä¹Ÿæ·»åŠ åˆ°DecorViewçš„å†…å®¹æ ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™DecorViewè¿˜æ²¡æœ‰è¢«WindowManageræ·»åŠ åˆ°Windowä¸­</p>
<p>åœ¨ActivityThreadçš„handleResumeActivityä¼šè°ƒç”¨Activityçš„onResumeæ–¹æ³•,å¹¶ä¸”ä¼šè°ƒç”¨ViewManagerçš„addViewæ–¹æ³•æŠŠDecorViewæ·»åŠ åˆ°WindowManagerä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleResumeActivity</span><span class="hljs-params">(IBinder token, <span class="hljs-type">boolean</span> finalStateRequest, <span class="hljs-type">boolean</span> isForward,
            String reason)</span> {
        <span class="hljs-comment">//è°ƒç”¨Activityçš„onResumeæ–¹æ³•</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">ActivityClientRecord</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> performResumeActivity(token, finalStateRequest, reason);
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (r.window == <span class="hljs-literal">null</span> &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) {
            r.window = r.activity.getWindow();
            <span class="hljs-type">View</span> <span class="hljs-variable">decor</span> <span class="hljs-operator">=</span> r.window.getDecorView();
            decor.setVisibility(View.INVISIBLE);
            <span class="hljs-comment">// è·å–WindowMagaer</span>
            <span class="hljs-type">ViewManager</span> <span class="hljs-variable">wm</span> <span class="hljs-operator">=</span> a.getWindowManager();
            WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> r.window.getAttributes();
            a.mDecor = decor;
            l.type = WindowManager.LayoutParams.TYPE_BASE_APPLICATION;
         
            <span class="hljs-keyword">if</span> (a.mVisibleFromClient) {
                <span class="hljs-keyword">if</span> (!a.mWindowAdded) {
                    a.mWindowAdded = <span class="hljs-literal">true</span>;
                    <span class="hljs-comment">// æŠŠDecorViewæ·»åŠ åˆ°WindowManager</span>
                    wm.addView(decor, l);
                } 
                <span class="hljs-comment">// ...</span>
    }
</code></pre>
<p>åˆ°è¿™é‡ŒActivityçš„Windowåˆ›å»ºè¿‡ç¨‹åˆ†æå®Œæ¯•</p>
<h3 data-id="heading-11">4.2 Dialogçš„Windowåˆ›å»ºè¿‡ç¨‹</h3>
<p>Dialogçš„Windowåˆ›å»ºè¿‡ç¨‹å’ŒActivityç±»ä¼¼ï¼Œå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºWindowï¼š</li>
</ol>
<p>åˆ›å»ºWindowçš„åœ°æ–¹å°±æ˜¯ç›´æ¥åœ¨Dialogçš„æ„é€ å‡½æ•°ä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java">Dialog(<span class="hljs-meta">@UiContext</span> <span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@StyleRes</span> <span class="hljs-type">int</span> themeResId,
        <span class="hljs-type">boolean</span> createContextThemeWrapper) {
    <span class="hljs-comment">// ...</span>

    mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
    
    <span class="hljs-comment">// åˆ›å»ºPhoneWindow</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Window</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(mContext);
    mWindow = w;
    w.setCallback(<span class="hljs-built_in">this</span>);
    w.setOnWindowDismissedCallback(<span class="hljs-built_in">this</span>);
    w.setOnWindowSwipeDismissedCallback(() -&gt; {
        <span class="hljs-keyword">if</span> (mCancelable) {
            cancel();
        }
    });
    w.setWindowManager(mWindowManager, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    w.setGravity(Gravity.CENTER);

    mListenersHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenersHandler</span>(<span class="hljs-built_in">this</span>);
}
</code></pre>
<p>å¯ä»¥å‘ç°è¿™é‡Œå’ŒActivityä¸€æ ·ï¼Œéƒ½æ˜¯åˆ›å»ºPhoneWindowï¼ŒåŒæ—¶è®¾ç½®ä¸€äº›å›è°ƒã€‚</p>
<ol start="2">
<li>åˆå§‹åŒ–DecorViewï¼Œå¹¶å°†Dialogçš„è§†å›¾æ·»åŠ åˆ°DecorViewä¸­ã€‚</li>
</ol>
<p>è¿™ä¸ªæ­¥éª¤ä¹Ÿå’ŒActivityç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view)</span> {
    mWindow.setContentView(view);
}
</code></pre>
<p>è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå’ŒActivityç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡Windowå»æ·»åŠ æŒ‡å®šçš„å¸ƒå±€æ–‡ä»¶ã€‚</p>
<ol start="3">
<li>å°†DecorViewæ·»åŠ åˆ°Windowä¸­å¹¶æ˜¾ç¤º</li>
</ol>
<p>åœ¨Dialogçš„showæ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡WindowManagerå°†DecorViewæ·»åŠ åˆ°Windowä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// è·å–DecorView</span>
        mDecor = mWindow.getDecorView();

        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// æ·»åŠ åˆ°WindowManager</span>
        mWindowManager.addView(mDecor, l);
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// å‘é€å›è°ƒæ¶ˆæ¯</span>
        <span class="hljs-comment">// ç›®çš„æ˜¯åœ¨è§†å›¾å®Œæˆæ·»åŠ å¹¶å¯è§åï¼Œé€šçŸ¥ä¸šåŠ¡é€»è¾‘ã€‚</span>
        sendShowMessage();
}
</code></pre>
<p>ä»ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤å¯ä»¥å‘ç°ï¼ŒDialogçš„Windowåˆ›å»ºå’ŒActivityçš„Windowåˆ›å»ºå¾ˆç±»ä¼¼ï¼ŒäºŒè‡³å‡ ä¹æ²¡æœ‰ä¸Šé¢åŒºåˆ«ã€‚</p>
<p>å½“Dialogå…³é—­æ—¶ï¼Œå®ƒä¼šé€šè¿‡WindowManageræ¥ç§»é™¤DecorViewï¼Œ<code>mWindowManager.removeViewImmediate(mDecor)</code> ã€‚</p>
<p>æ™®é€šçš„Dialogæœ‰ä¸€ä¸ªç‰¹æ®Šä¹‹å¤„ï¼Œ<strong>å°±æ˜¯å¿…é¡»é‡‡ç”¨Activityçš„Contextï¼Œå¦‚æœé‡‡ç”¨Applicationçš„Contextï¼Œå°±ä¼šæŠ¥é”™ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">Caused by: android.view.WindowManager$BadTokenException: Unable to add window -- token <span class="hljs-literal">null</span> is not valid; is your activity running?
</code></pre>
<p>é”™è¯¯ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œæ˜¯æ²¡æœ‰åº”ç”¨Tokenå¯¼è‡´çš„ï¼Œè€ŒTokenä¸€èˆ¬åªæœ‰Activityæ‹¥æœ‰ï¼Œæ‰€ä»¥è¿™é‡Œåªéœ€è¦ç”¨Activityä½œä¸ºContextæ¥æ˜¾ç¤ºå¯¹è¯æ¡†å³å¯ã€‚</p>
<p>å¦å¤–ï¼Œç³»ç»Ÿ Window æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå¯ä»¥ä¸éœ€è¦Tokenï¼Œæˆ‘ä»¬å¯ä»¥å°†Dialogçš„Windowçš„Typeä¿®æ”¹ä¸ºç³»ç»Ÿç±»å‹å°±å¯ä»¥äº†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Dialog</span> <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dialog</span>(getApplicationContext());
dialog.setContentView(R.layout.dialog_layout);
<span class="hljs-type">Window</span> <span class="hljs-variable">window</span> <span class="hljs-operator">=</span> dialog.getWindow();
<span class="hljs-keyword">if</span> (window != <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// è®¾ç½®ç³»ç»Ÿç±»å‹ Windowï¼Œä½¿å…¶ä¸ä¾èµ– Activity Token</span>
    window.setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY);
}
dialog.show();
</code></pre>
<h3 data-id="heading-12">4.3 Toastçš„Windowåˆ›å»ºè¿‡ç¨‹</h3>
<p>Toastä¹Ÿæ˜¯åŸºäºWindowæ¥å®ç°çš„ï¼Œä¸è¿‡å®ƒçš„å·¥ä½œè¿‡ç¨‹ç¨å¾®ä¼šå¤æ‚ä¸€ç‚¹ã€‚ç”±äºToastå…·å¤‡å®šæ—¶å–æ¶ˆåŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨ Toast çš„å†…éƒ¨æœ‰ä¸¤ç±» IPC çš„è¿‡ç¨‹ï¼Œç¬¬ä¸€ç±»æ˜¯ Toast è®¿é—® <code>NotificationManagerService</code> è¿‡ç¨‹ã€‚ç¬¬äºŒç±»æ˜¯ <code>NotificationManagerServer</code> å›è°ƒ Toast é‡Œçš„ TN æ¥å£ã€‚ä¸‹é¢å°† <code>NotificationManagerService</code> ç®€ç§°ä¸º NMSã€‚</p>
<p>Toast å±äºç³»ç»Ÿ Windowï¼Œå†…éƒ¨è§†å›¾æœ‰ä¸¤ç§å®šä¹‰æ–¹å¼ï¼Œä¸€ç§æ˜¯ç³»ç»Ÿé»˜è®¤çš„ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ setView æ–¹æ³•æ¥æŒ‡å®šä¸€ä¸ª View(setView æ–¹æ³•åœ¨ android 11 ä»¥åå·²ç»åºŸå¼ƒäº†ï¼Œä¸ä¼šå†å±•ç¤ºè‡ªå®šä¹‰è§†å›¾)ï¼Œå®ƒä»¬éƒ½å¯¹åº” Toast çš„ä¸€ä¸ªå†…éƒ¨æˆå‘˜ <code>mNextView</code>ã€‚</p>
<p>Toastæä¾›äº†showå’Œcancelæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºæ˜¾ç¤ºå’Œéšè—Toastï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªIPCè¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>

        <span class="hljs-type">INotificationManager</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getService();
        <span class="hljs-type">String</span> <span class="hljs-variable">pkg</span> <span class="hljs-operator">=</span> mContext.getOpPackageName();
        <span class="hljs-type">TN</span> <span class="hljs-variable">tn</span> <span class="hljs-operator">=</span> mTN;
        <span class="hljs-keyword">if</span> (Flags.toastNoWeakref()) {
            tn.mNextView = mNextView;
        } <span class="hljs-keyword">else</span> {
            tn.mNextViewWeakRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(mNextView);
        }
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isUiContext</span> <span class="hljs-operator">=</span> mContext.isUiContext();
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">displayId</span> <span class="hljs-operator">=</span> mContext.getDisplayId();

        <span class="hljs-type">boolean</span> <span class="hljs-variable">wasEnqueued</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (Compatibility.isChangeEnabled(CHANGE_TEXT_TOASTS_IN_THE_SYSTEM)) {
                <span class="hljs-keyword">if</span> (mNextView != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// It's a custom toast</span>
                    <span class="hljs-comment">// è°ƒç”¨NMS</span>
                    wasEnqueued = service.enqueueToast(pkg, mToken, tn, mDuration, isUiContext,
                            displayId);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ...</span>
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ...</span>
            }
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// Empty</span>
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// ...</span>
        }
    }
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (Compatibility.isChangeEnabled(CHANGE_TEXT_TOASTS_IN_THE_SYSTEM)
            &amp;&amp; mNextView == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨NMS </span>
            getService().cancelToast(mContext.getOpPackageName(), mToken);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// Empty</span>
        }
    } <span class="hljs-keyword">else</span> {
        mTN.cancel();
    }
}
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ˜¾ç¤ºå’Œéšè—Toastéƒ½éœ€è¦é€šè¿‡NMSæ¥å®ç°ï¼Œç”±äºNMSè¿è¡Œåœ¨ç³»ç»Ÿçš„è¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡IPCæ¥æ˜¾ç¤ºå’Œéšè—Toastã€‚</p>
<p>æ³¨æ„è¿™é‡Œçš„TNç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªBinderç±»ï¼Œåœ¨Toastå’ŒNMSè¿›è¡ŒIPCçš„è¿‡ç¨‹ä¸­ï¼Œå½“NMSå¤„ç†Toastçš„æ˜¾ç¤ºæˆ–éšè—è¯·æ±‚æ—¶ä¼šè·¨è¿›ç¨‹å›è°ƒTNä¸­çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ç”±äºTNè¿è¡Œåœ¨Binderçº¿ç¨‹æ± ä¸­ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡Handlerå°†å…¶åˆ‡æ¢åˆ°å½“å‰çº¿ç¨‹ä¸­ã€‚è¿™é‡Œçš„å½“å‰çº¿ç¨‹æŒ‡çš„æ˜¯å‘é€Toastæ‰€åœ¨çš„çº¿ç¨‹ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä½¿ç”¨äº†Handlerï¼Œæ‰€ä»¥è¿™æ„å‘³ç€Toastæ— æ³•åœ¨æ²¡æœ‰Looperçš„çº¿ç¨‹ä¸­å¼¹å‡ºï¼Œè¿™æ˜¯å› ä¸ºHandleréœ€è¦ä½¿ç”¨Looperæ‰èƒ½å®Œæˆåˆ‡æ¢çº¿ç¨‹çš„åŠŸèƒ½ã€‚</p>
<p>æ—¢ç„¶æ˜¯å…ˆå’ŒNMSé€šä¿¡ï¼Œç®€å•è¯´ä¸€ä¸‹NMSä¸­çš„ä»£ç ï¼Œä»£ç è¾ƒå¤šï¼Œç®€å•è¯´ä¸€ä¸‹æµç¨‹ï¼š</p>
<ol>
<li>è°ƒç”¨NMSæ–¹æ³•æºå¸¦3ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å½“å‰åŒ…åã€tnè¿œç¨‹å›è°ƒå’ŒToastæ—¶é•¿ã€‚NMSå…ˆæŠŠToastè¯·æ±‚å°è£…ä¸ºToastRecordå¯¹è±¡ï¼Œæ·»åŠ åˆ°mToastQueueé˜Ÿåˆ—ä¸­ã€‚</li>
<li>mToastQueueæ˜¯ä¸€ä¸ª50å®¹é‡çš„ArrayListï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢DOSï¼Œå‡å¦‚é€šè¿‡æŸä¸ªæ–¹æ³•å¤§é‡çš„è¿ç»­å¼¹å‡ºToastï¼Œè¿™å°†å¯¼è‡´å…¶ä»–åº”ç”¨æ²¡æœºä¼šå¼¹å‡ºToastã€‚</li>
<li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯è¾¾ä¸åˆ°å­˜å‚¨ä¸Šé™çš„ï¼Œå½“ToastRecordè¢«æ·»åŠ åˆ°mToastQueueä¸­ï¼ŒNMSä¼šé€šè¿‡showNextToastLockedæ–¹æ³•æ¥æ˜¾ç¤ºå½“å‰çš„Toastã€‚</li>
<li>Toastçš„æ˜¾ç¤ºæ˜¯ç”±ToastRecordçš„callbackæ¥å®Œæˆçš„ï¼Œè€Œè¿™ä¸ªcallbackå®é™…ä¸Šå°±æ˜¯ä¼ é€’è¿›æ¥çš„tnï¼Œæ‰€ä»¥æœ€ç»ˆè°ƒç”¨TNä¸­çš„æ–¹æ³•ä¼šæ˜¯åœ¨Binderçº¿ç¨‹æ± ä¸­ã€‚</li>
<li>Toastæ˜¾ç¤ºåï¼ŒNMSè¿˜ä¼šé€šè¿‡scheduleTimeoutLockedæ–¹æ³•å‘é€ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼ŒåŒæ ·æ˜¯ç»è¿‡callbackå›è°ƒï¼Œè¿™ä¸ªå°±æ˜¯å–æ¶ˆToastçš„åŠ¨ä½œã€‚</li>
</ol>
<p>æ‰€ä»¥ä»ä¸Šé¢åˆ†ææ¥çœ‹ï¼ŒToastå’ŒNMSè¿›è¡Œäº†å¤šæ¬¡IPCé€šä¿¡ï¼Œä½†æ˜¯çœŸæ­£å»æ˜¾ç¤ºToastçš„è¿˜æ˜¯å¾—ç”±Toastç±»æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„TNç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TN</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ITransientNotification</span>.Stub {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">final</span> Handler mHandler;
    <span class="hljs-comment">// ...</span>

    
    TN(Context context, String packageName, Binder token, List&lt;Callback&gt; callbacks,
            <span class="hljs-meta">@Nullable</span> Looper looper) {
        <span class="hljs-type">IAccessibilityManager</span> <span class="hljs-variable">accessibilityManager</span> <span class="hljs-operator">=</span> IAccessibilityManager.Stub.asInterface(
                ServiceManager.getService(Context.ACCESSIBILITY_SERVICE));
        mPresenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToastPresenter</span>(context, accessibilityManager, getService(),
                packageName);
        mParams = mPresenter.getLayoutParams();
        mPackageName = packageName;
        mToken = token;
        mCallbacks = callbacks;

        mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(looper, <span class="hljs-literal">null</span>) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
                <span class="hljs-keyword">switch</span> (msg.what) {
                    <span class="hljs-keyword">case</span> SHOW: {
                        <span class="hljs-type">IBinder</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> (IBinder) msg.obj;
                        handleShow(token);
                        <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">case</span> HIDE: {
                        handleHide();
                        <span class="hljs-comment">// Don't do this in handleHide() because it is also invoked by</span>
                        <span class="hljs-comment">// handleShow()</span>
                        mNextView = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">case</span> CANCEL: {
                        handleHide();
                        <span class="hljs-comment">// Don't do this in handleHide() because it is also invoked by</span>
                        <span class="hljs-comment">// handleShow()</span>
                        mNextView = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">try</span> {
                            getService().cancelToast(mPackageName, mToken);
                        } <span class="hljs-keyword">catch</span> (RemoteException e) {
                        }
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        };
    }

   <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ä¼šå‘ç°ä½¿ç”¨äº†Handlerï¼Œä½†æ˜¯å‰é¢è¯´è¿‡TNçš„å›è°ƒå…¶å®æ˜¯åœ¨Binderçº¿ç¨‹æ± ä¸­ï¼Œå³è¿è¡Œåœ¨å­çº¿ç¨‹ä¸­ã€‚å½“æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­å¼¹å‡ºToastè‚¯å®šæ²¡é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨å­çº¿ç¨‹ä¸­å¼¹å‡ºToastå‘¢ï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"ä½ å¥½"</span>, Toast.LENGTH_SHORT).show();
}).start();
</code></pre>
<p>è¿è¡ŒåæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="hljs language-java" lang="java">java.lang.NullPointerException: Can<span class="hljs-string">'t toast on a thread that has not called Looper.prepare()
at com.android.internal.util.Preconditions.checkNotNull(Preconditions.java:174)
at android.widget.Toast.getLooper(Toast.java:188)
at android.widget.Toast.&lt;init&gt;(Toast.java:173)
at android.widget.Toast.makeText(Toast.java:518)
at android.widget.Toast.makeText(Toast.java:507)
at com.example.windowtest.MainActivity.lambda$onCreate$1$com-example-windowtest-MainActivity(MainActivity.java:36)
at com.example.windowtest.MainActivity$$ExternalSyntheticLambda1.run(D8$$SyntheticClass:0)
</span></code></pre>
<p>å¯ä»¥å‘ç°è¿™é‡Œçš„é”™è¯¯å¹¶ä¸æ˜¯è¯´Viewä¸èƒ½å†å­çº¿ç¨‹ä¸­ç»˜åˆ¶ï¼Œè€Œæ˜¯è¯´æ²¡æœ‰Looperï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™å­çº¿ç¨‹ä¹Ÿè·å–ä»¥ä¸‹Looperï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    Looper.prepare();
    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"ä½ å¥½"</span>, Toast.LENGTH_SHORT).show();
}).start();
</code></pre>
<p>è¿è¡Œæ•ˆæœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7522a6afe7664b52ab800e2dfb1b997e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=y81K1R28i1H3At3qsglTH4rwlc4%3D" alt="" loading="lazy"/></p>
<p>æ˜¯å¯ä»¥æ­£å¸¸å¼¹å‡ºToastçš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬çŸ¥é“Toastä¸èƒ½æ˜¾ç¤ºåœ¨å­çº¿ç¨‹å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªé”™è¯¯ï¼ŒToastæ˜¯å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­å¼¹å‡ºçš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äº”ã€Kotlinâ€”â€”æ¡ä»¶æ§åˆ¶ã€å¾ªç¯æ§åˆ¶]]></title>    <link>https://juejin.cn/post/7579499567868575794</link>    <guid>https://juejin.cn/post/7579499567868575794</guid>    <pubDate>2025-12-03T14:42:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567868575794" data-draft-id="7579427549471113262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äº”ã€Kotlinâ€”â€”æ¡ä»¶æ§åˆ¶ã€å¾ªç¯æ§åˆ¶"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-03T14:42:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Haha_bj"/> <meta itemprop="url" content="https://juejin.cn/user/2612027844214647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äº”ã€Kotlinâ€”â€”æ¡ä»¶æ§åˆ¶ã€å¾ªç¯æ§åˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612027844214647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Haha_bj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:42:31.000Z" title="Wed Dec 03 2025 14:42:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¡ä»¶æ§åˆ¶æ˜¯æ¯é—¨ç¼–ç¨‹è¯­è¨€ä¸­å¿…ä¸å¯å°‘çš„ï¼Œä¸€èˆ¬å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„if-elseï¼Œæ¥ä½œä¸ºæˆ‘ä»¬ä»£ç é€»è¾‘é€‰æ‹©æ¡ä»¶æ§åˆ¶ã€‚åœ¨Javaä¸­ä¸€èˆ¬ä½¿ç”¨ if-elseå’Œ switch-case æ¥ä½œä¸ºæ¡ä»¶æ§åˆ¶ï¼Œè€Œåœ¨ Kotlin ä¸­åˆ™æ˜¯ä½¿ç”¨ if-else å’Œ when æ¥ä½œä¸ºæ¡ä»¶æ§åˆ¶ã€‚
ç«‹</p>
<blockquote>
<p>Tips:Kotlinä¸­æ²¡æœ‰switch-case ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f1ff8406dfe45af9097cc260d562474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=tPHh6XIxoeqn45OLkr7SERvuC30%3D" alt="å›¾ç‰‡.png" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€if è¡¨è¾¾å¼</h2>
<h3 data-id="heading-1">1ã€å¸¦è¿”å›å€¼ if è¡¨è¾¾å¼</h3>
<p>åœ¨ Kotlin ä¸­ï¼Œifæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼æ‰€ä»¥å®ƒä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè¡¨è¾¾å¼çš„å€¼ä¸ºè¡¨è¾¾å¼ä½œç”¨åŸŸå†…æœ€åä¸€è¡Œçš„å€¼ã€‚è¿™ä¸€ç‚¹å’ŒJava æ˜¯ä¸åŒçš„,åœ¨ Java ä¸­ if ä»…ä»…æ˜¯è¯­å¥ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">if</span> (a &gt; b){
        <span class="hljs-keyword">return</span>  a
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">return</span>  b
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> res = maxOf(<span class="hljs-number">10</span>,<span class="hljs-number">22</span>)
    
}
</code></pre>
<h3 data-id="heading-2">2ã€ if è¡¨è¾¾å¼æ›¿ä»£ä¸‰ç›®è¿ç®—ç¬¦</h3>
<p>å› ä¸ºåœ¨ Kotlin ä¸­ if è¡¨è¾¾å¼æ˜¯å¸¦æœ‰è¿”å›å€¼çš„ã€æ‰€ä»¥åœ¨ Kotlin ä¸­æ˜¯ä¸éœ€è¦ä¸‰ç›®è¿ç®—ç¬¦(xxx?xxx:xxx);å› ä¸º if è¡¨è¾¾å¼è¿™äº›éƒ½èƒ½åšåˆ°ã€‚</p>
<p>è€Œåœ¨ Kotlin ä¸­åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ if è¡¨è¾¾å¼æ¥ä½¿ç”¨:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/// è¿”å›if </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">if</span> (a &gt; b){
        a
    }<span class="hljs-keyword">else</span>{
        b
    }
}
<span class="hljs-comment">//ç®€å†™</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>,b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (a&gt;b) a <span class="hljs-keyword">else</span> b
}
</code></pre>
<h2 data-id="heading-3">äºŒã€when è¡¨è¾¾å¼</h2>
<p>åœ¨ Kotlin ä¸­ä½¿ç”¨ when è¡¨è¾¾å¼æ›¿ä»£äº†ç±»ä¼¼Cè¯­è¨€çš„ switch-case è¯­å¥ã€‚</p>
<p>when å°†å®ƒçš„å‚æ•°ä¸æ‰€æœ‰çš„åˆ†æ”¯æ¡ä»¶é¡ºåºæ¯”è¾ƒï¼Œç›´åˆ°æŸä¸ªåˆ†æ”¯æ»¡è¶³æ¡ä»¶ã€‚ when æ—¢å¯ä»¥è¢«å½“åšè¡¨è¾¾å¼ä½¿ç”¨ä¹Ÿå¯ä»¥è¢«å½“åšè¯­å¥ä½¿ç”¨ã€‚å¦‚æœå®ƒè¢«å½“åšè¡¨è¾¾å¼ï¼Œç¬¦åˆæ¡ä»¶çš„åˆ†æ”¯çš„å€¼å°±æ˜¯æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå¦‚æœå½“åšè¯­å¥ä½¿ç”¨ï¼Œåˆ™å¿½ç•¥ä¸ªåˆ«åˆ†æ”¯çš„å€¼ã€‚(åƒ ifä¸€æ ·ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯å¯ä»¥æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå®ƒçš„å€¼æ˜¯å—ä¸­æœ€åçš„è¡¨è¾¾å¼çš„å€¼ã€‚)</p>
<blockquote>
<p>Tips:å¦‚æœå…¶ä»–åˆ†æ”¯éƒ½ä¸æ»¡è¶³æ¡ä»¶å°†ä¼šæ±‚å€¼ e/se åˆ†æ”¯ã€‚å¦‚æœ when ä½œä¸ºä¸€ä¸ªè¡¨è¾¾å¼ä½¿ç”¨ï¼Œåˆ™å¿…é¡»æœ‰e/se åˆ†æ”¯ï¼Œé™¤éç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æµ‹å‡ºæ‰€æœ‰çš„å¯èƒ½æƒ…å†µéƒ½å·²ç»è¦†ç›–äº†</p>
</blockquote>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eval2</span><span class="hljs-params">(number: <span class="hljs-type">Number</span>)</span></span>:String=<span class="hljs-keyword">when</span>(number) {
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"this is int number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"this is double number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Float</span> -&gt; <span class="hljs-string">"ths is float number'
    is Long -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> long number<span class="hljs-string">"
    is Byte -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> byte number<span class="hljs-string">"
    is Short -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">Short</span> number<span class="hljs-string">"
    else -&gt; "</span>invalid number<span class="hljs-string">"
}
</span></code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// when åŒæ ·æ˜¯å¸¦æœ‰è¿”å›å€¼çš„// when å°†å®ƒçš„å‚æ•°ä¸æ‰€æœ‰çš„åˆ†æ”¯æ¡ä»¶é¡ºåºæ¯”è¾ƒï¼Œç›´åˆ°æŸä¸ªåˆ†æ”¯æ»¡è¶³æ¡ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eval2</span><span class="hljs-params">(number:<span class="hljs-type">Number</span>)</span></span>:String=<span class="hljs-keyword">when</span>(number) {
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"this is int number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"this is double number'"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Float</span> -&gt; {
        println(<span class="hljs-string">"the number is float"</span>)
        <span class="hljs-string">"ths is float number"</span>
    }
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Byte</span> -&gt; <span class="hljs-string">"this is byte number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Short</span> -&gt; <span class="hljs-string">"this is Short number"</span>
    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"invalid number"</span>
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5df85641a95409f8957604f5283996d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=DjQYdAuUaMJD1K%2BRJ9%2B2v8eiMuI%3D" alt="å›¾ç‰‡.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3d656eda8b74fcdb8f52e1cff528d6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=xdn%2Fu3DBYxZBPA8iN%2B9kSgypUGU%3D" alt="å›¾ç‰‡.png" loading="lazy"/></p>
<h2 data-id="heading-4">ä¸‰ã€å¾ªç¯æ§åˆ¶</h2>
<p>å¾ªç¯æ§åˆ¶è¯­å¥ä¹Ÿæ˜¯æ¯é—¨è¯­è¨€ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ï¼Œä¸€èˆ¬å°±æ˜¯æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„forã€whileã€do-while ã€‚
è¿Ÿ
Kotlin å¾ªç¯å…¶å®å‡ ä¹å’Œ Javaä¸­ çš„ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0f6c72138f14a928332a5b32b6486c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=goXC3cZ8%2BjUM21NhvOZu%2B0DUIXo%3D" alt="å›¾ç‰‡.png" loading="lazy"/></p>
<h3 data-id="heading-5">1ã€for å¾ªç¯</h3>
<p>for å¾ªç¯ å¯ä»¥å¯¹ä»»ä½•æä¾›è¿­ä»£å™¨(iterator)çš„å¯¹è±¡è¿›è¡Œéå†ï¼Œfor å¾ªç¯ä»…ä»¥å”¯ä¸€ä¸€ç§å½¢å¼å­˜åœ¨,å’Œ Javaçš„ foreachå¾ªç¯ä¸€è‡´ã€‚å…¶å†™æ³• for item in elements å’Œ C# ä¸€æ ·ã€‚å’Œ Java ç±»ä¼¼ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span>  array = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>)
<span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> array){
    println(item)
}
</code></pre>
<h3 data-id="heading-6">2ã€while å’Œ do-while å¾ªç¯</h3>
<p>Kotlin ä¸­ while å’Œ do-while å¾ªç¯ï¼Œå®ƒä»¬çš„è¯­æ³•å’Œ Java ä¸­ç›¸åº”çš„å¾ªç¯æ²¡ä»€ä¹ˆåŒºåˆ«:</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span>  array = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>)

<span class="hljs-keyword">var</span>  index = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> (index &lt; array.size){
    println(<span class="hljs-string">"The <span class="hljs-variable">$index</span> element is <span class="hljs-subst">${array[index++]}</span>"</span>)
}
println(<span class="hljs-string">"ç©ºæ ¼"</span>)

 <span class="hljs-comment">// do - while å…ˆæ‰§è¡Œ ä¸€æ¬¡å¾ªç¯ä½“ï¼Œå†çœ‹å¾ªç¯æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚æ»¡è¶³ç»§ç»­æ‰§è¡Œï¼Œä¸æ»¡è¶³åˆ™é€€ </span>
index = <span class="hljs-number">0</span>
<span class="hljs-keyword">do</span> {
    println(<span class="hljs-string">"The <span class="hljs-variable">$index</span> element is <span class="hljs-subst">${array[index++]}</span>"</span>)
}<span class="hljs-keyword">while</span> (index &lt; array.size)
</code></pre>
<h3 data-id="heading-7">3ã€åŒºé—´è¡¨è¾¾å¼</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// ..  éå†åŒºé—´ï¼Œæ³¨æ„Kotlinçš„åŒºé—´çš„åŒ…å«æˆ–æ˜¯é—­åˆçš„ã€‚</span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> .. <span class="hljs-number">10</span>){
    println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
}
<span class="hljs-comment">// 1 2 3 4 5 6 7 8 9 10</span>

<span class="hljs-comment">// until ä¸åŒ…æ‹¬æœ€åä¸€ä¸ªå…ƒç´ </span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> until  <span class="hljs-number">10</span>){
    println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
}
<span class="hljs-comment">// 1 2 3 4 5 6 6 7 8</span>
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin"> <span class="hljs-comment">// downTo //æ˜¯æŒ‡ä»10 ... 1</span>
  <span class="hljs-keyword">for</span> ( i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span>){
      println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
  }
<span class="hljs-comment">// 10 9 8 7 6 5 4 3 2 1</span>

  <span class="hljs-comment">// step æ­¥é•¿</span>
  <span class="hljs-keyword">for</span> ( i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span> step  <span class="hljs-number">2</span> ){
      println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
  }
  <span class="hljs-comment">// 10 8 6 5 4 2</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[23.Kotlin ç»§æ‰¿ï¼šç»§æ‰¿çš„ç»†èŠ‚ï¼šè¦†ç›–æ–¹æ³•ä¸å±æ€§]]></title>    <link>https://juejin.cn/post/7579518059170627610</link>    <guid>https://juejin.cn/post/7579518059170627610</guid>    <pubDate>2025-12-03T15:40:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579518059170627610" data-draft-id="7579472170906124338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="23.Kotlin ç»§æ‰¿ï¼šç»§æ‰¿çš„ç»†èŠ‚ï¼šè¦†ç›–æ–¹æ³•ä¸å±æ€§"/> <meta itemprop="keywords" content="Android,Kotlin,åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T15:40:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_å°é›¨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            23.Kotlin ç»§æ‰¿ï¼šç»§æ‰¿çš„ç»†èŠ‚ï¼šè¦†ç›–æ–¹æ³•ä¸å±æ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_å°é›¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:40:02.000Z" title="Wed Dec 03 2025 15:40:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>å¸Œæœ›å¸®ä½ åœ¨Kotlinè¿›é˜¶è·¯ä¸Šå°‘èµ°å¼¯è·¯ï¼Œåœ¨æŠ€æœ¯ä¸Šç¨³æ­¥æå‡ã€‚å½“ç„¶ï¼Œç”±äºä¸ªäººçŸ¥è¯†å‚¨å¤‡æœ‰é™ï¼Œç¬”è®°ä¸­éš¾å…å­˜åœ¨ç–æ¼æˆ–è¡¨è¿°ä¸å½“çš„åœ°æ–¹ï¼Œä¹Ÿéå¸¸æ¬¢è¿å¤§å®¶æå‡ºå®è´µæ„è§ï¼Œä¸€èµ·äº¤æµè¿›æ­¥ã€‚ â€”â€” Android_å°é›¨</p>
</blockquote>
<p>æ•´ä½“ç›®å½•ï¼š<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin è¿›é˜¶ä¸è¿·è·¯ï¼š41 ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæ„å»ºå®Œæ•´çŸ¥è¯†ä½“ç³»</a></p>
<h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä¸­ï¼Œç»§æ‰¿æ˜¯å®ç°ä»£ç å¤ç”¨å’Œå¤šæ€æ€§çš„åŸºçŸ³ã€‚ç„¶è€Œï¼Œç›¸è¾ƒäº Java å®½æ¾çš„ç»§æ‰¿æœºåˆ¶ï¼ŒKotlin å¼•å…¥äº†æ›´ä¸ºä¸¥æ ¼çš„â€œæ˜¾å¼å£°æ˜â€å“²å­¦ã€‚</p>
<h3 data-id="heading-1">1.1 è¦†ç›–çš„æ ¸å¿ƒä»·å€¼</h3>
<p>å­ç±»é€šè¿‡è¦†ç›–ï¼ˆOverrideï¼‰çˆ¶ç±»æˆå‘˜ï¼Œä¸ä»…èƒ½å¤Ÿç»§æ‰¿çˆ¶ç±»çš„èƒ½åŠ›ï¼Œæ›´èƒ½<strong>å®šåˆ¶åŒ–æ‰©å±•çˆ¶ç±»è¡Œä¸º</strong>ã€‚è¿™æ˜¯å®ç°å¤šæ€ç‰¹æ€§çš„å…³é”®ï¼šåŒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œåœ¨ä¸åŒçš„å­ç±»å®ä¾‹ä¸Šè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚</p>
<h3 data-id="heading-2">1.2 Kotlin çš„è®¾è®¡å“²å­¦</h3>
<p>Kotlin éµå¾ª <em>Effective Java</em> ä¸­çš„åè¨€ï¼šâ€œ<strong>Design and document for inheritance or else prohibit it</strong>â€ï¼ˆè¦ä¹ˆä¸ºç»§æ‰¿åšè®¾è®¡å¹¶æ–‡æ¡£åŒ–ï¼Œè¦ä¹ˆå°±ç¦æ­¢å®ƒï¼‰ã€‚
å› æ­¤ï¼ŒKotlin çš„ç±»å’Œæˆå‘˜é»˜è®¤æ˜¯ <code>final</code> çš„ã€‚è¿™ç§è®¾è®¡è§„é¿äº†â€œè„†å¼±åŸºç±»â€é—®é¢˜ï¼Œé˜²æ­¢å¼€å‘è€…åœ¨æ— æ„ä¸­è¦†ç›–äº†çˆ¶ç±»çš„é‡è¦é€»è¾‘ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å®‰å…¨æ€§å’Œå¯é¢„æµ‹æ€§ã€‚</p>
<h2 data-id="heading-3">äºŒã€è¦†ç›–çš„å‰ç½®æ¡ä»¶ï¼šOpen å…³é”®å­—</h2>
<p>è¦å®ç°è¦†ç›–ï¼Œå¿…é¡»æ‰“ç ´ Kotlin é»˜è®¤çš„â€œå°é—­â€çŠ¶æ€ï¼Œæ»¡è¶³â€œåŒé‡å¼€æ”¾â€æ¡ä»¶ï¼š</p>
<h3 data-id="heading-4">2.1 ç±»çš„å¯ç»§æ‰¿æ€§</h3>
<p>çˆ¶ç±»å¿…é¡»ç”¨ <code>open</code> ä¿®é¥°ã€‚</p>
<ul>
<li><strong>æ³¨æ„</strong>ï¼šæŠ½è±¡ç±»ï¼ˆ<code>abstract class</code>ï¼‰å’Œæ¥å£ï¼ˆ<code>interface</code>ï¼‰é»˜è®¤æ˜¯å¼€æ”¾çš„ï¼Œæ— éœ€æ˜¾å¼æ·»åŠ  <code>open</code>ã€‚</li>
<li><strong>ç¦æ­¢åœºæ™¯</strong>ï¼šæœªåŠ  <code>open</code> çš„æ™®é€šç±»é»˜è®¤ä¸º <code>final</code>ï¼Œä¸å¯è¢«ç»§æ‰¿ã€‚</li>
</ul>
<h3 data-id="heading-5">2.2 æˆå‘˜çš„å¯è¦†ç›–æ€§</h3>
<p>çˆ¶ç±»çš„æ–¹æ³•æˆ–å±æ€§å¿…é¡»ç”¨ <code>open</code> ä¿®é¥°ï¼Œå­ç±»æ‰èƒ½é€šè¿‡ <code>override</code> å…³é”®å­—è¿›è¡Œè¦†ç›–ã€‚
ä»¥ä¸‹æˆå‘˜<strong>ä¸å¯è¦†ç›–</strong>ï¼š</p>
<ul>
<li>æ—  <code>open</code> ä¿®é¥°çš„æ™®é€šæˆå‘˜ï¼ˆéšå¼ <code>final</code>ï¼‰ã€‚</li>
<li>é¡¶å±‚å‡½æ•°/å±æ€§ã€å±€éƒ¨å‡½æ•°/å±æ€§ã€‚</li>
<li><code>private</code> æˆå‘˜ï¼ˆå¯¹å­ç±»ä¸å¯è§ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-6">2.3 åŸºç¡€ç¤ºä¾‹</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ç±»å¿…é¡»æ˜¯ open çš„</span>
<span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-comment">// 2. å±æ€§å¿…é¡»æ˜¯ open çš„</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">120</span>

    <span class="hljs-comment">// 3. æ–¹æ³•å¿…é¡»æ˜¯ open çš„</span>
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"è½¦è¾†ä»¥ <span class="hljs-variable">$maxSpeed</span> km/h è¡Œé©¶"</span>)
    }
}

</code></pre>
<h2 data-id="heading-7">ä¸‰ã€æ–¹æ³•è¦†ç›–ï¼ˆMethod Overrideï¼‰ï¼šè§„åˆ™ä¸å®æˆ˜</h2>
<h3 data-id="heading-8">3.1 åŸºæœ¬è¯­æ³•</h3>
<p>Kotlin å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ <code>override</code> å…³é”®å­—ï¼Œè¿™ä¸ Java ä¸­å¯é€‰çš„ <code>@Override</code> æ³¨è§£æœ‰ç€æœ¬è´¨åŒºåˆ«ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-comment">// æ˜¾å¼ overrideï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"æ±½è½¦ä»¥ <span class="hljs-variable">$maxSpeed</span> km/h åŒ€é€Ÿè¡Œé©¶"</span>)
    }
}

<span class="hljs-comment">// å¤šæ€è°ƒç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> vehicle: Vehicle = Car()
    vehicle.run() <span class="hljs-comment">// è¾“å‡ºï¼šæ±½è½¦ä»¥ 120 km/h åŒ€é€Ÿè¡Œé©¶</span>
}

</code></pre>
<h3 data-id="heading-9">3.2 æ–¹æ³•è¦†ç›–çš„æ ¸å¿ƒè§„åˆ™</h3>
<h3 data-id="heading-10">3.2.1 ç­¾åå®Œå…¨å…¼å®¹</h3>
<ul>
<li><strong>å‚æ•°</strong>ï¼šæ•°é‡ã€ç±»å‹ã€é¡ºåºå¿…é¡»ä¸¥æ ¼ä¸€è‡´ã€‚</li>
<li><strong>è¿”å›å€¼åå˜ï¼ˆCovariantï¼‰</strong>ï¼šå­ç±»é‡å†™æ–¹æ³•æ—¶ï¼Œè¿”å›å€¼ç±»å‹å¯ä»¥æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹çš„<strong>å­ç±»å‹</strong>ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Transport</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Train</span> : <span class="hljs-type">Transport</span>()

<span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Logistics</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTransport</span><span class="hljs-params">()</span></span>: Transport = Transport()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RailwayLogistics</span> : <span class="hljs-type">Logistics</span>() {
    <span class="hljs-comment">// åˆæ³•ï¼šè¿”å› Train æ˜¯ Transport çš„å­ç±»</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTransport</span><span class="hljs-params">()</span></span>: Train = Train()
}

</code></pre>
<h3 data-id="heading-11">3.2.2 ç¦æ­¢â€œéšå¼è¦†ç›–â€ï¼ˆ override ä¸å¯çœç•¥ï¼‰</h3>
<p>å¦‚æœä¸å†™ <code>override</code>ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚è¿™ä¸€æœºåˆ¶æ˜ç¡®äº†å¼€å‘è€…çš„æ„å›¾ï¼Œé˜²æ­¢å› æ‹¼å†™é”™è¯¯æˆ–æ— æ„ä¸­å®šä¹‰äº†åŒåæ–¹æ³•è€Œå¯¼è‡´çš„é€»è¾‘ Bugã€‚</p>
<h3 data-id="heading-12">3.2.3 æ§åˆ¶åç»­è¦†ç›–æƒé™ï¼ˆFinal Overrideï¼‰</h3>
<p>å­ç±»è¦†ç›–åçš„æ–¹æ³•é»˜è®¤ä¾ç„¶æ˜¯ <code>open</code> çš„ã€‚å¦‚æœå¸Œæœ›ç»§æ‰¿é“¾åˆ°æ­¤ä¸ºæ­¢ï¼Œç¦æ­¢åç»­å­ç±»ç»§ç»­ä¿®æ”¹é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ <code>final override</code>ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SportCar</span> : <span class="hljs-type">Car</span>() {
    <span class="hljs-comment">// æ­¤æ–¹æ³•å·²è¢«é”å®šï¼ŒSportCar çš„å­ç±»æ— æ³•å†é‡å†™ run</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"è·‘è½¦ä»¥ 200 km/h é«˜é€Ÿè¡Œé©¶"</span>)
    }
}

</code></pre>
<h3 data-id="heading-13">3.2.4 æŠ½è±¡æ–¹æ³•çš„è¦†ç›–</h3>
<p>æŠ½è±¡æ–¹æ³•é»˜è®¤æ˜¯ <code>open</code> çš„ï¼ŒéæŠ½è±¡å­ç±»<strong>å¿…é¡»</strong>è¦†ç›–å®ƒä»¬ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMachine</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMachine</span> : <span class="hljs-type">AbstractMachine</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">// å¿…é¡»å®ç°</span>
        println(<span class="hljs-string">"å·¥å‚æœºå™¨å¯åŠ¨"</span>)
    }
}

</code></pre>
<h3 data-id="heading-14">3.3 å®æˆ˜æŠ€å·§ï¼šå¤ç”¨ä¸å¤šæ€ï¼ˆå¤ç”¨çˆ¶ç±»é€»è¾‘ï¼ˆsuper å…³é”®å­—ï¼‰ï¼‰</h3>
<p>åœ¨é‡å†™é€»è¾‘æ—¶ï¼Œé€šå¸¸éœ€è¦ä¿ç•™çˆ¶ç±»çš„åŸºç¡€è¡Œä¸ºï¼Œæ­¤æ—¶ä½¿ç”¨ <code>super</code> å…³é”®å­—ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bus</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.run() <span class="hljs-comment">// å¤ç”¨çˆ¶ç±»é€»è¾‘ï¼šè¾“å‡ºåŸºç¡€è¡Œé©¶ä¿¡æ¯</span>
        println(<span class="hljs-string">"å…¬äº¤è½¦å³å°†åœé ç«™ç‚¹"</span>) <span class="hljs-comment">// æ‰©å±•å­ç±»ç‰¹æœ‰é€»è¾‘</span>
    }
}

</code></pre>
<h2 data-id="heading-15">å››ã€å±æ€§è¦†ç›–ï¼ˆProperty Overrideï¼‰ï¼šç‰¹æ®Šè§„åˆ™ä¸é™·é˜±</h2>
<p>å±æ€§è¦†ç›–æ˜¯ Kotlin çš„ä¸€å¤§ç‰¹è‰²ï¼ˆJava ä¸­å­—æ®µä¸èƒ½è¢«é‡å†™ï¼‰ã€‚å…¶æ ¸å¿ƒåœ¨äºä¿æŒ<strong>ç±»å‹å…¼å®¹</strong>ä¸<strong>å¯å˜æ€§åˆç†</strong>ã€‚</p>
<h3 data-id="heading-16">4.1 åŸºæœ¬è¯­æ³•</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bicycle</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-comment">// è¦†ç›–å±æ€§ï¼Œè¯­æ³•ä¸æ–¹æ³•ç±»ä¼¼</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">40</span>
}

</code></pre>
<h3 data-id="heading-17">4.2 æ ¸å¿ƒè§„åˆ™</h3>
<h3 data-id="heading-18">4.2.1 å¯å˜æ€§å…¼å®¹è§„åˆ™ï¼ˆå…³é”®ï¼‰</h3>
<p>å­ç±»åœ¨è¦†ç›–å±æ€§æ—¶ï¼Œå¯ä»¥æ‰©å±•å±æ€§çš„å¯å˜æ€§ï¼Œä½†ä¸èƒ½é™åˆ¶å®ƒã€‚</p>



































<table><thead><tr><th>çˆ¶ç±»å±æ€§</th><th>å­ç±»è¦†ç›–å…è®¸</th><th>ç»“æœ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>val</code> (åªè¯»)</td><td><code>val</code> (åªè¯»)</td><td>âœ… åˆæ³•</td><td>ä¿æŒåªè¯»ç‰¹æ€§</td></tr><tr><td><code>val</code> (åªè¯»)</td><td><code>var</code> (è¯»å†™)</td><td>âœ… åˆæ³•</td><td><strong>æ‰©å±•</strong>ä¸ºå¯å˜ï¼Œå…¼å®¹çˆ¶ç±»çš„è¯»å–å¥‘çº¦</td></tr><tr><td><code>var</code> (è¯»å†™)</td><td><code>val</code> (åªè¯»)</td><td>âŒ <strong>ç¦æ­¢</strong></td><td>ç ´åäº†çˆ¶ç±»çš„â€œå†™å…¥â€å¥‘çº¦</td></tr><tr><td><code>var</code> (è¯»å†™)</td><td><code>var</code> (è¯»å†™)</td><td>âœ… åˆæ³•</td><td>ä¿æŒè¯»å†™ç‰¹æ€§</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹ï¼šVar è¦†ç›– Val</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> price: <span class="hljs-built_in">Double</span> = <span class="hljs-number">100.0</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MutableProduct</span> : <span class="hljs-type">Product</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Double</span> = <span class="hljs-number">120.0</span> <span class="hljs-comment">// åˆæ³•ï¼šå­ç±»å®ä¾‹å¯ä»¥ä¿®æ”¹ä»·æ ¼</span>
}

</code></pre>
<h3 data-id="heading-19">4.2.2 è¦†ç›–çš„ä¸‰ç§å®ç°æ–¹å¼</h3>
<ol>
<li>
<p><strong>ç›´æ¥èµ‹å€¼</strong>ï¼šèµ‹ä¸€ä¸ªæ–°çš„å¸¸é‡å€¼ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ElectricCar</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">150</span> <span class="hljs-comment">// ç›´æ¥é‡æ–°èµ‹å€¼</span>
}
</code></pre>
</li>
<li>
<p><strong>è‡ªå®šä¹‰ Getter (è®¡ç®—å±æ€§)</strong>ï¼šä¸å ç”¨å†…å­˜å­—æ®µï¼Œæ¯æ¬¡è®¿é—®æ—¶åŠ¨æ€è®¡ç®—ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = <span class="hljs-number">90</span> <span class="hljs-comment">// è®¡ç®—å±æ€§ï¼ˆæ— å­—æ®µå­˜å‚¨ï¼‰</span>
}

<span class="hljs-comment">// å¸¦ä¾èµ–çš„è®¡ç®—å±æ€§</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadedTruck</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">var</span> loadWeight: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = <span class="hljs-number">120</span> - (loadWeight / <span class="hljs-number">100</span>) <span class="hljs-comment">// è½½é‡è¶Šå¤§ï¼Œæœ€é«˜é€Ÿè¶Šä½</span>
}
</code></pre>
</li>
<li>
<p><strong>æŠ½è±¡å±æ€§çš„è¦†ç›–</strong>ï¼šæŠ½è±¡ç±»çš„æŠ½è±¡å±æ€§éšå¼ openï¼Œå­ç±»éœ€ç”¨ override æä¾›å®ç°ï¼ˆèµ‹å€¼æˆ–è®¡ç®—å±æ€§ï¼‰ã€‚</p>
</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Device</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> brand: String <span class="hljs-comment">// æŠ½è±¡å±æ€§ï¼Œæ— å®ç°</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> : <span class="hljs-type">Device</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> brand: String = <span class="hljs-string">"Apple"</span> <span class="hljs-comment">// èµ‹å€¼å®ç°</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tablet</span> : <span class="hljs-type">Device</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> brand: String <span class="hljs-keyword">get</span>() = <span class="hljs-string">"Samsung"</span> <span class="hljs-comment">// è®¡ç®—å±æ€§å®ç°</span>
}
</code></pre>
<h3 data-id="heading-20">4.3 âš ï¸ è‡´å‘½é™·é˜±</h3>
<p>è¿™æ˜¯ Kotlin ç»§æ‰¿ä¸­æœ€å®¹æ˜“è¸©çš„å‘ã€‚<strong>çˆ¶ç±»æ„é€ å‡½æ•°åœ¨å­ç±»å±æ€§åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œã€‚</strong></p>
<h3 data-id="heading-21">4.3.1åˆå§‹åŒ–é¡ºåºé™·é˜±</h3>
<p>å­ç±»è¦†ç›–å±æ€§çš„åˆå§‹åŒ–åœ¨ã€Œçˆ¶ç±»æ„é€ å‡½æ•°æ‰§è¡Œä¹‹åã€ï¼Œé¿å…åœ¨çˆ¶ç±»æ„é€ ä¸­ä¾èµ–å­ç±»è¦†ç›–å±æ€§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span> = <span class="hljs-number">10</span>
    <span class="hljs-keyword">init</span> {
        println(<span class="hljs-string">"Parent init: value = <span class="hljs-variable">$value</span>"</span>) <span class="hljs-comment">// è¾“å‡ºï¼š10ï¼ˆå­ç±»è¦†ç›–å±æ€§æœªåˆå§‹åŒ–ï¼‰</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> : <span class="hljs-type">Parent</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span> = <span class="hljs-number">20</span>
    <span class="hljs-keyword">init</span> {
        println(<span class="hljs-string">"Child init: value = <span class="hljs-variable">$value</span>"</span>) <span class="hljs-comment">// è¾“å‡ºï¼š20ï¼ˆè¦†ç›–å±æ€§å·²åˆå§‹åŒ–ï¼‰</span>
    }
}

<span class="hljs-keyword">val</span> child = Child() <span class="hljs-comment">// æ‰§è¡Œæµç¨‹ï¼šParent æ„é€  â†’ Child è¦†ç›–å±æ€§åˆå§‹åŒ– â†’ Child æ„é€ </span>
</code></pre>
<h3 data-id="heading-22">4.3.2 è¦†ç›– var å±æ€§çš„ getter/setter</h3>
<p>å¯å•ç‹¬è¦†ç›– var å±æ€§çš„ getter æˆ– setterï¼Œä¿ç•™å¦ä¸€éƒ¨åˆ†é€»è¾‘ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">"Unknown"</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NicknamedUser</span> : <span class="hljs-type">User</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> name: String
        <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">super</span>.name + <span class="hljs-string">"_nickname"</span> <span class="hljs-comment">// è¦†ç›– getter</span>
        <span class="hljs-keyword">set</span>(value) { <span class="hljs-keyword">super</span>.name = value.trim() } <span class="hljs-comment">// è¦†ç›– setter</span>
}

<span class="hljs-keyword">val</span> user = NicknamedUser()
user.name = <span class="hljs-string">"  Tom  "</span>
println(user.name) <span class="hljs-comment">// è¾“å‡ºï¼šTom_nickname</span>

</code></pre>
<h2 data-id="heading-23">äº”ã€è¦†ç›–å†²çªè§£å†³ï¼ˆå¤šå®ç°åœºæ™¯ï¼‰</h2>
<p>å½“ç±»ç»§æ‰¿äº†çˆ¶ç±»å¹¶å®ç°äº†å¤šä¸ªæ¥å£ï¼Œä¸”è¿™äº›çˆ¶ç±»å‹ä¸­å­˜åœ¨ç­¾åç›¸åŒçš„æˆå‘˜æ—¶ï¼Œç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨å†³ç­–ï¼Œå¿…é¡»ç”±å¼€å‘è€…æ˜¾å¼è§£å†³å†²çªã€‚</p>
<h3 data-id="heading-24">5.1 æ¥å£å¤šå®ç°çš„å†²çª</h3>
<p>å¤šä¸ªæ¥å£æœ‰åŒåæ–¹æ³•æ—¶ï¼Œä½¿ç”¨ <code>super&lt;T&gt;</code> è¯­æ³•æŒ‡å®šè°ƒç”¨å“ªä¸ªæ¥å£çš„å®ç°ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Walkable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"æ­¥è¡Œ"</span>)
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"é£è¡Œ"</span>)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> : <span class="hljs-type">Walkable</span>, <span class="hljs-type">Flyable</span> {
    <span class="hljs-comment">// ç¼–è¯‘å™¨æŠ¥é”™ï¼Œå¿…é¡»æ˜¾å¼ override</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>&lt;Walkable&gt;.move() <span class="hljs-comment">// è°ƒç”¨ Walkable çš„é€»è¾‘</span>
        <span class="hljs-keyword">super</span>&lt;Flyable&gt;.move()  <span class="hljs-comment">// è°ƒç”¨ Flyable çš„é€»è¾‘</span>
        println(<span class="hljs-string">"é¸Ÿç±»æ‰‘è…¾ç€ç¿…è†€"</span>)
    }
}

</code></pre>
<h3 data-id="heading-25">5.2 ç±»ç»§æ‰¿ + æ¥å£å®ç°çš„å†²çª(å±æ€§å†²çªè§£å†³)</h3>
<p>çˆ¶ç±»æˆå‘˜ä¼˜å…ˆçº§é«˜äºæ¥å£æˆå‘˜ã€‚è‹¥éœ€è°ƒç”¨æ¥å£çš„å®ç°ï¼Œéœ€é€šè¿‡ <code>super&lt;æ¥å£å&gt;.æˆå‘˜()</code> æ˜¾å¼æŒ‡å®šï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"åŠ¨ç‰©è¿›é£Ÿ"</span>)
    }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Herbivore</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"é£Ÿè‰åŠ¨ç‰©åƒæ¤ç‰©"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Deer</span> : <span class="hljs-type">Animal</span>(), Herbivore {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>&lt;Animal&gt;.eat() <span class="hljs-comment">// æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼ˆä¹Ÿå¯ç›´æ¥ super.eat()ï¼‰</span>
        <span class="hljs-keyword">super</span>&lt;Herbivore&gt;.eat() <span class="hljs-comment">// æ˜¾å¼è°ƒç”¨æ¥å£æ–¹æ³•</span>
    }
}

<span class="hljs-keyword">val</span> deer = Deer()
deer.eat() <span class="hljs-comment">// è¾“å‡ºï¼šåŠ¨ç‰©è¿›é£Ÿ â†’ é£Ÿè‰åŠ¨ç‰©åƒæ¤ç‰©</span>

</code></pre>
<h2 data-id="heading-26">å…­ã€ä½¿ç”¨æ³¨æ„äº‹é¡¹ä¸é¿å‘æŒ‡å—</h2>
<ol>
<li>
<p><strong>ç¦æ­¢è¦†ç›– private æˆå‘˜</strong>ï¼š
çˆ¶ç±» <code>private</code> æˆå‘˜å¯¹å­ç±»ä¸å¯è§ã€‚è‹¥å­ç±»å®šä¹‰äº†ä¸€ä¸ªåŒåå‡½æ•°ï¼Œè¿™<strong>ä¸æ˜¯è¦†ç›–</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„ã€ä¸çˆ¶ç±»æ— å…³çš„æ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>é¿å…è¿‡åº¦è¦†ç›–</strong>ï¼š
ä¸è¦ä¸ºäº†ä½¿ç”¨ç»§æ‰¿è€Œç»§æ‰¿ã€‚ä»…åœ¨éœ€è¦ä¿®æ”¹/æ‰©å±•çˆ¶ç±»è¡Œä¸ºæ—¶è¿›è¡Œè¦†ç›–ã€‚å¦‚æœåªæ˜¯ä¸ºäº†å¤ç”¨ä»£ç ï¼Œä¼˜å…ˆè€ƒè™‘**ç»„åˆï¼ˆCompositionï¼‰**è€Œéç»§æ‰¿ã€‚</p>
</li>
<li>
<p><strong>è°¨æ…ä¿®æ”¹å¯å˜æ€§</strong>ï¼š
è™½ç„¶ç”¨ <code>var</code> è¦†ç›– <code>val</code> åœ¨è¯­æ³•ä¸Šæ˜¯å…è®¸çš„ï¼Œä½†è¦ç¡®ä¿è¿™æ ·åšç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼Œé˜²æ­¢å¤–éƒ¨æ„å¤–ä¿®æ”¹äº†æœ¬è¯¥æ˜¯å¸¸é‡çš„å±æ€§ã€‚</p>
</li>
<li>
<p><strong>å¤šæ€åœºæ™¯ä¸‹çš„ç±»å‹è½¬æ¢</strong>ï¼š
çˆ¶ç±»å¼•ç”¨è°ƒç”¨è¦†ç›–æˆå‘˜æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨åˆ†å‘åˆ°å­ç±»çš„å®ç°ï¼Œ<strong>æ— éœ€</strong>è¿›è¡Œç±»å‹å¼ºè½¬å³å¯æ‰§è¡Œå­ç±»é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>å¼‚å¸¸å£°æ˜</strong>ï¼š
Kotlin æ²¡æœ‰ Checked Exceptionï¼ˆå—æ£€å¼‚å¸¸ï¼‰ï¼Œä½†è¦†ç›–æ–¹æ³•æ—¶ï¼Œå­ç±»æŠ›å‡ºçš„è¿è¡Œæ—¶å¼‚å¸¸èŒƒå›´ä¸åº”è¿èƒŒçˆ¶ç±»çš„è®¾è®¡å¥‘çº¦ï¼ˆéµå¾ª Liskov æ›¿æ¢åŸåˆ™ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ¥å£æŠ½è±¡æˆå‘˜ä¸çˆ¶ç±»æˆå‘˜å†²çª</strong></p>
<p>ä¼˜å…ˆè¦†ç›–çˆ¶ç±»æˆå‘˜ï¼Œè‹¥éœ€ä½¿ç”¨æ¥å£é€»è¾‘ï¼Œé€šè¿‡ super&lt;æ¥å£å&gt; è°ƒç”¨</p>
</li>
<li>
<p><strong>è¦†ç›–æ–¹æ³•çš„å¼‚å¸¸å£°æ˜</strong></p>
<p>å­ç±»è¦†ç›–æ–¹æ³•ä¸èƒ½æŠ›å‡ºæ¯”çˆ¶ç±»æ›´å¤šçš„ checked å¼‚å¸¸ï¼ˆKotlin æ—  checked å¼‚å¸¸ï¼Œä½†éœ€æ³¨æ„è¿è¡Œæ—¶å¼‚å¸¸çš„åˆç†æ€§ï¼‰</p>
</li>
</ol>
<h2 data-id="heading-27">ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-28">7.1 æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾</h3>
<ul>
<li>è¦†ç›–å‰æï¼šçˆ¶ç±» open + æˆå‘˜ openï¼Œå­ç±»æ˜¾å¼ override</li>
<li>æ–¹æ³•è¦†ç›–ï¼šç­¾åå…¼å®¹ã€æ”¯æŒåå˜è¿”å›å€¼ã€å¯é€šè¿‡ final ç¦æ­¢åç»­è¦†ç›–</li>
<li>å±æ€§è¦†ç›–ï¼šæ”¯æŒ valâ†’var æ‰©å±•ã€ä¸‰ç§å®ç°æ–¹å¼ã€æ³¨æ„åˆå§‹åŒ–é¡ºåº</li>
<li>å†²çªè§£å†³ï¼šå¤šå®ç°åŒåæˆå‘˜éœ€æ˜¾å¼ overrideï¼Œç”¨ super&lt;ç±»å‹&gt; å¤ç”¨æŒ‡å®šå®ç°</li>
</ul>
<h3 data-id="heading-29">7.2 æœ€ä½³å®è·µ</h3>
<ul>
<li><strong>æ˜¾å¼åŒ–åŸåˆ™</strong>ï¼šopen å’Œ override å…³é”®å­—ä¸å¯çœç•¥ï¼Œæå‡ä»£ç å¯è¯»æ€§</li>
<li><strong>æœ€å°ä¿®æ”¹åŸåˆ™</strong>ï¼šè¦†ç›–çˆ¶ç±»æˆå‘˜æ—¶ï¼Œå°½é‡å¤ç”¨ super é€»è¾‘ï¼Œä»…è¡¥å……å¿…è¦çš„å­ç±»å·®å¼‚</li>
<li><strong>å…¼å®¹æ€§åŸåˆ™</strong>ï¼šè¦†ç›–åçš„æˆå‘˜éœ€ä¿æŒä¸çˆ¶ç±»çš„å…¼å®¹æ€§ï¼ˆä¸ç¼©å°å‚æ•°èŒƒå›´ã€ä¸ä¸¢å¤±åŠŸèƒ½ï¼‰</li>
<li><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼šé¿å…ä¸ºäº†è¦†ç›–è€Œè¦†ç›–ï¼Œç¡®ä¿è¦†ç›–è¡Œä¸ºç¬¦åˆå­ç±»çš„ä¸šåŠ¡èŒè´£</li>
<li><strong>å†²çªå¤„ç†åŸåˆ™</strong>ï¼šå¤šå®ç°å†²çªæ—¶ï¼Œä¼˜å…ˆä¿ç•™æ ¸å¿ƒé€»è¾‘ï¼Œåˆç†å¤ç”¨ä¸åŒæ¥å£ / çˆ¶ç±»çš„å®ç°</li>
</ul>
<h3 data-id="heading-30">7.3 Kotlin vs Java è¦†ç›–æ ¸å¿ƒåŒºåˆ«</h3>






























<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>Kotlin è¦†ç›–</th><th>Java è¦†ç›–</th></tr></thead><tbody><tr><td><strong>æ˜¾å¼å£°æ˜</strong></td><td><strong>å¿…é¡»</strong>ç”¨ <code>override</code></td><td>å¯é€‰ <code>@Override</code></td></tr><tr><td><strong>é»˜è®¤çŠ¶æ€</strong></td><td>é»˜è®¤ <code>final</code> (éœ€ <code>open</code>)</td><td>é»˜è®¤å¯è¦†ç›– (éœ€ <code>final</code> ç¦æ­¢)</td></tr><tr><td><strong>å±æ€§è¦†ç›–</strong></td><td>æ”¯æŒ (val -&gt; var, Getter)</td><td>ä¸æ”¯æŒ (ä»…å­—æ®µéšè—)</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>æ”¯æŒåå˜</td><td>æ”¯æŒåå˜</td></tr></tbody></table>
<h3 data-id="heading-31">8.å…¨æ–‡æ€»ç»“</h3>
<p>ä¸ºäº†æ–¹ä¾¿è®°å¿† Kotlin çš„è¦†ç›–è§„åˆ™ï¼Œæˆ‘ä»¬æ€»ç»“ä¸ºï¼š</p>
<ul>
<li><strong>1 ä¸ªå…³é”®å­—</strong>ï¼š<strong>override</strong> æ˜¯å¼ºåˆ¶ä¸”æ ¸å¿ƒçš„ã€‚</li>
<li><strong>2 ä¸ªå‰æ</strong>ï¼šçˆ¶ç±»å¿…é¡» <strong>open</strong> + æˆå‘˜å¿…é¡» <strong>open</strong>ã€‚</li>
<li><strong>3 ç§å±æ€§è¦†ç›–</strong>ï¼šç›´æ¥èµ‹å€¼ã€è‡ªå®šä¹‰ Getterã€<strong>var è¦†ç›– val</strong>ï¼ˆæ‰©å±•å¯å˜æ€§ï¼‰ã€‚</li>
<li><strong>4 å¤§æ ¸å¿ƒè§„åˆ™</strong>ï¼š
<ol>
<li>ç­¾åå¿…é¡»ä¸¥æ ¼åŒ¹é…ã€‚</li>
<li>è¿”å›å€¼æ”¯æŒåå˜ï¼ˆå­ç±»ç±»å‹ï¼‰ã€‚</li>
<li>åˆå§‹åŒ–é™·é˜±ï¼ˆçˆ¶ç±»æ„é€ å…ˆäºå­ç±»å±æ€§ï¼‰ã€‚</li>
<li>å†²çªè§£å†³éœ€æŒ‡æ˜ <code>super&lt;Type&gt;</code>ã€‚</li>
</ol>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹åº”ç”¨æŠ€æœ¯ä¹‹Reranké‡æ’åº]]></title>    <link>https://juejin.cn/post/7579460553614884915</link>    <guid>https://juejin.cn/post/7579460553614884915</guid>    <pubDate>2025-12-03T11:53:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579460553614884915" data-draft-id="7579473409748353075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹åº”ç”¨æŠ€æœ¯ä¹‹Reranké‡æ’åº"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T11:53:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Stream"/> <meta itemprop="url" content="https://juejin.cn/user/4132429930956443"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹åº”ç”¨æŠ€æœ¯ä¹‹Reranké‡æ’åº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4132429930956443/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Stream
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:53:12.000Z" title="Wed Dec 03 2025 11:53:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœ¬æœŸå¯¼è¯»</h2>
<p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†RAGæ£€ç´¢å¢å¼ºã€Function Callingå·¥å…·è°ƒç”¨ã€MCPåè®®ã€Agentæ¶æ„ã€A2Aåä½œã€Prompt Engineeringå’ŒAIç¼–ç¨‹å·¥å…·ã€‚ç°åœ¨æˆ‘ä»¬è¦æ¢è®¨RAGç³»ç»Ÿä¸­çš„å…³é”®ç»„ä»¶â€”â€”Rerankï¼ˆé‡æ’åºï¼‰æŠ€æœ¯ã€‚</p>
<p>Rerankæ˜¯RAGç³»ç»Ÿä¸­çš„"è´¨æ£€å‘˜"ï¼Œå®ƒèƒ½å¤Ÿå¯¹åˆæ­¥æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åºï¼Œæ˜¾è‘—æå‡æ£€ç´¢è´¨é‡ï¼Œæ˜¯æ„å»ºé«˜è´¨é‡RAGç³»ç»Ÿä¸å¯æˆ–ç¼ºçš„æŠ€æœ¯ã€‚</p>
<p>æœ¬æ–‡å°†å…¨é¢è§£æRerankçš„åŸç†ã€ç®—æ³•ã€æ¨¡å‹å’Œåº”ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´ç²¾å‡†çš„æ£€ç´¢ç³»ç»Ÿã€‚</p>
<p>æœ¬æ–‡å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>Rerankçš„åŸºç¡€æ¦‚å¿µå’ŒåŸç†</li>
<li>Rerankç®—æ³•è¯¦è§£</li>
<li>ä¸»æµRerankæ¨¡å‹å¯¹æ¯”</li>
<li>Rerankåœ¨RAGä¸­çš„åº”ç”¨ç­–ç•¥</li>
<li>Pythonå®æˆ˜ï¼šæ„å»ºRerankç³»ç»Ÿ</li>
<li>æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ</li>
</ul>
<h2 data-id="heading-1">ä¸€ã€Rerankæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h3 data-id="heading-2">1.1 Rerankçš„å®šä¹‰</h3>
<p>**Rerankï¼ˆé‡æ’åºï¼‰**æ˜¯æŒ‡åœ¨åˆæ­¥æ£€ç´¢ç»“æœçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„æ¨¡å‹å¯¹ç»“æœè¿›è¡Œé‡æ–°æ’åºçš„æŠ€æœ¯ã€‚</p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»Ÿæ£€ç´¢æµç¨‹ï¼š
æŸ¥è¯¢ â†’ å‘é‡æ£€ç´¢ â†’ è¿”å›<span class="hljs-attribute">Top</span>-Kç»“æœ

Rerankå¢å¼ºæµç¨‹ï¼š
æŸ¥è¯¢ â†’ å‘é‡æ£€ç´¢ â†’ Reranké‡æ’åº â†’ è¿”å›ä¼˜åŒ–åçš„<span class="hljs-attribute">Top</span>-Kç»“æœ
</code></pre>
<h3 data-id="heading-3">1.2 Rerankçš„æ ¸å¿ƒä»·å€¼</h3>
<p><strong>1. æå‡æ£€ç´¢ç²¾åº¦</strong></p>
<ul>
<li>ä¼ ç»Ÿå‘é‡æ£€ç´¢ï¼š70-80%å‡†ç¡®ç‡</li>
<li>åŠ å…¥Rerankåï¼š85-95%å‡†ç¡®ç‡</li>
</ul>
<p><strong>2. å‡å°‘å™ªå£°å¹²æ‰°</strong></p>
<ul>
<li>è¿‡æ»¤ä¸ç›¸å…³æ–‡æ¡£</li>
<li>æå‡ç›¸å…³æ–‡æ¡£æ’å</li>
<li>æ”¹å–„ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>3. ä¼˜åŒ–è®¡ç®—æ•ˆç‡</strong></p>
<ul>
<li>ç²—æ’+ç²¾æ’çš„ä¸¤é˜¶æ®µæ¶æ„</li>
<li>å¹³è¡¡ç²¾åº¦å’Œæ•ˆç‡</li>
<li>é™ä½è®¡ç®—æˆæœ¬</li>
</ul>
<h3 data-id="heading-4">1.3 Rerank vs ä¼ ç»Ÿæ£€ç´¢</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿå‘é‡æ£€ç´¢</th><th>Reranké‡æ’åº</th></tr></thead><tbody><tr><td><strong>è®¡ç®—å¤æ‚åº¦</strong></td><td>O(n)</td><td>O(k) (k&lt;&lt;n)</td></tr><tr><td><strong>æ£€ç´¢ç²¾åº¦</strong></td><td>ä¸­ç­‰</td><td>é«˜</td></tr><tr><td><strong>è®¡ç®—æˆæœ¬</strong></td><td>ä½</td><td>ä¸­ç­‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¤§è§„æ¨¡æ£€ç´¢</td><td>ç²¾ç¡®æ£€ç´¢</td></tr><tr><td><strong>å»¶è¿Ÿ</strong></td><td>ä½</td><td>ä¸­ç­‰</td></tr></tbody></table>
<h3 data-id="heading-5">1.4 Rerankçš„åº”ç”¨åœºæ™¯</h3>
<p><strong>1. é—®ç­”ç³»ç»Ÿ</strong></p>
<pre><code class="hljs">ç”¨æˆ·é—®é¢˜ï¼šå¦‚ä½•ä¼˜åŒ–Pythonä»£ç æ€§èƒ½ï¼Ÿ
åˆæ­¥æ£€ç´¢ï¼šè¿”å›10ä¸ªç›¸å…³æ–‡æ¡£
Rerankåï¼šé‡æ–°æ’åºï¼Œæœ€ç›¸å…³çš„æ’åœ¨å‰é¢
</code></pre>
<p><strong>2. æ–‡æ¡£æœç´¢</strong></p>
<pre><code class="hljs">æœç´¢å…³é”®è¯ï¼šæœºå™¨å­¦ä¹ ç®—æ³•
åˆæ­¥æ£€ç´¢ï¼šè¿”å›20ä¸ªæ–‡æ¡£
Rerankåï¼šæŒ‰ç›¸å…³æ€§é‡æ–°æ’åº
</code></pre>
<p><strong>3. æ¨èç³»ç»Ÿ</strong></p>
<pre><code class="hljs">ç”¨æˆ·åå¥½ï¼šç§‘æŠ€ç±»æ–‡ç« 
åˆæ­¥æ£€ç´¢ï¼šè¿”å›50ç¯‡æ–‡ç« 
Rerankåï¼šæŒ‰ç”¨æˆ·å…´è¶£åº¦æ’åº
</code></pre>
<hr/>
<h2 data-id="heading-6">äºŒã€Rerankç®—æ³•è¯¦è§£</h2>
<h3 data-id="heading-7">2.1 Cross-Encoderç®—æ³•</h3>
<h4 data-id="heading-8">2.1.1 ç®—æ³•åŸç†</h4>
<p><strong>Cross-Encoder</strong>æ˜¯æœ€å¸¸ç”¨çš„Rerankç®—æ³•ï¼Œå®ƒå°†æŸ¥è¯¢å’Œæ–‡æ¡£åŒæ—¶è¾“å…¥æ¨¡å‹ï¼Œè¾“å‡ºç›¸å…³æ€§åˆ†æ•°ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Cross-Encoderæ¶æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossEncoder</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        scores = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            <span class="hljs-comment"># å°†æŸ¥è¯¢å’Œæ–‡æ¡£æ‹¼æ¥</span>
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>, 
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            
            <span class="hljs-comment"># è®¡ç®—ç›¸å…³æ€§åˆ†æ•°</span>
            <span class="hljs-keyword">with</span> torch.no_grad():
                outputs = self.model(**inputs)
                score = torch.sigmoid(outputs.logits).item()
                scores.append(score)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-9">2.1.2 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h4>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ç²¾åº¦é«˜ï¼šè€ƒè™‘æŸ¥è¯¢å’Œæ–‡æ¡£çš„äº¤äº’</li>
<li>æ¨¡å‹ç®€å•ï¼šæ˜“äºå®ç°å’Œéƒ¨ç½²</li>
<li>æ•ˆæœç¨³å®šï¼šåœ¨å„ç§åœºæ™¯ä¸‹è¡¨ç°è‰¯å¥½</li>
</ul>
<p><strong>åŠ£åŠ¿ï¼š</strong></p>
<ul>
<li>è®¡ç®—æˆæœ¬é«˜ï¼šéœ€è¦é€ä¸ªè®¡ç®—</li>
<li>æ— æ³•é¢„è®¡ç®—ï¼šæ¯æ¬¡éƒ½éœ€è¦å®æ—¶è®¡ç®—</li>
<li>æ‰©å±•æ€§å·®ï¼šéš¾ä»¥å¤„ç†å¤§é‡æ–‡æ¡£</li>
</ul>
<h3 data-id="heading-10">2.2 ColBERTç®—æ³•</h3>
<h4 data-id="heading-11">2.2.1 ç®—æ³•åŸç†</h4>
<p><strong>ColBERT</strong>ä½¿ç”¨ç»†ç²’åº¦çš„tokençº§äº¤äº’ï¼Œå¹³è¡¡äº†ç²¾åº¦å’Œæ•ˆç‡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ColBERTæ¶æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ColBERT</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.model = ColBERTModel.from_pretrained(model_name)
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_query</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-comment"># ç¼–ç æŸ¥è¯¢</span>
        query_tokens = self.tokenizer(query, return_tensors=<span class="hljs-string">'pt'</span>)
        query_embeddings = self.model.query(**query_tokens)
        <span class="hljs-keyword">return</span> query_embeddings
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-comment"># ç¼–ç æ–‡æ¡£</span>
        doc_embeddings = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc_tokens = self.tokenizer(doc, return_tensors=<span class="hljs-string">'pt'</span>)
            doc_embedding = self.model.doc(**doc_tokens)
            doc_embeddings.append(doc_embedding)
        <span class="hljs-keyword">return</span> doc_embeddings
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query_embeddings, doc_embeddings</span>):
        scores = []
        <span class="hljs-keyword">for</span> doc_embedding <span class="hljs-keyword">in</span> doc_embeddings:
            <span class="hljs-comment"># è®¡ç®—æœ€å¤§ç›¸ä¼¼åº¦</span>
            max_sim = torch.<span class="hljs-built_in">max</span>(torch.<span class="hljs-built_in">sum</span>(query_embeddings * doc_embedding, dim=-<span class="hljs-number">1</span>))
            scores.append(max_sim.item())
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-12">2.2.2 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h4>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ•ˆç‡é«˜ï¼šå¯ä»¥é¢„è®¡ç®—æ–‡æ¡£åµŒå…¥</li>
<li>ç²¾åº¦å¥½ï¼šç»†ç²’åº¦äº¤äº’</li>
<li>å¯æ‰©å±•ï¼šæ”¯æŒå¤§è§„æ¨¡æ£€ç´¢</li>
</ul>
<p><strong>åŠ£åŠ¿ï¼š</strong></p>
<ul>
<li>å®ç°å¤æ‚ï¼šéœ€è¦ç‰¹æ®Šçš„æ•°æ®ç»“æ„</li>
<li>å†…å­˜å ç”¨å¤§ï¼šéœ€è¦å­˜å‚¨ç»†ç²’åº¦åµŒå…¥</li>
<li>æ¨¡å‹è¾ƒå¤§ï¼šå‚æ•°é‡è¾ƒå¤š</li>
</ul>
<h3 data-id="heading-13">2.3 RAG-Fusionç®—æ³•</h3>
<h4 data-id="heading-14">2.3.1 ç®—æ³•åŸç†</h4>
<p><strong>RAG-Fusion</strong>ç»“åˆå¤šä¸ªæŸ¥è¯¢çš„æ£€ç´¢ç»“æœï¼Œé€šè¿‡èåˆæå‡æ£€ç´¢è´¨é‡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># RAG-Fusionæ¶æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGFusion</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, llm_model, rerank_model</span>):
        self.llm = llm_model
        self.reranker = rerank_model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_queries</span>(<span class="hljs-params">self, original_query, num_queries=<span class="hljs-number">3</span></span>):
        <span class="hljs-comment"># ä½¿ç”¨LLMç”Ÿæˆå¤šä¸ªç›¸å…³æŸ¥è¯¢</span>
        prompt = <span class="hljs-string">f"""
        åŸºäºä»¥ä¸‹æŸ¥è¯¢ï¼Œç”Ÿæˆ<span class="hljs-subst">{num_queries}</span>ä¸ªç›¸å…³çš„æŸ¥è¯¢ï¼š
        åŸå§‹æŸ¥è¯¢ï¼š<span class="hljs-subst">{original_query}</span>
        
        è¦æ±‚ï¼š
        1. ä¿æŒåŸæ„ä¸å˜
        2. ä»ä¸åŒè§’åº¦è¡¨è¾¾
        3. ä½¿ç”¨åŒä¹‰è¯å’Œè¿‘ä¹‰è¯
        """</span>
        
        response = self.llm.generate(prompt)
        queries = self.parse_queries(response)
        <span class="hljs-keyword">return</span> [original_query] + queries
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fusion_rerank</span>(<span class="hljs-params">self, queries, documents</span>):
        all_scores = []
        
        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> queries:
            <span class="hljs-comment"># å¯¹æ¯ä¸ªæŸ¥è¯¢è¿›è¡Œæ£€ç´¢å’Œé‡æ’åº</span>
            scores = self.reranker.rerank(query, documents)
            all_scores.append(scores)
        
        <span class="hljs-comment"># èåˆå¤šä¸ªæŸ¥è¯¢çš„åˆ†æ•°</span>
        fusion_scores = self.fusion_scores(all_scores)
        <span class="hljs-keyword">return</span> fusion_scores
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fusion_scores</span>(<span class="hljs-params">self, all_scores</span>):
        <span class="hljs-comment"># ä½¿ç”¨åŠ æƒå¹³å‡èåˆåˆ†æ•°</span>
        weights = [<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>]  <span class="hljs-comment"># åŸå§‹æŸ¥è¯¢æƒé‡æ›´é«˜</span>
        fusion_scores = []
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_scores[<span class="hljs-number">0</span>])):
            score = <span class="hljs-built_in">sum</span>(scores[i] * weight <span class="hljs-keyword">for</span> scores, weight <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(all_scores, weights))
            fusion_scores.append(score)
        
        <span class="hljs-keyword">return</span> fusion_scores
</code></pre>
<h3 data-id="heading-15">2.4 å…¶ä»–Rerankç®—æ³•</h3>
<h4 data-id="heading-16">2.4.1 BM25 + Neural Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># BM25 + Neural Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BM25NeuralRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bm25_model, neural_reranker</span>):
        self.bm25 = bm25_model
        self.neural_reranker = neural_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-comment"># ç¬¬ä¸€é˜¶æ®µï¼šBM25ç²—æ’</span>
        bm25_scores = self.bm25.get_scores(query, documents)
        
        <span class="hljs-comment"># é€‰æ‹©Top-Kè¿›è¡Œç¥ç»é‡æ’åº</span>
        top_k_indices = np.argsort(bm25_scores)[-<span class="hljs-number">20</span>:]  <span class="hljs-comment"># Top-20</span>
        top_k_docs = [documents[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_k_indices]
        
        <span class="hljs-comment"># ç¬¬äºŒé˜¶æ®µï¼šç¥ç»é‡æ’åº</span>
        neural_scores = self.neural_reranker.rerank(query, top_k_docs)
        
        <span class="hljs-comment"># èåˆåˆ†æ•°</span>
        final_scores = []
        <span class="hljs-keyword">for</span> i, doc_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(top_k_indices):
            bm25_score = bm25_scores[doc_idx]
            neural_score = neural_scores[i]
            <span class="hljs-comment"># åŠ æƒèåˆ</span>
            final_score = <span class="hljs-number">0.3</span> * bm25_score + <span class="hljs-number">0.7</span> * neural_score
            final_scores.append((doc_idx, final_score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(final_scores, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-17">2.4.2 Multi-Stage Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤šé˜¶æ®µé‡æ’åº</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiStageRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, stages</span>):
        self.stages = stages  <span class="hljs-comment"># å¤šä¸ªé‡æ’åºæ¨¡å‹</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        current_docs = documents
        current_scores = [<span class="hljs-number">1.0</span>] * <span class="hljs-built_in">len</span>(documents)
        
        <span class="hljs-keyword">for</span> stage <span class="hljs-keyword">in</span> self.stages:
            <span class="hljs-comment"># æ¯ä¸ªé˜¶æ®µé‡æ–°æ’åº</span>
            stage_scores = stage.rerank(query, current_docs)
            
            <span class="hljs-comment"># æ›´æ–°åˆ†æ•°</span>
            current_scores = [s1 * s2 <span class="hljs-keyword">for</span> s1, s2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(current_scores, stage_scores)]
            
            <span class="hljs-comment"># é€‰æ‹©Top-Kè¿›å…¥ä¸‹ä¸€é˜¶æ®µ</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_docs) &gt; <span class="hljs-number">10</span>:
                top_indices = np.argsort(current_scores)[-<span class="hljs-number">10</span>:]
                current_docs = [current_docs[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                current_scores = [current_scores[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(current_docs, current_scores))
</code></pre>
<hr/>
<h2 data-id="heading-18">ä¸‰ã€ä¸»æµRerankæ¨¡å‹å¯¹æ¯”</h2>
<h3 data-id="heading-19">3.1 æ¨¡å‹æ€§èƒ½å¯¹æ¯”</h3>





















































<table><thead><tr><th>æ¨¡å‹</th><th>ç²¾åº¦</th><th>é€Ÿåº¦</th><th>å†…å­˜å ç”¨</th><th>é€‚ç”¨åœºæ™¯</th><th>å¼€æºçŠ¶æ€</th></tr></thead><tbody><tr><td><strong>Cross-Encoder</strong></td><td>â­â­â­â­â­</td><td>â­â­</td><td>â­â­â­</td><td>é«˜ç²¾åº¦æ£€ç´¢</td><td>âœ…</td></tr><tr><td><strong>ColBERT</strong></td><td>â­â­â­â­</td><td>â­â­â­â­</td><td>â­â­</td><td>å¤§è§„æ¨¡æ£€ç´¢</td><td>âœ…</td></tr><tr><td><strong>RAG-Fusion</strong></td><td>â­â­â­â­â­</td><td>â­â­</td><td>â­â­â­</td><td>å¤æ‚æŸ¥è¯¢</td><td>âœ…</td></tr><tr><td><strong>BM25+Neural</strong></td><td>â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­</td><td>æ··åˆæ£€ç´¢</td><td>âœ…</td></tr><tr><td><strong>Multi-Stage</strong></td><td>â­â­â­â­â­</td><td>â­â­</td><td>â­â­</td><td>è¶…é«˜ç²¾åº¦</td><td>âœ…</td></tr></tbody></table>
<h3 data-id="heading-20">3.2 è¯¦ç»†æ¨¡å‹åˆ†æ</h3>
<h4 data-id="heading-21">3.2.1 Cross-Encoderæ¨¡å‹</h4>
<p><strong>æ¨èæ¨¡å‹ï¼š</strong></p>
<ul>
<li><code>cross-encoder/ms-marco-MiniLM-L-6-v2</code></li>
<li><code>cross-encoder/ms-marco-MiniLM-L-12-v2</code></li>
<li><code>cross-encoder/nli-deberta-v3-base</code></li>
</ul>
<p><strong>æ€§èƒ½ç‰¹ç‚¹ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ€§èƒ½æµ‹è¯•</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_cross_encoder</span>():
    model = CrossEncoder(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    
    <span class="hljs-comment"># æµ‹è¯•æ•°æ®</span>
    queries = [<span class="hljs-string">"æœºå™¨å­¦ä¹ ç®—æ³•"</span>, <span class="hljs-string">"æ·±åº¦å­¦ä¹ åº”ç”¨"</span>, <span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†"</span>]
    documents = [<span class="hljs-string">"æ–‡æ¡£1"</span>, <span class="hljs-string">"æ–‡æ¡£2"</span>, <span class="hljs-string">"æ–‡æ¡£3"</span>, <span class="hljs-string">"æ–‡æ¡£4"</span>, <span class="hljs-string">"æ–‡æ¡£5"</span>]
    
    start_time = time.time()
    scores = model.rerank(queries[<span class="hljs-number">0</span>], documents)
    end_time = time.time()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤„ç†æ—¶é—´: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¹³å‡æ¯æ–‡æ¡£: <span class="hljs-subst">{(end_time - start_time) / <span class="hljs-built_in">len</span>(documents):<span class="hljs-number">.3</span>f}</span>ç§’"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ’åºç»“æœ: <span class="hljs-subst">{scores}</span>"</span>)
</code></pre>
<h4 data-id="heading-22">3.2.2 ColBERTæ¨¡å‹</h4>
<p><strong>æ¨èæ¨¡å‹ï¼š</strong></p>
<ul>
<li><code>colbert-ir/colbertv2.0</code></li>
<li><code>colbert-ir/colbertv1.0</code></li>
</ul>
<p><strong>æ€§èƒ½ç‰¹ç‚¹ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ColBERTæ€§èƒ½æµ‹è¯•</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_colbert</span>():
    model = ColBERT(<span class="hljs-string">'colbert-ir/colbertv2.0'</span>)
    
    <span class="hljs-comment"># é¢„è®¡ç®—æ–‡æ¡£åµŒå…¥</span>
    documents = [<span class="hljs-string">"æ–‡æ¡£1"</span>, <span class="hljs-string">"æ–‡æ¡£2"</span>, <span class="hljs-string">"æ–‡æ¡£3"</span>, <span class="hljs-string">"æ–‡æ¡£4"</span>, <span class="hljs-string">"æ–‡æ¡£5"</span>]
    doc_embeddings = model.encode_documents(documents)
    
    <span class="hljs-comment"># æŸ¥è¯¢ç¼–ç å’Œé‡æ’åº</span>
    query = <span class="hljs-string">"æœºå™¨å­¦ä¹ ç®—æ³•"</span>
    query_embedding = model.encode_query(query)
    
    start_time = time.time()
    scores = model.rerank(query_embedding, doc_embeddings)
    end_time = time.time()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é‡æ’åºæ—¶é—´: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ’åºç»“æœ: <span class="hljs-subst">{scores}</span>"</span>)
</code></pre>
<h4 data-id="heading-23">3.2.3 è‡ªå®šä¹‰Rerankæ¨¡å‹</h4>
<p><strong>è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è®­ç»ƒè‡ªå®šä¹‰Cross-Encoder</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomCrossEncoderTrainer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name, num_labels=<span class="hljs-number">2</span></span>):
        self.model = AutoModelForSequenceClassification.from_pretrained(
            model_name, num_labels=num_labels
        )
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_dataset</span>(<span class="hljs-params">self, data</span>):
        <span class="hljs-comment"># å‡†å¤‡è®­ç»ƒæ•°æ®</span>
        dataset = []
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> data:
            query = item[<span class="hljs-string">'query'</span>]
            doc = item[<span class="hljs-string">'document'</span>]
            label = item[<span class="hljs-string">'label'</span>]  <span class="hljs-comment"># 0: ä¸ç›¸å…³, 1: ç›¸å…³</span>
            
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>,
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            dataset.append({
                <span class="hljs-string">'input_ids'</span>: inputs[<span class="hljs-string">'input_ids'</span>],
                <span class="hljs-string">'attention_mask'</span>: inputs[<span class="hljs-string">'attention_mask'</span>],
                <span class="hljs-string">'labels'</span>: torch.tensor([label])
            })
        
        <span class="hljs-keyword">return</span> dataset
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self, train_dataset, val_dataset, epochs=<span class="hljs-number">3</span></span>):
        <span class="hljs-comment"># è®­ç»ƒæ¨¡å‹</span>
        training_args = TrainingArguments(
            output_dir=<span class="hljs-string">'./rerank_model'</span>,
            num_train_epochs=epochs,
            per_device_train_batch_size=<span class="hljs-number">16</span>,
            per_device_eval_batch_size=<span class="hljs-number">16</span>,
            warmup_steps=<span class="hljs-number">500</span>,
            weight_decay=<span class="hljs-number">0.01</span>,
            logging_dir=<span class="hljs-string">'./logs'</span>,
        )
        
        trainer = Trainer(
            model=self.model,
            args=training_args,
            train_dataset=train_dataset,
            eval_dataset=val_dataset,
        )
        
        trainer.train()
        <span class="hljs-keyword">return</span> trainer
</code></pre>
<hr/>
<h2 data-id="heading-24">å››ã€Rerankåœ¨RAGä¸­çš„åº”ç”¨</h2>
<h3 data-id="heading-25">4.1 RAGç³»ç»Ÿæ¶æ„</h3>
<h4 data-id="heading-26">4.1.1 ä¼ ç»ŸRAGæ¶æ„</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ ç»ŸRAGç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TraditionalRAG</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model, llm_model</span>):
        self.embedding_model = embedding_model
        self.llm_model = llm_model
        self.vector_store = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-comment"># å‘é‡æ£€ç´¢</span>
        query_embedding = self.embedding_model.encode(query)
        results = self.vector_store.similarity_search(
            query_embedding, k=top_k
        )
        <span class="hljs-keyword">return</span> results
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">self, query, retrieved_docs</span>):
        <span class="hljs-comment"># ç”Ÿæˆå›ç­”</span>
        context = <span class="hljs-string">"\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> retrieved_docs])
        prompt = <span class="hljs-string">f"åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š\n<span class="hljs-subst">{context}</span>\n\né—®é¢˜ï¼š<span class="hljs-subst">{query}</span>"</span>
        
        response = self.llm_model.generate(prompt)
        <span class="hljs-keyword">return</span> response
</code></pre>
<h4 data-id="heading-27">4.1.2 Rerankå¢å¼ºçš„RAGæ¶æ„</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Rerankå¢å¼ºçš„RAGç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RerankEnhancedRAG</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model, llm_model, rerank_model</span>):
        self.embedding_model = embedding_model
        self.llm_model = llm_model
        self.rerank_model = rerank_model
        self.vector_store = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_and_rerank</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-comment"># ç¬¬ä¸€é˜¶æ®µï¼šå‘é‡æ£€ç´¢ï¼ˆè·å–æ›´å¤šå€™é€‰ï¼‰</span>
        query_embedding = self.embedding_model.encode(query)
        candidates = self.vector_store.similarity_search(
            query_embedding, k=top_k
        )
        
        <span class="hljs-comment"># ç¬¬äºŒé˜¶æ®µï¼šReranké‡æ’åº</span>
        documents = [doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> candidates]
        scores = self.rerank_model.rerank(query, documents)
        
        <span class="hljs-comment"># é€‰æ‹©Top-Kç»“æœ</span>
        ranked_results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(candidates, scores))
        ranked_results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">return</span> ranked_results[:final_k]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">self, query, ranked_docs</span>):
        <span class="hljs-comment"># ä½¿ç”¨é‡æ’åºåçš„æ–‡æ¡£ç”Ÿæˆå›ç­”</span>
        context = <span class="hljs-string">"\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> ranked_docs])
        prompt = <span class="hljs-string">f"åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š\n<span class="hljs-subst">{context}</span>\n\né—®é¢˜ï¼š<span class="hljs-subst">{query}</span>"</span>
        
        response = self.llm_model.generate(prompt)
        <span class="hljs-keyword">return</span> response
</code></pre>
<h3 data-id="heading-28">4.2 Rerankç­–ç•¥é€‰æ‹©</h3>
<h4 data-id="heading-29">4.2.1 åŸºäºæŸ¥è¯¢å¤æ‚åº¦çš„ç­–ç•¥</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªé€‚åº”Rerankç­–ç•¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveRerankStrategy</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, simple_reranker, complex_reranker</span>):
        self.simple_reranker = simple_reranker
        self.complex_reranker = complex_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_query_complexity</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-comment"># åˆ†ææŸ¥è¯¢å¤æ‚åº¦</span>
        complexity_score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># é•¿åº¦å› å­</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">10</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># å…³é”®è¯æ•°é‡</span>
        technical_terms = [<span class="hljs-string">'ç®—æ³•'</span>, <span class="hljs-string">'æ¨¡å‹'</span>, <span class="hljs-string">'ä¼˜åŒ–'</span>, <span class="hljs-string">'æ€§èƒ½'</span>, <span class="hljs-string">'æ¶æ„'</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> technical_terms <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> query) &gt; <span class="hljs-number">2</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># é—®å¥ç±»å‹</span>
        <span class="hljs-keyword">if</span> query.endswith(<span class="hljs-string">'?'</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">5</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-keyword">return</span> complexity_score
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_reranker</span>(<span class="hljs-params">self, query</span>):
        complexity = self.analyze_query_complexity(query)
        
        <span class="hljs-keyword">if</span> complexity &lt;= <span class="hljs-number">1</span>:
            <span class="hljs-keyword">return</span> self.simple_reranker
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self.complex_reranker
</code></pre>
<h4 data-id="heading-30">4.2.2 åŸºäºæ–‡æ¡£ç±»å‹çš„ç­–ç•¥</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–‡æ¡£ç±»å‹æ„ŸçŸ¥çš„Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentTypeAwareRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, code_reranker, text_reranker, table_reranker</span>):
        self.code_reranker = code_reranker
        self.text_reranker = text_reranker
        self.table_reranker = table_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_document_type</span>(<span class="hljs-params">self, document</span>):
        <span class="hljs-comment"># æ£€æµ‹æ–‡æ¡£ç±»å‹</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'```'</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">or</span> <span class="hljs-string">'def '</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">or</span> <span class="hljs-string">'class '</span> <span class="hljs-keyword">in</span> document:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'code'</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">'|'</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">and</span> <span class="hljs-string">'\n'</span> <span class="hljs-keyword">in</span> document:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'table'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'text'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_by_type</span>(<span class="hljs-params">self, query, documents</span>):
        results = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc_type = self.detect_document_type(doc)
            
            <span class="hljs-keyword">if</span> doc_type == <span class="hljs-string">'code'</span>:
                score = self.code_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">elif</span> doc_type == <span class="hljs-string">'table'</span>:
                score = self.table_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">else</span>:
                score = self.text_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            
            results.append((doc, score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-31">4.3 å¤šæ¨¡æ€Rerank</h3>
<h4 data-id="heading-32">4.3.1 æ–‡æœ¬+å›¾åƒRerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤šæ¨¡æ€Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, text_reranker, image_reranker, fusion_weight=<span class="hljs-number">0.7</span></span>):
        self.text_reranker = text_reranker
        self.image_reranker = image_reranker
        self.fusion_weight = fusion_weight
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_multimodal</span>(<span class="hljs-params">self, query, documents</span>):
        results = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            <span class="hljs-comment"># æ–‡æœ¬é‡æ’åº</span>
            text_score = self.text_reranker.rerank(query, [doc.text])[<span class="hljs-number">0</span>]
            
            <span class="hljs-comment"># å›¾åƒé‡æ’åºï¼ˆå¦‚æœæœ‰å›¾åƒï¼‰</span>
            image_score = <span class="hljs-number">0</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(doc, <span class="hljs-string">'image'</span>) <span class="hljs-keyword">and</span> doc.image:
                image_score = self.image_reranker.rerank(query, [doc.image])[<span class="hljs-number">0</span>]
            
            <span class="hljs-comment"># èåˆåˆ†æ•°</span>
            <span class="hljs-keyword">if</span> image_score &gt; <span class="hljs-number">0</span>:
                final_score = (self.fusion_weight * text_score + 
                             (<span class="hljs-number">1</span> - self.fusion_weight) * image_score)
            <span class="hljs-keyword">else</span>:
                final_score = text_score
            
            results.append((doc, final_score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<hr/>
<h2 data-id="heading-33">äº”ã€Pythonå®æˆ˜ï¼šæ„å»ºRerankç³»ç»Ÿ</h2>
<h3 data-id="heading-34">5.1 åŸºç¡€Rerankå®ç°</h3>
<h4 data-id="heading-35">5.1.1 Cross-Encoderå®ç°</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification
<span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> CrossEncoder
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleCrossEncoderRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name=<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span></span>):
        self.model = CrossEncoder(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        å¯¹æ–‡æ¡£è¿›è¡Œé‡æ’åº
        
        Args:
            query: æŸ¥è¯¢æ–‡æœ¬
            documents: æ–‡æ¡£åˆ—è¡¨
            top_k: è¿”å›å‰kä¸ªç»“æœï¼ŒNoneè¡¨ç¤ºè¿”å›å…¨éƒ¨
        
        Returns:
            æ’åºåçš„(æ–‡æ¡£, åˆ†æ•°)åˆ—è¡¨
        """</span>
        <span class="hljs-comment"># è®¡ç®—ç›¸å…³æ€§åˆ†æ•°</span>
        pairs = [(query, doc) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents]
        scores = self.model.predict(pairs)
        
        <span class="hljs-comment"># æ’åº</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_cross_encoder</span>():
    reranker = SimpleCrossEncoderRerank()
    
    query = <span class="hljs-string">"å¦‚ä½•ä¼˜åŒ–Pythonä»£ç æ€§èƒ½"</span>
    documents = [
        <span class="hljs-string">"Pythonæ€§èƒ½ä¼˜åŒ–æŠ€å·§åŒ…æ‹¬ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼ã€é¿å…å…¨å±€å˜é‡ç­‰"</span>,
        <span class="hljs-string">"æœºå™¨å­¦ä¹ ç®—æ³•åœ¨æ•°æ®ç§‘å­¦ä¸­çš„åº”ç”¨"</span>,
        <span class="hljs-string">"Pythonä»£ç ä¼˜åŒ–ï¼šä½¿ç”¨numpyå’Œpandasæå‡è®¡ç®—æ•ˆç‡"</span>,
        <span class="hljs-string">"æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒçš„æœ€ä½³å®è·µ"</span>,
        <span class="hljs-string">"Pythonå¼‚æ­¥ç¼–ç¨‹å’Œå¹¶å‘å¤„ç†"</span>
    ]
    
    results = reranker.rerank(query, documents, top_k=<span class="hljs-number">3</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é‡æ’åºç»“æœï¼š"</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. åˆ†æ•°: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   æ–‡æ¡£: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h4 data-id="heading-36">5.1.2 ColBERTå®ç°</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleColBERTRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name=<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span></span>):
        self.model = SentenceTransformer(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_query</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-string">"""ç¼–ç æŸ¥è¯¢"""</span>
        <span class="hljs-keyword">return</span> self.model.encode([query])[<span class="hljs-number">0</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-string">"""ç¼–ç æ–‡æ¡£"""</span>
        <span class="hljs-keyword">return</span> self.model.encode(documents)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        ä½¿ç”¨ColBERTé£æ ¼çš„é‡æ’åº
        """</span>
        <span class="hljs-comment"># ç¼–ç æŸ¥è¯¢å’Œæ–‡æ¡£</span>
        query_embedding = self.encode_query(query)
        doc_embeddings = self.encode_documents(documents)
        
        <span class="hljs-comment"># è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°</span>
        scores = []
        <span class="hljs-keyword">for</span> doc_embedding <span class="hljs-keyword">in</span> doc_embeddings:
            <span class="hljs-comment"># è®¡ç®—æœ€å¤§ç›¸ä¼¼åº¦ï¼ˆColBERTé£æ ¼ï¼‰</span>
            similarities = np.dot(query_embedding, doc_embedding.T)
            max_similarity = np.<span class="hljs-built_in">max</span>(similarities)
            scores.append(max_similarity)
        
        <span class="hljs-comment"># æ’åº</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_colbert</span>():
    reranker = SimpleColBERTRerank()
    
    query = <span class="hljs-string">"æœºå™¨å­¦ä¹ ç®—æ³•é€‰æ‹©"</span>
    documents = [
        <span class="hljs-string">"ç›‘ç£å­¦ä¹ ç®—æ³•åŒ…æ‹¬çº¿æ€§å›å½’ã€å†³ç­–æ ‘ã€éšæœºæ£®æ—ç­‰"</span>,
        <span class="hljs-string">"æ— ç›‘ç£å­¦ä¹ ä¸»è¦ç”¨äºèšç±»å’Œé™ç»´"</span>,
        <span class="hljs-string">"æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯"</span>,
        <span class="hljs-string">"å¼ºåŒ–å­¦ä¹ é€šè¿‡ä¸ç¯å¢ƒäº¤äº’å­¦ä¹ æœ€ä¼˜ç­–ç•¥"</span>
    ]
    
    results = reranker.rerank(query, documents, top_k=<span class="hljs-number">2</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ColBERTé‡æ’åºç»“æœï¼š"</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. åˆ†æ•°: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   æ–‡æ¡£: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h3 data-id="heading-37">5.2 é«˜çº§Rerankå®ç°</h3>
<h4 data-id="heading-38">5.2.1 å¤šé˜¶æ®µRerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiStageRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, stages</span>):
        <span class="hljs-string">"""
        å¤šé˜¶æ®µé‡æ’åº
        
        Args:
            stages: é‡æ’åºé˜¶æ®µåˆ—è¡¨ï¼Œæ¯ä¸ªé˜¶æ®µæ˜¯ä¸€ä¸ªreranker
        """</span>
        self.stages = stages
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        å¤šé˜¶æ®µé‡æ’åº
        """</span>
        current_docs = documents
        current_scores = [<span class="hljs-number">1.0</span>] * <span class="hljs-built_in">len</span>(documents)
        
        <span class="hljs-keyword">for</span> stage_idx, stage <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.stages):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰§è¡Œç¬¬<span class="hljs-subst">{stage_idx + <span class="hljs-number">1</span>}</span>é˜¶æ®µé‡æ’åº..."</span>)
            
            <span class="hljs-comment"># å½“å‰é˜¶æ®µé‡æ’åº</span>
            stage_scores = []
            <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> current_docs:
                score = stage.rerank(query, [doc])[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
                stage_scores.append(score)
            
            <span class="hljs-comment"># æ›´æ–°ç´¯ç§¯åˆ†æ•°</span>
            current_scores = [s1 * s2 <span class="hljs-keyword">for</span> s1, s2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(current_scores, stage_scores)]
            
            <span class="hljs-comment"># é€‰æ‹©Top-Kè¿›å…¥ä¸‹ä¸€é˜¶æ®µ</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_docs) &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> stage_idx &lt; <span class="hljs-built_in">len</span>(self.stages) - <span class="hljs-number">1</span>:
                top_indices = np.argsort(current_scores)[-<span class="hljs-number">10</span>:]
                current_docs = [current_docs[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                current_scores = [current_scores[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¬¬<span class="hljs-subst">{stage_idx + <span class="hljs-number">1</span>}</span>é˜¶æ®µåä¿ç•™Top-10"</span>)
        
        <span class="hljs-comment"># æœ€ç»ˆæ’åº</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(current_docs, current_scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_multi_stage</span>():
    <span class="hljs-comment"># åˆ›å»ºå¤šä¸ªé‡æ’åºé˜¶æ®µ</span>
    stage1 = SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    stage2 = SimpleColBERTRerank(<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>)
    
    multi_rerank = MultiStageRerank([stage1, stage2])
    
    query = <span class="hljs-string">"Pythonå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ"</span>
    documents = [
        <span class="hljs-string">"Python asyncioåº“æä¾›äº†å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€è®¾æ–½"</span>,
        <span class="hljs-string">"å¼‚æ­¥ç¼–ç¨‹å¯ä»¥æé«˜I/Oå¯†é›†å‹åº”ç”¨çš„æ€§èƒ½"</span>,
        <span class="hljs-string">"æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒéœ€è¦å¤§é‡è®¡ç®—èµ„æº"</span>,
        <span class="hljs-string">"ä½¿ç”¨async/awaitè¯­æ³•å¯ä»¥ç®€åŒ–å¼‚æ­¥ä»£ç "</span>,
        <span class="hljs-string">"å¼‚æ­¥ç¼–ç¨‹åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ç‰¹åˆ«æœ‰ç”¨"</span>
    ]
    
    results = multi_rerank.rerank(query, documents, top_k=<span class="hljs-number">3</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤šé˜¶æ®µé‡æ’åºç»“æœï¼š"</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. åˆ†æ•°: <span class="hljs-subst">{score:<span class="hljs-number">.6</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   æ–‡æ¡£: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h4 data-id="heading-39">5.2.2 è‡ªé€‚åº”Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, rerankers</span>):
        <span class="hljs-string">"""
        è‡ªé€‚åº”é‡æ’åº
        
        Args:
            rerankers: é‡æ’åºå™¨å­—å…¸ï¼Œkeyä¸ºæ¡ä»¶ï¼Œvalueä¸ºreranker
        """</span>
        self.rerankers = rerankers
        self.default_reranker = <span class="hljs-built_in">list</span>(rerankers.values())[<span class="hljs-number">0</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_reranker</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        æ ¹æ®æŸ¥è¯¢å’Œæ–‡æ¡£ç‰¹å¾é€‰æ‹©é‡æ’åºå™¨
        """</span>
        <span class="hljs-comment"># æŸ¥è¯¢é•¿åº¦</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">15</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'long_query'</span>, self.default_reranker)
        
        <span class="hljs-comment"># æ–‡æ¡£æ•°é‡</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(documents) &gt; <span class="hljs-number">50</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'large_docs'</span>, self.default_reranker)
        
        <span class="hljs-comment"># æŠ€æœ¯æœ¯è¯­</span>
        tech_terms = [<span class="hljs-string">'ç®—æ³•'</span>, <span class="hljs-string">'æ¨¡å‹'</span>, <span class="hljs-string">'ä¼˜åŒ–'</span>, <span class="hljs-string">'æ€§èƒ½'</span>, <span class="hljs-string">'æ¶æ„'</span>, <span class="hljs-string">'ç³»ç»Ÿ'</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> tech_terms <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> query) &gt; <span class="hljs-number">2</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'technical'</span>, self.default_reranker)
        
        <span class="hljs-keyword">return</span> self.default_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        è‡ªé€‚åº”é‡æ’åº
        """</span>
        <span class="hljs-comment"># é€‰æ‹©é‡æ’åºå™¨</span>
        selected_reranker = self.select_reranker(query, documents)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é€‰æ‹©é‡æ’åºå™¨: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(selected_reranker).__name__}</span>"</span>)
        
        <span class="hljs-comment"># æ‰§è¡Œé‡æ’åº</span>
        <span class="hljs-keyword">return</span> selected_reranker.rerank(query, documents, top_k)

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_adaptive</span>():
    <span class="hljs-comment"># åˆ›å»ºä¸åŒçš„é‡æ’åºå™¨</span>
    rerankers = {
        <span class="hljs-string">'long_query'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-12-v2'</span>),
        <span class="hljs-string">'large_docs'</span>: SimpleColBERTRerank(<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>),
        <span class="hljs-string">'technical'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/nli-deberta-v3-base'</span>),
        <span class="hljs-string">'default'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    }
    
    adaptive_rerank = AdaptiveRerank(rerankers)
    
    <span class="hljs-comment"># æµ‹è¯•ä¸åŒåœºæ™¯</span>
    test_cases = [
        {
            <span class="hljs-string">'query'</span>: <span class="hljs-string">'å¦‚ä½•ä¼˜åŒ–æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒé€Ÿåº¦å’Œå‡†ç¡®æ€§'</span>,
            <span class="hljs-string">'docs'</span>: [<span class="hljs-string">'æ·±åº¦å­¦ä¹ ä¼˜åŒ–æŠ€å·§'</span>, <span class="hljs-string">'æ¨¡å‹è®­ç»ƒæœ€ä½³å®è·µ'</span>, <span class="hljs-string">'æ€§èƒ½è°ƒä¼˜æ–¹æ³•'</span>]
        },
        {
            <span class="hljs-string">'query'</span>: <span class="hljs-string">'Python'</span>,
            <span class="hljs-string">'docs'</span>: [<span class="hljs-string">'PythonåŸºç¡€è¯­æ³•'</span>, <span class="hljs-string">'Pythoné«˜çº§ç‰¹æ€§'</span>, <span class="hljs-string">'Pythonåº”ç”¨å¼€å‘'</span>] * <span class="hljs-number">20</span>
        }
    ]
    
    <span class="hljs-keyword">for</span> i, <span class="hljs-keyword">case</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_cases, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\næµ‹è¯•æ¡ˆä¾‹ <span class="hljs-subst">{i}</span>:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŸ¥è¯¢: <span class="hljs-subst">{<span class="hljs-keyword">case</span>[<span class="hljs-string">'query'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡æ¡£æ•°é‡: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(<span class="hljs-keyword">case</span>[<span class="hljs-string">'docs'</span>])}</span>"</span>)
        
        results = adaptive_rerank.rerank(<span class="hljs-keyword">case</span>[<span class="hljs-string">'query'</span>], <span class="hljs-keyword">case</span>[<span class="hljs-string">'docs'</span>], top_k=<span class="hljs-number">3</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"é‡æ’åºç»“æœï¼š"</span>)
        <span class="hljs-keyword">for</span> j, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{j}</span>. åˆ†æ•°: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span> - <span class="hljs-subst">{doc}</span>"</span>)
</code></pre>
<h3 data-id="heading-40">5.3 å®Œæ•´RAGç³»ç»Ÿé›†æˆ</h3>
<h4 data-id="heading-41">5.3.1 RAG with Rerankç³»ç»Ÿ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
<span class="hljs-keyword">import</span> faiss
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGWithRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model_name, rerank_model_name, llm_model=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># åˆå§‹åŒ–ç»„ä»¶</span>
        self.embedding_model = SentenceTransformer(embedding_model_name)
        self.reranker = SimpleCrossEncoderRerank(rerank_model_name)
        self.llm_model = llm_model
        
        <span class="hljs-comment"># å‘é‡å­˜å‚¨</span>
        self.vector_store = <span class="hljs-literal">None</span>
        self.documents = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-string">"""
        æ·»åŠ æ–‡æ¡£åˆ°å‘é‡å­˜å‚¨
        """</span>
        self.documents.extend(documents)
        
        <span class="hljs-comment"># ç”ŸæˆåµŒå…¥</span>
        embeddings = self.embedding_model.encode(documents)
        
        <span class="hljs-comment"># åˆ›å»ºFAISSç´¢å¼•</span>
        dimension = embeddings.shape[<span class="hljs-number">1</span>]
        index = faiss.IndexFlatIP(dimension)  <span class="hljs-comment"># å†…ç§¯ç´¢å¼•</span>
        
        <span class="hljs-comment"># å½’ä¸€åŒ–åµŒå…¥ï¼ˆç”¨äºä½™å¼¦ç›¸ä¼¼åº¦ï¼‰</span>
        faiss.normalize_L2(embeddings)
        index.add(embeddings)
        
        self.vector_store = index
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_and_rerank</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-string">"""
        æ£€ç´¢å’Œé‡æ’åº
        """</span>
        <span class="hljs-comment"># ç¬¬ä¸€é˜¶æ®µï¼šå‘é‡æ£€ç´¢</span>
        query_embedding = self.embedding_model.encode([query])
        faiss.normalize_L2(query_embedding)
        
        scores, indices = self.vector_store.search(query_embedding, top_k)
        
        <span class="hljs-comment"># è·å–å€™é€‰æ–‡æ¡£</span>
        candidates = [self.documents[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]
        
        <span class="hljs-comment"># ç¬¬äºŒé˜¶æ®µï¼šé‡æ’åº</span>
        rerank_results = self.reranker.rerank(query, candidates, top_k=final_k)
        
        <span class="hljs-keyword">return</span> rerank_results
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_answer</span>(<span class="hljs-params">self, query, retrieved_docs</span>):
        <span class="hljs-string">"""
        ç”Ÿæˆå›ç­”
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.llm_model:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"LLMæ¨¡å‹æœªé…ç½®"</span>
        
        <span class="hljs-comment"># æ„å»ºä¸Šä¸‹æ–‡</span>
        context = <span class="hljs-string">"\n"</span>.join([doc <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> retrieved_docs])
        
        <span class="hljs-comment"># ç”Ÿæˆå›ç­”</span>
        prompt = <span class="hljs-string">f"""
        åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š
        
        ä¸Šä¸‹æ–‡ï¼š
        <span class="hljs-subst">{context}</span>
        
        é—®é¢˜ï¼š<span class="hljs-subst">{query}</span>
        
        è¯·æä¾›å‡†ç¡®ã€ç®€æ´çš„å›ç­”ï¼š
        """</span>
        
        <span class="hljs-comment"># è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„LLM</span>
        <span class="hljs-comment"># response = self.llm_model.generate(prompt)</span>
        response = <span class="hljs-string">f"åŸºäºæ£€ç´¢åˆ°çš„<span class="hljs-subst">{<span class="hljs-built_in">len</span>(retrieved_docs)}</span>ä¸ªç›¸å…³æ–‡æ¡£ï¼Œå›ç­”ï¼š<span class="hljs-subst">{query}</span>"</span>
        
        <span class="hljs-keyword">return</span> response
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-string">"""
        å®Œæ•´çš„æŸ¥è¯¢æµç¨‹
        """</span>
        <span class="hljs-comment"># æ£€ç´¢å’Œé‡æ’åº</span>
        retrieved_docs = self.retrieve_and_rerank(query, top_k, final_k)
        
        <span class="hljs-comment"># ç”Ÿæˆå›ç­”</span>
        answer = self.generate_answer(query, retrieved_docs)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'answer'</span>: answer,
            <span class="hljs-string">'retrieved_docs'</span>: retrieved_docs,
            <span class="hljs-string">'query'</span>: query
        }

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_rag_with_rerank</span>():
    <span class="hljs-comment"># åˆå§‹åŒ–RAGç³»ç»Ÿ</span>
    rag = RAGWithRerank(
        embedding_model_name=<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>,
        rerank_model_name=<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>
    )
    
    <span class="hljs-comment"># æ·»åŠ æ–‡æ¡£</span>
    documents = [
        <span class="hljs-string">"Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œå…·æœ‰ç®€æ´çš„è¯­æ³•å’Œå¼ºå¤§çš„åŠŸèƒ½"</span>,
        <span class="hljs-string">"æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œé€šè¿‡ç®—æ³•è®©è®¡ç®—æœºå­¦ä¹ "</span>,
        <span class="hljs-string">"æ·±åº¦å­¦ä¹ ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººè„‘çš„å­¦ä¹ è¿‡ç¨‹"</span>,
        <span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯è®¡ç®—æœºç§‘å­¦å’Œäººå·¥æ™ºèƒ½çš„äº¤å‰é¢†åŸŸ"</span>,
        <span class="hljs-string">"è®¡ç®—æœºè§†è§‰è®©è®¡ç®—æœºèƒ½å¤Ÿç†è§£å’Œåˆ†æå›¾åƒå’Œè§†é¢‘"</span>,
        <span class="hljs-string">"æ•°æ®ç§‘å­¦ç»“åˆç»Ÿè®¡å­¦ã€è®¡ç®—æœºç§‘å­¦å’Œé¢†åŸŸä¸“ä¸šçŸ¥è¯†"</span>,
        <span class="hljs-string">"äº‘è®¡ç®—æä¾›äº†æŒ‰éœ€è®¿é—®è®¡ç®—èµ„æºçš„æœåŠ¡æ¨¡å¼"</span>,
        <span class="hljs-string">"åŒºå—é“¾æ˜¯ä¸€ç§åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼Œå…·æœ‰å»ä¸­å¿ƒåŒ–ç‰¹ç‚¹"</span>
    ]
    
    rag.add_documents(documents)
    
    <span class="hljs-comment"># æŸ¥è¯¢</span>
    query = <span class="hljs-string">"ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ "</span>
    result = rag.query(query)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŸ¥è¯¢: <span class="hljs-subst">{result[<span class="hljs-string">'query'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å›ç­”: <span class="hljs-subst">{result[<span class="hljs-string">'answer'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£:"</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(result[<span class="hljs-string">'retrieved_docs'</span>], <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. åˆ†æ•°: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   æ–‡æ¡£: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<hr/>
<h2 data-id="heading-42">å…­ã€æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-43">6.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-44">6.1.1 è®¡ç®—ä¼˜åŒ–</h4>
<p><strong>æ‰¹å¤„ç†ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name, batch_size=<span class="hljs-number">32</span></span>):
        self.model = CrossEncoder(model_name)
        self.batch_size = batch_size
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_batch</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        æ‰¹é‡é‡æ’åºä¼˜åŒ–
        """</span>
        results = []
        
        <span class="hljs-comment"># åˆ†æ‰¹å¤„ç†</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(documents), self.batch_size):
            batch_docs = documents[i:i + self.batch_size]
            batch_pairs = [(query, doc) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> batch_docs]
            
            <span class="hljs-comment"># æ‰¹é‡é¢„æµ‹</span>
            batch_scores = self.model.predict(batch_pairs)
            
            <span class="hljs-comment"># æ·»åŠ ç»“æœ</span>
            <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(batch_docs, batch_scores):
                results.append((doc, score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>ç¼“å­˜ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker, cache_size=<span class="hljs-number">1000</span></span>):
        self.reranker = reranker
        self.cache_size = cache_size
        self.cache = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_cache_key</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""ç”Ÿæˆç¼“å­˜é”®"""</span>
        content = <span class="hljs-string">f"<span class="hljs-subst">{query}</span>|||<span class="hljs-subst">{hashlib.md5(<span class="hljs-built_in">str</span>(documents).encode()).hexdigest()}</span>"</span>
        <span class="hljs-keyword">return</span> hashlib.md5(content.encode()).hexdigest()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        å¸¦ç¼“å­˜çš„é‡æ’åº
        """</span>
        cache_key = self._get_cache_key(query, documents)
        
        <span class="hljs-comment"># æ£€æŸ¥ç¼“å­˜</span>
        <span class="hljs-keyword">if</span> cache_key <span class="hljs-keyword">in</span> self.cache:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ä½¿ç”¨ç¼“å­˜ç»“æœ"</span>)
            <span class="hljs-keyword">return</span> self.cache[cache_key]
        
        <span class="hljs-comment"># æ‰§è¡Œé‡æ’åº</span>
        results = self.reranker.rerank(query, documents)
        
        <span class="hljs-comment"># æ›´æ–°ç¼“å­˜</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.cache) &lt; self.cache_size:
            self.cache[cache_key] = results
        
        <span class="hljs-keyword">return</span> results
</code></pre>
<h4 data-id="heading-45">6.1.2 å†…å­˜ä¼˜åŒ–</h4>
<p><strong>æ¨¡å‹é‡åŒ–ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification

<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantizedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        
        <span class="hljs-comment"># é‡åŒ–æ¨¡å‹</span>
        self.model = torch.quantization.quantize_dynamic(
            self.model, {torch.nn.Linear}, dtype=torch.qint8
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        ä½¿ç”¨é‡åŒ–æ¨¡å‹é‡æ’åº
        """</span>
        scores = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>,
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            
            <span class="hljs-keyword">with</span> torch.no_grad():
                outputs = self.model(**inputs)
                score = torch.sigmoid(outputs.logits).item()
                scores.append(score)
        
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-46">6.2 æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-47">6.2.1 æ¨¡å‹é€‰æ‹©ç­–ç•¥</h4>
<p><strong>åŸºäºæ•°æ®é‡çš„é€‰æ‹©ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">select_rerank_model</span>(<span class="hljs-params">data_size, latency_requirement</span>):
    <span class="hljs-string">"""
    æ ¹æ®æ•°æ®é‡å’Œå»¶è¿Ÿè¦æ±‚é€‰æ‹©é‡æ’åºæ¨¡å‹
    """</span>
    <span class="hljs-keyword">if</span> data_size &lt; <span class="hljs-number">1000</span> <span class="hljs-keyword">and</span> latency_requirement &lt; <span class="hljs-number">100</span>:  <span class="hljs-comment"># ms</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>
    <span class="hljs-keyword">elif</span> data_size &lt; <span class="hljs-number">10000</span> <span class="hljs-keyword">and</span> latency_requirement &lt; <span class="hljs-number">500</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-12-v2"</span>
    <span class="hljs-keyword">elif</span> data_size &gt;= <span class="hljs-number">10000</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"colbert-ir/colbertv2.0"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/nli-deberta-v3-base"</span>
</code></pre>
<p><strong>åŸºäºæŸ¥è¯¢ç±»å‹çš„é€‰æ‹©ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">select_rerank_by_query_type</span>(<span class="hljs-params">query</span>):
    <span class="hljs-string">"""
    æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©é‡æ’åºæ¨¡å‹
    """</span>
    <span class="hljs-comment"># æŠ€æœ¯æŸ¥è¯¢</span>
    tech_keywords = [<span class="hljs-string">'ç®—æ³•'</span>, <span class="hljs-string">'æ¨¡å‹'</span>, <span class="hljs-string">'ä¼˜åŒ–'</span>, <span class="hljs-string">'æ€§èƒ½'</span>, <span class="hljs-string">'æ¶æ„'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> query <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> tech_keywords):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/nli-deberta-v3-base"</span>
    
    <span class="hljs-comment"># é•¿æŸ¥è¯¢</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">15</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-12-v2"</span>
    
    <span class="hljs-comment"># çŸ­æŸ¥è¯¢</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>
</code></pre>
<h4 data-id="heading-48">6.2.2 å‚æ•°è°ƒä¼˜</h4>
<p><strong>é˜ˆå€¼è°ƒä¼˜ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThresholdTuner</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker</span>):
        self.reranker = reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tune_threshold</span>(<span class="hljs-params">self, queries, documents, ground_truth</span>):
        <span class="hljs-string">"""
        è°ƒä¼˜é‡æ’åºé˜ˆå€¼
        """</span>
        best_threshold = <span class="hljs-number">0.5</span>
        best_f1 = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">for</span> threshold <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.1</span>):
            f1_scores = []
            
            <span class="hljs-keyword">for</span> query, docs, gt <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(queries, documents, ground_truth):
                <span class="hljs-comment"># é‡æ’åº</span>
                results = self.reranker.rerank(query, docs)
                
                <span class="hljs-comment"># åº”ç”¨é˜ˆå€¼</span>
                filtered_results = [(doc, score) <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> results <span class="hljs-keyword">if</span> score &gt;= threshold]
                
                <span class="hljs-comment"># è®¡ç®—F1åˆ†æ•°</span>
                predicted = <span class="hljs-built_in">set</span>([doc <span class="hljs-keyword">for</span> doc, _ <span class="hljs-keyword">in</span> filtered_results])
                actual = <span class="hljs-built_in">set</span>(gt)
                
                precision = <span class="hljs-built_in">len</span>(predicted &amp; actual) / <span class="hljs-built_in">len</span>(predicted) <span class="hljs-keyword">if</span> predicted <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                recall = <span class="hljs-built_in">len</span>(predicted &amp; actual) / <span class="hljs-built_in">len</span>(actual) <span class="hljs-keyword">if</span> actual <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                f1 = <span class="hljs-number">2</span> * precision * recall / (precision + recall) <span class="hljs-keyword">if</span> (precision + recall) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                
                f1_scores.append(f1)
            
            avg_f1 = np.mean(f1_scores)
            <span class="hljs-keyword">if</span> avg_f1 &gt; best_f1:
                best_f1 = avg_f1
                best_threshold = threshold
        
        <span class="hljs-keyword">return</span> best_threshold, best_f1
</code></pre>
<h4 data-id="heading-49">6.2.3 ç›‘æ§å’Œè¯„ä¼°</h4>
<p><strong>æ€§èƒ½ç›‘æ§ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RerankMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.metrics = defaultdict(<span class="hljs-built_in">list</span>)
        self.logger = logging.getLogger(__name__)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_rerank_performance</span>(<span class="hljs-params">self, query, documents, results, latency</span>):
        <span class="hljs-string">"""
        è®°å½•é‡æ’åºæ€§èƒ½
        """</span>
        self.metrics[<span class="hljs-string">'latency'</span>].append(latency)
        self.metrics[<span class="hljs-string">'query_length'</span>].append(<span class="hljs-built_in">len</span>(query.split()))
        self.metrics[<span class="hljs-string">'doc_count'</span>].append(<span class="hljs-built_in">len</span>(documents))
        self.metrics[<span class="hljs-string">'result_count'</span>].append(<span class="hljs-built_in">len</span>(results))
        
        <span class="hljs-comment"># è®°å½•æ—¥å¿—</span>
        self.logger.info(<span class="hljs-string">f"Rerank completed: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span> docs -&gt; <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> results, <span class="hljs-subst">{latency:<span class="hljs-number">.3</span>f}</span>s"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_performance_stats</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        è·å–æ€§èƒ½ç»Ÿè®¡
        """</span>
        stats = {}
        <span class="hljs-keyword">for</span> metric, values <span class="hljs-keyword">in</span> self.metrics.items():
            stats[metric] = {
                <span class="hljs-string">'mean'</span>: np.mean(values),
                <span class="hljs-string">'std'</span>: np.std(values),
                <span class="hljs-string">'min'</span>: np.<span class="hljs-built_in">min</span>(values),
                <span class="hljs-string">'max'</span>: np.<span class="hljs-built_in">max</span>(values),
                <span class="hljs-string">'count'</span>: <span class="hljs-built_in">len</span>(values)
            }
        <span class="hljs-keyword">return</span> stats
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_metrics</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        é‡ç½®æŒ‡æ ‡
        """</span>
        self.metrics.clear()
</code></pre>
<hr/>
<h2 data-id="heading-50">ä¸ƒã€Rerankçš„æœªæ¥å‘å±•è¶‹åŠ¿</h2>
<h3 data-id="heading-51">7.1 æŠ€æœ¯å‘å±•è¶‹åŠ¿</h3>
<h4 data-id="heading-52">7.1.1 æ¨¡å‹æ¶æ„æ¼”è¿›</h4>
<p><strong>Transformeræ¶æ„ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æœªæ¥çš„é«˜æ•ˆRerankæ¨¡å‹æ¶æ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EfficientRerankModel</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># ä½¿ç”¨æ›´é«˜æ•ˆçš„æ³¨æ„åŠ›æœºåˆ¶</span>
        self.attention = SparseAttention()
        <span class="hljs-comment"># ä½¿ç”¨çŸ¥è¯†è’¸é¦</span>
        self.student_model = DistilledModel()
        <span class="hljs-comment"># ä½¿ç”¨å¤šä»»åŠ¡å­¦ä¹ </span>
        self.multi_task_head = MultiTaskHead()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-comment"># ç¨€ç–æ³¨æ„åŠ›è®¡ç®—</span>
        query_repr = self.sparse_attention(query)
        doc_reprs = self.sparse_attention(documents)
        
        <span class="hljs-comment"># å¤šä»»åŠ¡å­¦ä¹ </span>
        scores = self.multi_task_head(query_repr, doc_reprs)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<p><strong>å¤šæ¨¡æ€Rerankï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤šæ¨¡æ€é‡æ’åº</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.text_encoder = TextEncoder()
        self.image_encoder = ImageEncoder()
        self.audio_encoder = AudioEncoder()
        self.fusion_layer = FusionLayer()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_multimodal</span>(<span class="hljs-params">self, query, multimodal_docs</span>):
        <span class="hljs-string">"""
        å¤šæ¨¡æ€é‡æ’åº
        """</span>
        query_features = self.extract_query_features(query)
        
        scores = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> multimodal_docs:
            doc_features = self.extract_doc_features(doc)
            score = self.fusion_layer(query_features, doc_features)
            scores.append(score)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-53">7.1.2 è®¡ç®—æ•ˆç‡æå‡</h4>
<p><strong>ç¡¬ä»¶åŠ é€Ÿï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># GPU/TPUåŠ é€Ÿçš„é‡æ’åº</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AcceleratedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, device=<span class="hljs-string">'cuda'</span></span>):
        self.device = device
        self.model = self.load_model().to(device)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_batch_gpu</span>(<span class="hljs-params">self, queries, documents</span>):
        <span class="hljs-string">"""
        GPUæ‰¹é‡é‡æ’åº
        """</span>
        <span class="hljs-comment"># æ‰¹é‡å¤„ç†</span>
        batch_pairs = []
        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> queries:
            <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
                batch_pairs.append((query, doc))
        
        <span class="hljs-comment"># GPUè®¡ç®—</span>
        batch_scores = self.model.predict_batch(batch_pairs)
        
        <span class="hljs-keyword">return</span> batch_scores
</code></pre>
<h3 data-id="heading-54">7.2 åº”ç”¨åœºæ™¯æ‰©å±•</h3>
<h4 data-id="heading-55">7.2.1 å®æ—¶Rerank</h4>
<p><strong>æµå¼å¤„ç†ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> asyncio <span class="hljs-keyword">import</span> Queue

<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker</span>):
        self.reranker = reranker
        self.queue = Queue()
        self.results = {}
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_stream</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        æµå¼å¤„ç†é‡æ’åºè¯·æ±‚
        """</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            request = <span class="hljs-keyword">await</span> self.queue.get()
            query_id, query, documents = request
            
            <span class="hljs-comment"># å¼‚æ­¥é‡æ’åº</span>
            results = <span class="hljs-keyword">await</span> self.async_rerank(query, documents)
            self.results[query_id] = results
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        å¼‚æ­¥é‡æ’åº
        """</span>
        <span class="hljs-comment"># åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡</span>
        loop = asyncio.get_event_loop()
        results = <span class="hljs-keyword">await</span> loop.run_in_executor(
            <span class="hljs-literal">None</span>, self.reranker.rerank, query, documents
        )
        <span class="hljs-keyword">return</span> results
</code></pre>
<h4 data-id="heading-56">7.2.2 ä¸ªæ€§åŒ–Rerank</h4>
<p><strong>ç”¨æˆ·åå¥½å­¦ä¹ ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonalizedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, base_reranker</span>):
        self.base_reranker = base_reranker
        self.user_preferences = {}
        self.preference_model = PreferenceModel()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">learn_user_preference</span>(<span class="hljs-params">self, user_id, query, documents, clicks</span>):
        <span class="hljs-string">"""
        å­¦ä¹ ç”¨æˆ·åå¥½
        """</span>
        <span class="hljs-comment"># è®°å½•ç”¨æˆ·è¡Œä¸º</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.user_preferences:
            self.user_preferences[user_id] = []
        
        self.user_preferences[user_id].append({
            <span class="hljs-string">'query'</span>: query,
            <span class="hljs-string">'documents'</span>: documents,
            <span class="hljs-string">'clicks'</span>: clicks
        })
        
        <span class="hljs-comment"># æ›´æ–°åå¥½æ¨¡å‹</span>
        self.preference_model.update(user_id, query, documents, clicks)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">personalized_rerank</span>(<span class="hljs-params">self, user_id, query, documents</span>):
        <span class="hljs-string">"""
        ä¸ªæ€§åŒ–é‡æ’åº
        """</span>
        <span class="hljs-comment"># åŸºç¡€é‡æ’åº</span>
        base_results = self.base_reranker.rerank(query, documents)
        
        <span class="hljs-comment"># ä¸ªæ€§åŒ–è°ƒæ•´</span>
        user_preference = self.preference_model.get_preference(user_id)
        personalized_results = self.apply_preference(base_results, user_preference)
        
        <span class="hljs-keyword">return</span> personalized_results
</code></pre>
<h3 data-id="heading-57">7.3 æŒ‘æˆ˜ä¸æœºé‡</h3>
<h4 data-id="heading-58">7.3.1 ä¸»è¦æŒ‘æˆ˜</h4>
<p><strong>æŠ€æœ¯æŒ‘æˆ˜ï¼š</strong></p>
<ol>
<li><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼šRerankçš„è®¡ç®—æˆæœ¬ä»ç„¶è¾ƒé«˜</li>
<li><strong>å»¶è¿Ÿé—®é¢˜</strong>ï¼šå®æ—¶åº”ç”¨å¯¹å»¶è¿Ÿè¦æ±‚ä¸¥æ ¼</li>
<li><strong>æ¨¡å‹æ³›åŒ–</strong>ï¼šä¸åŒé¢†åŸŸçš„æ³›åŒ–èƒ½åŠ›æœ‰é™</li>
<li><strong>æ•°æ®è´¨é‡</strong>ï¼šè®­ç»ƒæ•°æ®çš„è´¨é‡å½±å“æ¨¡å‹æ•ˆæœ</li>
</ol>
<p><strong>ä¸šåŠ¡æŒ‘æˆ˜ï¼š</strong></p>
<ol>
<li><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šå¤§è§„æ¨¡éƒ¨ç½²çš„æˆæœ¬è¾ƒé«˜</li>
<li><strong>æ•ˆæœè¯„ä¼°</strong>ï¼šç¼ºä¹ç»Ÿä¸€çš„è¯„ä¼°æ ‡å‡†</li>
<li><strong>ç”¨æˆ·æ¥å—åº¦</strong>ï¼šç”¨æˆ·å¯¹AIæ’åºçš„ä¿¡ä»»åº¦</li>
<li><strong>éšç§ä¿æŠ¤</strong>ï¼šç”¨æˆ·æ•°æ®çš„éšç§é—®é¢˜</li>
</ol>
<h4 data-id="heading-59">7.3.2 å‘å±•æœºé‡</h4>
<p><strong>æŠ€æœ¯æœºé‡ï¼š</strong></p>
<ul>
<li><strong>ç¡¬ä»¶å‘å±•</strong>ï¼šGPU/TPUæ€§èƒ½æå‡</li>
<li><strong>æ¨¡å‹ä¼˜åŒ–</strong>ï¼šæ›´é«˜æ•ˆçš„æ¶æ„è®¾è®¡</li>
<li><strong>å¤šæ¨¡æ€èåˆ</strong>ï¼šæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘çš„ç»Ÿä¸€å¤„ç†</li>
<li><strong>å®æ—¶è®¡ç®—</strong>ï¼šè¾¹ç¼˜è®¡ç®—å’Œæµå¼å¤„ç†</li>
</ul>
<p><strong>åº”ç”¨æœºé‡ï¼š</strong></p>
<ul>
<li><strong>å‚ç›´é¢†åŸŸ</strong>ï¼šåŒ»ç–—ã€æ³•å¾‹ã€é‡‘èç­‰ä¸“ä¸šé¢†åŸŸ</li>
<li><strong>ç§»åŠ¨åº”ç”¨</strong>ï¼šæ‰‹æœºç«¯çš„å®æ—¶é‡æ’åº</li>
<li><strong>IoTè®¾å¤‡</strong>ï¼šæ™ºèƒ½è®¾å¤‡çš„æœ¬åœ°é‡æ’åº</li>
<li><strong>ä¼ä¸šåº”ç”¨</strong>ï¼šä¼ä¸šå†…éƒ¨çŸ¥è¯†ç®¡ç†</li>
</ul>
<h3 data-id="heading-60">7.4 å‘å±•è·¯çº¿å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title RerankæŠ€æœ¯å‘å±•è·¯çº¿å›¾
    dateFormat  YYYY-MM-DD
    section å½“å‰é˜¶æ®µ
    æ¨¡å‹ä¼˜åŒ–      :2024-01-01, 2024-12-31
    æ•ˆç‡æå‡      :2024-06-01, 2025-06-30
    å¤šæ¨¡æ€æ”¯æŒ    :2024-09-01, 2025-09-30
    
    section ä¸­æœŸå‘å±•
    å®æ—¶å¤„ç†      :2025-01-01, 2026-12-31
    ä¸ªæ€§åŒ–æ’åº    :2025-06-01, 2026-06-30
    è¾¹ç¼˜è®¡ç®—      :2025-09-01, 2026-09-30
    
    section é•¿æœŸæ„¿æ™¯
    é€šç”¨æ™ºèƒ½æ’åº  :2026-01-01, 2027-12-31
    è‡ªä¸»ä¼˜åŒ–      :2026-06-01, 2028-06-30
    äººæœºåä½œ      :2027-01-01, 2028-12-31
</code></pre>
<hr/>
<h2 data-id="heading-61">å…«ã€æ€»ç»“</h2>
<h3 data-id="heading-62">æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li><strong>Rerankæ˜¯RAGç³»ç»Ÿçš„å…³é”®ç»„ä»¶</strong>ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ£€ç´¢è´¨é‡</li>
<li><strong>Cross-Encoderæ˜¯æœ€å¸¸ç”¨çš„Rerankç®—æ³•</strong>ï¼Œç²¾åº¦é«˜ä½†è®¡ç®—æˆæœ¬å¤§</li>
<li><strong>ColBERTå¹³è¡¡äº†ç²¾åº¦å’Œæ•ˆç‡</strong>ï¼Œé€‚åˆå¤§è§„æ¨¡æ£€ç´¢åœºæ™¯</li>
<li><strong>RAG-Fusioné€šè¿‡å¤šæŸ¥è¯¢èåˆ</strong>ï¼Œæå‡äº†å¤æ‚æŸ¥è¯¢çš„å¤„ç†èƒ½åŠ›</li>
<li><strong>å¤šé˜¶æ®µRerank</strong>ç»“åˆäº†ä¸åŒç®—æ³•çš„ä¼˜åŠ¿</li>
<li><strong>Pythonå®æˆ˜</strong>å±•ç¤ºäº†å®Œæ•´çš„Rerankç³»ç»Ÿå®ç°</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘åšäº†ä¸€ä¸ªç¼–è¾‘å›½é™…åŒ–i18n jsonæ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·]]></title>    <link>https://juejin.cn/post/7579460553614737459</link>    <guid>https://juejin.cn/post/7579460553614737459</guid>    <pubDate>2025-12-03T10:41:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579460553614737459" data-draft-id="7579451710302568474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘åšäº†ä¸€ä¸ªç¼–è¾‘å›½é™…åŒ–i18n jsonæ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T10:41:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chenyunjie"/> <meta itemprop="url" content="https://juejin.cn/user/1204720476632045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘åšäº†ä¸€ä¸ªç¼–è¾‘å›½é™…åŒ–i18n jsonæ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1204720476632045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chenyunjie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:41:46.000Z" title="Wed Dec 03 2025 10:41:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºæœ¬ç”¨æ³•</h2>
<pre><code class="hljs language-bash" lang="bash">i18nedt locales/*.json -k home.start
</code></pre>
<p>è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¼šæ‰“å¼€ç¼–è¾‘å™¨è®©ä½ ç¼–è¾‘ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œé€€å‡ºç¼–è¾‘å™¨æ—¶ä½ çš„å†…å®¹å°±ä¼šå†™åˆ°å¯¹åº”çš„jsonæ–‡ä»¶é‡Œ
ï¼Œ-k å‚æ•°å¯ä»¥æœ‰å¤šä¸ª</p>
<p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡I18NEDT_FILESè®¾ç½®jsonæ–‡ä»¶ã€‚è¿™æ ·åé¢å°±å¯ä»¥ç›´æ¥</p>
<pre><code class="hljs language-arduino" lang="arduino">i18nedt -k home.start
</code></pre>
<p>å»ºè®®æ­é…direnvè¿™æ ·çš„å·¥å…·ä½¿ç”¨</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/257fad6fad614c6b885a9626f357aff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=huLKwG2gozJcWuyetshKvzebXe8%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-1">å¯ä»¥è®©AIå¸®ä½ å¡«å†™ç¼ºå¤±çš„ç¿»è¯‘</h2>
<p>åœ¨aiå·¥å…·é‡Œ@ä¸€ä¸‹ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da1d7beaa3094509957dd53392967f61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=z93kO6pEG3Elg1B5H79fcNsBJl8%3D" alt="ai-ready.png" loading="lazy"/></p>
<h2 data-id="heading-2">é…åˆfzf</h2>
<p>å‘½ä»¤è¡Œçš„å¥½å¤„å°±æ˜¯å¯ä»¥æŠŠä¸åŒçš„å·¥å…·ç»„åˆèµ·æ¥</p>
<p>fzf <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjunegunn%2Ffzf" target="_blank" title="https://github.com/junegunn/fzf" ref="nofollow noopener noreferrer">github.com/junegunn/fzâ€¦</a> æ˜¯ä¸€ä¸ªé€šç”¨çš„fuzzy finder</p>
<pre><code class="hljs language-bash" lang="bash">i18nedt -f | fzf \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'enter:become:i18nedt -k {1}'</span> \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'ctrl-o:execute:i18nedt -k {1}'</span> \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'ctrl-x:become:i18nedt -k {q}'</span> \
     --delimiter = --preview <span class="hljs-string">'i18nedt -pa -k {1}'</span> \
     --preview-window <span class="hljs-string">'&lt;80(up):wrap'</span> --<span class="hljs-built_in">bind</span> <span class="hljs-string">'?:toggle-preview'</span>
</code></pre>
<p>è¿™æ ·ä½ å¯ä»¥fuzzyæœç´¢é¡¹ç›®é‡Œæ‰€æœ‰ç¿»è¯‘çš„keyå’Œæ–‡æœ¬ï¼Œé€‰ä¸­æŸä¸€æ¡åå›è½¦ç¼–è¾‘ï¼Œctrl-x ä»¥æœç´¢å†…å®¹ä¸ºkeyè¿›è¡Œç¼–è¾‘ï¼ˆä¸€èˆ¬æ˜¯æ–°å»ºkeyæ—¶ä½¿ç”¨ï¼‰ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffdbe4fe8a21404a8028afa8c3ed6817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=kQ5mj2YFIiVkd74ypId82dQn1LI%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-3">github</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkikyous%2Fi18nedt" target="_blank" title="https://github.com/kikyous/i18nedt" ref="nofollow noopener noreferrer">github.com/kikyous/i18â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ç³»ç»Ÿç›‘æ§ç³»åˆ—ã€‘005ï¼šCPUæ¸©åº¦ç›‘æ§è„šæœ¬]]></title>    <link>https://juejin.cn/post/7579313396207992847</link>    <guid>https://juejin.cn/post/7579313396207992847</guid>    <pubDate>2025-12-03T10:34:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579313396207992847" data-draft-id="7579298511072542720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ç³»ç»Ÿç›‘æ§ç³»åˆ—ã€‘005ï¼šCPUæ¸©åº¦ç›‘æ§è„šæœ¬"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2025-12-03T10:34:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¶æ—¥å¤±çœ è€…"/> <meta itemprop="url" content="https://juejin.cn/user/3411111810444068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ç³»ç»Ÿç›‘æ§ç³»åˆ—ã€‘005ï¼šCPUæ¸©åº¦ç›‘æ§è„šæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411111810444068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¶æ—¥å¤±çœ è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:34:41.000Z" title="Wed Dec 03 2025 10:34:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p>CPUæ¸©åº¦æ˜¯è¡¡é‡ç³»ç»Ÿå¥åº·çŠ¶å†µçš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚è¿‡é«˜çš„CPUæ¸©åº¦å¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šã€æ€§èƒ½ä¸‹é™ç”šè‡³ç¡¬ä»¶æŸåã€‚å®æ—¶ç›‘æ§CPUæ¸©åº¦æœ‰åŠ©äºåŠæ—¶å‘ç°æ•£çƒ­é—®é¢˜ï¼Œé¢„é˜²ç³»ç»Ÿæ•…éšœã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªå®ç”¨çš„Pythonè„šæœ¬â€”â€”CPUæ¸©åº¦ç›‘æ§å·¥å…·ï¼Œå®ƒå¯ä»¥å®æ—¶ç›‘æ§CPUæ¸©åº¦ï¼Œå¹¶åœ¨æ¸©åº¦è¿‡é«˜æ—¶å‘å‡ºå‘Šè­¦ã€‚</p>
<h2 data-id="heading-1">åŠŸèƒ½ä»‹ç»</h2>
<p>è¿™ä¸ªCPUæ¸©åº¦ç›‘æ§å·¥å…·å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ol>
<li><strong>å®æ—¶æ¸©åº¦ç›‘æ§</strong>ï¼šå®æ—¶è¯»å–CPUæ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®</li>
<li><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šæ”¯æŒWindowsã€Linuxå’ŒmacOSæ“ä½œç³»ç»Ÿ</li>
<li><strong>æ¸©åº¦å‘Šè­¦</strong>ï¼šå½“æ¸©åº¦è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶å‘å‡ºå‘Šè­¦</li>
<li><strong>å†å²æ•°æ®è®°å½•</strong>ï¼šè®°å½•æ¸©åº¦å˜åŒ–å†å²ï¼Œä¾¿äºåˆ†æ</li>
<li><strong>å¯è§†åŒ–å›¾è¡¨</strong>ï¼šç”Ÿæˆæ¸©åº¦å˜åŒ–è¶‹åŠ¿å›¾</li>
<li><strong>å®šæ—¶ç›‘æ§</strong>ï¼šæ”¯æŒæŒ‰æŒ‡å®šé—´éš”æŒç»­ç›‘æ§CPUæ¸©åº¦</li>
<li><strong>å¤šæ ¸æ¸©åº¦ç›‘æ§</strong>ï¼šæ”¯æŒå¤šæ ¸CPUçš„æ¸©åº¦ç›‘æ§</li>
<li><strong>é£æ‰‡è½¬é€Ÿç›‘æ§</strong>ï¼šåœ¨æ”¯æŒçš„ç³»ç»Ÿä¸Šç›‘æ§é£æ‰‡è½¬é€Ÿ</li>
</ol>
<h2 data-id="heading-2">åº”ç”¨åœºæ™¯</h2>
<p>è¿™ä¸ªå·¥å…·é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li><strong>æœåŠ¡å™¨ç›‘æ§</strong>ï¼šç›‘æ§æœåŠ¡å™¨CPUæ¸©åº¦ï¼Œé¢„é˜²è¿‡çƒ­æ•…éšœ</li>
<li><strong>é«˜æ€§èƒ½è®¡ç®—</strong>ï¼šåœ¨å¯†é›†è®¡ç®—ä»»åŠ¡ä¸­ç›‘æ§CPUæ¸©åº¦</li>
<li><strong>ç³»ç»Ÿç»´æŠ¤</strong>ï¼šå®šæœŸæ£€æŸ¥ç³»ç»Ÿæ•£çƒ­çŠ¶å†µ</li>
<li><strong>æ•…éšœæ’æŸ¥</strong>ï¼šè¯Šæ–­ç³»ç»Ÿä¸ç¨³å®šæ˜¯å¦ç”±è¿‡çƒ­å¼•èµ·</li>
<li><strong>è¶…é¢‘æµ‹è¯•</strong>ï¼šåœ¨CPUè¶…é¢‘æ—¶ç›‘æ§æ¸©åº¦å˜åŒ–</li>
<li><strong>ç¯å¢ƒç›‘æ§</strong>ï¼šç›‘æ§æœºæˆ¿æˆ–è®¾å¤‡ç¯å¢ƒæ¸©åº¦</li>
</ol>
<h2 data-id="heading-3">æŠ¥é”™å¤„ç†</h2>
<p>è„šæœ¬åŒ…å«äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š</p>
<ol>
<li><strong>ä¼ æ„Ÿå™¨æ£€æµ‹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨</li>
<li><strong>æƒé™éªŒè¯</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®ä¼ æ„Ÿå™¨æ•°æ®</li>
<li><strong>ç¡¬ä»¶å…¼å®¹æ€§</strong>ï¼šå¤„ç†ä¸åŒç¡¬ä»¶å¹³å°çš„å…¼å®¹æ€§é—®é¢˜</li>
<li><strong>æ•°æ®æœ‰æ•ˆæ€§æ£€æŸ¥</strong>ï¼šéªŒè¯æ¸©åº¦æ•°æ®çš„æœ‰æ•ˆæ€§</li>
<li><strong>å¼‚å¸¸æ•è·</strong>ï¼šæ•è·å¹¶å¤„ç†è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å„ç§å¼‚å¸¸</li>
<li><strong>é™çº§å¤„ç†</strong>ï¼šåœ¨ä¼ æ„Ÿå™¨ä¸å¯ç”¨æ—¶æä¾›æ›¿ä»£æ–¹æ¡ˆ</li>
</ol>
<h2 data-id="heading-4">ä»£ç å®ç°</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> platform
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> matplotlib.dates <span class="hljs-keyword">as</span> mdates
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CPUTemperatureMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, history_size=<span class="hljs-number">100</span></span>):
        self.os_type = platform.system().lower()
        self.history_size = history_size
        self.temperature_history = deque(maxlen=history_size)
        self.timestamp_history = deque(maxlen=history_size)
        self.errors = []
        self.monitoring = <span class="hljs-literal">False</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_linux</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–Linuxç³»ç»ŸCPUæ¸©åº¦"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># æ–¹æ³•1: é€šè¿‡sysfsè¯»å–æ¸©åº¦</span>
        <span class="hljs-keyword">try</span>:
            hwmon_paths = []
            <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(<span class="hljs-string">'/sys/class/hwmon/'</span>):
                <span class="hljs-keyword">if</span> <span class="hljs-string">'temp1_input'</span> <span class="hljs-keyword">in</span> files:
                    hwmon_paths.append(root)
                    
            <span class="hljs-keyword">for</span> i, path <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(hwmon_paths):
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-comment"># è¯»å–æ¸©åº¦</span>
                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(path, <span class="hljs-string">'temp1_input'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                        temp_raw = <span class="hljs-built_in">int</span>(f.read().strip())
                        temp_celsius = temp_raw / <span class="hljs-number">1000.0</span>
                        
                    <span class="hljs-comment"># è¯»å–ä¼ æ„Ÿå™¨åç§°</span>
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(path, <span class="hljs-string">'name'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                            name = f.read().strip()
                    <span class="hljs-keyword">except</span>:
                        name = <span class="hljs-string">f"Sensor <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>
                        
                    temperatures[name] = temp_celsius
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">pass</span>
            
        <span class="hljs-comment"># æ–¹æ³•2: é€šè¿‡/proc/cpuinfoè·å–æ¸©åº¦ï¼ˆæŸäº›ç³»ç»Ÿï¼‰</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> temperatures:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'/proc/cpuinfo'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                    <span class="hljs-comment"># æ³¨æ„ï¼š/proc/cpuinfoé€šå¸¸ä¸åŒ…å«æ¸©åº¦ä¿¡æ¯</span>
                    <span class="hljs-comment"># è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…å¯èƒ½éœ€è¦å…¶ä»–æ–¹æ³•</span>
                    <span class="hljs-keyword">pass</span>
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
                
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_windows</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–Windowsç³»ç»ŸCPUæ¸©åº¦"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># Windowsä¸Šè·å–æ¸©åº¦æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹åº“</span>
        <span class="hljs-comment"># è¿™é‡Œæä¾›å‡ ç§å¯èƒ½çš„æ–¹æ³•</span>
        
        <span class="hljs-comment"># æ–¹æ³•1: å°è¯•ä½¿ç”¨wmiï¼ˆéœ€è¦pywin32ï¼‰</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">import</span> wmi
            c = wmi.WMI(namespace=<span class="hljs-string">"root\\wmi"</span>)
            temperature_infos = c.MSAcpi_ThermalZoneTemperature()
            
            <span class="hljs-keyword">for</span> i, sensor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(temperature_infos):
                <span class="hljs-comment"># æ¸©åº¦ä»¥ååˆ†ä¹‹ä¸€å¼€å°”æ–‡ä¸ºå•ä½</span>
                temp_kelvin = sensor.CurrentTemperature / <span class="hljs-number">10.0</span>
                temp_celsius = temp_kelvin - <span class="hljs-number">273.15</span>
                temperatures[<span class="hljs-string">f"Thermal Zone <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>] = temp_celsius
                
        <span class="hljs-keyword">except</span> ImportError:
            self.errors.append(<span class="hljs-string">"ç¼ºå°‘wmiåº“ï¼Œæ— æ³•è·å–Windowsæ¸©åº¦ä¿¡æ¯"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.errors.append(<span class="hljs-string">f"é€šè¿‡WMIè·å–æ¸©åº¦å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            
        <span class="hljs-comment"># æ–¹æ³•2: å°è¯•ä½¿ç”¨OpenHardwareMonitorLibï¼ˆéœ€è¦å®‰è£…ï¼‰</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> temperatures:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># è¿™éœ€è¦é¢„å…ˆå®‰è£…OpenHardwareMonitorå¹¶æ³¨å†ŒCOMç»„ä»¶</span>
                <span class="hljs-comment"># ç”±äºå¤æ‚æ€§ï¼Œè¿™é‡Œä»…æä¾›æ¡†æ¶</span>
                <span class="hljs-keyword">pass</span>
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
                
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_macos</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–macOSç³»ç»ŸCPUæ¸©åº¦"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># macOSä¸Šè·å–æ¸©åº¦ä¹Ÿæ¯”è¾ƒå¤æ‚</span>
        <span class="hljs-comment"># å¯ä»¥å°è¯•ä½¿ç”¨osascriptè°ƒç”¨ç³»ç»Ÿå‘½ä»¤</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ³¨æ„ï¼šmacOSé€šå¸¸ä¸ç›´æ¥æš´éœ²æ¸©åº¦ä¼ æ„Ÿå™¨</span>
            <span class="hljs-comment"># å¯èƒ½éœ€è¦ç¬¬ä¸‰æ–¹å·¥å…·å¦‚iStats</span>
            <span class="hljs-keyword">import</span> subprocess
            result = subprocess.run([<span class="hljs-string">'sysctl'</span>, <span class="hljs-string">'machdep.xcpm.cpu_thermal_level'</span>], 
                                  capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, timeout=<span class="hljs-number">10</span>)
            
            <span class="hljs-keyword">if</span> result.returncode == <span class="hljs-number">0</span>:
                <span class="hljs-comment"># è§£æè¾“å‡º</span>
                output = result.stdout.strip()
                <span class="hljs-comment"># è¿™é‡Œçš„è¾“å‡ºæ ¼å¼å¯èƒ½å› ç³»ç»Ÿè€Œå¼‚</span>
                <span class="hljs-comment"># ä»…ä½œä¸ºç¤ºä¾‹</span>
                temperatures[<span class="hljs-string">'CPU'</span>] = <span class="hljs-number">0.0</span>  <span class="hljs-comment"># å®é™…éœ€è¦è§£æå…·ä½“æ•°å€¼</span>
                
        <span class="hljs-keyword">except</span> subprocess.TimeoutExpired:
            self.errors.append(<span class="hljs-string">"è·å–macOSæ¸©åº¦ä¿¡æ¯è¶…æ—¶"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.errors.append(<span class="hljs-string">f"è·å–macOSæ¸©åº¦ä¿¡æ¯å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–CPUæ¸©åº¦ï¼ˆè·¨å¹³å°ï¼‰"""</span>
        <span class="hljs-keyword">if</span> self.os_type == <span class="hljs-string">'linux'</span>:
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_linux()
        <span class="hljs-keyword">elif</span> self.os_type == <span class="hljs-string">'windows'</span>:
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_windows()
        <span class="hljs-keyword">elif</span> self.os_type == <span class="hljs-string">'darwin'</span>:  <span class="hljs-comment"># macOS</span>
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_macos()
        <span class="hljs-keyword">else</span>:
            self.errors.append(<span class="hljs-string">f"ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: <span class="hljs-subst">{self.os_type}</span>"</span>)
            <span class="hljs-keyword">return</span> {}
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_temperature</span>(<span class="hljs-params">self, temp_celsius</span>):
        <span class="hljs-string">"""æ ¼å¼åŒ–æ¸©åº¦æ˜¾ç¤º"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{temp_celsius:<span class="hljs-number">.1</span>f}</span>Â°C (<span class="hljs-subst">{temp_celsius * <span class="hljs-number">9</span>/<span class="hljs-number">5</span> + <span class="hljs-number">32</span>:<span class="hljs-number">.1</span>f}</span>Â°F)"</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_temperature</span>(<span class="hljs-params">self, temperatures</span>):
        <span class="hljs-string">"""æ˜¾ç¤ºæ¸©åº¦ä¿¡æ¯"""</span>
        <span class="hljs-comment"># æ¸…å±ï¼ˆå…¼å®¹ä¸åŒæ“ä½œç³»ç»Ÿï¼‰</span>
        os.system(<span class="hljs-string">'cls'</span> <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">'nt'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'clear'</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"CPUæ¸©åº¦ç›‘æ§å·¥å…·"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç›‘æ§æ—¶é—´: <span class="hljs-subst">{datetime.now().strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>)}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ“ä½œç³»ç»Ÿ: <span class="hljs-subst">{self.os_type}</span>"</span>)
        <span class="hljs-built_in">print</span>()
        
        <span class="hljs-keyword">if</span> temperatures:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"CPUæ¸©åº¦ä¿¡æ¯:"</span>)
            <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{sensor_name}</span>: <span class="hljs-subst">{self.format_temperature(temp)}</span>"</span>)
                
                <span class="hljs-comment"># æ¸©åº¦å‘Šè­¦</span>
                <span class="hljs-keyword">if</span> temp &gt; <span class="hljs-number">80</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"  âš ï¸  è­¦å‘Š: æ¸©åº¦è¿‡é«˜!"</span>)
                <span class="hljs-keyword">elif</span> temp &gt; <span class="hljs-number">70</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"  â„¹ï¸  æ³¨æ„: æ¸©åº¦è¾ƒé«˜"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æœªèƒ½è·å–CPUæ¸©åº¦ä¿¡æ¯"</span>)
            <span class="hljs-keyword">if</span> self.errors:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"é”™è¯¯ä¿¡æ¯:"</span>)
                <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> self.errors[-<span class="hljs-number">3</span>:]:  <span class="hljs-comment"># æ˜¾ç¤ºæœ€è¿‘3ä¸ªé”™è¯¯</span>
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{error}</span>"</span>)
                    
        <span class="hljs-built_in">print</span>()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æŒ‰ Ctrl+C åœæ­¢ç›‘æ§"</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">collect_data</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ”¶é›†æ¸©åº¦æ•°æ®"""</span>
        temperatures = self.get_cpu_temperature()
        timestamp = datetime.now()
        
        <span class="hljs-comment"># è®°å½•åˆ°å†å²æ•°æ®</span>
        <span class="hljs-keyword">if</span> temperatures:
            avg_temp = <span class="hljs-built_in">sum</span>(temperatures.values()) / <span class="hljs-built_in">len</span>(temperatures)
            self.temperature_history.append(avg_temp)
            self.timestamp_history.append(timestamp)
            
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_data</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"temperature_data.json"</span></span>):
        <span class="hljs-string">"""ä¿å­˜æ¸©åº¦æ•°æ®åˆ°æ–‡ä»¶"""</span>
        <span class="hljs-keyword">try</span>:
            data = {
                <span class="hljs-string">'timestamps'</span>: [t.isoformat() <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> self.timestamp_history],
                <span class="hljs-string">'temperatures'</span>: <span class="hljs-built_in">list</span>(self.temperature_history),
                <span class="hljs-string">'os_type'</span>: self.os_type,
                <span class="hljs-string">'record_time'</span>: datetime.now().isoformat()
            }
            
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
                json.dump(data, f, indent=<span class="hljs-number">2</span>)
                
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¸©åº¦æ•°æ®å·²ä¿å­˜åˆ°: <span class="hljs-subst">{filename}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¿å­˜æ¸©åº¦æ•°æ®æ—¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_chart</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"temperature_chart.png"</span></span>):
        <span class="hljs-string">"""ç”Ÿæˆæ¸©åº¦å˜åŒ–å›¾è¡¨"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.timestamp_history) &lt; <span class="hljs-number">2</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•°æ®ä¸è¶³ï¼Œæ— æ³•ç”Ÿæˆå›¾è¡¨"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
            plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">6</span>))
            plt.plot(self.timestamp_history, self.temperature_history, <span class="hljs-string">'b-'</span>, linewidth=<span class="hljs-number">1.5</span>)
            plt.title(<span class="hljs-string">'CPUæ¸©åº¦å˜åŒ–è¶‹åŠ¿'</span>)
            plt.xlabel(<span class="hljs-string">'æ—¶é—´'</span>)
            plt.ylabel(<span class="hljs-string">'æ¸©åº¦ (Â°C)'</span>)
            plt.grid(<span class="hljs-literal">True</span>, alpha=<span class="hljs-number">0.3</span>)
            
            <span class="hljs-comment"># è®¾ç½®æ¸©åº¦å‘Šè­¦çº¿</span>
            plt.axhline(y=<span class="hljs-number">70</span>, color=<span class="hljs-string">'orange'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.7</span>, label=<span class="hljs-string">'é«˜æ¸©è­¦å‘Š (70Â°C)'</span>)
            plt.axhline(y=<span class="hljs-number">80</span>, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.7</span>, label=<span class="hljs-string">'å±é™©æ¸©åº¦ (80Â°C)'</span>)
            
            plt.legend()
            
            <span class="hljs-comment"># æ ¼å¼åŒ–æ—¶é—´è½´</span>
            plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="hljs-string">'%H:%M'</span>))
            plt.gca().xaxis.set_major_locator(mdates.MinuteLocator(interval=<span class="hljs-number">5</span>))
            plt.setp(plt.gca().xaxis.get_majorticklabels(), rotation=<span class="hljs-number">45</span>)
            
            plt.tight_layout()
            plt.savefig(filename, dpi=<span class="hljs-number">300</span>, bbox_inches=<span class="hljs-string">'tight'</span>)
            plt.close()
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¸©åº¦å›¾è¡¨å·²ä¿å­˜åˆ°: <span class="hljs-subst">{filename}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”Ÿæˆæ¸©åº¦å›¾è¡¨æ—¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_temperature_alert</span>(<span class="hljs-params">self, temperatures, threshold=<span class="hljs-number">80</span></span>):
        <span class="hljs-string">"""æ£€æŸ¥æ¸©åº¦å‘Šè­¦"""</span>
        alerts = []
        
        <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
            <span class="hljs-keyword">if</span> temp &gt; threshold:
                alerts.append({
                    <span class="hljs-string">'sensor'</span>: sensor_name,
                    <span class="hljs-string">'temperature'</span>: temp,
                    <span class="hljs-string">'threshold'</span>: threshold,
                    <span class="hljs-string">'time'</span>: datetime.now().isoformat()
                })
                
        <span class="hljs-keyword">if</span> alerts:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nğŸš¨ æ¸©åº¦å‘Šè­¦!"</span>)
            <span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> alerts:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{alert[<span class="hljs-string">'sensor'</span>]}</span>: <span class="hljs-subst">{self.format_temperature(alert[<span class="hljs-string">'temperature'</span>])}</span> "</span>
                      <span class="hljs-string">f"(é˜ˆå€¼: <span class="hljs-subst">{alert[<span class="hljs-string">'threshold'</span>]}</span>Â°C)"</span>)
                      
        <span class="hljs-keyword">return</span> alerts
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_monitoring</span>(<span class="hljs-params">self, interval=<span class="hljs-number">5</span>, duration=<span class="hljs-literal">None</span>, alert_threshold=<span class="hljs-number">80</span>, 
                        save_data=<span class="hljs-literal">False</span>, chart_file=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""å¼€å§‹ç›‘æ§"""</span>
        self.monitoring = <span class="hljs-literal">True</span>
        start_time = time.time()
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">while</span> self.monitoring:
                <span class="hljs-comment"># æ”¶é›†æ•°æ®</span>
                temperatures = self.collect_data()
                
                <span class="hljs-comment"># æ˜¾ç¤ºæ¸©åº¦</span>
                self.display_temperature(temperatures)
                
                <span class="hljs-comment"># æ£€æŸ¥å‘Šè­¦</span>
                <span class="hljs-keyword">if</span> temperatures:
                    self.check_temperature_alert(temperatures, alert_threshold)
                    
                <span class="hljs-comment"># ä¿å­˜æ•°æ®</span>
                <span class="hljs-keyword">if</span> save_data <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(self.temperature_history) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># æ¯10æ¬¡ä¿å­˜ä¸€æ¬¡</span>
                    self.save_data()
                    
                <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æŒ‡å®šæ—¶é•¿</span>
                <span class="hljs-keyword">if</span> duration <span class="hljs-keyword">and</span> (time.time() - start_time) &gt;= duration:
                    <span class="hljs-keyword">break</span>
                    
                <span class="hljs-comment"># ç­‰å¾…ä¸‹æ¬¡ç›‘æ§</span>
                time.sleep(interval)
                
        <span class="hljs-keyword">except</span> KeyboardInterrupt:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\nåœæ­¢ç›‘æ§..."</span>)
        <span class="hljs-keyword">finally</span>:
            self.monitoring = <span class="hljs-literal">False</span>
            
            <span class="hljs-comment"># ç”Ÿæˆå›¾è¡¨</span>
            <span class="hljs-keyword">if</span> chart_file:
                self.generate_chart(chart_file)
                
            <span class="hljs-comment"># ä¿å­˜æœ€ç»ˆæ•°æ®</span>
            <span class="hljs-keyword">if</span> save_data:
                self.save_data()
                
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç›‘æ§å·²åœæ­¢"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"CPUæ¸©åº¦ç›‘æ§å·¥å…·"</span>)
    parser.add_argument(<span class="hljs-string">"-i"</span>, <span class="hljs-string">"--interval"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">5</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"ç›‘æ§é—´éš”ï¼ˆç§’ï¼Œé»˜è®¤ï¼š5ï¼‰"</span>)
    parser.add_argument(<span class="hljs-string">"-d"</span>, <span class="hljs-string">"--duration"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"ç›‘æ§æ—¶é•¿ï¼ˆç§’ï¼Œä¸æŒ‡å®šåˆ™æŒç»­ç›‘æ§ï¼‰"</span>)
    parser.add_argument(<span class="hljs-string">"-t"</span>, <span class="hljs-string">"--threshold"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, default=<span class="hljs-number">80.0</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"æ¸©åº¦å‘Šè­¦é˜ˆå€¼ï¼ˆÂ°Cï¼Œé»˜è®¤ï¼š80ï¼‰"</span>)
    parser.add_argument(<span class="hljs-string">"-s"</span>, <span class="hljs-string">"--save-data"</span>, action=<span class="hljs-string">"store_true"</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"ä¿å­˜æ¸©åº¦æ•°æ®åˆ°æ–‡ä»¶"</span>)
    parser.add_argument(<span class="hljs-string">"-c"</span>, <span class="hljs-string">"--chart"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"ç”Ÿæˆæ¸©åº¦å›¾è¡¨åˆ°æŒ‡å®šæ–‡ä»¶"</span>)
    parser.add_argument(<span class="hljs-string">"--list-sensors"</span>, action=<span class="hljs-string">"store_true"</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"åˆ—å‡ºå¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨"</span>)
    
    args = parser.parse_args()
    
    <span class="hljs-comment"># æ£€æŸ¥å¿…è¦çš„ä¾èµ–</span>
    <span class="hljs-keyword">if</span> args.list_sensors <span class="hljs-keyword">and</span> platform.system().lower() == <span class="hljs-string">'windows'</span>:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">import</span> wmi
        <span class="hljs-keyword">except</span> ImportError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"è­¦å‘Š: ç¼ºå°‘wmiåº“ï¼Œæ— æ³•åˆ—å‡ºWindowsä¼ æ„Ÿå™¨"</span>)
            
    <span class="hljs-keyword">try</span>:
        monitor = CPUTemperatureMonitor()
        
        <span class="hljs-comment"># åˆ—å‡ºä¼ æ„Ÿå™¨</span>
        <span class="hljs-keyword">if</span> args.list_sensors:
            temperatures = monitor.get_cpu_temperature()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨:"</span>)
            <span class="hljs-keyword">if</span> temperatures:
                <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{sensor_name}</span>: <span class="hljs-subst">{monitor.format_temperature(temp)}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"  æœªæ‰¾åˆ°å¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨"</span>)
            <span class="hljs-keyword">return</span>
            
        <span class="hljs-comment"># å¼€å§‹ç›‘æ§</span>
        monitor.start_monitoring(
            interval=args.interval,
            duration=args.duration,
            alert_threshold=args.threshold,
            save_data=args.save_data,
            chart_file=args.chart
        )
        
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\nç”¨æˆ·ä¸­æ–­æ“ä½œ"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¨‹åºæ‰§è¡Œå‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
        sys.exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h2 data-id="heading-5">ä½¿ç”¨æ–¹æ³•</h2>
<h3 data-id="heading-6">å®‰è£…ä¾èµ–</h3>
<p>åœ¨ä½¿ç”¨æ­¤è„šæœ¬ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦å®‰è£…å¿…è¦çš„åº“ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windowsç³»ç»Ÿï¼ˆå¯é€‰ï¼Œç”¨äºæ›´å¥½çš„æ¸©åº¦ç›‘æ§ï¼‰</span>
pip install pywin32 wmi

<span class="hljs-comment"># ç”Ÿæˆå›¾è¡¨éœ€è¦</span>
pip install matplotlib
</code></pre>
<h3 data-id="heading-7">åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åŸºæœ¬ç”¨æ³•ï¼Œæ¯5ç§’åˆ·æ–°ä¸€æ¬¡</span>
python cpu_temp_monitor.py

<span class="hljs-comment"># è®¾ç½®ç›‘æ§é—´éš”ä¸º10ç§’</span>
python cpu_temp_monitor.py -i 10

<span class="hljs-comment"># ç›‘æ§60ç§’åè‡ªåŠ¨åœæ­¢</span>
python cpu_temp_monitor.py -d 60

<span class="hljs-comment"># è®¾ç½®å‘Šè­¦é˜ˆå€¼ä¸º75Â°C</span>
python cpu_temp_monitor.py -t 75

<span class="hljs-comment"># ä¿å­˜æ¸©åº¦æ•°æ®åˆ°æ–‡ä»¶</span>
python cpu_temp_monitor.py -s

<span class="hljs-comment"># ç”Ÿæˆæ¸©åº¦å˜åŒ–å›¾è¡¨</span>
python cpu_temp_monitor.py -c temperature.png

<span class="hljs-comment"># åˆ—å‡ºå¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨</span>
python cpu_temp_monitor.py --list-sensors
</code></pre>
<h3 data-id="heading-8">å‘½ä»¤è¡Œå‚æ•°è¯´æ˜</h3>
<ul>
<li><code>-i, --interval</code>: ç›‘æ§é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤5ç§’</li>
<li><code>-d, --duration</code>: ç›‘æ§æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œä¸æŒ‡å®šåˆ™æŒç»­ç›‘æ§</li>
<li><code>-t, --threshold</code>: æ¸©åº¦å‘Šè­¦é˜ˆå€¼ï¼ˆÂ°Cï¼‰ï¼Œé»˜è®¤80Â°C</li>
<li><code>-s, --save-data</code>: ä¿å­˜æ¸©åº¦æ•°æ®åˆ°æ–‡ä»¶</li>
<li><code>-c, --chart</code>: ç”Ÿæˆæ¸©åº¦å›¾è¡¨åˆ°æŒ‡å®šæ–‡ä»¶</li>
<li><code>--list-sensors</code>: åˆ—å‡ºå¯ç”¨çš„æ¸©åº¦ä¼ æ„Ÿå™¨</li>
</ul>
<h3 data-id="heading-9">ä½¿ç”¨ç¤ºä¾‹</h3>
<ol>
<li><strong>æŒç»­ç›‘æ§CPUæ¸©åº¦</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py
</code></pre>
<ol start="2">
<li><strong>ç›‘æ§å¹¶ä¿å­˜æ•°æ®</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py -i 10 -d 300 -s -c temp_trend.png
</code></pre>
<ol start="3">
<li><strong>è®¾ç½®è¾ƒä½çš„å‘Šè­¦é˜ˆå€¼</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py -t 70
</code></pre>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>è¿™ä¸ªCPUæ¸©åº¦ç›‘æ§å·¥å…·æä¾›äº†ä¸€ä¸ªè·¨å¹³å°çš„CPUæ¸©åº¦ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºCPUæ¸©åº¦å¹¶åœ¨æ¸©åº¦è¿‡é«˜æ—¶å‘å‡ºå‘Šè­¦ã€‚å®ƒæ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œå¯è§†åŒ–å›¾è¡¨ç”Ÿæˆï¼Œé€‚ç”¨äºæœåŠ¡å™¨ç›‘æ§ã€ç³»ç»Ÿç»´æŠ¤å’Œæ•…éšœæ’æŸ¥ç­‰å¤šç§åœºæ™¯ã€‚é€šè¿‡è¿™ä¸ªå·¥å…·ï¼Œç”¨æˆ·å¯ä»¥åŠæ—¶äº†è§£CPUçš„æ¸©åº¦çŠ¶å†µï¼Œé¢„é˜²å› è¿‡çƒ­å¯¼è‡´çš„ç³»ç»Ÿé—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„æ¸©åº¦è·å–æ–¹æ³•æœ‰æ‰€ä¸åŒï¼ŒæŸäº›å¹³å°å¯èƒ½éœ€è¦å®‰è£…é¢å¤–çš„åº“æˆ–å·¥å…·æ‰èƒ½è·å–å‡†ç¡®çš„æ¸©åº¦æ•°æ®ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå»ºè®®æ ¹æ®å…·ä½“çš„ç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨é¢è§£æï¼šGeoJSON ä¸ TopoJSON çš„å®šä¹‰ã€å·®å¼‚åŠé€‚ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7579439226519289862</link>    <guid>https://juejin.cn/post/7579439226519289862</guid>    <pubDate>2025-12-03T11:54:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579439226519289862" data-draft-id="7579439226519257094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨é¢è§£æï¼šGeoJSON ä¸ TopoJSON çš„å®šä¹‰ã€å·®å¼‚åŠé€‚ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2025-12-03T11:54:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°jobleap"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147692910"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨é¢è§£æï¼šGeoJSON ä¸ TopoJSON çš„å®šä¹‰ã€å·®å¼‚åŠé€‚ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147692910/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°jobleap
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:54:29.000Z" title="Wed Dec 03 2025 11:54:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯jobleap.cnçš„å°ä¹ã€‚</p>
<p>ä½œä¸ºç¨‹åºå‘˜åœ¨åœ°ç†ä¿¡æ¯å¼€å‘ï¼ˆå¦‚åœ°å›¾å¯è§†åŒ–ã€ç©ºé—´æ•°æ®å¤„ç†ï¼‰ä¸­å¸¸ç”¨çš„ä¸¤ç§æ•°æ®æ ¼å¼ï¼ŒGeoJSON å’Œ TopoJSON è™½åŒåŸºäº JSON è¯­æ³•ï¼Œä½†åœ¨è®¾è®¡ç›®æ ‡ã€æ•°æ®ç»“æ„å’Œé€‚ç”¨åœºæ™¯ä¸Šå­˜åœ¨æœ¬è´¨åŒºåˆ«ã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯è§†è§’å‡ºå‘ï¼Œç³»ç»Ÿæ¢³ç†ä¸¤è€…çš„æ ¸å¿ƒç‰¹æ€§ã€å·®å¼‚å¯¹æ¯”ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘åœºæ™¯ç»™å‡ºé€‰æ‹©å»ºè®®ï¼Œå¸®åŠ©å¼€å‘è€…ç²¾å‡†åŒ¹é…éœ€æ±‚ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå®šä¹‰ä¸æ•°æ®ç»“æ„</h2>
<h3 data-id="heading-1">1. GeoJSONï¼šç®€å•ç›´è§‚çš„åœ°ç†æ•°æ®äº¤æ¢æ ¼å¼</h3>
<h4 data-id="heading-2">å®šä¹‰</h4>
<p>GeoJSON æ˜¯ä¸€ç§<strong>åŸºäº JSON çš„è½»é‡çº§åœ°ç†æ•°æ®äº¤æ¢æ ‡å‡†</strong>ï¼ˆRFC 7946 è§„èŒƒï¼‰ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ã€Œç®€æ´ã€å¯è¯»ã€æ˜“è§£æã€ï¼Œæ”¯æŒç‚¹ã€çº¿ã€é¢ã€å¤šå‡ ä½•å¯¹è±¡ç­‰åŸºç¡€ç©ºé—´ç±»å‹ï¼ŒåŒæ—¶å¯é™„åŠ è‡ªå®šä¹‰å±æ€§ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-3">æ ¸å¿ƒæ•°æ®ç»“æ„</h4>
<p>GeoJSON çš„æ ¸å¿ƒæ˜¯ <code>Geometry</code>ï¼ˆå‡ ä½•å¯¹è±¡ï¼‰å’Œ <code>Feature</code>ï¼ˆè¦ç´ å¯¹è±¡ï¼‰ï¼š</p>
<ul>
<li><strong>å‡ ä½•å¯¹è±¡ï¼ˆGeometryï¼‰</strong>ï¼šæè¿°åœ°ç†ç©ºé—´å½¢çŠ¶ï¼Œæ”¯æŒ 7 ç§ç±»å‹ï¼š
<ul>
<li>ç‚¹ï¼ˆ<code>Point</code>ï¼‰ï¼šå¦‚åæ ‡ <code>[ç»åº¦, çº¬åº¦]</code></li>
<li>çº¿ï¼ˆ<code>LineString</code>ï¼‰ï¼šå¦‚è·¯å¾„ <code>[[x1,y1], [x2,y2], ...]</code></li>
<li>é¢ï¼ˆ<code>Polygon</code>ï¼‰ï¼šå¦‚åŒºåŸŸ <code>[[[x1,y1], [x2,y2], ..., [x1,y1]]]</code>ï¼ˆé—­åˆç¯ï¼‰</li>
<li>å¤šç‚¹ï¼ˆ<code>MultiPoint</code>ï¼‰ã€å¤šçº¿ï¼ˆ<code>MultiLineString</code>ï¼‰ã€å¤šé¢ï¼ˆ<code>MultiPolygon</code>ï¼‰</li>
<li>å‡ ä½•é›†åˆï¼ˆ<code>GeometryCollection</code>ï¼‰ï¼šåŒ…å«å¤šä¸ªä¸åŒç±»å‹çš„å‡ ä½•å¯¹è±¡</li>
</ul>
</li>
<li><strong>è¦ç´ å¯¹è±¡ï¼ˆFeatureï¼‰</strong>ï¼šå°†å‡ ä½•å¯¹è±¡ä¸å±æ€§å…³è”ï¼Œæ ¼å¼ä¸º <code>{"type": "Feature", "geometry": {...}, "properties": {...}}</code></li>
<li><strong>è¦ç´ é›†åˆï¼ˆFeatureCollectionï¼‰</strong>ï¼šå¤šä¸ªè¦ç´ çš„é›†åˆï¼ˆæœ€å¸¸ç”¨çš„é¡¶å±‚ç»“æ„ï¼‰</li>
</ul>
<h4 data-id="heading-4">ç¤ºä¾‹ï¼ˆä¸­å›½éƒ¨åˆ†åŸå¸‚ç‚¹æ•°æ®ï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FeatureCollection"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Feature"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"geometry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Point"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"coordinates"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">116.403963</span><span class="hljs-punctuation">,</span> <span class="hljs-number">39.915119</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åŒ—äº¬"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"population"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2184</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Feature"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"geometry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Point"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"coordinates"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">121.473701</span><span class="hljs-punctuation">,</span> <span class="hljs-number">31.230416</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä¸Šæµ·"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"population"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2487</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-5">å…³é”®ç‰¹æ€§</h4>
<ul>
<li>ç»“æ„æ‰å¹³ï¼Œå¯è¯»æ€§æå¼ºï¼ˆç›´æ¥è‚‰çœ¼è¯†åˆ«åœ°ç†ç±»å‹å’Œå±æ€§ï¼‰ï¼›</li>
<li>æ— éœ€é¢å¤–ä¾èµ–ï¼Œæ‰€æœ‰ä¸»æµåœ°å›¾åº“ï¼ˆLeafletã€Mapboxã€EChartsï¼‰å’Œç©ºé—´æ•°æ®æ¡†æ¶ï¼ˆGeoPandasã€Shapelyï¼‰å‡åŸç”Ÿæ”¯æŒï¼›</li>
<li>æ•°æ®å†—ä½™åº¦é«˜ï¼ˆå¦‚ç›¸é‚»çœä»½çš„å…±äº«è¾¹ç•Œä¼šé‡å¤å­˜å‚¨ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-6">2. TopoJSONï¼šåŸºäºæ‹“æ‰‘çš„é«˜æ•ˆåœ°ç†æ•°æ®æ ¼å¼</h3>
<h4 data-id="heading-7">å®šä¹‰</h4>
<p>TopoJSON æ˜¯ GeoJSON çš„<strong>æ‰©å±•æ ¼å¼</strong>ï¼ˆç”± D3.js ä½œè€… Mike Bostock è®¾è®¡ï¼‰ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ã€Œå‹ç¼©æ•°æ®ä½“ç§¯ã€æ¶ˆé™¤å†—ä½™ã€ï¼Œé€šè¿‡<strong>æ‹“æ‰‘ç»“æ„</strong>ï¼ˆTopologyï¼‰å¤ç”¨å…±äº«åœ°ç†è¾¹ç•Œï¼ˆå¦‚å›½å®¶ã€çœä»½çš„ç›¸é‚»è¾¹ç•Œï¼‰ï¼Œå°†é‡å¤å­˜å‚¨çš„åæ ‡æ•°æ®è½¬åŒ–ä¸ºå¯å¤ç”¨çš„ã€Œå¼§æ®µï¼ˆArcï¼‰ã€ã€‚</p>
<h4 data-id="heading-8">æ ¸å¿ƒæ•°æ®ç»“æ„</h4>
<p>TopoJSON ä¸ç›´æ¥å­˜å‚¨å®Œæ•´çš„å‡ ä½•å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ã€Œæ‹“æ‰‘å…³ç³»ã€æè¿°æ•°æ®ï¼š</p>
<ul>
<li><strong>å¼§æ®µï¼ˆArcsï¼‰</strong>ï¼šæå–æ‰€æœ‰å‡ ä½•å¯¹è±¡çš„å…±äº«è¾¹ç•Œï¼Œä»¥åæ ‡æ•°ç»„å½¢å¼å­˜å‚¨ï¼ˆå¦‚ç›¸é‚»ä¸¤çœçš„è¾¹ç•Œä»…å­˜å‚¨ä¸€æ¬¡ï¼‰ï¼›</li>
<li><strong>å¯¹è±¡ï¼ˆObjectsï¼‰</strong>ï¼šå¯¹åº” GeoJSON ä¸­çš„ <code>Feature</code>ï¼Œä½†ä¸å­˜å‚¨å®Œæ•´åæ ‡ï¼Œè€Œæ˜¯é€šè¿‡ã€Œå¼•ç”¨å¼§æ®µçš„ç´¢å¼•å’Œæ–¹å‘ã€ï¼ˆæ­£/è´Ÿç´¢å¼•è¡¨ç¤ºé¡ºæ—¶é’ˆ/é€†æ—¶é’ˆï¼‰é‡æ„å‡ ä½•å½¢çŠ¶ï¼›</li>
<li><strong>è½¬æ¢å‚æ•°ï¼ˆTransformï¼‰</strong>ï¼šå¯é€‰å‚æ•°ï¼Œé€šè¿‡ç¼©æ”¾ï¼ˆscaleï¼‰å’Œåç§»ï¼ˆtranslateï¼‰å¯¹åæ ‡è¿›è¡Œæ•´æ•°åŒ–å¤„ç†ï¼Œè¿›ä¸€æ­¥å‹ç¼©ä½“ç§¯ã€‚</li>
</ul>
<h4 data-id="heading-9">ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆä¸­å›½çœä»½æ‹“æ‰‘æ•°æ®ï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Topology"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"transform"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"scale"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0.0001</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.0001</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"translate"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">73.55</span><span class="hljs-punctuation">,</span> <span class="hljs-number">18.15</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">10000</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20000</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10001</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20001</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// å…±äº«å¼§æ®µ1</span>
    <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">10002</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20002</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10003</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20003</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span>   <span class="hljs-comment">// å…±äº«å¼§æ®µ2</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"objects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"beijing"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Polygon"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>  <span class="hljs-comment">// å¼•ç”¨å¼§æ®µ0å’Œ1ï¼Œé‡æ„åŒ—äº¬çš„è¾¹ç•Œ</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hebei"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Polygon"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">-1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// è´Ÿç´¢å¼•è¡¨ç¤ºåå‘ä½¿ç”¨å¼§æ®µ1</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-10">å…³é”®ç‰¹æ€§</h4>
<ul>
<li>æ•°æ®å‹ç¼©æ¯”æé«˜ï¼ˆç›¸æ¯” GeoJSON å¯å‡å°‘ 50%-90% ä½“ç§¯ï¼Œå°¤å…¶æ˜¯è¾¹ç•Œå¤æ‚çš„å¤§æ•°æ®é›†ï¼‰ï¼›</li>
<li>éœ€é€šè¿‡å·¥å…·ï¼ˆå¦‚ <code>topojson-client</code>ã€<code>GeoPandas</code>ï¼‰è½¬æ¢ä¸º GeoJSON åæ‰èƒ½ç”¨äºå¯è§†åŒ–ï¼›</li>
<li>ä¿ç•™æ‹“æ‰‘å…³ç³»ï¼Œæ”¯æŒå¤æ‚ç©ºé—´åˆ†æï¼ˆå¦‚åˆ¤æ–­è¾¹ç•Œç›¸é‚»ã€åˆå¹¶/æ‹†åˆ†åŒºåŸŸï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-11">äºŒã€æ ¸å¿ƒå·®å¼‚å¯¹æ¯”ï¼ˆç¨‹åºå‘˜è§†è§’ï¼‰</h2>













































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>GeoJSON</th><th>TopoJSON</th></tr></thead><tbody><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td>ç®€æ´æ˜“è¯»ã€å¿«é€Ÿäº¤æ¢</td><td>æ•°æ®å‹ç¼©ã€æ‹“æ‰‘å¤ç”¨</td></tr><tr><td><strong>æ•°æ®å†—ä½™</strong></td><td>é«˜ï¼ˆå…±äº«è¾¹ç•Œé‡å¤å­˜å‚¨ï¼‰</td><td>ä½ï¼ˆå…±äº«è¾¹ç•Œä»…å­˜å‚¨ä¸€æ¬¡ï¼‰</td></tr><tr><td><strong>æ–‡ä»¶ä½“ç§¯</strong></td><td>å¤§ï¼ˆé€‚åˆå°æ•°æ®é›†ï¼‰</td><td>å°ï¼ˆé€‚åˆå¤§æ•°æ®é›†ï¼‰</td></tr><tr><td><strong>è§£æéš¾åº¦</strong></td><td>ä½ï¼ˆåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼‰</td><td>é«˜ï¼ˆéœ€è½¬æ¢ä¸º GeoJSON æ‰èƒ½ä½¿ç”¨ï¼‰</td></tr><tr><td><strong>æ”¯æŒåŠŸèƒ½</strong></td><td>åŸºç¡€ç©ºé—´æ•°æ®å­˜å‚¨ä¸å¯è§†åŒ–</td><td>æ‹“æ‰‘åˆ†æã€å¤§æ•°æ®é‡åœ°å›¾åŠ è½½ã€ç©ºé—´å…³ç³»å¤„ç†</td></tr><tr><td><strong>å¼€å‘æ•ˆç‡</strong></td><td>é«˜ï¼ˆç›´æ¥è§£æï¼Œå¿«é€Ÿè¿­ä»£ï¼‰</td><td>ä¸­ï¼ˆéœ€é¢å¤–å¤„ç†è½¬æ¢é€»è¾‘ï¼‰</td></tr><tr><td><strong>ç”Ÿæ€æ”¯æŒ</strong></td><td>æ‰€æœ‰åœ°å›¾åº“/ç©ºé—´æ¡†æ¶åŸç”Ÿæ”¯æŒ</td><td>éœ€ä¾èµ– TopoJSON ä¸“ç”¨åº“ï¼ˆå¦‚ <code>topojson-client</code>ã€<code>topojson-server</code>ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-12">å…³é”®å·®å¼‚æ€»ç»“</h3>
<ol>
<li><strong>ä½“ç§¯å·®å¼‚</strong>ï¼šTopoJSON æ˜¯ GeoJSON çš„ã€Œå‹ç¼©ç‰ˆã€ï¼Œå¯¹äºåŒ…å«å¤§é‡å…±äº«è¾¹ç•Œçš„æ•°æ®é›†ï¼ˆå¦‚ä¸–ç•Œåœ°å›¾ã€å…¨å›½çœä»½åœ°å›¾ï¼‰ï¼Œä½“ç§¯ä¼˜åŠ¿æä¸ºæ˜æ˜¾ï¼›</li>
<li><strong>ä½¿ç”¨æˆæœ¬</strong>ï¼šGeoJSON å¼€ç®±å³ç”¨ï¼ŒTopoJSON éœ€ã€Œè½¬æ¢æ­¥éª¤ã€ï¼ˆå¼€å‘ä¸­éœ€é›†æˆè½¬æ¢é€»è¾‘ï¼‰ï¼›</li>
<li><strong>åŠŸèƒ½è¾¹ç•Œ</strong>ï¼šGeoJSON èšç„¦ã€Œæ•°æ®äº¤æ¢ã€ï¼ŒTopoJSON èšç„¦ã€Œé«˜æ•ˆå­˜å‚¨+æ‹“æ‰‘åˆ†æã€ã€‚</li>
</ol>
<h2 data-id="heading-13">ä¸‰ã€é€‚ç”¨åœºæ™¯ä¸ä»»åŠ¡éœ€æ±‚</h2>
<h3 data-id="heading-14">1. GeoJSON é€‚ç”¨åœºæ™¯</h3>
<h4 data-id="heading-15">ï¼ˆ1ï¼‰å°æ•°æ®é›†+å¿«é€Ÿå¼€å‘åœºæ™¯</h4>
<ul>
<li><strong>åŸå‹å¼€å‘</strong>ï¼šå¿«é€ŸéªŒè¯åœ°å›¾å¯è§†åŒ–åŠŸèƒ½ï¼ˆå¦‚æ ‡è®°åº—é“ºä½ç½®ã€ç»˜åˆ¶ç®€å•è·¯å¾„ï¼‰ï¼Œæ— éœ€å…³æ³¨æ•°æ®ä½“ç§¯ï¼›</li>
<li><strong>å°è§„æ¨¡ç©ºé—´æ•°æ®äº¤æ¢</strong>ï¼šå¦‚æ¥å£è¿”å›å•ä¸ªåŸå¸‚çš„POIç‚¹ï¼ˆå…´è¶£ç‚¹ï¼‰ã€ç”¨æˆ·ä¸Šä¼ çš„è‡ªå®šä¹‰è·¯çº¿æ•°æ®ï¼›</li>
<li><strong>ç®€å•å¯è§†åŒ–éœ€æ±‚</strong>ï¼šå¦‚ ECharts åœ°å›¾ç»„ä»¶ã€Leaflet åŸºç¡€åœ°å›¾æ ‡è®°ï¼Œæ•°æ®é‡åœ¨åƒçº§ä»¥å†…ï¼ˆæ— æ˜æ˜¾æ€§èƒ½é—®é¢˜ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-16">ï¼ˆ2ï¼‰æ— éœ€æ‹“æ‰‘å…³ç³»çš„åœºæ™¯</h4>
<ul>
<li>ä»…éœ€å±•ç¤ºåœ°ç†å¯¹è±¡çš„ã€Œä½ç½®å’Œå±æ€§ã€ï¼ˆå¦‚æ ‡æ³¨å…¬äº¤ç«™ç‚¹ã€æ˜¾ç¤ºåŒºåŸŸåç§°ï¼‰ï¼Œä¸æ¶‰åŠè¾¹ç•Œå…±äº«ã€ç©ºé—´åˆ†æï¼›</li>
<li>å¤šç³»ç»Ÿæ•°æ®äº¤äº’ï¼ˆå¦‚åç«¯æ¥å£è¿”å›åœ°ç†æ•°æ®ç»™å‰ç«¯ï¼Œè·¨è¯­è¨€/è·¨æ¡†æ¶å…¼å®¹ä¼˜å…ˆï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-17">ï¼ˆ3ï¼‰æ¨èå·¥å…·/åº“</h4>
<ul>
<li>è§£æï¼šåŸç”Ÿ JSON è§£æå™¨ï¼ˆPython <code>json</code> æ¨¡å—ã€Golang <code>encoding/json</code>ï¼‰+ ç©ºé—´åº“ï¼ˆGeoPandasã€Shapelyï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼šLeafletã€Mapbox GL JSã€EChartsã€Matplotlibã€‚</li>
</ul>
<h3 data-id="heading-18">2. TopoJSON é€‚ç”¨åœºæ™¯</h3>
<h4 data-id="heading-19">ï¼ˆ1ï¼‰å¤§æ•°æ®é‡åœ°å›¾å¯è§†åŒ–</h4>
<ul>
<li><strong>å¤§è§„æ¨¡åŒºåŸŸæ•°æ®</strong>ï¼šå¦‚ä¸–ç•Œå„å›½ã€å…¨å›½çœä»½/å¸‚åŒºã€å¤æ‚è·¯ç½‘æ•°æ®ï¼ˆè¾¹ç•Œé‡å¤å¤šï¼Œå‹ç¼©æ•ˆæœæ˜¾è‘—ï¼‰ï¼›</li>
<li><strong>é«˜æ€§èƒ½åŠ è½½éœ€æ±‚</strong>ï¼šå¦‚ç§»åŠ¨ç«¯åœ°å›¾ã€Web ç«¯å¤§æ•°æ®é‡åœ°å›¾ï¼ˆå‡å°‘ç½‘ç»œä¼ è¾“æ—¶é—´ï¼Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-20">ï¼ˆ2ï¼‰éœ€è¦æ‹“æ‰‘å…³ç³»çš„ç©ºé—´åˆ†æ</h4>
<ul>
<li>ç©ºé—´å…³ç³»åˆ¤æ–­ï¼šå¦‚åˆ¤æ–­ä¸¤ä¸ªåŒºåŸŸæ˜¯å¦ç›¸é‚»ã€è®¡ç®—å…±äº«è¾¹ç•Œé•¿åº¦ï¼›</li>
<li>åœ°ç†æ•°æ®å¤„ç†ï¼šå¦‚åˆå¹¶ç›¸é‚»åŒºåŸŸã€æ‹†åˆ†å¤æ‚å¤šè¾¹å½¢ã€æ‹“æ‰‘çº é”™ï¼ˆå¦‚æ¶ˆé™¤é‡å è¾¹ç•Œï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-21">ï¼ˆ3ï¼‰ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–åœºæ™¯</h4>
<ul>
<li>æ­£å¼ä¸Šçº¿çš„åœ°å›¾åº”ç”¨ï¼ˆå¦‚æ‰“è½¦è½¯ä»¶çš„åŒºåŸŸåˆ’åˆ†ã€ç‰©æµé…é€èŒƒå›´å±•ç¤ºï¼‰ï¼Œéœ€å¹³è¡¡åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒï¼›</li>
<li>æ•°æ®å­˜å‚¨ä¼˜åŒ–ï¼ˆå¦‚æœåŠ¡å™¨å­˜å‚¨å¤§é‡åœ°ç†æ•°æ®ï¼Œå‡å°‘ç£ç›˜å ç”¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-22">ï¼ˆ4ï¼‰æ¨èå·¥å…·/åº“</h4>
<ul>
<li>è½¬æ¢ï¼š<code>topojson-client</code>ï¼ˆå‰ç«¯è½¬æ¢ï¼‰ã€<code>GeoPandas</code>ï¼ˆPythonï¼š<code>geopandas.read_file()</code> æ”¯æŒç›´æ¥è¯»å– TopoJSONï¼‰ã€<code>topojson-server</code>ï¼ˆåç«¯ç”Ÿæˆ TopoJSONï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼šD3.jsï¼ˆåŸç”Ÿæ”¯æŒ TopoJSONï¼Œé€‚åˆå®šåˆ¶åŒ–åœ°å›¾ï¼‰ã€Mapbox GL JSï¼ˆéœ€å…ˆè½¬æ¢ä¸º GeoJSONï¼‰ï¼›</li>
<li>ç”Ÿæˆï¼š<code>ogr2ogr</code>ï¼ˆGDAL å·¥å…·é›†ï¼Œæ”¯æŒæ‰¹é‡å°† Shapefile è½¬æ¢ä¸º TopoJSONï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-23">å››ã€å¼€å‘å®è·µé€‰æ‹©å»ºè®®</h2>
<ol>
<li>
<p><strong>ä¼˜å…ˆé€‰ GeoJSON çš„æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>æ•°æ®é‡å°ï¼ˆå¦‚ &lt;1 ä¸‡æ¡è¦ç´ ï¼‰ã€å¼€å‘å‘¨æœŸçŸ­ã€éœ€è¦å¿«é€Ÿè¿­ä»£ï¼›</li>
<li>è·¨ç³»ç»Ÿæ•°æ®äº¤äº’ï¼ˆå…¼å®¹æ€§ä¼˜å…ˆï¼‰ï¼›</li>
<li>ä»…éœ€åŸºç¡€å¯è§†åŒ–ï¼Œæ— éœ€æ‹“æ‰‘åˆ†æã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¼˜å…ˆé€‰ TopoJSON çš„æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>æ•°æ®é‡åºå¤§ï¼ˆå¦‚å…¨å›½/å…¨çƒåœ°å›¾ã€å¤æ‚è·¯ç½‘ï¼‰ï¼Œéœ€ä¼˜åŒ–åŠ è½½é€Ÿåº¦ï¼›</li>
<li>æ¶‰åŠè¾¹ç•Œå…±äº«çš„ç©ºé—´åˆ†æï¼ˆå¦‚åŒºåŸŸç›¸é‚»åˆ¤æ–­ã€è¾¹ç•Œåˆå¹¶ï¼‰ï¼›</li>
<li>ç”Ÿäº§ç¯å¢ƒï¼Œå¯¹æ€§èƒ½å’Œå­˜å‚¨å ç”¨æœ‰ä¸¥æ ¼è¦æ±‚ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ··åˆä½¿ç”¨æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>åç«¯å­˜å‚¨ï¼šä½¿ç”¨ TopoJSON å‹ç¼©å­˜å‚¨ï¼Œå‡å°‘ç£ç›˜å ç”¨å’Œä¼ è¾“å¸¦å®½ï¼›</li>
<li>å‰ç«¯ä½¿ç”¨ï¼šé€šè¿‡ <code>topojson-client</code> å®æ—¶è½¬æ¢ä¸º GeoJSON åæ¸²æŸ“ï¼Œå…¼é¡¾æ€§èƒ½å’Œå¼€å‘æ•ˆç‡ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-24">äº”ã€å·¥å…·é“¾æ¨èï¼ˆPython/Golang å¼€å‘è€…ï¼‰</h2>
<h3 data-id="heading-25">Python ç”Ÿæ€</h3>
<ul>
<li>è§£æ/è½¬æ¢ï¼š<code>GeoPandas</code>ï¼ˆ<code>gpd.read_file("data.topo.json")</code> ç›´æ¥è¯»å–ï¼Œ<code>gpd.to_file("data.geojson")</code> è½¬æ¢ï¼‰ã€<code>topojson</code>ï¼ˆ<code>topojson.convert()</code> å®ç° GeoJSON è½¬ TopoJSONï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼š<code>folium</code>ï¼ˆLeaflet å°è£…ï¼‰ã€<code>plotly</code>ï¼ˆäº¤äº’å¼åœ°å›¾ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-26">Golang ç”Ÿæ€</h3>
<ul>
<li>è§£æï¼š<code>github.com/paulmach/orb</code>ï¼ˆGeoJSON è§£æä¸ç©ºé—´æ“ä½œï¼‰ã€<code>github.com/topojson/topojson-go</code>ï¼ˆTopoJSON è½¬æ¢ï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼š<code>github.com/go-echarts/go-echarts</code>ï¼ˆåœ°å›¾ç»„ä»¶ï¼‰ã€<code>github.com/paulmach/osm</code>ï¼ˆç»“åˆ OpenStreetMap æ•°æ®ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-27">æ€»ç»“</h2>
<p>GeoJSON æ˜¯ã€Œç®€å•æ˜“ç”¨çš„åœ°ç†æ•°æ®äº¤æ¢æ ‡å‡†ã€ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ã€å°è§„æ¨¡æ•°æ®åœºæ™¯ï¼›TopoJSON æ˜¯ã€Œé«˜æ•ˆå‹ç¼©çš„æ‹“æ‰‘æ•°æ®æ ¼å¼ã€ï¼Œé€‚åˆå¤§æ•°æ®é‡ã€é«˜æ€§èƒ½ã€å¤æ‚ç©ºé—´åˆ†æåœºæ™¯ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œéœ€æ ¹æ®æ•°æ®è§„æ¨¡ã€æ€§èƒ½éœ€æ±‚ã€å¼€å‘æˆæœ¬é€‰æ‹©åˆé€‚çš„æ ¼å¼â€”â€”å°é¡¹ç›®ä¼˜å…ˆ GeoJSON æå‡æ•ˆç‡ï¼Œå¤§é¡¹ç›®ä¼˜å…ˆ TopoJSON ä¼˜åŒ–æ€§èƒ½ï¼Œæ··åˆä½¿ç”¨æ–¹æ¡ˆåˆ™å¯å…¼é¡¾ä¸¤è€…ä¼˜åŠ¿ã€‚</p>
<p>æŒæ¡ä¸¤è€…çš„è½¬æ¢é€»è¾‘å’Œç”Ÿæ€å·¥å…·ï¼Œèƒ½è®©åœ°ç†ä¿¡æ¯å¼€å‘æ›´é«˜æ•ˆã€æ›´çµæ´»ï¼Œå°¤å…¶åœ¨åœ°å›¾å¯è§†åŒ–ã€ç©ºé—´æ•°æ®æ¥å£å¼€å‘ç­‰åœºæ™¯ä¸­ï¼Œå¯æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaï¼šç†è§£æ•°æ®ç±»å‹å’Œå˜é‡]]></title>    <link>https://juejin.cn/post/7579507023507800127</link>    <guid>https://juejin.cn/post/7579507023507800127</guid>    <pubDate>2025-12-03T13:17:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023507800127" data-draft-id="7579507023507718207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaï¼šç†è§£æ•°æ®ç±»å‹å’Œå˜é‡"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-03T13:17:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaï¼šç†è§£æ•°æ®ç±»å‹å’Œå˜é‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:17:42.000Z" title="Wed Dec 03 2025 13:17:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">Javaçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ8ä¸ªï¼‰</h2>
<p>Javaæœ‰8ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæˆ‘æŠŠå®ƒä»¬åˆ†æˆ4ç»„</p>
<h3 data-id="heading-1">ç¬¬1ç»„ï¼šæ•´æ•°ç»„ï¼ˆå­˜æ•´æ•°ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegerTypes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æ•´æ•°ç»„æˆå‘˜ ==="</span>);
        
        <span class="hljs-comment">// 1. byteï¼šæœ€å°çš„æ•´å‹ï¼Œé€‚åˆå­˜å°æ•°å­—</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">myByte</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;              <span class="hljs-comment">// èŒƒå›´ï¼š-128 ~ 127</span>
        System.out.println(<span class="hljs-string">"byteå€¼: "</span> + myByte + <span class="hljs-string">" (å ç”¨1ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// 2. shortï¼šçŸ­æ•´å‹ï¼Œæ¯”byteå¤§ä¸€ç‚¹</span>
        <span class="hljs-type">short</span> <span class="hljs-variable">myShort</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>;          <span class="hljs-comment">// èŒƒå›´ï¼š-32768 ~ 32767</span>
        System.out.println(<span class="hljs-string">"shortå€¼: "</span> + myShort + <span class="hljs-string">" (å ç”¨2ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// 3. intï¼šæœ€å¸¸ç”¨çš„æ•´å‹ï¼ˆé»˜è®¤é€‰æ‹©ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">myInt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000000</span>;            <span class="hljs-comment">// èŒƒå›´ï¼šçº¦Â±21äº¿</span>
        System.out.println(<span class="hljs-string">"intå€¼: "</span> + myInt + <span class="hljs-string">" (å ç”¨4ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// 4. longï¼šå¤§æ•´æ•°ï¼Œæ•°å­—åè¦åŠ L</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">myLong</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000000000L</span>;     <span class="hljs-comment">// èŒƒå›´ï¼šéå¸¸å¤§ï¼</span>
        System.out.println(<span class="hljs-string">"longå€¼: "</span> + myLong + <span class="hljs-string">" (å ç”¨8ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šå­¦ç”Ÿä¿¡æ¯</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">studentAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;          <span class="hljs-comment">// å¹´é¾„ç”¨byteè¶³å¤Ÿ</span>
        <span class="hljs-type">short</span> <span class="hljs-variable">studentId</span> <span class="hljs-operator">=</span> <span class="hljs-number">12345</span>;       <span class="hljs-comment">// å­¦å·ç”¨short</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">population</span> <span class="hljs-operator">=</span> <span class="hljs-number">1400000000</span>;   <span class="hljs-comment">// ä¸­å›½äººå£ï¼Œç”¨int</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">worldPopulation</span> <span class="hljs-operator">=</span> <span class="hljs-number">7800000000L</span>; <span class="hljs-comment">// ä¸–ç•Œäººå£ï¼Œç”¨long</span>
    }
}
</code></pre>
<h3 data-id="heading-2">ç¬¬2ç»„ï¼šæµ®ç‚¹ç»„ï¼ˆå­˜å°æ•°ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FloatTypes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æµ®ç‚¹ç»„æˆå‘˜ ==="</span>);
        
        <span class="hljs-comment">// 1. floatï¼šå•ç²¾åº¦å°æ•°ï¼Œæ•°å­—åè¦åŠ F</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">myFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14F</span>;          <span class="hljs-comment">// ç²¾åº¦çº¦6-7ä½å°æ•°</span>
        System.out.println(<span class="hljs-string">"floatå€¼: "</span> + myFloat + <span class="hljs-string">" (å ç”¨4ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// 2. doubleï¼šåŒç²¾åº¦å°æ•°ï¼ˆé»˜è®¤é€‰æ‹©ï¼‰</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">myDouble</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.1415926535</span>; <span class="hljs-comment">// ç²¾åº¦çº¦15ä½å°æ•°</span>
        System.out.println(<span class="hljs-string">"doubleå€¼: "</span> + myDouble + <span class="hljs-string">" (å ç”¨8ä¸ªå­—èŠ‚)"</span>);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè´­ç‰©è®¡ç®—</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">applePrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">5.99F</span>;       <span class="hljs-comment">// è‹¹æœå•ä»·</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">totalCost</span> <span class="hljs-operator">=</span> applePrice * <span class="hljs-number">2.5</span>; <span class="hljs-comment">// æ€»ä»·</span>
        System.out.println(<span class="hljs-string">"2.5æ–¤è‹¹æœæ€»ä»·: "</span> + totalCost + <span class="hljs-string">"å…ƒ"</span>);
        
        <span class="hljs-comment">// ç§‘å­¦è®¡ç®—ç¤ºä¾‹</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">pi</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.141592653589793</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">earthRadius</span> <span class="hljs-operator">=</span> <span class="hljs-number">6371.0</span>;    <span class="hljs-comment">// åœ°çƒåŠå¾„ï¼ˆå…¬é‡Œï¼‰</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">circleArea</span> <span class="hljs-operator">=</span> pi * earthRadius * earthRadius;
        System.out.println(<span class="hljs-string">"åœ°çƒè¡¨é¢ç§¯çº¦: "</span> + circleArea + <span class="hljs-string">"å¹³æ–¹å…¬é‡Œ"</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">ç¬¬3ç»„ï¼šå­—ç¬¦ç»„ï¼ˆå­˜å•ä¸ªå­—ç¬¦ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CharType</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å­—ç¬¦ç±»å‹ ==="</span>);
        
        <span class="hljs-comment">// charï¼šå­˜å•ä¸ªå­—ç¬¦ï¼Œç”¨å•å¼•å·</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">myChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">chineseChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'æˆ‘'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">numberChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'7'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">symbolChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'@'</span>;
        
        System.out.println(<span class="hljs-string">"è‹±æ–‡å­—æ¯: "</span> + myChar);
        System.out.println(<span class="hljs-string">"ä¸­æ–‡å­—ç¬¦: "</span> + chineseChar);
        System.out.println(<span class="hljs-string">"æ•°å­—å­—ç¬¦: "</span> + numberChar);
        System.out.println(<span class="hljs-string">"ç¬¦å·å­—ç¬¦: "</span> + symbolChar);
        
        <span class="hljs-comment">// charå¯ä»¥å­˜å‚¨Unicodeå­—ç¬¦</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">heart</span> <span class="hljs-operator">=</span> <span class="hljs-string">'\u2764'</span>;  <span class="hljs-comment">// å¿ƒå½¢ç¬¦å·çš„Unicode</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">smiley</span> <span class="hljs-operator">=</span> <span class="hljs-string">'\u263A'</span>; <span class="hljs-comment">// ç¬‘è„¸ç¬¦å·çš„Unicode</span>
        System.out.println(<span class="hljs-string">"ç‰¹æ®Šç¬¦å·: "</span> + heart + <span class="hljs-string">" "</span> + smiley);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šå¯†ç éªŒè¯</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">firstChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'a'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">lastChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'z'</span>;
        System.out.println(<span class="hljs-string">"å­—æ¯èŒƒå›´: "</span> + firstChar + <span class="hljs-string">" åˆ° "</span> + lastChar);
        
        <span class="hljs-comment">// charå’Œintçš„è½¬æ¢</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">letter</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">asciiValue</span> <span class="hljs-operator">=</span> letter;  <span class="hljs-comment">// è‡ªåŠ¨è½¬æ¢ä¸ºASCIIç </span>
        System.out.println(<span class="hljs-string">"å­—ç¬¦'A'çš„ASCIIç æ˜¯: "</span> + asciiValue);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">66</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">correspondingChar</span> <span class="hljs-operator">=</span> (<span class="hljs-type">char</span>) number; <span class="hljs-comment">// å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦</span>
        System.out.println(<span class="hljs-string">"ASCIIç 66å¯¹åº”çš„å­—ç¬¦æ˜¯: "</span> + correspondingChar);
    }
}
</code></pre>
<h3 data-id="heading-4">ç¬¬4ç»„ï¼šå¸ƒå°”ç»„ï¼ˆçœŸå‡åˆ¤æ–­ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BooleanType</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å¸ƒå°”ç±»å‹ ==="</span>);
        
        <span class="hljs-comment">// booleanï¼šåªæœ‰ä¸¤ä¸ªå€¼ true æˆ– false</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isJavaFun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFishFly</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        System.out.println(<span class="hljs-string">"å­¦Javaæœ‰è¶£å—ï¼Ÿ"</span> + isJavaFun);
        System.out.println(<span class="hljs-string">"é±¼ä¼šé£å—ï¼Ÿ"</span> + isFishFly);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šæ¡ä»¶åˆ¤æ–­</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isRaining</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasUmbrella</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        System.out.println(<span class="hljs-string">"æ­£åœ¨ä¸‹é›¨: "</span> + isRaining);
        System.out.println(<span class="hljs-string">"æœ‰é›¨ä¼: "</span> + hasUmbrella);
        
        <span class="hljs-keyword">if</span> (isRaining &amp;&amp; !hasUmbrella) {
            System.out.println(<span class="hljs-string">"ç»“è®ºï¼šä½ ä¼šè¢«æ·‹æ¹¿ï¼"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"ç»“è®ºï¼šä½ ä¸ä¼šè¢«æ·‹æ¹¿ï¼"</span>);
        }
        
        <span class="hljs-comment">// æ›´å¤šå®é™…ä¾‹å­</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isWeekend</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSunny</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isHoliday</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldGoOut</span> <span class="hljs-operator">=</span> isWeekend &amp;&amp; isSunny;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">canSleepLate</span> <span class="hljs-operator">=</span> isWeekend || isHoliday;
        
        System.out.println(<span class="hljs-string">"åº”è¯¥å‡ºå»ç©å—ï¼Ÿ"</span> + shouldGoOut);
        System.out.println(<span class="hljs-string">"å¯ä»¥ç¡æ‡’è§‰å—ï¼Ÿ"</span> + canSleepLate);
    }
}
</code></pre>
<h2 data-id="heading-5">å˜é‡ï¼šæ•°æ®çš„"å­˜å‚¨ç›’å­"</h2>
<h3 data-id="heading-6">å˜é‡ä¸‰è¦ç´ ï¼šç±»å‹ã€åå­—ã€å€¼</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VariableDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å˜é‡åŸºç¡€ ==="</span>);
        
        <span class="hljs-comment">// å˜é‡å£°æ˜ä¸‰éƒ¨æ›²</span>
        <span class="hljs-comment">// 1. å£°æ˜å˜é‡ï¼ˆåˆ›å»ºç›’å­ï¼‰</span>
        <span class="hljs-type">int</span> age;
        
        <span class="hljs-comment">// 2. èµ‹å€¼ï¼ˆå¾€ç›’å­é‡Œæ”¾ä¸œè¥¿ï¼‰</span>
        age = <span class="hljs-number">18</span>;
        
        <span class="hljs-comment">// 3. ä½¿ç”¨å˜é‡ï¼ˆä»ç›’å­é‡Œå–ä¸œè¥¿ï¼‰</span>
        System.out.println(<span class="hljs-string">"æˆ‘çš„å¹´é¾„æ˜¯: "</span> + age + <span class="hljs-string">"å²"</span>);
        
        <span class="hljs-comment">// ä¹Ÿå¯ä»¥ä¸€æ­¥åˆ°ä½</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"å°æ˜"</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> <span class="hljs-number">175.5</span>;
        
        System.out.println(<span class="hljs-string">"å§“å: "</span> + name);
        System.out.println(<span class="hljs-string">"èº«é«˜: "</span> + height + <span class="hljs-string">"å˜ç±³"</span>);
        
        <span class="hljs-comment">// å˜é‡å¯ä»¥é‡æ–°èµ‹å€¼ï¼ˆä½†ç±»å‹ä¸èƒ½å˜ï¼‰</span>
        age = <span class="hljs-number">19</span>;  <span class="hljs-comment">// âœ… æ­£ç¡®ï¼šæ”¹å˜ç›’å­çš„å†…å®¹</span>
        System.out.println(<span class="hljs-string">"ä¸€å¹´åï¼Œæˆ‘çš„å¹´é¾„æ˜¯: "</span> + age + <span class="hljs-string">"å²"</span>);
        
        <span class="hljs-comment">// age = "åä¹å²";  // âŒ é”™è¯¯ï¼šä¸èƒ½æ”¹å˜ç›’å­çš„ç±»å‹</span>
    }
}
</code></pre>
<h3 data-id="heading-7">å˜é‡å‘½åè§„åˆ™ï¼ˆé‡è¦ï¼ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NamingRules</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å˜é‡å‘½åè§„åˆ™ ==="</span>);
        
        <span class="hljs-comment">// âœ… æ­£ç¡®çš„å‘½åæ–¹å¼</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;                    <span class="hljs-comment">// ç®€å•æ¸…æ™°</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">studentName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"å¼ ä¸‰"</span>;     <span class="hljs-comment">// é©¼å³°å‘½åæ³•</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">totalPrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">99.99</span>;       <span class="hljs-comment">// æè¿°æ€§åç§°</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isPassed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;         <span class="hljs-comment">// å¸ƒå°”å˜é‡ç”¨is/haså¼€å¤´</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">PI</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14159</span>;       <span class="hljs-comment">// å¸¸é‡å…¨å¤§å†™</span>
        
        <span class="hljs-comment">// âŒ é”™è¯¯çš„å‘½åæ–¹å¼ï¼ˆä¸è¦è¿™æ ·åšï¼ï¼‰</span>
        <span class="hljs-comment">// int 1age = 18;                 // ä¸èƒ½ä»¥æ•°å­—å¼€å¤´</span>
        <span class="hljs-comment">// String student name = "æå››";  // ä¸èƒ½æœ‰ç©ºæ ¼</span>
        <span class="hljs-comment">// double class = 3.14;           // ä¸èƒ½ç”¨å…³é”®å­—</span>
        <span class="hljs-comment">// int a = 10;                    // å¤ªç®€å•ï¼Œæ²¡æ„ä¹‰</span>
        
        <span class="hljs-comment">// å¥½çš„å‘½åç¤ºä¾‹</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfStudents</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>;       <span class="hljs-comment">// æ¸…æ™°æ˜“æ‡‚</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">85.5</span>;      <span class="hljs-comment">// ä¸€çœ‹å°±çŸ¥é“æ˜¯ä»€ä¹ˆ</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasPermission</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;    <span class="hljs-comment">// å¸ƒå°”å˜é‡å‘½åè§„èŒƒ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/home/user"</span>;  <span class="hljs-comment">// æè¿°æ¸…æ¥š</span>
        
        System.out.println(<span class="hljs-string">"å¥½åå­—è®©ä»£ç æ›´æ˜“è¯»ï¼"</span>);
    }
}
</code></pre>
<h2 data-id="heading-8">ç±»å‹è½¬æ¢ï¼šæ•°æ®ç±»å‹çš„"å˜å½¢æœ¯"</h2>
<h3 data-id="heading-9">è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆå°è½¬å¤§ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConversion</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== è‡ªåŠ¨ç±»å‹è½¬æ¢ ==="</span>);
        
        <span class="hljs-comment">// byte -&gt; short -&gt; int -&gt; long -&gt; float -&gt; double</span>
        <span class="hljs-comment">// char -&gt; int</span>
        <span class="hljs-comment">// å°ç±»å‹è‡ªåŠ¨è½¬å¤§ç±»å‹ï¼ˆå®‰å…¨è½¬æ¢ï¼‰</span>
        
        <span class="hljs-type">byte</span> <span class="hljs-variable">smallNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">bigNumber</span> <span class="hljs-operator">=</span> smallNumber;  <span class="hljs-comment">// byteè‡ªåŠ¨è½¬int</span>
        System.out.println(<span class="hljs-string">"byteè½¬int: "</span> + bigNumber);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> count;  <span class="hljs-comment">// intè‡ªåŠ¨è½¬double</span>
        System.out.println(<span class="hljs-string">"intè½¬double: "</span> + price);
        
        <span class="hljs-type">char</span> <span class="hljs-variable">letter</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">ascii</span> <span class="hljs-operator">=</span> letter;    <span class="hljs-comment">// charè‡ªåŠ¨è½¬int</span>
        System.out.println(<span class="hljs-string">"charè½¬int: "</span> + ascii);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—å¹³å‡å€¼</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">450</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">studentCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">average</span> <span class="hljs-operator">=</span> totalScore / (<span class="hljs-type">double</span>) studentCount; <span class="hljs-comment">// è‡ªåŠ¨è½¬æ¢</span>
        System.out.println(<span class="hljs-string">"å¹³å‡åˆ†: "</span> + average);
    }
}
</code></pre>
<h3 data-id="heading-10">å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆå¤§è½¬å°ï¼‰</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForceConversion</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å¼ºåˆ¶ç±»å‹è½¬æ¢ ==="</span>);
        
        <span class="hljs-comment">// å¤§ç±»å‹è½¬å°ç±»å‹éœ€è¦å¼ºåˆ¶è½¬æ¢ï¼ˆå¯èƒ½ä¸¢å¤±æ•°æ®ï¼‰</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">bigNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">99.99</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">smallNumber</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) bigNumber;  <span class="hljs-comment">// å¼ºåˆ¶è½¬æ¢ï¼Œå°æ•°éƒ¨åˆ†ä¸¢å¤±</span>
        System.out.println(<span class="hljs-string">"double 99.99 è½¬ int: "</span> + smallNumber);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">bigValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000L</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">normalValue</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) bigValue;   <span class="hljs-comment">// å¼ºåˆ¶è½¬æ¢</span>
        System.out.println(<span class="hljs-string">"longè½¬int: "</span> + normalValue);
        
        <span class="hljs-comment">// æ³¨æ„ï¼šè¶…å‡ºèŒƒå›´ä¼šå‡ºé—®é¢˜ï¼</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">largeInt</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">tinyByte</span> <span class="hljs-operator">=</span> (<span class="hljs-type">byte</span>) largeInt;    <span class="hljs-comment">// byteæœ€å¤§127ï¼Œè¿™é‡Œä¼šæº¢å‡º</span>
        System.out.println(<span class="hljs-string">"int 200 è½¬ byte: "</span> + tinyByte + <span class="hljs-string">" (æº¢å‡ºé”™è¯¯ï¼)"</span>);
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šå•†å“ä»·æ ¼å–æ•´</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">originalPrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">299.99</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">roundedPrice</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) originalPrice;  <span class="hljs-comment">// å»æ‰å°æ•°éƒ¨åˆ†</span>
        System.out.println(<span class="hljs-string">"åŸä»·: "</span> + originalPrice);
        System.out.println(<span class="hljs-string">"å–æ•´å: "</span> + roundedPrice);
    }
}
</code></pre>
<h2 data-id="heading-11">å¸¸é‡ï¼šä¸å˜çš„é‡</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å¸¸é‡ ==="</span>);
        
        <span class="hljs-comment">// ä½¿ç”¨finalå…³é”®å­—å®šä¹‰å¸¸é‡</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">PI</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.1415926535</span>;    <span class="hljs-comment">// æ•°å­¦å¸¸æ•°Ï€</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DAYS_IN_WEEK</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;        <span class="hljs-comment">// ä¸€å‘¨å¤©æ•°</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">COMPANY_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"é˜¿é‡Œå·´å·´"</span>; <span class="hljs-comment">// å…¬å¸åç§°</span>
        
        System.out.println(<span class="hljs-string">"åœ†å‘¨ç‡: "</span> + PI);
        System.out.println(<span class="hljs-string">"ä¸€å‘¨æœ‰ "</span> + DAYS_IN_WEEK + <span class="hljs-string">" å¤©"</span>);
        System.out.println(<span class="hljs-string">"å…¬å¸: "</span> + COMPANY_NAME);
        
        <span class="hljs-comment">// å¸¸é‡ä¸€æ—¦èµ‹å€¼å°±ä¸èƒ½ä¿®æ”¹</span>
        <span class="hljs-comment">// PI = 3.14;  // âŒ é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹å¸¸é‡</span>
        
        <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—åœ†é¢ç§¯</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> <span class="hljs-number">5.0</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">circleArea</span> <span class="hljs-operator">=</span> PI * radius * radius;
        System.out.println(<span class="hljs-string">"åŠå¾„ä¸º5çš„åœ†é¢ç§¯: "</span> + circleArea);
        
        <span class="hljs-comment">// é…ç½®ä¿¡æ¯ç”¨å¸¸é‡</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_LOGIN_ATTEMPTS</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DATABASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">DEBUG_MODE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        System.out.println(<span class="hljs-string">"æœ€å¤§ç™»å½•å°è¯•æ¬¡æ•°: "</span> + MAX_LOGIN_ATTEMPTS);
        System.out.println(<span class="hljs-string">"æ•°æ®åº“è¿æ¥: "</span> + DATABASE_URL);
        System.out.println(<span class="hljs-string">"è°ƒè¯•æ¨¡å¼: "</span> + DEBUG_MODE);
    }
}
</code></pre>
<h2 data-id="heading-12">ç»¼åˆå®æˆ˜ï¼šå­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿ</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentGradeSystem</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== å­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿ ==="</span>);
        
        <span class="hljs-comment">// å­¦ç”Ÿä¿¡æ¯ï¼ˆä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">studentName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"å¼ ä¸‰"</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">studentAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">studentId</span> <span class="hljs-operator">=</span> <span class="hljs-number">2023001</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">studentClass</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        
        <span class="hljs-comment">// å„ç§‘æˆç»©</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">chineseScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;      <span class="hljs-comment">// 0-100åˆ†ï¼Œç”¨byteè¶³å¤Ÿ</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">mathScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">92</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">englishScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">78</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">scienceScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;
        
        <span class="hljs-comment">// è®¡ç®—æ€»åˆ†å’Œå¹³å‡åˆ†</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> chineseScore + mathScore + englishScore + scienceScore;
        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> totalScore / <span class="hljs-number">4.0</span>;  <span class="hljs-comment">// ç”¨doubleå­˜å°æ•°</span>
        
        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦åŠæ ¼</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isPassed</span> <span class="hljs-operator">=</span> averageScore &gt;= <span class="hljs-number">60</span>;
        
        <span class="hljs-comment">// åˆ¤æ–­æˆç»©ç­‰çº§</span>
        <span class="hljs-type">char</span> grade;
        <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">90</span>) {
            grade = <span class="hljs-string">'A'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">80</span>) {
            grade = <span class="hljs-string">'B'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">70</span>) {
            grade = <span class="hljs-string">'C'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">60</span>) {
            grade = <span class="hljs-string">'D'</span>;
        } <span class="hljs-keyword">else</span> {
            grade = <span class="hljs-string">'F'</span>;
        }
        
        <span class="hljs-comment">// è¾“å‡ºå­¦ç”Ÿä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"===== å­¦ç”Ÿä¿¡æ¯ ====="</span>);
        System.out.println(<span class="hljs-string">"å§“å: "</span> + studentName);
        System.out.println(<span class="hljs-string">"å¹´é¾„: "</span> + studentAge);
        System.out.println(<span class="hljs-string">"å­¦å·: "</span> + studentId);
        System.out.println(<span class="hljs-string">"ç­çº§: "</span> + studentClass + <span class="hljs-string">"ç­"</span>);
        
        System.out.println(<span class="hljs-string">"\n===== æˆç»©å• ====="</span>);
        System.out.println(<span class="hljs-string">"è¯­æ–‡: "</span> + chineseScore + <span class="hljs-string">"åˆ†"</span>);
        System.out.println(<span class="hljs-string">"æ•°å­¦: "</span> + mathScore + <span class="hljs-string">"åˆ†"</span>);
        System.out.println(<span class="hljs-string">"è‹±è¯­: "</span> + englishScore + <span class="hljs-string">"åˆ†"</span>);
        System.out.println(<span class="hljs-string">"ç§‘å­¦: "</span> + scienceScore + <span class="hljs-string">"åˆ†"</span>);
        
        System.out.println(<span class="hljs-string">"\n===== ç»Ÿè®¡ ====="</span>);
        System.out.println(<span class="hljs-string">"æ€»åˆ†: "</span> + totalScore + <span class="hljs-string">"åˆ†"</span>);
        System.out.println(<span class="hljs-string">"å¹³å‡åˆ†: "</span> + averageScore + <span class="hljs-string">"åˆ†"</span>);
        System.out.println(<span class="hljs-string">"æ˜¯å¦åŠæ ¼: "</span> + (isPassed ? <span class="hljs-string">"æ˜¯"</span> : <span class="hljs-string">"å¦"</span>));
        System.out.println(<span class="hljs-string">"æˆç»©ç­‰çº§: "</span> + grade);
        
        <span class="hljs-comment">// ç±»å‹è½¬æ¢ç¤ºä¾‹</span>
        System.out.println(<span class="hljs-string">"\n===== ç±»å‹è½¬æ¢ç¤ºä¾‹ ====="</span>);
        <span class="hljs-type">double</span> <span class="hljs-variable">preciseAverage</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) totalScore / <span class="hljs-number">4</span>;  <span class="hljs-comment">// å¼ºåˆ¶è½¬æ¢</span>
        System.out.println(<span class="hljs-string">"ç²¾ç¡®å¹³å‡åˆ†: "</span> + preciseAverage);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">roundedAverage</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) averageScore;  <span class="hljs-comment">// å»æ‰å°æ•°éƒ¨åˆ†</span>
        System.out.println(<span class="hljs-string">"å–æ•´å¹³å‡åˆ†: "</span> + roundedAverage);
    }
}
</code></pre>
<h2 data-id="heading-13">å¸¸è§é”™è¯¯å’Œæ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-14">é”™è¯¯ç¤ºä¾‹ï¼š</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonMistakes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. æœªåˆå§‹åŒ–å°±ä½¿ç”¨å˜é‡</span>
        <span class="hljs-comment">// int x;</span>
        <span class="hljs-comment">// System.out.println(x);  // âŒ é”™è¯¯ï¼šå˜é‡æœªåˆå§‹åŒ–</span>
        
        <span class="hljs-comment">// 2. è¶…å‡ºæ•°æ®ç±»å‹èŒƒå›´</span>
        <span class="hljs-comment">// byte b = 200;  // âŒ é”™è¯¯ï¼šbyteæœ€å¤§127</span>
        <span class="hljs-comment">// int i = 10000000000;  // âŒ é”™è¯¯ï¼šè¶…å‡ºintèŒƒå›´</span>
        
        <span class="hljs-comment">// 3. ç±»å‹ä¸åŒ¹é…</span>
        <span class="hljs-comment">// int num = 3.14;  // âŒ é”™è¯¯ï¼šdoubleä¸èƒ½ç›´æ¥èµ‹ç»™int</span>
        <span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šint num = (int)3.14;</span>
        
        <span class="hljs-comment">// 4. ä½¿ç”¨é”™è¯¯çš„å­—é¢å€¼</span>
        <span class="hljs-comment">// long l = 10000000000;  // âŒ é”™è¯¯ï¼šéœ€è¦åŠ L</span>
        <span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šlong l = 10000000000L;</span>
        
        <span class="hljs-comment">// 5. å˜é‡åå†²çª</span>
        <span class="hljs-comment">// int age = 18;</span>
        <span class="hljs-comment">// int age = 20;  // âŒ é”™è¯¯ï¼šé‡å¤å®šä¹‰</span>
        
        System.out.println(<span class="hljs-string">"è®°ä½è¿™äº›å¸¸è§é”™è¯¯ï¼Œé¿å…è¸©å‘ï¼"</span>);
    }
}
</code></pre>
<h3 data-id="heading-15">æ­£ç¡®ç¤ºä¾‹ï¼š</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BestPractices</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æœ€ä½³å®è·µ ==="</span>);
        
        <span class="hljs-comment">// 1. é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;              <span class="hljs-comment">// âœ… å¹´é¾„ç”¨byteè¶³å¤Ÿ</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">population</span> <span class="hljs-operator">=</span> <span class="hljs-number">1400000000</span>; <span class="hljs-comment">// âœ… äººå£ç”¨int</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">19.99</span>;       <span class="hljs-comment">// âœ… ä»·æ ¼ç”¨double</span>
        
        <span class="hljs-comment">// 2. ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfStudents</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>;  <span class="hljs-comment">// âœ… æ¸…æ™°æ˜“æ‡‚</span>
        <span class="hljs-comment">// int n = 45;               // âŒ å¤ªç®€ç•¥</span>
        
        <span class="hljs-comment">// 3. åŠæ—¶åˆå§‹åŒ–å˜é‡</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;              <span class="hljs-comment">// âœ… å£°æ˜æ—¶å°±åˆå§‹åŒ–</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;           <span class="hljs-comment">// âœ… ç»™åˆå§‹å€¼</span>
        
        <span class="hljs-comment">// 4. å¸¸é‡ç”¨finalä¿®é¥°</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">TAX_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.13</span>;  <span class="hljs-comment">// âœ… ç¨ç‡æ˜¯å¸¸é‡</span>
        
        <span class="hljs-comment">// 5. æ³¨æ„ç±»å‹è½¬æ¢</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> / <span class="hljs-number">3.0</span>;   <span class="hljs-comment">// âœ… å¾—åˆ°3.333...</span>
        <span class="hljs-comment">// double result = 10 / 3;   // âŒ å¾—åˆ°3.0</span>
        
        System.out.println(<span class="hljs-string">"å¥½ä¹ æƒ¯è®©ç¼–ç¨‹æ›´è½»æ¾ï¼"</span>);
    }
}
</code></pre>
<h2 data-id="heading-16">æ€»ç»“ï¼šæœ€é‡è¦çš„ä¸‰ç‚¹</h2>
<ol>
<li>
<p><strong>é€‰æ‹©åˆé€‚çš„ç±»å‹</strong>ï¼šæ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®ç±»å‹</p>
<ul>
<li>æ•´æ•°ç”¨<code>int</code>ï¼Œå°æ•°ç”¨<code>double</code></li>
<li>çœŸå‡ç”¨<code>boolean</code>ï¼Œå­—ç¬¦ç”¨<code>char</code></li>
<li>å¤§æ•°å­—ç”¨<code>long</code>ï¼Œå°æ•°å­—ç”¨<code>byte</code></li>
</ul>
</li>
<li>
<p><strong>å˜é‡åè¦æœ‰æ„ä¹‰</strong>ï¼šè®©ä»£ç è‡ªå·±è¯´è¯</p>
<ul>
<li><code>age</code>æ¯”<code>a</code>å¥½</li>
<li><code>studentCount</code>æ¯”<code>sc</code>å¥½</li>
<li><code>isPassed</code>æ¯”<code>ip</code>å¥½</li>
</ul>
</li>
<li>
<p><strong>æ³¨æ„ç±»å‹è½¬æ¢</strong>ï¼šé¿å…æ•°æ®ä¸¢å¤±</p>
<ul>
<li>è‡ªåŠ¨è½¬æ¢ï¼šå°ç±»å‹è½¬å¤§ç±»å‹</li>
<li>å¼ºåˆ¶è½¬æ¢ï¼šå¤§ç±»å‹è½¬å°ç±»å‹ï¼ˆå°å¿ƒï¼ï¼‰</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot ThreadLocal çˆ¶å­çº¿ç¨‹ä¼ å€¼çš„å‡ ç§å®ç°æ–¹å¼]]></title>    <link>https://juejin.cn/post/7579519985699848198</link>    <guid>https://juejin.cn/post/7579519985699848198</guid>    <pubDate>2025-12-04T00:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579519985699848198" data-draft-id="7579101504289308726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot ThreadLocal çˆ¶å­çº¿ç¨‹ä¼ å€¼çš„å‡ ç§å®ç°æ–¹å¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-04T00:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£è±¡å—"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot ThreadLocal çˆ¶å­çº¿ç¨‹ä¼ å€¼çš„å‡ ç§å®ç°æ–¹å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£è±¡å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:05:07.000Z" title="Thu Dec 04 2025 00:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦åœ¨çˆ¶å­çº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®çš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€è¯·æ±‚IDã€é“¾è·¯è¿½è¸ªIDç­‰ã€‚</p>
<p>ThreadLocalä½œä¸ºJavaä¸­é‡è¦çš„çº¿ç¨‹æœ¬åœ°å˜é‡æœºåˆ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†åœ¨å•ä¸ªçº¿ç¨‹å†…å­˜å‚¨æ•°æ®çš„ä¾¿åˆ©ã€‚ä½†æ˜¯ï¼Œå½“æ¶‰åŠåˆ°çˆ¶å­çº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ é€’æ—¶ï¼ŒThreadLocalé»˜è®¤çš„è¡Œä¸ºå¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»åœ¨SpringBootåº”ç”¨ä¸­å®ç°ThreadLocalçˆ¶å­çº¿ç¨‹ä¼ å€¼çš„å‡ ç§æ–¹å¼ã€‚</p>
<h2 data-id="heading-1">ThreadLocal åŸºç¡€å›é¡¾</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ThreadLocalçš„åŸºæœ¬åŸç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; {
    <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ThreadLocalMap</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
            map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-keyword">else</span>
            createMap(t, value);
    }

    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
                <span class="hljs-keyword">return</span> result;
            }
        }
        <span class="hljs-keyword">return</span> setInitialValue();
    }
}
</code></pre>
<p>ThreadLocalçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„ThreadLocalMapï¼Œä»è€Œå®ç°çº¿ç¨‹éš”ç¦»ã€‚</p>
<h2 data-id="heading-2">é—®é¢˜çš„æå‡º</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ThreadLocalåœ¨çˆ¶å­çº¿ç¨‹ä¸­çš„é»˜è®¤è¡Œä¸º</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        threadLocal.set(<span class="hljs-string">"ä¸»çº¿ç¨‹çš„å€¼"</span>);
        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è·å–: "</span> + threadLocal.get()); <span class="hljs-comment">// è¾“å‡º: ä¸»çº¿ç¨‹çš„å€¼</span>

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"å­çº¿ç¨‹è·å–: "</span> + threadLocal.get()); <span class="hljs-comment">// è¾“å‡º: null</span>
        });
        childThread.start();
    }
}
</code></pre>
<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå­çº¿ç¨‹æ— æ³•è®¿é—®çˆ¶çº¿ç¨‹ä¸­è®¾ç½®çš„ThreadLocalå€¼ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ThreadLocalMapã€‚</p>
<h2 data-id="heading-3">è§£å†³æ–¹æ¡ˆä¸€ï¼šInheritableThreadLocal</h2>
<p>Javaä¸ºæˆ‘ä»¬æä¾›äº†InheritableThreadLocalæ¥è§£å†³çˆ¶å­çº¿ç¨‹ä¼ å€¼çš„é—®é¢˜</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> InheritableThreadLocal&lt;String&gt; inheritableThreadLocal =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        inheritableThreadLocal.set(<span class="hljs-string">"ä¸»çº¿ç¨‹çš„å€¼"</span>);
        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è·å–: "</span> + inheritableThreadLocal.get());

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"å­çº¿ç¨‹è·å–: "</span> + inheritableThreadLocal.get()); <span class="hljs-comment">// è¾“å‡º: ä¸»çº¿ç¨‹çš„å€¼</span>
        });
        childThread.start();
    }
}
</code></pre>
<h4 data-id="heading-4">InheritableThreadLocal åŸç†åˆ†æ</h4>
<p>InheritableThreadLocalçš„å®ç°åœ¨Threadç±»ä¸­</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-comment">// çˆ¶çº¿ç¨‹çš„inheritableThreadLocalsä¼šåœ¨åˆ›å»ºå­çº¿ç¨‹æ—¶å¤åˆ¶</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,
                      <span class="hljs-type">long</span> stackSize, AccessControlContext acc,
                      <span class="hljs-type">boolean</span> inheritThreadLocals)</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)
            <span class="hljs-built_in">this</span>.inheritableThreadLocals =
                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h4 data-id="heading-5">InheritableThreadLocal çš„å±€é™æ€§</h4>
<ul>
<li><strong>1. æ—¶æœºé™åˆ¶</strong>ï¼šåªåœ¨åˆ›å»ºçº¿ç¨‹æ—¶è¿›è¡Œå€¼ä¼ é€’ï¼Œåç»­ä¿®æ”¹ä¸ä¼šä¼ é€’åˆ°å·²åˆ›å»ºçš„å­çº¿ç¨‹</li>
<li><strong>2. çº¿ç¨‹æ± é—®é¢˜</strong>ï¼šåœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨æ—¶ï¼Œç”±äºçº¿ç¨‹ä¼šè¢«å¤ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ··ä¹±</li>
</ul>
<h2 data-id="heading-6">è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨TransmittableThreadLocal</h2>
<p>é˜¿é‡Œå·´å·´å¼€æºçš„TransmittableThreadLocalï¼ˆTTLï¼‰æ˜¯è§£å†³çº¿ç¨‹æ± åœºæ™¯ä¸‹çˆ¶å­çº¿ç¨‹ä¼ å€¼é—®é¢˜çš„ä¼˜ç§€æ–¹æ¡ˆï¼š</p>
<h4 data-id="heading-7">æ·»åŠ ä¾èµ–</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transmittable-thread-local<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">åŸºæœ¬ä½¿ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.ttl.TransmittableThreadLocal;
<span class="hljs-keyword">import</span> com.alibaba.ttl.threadpool.TtlExecutors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TransmittableThreadLocal&lt;String&gt; ttl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        ttl.set(<span class="hljs-string">"ä¸»çº¿ç¨‹çš„å€¼"</span>);
        System.out.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è·å–: "</span> + ttl.get());

        <span class="hljs-comment">// ä½¿ç”¨TTLè£…é¥°çš„çº¿ç¨‹æ± </span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> TtlExecutors.getTtlExecutorService(
            Executors.newFixedThreadPool(<span class="hljs-number">2</span>)
        );

        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± ä»»åŠ¡1è·å–: "</span> + ttl.get()); <span class="hljs-comment">// è¾“å‡º: ä¸»çº¿ç¨‹çš„å€¼</span>
        });

        <span class="hljs-comment">// ä¿®æ”¹å€¼åæäº¤æ–°ä»»åŠ¡</span>
        ttl.set(<span class="hljs-string">"æ›´æ–°åçš„å€¼"</span>);
        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"çº¿ç¨‹æ± ä»»åŠ¡2è·å–: "</span> + ttl.get()); <span class="hljs-comment">// è¾“å‡º: æ›´æ–°åçš„å€¼</span>
        });
    }
}
</code></pre>
<h4 data-id="heading-9">TTL ä¸Spring Bootçš„é›†æˆ</h4>
<p>åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é›†æˆTTL</p>
<h5 data-id="heading-10">1. é…ç½®TTLå¼‚æ­¥æ‰§è¡Œå™¨</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"Async-"</span>);

        <span class="hljs-comment">// ä½¿ç”¨TTLè£…é¥°</span>
        <span class="hljs-keyword">return</span> TtlExecutors.getTtlExecutor(executor);
    }
}
</code></pre>
<h5 data-id="heading-11">2. ä½¿ç”¨TTLçš„è¯·æ±‚æ‹¦æˆªå™¨</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlRequestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;String&gt; requestId =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        requestId.set(id);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        requestId.remove(); <span class="hljs-comment">// æ¸…ç†</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> requestId.get();
    }
}
</code></pre>
<h2 data-id="heading-12">è§£å†³æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰TaskDecorator</h2>
<p>Springæä¾›äº†TaskDecoratoræ¥å£ï¼Œå…è®¸æˆ‘ä»¬å¯¹Runnableä»»åŠ¡è¿›è¡Œè£…é¥°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"CustomAsync-"</span>);

        <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰è£…é¥°å™¨</span>
        executor.setTaskDecorator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextCopyingDecorator</span>());
        executor.initialize();

        <span class="hljs-keyword">return</span> executor;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextCopyingDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskDecorator</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Runnable <span class="hljs-title function_">decorate</span><span class="hljs-params">(Runnable runnable)</span> {
            <span class="hljs-comment">// è·å–çˆ¶çº¿ç¨‹çš„ThreadLocalä¸Šä¸‹æ–‡</span>
            Map&lt;String, Object&gt; context = getContextFromCurrentThread();
            <span class="hljs-keyword">return</span> () -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// åœ¨å­çº¿ç¨‹ä¸­å¤åˆ¶ä¸Šä¸‹æ–‡</span>
                    setContextToCurrentThread(context);
                    runnable.run();
                } <span class="hljs-keyword">finally</span> {
                    clearCurrentThreadContext();
                }
            };
        }

        <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getContextFromCurrentThread</span><span class="hljs-params">()</span> {
            Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-comment">// æ”¶é›†å½“å‰çº¿ç¨‹çš„ThreadLocalå€¼</span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šä»è‡ªå®šä¹‰çš„ThreadLocalä¸­è·å–</span>
            <span class="hljs-keyword">if</span> (UserContext.getUser() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"userInfo"</span>, UserContext.getUser());
            }
            <span class="hljs-keyword">if</span> (RequestContextHolder.getRequestAttributes() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"requestAttributes"</span>, RequestContextHolder.getRequestAttributes());
            }
            <span class="hljs-keyword">return</span> context;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContextToCurrentThread</span><span class="hljs-params">(Map&lt;String, Object&gt; context)</span> {
            <span class="hljs-comment">// åœ¨å­çº¿ç¨‹ä¸­è®¾ç½®ä¸Šä¸‹æ–‡</span>
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"userInfo"</span>)) {
                UserContext.setUser((UserContext.UserInfo) context.get(<span class="hljs-string">"userInfo"</span>));
            }
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"requestAttributes"</span>)) {
                RequestContextHolder.setRequestAttributes((RequestAttributes) context.get(<span class="hljs-string">"requestAttributes"</span>));
            }
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCurrentThreadContext</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// æ¸…ç†ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
            UserContext.clear();
            RequestContextHolder.resetRequestAttributes();
        }
    }
}
</code></pre>
<h2 data-id="heading-13">è§£å†³æ–¹æ¡ˆå››ï¼šä½¿ç”¨Springçš„RequestContextHolder</h2>
<p>åœ¨Spring Webåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨RequestContextHolderæ¥ä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextService</span> {

    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è·å–çˆ¶çº¿ç¨‹çš„è¯·æ±‚ä¸Šä¸‹æ–‡</span>
        <span class="hljs-type">RequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> RequestContextHolder.getRequestAttributes();

        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­è®¾ç½®ä¸Šä¸‹æ–‡</span>
            RequestContextHolder.setRequestAttributes(attributes);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doSomeWork();
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">finally</span> {
                RequestContextHolder.resetRequestAttributes();
            }
        });
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">doSomeWork</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è·å–è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯</span>
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>
            ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        <span class="hljs-keyword">return</span> <span class="hljs-string">"å¤„ç†å®Œæˆ: "</span> + request.getRequestURI();
    }
}
</code></pre>
<h2 data-id="heading-14">æ–¹æ¡ˆé€‰æ‹©å»ºè®®</h2>
<p>åŸºäºä¸Šè¿°æ€§èƒ½å¯¹æ¯”å’Œé€‚ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºä»¥ä¸‹é€‰æ‹©å»ºè®®ï¼š</p>
<ul>
<li><strong>1. ç®€å•çš„çˆ¶å­çº¿ç¨‹ä¼ å€¼</strong>ï¼šä½¿ç”¨InheritableThreadLocal</li>
<li><strong>2. çº¿ç¨‹æ± åœºæ™¯</strong>ï¼šæ¨èä½¿ç”¨TransmittableThreadLocal</li>
<li><strong>3. Springå¼‚æ­¥ä»»åŠ¡</strong>ï¼šä½¿ç”¨TaskDecorator</li>
<li><strong>4. Webåº”ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡</strong>ï¼šä½¿ç”¨RequestContextHolder</li>
</ul>
<h2 data-id="heading-15">æœ€ä½³å®è·µ</h2>
<h4 data-id="heading-16">1. å†…å­˜æ³„æ¼é¢„é˜²</h4>
<p>æ— è®ºä½¿ç”¨å“ªç§æ–¹æ¡ˆï¼Œéƒ½è¦æ³¨æ„åŠæ—¶æ¸…ç†ThreadLocalï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeThreadLocalUsage</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            threadLocal.set(someValue);
            <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
        } <span class="hljs-keyword">finally</span> {
            threadLocal.remove(); <span class="hljs-comment">// é˜²æ­¢å†…å­˜æ³„æ¼</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-17">2. ä¸Šä¸‹æ–‡å°è£…</h4>
<p>å»ºè®®å°è£…ä¸€ä¸ªç»Ÿä¸€çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;UserInfo&gt; USER_CONTEXT =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUser</span><span class="hljs-params">(UserInfo user)</span> {
        USER_CONTEXT.set(user);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserInfo <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> USER_CONTEXT.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        USER_CONTEXT.remove();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
        <span class="hljs-keyword">private</span> String userId;
        <span class="hljs-keyword">private</span> String userName;
        <span class="hljs-keyword">private</span> String requestId;
        <span class="hljs-comment">// getters and setters</span>
    }
}
</code></pre>
<h4 data-id="heading-18">3. æ‹¦æˆªå™¨ç»Ÿä¸€ç®¡ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContextInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> buildUserInfo(request);
        UserContext.setUser(userInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        UserContext.clear();
    }

    <span class="hljs-keyword">private</span> UserInfo <span class="hljs-title function_">buildUserInfo</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
        userInfo.setUserId(request.getHeader(<span class="hljs-string">"X-User-Id"</span>));
        userInfo.setRequestId(UUID.randomUUID().toString());
        <span class="hljs-keyword">return</span> userInfo;
    }
}
</code></pre>
<h2 data-id="heading-19">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†å››ç§åœ¨SpringBootä¸­å®ç°ThreadLocalçˆ¶å­çº¿ç¨‹ä¼ å€¼çš„æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>1. InheritableThreadLocal</strong>ï¼šæœ€ç®€å•çš„åŸç”Ÿè§£å†³æ–¹æ¡ˆï¼Œé€‚ç”¨äºåŸºç¡€åœºæ™¯</li>
<li><strong>2. TransmittableThreadLocal</strong>ï¼šåŠŸèƒ½å¼ºå¤§çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚åˆçº¿ç¨‹æ± åœºæ™¯</li>
<li><strong>3. TaskDecorator</strong>ï¼šSpringæä¾›çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆï¼Œé›†æˆåº¦é«˜</li>
<li><strong>4. RequestContextHolder</strong>ï¼šSpring Webåº”ç”¨çš„å†…ç½®æ–¹æ¡ˆ</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚</p>
<p>åŒæ—¶ï¼Œè¦æ³¨æ„å†…å­˜ç®¡ç†å’Œä¸Šä¸‹æ–‡æ¸…ç†ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è„±ç¦» SwiftUI ä¹Ÿèƒ½ç”¨ @Observableï¼šæ·±å…¥ç†è§£ withObservationTracking çš„ç©æ³•ã€å‘ç‚¹ä¸ Swift 6 çªå›´]]></title>    <link>https://juejin.cn/post/7579473409749614643</link>    <guid>https://juejin.cn/post/7579473409749614643</guid>    <pubDate>2025-12-04T00:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579473409749614643" data-draft-id="7550880849392599055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è„±ç¦» SwiftUI ä¹Ÿèƒ½ç”¨ @Observableï¼šæ·±å…¥ç†è§£ withObservationTracking çš„ç©æ³•ã€å‘ç‚¹ä¸ Swift 6 çªå›´"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-12-04T00:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è„±ç¦» SwiftUI ä¹Ÿèƒ½ç”¨ @Observableï¼šæ·±å…¥ç†è§£ withObservationTracking çš„ç©æ³•ã€å‘ç‚¹ä¸ Swift 6 çªå›´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:08:31.000Z" title="Thu Dec 04 2025 00:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>iOS 17 å¼•å…¥çš„ <code>@Observable</code> å®è®© SwiftUI åˆ·æ–°æœºåˆ¶å¤§å˜å¤©ï¼Œä½†å®˜æ–¹æ–‡æ¡£åªå‘Šè¯‰ä½ â€œåœ¨ View é‡Œç”¨å°±è¡Œâ€ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨ é SwiftUI åœºæ™¯ï¼ˆæ¯”å¦‚ NetworkLayerã€ViewModelã€Unit Testï¼‰é‡Œç›‘å¬å±æ€§å˜åŒ–ï¼Œå°±åªèƒ½é  <code>withObservationTracking</code>ã€‚</p>
<h2 data-id="heading-1">@Observable æ˜¯ä»€ä¹ˆ</h2>






























<table><thead><tr><th>ç‰¹æ€§</th><th>@Observable</th><th>ObservableObject + @Published</th></tr></thead><tbody><tr><td>é€‚ç”¨ç³»ç»Ÿ</td><td>iOS 17+</td><td>iOS 13+</td></tr><tr><td>åˆ·æ–°ç²’åº¦</td><td>å±æ€§çº§ï¼ˆä»…å˜æ›´çš„å±æ€§è§¦å‘è§†å›¾æ›´æ–°ï¼‰</td><td>å¯¹è±¡çº§ï¼ˆæ•´ä¸ª <code>ObjectWillChange</code> è§¦å‘æ›´æ–°ï¼‰</td></tr><tr><td>ä¾èµ–åè®®</td><td>æ— éœ€é¢å¤–åè®®</td><td>å¿…é¡»ç»§æ‰¿ <code>ObservableObject</code> åè®®</td></tr><tr><td>é SwiftUI ç›‘å¬</td><td>ä½¿ç”¨ <code>withObservationTracking</code> é—­åŒ…</td><td>ä½¿ç”¨ <code>objectWillChange</code> å‘å¸ƒè€…ï¼ˆPublisherï¼‰</td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š <code>@Observable</code> æ˜¯ Swift 5.9 å®åŠ æŒçš„â€œè½»é‡çº§å¯è§‚æµ‹å¯¹è±¡â€ï¼Œä¸“ä¸º SwiftUI ä¼˜åŒ–ï¼Œä½† å®æœ¬èº«ä¸é™åˆ¶ä½¿ç”¨åœºæ™¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹/ä»»æ„æ¨¡å—é‡Œæ‰‹åŠ¨è®¢é˜…ã€‚</p>
<h2 data-id="heading-2">withObservationTracking åŸç†è§£å‰–</h2>
<p>å‡½æ•°ç­¾åï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">withObservationTracking</span>&lt;<span class="hljs-type">T</span>&gt;(
  <span class="hljs-keyword">_</span> <span class="hljs-params">apply</span>: () -&gt; <span class="hljs-type">T</span>,          <span class="hljs-comment">// â‘  è®¿é—®å±æ€§ â†’ è¢«è®°å½•</span>
  <span class="hljs-params">onChange</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-meta">@Sendable</span> () -&gt; <span class="hljs-type">Void</span>  <span class="hljs-comment">// â‘¡ å±æ€§â€œå³å°†â€å˜æ—¶å›è°ƒ</span>
) -&gt; <span class="hljs-type">T</span>
</code></pre>
<p>å…³é”®è¡Œä¸ºï¼š</p>
<ol>
<li>apply é—­åŒ…é‡Œè®¿é—®åˆ°çš„ä»»ä½•è¢« <code>@Observable</code> æ ‡è®°ç±»çš„å­˜å‚¨å±æ€§ï¼Œéƒ½ä¼šè¢«åŠ å…¥â€œæœ¬æ¬¡è§‚æµ‹æ¸…å•â€ã€‚</li>
<li>å½“æ¸…å•é‡Œä»»æ„å±æ€§å‘ç”Ÿ willSet æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œ onChangeï¼›</li>
<li>onChange åªä¼šè¢«è§¦å‘ä¸€æ¬¡ï¼Œä¹‹åå¦‚æœæƒ³ç»§ç»­ç›‘å¬ï¼Œå¿…é¡»æ‰‹åŠ¨é‡æ–°è°ƒç”¨ <code>withObservationTracking</code>ï¼Œå³â€œé€’å½’è®¢é˜…â€ã€‚</li>
</ol>
<h2 data-id="heading-3">æœ€å°å¯è¿è¡Œç¤ºä¾‹</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">// 1. å£°æ˜è¢«è§‚æµ‹çš„æ¨¡å‹</span>
<span class="hljs-meta">@Observable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
}

<span class="hljs-comment">// 2. å£°æ˜ç›‘å¬è€…</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span> {
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) {
        <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter
    }
    
    <span class="hljs-comment">/// å¼€å§‹ç›‘å¬ï¼Œæ‰“å°æœ€æ–°å€¼</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">observe</span>() {
        <span class="hljs-comment">// â‘  apply é—­åŒ…ï¼šè¯»å–å±æ€§ â†’ è¢«ç³»ç»Ÿè®°å½•</span>
        <span class="hljs-comment">// â‘¡ onChangeï¼šcount å³å°†æ”¹å˜æ—¶è°ƒç”¨ï¼ˆæ—§å€¼ä»å¯è§ï¼‰</span>
        withObservationTracking {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰è®¡æ•°ï¼š<span class="hljs-subst">\(counter.count)</span>"</span>)
        } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// ç³»ç»Ÿåªç»™ä¸€æ¬¡é€šçŸ¥ï¼Œæƒ³æŒç»­ç›‘å¬å¿…é¡»é‡æ–°è°ƒç”¨ observe()</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ£€æµ‹åˆ°å˜åŒ–ï¼Œé‡æ–°è®¢é˜…"</span>)
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.observe()
        }
    }
}

<span class="hljs-comment">// 3. å®¢æˆ·ç«¯ä»£ç </span>
<span class="hljs-keyword">let</span> counter <span class="hljs-operator">=</span> <span class="hljs-type">Counter</span>()
<span class="hljs-keyword">let</span> observer <span class="hljs-operator">=</span> <span class="hljs-type">CounterObserver</span>(counter: counter)

<span class="hljs-comment">// å¯åŠ¨ç›‘å¬</span>
observer.observe()

<span class="hljs-comment">// åˆ¶é€ å˜åŒ–</span>
counter.count <span class="hljs-operator">=</span> <span class="hljs-number">1</span>   <span class="hljs-comment">// æ§åˆ¶å°ï¼šæ£€æµ‹åˆ°å˜åŒ–ï¼Œé‡æ–°è®¢é˜… â†’ å½“å‰è®¡æ•°ï¼š1</span>
counter.count <span class="hljs-operator">=</span> <span class="hljs-number">2</span>   <span class="hljs-comment">// åŒä¸Š</span>
</code></pre>
<h2 data-id="heading-4">å‘ç‚¹ 1ï¼šonChange ç»™å‡ºçš„æ˜¯â€œæ—§å€¼â€</h2>
<p>å› ä¸º onChange è§¦å‘åœ¨ willSet é˜¶æ®µï¼Œæ‰€ä»¥é—­åŒ…é‡Œå†è¯»å±æ€§ä»æ˜¯è€æ•°æ®ã€‚</p>
<p>è§£å†³æ€è·¯ï¼šæŠŠè¯»å–åŠ¨ä½œæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ª RunLoop â†’ æ‹¿åˆ° didSet ä¹‹åçš„æ–°å€¼ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">observe</span>() {
    withObservationTracking {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"RunLoop å‰è¯»å– â†’ æ—§å€¼ï¼š<span class="hljs-subst">\(counter.count)</span>"</span>)
    } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
        <span class="hljs-comment">// å…³é”®ï¼šå¼‚æ­¥åˆ°ä¸‹ä¸€è½®</span>
        <span class="hljs-type">DispatchQueue</span>.main.async {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"RunLoop åè¯»å– â†’ æ–°å€¼ï¼š<span class="hljs-subst">\(<span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.counter.count <span class="hljs-operator">??</span> <span class="hljs-operator">-</span><span class="hljs-number">1</span>)</span>"</span>)
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.observe() <span class="hljs-comment">// ç»§ç»­ç›‘å¬</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-5">å‘ç‚¹ 2ï¼šæ¨¡æ¿ä»£ç å¤ªå¤š â†’ äºŒæ¬¡å°è£…</h2>
<p>æ¯æ¬¡æ‰‹å†™â€œé€’å½’ + å¼‚æ­¥â€å¤ªçƒ¦ï¼Œå¯ä»¥æç‚¼æˆä¸€ä¸ªå¯é‡ç”¨çš„æ³›å‹åŠ©æ‰‹ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">/// è®©ä»»æ„é—­åŒ…â€œæŒç»­â€è¢«ç›‘å¬ï¼Œè‡ªåŠ¨ re-subscribe</span>
<span class="hljs-comment">/// - Parameter execute: éœ€è¦è·Ÿè¸ªå±æ€§çš„è¯»å–é—­åŒ…</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">keepObserving</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">AnyObject</span>&gt;(
    <span class="hljs-params">target</span>: <span class="hljs-type">T</span>,
    <span class="hljs-params">execute</span>: <span class="hljs-keyword">@escaping</span> <span class="hljs-meta">@Sendable</span> () -&gt; <span class="hljs-type">Void</span>
) {
    <span class="hljs-type">Observation</span>.withObservationTracking {
        execute()
    } onChange: {
        <span class="hljs-type">DispatchQueue</span>.main.async {
            keepObserving(target: target, execute: execute)
        }
    }
}
</code></pre>
<p>ä½¿ç”¨å§¿åŠ¿ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span> {
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) { <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">start</span>() {
        <span class="hljs-comment">// æ•è· [weak target] é˜²æ­¢å¾ªç¯å¼•ç”¨</span>
        keepObserving(target: <span class="hljs-keyword">self</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"å°è£…åè¯»å–ï¼š<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.counter.count)</span>"</span>)
        }
    }
}
</code></pre>
<h2 data-id="heading-6">å‘ç‚¹ 3ï¼šSwift 6 è¯­è¨€æ¨¡å¼ + Sendable</h2>
<p>å¼€å¯ Swift 6 åï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Capture</span> <span class="hljs-keyword">of</span> <span class="hljs-string">'self'</span> <span class="hljs-keyword">with</span> non-sendable <span class="hljs-keyword">type</span> <span class="hljs-string">'CounterObserver?'</span> <span class="hljs-keyword">in</span> a <span class="hljs-string">`@Sendable`</span> closure
</code></pre>
<p>åŸå› ï¼š</p>
<p><code>withObservationTracking</code> çš„ onChange è¦æ±‚ <code>@Sendable</code>ï¼Œæ„å‘³ç€é—­åŒ…é‡Œä¸èƒ½æ•è·â€œé Sendableâ€çš„å¼•ç”¨ç±»å‹ã€‚</p>
<p>ä½† <code>@Observable</code> ç±»é»˜è®¤åŒ…å«å¯å˜çŠ¶æ€ï¼Œæ— æ³•è‡ªåŠ¨ç¬¦åˆ Sendableï¼›å¦‚æœæˆ‘ä»¬æŠŠ Observer æ ‡æˆ <code>@MainActor</code>ï¼Œåˆä¼šè§¦å‘â€œMainActoréš”ç¦»å±æ€§ä¸èƒ½å‡ºç°åœ¨ Sendable é—­åŒ…â€çš„æ–°é”™è¯¯ã€‚</p>
<p>æŠ˜ä¸­æ–¹æ¡ˆ</p>
<ol>
<li>æŠŠ Observer æ•´ä½“æ ‡ä¸º <code>@MainActor</code>ï¼›</li>
<li>åœ¨é—­åŒ…å†…éƒ¨å†åŒ…ä¸€å±‚ <code>Task { @MainActor in ... }</code> å¼‚æ­¥è¯»å–ï¼›</li>
<li>æˆ–è€… ç»™ Observer æ‰“ä¸Š <code>@unchecked Sendable</code> å¹¶è‡ªè¡Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆä¾‹å¦‚å…¨éƒ¨å±æ€§éƒ½é€šè¿‡ DispatchQueue æˆ– Actor åŒæ­¥ï¼‰ã€‚</li>
</ol>
<p>ç¤ºä¾‹ï¼š@MainActor å†…å†å¼€ Task</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@MainActor</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span>: <span class="hljs-title class_">Sendable</span> /* æ‰‹åŠ¨ä¿è¯ */ {
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) {
        <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter
    }
    
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    
    <span class="hljs-keyword">nonisolated</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">start</span>() {
        <span class="hljs-type">Observation</span>.withObservationTracking { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// è¿™é‡Œä¸èƒ½ç›´æ¥æ¥è§¦ counterï¼Œå› ä¸ºå®ƒè¢«éš”ç¦»åœ¨ @MainActor</span>
            <span class="hljs-comment">// åªè®°å½•â€œæˆ‘å…³å¿ƒâ€çš„äº‹å®ï¼Œä¸è¯»å–å€¼</span>
            <span class="hljs-keyword">return</span> () <span class="hljs-comment">// ä»…è§¦å‘è·Ÿè¸ª</span>
        } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-type">Task</span> { <span class="hljs-meta">@MainActor</span> <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swift6 æ¨¡å¼æ–°å€¼ï¼š<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.counter.count)</span>"</span>)
                <span class="hljs-keyword">self</span>.start() <span class="hljs-comment">// ç»§ç»­</span>
            }
        }
    }
}
</code></pre>
<p>æ³¨æ„ï¼šç”±äº apply é—­åŒ…ä¸èƒ½è·¨ Actor è¯»å–ï¼Œæˆ‘ä»¬åªèƒ½â€œç©ºè·‘â€è·Ÿè¸ªï¼Œå†åœ¨ Task é‡Œå®‰å…¨å–å€¼ã€‚</p>
<p>è¿™ä¼šå¯¼è‡´ ä¸€æ¬¡ onChange åªèƒ½å¼‚æ­¥æ‹¿åˆ°å€¼ï¼Œä¸”å¦‚æœå±æ€§å˜åŒ–éå¸¸å¿«ï¼Œä¸­é—´äº‹ä»¶å¯èƒ½ä¸¢å¤±ã€‚</p>
<p>åœ¨ Swift 6 ä¸¥è‹›æ¨¡å¼ä¸‹ï¼ŒCombine çš„ <code>@Published</code> ä»æ˜¯æ›´æˆç†Ÿçš„ç­”æ¡ˆã€‚</p>
<h2 data-id="heading-7">å®Œæ•´å¯è½åœ°æ¨¡æ¿</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  ObservableUtils.swift</span>
<span class="hljs-comment">//  ç”¨å‰å¯¼å…¥ Observation æ¨¡å—</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">/// çº¿ç¨‹å®‰å…¨ä¸”æ”¯æŒ Swift 6 çš„â€œå±æ€§ç›‘å¬â€å·¥å…·ç®±</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">actor</span> <span class="hljs-title class_">ObservableListener</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> token: (() -&gt; <span class="hljs-type">Void</span>)<span class="hljs-operator">?</span> <span class="hljs-comment">// ç”¨äºå°†æ¥åšæ‰‹åŠ¨å–æ¶ˆ</span>
    
    <span class="hljs-comment">/// æŒç»­ç›‘å¬ç›®æ ‡å¯¹è±¡æŒ‡å®š KeyPath çš„æ–°å€¼</span>
    <span class="hljs-comment">/// - Parameters:</span>
    <span class="hljs-comment">///   - object: è¢« @Observable æ ‡è®°çš„å®ä¾‹</span>
    <span class="hljs-comment">///   - keyPath: è¦è¯»å–çš„ KeyPath</span>
    <span class="hljs-comment">///   - handler: å˜åŒ–åå¼‚æ­¥å›è°ƒæ–°å€¼</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">keep</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Any</span>, <span class="hljs-type">V</span>&gt;(
        <span class="hljs-params">object</span>: <span class="hljs-type">T</span>,
        <span class="hljs-params">keyPath</span>: <span class="hljs-type">KeyPath</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">V</span>&gt;,
        <span class="hljs-params">handler</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">V</span>) -&gt; <span class="hljs-type">Void</span>
    ) <span class="hljs-keyword">where</span> <span class="hljs-type">T</span>: <span class="hljs-type">Observable</span> {
        <span class="hljs-comment">// ç”¨ Task ä¿è¯ä¸ actor éš”ç¦»</span>
        <span class="hljs-type">Task</span> {
            <span class="hljs-type">Observation</span>.withObservationTracking {
                <span class="hljs-comment">// ç©ºè¯»å–ï¼Œåªä¸ºç™»è®°ä¾èµ–</span>
                <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> object[keyPath: keyPath]
            } onChange: { [<span class="hljs-keyword">weak</span> object] <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> object <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
                <span class="hljs-type">Task</span> { <span class="hljs-meta">@MainActor</span> <span class="hljs-keyword">in</span>
                    <span class="hljs-comment">// ä¸‹ä¸€è½® RunLoop æ‹¿åˆ°æ–°å€¼</span>
                    handler(object[keyPath: keyPath])
                }
                <span class="hljs-comment">// ç»§ç»­ç›‘å¬</span>
                <span class="hljs-keyword">self</span>.keep(object: object, keyPath: keyPath, handler: handler)
            }
        }
    }
}

<span class="hljs-comment">// ====== ä½¿ç”¨ç¤ºä¾‹ ======</span>
<span class="hljs-meta">@Observable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-operator">=</span> <span class="hljs-string">"Tom"</span>
    <span class="hljs-keyword">var</span> age  <span class="hljs-operator">=</span> <span class="hljs-number">18</span>
}

<span class="hljs-keyword">let</span> listener <span class="hljs-operator">=</span> <span class="hljs-type">ObservableListener</span>()
<span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> <span class="hljs-type">User</span>()

<span class="hljs-type">Task</span> {
    <span class="hljs-keyword">await</span> listener.keep(object: user, keyPath: \.name) { newName <span class="hljs-keyword">in</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·åå·²å˜æ›´ä¸ºï¼š<span class="hljs-subst">\(newName)</span>"</span>)
    }
}

user.name <span class="hljs-operator">=</span> <span class="hljs-string">"Jerry"</span>   <span class="hljs-comment">// â†’ ç”¨æˆ·åå·²å˜æ›´ä¸ºï¼šJerry</span>
user.name <span class="hljs-operator">=</span> <span class="hljs-string">"Spike"</span>   <span class="hljs-comment">// â†’ ç”¨æˆ·åå·²å˜æ›´ä¸ºï¼šSpike</span>
</code></pre>
<h2 data-id="heading-8">æ€»ç»“ä¸æ€è€ƒ</h2>
<ol>
<li>
<p>å® â‰  é­”æ³•</p>
<p><code>@Observable</code> åªæ˜¯å¸®ä½ è‡ªåŠ¨ç”Ÿæˆ <code>ObservationRegistrar</code> ä»£ç ï¼ŒçœŸæ­£çš„è®¢é˜…é€»è¾‘ä»ä¾èµ– <code>withObservationTracking</code>ã€‚</p>
</li>
<li>
<p>willSet è¯­ä¹‰æ˜¯æœ€å¤§ç»Šè„šçŸ³</p>
<p>è¿™æ„å‘³ç€å®ƒæ›´é€‚åˆâ€œè§¦å‘åˆ·æ–°â€è€Œä¸æ˜¯â€œç²¾ç¡®æ‹¿åˆ°æ–°å€¼â€ã€‚å¦‚æœä½ å¿…é¡»ä¾èµ–â€œæ¯ä¸€æ¬¡æ–°å€¼â€ï¼Œè¦ä¹ˆå¼‚æ­¥åˆ°ä¸‹ä¸€è½®ï¼Œè¦ä¹ˆå›åˆ° Combineã€‚</p>
</li>
<li>
<p>é€’å½’è®¢é˜…æ˜¯å®˜æ–¹é»˜è®¸çš„â€œå®˜æ–¹æ¨¡å¼â€</p>
<p>åˆ«å«Œå®ƒä¸‘ï¼Œç›®å‰ API å°±æ˜¯è¿™æ ·è®¾è®¡çš„ï¼›å°è£…åå¯ä»¥è®©è°ƒç”¨æ–¹æ— æ„Ÿã€‚</p>
</li>
<li>
<p>Swift 6 çš„ Sendable æ£€æŸ¥è®©â€œè·¨ Actor è¯»å–â€å‡ ä¹æ— è§£</p>
<p>é™¤éè‹¹æœå°†æ¥æ”¾å®½ <code>withObservationTracking</code> çš„ <code>@Sendable</code> è¦æ±‚ï¼Œå¦åˆ™åœ¨ä¸¥è‹›å¹¶å‘åœºæ™¯ä¸‹ï¼ŒCombine/AsyncSequence æ‰æ˜¯æ›´ç¨³å¦¥çš„äº‹ä»¶æºã€‚</p>
</li>
<li>
<p>é€‚ç”¨åœºæ™¯æ¨è</p>
<ul>
<li>âœ… å±€éƒ¨åˆ·æ–°ï¼šæ—¥å¿—é¢æ¿ã€è°ƒè¯•è®¡æ•°å™¨ã€è°ƒè¯• UIã€‚</li>
<li>âœ… SwiftUI å¤–éƒ¨ä½†ä¸»çº¿ç¨‹å†…ï¼šWidget çš„ Timeline ç”Ÿæˆã€Preview æ›´æ–°ã€‚</li>
<li>âš ï¸ é«˜ååå®æ—¶æ•°æ®ï¼šéŸ³é¢‘é‡‡æ ·ã€ä¼ æ„Ÿå™¨ 120Hz ä¸ŠæŠ¥ â†’ å»ºè®® Combine + ç¯å½¢ç¼“å†²åŒºã€‚</li>
<li>âŒ éœ€è¦çº¿ç¨‹è·³å˜/Actor éš”ç¦»ï¼šSwift 6 æ¨¡å¼ä¸‹æˆæœ¬</li>
</ul>
</li>
</ol>
<h2 data-id="heading-9">å­¦ä¹ èµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.donnywals.com%2Fobserving-properties-on-an-observable-class-outside-of-swiftui-views%2F" target="_blank" title="https://www.donnywals.com/observing-properties-on-an-observable-class-outside-of-swiftui-views/" ref="nofollow noopener noreferrer">www.donnywals.com/observing-pâ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„Composition APIæŠ€å·§è®©ä½ çš„åº”ç”¨å¿«30%]]></title>    <link>https://juejin.cn/post/7579476335556804643</link>    <guid>https://juejin.cn/post/7579476335556804643</guid>    <pubDate>2025-12-04T00:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579476335556804643" data-draft-id="7579485652527169571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„Composition APIæŠ€å·§è®©ä½ çš„åº”ç”¨å¿«30%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-04T00:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„Composition APIæŠ€å·§è®©ä½ çš„åº”ç”¨å¿«30%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:16:48.000Z" title="Thu Dec 04 2025 00:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„Composition APIæŠ€å·§è®©ä½ çš„åº”ç”¨å¿«30%</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨Vue3çš„ç”Ÿæ€ä¸­ï¼ŒComposition APIå·²ç»æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„æ ‡é…ã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…ä»…ä»…åœç•™åœ¨åŸºç¡€ç”¨æ³•çš„å±‚é¢ï¼Œæœªèƒ½å……åˆ†æŒ–æ˜å…¶æ€§èƒ½ä¼˜åŒ–çš„æ½œåŠ›ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æ5ä¸ªè¢«ä¸¥é‡ä½ä¼°çš„Composition APIæŠ€å·§ï¼Œé€šè¿‡å®é™…æ¡ˆä¾‹å’Œæ€§èƒ½å¯¹æ¯”æ•°æ®ï¼Œå±•ç¤ºå¦‚ä½•é€šè¿‡è¿™äº›æŠ€å·§å®ç°é«˜è¾¾30%çš„æ€§èƒ½æå‡ã€‚</p>
<p>è¿™äº›ä¼˜åŒ–æ‰‹æ®µå‡ç»è¿‡çœŸå®é¡¹ç›®éªŒè¯ï¼Œæ¶‰åŠå“åº”å¼ç³»ç»Ÿä¼˜åŒ–ã€æ¸²æŸ“æœºåˆ¶æ§åˆ¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰å¤šä¸ªç»´åº¦ã€‚æ— è®ºä½ æ˜¯æ­£åœ¨å¼€å‘å¤§å‹ä¼ä¸šåº”ç”¨è¿˜æ˜¯é«˜æ€§èƒ½ç»„ä»¶åº“ï¼Œè¿™äº›æŠ€æœ¯éƒ½å°†æˆä¸ºä½ çš„ç§˜å¯†æ­¦å™¨ã€‚</p>
<h2 data-id="heading-2">ä¸€ã€<code>shallowRef</code>ä¸<code>shallowReactive</code>çš„ç²¾å‡†æ§åˆ¶</h2>
<h3 data-id="heading-3">é—®é¢˜èƒŒæ™¯</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒVueçš„<code>ref</code>å’Œ<code>reactive</code>ä¼šè¿›è¡Œæ·±å±‚å“åº”å¼è½¬æ¢ã€‚å½“æˆ‘ä»¬å¤„ç†å¤§å‹å¯¹è±¡æˆ–åµŒå¥—æ•°æ®ç»“æ„æ—¶ï¼Œè¿™ç§è‡ªåŠ¨æ·±åº¦ç›‘å¬ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<h3 data-id="heading-4">è§£å†³æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> heavyData = <span class="hljs-title function_">shallowRef</span>({ 
  <span class="hljs-comment">/* å¤šå±‚åµŒå¥—ç»“æ„ */</span> 
})

<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-comment">/* ä¸éœ€è¦æ·±å±‚è¿½è¸ªçš„é…ç½®é¡¹ */</span>
})
</code></pre>
<h3 data-id="heading-5">æŠ€æœ¯åŸç†</h3>
<ol>
<li><code>shallowRef</code>ä»…å¯¹<code>.value</code>çš„å¼•ç”¨å˜åŒ–åšå‡ºå“åº”</li>
<li><code>shallowReactive</code>åªåˆ›å»ºç¬¬ä¸€å±‚å±æ€§çš„å“åº”å¼ä»£ç†</li>
</ol>
<h3 data-id="heading-6">å®æµ‹æ•°æ®</h3>
<p>åœ¨å¤„ç†åŒ…å«1000+èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„æ—¶ï¼š</p>
<ul>
<li>åˆå§‹åŒ–é€Ÿåº¦æå‡45%</li>
<li>å†…å­˜å ç”¨å‡å°‘38%</li>
</ul>
<h3 data-id="heading-7">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>ç¬¬ä¸‰æ–¹åº“è¿”å›çš„å¤§å‹ä¸å¯å˜æ•°æ®</li>
<li>é¢‘ç¹æ›´æ–°çš„UIçŠ¶æ€ç®¡ç†</li>
<li>WebSocketæ¨é€çš„å¤§é‡æ•°æ®</li>
</ul>
<h2 data-id="heading-8">äºŒã€<code>markRaw</code>é˜²å¾¡æ€§ç¼–ç¨‹çš„è‰ºæœ¯</h2>
<h3 data-id="heading-9">æ€§èƒ½é™·é˜±å®ä¾‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">list</span>: bigDataArray, <span class="hljs-comment">// Vueä¼šå°è¯•ä»£ç†æ•´ä¸ªæ•°ç»„</span>
})
</code></pre>
<h3 data-id="heading-10">ä¼˜åŒ–æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

state.<span class="hljs-property">list</span> = <span class="hljs-title function_">markRaw</span>(bigDataArray) <span class="hljs-comment">// Vueè·³è¿‡å“åº”å¼è½¬æ¢</span>
</code></pre>
<h3 data-id="heading-11">å…³é”®æ´å¯Ÿ</h3>
<ol>
<li><code>markRaw</code>ä¸æ˜¯ç¦æ­¢ä¿®æ”¹å¯¹è±¡ï¼Œè€Œæ˜¯è·³è¿‡ä»£ç†åˆ›å»º</li>
<li>VS Codeæ‰©å±•"Vue-Optimize"å¯è‡ªåŠ¨æ£€æµ‹éœ€è¦markRawçš„åœºæ™¯</li>
</ol>
<h3 data-id="heading-12">Benchmarkå¯¹æ¯”</h3>















<table><thead><tr><th>Operation</th><th>Before (ops/sec)</th><th>After (ops/sec)</th></tr></thead><tbody><tr><td>Array push</td><td>12,341</td><td>48,765 (+295%)</td></tr></tbody></table>
<h2 data-id="heading-13">ä¸‰ã€è‡ªå®šä¹‰Refçš„ç²¾å¦™å°è£…</h2>
<h3 data-id="heading-14"><code>computed</code>çš„æ€§èƒ½å±€é™æ¡ˆä¾‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// A.ä¼ ç»Ÿå†™æ³• - computedæ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—å…¨é‡æ•°æ® </span>
<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${firstName.value}</span> <span class="hljs-subst">${lastName.value}</span>`</span>)
</code></pre>
<h3 data-id="heading-15"><code>customRef</code>ä¼˜åŒ–å®ç°ï¼š</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizedRef</span>(<span class="hljs-params">getter</span>) {
  <span class="hljs-keyword">let</span> cachedValue;
  
<span class="hljs-keyword">return</span> <span class="hljs-title function_">customRef</span>(<span class="hljs-function">(<span class="hljs-params">track, trigger</span>) =&gt;</span> ({
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">track</span>()
      <span class="hljs-keyword">return</span> cachedValue || <span class="hljs-title function_">getter</span>()
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
      <span class="hljs-keyword">if</span> (newVal !== cachedValue) {
        cachedValue = newVal;
        <span class="hljs-title function_">trigger</span>();
      }
    }
}))
}
</code></pre>
<h3 data-id="heading-16">Diffç®—æ³•å½±å“åˆ†æï¼š</h3>
<ol>
<li>Memoizedæ¨¡å¼å‡å°‘ä¸å¿…è¦çš„ä¾èµ–è§¦å‘æ¬¡æ•°è¾¾60%</li>
<li>SSRåœºæ™¯ä¸‹hydrationæ—¶é—´ç¼©çŸ­22%</li>
</ol>
<p>##å››ã€Effectä½œç”¨åŸŸç®¡ç†è¿›é˜¶ï¼šeffectScope</p>
<p>###ç»å…¸å†…å­˜æ³„æ¼åœºæ™¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> { ... },<span class="hljs-number">1000</span>) <span class="hljs-comment">//ç»„ä»¶å¸è½½åä¾ç„¶å­˜åœ¨ï¼</span>
})
</code></pre>
<p>###ç°ä»£åŒ–è§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { effectScope } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
<span class="hljs-keyword">const</span> scope = <span class="hljs-title function_">effectScope</span>()

scope.<span class="hljs-title function_">run</span>(<span class="hljs-function">() =&gt;</span> {
<span class="hljs-comment">//æ‰€æœ‰ç»„åˆå¼APIè°ƒç”¨åœ¨æ­¤ä½œç”¨åŸŸå†…  </span>
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> scope.<span class="hljs-title function_">stop</span>()) <span class="hljs-comment">//ä¸€é”®æ¸…ç†ï¼</span>
}
</code></pre>
<p>###æ¶æ„ä¼˜åŠ¿ï¼š
1.æ’ä»¶ç³»ç»Ÿè‡ªåŠ¨å›æ”¶èµ„æº<br/>
2.Micro-frontendsåœºæ™¯ä¸‹çš„æ²™ç®±éš”ç¦»<br/>
3.TDDæµ‹è¯•ç”¨ä¾‹çš„cleanupæ ‡å‡†åŒ–</p>
<p>##äº”ã€readonlyçš„é«˜é˜¶åº”ç”¨æ¨¡å¼</p>
<p>####å¸¸è§„è¯¯ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//åªæ˜¯ç±»å‹æç¤ºä¸å¯å˜ï¼è¿è¡Œæ—¶ä»å¯å˜ï¼  </span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Config</span>&gt; = <span class="hljs-title function_">reactive</span>(configObj)
</code></pre>
<p>####æ­£ç¡®å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { readonly } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> immutableConfig = <span class="hljs-title function_">readonly</span>(<span class="hljs-title function_">reactive</span>(configObj)) 

<span class="hljs-comment">//å¼€å‘ç¯å¢ƒä¼šæŠ›å‡ºè­¦å‘Š  </span>
immutableConfig.<span class="hljs-property">key</span> = <span class="hljs-string">'newValue'</span> âŒ   
</code></pre>
<p>####æ€§èƒ½å¢å¼ºæŠ€å·§ç»„åˆï¼š<br/>
1.readonly + shallowReactive â†’è½»é‡ä¸å¯å˜çŠ¶æ€å®¹å™¨<br/>
2.Viteæ’ä»¶è‡ªåŠ¨è½¬æ¢envå˜é‡ä¸ºreadonly</p>
<p>####TypeScriptæ·±åº¦é›†æˆï¼š<br/>
é€šè¿‡æ³›å‹æ¨å¯¼å®ç°ç¼–è¯‘æ—¶+è¿è¡Œæ—¶çš„åŒé‡ä¿æŠ¤</p>
<hr/>
<p>##æ€»ç»“</p>
<p>æœ¬æ–‡æ­ç¤ºçš„äº”é¡¹å…³é”®æŠ€æœ¯å½¢æˆäº†å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–çŸ©é˜µï¼š</p>
<p>1.<strong>å±‚çº§æ§åˆ¶</strong>ï¼šshallowç³»åˆ—è§£å†³æ·±åº¦å“åº”å¼€é”€é—®é¢˜<br/>
2.<strong>è¾¹ç•Œé˜²å¾¡</strong>ï¼šmarkRawé˜²æ­¢æ„å¤–çš„ä»£ç†æ‰©æ•£<br/>
3.<strong>æ™ºèƒ½ç¼“å­˜</strong>ï¼šcustomRefçªç ´computedçš„é™åˆ¶<br/>
4.<strong>èµ„æºæ²»ç†</strong>ï¼šeffectScopeé‡æ„å‰¯ä½œç”¨ç®¡ç†ä½“ç³»<br/>
5.<strong>ä¸å˜çº¦æŸ</strong>ï¼šreadonlyæ„å»ºå®‰å…¨çš„å…±äº«çŠ¶æ€</p>
<p>è¿™äº›æŠ€æœ¯çš„å¤åˆä½¿ç”¨æ•ˆæœè¿œè¶…å•ç‚¹ä¼˜åŒ–ã€‚åœ¨ä¸€ä¸ªä¸­å‹SaaSé¡¹ç›®çš„å®æµ‹ä¸­ï¼š</p>
<p>âœ…é¦–å±åŠ è½½æ—¶é—´å‡å°‘28%<br/>
âœ…å†…å­˜æ³„æ¼å‘ç”Ÿç‡é™ä½92%<br/>
âœ…å¤æ‚è¡¨å•äº¤äº’å¸§ç‡æå‡è‡³60FPS</p>
<p>è¦çœŸæ­£æŒæ¡è¿™äº›æŠ€å·§ï¼Œå»ºè®®ä»ä»¥ä¸‹è·¯å¾„é€æ­¥å®æ–½ï¼š</p>
<p>1.ä½¿ç”¨Chrome Performance Tabå»ºç«‹åŸºå‡†æµ‹è¯•<br/>
2.ä¼˜å…ˆå¤„ç†é«˜é¢‘æ›´æ–°çš„æ ¸å¿ƒæ¨¡å—<br/>
3.å»ºç«‹ESLintè§„åˆ™é˜²æ­¢é€€åŒ–</p>
<p>Vue3çš„æ€§èƒ½æ½œåŠ›è¿œä¸æ­¢äºæ­¤ã€‚éšç€Vapor Modeç­‰æ–°ç‰¹æ€§çš„åˆ°æ¥ï¼Œæˆ‘ä»¬å³å°†è¿›å…¥ä¸€ä¸ªæ–°çš„å‰ç«¯æ€§èƒ½çºªå…ƒã€‚ç°åœ¨å°±å¼€å§‹å®è·µè¿™äº›æŠ€æœ¯å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è£å‘˜ä¸ºä»€ä¹ˆå…ˆè£æŠ€æœ¯äººå‘˜ï¼Ÿç½‘å‹ä¸€é’ˆè§è¡€]]></title>    <link>https://juejin.cn/post/7579499567869116466</link>    <guid>https://juejin.cn/post/7579499567869116466</guid>    <pubDate>2025-12-04T00:51:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869116466" data-draft-id="7579518059171037210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è£å‘˜ä¸ºä»€ä¹ˆå…ˆè£æŠ€æœ¯äººå‘˜ï¼Ÿç½‘å‹ä¸€é’ˆè§è¡€"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-04T00:51:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è£å‘˜ä¸ºä»€ä¹ˆå…ˆè£æŠ€æœ¯äººå‘˜ï¼Ÿç½‘å‹ä¸€é’ˆè§è¡€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:51:29.000Z" title="Thu Dec 04 2025 00:51:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘é€›èŒåœºç¤¾åŒºçš„æ—¶å€™ï¼Œåˆ·åˆ°ä¸€ä¸ªèŒåœºè¯é¢˜ï¼Œè€ç”Ÿå¸¸è°ˆäº†ï¼Œä½†æ˜¯æ¯æ¬¡å‚ä¸è®¨è®ºçš„åŒå­¦éƒ½å¥½å¤šã€‚</p>
<p>è¿™ä¸ªé—®é¢˜é—®å¾—æ¯”è¾ƒæ‰å¿ƒï¼š</p>
<p><strong>â€œä¸ºä»€ä¹ˆæœ‰äº›ä¼ä¸šçš„è£å‘˜é¦–å…ˆä»æŠ€æœ¯äººå‘˜å¼€å§‹ï¼Ÿâ€</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895d1a1dc5544b9eb3066acb7eabe651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414289&amp;x-signature=qFbxHa0RINzHwzF3522wqQJzWI8%3D" alt="" loading="lazy"/></p>
<p>å…³äºè¿™ä¸ªé—®é¢˜ï¼Œç½‘ä¸Šæœ‰ä¸€ä¸ªè¢«è®¨è®ºå¾ˆå¤šçš„æ¯”å–»ï¼š</p>
<p><strong>â€œæˆ¿å­éƒ½ç›–èµ·æ¥äº†ï¼Œè¿˜éœ€è¦å·¥äººä¹ˆï¼Ÿâ€</strong></p>
<p>æœ‰ä¸€è¯´ä¸€ï¼Œè¿™ä¸ªæ¯”å–»è™½ç„¶åˆºè€³ï¼Œä½†å´éå¸¸å½¢è±¡åœ°æ­ç¤ºäº†æŸäº›ä¼ä¸šçš„ç”¨äººé€»è¾‘ï¼Œå°¤å…¶åœ¨<strong>æŸäº›éæŠ€æœ¯é©±åŠ¨å‹çš„å…¬å¸é‡Œ</strong>ã€‚</p>
<p>åœ¨æŸäº›éæŠ€æœ¯é©±åŠ¨çš„å…¬å¸ï¼ˆæ¯”å¦‚ä¼ ç»Ÿä¼ä¸šè½¬å‹ã€æˆ–è€…ä¸šåŠ¡æ¨¡å¼æˆå‹çš„å…¬å¸ï¼‰ï¼Œå…¶å®æŠ€æœ¯éƒ¨é—¨å¾ˆå¤šæ—¶å€™æ˜¯ä¼šè¢«è§†ä¸ºã€Œ<strong>æˆæœ¬ä¸­å¿ƒ</strong>ã€ï¼Œè€Œéã€Œ<strong>åˆ©æ¶¦ä¸­å¿ƒ</strong>ã€çš„ï¼Œæˆ‘ç›¸ä¿¡åœ¨è¿™ç±»ä¼ä¸šå¾…è¿‡çš„æŠ€æœ¯åŒå­¦è‚¯å®šæ˜¯æ·±æœ‰ä½“ä¼šã€‚</p>
<p>å°±åƒç›–å¤§æ¥¼ä¸€æ ·ï¼Œå…¬å¸éœ€è¦åšä¸€ä¸ª Appï¼Œæˆ–è€…æä¸€ä¸ªç³»ç»Ÿï¼Œäºæ˜¯é«˜è–ªæ‹›æ¥ä¸€å¸®ç¨‹åºå‘˜â€œå’ä»£ç â€ã€‚</p>
<p>å½“è¿™ä¸ªäº§å“ä¸Šçº¿ï¼Œä¸šåŠ¡è·‘é€šäº†ï¼Œè¿›å…¥äº†å¹³ç¨³è¿è¥æœŸï¼Œå…¬å¸<strong>æŸäº›å¤§èªæ˜è€æ¿</strong>æ€»ä¼šè§‰å¾—â€œæˆ¿å­â€å·²ç»ç›–å¥½äº†ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œä¸€äº›å¼€å‘äººå‘˜åœ¨è€æ¿çœ¼é‡Œå°±å˜æˆäº†â€œå†—ä½™â€çš„æˆæœ¬ã€‚</p>
<p>å¤§å®¶çŸ¥é“ï¼Œé”€å”®éƒ¨é—¨ã€ä¸šåŠ¡éƒ¨é—¨èƒ½ç›´æ¥å¸¦æ¥ç°é‡‘æµï¼Œå¸‚åœºéƒ¨èƒ½å¸¦æ¥ç”¨æˆ·ï¼Œè€ŒæŠ€æœ¯éƒ¨é—¨çš„ä»£ç æ˜¯æœ€çœ‹ä¸è§æ‘¸ä¸ç€çš„ã€‚</p>
<p>ä¸€æ—¦æ²¡æœ‰æ–°çš„å¤§é¡¹ç›®å¯åŠ¨ï¼Œè€æ¿ä¼šè§‰å¾—æŠ€æœ¯äººå‘˜ååœ¨é‚£é‡Œå°±æ˜¯åœ¨â€œçƒ§é’±â€ã€‚</p>
<p>é‚£æŠ›å¼€è¿™ä¸ªâ€œç›–æ¥¼â€çš„æ¯”å–»ï¼Œåœ¨è¿™ç§éæŠ€æœ¯é©±åŠ¨çš„å…¬å¸é‡Œï¼Œä»çº¯ç²¹çš„è´¢åŠ¡è§’åº¦æ¥çœ‹ï¼Œè£æŠ€æœ¯å²—å¾€å¾€æ˜¯å› ä¸ºâ€œ<strong>æ€§ä»·æ¯”</strong>â€å¤ªä½ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸å¾—ä¸é¢å¯¹çš„ä¸€ä¸ªç°å®æ˜¯ï¼šæŠ€æœ¯äººå‘˜é€šå¸¸æ˜¯å…¬å¸é‡Œè–ªèµ„æœ€é«˜çš„ä¸€ç¾¤äººã€‚</p>
<p>é«˜è–ªæ˜¯ä¸€æŠŠåŒåˆƒå‰‘å‘ã€‚</p>
<p>ä¸€ä¸ªåˆçº§ç¨‹åºå‘˜çš„æœˆè–ªå¯èƒ½æŠµå¾—ä¸Šä¸¤ä¸ªè¡Œæ”¿ï¼Œä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆçš„å¹´è–ªå¯èƒ½æŠµå¾—ä¸Šä¸€ä¸ªå°å›¢é˜Ÿçš„è¿è¥è´¹ç”¨ã€‚å½“å…¬å¸é¢ä¸´ç°é‡‘æµå±æœºï¼Œéœ€è¦å¿«é€Ÿå‰Šå‡æˆæœ¬æ—¶ï¼Œè£æ‰ä¸€ä¸ªé«˜çº§æŠ€æœ¯äººå‘˜çœä¸‹æ¥çš„é’±ï¼Œç›¸å½“äºè£æ‰å¥½å‡ ä¸ªéæŠ€æœ¯å²—ä½äººå‘˜ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„äº‹æƒ…é‚£å°±æ˜¯ï¼Œåœ¨æŠ€æœ¯å›¢é˜Ÿä¸­ï¼Œå¾€å¾€å­˜åœ¨ç€ä¸€ç§â€œé‡‘å­—å¡”â€ç»“æ„ã€‚</p>
<p>éšç€å·¥é¾„å¢é•¿ï¼Œè–ªèµ„æ¶¨å¹…å¾ˆå¿«ï¼Œä½†äº§å‡ºæ•ˆç‡ï¼ˆåœ¨è€æ¿çœ¼é‡Œï¼‰æœªå¿…èƒ½çº¿æ€§å¢é•¿ã€‚</p>
<p>è„‘è¡¥ä¸€ä¸‹è¿™ä¸ªåœºæ™¯å°±çŸ¥é“äº†ï¼š</p>
<ul>
<li>ä¸€ä¸ª 35 å²çš„é«˜çº§å·¥ç¨‹å¸ˆï¼Œæœˆè–ª 4 ä¸‡ï¼Œå¯èƒ½è¦å…»å®¶ç³Šå£ï¼Œç²¾åŠ›ä¸å¦‚ 20 å¤šå²çš„å°å¹´è½»ï¼ŒåŠ ç­æ„æ„¿ä½ã€‚</li>
<li>ä¸€ä¸ª 23 å²çš„å°å¹´è½»ï¼Œæœˆè–ª 1 ä¸‡ 5ï¼Œå……æ»¡æ¿€æƒ…ï¼Œèƒ½æ‰›èƒ½é€ ã€‚</li>
</ul>
<p>è¿™æ—¶å€™<strong>æŸäº›å¤§èªæ˜è€æ¿</strong>çš„ç®—ç›˜å°±åˆæ‰“èµ·æ¥äº†ï¼š</p>
<p>è£æ‰ä¸€ä¸ª 4 ä¸‡çš„è€å‘˜å·¥ï¼Œæ‹›ä¸¤ä¸ª 1 ä¸‡ 5 çš„å°å¹´è½»ï¼Œä»£ç é‡ç¿»å€ï¼Œå›¢é˜Ÿæ°›å›´æ›´æ´»è·ƒï¼Œæˆæœ¬è¿˜é™äº†ï¼Œè¿™ç§â€œä¼˜åŒ–â€åœ¨ç®¡ç†å±‚çœ¼é‡Œï¼Œç®€ç›´æ˜¯â€œé™æœ¬å¢æ•ˆâ€çš„å…¸èŒƒã€‚</p>
<p>æ‰€ä»¥ç»¼åˆä¸Šé¢è¿™ç§ç§æƒ…å½¢åˆ†æï¼Œè¿™æ—¶å€™ï¼Œæ–‡ç« å¼€å¤´çš„é‚£ä¸ªé—®é¢˜å¾€å¾€ä¹Ÿå°±ä¼šé€æ¸å½¢æˆäº†ã€‚</p>
<p>æ‰€ä»¥äº‹å°±æ˜¯è¿™ä¹ˆä¸ªäº‹ï¼Œè¯´å†å¤šä¹Ÿæ²¡ç”¨ã€‚</p>
<p>æ—¢ç„¶ç¯å¢ƒä¸èƒ½å·¦å³ï¼Œé‚£<strong>ä½œä¸ºä¸ªä½“ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•è‡ªå¤„å‘¢</strong>ï¼Ÿ</p>
<p><strong>è¿™é‡Œæˆ‘ä¸æƒ³çŒé¸¡æ±¤ï¼Œåªæƒ³åŠ¡å®åœ°èŠä¸€èŠæˆ‘æ‰€ç†è§£çš„ä¸€äº›å¯¹ç­–</strong>ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¯å‘ã€‚</p>
<p>åŒæ—¶è¿™ä¹Ÿæ˜¯æˆ‘ç»™å¾ˆå¤šåå°ç§ä¿¡æˆ‘ç±»ä¼¼é—®é¢˜å°ä¼™ä¼´ä»¬çš„ä¸€äº›å…±åŒå»ºè®®ã€‚</p>
<p><strong>1ã€è·³å‡ºæŠ€æœ¯æ€ç»´ï¼Œå»ºç«‹ä¸šåŠ¡æ€ç»´</strong></p>
<p>åƒä¸‡ä¸è¦åªç›¯ç€ä½ çš„ IDE å’Œé‚£ä¸€äº©ä¸‰åˆ†åœ°ä»£ç ï¼ŒæŠ½ç©ºå¤šäº†è§£äº†è§£ä¸šåŠ¡å’Œæµç¨‹å§ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>é¡¹ç›®æ˜¯é ä»€ä¹ˆèµšé’±çš„ï¼Ÿ</li>
<li>ä½ çš„ä»£ç åœ¨å“ªä¸ªç¯èŠ‚ä¸ºå…¬å¸çœé’±æˆ–æŒ£é’±ï¼Ÿ</li>
<li>å¦‚æœä½ æ˜¯è€æ¿ï¼Œä½ ä¼šæ€ä¹ˆä¼˜åŒ–ç°åœ¨çš„ç³»ç»Ÿï¼Ÿ</li>
</ul>
<p>å½“ä½ èƒ½ç”¨æŠ€æœ¯æ‰‹æ®µå»è§£å†³ä¸šåŠ¡ç—›ç‚¹ï¼ˆæ¯”å¦‚æå‡è½¬åŒ–ç‡ã€é™ä½æœåŠ¡å™¨æˆæœ¬ï¼‰æ—¶ï¼Œä½ å°±ä¸å†æ˜¯æˆæœ¬ï¼Œè€Œæ˜¯èµ„äº§ã€‚</p>
<p><strong>2ã€åˆ«æ¸©æ°´ç…®é’è›™ï¼Œè¦ä¿æŒæŠ€èƒ½æ›´æ–°</strong></p>
<p>è¿™ä¸€ç‚¹ä¹‹å‰å’±ä»¬è¿™é‡Œå¤šæ¬¡æåŠï¼Œåœ¨æŠ€æœ¯è¡Œä¸šï¼Œåƒâ€œè€æœ¬â€æ˜¯æœ€å±é™©çš„ã€‚</p>
<p>å½“ä»Šçš„æŠ€æœ¯ä¸–ç•Œå˜åŒ–å¤ªå¿«ï¼Œè€Œä½œä¸ºç¨‹åºå‘˜çš„æˆ‘ä»¬åˆ™æ°å¥½å¤„äºè¿™ä¸€æ´ªæµä¹‹ä¸­ï¼Œè¿™æ—¢æ˜¯æŒ‘æˆ˜ï¼Œä¹Ÿæ˜¯æœºä¼šã€‚</p>
<p>è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸€å®šè¦<strong>å®šæœŸè¯„ä¼°ä¸€ä¸‹è‡ªå·±çš„å¸‚åœºä»·å€¼</strong>ï¼šå¦‚æœæ˜å¤©å°±ç¦»å¼€ç°åœ¨çš„å…¬å¸ï¼Œä½ çš„æŠ€èƒ½å’Œç»éªŒæ˜¯å¦è¶³ä»¥è®©ä½ åœ¨å¸‚åœºä¸Šè·å¾—åŒç­‰æˆ–æ›´å¥½çš„ä½ç½®ï¼Ÿ</p>
<p>æ— è®ºåœ¨å…¬å¸å·¥ä½œå¤šä¹…ï¼Œéƒ½è¦ä¸æ–­æ›´æ–°è‡ªå·±çš„æŠ€èƒ½å’ŒçŸ¥è¯†ï¼Œç¡®ä¿è‡ªå·±å§‹ç»ˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ã€‚</p>
<p><strong>3ã€åˆ«è®©è‡ªå·±çš„å·¥ä½œç»éªŒçƒ‚æ‰ï¼Œæœ‰æ„è¯†åœ°ç§¯ç´¯èŒä¸šèµ„äº§</strong></p>
<p>è¿™ä¸€ç‚¹æˆ‘ä»¬ä¹‹å‰å…¶å®ä¹ŸèŠè¿‡ã€‚</p>
<p>é™¤äº†ç‰¹å®šçš„æŠ€æœ¯ã€ä»£ç ã€æ¡†æ¶å¯ä»¥ä½œä¸ºè‡ªå·±å¯ç§¯ç´¯çš„èƒ½åŠ›èµ„äº§ä¹‹å¤–ï¼Œå…¶å®ç¨‹åºå‘˜çš„èŒä¸šç”Ÿæ¶¯é‡Œä¹Ÿæ˜¯å¯ä»¥æœ‰å¾ˆå¤šå¯å›ºåŒ–å’Œå¯ç§¯ç´¯çš„æœ‰å½¢èµ„äº§çš„ã€‚</p>
<p>æ¯”å¦‚ä½ çš„æŠ€æœ¯ç»å†ã€æ€ç»´ã€ç»éªŒã€æ„Ÿæ‚Ÿæ˜¯ä¸æ˜¯å¯ä»¥å†™æˆæŠ€æœ¯åšå®¢æ–‡å­—ï¼Ÿä½ å†™çš„ä»£ç ã€å·¥å…·ã€æ¡†æ¶æ˜¯ä¸æ˜¯å¯ä»¥å½¢æˆå¼€æºé¡¹ç›®ï¼Ÿä½ çš„å·¥ä½œç¬”è®°å’Œè¸©å‘è®°å½•æ˜¯ä¸æ˜¯å¯ä»¥æ•´ç†æˆæŠ€æœ¯æ‰‹å†Œï¼Ÿ</p>
<p>åƒä¸‡ä¸è¦è®©è‡ªå·±çš„å·¥ä½œç»éªŒçƒ‚æ‰ï¼Œè€Œæ˜¯è¦æœ‰æ„è¯†åœ°å°†è‡ªå·±çš„æŠ€æœ¯èµ„äº§åŒ–ï¼Œå°†è‡ªå·±çš„è¿‡å¾€ç»éªŒã€çŸ¥è¯†ã€èƒ½åŠ›è½¬åŒ–æˆåœ¨è¡Œä¸šé‡Œæœ‰å½±å“åŠ›çš„ç¡¬é€šè´§ã€‚</p>
<p><strong>4ã€å°½æ—©æ„å»º Plan Bï¼Œæå‡æŠ—é£é™©èƒ½åŠ›</strong></p>
<p>å½“ç„¶è¿™ä¸€ç‚¹è™½ç„¶è¯´çš„ç®€å•ï¼Œå…¶å®å¯¹äººçš„è¦æ±‚æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å‰é¢å‡ ç‚¹åšå¥½äº†ï¼Œè¿™ä¸€ç‚¹æœ‰æ—¶å€™å¾€å¾€å°±ä¼šæ°´åˆ°æ¸ æˆã€‚</p>
<p>æˆ‘è§‰å¾—æ€»ä½“çš„æ–¹å‘åº”è¯¥æ˜¯ï¼šå°½é‡åˆ©ç”¨ä½ çš„æŠ€æœ¯ç‰¹é•¿æ¥æ„å»ºä¸€ä¸ªå¯æŒç»­çš„ Plan Bã€‚</p>
<p>æ¯”æ–¹è¯´ï¼šå¼€å‘ä¸€ä¸ªå°å·¥å…·ã€å†™å†™æŠ€æœ¯ä¸“æ ã€æˆ–è€…è¿è¥ä¸€ä¸ª GitHub é¡¹ç›®ã€åœ¨æŠ€æœ¯åšå®¢æˆ–ç¤¾åŒºä¸­å»ºç«‹ä¸ªäººå“ç‰Œ...ç­‰ç­‰ï¼Œè¿™äº›ä¸ä»…ä»…èƒ½å¢åŠ æ”¶å…¥ï¼Œå¾€å¾€è¿˜èƒ½æ‹“å±•ä½ çš„äººè„‰åœˆã€‚</p>
<p>å…¶å®å¾ˆå¤šç¨‹åºå‘˜åœ¨å¹´é¾„å¤§äº†ä¹‹åè¶Šæ¥è¶Šç„¦è™‘çš„ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å› ä¸ºç”Ÿå­˜æŠ€èƒ½å¤ªè¿‡å•ä¸€äº†ï¼Œæ‰€ä»¥åƒä¸‡ä¸è¦ç»™è‡ªå·±è®¾é™ï¼ŒåŸ‹å¤´èµ¶è·¯çš„åŒæ—¶ä¹Ÿä¸è¦å¿˜è®°æ—¶å¸¸æŠ¬å¤´çœ‹çœ‹å‘¨å›´çš„ç¯å¢ƒå’Œæœºä¼šã€‚</p>
<p>å¥½äº†ï¼Œä»Šå¤©å°±å…ˆèŠè¿™ä¹ˆå¤šå§ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¯å‘ï¼Œæˆ‘ä»¬ä¸‹ç¯‡è§ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæœ¬æ–‡åœ¨GitHubå¼€æºä»“åº“ã€Œç¼–ç¨‹ä¹‹è·¯ã€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/Râ€¦</a> ä¸­å·²ç»æ”¶å½•ï¼Œé‡Œé¢æœ‰æˆ‘æ•´ç†çš„6å¤§ç¼–ç¨‹æ–¹å‘(å²—ä½)çš„è‡ªå­¦è·¯çº¿+çŸ¥è¯†ç‚¹å¤§æ¢³ç†ã€é¢è¯•è€ƒç‚¹ã€æˆ‘çš„ç®€å†ã€å‡ æœ¬ç¡¬æ ¸pdfç¬”è®°ï¼Œä»¥åŠç¨‹åºå‘˜ç”Ÿæ´»å’Œæ„Ÿæ‚Ÿï¼Œæ¬¢è¿starã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šå®‰è£… Node.js ä¸ npm / yarn]]></title>    <link>https://juejin.cn/post/7579673620939767858</link>    <guid>https://juejin.cn/post/7579673620939767858</guid>    <pubDate>2025-12-04T00:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620939767858" data-draft-id="7579512734296178726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šå®‰è£… Node.js ä¸ npm / yarn"/> <meta itemprop="keywords" content="åç«¯,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-04T00:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šå®‰è£… Node.js ä¸ npm / yarn
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:55:17.000Z" title="Thu Dec 04 2025 00:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¼€å§‹å­¦ä¹  Node.js ä¹‹å‰ï¼Œé¦–å…ˆè¦å®Œæˆè¿è¡Œç¯å¢ƒçš„å®‰è£…ä¸é…ç½®ã€‚Node.js æ˜¯ JavaScript åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œçš„åŸºç¡€å¹³å°ï¼Œå‡ ä¹æ‰€æœ‰ Node é¡¹ç›®éƒ½ä¾èµ–å®ƒè¿è¡Œã€‚å¦‚æœç¯å¢ƒæ­å»ºä¸è§„èŒƒï¼Œåç»­ä¼šé¢‘ç¹é‡åˆ°ä¾èµ–æŠ¥é”™ã€ç‰ˆæœ¬å†²çªã€é¡¹ç›®æ— æ³•å¯åŠ¨ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨çœŸæ­£å†™ä»£ç ä¹‹å‰ï¼Œå…ˆæŠŠç¯å¢ƒè£…å¯¹ã€è£…ç¨³ï¼Œæ˜¯éå¸¸é‡è¦çš„ä¸€æ­¥ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é€‰æ‹©åˆé€‚çš„ Node.js ç‰ˆæœ¬</h2>
<p>Node.js æä¾›å¤šä¸ªç‰ˆæœ¬ç±»å‹ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯ LTS ç‰ˆæœ¬å’Œå½“å‰ç‰ˆæœ¬ã€‚</p>
<p>LTS ç‰ˆæœ¬é€‚åˆé•¿æœŸå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒï¼Œç¨³å®šã€å…¼å®¹æ€§å¥½ã€‚
å½“å‰ç‰ˆæœ¬åŒ…å«æœ€æ–°ç‰¹æ€§ï¼Œä½†å¯èƒ½å­˜åœ¨ä¸ç¨³å®šæƒ…å†µã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°å¼€å‘è€…æ¥è¯´ï¼Œæ¨èä½¿ç”¨ LTS ä½œä¸ºé»˜è®¤å¼€å‘ç‰ˆæœ¬ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…å› ä¸ºç‰ˆæœ¬å‡çº§å¸¦æ¥çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€ä¸åŒæ“ä½œç³»ç»Ÿçš„å®‰è£…æ–¹å¼</h2>
<h3 data-id="heading-2">Windows</h3>
<p>Windows ç”¨æˆ·å¯ä»¥ç›´æ¥ä¸‹è½½å®‰è£…åŒ…ï¼ŒæŒ‰ç…§æç¤ºä¸€æ­¥æ­¥å®‰è£…ã€‚
å®‰è£…æ—¶æ³¨æ„å‹¾é€‰æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ node å‘½ä»¤ã€‚</p>
<h3 data-id="heading-3">macOS</h3>
<p>macOS ç”¨æˆ·æ›´é€‚åˆä½¿ç”¨åŒ…ç®¡ç†å·¥å…·å®‰è£…ï¼Œæ¯”å¦‚ Homebrewã€‚
ä½¿ç”¨åŒ…ç®¡ç†å™¨å¯ä»¥æ–¹ä¾¿å‡çº§å’Œå¸è½½ï¼Œä¹Ÿæ›´ç¬¦åˆå¼€å‘è€…ä¹ æƒ¯ã€‚</p>
<h3 data-id="heading-4">Linux</h3>
<p>Linux ç”¨æˆ·å¯ä»¥é€šè¿‡ç³»ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…ã€‚
ä½†åº”é¿å…ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦æ—§ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨å®˜æ–¹æä¾›çš„è½¯ä»¶æºè·å–æœ€æ–° LTSã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</h2>
<p>å®‰è£…å®Œæˆåï¼Œåœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node -v
npm -v
</code></pre>
<p>å¦‚æœå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬å·è¾“å‡ºï¼Œè¯´æ˜ Node.js å’Œ npm å·²æˆåŠŸå®‰è£…ã€‚</p>
<hr/>
<h2 data-id="heading-6">å››ã€npm çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</h2>
<p>npm æ˜¯ Node.js è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºç®¡ç†ç¬¬ä¸‰æ–¹åº“ã€‚</p>
<p>å®ƒå¯ä»¥å®Œæˆçš„äº‹æƒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®‰è£…é¡¹ç›®ä¾èµ–</li>
<li>ç®¡ç†ç‰ˆæœ¬å…³ç³»</li>
<li>æ›´æ–°ä¸åˆ é™¤åº“</li>
<li>æ‰§è¡Œé¡¹ç›®è„šæœ¬</li>
</ul>
<p>åœ¨ Node.js é¡¹ç›®ä¸­ï¼Œpackage.json æ–‡ä»¶ç”¨äºè®°å½•ä¾èµ–å…³ç³»ä¸è¿è¡Œæ–¹å¼ã€‚
é€šè¿‡è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥åœ¨ä»»ä½•ä¸€å°æœºå™¨ä¸Šå¿«é€Ÿæ¢å¤å®Œæ•´å¼€å‘ç¯å¢ƒã€‚</p>
<hr/>
<h2 data-id="heading-7">äº”ã€yarn ä¸ npm çš„åŒºåˆ«</h2>
<p>yarn æ˜¯å¦ä¸€ç§æµè¡Œçš„åŒ…ç®¡ç†å·¥å…·ã€‚</p>
<p>ç›¸æ¯” npmï¼Œyarn æä¾›äº†æ›´ä¸¥æ ¼çš„ä¾èµ–é”å®šæœºåˆ¶ï¼Œå¯ä»¥ä¿è¯å¤šäººåä½œæ—¶ä¾èµ–ä¸€è‡´ã€‚</p>
<p>åœ¨å®‰è£…é€Ÿåº¦æ–¹é¢ï¼Œyarn é€šå¸¸æ›´å¿«ï¼›
åœ¨ç”Ÿæ€æ–¹é¢ï¼Œnpm ä½¿ç”¨èŒƒå›´æ›´å¹¿ã€‚</p>
<p>é€‰æ‹©å“ªä¸ªå·¥å…·å¹¶ä¸é‡è¦ï¼Œ<strong>é‡è¦çš„æ˜¯ä¿æŒç»Ÿä¸€</strong>ã€‚
ä¸€ä¸ªé¡¹ç›®ä¸­ä¸åº”åŒæ—¶æ··ç”¨å¤šä¸ªåŒ…ç®¡ç†å·¥å…·ã€‚</p>
<hr/>
<h2 data-id="heading-8">å…­ã€å»ºè®®ä½¿ç”¨ Node.js ç‰ˆæœ¬ç®¡ç†å·¥å…·</h2>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸åŒé¡¹ç›®å¯¹ Node.js ç‰ˆæœ¬è¦æ±‚ä¸åŒã€‚</p>
<p>è¿™æ—¶æ¨èä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·æ¥åˆ‡æ¢ Node ç‰ˆæœ¬ï¼š</p>
<ul>
<li>macOS / Linuxï¼šnvm</li>
<li>Windowsï¼šnvm-windows</li>
</ul>
<p>ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¯ä»¥åœ¨å¤šä¸ª Node ç¯å¢ƒä¹‹é—´è‡ªç”±åˆ‡æ¢ï¼Œé¿å…åå¤é‡è£…ã€‚</p>
<hr/>
<h2 data-id="heading-9">ä¸ƒã€æ€»ç»“</h2>
<p>å®‰è£… Node.js ä¸åªæ˜¯å®Œæˆä¸€ä¸ªè½¯ä»¶çš„ä¸‹è½½ï¼Œè€Œæ˜¯å»ºç«‹æ•´ä¸ªå¼€å‘ä½“ç³»çš„åŸºç¡€ã€‚</p>
<p>npm æˆ– yarn è´Ÿè´£ç®¡ç†ä¾èµ–ï¼Œ
nvm è´Ÿè´£ç®¡ç†ç‰ˆæœ¬ï¼Œ
Node.js æœ¬èº«åˆ™æ‰¿æ‹…è¿è¡Œä»»åŠ¡ã€‚</p>
<p>ç¯å¢ƒé…ç½®æ˜¯å¦è§„èŒƒï¼Œä¼šç›´æ¥å½±å“å¼€å‘æ•ˆç‡ä¸é¡¹ç›®ç¨³å®šæ€§ã€‚
å°†ç¯å¢ƒä¸€æ¬¡æ­å¥½ï¼Œæ¯”åç»­ä¸æ–­ä¿®ä¿®è¡¥è¡¥æ›´å¯é ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šé…ç½®å¼€å‘ç¯å¢ƒ]]></title>    <link>https://juejin.cn/post/7579499567869132850</link>    <guid>https://juejin.cn/post/7579499567869132850</guid>    <pubDate>2025-12-04T00:56:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869132850" data-draft-id="7579673620939784242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šé…ç½®å¼€å‘ç¯å¢ƒ"/> <meta itemprop="keywords" content="Node.js,åç«¯,Trae"/> <meta itemprop="datePublished" content="2025-12-04T00:56:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šé…ç½®å¼€å‘ç¯å¢ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:00.000Z" title="Thu Dec 04 2025 00:56:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å­¦ä¼šä½¿ç”¨ Node.js çš„ç¬¬ä¸€æ­¥ï¼Œä¸æ˜¯å†™ä¸šåŠ¡ä»£ç ï¼Œè€Œæ˜¯æ­å¥½å¼€å‘ç¯å¢ƒã€‚ä¸€ä¸ªè‰¯å¥½çš„å¼€å‘ç¯å¢ƒå¯ä»¥æ˜¾è‘—æé«˜å¼€å‘æ•ˆç‡ï¼Œå‡å°‘è°ƒè¯•æˆæœ¬ï¼Œä¹Ÿèƒ½é¿å…å¾ˆå¤šç”±äºç¯å¢ƒä¸ä¸€è‡´å¯¼è‡´çš„å¥‡æ€ªé—®é¢˜ã€‚æœ¬ç« å°†ä»¥â€œå®ç”¨ä¼˜å…ˆâ€ä¸ºåŸåˆ™ï¼Œè®²è§£å¦‚ä½•ä¸º Node.js æ­å»ºä¸€å¥—ç¨³å®šã€æ˜“ç»´æŠ¤çš„å¼€å‘ç¯å¢ƒã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ˜ç¡®å¼€å‘ç¯å¢ƒåŒ…å«å“ªäº›å†…å®¹</h2>
<p>ä¸€ä¸ªå®Œæ•´çš„ Node.js å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸åªæ˜¯å®‰è£…äº† Node.js å°±ç®—å®Œæˆã€‚é€šå¸¸è¿˜åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>Node.js è¿è¡Œç¯å¢ƒ</li>
<li>ä»£ç ç¼–è¾‘å™¨æˆ– IDE</li>
<li>åŒ…ç®¡ç†å·¥å…·ï¼ˆnpm æˆ– yarnï¼‰</li>
<li>ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼ˆå¦‚ nvmï¼‰</li>
<li>è°ƒè¯•å·¥å…·</li>
<li>ä»£ç è§„èŒƒä¸æ ¼å¼åŒ–å·¥å…·</li>
</ul>
<p>è¿™äº›å·¥å…·å…±åŒæ„æˆæ—¥å¸¸å¼€å‘çš„åŸºç¡€è®¾æ–½ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€é€‰æ‹©åˆé€‚çš„ç¼–è¾‘å™¨</h2>
<p>Node.js æ˜¯ JavaScript ç”Ÿæ€çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä»£ç ç¼–è¾‘å™¨çš„é€‰æ‹©éå¸¸é‡è¦ã€‚</p>
<p>ç›®å‰æœ€æ¨èçš„å¼€å‘å·¥å…·æ˜¯ Visual Studio Codeï¼Œå®ƒè½»é‡ã€åŠŸèƒ½å¼ºã€æ’ä»¶ç”Ÿæ€ä¸°å¯Œï¼Œé€‚åˆå‰åç«¯å¼€å‘ä¸€ä½“åŒ–ä½¿ç”¨ã€‚</p>
<p>å»ºè®®å®‰è£…ä»¥ä¸‹å¸¸ç”¨æ’ä»¶ï¼š</p>
<ul>
<li>ESLintï¼šä»£ç è´¨é‡æ£€æŸ¥</li>
<li>Prettierï¼šä»£ç æ ¼å¼åŒ–</li>
<li>GitLensï¼šGit è¾…åŠ©å·¥å…·</li>
<li>Node.js è°ƒè¯•æ‰©å±•</li>
</ul>
<p>åˆé€‚çš„æ’ä»¶å¯ä»¥å¤§å¹…æå‡å¼€å‘ä½“éªŒï¼ŒåŒæ—¶é¿å…ä½çº§æ ¼å¼é”™è¯¯ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€é…ç½® Node.js ç‰ˆæœ¬ç®¡ç†å·¥å…·</h2>
<p>éšç€é¡¹ç›®å¢å¤šï¼Œå¿…ç„¶ä¼šé‡åˆ°å¤šä¸ª Node.js ç‰ˆæœ¬å…±å­˜çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œç‰ˆæœ¬ç®¡ç†å·¥å…·å˜å¾—éå¸¸é‡è¦ã€‚</p>
<p>macOS å’Œ Linux ç³»ç»Ÿæ¨èä½¿ç”¨ nvmã€‚
Windows ç³»ç»Ÿæ¨èä½¿ç”¨ nvm-windowsã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç®¡ç†ç‰ˆæœ¬ï¼š</p>
<ul>
<li>å®‰è£…æŒ‡å®šç‰ˆæœ¬</li>
<li>åˆ‡æ¢å½“å‰ç‰ˆæœ¬</li>
<li>æŸ¥çœ‹å·²å®‰è£…ç‰ˆæœ¬åˆ—è¡¨</li>
<li>è®¾ç½®é»˜è®¤ç‰ˆæœ¬</li>
</ul>
<p>ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·æ˜¯ä¸“ä¸šå¼€å‘è€…çš„åŸºæœ¬ä¹ æƒ¯ä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-3">å››ã€åˆå§‹åŒ–ç¬¬ä¸€ä¸ª Node.js é¡¹ç›®</h2>
<p>è¿›å…¥å·¥ä½œç›®å½•åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª package.json æ–‡ä»¶ï¼Œä½œä¸ºé¡¹ç›®çš„é…ç½®ä¸­å¿ƒã€‚</p>
<p>æ¥ä¸‹æ¥å¯ä»¥å®‰è£…å¸¸ç”¨å·¥å…·åŒ…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install express
</code></pre>
<p>é¡¹ç›®ç›®å½•é€šå¸¸åŒ…æ‹¬ï¼š</p>
<ul>
<li>node_modules ä¾èµ–ç›®å½•</li>
<li>package.json é¡¹ç›®é…ç½®æ–‡ä»¶</li>
<li>index.js æˆ– app.js å…¥å£æ–‡ä»¶</li>
</ul>
<p>ä¸€ä¸ªæœ€åŸºç¡€çš„ Node.js é¡¹ç›®ç»“æ„å°±æ­å»ºå®Œæˆäº†ã€‚</p>
<hr/>
<h2 data-id="heading-4">äº”ã€é…ç½®è°ƒè¯•ç¯å¢ƒ</h2>
<p>è‰¯å¥½çš„è°ƒè¯•èƒ½åŠ›å¯ä»¥æå¤§æå‡å¼€å‘æ•ˆç‡ã€‚</p>
<p>åœ¨ Visual Studio Code ä¸­ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºè°ƒè¯•é…ç½®æ–‡ä»¶ launch.jsonï¼Œç”¨äºå¯åŠ¨ Node.js è°ƒè¯•ä»»åŠ¡ã€‚</p>
<p>é…ç½®å®Œæˆåï¼š</p>
<ul>
<li>æ”¯æŒæ–­ç‚¹è°ƒè¯•</li>
<li>æ”¯æŒå˜é‡ç›‘æ§</li>
<li>æ”¯æŒè°ƒç”¨æ ˆåˆ†æ</li>
<li>æ”¯æŒå•æ­¥æ‰§è¡Œ</li>
</ul>
<p>ç›¸æ¯”ä½¿ç”¨ console.log è°ƒè¯•ï¼Œæ–­ç‚¹è°ƒè¯•æ›´åŠ é«˜æ•ˆå¯é ã€‚</p>
<hr/>
<h2 data-id="heading-5">å…­ã€å¼•å…¥ä»£ç è§„èŒƒä¸æ ¼å¼åŒ–å·¥å…·</h2>
<p>ä»£ç è§„èŒƒå¯ä»¥è®©é¡¹ç›®æ›´æ˜“ç»´æŠ¤ï¼Œä¹Ÿæ›´åˆ©äºå›¢é˜Ÿåä½œã€‚</p>
<p>æ¨èåœ¨é¡¹ç›®ä¸­é…ç½®ï¼š</p>
<ul>
<li>ESLintï¼šçº¦æŸä»£ç é£æ ¼</li>
<li>Prettierï¼šç»Ÿä¸€ä»£ç æ ¼å¼</li>
</ul>
<p>å®‰è£…ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install eslint prettier -D
</code></pre>
<p>é€šè¿‡è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ï¼Œå¯ä»¥å‡å°‘å¤§é‡æ ¼å¼é—®é¢˜å’Œä½çº§é”™è¯¯ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸ƒã€é…ç½® Git ä¸ç‰ˆæœ¬æ§åˆ¶</h2>
<p>ä»»ä½•ä¸€ä¸ªçœŸå®é¡¹ç›®éƒ½åº”çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</p>
<p>å»ºè®®ï¼š</p>
<ul>
<li>åˆå§‹åŒ– Git ä»“åº“</li>
<li>è®¾ç½® .gitignore æ–‡ä»¶</li>
<li>å®šæœŸæäº¤ä»£ç </li>
<li>ä½¿ç”¨åˆ†æ”¯å¼€å‘</li>
</ul>
<p>ç‰ˆæœ¬æ§åˆ¶ä¸ä»…æ˜¯ä»£ç å¤‡ä»½å·¥å…·ï¼Œæ›´æ˜¯å›¢é˜Ÿåä½œçš„ç”Ÿå‘½çº¿ã€‚</p>
<hr/>
<h2 data-id="heading-7">å…«ã€æ€»ç»“</h2>
<p>å¼€å‘ç¯å¢ƒçš„è´¨é‡ç›´æ¥å†³å®šå¼€å‘æ•ˆç‡å’Œé¡¹ç›®ç¨³å®šæ€§ã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„ Node.js å¼€å‘ç¯å¢ƒåº”åŒ…å«è¿è¡Œç¯å¢ƒã€ç¼–è¾‘å™¨ã€åŒ…ç®¡ç†å·¥å…·ã€è°ƒè¯•é…ç½®ã€ä»£ç è§„èŒƒã€ç‰ˆæœ¬æ§åˆ¶ç­‰å¤šä¸ªæ–¹é¢ã€‚</p>
<p>å‰æœŸå¤šèŠ±ä¸€äº›æ—¶é—´é…ç½®ç¯å¢ƒï¼ŒåæœŸå¯ä»¥å°‘è¸©å¾ˆå¤šå‘ã€‚
ç¯å¢ƒç¨³å®šï¼Œæ‰èƒ½ä¸“æ³¨ä¸šåŠ¡ä¸æŠ€æœ¯ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python å¼€å‘ä¸­æœ€å¸¸è§çš„é”™è¯¯å¤§å…¨ï¼ˆå« JSON ä¸“é¡¹è§£æï¼‰]]></title>    <link>https://juejin.cn/post/7579499567869149234</link>    <guid>https://juejin.cn/post/7579499567869149234</guid>    <pubDate>2025-12-04T00:56:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869149234" data-draft-id="7579472170906468402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python å¼€å‘ä¸­æœ€å¸¸è§çš„é”™è¯¯å¤§å…¨ï¼ˆå« JSON ä¸“é¡¹è§£æï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-04T00:56:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python å¼€å‘ä¸­æœ€å¸¸è§çš„é”™è¯¯å¤§å…¨ï¼ˆå« JSON ä¸“é¡¹è§£æï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:53.000Z" title="Thu Dec 04 2025 00:56:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰¯æ ‡é¢˜</strong>ï¼šä» SyntaxError åˆ° JSONDecodeErrorï¼Œä¸€æ–‡å¸®ä½ é¿å¼€ 90% çš„å‘</p>
</blockquote>
<p>Python ä»¥â€œç®€æ´æ˜“è¯»â€è‘—ç§°ï¼Œä½†å³ä¾¿æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…ï¼Œä¹Ÿå¸¸è¢«å„ç§é”™è¯¯æå¾—ç„¦å¤´çƒ‚é¢ã€‚è¿™äº›é”™è¯¯ä¸ä»…å½±å“å¼€å‘æ•ˆç‡ï¼Œè¿˜å¯èƒ½æ½œä¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¼•å‘ä¸¥é‡æ•…éšœã€‚</p>
<p>æœ¬æ–‡ç³»ç»Ÿæ¢³ç†äº† <strong>Python ä¸­æœ€å¸¸è§çš„é”™è¯¯ç±»å‹</strong>ï¼Œå¹¶ç‰¹åˆ«æ·±å…¥è§£æäº† <strong>JSON ç›¸å…³é”™è¯¯</strong>â€”â€”è¿™æ˜¯ Web å¼€å‘ã€API è°ƒç”¨å’Œæ•°æ®å¤„ç†ä¸­æœ€é¢‘ç¹å‡ºç°çš„é—®é¢˜ä¹‹ä¸€ã€‚æ¯ç±»é”™è¯¯éƒ½é…æœ‰ <strong>çœŸå®ç¤ºä¾‹ + åŸç†è§£é‡Š + è§£å†³æ–¹æ¡ˆ</strong>ï¼ŒåŠ©ä½ å¿«é€Ÿæ’é”™ã€å†™å‡ºå¥å£®ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é”™è¯¯åˆ†ç±»æ¦‚è§ˆ</h2>
<p>Python é”™è¯¯ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ol>
<li><strong>è¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰</strong> ï¼šä»£ç ä¸ç¬¦åˆ Python è¯­æ³•è§„åˆ™ï¼Œè§£é‡Šå™¨ç›´æ¥æ‹’ç»è¿è¡Œã€‚</li>
<li><strong>è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆExceptionsï¼‰</strong> ï¼šç¨‹åºèƒ½å¯åŠ¨ï¼Œä½†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å› é€»è¾‘æˆ–ç¯å¢ƒé—®é¢˜å´©æºƒã€‚</li>
<li><strong>é€»è¾‘é”™è¯¯ï¼ˆLogic Errorsï¼‰</strong> ï¼šä»£ç èƒ½è¿è¡Œä¸”ä¸æŠ¥é”™ï¼Œä½†ç»“æœä¸ç¬¦åˆé¢„æœŸï¼ˆæœ€éš¾è°ƒè¯•ï¼‰ã€‚</li>
</ol>
<p>æˆ‘ä»¬é‡ç‚¹è®¨è®ºå‰ä¸¤ç±»ï¼Œå¹¶åŠ å…¥ <strong>JSON ä¸“é¡¹ç« èŠ‚</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€è¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰</h2>
<p>è¿™ç±»é”™è¯¯åœ¨ä¿å­˜æˆ–è¿è¡Œè„šæœ¬æ—¶ç«‹å³æš´éœ²ã€‚</p>
<h3 data-id="heading-2">å¸¸è§åœºæ™¯ï¼š</h3>
<ul>
<li>ç¼ºå°‘å†’å· <code>:</code>ï¼ˆ<code>if</code>, <code>for</code>, <code>def</code> åå¿…é¡»åŠ ï¼‰</li>
<li>æ‹¬å·/å¼•å·ä¸åŒ¹é…</li>
<li>é”™è¯¯ç¼©è¿›ï¼ˆæ··ç”¨ç©ºæ ¼ä¸ Tabï¼‰</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># âŒ å…¸å‹é”™è¯¯</span>
<span class="hljs-keyword">if</span> x &gt; 0
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"positive"</span>)  <span class="hljs-comment"># SyntaxError: invalid syntax</span>

<span class="hljs-comment"># âœ… æ­£ç¡®å†™æ³•</span>
<span class="hljs-keyword">if</span> x &gt; 0:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"positive"</span>)
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>å»ºè®®</strong>ï¼šä½¿ç”¨æ”¯æŒè¯­æ³•é«˜äº®å’Œæ‹¬å·åŒ¹é…çš„ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Codeã€PyCharmï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆExceptionsï¼‰</h2>
<h3 data-id="heading-4">1. NameErrorï¼šå˜é‡æœªå®šä¹‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">print</span>(username)  # NameError: name <span class="hljs-string">'username'</span> is not defined
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼šç¡®ä¿å˜é‡å·²èµ‹å€¼ï¼Œæ³¨æ„ä½œç”¨åŸŸã€‚</p>
<hr/>
<h3 data-id="heading-5">2. AttributeErrorï¼šå¯¹è±¡æ— æ­¤å±æ€§</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[]</span><span class="hljs-selector-class">.push</span>(<span class="hljs-number">1</span>)  # AttributeError: <span class="hljs-string">'list'</span> object has no attribute <span class="hljs-string">'push'</span>
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼šæŸ¥å®˜æ–¹æ–‡æ¡£ï¼Œç¡®è®¤æ–¹æ³•åï¼ˆå¦‚ <code>list.append()</code>ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-6">3. IndexError / KeyErrorï¼šè¶Šç•Œè®¿é—®</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">d</span> = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>}
print(d<span class="hljs-section">["age"]</span>)  <span class="hljs-comment"># KeyError: 'age'</span>
</code></pre>
<p>âœ… <strong>å®‰å…¨è®¿é—®</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">d.<span class="hljs-keyword">get</span>(<span class="hljs-string">"age"</span>, <span class="hljs-string">"æœªçŸ¥"</span>)  <span class="hljs-meta"># æ¨è</span>
<span class="hljs-meta"># æˆ–</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">"age"</span> <span class="hljs-keyword">in</span> d: ...
</code></pre>
<hr/>
<h3 data-id="heading-7">4. TypeErrorï¼šç±»å‹ä¸åŒ¹é…</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"5"</span> + 3  <span class="hljs-comment"># TypeError: can only concatenate str (not "int") to str</span>
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼šæ˜¾å¼è½¬æ¢ç±»å‹ï¼Œå¦‚ <code>int("5") + 3</code>ã€‚</p>
<hr/>
<h3 data-id="heading-8">5. ValueErrorï¼šå€¼åˆæ³•ä½†ä¸ç¬¦åˆè¦æ±‚</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">int</span>(<span class="hljs-string">"abc"</span>)  <span class="hljs-comment"># ValueError: invalid literal for int()</span>
</code></pre>
<p>âœ… <strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    num = <span class="hljs-built_in">int</span>(user_input)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—"</span>)
</code></pre>
<hr/>
<h3 data-id="heading-9">6. ZeroDivisionErrorï¼šé™¤é›¶é”™è¯¯</h3>
<pre><code class="hljs language-bash" lang="bash">10 / 0  <span class="hljs-comment"># ZeroDivisionError</span>
</code></pre>
<p>âœ… <strong>æ£€æŸ¥åˆ†æ¯</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">if denominator != 0:
    <span class="hljs-attr">result</span> = numerator / denominator
</code></pre>
<hr/>
<h3 data-id="heading-10">7. FileNotFoundErrorï¼šæ–‡ä»¶ä¸å­˜åœ¨</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">open</span>(<span class="hljs-string">"missing.txt"</span>)  <span class="hljs-comment"># FileNotFoundError</span>
</code></pre>
<p>âœ… <strong>å®‰å…¨æ‰“å¼€</strong>ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">import <span class="hljs-built_in">os</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(<span class="hljs-string">"file.txt"</span>):
    with <span class="hljs-built_in">open</span>(<span class="hljs-string">"file.txt"</span>) as f: ...
</code></pre>
<hr/>
<h3 data-id="heading-11">8. ModuleNotFoundErrorï¼šæ¨¡å—æœªå®‰è£…</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># ModuleNotFoundErrorï¼ˆè‹¥æœªå®‰è£…ï¼‰</span>
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼š</p>
<pre><code class="hljs">pip install requests
</code></pre>
<hr/>
<h2 data-id="heading-12">å››ã€ç»å…¸é€»è¾‘é™·é˜±</h2>
<h3 data-id="heading-13">å¯å˜é»˜è®¤å‚æ•°ï¼ˆMutable Default Argumentï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ å±é™©ï¼</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">item, lst=[]</span>):
    lst.append(item)
    <span class="hljs-keyword">return</span> lst

<span class="hljs-built_in">print</span>(add(<span class="hljs-number">1</span>))  <span class="hljs-comment"># [1]</span>
<span class="hljs-built_in">print</span>(add(<span class="hljs-number">2</span>))  <span class="hljs-comment"># [1, 2] â† æ„å¤–å…±äº«ï¼</span>

<span class="hljs-comment"># âœ… æ­£ç¡®</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">item, lst=<span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">if</span> lst <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        lst = []
    lst.append(item)
    <span class="hljs-keyword">return</span> lst
</code></pre>
<blockquote>
<p>ğŸ“Œ <strong>é»„é‡‘æ³•åˆ™</strong>ï¼šæ°¸è¿œä¸è¦ç”¨ <code>list</code>ã€<code>dict</code>ã€<code>set</code> ç­‰å¯å˜å¯¹è±¡ä½œä¸ºå‡½æ•°é»˜è®¤å‚æ•°ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">äº”ã€JSON ä¸“é¡¹ï¼šæœ€å¸¸è¢«å¿½è§†çš„é”™è¯¯æº</h2>
<p>åœ¨ API å¼€å‘ã€é…ç½®æ–‡ä»¶è¯»å–ã€å‰åç«¯é€šä¿¡ä¸­ï¼Œ<strong>JSON æ˜¯æ•°æ®äº¤æ¢çš„é€šç”¨è¯­è¨€</strong>ã€‚ä½†å¤„ç†ä¸å½“ææ˜“å‡ºé”™ã€‚</p>
<h3 data-id="heading-15">1. <code>json.JSONDecodeError</code>ï¼šJSON æ ¼å¼éæ³•</h3>
<p>è¿™æ˜¯ <strong>æœ€å¸¸è§</strong> çš„ JSON é”™è¯¯ï¼Œé€šå¸¸ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š</p>
<h4 data-id="heading-16">âŒ åœºæ™¯ 1ï¼šå­—ç¬¦ä¸²ä¸æ˜¯åˆæ³• JSON</h4>
<pre><code class="hljs language-ini" lang="ini">import json

<span class="hljs-attr">data</span> = <span class="hljs-string">"{'name': 'Alice'}"</span>  <span class="hljs-comment"># æ³¨æ„ï¼šç”¨äº†å•å¼•å·ï¼</span>
json.loads(data)  <span class="hljs-comment"># JSONDecodeError: Expecting property name enclosed in double quotes</span>
</code></pre>
<p>âœ… <strong>åŸå› </strong>ï¼šJSON æ ‡å‡†è¦æ±‚ <strong>é”®å’Œå­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å· <code>"</code></strong> ï¼Œå•å¼•å·æ— æ•ˆã€‚</p>
<p>âœ… <strong>è§£å†³</strong>ï¼š</p>
<ul>
<li>
<p>ç¡®ä¿æ•°æ®æºè¾“å‡ºæ ‡å‡† JSONï¼ˆå¦‚åç«¯ç”¨ <code>json.dumps()</code>ï¼‰</p>
</li>
<li>
<p>è‹¥å¿…é¡»è§£æéæ ‡å‡†å­—ç¬¦ä¸²ï¼Œå¯å…ˆæ›¿æ¢ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">data</span> = data.replace(<span class="hljs-string">"'"</span>, <span class="hljs-string">'"'</span>)
</code></pre>
</li>
</ul>
<h4 data-id="heading-17">âŒ åœºæ™¯ 2ï¼šæœ«å°¾å¤šä½™é€—å·</h4>
<pre><code class="hljs language-makefile" lang="makefile">data = '{<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"age"</span>: 30,}'  <span class="hljs-comment"># æœ«å°¾é€—å·</span>
json.loads(data)  <span class="hljs-comment"># JSONDecodeError</span>
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼šä½¿ç”¨åœ¨çº¿ JSON æ ¡éªŒå·¥å…·ï¼ˆå¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjsonlint.com%2F" target="_blank" title="https://jsonlint.com/" ref="nofollow noopener noreferrer">jsonlint.com</a>ï¼‰éªŒè¯ã€‚</p>
<h4 data-id="heading-18">âŒ åœºæ™¯ 3ï¼šå“åº”ä½“ä¸ºç©ºæˆ– HTML</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æ¨¡æ‹Ÿè¯·æ±‚è¿”å› 404 é¡µé¢ï¼ˆHTMLï¼‰</span>
<span class="hljs-attr">response_text</span> = <span class="hljs-string">"&lt;html&gt;Not Found&lt;/html&gt;"</span>
json.loads(response_text)  <span class="hljs-comment"># JSONDecodeError</span>
</code></pre>
<p>âœ… <strong>é˜²å¾¡æ€§å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> requests

resp = requests.get(<span class="hljs-string">"https://api.example.com/data"</span>)
<span class="hljs-keyword">try</span>:
    data = resp.json()  <span class="hljs-comment"># requests å†…éƒ¨è°ƒç”¨ json.loads()</span>
<span class="hljs-keyword">except</span> json.JSONDecodeError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å“åº”ä¸æ˜¯ JSONï¼çŠ¶æ€ç :"</span>, resp.status_code)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"åŸå§‹å†…å®¹:"</span>, resp.text[:<span class="hljs-number">200</span>])
</code></pre>
<hr/>
<h3 data-id="heading-19">2. <code>TypeError: Object of type xxx is not JSON serializable</code></h3>
<p>å½“ä½ å°è¯•æŠŠ <strong>é JSON æ”¯æŒçš„ç±»å‹</strong> åºåˆ—åŒ–æ—¶å‘ç”Ÿï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

data = {<span class="hljs-string">"time"</span>: datetime.<span class="hljs-title function_">now</span>()}
json.<span class="hljs-title function_">dumps</span>(data)  # <span class="hljs-title class_">TypeError</span>: <span class="hljs-title class_">Object</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> datetime is not <span class="hljs-title class_">JSON</span> serializable
</code></pre>
<p>âœ… <strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<h4 data-id="heading-20">æ–¹æ³• 1ï¼šè‡ªå®šä¹‰ <code>default</code> å‡½æ•°</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">json_serializer</span>(<span class="hljs-params">obj</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, datetime):
        <span class="hljs-keyword">return</span> obj.isoformat()
    <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f"Type <span class="hljs-subst">{<span class="hljs-built_in">type</span>(obj)}</span> not serializable"</span>)

json.dumps(data, default=json_serializer)
</code></pre>
<h4 data-id="heading-21">æ–¹æ³• 2ï¼šæå‰è½¬æ¢</h4>
<pre><code class="hljs language-css" lang="css">data = {"<span class="hljs-selector-tag">time</span>": datetime.<span class="hljs-built_in">now</span>().<span class="hljs-built_in">isoformat</span>()}
json<span class="hljs-selector-class">.dumps</span>(data)  # OK
</code></pre>
<h4 data-id="heading-22">æ–¹æ³• 3ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ <code>orjson</code>ã€<code>ujson</code>ï¼‰æ”¯æŒæ›´å¤šç±»å‹</h4>
<hr/>
<h3 data-id="heading-23">3. ä¸­æ–‡ä¹±ç é—®é¢˜ï¼ˆç¼–ç é”™è¯¯ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å†™å…¥æ–‡ä»¶</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
    json.dump({<span class="hljs-string">"æ¶ˆæ¯"</span>: <span class="hljs-string">"ä½ å¥½"</span>}, f)

<span class="hljs-comment"># è¯»å–æ—¶å¯èƒ½ä¹±ç ï¼ˆå°¤å…¶åœ¨ Windowsï¼‰</span>
</code></pre>
<p>âœ… <strong>è§£å†³</strong>ï¼šæ˜¾å¼æŒ‡å®š UTF-8 ç¼–ç </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å†™å…¥</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    json.dump(data, f, ensure_ascii=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># å…³é”®ï¼šensure_ascii=False</span>

<span class="hljs-comment"># è¯»å–</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    data = json.load(f)
</code></pre>
<blockquote>
<p>ğŸ”‘ <strong>ä¸¤ä¸ªå…³é”®å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>encoding="utf-8"</code>ï¼šç¡®ä¿æ–‡ä»¶ä»¥ UTF-8 è¯»å†™</li>
<li><code>ensure_ascii=False</code>ï¼šå…è®¸è¾“å‡ºä¸­æ–‡è€Œé <code>\u4f60\u597d</code></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-24">å…­ã€æœ€ä½³å®è·µï¼šå¦‚ä½•é¿å…å’Œå¿«é€Ÿå®šä½é”™è¯¯ï¼Ÿ</h2>
<h3 data-id="heading-25">1. ä½¿ç”¨ <code>try...except</code> ç²¾å‡†æ•è·</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    data = json.loads(api_response)
<span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">f"JSON è§£æå¤±è´¥: <span class="hljs-subst">{e.msg}</span> at line <span class="hljs-subst">{e.lineno}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">f"æœªçŸ¥é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h3 data-id="heading-26">2. å¯ç”¨ç±»å‹æç¤º + mypy</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_user</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-keyword">return</span> json.loads(data)  <span class="hljs-comment"># mypy å¯æ£€æŸ¥è¿”å›ç±»å‹</span>
</code></pre>
<h3 data-id="heading-27">3. å•å…ƒæµ‹è¯•è¦†ç›–å¼‚å¸¸è·¯å¾„</h3>
<pre><code class="hljs language-scss" lang="scss">def <span class="hljs-built_in">test_invalid_json</span>():
    with pytest.<span class="hljs-built_in">raises</span>(json.JSONDecodeError):
        <span class="hljs-built_in">parse_user</span>(<span class="hljs-string">"{'invalid': json}"</span>)
</code></pre>
<h3 data-id="heading-28">4. æ—¥å¿—è®°å½•åŸå§‹æ•°æ®</h3>
<p>å½“ JSON è§£æå¤±è´¥æ—¶ï¼Œ<strong>åŠ¡å¿…è®°å½•åŸå§‹å­—ç¬¦ä¸²</strong>ï¼Œä¾¿äºå¤ç°é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-29">ä¸ƒã€æ€»ç»“</h2>



































<table><thead><tr><th>é”™è¯¯ç±»å‹</th><th>é«˜é¢‘åœºæ™¯</th><th>é˜²å¾¡ç­–ç•¥</th></tr></thead><tbody><tr><td><code>SyntaxError</code></td><td>ç¼©è¿›ã€å†’å·ã€æ‹¬å·</td><td>ä½¿ç”¨æ™ºèƒ½ IDE</td></tr><tr><td><code>NameError</code></td><td>å˜é‡æœªå®šä¹‰</td><td>æ£€æŸ¥æ‹¼å†™ä¸ä½œç”¨åŸŸ</td></tr><tr><td><code>JSONDecodeError</code></td><td>éæ ‡å‡† JSONã€ç©ºå“åº”</td><td>æ ¡éªŒ + try-except + è®°å½•åŸå§‹æ•°æ®</td></tr><tr><td><code>TypeError</code>ï¼ˆåºåˆ—åŒ–ï¼‰</td><td>datetimeã€è‡ªå®šä¹‰å¯¹è±¡</td><td>è‡ªå®šä¹‰ <code>default</code> æˆ–é¢„è½¬æ¢</td></tr><tr><td>å¯å˜é»˜è®¤å‚æ•°</td><td>å‡½æ•°é»˜è®¤å€¼ä¸º list/dict</td><td>ç”¨ <code>None</code> ä»£æ›¿</td></tr></tbody></table>
<blockquote>
<p><strong>è®°ä½</strong>ï¼š<br/>
<strong>â€œé”™è¯¯ä¸æ˜¯æ•Œäººï¼Œè€Œæ˜¯ä½ ä»£ç çš„åé¦ˆã€‚â€</strong><br/>
å­¦ä¼šé˜…è¯»é”™è¯¯ä¿¡æ¯ï¼ˆå°¤å…¶æ˜¯ traceback å’Œ <code>JSONDecodeError</code> çš„ <code>lineno</code>ï¼‰ï¼Œæ˜¯æˆä¸ºé«˜æ•ˆ Python å¼€å‘è€…çš„å…³é”®ä¸€æ­¥ã€‚</p>
</blockquote>
<hr/>
<p><strong>å»¶ä¼¸é˜…è¯»</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fexceptions.html" target="_blank" title="https://docs.python.org/3/library/exceptions.html" ref="nofollow noopener noreferrer">Python å®˜æ–¹å¼‚å¸¸æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc8259" target="_blank" title="https://datatracker.ietf.org/doc/html/rfc8259" ref="nofollow noopener noreferrer">JSON æ ‡å‡† RFC 8259</a></li>
<li>ã€ŠEffective Pythonã€‹ç¬¬ 5 æ¡ï¼šäº†è§£ Python çš„ slice å’Œå¼‚å¸¸æœºåˆ¶</li>
</ul>
<hr/>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æˆä¸ºä½ æ—¥å¸¸å¼€å‘çš„â€œé¿å‘æŒ‡å—â€ã€‚å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—æˆ–åˆ†äº«ç»™å›¢é˜Ÿå°ä¼™ä¼´ï¼</p>
<blockquote>
<p>âœï¸ <strong>ä½œè€…</strong>ï¼šä¸€ä½è¸©è¿‡æ— æ•° JSON å‘çš„ Python å·¥ç¨‹å¸ˆ<br/>
ğŸ“… <strong>æ›´æ–°æ—¥æœŸ</strong>ï¼š2025 å¹´ 12 æœˆ<br/>
ğŸ·ï¸ <strong>æ ‡ç­¾</strong>ï¼š#Python #JSON #é”™è¯¯å¤„ç† #å¼€å‘æŠ€å·§ #åç«¯å¼€å‘</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸å–è¯¾ï¼Œçº¯å¹²è´§ï¼Androidåˆ†å±‚ä½ çŸ¥å¤šå°‘ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579476335557017635</link>    <guid>https://juejin.cn/post/7579476335557017635</guid>    <pubDate>2025-12-04T00:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579476335557017635" data-draft-id="7576187677839491087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸å–è¯¾ï¼Œçº¯å¹²è´§ï¼Androidåˆ†å±‚ä½ çŸ¥å¤šå°‘ï¼Ÿ"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-04T00:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸å–è¯¾ï¼Œçº¯å¹²è´§ï¼Androidåˆ†å±‚ä½ çŸ¥å¤šå°‘ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:58.000Z" title="Thu Dec 04 2025 00:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"â˜‚"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"âœ“"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"â¤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>æœ¬ç³»åˆ—ä¸ºå°è¯´ã€Šé€†è¢­è¥¿äºŒæ——ã€‹çš„æŠ€æœ¯è®²è§£ï¼Œç”¨äºè¯¦ç»†è¯´æ˜<a href="https://juejin.cn/post/7578700798745002018" target="_blank" title="https://juejin.cn/post/7578700798745002018">å‰§æƒ…</a>é‡Œæ¶‰åŠçš„å¼€å‘ç»†èŠ‚ã€‚</em></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ed9285ea7d94f4894512aeeaf132ce7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=pXkavJOWN0BshjIhuDJtD4U6x9w%3D" alt="0.jpg" loading="lazy"/></p>
<p>è‡ª 2008 å¹´ 9 æœˆ 23 æ—¥å‘å¸ƒä»¥æ¥ï¼ŒAndroid ç»å†äº†å·¨å¤§çš„æ¼”è¿›ã€‚å¤šå¹´æ¥ï¼ŒAndroid SDK å’Œæ•´ä¸ªç”Ÿæ€å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ï¼Œæ–°å·¥å…·å’Œè§£å†³æ–¹æ¡ˆå±‚å‡ºä¸ç©·ï¼Œæ¯”å¦‚ Android Architecture Componentsï¼ˆAACï¼‰ã€Jetpack ç³»åˆ—åº“ï¼Œä»¥åŠ Jetpack Composeã€‚ç„¶è€Œï¼Œå°½ç®¡æŠ€æœ¯ä¸æ–­é©æ–°ï¼ŒAndroid åº•å±‚çš„ä¸€äº›æ ¸å¿ƒæœºåˆ¶â€”â€”å¦‚ <code>Intent</code>ã€<code>Window</code> å’ŒåŸºç¡€ <code>View</code> æ¶æ„â€”â€”å´å§‹ç»ˆä¿æŒé«˜åº¦ç¨³å®šã€‚</p>
<p>ä¸åŒå…¬å¸åœ¨æ„å»º Android åº”ç”¨æ—¶é‡‡ç”¨çš„æŠ€æœ¯æ ˆå’Œå¼€å‘æ–¹å¼å„ä¸ç›¸åŒã€‚å› æ­¤ï¼Œè¦æƒ³æ‰¾åˆ°å¿ƒä»ªçš„ Android æ–¹é¢å·¥ä½œï¼Œå¿…é¡»æ ¹æ®èŒä½æè¿°ä¸­çš„æœ€ä½è¦æ±‚ï¼Œä»¥åŠç›®æ ‡å…¬å¸å®é™…ä½¿ç”¨çš„æŠ€æœ¯ï¼Œæœ‰é’ˆå¯¹æ€§åœ°å‡†å¤‡é¢è¯•ã€‚äº†è§£ä»–ä»¬çš„æŠ€æœ¯éœ€æ±‚ï¼Œèƒ½è®©ä½ æ›´é«˜æ•ˆåœ°èšç„¦é‡ç‚¹ã€‚</p>
<p>é¢è¯•é¢˜çš„éš¾åº¦å› å…¬å¸å’Œé¢è¯•å®˜è€Œå¼‚ã€‚ä¸å…¶æ­»è®°ç¡¬èƒŒç­”æ¡ˆï¼Œä¸å¦‚æ·±å…¥ç†è§£åº•å±‚æ¦‚å¿µï¼Œå¹¶å¤šåŠ å®è·µåº”ç”¨ã€‚æœ¬ç³»åˆ—ä¸­çš„é—®é¢˜æ—¨åœ¨ä¸ºä½ å‡†å¤‡ Android æŠ€æœ¯é¢è¯•æä¾›å‚è€ƒï¼Œå¹¶éæ¶µç›–æ‰€æœ‰å¯èƒ½è€ƒé¢˜çš„â€œæ ‡å‡†ç­”æ¡ˆæ‰‹å†Œâ€ã€‚</p>
<p>æœ‰äº›å…¬å¸ä¼šä¾§é‡è€ƒå¯Ÿ Android ç³»ç»Ÿåº•å±‚è¿ä½œå’Œæ¶æ„ï¼Œä»¥è¯„ä¼°ä½ å¯¹ Android åŸºç¡€çš„ç†è§£ï¼›å¦ä¸€äº›åˆ™æ›´å…³æ³¨é«˜å±‚ API æˆ–æµè¡Œåº“çš„ä½¿ç”¨ï¼Œçœ‹ä½ èƒ½å¦å¿«é€Ÿå°†å…¶æ•´åˆè¿›äº§å“ä¸­ã€‚ä¸åŒå…¬å¸çš„è¯„åˆ†æ ‡å‡†ä¹Ÿå¤§ç›¸å¾„åº­ï¼Œè¿™æ„å‘³ç€å¾ˆå¤šé—®é¢˜å¹¶æ²¡æœ‰å”¯ä¸€â€œå®Œç¾â€çš„ç­”æ¡ˆã€‚è¯¥ç³»åˆ—æä¾›çš„å›ç­”åªæ˜¯èµ·ç‚¹ï¼Œé¼“åŠ±ä½ åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‹“å±•å’Œæ·±æŒ–ã€‚</p>
<p>æœ¬ç³»åˆ—æ— æ„è¦†ç›– Android å¼€å‘è¿™ä¸€å¹¿é˜”é¢†åŸŸä¸­çš„æ‰€æœ‰å¯èƒ½é—®é¢˜ï¼Œè€Œæ˜¯å¸Œæœ›ä¸ºä½ æ‰“ä¸‹æ‰å®åŸºç¡€ï¼ŒåŠ©ä½ é«˜æ•ˆå‡†å¤‡ï¼Œå¹¶æ ¹æ®ç›®æ ‡å²—ä½çš„å…·ä½“è¦æ±‚è°ƒæ•´å­¦ä¹ æ–¹å‘ã€‚éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œæœ¬ç³»åˆ—å¹¶æœªæ·±å…¥æ¢è®¨é«˜çº§ç¬¬ä¸‰æ–¹åº“æˆ–åº•å±‚ç¡¬ä»¶ç›¸å…³åŠŸèƒ½ï¼ˆå¦‚ Camera APIã€Bluetooth ç­‰ï¼‰ã€‚å¦‚æœè¿™äº›å†…å®¹ä¸ä½ çš„èŒä¸šç›®æ ‡ç›¸å…³ï¼Œä½ éœ€è¦é¢å¤–æŸ¥é˜…èµ„æ–™ï¼Œè‡ªä¸»è¡¥å……çŸ¥è¯†ã€‚</p>
<p>ç¥ä½ åœ¨ Android é¢è¯•å‡†å¤‡ä¸­ä¸€åˆ‡é¡ºåˆ©ï¼</p>
<h2 data-id="heading-0">Android åˆ†å±‚æ˜¯ä»€ä¹ˆ</h2>
<p>Android æ˜¯ä¸€ä¸ªå¼€æºæ“ä½œç³»ç»Ÿï¼Œä¸»è¦é¢å‘æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç­‰ç§»åŠ¨è®¾å¤‡ã€‚å®ƒç”± Google å¼€å‘å¹¶ç»´æŠ¤ï¼ŒåŸºäº Linux å†…æ ¸ï¼Œæä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å¹³å°ï¼Œèƒ½å¤Ÿé€‚é…å„ç§ç¡¬ä»¶é…ç½®å’Œè®¾å¤‡ã€‚</p>
<h3 data-id="heading-1">é¢è¯•é—®é¢˜</h3>
<p>Android çš„å¹³å°æ¶æ„ç”±å¤šä¸ªå±‚çº§ç»„æˆï¼ŒåŒ…æ‹¬ Linux å†…æ ¸ã€Android è¿è¡Œæ—¶ï¼ˆARTï¼‰ä»¥åŠç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰ã€‚ä½ èƒ½è§£é‡Šä¸€ä¸‹è¿™äº›ç»„ä»¶æ˜¯å¦‚ä½•ååŒå·¥ä½œï¼Œä»¥ç¡®ä¿åº”ç”¨é¡ºåˆ©è¿è¡Œå¹¶ä¸ç¡¬ä»¶äº¤äº’çš„å—ï¼Ÿ</p>
<h3 data-id="heading-2">å…³é”®ç‰¹æ€§</h3>
<ol>
<li><strong>å¼€æºä¸”é«˜åº¦å¯å®šåˆ¶</strong>ï¼šAndroid æ˜¯å¼€æºçš„ï¼ˆå³ Android å¼€æºé¡¹ç›®ï¼ŒAOSPï¼‰ï¼Œå¼€å‘è€…å’Œå‚å•†å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚è‡ªç”±ä¿®æ”¹å’Œå®šåˆ¶ç³»ç»Ÿã€‚è¿™ç§çµæ´»æ€§æ¨åŠ¨äº†å®ƒåœ¨å„ç±»è®¾å¤‡ä¸Šçš„å¹¿æ³›åº”ç”¨ä¸åˆ›æ–°ï¼ŒåŒ…æ‹¬æ™ºèƒ½ç©¿æˆ´è®¾å¤‡ã€ç”µè§†ä¹ƒè‡³ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡ã€‚</li>
<li><strong>åŸºäº SDK çš„åº”ç”¨å¼€å‘</strong>ï¼šAndroid åº”ç”¨ä¸»è¦ä½¿ç”¨ Java æˆ– Kotlin ç¼–å†™ï¼Œå¹¶é…åˆ Android è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼‰ã€‚å¼€å‘è€…å¯é€šè¿‡ Android Studio ç­‰å·¥å…·ï¼Œåœ¨å¹³å°ä¸Šå®Œæˆåº”ç”¨çš„è®¾è®¡ã€å¼€å‘ä¸è°ƒè¯•ã€‚</li>
<li><strong>ä¸°å¯Œçš„åº”ç”¨ç”Ÿæ€</strong>ï¼šGoogle Play å•†åº—æ˜¯ Android å®˜æ–¹çš„åº”ç”¨åˆ†å‘å¹³å°ï¼Œæä¾›æ•°ç™¾ä¸‡æ¬¾æ¶µç›–æ¸¸æˆã€ç”Ÿäº§åŠ›å·¥å…·ç­‰å„ç±»åˆ«çš„åº”ç”¨ã€‚å¼€å‘è€…ä¹Ÿå¯é€šè¿‡ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—æˆ–ç›´æ¥æä¾› APK æ–‡ä»¶è¿›è¡Œç‹¬ç«‹åˆ†å‘ã€‚</li>
<li><strong>å¤šä»»åŠ¡å¤„ç†ä¸èµ„æºç®¡ç†</strong>ï¼šAndroid æ”¯æŒå¤šä»»åŠ¡è¿è¡Œï¼Œç”¨æˆ·å¯åŒæ—¶å¼€å¯å¤šä¸ªåº”ç”¨ã€‚ç³»ç»Ÿé‡‡ç”¨æ‰˜ç®¡å¼å†…å­˜ç®¡ç†å’Œé«˜æ•ˆçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨ä¸åŒè®¾å¤‡ä¸Šä¼˜åŒ–æ€§èƒ½è¡¨ç°ã€‚</li>
<li><strong>å¹¿æ³›çš„ç¡¬ä»¶å…¼å®¹æ€§</strong>ï¼šAndroid è¦†ç›–ä»å…¥é—¨çº§åˆ°é«˜ç«¯æ——èˆ°çš„å„ç±»è®¾å¤‡ï¼Œå¯¹ä¸åŒå±å¹•å°ºå¯¸ã€åˆ†è¾¨ç‡åŠç¡¬ä»¶é…ç½®å‡æœ‰å‡ºè‰²çš„é€‚é…èƒ½åŠ›ã€‚</li>
</ol>
<h3 data-id="heading-3">Android ç³»ç»Ÿæ¶æ„</h3>
<p>Android å¹³å°æ¶æ„é‡‡ç”¨æ¨¡å—åŒ–åˆ†å±‚è®¾è®¡ï¼Œç”±å¤šä¸ªç»„ä»¶æ„æˆï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77bf71e1d4f24022addc10a585af913d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=IK1ZnQQYUNNibu7DnpapyYv2r1Q%3D" alt="1.png" loading="lazy"/></p>
<p><em>ç›¸ä¿¡ Android å¼€å‘å†ç†Ÿæ‚‰ä¸è¿‡è¿™å¼ å›¾äº†ï¼</em></p>
<p>é‚£æˆ‘ä»¬ä»ä¸‹å¾€ä¸Šä¾æ¬¡è¯´æ˜è¿™äº›å±‚ï¼š</p>
<ul>
<li><strong>ç”µæºç®¡ç†</strong>ï¼šLinux å†…æ ¸ä¸­çš„ç”µæºå­ç³»ç»Ÿï¼Œè´Ÿè´£ç›´æ¥æ§åˆ¶ CPUã€è®¾å¤‡å’Œæ•´æœºçš„ä¼‘çœ ã€å”¤é†’ä¸åŠŸè€—çŠ¶æ€ï¼Œä¸ºä¸Šå±‚çœç”µæœºåˆ¶æä¾›ç¡¬ä»¶çº§æ”¯æŒã€‚</li>
<li><strong>Linux å†…æ ¸</strong>ï¼šLinux å†…æ ¸æ„æˆäº† Android æ“ä½œç³»ç»Ÿçš„åŸºç¡€ï¼Œè´Ÿè´£ç¡¬ä»¶æŠ½è±¡ï¼Œç¡®ä¿è½¯ä»¶ä¸ç¡¬ä»¶ä¹‹é—´çš„æ— ç¼äº¤äº’ã€‚å…¶æ ¸å¿ƒèŒè´£åŒ…æ‹¬å†…å­˜ä¸è¿›ç¨‹ç®¡ç†ã€å®‰å…¨ç­–ç•¥æ‰§è¡Œï¼Œä»¥åŠç®¡ç† Wi-Fiã€è“ç‰™ã€æ˜¾ç¤ºç­‰ç¡¬ä»¶ç»„ä»¶çš„é©±åŠ¨ç¨‹åºã€‚</li>
<li><strong>ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰</strong> ï¼šç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰æä¾›äº†ä¸€ç»„æ ‡å‡†æ¥å£ï¼Œå°† Android çš„ Java API æ¡†æ¶ä¸è®¾å¤‡ç¡¬ä»¶è¿æ¥èµ·æ¥ã€‚å®ƒç”±å¤šä¸ªåº“æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—é’ˆå¯¹ç‰¹å®šç¡¬ä»¶ï¼ˆå¦‚æ‘„åƒå¤´æˆ–è“ç‰™ï¼‰è¿›è¡Œå®šåˆ¶ã€‚å½“æ¡†æ¶ API è¯·æ±‚è®¿é—®ç¡¬ä»¶æ—¶ï¼ŒAndroid ç³»ç»Ÿä¼šåŠ¨æ€åŠ è½½å¯¹åº”çš„ HAL æ¨¡å—æ¥å®Œæˆè¯·æ±‚ã€‚</li>
<li><strong>Android è¿è¡Œæ—¶ï¼ˆARTï¼‰ä¸æ ¸å¿ƒåº“</strong>ï¼šAndroid è¿è¡Œæ—¶ï¼ˆARTï¼‰è´Ÿè´£æ‰§è¡Œç”± Kotlin æˆ– Java ç¼–è¯‘è€Œæ¥çš„å­—èŠ‚ç ã€‚ART æ”¯æŒâ€œæå‰ç¼–è¯‘â€ï¼ˆAOTï¼‰å’Œâ€œå³æ—¶ç¼–è¯‘â€ï¼ˆJITï¼‰ï¼Œä»¥ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚æ ¸å¿ƒåº“åˆ™æä¾›äº†æ•°æ®ç»“æ„ã€æ–‡ä»¶æ“ä½œã€å¤šçº¿ç¨‹ç­‰å…³é”®åŠŸèƒ½çš„ APIï¼Œä¸ºåº”ç”¨å¼€å‘æ„å»ºäº†å®Œæ•´çš„è¿è¡Œç¯å¢ƒã€‚</li>
<li><strong>åŸç”Ÿ C/C++ åº“</strong>ï¼šAndroid åŒ…å«ä¸€ç³»åˆ—ç”¨ C å’Œ C++ ç¼–å†™çš„åŸç”Ÿåº“ï¼Œç”¨äºæ”¯æ’‘å…³é”®åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ<strong>OpenGL</strong> è´Ÿè´£å›¾å½¢æ¸²æŸ“ï¼Œ<strong>SQLite</strong> æä¾›æ•°æ®åº“æ“ä½œèƒ½åŠ›ï¼Œ<strong>WebKit</strong> ç”¨äºç½‘é¡µå†…å®¹å±•ç¤ºã€‚è¿™äº›åº“æ—¢è¢« Android æ¡†æ¶å†…éƒ¨ä½¿ç”¨ï¼Œä¹Ÿå¯è¢«åº”ç”¨ç›´æ¥è°ƒç”¨ï¼Œä»¥å¤„ç†å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„ä»»åŠ¡ã€‚</li>
<li><strong>Android æ¡†æ¶ï¼ˆAPIï¼‰</strong> ï¼šåº”ç”¨æ¡†æ¶å±‚æä¾›äº†é¢å‘å¼€å‘è€…çš„é«˜å±‚æœåŠ¡å’Œ APIï¼ŒåŒ…æ‹¬ <code>ActivityManager</code>ã€<code>NotificationManager</code>ã€<code>ContentProvider</code> ç­‰ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆæ„å»º Android åº”ç”¨ï¼Œå¹¶å……åˆ†åˆ©ç”¨ç³»ç»Ÿèƒ½åŠ›ã€‚</li>
<li><strong>åº”ç”¨ç¨‹åº</strong>ï¼šæœ€ä¸Šå±‚æ˜¯æ‰€æœ‰é¢å‘ç”¨æˆ·çš„åº”ç”¨ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè‡ªå¸¦åº”ç”¨ï¼ˆå¦‚é€šè®¯å½•ã€è®¾ç½®ï¼‰å’ŒåŸºäº Android SDK å¼€å‘çš„ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚è¿™äº›åº”ç”¨ä¾èµ–åº•å±‚å„æ¨¡å—ï¼Œå°†åŠŸèƒ½é¡ºç•…åœ°äº¤ä»˜ç»™ç”¨æˆ·ã€‚</li>
</ul>
<h3 data-id="heading-4">æ€»ç»“</h3>
<p>Android æ˜¯å…¨çƒä½¿ç”¨æœ€å¹¿æ³›çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå æ®ç€ç»å¯¹çš„å¸‚åœºä»½é¢ã€‚å®ƒä¸ä»…æ¨åŠ¨åˆ›æ–°ï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†è§¦è¾¾æ•°åäº¿ç”¨æˆ·çš„æœºä¼šã€‚å‡­å€Ÿå…¶é«˜åº¦çš„é€‚åº”æ€§å’Œå¼€æºç‰¹æ€§ï¼ŒAndroid å¾—ä»¥åœ¨å„ç§å¸‚åœºä¸­è“¬å‹ƒå‘å±•ï¼Œå¹¶æˆä¸ºä¼—å¤šéæ‰‹æœºè®¾å¤‡çš„åŸºçŸ³ã€‚</p>
<h2 data-id="heading-5">Intent æ˜¯ä»€ä¹ˆ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d8e2a3f1da643dc996b2fc8e511c80d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=mqWc5yvW6q8iO8OSPPzGn25uWtw%3D" alt="2.png" loading="lazy"/></p>
<p><code>Intent</code> æ˜¯å¯¹å³å°†æ‰§è¡Œæ“ä½œçš„ä¸€ç§æŠ½è±¡æè¿°ã€‚å®ƒä½œä¸ºä¸€ç§æ¶ˆæ¯å¯¹è±¡ï¼Œè®© <code>Activity</code>ã€<code>Service</code> å’Œ <code>BroadcastReceiver</code> èƒ½å¤Ÿå½¼æ­¤é€šä¿¡ã€‚<code>Intent</code> é€šå¸¸ç”¨äºå¯åŠ¨ä¸€ä¸ª <code>Activity</code>ã€å‘é€å¹¿æ’­æˆ–å¯åŠ¨ä¸€ä¸ª <code>Service</code>ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œæ˜¯ Android åŸºäºç»„ä»¶æ¶æ„çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚</p>
<p>Android ä¸­ä¸»è¦æœ‰ä¸¤ç§ <code>Intent</code>ï¼šæ˜¾å¼ <code>Intent</code> å’Œéšå¼ <code>Intent</code>ã€‚</p>
<h3 data-id="heading-6">é¢è¯•é—®é¢˜</h3>
<p>æ˜¾å¼ <code>Intent</code> å’Œéšå¼ <code>Intent</code> çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå„è‡ªé€‚ç”¨äºå“ªäº›åœºæ™¯ï¼Ÿ</p>
<p>Android ç³»ç»Ÿå¦‚ä½•å†³å®šç”±å“ªä¸ªåº”ç”¨æ¥å¤„ç†ä¸€ä¸ªéšå¼ <code>Intent</code>ï¼Ÿå¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„åº”ç”¨ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<h3 data-id="heading-7">æ˜¾å¼ Intent</h3>
<p><strong>å®šä¹‰</strong>ï¼šæ˜¾å¼ <code>Intent</code> é€šè¿‡ç›´æ¥æŒ‡å®šç»„ä»¶åç§°ï¼Œæ˜ç¡®æŒ‡å‡ºè¦å¯åŠ¨çš„å…·ä½“ç»„ä»¶ï¼ˆ<code>Activity</code> æˆ– <code>Service</code>ï¼‰ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ æ˜ç¡®çŸ¥é“ç›®æ ‡ç»„ä»¶æ—¶ä½¿ç”¨æ˜¾å¼ <code>Intent</code>ï¼Œä¾‹å¦‚å¯åŠ¨è‡ªå·±åº”ç”¨å†…çš„æŸä¸ªç‰¹å®š <code>Activity</code>ã€‚</p>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼šå¦‚æœä½ åœ¨åŒä¸€ä¸ªåº”ç”¨å†…ä»ä¸€ä¸ª <code>Activity</code> è·³è½¬åˆ°å¦ä¸€ä¸ª <code>Activity</code>ï¼Œå°±åº”è¯¥ä½¿ç”¨æ˜¾å¼ <code>Intent</code>ã€‚</p>
<p>ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨æ˜¾å¼ <code>Intent</code>ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, TargetActivity::<span class="hljs-keyword">class</span>.java)
startActivity(intent)
</code></pre>
<h3 data-id="heading-8">éšå¼ Intent</h3>
<p><strong>å®šä¹‰</strong>ï¼šéšå¼ <code>Intent</code> ä¸æŒ‡å®šå…·ä½“ç»„ä»¶ï¼Œè€Œæ˜¯å£°æ˜ä¸€ä¸ªé€šç”¨çš„æ“ä½œæ„å›¾ã€‚ç³»ç»Ÿä¼šæ ¹æ®è¯¥ <code>Intent</code> ä¸­çš„åŠ¨ä½œï¼ˆ<code>action</code>ï¼‰ã€ç±»åˆ«ï¼ˆ<code>category</code>ï¼‰å’Œæ•°æ®ï¼ˆ<code>data</code>ï¼‰ï¼Œè‡ªåŠ¨åŒ¹é…èƒ½å¤Ÿå¤„ç†å®ƒçš„ç»„ä»¶ã€‚</p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªå¯ç”±å…¶ä»–åº”ç”¨æˆ–ç³»ç»Ÿç»„ä»¶å¤„ç†çš„æ“ä½œæ—¶ï¼Œéšå¼ <code>Intent</code> éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æ‰“å¼€ä¸€ä¸ªç½‘é¡µé“¾æ¥æˆ–åˆ†äº«å†…å®¹ã€‚</p>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼šå¦‚æœä½ è¦é€šè¿‡æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œæˆ–è€…æŠŠå†…å®¹åˆ†äº«ç»™å…¶ä»–åº”ç”¨ï¼Œå°±åº”è¯¥ä½¿ç”¨éšå¼ <code>Intent</code>ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿä¼šå†³å®šç”±å“ªä¸ªåº”ç”¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p>
<p>ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨éšå¼ <code>Intent</code>ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_VIEW)
intent.<span class="hljs-keyword">data</span> = Uri.parse(<span class="hljs-string">"https://www.example.com"</span>)
startActivity(intent)
</code></pre>
<p>å¦‚æœä½¿ç”¨éšå¼ <code>Intent</code> å¯åŠ¨ Activityï¼Œä½†ç³»ç»Ÿä¸­æ²¡æœ‰åº”ç”¨èƒ½å¤„ç†è¯¥ <code>Intent</code>ï¼Œä¼šæŠ›å‡ºÂ <code>ActivityNotFoundException</code>ã€‚</p>
<p>æ­£ç¡®åšæ³•æ˜¯ï¼Œåœ¨è°ƒç”¨ <code>startActivity()</code> ä¹‹å‰ï¼Œåº”ä½¿ç”¨ <code>PackageManager</code> æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯å¤„ç†çš„ <code>Activity</code>ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_SEND).apply {
    type = <span class="hljs-string">"text/plain"</span>
    putExtra(Intent.EXTRA_TEXT, <span class="hljs-string">"Hello"</span>)
}

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰åº”ç”¨èƒ½å¤„ç†</span>
<span class="hljs-keyword">if</span> (intent.resolveActivity(getPackageManager()) != <span class="hljs-literal">null</span>) {
    startActivity(intent)
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æç¤ºç”¨æˆ·æˆ–é™çº§å¤„ç†</span>
    Toast.makeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"æ²¡æœ‰åº”ç”¨å¯ä»¥å¤„ç†æ­¤æ“ä½œ"</span>, Toast.LENGTH_SHORT).show()
}
</code></pre>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>æ˜¾å¼ <code>Intent</code> ç”¨äºåº”ç”¨å†…éƒ¨å¯¼èˆªï¼Œç›®æ ‡ç»„ä»¶æ˜¯æ˜ç¡®å·²çŸ¥çš„ã€‚<br/>
è€Œéšå¼ <code>Intent</code> åˆ™ç”¨äºé‚£äº›å¯èƒ½ç”±å¤–éƒ¨åº”ç”¨æˆ–å…¶ä»–ç»„ä»¶å¤„ç†çš„æ“ä½œï¼Œæ— éœ€ç›´æ¥æŒ‡å®šç›®æ ‡ã€‚å®ƒæ›´åƒä¸€ç§å‘ç³»ç»Ÿæéœ€æ±‚çš„å·¥ä½œæ–¹å¼ï¼Œè¿™è®© Android ç”Ÿæ€æ›´å…·çµæ´»æ€§ï¼Œä¹Ÿè®©åº”ç”¨ä¹‹é—´èƒ½æ— ç¼åä½œã€‚</p>
<h3 data-id="heading-10">è¿›é˜¶ï¼šä»€ä¹ˆæ˜¯ IntentFilter</h3>
<p>Android ä¸­çš„ <code>IntentFilter</code> ç”¨äºå®šä¹‰åº”ç”¨ç»„ä»¶å¦‚ä½•å“åº”ç‰¹å®šçš„ <code>Intent</code>ï¼Œæ¯”å¦‚æ‰“å¼€ä¸€ä¸ªé“¾æ¥æˆ–å¤„ç†ä¸€æ¡å¹¿æ’­ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¿‡æ»¤å™¨ï¼Œç”¨æ¥å£°æ˜æŸä¸ª <code>Activity</code>ã€<code>Service</code> æˆ– <code>BroadcastReceiver</code> èƒ½å¤Ÿå¤„ç†å“ªäº›ç±»å‹çš„ <code>Intent</code>ï¼Œè¿™äº›å£°æ˜å†™åœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­ã€‚</p>
<p>æ¯ä¸ª <code>IntentFilter</code> å¯ä»¥åŒ…å« <code>Action</code>ã€<code>Category</code> å’Œæ•°æ®ç±»å‹ï¼Œä»¥ä¾¿ç²¾å‡†åŒ¹é…ä¼ å…¥çš„ <code>Intent</code>ã€‚åˆç†åœ°å®šä¹‰ <code>IntentFilter</code>ï¼Œèƒ½è®©ä½ çš„åº”ç”¨ä¸å…¶ä»–åº”ç”¨åŠç³»ç»Ÿç»„ä»¶æ— ç¼åä½œï¼Œä»è€Œæå‡æ•´ä½“åŠŸèƒ½ä½“éªŒã€‚</p>
<p>å½“å‘é€ä¸€ä¸ªéšå¼ <code>Intent</code> æ—¶ï¼ŒAndroid ç³»ç»Ÿä¼šæ ¹æ®è¯¥ <code>Intent</code> çš„å±æ€§ï¼Œä¸å·²å®‰è£…åº”ç”¨çš„æ¸…å•æ–‡ä»¶ä¸­å£°æ˜çš„ <code>IntentFilter</code> è¿›è¡ŒåŒ¹é…ï¼Œä»è€Œç¡®å®šåº”å¯åŠ¨å“ªä¸ªç»„ä»¶ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œç³»ç»Ÿå°±ä¼šå¯åŠ¨å¯¹åº”çš„ç»„ä»¶ï¼Œå¹¶å°† <code>Intent</code> å¯¹è±¡ä¼ é€’ç»™å®ƒã€‚å¦‚æœå¤šä¸ªç»„ä»¶éƒ½èƒ½åŒ¹é…è¯¥ <code>Intent</code>ï¼Œç³»ç»Ÿä¼šå¼¹å‡ºä¸€ä¸ªé€‰æ‹©å™¨å¯¹è¯æ¡†ï¼Œè®©ç”¨æˆ·è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸ªåº”ç”¨æ¥å¤„ç†è¯¥æ“ä½œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d3e8b04c9a043f6829ce5499d58d87f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=xyGkdG8lxGuLQbR5GCAC751IWI0%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-11">PendingIntent åˆæ˜¯ä»€ä¹ˆ</h2>
<p><code>PendingIntent</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ <code>Intent</code>ï¼Œå®ƒæˆæƒå…¶ä»–åº”ç”¨æˆ–ç³»ç»Ÿç»„ä»¶åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»ï¼Œä»¥ä½ åº”ç”¨çš„åä¹‰æ‰§è¡Œä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„ <code>Intent</code>ã€‚è¿™ç§æœºåˆ¶ç‰¹åˆ«é€‚ç”¨äºé‚£äº›éœ€è¦åœ¨ä½ çš„åº”ç”¨ç”Ÿå‘½å‘¨æœŸä¹‹å¤–è§¦å‘çš„æ“ä½œï¼Œæ¯”å¦‚å‘é€é€šçŸ¥æˆ–ä¸åå°æœåŠ¡äº¤äº’ã€‚</p>
<h3 data-id="heading-12">é¢è¯•é—®é¢˜</h3>
<p>ä»€ä¹ˆæ˜¯ <code>PendingIntent</code>ï¼Ÿå®ƒå’Œæ™®é€š <code>Intent</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>èƒ½å¦ä¸¾ä¸€ä¸ªå¿…é¡»ä½¿ç”¨ <code>PendingIntent</code> çš„åœºæ™¯ï¼Ÿ</p>
<h3 data-id="heading-13">æ ¸å¿ƒç‰¹æ€§</h3>
<p><code>PendingIntent</code> æœ¬è´¨ä¸Šæ˜¯å¯¹æ™®é€š <code>Intent</code> çš„ä¸€å±‚å°è£…ï¼Œèƒ½è®©è¿™ä¸ª <code>Intent</code> åœ¨ä½ çš„åº”ç”¨ç”Ÿå‘½å‘¨æœŸç»“æŸåä¾ç„¶æœ‰æ•ˆã€‚å®ƒæŠŠæ‰§è¡Œ <code>Intent</code> çš„æƒé™å§”æ‰˜ç»™å…¶ä»–åº”ç”¨æˆ–ç³»ç»ŸæœåŠ¡ï¼Œå¹¶ä¸”è¿™äº›ç»„ä»¶ä¼šä»¥ä½ åº”ç”¨çš„èº«ä»½å’Œæƒé™æ¥æ‰§è¡Œæ“ä½œã€‚<code>PendingIntent</code> å¯ç”¨äº <code>Activity</code>ã€<code>Service</code> æˆ– <code>BroadcastReceiver</code>ã€‚</p>
<p>å®ƒä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li><strong>Activity</strong>ï¼šå¯åŠ¨ä¸€ä¸ª Activityã€‚</li>
<li><strong>Service</strong>ï¼šå¯åŠ¨ä¸€ä¸ª Serviceã€‚</li>
<li><strong>Broadcast</strong>ï¼šå‘é€ä¸€æ¡å¹¿æ’­ã€‚</li>
</ul>
<p>ä½ å¯ä»¥é€šè¿‡ <code>PendingIntent.getActivity()</code>ã€<code>PendingIntent.getService()</code> æˆ– <code>PendingIntent.getBroadcast()</code> ç­‰å·¥å‚æ–¹æ³•æ¥åˆ›å»ºå¯¹åº”çš„ <code>PendingIntent</code>ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 1. åˆ›å»º Intent è·³è½¬åˆ°ç›®æ ‡ Activity</span>
<span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MyActivity::<span class="hljs-keyword">class</span>.java)

<span class="hljs-comment">// 2. åˆ›å»º PendingIntentï¼Œç”¨äºé€šçŸ¥ç‚¹å‡»åå¯åŠ¨ Activity</span>
<span class="hljs-keyword">val</span> pendingIntent = PendingIntent.getActivity(
    <span class="hljs-keyword">this</span>,
    <span class="hljs-number">0</span>,
    intent,
    PendingIntent.FLAG_UPDATE_CURRENT <span class="hljs-comment">// æ›´æ–°ç°æœ‰ PendingIntent</span>
)

<span class="hljs-comment">// 3. æ„å»ºé€šçŸ¥</span>
<span class="hljs-keyword">val</span> notification = NotificationCompat.Builder(<span class="hljs-keyword">this</span>, CHANNEL_ID)
    .setContentTitle(<span class="hljs-string">"Title"</span>)
    .setContentText(<span class="hljs-string">"Content"</span>)
    .setSmallIcon(R.drawable.ic_notification)
    .setContentIntent(pendingIntent) <span class="hljs-comment">// ç‚¹å‡»é€šçŸ¥æ—¶è§¦å‘</span>
    .build()

<span class="hljs-comment">// 4. å‘é€é€šçŸ¥</span>
NotificationManagerCompat.from(<span class="hljs-keyword">this</span>).notify(NOTIFICATION_ID, notification)
</code></pre>
<p><code>PendingIntent</code> æ”¯æŒå¤šç§æ ‡å¿—ï¼ˆflagï¼‰ï¼Œç”¨äºæ§åˆ¶å…¶è¡Œä¸ºä»¥åŠä¸ç³»ç»Ÿæˆ–å…¶ä»–ç»„ä»¶çš„äº¤äº’æ–¹å¼ï¼š</p>
<ul>
<li><code>FLAG_UPDATE_CURRENT</code>ï¼šç”¨æ–°æ•°æ®æ›´æ–°å·²å­˜åœ¨çš„ <code>PendingIntent</code>ã€‚</li>
<li><code>FLAG_CANCEL_CURRENT</code>ï¼šåœ¨åˆ›å»ºæ–°çš„ <code>PendingIntent</code> å‰ï¼Œå…ˆå–æ¶ˆå·²å­˜åœ¨çš„å®ä¾‹ã€‚</li>
<li><code>FLAG_IMMUTABLE</code>ï¼šå°† <code>PendingIntent</code> è®¾ä¸ºä¸å¯å˜ï¼Œé˜²æ­¢æ¥æ”¶æ–¹ä¿®æ”¹å…¶å†…å®¹ã€‚</li>
<li><code>FLAG_ONE_SHOT</code>ï¼šç¡®ä¿è¯¥ <code>PendingIntent</code> åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</li>
</ul>
<h3 data-id="heading-14">ä½¿ç”¨åœºæ™¯</h3>
<ol>
<li><strong>é€šçŸ¥ï¼ˆNotificationsï¼‰</strong> ï¼šç”¨æˆ·ç‚¹å‡»é€šçŸ¥æ—¶ï¼Œå¯è§¦å‘æ‰“å¼€æŸä¸ª <code>Activity</code> ç­‰æ“ä½œã€‚</li>
<li><strong>é—¹é’Ÿï¼ˆAlarmsï¼‰</strong> ï¼šé…åˆ <code>AlarmManager</code> è°ƒåº¦å®šæ—¶ä»»åŠ¡ã€‚</li>
<li><strong>æœåŠ¡ï¼ˆServicesï¼‰</strong> ï¼šå°†ä»»åŠ¡å§”æ‰˜ç»™ <code>ForegroundService</code> æˆ– <code>BroadcastReceiver</code>ï¼Œç”¨äºæ‰§è¡Œåå°æ“ä½œã€‚</li>
</ol>
<h3 data-id="heading-15">å®‰å…¨äº‹é¡¹</h3>
<p>å§‹ç»ˆä¸º <code>PendingIntent</code> è®¾ç½® <code>FLAG_IMMUTABLE</code>ï¼Œä»¥é˜²æ­¢æ¶æ„åº”ç”¨ç¯¡æ”¹å…¶å†…éƒ¨çš„ <code>Intent</code>ã€‚è¿™ä¸€ç‚¹ä» Android 12ï¼ˆAPI çº§åˆ« 31ï¼‰å¼€å§‹å°¤ä¸ºé‡è¦â€”â€”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œç³»ç»Ÿå·²å¼ºåˆ¶è¦æ±‚å¿…é¡»ä½¿ç”¨è¯¥æ ‡å¿—ã€‚</p>
<h3 data-id="heading-16">æ€»ç»“</h3>
<p><code>PendingIntent</code> æ˜¯ Android ä¸­çš„ä¸€é¡¹æ ¸å¿ƒæœºåˆ¶ï¼Œå³ä½¿ä½ çš„åº”ç”¨æœªåœ¨å‰å°è¿è¡Œï¼Œä¹Ÿèƒ½å®ç°ä¸ç³»ç»Ÿç»„ä»¶æˆ–å…¶ä»–åº”ç”¨ä¹‹é—´çš„æ— ç¼é€šä¿¡ã€‚é€šè¿‡åˆç†ç®¡ç†æ ‡å¿—ï¼ˆflagsï¼‰å’Œæƒé™ï¼Œä½ å¯ä»¥ç¡®ä¿å»¶è¿Ÿä»»åŠ¡çš„å®‰å…¨ã€é«˜æ•ˆæ‰§è¡Œã€‚</p>
<h2 data-id="heading-17">Serializable å’Œ Parcelable æœ‰ä»€ä¹ˆåŒºåˆ«</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/782efb9f5bfa49f2b0a669e76978a391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=X%2BdPTochwcnWAdGmPdg8hxxrMF4%3D" alt="3.png" loading="lazy"/></p>
<p>åœ¨ Android ä¸­ï¼Œ<code>Serializable</code> å’Œ <code>Parcelable</code> éƒ½æ˜¯ç”¨æ¥åœ¨ä¸åŒç»„ä»¶ï¼ˆå¦‚ <code>Activity</code> æˆ– <code>Fragment</code>ï¼‰ä¹‹é—´ä¼ é€’æ•°æ®çš„æœºåˆ¶ï¼Œä½†å®ƒä»¬åœ¨æ€§èƒ½å’Œå®ç°æ–¹å¼ä¸Šæœ‰æ˜æ˜¾åŒºåˆ«ã€‚</p>
<h3 data-id="heading-18">é¢è¯•é—®é¢˜</h3>
<p>åœ¨ Android ä¸­ï¼Œ<code>Serializable</code> å’Œ <code>Parcelable</code> æœ‰å“ªäº›å…³é”®åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆåœ¨ç»„ä»¶é—´ä¼ é€’æ•°æ®æ—¶é€šå¸¸æ›´æ¨èä½¿ç”¨ <code>Parcelable</code>ï¼Ÿ</p>
<h3 data-id="heading-19">Serializable</h3>
<p><strong>Java æ ‡å‡†æ¥å£</strong>ï¼š<code>Serializable</code> æ˜¯ Java æä¾›çš„æ ‡å‡†æ¥å£ï¼Œç”¨äºå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œä»¥ä¾¿åœ¨ <code>Activity</code> ä¹‹é—´ä¼ é€’æˆ–å†™å…¥ç£ç›˜ã€‚</p>
<p><strong>åŸºäºåå°„</strong>ï¼šå®ƒä¾èµ– Java åå°„æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€æ£€æŸ¥ç±»åŠå…¶å­—æ®µæ¥å®Œæˆåºåˆ—åŒ–ã€‚</p>
<p><strong>æ€§èƒ½</strong>ï¼šç›¸æ¯” <code>Parcelable</code>ï¼Œ<code>Serializable</code> æ›´æ…¢ï¼Œå› ä¸ºåå°„æœ¬èº«å¼€é”€è¾ƒå¤§ã€‚æ­¤å¤–ï¼Œåºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œå¢åŠ å†…å­˜è´Ÿæ‹…ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå½“æ€§èƒ½ä¸æ˜¯å…³é”®å› ç´ ï¼Œæˆ–åœ¨é Android ç‰¹æœ‰çš„ä»£ç åº“ä¸­ä½¿ç”¨æ—¶ï¼Œ<code>Serializable</code> æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©ã€‚</p>
<h3 data-id="heading-20">Parcelable</h3>
<p><strong>Android ä¸“å±æ¥å£</strong>ï¼š<code>Parcelable</code> æ˜¯ Android ç‰¹æœ‰çš„æ¥å£ï¼Œä¸“ä¸ºåœ¨ Android ç»„ä»¶é—´å®ç°é«˜æ€§èƒ½çš„è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰è€Œè®¾è®¡ã€‚</p>
<p><strong>æ€§èƒ½</strong>ï¼š<code>Parcelable</code> æ¯” <code>Serializable</code> æ›´å¿«ï¼Œå› ä¸ºå®ƒé’ˆå¯¹ Android åšäº†ä¼˜åŒ–ï¼Œä¸ä¾èµ–åå°„æœºåˆ¶ï¼Œå¹¶ä¸”é€šè¿‡é¿å…åˆ›å»ºå¤§é‡ä¸´æ—¶å¯¹è±¡æ¥å‡å°‘åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ¨ Android ä¸­ä¼ é€’æ•°æ®æ—¶ï¼Œå°¤å…¶æ˜¯æ¶‰åŠ IPC æˆ–åœ¨ Activityã€Service ä¹‹é—´ä¼ è¾“æ•°æ®ä¸”å¯¹æ€§èƒ½æœ‰è¦æ±‚çš„åœºæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨ <code>Parcelable</code>ã€‚</p>
<p>åœ¨ç°ä»£ Android å¼€å‘ä¸­ï¼Œ<code>kotlin-parcelize</code> æ’ä»¶é€šè¿‡è‡ªåŠ¨ç”Ÿæˆå®ç°ä»£ç ï¼Œå¤§å¹…ç®€åŒ–äº†åˆ›å»º <code>Parcelable</code> å¯¹è±¡çš„è¿‡ç¨‹ã€‚ç›¸æ¯”æ—©æœŸéœ€è¦æ‰‹åŠ¨ç¼–å†™çš„æ–¹å¼ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ é«˜æ•ˆã€‚åªéœ€åœ¨ç±»ä¸Šæ·»åŠ  <code>@Parcelize</code> æ³¨è§£ï¼Œæ’ä»¶ä¾¿ä¼šè‡ªåŠ¨ç”Ÿæˆæ‰€éœ€çš„ <code>Parcelable</code> å®ç°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå…¶å·¥ä½œæ–¹å¼ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">import</span> kotlinx.parcelize.Parcelize
<span class="hljs-keyword">import</span> android.os.Parcelable

<span class="hljs-meta">@Parcelize</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> firstName: String, <span class="hljs-keyword">val</span> lastName: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>) : Parcelable
</code></pre>
<p>é€šè¿‡è¿™æ ·çš„è®¾ç½®ï¼Œä½ ä¸å†éœ€è¦æ‰‹åŠ¨é‡å†™ <code>writeToParcel</code> æ–¹æ³•æˆ–å®ç° <code>CREATOR</code>ï¼Œå¤§å¹…å‡å°‘äº†æ ·æ¿ä»£ç ï¼Œæå‡äº†å¯è¯»æ€§ã€‚</p>
<blockquote>
<p>å¦‚æœä½ çš„ç±»ä½¿ç”¨äº† <code>@Parcelize</code> æ³¨è§£ï¼Œä½†å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªæ—¢ä¸æ˜¯åŸºæœ¬ç±»å‹ã€åˆæœªè¢« <code>@Parcelize</code> æ ‡è®°çš„å±æ€§ï¼Œå°±ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š<br/>
<em>Type is not directly supported by â€˜Parcelizeâ€™. Annotate the parameter type with â€˜@RawValueâ€™ if you want it to be serialized using â€˜writeValue()â€™.</em><br/>
è¿™æ˜¯å› ä¸º <code>Parcelize</code> ç¼–è¯‘å™¨æ’ä»¶åœ¨åºåˆ—åŒ–æ—¶ä¼šå°è¯•â€œå±•å¼€â€æ‰€æœ‰å±æ€§ï¼Œè€Œä»»ä½•ä¸æ”¯æŒæˆ–æ— æ³•è¯†åˆ«çš„ç±»å‹éƒ½å¿…é¡»æ˜¾å¼æ ‡è®°ã€‚<br/>
ä¸ºé¿å…è¿™ä¸ªé—®é¢˜ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å¤æ‚ç±»å‹æˆ–è‡ªå®šä¹‰ç±»å‹è¦ä¹ˆè‡ªèº«å·²æ­£ç¡®å®ç° <code>Parcelable</code>ï¼Œè¦ä¹ˆç”¨ <code>@RawValue</code> æ³¨è§£æ ‡æ³¨ï¼Œä»¥è¡¨æ˜ä½ å¸Œæœ›å®ƒä»¬é€šè¿‡ <code>writeValue()</code> è¿›è¡Œæ‰‹åŠ¨åºåˆ—åŒ–ã€‚</p>
</blockquote>
<h3 data-id="heading-21">å…³é”®åŒºåˆ«</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>Serializable</th><th>Parcelable</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ ‡å‡†Javaæ¥å£</td><td>Androidä¸“ç”¨æ¥å£</td></tr><tr><td>æ€§èƒ½</td><td>è¾ƒæ…¢ï¼Œä½¿ç”¨åå°„</td><td>æ›´å¿«ï¼Œé’ˆå¯¹Androidä¼˜åŒ–</td></tr><tr><td>åƒåœ¾åˆ›å»º</td><td>äº§ç”Ÿæ›´å¤šåƒåœ¾ï¼ˆæ›´å¤šå¯¹è±¡ï¼‰</td><td>äº§ç”Ÿè¾ƒå°‘åƒåœ¾ï¼ˆé«˜æ•ˆï¼‰</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>é€‚ç”¨äºé€šç”¨Javaä½¿ç”¨</td><td>æ¨èç”¨äºAndroidï¼Œå°¤å…¶æ˜¯IPC</td></tr></tbody></table>
<h3 data-id="heading-22">æ€»ç»“</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ Android åº”ç”¨ä¸­ï¼Œ<strong>ä¼˜å…ˆé€‰æ‹© <code>Parcelable</code></strong>ï¼Œå› ä¸ºå®ƒåœ¨å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹æ€§èƒ½æ›´ä¼˜ã€‚</p>
<ul>
<li>åœ¨ç®€å•åœºæ™¯ã€éæ€§èƒ½æ•æ„Ÿçš„æ“ä½œï¼Œæˆ–å¤„ç†ä¸ Android æ— å…³çš„é€šç”¨ Java ä»£ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>Serializable</code>ã€‚</li>
<li>è€Œåœ¨æ¶‰åŠ Android ç‰¹æœ‰ç»„ä»¶ä¸”å¯¹æ€§èƒ½æœ‰è¦æ±‚çš„åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚è¿›ç¨‹é—´é€šä¿¡ IPCï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ <code>Parcelable</code>ï¼Œå› ä¸ºå®ƒé’ˆå¯¹ Android çš„ IPC æœºåˆ¶åšäº†é«˜åº¦ä¼˜åŒ–ï¼Œæ•ˆç‡é«˜å¾—å¤šã€‚</li>
</ul>
<h3 data-id="heading-23">è¿›é˜¶ï¼šParcel ä¸ Parcelable</h3>
<p><code>Parcel</code> æ˜¯ Android ä¸­çš„ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç”¨äºåœ¨åº”ç”¨çš„ä¸åŒç»„ä»¶ï¼ˆå¦‚ <code>Activity</code>ã€<code>Service</code> æˆ– <code>BroadcastReceiver</code>ï¼‰ä¹‹é—´å®ç°é«˜æ€§èƒ½çš„è¿›ç¨‹é—´é€šä¿¡ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼ˆmarshalingï¼Œå³â€œæ‰å¹³åŒ–â€ï¼‰å’Œååºåˆ—åŒ–ï¼ˆunmarshalingï¼Œå³â€œè¿˜åŸâ€ï¼‰ï¼Œä»¥ä¾¿è·¨è¶Š Android çš„ IPC è¾¹ç•Œä¼ é€’ã€‚</p>
<p><code>Parcel</code> ä¸ä»…å¯ä»¥ä¼ è¾“æ‰å¹³åŒ–çš„æ•°æ®ï¼Œè¿˜èƒ½æºå¸¦æŒ‡å‘æ´»è·ƒ <code>IBinder</code> å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡ IPC æœºåˆ¶è¿›è¡Œä¼ é€’ã€‚å®ƒä¸“ä¸ºé«˜æ€§èƒ½ IPC ä¼ è¾“è€Œè®¾è®¡ï¼Œé…åˆ <code>Parcelable</code> æ¥å£ï¼Œèƒ½è®©å¯¹è±¡é«˜æ•ˆåœ°åºåˆ—åŒ–å¹¶åœ¨ç»„ä»¶é—´æµè½¬ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Parcel</code> å¹¶éé€šç”¨çš„åºåˆ—åŒ–å·¥å…·ï¼Œä¹Ÿä¸åº”ç”¨äºæŒä¹…åŒ–å­˜å‚¨â€”â€”å› ä¸ºå…¶åº•å±‚å®ç°å¯èƒ½éšç³»ç»Ÿç‰ˆæœ¬å˜åŒ–ï¼Œå¯¼è‡´æ—§æ•°æ®æ— æ³•è¯»å–ã€‚</p>
<p><code>Parcel</code> æä¾›äº†ä¸°å¯Œçš„ APIï¼Œæ”¯æŒè¯»å†™åŸºæœ¬æ•°æ®ç±»å‹ã€æ•°ç»„ä»¥åŠ <code>Parcelable</code> å¯¹è±¡ï¼Œä½¿å¯¹è±¡èƒ½å¤Ÿè‡ªè¡Œåºåˆ—åŒ–å¹¶åœ¨éœ€è¦æ—¶é‡å»ºã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€äº›ä¼˜åŒ–æ–¹æ³•ï¼šåœ¨å¤„ç† <code>Parcelable</code> å¯¹è±¡æ—¶ï¼Œå¯çœç•¥å†™å…¥ç±»ä¿¡æ¯ï¼Œä½†è¦æ±‚æ¥æ”¶æ–¹æå‰çŸ¥é“æ•°æ®ç±»å‹ï¼Œä»è€Œæå‡ä¼ è¾“æ•ˆç‡ã€‚</p>
<p><code>Parcelable</code> æ˜¯ Android ç‰¹æœ‰çš„æ¥å£ï¼Œç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä»¥ä¾¿é€šè¿‡ <code>Parcel</code> ä¼ é€’ã€‚å®ç°äº† <code>Parcelable</code> çš„å¯¹è±¡å¯ä»¥è¢«å†™å…¥ <code>Parcel</code>ï¼Œå¹¶ä»ä¸­æ¢å¤ï¼Œå› æ­¤éå¸¸é€‚åˆåœ¨ Android ç»„ä»¶ä¹‹é—´ä¼ é€’å¤æ‚æ•°æ®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# åˆ—è¡¨æ¨¡å¼ï¼ˆList Patternsï¼‰æ·±åº¦è§£æï¼šæ¨¡å¼åŒ¹é…å†è¿›åŒ–ï¼]]></title>    <link>https://juejin.cn/post/7579494852653170722</link>    <guid>https://juejin.cn/post/7579494852653170722</guid>    <pubDate>2025-12-03T23:19:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579494852653170722" data-draft-id="7579494852653154338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# åˆ—è¡¨æ¨¡å¼ï¼ˆList Patternsï¼‰æ·±åº¦è§£æï¼šæ¨¡å¼åŒ¹é…å†è¿›åŒ–ï¼"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-03T23:19:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”é’æ«"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# åˆ—è¡¨æ¨¡å¼ï¼ˆList Patternsï¼‰æ·±åº¦è§£æï¼šæ¨¡å¼åŒ¹é…å†è¿›åŒ–ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”é’æ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:19:24.000Z" title="Wed Dec 03 2025 23:19:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç®€ä»‹</h3>
<p>åˆ—è¡¨æ¨¡å¼æ˜¯ä¸€ç§æ¨¡å¼åŒ¹é…æœºåˆ¶ï¼Œå…è®¸æ£€æŸ¥ä¸€ä¸ªé›†åˆï¼ˆä¾‹å¦‚æ•°ç»„ã€<code>List&lt;T&gt;</code>ã€æˆ–ä»»ä½•å®ç°äº† <code>IEnumerable&lt;T&gt;</code> çš„ç±»å‹ï¼‰çš„å…ƒç´ æ•°é‡ã€é¡ºåºä»¥åŠæ¯ä¸ªå…ƒç´ çš„å†…å®¹ã€‚</p>
<p>åœ¨ <code>C# 10</code> ä¹‹å‰ï¼Œæ¨¡å¼åŒ¹é… (<code>Pattern Matching</code>) å·²æ”¯æŒ <code>switch</code> è¡¨è¾¾å¼ã€ç±»å‹æ¨¡å¼ã€å±æ€§æ¨¡å¼ç­‰ï¼Œä½†å¯¹åˆ—è¡¨æˆ–åºåˆ—çš„åŒ¹é…è¿˜ä¸å¤Ÿç›´è§‚ã€‚
<code>C# 11</code> å¼•å…¥ åˆ—è¡¨æ¨¡å¼ï¼ˆ<code>List Patterns</code>ï¼‰ï¼Œè®©å¼€å‘è€…å¯ä»¥ï¼š</p>
<ul>
<li>
<p>æŒ‰é¡ºåºåŒ¹é…æ•°ç»„ã€<code>Span&lt;T&gt;</code>ã€<code>IList&lt;T&gt;</code> ç­‰åˆ—è¡¨ã€‚</p>
</li>
<li>
<p>æ£€æŸ¥é•¿åº¦ã€ç‰¹å®šå…ƒç´ ï¼Œç”šè‡³è§£æ„å…¶ä¸­çš„å€¼ã€‚</p>
</li>
<li>
<p>ç»“åˆ <code>switchã€isã€when</code> ç­‰æ¨¡å¼åŒ¹é…å†™å‡ºç®€æ´ã€å£°æ˜å¼çš„ä»£ç ã€‚</p>
</li>
</ul>
<blockquote>
<p>âœ… åˆ—è¡¨æ¨¡å¼æ˜¯æ¨¡å¼åŒ¹é…çš„æ‰©å±•ï¼Œä¸æ˜¯æ–°çš„é›†åˆç±»å‹ã€‚</p>
</blockquote>
<h3 data-id="heading-1">è¯­æ³•</h3>
<p>åˆ—è¡¨æ¨¡å¼ä½¿ç”¨æ–¹æ‹¬å· <code>[]</code> æ¥å®šä¹‰è¦åŒ¹é…çš„æ¨¡å¼ï¼š</p>
<p>åŸºæœ¬å½¢å¼ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[ element-pattern<span class="hljs-number">-1</span>, element-pattern<span class="hljs-number">-2</span>, ... ]
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// æ£€æŸ¥åˆ—è¡¨æ˜¯å¦æ°å¥½åŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼š1, 2, 3</span>
<span class="hljs-keyword">if</span> (list <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
{
    Console.WriteLine(<span class="hljs-string">"åˆ—è¡¨åŒ…å«ç²¾ç¡®åºåˆ— 1, 2, 3"</span>);
}
</code></pre>
<p>å…ƒç´ æ¨¡å¼å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>
<p>å¸¸é‡ï¼ˆ1ã€"abc"ï¼‰</p>
</li>
<li>
<p>å˜é‡ï¼ˆvar xï¼‰</p>
</li>
<li>
<p>ç±»å‹æ¨¡å¼ï¼ˆint xï¼‰</p>
</li>
<li>
<p>é€šé…ç¬¦ï¼ˆ_ï¼‰</p>
</li>
<li>
<p>åˆ‡ç‰‡æ¨¡å¼ï¼ˆ..ï¼ŒC# 11 å¼•å…¥ï¼‰</p>
</li>
<li>
<p>åµŒå¥—æ¨¡å¼ï¼ˆ{}ã€[] ç­‰ï¼‰</p>
</li>
</ul>
<p>å¯ä»¥ç”¨äºï¼š</p>
<ul>
<li>
<p><code>is</code> è¡¨è¾¾å¼</p>
</li>
<li>
<p><code>switch</code> è¡¨è¾¾å¼æˆ–è¯­å¥</p>
</li>
<li>
<p><code>when</code> æ¡ä»¶</p>
</li>
</ul>
<h3 data-id="heading-2">åŒ¹é…è§„åˆ™</h3>
<ul>
<li>
<p>åŒ¹é…é¡ºåºä¸¥æ ¼ä¸€è‡´ã€‚</p>
</li>
<li>
<p>å…ƒç´ æ•°é‡éœ€æ»¡è¶³æ¨¡å¼è¦æ±‚ï¼ˆå¯ç”¨åˆ‡ç‰‡æ¨¡å¼æ”¾å®½ï¼‰ã€‚</p>
</li>
<li>
<p>æ”¯æŒ <code>IEnumerable</code>ã€æ•°ç»„ã€<code>Span&lt;T&gt;</code>ã€<code>IList&lt;T&gt;</code> ç­‰å®ç° <code>Length/Count</code> å±æ€§ + ç´¢å¼•å™¨ çš„ç±»å‹ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">åŸºç¡€ç¤ºä¾‹</h3>
<h4 data-id="heading-4">ç²¾ç¡®åŒ¹é…</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };

<span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Exact match!"</span>);
</code></pre>
<blockquote>
<p>åªæœ‰å½“æ•°ç»„æ˜¯ <code>{1,2,3}</code> ä¸”é•¿åº¦ä¸º 3 æ—¶æ‰åŒ¹é…ã€‚</p>
</blockquote>
<h4 data-id="heading-5">é€šé…ç¬¦ _</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, _, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Middle element can be anything"</span>);
</code></pre>
<blockquote>
<p>å¿½ç•¥ç¬¬äºŒä¸ªå…ƒç´ ï¼Œåªè¦æ±‚é¦–å°¾å›ºå®šã€‚</p>
</blockquote>
<h4 data-id="heading-6">åˆ‡ç‰‡æ¨¡å¼ ..</h4>
<ul>
<li>åŒ¹é…ä»¥ 1 å¼€å¤´çš„ä»»æ„é•¿åº¦æ•°ç»„ã€‚</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, ..])
    Console.WriteLine(<span class="hljs-string">"Starts with 1"</span>);
</code></pre>
<ul>
<li>åŒ¹é…ä»¥ 3 ç»“å°¾çš„æ•°ç»„ã€‚</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [.., <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Ends with 3"</span>);
</code></pre>
<ul>
<li>å¼€å¤´å’Œç»“å°¾éƒ½å¯æ£€æŸ¥ï¼Œä¸­é—´å…ƒç´ æ•°é‡ä¸é™ã€‚</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, .., <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Starts with 1 and ends with 3"</span>);
</code></pre>
<h4 data-id="heading-7">å˜é‡ç»‘å®š</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, .. <span class="hljs-keyword">var</span> middle, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">$"Middle elements count: <span class="hljs-subst">{middle.Length}</span>"</span>);
</code></pre>
<blockquote>
<p>ä½¿ç”¨ var middle æ•è·ä¸­é—´åˆ‡ç‰‡ã€‚</p>
</blockquote>
<h4 data-id="heading-8">ç±»å‹æ¨¡å¼</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">object</span>[] items = { <span class="hljs-string">"hello"</span>, <span class="hljs-number">42</span>, <span class="hljs-number">99</span> };

<span class="hljs-keyword">if</span> (items <span class="hljs-keyword">is</span> [<span class="hljs-string">"hello"</span>, <span class="hljs-built_in">int</span> x, ..])
    Console.WriteLine(<span class="hljs-string">$"Second element is int: <span class="hljs-subst">{x}</span>"</span>);
</code></pre>
<blockquote>
<p>ç»“åˆç±»å‹æ¨¡å¼å’Œåˆ‡ç‰‡ã€‚</p>
</blockquote>
<h4 data-id="heading-9">ç©ºé›†åˆåŒ¹é…</h4>
<pre><code class="hljs language-csharp" lang="csharp">   <span class="hljs-keyword">if</span> (arr <span class="hljs-keyword">is</span> []) 
   {
       Console.WriteLine(<span class="hljs-string">"Array is empty"</span>);
   }
</code></pre>
<h4 data-id="heading-10">åµŒå¥—åˆ—è¡¨æ¨¡å¼</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">object</span>[] data = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>];

<span class="hljs-built_in">string</span> result = data <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-meta">1, [2, 3</span>], <span class="hljs-number">4</span>] =&gt; <span class="hljs-string">"Nested match: [1, [2, 3], 4]"</span>,
    _ =&gt; <span class="hljs-string">"No match"</span>
};

Console.WriteLine(result); <span class="hljs-comment">// è¾“å‡º: Nested match: [1, [2, 3], 4]</span>
</code></pre>
<h4 data-id="heading-11">ç»“åˆ switch è¡¨è¾¾å¼</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] nums = { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span> };

<span class="hljs-built_in">string</span> result = nums <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-meta">1, 2, 3, 4</span>] =&gt; <span class="hljs-string">"Exact 1-2-3-4"</span>,
    [<span class="hljs-meta">1, ..</span>]      =&gt; <span class="hljs-string">"Starts with 1"</span>,
    [.., <span class="hljs-number">4</span>]      =&gt; <span class="hljs-string">"Ends with 4"</span>,
    []           =&gt; <span class="hljs-string">"Empty list"</span>,
    _            =&gt; <span class="hljs-string">"Other"</span>
};
Console.WriteLine(result);
</code></pre>
<h3 data-id="heading-12">é«˜çº§ç¤ºä¾‹</h3>
<h4 data-id="heading-13">æ–æ³¢é‚£å¥‘æ£€æµ‹</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] fib = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span> };

<span class="hljs-keyword">if</span> (fib <span class="hljs-keyword">is</span> [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, .. <span class="hljs-keyword">var</span> rest])
    Console.WriteLine(<span class="hljs-string">$"Fibonacci sequence with <span class="hljs-subst">{rest.Length + <span class="hljs-number">2</span>}</span> elements"</span>);
</code></pre>
<h4 data-id="heading-14">è§£æå‘½ä»¤è¡Œå‚æ•°</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>[] args = { <span class="hljs-string">"add"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"Alice"</span> };

<span class="hljs-keyword">var</span> command = args <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-string">"add"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-keyword">var</span> name] =&gt; <span class="hljs-string">$"Add user <span class="hljs-subst">{name}</span>"</span>,
    [<span class="hljs-string">"remove"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-keyword">var</span> name] =&gt; <span class="hljs-string">$"Remove user <span class="hljs-subst">{name}</span>"</span>,
    [] =&gt; <span class="hljs-string">"No command"</span>,
    _ =&gt; <span class="hljs-string">"Invalid"</span>
};

Console.WriteLine(command);
</code></pre>
<h4 data-id="heading-15">å¸¦ when æ¡ä»¶</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-keyword">var</span> first, .., <span class="hljs-keyword">var</span> last] &amp;&amp; first &lt; last)
    Console.WriteLine(<span class="hljs-string">$"First &lt; Last (<span class="hljs-subst">{first}</span> &lt; <span class="hljs-subst">{last}</span>)"</span>);
</code></pre>
<h3 data-id="heading-16">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>
<p>æ•°æ®éªŒè¯ï¼šæ£€æŸ¥è¾“å…¥çš„é›†åˆæ˜¯å¦ç¬¦åˆé¢„æœŸç»“æ„ã€‚</p>
</li>
<li>
<p>æ•°æ®æå–ï¼šä»é›†åˆä¸­æå–ç‰¹å®šå…ƒç´ åˆ°å˜é‡ï¼Œå‡å°‘æ‰‹åŠ¨ç´¢å¼•æ“ä½œã€‚</p>
</li>
<li>
<p>ç®€åŒ–æ§åˆ¶æµï¼šæ›¿ä»£å¤æ‚çš„ <code>if-else</code> æˆ–å¾ªç¯é€»è¾‘ã€‚</p>
</li>
<li>
<p>é€’å½’å¤„ç†ï¼šç»“åˆåˆ‡ç‰‡æ¨¡å¼å¤„ç†åµŒå¥—æˆ–ä¸å®šé•¿é›†åˆã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>