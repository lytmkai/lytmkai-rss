<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Redis（131）Redis的整数集合（Intset）是如何实现的？]]></title>    <link>https://juejin.cn/post/7573525927793868826</link>    <guid>https://juejin.cn/post/7573525927793868826</guid>    <pubDate>2025-11-17T23:03:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927793868826" data-draft-id="7573519273030680622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（131）Redis的整数集合（Intset）是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T23:03:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（131）Redis的整数集合（Intset）是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T23:03:10.000Z" title="Mon Nov 17 2025 23:03:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>整数集合（Intset）是Redis中的一种紧凑型数据结构，专门用于存储整数集合。这种集合通过数组保存数据，并根据需要动态调整数组的大小和整数的存储格式（16位、32位或64位），从而实现高效的存储和查询。</p>
<h3 data-id="heading-0">主要结构</h3>
<p>整数集合的基本结构包括一个头部和一个整数数组。头部包含了整数集合的元数据，如编码方式、元素数量等。数组部分则用于存储实际的整数数据。</p>
<h4 data-id="heading-1">头部结构</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">intset</span> {</span>
    <span class="hljs-type">uint32_t</span> encoding;   <span class="hljs-comment">// 编码方式：表示当前使用的整数类型（16位、32位或64位）</span>
    <span class="hljs-type">uint32_t</span> length;     <span class="hljs-comment">// 集合中的元素数量</span>
    <span class="hljs-type">int8_t</span> contents[];   <span class="hljs-comment">// 整数数组，实际存储数据的地方</span>
} intset;
</code></pre>
<h3 data-id="heading-2">主要操作</h3>
<h4 data-id="heading-3">1. 创建整数集合</h4>
<p>创建一个新的整数集合并初始化。</p>
<pre><code class="hljs language-c" lang="c">intset *<span class="hljs-title function_">intsetNew</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    intset *is = zmalloc(<span class="hljs-keyword">sizeof</span>(intset));
    is-&gt;encoding = intrev32ifbe(INTSET_ENC_INT16);  <span class="hljs-comment">// 默认编码方式为16位整数</span>
    is-&gt;length = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 初始集合长度为0</span>
    <span class="hljs-keyword">return</span> is;
}
</code></pre>
<h4 data-id="heading-4">2. 查找操作</h4>
<p>查找一个整数是否存在于集合中。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">uint8_t</span> <span class="hljs-title function_">intsetFind</span><span class="hljs-params">(intset *is, <span class="hljs-type">int64_t</span> value)</span> {
    <span class="hljs-type">uint32_t</span> pos;
    <span class="hljs-keyword">if</span> (intsetSearch(is, value, &amp;pos)) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">intsetSearch</span><span class="hljs-params">(intset *is, <span class="hljs-type">int64_t</span> value, <span class="hljs-type">uint32_t</span> *pos)</span> {
    <span class="hljs-type">int</span> min = <span class="hljs-number">0</span>, max = intrev32ifbe(is-&gt;length) - <span class="hljs-number">1</span>, mid = <span class="hljs-number">-1</span>;
    <span class="hljs-type">int64_t</span> cur;
    <span class="hljs-keyword">if</span> (intrev32ifbe(is-&gt;length) == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (pos) *pos = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">while</span> (max &gt;= min) {
        mid = (min + max) / <span class="hljs-number">2</span>;
        cur = intsetGetEncoded(is, mid);
        <span class="hljs-keyword">if</span> (value &gt; cur) {
            min = mid + <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; cur) {
            max = mid - <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">if</span> (value == cur) {
        <span class="hljs-keyword">if</span> (pos) *pos = mid;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (pos) *pos = min;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h4 data-id="heading-5">3. 插入操作</h4>
<p>向整数集合中插入一个整数。根据需要调整编码方式并重新分配内存。</p>
<pre><code class="hljs language-c" lang="c">intset *<span class="hljs-title function_">intsetAdd</span><span class="hljs-params">(intset *is, <span class="hljs-type">int64_t</span> value, <span class="hljs-type">uint8_t</span> *success)</span> {
    <span class="hljs-type">uint8_t</span> valenc = _intsetValueEncoding(value);
    <span class="hljs-type">uint32_t</span> pos;
    <span class="hljs-keyword">if</span> (success) *success = <span class="hljs-number">1</span>;

    <span class="hljs-comment">// 查找插入位置</span>
    <span class="hljs-keyword">if</span> (intsetSearch(is, value, &amp;pos)) {
        <span class="hljs-keyword">if</span> (success) *success = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> is;
    }

    <span class="hljs-comment">// 如果需要更大的编码格式</span>
    <span class="hljs-keyword">if</span> (valenc &gt; intrev32ifbe(is-&gt;encoding)) {
        <span class="hljs-keyword">return</span> intsetUpgradeAndAdd(is, value);
    }

    <span class="hljs-comment">// 为新元素分配空间</span>
    is = intsetResize(is, intrev32ifbe(is-&gt;length) + <span class="hljs-number">1</span>);

    <span class="hljs-comment">// 移动元素以腾出插入位置</span>
    <span class="hljs-keyword">if</span> (pos &lt; intrev32ifbe(is-&gt;length)) {
        intsetMoveTail(is, pos, intrev32ifbe(is-&gt;length) - pos);
    }

    <span class="hljs-comment">// 插入新元素</span>
    intsetSet(is, pos, value);
    is-&gt;length = intrev32ifbe(intrev32ifbe(is-&gt;length) + <span class="hljs-number">1</span>);

    <span class="hljs-keyword">return</span> is;
}

<span class="hljs-type">static</span> <span class="hljs-type">uint8_t</span> _intsetValueEncoding(<span class="hljs-type">int64_t</span> v) {
    <span class="hljs-keyword">if</span> (v &lt; INT32_MIN || v &gt; INT32_MAX) <span class="hljs-keyword">return</span> INTSET_ENC_INT64;
    <span class="hljs-keyword">if</span> (v &lt; INT16_MIN || v &gt; INT16_MAX) <span class="hljs-keyword">return</span> INTSET_ENC_INT32;
    <span class="hljs-keyword">return</span> INTSET_ENC_INT16;
}
</code></pre>
<h4 data-id="heading-6">4. 删除操作</h4>
<p>从整数集合中删除一个整数。</p>
<pre><code class="hljs language-c" lang="c">intset *<span class="hljs-title function_">intsetRemove</span><span class="hljs-params">(intset *is, <span class="hljs-type">int64_t</span> value, <span class="hljs-type">int</span> *success)</span> {
    <span class="hljs-type">uint8_t</span> valenc = _intsetValueEncoding(value);
    <span class="hljs-type">uint32_t</span> pos;
    <span class="hljs-keyword">if</span> (success) *success = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (valenc &lt;= intrev32ifbe(is-&gt;encoding) &amp;&amp; intsetSearch(is, value, &amp;pos)) {
        <span class="hljs-type">uint32_t</span> len = intrev32ifbe(is-&gt;length);

        <span class="hljs-comment">// 移动尾部元素以覆盖被删除元素</span>
        <span class="hljs-keyword">if</span> (pos &lt; (len - <span class="hljs-number">1</span>)) {
            intsetMoveTail(is, pos + <span class="hljs-number">1</span>, len - (pos + <span class="hljs-number">1</span>));
        }
        is = intsetResize(is, len - <span class="hljs-number">1</span>);
        is-&gt;length = intrev32ifbe(len - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (success) *success = <span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">return</span> is;
}
</code></pre>
<h3 data-id="heading-7">辅助函数</h3>
<h4 data-id="heading-8">获取和设置元素</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">int64_t</span> <span class="hljs-title function_">intsetGetEncoded</span><span class="hljs-params">(intset *is, <span class="hljs-type">int</span> pos)</span> {
    <span class="hljs-type">int64_t</span> v64;
    <span class="hljs-type">int32_t</span> v32;
    <span class="hljs-type">int16_t</span> v16;
    <span class="hljs-type">uint32_t</span> encoding = intrev32ifbe(is-&gt;encoding);

    <span class="hljs-keyword">if</span> (encoding == INTSET_ENC_INT64) {
        <span class="hljs-built_in">memcpy</span>(&amp;v64, ((<span class="hljs-type">int64_t</span>*)is-&gt;contents) + pos, <span class="hljs-keyword">sizeof</span>(v64));
        <span class="hljs-keyword">return</span> intrev64ifbe(v64);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (encoding == INTSET_ENC_INT32) {
        <span class="hljs-built_in">memcpy</span>(&amp;v32, ((<span class="hljs-type">int32_t</span>*)is-&gt;contents) + pos, <span class="hljs-keyword">sizeof</span>(v32));
        <span class="hljs-keyword">return</span> intrev32ifbe(v32);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">memcpy</span>(&amp;v16, ((<span class="hljs-type">int16_t</span>*)is-&gt;contents) + pos, <span class="hljs-keyword">sizeof</span>(v16));
        <span class="hljs-keyword">return</span> intrev16ifbe(v16);
    }
}

<span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">intsetSet</span><span class="hljs-params">(intset *is, <span class="hljs-type">int</span> pos, <span class="hljs-type">int64_t</span> value)</span> {
    <span class="hljs-type">uint32_t</span> encoding = intrev32ifbe(is-&gt;encoding);

    <span class="hljs-keyword">if</span> (encoding == INTSET_ENC_INT64) {
        ((<span class="hljs-type">int64_t</span>*)is-&gt;contents)[pos] = intrev64ifbe(value);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (encoding == INTSET_ENC_INT32) {
        ((<span class="hljs-type">int32_t</span>*)is-&gt;contents)[pos] = intrev32ifbe(value);
    } <span class="hljs-keyword">else</span> {
        ((<span class="hljs-type">int16_t</span>*)is-&gt;contents)[pos] = intrev16ifbe(value);
    }
}
</code></pre>
<h4 data-id="heading-9">调整内存大小</h4>
<pre><code class="hljs language-c" lang="c">intset *<span class="hljs-title function_">intsetResize</span><span class="hljs-params">(intset *is, <span class="hljs-type">uint32_t</span> len)</span> {
    <span class="hljs-type">uint32_t</span> size = len * intrev32ifbe(is-&gt;encoding);
    is = zrealloc(is, <span class="hljs-keyword">sizeof</span>(intset) + size);
    <span class="hljs-keyword">return</span> is;
}
</code></pre>
<h3 data-id="heading-10">示例使用</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    intset *is = intsetNew();
    <span class="hljs-type">uint8_t</span> success;

    <span class="hljs-comment">// 插入整数</span>
    is = intsetAdd(is, <span class="hljs-number">10</span>, &amp;success);
    is = intsetAdd(is, <span class="hljs-number">20</span>, &amp;success);
    is = intsetAdd(is, <span class="hljs-number">30</span>, &amp;success);

    <span class="hljs-comment">// 查找整数</span>
    <span class="hljs-keyword">if</span> (intsetFind(is, <span class="hljs-number">20</span>)) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"20 exists in the set.\n"</span>);
    }

    <span class="hljs-comment">// 删除整数</span>
    is = intsetRemove(is, <span class="hljs-number">20</span>, &amp;success);
    <span class="hljs-keyword">if</span> (!intsetFind(is, <span class="hljs-number">20</span>)) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"20 has been removed from the set.\n"</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>总结：整数集合（Intset）通过紧凑的内存布局和灵活的编码方式实现了高效的存储和查询操作。它适用于存储小范围的整数集合，通过精心设计的数据结构，保证了高效的插入、删除和查找操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（130）Redis的压缩列表（Ziplist）是如何实现的？]]></title>    <link>https://juejin.cn/post/7573519273030664238</link>    <guid>https://juejin.cn/post/7573519273030664238</guid>    <pubDate>2025-11-17T23:02:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573519273030664238" data-draft-id="7573528564026556462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（130）Redis的压缩列表（Ziplist）是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T23:02:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（130）Redis的压缩列表（Ziplist）是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T23:02:08.000Z" title="Mon Nov 17 2025 23:02:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>压缩列表（Ziplist）是Redis中一种紧凑型的数据结构，用于存储小量的字符串或整数。它的设计初衷是为了节省内存，尤其适用于存储短小数据的场景，如列表或哈希表中的少量元素。Ziplist通过连续的内存块存储数据，并使用一种紧凑的编码方式来表示字符串和整数，从而减少内存占用。</p>
<h3 data-id="heading-0">主要结构</h3>
<p>Ziplist的结构可以分为三部分：表头、数据项和表尾。</p>
<ol>
<li><strong>表头</strong>：包含两个字段：<code>zlbytes</code>和<code>zltail</code>。
<ul>
<li><code>zlbytes</code>：整个压缩列表所占的字节数。</li>
<li><code>zltail</code>：到压缩列表尾部的偏移量。</li>
<li><code>zllen</code>：压缩列表包含的节点数。</li>
</ul>
</li>
<li><strong>数据项</strong>：每个数据项都有三部分：前置节点长度、编码方式和实际数据。</li>
<li><strong>表尾</strong>：用一个字节<code>0xFF</code>标识压缩列表的结束。</li>
</ol>
<h4 data-id="heading-1">压缩列表的完整结构</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/*  
 * |&lt;zlbytes&gt;|&lt;zltail&gt;|&lt;zllen&gt;|&lt;entry&gt;...|&lt;entry&gt;|&lt;zlend&gt;|
 */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ziplist</span> {</span>
    <span class="hljs-type">uint32_t</span> zlbytes;  <span class="hljs-comment">// 压缩列表所占用的总字节数</span>
    <span class="hljs-type">uint32_t</span> zltail;   <span class="hljs-comment">// 到压缩列表尾部的偏移量</span>
    <span class="hljs-type">uint16_t</span> zllen;    <span class="hljs-comment">// 压缩列表包含的节点数</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> entries[]; <span class="hljs-comment">// 压缩列表的实际数据部分</span>
} ziplist;
</code></pre>
<h3 data-id="heading-2">数据项的结构</h3>
<p>每个数据项由以下部分组成：</p>
<ol>
<li><strong>前置节点长度（PrevEntryLength）</strong>：表示前一个节点的长度。</li>
<li><strong>编码方式（Encoding）</strong>：表示当前节点的类型和编码方式。</li>
<li><strong>实际数据（Content）</strong>：当前节点的实际数据。</li>
</ol>
<h4 data-id="heading-3">数据项的结构定义</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ziplistEntry</span> {</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> prevrawlen;  <span class="hljs-comment">// 前一个节点的长度</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> encoding;    <span class="hljs-comment">// 当前节点的数据类型和编码方式</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *p;         <span class="hljs-comment">// 指向实际数据的指针</span>
} ziplistEntry;
</code></pre>
<h3 data-id="heading-4">主要操作</h3>
<h4 data-id="heading-5">1. 压缩列表的创建</h4>
<p>创建一个新的压缩列表，并初始化其头部和尾部。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">ziplistNew</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> bytes = ZIPLIST_HEADER_SIZE+<span class="hljs-number">1</span>; <span class="hljs-comment">// 头部 + 尾部</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = zmalloc(bytes);

    ZIPLIST_BYTES(zl) = intrev32ifbe(bytes);  <span class="hljs-comment">// 设置 zlbytes</span>
    ZIPLIST_TAIL_OFFSET(zl) = intrev32ifbe(ZIPLIST_HEADER_SIZE);  <span class="hljs-comment">// 设置 zltail</span>
    ZIPLIST_LENGTH(zl) = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 设置 zllen</span>
    zl[bytes<span class="hljs-number">-1</span>] = ZIP_END;  <span class="hljs-comment">// 设置 zlend</span>

    <span class="hljs-keyword">return</span> zl;
}
</code></pre>
<h4 data-id="heading-6">2. 插入操作</h4>
<p>插入一个新的数据项到压缩列表中。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">ziplistInsert</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *s, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> slen)</span> {
    <span class="hljs-type">size_t</span> curlen = intrev32ifbe(ZIPLIST_BYTES(zl));
    <span class="hljs-type">size_t</span> reqlen;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> encoding = <span class="hljs-number">0</span>;
    <span class="hljs-type">long</span> <span class="hljs-type">long</span> value;

    <span class="hljs-comment">// 计算插入数据所需的空间</span>
    <span class="hljs-keyword">if</span> (zipTryEncoding(s, slen, &amp;value, &amp;encoding)) {
        reqlen = zipIntSize(encoding);
    } <span class="hljs-keyword">else</span> {
        reqlen = slen;
    }

    <span class="hljs-comment">// 计算新节点的总长度</span>
    reqlen += zipStorePrevEntryLength(<span class="hljs-literal">NULL</span>, curlen);
    reqlen += zipStoreEntryEncoding(<span class="hljs-literal">NULL</span>, encoding, slen);

    zl = zrealloc(zl, curlen + reqlen);
    p = zl + (p - zl);

    <span class="hljs-comment">// 更新头部信息</span>
    memmove(p + reqlen, p, curlen - (p - zl));
    zipStorePrevEntryLength(p, curlen);
    p += zipStoreEntryEncoding(p, encoding, slen);
    
    <span class="hljs-keyword">if</span> (encoding == ZIP_INT_8B) {
        p[<span class="hljs-number">0</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)value;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (encoding == ZIP_INT_16B) {
        <span class="hljs-type">int16_t</span> i16 = (<span class="hljs-type">int16_t</span>)value;
        <span class="hljs-built_in">memcpy</span>(p, &amp;i16, <span class="hljs-keyword">sizeof</span>(i16));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (encoding == ZIP_INT_32B) {
        <span class="hljs-type">int32_t</span> i32 = (<span class="hljs-type">int32_t</span>)value;
        <span class="hljs-built_in">memcpy</span>(p, &amp;i32, <span class="hljs-keyword">sizeof</span>(i32));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (encoding == ZIP_INT_64B) {
        <span class="hljs-type">int64_t</span> i64 = (<span class="hljs-type">int64_t</span>)value;
        <span class="hljs-built_in">memcpy</span>(p, &amp;i64, <span class="hljs-keyword">sizeof</span>(i64));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">memcpy</span>(p, s, slen);
    }

    ZIPLIST_BYTES(zl) = intrev32ifbe(curlen + reqlen);
    ZIPLIST_TAIL_OFFSET(zl) = intrev32ifbe(curlen + reqlen - (p - zl));
    ZIPLIST_LENGTH(zl) = intrev16ifbe(intrev16ifbe(ZIPLIST_LENGTH(zl)) + <span class="hljs-number">1</span>);

    <span class="hljs-keyword">return</span> zl;
}
</code></pre>
<h4 data-id="heading-7">3. 删除操作</h4>
<p>从压缩列表中删除一个数据项。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">ziplistDelete</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> **p)</span> {
    <span class="hljs-type">size_t</span> curlen = intrev32ifbe(ZIPLIST_BYTES(zl));
    <span class="hljs-type">size_t</span> reqlen = zipRawEntryLength(*p);
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *ptr = *p;
    <span class="hljs-type">size_t</span> offset = ptr - zl;

    <span class="hljs-comment">// 删除节点</span>
    memmove(ptr, ptr+reqlen, curlen-(offset+reqlen));
    zl = zrealloc(zl, curlen-reqlen);

    <span class="hljs-comment">// 更新头部信息</span>
    ZIPLIST_BYTES(zl) = intrev32ifbe(curlen-reqlen);
    ZIPLIST_TAIL_OFFSET(zl) = intrev32ifbe(intrev32ifbe(ZIPLIST_TAIL_OFFSET(zl))-reqlen);
    ZIPLIST_LENGTH(zl) = intrev16ifbe(intrev16ifbe(ZIPLIST_LENGTH(zl))<span class="hljs-number">-1</span>);

    <span class="hljs-keyword">return</span> zl;
}
</code></pre>
<h3 data-id="heading-8">辅助函数</h3>
<h4 data-id="heading-9">编码和存储长度</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">zipStorePrevEntryLength</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> len)</span> {
    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> (len &lt; ZIP_BIG_PREVLEN) ? <span class="hljs-number">1</span> : <span class="hljs-number">5</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (len &lt; ZIP_BIG_PREVLEN) {
            p[<span class="hljs-number">0</span>] = len;
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
            p[<span class="hljs-number">0</span>] = ZIP_BIG_PREVLEN;
            <span class="hljs-built_in">memcpy</span>(p+<span class="hljs-number">1</span>, &amp;len, <span class="hljs-keyword">sizeof</span>(len));
            <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
        }
    }
}

<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">zipStoreEntryEncoding</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *p, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> encoding, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> rawlen)</span> {
    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (ZIP_IS_STR(encoding)) {
            <span class="hljs-keyword">if</span> (rawlen &lt;= <span class="hljs-number">0x3f</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rawlen &lt;= <span class="hljs-number">0x3fff</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (ZIP_IS_STR(encoding)) {
            <span class="hljs-keyword">if</span> (rawlen &lt;= <span class="hljs-number">0x3f</span>) {
                p[<span class="hljs-number">0</span>] = ZIP_STR_06B | rawlen;
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rawlen &lt;= <span class="hljs-number">0x3fff</span>) {
                p[<span class="hljs-number">0</span>] = ZIP_STR_14B | ((rawlen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0x3f</span>);
                p[<span class="hljs-number">1</span>] = rawlen &amp; <span class="hljs-number">0xff</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
            } <span class="hljs-keyword">else</span> {
                p[<span class="hljs-number">0</span>] = ZIP_STR_32B;
                <span class="hljs-built_in">memcpy</span>(p+<span class="hljs-number">1</span>, &amp;rawlen, <span class="hljs-keyword">sizeof</span>(rawlen));
                <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
            }
        } <span class="hljs-keyword">else</span> {
            p[<span class="hljs-number">0</span>] = encoding;
            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">示例使用</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *zl = ziplistNew();
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *p;

    <span class="hljs-comment">// 插入数据项</span>
    zl = ziplistInsert(zl, zl + ZIPLIST_HEADER_SIZE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)<span class="hljs-string">"hello"</span>, <span class="hljs-number">5</span>);
    zl = ziplistInsert(zl, zl + ZIPLIST_HEADER_SIZE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)<span class="hljs-string">"world"</span>, <span class="hljs-number">5</span>);

    p = zl + ZIPLIST_HEADER_SIZE;
    <span class="hljs-keyword">while</span> (*p != ZIP_END) {
        <span class="hljs-comment">// 访问数据项</span>
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%s\n"</span>, p + <span class="hljs-number">1</span>); <span class="hljs-comment">// 打印数据项内容</span>
        p += zipRawEntryLength(p);
    }

    <span class="hljs-comment">// 删除数据项</span>
    zl = ziplistDelete(zl, &amp;p);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>总结：压缩列表（ziplist）通过紧凑的内存布局和灵活的编码方式实现了高效的内存利用。它适用于存储短小数据的场景，通过精心设计的数据结构，保证了高效的插入、删除和查找操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 6 迁移常见 crash: _dispatch_assert_queue_fail]]></title>    <link>https://juejin.cn/post/7573525927793737754</link>    <guid>https://juejin.cn/post/7573525927793737754</guid>    <pubDate>2025-11-17T17:21:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927793737754" data-draft-id="7573519273030615086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 6 迁移常见 crash: _dispatch_assert_queue_fail"/> <meta itemprop="keywords" content="Swift,SwiftUI"/> <meta itemprop="datePublished" content="2025-11-17T17:21:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RickeyBoy"/> <meta itemprop="url" content="https://juejin.cn/user/2928754706626136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 6 迁移常见 crash: _dispatch_assert_queue_fail
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754706626136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RickeyBoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T17:21:00.000Z" title="Mon Nov 17 2025 17:21:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>我的 Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRickeyBoy%2FRickey-iOS-Notes%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/RickeyBoy/Rickey-iOS-Notes?tab=readme-ov-file" ref="nofollow noopener noreferrer">github.com/RickeyBoy/R…</a></p>
<p>大量 iOS 内容欢迎大家关注~</p>
</blockquote>
<p>最近在将公司项目迁移到 Swift 6 的过程中，解决了好几个相似的 crash。关键字如下</p>
<pre><code class="hljs language-Swift" lang="Swift">    _dispatch_assert_queue_fail
    
    <span class="hljs-string">"%sBlock was %sexpected to execute on queue [%s (%p)]
    
    Task 208: EXC_BREAKPOINT (code=1, subcode=0x103546f18)
</span></code></pre>
<p>在这里记录和分享，希望遇到相似的问题之后能够更快的解决。</p>
<h2 data-id="heading-0">Crash 1 信息</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401aa2b8456a451bb9126dd29819f501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=sV5ZX53rOCnMQ%2BKlFTYgA33EDyk%3D" alt="image1.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b72bb0e8bcc94b5698585bd52d77b9a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=Tmroj40eTshiska0Z8maHeMOmmI%3D" alt="image2.png" loading="lazy"/></p>
<h2 data-id="heading-1">原因与解决 1</h2>
<p>首先根据 crash 的提示，可以清楚地知道：Block 预期在一个线程上执行，而实际在另一个线程上执行。第一反应：大概率是主线程 vs 后台线程之间的不一致导致的。</p>
<p>如果经常熟练处理 Swift 6 升级的小伙伴就知道，一定是有地方标记了 <code>@MainActor</code>，也就意味着相对应的方法一定是要在主线程上执行的；而实际阴差阳错，在后台线程执行了。</p>
<p>所以接下来可能需要找，到底哪里线程不一致呢？我们根据代码来寻找即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93196cc2304f412f8b3d4580ce12f5b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=SJBKdw4GxcAi2mhkHFKGz7G%2Bods%3D" alt="image3.png" loading="lazy"/></p>
<p>不难找到，根据 Combine 调用链，可以发现其中一处对于 <code>userPublisher</code> 的监听时，选择了在 <code>global</code> 上去执行后面的操作，所以这里需要将这一个逻辑去掉。</p>
<p>于此同时，对于 <code>userPublisher</code> 的发布，我们也最好将其默认放在主线程上，因为他是和 UI 相关的，所以需要做这样的改动：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb6c0a185cd74042976a3644d48f7a3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=Ie%2BLXY%2BIXpAVE5HaVNlrqjaviVA%3D" alt="image4.png" loading="lazy"/></p>
<h2 data-id="heading-2">坑点</h2>
<p>目前是不是觉得好像这个类型的 crash 不算很难解决？没错，这个 crash 的提示相对清楚，知道大概原因后去找就相对容易了。</p>
<p>不过需要注意的是，当使用 Combine 框架遇上这类型的 crash 时，crash 断点只会发生在 <code>Publisher</code> 而不是 <code>Observer</code> 处，所以我们需要自己去寻找调用方，看下在哪里出现了线程使用不一致的问题。</p>
<h2 data-id="heading-3">Crash 2 信息</h2>
<p>好的，那么同类型的一个 crash 再来看看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88360664b0a04f2ba0986ce8914e539c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=1I9XKAmFoHeK61qR8KQ5hS%2FqL84%3D" alt="image5.png" loading="lazy"/></p>
<p>报错信息就不贴了，和上一个 crash 是一样的，都是：<code>"%sBlock was %sexpected to execute on queue [%s (%p)]</code></p>
<p>这里可以看到，crash 断点处在子线程，也是在 AsyncStream 发布处断点。那么根据经验推断，可以大概知道原因：</p>
<ol start="0">
<li>此处发布的时候，处在子线程</li>
<li>下游调用方，一定有某个地方要求在主线程</li>
<li>实际线程与要求线程不一致，所以导致 crash</li>
</ol>
<h2 data-id="heading-4">原因与解决 2</h2>
<p>这里寻找过程就不赘述了。原来的发布者是处在子线程，而后面的监听者处在主线程，因此需要改在主线程发布。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ee6ac69b29b438e9a54cf895bdcd5c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764004859&amp;x-signature=GLnKOIsF5re2WosQBb6XKtl%2BXrw%3D" alt="image6.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习编写chrome插件：Hello World 扩展]]></title>    <link>https://juejin.cn/post/7573525927793721370</link>    <guid>https://juejin.cn/post/7573525927793721370</guid>    <pubDate>2025-11-17T16:51:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927793721370" data-draft-id="7573579203460038707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习编写chrome插件：Hello World 扩展"/> <meta itemprop="keywords" content="Chrome,前端"/> <meta itemprop="datePublished" content="2025-11-17T16:51:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Keely40285"/> <meta itemprop="url" content="https://juejin.cn/user/2594503171249997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习编写chrome插件：Hello World 扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2594503171249997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Keely40285
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T16:51:05.000Z" title="Mon Nov 17 2025 16:51:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">编写 Hello World</h2>
<p>以下内容主要参考： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Fget-started%2Ftutorial%2Fhello-world%3Fhl%3Dzh-cn" target="_blank" title="https://developer.chrome.com/docs/extensions/get-started/tutorial/hello-world?hl=zh-cn" ref="nofollow noopener noreferrer">chrome文档-Hello World 扩展</a></p>
<h3 data-id="heading-1">1. 创建项目</h3>
<p>创建项目，在根目录创建 manifest.json 文件，添加如下内容：</p>
<ul>
<li>文件中的各个字段含义清单请<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Freference%2Fmanifest%3Fhl%3Dzh-cn" target="_blank" title="https://developer.chrome.com/docs/extensions/reference/manifest?hl=zh-cn" ref="nofollow noopener noreferrer">点击查看清单文件格式</a></li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Keely"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keely的插件"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_popup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hello.html"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"default_icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hello.png"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 hello.html，填入如下内容</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">html</span>&gt;
  &lt;<span class="hljs-selector-tag">body</span>&gt;
    &lt;<span class="hljs-selector-tag">h1</span>&gt;Hello Keely&lt;/<span class="hljs-selector-tag">h1</span>&gt;
  &lt;/<span class="hljs-selector-tag">body</span>&gt;
&lt;/<span class="hljs-selector-tag">html</span>&gt;
</code></pre>
<p>项目结构如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c17c9d7ccd454e80593c7c14f107de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764003065&amp;x-signature=FzKWN4pqmmCSVoWsIVjXtZkX%2Bq0%3D" alt="项目目录如下.png" loading="lazy"/></p>
<h3 data-id="heading-2">2. 加载未打包的扩展程序</h3>
<ul>
<li>在chrome新标签页中输入 <code>chrome://extensions</code> 即可前往“扩展程序”页面。</li>
<li>打开开发者模式</li>
<li>加载未打包扩展程序：选择刚才创建的项目目录即可</li>
<li>每次程序更新后，可以点击右下角的<strong>刷新icon</strong>进行插件的刷新</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cf538b26f034fcaa06c07b7c9b106cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764003065&amp;x-signature=6t4ahSP%2FmQs7OepqHzq3x3IH8aU%3D" alt="扩展程序.png" loading="lazy"/></p>
<h3 data-id="heading-3">3. 查看扩展程序：</h3>
<p>点击扩展程序的icon，找到刚才导入的插件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0fb69c0191466f80586c7c18faa3ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764003065&amp;x-signature=t4wNkmuPwTcahdC0lKuT7jwxWNA%3D" alt="扩展程序.png" loading="lazy"/></p>
<p>点击插件效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9056af9bd63418cb1aeadde480c94a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764003065&amp;x-signature=qqD8n6CzXuYrZ87Cy9UOrhr4QM8%3D" alt="hello keely.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Langchain Template 全面指南]]></title>    <link>https://juejin.cn/post/7573535624532639763</link>    <guid>https://juejin.cn/post/7573535624532639763</guid>    <pubDate>2025-11-17T16:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573535624532639763" data-draft-id="7573524348130050111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Langchain Template 全面指南"/> <meta itemprop="keywords" content="LangChain,OpenAI"/> <meta itemprop="datePublished" content="2025-11-17T16:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小东"/> <meta itemprop="url" content="https://juejin.cn/user/932815872994359"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Langchain Template 全面指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/932815872994359/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小东
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T16:51:42.000Z" title="Mon Nov 17 2025 16:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p><code>LangChain Template</code> 是 LangChain 提示工程的核心组件，用于动态生成模型的输入。</p>
<p>🎯 <strong>Template</strong> 的核心概念：</p>
<p><strong>Template</strong> 本质是一个带有<strong>占位符</strong>的文本字符串，这些占位符会在运行时被具体的值填充。它的主要目的是将<strong>提示逻辑</strong>与<strong>业务数据</strong>分离。</p>
<h2 data-id="heading-1">模板分类</h2>
<h3 data-id="heading-2">1. 🎯 基础模板类（Core Templates）</h3>
<h4 data-id="heading-3">(1) <code>PromptTemplate</code></h4>
<p><strong>最基础的文本模板</strong></p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import PromptTemplate

<span class="hljs-comment"># 创建模板的两种方式</span>
<span class="hljs-comment"># 方式1: 使用 from_template (推荐)</span>
<span class="hljs-attr">template</span> = PromptTemplate.from_template(<span class="hljs-string">"请把{text}翻译成{language}"</span>)
<span class="hljs-attr">result</span> = template.format(text=<span class="hljs-string">"Hello"</span>, language=<span class="hljs-string">"中文"</span>)
print(result)  <span class="hljs-comment"># 输出: "请把Hello翻译成中文"</span>

<span class="hljs-comment"># 方式2: 传统创建方式</span>
<span class="hljs-attr">template</span> = PromptTemplate(
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"text"</span>, <span class="hljs-string">"language"</span>],
    <span class="hljs-attr">template</span>=<span class="hljs-string">"请把{text}翻译成{language}"</span>
)

<span class="hljs-comment"># 实际应用示例</span>
<span class="hljs-attr">translation_template</span> = PromptTemplate.from_template(
    "将以下{source_lang}文本翻译成{target_lang}：{text}"
)
<span class="hljs-attr">translation_result</span> = translation_template.format(
    <span class="hljs-attr">source_lang</span>=<span class="hljs-string">"英文"</span>,
    <span class="hljs-attr">target_lang</span>=<span class="hljs-string">"中文"</span>, 
    <span class="hljs-attr">text</span>=<span class="hljs-string">"Hello, how are you?"</span>
)
</code></pre>
<h4 data-id="heading-4">(2) <code>ChatPromptTemplate</code></h4>
<p><strong>聊天消息模板（最常用）</strong></p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import ChatPromptTemplate

<span class="hljs-comment"># 创建聊天提示模板</span>
<span class="hljs-attr">chat_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个{role}"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"请回答：{question}"</span>)
])

<span class="hljs-comment"># 格式化模板</span>
<span class="hljs-attr">messages</span> = chat_prompt.format_messages(
    <span class="hljs-attr">role</span>=<span class="hljs-string">"数学老师"</span>,
    <span class="hljs-attr">question</span>=<span class="hljs-string">"什么是勾股定理？"</span>
)

<span class="hljs-comment"># 实际应用：客服机器人模板</span>
<span class="hljs-attr">customer_service_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是{company}的客服代表，专门处理{department}问题"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"我遇到了一个问题：{issue_description}"</span>),
    (<span class="hljs-string">"ai"</span>, <span class="hljs-string">"我很理解您的情况，让我来帮您解决。"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"具体的细节是：{details}"</span>)
])
</code></pre>
<h3 data-id="heading-5">2. 👥 消息模板类（Message Templates）</h3>
<p>这些是 <code>ChatPromptTemplate</code> 的组成部分：</p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import (
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate,
    AIMessagePromptTemplate,
    FunctionMessagePromptTemplate
)

<span class="hljs-comment"># 创建各种消息模板</span>
<span class="hljs-attr">system_template</span> = SystemMessagePromptTemplate.from_template(
    "你是{role}，具有{expertise}专业知识"
)
<span class="hljs-attr">human_template</span> = HumanMessagePromptTemplate.from_template(
    "我的问题是：{question}"
)
<span class="hljs-attr">ai_template</span> = AIMessagePromptTemplate.from_template(
    "根据我的知识，{answer}"
)

<span class="hljs-comment"># 组合使用</span>
<span class="hljs-attr">chat_prompt</span> = ChatPromptTemplate.from_messages([
    system_template, 
    human_template,
    ai_template
])

<span class="hljs-comment"># 完整示例：编程助手</span>
<span class="hljs-attr">programming_prompt</span> = ChatPromptTemplate.from_messages([
    SystemMessagePromptTemplate.from_template(
        <span class="hljs-string">"你是{language}编程专家，擅长{domain}开发"</span>
    ),
    HumanMessagePromptTemplate.from_template(
        <span class="hljs-string">"请帮我解决这个编程问题：{problem}"</span>
    ),
    AIMessagePromptTemplate.from_template(
        <span class="hljs-string">"我会按照以下思路解决：{approach}"</span>
    ),
    HumanMessagePromptTemplate.from_template(
        <span class="hljs-string">"具体实现代码是？"</span>
    )
])
</code></pre>
<h3 data-id="heading-6">3. 🎪 高级模板类（Advanced Templates）</h3>
<h4 data-id="heading-7">(7) <code>FewShotPromptTemplate</code></h4>
<p><strong>少样本学习模板</strong></p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import FewShotPromptTemplate, PromptTemplate

<span class="hljs-comment"># 定义示例数据</span>
<span class="hljs-attr">examples</span> = [
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"The weather is nice today"</span>, 
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"今天天气很好"</span>
    },
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"I love programming"</span>, 
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"我喜欢编程"</span>
    },
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"The meeting starts at 3 PM"</span>, 
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"会议下午三点开始"</span>
    }
]

<span class="hljs-comment"># 定义单个示例的模板</span>
<span class="hljs-attr">example_template</span> = PromptTemplate.from_template(
    "英文: {input}\n中文: {output}"
)

<span class="hljs-comment"># 创建少样本提示模板</span>
<span class="hljs-attr">few_shot_prompt</span> = FewShotPromptTemplate(
    <span class="hljs-attr">examples</span>=examples,
    <span class="hljs-attr">example_prompt</span>=example_template,
    <span class="hljs-attr">prefix</span>=<span class="hljs-string">"请根据以下示例将英文翻译成中文："</span>,
    <span class="hljs-attr">suffix</span>=<span class="hljs-string">"英文: {input}\n中文:"</span>,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"input"</span>]
)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-attr">result</span> = few_shot_prompt.format(input=<span class="hljs-string">"Thank you for your help"</span>)
print("=== 生成的提示 ===")
print(result)

<span class="hljs-comment"># 实际应用：情感分析少样本模板</span>
<span class="hljs-attr">sentiment_examples</span> = [
    {<span class="hljs-string">"text"</span>: <span class="hljs-string">"这个产品太棒了！"</span>, <span class="hljs-string">"sentiment"</span>: <span class="hljs-string">"正面"</span>},
    {<span class="hljs-string">"text"</span>: <span class="hljs-string">"服务很差，很不满意"</span>, <span class="hljs-string">"sentiment"</span>: <span class="hljs-string">"负面"</span>},
    {<span class="hljs-string">"text"</span>: <span class="hljs-string">"还可以，一般般"</span>, <span class="hljs-string">"sentiment"</span>: <span class="hljs-string">"中性"</span>}
]

<span class="hljs-attr">sentiment_template</span> = FewShotPromptTemplate(
    <span class="hljs-attr">examples</span>=sentiment_examples,
    <span class="hljs-attr">example_prompt</span>=PromptTemplate.from_template(
        "文本: {text}\n情感: {sentiment}"
    ),
    <span class="hljs-attr">prefix</span>=<span class="hljs-string">"分析以下文本的情感倾向："</span>,
    <span class="hljs-attr">suffix</span>=<span class="hljs-string">"文本: {text}\n情感:"</span>,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"text"</span>]
)
</code></pre>
<h4 data-id="heading-8">(8) <code>FewShotChatMessagePromptTemplate</code></h4>
<p><strong>聊天版的少样本模板</strong></p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import FewShotChatMessagePromptTemplate, ChatPromptTemplate

<span class="hljs-comment"># 定义聊天示例</span>
<span class="hljs-attr">chat_examples</span> = [
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"今天的天气怎么样？"</span>,
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"我无法获取实时天气信息，请查看天气预报应用。"</span>
    },
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"现在几点了？"</span>,
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"我无法获取当前时间，请查看您的设备时钟。"</span>
    },
    {
        <span class="hljs-string">"input"</span>: <span class="hljs-string">"我的快递到哪里了？"</span>, 
        <span class="hljs-string">"output"</span>: <span class="hljs-string">"我无法查询物流信息，请使用快递公司的官方应用查询。"</span>
    }
]

<span class="hljs-comment"># 创建示例模板</span>
<span class="hljs-attr">example_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
    (<span class="hljs-string">"ai"</span>, <span class="hljs-string">"{output}"</span>)
])

<span class="hljs-comment"># 创建少样本聊天模板</span>
<span class="hljs-attr">few_shot_chat</span> = FewShotChatMessagePromptTemplate(
    <span class="hljs-attr">examples</span>=chat_examples,
    <span class="hljs-attr">example_prompt</span>=example_prompt
)

<span class="hljs-comment"># 组合到完整提示中</span>
<span class="hljs-attr">final_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个有帮助的AI助手，请礼貌地回答用户问题。"</span>),
    few_shot_chat,
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{user_input}"</span>)
])

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-attr">messages</span> = final_prompt.format_messages(
    <span class="hljs-attr">user_input</span>=<span class="hljs-string">"我的银行余额是多少？"</span>
)
</code></pre>
<h3 data-id="heading-9">4. 🧩 特殊用途模板</h3>
<h4 data-id="heading-10">(9) <code>MessagesPlaceholder</code></h4>
<p><strong>消息占位符（用于动态插入消息）</strong></p>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import MessagesPlaceholder, ChatPromptTemplate

<span class="hljs-comment"># 创建带消息占位符的模板</span>
<span class="hljs-attr">prompt_with_history</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是专业的{expert_role}"</span>),
    MessagesPlaceholder(variable_name=<span class="hljs-string">"chat_history"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{current_question}"</span>)
])

<span class="hljs-comment"># 模拟对话历史</span>
<span class="hljs-attr">chat_history</span> = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"human"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"什么是Python？"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"ai"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Python是一种编程语言。"</span>}
]

<span class="hljs-comment"># 格式化模板</span>
<span class="hljs-attr">messages</span> = prompt_with_history.format_messages(
    <span class="hljs-attr">expert_role</span>=<span class="hljs-string">"编程教师"</span>,
    <span class="hljs-attr">chat_history</span>=chat_history,
    <span class="hljs-attr">current_question</span>=<span class="hljs-string">"Python有什么特点？"</span>
)

<span class="hljs-comment"># 实际应用：带记忆的对话系统</span>
<span class="hljs-attr">memory_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"""你是{assistant_name}，具有以下特点：
    - 专业领域: {expertise}
    - 回答风格: {style}
    - 语言: {language}"""</span>),
    
    MessagesPlaceholder(variable_name=<span class="hljs-string">"conversation_history"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{current_input}"</span>)
])
</code></pre>
<h2 data-id="heading-11">🔗 Template 关系图谱</h2>
<pre><code class="hljs language-scss" lang="scss">PromptTemplate (基类)
    │
    ├── ChatPromptTemplate (组合多个消息)
    │       ├── SystemMessagePromptTemplate
    │       ├── HumanMessagePromptTemplate  
    │       ├── AIMessagePromptTemplate
    │       └── FunctionMessagePromptTemplate
    │
    ├── FewShotPromptTemplate (包含example_prompt)
    │
    └── FewShotChatMessagePromptTemplate (专门用于聊天)
</code></pre>
<h2 data-id="heading-12">🎯 核心关系说明</h2>
<h3 data-id="heading-13">关系1：<strong>包含关系</strong></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># FewShotPromptTemplate 包含 PromptTemplate</span>
<span class="hljs-attr">examples</span> = [
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"hello"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"你好"</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"goodbye"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"再见"</span>}
]

<span class="hljs-attr">example_prompt</span> = PromptTemplate.from_template(
    "输入: {input}\n输出: {output}"
)

<span class="hljs-attr">few_shot_prompt</span> = FewShotPromptTemplate(
    <span class="hljs-attr">example_prompt</span>=example_prompt,  <span class="hljs-comment"># 包含关系</span>
    <span class="hljs-attr">examples</span>=examples,
    <span class="hljs-attr">prefix</span>=<span class="hljs-string">"翻译任务："</span>,
    <span class="hljs-attr">suffix</span>=<span class="hljs-string">"输入: {input}\n输出:"</span>,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"input"</span>]
)

<span class="hljs-comment"># ChatPromptTemplate 包含 MessagePromptTemplates</span>
<span class="hljs-attr">system_template</span> = SystemMessagePromptTemplate.from_template(<span class="hljs-string">"系统: {role}"</span>)
<span class="hljs-attr">human_template</span> = HumanMessagePromptTemplate.from_template(<span class="hljs-string">"用户: {question}"</span>)

<span class="hljs-attr">chat_prompt</span> = ChatPromptTemplate.from_messages([
    system_template,    <span class="hljs-comment"># 包含关系</span>
    human_template      <span class="hljs-comment"># 包含关系</span>
])
</code></pre>
<h3 data-id="heading-14">关系2：<strong>组合关系</strong></h3>
<pre><code class="hljs language-ini" lang="ini">from langchain.prompts import ChatPromptTemplate, FewShotChatMessagePromptTemplate

<span class="hljs-comment"># 创建少样本部分</span>
<span class="hljs-attr">few_shot_examples</span> = [
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"如何学习编程？"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"建议从基础语法开始..."</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"最好的编程语言？"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"这取决于你的目标..."</span>}
]

<span class="hljs-attr">few_shot_section</span> = FewShotChatMessagePromptTemplate(
    <span class="hljs-attr">example_prompt</span>=ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
        (<span class="hljs-string">"ai"</span>, <span class="hljs-string">"{output}"</span>)
    ]),
    <span class="hljs-attr">examples</span>=few_shot_examples
)

<span class="hljs-comment"># FewShotChatMessagePromptTemplate 作为 ChatPromptTemplate 的一部分</span>
<span class="hljs-attr">final_prompt</span> = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是{teacher_type}老师"</span>),
    few_shot_section,  <span class="hljs-comment"># 组合关系</span>
    MessagesPlaceholder(variable_name=<span class="hljs-string">"history"</span>),  <span class="hljs-comment"># 组合关系</span>
    HumanMessagePromptTemplate.from_template(<span class="hljs-string">"{current_input}"</span>)
])

<span class="hljs-comment"># 使用组合模板</span>
<span class="hljs-attr">formatted_messages</span> = final_prompt.format_messages(
    <span class="hljs-attr">teacher_type</span>=<span class="hljs-string">"编程"</span>,
    <span class="hljs-attr">history</span>=[],
    <span class="hljs-attr">current_input</span>=<span class="hljs-string">"如何调试代码？"</span>
)
</code></pre>
<h2 data-id="heading-15">🛠️ 实际使用场景对比</h2>
<h3 data-id="heading-16">场景1：简单文本生成 → <code>PromptTemplate</code></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 诗歌生成</span>
<span class="hljs-attr">poem_template</span> = PromptTemplate.from_template(<span class="hljs-string">"""
请以{style}风格写一首关于{topic}的诗。

要求：
- 意境: {mood}
- 长度: {length}
- 语言: {language}

诗歌：
"""</span>)

<span class="hljs-attr">poem_prompt</span> = poem_template.format(
    <span class="hljs-attr">style</span>=<span class="hljs-string">"浪漫"</span>,
    <span class="hljs-attr">topic</span>=<span class="hljs-string">"春天"</span>, 
    <span class="hljs-attr">mood</span>=<span class="hljs-string">"欢快"</span>,
    <span class="hljs-attr">length</span>=<span class="hljs-string">"八句"</span>,
    <span class="hljs-attr">language</span>=<span class="hljs-string">"中文"</span>
)
</code></pre>
<h3 data-id="heading-17">场景2：聊天对话 → <code>ChatPromptTemplate</code> + <code>MessageTemplates</code></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 专业咨询对话</span>
<span class="hljs-attr">system_msg</span> = SystemMessagePromptTemplate.from_template(<span class="hljs-string">"""
你是{profession}顾问，具有以下资质：
- 经验: {experience}
- 专长: {specialization} 
- 认证: {certifications}
"""</span>)

<span class="hljs-attr">human_msg</span> = HumanMessagePromptTemplate.from_template(<span class="hljs-string">"""
我的咨询问题是：{question}

背景信息：
{context}
"""</span>)

<span class="hljs-attr">chat_prompt</span> = ChatPromptTemplate.from_messages([system_msg, human_msg])

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-attr">messages</span> = chat_prompt.format_messages(
    <span class="hljs-attr">profession</span>=<span class="hljs-string">"法律"</span>,
    <span class="hljs-attr">experience</span>=<span class="hljs-string">"10年"</span>,
    <span class="hljs-attr">specialization</span>=<span class="hljs-string">"合同法"</span>,
    <span class="hljs-attr">certifications</span>=<span class="hljs-string">"律师执业证"</span>,
    <span class="hljs-attr">question</span>=<span class="hljs-string">"合同违约如何处理？"</span>,
    <span class="hljs-attr">context</span>=<span class="hljs-string">"甲方未按约定时间付款"</span>
)
</code></pre>
<h3 data-id="heading-18">场景3：示例学习 → <code>FewShotPromptTemplate</code></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 代码生成少样本学习</span>
<span class="hljs-attr">code_examples</span> = [
    {
        <span class="hljs-string">"requirement"</span>: <span class="hljs-string">"计算列表平均值"</span>,
        <span class="hljs-string">"code"</span>: <span class="hljs-string">"def calculate_average(numbers):\n    return sum(numbers) / len(numbers)"</span>
    },
    {
        <span class="hljs-string">"requirement"</span>: <span class="hljs-string">"反转字符串"</span>, 
        <span class="hljs-string">"code"</span>: <span class="hljs-string">"def reverse_string(s):\n    return s[::-1]"</span>
    }
]

<span class="hljs-attr">code_template</span> = FewShotPromptTemplate(
    <span class="hljs-attr">examples</span>=code_examples,
    <span class="hljs-attr">example_prompt</span>=PromptTemplate.from_template(
        "需求: {requirement}\n代码: {code}"
    ),
    <span class="hljs-attr">prefix</span>=<span class="hljs-string">"请根据示例编写Python代码："</span>,
    <span class="hljs-attr">suffix</span>=<span class="hljs-string">"需求: {requirement}\n代码:"</span>,
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"requirement"</span>]
)

<span class="hljs-attr">code_prompt</span> = code_template.format(
    <span class="hljs-attr">requirement</span>=<span class="hljs-string">"检查字符串是否是回文"</span>
)
</code></pre>
<h3 data-id="heading-19">场景4：复杂聊天 + 示例 → 组合使用</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 创建少样本部分</span>
<span class="hljs-attr">few_shot_examples</span> = [
    {
        <span class="hljs-string">"situation"</span>: <span class="hljs-string">"用户询问个人隐私信息"</span>,
        <span class="hljs-string">"response"</span>: <span class="hljs-string">"出于安全考虑，我无法访问或提供个人隐私信息。"</span>
    },
    {
        <span class="hljs-string">"situation"</span>: <span class="hljs-string">"用户要求违法帮助"</span>, 
        <span class="hljs-string">"response"</span>: <span class="hljs-string">"抱歉，我无法提供任何违法或不道德行为的帮助。"</span>
    }
]

<span class="hljs-attr">few_shot_section</span> = FewShotChatMessagePromptTemplate(
    <span class="hljs-attr">example_prompt</span>=ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"情境: {situation}"</span>),
        (<span class="hljs-string">"ai"</span>, <span class="hljs-string">"回复: {response}"</span>)
    ]),
    <span class="hljs-attr">examples</span>=few_shot_examples
)

<span class="hljs-comment"># 2. 创建完整聊天提示</span>
<span class="hljs-attr">final_prompt</span> = ChatPromptTemplate.from_messages([
    SystemMessagePromptTemplate.from_template(<span class="hljs-string">"""
    你是{assistant_name}，安全准则：
    - {safety_guidelines}
    - 始终遵守{regulations}
    """</span>),
    
    few_shot_section,  <span class="hljs-comment"># 包含少样本示例</span>
    
    MessagesPlaceholder(variable_name=<span class="hljs-string">"conversation_history"</span>),  <span class="hljs-comment"># 动态历史</span>
    
    HumanMessagePromptTemplate.from_template(<span class="hljs-string">"当前查询: {current_query}"</span>)
])

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-attr">messages</span> = final_prompt.format_messages(
    <span class="hljs-attr">assistant_name</span>=<span class="hljs-string">"安全助手"</span>,
    <span class="hljs-attr">safety_guidelines</span>=<span class="hljs-string">"不分享个人信息，不提供违法建议"</span>,
    <span class="hljs-attr">regulations</span>=<span class="hljs-string">"AI使用规范"</span>,
    <span class="hljs-attr">conversation_history</span>=[],
    <span class="hljs-attr">current_query</span>=<span class="hljs-string">"你能告诉我别人的电话号码吗？"</span>
)
</code></pre>
<h2 data-id="heading-20">📝 使用频率总结</h2>


















































<table><thead><tr><th>Template 类型</th><th>用途</th><th>使用频率</th></tr></thead><tbody><tr><td><code>PromptTemplate</code></td><td>基础文本模板</td><td>⭐⭐⭐⭐</td></tr><tr><td><code>ChatPromptTemplate</code></td><td>聊天消息组合</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><code>SystemMessagePromptTemplate</code></td><td>系统消息</td><td>⭐⭐⭐⭐</td></tr><tr><td><code>HumanMessagePromptTemplate</code></td><td>用户消息</td><td>⭐⭐⭐⭐</td></tr><tr><td><code>AIMessagePromptTemplate</code></td><td>AI消息</td><td>⭐⭐⭐</td></tr><tr><td><code>FewShotPromptTemplate</code></td><td>少样本学习</td><td>⭐⭐⭐</td></tr><tr><td><code>FewShotChatMessagePromptTemplate</code></td><td>聊天少样本</td><td>⭐⭐</td></tr><tr><td><code>MessagesPlaceholder</code></td><td>动态消息占位</td><td>⭐⭐</td></tr></tbody></table>
<h2 data-id="heading-21">总结</h2>
<p><code>LangChain Template</code> 提供了强大而灵活的提示工程能力：</p>
<ul>
<li><strong>🎯 精准控制</strong>: 通过模板精确控制模型输入，确保提示的一致性</li>
<li><strong>♻️ 可复用性</strong>: 一次创建，多处使用，提高开发效率</li>
<li><strong>🔧 模块化</strong>: 像搭积木一样组合模板，支持复杂场景</li>
<li><strong>🛡️ 可靠性</strong>: 类型安全和错误检查，减少运行时错误</li>
<li><strong>🚀 高效开发</strong>: 加速 AI 应用开发流程，降低维护成本</li>
</ul>
<p>掌握 <code>LangChain Template</code> 是构建高质量大模型应用的关键技能，它让提示工程从艺术走向工程化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手搓一个简易Agent]]></title>    <link>https://juejin.cn/post/7573512056089493539</link>    <guid>https://juejin.cn/post/7573512056089493539</guid>    <pubDate>2025-11-17T14:52:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573512056089493539" data-draft-id="7573512056089231395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手搓一个简易Agent"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-17T14:52:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桜吹雪"/> <meta itemprop="url" content="https://juejin.cn/user/1179091901098269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手搓一个简易Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1179091901098269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桜吹雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T14:52:13.000Z" title="Mon Nov 17 2025 14:52:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果跟着我完成了前面的一些学习，相信你也对ai有一定程度的了解了，话不多说我们下一步继续学手搓一个简单的ReAct Agent，如果你不了解什么是ReAct的话可以百度或者问一下AI，相信AI可以给你很详细的解答。</p>
<h2 data-id="heading-0">起步</h2>
<p>既然是手搓的话，咱们就先不用前面用到的Langchain.js了（手搓完再展示Langchain.js v1.0的createAgent），这里使用一个非常轻便的库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxsai.js.org%2F" target="_blank" title="https://xsai.js.org/" ref="nofollow noopener noreferrer">xsai</a>，相对于Langchain.js动不动几十MB的安装依赖，xsai就要小很多了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee2ae3a950be4df7880684b95a44ebbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGc5ZC56Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763996127&amp;x-signature=TZJypm8maaI9%2Fk4HDFMaIwPoORs%3D" alt="image.png" loading="lazy"/></p>
<p>然后js运行时咱们选非常好用的Bun，因为内置了很多好用的工具，比如Monorepo、env管理等等</p>
<p>然后模型选择，既然叫ReAct，那么我们需要一个能够推理思考的模型，当然你也可以写提示词让非推理模型生成推理链，不过现在是5202年末，各大厂商都有推出非常牛逼的推理模型，那么咱们简单点选个推理模型就好了，这里我选择了Qwen3-8B，使用ollama本地运行（其实是最近换了新显卡发现本地跑小模型也挺快的），当然也可以选择一些云计算平台，比如火山、百炼等等，都有几十上百万的免费token，要是用完了想白嫖也可以选择硅基流动的免费模型！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d8eb806efdf469aa61055e3340c772b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGc5ZC56Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763996127&amp;x-signature=Py9gBpv6mcKqtMD906vpd6pzcrk%3D" alt="image.png" loading="lazy"/></p>
<p>除此之外也没啥多余的东西了，那么开始操作吧</p>
<pre><code class="hljs language-sh" lang="sh">bun init                                                                 
                                                                           
✓ Select a project template: Blank

 + .gitignore
 + index.ts
 + tsconfig.json (<span class="hljs-keyword">for</span> editor autocomplete)
 + README.md

To get started, run:

    bun run index.ts

</code></pre>
<pre><code class="hljs language-sh" lang="sh">bun add @xsai/shared-chat @xsai/tool @xsai/utils-chat zod
</code></pre>
<h2 data-id="heading-1">编写代码</h2>
<p>为了方便演示，代码就不拆分文件了，直接写到底，并用简单说明一下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {
  chat,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">AssistantMessage</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">FinishReason</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Message</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Tool</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Usage</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@xsai/shared-chat"</span>;
<span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"@xsai/tool"</span>;
<span class="hljs-keyword">import</span> { message } <span class="hljs-keyword">from</span> <span class="hljs-string">"@xsai/utils-chat"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> z <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-comment">//#region openai 返回结构</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Choice</span> {
  <span class="hljs-attr">finish_reason</span>: <span class="hljs-title class_">FinishReason</span>;
  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-title class_">AssistantMessage</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChatCompletionsResponse</span> {
  <span class="hljs-attr">choices</span>: <span class="hljs-title class_">Choice</span>[];
  <span class="hljs-attr">created</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">model</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">object</span>: <span class="hljs-string">"chat.completion"</span>;
  <span class="hljs-attr">system_fingerprint</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">usage</span>: <span class="hljs-title class_">Usage</span>;
}
<span class="hljs-comment">//#endregion</span>

<span class="hljs-comment">// 方便生成message</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> assistant = message.<span class="hljs-property">assistant</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> system = message.<span class="hljs-property">system</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> user = message.<span class="hljs-property">user</span>;

<span class="hljs-comment">// 用来创建agent</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAgent</span>(<span class="hljs-params">options: {
  provider: {
    baseURL: <span class="hljs-built_in">string</span>;
    apiKey: <span class="hljs-built_in">string</span>;
    model: <span class="hljs-built_in">string</span>;
  };
  tools?: Tool[];
}</span>) {
  <span class="hljs-comment">// call：让agent开始工作</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">call</span>(<span class="hljs-params">
    messages: Message[],
    callOptions: { maxRoundTrip: <span class="hljs-built_in">number</span> } = { maxRoundTrip: <span class="hljs-number">10</span> }
  </span>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 限制一下agent最大运行步数</span>
    <span class="hljs-keyword">while</span> (count &lt; callOptions.<span class="hljs-property">maxRoundTrip</span>) {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">chat</span>({
        ...options.<span class="hljs-property">provider</span>,
        <span class="hljs-attr">baseURL</span>: options.<span class="hljs-property">provider</span>.<span class="hljs-property">baseURL</span>,
        <span class="hljs-attr">model</span>: options.<span class="hljs-property">provider</span>.<span class="hljs-property">model</span>,
        messages,
        <span class="hljs-attr">tools</span>: options.<span class="hljs-property">tools</span>,
      });
      <span class="hljs-keyword">const</span> cmplResp = (<span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ChatCompletionsResponse</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(cmplResp.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>], <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
      <span class="hljs-keyword">const</span> toolCalls = cmplResp.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>.<span class="hljs-property">tool_calls</span>;
      <span class="hljs-comment">// 判断是否函数调用，如果没有函数调用说明结束工作，已经得到结果</span>
      <span class="hljs-keyword">if</span> (!toolCalls?.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">return</span> cmplResp;
      }
      <span class="hljs-comment">// 将tool_calls加入到messages上下文中，方便ai判读已经调用过说明函数</span>
      messages.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">assistant</span>(toolCalls[<span class="hljs-number">0</span>]));
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> choice <span class="hljs-keyword">of</span> cmplResp.<span class="hljs-property">choices</span>) {
        <span class="hljs-keyword">if</span> (!choice.<span class="hljs-property">message</span>.<span class="hljs-property">tool_calls</span>) {
          <span class="hljs-keyword">continue</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> toolCall <span class="hljs-keyword">of</span> choice.<span class="hljs-property">message</span>.<span class="hljs-property">tool_calls</span>) {
          <span class="hljs-comment">// 找到tool</span>
          <span class="hljs-keyword">const</span> foundTool = options.<span class="hljs-property">tools</span>?.<span class="hljs-title function_">find</span>(
            <span class="hljs-function">(<span class="hljs-params">tool</span>) =&gt;</span> tool.<span class="hljs-property">function</span>.<span class="hljs-property">name</span> === toolCall.<span class="hljs-property">function</span>.<span class="hljs-property">name</span>
          );
          <span class="hljs-keyword">if</span> (!foundTool) {
            <span class="hljs-keyword">continue</span>;
          }
          <span class="hljs-comment">// 调用tool拿到结果</span>
          <span class="hljs-keyword">const</span> invokeResult = <span class="hljs-keyword">await</span> foundTool.<span class="hljs-title function_">execute</span>(
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(toolCall.<span class="hljs-property">function</span>.<span class="hljs-property">arguments</span> || <span class="hljs-string">"{}"</span>),
            {
              messages,
              <span class="hljs-attr">toolCallId</span>: toolCall.<span class="hljs-property">id</span>,
            }
          );
          <span class="hljs-comment">// 将结果加入到上下文中</span>
          messages.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">role</span>: <span class="hljs-string">"tool"</span>,
            <span class="hljs-attr">content</span>:
              invokeResult === <span class="hljs-string">"string"</span>
                ? invokeResult
                : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(invokeResult),
            <span class="hljs-attr">tool_call_id</span>: toolCall.<span class="hljs-property">id</span>,
          });
        }
      }
      <span class="hljs-comment">// 完成一次函数调用</span>
      count++;
    }
  }
  <span class="hljs-keyword">return</span> { call };
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 创建工具</span>
  <span class="hljs-keyword">const</span> getCity = <span class="hljs-keyword">await</span> <span class="hljs-title function_">tool</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"getCity"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the user's city"</span>,
    <span class="hljs-attr">execute</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"广州"</span>,
    <span class="hljs-attr">parameters</span>: z.<span class="hljs-title function_">object</span>({}),
  });
  <span class="hljs-keyword">const</span> getCityCode = <span class="hljs-keyword">await</span> <span class="hljs-title function_">tool</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"getCityCode"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the user's city code with search"</span>,
    <span class="hljs-attr">execute</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"Guangzhou"</span>,
    <span class="hljs-attr">parameters</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">location</span>: z
        .<span class="hljs-title function_">string</span>()
        .<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>)
        .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"Get the user's city code with search"</span>),
    }),
  });
  <span class="hljs-keyword">const</span> getWeather = <span class="hljs-keyword">await</span> <span class="hljs-title function_">tool</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"getWeather"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the city code weather"</span>,
    <span class="hljs-attr">execute</span>: <span class="hljs-function">(<span class="hljs-params">{ cityCode }</span>) =&gt;</span> ({
      <span class="hljs-attr">city</span>: <span class="hljs-string">`广州`</span>,
      cityCode,
      <span class="hljs-attr">weather</span>: <span class="hljs-string">"sunny"</span>,
      <span class="hljs-attr">degreesCelsius</span>: <span class="hljs-number">26</span>,
    }),
    <span class="hljs-attr">parameters</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">cityCode</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">describe</span>(<span class="hljs-string">"Get the city code weather"</span>),
    }),
  });
  <span class="hljs-comment">// 创建agent</span>
  <span class="hljs-keyword">const</span> { call } = <span class="hljs-title function_">createAgent</span>({
    <span class="hljs-attr">provider</span>: {
      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:11434/v1"</span>,
      <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"unused"</span>,
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen3:8b"</span>,
    },
    <span class="hljs-attr">tools</span>: [getCity, getCityCode, getWeather],
  });
  <span class="hljs-comment">// 运行</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">call</span>([
    <span class="hljs-title function_">system</span>(
      <span class="hljs-string">"我是一名乐于助人的助手，负责为用户提供所需信息。用户可能提出任何问题，请识别用户的需求，并选用合适的工具来获取必要信息。"</span>
    ),
    <span class="hljs-title function_">user</span>(<span class="hljs-string">"今天天气怎么样?"</span>),
  ]);
  <span class="hljs-comment">// 观察执行结果</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res?.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
}

<span class="hljs-title function_">main</span>();
</code></pre>
<p>执行一下，查看结果：</p>
<pre><code class="hljs language-sh" lang="sh">bun index.ts

今天广州的天气是晴天，气温28摄氏度。
</code></pre>
<p>是不是很简单通俗易懂。</p>
<h2 data-id="heading-2">邪修（bushi）快捷办法</h2>
<p>当然你可以参考上面的办法简单封装一下，或者，也不是不可以用别人写好的办法，比如langchain.js的办法</p>
<pre><code class="hljs language-sh" lang="sh">bun add langchain @langchain/openai
</code></pre>
<p>编写代码！</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { createAgent, tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> z <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-keyword">const</span> getCity = <span class="hljs-title function_">tool</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">"广州"</span>, {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"getCity"</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the user's city"</span>,
  <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({}),
});

<span class="hljs-keyword">const</span> getCityCode = <span class="hljs-title function_">tool</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">"Guangzhou"</span>, {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"getCityCode"</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the user's city code with search"</span>,
  <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">location</span>: z
      .<span class="hljs-title function_">string</span>()
      .<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"Get the user's city code with search"</span>),
  }),
});
<span class="hljs-keyword">const</span> getWeather = <span class="hljs-title function_">tool</span>(
  <span class="hljs-function">(<span class="hljs-params">{ cityCode }</span>) =&gt;</span> ({
    <span class="hljs-attr">city</span>: <span class="hljs-string">`广州`</span>,
    cityCode,
    <span class="hljs-attr">weather</span>: <span class="hljs-string">"sunny"</span>,
    <span class="hljs-attr">degreesCelsius</span>: <span class="hljs-number">28</span>,
  }),
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"getWeather"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"Get the city code weather"</span>,
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">cityCode</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">describe</span>(<span class="hljs-string">"Get the city code weather"</span>),
    }),
  }
);

<span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createAgent</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
    <span class="hljs-attr">configuration</span>: {
      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:11434/v1"</span>,
    },
    <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"unused"</span>,
    <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen3:8b"</span>,
  }),
  <span class="hljs-attr">tools</span>: [getCity, getCityCode, getWeather],
  <span class="hljs-attr">systemPrompt</span>: <span class="hljs-string">"You are a helpful assistant."</span>,
});

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">invoke</span>({
  <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"今天天气怎么样"</span> }],
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">messages</span>.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>)?.<span class="hljs-property">content</span>);
</code></pre>
<pre><code class="hljs language-sh" lang="sh">bun langchain-agent.ts                                                                                   
今天广州的天气晴朗，气温28摄氏度。
</code></pre>
<p>嗯，很简单粗暴，很邪修（</p>
<p>你学废了吗!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SourceMap数据生成核心原理：简化字段与Base64VLQ编码]]></title>    <link>https://juejin.cn/post/7573486671297560618</link>    <guid>https://juejin.cn/post/7573486671297560618</guid>    <pubDate>2025-11-17T15:10:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573486671297560618" data-draft-id="7573486671297511466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SourceMap数据生成核心原理：简化字段与Base64VLQ编码"/> <meta itemprop="keywords" content="前端,JavaScript,算法"/> <meta itemprop="datePublished" content="2025-11-17T15:10:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="漂流瓶jz"/> <meta itemprop="url" content="https://juejin.cn/user/3694779980078877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SourceMap数据生成核心原理：简化字段与Base64VLQ编码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3694779980078877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    漂流瓶jz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:10:12.000Z" title="Mon Nov 17 2025 15:10:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简述</h2>
<p>SourceMap提供了从源代码到生成代码之间的转换关系，通过它使得各类代码生成工具生成的代码调试变得简单。前面我们写过两篇文章描述过SourceMap的历史，使用方式和生成工具等，对SourceMap有了一定的了解：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2025%2Fjs-sourcemap.html" target="_blank" title="https://jzplp.github.io/2025/js-sourcemap.html" ref="nofollow noopener noreferrer">快速定位源码问题：SourceMap的生成/使用/文件格式与历史</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2025%2Fwebpack-sourcemap.html" target="_blank" title="https://jzplp.github.io/2025/webpack-sourcemap.html" ref="nofollow noopener noreferrer">Webpack中各种devtool配置的含义与SourceMap生成逻辑</a></li>
</ul>
<p>但是对于SourceMap数据中最重要的内容，记录着转换前后代码中变量/属性名的位置关系的mappings字段却没有介绍。这也是SourceMap的核心生成原理。那么它是如何关联位置的，以及如何生成和解析这段字符串，这篇文章将会一一解答。</p>
<h2 data-id="heading-1">创建SourceMap示例</h2>
<p>在正式的介绍之前，为了方便后面描述，首先让我们创建一个SourceMap的示例，后面会一直用这个例子。这里采用Terser生成，首先看下源代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/index.js</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> sum = jzplp + <span class="hljs-number">10</span>;
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
  <span class="hljs-keyword">throw</span> err;
}
</code></pre>
<p>然后执行命令，生成代码和SourceMap。注意这里为了展示两行场景，没有开启代码压缩。semicolons=false表示不采用分号，而使用换行符。</p>
<pre><code class="hljs language-sh" lang="sh">terser src/index.js --mangle --format semicolons=<span class="hljs-literal">false</span> -o dist.js --source-map url=dist.js.map
</code></pre>
<p>然后看下生成的结果：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// dist.js</span>
<span class="hljs-keyword">try</span>{<span class="hljs-keyword">const</span> o=jzplp+<span class="hljs-number">10</span>}<span class="hljs-keyword">catch</span>(o){<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(o)
<span class="hljs-keyword">throw</span> o}
<span class="hljs-comment">//# sourceMappingURL/* 防止报错 */=dist.js.map</span>

<span class="hljs-comment">// dist.js.map</span>
{
  <span class="hljs-string">"version"</span>: <span class="hljs-number">3</span>,
  <span class="hljs-string">"names"</span>: [<span class="hljs-string">"sum"</span>, <span class="hljs-string">"jzplp"</span>, <span class="hljs-string">"err"</span>, <span class="hljs-string">"console"</span>, <span class="hljs-string">"log"</span>],
  <span class="hljs-string">"sources"</span>: [<span class="hljs-string">"src/index.js"</span>],
  <span class="hljs-string">"mappings"</span>: <span class="hljs-string">"AAAA,IACE,MAAMA,EAAMC,MAAQ,EACtB,CAAE,MAAOC,GACPC,QAAQC,IAAIF;AACZ,MAAMA,CACR"</span>,
  <span class="hljs-string">"ignoreList"</span>: []
}
</code></pre>
<p>还有一个index.html，后面在浏览器中查看效果使用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./dist.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>最后还有一个解析SourceMap数据的工具，这里我们直接采用这篇文章中使用的解析SourceMap工具代码即可，<a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2025%2Fwebpack-sourcemap.html" target="_blank" title="https://jzplp.github.io/2025/webpack-sourcemap.html" ref="nofollow noopener noreferrer">Webpack中各种devtool配置的含义与SourceMap生成逻辑</a>。注意要修改下文件路径。</p>
<p>source-map中的行号从1开始，列号从0开始。但是我们为了符合SourceMap数据规范，后面所有的标号都从0开始，包括行号和列号。因此我们对代码稍作改造，后面都按照这个标准来计算。这里解析上面生成的SourceMap数据结果如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">0</span>  源代码行<span class="hljs-number">0</span>  列<span class="hljs-number">0</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">4</span>  源代码行<span class="hljs-number">1</span>  列<span class="hljs-number">2</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">10</span> 源代码行<span class="hljs-number">1</span>  列<span class="hljs-number">8</span>  源名称sum          源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">12</span> 源代码行<span class="hljs-number">1</span>  列<span class="hljs-number">14</span> 源名称jzplp        源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">18</span> 源代码行<span class="hljs-number">1</span>  列<span class="hljs-number">22</span> 源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">20</span> 源代码行<span class="hljs-number">2</span>  列<span class="hljs-number">0</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">21</span> 源代码行<span class="hljs-number">2</span>  列<span class="hljs-number">2</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">27</span> 源代码行<span class="hljs-number">2</span>  列<span class="hljs-number">9</span>  源名称err          源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">30</span> 源代码行<span class="hljs-number">3</span>  列<span class="hljs-number">2</span>  源名称console      源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">38</span> 源代码行<span class="hljs-number">3</span>  列<span class="hljs-number">10</span> 源名称log          源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">0</span>  列<span class="hljs-number">42</span> 源代码行<span class="hljs-number">3</span>  列<span class="hljs-number">14</span> 源名称err          源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">1</span>  列<span class="hljs-number">0</span>  源代码行<span class="hljs-number">4</span>  列<span class="hljs-number">2</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">1</span>  列<span class="hljs-number">6</span>  源代码行<span class="hljs-number">4</span>  列<span class="hljs-number">8</span>  源名称err          源文件<span class="hljs-symbol">:src/index</span>.js
生成代码行<span class="hljs-number">1</span>  列<span class="hljs-number">7</span>  源代码行<span class="hljs-number">5</span>  列<span class="hljs-number">0</span>  源名称-            源文件<span class="hljs-symbol">:src/index</span>.js
</code></pre>
<h2 data-id="heading-2">整理对应关系</h2>
<p>首先第一步，我们分析源代码和生成代码，将对应关系整理出来。先列一下对应关系拥有的字段，这些字段值对于SourceMap转换来说是必须的。</p>
<ul>
<li>源代码文件名</li>
<li>源代码行号</li>
<li>源代码列号</li>
<li>源代码标识符</li>
<li>生成代码文件名</li>
<li>生成代码行号</li>
<li>生成代码列号</li>
<li>生成代码标识符</li>
</ul>





















































































<table><thead><tr><th>源代码文件名</th><th>源代码标识符</th><th>源代码行号</th><th>源代码列号</th><th>生成代码文件名</th><th>生成代码标识符</th><th>生成代码行号</th><th>生成代码列号</th></tr></thead><tbody><tr><td>src/index.js</td><td>sum</td><td>1</td><td>8</td><td>dist.js</td><td>o</td><td>0</td><td>10</td></tr><tr><td>src/index.js</td><td>jzplp</td><td>1</td><td>14</td><td>dist.js</td><td>jzplp</td><td>0</td><td>12</td></tr><tr><td>src/index.js</td><td>err</td><td>2</td><td>9</td><td>dist.js</td><td>o</td><td>0</td><td>27</td></tr><tr><td>src/index.js</td><td>console</td><td>3</td><td>2</td><td>dist.js</td><td>console</td><td>0</td><td>30</td></tr><tr><td>src/index.js</td><td>log</td><td>3</td><td>10</td><td>dist.js</td><td>log</td><td>0</td><td>38</td></tr><tr><td>src/index.js</td><td>err</td><td>3</td><td>14</td><td>dist.js</td><td>o</td><td>0</td><td>42</td></tr><tr><td>src/index.js</td><td>err</td><td>4</td><td>8</td><td>dist.js</td><td>o</td><td>1</td><td>6</td></tr></tbody></table>
<p>可以看到这个表格和上面我们解析SourceMap数据得到的值是一样的。但是前面SourceMap中还多了一些没有标识符的对应关系数据，通过对比了解那是代码中其它内容的对应，这里我们忽略，按照标准的标识符关系来计算。此时我们创建一个JSON，存放我们生成的SourceMap数据。现在里面只有版本号：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>下面我们开始一步一步进行精简流程，目的是保证信息量不减少的情况下，减少最后形成的字符串长度。</p>
<h2 data-id="heading-3">文件名精简</h2>
<p>生成代码文件名这个字段无需表示，因为SourceMap数据是从生成文件的注释中指定的，那么SourceMap数据对应的生成文件就是这个指定的文件，无需标明。</p>
<p>然后是源代码文件名，这个我们用一个专门的数组存放，取名叫做sources。此时我们的SourceMap内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/index.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后记录表格中的源代码文件名变成数组的下标，从0开始。这时我们的表格变成了这样：</p>













































































<table><thead><tr><th>源代码文件名下标</th><th>源代码标识符</th><th>源代码行号</th><th>源代码列号</th><th>生成代码标识符</th><th>生成代码行号</th><th>生成代码列号</th></tr></thead><tbody><tr><td>0</td><td>sum</td><td>1</td><td>8</td><td>o</td><td>0</td><td>10</td></tr><tr><td>0</td><td>jzplp</td><td>1</td><td>14</td><td>jzplp</td><td>0</td><td>12</td></tr><tr><td>0</td><td>err</td><td>2</td><td>9</td><td>o</td><td>0</td><td>27</td></tr><tr><td>0</td><td>console</td><td>3</td><td>2</td><td>console</td><td>0</td><td>30</td></tr><tr><td>0</td><td>log</td><td>3</td><td>10</td><td>log</td><td>0</td><td>38</td></tr><tr><td>0</td><td>err</td><td>3</td><td>14</td><td>o</td><td>0</td><td>42</td></tr><tr><td>0</td><td>err</td><td>4</td><td>8</td><td>o</td><td>1</td><td>6</td></tr></tbody></table>
<h2 data-id="heading-4">代码标识符精简</h2>
<p>关于生成代码标识符，既然我们有了SourceMap数据指定的行列号，生成代码本身又是可见的，就可以从代码中定位到生成代码标识符，无需在表格中列出。</p>
<p>然后是源代码标识符，可以看到有很多重复出现的标识符，我们将这些标识符用一个专门的数组存放，取名叫做names。此时我们的SourceMap内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"names"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"sum"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"jzplp"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"err"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"console"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"log"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/index.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后再将表格中的源代码标识符简化为源代码标识符下标，可以看到现在表格中全都是数字了。</p>





































































<table><thead><tr><th>源代码文件名下标</th><th>源代码标识符下标</th><th>源代码行号</th><th>源代码列号</th><th>生成代码行号</th><th>生成代码列号</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>1</td><td>8</td><td>0</td><td>10</td></tr><tr><td>0</td><td>1</td><td>1</td><td>14</td><td>0</td><td>12</td></tr><tr><td>0</td><td>2</td><td>2</td><td>9</td><td>0</td><td>27</td></tr><tr><td>0</td><td>3</td><td>3</td><td>2</td><td>0</td><td>30</td></tr><tr><td>0</td><td>4</td><td>3</td><td>10</td><td>0</td><td>38</td></tr><tr><td>0</td><td>2</td><td>3</td><td>14</td><td>0</td><td>42</td></tr><tr><td>0</td><td>2</td><td>4</td><td>8</td><td>1</td><td>6</td></tr></tbody></table>
<h2 data-id="heading-5">表格转为字符串</h2>
<p>SourceMap数据中的mappings是一个字符串，但我们是一个表格，这一步我们将表格转化为字符串。将每一个对应关系用逗号分隔，对应关系中间的六个数字我们用|分隔。那么数据可以被转为这样：</p>
<pre><code class="hljs">0|0|1|8|0|10,0|1|1|14|0|12,0|2|2|9|0|27,0|3|3|2|0|30,0|4|3|10|0|38,0|2|3|14|0|42,0|2|4|8|1|6
</code></pre>
<p>为了便于生成代码查找，我们将生成代码的每行做分隔，中间用分号表示，例如 第一行,第一行;第二行;;第四行。这种方式可以去掉数据中的行号列。这样我们的数据可以被转为这样：</p>
<pre><code class="hljs language-ini" lang="ini">0|0|1|8|10,0|1|1|14|12,0|2|2|9|27,0|3|3|2|30,0|4|3|10|38,0|2|3|14|42<span class="hljs-comment">;0|2|4|8|6</span>
</code></pre>
<p>这份数据对应的表格表示如下：</p>





























































<table><thead><tr><th>源代码文件名下标</th><th>源代码标识符下标</th><th>源代码行号</th><th>源代码列号</th><th>生成代码列号</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>1</td><td>8</td><td>10</td></tr><tr><td>0</td><td>1</td><td>1</td><td>14</td><td>12</td></tr><tr><td>0</td><td>2</td><td>2</td><td>9</td><td>27</td></tr><tr><td>0</td><td>3</td><td>3</td><td>2</td><td>30</td></tr><tr><td>0</td><td>4</td><td>3</td><td>10</td><td>38</td></tr><tr><td>0</td><td>2</td><td>3</td><td>14</td><td>42</td></tr><tr><td>0</td><td>2</td><td>4</td><td>8</td><td>6</td></tr></tbody></table>
<h2 data-id="heading-6">数字转为增量计数</h2>
<p>从上面的字符串可以看到，行号列号数字是不断增长的。我们的代码非常短不明显，在大项目中行号列号可能会到数万行，这样还是会导致字符串长度过长。针对这个问题，可以使用增量计数的方式精简。</p>
<p>增量计数指的是，后面的数字以前一个数字为基准，只记录增加的数字。例如原始的数据为：[1, 3, 8, 6, 10]。我们将每一个数据减去前一个数据，就得到了增量数组：[1, 2, 5, -2, 4]。从例子中可以看到，如果这个数字相比于前一个数字是减小的，那么这个增量就是负值。</p>
<p>按照这个方式，我们将所有数据进一步精简：</p>





























































<table><thead><tr><th>源代码文件名下标增量</th><th>源代码标识符下标增量</th><th>源代码行号增量</th><th>源代码列号增量</th><th>生成代码列号增量</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>1</td><td>8</td><td>10</td></tr><tr><td>0</td><td>1</td><td>0</td><td>6</td><td>2</td></tr><tr><td>0</td><td>1</td><td>1</td><td>-5</td><td>15</td></tr><tr><td>0</td><td>1</td><td>1</td><td>-7</td><td>3</td></tr><tr><td>0</td><td>1</td><td>0</td><td>8</td><td>8</td></tr><tr><td>0</td><td>-2</td><td>0</td><td>4</td><td>4</td></tr><tr><td>0</td><td>0</td><td>1</td><td>-6</td><td>-38</td></tr></tbody></table>
<p>可以看到，虽然整体得到了精简，但是还有一些负值存在，尤其是当换行之后，列号会从很大的数字变为很少的数字，这时候可能会出现一个较大的负值。不过常规情况下，每换一行也只会出现这一次。然后我们将数据字段位置按照规范调整一下：</p>





























































<table><thead><tr><th>生成代码列号增量</th><th>源代码文件名下标增量</th><th>源代码行号增量</th><th>源代码列号增量</th><th>源代码标识符下标增量</th></tr></thead><tbody><tr><td>10</td><td>0</td><td>1</td><td>8</td><td>0</td></tr><tr><td>2</td><td>0</td><td>0</td><td>6</td><td>1</td></tr><tr><td>15</td><td>0</td><td>1</td><td>-5</td><td>1</td></tr><tr><td>3</td><td>0</td><td>1</td><td>-7</td><td>1</td></tr><tr><td>8</td><td>0</td><td>0</td><td>8</td><td>1</td></tr><tr><td>4</td><td>0</td><td>0</td><td>4</td><td>-2</td></tr><tr><td>-38</td><td>0</td><td>1</td><td>-6</td><td>0</td></tr></tbody></table>
<p>转成字符串形式如下：</p>
<pre><code class="hljs language-ini" lang="ini">10|0|1|8|0,2|0|0|6|1,15|0|1|-5|1,3|0|1|-7|1,8|0|0|8|1,4|0|0|4|-2<span class="hljs-comment">;-38|0|1|-6|0</span>
</code></pre>
<h2 data-id="heading-7">Base64VLQ编码</h2>
<h3 data-id="heading-8">VLQ编码</h3>
<p>在上一步中形成的字符串里，占用最多空间的是分隔符|，在这一步中的首要任务就是要去掉它。直接去掉肯定不行，例如15|0|1|-5|1，去掉之后是1501-51，我们根本不知道如何将数字分隔开。这时就需要采用VLQ编码来实现。</p>
<p>VLQ编码(Variable Length Quantity)是一种将任意大小的数字转化为连续二进制码的一种编码方式，默认是采用8位来编码。这里由于需要适配Base64编码，因此改为了6位编码。我们举三个例子介绍一下编码方式，数字3，数字-38，数字4268。</p>
<p>首先将这两个数字的绝对值转成二进制，然后正数在后面补0，负数在后面补1。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>     <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">11</span>             <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">110</span>
-<span class="hljs-number">38</span>   <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">100110</span>        <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">1001101</span>
<span class="hljs-number">4268</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">1000010101100</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">10000101011000</span>
</code></pre>
<p>然后再按照五个二进制位分为一组，不足五位的在前面补齐0。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>     <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">110</span>            <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00110</span>            <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00110</span>
-<span class="hljs-number">38</span>   <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">1001101</span>        <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">10</span> <span class="hljs-number">01101</span>         <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00010</span> <span class="hljs-number">01101</span>
<span class="hljs-number">4268</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">10000101011000</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">1000</span> <span class="hljs-number">01010</span> <span class="hljs-number">11000</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">01000</span> <span class="hljs-number">01010</span> <span class="hljs-number">11000</span>
</code></pre>
<p>然后将这几组的顺序倒转。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>     <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00110</span>              <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00110</span>
-<span class="hljs-number">38</span>   <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00010</span> <span class="hljs-number">01101</span>        <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">01101</span> <span class="hljs-number">00010</span>
<span class="hljs-number">4268</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">01000</span> <span class="hljs-number">01010</span> <span class="hljs-number">11000</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">11000</span> <span class="hljs-number">01010</span> <span class="hljs-number">01000</span>
</code></pre>
<p>然后就是去掉分隔符的关键步骤，将每一组最前面补一位：1表示还没结束，后面还有表示同一个数字的其他组；0表示这个数字在这一组已经结束了。到这里，VLQ编码就完成了。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>     <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">00110</span>              <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">000110</span>
-<span class="hljs-number">38</span>   <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">01101</span> <span class="hljs-number">00010</span>        <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">101101</span> <span class="hljs-number">000010</span>
<span class="hljs-number">4268</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">11000</span> <span class="hljs-number">01010</span> <span class="hljs-number">01000</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">111000</span> <span class="hljs-number">101010</span> <span class="hljs-number">001000</span>
</code></pre>
<h3 data-id="heading-9">Base64编码</h3>
<p>我们很久之前介绍过Base64编码，那时候是将3个字节转换为4个Base64编码值：因为 3<em>8=24, 6</em>4=24，位数相同正好能转换。但是这里由于我们在VLQ编码的时候就已经设置了6位，因此就不需要合并字节了，而是直接把一组二进制数转为对应字符即可：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/291d9e4be2f14a79830328e521785888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ryC5rWB55O2ano=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763997012&amp;x-signature=XzOiIR0WYR5A4c9aoKomXttNzrk%3D" alt="sourcemap-principle-1.png" loading="lazy"/>
表格来源于百度百科</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>     <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">000110</span>               <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">6</span>        <span class="hljs-punctuation">-&gt;</span> G
-<span class="hljs-number">38</span>   <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">101101</span> <span class="hljs-number">000010</span>        <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">45</span> <span class="hljs-number">2</span>     <span class="hljs-punctuation">-&gt;</span> tC
<span class="hljs-number">4268</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">111000</span> <span class="hljs-number">101010</span> <span class="hljs-number">001000</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">56</span> <span class="hljs-number">42</span> <span class="hljs-number">8</span>  <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">4</span>qI
</code></pre>
<p>通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.murzwin.com%2Fbase64vlq.html" target="_blank" title="https://www.murzwin.com/base64vlq.html" ref="nofollow noopener noreferrer">在线的BASE64VLQ转换工具</a>，得到的结果是一致的，证明我们的算法是正确的。</p>
<h3 data-id="heading-10">最终生成SourceMap</h3>
<p>由于这种编码方式可以通过第一个二进制位表示数字是否已经结束，因此不再需要分隔符了。上面前面三个数字的例子可以被表示为：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-number">3</span>|-<span class="hljs-number">38</span>|<span class="hljs-number">4268</span> <span class="hljs-punctuation">-&gt;</span> GtC4qI
</code></pre>
<p>我们用这个方式，将每个数字都进行编码，结果如下。这里分别列出了数字和对应的编码，中间用空格分隔：</p>





























































<table><thead><tr><th>生成代码列号增量</th><th>源代码文件名下标增量</th><th>源代码行号增量</th><th>源代码列号增量</th><th>源代码标识符下标增量</th></tr></thead><tbody><tr><td>10 U</td><td>0 A</td><td>1 C</td><td>8 Q</td><td>0 A</td></tr><tr><td>2 E</td><td>0 A</td><td>0 A</td><td>6 M</td><td>1 C</td></tr><tr><td>15 e</td><td>0 A</td><td>1 C</td><td>-5 L</td><td>1 C</td></tr><tr><td>3 G</td><td>0 A</td><td>1 C</td><td>-7 P</td><td>1 C</td></tr><tr><td>8 Q</td><td>0 A</td><td>0 A</td><td>8 Q</td><td>1 C</td></tr><tr><td>4 I</td><td>0 A</td><td>0 A</td><td>4 I</td><td>-2 F</td></tr><tr><td>-38 tC</td><td>0 A</td><td>1 C</td><td>-6 N</td><td>0 A</td></tr></tbody></table>
<p>转成字符串形式如下：</p>
<pre><code class="hljs language-css" lang="css">编码
U|<span class="hljs-selector-tag">A</span>|C|<span class="hljs-selector-tag">Q</span>|<span class="hljs-selector-tag">A</span>,E|<span class="hljs-selector-tag">A</span>|<span class="hljs-selector-tag">A</span>|M|C,e|<span class="hljs-selector-tag">A</span>|C|L|C,G|<span class="hljs-selector-tag">A</span>|C|<span class="hljs-selector-tag">P</span>|C,<span class="hljs-selector-tag">Q</span>|<span class="hljs-selector-tag">A</span>|<span class="hljs-selector-tag">A</span>|<span class="hljs-selector-tag">Q</span>|C,<span class="hljs-selector-tag">I</span>|<span class="hljs-selector-tag">A</span>|<span class="hljs-selector-tag">A</span>|<span class="hljs-selector-tag">I</span>|F;tC|<span class="hljs-selector-tag">A</span>|C|N|<span class="hljs-selector-tag">A</span>
去掉分隔符
UACQA,EAAMC,eACLC,GACPC,QAAQC,IAAIF;tCACNA
</code></pre>
<p>最后生成真正的SourceMap完整数据文件：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"names"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"sum"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"jzplp"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"err"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"console"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"log"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/index.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mappings"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"UACQA,EAAMC,eACLC,GACPC,QAAQC,IAAIF;tCACNA"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这里和Terser生成的SourceMap数据不同，因为它多生成了一些没有标识符的对应关系。如果对应关系中没有标识符，那么生成的结果中不存在对应数字即可，例如Terser生成的SourceMap数据中四个字母的数据，就肯定是没有标识符的。</p>
<h2 data-id="heading-11">浏览器测试</h2>
<p>使用自己手工生成的完整的SourceMap数据，替换掉Terser生成的SourceMap文件内容。然后在浏览器中打开查看效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/594b1fc72ce441ee9f1c2967853bd4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ryC5rWB55O2ano=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763997012&amp;x-signature=i7jDQjOefMMtbHZJVzdMxfGddTI%3D" alt="sourcemap-principle-2.png" loading="lazy"/></p>
<p>可以看到，报错位置成功的被转换为源文件index.js中的报错位置（浏览器行号列号都从1开始）。因此这说明我们手工生成的SourceMap是有效的。</p>
<h2 data-id="heading-12">参考</h2>
<ul>
<li>快速定位源码问题：SourceMap的生成/使用/文件格式与历史<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2025%2Fjs-sourcemap.html" target="_blank" title="https://jzplp.github.io/2025/js-sourcemap.html" ref="nofollow noopener noreferrer">jzplp.github.io/2025/js-sou…</a></li>
<li>Webpack中各种devtool配置的含义与SourceMap生成逻辑<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2025%2Fwebpack-sourcemap.html" target="_blank" title="https://jzplp.github.io/2025/webpack-sourcemap.html" ref="nofollow noopener noreferrer">jzplp.github.io/2025/webpac…</a></li>
<li>Terser 文档<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fterser.org%2F" target="_blank" title="https://terser.org/" ref="nofollow noopener noreferrer">terser.org/</a></li>
<li>sourcemap 这么讲，我彻底理解了<br/>
<a href="https://juejin.cn/post/7199895323187347514" target="_blank" title="https://juejin.cn/post/7199895323187347514">juejin.cn/post/719989…</a></li>
<li>Base64编码详解与URL安全的Base64编码<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fjzplp.github.io%2F2021%2Fbase64-safe.html" target="_blank" title="https://jzplp.github.io/2021/base64-safe.html" ref="nofollow noopener noreferrer">jzplp.github.io/2021/base64…</a></li>
<li>JavaScript Source Map 详解
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2013%2F01%2Fjavascript_source_map.html" target="_blank" title="https://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html" ref="nofollow noopener noreferrer">www.ruanyifeng.com/blog/2013/0…</a></li>
<li>BASE64 VLQ CODEC (COder/DECoder) AND SOURCEMAP V3 / ECMA-426 MAPPINGS PARSER<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.murzwin.com%2Fbase64vlq.html" target="_blank" title="https://www.murzwin.com/base64vlq.html" ref="nofollow noopener noreferrer">www.murzwin.com/base64vlq.h…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose Navigation3：返回栈管理、大屏适配与自定义策略]]></title>    <link>https://juejin.cn/post/7573506713867288627</link>    <guid>https://juejin.cn/post/7573506713867288627</guid>    <pubDate>2025-11-17T15:08:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573506713867288627" data-draft-id="7572776177691049993" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose Navigation3：返回栈管理、大屏适配与自定义策略"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-17T15:08:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose Navigation3：返回栈管理、大屏适配与自定义策略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:08:57.000Z" title="Mon Nov 17 2025 15:08:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Navigation3 相比 Navigation2 来说，区别主要有两点：</p>
<ol>
<li>导航返回栈从由 Navigation 内部控制，变为由开发者控制。</li>
<li>Navigation2 只适用于单页模式，一个屏幕只能显示一个路由对应的页面。而 Navigation3 可适配大屏。</li>
</ol>
<h2 data-id="heading-0">添加依赖</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">plugins {
    <span class="hljs-comment">// Kotlin serialization plugin</span>
    id(<span class="hljs-string">"org.jetbrains.kotlin.plugin.serialization"</span>) version <span class="hljs-string">"2.0.21"</span>
}

dependencies {
    <span class="hljs-comment">// Navigation3</span>
    implementation(<span class="hljs-string">"androidx.navigation3:navigation3-runtime:1.0.0-rc01"</span>)
    implementation(<span class="hljs-string">"androidx.navigation3:navigation3-ui:1.0.0-rc01"</span>)

    <span class="hljs-comment">// Navigation3 Adaptive</span>
    implementation(<span class="hljs-string">"androidx.compose.material3.adaptive:adaptive-navigation3:1.3.0-alpha03"</span>)

    <span class="hljs-comment">// Kotlin Serialization</span>
    implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-serialization-core:1.6.0"</span>)

    <span class="hljs-comment">// Navigation3 ViewModel</span>
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-navigation3:2.10.0-rc01"</span>)
}
</code></pre>
<p><code>compileSdkVersion</code> 需要 36 以上：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">android {
    compileSdk = <span class="hljs-number">36</span>
}
</code></pre>
<h2 data-id="heading-1">简单用法</h2>
<p>我们以商品列表页和商品详情页为例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> ProductList
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductDetail</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> description: String
)

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ProductList</span><span class="hljs-params">(
    products: <span class="hljs-type">List</span>&lt;<span class="hljs-type">ProductDetail</span>&gt;,
    onProductClick: (<span class="hljs-type">ProductDetail</span>) -&gt; <span class="hljs-type">Unit</span>,
    modifier: <span class="hljs-type">Modifier</span> = Modifier
)</span></span> {
    LazyColumn(modifier = modifier.fillMaxSize()) {
        items(products) { product -&gt;
            Text(
                text = product.name,
                modifier = Modifier
                    .fillMaxSize()
                    .clickable { onProductClick(product) }
                    .padding(<span class="hljs-number">16.</span>dp)
            )
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ProductDetail</span><span class="hljs-params">(
    product: <span class="hljs-type">ProductDetail</span>,
    modifier: <span class="hljs-type">Modifier</span> = Modifier
)</span></span> {
    Column(
        modifier = modifier
            .fillMaxSize()
            .padding(<span class="hljs-number">16.</span>dp),
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Text(
            text = product.name,
            fontWeight = FontWeight.Bold,
            fontSize = <span class="hljs-number">30.</span>sp
        )
        Column(
            modifier = Modifier
                .fillMaxSize()
                .weight(<span class="hljs-number">1f</span>),
            verticalArrangement = Arrangement.Center,
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Text(
                text = product.description,
                fontSize = <span class="hljs-number">26.</span>sp
            )
        }
    }
}
</code></pre>
<p>注意：<code>ProductDetail</code> 和 <code>ProductList</code> 有两重意思：既封装了页面的数据，又作为页面的导航节点。</p>
<p>然后是 <code>MyApp</code> 函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        enableEdgeToEdge()
        setContent {
            ComposeNavigation3TestTheme {
                MyApp()
            }
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyApp</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier)</span></span> {
    <span class="hljs-comment">// 返回栈，初始页面是商品列表</span>
    <span class="hljs-comment">// Navigation3 会自动展示栈顶页面</span>
    <span class="hljs-keyword">val</span> backStack = remember { mutableStateListOf&lt;Any&gt;(ProductList) }
    NavDisplay( <span class="hljs-comment">// 入口函数</span>
        backStack = backStack, <span class="hljs-comment">// backStack参数是导航返回栈</span>
        onBack = { <span class="hljs-comment">// onBack回调是返回的监听</span>
            <span class="hljs-comment">// 返回逻辑为：移除栈顶元素</span>
            backStack.removeLastOrNull()
        },
        entryProvider = { key -&gt; <span class="hljs-comment">// entryProvider回调用于定义每个页面的NavEntry</span>
            <span class="hljs-keyword">when</span> (key) {
                <span class="hljs-comment">// 商品列表页面</span>
                <span class="hljs-keyword">is</span> ProductList -&gt; NavEntry(key) {
                    <span class="hljs-keyword">val</span> products = mutableListOf&lt;ProductDetail&gt;()
                    repeat(<span class="hljs-number">30</span>) {
                        products.add(ProductDetail(<span class="hljs-string">"Product <span class="hljs-variable">$it</span>"</span>, <span class="hljs-string">"Description of Product <span class="hljs-variable">$it</span>"</span>))
                    }
                    ProductList(
                        products = products,
                        onProductClick = { product -&gt;
                            <span class="hljs-comment">// 跳转到商品详情页面</span>
                            backStack.add(ProductDetail(product.name, product.description))
                        },
                        modifier
                    )
                }
                <span class="hljs-comment">// 商品详情页面</span>
                <span class="hljs-keyword">is</span> ProductDetail -&gt; NavEntry(key) {
                    ProductDetail(
                        product = key,
                        modifier
                    )
                }

                <span class="hljs-keyword">else</span> -&gt; error(<span class="hljs-string">"Unknown key: <span class="hljs-variable">$key</span>"</span>)
            }
        }
    )
}
</code></pre>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56edff5cc8ce4dfa9d5245af97722608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763996936&amp;x-signature=sexqMGLp9RLuuLnk%2FehteOqwBwA%3D" alt="Screen_recording_20251117_162824.gif" width="50%" loading="lazy"/>
<p>可以看到，商品列表页向商品详情页传递数据非常容易，只需将数据加入到返回栈，详情页自然能在 <code>entryProvider</code> 回调中收到。</p>
<h2 data-id="heading-2">保存和管理导航状态</h2>
<p>现在，我们旋转屏幕，会导致 Activity 的重建，导致返回栈被清空。</p>
<p>解决方法也很简单：只需给每一个 data class 加上 <code>@Serializable</code> 注解，然后实现 <code>NavKey</code> 接口。</p>
<blockquote>
<p>状态恢复要求数据是可序列化的</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> ProductList : NavKey

<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductDetail</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> description: String
) : NavKey
</code></pre>
<p>再将返回栈的声明改为 <code>val backStack = rememberNavBackStack(ProductList)</code> 即可。</p>
<h2 data-id="heading-3">大屏适配</h2>
<p>Navigation 3 中的场景（<code>Scene</code>）解决了大屏适配的问题，它可以显示一个或多个 <code>NavEntry</code> 实例，也就是同时显示多个 <code>NavEntry</code> 页面。</p>
<p>我们可以给 <code>NavDisplay</code> 函数传入一个 <code>sceneStrategy</code> 参数，来指定场景策略。默认策略是 <code>SinglePaneSceneStrategy</code>，单页场景模式。</p>
<p>我们来使用 <code>ListDetailSceneStrategy</code>，列表详情页面场景策略，它会自动根据当前屏幕大小进行页面分配。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalMaterial3AdaptiveApi::class)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyApp</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier)</span></span> {
    <span class="hljs-keyword">val</span> backStack = rememberNavBackStack(ProductList)
    <span class="hljs-comment">// 创建ListDetailSceneStrategy实例</span>
    <span class="hljs-keyword">val</span> listDetailStrategy = rememberListDetailSceneStrategy&lt;Any&gt;()
    NavDisplay(
        backStack = backStack,
        onBack = {
            backStack.removeLastOrNull()
        },
        sceneStrategy = listDetailStrategy, <span class="hljs-comment">// 使用ListDetailSceneStrategy</span>
        entryProvider = { key -&gt;
            <span class="hljs-keyword">when</span> (key) {
                <span class="hljs-keyword">is</span> ProductList -&gt; NavEntry(
                    key = key,
                    metadata = ListDetailSceneStrategy.listPane( <span class="hljs-comment">// 修改处</span>
                        detailPlaceholder = {
                            Column(
                                modifier = Modifier
                                    .fillMaxSize(),
                                verticalArrangement = Arrangement.Center,
                                horizontalAlignment = Alignment.CenterHorizontally
                            ) {
                                Text(<span class="hljs-string">"Choose a product from the list"</span>, fontSize = <span class="hljs-number">26.</span>sp)
                            }
                        }
                    )
                ) {
                    <span class="hljs-keyword">val</span> products = mutableListOf&lt;ProductDetail&gt;()
                    repeat(<span class="hljs-number">30</span>) {
                        products.add(ProductDetail(<span class="hljs-string">"Product <span class="hljs-variable">$it</span>"</span>, <span class="hljs-string">"Description of Product <span class="hljs-variable">$it</span>"</span>))
                    }
                    ProductList(
                        products = products,
                        onProductClick = { product -&gt;
                            backStack.add(ProductDetail(product.name, product.description))
                        },
                        modifier
                    )
                }

                <span class="hljs-keyword">is</span> ProductDetail -&gt; NavEntry(
                    key = key,
                    metadata = ListDetailSceneStrategy.detailPane() <span class="hljs-comment">// 修改处</span>
                ) {
                    ProductDetail(
                        product = key,
                        modifier
                    )
                }

                <span class="hljs-keyword">else</span> -&gt; error(<span class="hljs-string">"Unknown key: <span class="hljs-variable">$key</span>"</span>)
            }
        }
    )
}
</code></pre>
<p>我们给列表页和详情页的 <code>NavEntry</code> 都传入了 <code>metadata</code> 参数，通过 <code>listPane()</code> 和 <code>detailPane()</code> 来告知了 <code>Navigation</code> 列表页和详情页的 <code>NavEntry</code> 分别是哪个。</p>
<p>我们还给 <code>listPane()</code> 传入了 <code>detailPlaceholder</code>（详情页占位符）参数，这样未选中列表项时，会默认显示占位的内容。</p>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb3fe9416eaa48aeb53170cbb30c884e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763996936&amp;x-signature=Tg%2B0MjeKfgn7e4u05ANVZlryvWQ%3D" alt="Screen_recording_20251117_183726.gif" width="100%" loading="lazy"/>
<h2 data-id="heading-4">自定义场景</h2>
<p>为了完成自定义场景，我们先来简单看看内置的单页模式场景的源码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SinglePaneScene</span>&lt;<span class="hljs-type">T : Any</span>&gt;(
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> key: Any, <span class="hljs-comment">// 唯一标识符，用于动画</span>
    <span class="hljs-keyword">val</span> entry: NavEntry&lt;T&gt;, <span class="hljs-comment">// 当前页的 NavEntry</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> previousEntries: List&lt;NavEntry&lt;T&gt;&gt;,  <span class="hljs-comment">// 添加当前页之前的 NavEntry 列表，用于预测性返回动画</span>
) : Scene&lt;T&gt; { <span class="hljs-comment">// 实现 Scene 接口</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> entries: List&lt;NavEntry&lt;T&gt;&gt; = listOf(entry) <span class="hljs-comment">// 当前场景需要显示的 NavEntry</span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> content: <span class="hljs-meta">@Composable</span> () -&gt; <span class="hljs-built_in">Unit</span> = { entry.Content() } <span class="hljs-comment">// 当前场景的内容</span>

    <span class="hljs-comment">// equals、hashCode、toString 方法</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SinglePaneSceneStrategy</span>&lt;<span class="hljs-type">T : Any</span>&gt; : <span class="hljs-type">SceneStrategy</span>&lt;<span class="hljs-type">T</span>&gt; {
    
    <span class="hljs-comment">// 返回场景类实例，它决定了最终界面的显示内容</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> SceneStrategyScope<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">calculateScene</span><span class="hljs-params">(entries: <span class="hljs-type">List</span>&lt;<span class="hljs-type">NavEntry</span>&lt;<span class="hljs-type">T</span>&gt;&gt;)</span></span>: Scene&lt;T&gt; {
        <span class="hljs-keyword">return</span> SinglePaneScene(
            key = entries.last().contentKey,
            entry = entries.last(),
            previousEntries = entries.dropLast(<span class="hljs-number">1</span>),
        )
    }
}
</code></pre>
<p>简单了解过后，我们来完成双页模式场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DoublePaneScene</span>&lt;<span class="hljs-type">T : Any</span>&gt;(
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> key: Any,
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> previousEntries: List&lt;NavEntry&lt;T&gt;&gt;,
    <span class="hljs-keyword">val</span> startEntry: NavEntry&lt;T&gt;, <span class="hljs-comment">// 左侧面板导航条目</span>
    <span class="hljs-keyword">val</span> endEntry: NavEntry&lt;T&gt; <span class="hljs-comment">// 右侧面板导航条目</span>
) : Scene&lt;T&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> entries: List&lt;NavEntry&lt;T&gt;&gt; = listOf(startEntry, endEntry)

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> content: <span class="hljs-meta">@Composable</span> (() -&gt; <span class="hljs-built_in">Unit</span>) = {
        <span class="hljs-comment">// 获取窗口大小信息</span>
        <span class="hljs-keyword">val</span> windowSizeClass = currentWindowAdaptiveInfo().windowSizeClass
        <span class="hljs-comment">// 如果宽度大于等于中屏，则显示双列</span>
        <span class="hljs-keyword">if</span> (windowSizeClass.isWidthAtLeastBreakpoint(WIDTH_DP_MEDIUM_LOWER_BOUND)) {
            Row(modifier = Modifier.fillMaxSize()) {
                Column(modifier = Modifier.weight(<span class="hljs-number">0.22f</span>)) {
                    startEntry.Content()
                }
                Column(modifier = Modifier.weight(<span class="hljs-number">0.78f</span>)) {
                    endEntry.Content()
                }
            }
        } <span class="hljs-keyword">else</span> {
            endEntry.Content()
        }
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> START_PANE_KEY = <span class="hljs-string">"StartPane"</span>
        <span class="hljs-keyword">internal</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> END_PANE_KEY = <span class="hljs-string">"EndPane"</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startPane</span><span class="hljs-params">()</span></span> = mapOf(START_PANE_KEY to <span class="hljs-literal">true</span>)
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">endPane</span><span class="hljs-params">()</span></span> = mapOf(END_PANE_KEY to <span class="hljs-literal">true</span>)
    }
}
</code></pre>
<p>首先，我们接收了两个 <code>NavEntry</code> 实例，待会将会传递进来，分别代表了左侧和右侧的页面。</p>
<p>然后在 <code>content</code> 中，完成了页面的布局：如果是大屏设备，则双列显示；否则，只显示右侧页面。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DoublePaneSceneStrategy</span>&lt;<span class="hljs-type">T : Any</span>&gt; : <span class="hljs-type">SceneStrategy</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> SceneStrategyScope<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">calculateScene</span><span class="hljs-params">(entries: <span class="hljs-type">List</span>&lt;<span class="hljs-type">NavEntry</span>&lt;<span class="hljs-type">T</span>&gt;&gt;)</span></span>: Scene&lt;T&gt;? {
        <span class="hljs-comment">// 过滤出拥有特定元数据的 NavEntry</span>
        <span class="hljs-keyword">val</span> startPane =
            entries.filter { it.metadata.containsKey(DoublePaneScene.START_PANE_KEY) }
        <span class="hljs-keyword">val</span> endPane =
            entries.filter { it.metadata.containsKey(DoublePaneScene.END_PANE_KEY) }
        <span class="hljs-keyword">if</span> (startPane.isEmpty() || endPane.isEmpty()) {
            <span class="hljs-comment">// 不同时存在两个面板，说明当前场景策略无法处理</span>
            <span class="hljs-comment">// 默认会被单页模式场景策略处理</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        }

        <span class="hljs-keyword">val</span> startEntry = startPane.last()
        <span class="hljs-keyword">val</span> endEntry = endPane.last()
        <span class="hljs-comment">// 构建一个 Key 用于标识场景</span>
        <span class="hljs-keyword">val</span> sceneKey = Pair(startEntry, endEntry)
        <span class="hljs-keyword">return</span> DoublePaneScene(
            key = sceneKey,
            previousEntries = entries.dropLast(<span class="hljs-number">1</span>),
            startEntry = startEntry,
            endEntry = endEntry
        )
    }

}
</code></pre>
<p>我们找到特定的两个 <code>NavEntry</code>（待会使用时，需要将指定的元数据传入），然后创建 <code>DoublePaneScene</code> 实例返回即可。</p>
<p>具体使用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyApp</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier)</span></span> {
    <span class="hljs-keyword">val</span> backStack = rememberNavBackStack(ProductList)
    NavDisplay(
        backStack = backStack,
        onBack = {
            backStack.removeLastOrNull()
        },
        sceneStrategy = DoublePaneSceneStrategy(), <span class="hljs-comment">// 使用DoublePaneScene</span>
        entryProvider = { key -&gt;
            <span class="hljs-keyword">when</span> (key) {
                <span class="hljs-keyword">is</span> ProductList -&gt; NavEntry(
                    key = key,
                    <span class="hljs-comment">// 传递特定元数据</span>
                    metadata = DoublePaneScene.startPane()
                ) {
                    <span class="hljs-keyword">val</span> products = mutableListOf&lt;ProductDetail&gt;()
                    repeat(<span class="hljs-number">30</span>) {
                        products.add(ProductDetail(<span class="hljs-string">"Product <span class="hljs-variable">$it</span>"</span>, <span class="hljs-string">"Description of Product <span class="hljs-variable">$it</span>"</span>))
                    }
                    ProductList(
                        products = products,
                        onProductClick = { product -&gt;
                            backStack.add(ProductDetail(product.name, product.description))
                        },
                        modifier
                    )
                }

                <span class="hljs-keyword">is</span> ProductDetail -&gt; NavEntry(
                    key = key,
                    <span class="hljs-comment">// 传递特定元数据</span>
                    metadata = DoublePaneScene.endPane()
                ) {
                    ProductDetail(
                        product = key,
                        modifier
                    )
                }

                <span class="hljs-keyword">else</span> -&gt; error(<span class="hljs-string">"Unknown key: <span class="hljs-variable">$key</span>"</span>)
            }
        }
    )
}
</code></pre>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb6ca4e66ab4ecd98d06f17a27e5ba8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763996936&amp;x-signature=i%2BJXN0irWkCj99CzlfGC8qttvmU%3D" alt="Screen_recording_20251117_192709.gif" width="100%" loading="lazy"/>
<p>可以看到，每次点击列表项时，左侧的列表页都会“闪烁”一下。并且按下返回键时，会回到上一个详情页。</p>
<p>这与官方的 <code>ListDetailSceneStrategy</code> 效果并不同，这是因为官方的 <code>ListDetailSceneStrategy</code> 会安装自己的 <code>BackHandler</code>，在大屏幕设备上，按下返回键会直接清空堆栈。而我们的 <code>DoublePaneSceneStrategy</code> 只负责显示，并不会有额外的优化。</p>
<p>“闪烁”是因为 <code>NavDisplay</code> 依靠 <code>sceneKey</code> 来判断是否是同一个场景，当我们点击了新的列表项后，<code>NavDisplay</code> 发现场景已经变化，会销毁并重建整个场景，而这个过程就是我们看到的“闪烁”。</p>
<h2 data-id="heading-5">参考</h2>
<p>参考郭霖大佬的博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0-43B2VbQHSYxABXckJJbQ" target="_blank" title="https://mp.weixin.qq.com/s/0-43B2VbQHSYxABXckJJbQ" ref="nofollow noopener noreferrer">写给初学者的Jetpack Compose教程，Navigation 3</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[项目太大，AI无法理解？试试这3种思路]]></title>    <link>https://juejin.cn/post/7573525634212626475</link>    <guid>https://juejin.cn/post/7573525634212626475</guid>    <pubDate>2025-11-17T15:12:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525634212626475" data-draft-id="7573468493570474020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="项目太大，AI无法理解？试试这3种思路"/> <meta itemprop="keywords" content="AI编程,人工智能"/> <meta itemprop="datePublished" content="2025-11-17T15:12:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            项目太大，AI无法理解？试试这3种思路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:12:00.000Z" title="Mon Nov 17 2025 15:12:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周六的活动中交流了一个问题：<strong>如何解决 AI 在大项目理解中的瓶颈</strong>。</p>
<p>活动结束后，我一直在思考，这个场景确实是个非常普遍的痛点，很可能会造成原本很好的工具无法使用。</p>
<p>于是，我决定好好的研究下，今天，就把目前的思考内容和大家分享下，抛砖引玉。</p>
<h2 data-id="heading-0">处理大项目的思路</h2>
<p>首先，有一个背景，我们需要达成一致。</p>
<p>在超级模型出现前，将整个项目代码一次性塞入 <code>AI</code> 中是不现实，现有思路的关键都在于<strong>如何更加精确、动态地找到回答问题所需的代码片段</strong>。</p>
<p>整理了如下几个思路：</p>
<ul>
<li>人工划分降低理解难度</li>
<li>借助工具实现代码图谱</li>
<li>Claude Skills按需加载上下文</li>
</ul>
<p>这几个思路并不是完全并列，而是可以<strong>同时使用，相互结合</strong>的。</p>
<h2 data-id="heading-1">人工划分降低理解难度</h2>
<p>最难的，也是最简单的思路。</p>
<p>“<strong>难</strong>”在于这个过程需要人工处理，工作量比较大；“<strong>简单</strong>”在于不需要额外的知识辅助，也不需要引入新的工具。</p>
<ul>
<li>可以通过分层的方式，比如：服务层、业务层、数据层等。</li>
<li>可以通过分模块的方式，比如：合同模块、支付模块、日志模块等。</li>
</ul>
<p>所有的措施都是为了缩小检索空间，只要划分后的上下文，AI 可以“吃”下，那就可以了。</p>
<h2 data-id="heading-2">借助工具实现代码图谱</h2>
<p>上面的思路估计很多人会望而却步，毕竟，大项目最难着手的就是分析。</p>
<p>这时候，还有另一种思路，借助专门的“<strong>代码图谱</strong>”工具进行分析。</p>
<p>“代码图谱”可以理解为一种专门的“知识图谱”，通过解析 <code>AST</code>、<code>调用关系</code>和<code>数据依赖</code>，构建项目级的语义索引，支持基于<strong>结构的精准检索</strong>。</p>
<p>相比纯向量检索，代码图谱更能捕捉函数调用、继承等结构化关系，适合深度理解。</p>
<p>我找到了一个比较不错的落地工具：<code>Sourcegraph Cody</code>，支持 <code>VS Code</code> 系列插件安装。</p>
<p>目前尚未来得及实测，大家感兴趣可以先行尝试。</p>
<h2 data-id="heading-3">按需加载上下文</h2>
<p>“代码图谱”已经提供了一个比较智能的上下文自动划分思路，但这个思路更多的解决重点其实是在单次 AI 对话的上下文上。</p>
<p>如果某个任务特别复杂，单次 AI 对话无法解决，需要多次交互，那上下文依然会出现无法满足的情况。</p>
<p>这时候就需要“按需加载上下文”这种思路去进一步优化了。</p>
<p>这一思路主要是引入一个<strong>动态决策</strong>的智能体，它先将复杂任务拆解为的多个步骤，并针对<strong>每一步的请求内容</strong>，动态分析<strong>所需的上下文</strong>（在代码图谱基础上，再次按需索取），然后循环迭代，直至计划执行完毕。</p>
<p>其实就是 <code>Claude Skills</code> 的设计思路，可以在 <code>Plan</code> 阶段生成的文档<strong>计划</strong>中，支持自动/手动<strong>配置相关上下文</strong>。</p>
<p>但是，目前尚未找到完美的落地方案。如果你有合适推荐，欢迎留言指导。</p>
<h2 data-id="heading-4">结语</h2>
<p>以上就是这两天了解到的<strong>AI 理解大项目</strong>的几个思路，可以结合起来，逐步应用。</p>
<p>你遇到大项目理解难题时，是怎么破局的？欢迎留言交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze Studio 源码分析（一）后端架构及数据流分析]]></title>    <link>https://juejin.cn/post/7573468493570506788</link>    <guid>https://juejin.cn/post/7573468493570506788</guid>    <pubDate>2025-11-17T15:21:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493570506788" data-draft-id="7573511426868133907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coze Studio 源码分析（一）后端架构及数据流分析"/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2025-11-17T15:21:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DevYK"/> <meta itemprop="url" content="https://juejin.cn/user/3368559355637566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coze Studio 源码分析（一）后端架构及数据流分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559355637566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DevYK
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:21:57.000Z" title="Mon Nov 17 2025 15:21:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ul>
<li><a href="#1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0" title="#1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">1. 项目概述</a></li>
<li><a href="#2-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" title="#2-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">2. 整体架构设计</a></li>
<li><a href="#3-%E6%A0%B8%E5%BF%83%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84" title="#3-%E6%A0%B8%E5%BF%83%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84">3. 核心分层架构</a></li>
<li><a href="#4-%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E6%A0%88" title="#4-%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E6%A0%88">4. 关键技术栈</a></li>
<li><a href="#5-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90" title="#5-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90">5. 目录结构分析</a></li>
<li><a href="#6-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3" title="#6-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3">6. 核心模块详解</a></li>
<li><a href="#7-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90%E7%AE%80%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A4%BA%E4%BE%8B" title="#7-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90%E7%AE%80%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A4%BA%E4%BE%8B">7. 数据流分析：简单工作流示例</a></li>
<li><a href="#8-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" title="#8-%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">8. 总结与展望</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">1. 项目概述</h2>
<h3 data-id="heading-2">1.1 Coze Studio 简介</h3>
<p>Coze Studio 是一个开源的 AI Agent 开发平台，提供从开发到部署的全流程支持。后端采用 <strong>Golang</strong> 开发，前端使用 <strong>React + TypeScript</strong>，整体架构基于<strong>微服务</strong>和**领域驱动设计（DDD）**原则构建。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li>🎯 提供 AI Agent 开发所需的核心技术：Prompt、RAG、Plugin、Workflow</li>
<li>🚀 低代码/无代码的可视化开发工具</li>
<li>🔧 完整的模型管理、知识库、MCP(<code>在 coze-studio-plus 中实现了</code>)、插件系统</li>
<li>📊 强大的 Workflow 编排引擎</li>
<li>🌐 RESTful API 和 SDK 支持</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5970d1ecab44b49c09e4d87b9b9eaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGV2WUs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763997717&amp;x-signature=HDvz85uFjpHQ7N7WzHHCZzdC0qs%3D" alt="20251117225049" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 技能点</h3>





































<table><thead><tr><th>技术</th><th>描述</th></tr></thead><tbody><tr><td><strong>Golang</strong></td><td>高性能、并发友好、部署简单</td></tr><tr><td><strong>Hertz</strong></td><td>CloudWeGo 高性能 HTTP 框架</td></tr><tr><td><strong>Eino</strong></td><td>AI Workflow 运行时引擎,类似于 python 的 LangGraph</td></tr><tr><td><strong>DDD</strong></td><td>复杂业务逻辑的最佳实践</td></tr><tr><td><strong>MySQL</strong></td><td>主数据存储</td></tr><tr><td><strong>Redis</strong></td><td>缓存和 Checkpoint 存储</td></tr><tr><td><strong>Elasticsearch</strong></td><td>搜索和知识库检索</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">2. 整体架构设计</h2>
<h3 data-id="heading-5">2.1 宏观架构图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph L7["第7层：客户端层 Client Layer"]
        direction LR
        A["Web Frontend&lt;br/&gt;React + TypeScript&lt;br/&gt;Web前端界面"]
        B["API/SDK Client&lt;br/&gt;API和SDK客户端&lt;br/&gt;第三方系统集成"]
    end
    
    subgraph L6["第6层：接入层 API Layer"]
        direction LR
        C["Hertz HTTP Server&lt;br/&gt;:8888&lt;br/&gt;HTTP服务器，接收请求"]
        D["Middleware Stack&lt;br/&gt;Auth/Log/CORS&lt;br/&gt;中间件栈：认证/日志/跨域"]
        E["Router&lt;br/&gt;API Routes&lt;br/&gt;路由分发，API路由注册"]
    end
    
    subgraph L5["第5层：应用服务层 Application Layer"]
        direction LR
        F1["WorkflowApp&lt;br/&gt;工作流应用服务&lt;br/&gt;编排工作流业务流程"]
        F2["SingleAgentApp&lt;br/&gt;单智能体应用服务&lt;br/&gt;管理Agent创建和执行"]
        F3["PluginApp&lt;br/&gt;插件应用服务&lt;br/&gt;管理插件生命周期"]
        F4["KnowledgeApp&lt;br/&gt;知识库应用服务&lt;br/&gt;管理知识库CRUD"]
        F5["ConversationApp&lt;br/&gt;对话应用服务&lt;br/&gt;管理对话会话"]
    end
    
    subgraph L4["第4层：领域层 Domain Layer"]
        direction LR
        G1["Workflow Domain&lt;br/&gt;工作流领域服务&lt;br/&gt;核心工作流业务逻辑"]
        G2["Agent Domain&lt;br/&gt;智能体领域服务&lt;br/&gt;Agent核心业务逻辑"]
        G3["Plugin Domain&lt;br/&gt;插件领域服务&lt;br/&gt;插件核心业务逻辑"]
        G4["Knowledge Domain&lt;br/&gt;知识库领域服务&lt;br/&gt;知识库核心逻辑"]
    end
    
    subgraph L3["第3层：跨域服务层 Cross Domain Layer"]
        direction LR
        H1["Workflow Cross&lt;br/&gt;工作流跨域服务"]
        H2["Message Cross&lt;br/&gt;消息跨域服务"]
        H3["Database Cross&lt;br/&gt;数据库跨域服务"]
        H4["Plugin Cross&lt;br/&gt;插件跨域服务"]
    end
    
    subgraph L2["第2层：基础设施层 Infrastructure Layer"]
        direction LR
        I1[("MySQL&lt;br/&gt;关系型数据库")]
        I2[("Redis&lt;br/&gt;内存数据库")]
        I3[("Elasticsearch&lt;br/&gt;搜索引擎")]
        I4["OSS&lt;br/&gt;对象存储"]
        I5["EventBus&lt;br/&gt;事件总线"]
        I6["CodeRunner&lt;br/&gt;代码执行器"]
    end
    
    subgraph L1["第1层：外部服务层 External Services"]
        direction LR
        J["LLM Providers&lt;br/&gt;OpenAI/Claude/..."]
        K["Embedding Service&lt;br/&gt;向量嵌入服务"]
    end
    
    %% 客户端到接入层
    A --&gt; C
    B --&gt; C
    
    %% 接入层内部流转（顺序执行）
    C --&gt; D
    D --&gt; E
    
    %% 接入层到应用服务层（路由分发）
    E --&gt; F1
    E --&gt; F2
    E --&gt; F3
    E --&gt; F4
    E --&gt; F5
    
    %% 应用服务层到领域层（主要调用关系，对齐减少交叉）
    F1 --&gt; G1
    F2 --&gt; G2
    F3 --&gt; G3
    F4 --&gt; G4
    F5 --&gt; G1
    F5 --&gt; G2
    
    %% 领域层到跨域服务层（虚线表示间接调用）
    G1 -.-&gt; H1
    G2 -.-&gt; H2
    G3 -.-&gt; H4
    G4 -.-&gt; H3
    
    %% 跨域服务层到基础设施层
    H1 --&gt; I1
    H2 --&gt; I2
    H3 --&gt; I1
    H4 --&gt; I1
    
    %% 领域层直接访问基础设施（主要依赖，简化连接）
    G1 --&gt; I2
    G1 --&gt; I5
    G4 --&gt; I3
    G3 --&gt; I4
    G3 --&gt; I6
    
    %% 领域层到外部服务
    G1 --&gt; J
    G2 --&gt; J
    G4 --&gt; K
    
    %% 样式
    style L7 fill:#e1f5ff
    style L6 fill:#fff4e1
    style L5 fill:#e8f5e9
    style L4 fill:#f3e5f5
    style L3 fill:#fce4ec
    style L2 fill:#fff9c4
    style L1 fill:#f5f5f5
</code></pre>
<h3 data-id="heading-6">2.2 架构特点分析</h3>







































































<table><thead><tr><th>层级/模块</th><th>职责（简述）</th><th>依赖关系（→ 表示依赖）</th><th>主要联系方式</th></tr></thead><tbody><tr><td><strong>API</strong> (backend/api)</td><td>暴露 HTTP 接口层，使用 Hertz（Go 的高性能 Web 框架）处理请求、路由和响应组装。</td><td>API → Application API → Types</td><td>- 通过 Application 的服务接口调用业务逻辑。 - 使用 Types 定义请求/响应 DTO（数据传输对象）。 - 与前端 IDL 联动，确保 API 契约一致。</td></tr><tr><td><strong>Application</strong> (backend/application)</td><td>应用层：协调领域层和基础设施，封装业务用例（如 API 聚合、事务管理）。不含核心业务逻辑。</td><td>Application → Domain Application → Infra (Contract) Application → Pkg</td><td>- 调用 Domain 的聚合根/服务执行业务。 - 通过 Infra Contract 的接口（如 Repository）访问数据。 - 使用 Pkg 的工具（如依赖注入）组装组件。</td></tr><tr><td><strong>Domain</strong> (backend/domain)</td><td>领域层：DDD 核心，封装实体、值对象、聚合、领域服务和事件。纯业务逻辑，无技术细节。</td><td>Domain ← (无依赖，独立) Domain → Crossdomain (可选共享)</td><td>- 被 Application 调用，提供行为方法（如 Order.Create()）。 - 通过领域事件（Domain Event）与 Crossdomain 通信，解耦跨域逻辑。 - 定义 Infra 的合约接口（如 Repository 接口）。</td></tr><tr><td><strong>Crossdomain</strong> (backend/crossdomain)</td><td>跨领域层：处理多限界上下文（Bounded Context）间的共享模型、事件和规则（如全局用户 ID）。</td><td>Crossdomain → Domain (部分) Crossdomain ← Application (调用)</td><td>- 作为 Domain 的补充，提供共享值对象/事件。 - 通过事件总线（Event Bus）与多个 Domain 交互，避免直接耦合。</td></tr><tr><td><strong>Infra/contract</strong> (backend/infra/contract)</td><td>基础设施合约层：定义抽象接口（如 Repository、Cache 接口），由 Domain 驱动。</td><td>Infra/Contract ← Domain (接口由 Domain 定义) Infra/Contract → Impl</td><td>- 为 Domain 提供“门面”，隐藏实现细节。 - Application 通过这些接口间接访问 Impl。 - 确保可替换性（e.g., 换数据库）。</td></tr><tr><td><strong>Infra/Impl</strong> (backend/infra/impl)</td><td>基础设施实现层：具体实现合约，如数据库（GORM/MySQL）、缓存（Redis）、消息队列。</td><td>Infra/Impl → Contract (实现接口)</td><td>- 注入到 Application/Domain 中（通过 Pkg 的 DI 容器）。 - 只响应合约调用，不反向影响业务层。</td></tr><tr><td><strong>Pkg</strong> (backend/pkg)</td><td>共享包层：工具和依赖注入（如 Wire），跨层复用。</td><td>Pkg ← (所有层可选依赖)</td><td>- 提供 DI（依赖注入）框架，连接 Application 与 Infra。 - 包含通用工具（如日志、配置），减少重复代码。</td></tr><tr><td><strong>Types</strong> (backend/types)</td><td>类型定义层：共享数据结构（如枚举、结构体），用于 DTO 和内部类型。</td><td>Types ← API/Application (引用)</td><td>- 统一类型系统，避免散乱定义。 - 与 IDL 同步，确保前后端类型一致。</td></tr><tr><td><strong>Common</strong> (backend/common)</td><td>通用组件层：基础工具（如错误码、常量）。</td><td>Common ← (辅助其他层)</td><td>- 被所有层引用，提供底层支持（如日志中间件）。</td></tr><tr><td><strong>Docker</strong> (backend/docker)</td><td>部署配置层：Dockerfile 和 Compose，用于容器化。</td><td>Docker ← (外部，无直接依赖)</td><td>- 打包整个后端服务，支持微服务部署。 - 与整体项目集成，无业务联系。</td></tr></tbody></table>
<p>Coze Studio 的 DDD 架构遵循四层洋葱模型（API → Application → Domain → Infra）辅以共享层（Pkg/Types/Crossdomain），数据流为：外部 HTTP 请求经 API 层路由/验证后传入 Application 协调用例与事务，调用 Domain 层纯业务实体/聚合/事件处理核心逻辑（如代理创建），Domain 通过合约接口（如 Repository）驱动 Infra 层实现持久化（OceanBase/ES）、缓存（Cache）与事件分发（EventBus），处理结果经 Crossdomain 共享跨域数据后逆向回流至 API 响应前端，同时 Pkg 注入依赖与 Types 统一类型确保全链路一致性。</p>
<h4 data-id="heading-7">2.2.2 DDD 实践</h4>
<p><strong>领域驱动设计核心要素</strong>：</p>
<ul>
<li><strong>实体（Entity）</strong>：具有唯一标识的领域对象</li>
<li><strong>值对象（Value Object）</strong>：无标识的不可变对象</li>
<li><strong>聚合根（Aggregate Root）</strong>：管理一组相关对象的生命周期</li>
<li><strong>领域服务（Domain Service）</strong>：跨实体的业务逻辑</li>
<li><strong>仓储（Repository）</strong>：数据访问抽象层</li>
<li><strong>应用服务（Application Service）</strong>：用例协调者</li>
</ul>
<h4 data-id="heading-8">2.2.3 依赖倒置原则</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph BT
    A[Domain Layer&lt;br/&gt;领域接口定义] 
    B[Application Layer&lt;br/&gt;依赖接口]
    C[Infrastructure Layer&lt;br/&gt;实现接口]
    D[Cross Domain&lt;br/&gt;依赖接口]
    
    B --&gt;|依赖| A
    C -.-&gt;|实现| A
    D --&gt;|依赖| A
    
    style A fill:#f9f,stroke:#333,stroke-width:4px
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>✅ 核心业务逻辑不依赖基础设施</li>
<li>✅ 易于测试（可 Mock）</li>
<li>✅ 灵活替换底层实现</li>
</ul>
<hr/>
<h2 data-id="heading-9">3. 核心分层架构</h2>
<h3 data-id="heading-10">3.1 各层详细职责</h3>
<h4 data-id="heading-11">3.1.1 API 层（<code>/backend/api</code>）</h4>
<pre><code class="hljs language-bash" lang="bash">api/
├── handler/          <span class="hljs-comment"># HTTP 请求处理器</span>
│   └── coze/         <span class="hljs-comment"># 具体业务 Handler</span>
├── middleware/       <span class="hljs-comment"># 中间件（认证、日志、CORS）</span>
├── model/           <span class="hljs-comment"># API 数据模型（DTO）</span>
└── router/          <span class="hljs-comment"># 路由注册</span>
</code></pre>
<p><strong>核心职责</strong>：</p>
<ul>
<li>🔸 接收 HTTP 请求，解析参数</li>
<li>🔸 调用 Application Service</li>
<li>🔸 返回统一格式的响应</li>
<li>🔸 参数校验和错误处理</li>
</ul>
<p><strong>关键代码示例</strong>（<code>main.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ctx := context.Background()
    
    <span class="hljs-comment">// 1. 加载环境变量</span>
    loadEnv()
    
    <span class="hljs-comment">// 2. 初始化所有服务（依赖注入）</span>
    application.Init(ctx)
    
    <span class="hljs-comment">// 3. 启动 HTTP 服务器</span>
    startHttpServer()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startHttpServer</span><span class="hljs-params">()</span></span> {
    s := server.Default(opts...)
    
    <span class="hljs-comment">// 中间件链（顺序很重要！）</span>
    s.Use(middleware.ContextCacheMW())      <span class="hljs-comment">// 上下文缓存</span>
    s.Use(middleware.RequestInspectorMW())  <span class="hljs-comment">// 请求检查</span>
    s.Use(middleware.SetHostMW())           <span class="hljs-comment">// 设置主机信息</span>
    s.Use(middleware.SetLogIDMW())          <span class="hljs-comment">// 日志ID</span>
    s.Use(corsHandler)                      <span class="hljs-comment">// CORS</span>
    s.Use(middleware.AccessLogMW())         <span class="hljs-comment">// 访问日志</span>
    s.Use(middleware.OpenapiAuthMW())       <span class="hljs-comment">// OpenAPI 认证</span>
    s.Use(middleware.SessionAuthMW())       <span class="hljs-comment">// Session 认证</span>
    s.Use(middleware.I18nMW())              <span class="hljs-comment">// 国际化</span>
    
    router.GeneratedRegister(s)
    s.Spin()
}
</code></pre>
<p><strong>中间件执行顺序</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[HTTP Request] --&gt; B[ContextCache]
    B --&gt; C[RequestInspector]
    C --&gt; D[SetHost]
    D --&gt; E[SetLogID]
    E --&gt; F[CORS]
    F --&gt; G[AccessLog]
    G --&gt; H[OpenapiAuth]
    H --&gt; I[SessionAuth]
    I --&gt; J[I18n]
    J --&gt; K[Handler]
    K --&gt; L[Response]
    
    style A fill:#e3f2fd
    style K fill:#c8e6c9
    style L fill:#fff9c4
</code></pre>
<h4 data-id="heading-12">3.1.2 应用服务层（<code>/backend/application</code>）</h4>
<pre><code class="hljs language-bash" lang="bash">── application/      <span class="hljs-comment"># 应用层，组合领域对象和基础设施实现</span>
   ├── app/          <span class="hljs-comment"># 应用服务</span>
   ├── conversation/ <span class="hljs-comment"># 会话应用服务</span>
   ├── knowledge/    <span class="hljs-comment"># 知识应用服务</span>
   ├── memory/       <span class="hljs-comment"># 内存应用服务</span>
   ├── modelmgr/     <span class="hljs-comment"># 模型管理应用服务</span>
   ├── plugin/       <span class="hljs-comment"># 插件应用服务</span>
   ├── prompt/       <span class="hljs-comment"># 提示词应用服务</span>
   ├── search/       <span class="hljs-comment"># 搜索应用服务</span>
   ├── singleagent/  <span class="hljs-comment"># 单一代理应用服务</span>
   ├── user/         <span class="hljs-comment"># 用户应用服务</span>
   └── workflow/     <span class="hljs-comment"># 工作流应用服务</span>
</code></pre>
<p><strong>核心职责</strong>：</p>
<ul>
<li>🔸 编排多个 Domain Service 完成业务用例</li>
<li>🔸 事务管理</li>
<li>🔸 权限检查</li>
<li>🔸 事件发布</li>
</ul>
<p><strong>服务初始化</strong>（<code>application.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Init</span><span class="hljs-params">(ctx context.Context)</span></span> (err <span class="hljs-type">error</span>) {
	<span class="hljs-comment">// 1. 初始化上下文缓存</span>
	ctx = ctxcache.Init(ctx)
	<span class="hljs-comment">// 2. 初始化基础设施</span>
	infra, err := appinfra.Init(ctx)

	<span class="hljs-comment">// 3. 初始化事件总线(依赖基础设施)</span>
	eventbus := initEventBus(infra)

	<span class="hljs-comment">// 4. 初始化基础服务(依赖基础设施和事件总线)</span>
	basicServices, err := initBasicServices(ctx, infra, eventbus)

	<span class="hljs-comment">// 5. 初始化主服务(依赖基础服务)</span>
	primaryServices, err := initPrimaryServices(ctx, basicServices)

	<span class="hljs-comment">// 6. 初始化复杂服务(依赖主服务)</span>
	complexServices, err := initComplexServices(ctx, primaryServices)

	<span class="hljs-comment">// 7. 配置跨域服务</span>
	crossconnector.SetDefaultSVC(connectorImpl.InitDomainService(basicServices.connectorSVC.DomainSVC))
	crossdatabase.SetDefaultSVC(databaseImpl.InitDomainService(primaryServices.memorySVC.DatabaseDomainSVC))
	crossknowledge.SetDefaultSVC(knowledgeImpl.InitDomainService(primaryServices.knowledgeSVC.DomainSVC))
	crossplugin.SetDefaultSVC(pluginImpl.InitDomainService(primaryServices.pluginSVC.DomainSVC, infra.OSS))
	...
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>服务依赖简要关系图</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "Infrastructure 基础设施"
        I1[DB/Redis/OSS/ES]
    end
    
    subgraph "Basic Services 基础服务"
        B1[ModelMgr]
        B2[Connector]
        B3[User]
        B4[Upload]
    end
    
    subgraph "Primary Services 主要服务"
        P1[Plugin]
        P2[Memory]
        P3[Knowledge]
        P4[Workflow]
    end
    
    subgraph "Complex Services 复杂服务"
        C1[SingleAgent]
        C2[App]
        C3[Conversation]
    end
    
    I1 --&gt; B1
    I1 --&gt; B2
    I1 --&gt; B3
    I1 --&gt; B4
    
    B1 --&gt; P1
    B2 --&gt; P2
    B3 --&gt; P3
    B4 --&gt; P4
    
    P1 --&gt; C1
    P2 --&gt; C1
    P3 --&gt; C2
    P4 --&gt; C2
    
    C1 --&gt; C3
    C2 --&gt; C3
    
    style I1 fill:#fff9c4
    style P1 fill:#c8e6c9
    style P2 fill:#c8e6c9
    style P3 fill:#c8e6c9
    style P4 fill:#c8e6c9
    style C1 fill:#f8bbd0
    style C2 fill:#f8bbd0
    style C3 fill:#f8bbd0
</code></pre>
<h4 data-id="heading-13">3.1.3 领域层（<code>/backend/domain</code>）</h4>
<pre><code class="hljs language-bash" lang="bash">── domain/           <span class="hljs-comment"># 领域层，包含核心业务逻辑</span>
   ├── agent/        <span class="hljs-comment"># 代理领域逻辑</span>
   ├── app/          <span class="hljs-comment"># 应用领域逻辑</span>
   ├── conversation/ <span class="hljs-comment"># 会话领域逻辑</span>
   ├── knowledge/    <span class="hljs-comment"># 知识领域逻辑</span>
   ├── memory/       <span class="hljs-comment"># 内存领域逻辑</span>
   ├── modelmgr/     <span class="hljs-comment"># 模型管理领域逻辑</span>
   ├── plugin/       <span class="hljs-comment"># 插件领域逻辑</span>
   ├── prompt/       <span class="hljs-comment"># 提示词领域逻辑</span>
   ├── search/       <span class="hljs-comment"># 搜索领域逻辑</span>
   ├── user/         <span class="hljs-comment"># 用户领域逻辑</span>
   └── workflow/     <span class="hljs-comment"># 工作流领域逻辑</span>
</code></pre>
<p><strong>领域模型核心</strong>：</p>
<p><strong>Entity 示例</strong>（<code>domain/workflow/entity/workflow.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Workflow 实体（聚合根）</span>
<span class="hljs-keyword">type</span> Workflow <span class="hljs-keyword">struct</span> {
    ID          <span class="hljs-type">int64</span>
    SpaceID     <span class="hljs-type">int64</span>
    AppID       *<span class="hljs-type">int64</span>
    Name        <span class="hljs-type">string</span>
    Description <span class="hljs-type">string</span>
    Mode        WorkflowMode  <span class="hljs-comment">// CHATFLOW | WORKFLOW</span>
    Canvas      <span class="hljs-type">string</span>        <span class="hljs-comment">// JSON schema</span>
    Version     <span class="hljs-type">string</span>
    Status      Status
    CreatedAt   time.Time
    UpdatedAt   time.Time
}

<span class="hljs-comment">// 业务方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Workflow)</span></span> GetBasic() *BasicInfo { ... }
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Workflow)</span></span> GetVersion() <span class="hljs-type">string</span> { ... }
</code></pre>
<p><strong>Domain Service 接口</strong>（<code>domain/workflow/interface.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Service <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// 元数据管理</span>
    Create(ctx context.Context, meta *vo.MetaCreate) (<span class="hljs-type">int64</span>, <span class="hljs-type">error</span>)
    Get(ctx context.Context, policy *vo.GetPolicy) (*entity.Workflow, <span class="hljs-type">error</span>)
    Delete(ctx context.Context, policy *vo.DeletePolicy) ([]<span class="hljs-type">int64</span>, <span class="hljs-type">error</span>)
    UpdateMeta(ctx context.Context, id <span class="hljs-type">int64</span>, metaUpdate *vo.MetaUpdate) <span class="hljs-type">error</span>
    
    <span class="hljs-comment">// 执行相关</span>
    Executable  <span class="hljs-comment">// 嵌入执行接口</span>
    AsTool      <span class="hljs-comment">// 作为工具使用</span>
    
    <span class="hljs-comment">// Workflow 特有逻辑</span>
    Publish(ctx context.Context, policy *vo.PublishPolicy) <span class="hljs-type">error</span>
    WorkflowSchemaCheck(ctx context.Context, wf *entity.Workflow, checks []workflow.CheckType) ([]*workflow.CheckResult, <span class="hljs-type">error</span>)
    
    <span class="hljs-comment">// 会话相关</span>
    ChatFlowRole
    Conversation
}
</code></pre>
<h4 data-id="heading-14">3.1.4 跨域服务层（<code>/backend/crossdomain</code>）</h4>
<p><strong>设计目的</strong>：</p>
<ul>
<li>解决循环依赖问题</li>
<li>提供统一的跨领域调用接口</li>
<li>隔离不同领域的实现细节</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">├── crossdomain/      <span class="hljs-comment"># 跨领域防腐层</span>
│   ├── contract/     <span class="hljs-comment"># 跨领域接口定义</span>
│   ├── impl/         <span class="hljs-comment"># 跨领域接口实现</span>
│   └── workflow/     <span class="hljs-comment"># 工作流跨领域实现</span>

<span class="hljs-comment">#示例</span>
crossdomain/
├── workflow/
│   ├── contract.go       <span class="hljs-comment"># 接口定义</span>
│   ├── impl/            <span class="hljs-comment"># 接口实现（适配器）</span>
│   └── model/           <span class="hljs-comment"># 跨域数据模型</span>
├── knowledge/
├── plugin/
└── ...


</code></pre>
<p><strong>使用模式</strong>：</p>
<blockquote>
<p><strong>注意</strong>：以下代码为<strong>伪代码示例</strong>，用于说明跨域调用的概念模式。实际代码中的函数名和方法名可能不同。</p>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 伪代码示例：在 Plugin Domain 中调用 Workflow</span>
<span class="hljs-keyword">import</span> crossworkflow <span class="hljs-string">"github.com/coze-dev/coze-studio/backend/crossdomain/workflow"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *PluginService)</span></span> UseInWorkflow(ctx context.Context, wfID <span class="hljs-type">int64</span>) <span class="hljs-type">error</span> {
    <span class="hljs-comment">// 通过 crossdomain 接口调用（伪代码）</span>
    wf, err := crossworkflow.GetDefaultSVC().GetWorkflow(ctx, wfID)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>真实代码示例</strong>（来自 <code>backend/domain/agent/singleagent/internal/agentflow/node_tool_workflow.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 真实代码：在 Agent Domain 中调用 Workflow</span>
<span class="hljs-keyword">import</span> crossworkflow <span class="hljs-string">"github.com/coze-dev/coze-studio/backend/crossdomain/workflow"</span>

<span class="hljs-comment">// 获取 Workflow 作为工具使用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newWorkflowTools</span><span class="hljs-params">(ctx context.Context, conf *workflowConfig)</span></span> ([]workflow.ToolFromWorkflow, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">struct</span>{}, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">var</span> policies []*vo.GetPolicy

  ...

	workflowTools, err := crossworkflow.DefaultSVC().WorkflowAsModelTool(ctx, policies)

  ...
	<span class="hljs-keyword">return</span> workflowTools, toolsReturnDirectly, err
}
</code></pre>
<h4 data-id="heading-15">3.1.5 基础设施层（<code>/backend/infra</code>）</h4>
<pre><code class="hljs language-bash" lang="bash">infra/
├── orm/              <span class="hljs-comment"># ORM 封装</span>
├── rdb/              <span class="hljs-comment"># 关系数据库</span>
├── cache/            <span class="hljs-comment"># Redis 缓存</span>
├── es/               <span class="hljs-comment"># Elasticsearch</span>
├── storage/          <span class="hljs-comment"># 对象存储（OSS）</span>
├── eventbus/         <span class="hljs-comment"># 事件总线</span>
├── embedding/        <span class="hljs-comment"># 向量嵌入</span>
├── coderunner/       <span class="hljs-comment"># 代码执行沙箱</span>
├── checkpoint/       <span class="hljs-comment"># 检查点存储</span>
└── ...
</code></pre>
<p><strong>核心职责</strong>：</p>
<ul>
<li>🔸 封装技术实现细节（数据库、缓存、消息队列等）</li>
<li>🔸 提供统一的接口抽象，不依赖具体实现</li>
<li>🔸 实现依赖倒置，领域层只依赖接口</li>
</ul>
<p><strong>代码示例</strong>：</p>
<p><strong>1. Elasticsearch 使用示例</strong></p>
<p><code>application-&gt;domain-&gt;infra   </code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//coze-studio/backend/application/application.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initComplexServices</span><span class="hljs-params">(ctx context.Context, p *primaryServices)</span></span> (*complexServices, <span class="hljs-type">error</span>) {
	...

	searchSVC, err := search.InitService(ctx, p.toSearchServiceComponents(singleAgentSVC, appSVC))
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	...
}

<span class="hljs-comment">//coze-studio/backend/application/search/init.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitService</span><span class="hljs-params">(ctx context.Context, s *ServiceComponents)</span></span> (*SearchApplicationService, <span class="hljs-type">error</span>) {
	searchDomainSVC := search.NewDomainService(ctx, s.ESClient)

	...

	<span class="hljs-keyword">return</span> SearchSVC, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">//coze-studio/backend/domain/search/service/search.go</span>
<span class="hljs-comment">// 领域服务通过依赖注入获取 ES 客户端</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDomainService</span><span class="hljs-params">(ctx context.Context, e es.Client)</span></span> Search {
    <span class="hljs-keyword">return</span> &amp;searchImpl{
        esClient: e,
    }
}

<span class="hljs-comment">// 使用 ES 进行全文检索</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *searchImpl)</span></span> SearchProjects(ctx context.Context, req *SearchRequest) <span class="hljs-type">error</span> {
    searchReq := &amp;es.Request{
        Query: &amp;es.Query{
            Bool: &amp;es.BoolQuery{
                Must: []es.Query{
                    es.NewEqualQuery(<span class="hljs-string">"space_id"</span>, strconv.FormatInt(req.SpaceID, <span class="hljs-number">10</span>)),
                },
            },
        },
    }
    
    result, err := s.esClient.Search(ctx, <span class="hljs-string">"project_index"</span>, searchReq)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-comment">// 处理搜索结果...</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">//coze-studio/backend/infra/es/es.go</span>
<span class="hljs-keyword">type</span> Client <span class="hljs-keyword">interface</span> {
...
	Search(ctx context.Context, index <span class="hljs-type">string</span>, req *Request) (*Response, <span class="hljs-type">error</span>)
...
}
<span class="hljs-comment">//最后会根据实例化的 es 去调用</span>
impl/es
	es_impl.<span class="hljs-keyword">go</span>
	es7.<span class="hljs-keyword">go</span>
	es8.<span class="hljs-keyword">go</span>
	...
</code></pre>
<p><strong>2. Storage（对象存储）使用示例</strong>（来自 <code>backend/domain/plugin/service/exec_tool.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> toolExecutor <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// 通过依赖注入获取存储服务</span>
    oss storage.Storage
}

<span class="hljs-comment">// 上传文件到对象存储</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *toolExecutor)</span></span> uploadFile(ctx context.Context, content []<span class="hljs-type">byte</span>, objectKey <span class="hljs-type">string</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> t.oss.PutObject(ctx, objectKey, content)
}

<span class="hljs-comment">// 获取文件的预签名URL</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t *toolExecutor)</span></span> getFileUrl(ctx context.Context, objectKey <span class="hljs-type">string</span>) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> t.oss.GetObjectUrl(ctx, objectKey, storage.WithExpiration(time.Hour))
}
</code></pre>
<p><strong>3. Cache（Redis）使用示例</strong>（来自 <code>backend/domain/workflow/internal/nodes/llm/llm.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 使用上下文缓存（基于 Redis）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/coze-dev/coze-studio/backend/pkg/ctxcache"</span>

<span class="hljs-comment">// 存储数据到缓存</span>
ctxcache.Store(ctx, <span class="hljs-string">"raw_output_key"</span>, outputData)
ctxcache.Store(ctx, <span class="hljs-string">"chat_history_key"</span>, messages)

<span class="hljs-comment">// 从缓存读取数据</span>
rawOutput, found := ctxcache.Get[<span class="hljs-type">string</span>](ctx, <span class="hljs-string">"raw_output_key"</span>)
<span class="hljs-keyword">if</span> found {
    <span class="hljs-comment">// 使用缓存的数据</span>
}
</code></pre>
<p><strong>4. EventBus（事件总线）接口定义</strong>（来自 <code>backend/infra/eventbus/eventbus.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 事件生产者接口</span>
<span class="hljs-keyword">type</span> Producer <span class="hljs-keyword">interface</span> {
    Send(ctx context.Context, body []<span class="hljs-type">byte</span>, opts ...SendOpt) <span class="hljs-type">error</span>
    BatchSend(ctx context.Context, bodyArr [][]<span class="hljs-type">byte</span>, opts ...SendOpt) <span class="hljs-type">error</span>
}

<span class="hljs-comment">// 事件消费者接口</span>
<span class="hljs-keyword">type</span> ConsumerHandler <span class="hljs-keyword">interface</span> {
    HandleMessage(ctx context.Context, msg *Message) <span class="hljs-type">error</span>
}

<span class="hljs-comment">// 使用示例：发布事件</span>
producer.Send(ctx, eventData, eventbus.WithTopic(<span class="hljs-string">"workflow_events"</span>))

<span class="hljs-comment">// 使用示例：消费事件</span>
eventbus.GetDefaultSVC().RegisterConsumer(
    <span class="hljs-string">"server"</span>, <span class="hljs-string">"workflow_events"</span>, <span class="hljs-string">"group1"</span>, 
    &amp;MyHandler{}, 
)
</code></pre>
<hr/>
<h2 data-id="heading-16">4. 关键技术栈</h2>
<h3 data-id="heading-17">4.1 核心框架</h3>
<h4 data-id="heading-18">4.1.1 Hertz - HTTP 框架</h4>
<ul>
<li>🚀 CloudWeGo 生态，性能优异</li>
<li>🔧 中间件机制完善</li>
<li>📦 代码生成支持（基于 IDL）</li>
</ul>
<h4 data-id="heading-19">4.1.2 Eino - AI Workflow 引擎</h4>
<p><strong>Eino</strong>  是字节开源的 Go 语言编写的终极大型语言模型（LLM）应用开发框架，它从开源社区中的诸多优秀 LLM 应用开发框架，如 LangChain 和 LlamaIndex 等获取灵感，同时借鉴前沿研究成果与实际应用，提供了一个强调简洁性、可扩展性、可靠性与有效性，且更符合 Go 语言编程惯例的 LLM 应用开发框架。</p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcloudwego%2Feino%2Fblob%2Fmain%2FREADME.zh_CN.md" target="_blank" title="https://github.com/cloudwego/eino/blob/main/README.zh_CN.md" ref="nofollow noopener noreferrer">github.com/cloudwego/e…</a></p>
<p><strong>核心概念</strong>：</p>
<ul>
<li><strong>Runnable</strong>: 可执行单元的抽象</li>
<li><strong>Compose</strong>: 组合模式，构建复杂 Workflow</li>
<li><strong>Schema</strong>: 数据流定义</li>
<li><strong>Checkpoint</strong>: 状态持久化，支持中断恢复</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/cloudwego/eino/compose"</span>

<span class="hljs-comment">// 创建 Workflow</span>
wf := compose.NewWorkflow[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any](
    compose.WithGenLocalState(GenState()),
)

<span class="hljs-comment">// 添加节点</span>
wf.AddLambdaNode(<span class="hljs-string">"llm_node"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any)</span></span> (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 调用 LLM</span>
    <span class="hljs-keyword">return</span> llmService.Chat(ctx, input)
})

<span class="hljs-comment">// 编译运行</span>
runner, _ := wf.Compile(ctx, compose.WithCheckPointStore(store))
output, _ := runner.Invoke(ctx, input)
</code></pre>
<h3 data-id="heading-20">4.2 数据存储</h3>






























<table><thead><tr><th>存储</th><th>用途</th><th>示例</th></tr></thead><tbody><tr><td><strong>MySQL</strong></td><td>主数据存储</td><td>Workflow 元数据、用户信息</td></tr><tr><td><strong>Redis</strong></td><td>缓存 + Checkpoint</td><td>执行状态、临时数据</td></tr><tr><td><strong>Elasticsearch</strong></td><td>全文检索</td><td>资源搜索、知识库检索</td></tr><tr><td><strong>OSS</strong></td><td>对象存储</td><td>文件上传、图片、模型文件</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-21">5. 目录结构分析</h2>
<h3 data-id="heading-22">5.1 完整目录树</h3>
<pre><code class="hljs language-csharp" lang="csharp">├── backend/              <span class="hljs-meta"># 后端服务</span>
│   ├── api/              <span class="hljs-meta"># API 处理器和路由</span>
│   │   ├── handler/      <span class="hljs-meta"># 处理器</span>
│   │   ├── <span class="hljs-keyword">internal</span>/     <span class="hljs-meta"># 内部工具</span>
│   │   ├── middleware/   <span class="hljs-meta"># 中间件组件</span>
│   │   ├── model/        <span class="hljs-meta"># API 模型定义</span>
│   │   └── router/       <span class="hljs-meta"># 路由定义</span>
│   ├── application/      <span class="hljs-meta"># 应用层，组合领域对象和基础设施实现</span>
│   │   ├── app/          <span class="hljs-meta"># 应用服务</span>
│   │   ├── conversation/ <span class="hljs-meta"># 会话应用服务</span>
│   │   ├── knowledge/    <span class="hljs-meta"># 知识应用服务</span>
│   │   ├── memory/       <span class="hljs-meta"># 内存应用服务</span>
│   │   ├── modelmgr/     <span class="hljs-meta"># 模型管理应用服务</span>
│   │   ├── plugin/       <span class="hljs-meta"># 插件应用服务</span>
│   │   ├── prompt/       <span class="hljs-meta"># 提示词应用服务</span>
│   │   ├── search/       <span class="hljs-meta"># 搜索应用服务</span>
│   │   ├── singleagent/  <span class="hljs-meta"># 单一代理应用服务</span>
│   │   ├── user/         <span class="hljs-meta"># 用户应用服务</span>
│   │   └── workflow/     <span class="hljs-meta"># 工作流应用服务</span>
│   ├── conf/             <span class="hljs-meta"># 配置文件</span>
│   │   ├── model/        <span class="hljs-meta"># 模型配置</span>
│   │   ├── plugin/       <span class="hljs-meta"># 插件配置</span>
│   │   └── prompt/       <span class="hljs-meta"># 提示词配置</span>
│   ├── crossdomain/      <span class="hljs-meta"># 跨领域防腐层</span>
│   │   ├── contract/     <span class="hljs-meta"># 跨领域接口定义</span>
│   │   ├── impl/         <span class="hljs-meta"># 跨领域接口实现</span>
│   │   └── workflow/     <span class="hljs-meta"># 工作流跨领域实现</span>
│   ├── domain/           <span class="hljs-meta"># 领域层，包含核心业务逻辑</span>
│   │   ├── agent/        <span class="hljs-meta"># 代理领域逻辑</span>
│   │   ├── app/          <span class="hljs-meta"># 应用领域逻辑</span>
│   │   ├── conversation/ <span class="hljs-meta"># 会话领域逻辑</span>
│   │   ├── knowledge/    <span class="hljs-meta"># 知识领域逻辑</span>
│   │   ├── memory/       <span class="hljs-meta"># 内存领域逻辑</span>
│   │   ├── modelmgr/     <span class="hljs-meta"># 模型管理领域逻辑</span>
│   │   ├── plugin/       <span class="hljs-meta"># 插件领域逻辑</span>
│   │   ├── prompt/       <span class="hljs-meta"># 提示词领域逻辑</span>
│   │   ├── search/       <span class="hljs-meta"># 搜索领域逻辑</span>
│   │   ├── user/         <span class="hljs-meta"># 用户领域逻辑</span>
│   │   └── workflow/     <span class="hljs-meta"># 工作流领域逻辑</span>
│   ├── infra/            <span class="hljs-meta"># 基础设施实现层</span>
│   │   ├── contract/     <span class="hljs-meta"># 基础设施接口定义</span>
│   │   └── impl/         <span class="hljs-meta"># 基础设施接口实现</span>
│   ├── pkg/              <span class="hljs-meta"># 无外部依赖的工具方法</span>
│   │   ├── ctxcache/     <span class="hljs-meta"># 上下文缓存工具</span>
│   │   ├── errorx/       <span class="hljs-meta"># 错误处理工具</span>
│   │   ├── goutil/       <span class="hljs-meta"># Go 语言工具</span>
│   │   ├── logs/         <span class="hljs-meta"># 日志工具</span>
│   │   └── safego/       <span class="hljs-meta"># 安全 Go 工具</span>
│   └── types/            <span class="hljs-meta"># 类型定义</span>
│       ├── consts/       <span class="hljs-meta"># 常量定义</span>
│       ├── ddl/          <span class="hljs-meta"># 数据定义语言</span>
│       └── errno/        <span class="hljs-meta"># 错误码定义</span>
├── frontend/             <span class="hljs-meta"># 前端应用</span>
...
├── idl/                  <span class="hljs-meta"># 接口定义语言文件</span>
</code></pre>
<h3 data-id="heading-23">5.2 目录职责矩阵</h3>








































<table><thead><tr><th>目录</th><th>职责</th><th>依赖方向</th></tr></thead><tbody><tr><td><code>api</code></td><td>HTTP 请求处理</td><td>→ application</td></tr><tr><td><code>application</code></td><td>业务流程编排</td><td>→ domain</td></tr><tr><td><code>domain</code></td><td>核心业务逻辑</td><td>→ crossdomain</td></tr><tr><td><code>crossdomain</code></td><td>跨域服务抽象</td><td>→ domain (interface)</td></tr><tr><td><code>infra</code></td><td>技术实现细节</td><td>← domain (实现接口)</td></tr><tr><td><code>pkg</code></td><td>通用工具</td><td>被所有层使用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-24">6. 核心模块详解</h2>
<h4 data-id="heading-25">6.1.1 Workflow 架构</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "Workflow Domain"
        A[Service Interface]
        B[Service Implementation]
        C[Entity/VO]
        
        subgraph "Internal 内部实现"
            D[Schema - 数据流定义]
            E[Compose - 编排引擎]
            F[Nodes - 节点实现]
            G[Execute - 执行引擎]
            H[Repository - 仓储]
        end
    end
    
    A --&gt; B
    B --&gt; D
    B --&gt; E
    B --&gt; H
    D --&gt; E
    E --&gt; F
    E --&gt; G
    F --&gt; G
    
    style D fill:#e1f5ff
    style E fill:#fff4e1
    style F fill:#e8f5e9
    style G fill:#f3e5f5
</code></pre>
<h4 data-id="heading-26">6.1.2 核心组件</h4>
<h5 data-id="heading-27">Schema（数据流定义）</h5>
<p><strong>职责</strong>：定义 Workflow 的结构和数据流</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/schema/workflow_schema.go WorkflowSchema 定义 Workflow 的完整结构</span>
<span class="hljs-keyword">type</span> WorkflowSchema <span class="hljs-keyword">struct</span> {
    Nodes       []*NodeSchema                <span class="hljs-string">`json:"nodes"`</span>
    Connections []*Connection                <span class="hljs-string">`json:"connections"`</span>
    Hierarchy   <span class="hljs-keyword">map</span>[vo.NodeKey]vo.NodeKey    <span class="hljs-string">`json:"hierarchy,omitempty"`</span> <span class="hljs-comment">// child node key-&gt; parent node key</span>
    Branches    <span class="hljs-keyword">map</span>[vo.NodeKey]*BranchSchema <span class="hljs-string">`json:"branches,omitempty"`</span>
    
    GeneratedNodes []vo.NodeKey <span class="hljs-string">`json:"generated_nodes,omitempty"`</span> <span class="hljs-comment">// generated nodes for the nodes in batch mode</span>
    
    nodeMap           <span class="hljs-keyword">map</span>[vo.NodeKey]*NodeSchema <span class="hljs-comment">// won't serialize this</span>
    compositeNodes    []*CompositeNode           <span class="hljs-comment">// won't serialize this</span>
    requireCheckPoint <span class="hljs-type">bool</span>                       <span class="hljs-comment">// won't serialize this</span>
    requireStreaming  <span class="hljs-type">bool</span>
    historyRounds     <span class="hljs-type">int64</span>
}

<span class="hljs-comment">// Connection 定义节点之间的连接关系</span>
<span class="hljs-keyword">type</span> Connection <span class="hljs-keyword">struct</span> {
    FromNode vo.NodeKey <span class="hljs-string">`json:"from_node"`</span>
    ToNode   vo.NodeKey <span class="hljs-string">`json:"to_node"`</span>
    FromPort *<span class="hljs-type">string</span>    <span class="hljs-string">`json:"from_port,omitempty"`</span>
}
</code></pre>
<h5 data-id="heading-28">Compose（编排引擎）</h5>
<p><strong>职责</strong>：将 Schema 编译成可执行的 Workflow</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//backend/domain/workflow/internal/compose/workflow.go NewWorkflow 创建 Workflow 实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewWorkflow</span><span class="hljs-params">(ctx context.Context, sc *schema.WorkflowSchema, opts ...WorkflowOption)</span></span> (*Workflow, <span class="hljs-type">error</span>) {
    sc.Init() <span class="hljs-comment">// 初始化 Schema，构建 nodeMap 等内部结构</span>
    
    wf := &amp;Workflow{
        workflow:    compose.NewWorkflow[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any](
            compose.WithGenLocalState(GenState()),
        ),
        hierarchy:   sc.Hierarchy,
        connections: sc.Connections,
        schema:      sc,
    }
    
    wf.streamRun = sc.RequireStreaming()
    wf.requireCheckpoint = sc.RequireCheckpoint()
    
    <span class="hljs-comment">// 处理选项</span>
    wfOpts := &amp;workflowOptions{}
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {
        opt(wfOpts)
    }
    
    <span class="hljs-comment">// 添加所有复合节点（包含子工作流的节点）</span>
    compositeNodes := sc.GetCompositeNodes()
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> compositeNodes {
        cNode := compositeNodes[i]
        <span class="hljs-keyword">if</span> err := wf.AddCompositeNode(ctx, cNode); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
    }
    
    <span class="hljs-comment">// 添加所有普通节点</span>
    <span class="hljs-keyword">for</span> _, ns := <span class="hljs-keyword">range</span> sc.Nodes {
        <span class="hljs-keyword">if</span> err := wf.AddNode(ctx, ns); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
    }
    
    <span class="hljs-comment">// 编译成可执行的 Runner</span>
    runner, err := wf.Compile(ctx, wfOpts.compileOpts...)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    wf.Runner = runner
    
    <span class="hljs-keyword">return</span> wf, <span class="hljs-literal">nil</span>
}
</code></pre>
<h5 data-id="heading-29">Nodes（节点实现）</h5>
<p><strong>支持的节点类型</strong>：</p>




























































<table><thead><tr><th>节点类型</th><th>功能</th><th>实现路径</th></tr></thead><tbody><tr><td><strong>Entry</strong></td><td>工作流入口</td><td><code>nodes/entry</code></td></tr><tr><td><strong>Exit</strong></td><td>工作流出口</td><td><code>nodes/exit</code></td></tr><tr><td><strong>LLM</strong></td><td>大模型调用</td><td><code>nodes/llm</code></td></tr><tr><td><strong>Plugin</strong></td><td>插件调用</td><td><code>nodes/plugin</code></td></tr><tr><td><strong>Code</strong></td><td>代码执行</td><td><code>nodes/code</code></td></tr><tr><td><strong>Knowledge</strong></td><td>知识库检索</td><td><code>nodes/knowledge</code></td></tr><tr><td><strong>Database</strong></td><td>数据库操作</td><td><code>nodes/database</code></td></tr><tr><td><strong>Selector</strong></td><td>条件分支</td><td><code>nodes/selector</code></td></tr><tr><td><strong>Loop</strong></td><td>循环迭代</td><td><code>nodes/loop</code></td></tr><tr><td><strong>HTTPRequester</strong></td><td>HTTP 请求</td><td><code>nodes/httprequester</code></td></tr></tbody></table>
<p><strong>节点构建机制</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//backend/domain/workflow/internal/compose/node_builder.go New 从 NodeSchema 实例化实际的节点类型</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(ctx context.Context, s *schema.NodeSchema,
    inner compose.Runnable[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any], // 复合节点的内部工作流
    sc *schema.WorkflowSchema, // 节点所在的工作流 Schema
    deps *dependencyInfo, // 节点的依赖信息
    requireCheckpoint <span class="hljs-type">bool</span>,
)</span></span> (_ *Node, err <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 如果 NodeSchema 的 Configs 实现了 NodeBuilder 接口，使用它来构建节点</span>
    nb, ok := s.Configs.(schema.NodeBuilder)
    <span class="hljs-keyword">if</span> ok {
        opts := []schema.BuildOption{
            schema.WithWorkflowSchema(sc),
            schema.WithInnerWorkflow(inner),
        }
        
        <span class="hljs-comment">// 构建实际的 InvokableNode 等</span>
        n, err := nb.Build(ctx, s, opts...)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        
        <span class="hljs-comment">// 将 InvokableNode 包装成 NodeRunner，转换为 eino 的 Lambda</span>
        <span class="hljs-keyword">return</span> toNode(s, n), <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 处理特殊节点类型</span>
    <span class="hljs-keyword">switch</span> s.Type {
    <span class="hljs-keyword">case</span> entity.NodeTypeLambda:
        <span class="hljs-keyword">return</span> &amp;Node{Lambda: s.Lambda}, <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">case</span> entity.NodeTypeSubWorkflow:
        subWorkflow, err := buildSubWorkflow(ctx, s, requireCheckpoint)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">return</span> toNode(s, subWorkflow), <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">default</span>:
        <span class="hljs-built_in">panic</span>(fmt.Sprintf(<span class="hljs-string">"node schema's Configs does not implement NodeBuilder. type: %v"</span>, s.Type))
    }
}
</code></pre>
<p><strong>说明</strong>：LLM 节点通过实现 <code>NodeBuilder</code> 接口来构建，具体实现在 <code>backend/domain/workflow/internal/nodes/llm/llm.go</code> 中。</p>
<h5 data-id="heading-30">Execute（执行引擎）</h5>
<p><strong>核心功能</strong>：</p>
<ul>
<li>🔸 执行上下文管理</li>
<li>🔸 事件发送（开始、结束、错误）</li>
<li>🔸 流式输出支持</li>
<li>🔸 中断和恢复</li>
</ul>
<p><strong>事件类型</strong>（真实代码来自 <code>backend/domain/workflow/internal/execute/event.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> EventType <span class="hljs-type">string</span>

<span class="hljs-keyword">const</span> (
    <span class="hljs-comment">// 工作流级别事件</span>
    WorkflowStart         EventType = <span class="hljs-string">"workflow_start"</span>
    WorkflowSuccess       EventType = <span class="hljs-string">"workflow_success"</span>
    WorkflowFailed        EventType = <span class="hljs-string">"workflow_failed"</span>
    WorkflowCancel        EventType = <span class="hljs-string">"workflow_cancel"</span>
    WorkflowInterrupt     EventType = <span class="hljs-string">"workflow_interrupt"</span>
    WorkflowResume        EventType = <span class="hljs-string">"workflow_resume"</span>
    
    <span class="hljs-comment">// 节点级别事件</span>
    NodeStart             EventType = <span class="hljs-string">"node_start"</span>
    NodeEnd               EventType = <span class="hljs-string">"node_end"</span>
    NodeEndStreaming      EventType = <span class="hljs-string">"node_end_streaming"</span> <span class="hljs-comment">// 绝对结束，所有流式内容发送完毕</span>
    NodeError             EventType = <span class="hljs-string">"node_error"</span>
    NodeStreamingInput    EventType = <span class="hljs-string">"node_streaming_input"</span>
    NodeStreamingOutput   EventType = <span class="hljs-string">"node_streaming_output"</span>
    
    <span class="hljs-comment">// 工具调用事件</span>
    FunctionCall          EventType = <span class="hljs-string">"function_call"</span>
    ToolResponse          EventType = <span class="hljs-string">"tool_response"</span>
    ToolStreamingResponse EventType = <span class="hljs-string">"tool_streaming_response"</span>
    ToolError             EventType = <span class="hljs-string">"tool_error"</span>
)
</code></pre>
<h4 data-id="heading-31">6.1.3 Workflow 生命周期</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Handler
    participant AppService
    participant DomainService
    participant Compose
    participant Eino
    participant Node
    
    Client-&gt;&gt;Handler: POST /api/workflow/execute
    Handler-&gt;&gt;AppService: Execute(config, input)
    AppService-&gt;&gt;DomainService: SyncExecute(config, input)
    
    DomainService-&gt;&gt;DomainService: Get Workflow Entity
    DomainService-&gt;&gt;DomainService: Parse Canvas to Schema
    DomainService-&gt;&gt;Compose: NewWorkflow(schema)
    
    Compose-&gt;&gt;Compose: AddNodes
    Compose-&gt;&gt;Compose: Compile
    Compose--&gt;&gt;DomainService: Return Runner
    
    DomainService-&gt;&gt;Eino: Runner.Invoke(ctx, input)
    
    loop For each node
        Eino-&gt;&gt;Node: Execute(input)
        Node--&gt;&gt;Eino: output
        Eino-&gt;&gt;Eino: Emit Event
    end
    
    Eino--&gt;&gt;DomainService: Final Output
    DomainService--&gt;&gt;AppService: WorkflowExecution
    AppService--&gt;&gt;Handler: Result
    Handler--&gt;&gt;Client: HTTP Response
</code></pre>
<h3 data-id="heading-32">6.2 Plugin 模块</h3>
<h4 data-id="heading-33">6.2.1 Plugin 架构</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "Plugin Domain"
        A[Plugin Service]
        B[Plugin Entity]
        C[Plugin Repository]
        
        subgraph "Plugin Types"
            D1[HTTP Plugin]
            D2[Code Plugin]
            D3[System Plugin]
        end
        
        A --&gt; B
        A --&gt; C
        A --&gt; D1
        A --&gt; D2
        A --&gt; D3
    end
    
    subgraph "Workflow Integration"
        E[Plugin Node]
        F[Tool Wrapper]
    end
    
    A --&gt; E
    E --&gt; F
    
    style A fill:#e1f5ff
    style E fill:#fff4e1
</code></pre>
<h4 data-id="heading-34">6.2.2 Plugin 调用流程</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//backend/domain/workflow/internal/nodes/plugin/exec.go Plugin 节点执行（简化版，展示核心逻辑）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *PluginNode)</span></span> execute(ctx context.Context, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any) (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 准备执行请求</span>
    req := &amp;model.ExecuteToolRequest{
        PluginID:  pe.PluginID,
        ToolID:    pe.ToolID,
        Input:     input,
        <span class="hljs-comment">// ... 其他配置</span>
    }
    
    execOpts := []model.ExecuteToolOpt{
        model.WithInvalidRespProcessStrategy(consts.InvalidResponseProcessStrategyOfReturnDefault),
    }
    
    <span class="hljs-keyword">if</span> pe.PluginVersion != <span class="hljs-literal">nil</span> {
        execOpts = <span class="hljs-built_in">append</span>(execOpts, model.WithToolVersion(*pe.PluginVersion))
    }
    
    <span class="hljs-comment">// 2. 通过跨域服务调用 Plugin（注意：使用 DefaultSVC() 而不是 GetDefaultSVC()）</span>
    r, err := crossplugin.DefaultSVC().ExecuteTool(ctx, req, execOpts...)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 处理中断事件（如需要 OAuth 授权）</span>
        <span class="hljs-keyword">if</span> extra, ok := compose.IsInterruptRerunError(err); ok {
            pluginTIE, ok := extra.(*model.ToolInterruptEvent)
            <span class="hljs-keyword">if</span> ok {
                <span class="hljs-comment">// 创建工作流中断事件</span>
                <span class="hljs-comment">// ...</span>
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 3. 返回执行结果</span>
    <span class="hljs-keyword">return</span> r.Output, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用 <code>crossplugin.DefaultSVC()</code> 而不是 <code>crossplugin.GetDefaultSVC()</code></li>
<li>支持工具版本控制</li>
<li>支持中断和恢复机制（如 OAuth 授权）</li>
</ul>
<h3 data-id="heading-35">6.3 Knowledge 模块</h3>
<h4 data-id="heading-36">6.3.1 RAG 流程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant LLMNode
    participant KnowledgeSVC
    participant Embedding
    participant VectorDB
    participant Reranker
    
    LLMNode-&gt;&gt;KnowledgeSVC: Query(question)
    KnowledgeSVC-&gt;&gt;Embedding: Embed(question)
    Embedding--&gt;&gt;KnowledgeSVC: vector
    
    KnowledgeSVC-&gt;&gt;VectorDB: Search(vector, topK)
    VectorDB--&gt;&gt;KnowledgeSVC: candidates
    
    KnowledgeSVC-&gt;&gt;Reranker: Rerank(candidates, question)
    Reranker--&gt;&gt;KnowledgeSVC: top results
    
    KnowledgeSVC--&gt;&gt;LLMNode: context + references
    LLMNode-&gt;&gt;LLMNode: Build Prompt with context
</code></pre>
<hr/>
<h2 data-id="heading-37">7. 数据流分析：简单工作流示例</h2>
<h3 data-id="heading-38">7.1 场景描述</h3>
<p>我们分析一个<strong>最简单的 Workflow</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[开始]</span> → <span class="hljs-selector-attr">[大模型]</span> → <span class="hljs-selector-attr">[结束]</span>
</code></pre>
<p><strong>说明</strong>：本节以 <strong>OpenAPI 方式</strong>执行 Workflow 为例进行分析。Coze Studio 提供两套 API：</p>























<table><thead><tr><th>API 类型</th><th>路径前缀</th><th>用途</th><th>认证方式</th></tr></thead><tbody><tr><td><strong>OpenAPI</strong></td><td><code>/v1/</code></td><td>对外开放的 API，供第三方调用</td><td>API Key（Personal Access Token）</td></tr><tr><td><strong>内部 API</strong></td><td><code>/api/</code></td><td>Web 前端使用的内部 API</td><td>Session 认证</td></tr></tbody></table>
<p>本节重点分析 OpenAPI 的执行流程，因为它更完整地展示了认证、权限校验、版本控制等机制。</p>
<p><strong>Canvas JSON 结构</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"user_input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llm_1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llm"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{{user_input}}"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"exit"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"exit"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"inputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"connections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry.user_input"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llm_1.input"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llm_1.output"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"exit.output"</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-39">7.2 完整数据流图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "1. HTTP 请求入口（`backend/api/handler/coze/workflow_service.go`）"
        A1["POST /v1/workflow/run&lt;br/&gt;workflow_id:123&lt;br/&gt;input:user_input=Hello&lt;br/&gt;外部调用入口"]
    end
    
    subgraph "2. API 层（Hertz Handler）"
        B1["WorkflowExecuteHandler&lt;br/&gt;OpenAPI入口处理器"]
        B2["Parse Request Body&lt;br/&gt;解析请求体"]
        B3["Validate Parameters&lt;br/&gt;参数校验"]
    end
    
    subgraph "3. 应用层（`application/workflow`）"
        C1["WorkflowApp.Execute/OpenAPIRun&lt;br/&gt;应用服务编排"]
        C2["Build ExecuteConfig&lt;br/&gt;构建执行配置"]
        C3["Call Domain Service&lt;br/&gt;调用领域服务"]
    end
    
    subgraph "4. 领域层预处理（`domain/workflow`）"
        D1["WorkflowService.SyncExecute&lt;br/&gt;领域服务执行入口"]
        D2["Get Workflow Entity&lt;br/&gt;查询workflow_meta + version"]
        D3["Parse Canvas JSON&lt;br/&gt;转换为 WorkflowSchema"]
        D4["WorkflowSchema&lt;br/&gt;节点: entry/llm/exit&lt;br/&gt;连接关系/类型定义"]
    end
    
    subgraph "5. Compose 构建阶段（`domain/workflow/internal/compose`）"
        E1["compose.NewWorkflow&lt;br/&gt;初始化可执行图"]
        E2["AddNode: Entry&lt;br/&gt;输出 user_input"]
        E3["AddNode: LLM&lt;br/&gt;模型+Prompt配置"]
        E4["AddNode: Exit&lt;br/&gt;输入 output"]
        E5["Compile to Runner&lt;br/&gt;编译为 Eino Runner"]
    end
    
    subgraph "6. Execute 运行阶段"
        F1["Runner.Invoke&lt;br/&gt;输入user_input=Hello"]
        F2["Entry Node Execute&lt;br/&gt;发射 user_input"]
        F3["LLM Node Execute&lt;br/&gt;构建Prompt→调用LLM→拿到回复"]
        F4["Exit Node Execute&lt;br/&gt;收集最终输出"]
        F5["Return Final Output&lt;br/&gt;形成完整响应体"]
    end
    
    subgraph "7. 事件发射（`domain/workflow/internal/execute`）"
        G1["WorkflowStart Event&lt;br/&gt;工作流开始"]
        G2["NodeStart: entry"]
        G3["NodeSuccess: entry"]
        G4["NodeStart: llm_1"]
        G5["NodeSuccess: llm_1&lt;br/&gt;附带 token 使用"]
        G6["NodeStart: exit"]
        G7["NodeSuccess: exit"]
        G8["WorkflowSuccess Event&lt;br/&gt;总耗时 / 总 token"]
    end
    
    subgraph "8. HTTP 响应输出"
        H1["Build WorkflowExecution Entity&lt;br/&gt;构建执行记录 + token info"]
        H2["Return HTTP Response&lt;br/&gt;返回 code/data"]
    end
    
    A1 --&gt; B1
    B1 --&gt; B2
    B2 --&gt; B3
    B3 --&gt; C1
    
    C1 --&gt; C2
    C2 --&gt; C3
    C3 --&gt; D1
    
    D1 --&gt; D2
    D2 --&gt; D3
    D3 --&gt; D4
    D4 --&gt; E1
    
    E1 --&gt; E2
    E2 --&gt; E3
    E3 --&gt; E4
    E4 --&gt; E5
    E5 --&gt; F1
    
    F1 --&gt; F2
    F2 --&gt; F3
    F3 --&gt; F4
    F4 --&gt; F5
    
    F1 -.-&gt;|emit| G1
    F2 -.-&gt;|emit| G2
    F2 -.-&gt;|emit| G3
    F3 -.-&gt;|emit| G4
    F3 -.-&gt;|emit| G5
    F4 -.-&gt;|emit| G6
    F4 -.-&gt;|emit| G7
    F5 -.-&gt;|emit| G8
    
    F5 --&gt; H1
    H1 --&gt; H2
    
    style D4 fill:#e1f5ff
    style E5 fill:#fff4e1
    style F3 fill:#ffe0e0
    style G8 fill:#e8f5e9

</code></pre>
<h3 data-id="heading-40">7.3 详细执行步骤</h3>
<h4 data-id="heading-41">Step 1: HTTP 请求到达</h4>
<pre><code class="hljs language-http" lang="http">POST /v1/workflow/run HTTP/1.1
Content-Type: application/json
Authorization: Bearer &lt;API_KEY&gt;

{
  "workflow_id": "123",
  "parameters": "{\"user_input\": \"Hello, AI!\"}"
}
</code></pre>
<p><strong>说明</strong>：</p>
<ul>
<li>OpenAPI 使用 <code>/v1/workflow/run</code> 路径</li>
<li>需要 API Key 认证</li>
<li><code>parameters</code> 是 JSON 字符串格式</li>
</ul>
<h4 data-id="heading-42">Step 2: API Handler 处理</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/api/handler/coze/workflow_service.go</span>
<span class="hljs-comment">// OpenAPIRunFlow .</span>
<span class="hljs-comment">// @router /v1/workflow/run [POST]</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">OpenAPIRunFlow</span><span class="hljs-params">(ctx context.Context, c *app.RequestContext)</span></span> {
    <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>

    <span class="hljs-comment">// 预处理请求体</span>
    <span class="hljs-keyword">if</span> err = preprocessWorkflowRequestBody(ctx, c); err != <span class="hljs-literal">nil</span> {
        invalidParamRequestResponse(c, err.Error())
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 绑定和验证参数</span>
    <span class="hljs-keyword">var</span> req workflow.OpenAPIRunFlowRequest
    err = c.BindAndValidate(&amp;req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        invalidParamRequestResponse(c, err.Error())
        <span class="hljs-keyword">return</span>
    }
    
    <span class="hljs-comment">// 调用 Application Service</span>
    resp, err := appworkflow.SVC.OpenAPIRun(ctx, &amp;req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 处理 Workflow 特定错误</span>
        <span class="hljs-keyword">var</span> se vo.WorkflowError
        <span class="hljs-keyword">if</span> errors.As(err, &amp;se) {
            resp = <span class="hljs-built_in">new</span>(workflow.OpenAPIRunFlowResponse)
            resp.Code = <span class="hljs-type">int64</span>(se.OpenAPICode())
            resp.Msg = ptr.Of(se.Msg())
            debugURL := se.DebugURL()
            <span class="hljs-keyword">if</span> debugURL != <span class="hljs-string">""</span> {
                resp.DebugUrl = ptr.Of(debugURL)
            }
            c.JSON(consts.StatusOK, resp)
            <span class="hljs-keyword">return</span>
        }

        internalServerErrorResponse(ctx, c, err)
        <span class="hljs-keyword">return</span>
    }

    c.JSON(consts.StatusOK, resp)
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用 <code>OpenAPIRunFlowRequest</code></li>
<li>包含完整的错误处理逻辑</li>
<li>支持返回 debug URL</li>
</ul>
<h4 data-id="heading-43">Step 3: Application Service 编排</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/application/workflow/workflow.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *ApplicationService)</span></span> OpenAPIRun(ctx context.Context, req *workflow.OpenAPIRunFlowRequest) (
    _ *workflow.OpenAPIRunFlowResponse, err <span class="hljs-type">error</span>,
) {
    <span class="hljs-comment">// 1. 获取 API 认证信息</span>
    apiKeyInfo := ctxutil.GetApiAuthFromCtx(ctx)
    userID := apiKeyInfo.UserID

    <span class="hljs-comment">// 2. 解析参数</span>
    parameters := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any)
    <span class="hljs-keyword">if</span> req.Parameters != <span class="hljs-literal">nil</span> {
        err := sonic.UnmarshalString(*req.Parameters, &amp;parameters)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, vo.WrapError(errno.ErrInvalidParameter, err)
        }
    }

    <span class="hljs-comment">// 3. 获取 Workflow 元数据</span>
    meta, err := GetWorkflowDomainSVC().Get(ctx, &amp;vo.GetPolicy{
        ID:       mustParseInt64(req.GetWorkflowID()),
        MetaOnly: <span class="hljs-literal">true</span>,
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-comment">// 4. 检查是否已发布</span>
    <span class="hljs-keyword">if</span> meta.LatestPublishedVersion == <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, vo.NewError(errno.ErrWorkflowNotPublished)
    }

    <span class="hljs-comment">// 5. 权限检查</span>
    <span class="hljs-keyword">if</span> err = checkUserSpace(ctx, userID, meta.SpaceID); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-comment">// 6. 构建执行配置</span>
    exeCfg := workflowModel.ExecuteConfig{
        ID:            meta.ID,
        From:          workflowModel.FromSpecificVersion,
        Version:       *meta.LatestPublishedVersion,
        Operator:      userID,
        Mode:          workflowModel.ExecuteModeRelease,
        ConnectorID:   apiKeyInfo.ConnectorID,
        ConnectorUID:  strconv.FormatInt(userID, <span class="hljs-number">10</span>),
        InputFailFast: <span class="hljs-literal">true</span>,
        BizType:       workflowModel.BizTypeWorkflow,
    }

    <span class="hljs-comment">// 7. 判断同步/异步执行</span>
    <span class="hljs-keyword">if</span> req.GetIsAsync() {
        <span class="hljs-comment">// 异步执行</span>
        exeCfg.SyncPattern = workflowModel.SyncPatternAsync
        exeCfg.TaskType = workflowModel.TaskTypeBackground
        exeID, err := GetWorkflowDomainSVC().AsyncExecute(ctx, exeCfg, parameters)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">return</span> &amp;workflow.OpenAPIRunFlowResponse{
            ExecuteID: ptr.Of(strconv.FormatInt(exeID, <span class="hljs-number">10</span>)),
            DebugUrl:  ptr.Of(debugutil.GetWorkflowDebugURL(ctx, meta.ID, meta.SpaceID, exeID)),
        }, <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 8. 同步执行</span>
    exeCfg.SyncPattern = workflowModel.SyncPatternSync
    exeCfg.TaskType = workflowModel.TaskTypeForeground
    wfExe, tPlan, err := GetWorkflowDomainSVC().SyncExecute(ctx, exeCfg, parameters)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-comment">// 9. 构建返回结果</span>
    <span class="hljs-keyword">return</span> buildOpenAPIRunResponse(ctx, wfExe, tPlan, meta)
}
</code></pre>
<p><strong>关键流程</strong>：</p>
<ol>
<li>✅ API 认证和用户识别</li>
<li>✅ 参数解析（JSON 字符串 → map）</li>
<li>✅ Workflow 元数据获取</li>
<li>✅ 发布状态检查</li>
<li>✅ 权限校验</li>
<li>✅ 执行配置构建</li>
<li>✅ 支持同步/异步模式</li>
<li>✅ 调用 Domain Service 执行</li>
</ol>
<h4 data-id="heading-44">Step 4: Domain Service 执行</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/service/executable_impl.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(i *impl)</span></span> SyncExecute(ctx context.Context, config workflowModel.ExecuteConfig, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any) (*entity.WorkflowExecution, vo.TerminatePlan, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 获取 Workflow 实体</span>
    wfEntity, _ := i.Get(ctx, &amp;vo.GetPolicy{
        ID:    config.ID,
        QType: config.From,
    })
    
    <span class="hljs-comment">// 2. 解析 Canvas 为 Schema</span>
    canvas := &amp;vo.Canvas{}
    sonic.UnmarshalString(wfEntity.Canvas, canvas)
    workflowSC, _ := adaptor.CanvasToWorkflowSchema(ctx, canvas)
    
    <span class="hljs-comment">// 3. 创建 Workflow</span>
    wf, _ := compose.NewWorkflow(ctx, workflowSC, 
        compose.WithIDAsName(wfEntity.ID))
    
    <span class="hljs-comment">// 4. 准备执行上下文</span>
    cancelCtx, executeID, opts, lastEventChan, _ := compose.NewWorkflowRunner(
        wfEntity.GetBasic(), 
        workflowSC, 
        config,
        compose.WithInput(inputStr),
    ).Prepare(ctx)
    
    <span class="hljs-comment">// 5. 同步执行</span>
    startTime := time.Now()
    out, err := wf.SyncRun(cancelCtx, input, opts...)
    
    <span class="hljs-comment">// 6. 等待最后一个事件</span>
    lastEvent := &lt;-lastEventChan
    
    <span class="hljs-comment">// 7. 构建返回结果</span>
    <span class="hljs-keyword">return</span> &amp;entity.WorkflowExecution{
        ID:         executeID,
        WorkflowID: wfEntity.ID,
        Status:     entity.WorkflowSuccess,
        Output:     ptr.Of(outputStr),
        TokenInfo:  &amp;entity.TokenUsage{
            InputTokens:  lastEvent.GetInputTokens(),
            OutputTokens: lastEvent.GetOutputTokens(),
        },
        Duration:   lastEvent.Duration,
    }, wf.TerminatePlan(), <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-45">Step 5: Compose Layer 构建</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/compose/workflow.go (83-158行)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewWorkflow</span><span class="hljs-params">(ctx context.Context, sc *schema.WorkflowSchema, opts ...WorkflowOption)</span></span> (*Workflow, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 初始化 WorkflowSchema</span>
    sc.Init()
    
    <span class="hljs-comment">// 2. 创建 Workflow 实例</span>
    wf := &amp;Workflow{
        workflow:    compose.NewWorkflow[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any](
            compose.WithGenLocalState(GenState()),  <span class="hljs-comment">// 状态生成器</span>
        ),
        hierarchy:   sc.Hierarchy,
        connections: sc.Connections,
        schema:      sc,
    }
    
    <span class="hljs-comment">// 3. 设置执行模式</span>
    wf.streamRun = sc.RequireStreaming()        <span class="hljs-comment">// 是否需要流式输出</span>
    wf.requireCheckpoint = sc.RequireCheckpoint() <span class="hljs-comment">// 是否需要 Checkpoint</span>
    
    <span class="hljs-comment">// 4. 处理选项参数</span>
    wfOpts := &amp;workflowOptions{}
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {
        opt(wfOpts)
    }
    
    <span class="hljs-comment">// 5. 检查节点数量限制</span>
    <span class="hljs-keyword">if</span> wfOpts.maxNodeCount &gt; <span class="hljs-number">0</span> {
        <span class="hljs-keyword">if</span> sc.NodeCount() &gt; <span class="hljs-type">int32</span>(wfOpts.maxNodeCount) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"node count %d exceeds the limit: %d"</span>, 
                sc.NodeCount(), wfOpts.maxNodeCount)
        }
    }
    
    <span class="hljs-keyword">if</span> wfOpts.parentRequireCheckpoint {
        wf.requireCheckpoint = <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-comment">// 6. 设置 input/output 类型定义</span>
    wf.input = sc.GetNode(entity.EntryNodeKey).OutputTypes
    wf.output = sc.GetNode(entity.ExitNodeKey).InputTypes
    
    <span class="hljs-comment">// 7. 【第一轮】添加复合节点（CompositeNodes）</span>
    <span class="hljs-comment">//    复合节点包含内部子工作流，需要先构建</span>
    compositeNodes := sc.GetCompositeNodes()
    processedNodeKey := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[vo.NodeKey]<span class="hljs-keyword">struct</span>{})
    
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> compositeNodes {
        cNode := compositeNodes[i]
        <span class="hljs-keyword">if</span> err := wf.AddCompositeNode(ctx, cNode); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        
        <span class="hljs-comment">// 标记已处理的节点（父节点和子节点）</span>
        processedNodeKey[cNode.Parent.Key] = <span class="hljs-keyword">struct</span>{}{}
        <span class="hljs-keyword">for</span> _, child := <span class="hljs-keyword">range</span> cNode.Children {
            processedNodeKey[child.Key] = <span class="hljs-keyword">struct</span>{}{}
        }
    }
    
    <span class="hljs-comment">// 8. 【第二轮】添加普通节点（Entry, LLM, Exit 等）</span>
    <span class="hljs-comment">//    跳过已经作为复合节点处理的节点</span>
    <span class="hljs-keyword">for</span> _, ns := <span class="hljs-keyword">range</span> sc.Nodes {
        <span class="hljs-keyword">if</span> _, ok := processedNodeKey[ns.Key]; !ok {
            <span class="hljs-keyword">if</span> err := wf.AddNode(ctx, ns); err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
            }
        }
        
        <span class="hljs-comment">// 保存 Exit 节点的终止计划</span>
        <span class="hljs-keyword">if</span> ns.Type == entity.NodeTypeExit {
            wf.terminatePlan = ns.Configs.(*exit.Config).TerminatePlan
        }
    }
    
    <span class="hljs-comment">// 9. 编译成可执行的 Runner</span>
    <span class="hljs-keyword">var</span> compileOpts []compose.GraphCompileOption
    <span class="hljs-keyword">if</span> wf.requireCheckpoint {
        compileOpts = <span class="hljs-built_in">append</span>(compileOpts, 
            compose.WithCheckPointStore(workflow2.GetRepository()))
    }
    <span class="hljs-keyword">if</span> wfOpts.idAsName {
        compileOpts = <span class="hljs-built_in">append</span>(compileOpts, 
            compose.WithGraphName(strconv.FormatInt(wfOpts.wfID, <span class="hljs-number">10</span>)))
    }
    
    r, err := wf.Compile(ctx, compileOpts...)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    wf.Runner = r
    
    <span class="hljs-keyword">return</span> wf, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>节点添加流程（AddNode）</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/compose/workflow.go (216-280行)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *Workflow)</span></span> addNodeInternal(ctx context.Context, ns *schema.NodeSchema, 
    inner *innerWorkflowInfo) (<span class="hljs-keyword">map</span>[vo.NodeKey][]*compose.FieldMapping, <span class="hljs-type">error</span>) {
    
    key := ns.Key
    
    <span class="hljs-comment">// 1. 解析节点依赖关系</span>
    deps, err := w.resolveDependencies(key, ns.InputSources)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 2. 如果是复合节点，合并内部工作流的依赖</span>
    <span class="hljs-keyword">if</span> inner != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">if</span> err = deps.merge(inner.carryOvers); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
    }
    
    <span class="hljs-keyword">var</span> innerWorkflow compose.Runnable[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any]
    <span class="hljs-keyword">if</span> inner != <span class="hljs-literal">nil</span> {
        innerWorkflow = inner.inner
    }
    
    <span class="hljs-comment">// 3. 【核心】调用 node_builder.New() 创建节点实例</span>
    ins, err := New(ctx, ns, innerWorkflow, w.schema, deps, w.requireCheckpoint)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 4. 准备节点选项</span>
    <span class="hljs-keyword">var</span> opts []compose.GraphAddNodeOpt
    opts = <span class="hljs-built_in">append</span>(opts, compose.WithNodeName(<span class="hljs-type">string</span>(ns.Key)))
    
    <span class="hljs-comment">// 5. 添加前置处理器（preHandler）</span>
    preHandler := statePreHandler(ns, w.streamRun)
    <span class="hljs-keyword">if</span> preHandler != <span class="hljs-literal">nil</span> {
        opts = <span class="hljs-built_in">append</span>(opts, preHandler)
    }
    
    <span class="hljs-comment">// 6. 添加后置处理器（postHandler）</span>
    postHandler := statePostHandler(ns, w.streamRun)
    <span class="hljs-keyword">if</span> postHandler != <span class="hljs-literal">nil</span> {
        opts = <span class="hljs-built_in">append</span>(opts, postHandler)
    }
    
    <span class="hljs-comment">// 7. 将节点添加到 Workflow 图中</span>
    <span class="hljs-keyword">var</span> wNode *compose.WorkflowNode
    <span class="hljs-keyword">if</span> ins.Lambda != <span class="hljs-literal">nil</span> {
        wNode = w.AddLambdaNode(<span class="hljs-type">string</span>(key), ins.Lambda, opts...)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"node instance has no Lambda: %s"</span>, key)
    }
    
    <span class="hljs-comment">// 8. 处理数组钻取（array drill down）</span>
    <span class="hljs-keyword">if</span> err = deps.arrayDrillDown(w.schema.GetAllNodes()); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 9. 添加节点的输入连接（建立节点之间的数据流）</span>
    <span class="hljs-keyword">for</span> fromNodeKey := <span class="hljs-keyword">range</span> deps.inputsFull {
        wNode.AddInput(<span class="hljs-type">string</span>(fromNodeKey))
    }
    
    <span class="hljs-keyword">for</span> fromNodeKey, fieldMappings := <span class="hljs-keyword">range</span> deps.inputs {
        wNode.AddInput(<span class="hljs-type">string</span>(fromNodeKey), fieldMappings...)
    }
    
    <span class="hljs-keyword">for</span> fromNodeKey := <span class="hljs-keyword">range</span> deps.inputsNoDirectDependencyFull {
        wNode.AddInputWithOptions(<span class="hljs-type">string</span>(fromNodeKey), <span class="hljs-literal">nil</span>, 
            compose.WithNoDirectDependency())
    }
    
    <span class="hljs-keyword">for</span> fromNodeKey, fieldMappings := <span class="hljs-keyword">range</span> deps.inputsNoDirectDependency {
        wNode.AddInputWithOptions(<span class="hljs-type">string</span>(fromNodeKey), fieldMappings, 
            compose.WithNoDirectDependency())
    }
    
    <span class="hljs-comment">// ... 返回 carryOver 依赖</span>
}
</code></pre>
<p><strong>节点实例化（node_builder.New）</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/compose/node_builder.go (40-100行)</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(ctx context.Context, s *schema.NodeSchema,
    inner compose.Runnable[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any], // 内部工作流（复合节点用）
    sc *schema.WorkflowSchema,                               // 所属工作流 Schema
    deps *dependencyInfo,                                    // 依赖信息
    requireCheckpoint <span class="hljs-type">bool</span>,
)</span></span> (_ *Node, err <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> panicErr := <span class="hljs-built_in">recover</span>(); panicErr != <span class="hljs-literal">nil</span> {
            err = safego.NewPanicErr(panicErr, debug.Stack())
        }
        
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            err = vo.WrapIfNeeded(errno.ErrCreateNodeFail, err, 
                errorx.KV(<span class="hljs-string">"node_name"</span>, s.Name), 
                errorx.KV(<span class="hljs-string">"cause"</span>, err.Error()))
        }
    }()
    
    <span class="hljs-comment">// 1. 获取完整的数据源信息（如果节点需要）</span>
    <span class="hljs-keyword">var</span> fullSources <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*schema.SourceInfo
    <span class="hljs-keyword">if</span> m := entity.NodeMetaByNodeType(s.Type); m != <span class="hljs-literal">nil</span> &amp;&amp; m.InputSourceAware {
        <span class="hljs-keyword">if</span> fullSources, err = GetFullSources(s, sc, deps); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        s.FullSources = fullSources
    }
    
    <span class="hljs-comment">// 2. 【策略模式】检查 NodeSchema.Configs 是否实现了 NodeBuilder 接口</span>
    nb, ok := s.Configs.(schema.NodeBuilder)
    <span class="hljs-keyword">if</span> ok {
        <span class="hljs-comment">// 2.1 准备构建选项</span>
        opts := []schema.BuildOption{
            schema.WithWorkflowSchema(sc),
            schema.WithInnerWorkflow(inner),
        }
        
        <span class="hljs-comment">// 2.2 调用具体节点的 Build() 方法</span>
        <span class="hljs-comment">//     例如: LLMConfig.Build(), PluginConfig.Build() 等</span>
        n, err := nb.Build(ctx, s, opts...)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        
        <span class="hljs-comment">// 2.3 将节点包装成 Lambda（Eino 统一接口）</span>
        <span class="hljs-keyword">return</span> toNode(s, n), <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">// 3. 特殊节点类型处理</span>
    <span class="hljs-keyword">switch</span> s.Type {
    <span class="hljs-keyword">case</span> entity.NodeTypeLambda:
        <span class="hljs-comment">// 直接使用预定义的 Lambda</span>
        <span class="hljs-keyword">if</span> s.Lambda == <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"lambda is not defined for NodeTypeLambda"</span>)
        }
        <span class="hljs-keyword">return</span> &amp;Node{Lambda: s.Lambda}, <span class="hljs-literal">nil</span>
        
    <span class="hljs-keyword">case</span> entity.NodeTypeSubWorkflow:
        <span class="hljs-comment">// 构建子工作流</span>
        subWorkflow, err := buildSubWorkflow(ctx, s, requireCheckpoint)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">return</span> toNode(s, subWorkflow), <span class="hljs-literal">nil</span>
        
    <span class="hljs-keyword">default</span>:
        <span class="hljs-built_in">panic</span>(fmt.Sprintf(<span class="hljs-string">"node schema's Configs does not implement NodeBuilder. type: %v"</span>, s.Type))
    }
}
</code></pre>
<p><strong>LLM 节点构建示例（Build 方法）</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/nodes/llm/llm.go</span>
<span class="hljs-comment">// LLMConfig 实现了 schema.NodeBuilder 接口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *LLMConfig)</span></span> Build(ctx context.Context, ns *schema.NodeSchema, 
    opts ...schema.BuildOption) (schema.InvokableNode, <span class="hljs-type">error</span>) {
    
    <span class="hljs-comment">// 1. 构建 ChatModel</span>
    chatModel, err := modelbuilder.NewChatModel(ctx, c.Model, c.ModelConfig)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 2. 构建 Prompt Template</span>
    <span class="hljs-comment">//    将配置中的 Messages 转换为可执行的模板</span>
    <span class="hljs-comment">//    例如: "{{user_input}}" -&gt; 可替换的模板变量</span>
    promptTpl := buildPromptTemplate(c.Messages)
    
    <span class="hljs-comment">// 3. 创建 LLM Chain</span>
    chain := compose.NewChain[<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, *schema.Message]()
    chain.AppendPrompt(promptTpl)
    chain.AppendChatModel(chatModel)
    
    <span class="hljs-comment">// 4. 返回 LLMNode（实现了 InvokableNode 接口）</span>
    <span class="hljs-keyword">return</span> &amp;LLMNode{
        config:    c,
        chain:     chain,
        chatModel: chatModel,
    }, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// LLMNode 的 Invoke 方法（运行时执行）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *LLMNode)</span></span> Invoke(ctx context.Context, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any) (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 执行 Prompt -&gt; ChatModel Chain</span>
    <span class="hljs-comment">//    input = {user_input: "Hello, AI!"}</span>
    <span class="hljs-comment">//    -&gt; Prompt 渲染 -&gt; ChatModel API 调用</span>
    msg, err := n.chain.Invoke(ctx, input)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
        
    <span class="hljs-comment">// 2. 返回输出</span>
    <span class="hljs-comment">//    {output: "Hi there! How can I help you?"}</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{<span class="hljs-string">"output"</span>: msg.Content}, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>关键流程总结</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[NewWorkflow] --&gt; B[sc.Init 初始化]
    B --&gt; C[创建 Workflow 实例]
    C --&gt; D[设置 streamRun/requireCheckpoint]
    D --&gt; E[第一轮: AddCompositeNode]
    E --&gt; F[第二轮: AddNode 普通节点]
    
    F --&gt; G[addNodeInternal]
    G --&gt; H[resolveDependencies 解析依赖]
    H --&gt; I["node_builder.New() 创建实例"]
    
    I --&gt; J{Configs 实现 NodeBuilder?}
    J --&gt;|是| K[调用 Build 方法]
    J --&gt;|否| L[特殊类型处理]
    
    K --&gt; M[toNode 包装成 Lambda]
    L --&gt; M
    
    M --&gt; N[AddLambdaNode 添加到图]
    N --&gt; O[AddInput 连接数据流]
    
    F --&gt; P[Compile 编译]
    P --&gt; Q[生成 Runner]
    
    style I fill:#ffe0e0
    style K fill:#e1f5ff
    style P fill:#e8f5e9
</code></pre>
<h4 data-id="heading-46">Step 6: Runtime 执行</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// &gt; - `backend/domain/workflow/internal/compose/workflow.go` → `Workflow.SyncRun()` / `Workflow.Runner.Invoke()`</span>
<span class="hljs-comment">// &gt; - `github.com/cloudwego/eino/compose/runnable.go` → `runner.Run()`（节点调度与回调触发）</span>
<span class="hljs-comment">// Eino Framework 内部执行流程</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Runner)</span></span> Invoke(ctx context.Context, input <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, opts ...Option) (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. Emit WorkflowStart Event</span>
    callbacks.OnStart(ctx, &amp;callbacks.RunInfo{
        Name: <span class="hljs-string">"workflow_123"</span>,
        Type: <span class="hljs-string">"workflow"</span>,
    })
    
    state := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{}
    
    <span class="hljs-comment">// 2. 按拓扑顺序执行节点</span>
    <span class="hljs-keyword">for</span> _, node := <span class="hljs-keyword">range</span> r.sortedNodes {
        <span class="hljs-comment">// 2.1 Entry Node</span>
        <span class="hljs-keyword">if</span> node.Key == <span class="hljs-string">"entry"</span> {
            callbacks.OnStart(ctx, &amp;callbacks.RunInfo{Name: <span class="hljs-string">"entry"</span>})
            state[<span class="hljs-string">"user_input"</span>] = input[<span class="hljs-string">"user_input"</span>]  <span class="hljs-comment">// "Hello, AI!"</span>
            callbacks.OnEnd(ctx, &amp;callbacks.RunInfo{Name: <span class="hljs-string">"entry"</span>})
        }
        
        <span class="hljs-comment">// 2.2 LLM Node</span>
        <span class="hljs-keyword">if</span> node.Key == <span class="hljs-string">"llm_1"</span> {
            callbacks.OnStart(ctx, &amp;callbacks.RunInfo{Name: <span class="hljs-string">"llm_1"</span>})
            
            <span class="hljs-comment">// 获取输入</span>
            nodeInput := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{
                <span class="hljs-string">"user_input"</span>: state[<span class="hljs-string">"user_input"</span>],
            }
            
            <span class="hljs-comment">// 执行 LLM Lambda</span>
            nodeOutput, _ := node.Lambda(ctx, nodeInput)
            <span class="hljs-comment">// nodeOutput = {output: "Hi there! How can I help you?"}</span>
            
            state[<span class="hljs-string">"llm_1_output"</span>] = nodeOutput[<span class="hljs-string">"output"</span>]
            
            callbacks.OnEnd(ctx, &amp;callbacks.RunInfo{
                Name: <span class="hljs-string">"llm_1"</span>,
                Extra: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{
                    <span class="hljs-string">"input_tokens"</span>: <span class="hljs-number">10</span>,
                    <span class="hljs-string">"output_tokens"</span>: <span class="hljs-number">8</span>,
                },
            })
        }
        
        <span class="hljs-comment">// 2.3 Exit Node</span>
        <span class="hljs-keyword">if</span> node.Key == <span class="hljs-string">"exit"</span> {
            callbacks.OnStart(ctx, &amp;callbacks.RunInfo{Name: <span class="hljs-string">"exit"</span>})
            output := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{
                <span class="hljs-string">"output"</span>: state[<span class="hljs-string">"llm_1_output"</span>],
            }
            callbacks.OnEnd(ctx, &amp;callbacks.RunInfo{Name: <span class="hljs-string">"exit"</span>})
            
            callbacks.OnEnd(ctx, &amp;callbacks.RunInfo{
                Name: <span class="hljs-string">"workflow_123"</span>,
                Type: <span class="hljs-string">"workflow"</span>,
            })
            
            <span class="hljs-keyword">return</span> output, <span class="hljs-literal">nil</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-47">Step 7: 事件流</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Runner
    participant Callback
    participant EventChan
    participant Handler
    
    Runner-&gt;&gt;Callback: OnStart(workflow_123)
    Callback-&gt;&gt;EventChan: WorkflowStart
    
    Runner-&gt;&gt;Callback: OnStart(entry)
    Callback-&gt;&gt;EventChan: NodeStart(entry)
    Runner-&gt;&gt;Callback: OnEnd(entry)
    Callback-&gt;&gt;EventChan: NodeSuccess(entry)
    
    Runner-&gt;&gt;Callback: OnStart(llm_1)
    Callback-&gt;&gt;EventChan: NodeStart(llm_1)
    Note over Runner: Call LLM API...
    Runner-&gt;&gt;Callback: OnEnd(llm_1, tokens)
    Callback-&gt;&gt;EventChan: NodeSuccess(llm_1)
    
    Runner-&gt;&gt;Callback: OnStart(exit)
    Callback-&gt;&gt;EventChan: NodeStart(exit)
    Runner-&gt;&gt;Callback: OnEnd(exit)
    Callback-&gt;&gt;EventChan: NodeSuccess(exit)
    
    Runner-&gt;&gt;Callback: OnEnd(workflow_123)
    Callback-&gt;&gt;EventChan: WorkflowSuccess
    EventChan-&gt;&gt;Handler: lastEvent
</code></pre>
<p><strong>事件处理代码</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/domain/workflow/internal/execute/event_handle.go</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(ctx context.Context, event *Event, repo workflow.Repository,
    sw *schema.StreamWriter[*entity.Message])</span></span> (signal terminateSignal, err <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">switch</span> event.Type {
    <span class="hljs-keyword">case</span> WorkflowStart:
        <span class="hljs-comment">// ① WorkflowStart：创建/更新 workflow_execution，标记为 Running，</span>
        <span class="hljs-comment">//    并将“正在运行”状态推送给前端（如果是流式执行）。</span>
    <span class="hljs-keyword">case</span> NodeStart:
        <span class="hljs-comment">// ② NodeStart：写入 node_execution（包含输入、节点类型等），用于后续追踪。</span>
        nodeExec := &amp;entity.NodeExecution{
            ID:        event.NodeExecuteID,
            ExecuteID: event.RootCtx.RootExecuteID,
            NodeID:    <span class="hljs-type">string</span>(event.NodeKey),
            NodeName:  event.NodeName,
            NodeType:  event.NodeType,
            Status:    entity.NodeRunning,
            Input:     ptr.Of(mustMarshalToString(event.Input)),
        }
        <span class="hljs-keyword">if</span> err = repo.CreateNodeExecution(ctx, nodeExec); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> noTerminate, fmt.Errorf(<span class="hljs-string">"failed to create node execution: %v"</span>, err)
        }
    <span class="hljs-keyword">case</span> NodeEnd, NodeEndStreaming:
        <span class="hljs-comment">// ③ NodeEnd：记录节点的执行结果、耗时、token 消耗、输出内容等。</span>
        nodeExec := &amp;entity.NodeExecution{
            ID:       event.NodeExecuteID,
            Status:   entity.NodeSuccess,
            Duration: event.Duration,
            TokenInfo: &amp;entity.TokenUsage{
                InputTokens:  event.GetInputTokens(),
                OutputTokens: event.GetOutputTokens(),
            },
            Extra: event.extra,
        }
        <span class="hljs-keyword">if</span> event.outputStr != <span class="hljs-literal">nil</span> {
            nodeExec.Output = event.outputStr
        } <span class="hljs-keyword">else</span> {
            nodeExec.Output = ptr.Of(mustMarshalToString(event.Output))
            nodeExec.RawOutput = event.RawOutput
        }
        <span class="hljs-keyword">if</span> err = repo.UpdateNodeExecution(ctx, nodeExec); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> noTerminate, fmt.Errorf(<span class="hljs-string">"failed to save node execution: %v"</span>, err)
        }
        <span class="hljs-keyword">if</span> event.NodeType == entity.NodeTypeExit &amp;&amp; event.SubWorkflowCtx == <span class="hljs-literal">nil</span> {
            <span class="hljs-comment">// Exit 节点完成，标记“最后一个节点已结束”，等待 WorkflowSuccess 事件最终确认。</span>
            <span class="hljs-keyword">return</span> lastNodeDone, <span class="hljs-literal">nil</span>
        }
    <span class="hljs-keyword">case</span> WorkflowSuccess:
        <span class="hljs-comment">// ④ WorkflowSuccess：根工作流成功完成，等待 Exit 节点处理完后统一收尾。</span>
        <span class="hljs-keyword">return</span> workflowSuccess, <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">case</span> WorkflowFailed:
        <span class="hljs-comment">// ⑤ WorkflowFailed：更新 workflow_execution 状态为失败，并将错误信息写入 node_execution。</span>
    <span class="hljs-keyword">default</span>:
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"unimplemented event type: "</span> + event.Type)
    }
    <span class="hljs-keyword">return</span> noTerminate, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HandleExecuteEvent</span><span class="hljs-params">(ctx context.Context, wfExeID <span class="hljs-type">int64</span>, eventChan &lt;-<span class="hljs-keyword">chan</span> *Event,
    cancelFn, timeoutFn context.CancelFunc, repo workflow.Repository,
    sw *schema.StreamWriter[*entity.Message], exeCfg workflowModel.ExecuteConfig)</span></span> (event *Event) {
    handler := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(event *Event)</span></span> *Event {
        signal, err := handleEvent(ctx, event, repo, sw)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            logs.CtxErrorf(ctx, <span class="hljs-string">"failed to handle event: %v"</span>, err)
        }
        <span class="hljs-keyword">switch</span> signal {
        <span class="hljs-keyword">case</span> workflowSuccess:
            <span class="hljs-comment">// ⑥ WorkflowSuccess：如果 Exit 节点也已完成，就调用 setRootWorkflowSuccess</span>
            <span class="hljs-comment">//    写入 workflow_execution（最终输出、token、耗时等）。</span>
            <span class="hljs-keyword">if</span> lastNodeIsDone || exeCfg.Mode == workflowModel.ExecuteModeNodeDebug {
                _ = setRootWorkflowSuccess(ctx, event, repo, sw)
                <span class="hljs-keyword">return</span> event
            }
        <span class="hljs-keyword">case</span> lastNodeDone:
            <span class="hljs-comment">// ⑦ Exit 节点完成：若之前已经收到 workflowSuccess，就立即收尾；否则等待。</span>
            lastNodeIsDone = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">if</span> wfSuccessEvent != <span class="hljs-literal">nil</span> {
                _ = setRootWorkflowSuccess(ctx, wfSuccessEvent, repo, sw)
                <span class="hljs-keyword">return</span> wfSuccessEvent
            }
        <span class="hljs-keyword">case</span> workflowAbort:
            <span class="hljs-comment">// ⑧ workflowAbort：出现取消/失败，直接返回最后一条事件。</span>
            <span class="hljs-keyword">return</span> event
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
    ...
}

</code></pre>
<h4 data-id="heading-48">Step 8: 返回结果</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//`backend/application/workflow/workflow.go` → `ApplicationService.OpenAPIRun`</span>

<span class="hljs-comment">// 异步执行：只返回 execute_id + debug_url</span>
<span class="hljs-keyword">if</span> req.GetIsAsync() {
    exeCfg.SyncPattern = workflowModel.SyncPatternAsync
    exeCfg.TaskType = workflowModel.TaskTypeBackground
    exeID, err := GetWorkflowDomainSVC().AsyncExecute(ctx, exeCfg, parameters)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> &amp;workflow.OpenAPIRunFlowResponse{
        ExecuteID: ptr.Of(strconv.FormatInt(exeID, <span class="hljs-number">10</span>)),
        DebugUrl:  ptr.Of(debugutil.GetWorkflowDebugURL(ctx, meta.ID, meta.SpaceID, exeID)),
    }, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// 同步执行：返回执行结果 + token + debug_url</span>
exeCfg.SyncPattern = workflowModel.SyncPatternSync
exeCfg.TaskType = workflowModel.TaskTypeForeground
wfExe, tPlan, err := GetWorkflowDomainSVC().SyncExecute(ctx, exeCfg, parameters)
...
<span class="hljs-keyword">return</span> &amp;workflow.OpenAPIRunFlowResponse{
    Data:      data,                                     <span class="hljs-comment">// 输出内容（answer 或变量）</span>
    ExecuteID: ptr.Of(strconv.FormatInt(wfExe.ID, <span class="hljs-number">10</span>)),  <span class="hljs-comment">// 执行 ID</span>
    DebugUrl:  ptr.Of(debugutil.GetWorkflowDebugURL(ctx, meta.ID, wfExe.SpaceID, wfExe.ID)),
    Token:     ptr.Of(wfExe.TokenInfo.InputTokens + wfExe.TokenInfo.OutputTokens),
    Cost:      ptr.Of(<span class="hljs-string">"0.00000"</span>),
}, <span class="hljs-literal">nil</span>
</code></pre>
<p><strong>字段含义</strong>：</p>
<ul>
<li><code>ExecuteID</code>：这次执行的唯一 ID，便于查询历史或调试。</li>
<li><code>Data</code>：工作流输出（当 terminate plan 是 <code>ReturnVariables</code> 时直接返回变量，否则封装成标准 answer 结构）。</li>
<li><code>Token</code>：累计 token 消耗（输入 + 输出）。</li>
<li><code>DebugUrl</code>：一键跳转调试页，便于复现。</li>
<li><code>Cost</code>：预留的计费字段，目前固定 <code>0.00000</code>。</li>
<li>异步场景不直接返回数据，只提供 <code>execute_id</code> + <code>debug_url</code>，由客户端轮询结果。</li>
</ul>
<h2 data-id="heading-49">8. 总结与展望</h2>
<p>在梳理 Coze Studio 后端的过程中可以看到，它已经具备一套相对完善的 DDD 分层和跨域治理能力：</p>
<ul>
<li>API 层负责契约与安全</li>
<li>Application 层掌控用例编排</li>
<li>Domain 层沉淀业务模型</li>
<li>Crossdomain / Infra 撑起跨上下文协作和基础设施抽象。</li>
</ul>
<p>这种“骨架＋血液”的分层让我们在阅读代码时始终能找到明确的职责线索，也解释了为什么工作流、插件、知识库这些复杂模块仍能保持可演化性。</p>
<p>整体来看，Coze Studio 的架构基础已经打好，接下来更像是在“好地基”上不断加砖：稳定性、可观测性、跨团队协作能力都会决定它能否支撑规模化的 AI 工作流生产。只要保持代码与文档同频、持续打磨开发者体验，这个平台就有机会成长为开源 AI Agent 体系里的“参考实现”。</p>
<p>后续会分享更多的 coze-studio 源码中值得我们学习的架构和编码思维，并且后续会跟着分享源码的过程中，对coze studio 进行二次开发，比如开发 mcp 插件(其实已经开发出来了，只是还没来得及以文章的方式来与大家见面，可以先给大家预览下二次开发后的效果在文章开头)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coco AI 参选 Gitee 2025 最受欢迎开源软件！您的每一票，都是对中国开源的硬核支持]]></title>    <link>https://juejin.cn/post/7573535624532459539</link>    <guid>https://juejin.cn/post/7573535624532459539</guid>    <pubDate>2025-11-17T15:38:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573535624532459539" data-draft-id="7573525634212659243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coco AI 参选 Gitee 2025 最受欢迎开源软件！您的每一票，都是对中国开源的硬核支持"/> <meta itemprop="keywords" content="开源,人工智能"/> <meta itemprop="datePublished" content="2025-11-17T15:38:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极限实验室"/> <meta itemprop="url" content="https://juejin.cn/user/1258294223312599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coco AI 参选 Gitee 2025 最受欢迎开源软件！您的每一票，都是对中国开源的硬核支持
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258294223312599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极限实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:38:20.000Z" title="Mon Nov 17 2025 15:38:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>「<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource" target="_blank" title="https://gitee.com/activity/2025opensource" ref="nofollow noopener noreferrer">Gitee 2025 年度开源项目评选</a>」火热进行中！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22066ca91ee2435296b5ce69a0fa74fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=tX0kjrUYRlNC%2Fzu%2B5irdl40UBgE%3D" alt="" loading="lazy"/></p>
<p>Coco AI 正在参加 Gitee 2025 最受欢迎的开源软件投票活动， 👉 快来给我投票吧！一起见证中国开源力量，谢谢你宝贵的一票！</p>
<p>点击 直达链接，进入投票页面：</p>
<p>投票直达链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource%3Fident%3DIEZ3FS" target="_blank" title="https://gitee.com/activity/2025opensource?ident=IEZ3FS" ref="nofollow noopener noreferrer">gitee.com/activity/20…</a></p>
<h2 data-id="heading-0">🥥 什么是 Coco AI</h2>
<p>Coco AI 是 极限科技（INFINI Labs） 重磅推出一款完全开源、跨平台的企业级智能搜索与助手系统，专为现代企业打造。它通过统一搜索入口，连接企业内外部的异构数据源，融合大模型能力，帮助团队高效访问知识，智能决策协作。</p>
<p>Coco 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs" target="_blank" title="https://coco.rs" ref="nofollow noopener noreferrer">coco.rs</a></p>
<p>Gitee 主页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://gitee.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">gitee.com/infinilabs/…</a> (来个 Star ⭐️ 吧)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6efac84e3e847c3a66a851d3e734b27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=yo4VY3zHWkyBgTXIjnoIFgr80Gg%3D" alt="" loading="lazy"/></p>
<p>Coco Demo 视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1yKT7zoEed%2F" target="_blank" title="https://www.bilibili.com/video/BV1yKT7zoEed/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1yK…</a></p>
<p>👉 快来给我投票吧！麻烦大家动动发财手，支持一下，谢谢！！！</p>
<h2 data-id="heading-1">如何投票?</h2>
<p>打开 Gitee 活动页面，搜索框输入 <strong>infini</strong>，找到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource%3Fident%3DIEZ3FS" target="_blank" title="https://gitee.com/activity/2025opensource?ident=IEZ3FS" ref="nofollow noopener noreferrer">Coco</a> 项目，即可参与投票。</p>
<p>同时也欢迎给 INFINI Labs 开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource%3Fident%3DIJQSSC" target="_blank" title="https://gitee.com/activity/2025opensource?ident=IJQSSC" ref="nofollow noopener noreferrer">analysis-ik</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource%3Fident%3DI16IWY" target="_blank" title="https://gitee.com/activity/2025opensource?ident=I16IWY" ref="nofollow noopener noreferrer">gateway</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource%3Fident%3DI0CVMB" target="_blank" title="https://gitee.com/activity/2025opensource?ident=I0CVMB" ref="nofollow noopener noreferrer">console</a> 投票。</p>
<p>活动链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Factivity%2F2025opensource" target="_blank" title="https://gitee.com/activity/2025opensource" ref="nofollow noopener noreferrer">gitee.com/activity/20…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e855b00630644d4da20155d05f99e4af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=zwAiwDTnl1JRXhLvux8E8WYcwTs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3da6291231a048c4a430732e4c144968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=3eo6Xj8p8KXao1NU2AVipgxxHHY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/736803bfc5c54b4abb492d9a223c20ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=QCEgPkzetUnmzh3ph15x6fSxdk8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">🎁 投票福利</h2>
<p>添加小助手微信（INFINI-Labs）提供「已投票」截图，加入抽奖群，抽 5 位送 Coco AI 定制 T 恤 或 暖冬时尚围巾，抽奖礼品将在公示后 15 个工作日内寄送。</p>
<p>投票截止日期：2026-01-09<br/>
抽奖日期：2026-01-10</p>
<p><strong>抽奖礼品</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d911414ecead481084577f172652ea5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=QSEj5rsc3QtKdX4yNWOWfi0pZVg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">关于极限科技（INFINI Labs）</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04104a155dd84c5e8de175b492caf98e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763998700&amp;x-signature=7sNDOuxKNImxzEaFZFfYJC9rwmU%3D" alt="INFINI Labs" loading="lazy"/></p>
<p>极限科技，全称极限数据（北京）科技有限公司，是一家专注于实时搜索与数据分析的软件公司。旗下品牌极限实验室（INFINI Labs）致力于打造极致易用的数据探索与分析体验。</p>
<p>极限科技是一支年轻的团队，采用天然分布式的方式来进行远程协作，员工分布在全球各地，希望通过努力成为中国乃至全球企业大数据实时搜索分析产品的首选，为中国技术品牌输出添砖加瓦。</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn" target="_blank" title="https://infinilabs.cn" ref="nofollow noopener noreferrer">infinilabs.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【AI编程】用Codebuddy+lighthouse开发AI年龄模拟网站]]></title>    <link>https://juejin.cn/post/7573524348130017343</link>    <guid>https://juejin.cn/post/7573524348130017343</guid>    <pubDate>2025-11-17T15:53:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573524348130017343" data-draft-id="7573524348130000959" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【AI编程】用Codebuddy+lighthouse开发AI年龄模拟网站"/> <meta itemprop="keywords" content="后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-17T15:53:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卷福同学"/> <meta itemprop="url" content="https://juejin.cn/user/3456520291098686"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【AI编程】用Codebuddy+lighthouse开发AI年龄模拟网站
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3456520291098686/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卷福同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T15:53:47.000Z" title="Mon Nov 17 2025 15:53:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.效果</h2>
<p>在线体验地址：<a href="https://link.juejin.cn?target=http%3A%2F%2F118.25.80.25%3A8080%2F" target="_blank" title="http://118.25.80.25:8080/" ref="nofollow noopener noreferrer">http://118.25.80.25:8080/</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46fdfd3af5894a8b8fa5f3351480eeb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763999627&amp;x-signature=bwV8Q6ssN6dGJqVoxq%2FczNnucjg%3D" alt="0.png" loading="lazy"/></p>
<p>（体验额度有限，用完就没了）</p>
<h2 data-id="heading-1">2.开发教程</h2>
<p>我们这里使用Codebuddy国际版进行开发，目前Codebuddy Pro已经需要付费了，现在付费还可以领取一个月的lighthouse轻量级服务器，属于性价比拉满。为了能继续体验AI编程的乐趣，小卷先开一个月的Pro试试水</p>
<p>下载和开会员地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codebuddy.ai%2Fpricing" target="_blank" title="https://www.codebuddy.ai/pricing" ref="nofollow noopener noreferrer">www.codebuddy.ai/pricing</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be4124f503d24cefbdb15843248863ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763999627&amp;x-signature=K7yO6yKFL725ZBR3RYnK1jnO7OU%3D" alt="1.png" loading="lazy"/></p>
<p>接着就可以开启我们的Vibe Coding之旅了，整体步骤如下：</p>
<p>1.先获取人像年龄转换的在线API</p>
<p>2.提供API和接口文档给Codebuddy，进行AI编程</p>
<p>3.测试体验通过后适配手机端页面</p>
<h2 data-id="heading-2">3.AI编程</h2>
<p>由于不知道有哪些网站提供人像年龄转换的功能API，我们直接和Codebuddy对话就行</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51c7d9df8d0f4c638310f4572dd11eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763999627&amp;x-signature=P7hrMNTmI3Hx8NkbmV69BJw0Q%2F4%3D" alt="2.png" loading="lazy"/></p>
<p>它会自行搜索相关内容和文档后，在进行开发</p>
<p>整个过程耗时还是比较久的，期间还出现了很多问题，这里就不记流水账了，只列出关键问题解法：</p>
<p>（1）AI自己找的人像转换API文档不对，开发报错</p>
<p>解决：我们找到腾讯云官方的人脸年龄变化API文档，丢给AI，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdocument%2Fproduct%2F1202%2F41968" target="_blank" title="https://cloud.tencent.com/document/product/1202/41968" ref="nofollow noopener noreferrer">cloud.tencent.com/document/pr…</a></p>
<p>（2）网站开发完成后上传图片报错</p>
<p>这种属于AI编程常见的功能错误了，把报错信息丢给AI，让其自行解决就行。PS：报错是一个接着一个，小卷解决这些报错差不多用了半小时</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79941c0cff414a0fa95de32b71c2935d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763999627&amp;x-signature=i%2FA970LY7TFhUk%2Bk2r9mMVCTj5s%3D" alt="3.png" loading="lazy"/></p>
<p>（3）人脸年龄变化功能需要付费</p>
<p>只能多花点米开通了。。。</p>
<p>计费说明：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdocument%2Fproduct%2F1202%2F45860" target="_blank" title="https://cloud.tencent.com/document/product/1202/45860" ref="nofollow noopener noreferrer">cloud.tencent.com/document/pr…</a></p>
<p>（4）需要提供腾讯云的SecretId和SecretKey</p>
<p>解决：登录腾讯云网站，打开密钥管理，新建个密钥就行了</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fcam%2Fcapi" target="_blank" title="https://console.cloud.tencent.com/cam/capi" ref="nofollow noopener noreferrer">console.cloud.tencent.com/cam/capi</a></p>
<p>最后，经历了一番折腾后，网站终于开发完成，接着我们就需要把它部署上lighthouse就行</p>
<h2 data-id="heading-3">4.部署</h2>
<p>我们点击对话框上面的配置集成按钮，选择Tencent Lighthouse</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b94e51a03f7d49ad9e5f4aaf522de58a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763999627&amp;x-signature=jWc%2BZ3N47wvQQSKOd3S0SIlr9GI%3D" alt="4.png" loading="lazy"/></p>
<p>这一步，因为我们开通了Pro会员，可以白领一个月的lighthouse轻量级服务器用，所以第一次用的时候，根据提示操作就行，Codebuddy会自行把代码部署到服务器上，等待一会就部署完毕了。</p>
<p>最后，对比了下之前用过的Cursor，Claude Code这些工具，Codebuddy最大的优势是和腾讯云的产品都打通了，想做小程序、腾讯云网站等等都非常方便的，可以说用起来非常简单快捷。</p>
<p>总之总之，这次 CodeBuddy 的体验既痛苦又有收获，很多事情只要开始做了，就会发现其实没那么难。</p>
<p>[#CodeBuddy]</p>
<p>[#CodeBuddyIDE]</p>
<p>[#CodeBuddyCode]</p>
<p>[#无界生成力]</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再只会 mvn install 了！深入拆解 Maven 插件核心原理]]></title>    <link>https://juejin.cn/post/7573468493570244644</link>    <guid>https://juejin.cn/post/7573468493570244644</guid>    <pubDate>2025-11-17T13:24:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493570244644" data-draft-id="7573524348129476671" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再只会 mvn install 了！深入拆解 Maven 插件核心原理"/> <meta itemprop="keywords" content="maven,Java"/> <meta itemprop="datePublished" content="2025-11-17T13:24:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮皮林551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再只会 mvn install 了！深入拆解 Maven 插件核心原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮皮林551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:24:04.000Z" title="Mon Nov 17 2025 13:24:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>一、Maven与Maven插件</strong></h3>
<p>确切的说，我们日常提及的“Maven”实际上只是Maven插件集合的核心框架。而插件才是执行实际操作的东西，插件可以用于：<strong>创建jar文件、创建war文件、编译代码、单元测试代码、创建项目文档等等。</strong></p>
<p>几乎所有您能想到的在项目中执行的操作都是通过Maven插件实现的。而我们安装的maven仅仅是为插件的运行提供一个管理框架</p>
<p>我们在打开一个maven管理的工程时，通常能在其POM文件中看到这样的内容</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 其他配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">skip</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skip</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<p>这其中 plugins 的内容就是所谓的Maven插件。当然，Maven有自己的标准插件，所以即使一个项目没有显式的引用Maven插件，也能执行一些基础的mvn命令，如clean、compile等。但是这个时候是默认配置。</p>
<p>所以如果你想有自己的配置，或者是有特定的目标，就需要显示的指定与配置plugins 了。</p>
<h3 data-id="heading-1"><strong>二、maven 插件使用举例</strong></h3>
<h4 data-id="heading-2"><strong>1. flatten-maven-plugin</strong></h4>
<h5 data-id="heading-3"><strong>① 插件配置</strong></h5>
<p>以我们一个实际项目为例，由于项目比较大，而且多模块互相引用，所以使得jar包也嵌套层数过高，那么工程版本管理就很繁琐，这个时候我们就可以使用 <code>flatten-maven-plugin</code> 这个插件，这个插件的作用是将项目的依赖打平（flatten），将所有依赖的版本号都解析并嵌入到POM文件中</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flatten-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">flattenMode</span>&gt;</span>resolveCiFriendliesOnly<span class="hljs-tag">&lt;/<span class="hljs-name">flattenMode</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">updatePomFile</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">updatePomFile</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ignoreTransitiveDependencies</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">ignoreTransitiveDependencies</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>flatten<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>generate-resources<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>flatten<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>flatten.clean<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>clean<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>clean<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>上面的一些配置解释如下：</p>
<ul>
<li><strong>outputDirectory:</strong>  指定扁平化后的 POM 文件输出的目录</li>
<li><strong>flattenMode:</strong>  指定扁平化的模式为 <code>resolveCiFriendliesOnly</code>, 项目中可能含有 <code>${revision}</code>、 <code>${sha1}</code> 、 <code>${changelist}</code> 这种占位符，可以在mvn命令中直接使用<code>mvn -Drevision=2.0.0-SNAPSHOT clean package</code>，来在命令中为这些占位符赋值，并进行后续操作</li>
<li><strong>updatePomFile:</strong>  表示会更新生成的扁平化 POM 文件</li>
<li><strong>ignoreTransitiveDependencies:</strong>  忽略传递依赖，确保这些依赖不被包含在最终的扁平化 POM 中</li>
</ul>
<p>除此以外，我们还定义了两个 <code>execution</code>，分别用于执行 flatten 以及 clean 操作。这样配置后，当执行 <code>mvn generate-resources</code> 时，会触发 flatten 操作，将项目的依赖进行扁平化处理。而执行 <code>mvn clean</code> 时，会执行 clean 操作，清理生成的扁平化文件。</p>
<h5 data-id="heading-4"><strong>② 作用</strong></h5>
<p>当我们经过上述配置后，当我们进行打包等操作时，触发 <code>generate-resources</code> 步骤，就能正常运行的插件了。最终的结果就是在我们指定的目录下，产生了一个<code>.flattened-pom.xml</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2218ac8d569d4771a36dd7f37c0fc023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=TIBWl91Z%2FTr%2FeCmFVApjEM6sGRQ%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e040e28055340d8bd3cb06c7dc2bc20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=Wl2%2BMAx5MeuWyQOtWkyMEqjHpZg%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>而且其内部就是jar包的平铺形式</p>
<h4 data-id="heading-5"><strong>2. exec-maven-plugin</strong></h4>
<h5 data-id="heading-6"><strong>① 插件配置</strong></h5>
<p>这个插件要用于在构建过程中执行外部程序或脚本。通过这个插件，可以方便地在Maven项目构建过程中调用外部命令、执行Shell脚本等。一个最常见的作用就是，进行代码混淆</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>exec-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>obfuscate<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span><span class="hljs-comment">&lt;!-- 指定执行的命令为java --&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">arguments</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>-jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>path/to/allatori.jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span><span class="hljs-comment">&lt;!-- Allatori的jar包路径 --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>-config<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>path/to/allatori-config.xml<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span><span class="hljs-comment">&lt;!-- Allatori混淆配置文件路径 --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>-in<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>${project.build.directory}/${project.build.finalName}.jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span><span class="hljs-comment">&lt;!-- 待混淆的jar包路径 --&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>-out<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">argument</span>&gt;</span>${project.build.directory}/${project.build.finalName}-obfuscated.jar<span class="hljs-tag">&lt;/<span class="hljs-name">argument</span>&gt;</span><span class="hljs-comment">&lt;!-- 混淆后的jar包输出路径 --&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">arguments</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>涉及的各个具体配置的含义如下：</p>
<ul>
<li>
<p><code>&lt;executable&gt;</code>：指定要执行的命令为java，表示使用Java来执行命令。</p>
</li>
<li>
<p><code>&lt;arguments&gt;</code>：配置执行的命令参数，具体含义如下：</p>
</li>
<li/>
<li>
<ul>
<li><code>-jar path/to/allatori.jar</code>：指定执行的jar包为Allatori混淆工具的jar包路径。</li>
<li><code>-config path/to/allatori-config.xml</code>：指定Allatori混淆工具所需的配置文件路径。</li>
<li><code>-in ${project.build.directory}/${project.build.finalName}.jar</code>：指定待混淆的jar包路径。</li>
<li><code>-out ${project.build.directory}/${project.build.finalName}-obfuscated.jar</code>：指定混淆后的jar包输出路径。</li>
</ul>
</li>
</ul>
<p>通过这样的配置，项目构建过程中会在package阶段执行命令，使用<code>java -jar</code> 这样的命令调用Allatori混淆工具，对我们的工程打包结果进行混淆处理。不难发现，这里其实还有一个关键的配置文件 <code>allatori-config.xml</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed4df3d68b8a4a688986893aa8287164~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=IZpwKPo6kCNgu4jMPfew0S03cac%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>关于这个配置文件该怎么配，他的属性与作用，可以见官方文档： <code>https://allatori.com/doc.html</code> ，我们就不再赘述</p>
<h5 data-id="heading-7"><strong>② 作用</strong></h5>
<p>经过配置后，我们的编译的代码就会产生一些变化，比如变量名变成了VAR系列，当然，变化的多寡取决于我们上面的配置文件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04796efa1a5244c4a4706abbcc85ac27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=QFqI3zxxYRm0BpnJ0WhGidph7o0%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e57fde1570f34728bdf36fcb0c28453e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=OF6LsjMLtLHWHSnSU3B9om7dsxo%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>当然，这里还有一个很特殊的点。就是使用 allatori 会有一个默认配置 <code>synthetize-methods</code>， 这个默认配置会让所有私有方法被标记为合成方法。而很多反编译器不展示合成方法，导致的结果就是反编译后看不到任何 private 方法</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a1c2a912014648a3841e06cffff2c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=kaR2pF7HO1O1jHj4aQc8tbLNUJs%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<h3 data-id="heading-8"><strong>三、maven 插件原理</strong></h3>
<h4 data-id="heading-9"><strong>1. MOJO（Maven Plain Old Java Object）</strong></h4>
<p>谈及maven插件，就必须提及一个重要概念MOJO ，MOJO 是一个缩写，全称为 <code>Maven Plain Old Java Object</code>。MOJO 是 Maven 插件中的一个核心概念，它代表了一个具体的构建任务或目标（goal）。</p>
<p>每个 MOJO 都是一个 Java 类，实现了特定的构建逻辑，并且可以通过 Maven 的命令行或配置文件（如 pom.xml）来调用。</p>
<h5 data-id="heading-10"><strong>MOJO 的主要特点</strong></h5>
<p><strong>Java 类：</strong></p>
<p>MOJO 是一个普通的 Java 类，通常继承自 <code>org.apache.maven.plugin.AbstractMojo</code> 类。</p>
<p>这个类提供了许多有用的方法和属性，帮助你更方便地编写插件。</p>
<p><strong>目标（Goal）：</strong></p>
<p>每个 MOJO 定义了一个或多个目标（goal），这些目标可以在 Maven 的生命周期中被调用。</p>
<p>目标是一个具体的构建任务，例如编译代码、打包、测试等。</p>
<p><strong>注解：</strong></p>
<p>MOJO 类和方法通常使用注解来提供元数据，例如 <code>@Mojo</code> 注解用于标记一个类为 MOJO，<code>@Parameter</code> 注解用于标记类的属性为插件配置参数。</p>
<p><strong>配置参数：</strong></p>
<p>MOJO 可以通过 <code>pom.xml</code> 或命令行接收配置参数，这些参数用于控制 MOJO 的行为。</p>
<p>例如， 元素可以用来配置 MOJO 的参数。</p>
<h4 data-id="heading-11"><strong>2. 通用的配置</strong></h4>
<p>知道了Mojo后，我们再回头看看插件，插件由一个或多个Mojo组成，其中一个Mojo映射到一个目标。</p>
<p>例如，您有一个Mojo，它对特定的URL执行查询，并带有指定的超时和选项列表。Mojo可能是这样的</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Mojo( name = <span class="hljs-string">"query"</span> )</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyQueryMojo</span>
    extends AbstractMojo
{
    <span class="hljs-meta">@Parameter(property = <span class="hljs-string">"query.url"</span>, required = true)</span>
    <span class="hljs-keyword">private</span> String url;
    
    <span class="hljs-meta">@Parameter(property = <span class="hljs-string">"timeout"</span>, required = false, defaultValue = <span class="hljs-string">"50"</span>)</span>
    privateint timeout;
    
    <span class="hljs-meta">@Parameter(property = <span class="hljs-string">"options"</span>)</span>
    <span class="hljs-keyword">private</span> String[] options;

<span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void execute()
        throws MojoExecutionException
    {
        ...
    }
}
</code></pre>
<p>然后再要使用这个插件的位置，这样设置pom.xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-myquery-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.foobar.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>one<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>two<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>three<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<p>配置中的元素与Mojo中字段的名称相匹配。映射是直接的。url元素映射到url字段，timeout元素映射到timeout字段，options元素映射到options字段。映射机制可以通过检查字段的类型并确定是否可能有合适的映射来处理数组。</p>
<h3 data-id="heading-12"><strong>四、自定义Maven插件</strong></h3>
<h4 data-id="heading-13"><strong>1. 编写一个maven插件</strong></h4>
<p>比如我们想写一个名字叫 “<code>hello-maven-plugin</code>” 的maven插件，目的是提供一个sayHi方法，在编译时输出一个<code>Hello, world</code>。那么我们首先创建一个maven项目，然后这样设置pom文件</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>sample.plugin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hello-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Sample Parameter-less Maven Plugin<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven-plugin-tools.version</span>&gt;</span>3.15.1<span class="hljs-tag">&lt;/<span class="hljs-name">maven-plugin-tools.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-plugin-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.9.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- dependency on annotations --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugin-tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-plugin-annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-plugin-tools.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-plugin-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-plugin-tools.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<p>然后我们的核心是建立一个类，如下 <code>GreetingMojo.java</code></p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> org.example;

<span class="hljs-keyword">import</span> org.apache.maven.plugin.<span class="hljs-type">AbstractMojo</span>;
<span class="hljs-keyword">import</span> org.apache.maven.plugin.<span class="hljs-type">MojoExecutionException</span>;
<span class="hljs-keyword">import</span> org.apache.maven.plugins.annotations.<span class="hljs-type">Mojo</span>;
<span class="hljs-comment">/**
 * Says "Hi" to the user.
 *
 */</span>
<span class="hljs-meta">@Mojo</span>(name = <span class="hljs-string">"sayhi"</span>)
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreetingMojo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractMojo</span></span>
{
    <span class="hljs-meta">@Override</span>
    public void execute() <span class="hljs-keyword">throws</span> <span class="hljs-type">MojoExecutionException</span>
    {
        getLog().info(<span class="hljs-string">"Hello, world."</span>);
    }
}
</code></pre>
<p>完成上述后，我们进行一次<code>mvn install</code>，把我们自己编写的这个插件上传到本地仓库中，以便被其他项目使用。</p>
<h4 data-id="heading-14"><strong>2. 直接执行</strong></h4>
<p>继上述我们写完自己的插件，并且install后，我们就能在其他项目里运用我们自己的这个插件了。比如我现在有一个项目，我在其pom文件里加上我们自己配置的插件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2527706874a84fe0b89cd82cd23f1781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=Ps1WLKTHyGdQeUVA3Cf%2BuBiFwkg%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>然后我们就看到我们这个项目可以使用自定义插件的功能了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9da6b62e2ef547019e1bcb6120477d7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=KmCRvJE6%2BJvs0cHQhMQbeewdltk%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>双击 <code>hello.sayhi</code> 或者执行命令 <code>mvn sample.plugin:hello-maven-plugin:1.0-SNAPSHOT:sayhi</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f437bb1a7fe4e7287151d5c193ffba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=Whi1FNH3rEnDm8Z4dGSUDJXvezQ%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<h4 data-id="heading-15"><strong>3. 绑定周期</strong></h4>
<p>但是大部分时候，我们不会手动去执行 <code>mvn sample.plugin:hello-maven-plugin:1.0-SNAPSHOT:sayhi</code> 这种命令，而是希望在某个通用的动作时，他能够自动去执行。</p>
<p>比方说我们希望在清理编译结果之前他可以自动sayhI, 这个时候我们就可以写成这样</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ce631152f61479185efaa9b521ba87a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=HhoWPXZKEw6SYKpnDU623dX%2BI9M%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>那么当我们运行clean的时候，就能看到他在clean之前，自动执行了sayhi</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8012f3f9b0484cbf97e9d172382548d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990644&amp;x-signature=ZXeGi4Ve5zTQitNNkmGvw1pccH8%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里又放大招！上线了一款国民级AI助手千问APP，挑战ChatGPT！]]></title>    <link>https://juejin.cn/post/7573508048141795337</link>    <guid>https://juejin.cn/post/7573508048141795337</guid>    <pubDate>2025-11-17T13:23:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508048141795337" data-draft-id="7573528564026081326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里又放大招！上线了一款国民级AI助手千问APP，挑战ChatGPT！"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-17T13:23:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员X小鹿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里又放大招！上线了一款国民级AI助手千问APP，挑战ChatGPT！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员X小鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:23:52.000Z" title="Mon Nov 17 2025 13:23:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是X小鹿。</p>
<p>今天被阿里千问 APP 刷屏了。一觉醒来，公众号、微博、社群、朋友圈，全是阿里千问 APP 上线的消息。</p>
<p><strong>阿里正式发布千问 APP——阿里最强大模型官方</strong> <strong>AI</strong> <strong>助手。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd1b71b64d648d1ba0d617a2d0252e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=PM7NX4%2BtKM%2Fh%2FG9HFmRWmdbqdFw%3D" alt="图片" loading="lazy"/></p>
<p>阿里基于自家的全球第一开源模型 Qwen，搞了个千问 APP，说实话刚看到这个消息时，还有点懵。</p>
<p>第一反应是，阿里不是已经有通义 APP 了吗，咋又发布了一个 AI 应用？</p>
<p>可能大部分人和我有一样的反应。</p>
<p>而且对通义千问、通义、千问、Qwen Chat，可能真的已经有点分不清了。</p>
<p>今天一篇文章和大家一起好好捋捋。</p>
<h2 data-id="heading-0">通义千问 APP、通义 APP 和千问 APP 有什么关系</h2>
<p>是的，阿里之前是有一款 AI 应用，叫通义 APP，再之前，它叫通义千问 APP。</p>
<p><strong>你可以理解为，通义千问 APP、通义 APP 他们进行品牌升级和整合后，就是今天的千问 APP。</strong></p>
<p>在手机应用商店搜「通义」，可以看到，现在出来的是阿里最新发布的千问 APP 了。</p>
<p><strong>三款 APP 的时间线：</strong></p>
<ul>
<li>通义千问 APP（2023.9～2024.5）</li>
<li>通义 APP（2024.5～2025.11）</li>
<li>2025.11.14 正式更名为千问 APP</li>
</ul>
<h2 data-id="heading-1">千问和 Qwen Chat 又有什么关系</h2>
<p>Qwen Chat 官网：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fchat.qwen.ai%2F" target="_blank" title="https://chat.qwen.ai/" ref="nofollow noopener noreferrer">chat.qwen.ai/</a></p>
<p>那 Qwen Chat 和新上线的千问，又有什么关系呢？</p>
<p>大家可以简单理解为：</p>
<p>Qwen Chat，是 Qwen 大模型的官方展示平台，里面集合了 Qwen 系列的多款大模型，主要用途是展示模型的能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/939e0933dc734b75ba4004b594887133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=umm0QBby96cSpgoGJVt6PGNrD8I%3D" alt="图片" loading="lazy"/></p>
<p>而千问，相当于一款国民级的 AI 产品、个人 AI 助手。</p>
<p>里面提供了很多大家在日常生活、工作、学习中都用得上的实用功能，面向的用户是普通大众。</p>
<p>说到这，大家可能已经对阿里的这些产品逐渐清晰了。</p>
<h2 data-id="heading-2">千问 APP</h2>
<p>下面再来详细介绍下刚刚上线的千问 APP。</p>
<p>千问 APP，使用阿里最强 Qwen 系列大模型，而且是 All in One。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38121889555843958c4a35409b757d1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=H5eVs39UFkRGx%2BZ1JwmGANQEQUQ%3D" alt="图片" loading="lazy"/></p>
<p>也就是说，它将阿里在图像、视觉、编程等领域的多款主流大模型都整合在了千问 APP 中。</p>
<h2 data-id="heading-3">千问 APP 具体能干什么</h2>
<p>进到阿里千问 APP 后，在输入框的上方滑动菜单，可以看到目前千问 APP 提供的所有功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a120ffd7950402fb48fa54ed8033d69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=4SgVwQdyO4CjRWpzLk5EwgVZ5FI%3D" alt="图片" loading="lazy"/></p>
<p>将目前阿里千问 APP 中的功能，简单进行了分类：</p>
<ul>
<li><strong>创意与内容创作</strong>：AI 生图、AI 修图、AI 生视频、PPT 创作、智能写作</li>
<li><strong>效率工具</strong>：音视频速读、文档阅读、实时记录、翻译</li>
<li><strong>实时通信</strong>：视频通话、打电话</li>
<li><strong>学习与教育</strong>：拍照讲题</li>
<li><strong>专业研究分析</strong>：深度研究</li>
</ul>
<p>各个功能就不一一展开介绍了，使用都非常简单，而且一些功能，可能大家之前都多多少少体验过。</p>
<p>除了上面列出的这些功能外，<strong>像之前通义 APP 里的一些经常被大家用来整活的玩法，在千问 APP 中依然能够找到。</strong></p>
<p>比如全民舞王、全民唱演、表情包大师、替身演员（一键替换视频中的角色）、视频风格转换、视频特效等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f0a755a076b4928906a4ad04840da76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=lDDpAz3%2BT90Cj%2F5jtk8yo6lDSUo%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-4">写在最后</h2>
<p>阿里正式上线千问 APP，可以说是阿里从 B 端开始触达 C 端的关键一步。</p>
<p>千问除了 APP 外，还提供了网页版和 PC 端。（对话记录是同步的）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9976b6b023ba423786fec75d0cd5765c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=LcLcwwEdozIPH8wWU%2BCKUQwilo8%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7cc8f57a3a846aeb2cb5bcd8d4a8a54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=xzvSA1gxZzKjTbbGATHmy9RAQbg%3D" alt="图片" loading="lazy"/></p>
<p>而且看相关介绍，千问后续也会上线国际版，面向全球用户，将直接与 OpenAI 的 ChatGPT 展开全面竞争。</p>
<p>以上，就是今天的分享。</p>
<p>最后，附上千问的使用入口。</p>
<p><strong>手机 APP</strong>：应用商店搜“千问”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4572fe4f72a45169805795aa9353121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990632&amp;x-signature=fEKrn5BzYMVfbqMpJX8fyhYKz1M%3D" alt="图片" loading="lazy"/></p>
<p>ps：在 APP 更新日志中，看到了好「抽象」的一幕，满屏的「问」，哈哈，该不会是 00 吧...</p>
<p><strong>电脑网页版</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tongyi.com%2F" target="_blank" title="https://www.tongyi.com/" ref="nofollow noopener noreferrer">www.tongyi.com/</a></p>
<hr/>
<blockquote>
<p>我是<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">程序员X小鹿</a>，前互联网大厂程序员，也是一名 AIGC 爱好者，持续分享更多好用的 AI 工具，欢迎一起交流~</p>
</blockquote>
<p><strong>推荐阅读</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024年终AI工具汇总：9大AI领域，70+精选AI工具，全都在这了！(建议收藏)</a></p>
<p>更多 AI 工具见<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">【AI工具】</a>专栏，持续更新中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用工具超越思考本身]]></title>    <link>https://juejin.cn/post/7573504290066677775</link>    <guid>https://juejin.cn/post/7573504290066677775</guid>    <pubDate>2025-11-17T13:26:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573504290066677775" data-draft-id="7573523709300097059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用工具超越思考本身"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-17T13:26:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东东拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/3808364011728392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用工具超越思考本身
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364011728392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东东拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:26:55.000Z" title="Mon Nov 17 2025 13:26:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">引言</h2>
<p>最近我在重读《思考如何超越思考》。</p>
<p>书里有一句话让我印象很深：</p>
<p>“思维并不只存在于大脑，它延伸到身体、环境与工具之中。”</p>
<p>这本书里有强有力的证据说明，屏幕越大， 越能提升大脑性能。</p>
<p>最近换上了BenQ RD320U 32寸 4K 显示器的我，深表认同。</p>
<h2 data-id="heading-1">我在AI时代新的工作方式</h2>
<p>16:9 的屏幕比例，已经陪伴我们几十年了。它起源于影院与电视时代——那时，屏幕是为“观看”而生的。</p>
<p>宽幅画面迎合人眼的横向视角，也适合叙事与娱乐的沉浸体验。</p>
<p>2025年AI大模型突飞猛进，已经融入进了每个人的工作和生活中。</p>
<p>一开始用大模型只是辅助，一边用IDE写代码，遇到问题，才切换到大模型的页面。</p>
<p>可随着AI的利用率越来越高，我不得不频繁的在工作软件和浏览器里面切换。我看到身边的很多同事也是这样的，AI输出一段内容，再切到IDE里面粘贴一段内容。</p>
<p>窗口之间的切换、上下滚动的频繁，都让注意力在无形中消耗，大脑可能刚有点思路，就被你的操作打断了。</p>
<p>你可以想象到这样的效率有多低！注意力是我们最宝贵的资源，我们不应该把资源耗费在这没有意义的地方。</p>
<p>换上BenQ RD320U，我的工作方式彻底改变了。</p>
<p>在 32 寸 4K 的工作环境中，我能真正做到“同时看见”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/354a801127fa46aea10a5576a6f8ebba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=9fnubrR3al4Yd0FC%2BWvFpSXJJWc%3D" alt="E306BE2E-8DD7-4F27-8DF3-8C6AD339AF27.jpg" loading="lazy"/></p>
<p>左侧是编辑器，右侧是 AI 对话框；上方是我要写的内容，底部是大模型的输出。</p>
<p>信息不再被挤压在一个个窗口里，而是被摊开、并列、呼吸。</p>
<p>这种状态下，思考的节奏变得流畅——我不再切换，而是在同一画面里思考。</p>
<p>写作、编程、调研、资料整理……这些任务在AI时代，并不是线性进行，而是同时存在的。</p>
<p>我最大的感触是，AI 时代，屏幕不再只是用来看，而是用来思考和创造的。</p>
<p>我们常以为，思考是一种“脑内活动”，但其实，大脑只是一个起点。</p>
<p>当你在白板上写字、在笔记里整理、在屏幕上分屏浏览时，你的思维正在外化——正在被环境放大，而环境的限制，也就成了思考的边界。</p>
<p>RD320U不仅提升了我们的视觉体验，更是在扩展我们的“认知空间”。</p>
<h2 data-id="heading-2">编程体验</h2>
<p>毕竟是RD系列，RD320U延续了程序员专门设计的功能：编码模式。</p>
<p>编码模式分为两种，适配浅色风格的亮色主题模式与适配暗黑风格的深色主题模式。</p>
<p>我依然是使用IDE的深色主题写代码，所以更喜欢使用深色编码模式，打开编码模式的RD320U代码明显更清晰更容易区分，显示器还进一步加强了IDE的语法高亮效果，给我们带来代码高辨识度的视觉体验。</p>
<p>无论你偏好什么编码主题，都能保持代码的清晰、对比度的精准。</p>
<p>看久了不累眼，也更容易保持专注。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa5443ddf7e9412f820ca1121574f694~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=r4JmAxEoTShJeSW9q1nobnns1Io%3D" alt="72D65CEB-9D2D-421C-BAF7-17D287E746C5.jpg" loading="lazy"/>
（上图是开启深色主题的RD320U）</p>
<p>RD320U还更新了一个新功能：双色彩显示增强版。</p>
<p>开头我就提到，现在分屏工作是我的常态，例如我在IDEA里面设置编码模式，而在浏览器里面设置M-Book模式，无论哪一个区域，都能让你感受到最好的体验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ca2fd5eff7b4169ab6b490b3547950d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=yoAPmy%2F0RIuERLTEz37tse9YV0o%3D" alt="8E49C458-59FE-493C-8B0A-B34973A3B966.jpg" loading="lazy"/></p>
<p>如果你也经常在屏幕前工作，或者工位就靠在窗户旁边，大概会懂那种感觉——</p>
<p>光线从窗外斜射进来，或者办公室的筒灯正好打在屏幕上，</p>
<p>画面里出现一片模糊的反光。</p>
<p>那一瞬间，你看见的不是内容，而是自己被打断的专注。</p>
<p>眩光的问题，从来不是亮度，而是干扰。</p>
<p>它让我们不断调整角度、移动视线，</p>
<p>却很难重新回到那个“全神贯注”的状态。</p>
<p>BenQ RD320U 在这点上做到了极致，面板全部覆盖了抗反射涂层，并且通过了TUV莱茵抗反射认证。</p>
<p>哪怕我开启了手表的手电筒照射，</p>
<p>屏幕依旧像是“吸光”的——</p>
<p>背景纯净、文字锐利、色彩饱满，不被反光破坏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddf76f34367541a6aca95d3bc6666f86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=fuhEXhiF1kH%2F%2Fv3DbAI70Tvo5is%3D" alt="F4DA1F76-6F21-40F8-9F2D-65ED6237FFF1.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c84e4bf722e346c1ac51fdc320e4cce5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=nLOi%2FES%2FBBqKsGVgsWeBQLPEH4k%3D" alt="2290F31F-28E5-49B0-87CA-10F53301A024.jpg" loading="lazy"/>
（左图是RD320U，右图是MacBook Pro显示效果）</p>
<h2 data-id="heading-3">为夜晚设计的MoonHalo</h2>
<p>孩子睡着、家里安静下来，我会重新坐回桌前——</p>
<p>那是属于我自己的、稍纵即逝的一点时间。</p>
<p>相信有孩子的人都有所体会。</p>
<p>我唯一苦恼的是灯光，不开灯，屏幕太刺眼；开灯，又有种下了班还坐在办公室的感觉，完全不想工作。</p>
<p>我试过台灯、氛围灯，也尝试把屏幕亮度调整到最低，始终没有找到既舒服又不扰人的状态。</p>
<p>但BenQ RD320U解决了我的问题，这台显示器自带的 MoonHalo 智慧光环，可以调节亮度、色温和环绕角度。</p>
<p>我上面所有拍摄的照片都是开启了MoonHalo的状态，光线从屏幕后方柔和地洒出，让我感到沉浸又舒适。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08598b3e5f404c55846bfd5a78ace89d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=ja0fwkLfRi0uFH5Bs9cG%2FeCPi0s%3D" alt="08C5286D-41F9-455C-863E-5C0018973261.jpg" loading="lazy"/></p>
<p>当时我认为它最大的作用是护眼，但当我重新用回这个功能，我认为这一圈柔光不只照亮屏幕，</p>
<p>也成为了工作时专注的“灯塔”。</p>
<h2 data-id="heading-4">保护你的双眼</h2>
<p>最近去体检，视力不出意外的又下降了，对于做过飞秒手术的我来说，屏幕素质是我感受最深的地方。</p>
<p>RD320U在护眼领域耕耘十余年，通过5项莱茵认证：Eyesfae2.0、 Eyecomfort、无频闪、硬件级滤蓝光和抗反射认证。并拥有1项国家发明专利：智慧调光专利。</p>
<p>夜晚看屏幕对眼睛的伤害是最大的，当周围环境一片漆黑，只有屏幕这一个明亮的光源。眼睛需要在极暗和极亮之间不断调整，瞳孔频繁收缩和放大，所以我经常出现眼睛酸胀、流泪等症状，这也算是飞秒手术的副作用吧。</p>
<p>RD320U提供了一个贴心的功能来照顾需要深夜工作的专业人士：猫头鹰模式。（听起来就是为了熬夜人士设计的）</p>
<p>打开这个模式后，无论周边环境有多暗，它会通过固件调整打破亮度限制，在屏幕显示上提供极低的亮度与色彩平衡解决方案，即使是深夜工作，我眼睛干涩症状有了极大的缓解。</p>
<p>而且你的屏幕的抗蓝光功能、夜间模式，都可以直接在屏幕下方直接看到，不需要去显示器设置里一遍遍的确认，非常方便。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4148438cc42a4edb9493116345299f74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=hbvgd449aKqeTcoq7ZXki5tGewQ%3D" alt="786EE30E-396F-4F94-9DBF-07C87498B371.jpg" loading="lazy"/></p>
<p>相信你一定经历过调整显示器亮度或者设置时，一遍遍的按显示器的实体按键，并且由于操作不熟练，一不小心按错的情况。</p>
<p>我之前就在想，怎么这样不复杂的功能，屏幕厂商就不能配套一个专用的软件呢。</p>
<p>在软硬结合方面，RD系列也做到了极致，配套软件Display Pilot 2给我们提供了我们日常使用所用的常用功能。</p>
<p>常见的如显示模式切换，键盘的快捷键控制和桌面分区， 甚至可以设置我们自己的工作流，在几点开始工作，几点开始看书，几点开始娱乐，都可以设置我们自己想要的效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d57f44159d4404ca6795bc3019ace0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763990815&amp;x-signature=dy1KRgLR3dcbmUV2W2zsVloiBAY%3D" alt="02D57274-C4E4-4588-9C8A-5CBA50DB4832.jpg" loading="lazy"/></p>
<h3 data-id="heading-5">体验总结</h3>
<p>这段时间体验下来，BenQ RD320U 这台屏幕，我最大的感受是它让我重新理解了什么叫“思考空间”。</p>
<p>当屏幕够大、分辨率够高、光线够柔和、模式够智能，注意力就不再被切碎，思绪也能自然流动。</p>
<p>好的工具，不只是提升效率，也能帮你建起一块安静而有秩序的心智空间。</p>
<p>而在这个被信息和AI包围的时代，能保有这样的空间，本身就已经是一种稀缺能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里AI的“船票之战”：千问APP剑指C端，能否重塑格局？]]></title>    <link>https://juejin.cn/post/7573468493570293796</link>    <guid>https://juejin.cn/post/7573468493570293796</guid>    <pubDate>2025-11-17T13:37:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493570293796" data-draft-id="7573524348129509439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里AI的“船票之战”：千问APP剑指C端，能否重塑格局？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-17T13:37:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里AI的“船票之战”：千问APP剑指C端，能否重塑格局？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:37:15.000Z" title="Mon Nov 17 2025 13:37:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果说过去的几年，是阿里巴巴在AI技术领域深耕于幕后、默默积累内功的阶段，那么2025年11月17日，无疑是其AI战略版图上一个里程碑式的节点。这一天，承载着阿里AI野心的“千问APP”公测版正式上线，这不仅是产品层面的发布，更是阿里向所有关注AI发展的人，掷出的一份宣言——他们要争夺AI时代的C端“船票”了。</p>
<p>这并非简单的跟随，而是阿里AI基因的一次全面转向。我们都知道，阿里在云计算、B端解决方案上有着深厚的积累，其通义系列大模型也在企业级市场和开源社区赢得了喝彩。然而，当通用人工智能的浪潮拍打海岸，个人AI助手的赛道变得炙手可热时，阿里毅然决然地从幕后走向台前，将目光锁定在了每一个普通用户身上，直接对标全球AI巨头ChatGPT。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-17_21.27.21-1024x689.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-17_21.27.21-1024x689.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/844b5a00ad534630a9593e260e886c9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763991435&amp;x-signature=4CC7a%2FAA5oJfLycMUIo21KQmQqg%3D" alt="iShot_2025-11-17_21.27.21" loading="lazy"/></a></p>
<h3 data-id="heading-0">从“幕后英雄”到“个人智囊”</h3>
<p>“会聊天、能办事”，这六个字精准地概括了千问APP的核心定位。它不再只是一个冷冰冰的问答机器，而是被塑造成一个真正能融入你生活、工作方方面面的私人AI助手。想象一下，你可能不再需要频繁切换应用，一个指令，千问就能帮你搞定日程安排、信息查询、甚至是购物比价。这背后，是阿里对未来AI生活入口的宏伟愿景。</p>
<p>这份雄心壮志，并非空中楼阁。它的底气，来源于阿里巴巴技术体系中最为耀眼的明星——Qwen（通义千问）大模型系列，特别是其旗舰模型Qwen3-Max。这款模型并非等闲之辈，据数据显示，它在全球范围内的下载量已经突破了惊人的6亿次，更是在多项严苛的基准测试中表现出色，甚至在实盘投资大赛中斩获冠军。这意味着，千问APP从诞生之初，就携带着顶尖的推理、编程和理解能力，站在了全球AI大模型的第一梯队。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-17_21.27.27-1024x419.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-17_21.27.27-1024x419.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36852f4ecd8c4b0782646d1ff0ee2397~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763991435&amp;x-signature=ldNB0zI%2FxJiT%2B4e5kOkn02vQ1dY%3D" alt="iShot_2025-11-17_21.27.27" loading="lazy"/></a></p>
<h3 data-id="heading-1">生态赋能下的“办事能力”</h3>
<p>千问APP的魅力，远不止于流畅的对话和精准的问答。它的真正杀手锏，在于其独特的“办事能力”。阿里并未满足于打造一个高级的聊天机器人，而是希望它能成为你数字生活中的多面手。</p>
<p>核心功能包括了智能写作、多模态视觉识别，以及未来将深度整合的办公、地图、健康、购物等各类生活场景。这意味着，你对着千问说一句“帮我计划一个周末短途旅行，包括交通和住宿”，它可能就能直接调度高德地图、飞猪旅行的服务，为你生成一份详细的行程。或者在电商场景中，一句“帮我找一件适合秋天穿的米色风衣，预算在一千元以内”，千问便能直接在淘宝天猫中进行筛选比价，甚至帮你完成下单前的各项准备。这种“一句话办事”的体验，正是阿里寄予厚望的差异化优势，旨在成为阿里系所有互联网服务的统一AI入口。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-17_21.27.38-1024x429.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-17_21.27.38-1024x429.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66071641c132443aaaccc3c1c8f9ee5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763991435&amp;x-signature=eOb5sUoiSEyiDVue3UNLmOR3Unk%3D" alt="iShot_2025-11-17_21.27.38" loading="lazy"/></a></p>
<h3 data-id="heading-2">挑战与机遇并存的“生死战”</h3>
<p>然而，这条赛道并非坦途。公测首日，用户涌入带来的服务拥堵，便提前敲响了警钟。在大规模高并发访问面前，应用的稳定性是决定用户体验的关键。此外，当前的C端AI助手市场早已是群雄逐鹿，用户忠诚度普遍不高，千问能否凭借其卓越的体验和深度整合的能力，真正俘获用户的心，形成强大的用户黏性，将是这场“未来之战”的胜负手。</p>
<p>但与此同时，千问APP也手握着巨大的机遇。其最大的优势，莫过于能够深度整合阿里庞大而成熟的生态系统。淘宝、高德、饿了么、钉钉……这些与我们生活息息相关的应用，一旦通过千问APP进行智能调度和协同，所爆发出的能量将是惊人的。这使得千问不仅仅是一个技术产品，更是一个连接阿里数字经济体各项服务的超级连接器。</p>
<p>这场从“通义”到“千问”的品牌统一，从B端到C端的战略转型，对阿里巴巴而言，如同移动互联网时代争夺“手机淘宝”的船票，是一场不容有失的“生死战”。千问APP的上线，只是吹响了号角，真正的战斗才刚刚开始。我们期待它能在激烈的市场竞争中，闯出一条属于自己的路，真正成为每一个普通用户“会聊天、能办事”的智能生活入口。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速入门现代C++：从C++11到C++20的核心特性]]></title>    <link>https://juejin.cn/post/7573519273030189102</link>    <guid>https://juejin.cn/post/7573519273030189102</guid>    <pubDate>2025-11-17T13:45:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573519273030189102" data-draft-id="7573528564026196014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速入门现代C++：从C++11到C++20的核心特性"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T13:45:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速入门现代C++：从C++11到C++20的核心特性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:45:15.000Z" title="Mon Nov 17 2025 13:45:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是现代C++？</h2>
<p>现代C++通常指C++11及之后版本的C++语言。自2011年C++11发布以来，C++发生了革命性的变化，引入了大量让代码更安全、高效、简洁的新特性。本文将带你快速掌握现代C++的核心特性。</p>
<h2 data-id="heading-1">一、自动类型推导</h2>
<h3 data-id="heading-2">1.1 <code>auto</code> 关键字</h3>
<p><code>auto</code> 让编译器自动推导变量类型，使代码更简洁：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 传统方式</span>
std::vector&lt;<span class="hljs-type">int</span>&gt;::iterator it = vec.<span class="hljs-built_in">begin</span>();

<span class="hljs-comment">// 现代方式</span>
<span class="hljs-keyword">auto</span> it = vec.<span class="hljs-built_in">begin</span>();
<span class="hljs-keyword">auto</span> name = <span class="hljs-string">"C++"</span>;        <span class="hljs-comment">// 推导为 const char*</span>
<span class="hljs-keyword">auto</span> score = <span class="hljs-number">95.5</span>;        <span class="hljs-comment">// 推导为 double</span>
<span class="hljs-keyword">auto</span> numbers = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}; <span class="hljs-comment">// 推导为 std::initializer_list&lt;int&gt;</span>
</code></pre>
<h3 data-id="heading-3">1.2 <code>decltype</code> 关键字</h3>
<p><code>decltype</code> 可以获取表达式的类型：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> x = <span class="hljs-number">10</span>;
<span class="hljs-keyword">decltype</span>(x) y = <span class="hljs-number">20</span>; <span class="hljs-comment">// y的类型与x相同，即int</span>

std::vector&lt;<span class="hljs-type">int</span>&gt; vec;
<span class="hljs-keyword">decltype</span>(vec.<span class="hljs-built_in">begin</span>()) iter; <span class="hljs-comment">// iter的类型是vector&lt;int&gt;::iterator</span>
</code></pre>
<h2 data-id="heading-4">二、智能指针：告别手动内存管理</h2>
<p>现代C++最重要的改进之一，彻底改变了内存管理方式。</p>
<h3 data-id="heading-5">2.1 <code>std::unique_ptr</code>：独占所有权</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">uniquePtrExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 创建unique_ptr</span>
    <span class="hljs-keyword">auto</span> ptr = std::<span class="hljs-built_in">make_unique</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">42</span>);
    
    <span class="hljs-comment">// 自动管理内存，无需手动delete</span>
    std::cout &lt;&lt; *ptr &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 移动语义，所有权转移</span>
    <span class="hljs-keyword">auto</span> ptr2 = std::<span class="hljs-built_in">move</span>(ptr);
    <span class="hljs-keyword">if</span> (!ptr) {
        std::cout &lt;&lt; <span class="hljs-string">"ptr is now null"</span> &lt;&lt; std::endl;
    }
} <span class="hljs-comment">// 自动释放内存</span>
</code></pre>
<h3 data-id="heading-6">2.2 <code>std::shared_ptr</code>：共享所有权</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sharedPtrExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> shared1 = std::<span class="hljs-built_in">make_shared</span>&lt;std::string&gt;(<span class="hljs-string">"Hello"</span>);
    
    {
        <span class="hljs-keyword">auto</span> shared2 = shared1; <span class="hljs-comment">// 引用计数+1</span>
        std::cout &lt;&lt; *shared2 &lt;&lt; std::endl;
    } <span class="hljs-comment">// shared2析构，引用计数-1</span>
    
    std::cout &lt;&lt; *shared1 &lt;&lt; std::endl; <span class="hljs-comment">// 仍然有效</span>
} <span class="hljs-comment">// shared1析构，引用计数为0，内存释放</span>
</code></pre>
<h3 data-id="heading-7">2.3 <code>std::weak_ptr</code>：解决循环引用</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span> {
    std::shared_ptr&lt;Node&gt; next;
    std::weak_ptr&lt;Node&gt; prev; <span class="hljs-comment">// 使用weak_ptr避免循环引用</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">weakPtrExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> node1 = std::<span class="hljs-built_in">make_shared</span>&lt;Node&gt;();
    <span class="hljs-keyword">auto</span> node2 = std::<span class="hljs-built_in">make_shared</span>&lt;Node&gt;();
    
    node1-&gt;next = node2;
    node2-&gt;prev = node1; <span class="hljs-comment">// 不会增加引用计数</span>
}
</code></pre>
<h2 data-id="heading-8">三、Lambda表达式：匿名函数的威力</h2>
<p>Lambda让函数式编程在C++中变得简单：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">lambdaExample</span><span class="hljs-params">()</span> </span>{
    std::vector&lt;<span class="hljs-type">int</span>&gt; numbers = {<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>};
    
    <span class="hljs-comment">// 基本lambda</span>
    std::<span class="hljs-built_in">sort</span>(numbers.<span class="hljs-built_in">begin</span>(), numbers.<span class="hljs-built_in">end</span>(), 
              [](<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b) { <span class="hljs-keyword">return</span> a &lt; b; });
    
    <span class="hljs-comment">// 捕获外部变量</span>
    <span class="hljs-type">int</span> threshold = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">auto</span> count = std::<span class="hljs-built_in">count_if</span>(numbers.<span class="hljs-built_in">begin</span>(), numbers.<span class="hljs-built_in">end</span>(),
        [threshold](<span class="hljs-type">int</span> x) { <span class="hljs-comment">// 值捕获</span>
            <span class="hljs-keyword">return</span> x &gt; threshold;
        });
    
    <span class="hljs-comment">// 引用捕获</span>
    <span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;
    std::for_each(numbers.<span class="hljs-built_in">begin</span>(), numbers.<span class="hljs-built_in">end</span>(),
        [&amp;sum](<span class="hljs-type">int</span> x) { <span class="hljs-comment">// 引用捕获</span>
            sum += x;
        });
    
    <span class="hljs-comment">// 通用lambda (C++14)</span>
    <span class="hljs-keyword">auto</span> genericLambda = [](<span class="hljs-keyword">auto</span> x) { <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; };
    std::cout &lt;&lt; <span class="hljs-built_in">genericLambda</span>(<span class="hljs-number">5</span>) &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; <span class="hljs-built_in">genericLambda</span>(<span class="hljs-number">3.14</span>) &lt;&lt; std::endl;
}
</code></pre>
<h2 data-id="heading-9">四、移动语义和右值引用</h2>
<p>理解移动语义是现代C++性能优化的关键：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">String</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">char</span>* data;
    <span class="hljs-type">size_t</span> length;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 移动构造函数</span>
    <span class="hljs-built_in">String</span>(String&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">data</span>(other.data), <span class="hljs-built_in">length</span>(other.length) {
        other.data = <span class="hljs-literal">nullptr</span>;    <span class="hljs-comment">// "偷走"资源</span>
        other.length = <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-comment">// 移动赋值运算符</span>
    String&amp; <span class="hljs-keyword">operator</span>=(String&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            <span class="hljs-keyword">delete</span>[] data;        <span class="hljs-comment">// 释放原有资源</span>
            data = other.data;    <span class="hljs-comment">// "偷走"资源</span>
            length = other.length;
            other.data = <span class="hljs-literal">nullptr</span>;
            other.length = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    ~<span class="hljs-built_in">String</span>() { <span class="hljs-keyword">delete</span>[] data; }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">moveExample</span><span class="hljs-params">()</span> </span>{
    String s1 = <span class="hljs-built_in">createString</span>(); <span class="hljs-comment">// 假设createString返回临时String</span>
    
    std::vector&lt;String&gt; strings;
    strings.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">String</span>(<span class="hljs-string">"Temporary"</span>)); <span class="hljs-comment">// 移动而非拷贝</span>
    
    String s2 = std::<span class="hljs-built_in">move</span>(s1); <span class="hljs-comment">// 显式移动</span>
}
</code></pre>
<h2 data-id="heading-10">五、现代循环和结构化绑定</h2>
<h3 data-id="heading-11">5.1 基于范围的for循环</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">rangeBasedForLoop</span><span class="hljs-params">()</span> </span>{
    std::vector&lt;<span class="hljs-type">int</span>&gt; numbers = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};
    
    <span class="hljs-comment">// 只读访问</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; num : numbers) {
        std::cout &lt;&lt; num &lt;&lt; <span class="hljs-string">" "</span>;
    }
    
    <span class="hljs-comment">// 修改元素</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; num : numbers) {
        num *= <span class="hljs-number">2</span>;
    }
    
    <span class="hljs-comment">// 遍历map</span>
    std::map&lt;std::string, <span class="hljs-type">int</span>&gt; scores = {{<span class="hljs-string">"Alice"</span>, <span class="hljs-number">95</span>}, {<span class="hljs-string">"Bob"</span>, <span class="hljs-number">87</span>}};
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; [name, score] : scores) { <span class="hljs-comment">// C++17结构化绑定</span>
        std::cout &lt;&lt; name &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; score &lt;&lt; std::endl;
    }
}
</code></pre>
<h3 data-id="heading-12">5.2 结构化绑定 (C++17)</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">std::tuple&lt;<span class="hljs-type">int</span>, std::string, <span class="hljs-type">double</span>&gt; <span class="hljs-title">getPerson</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> {<span class="hljs-number">25</span>, <span class="hljs-string">"Alice"</span>, <span class="hljs-number">170.5</span>};
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">structuredBindingExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 传统方式</span>
    <span class="hljs-keyword">auto</span> person = <span class="hljs-built_in">getPerson</span>();
    <span class="hljs-type">int</span> age = std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-number">0</span>&gt;(person);
    std::string name = std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-number">1</span>&gt;(person);
    
    <span class="hljs-comment">// 现代方式 (C++17)</span>
    <span class="hljs-keyword">auto</span> [age, name, height] = <span class="hljs-built_in">getPerson</span>();
    
    <span class="hljs-comment">// 用于pair</span>
    std::map&lt;std::string, <span class="hljs-type">int</span>&gt; scores;
    <span class="hljs-keyword">auto</span> [iter, success] = scores.<span class="hljs-built_in">insert</span>({<span class="hljs-string">"Alice"</span>, <span class="hljs-number">95</span>});
    
    <span class="hljs-comment">// 用于结构体</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> { <span class="hljs-type">double</span> x, y; };
    Point p{<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>};
    <span class="hljs-keyword">auto</span> [x, y] = p;
}
</code></pre>
<h2 data-id="heading-13">六、可选类型和变体类型</h2>
<h3 data-id="heading-14">6.1 <code>std::optional</code>：可能不存在的值</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;optional&gt;</span></span>

<span class="hljs-function">std::optional&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">findNumber</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt;&amp; vec, <span class="hljs-type">int</span> target)</span> </span>{
    <span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find</span>(vec.<span class="hljs-built_in">begin</span>(), vec.<span class="hljs-built_in">end</span>(), target);
    <span class="hljs-keyword">if</span> (it != vec.<span class="hljs-built_in">end</span>()) {
        <span class="hljs-keyword">return</span> *it; <span class="hljs-comment">// 返回值</span>
    }
    <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>; <span class="hljs-comment">// 无值</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">optionalExample</span><span class="hljs-params">()</span> </span>{
    std::vector&lt;<span class="hljs-type">int</span>&gt; numbers = {<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>};
    
    <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">findNumber</span>(numbers, <span class="hljs-number">5</span>);
    
    <span class="hljs-keyword">if</span> (result.<span class="hljs-built_in">has_value</span>()) { <span class="hljs-comment">// 或者 if (result)</span>
        std::cout &lt;&lt; <span class="hljs-string">"Found: "</span> &lt;&lt; result.<span class="hljs-built_in">value</span>() &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"Found: "</span> &lt;&lt; *result &lt;&lt; std::endl; <span class="hljs-comment">// 也可以解引用</span>
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"Not found"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 提供默认值</span>
    <span class="hljs-type">int</span> value = result.<span class="hljs-built_in">value_or</span>(<span class="hljs-number">-1</span>);
}
</code></pre>
<h3 data-id="heading-15">6.2 <code>std::variant</code>：类型安全的联合体</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;variant&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">variantExample</span><span class="hljs-params">()</span> </span>{
    std::variant&lt;<span class="hljs-type">int</span>, std::string, <span class="hljs-type">double</span>&gt; value;
    
    value = <span class="hljs-number">42</span>; <span class="hljs-comment">// 存储int</span>
    value = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// 存储string</span>
    value = <span class="hljs-number">3.14</span>; <span class="hljs-comment">// 存储double</span>
    
    <span class="hljs-comment">// 访问值</span>
    <span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">holds_alternative</span>&lt;<span class="hljs-type">int</span>&gt;(value)) {
        std::cout &lt;&lt; <span class="hljs-string">"int: "</span> &lt;&lt; std::<span class="hljs-built_in">get</span>&lt;<span class="hljs-type">int</span>&gt;(value) &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 使用visit (C++17)</span>
    std::<span class="hljs-built_in">visit</span>([](<span class="hljs-keyword">auto</span>&amp;&amp; arg) {
        <span class="hljs-keyword">using</span> T = std::<span class="hljs-type">decay_t</span>&lt;<span class="hljs-keyword">decltype</span>(arg)&gt;;
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;T, <span class="hljs-type">int</span>&gt;) {
            std::cout &lt;&lt; <span class="hljs-string">"int: "</span> &lt;&lt; arg &lt;&lt; std::endl;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;T, std::string&gt;) {
            std::cout &lt;&lt; <span class="hljs-string">"string: "</span> &lt;&lt; arg &lt;&lt; std::endl;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;T, <span class="hljs-type">double</span>&gt;) {
            std::cout &lt;&lt; <span class="hljs-string">"double: "</span> &lt;&lt; arg &lt;&lt; std::endl;
        }
    }, value);
}
</code></pre>
<h2 data-id="heading-16">七、编译时计算：<code>constexpr</code> 的威力</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// constexpr函数可以在编译期计算</span>
<span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">return</span> (n &lt;= <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : (n * <span class="hljs-built_in">factorial</span>(n - <span class="hljs-number">1</span>));
}

<span class="hljs-comment">// constexpr变量在编译期初始化</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> max_size = <span class="hljs-number">100</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">constexprExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> array[<span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>)]; <span class="hljs-comment">// 数组大小在编译期计算</span>
    
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> result = <span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 编译期计算</span>
    std::cout &lt;&lt; <span class="hljs-string">"5! = "</span> &lt;&lt; result &lt;&lt; std::endl;
}

<span class="hljs-comment">// C++20 consteval - 必须编译期求值</span>
<span class="hljs-function"><span class="hljs-keyword">consteval</span> <span class="hljs-type">int</span> <span class="hljs-title">square</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">return</span> n * n;
}
</code></pre>
<h2 data-id="heading-17">八、实际应用示例</h2>
<p>让我们用一个完整的例子展示现代C++的特性：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;optional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ranges&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
<span class="hljs-keyword">private</span>:
    std::string name;
    <span class="hljs-type">int</span> score;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Student</span>(std::string n, <span class="hljs-type">int</span> s) : <span class="hljs-built_in">name</span>(std::<span class="hljs-built_in">move</span>(n)), <span class="hljs-built_in">score</span>(s) {}
    
    <span class="hljs-comment">// 移动构造函数</span>
    <span class="hljs-built_in">Student</span>(Student&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">name</span>(std::<span class="hljs-built_in">move</span>(other.name)), <span class="hljs-built_in">score</span>(other.score) {}
    
    <span class="hljs-function"><span class="hljs-type">const</span> std::string&amp; <span class="hljs-title">getName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> name; }
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getScore</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> score; }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GradeManager</span> {
<span class="hljs-keyword">private</span>:
    std::vector&lt;std::unique_ptr&lt;Student&gt;&gt; students;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addStudent</span><span class="hljs-params">(std::string name, <span class="hljs-type">int</span> score)</span> </span>{
        students.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Student&gt;(std::<span class="hljs-built_in">move</span>(name), score));
    }
    
    <span class="hljs-function">std::optional&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">findScore</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; name)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(),
            [&amp;name](<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; student) {
                <span class="hljs-keyword">return</span> student-&gt;<span class="hljs-built_in">getName</span>() == name;
            });
        
        <span class="hljs-keyword">if</span> (it != students.<span class="hljs-built_in">end</span>()) {
            <span class="hljs-keyword">return</span> (*it)-&gt;<span class="hljs-built_in">getScore</span>();
        }
        <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printTopStudents</span><span class="hljs-params">(<span class="hljs-type">int</span> threshold)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-comment">// 使用ranges和lambda (C++20)</span>
        <span class="hljs-keyword">auto</span> topStudents = students | std::views::<span class="hljs-built_in">filter</span>([threshold](<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; student) {
            <span class="hljs-keyword">return</span> student-&gt;<span class="hljs-built_in">getScore</span>() &gt;= threshold;
        });
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; student : topStudents) {
            std::cout &lt;&lt; student-&gt;<span class="hljs-built_in">getName</span>() &lt;&lt; <span class="hljs-string">": "</span> &lt;&lt; student-&gt;<span class="hljs-built_in">getScore</span>() &lt;&lt; std::endl;
        }
    }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    GradeManager manager;
    
    manager.<span class="hljs-built_in">addStudent</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">95</span>);
    manager.<span class="hljs-built_in">addStudent</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">87</span>);
    manager.<span class="hljs-built_in">addStudent</span>(<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">92</span>);
    
    <span class="hljs-comment">// 查找成绩</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> score = manager.<span class="hljs-built_in">findScore</span>(<span class="hljs-string">"Alice"</span>)) {
        std::cout &lt;&lt; <span class="hljs-string">"Alice's score: "</span> &lt;&lt; *score &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 打印优秀学生</span>
    std::cout &lt;&lt; <span class="hljs-string">"Top students:"</span> &lt;&lt; std::endl;
    manager.<span class="hljs-built_in">printTopStudents</span>(<span class="hljs-number">90</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-18">学习建议</h2>
<ol>
<li><strong>循序渐进</strong>：从C++11开始，逐步学习C++14、C++17、C++20的新特性</li>
<li><strong>实践为主</strong>：在实际项目中应用这些特性</li>
<li><strong>理解原理</strong>：特别是移动语义和智能指针的工作原理</li>
<li><strong>关注性能</strong>：现代C++的很多特性都是为了更好的性能</li>
</ol>
<p>现代C++让编程变得更安全、更高效、更愉快。掌握这些核心特性，你将能够编写出更现代化的C++代码！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析进程间通信（IPC）及其应用场景]]></title>    <link>https://juejin.cn/post/7573506713867026483</link>    <guid>https://juejin.cn/post/7573506713867026483</guid>    <pubDate>2025-11-17T13:47:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573506713867026483" data-draft-id="7573519273030205486" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析进程间通信（IPC）及其应用场景"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T13:47:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析进程间通信（IPC）及其应用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:47:18.000Z" title="Mon Nov 17 2025 13:47:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在计算机的世界里，进程就像一个个独立的“小王国”，它们拥有自己独立的内存空间和资源。然而，一个复杂的应用往往需要多个进程协同工作，比如你的音乐播放器进程需要和系统音量控制进程通信，浏览器的一个标签页崩溃了也不能影响其他标签页。</p>
<p>那么，这些“小王国”之间如何安全、高效地传递信息呢？答案就是<strong>进程间通信</strong>。</p>
<h3 data-id="heading-0">什么是进程间通信？</h3>
<p>进程间通信是指两个或多个进程之间传输数据或信号的技术。由于进程的独立性，操作系统需要提供专门的机制来充当“信使”或“共享区域”，以实现它们之间的数据交换。</p>
<h3 data-id="heading-1">常见的进程间通信方式及其适用场景</h3>
<p>IPC的方式多种多样，没有绝对的“最佳”，只有最适合特定场景的。下面我们来一一解析。</p>
<h4 data-id="heading-2">1. 管道</h4>
<p>管道是Unix/Linux系统中最古老的IPC形式，它就像一个单向流动的水管，数据只能从一端写入，从另一端读出。</p>
<ul>
<li>
<p><strong>无名管道</strong></p>
<ul>
<li><strong>原理</strong>：在内存中创建一个缓冲区，只能用于具有亲缘关系（如父子进程）的进程间通信。</li>
<li><strong>特点</strong>：单向通信；生命周期随进程结束而结束。</li>
<li><strong>适用场景</strong>：<strong>Shell命令中的竖线 <code>|</code></strong>。例如 <code>ls | grep "test"</code>，<code>ls</code> 进程的输出通过管道传给 <code>grep</code> 进程作为输入。</li>
</ul>
</li>
<li>
<p>**有名管道</p>
<ul>
<li><strong>原理</strong>：通过一个在文件系统中存在的路径名来标识，即使没有亲缘关系的进程也可以通过打开这个“文件”进行通信。</li>
<li><strong>特点</strong>：突破了亲缘关系的限制；同样是单向通信。</li>
<li><strong>适用场景</strong>：<strong>任意两个本地进程之间的简单数据流传输</strong>。例如，一个后台服务进程和一个客户端进程之间的日志传递。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. 消息队列</h4>
<p>消息队列可以看作一个保存在内核中的消息链表，进程可以向队列中添加消息或从中读取消息。</p>
<ul>
<li><strong>原理</strong>：每个消息都是一个数据块，具有特定的类型和优先级。读取进程可以根据类型来读取，而不一定是先进先出。</li>
<li><strong>特点</strong>：
<ul>
<li><strong>异步</strong>：发送者和接收者不必同时存在。</li>
<li><strong>结构化</strong>：支持不同类型和优先级的消息。</li>
<li>相比于管道，避免了同步阻塞问题。</li>
</ul>
</li>
<li><strong>适用场景</strong>：<strong>需要异步处理、多路复用或按优先级处理消息的系统</strong>。例如，一个订单处理系统，可以将不同优先级的订单（如加急单、普通单）放入消息队列，由后端的多个处理进程消费。</li>
</ul>
<h4 data-id="heading-4">3. 共享内存</h4>
<p>这是<strong>最快</strong>的IPC方式，因为它绕过了内核的拷贝操作。</p>
<ul>
<li><strong>原理</strong>：多个进程共享同一块物理内存区域，这片区域被映射到它们各自的地址空间。进程可以直接读写这块内存，就像读写自己的内存一样。</li>
<li><strong>特点</strong>：
<ul>
<li><strong>极高性能</strong>：无需数据拷贝。</li>
<li><strong>需要同步</strong>：因为共享内存本身没有提供同步机制，所以进程间必须使用信号量、互斥锁等机制来协调对共享区域的访问，防止数据竞争。</li>
</ul>
</li>
<li><strong>适用场景</strong>：<strong>对性能要求极高的场景</strong>，如大型数据库、科学计算、高频交易系统。这些场景下，需要交换的数据量巨大，频繁的系统调用和数据拷贝会成为性能瓶颈。</li>
</ul>
<h4 data-id="heading-5">4. 信号量</h4>
<p>信号量本身不传输数据，而是作为一个<strong>计数器</strong>，用于控制多个进程对共享资源的访问，解决同步和互斥问题。</p>
<ul>
<li><strong>原理</strong>：它主要用于实现进程间的同步（协调执行顺序）和互斥（防止同时访问临界资源）。经典的PV操作就是基于信号量。</li>
<li><strong>特点</strong>：是一种锁机制。</li>
<li><strong>适用场景</strong>：<strong>作为其他IPC机制（尤其是共享内存）的“保镖”</strong>，确保同一时刻只有一个进程在访问共享资源。也可以用于控制一组资源的访问，例如限制同时访问某个文件的进程数量。</li>
</ul>
<h4 data-id="heading-6">5. 信号</h4>
<p>信号是进程间通信机制中<strong>唯一的异步通信方式</strong>。</p>
<ul>
<li><strong>原理</strong>：用于通知接收进程某个事件已经发生。例如，当你在终端按下 <code>Ctrl+C</code> 时，会向当前前台进程发送一个 <code>SIGINT</code> 信号，通知它中断。</li>
<li><strong>特点</strong>：轻量级；主要用于通知，而不是传输大量数据。</li>
<li><strong>适用场景</strong>：<strong>处理异常、中断或简单的进程控制</strong>。例如，通知进程退出、重新加载配置、处理程序异常等。</li>
</ul>
<h4 data-id="heading-7">6. 套接字</h4>
<p>套接字是功能最强大的IPC机制，它不仅可以用于同一台机器上的进程间通信，更可以用于网络中不同主机上的进程间通信。</p>
<ul>
<li><strong>原理</strong>：通过网络协议（如TCP/IP）进行通信。在本机通信时，可以使用Unix Domain Socket，它比网络套接字更高效，因为它不需要处理网络协议栈。</li>
<li><strong>特点</strong>：
<ul>
<li><strong>跨网络</strong>：通信范围最广。</li>
<li><strong>通用性强</strong>：有标准的编程接口。</li>
</ul>
</li>
<li><strong>适用场景</strong>：
<ul>
<li><strong>网络通信</strong>：所有C/S架构的应用，如Web服务器、聊天软件、远程数据库连接。</li>
<li><strong>本地通信</strong>：<strong>Unix Domain Socket</strong> 常用于同一主机上不同守护进程或客户端/服务器程序之间的高效通信，如Docker守护进程。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">总结与选择指南</h3>





































































<table><thead><tr><th align="left">IPC机制</th><th align="left">通信关系</th><th align="left">性能</th><th align="left">数据量</th><th align="left">核心特点</th><th align="left">典型场景</th></tr></thead><tbody><tr><td align="left"><strong>无名管道</strong></td><td align="left">父子进程</td><td align="left">中</td><td align="left">小</td><td align="left">简单、单向、亲缘关系</td><td align="left">Shell命令管道</td></tr><tr><td align="left"><strong>有名管道</strong></td><td align="left">任意进程</td><td align="left">中</td><td align="left">小</td><td align="left">有名字、单向、任意进程</td><td align="left">本地简单客户端/服务器</td></tr><tr><td align="left"><strong>消息队列</strong></td><td align="left">任意进程</td><td align="left">中</td><td align="left">中</td><td align="left">异步、结构化、支持优先级</td><td align="left">订单处理、异步任务队列</td></tr><tr><td align="left"><strong>共享内存</strong></td><td align="left">任意进程</td><td align="left"><strong>极高</strong></td><td align="left"><strong>大</strong></td><td align="left">最快、需同步</td><td align="left">数据库、高性能计算、图形处理</td></tr><tr><td align="left"><strong>信号量</strong></td><td align="left">任意进程</td><td align="left">-</td><td align="left">-</td><td align="left">同步控制，不传数据</td><td align="left">保护共享内存、资源池管理</td></tr><tr><td align="left"><strong>信号</strong></td><td align="left">任意进程</td><td align="left">高</td><td align="left">无</td><td align="left">异步通知、轻量级</td><td align="left">进程控制、中断处理</td></tr><tr><td align="left"><strong>套接字</strong></td><td align="left">任意/网络进程</td><td align="left">中/高</td><td align="left">大</td><td align="left"><strong>最通用、可跨网络</strong></td><td align="left">Web服务、分布式系统、本地守护进程通信</td></tr></tbody></table>
<p><strong>如何选择？</strong></p>
<ul>
<li><strong>追求极致性能，且数据量大</strong>：首选<strong>共享内存</strong>，并配合<strong>信号量</strong>进行同步。</li>
<li><strong>需要异步处理和解耦</strong>：考虑使用<strong>消息队列</strong>。</li>
<li><strong>简单的数据流，且有亲缘关系</strong>：使用<strong>无名管道</strong>。</li>
<li><strong>简单的数据流，无亲缘关系</strong>：使用<strong>有名管道</strong>。</li>
<li><strong>需要跨网络通信</strong>：必须使用<strong>套接字</strong>。</li>
<li><strong>仅需通知事件，不传数据</strong>：使用<strong>信号</strong>。</li>
<li><strong>本地客户端/服务器，希望高效且通用</strong>：使用<strong>Unix Domain Socket</strong>。</li>
</ul>
<p>理解各种IPC方式的优缺点和适用场景，是设计出高效、稳定、可扩展的软件系统的关键一步。希望这篇博客能帮助你更好地为你的项目选择最合适的“通信官”！</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[接手祖传代码后，我终于理解了"组合优于继承"]]></title>    <link>https://juejin.cn/post/7573508048141893641</link>    <guid>https://juejin.cn/post/7573508048141893641</guid>    <pubDate>2025-11-17T13:47:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508048141893641" data-draft-id="7573528564026212398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="接手祖传代码后，我终于理解了&quot;组合优于继承&quot;"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-17T13:47:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            接手祖传代码后，我终于理解了"组合优于继承"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:47:59.000Z" title="Mon Nov 17 2025 13:47:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>不管是看些博客，文章还是啥，经常会看到"组合优于继承"这句话，心里想的是：啥玩意儿？继承多好用啊，extends一下就完事了，还能复用代码，多香。也没去详细想过相关的问题。</p>
<p>直到有一天，我接手了一个"祖传"项目，看到了这样的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mammal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Mammal</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GuideDog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Dog</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceDog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">GuideDog</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TherapyDog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ServiceDog</span> {}

<span class="hljs-comment">// 我：???这是什么套娃现场</span>
</code></pre>
<p>然后产品经理说：我们要加个会飞的狗。</p>
<p>我：......</p>
<p>这时候才明白，原来继承不是万能的。今天就来聊聊为什么"组合优于继承"，以及什么时候该用继承，什么时候该用组合。</p>
<h2 data-id="heading-1">继承的问题到底在哪</h2>
<h3 data-id="heading-2">问题1：类层次太脆弱</h3>
<p>继承最大的问题是：<strong>你的子类和父类绑死了</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying`</span>;
  }

  <span class="hljs-title function_">layEggs</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> laid eggs`</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Penguin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Bird</span> {
  <span class="hljs-comment">// 问题来了：企鹅不会飞</span>
  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Penguins cannot fly!'</span>);
  }
}

<span class="hljs-keyword">const</span> penguin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Penguin</span>(<span class="hljs-string">'波波'</span>);
penguin.<span class="hljs-title function_">fly</span>(); <span class="hljs-comment">// 💥 抛错了</span>
</code></pre>
<p>你看，企鹅确实是鸟，但它不会飞。如果用继承，要么：</p>
<ol>
<li>在子类里覆盖方法抛错（但这违反了里氏替换原则）</li>
<li>把父类拆成更细的类（但这又导致类爆炸）</li>
</ol>
<p>这就是所谓的"脆弱基类问题"（Fragile Base Class Problem）。父类改一点东西，所有子类都可能挂。</p>
<h3 data-id="heading-3">问题2：多继承的困境</h3>
<p>JavaScript只支持单继承，但现实世界很多东西需要多种能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我想要一个会飞又会游泳的鸭子</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Bird</span>, <span class="hljs-title class_">Fish</span> {  <span class="hljs-comment">// ❌ 语法错误，JS不支持多继承</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>有人说，那我用Mixin啊：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Bird</span> {}
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Duck</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-title class_">Swimmable</span>, <span class="hljs-title class_">Diveable</span>);
</code></pre>
<p>但这又引入了新问题：</p>
<ul>
<li>Mixin的方法可能冲突</li>
<li>没有类型检查</li>
<li>原型链变得混乱</li>
</ul>
<h3 data-id="heading-4">问题3：逻辑散落在继承链中</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += <span class="hljs-number">10</span>;  <span class="hljs-comment">// 等等，energy在哪定义的？</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mammal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> = <span class="hljs-number">100</span>;  <span class="hljs-comment">// 原来在这</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Mammal</span> {
  <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &lt; <span class="hljs-number">20</span>) {  <span class="hljs-comment">// 要理解这个逻辑，得翻三层继承链</span>
      <span class="hljs-keyword">return</span> <span class="hljs-string">'Too tired to bark'</span>;
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= <span class="hljs-number">5</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Woof!'</span>;
  }
}
</code></pre>
<p>要理解<code>Dog.bark()</code>的完整逻辑，你得：</p>
<ol>
<li>看Dog类的bark方法</li>
<li>往上翻Mammal的构造函数（找energy定义）</li>
<li>再往上翻Animal的eat方法（看energy怎么变化）</li>
</ol>
<p>这就是"知识散落"问题。继承链一长，代码就像侦探小说，到处找线索。</p>
<h2 data-id="heading-5">组合是什么</h2>
<p>组合的核心思想很简单：<strong>把功能拆成独立的小块，需要什么就组装什么</strong>。</p>
<p>就像搭乐高：</p>
<ul>
<li>继承：买了个"城堡套装"，想改成"太空站"，得把塔楼锯掉，很麻烦</li>
<li>组合：买了一堆积木，想搭啥搭啥</li>
</ul>
<h3 data-id="heading-6">最简单的组合例子</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 把能力定义成独立的对象</span>
<span class="hljs-keyword">const</span> canFly = {
  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying at <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.flySpeed}</span> km/h`</span>;
  }
};

<span class="hljs-keyword">const</span> canSwim = {
  <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming at <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.swimSpeed}</span> km/h`</span>;
  }
};

<span class="hljs-keyword">const</span> canWalk = {
  <span class="hljs-title function_">walk</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is walking at <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.walkSpeed}</span> km/h`</span>;
  }
};

<span class="hljs-comment">// 鸭子：会飞、会游、会走</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDuck</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-keyword">const</span> duck = {
    name,
    <span class="hljs-attr">flySpeed</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">swimSpeed</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">walkSpeed</span>: <span class="hljs-number">3</span>
  };

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(duck, canFly, canSwim, canWalk);
}

<span class="hljs-comment">// 企鹅：只会游、会走</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createPenguin</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-keyword">const</span> penguin = {
    name,
    <span class="hljs-attr">swimSpeed</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">walkSpeed</span>: <span class="hljs-number">2</span>
  };

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(penguin, canSwim, canWalk);
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-title function_">createDuck</span>(<span class="hljs-string">'唐老鸭'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(duck.<span class="hljs-title function_">fly</span>());   <span class="hljs-comment">// ✅ 唐老鸭 is flying at 50 km/h</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(duck.<span class="hljs-title function_">swim</span>());  <span class="hljs-comment">// ✅ 唐老鸭 is swimming at 5 km/h</span>

<span class="hljs-keyword">const</span> penguin = <span class="hljs-title function_">createPenguin</span>(<span class="hljs-string">'波波'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(penguin.<span class="hljs-title function_">swim</span>()); <span class="hljs-comment">// ✅ 波波 is swimming at 30 km/h</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(penguin.<span class="hljs-property">fly</span>);    <span class="hljs-comment">// ✅ undefined - 企鹅本来就不会飞</span>
</code></pre>
<p>看到区别了吗？</p>
<ul>
<li>用继承：企鹅继承了Bird，但得覆盖fly方法抛错</li>
<li>用组合：企鹅压根不组装fly能力，自然就不会飞</li>
</ul>
<h2 data-id="heading-7">组合的几种实现方式</h2>
<h3 data-id="heading-8">方式1：工厂函数 + Object.assign</h3>
<p>这是最简单的方式，上面已经展示过了。优点是简单直接，缺点是没有类型提示。</p>
<h3 data-id="heading-9">方式2：类组合（Class Composition）</h3>
<p>如果你喜欢class语法，可以这样：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
}

<span class="hljs-comment">// 把能力定义成装饰函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">withFlying</span>(<span class="hljs-params">Base</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying`</span>;
    }
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">withSwimming</span>(<span class="hljs-params">Base</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming`</span>;
    }
  };
}

<span class="hljs-comment">// 组装能力</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">withSwimming</span>(<span class="hljs-title function_">withFlying</span>(<span class="hljs-title class_">Animal</span>)) {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">super</span>(name);
  }
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Duck</span>(<span class="hljs-string">'唐老鸭'</span>);
duck.<span class="hljs-title function_">fly</span>();   <span class="hljs-comment">// ✅</span>
duck.<span class="hljs-title function_">swim</span>();  <span class="hljs-comment">// ✅</span>
duck <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>; <span class="hljs-comment">// ✅ true</span>
</code></pre>
<p>这种方式的好处是：</p>
<ul>
<li>保留了class的语法</li>
<li>instanceof检查仍然有效</li>
<li>IDE能提供代码补全</li>
</ul>
<h3 data-id="heading-10">方式3：依赖注入</h3>
<p>更高级的做法是把能力注入进去：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, abilities = []</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;

    <span class="hljs-comment">// 注入能力</span>
    abilities.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">ability</span> =&gt;</span> {
      ability.<span class="hljs-title function_">attachTo</span>(<span class="hljs-variable language_">this</span>);
    });
  }
}

<span class="hljs-comment">// 定义能力模块</span>
<span class="hljs-keyword">const</span> flyingAbility = {
  <span class="hljs-title function_">attachTo</span>(<span class="hljs-params">target</span>) {
    target.<span class="hljs-property">flySpeed</span> = <span class="hljs-number">50</span>;
    target.<span class="hljs-property">fly</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying at <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.flySpeed}</span> km/h`</span>;
    };
  }
};

<span class="hljs-keyword">const</span> swimmingAbility = {
  <span class="hljs-title function_">attachTo</span>(<span class="hljs-params">target</span>) {
    target.<span class="hljs-property">swimSpeed</span> = <span class="hljs-number">10</span>;
    target.<span class="hljs-property">swim</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming at <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.swimSpeed}</span> km/h`</span>;
    };
  }
};

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">const</span> duck = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>(<span class="hljs-string">'唐老鸭'</span>, [flyingAbility, swimmingAbility]);
<span class="hljs-keyword">const</span> penguin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>(<span class="hljs-string">'波波'</span>, [swimmingAbility]);

duck.<span class="hljs-title function_">fly</span>();    <span class="hljs-comment">// ✅</span>
penguin.<span class="hljs-property">fly</span>;   <span class="hljs-comment">// ✅ undefined</span>
</code></pre>
<p>这种方式更灵活，能力模块可以有自己的初始化逻辑。</p>
<h2 data-id="heading-11">实战案例：重构继承代码</h2>
<p>来看个真实场景。假设我们要做一个游戏角色系统。</p>
<h3 data-id="heading-12">用继承实现（一团糟）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Character</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, hp, mp</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> = hp;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mp</span> = mp;
  }

  <span class="hljs-title function_">attack</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> attacks!`</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Character</span> {
  <span class="hljs-title function_">castSpell</span>(<span class="hljs-params">spellName</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mp</span> &lt; <span class="hljs-number">10</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Not enough MP!'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mp</span> -= <span class="hljs-number">10</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> casts <span class="hljs-subst">${spellName}</span>!`</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Warrior</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Character</span> {
  <span class="hljs-title function_">useSkill</span>(<span class="hljs-params">skillName</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> &lt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Too injured!'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> -= <span class="hljs-number">20</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> uses <span class="hljs-subst">${skillName}</span>!`</span>;
  }
}

<span class="hljs-comment">// 现在产品说：我们要加个"魔剑士"，既能施法又能用战技</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpellBlade</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Mage</span> {  <span class="hljs-comment">// 继承法师</span>
  <span class="hljs-title function_">useSkill</span>(<span class="hljs-params">skillName</span>) {  <span class="hljs-comment">// 复制粘贴战士的代码</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> &lt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Too injured!'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> -= <span class="hljs-number">20</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> uses <span class="hljs-subst">${skillName}</span>!`</span>;
  }
}

<span class="hljs-comment">// 问题：</span>
<span class="hljs-comment">// 1. SpellBlade复制了Warrior的代码（违反DRY原则：DRY - Don't Repeat Yourself（不要重复自己））</span>
<span class="hljs-comment">// 2. 如果Warrior的useSkill改了，SpellBlade也得改</span>
<span class="hljs-comment">// 3. 继承Mage还是Warrior？这是个哲学问题</span>
</code></pre>
<h3 data-id="heading-13">用组合重构（清爽）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 把能力拆成独立模块</span>
<span class="hljs-keyword">const</span> combatAbility = {
  <span class="hljs-title function_">attack</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> attacks for <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.attackPower}</span> damage!`</span>;
  }
};

<span class="hljs-keyword">const</span> magicAbility = {
  <span class="hljs-title function_">castSpell</span>(<span class="hljs-params">spellName</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mp</span> &lt; <span class="hljs-number">10</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Not enough MP!'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mp</span> -= <span class="hljs-number">10</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> casts <span class="hljs-subst">${spellName}</span>!`</span>;
  }
};

<span class="hljs-keyword">const</span> skillAbility = {
  <span class="hljs-title function_">useSkill</span>(<span class="hljs-params">skillName</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> &lt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Too injured!'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hp</span> -= <span class="hljs-number">20</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> uses <span class="hljs-subst">${skillName}</span>!`</span>;
  }
};

<span class="hljs-comment">// 工厂函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createCharacter</span>(<span class="hljs-params">name, hp, mp, abilities</span>) {
  <span class="hljs-keyword">const</span> character = {
    name,
    hp,
    mp,
    <span class="hljs-attr">attackPower</span>: <span class="hljs-number">50</span>
  };

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(character, ...abilities);
}

<span class="hljs-comment">// 创建不同职业</span>
<span class="hljs-keyword">const</span> mage = <span class="hljs-title function_">createCharacter</span>(<span class="hljs-string">'甘道夫'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, [combatAbility, magicAbility]);
<span class="hljs-keyword">const</span> warrior = <span class="hljs-title function_">createCharacter</span>(<span class="hljs-string">'阿拉贡'</span>, <span class="hljs-number">200</span>, <span class="hljs-number">50</span>, [combatAbility, skillAbility]);
<span class="hljs-keyword">const</span> spellBlade = <span class="hljs-title function_">createCharacter</span>(<span class="hljs-string">'塞尔达'</span>, <span class="hljs-number">150</span>, <span class="hljs-number">150</span>, [combatAbility, magicAbility, skillAbility]);

mage.<span class="hljs-title function_">castSpell</span>(<span class="hljs-string">'火球术'</span>);        <span class="hljs-comment">// ✅</span>
warrior.<span class="hljs-title function_">useSkill</span>(<span class="hljs-string">'狂战士之怒'</span>);   <span class="hljs-comment">// ✅</span>
spellBlade.<span class="hljs-title function_">castSpell</span>(<span class="hljs-string">'雷电术'</span>);  <span class="hljs-comment">// ✅</span>
spellBlade.<span class="hljs-title function_">useSkill</span>(<span class="hljs-string">'剑气斩'</span>);   <span class="hljs-comment">// ✅</span>
</code></pre>
<p>用组合的好处：</p>
<ol>
<li>代码不重复，每个能力只定义一次</li>
<li>能力可以随意组合，想要什么组装什么</li>
<li>新增职业超简单，改一下能力列表就行</li>
</ol>
<h2 data-id="heading-14">什么时候该用继承</h2>
<p>说了这么多组合的好处，难道继承就完全没用了吗？</p>
<p>也不是。继承适合这些场景：</p>
<h3 data-id="heading-15">场景1：严格的"is-a"关系</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeError</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Error</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-variable language_">super</span>(message);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'TypeError'</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReferenceError</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Error</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-variable language_">super</span>(message);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'ReferenceError'</span>;
  }
}
</code></pre>
<p>TypeError <strong>确实是</strong> Error的一种，这种关系很稳定，不会变。用继承没毛病。</p>
<h3 data-id="heading-16">场景2：需要利用多态</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-title function_">getArea</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'子类必须实现getArea方法'</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Shape</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">radius</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> = radius;
  }

  <span class="hljs-title function_">getArea</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Shape</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">width, height</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> = width;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> = height;
  }

  <span class="hljs-title function_">getArea</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>;
  }
}

<span class="hljs-comment">// 利用多态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateTotalArea</span>(<span class="hljs-params">shapes</span>) {
  <span class="hljs-keyword">return</span> shapes.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, shape</span>) =&gt;</span> sum + shape.<span class="hljs-title function_">getArea</span>(), <span class="hljs-number">0</span>);
}

<span class="hljs-keyword">const</span> shapes = [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-number">5</span>),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-number">3</span>)
];

<span class="hljs-title function_">calculateTotalArea</span>(shapes); <span class="hljs-comment">// 统一调用getArea，不用管具体类型</span>
</code></pre>
<p>这种情况继承的优势很明显：所有形状都有getArea方法，可以统一处理。</p>
<h3 data-id="heading-17">场景3：框架要求</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React组件必须继承React.Component</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
}

<span class="hljs-comment">// 虽然现在有了函数组件，但类组件时代就是这样</span>
</code></pre>
<p>框架规定了继承，那就没办法，得用。</p>
<h2 data-id="heading-18">组合和继承的混合使用</h2>
<p>实际项目中，往往是组合和继承混着用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用继承表达"is-a"关系</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, energy</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> = energy;
  }

  <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += <span class="hljs-number">10</span>;
  }
}

<span class="hljs-comment">// 用组合添加能力</span>
<span class="hljs-keyword">const</span> canFly = {
  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &lt; <span class="hljs-number">10</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Too tired to fly'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= <span class="hljs-number">10</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying`</span>;
  }
};

<span class="hljs-keyword">const</span> canSwim = {
  <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &lt; <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Too tired to swim'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= <span class="hljs-number">5</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming`</span>;
  }
};

<span class="hljs-comment">// 鸭子是动物（继承），会飞会游（组合）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">super</span>(name, <span class="hljs-number">100</span>);
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-variable language_">this</span>, canFly, canSwim);
  }
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Duck</span>(<span class="hljs-string">'唐老鸭'</span>);
duck.<span class="hljs-title function_">eat</span>();    <span class="hljs-comment">// 继承自Animal</span>
duck.<span class="hljs-title function_">fly</span>();    <span class="hljs-comment">// 组合的能力</span>
duck.<span class="hljs-title function_">swim</span>();   <span class="hljs-comment">// 组合的能力</span>
</code></pre>
<p>这样既保留了继承的多态性，又有了组合的灵活性。</p>
<h2 data-id="heading-19">TypeScript中的组合</h2>
<p>在TS里，组合的类型安全性更好：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义能力接口</span>
interface <span class="hljs-title class_">Flyable</span> {
  <span class="hljs-attr">flySpeed</span>: number;
  <span class="hljs-title function_">fly</span>(): string;
}

interface <span class="hljs-title class_">Swimmable</span> {
  <span class="hljs-attr">swimSpeed</span>: number;
  <span class="hljs-title function_">swim</span>(): string;
}

<span class="hljs-comment">// 组合类型</span>
type <span class="hljs-title class_">Duck</span> = {
  <span class="hljs-attr">name</span>: string;
} &amp; <span class="hljs-title class_">Flyable</span> &amp; <span class="hljs-title class_">Swimmable</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDuck</span>(<span class="hljs-params">name: string</span>): <span class="hljs-title class_">Duck</span> {
  <span class="hljs-keyword">return</span> {
    name,
    <span class="hljs-attr">flySpeed</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">swimSpeed</span>: <span class="hljs-number">10</span>,
    <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is flying`</span>;
    },
    <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> is swimming`</span>;
    }
  };
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-title function_">createDuck</span>(<span class="hljs-string">'唐老鸭'</span>);
duck.<span class="hljs-title function_">fly</span>();   <span class="hljs-comment">// ✅ 类型安全</span>
duck.<span class="hljs-title function_">walk</span>();  <span class="hljs-comment">// ❌ 编译错误：Duck没有walk方法</span>
</code></pre>
<p>TS的类型系统天然支持组合，用起来比继承舒服多了。</p>
<h2 data-id="heading-20">总结</h2>
<p>"组合优于继承"不是说继承一无是处，而是说：</p>
<ol>
<li><strong>优先考虑组合</strong>：大部分场景下，组合更灵活、更好维护</li>
<li><strong>继承也有用</strong>：严格的is-a关系、需要多态、框架要求等场景下继承更合适</li>
<li><strong>两者结合</strong>：实际项目中往往是组合 + 继承混用</li>
</ol>
<p>记住一个原则：<strong>如果你在纠结该不该用继承，那大概率应该用组合</strong>。</p>
<p>最后用一句话概括：</p>
<ul>
<li>继承是"你是什么"（you are what you are）</li>
<li>组合是"你能做什么"（you are what you do）</li>
</ul>
<p>世界是由能力组成的，不是由血统组成的。代码也一样。</p>
<hr/>
<p>参考文档：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FComposition_over_inheritance" target="_blank" title="https://en.wikipedia.org/wiki/Composition_over_inheritance" ref="nofollow noopener noreferrer">Composition over inheritance - Wikipedia</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FDesign_Patterns" target="_blank" title="https://en.wikipedia.org/wiki/Design_Patterns" ref="nofollow noopener noreferrer">《设计模式》- Gang of Four</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.info%2Fmixins" target="_blank" title="https://javascript.info/mixins" ref="nofollow noopener noreferrer">Functional Mixins in JavaScript</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决 Claude Code 在 VSCode 终端 Shift+Enter 不能换行的问题]]></title>    <link>https://juejin.cn/post/7573508048141926409</link>    <guid>https://juejin.cn/post/7573508048141926409</guid>    <pubDate>2025-11-17T13:54:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508048141926409" data-draft-id="7573521516324454427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决 Claude Code 在 VSCode 终端 Shift+Enter 不能换行的问题"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-17T13:54:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决 Claude Code 在 VSCode 终端 Shift+Enter 不能换行的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:54:40.000Z" title="Mon Nov 17 2025 13:54:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">解决 Claude Code 在 VSCode 终端 Shift+Enter 不能换行的问题</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/508c7a709d6d4153ae1e6f04097a22d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763992480&amp;x-signature=%2Br10HU4XNB5jBRSZyku2ehrfzxQ%3D" alt="image.png" loading="lazy"/></p>
<p>在 VSCode 终端里用 Claude Code，想输入多行代码或者问题，按 Shift+Enter 结果直接就发送了？这个问题困扰了不少人。</p>
<p>今天排查这个问题的时候，发现问题比想象的复杂——不是简单的配置错了，而是涉及到终端模拟器、VSCode 键绑定、Claude Code 输入处理的多层交互。</p>
<p>问题的表现：</p>
<ul>
<li>在 VSCode 终端中按 Shift+Enter，消息直接发送，无法换行</li>
<li>明明配置了 keybinding，但就是不生效</li>
<li>运行 <code>/terminal-setup</code> 命令也解决不了</li>
<li>但在 Ghostty 等独立终端中，Shift+Enter 可以正常换行</li>
</ul>
<h3 data-id="heading-1">问题排查过程</h3>
<h4 data-id="heading-2">第一步：检查是否是版本更新导致的</h4>
<p>先看了下 Claude Code 的版本和更新时间：</p>
<pre><code class="hljs language-bash" lang="bash">claude --version
<span class="hljs-comment"># 输出：2.0.37 (Claude Code)</span>

<span class="hljs-built_in">ls</span> -la /Users/tsk/.npm-global/lib/node_modules/@anthropic-ai/claude-code/
<span class="hljs-comment"># 发现是今天上午 10:46 刚更新的</span>
</code></pre>
<p>问题就出现在更新后，所以第一反应是版本更新导致的。但后来发现不是这么简单。</p>
<h4 data-id="heading-3">第二步：检查 VSCode 的键绑定配置</h4>
<p>看了下 <code>keybindings.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shift+enter"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workbench.action.terminal.sendSequence"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"\\\r\n"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"terminalFocus"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>配置看起来没问题，但就是不生效。</p>
<h4 data-id="heading-4">第三步：发现真正的元凶 - Ghostty</h4>
<p>继续排查，发现用户今天安装了 Ghostty 终端。检查 Ghostty 的配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/Library/Application\ Support/com.mitchellh.ghostty/config
</code></pre>
<p>发现了这一行：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">keybind</span> = shift+enter=text:\x1b\r
</code></pre>
<p><strong>这就是问题所在！</strong> Ghostty 的键绑定配置会影响 VSCode 终端的行为（因为 VSCode 配置中添加了 Ghostty 作为终端选项）。</p>
<p>但有意思的是，注释掉这一行后，Ghostty 里 Shift+Enter 反而不能用了，而 VSCode 终端里还是不行。</p>
<h4 data-id="heading-5">第四步：深入理解键盘事件的处理链路</h4>
<p>这时候需要理解 Ghostty 和 VSCode 终端处理键盘的区别：</p>
<p><strong>Ghostty（独立终端）的处理流程：</strong></p>
<pre><code class="hljs">键盘 → Ghostty 配置直接处理 → 发送序列给应用
</code></pre>
<p><strong>VSCode 终端（嵌入式）的处理流程：</strong></p>
<pre><code class="hljs">键盘 → VSCode 主进程 → VSCode 键绑定 → 终端组件 → Shell → 应用
</code></pre>
<p>这解释了为什么同样的配置在 Ghostty 中生效，在 VSCode 中不生效——<strong>层级太多，中间可能被拦截或转换</strong>。</p>
<h4 data-id="heading-6">第五步：找到根本原因</h4>
<p>检查 VSCode 的 <code>settings.json</code>，发现了关键配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"terminal.integrated.sendKeybindingsToShell"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这个配置的意思是：<strong>将键绑定直接发送给 shell，而不是让 VSCode 处理</strong>。</p>
<p>这就是为什么 <code>keybindings.json</code> 配置了也不生效的原因——VSCode 根本没去处理它，直接发给 shell 了。</p>
<h4 data-id="heading-7">第六步：找到正确的键序列</h4>
<p>在 GitHub Issue <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Fissues%2F2754" target="_blank" title="https://github.com/anthropics/claude-code/issues/2754" ref="nofollow noopener noreferrer">#2754</a> 中，有用户分享了有效的解决方案：</p>
<blockquote>
<p>Option+Enter always works for me on macOS, so I captured the keycodes and it sends an Escape (\u001B) and a Linefeed (\u000A). Updating the keybinding above makes Shift+Enter work identically to Option+Enter in VSCode on macOS.</p>
</blockquote>
<p>原来 Claude Code 能识别的换行序列是：<code>\u001b\n</code>（ESC + LF）。</p>
<h3 data-id="heading-8">最终解决方案</h3>
<p>需要同时修改两个配置文件：</p>
<h4 data-id="heading-9">1. 修改 <code>keybindings.json</code></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shift+enter"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workbench.action.terminal.sendSequence"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"\u001b\n"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"terminalFocus"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>路径：<code>~/Library/Application Support/Code/User/keybindings.json</code></p>
<h4 data-id="heading-10">2. 修改 <code>settings.json</code></h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"terminal.integrated.sendKeybindingsToShell"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>路径：<code>~/Library/Application Support/Code/User/settings.json</code></p>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>\u001b\n</code> 是 ESC + Linefeed 的组合，这是 Claude Code 能识别的换行序列</li>
<li><code>sendKeybindingsToShell: false</code> 让 VSCode 先处理键绑定，而不是直接发给 shell</li>
</ul>
<h4 data-id="heading-11">3. 重新加载 VSCode</h4>
<p>修改完配置后，需要：</p>
<ol>
<li>完全退出 VSCode（不是重新加载窗口）</li>
<li>重新打开 VSCode</li>
<li>打开新终端，启动 Claude Code</li>
<li>测试 Shift+Enter</li>
</ol>
<h3 data-id="heading-12">为什么 Ghostty 中可以生效</h3>
<p>Ghostty 是独立的终端模拟器，它直接控制所有键盘输入，配置文件中的 <code>keybind</code> 在最底层处理键盘事件，没有其他层级干扰。</p>
<p>而 VSCode 终端是嵌入式的，键盘事件要经过多层处理：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[键盘输入] --&gt; B[VSCode 主进程]
    B --&gt; C[键绑定系统]
    C --&gt; D[终端组件]
    D --&gt; E[Shell]
    E --&gt; F[Claude Code]

    style B fill:#e1f5ff
    style C fill:#fff3cd
    style D fill:#f8d7da
</code></pre>
<p>每一层都可能拦截或转换键盘序列，所以需要精确配置才能让 Shift+Enter 正确到达 Claude Code。</p>
<h3 data-id="heading-13">总结</h3>
<p>这个问题的关键在于理解：</p>
<p><strong>技术层面</strong>：</p>
<ul>
<li>Claude Code 接受的换行序列是 <code>\u001b\n</code>（ESC + LF）</li>
<li>VSCode 的 <code>sendKeybindingsToShell</code> 设置会影响键绑定是否生效</li>
<li>独立终端和嵌入式终端处理键盘事件的方式完全不同</li>
</ul>
<p><strong>实用层面</strong>：</p>
<ul>
<li>Ghostty 配置会影响 VSCode 终端（如果 VSCode 添加了 Ghostty profile）</li>
<li><code>/terminal-setup</code> 命令不一定能解决所有环境的问题</li>
<li>Option+Enter 是 Claude Code 官方推荐的换行方式（弱点是不符合其他工具的习惯）</li>
</ul>
<p><strong>踩坑建议</strong>：</p>
<ol>
<li><strong>在 VSCode 终端使用 Claude Code</strong>：修改 <code>keybindings.json</code> + 设置 <code>sendKeybindingsToShell: false</code> → 重启 VSCode → 测试（<strong>记得完全退出 VSCode，不是重新加载窗口</strong>！）</li>
<li><strong>在 Ghostty 等独立终端使用</strong>：在终端配置文件中添加 <code>keybind = shift+enter=text:\x1b\r</code> → 重新加载配置 → 搞定</li>
<li><strong>嫌麻烦的话</strong>：直接用 <code>Option+Enter</code> 换行，用 <code>Enter</code> 发送消息</li>
</ol>
<hr/>
<h3 data-id="heading-14">相关资源</h3>
<h4 data-id="heading-15">GitHub Issues</h4>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Fissues%2F2754" target="_blank" title="https://github.com/anthropics/claude-code/issues/2754" ref="nofollow noopener noreferrer">Issue #2754: Shift+Enter does NOT newline</a></strong> - 有效解决方案的来源</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Fissues%2F1259" target="_blank" title="https://github.com/anthropics/claude-code/issues/1259" ref="nofollow noopener noreferrer">Issue #1259: Support Shift+Enter for multiline input</a></strong> - 长期跟踪的功能请求</li>
</ol>
<h4 data-id="heading-16">官方文档</h4>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fen%2Fterminal-config" target="_blank" title="https://code.claude.com/docs/en/terminal-config" ref="nofollow noopener noreferrer">Claude Code Terminal Config</a></strong> - 官方终端配置指南</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Fterminal%2Fbasics%23_keybindings" target="_blank" title="https://code.visualstudio.com/docs/terminal/basics#_keybindings" ref="nofollow noopener noreferrer">VSCode Terminal Keybindings</a></strong> - VSCode 终端键绑定文档</li>
</ol>
<hr/>
<p>有问题欢迎交流，GitHub Issue 里也有很多用户在讨论这个问题，可以看看不同环境下的解决方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端高频面试题之Vue-router篇]]></title>    <link>https://juejin.cn/post/7573504290066792463</link>    <guid>https://juejin.cn/post/7573504290066792463</guid>    <pubDate>2025-11-17T13:58:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573504290066792463" data-draft-id="7573508361741860864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端高频面试题之Vue-router篇"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2025-11-17T13:58:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端高频面试题之Vue-router篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T13:58:00.000Z" title="Mon Nov 17 2025 13:58:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、Vue Router 是什么？它解决了什么问题？</h2>
<p><code>Vue-router</code> 是 <code>Vue.js</code> 的官方路由，是 <code>Vue.js</code> 构建单页应用的路由解决方案。每一个页面对应一个路由，它通过路由表，维护每个路由和组件的对应关系，在切换路由时，使得之前的组件失活并且渲染激活新对应的组件，实现单页应用的流畅切换，而无需刷新页面，提高了用户体验和性能。</p>
<h2 data-id="heading-1">2、什么是单页应用和多页应用？</h2>
<h3 data-id="heading-2">2.1 单页应用（Single Page Application, SPA）</h3>
<p>所谓单页应用（Single Page Application, SPA），就是整个应用只有一个 html 页面，即<code>index.html</code>，html 加载后通过 javascript 动态创建和渲染内容，用户点击时，通过监听客户端路由变化去局部更新 DOM，而无需刷新页面就能达到页面切换的目的。</p>
<ul>
<li><strong>特点</strong>：<strong>客户端渲染 + 前端路由</strong>。</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>用户体验好。</li>
<li>服务端资源占用少。</li>
<li>开发效率高（前后端分离开发模式）。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>首屏加载慢。</li>
<li>SEO不友好。</li>
<li>内存占用多（可能导致内存泄漏）。</li>
</ul>
<h3 data-id="heading-3">2.2 多页应用 (Multi Page Application, MPA)</h3>
<p>与 SPA 对应是多页应用 (Multi Page Application, MPA)，每个页面都有独立 html 页面，每次用户导航时会向服务器发起请求拿到对应的 html 页面。</p>
<ul>
<li><strong>特点</strong>：<strong>服务端端渲染 + 服务端路由</strong>。</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>SEO 友好。</li>
<li>首屏加载快。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>页面切换时体验没有 spa 丝滑。</li>
<li>服务器资源占用多，成本高。</li>
<li>开发复杂（前后端耦合）。</li>
</ul>
<h2 data-id="heading-4">3、如何实现动态路由、嵌套路由、路由懒加载、如何处理 404 页面？</h2>
<h3 data-id="heading-5">3.1 动态路由</h3>
<p>使用冒号（：）定义参数，比如 <code>{ path: '/user/:id', component: User }</code>, 组件内部通过 <code>$route.params.id</code> 获取对应参数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>, <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./User.vue'</span>) }
];
</code></pre>
<p>但需要注意获取到的 id 是 <code>string</code> 类型，如需转成 <code>Number</code> 需可以在组件内部调用 <code>Number(this.$route.params.id)</code> 进行转换，更方便的方式是在路由中将 id 定义为 props。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserComponent</span>,
    <span class="hljs-attr">props</span>: <span class="hljs-function"><span class="hljs-params">router</span> =&gt;</span> ({
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Number</span>(router.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>),
    }),
  }
];

</code></pre>
<p>组件内部直接通过 props 接收即可。</p>
<h3 data-id="heading-6">3.2 嵌套路由</h3>
<p>直接通过路由配置中的 <code>children</code> 属性定义即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserComponent</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'list'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserListComponent</span> },
      { <span class="hljs-attr">path</span>: <span class="hljs-string">':id'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserDetailComponent</span> },
    ]
  }
];
</code></pre>
<p>这样就定义了<code>/user/list</code>、<code>/user/:id</code> 两个子路由。</p>
<p>需要注意的是，如果子路由 <code>path</code> 以 <code>/</code> 开头，则子路由最终的 URL 将不会带上父路由的 <code>path</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserComponent</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'/list'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserListComponent</span> },
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'/:id'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">UserDetailComponent</span> },
    ]
  }
];
</code></pre>
<p>这样定义的两个路由是 <code>/list</code> 和 <code>/:id</code> 。</p>
<h3 data-id="heading-7">3.3 路由懒加载</h3>
<p>直接通过 <code>import()</code> 方法引入路由组件即可实现路由懒加载，这样定义路由后，<code>webpack</code> 等打包工具在构建时就不会把这个组件打包到主包里面，而是放在一个单独的 <code>chunk</code>，用到时在通过 <code>http</code> 请求去动态加载。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> routes = [
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/:id'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./User.vue'</span>),
  }
];

</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">props</span>: { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Number</span> }
}
</code></pre>
<h3 data-id="heading-8">3.4 配置404页面</h3>
<p><code>path</code> 属性可以支持通配符，在路由配置末尾配置 <code>{ path: '*', component: NotFoundComponent }</code> 即可。</p>
<h2 data-id="heading-9">4、vue-router 有几种钩子函数?具体是什么及执行流程是怎样的?</h2>
<p>钩子函数种类有: <strong>全局守卫、路由独享守卫、组件守卫</strong>。</p>
<ul>
<li><strong>全局守卫</strong>：<code>router.beforeEach</code>（导航前）、<code>router.beforeResolve</code>（解析前）、<code>router.afterEach</code>（导航后）</li>
<li><strong>路由独享守卫</strong>：在路由配置中定义 <code>beforeEnter</code>。</li>
<li><strong>组件守卫</strong>：<code>beforeRouteEnter</code>（进入组件前，无法访问通过 this 拿到组件实例）、<code>beforeRouteUpdate</code>（路由改变，该组件被复用时调用）、<code>beforeRouteLeave</code>（离开当前组件）。</li>
</ul>
<p>这些钩子在实际业务开发中，可以实现<strong>权限验证、数据预加载、进度条显示</strong>等功能。</p>
<p><strong>钩子的执行顺序如下</strong>：</p>
<ol>
<li>触发导航。</li>
<li>在失活的组件里调用 <code>beforeRouteLeave</code> 守卫。</li>
<li>调用全局的 <code>beforeEach</code> 守卫。</li>
<li>在被复用的组件里调用 <code>beforeRouteUpdate</code> 守卫 (2.2+)。</li>
<li>调用路由配置中的 <code>beforeEnter</code> 守卫。</li>
<li>解析异步路由组件（即加载 <code>import()</code> 导入的组件）。</li>
<li>在被激活的组件里调用 <code>beforeRouteEnter</code>。</li>
<li>调用全局的 <code>beforeResolve</code> 守卫 (2.5+)。</li>
<li>导航被确认。</li>
<li>调用全局的 <code>afterEach</code> 钩子。</li>
<li>触发 <code>DOM</code> 更新。</li>
<li>调用 <code>beforeRouteEnter</code> 守卫中传给 <code>next</code> 的回调函数，创建好的组件实例会作为回调函数的参数传入。</li>
</ol>
<h2 data-id="heading-10">5、vue-router 两种模式的区别？</h2>
<ul>
<li><strong>hash 模式（vue-router 默认路由模式）</strong>：</li>
</ul>
<p>使用 URL 的 # 号（如 /home#about），浏览器不会向服务器发送请求，兼容性好，但 URL 不美观。</p>
<ul>
<li><strong>history 模式</strong>：</li>
</ul>
<p>使用 HTML5 History API（如 /home），URL 更简洁，但需要服务器配置支持（否则刷新页面会 404），因为浏览器会向服务器请求该资源。</p>
<h2 data-id="heading-11">6、前端路由的实现原理是什么？</h2>
<h3 data-id="heading-12">6.1 hash路由</h3>
<p>原理：利用 URL 的 # 号变化页面不刷新的特性，然后通过监听 <code>hashchange</code>，拿到 # 号后面的 哈希内容作为路由 <code>path</code>，进行从路由表中找到对应的组件进行激活渲染即可。</p>
<p>我这里用 <code>hash.html</code> 文件写一个简单的 demo：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- hash.html --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#/home"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#/about"</span>&gt;</span>关于我们页面<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"routeView"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 模拟 &lt;router-view&gt; 组件渲染 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> routes = [
      {
          <span class="hljs-attr">path</span>: <span class="hljs-string">'#/home'</span>,
          <span class="hljs-attr">component</span>: <span class="hljs-string">'首页'</span>,
      },
      {
          <span class="hljs-attr">path</span>: <span class="hljs-string">'#/about'</span>,
          <span class="hljs-attr">component</span>: <span class="hljs-string">'关于我们页面'</span>,
      }
  ]
  <span class="hljs-keyword">const</span> routeViewEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#routeView'</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onHashChange</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; routes.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">if</span>(routes[i].<span class="hljs-property">path</span> === location.<span class="hljs-property">hash</span>) {
          routeViewEl.<span class="hljs-property">innerHTML</span> = routes[i].<span class="hljs-property">component</span>;
          <span class="hljs-keyword">break</span>;
        }
    }
  }
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'hashchange'</span>, onHashChange);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, onHashChange); <span class="hljs-comment">// 首次加载时匹配路由内容</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">6.2 history 路由</h3>
<p><strong>HTML5 History API 提供了以下方法</strong>：</p>
<ul>
<li><strong>pushState()</strong>：将给定的数据、标题（如果提供，则指定 URL）推送到会话历史栈中。</li>
<li><strong>replaceState()</strong>：使用指定的数据、标题（如果提供，则指定 URL）更新历史栈中的最新条目。</li>
<li><strong>back()</strong>：回到会话历史中的上一页，相当于浏览器的后退按钮。</li>
<li><strong>forward()</strong>：转到会话历史中的下一页，相当于浏览器的前进按钮。</li>
<li><strong>go()</strong>：跳转到会话历史中的相对页，-1 表示上一页，1 表示下一页，超出边界则无效。</li>
</ul>
<p>另外在 <code>window</code> 对象上提供了 <code>popstate</code> 事件，当激活同一文档中不同的历史记录条目时会被触发。所以用 <code>HTML5 History API</code> + <code>popstate</code> 事件即可实现 <code>history</code> 路由。</p>
<p>我这里用 <code>history.html</code> 文件写一个简单的 demo：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- history.html --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/home"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span> 
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于我们页面<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"routeView"</span>&gt;</span>
       <span class="hljs-comment">&lt;!-- 模拟 &lt;router-view&gt; 组件渲染 --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> routes = [
        {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'/home'</span>,
            <span class="hljs-attr">component</span>: <span class="hljs-string">'首页'</span>,
        },
        {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
            <span class="hljs-attr">component</span>: <span class="hljs-string">'关于我们页面'</span>,
        }
    ]

    <span class="hljs-keyword">const</span> routeViewEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#routeView'</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onPopState</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; routes.<span class="hljs-property">length</span>; i++) {
         <span class="hljs-keyword">if</span>(routes[i].<span class="hljs-property">path</span> === location.<span class="hljs-property">pathname</span>) {
           routeViewEl.<span class="hljs-property">innerHTML</span> = routes[i].<span class="hljs-property">component</span>;
           <span class="hljs-keyword">break</span>;
         }
      }
    }
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popState'</span>, onPopState)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> links = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'a'</span>);
      links.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> {
          a.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
              e.<span class="hljs-title function_">preventDefault</span>() <span class="hljs-comment">// 阻止 a 标签跳转</span>
              history.<span class="hljs-title function_">pushState</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">''</span>, a.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'href'</span>)); <span class="hljs-comment">// 获取 a 标签上的 href 属性作为跳转 URL</span>
              <span class="hljs-title function_">onPopState</span>();
          })
      })

    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>这里有两个注意点：</p>
<ol>
<li>需要阻止 a 标签的默认跳转行为，要不然会向服务器发起请求，直接跳走。</li>
<li>预览 <code>history.html</code> 需要起一个本地服务器去预览，比如<code>http://127.0.0.1:5500/history.html</code>，要不然会报错 <code>Uncaught SecurityError: Failed to execute 'pushState' on 'History': A history state object with URL 'file:///home' cannot be created in a document with origin 'null' and URL</code>。这应该是浏览器在 <code>History API</code> 所做的一些安全策略。</li>
</ol>
<h2 data-id="heading-14">7、vue 项目本地开发完成后部署到服务器后报 404 是什么原因呢？</h2>
<p>如果你使用的是 Vue Router 的 history 模式。刷新时会向服务端发起请求，服务端无法响应到对应的资源，所以会出现 404 问题。需要在服务端进行处理将所有请求重定向到你的 Vue 应用的入口文件。</p>
<p>配置后服务端不会再出现 404 问题，Vue 应用中要覆盖所有的路由情况。</p>
<p><code>nginx.conf</code> 配置方式：</p>
<pre><code class="hljs language-bash" lang="bash">location / {
  try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
}
</code></pre>
<h2 data-id="heading-15">8、使用动态路由时，如何解决参数变化但组件未更新的问题？</h2>
<p>比如路由从 <code>/user/1</code> 跳转到 <code>/user/2</code>，发现组件中 <code>created、mounted</code> 等生命周期钩子没有重新执行，导致没拿到最新的数据渲染到页面上。</p>
<h3 data-id="heading-16">8.1 方案一：watch 监听 $route</h3>
<p><code>$route</code> 是 <code>vue-router</code> 注入到组件中的一个响应式数据，当路由发生变化时，其数据会发生变化。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-string">'$route'</span>(to, <span class="hljs-keyword">from</span>) {
      <span class="hljs-keyword">if</span> (to.<span class="hljs-property">params</span>.<span class="hljs-property">id</span> !== <span class="hljs-keyword">from</span>.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>) {
         <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span> = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.$route.params.id}</span>`</span>); <span class="hljs-comment">// 获取最新数据</span>
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-17">8.2 方案二：使用组件内的路由导航守卫 beforeRouteUpdate</h3>
<p>在当前路由改变，但是该组件被复用时调用，vue-router 内部会调用用户在组件内定义的 <code>beforeRouteUpdate</code> 钩子。但需要注意，需要将 <code>beforeRouteUpdate</code> 定义在路由根组件才能生效。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">beforeRouteUpdate</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span> = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.$route.params.id}</span>`</span>); <span class="hljs-comment">// 获取最新数据</span>
    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h3 data-id="heading-18">8.3 方案三：增加 key，让组件强制重新渲染</h3>
<p><code>router-view</code> 上可以使用 key 属性，key 一旦发生变化，<code>router-view</code> 渲染的组件也会重新渲染。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;router-view :key="$route.fullPath"&gt;&lt;/router-view&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-19">结语</h2>
<p>以上是整理的 Vue-router 的高频面试题，如有错误或者可以优化的地方欢迎评论区指正，后续还会其它前端相关面试题。</p>
<h2 data-id="heading-20">往期回顾</h2>
<p><a href="https://juejin.cn/post/7571303808115769396" target="_blank" title="https://juejin.cn/post/7571303808115769396">前端高频面试题之Vue（初、中级篇）</a></p>
<p><a href="https://juejin.cn/post/7571972751529017380" target="_blank" title="https://juejin.cn/post/7571972751529017380">前端高频面试题之Vue（高级篇）</a></p>
<p><a href="https://juejin.cn/post/7572397142364799018" target="_blank" title="https://juejin.cn/post/7572397142364799018">前端高频面试题之Vuex篇</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mp4文件在CDN上无法在网页播放的问题]]></title>    <link>https://juejin.cn/post/7573468493570146340</link>    <guid>https://juejin.cn/post/7573468493570146340</guid>    <pubDate>2025-11-17T12:43:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493570146340" data-draft-id="7573525634212298795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mp4文件在CDN上无法在网页播放的问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T12:43:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大橙子打游戏"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170907086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mp4文件在CDN上无法在网页播放的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170907086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大橙子打游戏
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T12:43:40.000Z" title="Mon Nov 17 2025 12:43:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当把一个mp4文件放到对象存储之后，通过CDN回源，进行加速，可能会出现，在web页面上无法打开播放的问题，报错信息是</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf97e9ed13624c27ba9915d210d52cc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763988220&amp;x-signature=LT5SGTdufkRoLspu%2FDiAGJw7Hn8%3D" alt="image.png" loading="lazy"/></p>
<p>在CDN的配置项当中，关闭了智能压缩也没有用，依然会出现这种报错。</p>
<p>在售后技术团队一下午的支持解决无果之后，我详细比对了可用的视频和这条不可用视频的区别</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f132c566e456426f8db4a22209eccd33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qmZ5a2Q5omT5ri45oiP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763988220&amp;x-signature=4osSaz6rJc4aaZO7CUt8cnahICg%3D" alt="image.png" loading="lazy"/></p>
<p>最终定位到，是<strong>元数据</strong>的问题。</p>
<p>无法播放的那个视频，元数据丢失，补全一些元数据就可以了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Skills 硬核技巧：用 PDF-Skill 10 分钟搞定全类型 PDF 自动化，办公人必备]]></title>    <link>https://juejin.cn/post/7573508361741500416</link>    <guid>https://juejin.cn/post/7573508361741500416</guid>    <pubDate>2025-11-17T12:36:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508361741500416" data-draft-id="7573530680886394914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Skills 硬核技巧：用 PDF-Skill 10 分钟搞定全类型 PDF 自动化，办公人必备"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T12:36:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Skills 硬核技巧：用 PDF-Skill 10 分钟搞定全类型 PDF 自动化，办公人必备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T12:36:12.000Z" title="Mon Nov 17 2025 12:36:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常开发工作中,PDF文档处理一直是个让人头疼的问题。传统的PDF处理方式要么功能单一只能做简单的文本提取,要么需要购买昂贵的商业软件,开发者想实现批量表单填充、文档自动化处理这些需求往往要花费大量时间去调研各种库、写大量重复代码,效率低下不说,遇到复杂场景还经常卡壳。特别是对于那些需要处理大量PDF表单的企业应用来说,人工填写既费时又容易出错,急需一套完整的自动化解决方案。</p>
<p>ModelScope ms-agent 项目中的 PDF-Skill 就是为解决这些痛点而生的开源工具包,它整合了 pypdf、pdfplumber、reportlab 等多个成熟的 Python 库,再加上 poppler-utils、qpdf 等命令行工具,提供了从文本提取、表格识别、PDF创建、表单填充到图像处理、安全加密的全套解决方案。这套工具包最大的亮点在于"双路径表单处理" —— 既支持可填充表单的自动化填写,也能通过精确坐标定位处理那些不可填充的扫描版表单,配合可视化验证机制(蓝色标签框 + 红色输入框),确保每个字段都准确无误。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db9d988e028445c9a62977e5b91c0e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=vwDPX07%2Fxk1bYhZrFyRaftIEDcw%3D" alt="image-20251117150042094" loading="lazy"/></p>
<p>核心技术点</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a40cee18cf564ed2a6997388306933ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=wkFj0Pe5isgtocou5uMoay1fr5Q%3D" alt="image-20251117150147240" loading="lazy"/></p>
<p>另外提供了全套解决方案：在<strong>文本提取</strong>、<strong>表格识别</strong>、<strong>PDF创建</strong>、<strong>表单填充</strong>、<strong>图像处理</strong>、<strong>安全加密</strong> 等提供全面办公自动化功能</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf4021c4975b42fb87f3cfb2d4160a36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=rYeAlzMvakBC8e1oIm8SqsDMZBg%3D" alt="image-20251117150307555" loading="lazy"/></p>
<p>前几天看到魔搭社区日报中看到这篇关于PDF 的skill。详细文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn%2Flearn%2F2558%25EF%25BC%258C%25E6%2584%259F%25E5%2585%25B4%25E8%25B6%25A3%25E5%25B0%258F%25E4%25BC%2599%25E4%25BC%25B4%25E5%258F%25AF%25E4%25BB%25A5%25E5%2585%25B3%25E6%25B3%25A8%25E8%25BF%2599%25E7%25AF%2587%25E6%2596%2587%25E7%25AB%25A0" target="_blank" title="https://modelscope.cn/learn/2558%EF%BC%8C%E6%84%9F%E5%85%B4%E8%B6%A3%E5%B0%8F%E4%BC%99%E4%BC%B4%E5%8F%AF%E4%BB%A5%E5%85%B3%E6%B3%A8%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0" ref="nofollow noopener noreferrer">modelscope.cn/learn/2558，…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a8bff2671de4620b474aaeb47c035d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=Rl3z4L4XulU3UoI7%2Ba5r3%2F7E%2FZc%3D" alt="image-20251117112752547" loading="lazy"/></p>
<p>今天我们就手把手教大家如何使用这个强大的工具包,从环境配置到实战应用,体验一下这套"AI Agent专属PDF处理神器"的完整能力。话不多说,咱们直接开干!</p>
<h2 data-id="heading-1">项目介绍</h2>
<h3 data-id="heading-2">✨ 核心特性</h3>
<p>PDF-Skill 是一个功能全面的 PDF 处理工具包,主要特性包括:</p>
<ul>
<li><strong>📝 智能文本提取</strong>: 从PDF中提取纯文本内容,支持保留原始布局,将表格转换为 pandas DataFrame 格式,轻松导出到 Excel</li>
<li><strong>🎨 专业PDF创建</strong>: 使用 ReportLab 库创建新PDF,支持 Canvas(低级绘图)和 Platypus(结构化文档)两种方式</li>
<li><strong>🔧 全能文档操作</strong>: 合并、拆分、旋转、元数据提取、页面重排列、文档优化和修复一应俱全</li>
<li><strong>📋 双路径表单处理</strong>: 可填充表单自动填写 + 不可填充表单坐标定位,配合视觉验证机制确保准确性</li>
<li><strong>🖼️ 图像处理套件</strong>: 提取嵌入图像、PDF转高清图片、添加水印,支持可配置分辨率和快速渲染</li>
<li><strong>🔒 安全加密功能</strong>: PDF密码保护、权限控制、加密/解密操作,保障文档安全</li>
<li><strong>🔍 OCR文字识别</strong>: 针对扫描版PDF进行OCR识别,使用 pytesseract 和 pdf2image 将图像型PDF转为可搜索文本</li>
<li><strong>⚡ 性能优化策略</strong>: 支持大文件流式处理、内存高效分块处理、批处理和错误恢复机制</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae80af7330fa45b1997b5d6de354a912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=4gRfVOpqGx9oLvslROpzD0GzcaQ%3D" alt="image-20251117113054254" loading="lazy"/></p>
<h3 data-id="heading-3">🛠️ 技术栈</h3>
<h4 data-id="heading-4">Python 核心库</h4>








































<table><thead><tr><th>库名</th><th>主要功能</th><th>特点</th></tr></thead><tbody><tr><td><strong>pypdf</strong></td><td>基础PDF操作</td><td>合并、拆分、旋转、元数据提取</td></tr><tr><td><strong>pdfplumber</strong></td><td>文本和表格提取</td><td>保留布局、结构化表格数据、坐标信息</td></tr><tr><td><strong>reportlab</strong></td><td>PDF创建</td><td>专业报表生成、样式化文档</td></tr><tr><td><strong>pypdfium2</strong></td><td>PDF渲染</td><td>Chromium的PDFium绑定、快速图像生成</td></tr><tr><td><strong>pytesseract</strong></td><td>OCR识别</td><td>扫描版PDF文字识别</td></tr><tr><td><strong>pdf2image</strong></td><td>图像转换</td><td>PDF转图像</td></tr></tbody></table>
<h4 data-id="heading-5">命令行工具</h4>

























<table><thead><tr><th>工具</th><th>功能</th></tr></thead><tbody><tr><td><strong>pdftotext</strong></td><td>文本提取,支持布局保留和页面范围选择</td></tr><tr><td><strong>pdfimages</strong></td><td>最快的图像提取工具</td></tr><tr><td><strong>qpdf</strong></td><td>页面操作、优化、修复、密码移除</td></tr><tr><td><strong>pdftk</strong></td><td>合并、拆分、旋转等操作</td></tr></tbody></table>
<h4 data-id="heading-6">JavaScript 库</h4>
<p>项目还提供 JavaScript 支持,方便前端集成:</p>
<ul>
<li><strong>pdf-lib</strong>: 在任何JavaScript环境中创建和修改PDF</li>
<li><strong>pdfjs-dist</strong>: Mozilla的浏览器端PDF渲染方案</li>
</ul>
<h3 data-id="heading-7">🎯 应用场景</h3>
<p>PDF-Skill 适用于以下典型场景:</p>
<ol>
<li>
<p><strong>自动化表单填写</strong>: 批量处理PDF表单、企业文档自动化、数据迁移和录入</p>
</li>
<li>
<p><strong>文档数据提取</strong>: 从PDF报表中提取结构化数据、表格转Excel、文本内容分析</p>
</li>
<li>
<p><strong>PDF文档管理</strong>: 文档合并与拆分、批量处理和组织、文档归档和整理</p>
</li>
<li>
<p><strong>报表生成</strong>: 动态生成PDF报告、企业报表自动化、发票和单据生成</p>
</li>
<li>
<p><strong>安全文档处理</strong>: 添加密码保护、敏感文档加密、权限管理</p>
</li>
<li>
<p><strong>OCR和数字化</strong>: 扫描文档识别、历史文档数字化、可搜索PDF创建</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fade7fab086a45cb991ebbbf41988434~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=gRwMAojyyVohB1wzgdNfekDm%2Fas%3D" alt="image-20251117113154696" loading="lazy"/></p>
</li>
</ol>
<h3 data-id="heading-8">🌟 核心亮点</h3>
<p><strong>Claude Code 深度集成</strong></p>
<p>专门为 Claude Code 设计的工作流,支持 AI 辅助的 PDF 处理任务,智能化表单识别和填充。开发者可以在 AI Agent 中直接调用这些能力,实现真正的文档处理自动化。</p>
<p><strong>像素级坐标定位</strong></p>
<p>支持像素级的精确定位,可视化验证机制让你看得见摸得着 —— 蓝色矩形标记标签区域,红色矩形标记输入区域,防止字段重叠的智能检查,确保每个表单字段都填得准确无误。</p>
<p><strong>模块化设计</strong></p>
<p>每个功能都有独立的脚本和工具,清晰的文件组织结构让你随用随取。无论是简单的文本提取还是复杂的表单填充,都能快速找到对应工具,极易维护和扩展。</p>
<h2 data-id="heading-9">部署实战</h2>
<h3 data-id="heading-10">3.1 环境准备</h3>
<p>我们首先需要准备 Python 环境。PDF-Skill 官方推荐使用 Python 3.11+ 版本,这样能获得最佳的兼容性和性能。</p>
<p>对于 Linux/Mac 用户,可以使用系统自带的包管理器:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntu/Debian</span>
sudo apt update
sudo apt install python3.11 python3.11-venv python3-pip
<span class="hljs-meta prompt_">
# </span><span class="bash">macOS (使用 Homebrew)</span>
brew install python@3.11
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/746697e4638642ed9e90b7455bc13ace~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=b5Xq6mNuibut8HpEt7EvmUHd0kY%3D" alt="image-20251117113553532" loading="lazy"/></p>
<p>对于 Windows 用户,建议从 Python 官网下载安装包:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">检查 Python 版本</span>
python --version
<span class="hljs-meta prompt_">
# </span><span class="bash">应该看到 Python 3.11 或更高版本</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55548614f7024375a48932c820d790c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=WYH7TaTZK8UgV80o16XeiQQAWhE%3D" alt="image-20251117113341445" loading="lazy"/></p>
<h3 data-id="heading-11">3.2 项目下载</h3>
<p>接下来我们从 GitHub 下载 PDF-Skill 项目。打开终端,执行以下命令:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">克隆项目到本地</span>
git clone https://github.com/modelscope/ms-agent.git
<span class="hljs-meta prompt_">
# </span><span class="bash">进入 PDF-Skill 目录</span>
cd ms-agent/projects/agent_skills/skills/pdf
<span class="hljs-meta prompt_">
# </span><span class="bash">查看项目结构</span>
ls -la
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19dd1573bea14d7a84d33a6175b0533b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=%2FxdKkjKrC9ss3J0hmcFAbNcW4KI%3D" alt="image-20251117113745881" loading="lazy"/></p>
<p>等待几分钟后下载完成,你会看到以下目录结构:</p>
<pre><code class="hljs language-bash" lang="bash">pdf/
├── scripts/           <span class="hljs-comment"># 8个实用Python脚本</span>
├── SKILL.md          <span class="hljs-comment"># 主要技能文档</span>
├── forms.md          <span class="hljs-comment"># 表单填写工作流程</span>
├── reference.md      <span class="hljs-comment"># 高级功能参考</span>
└── LICENSE.txt       <span class="hljs-comment"># 许可证信息</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96e3c97b78f34961bfbad15afbbdad83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=VfoP4ulQnhZYLwbnlCaU5bC7A5M%3D" alt="image-20251117113812751" loading="lazy"/></p>
<h3 data-id="heading-12">3.3 依赖安装</h3>
<p>PDF-Skill 依赖多个 Python 库和系统工具。我们先安装 Python 依赖:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">创建虚拟环境(推荐)</span>
python3 -m venv venv
<span class="hljs-meta prompt_">
# </span><span class="bash">激活虚拟环境</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Linux/Mac:</span>
source venv/bin/activate
<span class="hljs-meta prompt_"># </span><span class="bash">Windows:</span>
venv\Scripts\activate
<span class="hljs-meta prompt_">
# </span><span class="bash">安装 Python 依赖</span>
pip install pypdf pdfplumber reportlab pypdfium2 pytesseract pdf2image
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e001e37d31464cdc9ee7ffbb7d30879c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=vF8gO88KmlHzj63hPGK8X85Stzw%3D" alt="image-20251117113915869" loading="lazy"/></p>
<p>接下来安装命令行工具。这些工具能大幅提升某些操作的性能:</p>
<p><strong>Ubuntu/Debian:</strong></p>
<pre><code class="hljs language-shell" lang="shell">sudo apt install poppler-utils qpdf pdftk tesseract-ocr
</code></pre>
<p><strong>macOS:</strong></p>
<pre><code class="hljs language-shell" lang="shell">brew install poppler qpdf pdftk tesseract
</code></pre>
<p><strong>Windows:</strong>
下载预编译版本:</p>
<ul>
<li>Poppler: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foschwartz10612%2Fpoppler-windows%2Freleases" target="_blank" title="https://github.com/oschwartz10612/poppler-windows/releases" ref="nofollow noopener noreferrer">github.com/oschwartz10…</a></li>
<li>QPDF: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqpdf%2Fqpdf%2Freleases" target="_blank" title="https://github.com/qpdf/qpdf/releases" ref="nofollow noopener noreferrer">github.com/qpdf/qpdf/r…</a></li>
<li>Tesseract: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FUB-Mannheim%2Ftesseract%2Fwiki" target="_blank" title="https://github.com/UB-Mannheim/tesseract/wiki" ref="nofollow noopener noreferrer">github.com/UB-Mannheim…</a></li>
</ul>
<p>安装完成后验证一下:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">验证工具安装</span>
pdftotext -v
qpdf --version
tesseract --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72cb8f234a3843c8afea2a6c618c5f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=0XGUjl3NqEkgN6v49gMlzsl4DxM%3D" alt="image-20251117114535751" loading="lazy"/></p>
<p>呵呵,看到版本号就说明安装成功了!</p>
<h3 data-id="heading-13">3.4 脚本工具介绍</h3>
<p>PDF-Skill 在 <code>scripts/</code> 目录下提供了8个实用脚本,让我们逐一了解:</p>
<h4 data-id="heading-14">表单处理脚本</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. 检查 PDF 是否包含可填充字段</span>
python scripts/check_fillable_fields.py your_form.pdf
<span class="hljs-meta prompt_">
# </span><span class="bash">2. 提取表单字段信息(生成 JSON 映射)</span>
python scripts/extract_form_field_info.py your_form.pdf
<span class="hljs-meta prompt_">
# </span><span class="bash">3. 填充可填充表单</span>
python scripts/fill_fillable_fields.py your_form.pdf field_values.json output.pdf
<span class="hljs-meta prompt_">
# </span><span class="bash">4. 使用注释填充不可填充表单</span>
python scripts/fill_pdf_form_with_annotations.py your_form.pdf fields.json output.pdf
</code></pre>
<h4 data-id="heading-15">验证和转换脚本</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">5. 验证边界框坐标</span>
python scripts/check_bounding_boxes.py fields.json
<span class="hljs-meta prompt_">
# </span><span class="bash">6. 边界框验证单元测试</span>
python scripts/check_bounding_boxes_test.py
<span class="hljs-meta prompt_">
# </span><span class="bash">7. PDF 转图像</span>
python scripts/convert_pdf_to_images.py document.pdf output_dir/
<span class="hljs-meta prompt_">
# </span><span class="bash">8. 创建可视化验证图像</span>
python scripts/create_validation_image.py your_form.pdf fields.json validation.png
</code></pre>
<h3 data-id="heading-16">claude skill 安装</h3>
<p>接下来我们把这个pdf skill 安装到claude code里面</p>
<p>复制<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelscope%2Fms-agent%2Ftree%2Fmain%2Fprojects%2Fagent_skills%2Fskills%2Fpdf" target="_blank" title="https://github.com/modelscope/ms-agent/tree/main/projects/agent_skills/skills/pdf" ref="nofollow noopener noreferrer">github.com/modelscope/…</a> 到claude   skills里面</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db3a9b66d24f46e1a6f56c250505e085~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=LDUTwhhrRx9o8GEOEveQww445jw%3D" alt="image-20251117115911191" loading="lazy"/></p>
<p>复制后</p>
<pre><code class="hljs language-bash" lang="bash">/root/.claude/skills/pdf
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e1449305dc045ae9cded571b6a4583f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=7YyZwTOOeXOm%2Ba252NZF48DWsMo%3D" alt="image-20251117120650925" loading="lazy"/></p>
<p>当然你也可以偷懒让AI 帮你干。</p>
<pre><code class="hljs language-bash" lang="bash">请帮我把/mnt/f/work/code/other/pdf/ms-agent/projects/agent_skills/skills/pdf  这个skills安装到系统的claude  skills 中。 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d73161d2cc8a49999ffba9a40eb44f39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=bEBnuNZZ0cmTLvgbVrvhtCJp5O0%3D" alt="image-20251117120241929" loading="lazy"/></p>
<h3 data-id="heading-17">实战案例1: PDF转成图片</h3>
<p>我这里有一张PDF的发票信息。我希望这个skill帮我转成图片。这个在平时我们工作中也有经常遇到。</p>
<p>提示词如下</p>
<pre><code class="hljs">请使用pdf 这个skill帮我把当前文件下“增值税电子普通发票4.pdf” 转成图片并输出。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3c10854988b4e0f84c9cb0d75b173ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=9Me6XF77mt1y1gDXmYTiGT%2BQcU4%3D" alt="image-20251117125049333" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a55f4163036d458bb04567b21449e388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=gSMpZXqy6atY6sfVYYAaEkarqVc%3D" alt="image-20251117125223579" loading="lazy"/></p>
<p>我们打开转换后的文件夹查看转换后的图片</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f75b8de1274a58bbb854766664b5b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=cIWHh8Z07iaG8%2FHaL7x%2FUUjTDk8%3D" alt="image-20251117125319373" loading="lazy"/></p>
<p>OK 一行命令就帮我把这个pdf 转成图片了。如果我有一个文件夹里面有几百个PDF。我是不是参考上面的提示词稍微修改一下，这活是不是AI 也是分分钟帮我把它干完了。嘿嘿，感兴趣小伙伴可以自己来尝试。时间关系这里不做演示。</p>
<h3 data-id="heading-18">实战案例2: 处理扫描版表单</h3>
<p>有些老旧的表单是扫描版,没有可填充字段,怎么办?PDF-Skill 的"坐标定位法"来帮忙!</p>
<p>我这里有一个2025年101中学八年级期中考试成绩表PDF版本，我们打开看一下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a5194380c8f44da939f10ca19804f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=GEw8E35EKL94NldMPyRqnmWVAps%3D" alt="image-20251117142234648" loading="lazy"/></p>
<p>我这里有个学生的成绩单一个基于markdown格式的文档数据（以上数据都是假的不是真实的，请勿当真）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b30dab1bbb01479ea2e3b50ba9ae3e8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=fFZaGgVF6q1QM3N9n%2BBYjuMw84Y%3D" alt="image-20251117143239317" loading="lazy"/></p>
<p>我这里的需求就是基于这个成绩数据填充到上面的额PDF文档中。接下来我们使用PDF-Skill来实现</p>
<p>提示词</p>
<pre><code class="hljs">请使用pdf 这个skill帮我把当前文件下“2025年101中学八年级期中考试成绩表-扫描版.pdf” 内容填充，填充的数据请基于“2025年101中学八年级期中考试成绩表.md” 文档里面的数据。填充后输出“2025年101中学八年级期中考试成绩表-扫描版-填充版.pdf”
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42f4e48a6ddf44f3894d49788bd73aa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=PKJlzMil7nsV7U4MEUK2iiM4zH0%3D" alt="image-20251117143631529" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07c97b7bfb804d468771868629f951f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=kKIuVJ2d8W3HpoQrBbgy1q0SEp0%3D" alt="image-20251117144221779" loading="lazy"/></p>
<p>分分钟AI 也帮我干完了。我们看一下生产后的效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d419fa48298b483199a032a9fef8a847~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=avuCDH6uq2kCx2oXTW2tdOfco8Y%3D" alt="image-20251117144314498" loading="lazy"/></p>
<p>虽然不完美，但是确实也帮我填充了。如果表格内容不多，表格空间足够大，我相信也是可以完成的。（AI还有进步空间。）</p>
<h3 data-id="heading-19">实战案例3: 提取表格数据到 Excel</h3>
<p>很多时候我们需要从 PDF 报表中提取数据做分析。传统方法是手工复制粘贴,PDF-Skill 可以一键搞定。</p>
<p>我们接下来还是拿刚才的PDF发票，让它帮我把这发票提取到Excel中</p>
<p>提示词</p>
<pre><code class="hljs">请使用pdf 这个skill帮我把当前文件下“增值税电子普通发票4.pdf” PDF里面发票内容提取生成excel表格。
请注意PDF里面发票明细可能有多行，把全票面信息全部提取生成excel表格并输出。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b93236de2c41b5b5f2e20f892aa739~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=jyRGbgTEgCf8I9l3VfHRO3Xe44k%3D" alt="image-20251117131735784" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c1e7d785b594ad68c3d69d6711b5978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=tBebs1uviEGjqDJgY0CaTvoWuMo%3D" alt="image-20251117132554274" loading="lazy"/></p>
<p>打开 Excel 文件,所有表格数据整整齐齐,再也不用手工复制粘贴了!</p>
<p>发票概览</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af905d26d70341048251e828a732b3c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=TmgpM87l47M1PWHXUOJa%2BALo8%2FY%3D" alt="image-20251117132649902" loading="lazy"/></p>
<p>完整信息</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3550ec8f94f4d10b63d1a12f81ffaa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=HryndEHRrOXzpvMpakOlWFZ62K8%3D" alt="image-20251117132755511" loading="lazy"/></p>
<p>发票明细</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d7bcd36f7a740388589aa5f587fca5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=wdn0NQg2QZE%2FWb8Gon7fHWavkis%3D" alt="image-20251117132834736" loading="lazy"/></p>
<h3 data-id="heading-20">实战案例4: 生成专业 PDF 报表</h3>
<p>除了处理现有 PDF,PDF-Skill 还能创建专业的 PDF 报表。下面演示如何用 ReportLab 生成一份带表格的报告:</p>
<p>提示词如下：</p>
<pre><code class="hljs">请使用pdf 这个skill帮我把当前文件下“pdf-skill技能总结.md” 把这个md文档的内容总结生成一个需要给领导汇报的PDF报告，并输出这个报告。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02a2fc9cda7e46abbd3d799d8b6ff818~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=hPs9qLdJMEWiH%2BG0mj0eF8wS%2BRA%3D" alt="image-20251117133742904" loading="lazy"/></p>
<p>总共帮我生成了5页</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df036b7cd5874c1d85917a3c6f9e105c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=Ng%2FZu0ku%2Bi9lyqnP8GeGOgTJ0v8%3D" alt="image-20251117133836723" loading="lazy"/></p>
<p>我们打开这个PDF 查看一下效果（报告有5页，这里只展开2张截图）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9700efa1882547f3a335c50b4825654c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=93cBfFcOYVPHiIMejlH8GVLjiZY%3D" alt="image-20251117135738823" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a553fd24863451c8900d89ec7c796c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763987772&amp;x-signature=24FTUi87PyFRMl3uM3ql15cu2tg%3D" alt="image-20251117135820779" loading="lazy"/></p>
<p>打开生成的 PDF,专业的表格样式、清晰的数据展示,完全可以直接拿去开会汇报</p>
<h3 data-id="heading-21">常见问题与解决方案</h3>
<p><strong>问题1: numpy 版本冲突</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">错误: <span class="hljs-keyword">module</span> <span class="hljs-string">'numpy'</span> has no attribute <span class="hljs-string">'float'</span>
</code></pre>
<p><strong>解决方案:</strong></p>
<pre><code class="hljs language-shell" lang="shell">pip install numpy==1.26.4
</code></pre>
<p><strong>问题2: Tesseract 找不到</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">错误: TesseractNotFoundError</span>
</code></pre>
<p><strong>解决方案:</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在代码中指定 tesseract 路径</span>
<span class="hljs-keyword">import</span> pytesseract
pytesseract.pytesseract.tesseract_cmd = <span class="hljs-string">r'C:\Program Files\Tesseract-OCR\tesseract.exe'</span>
</code></pre>
<p><strong>问题3: PDF 加密无法处理</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">错误: PdfReadError: file has not been decrypted</span>
</code></pre>
<p><strong>解决方案:</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pypdf

reader = pypdf.PdfReader(<span class="hljs-string">'encrypted.pdf'</span>)
reader.decrypt(<span class="hljs-string">'your-password'</span>)
</code></pre>
<p><strong>问题4: 表格识别不准确</strong></p>
<p><strong>解决方案:</strong> 调整 pdfplumber 参数</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pdfplumber

<span class="hljs-keyword">with</span> pdfplumber.<span class="hljs-built_in">open</span>(<span class="hljs-string">'document.pdf'</span>) <span class="hljs-keyword">as</span> pdf:
    page = pdf.pages[<span class="hljs-number">0</span>]

    <span class="hljs-comment"># 自定义表格检测参数</span>
    table = page.extract_table({
        <span class="hljs-string">'vertical_strategy'</span>: <span class="hljs-string">'lines'</span>,
        <span class="hljs-string">'horizontal_strategy'</span>: <span class="hljs-string">'lines'</span>,
        <span class="hljs-string">'snap_tolerance'</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">'join_tolerance'</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">'edge_min_length'</span>: <span class="hljs-number">3</span>,
    })
</code></pre>
<h2 data-id="heading-22">总结</h2>
<p>通过本文的实战演示,我们完整体验了 ModelScope PDF-Skill 这个强大的 PDF 处理工具包。从环境搭建到实际应用,我们用四个典型场景展示了它的核心能力:</p>
<p><strong>实战案例回顾</strong>:</p>
<ol>
<li>
<p><strong>PDF转图片</strong> - 一行提示词就把发票PDF转成高清图片,如果有几百个PDF文件需要批量转换,只需稍微修改提示词,AI分分钟帮你搞定,省去了手工一个个转换的麻烦。</p>
</li>
<li>
<p><strong>扫描版表单填充</strong> - 基于Markdown格式的学生成绩数据,自动填充到扫描版成绩表PDF中,虽然因表格空间限制填充了48条数据(总共50条),但整体效果已经相当不错,这在传统方案中几乎不可能实现。</p>
</li>
<li>
<p><strong>提取表格数据到Excel</strong> - 从增值税电子发票PDF中一键提取出发票概览、完整信息、发票明细三个工作表,所有数据整整齐齐,再也不用手工复制粘贴,大大提高了财务处理效率。</p>
</li>
<li>
<p><strong>生成专业PDF报表</strong> - 基于Markdown技能总结文档,自动生成了5页专业级的PDF报告,包含表格、统计数据、格式化排版,完全可以直接拿去给领导汇报。</p>
</li>
</ol>
<p><strong>核心优势总结</strong>:</p>
<p>PDF-Skill 最大的亮点在于与 Claude Code 的深度集成,让 AI 真正成为你的 PDF 处理助手。它整合了 pypdf、pdfplumber、reportlab 等多个成熟 Python 库,配合 poppler-utils、qpdf 等命令行工具,提供了文本提取、表单填充、文档创建、图像处理、安全加密的全套解决方案。"双路径表单处理"机制既支持可填充表单自动化,也能通过像素级坐标定位处理扫描版表单,配合可视化验证确保准确性。8个实用脚本涵盖从表单检查、字段提取、自动填充到边界框验证、PDF转图像的完整工具链,模块化设计让每个功能都清晰独立、易于维护扩展。</p>
<p><strong>扩展应用场景</strong>:</p>
<p>基于本文演示的基础功能,小伙伴们可以继续探索更多应用场景:批量处理企业合同、自动化发票识别录入、历史文档数字化归档、电子签章批量添加、PDF水印处理、多语言OCR识别等。这些场景在企业办公自动化、政务文档数字化、金融票据处理等领域都有广泛应用价值。PDF-Skill 提供的流式处理和并行批处理能力,能够高效处理大规模文档,远超传统单一功能的 PDF 库。</p>
<p>感兴趣的小伙伴可以按照文中步骤进行实践,根据实际业务需求调整参数配置。PDF-Skill 是完全开源免费的,无需购买昂贵商业软件,就能实现企业级 PDF 处理自动化。今天的分享就到这里,希望这个工具能帮大家解决 PDF 处理的各种难题,我们下一篇文章见!</p>
<h2 data-id="heading-23">项目资源</h2>
<p><strong>GitHub地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelscope%2Fms-agent%2Ftree%2Fmain%2Fprojects%2Fagent_skills%2Fskills%2Fpdf" target="_blank" title="https://github.com/modelscope/ms-agent/tree/main/projects/agent_skills/skills/pdf" ref="nofollow noopener noreferrer">github.com/modelscope/…</a></p>
<p>觉得项目不错可以点个赞。</p>
<p><strong>官方文档</strong>:</p>
<ul>
<li>SKILL.md: 核心库和命令行工具说明</li>
<li>forms.md: 表单处理详细工作流</li>
<li>reference.md: 高级功能和故障排除</li>
</ul>
<p><strong>技术交流</strong>:</p>
<ul>
<li>ModelScope 社区: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn" target="_blank" title="https://modelscope.cn" ref="nofollow noopener noreferrer">modelscope.cn</a></li>
<li>Issue 反馈: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelscope%2Fms-agent%2Fissues" target="_blank" title="https://github.com/modelscope/ms-agent/issues" ref="nofollow noopener noreferrer">github.com/modelscope/…</a></li>
</ul>
<p><strong>相关资源</strong>:</p>
<ul>
<li>pypdf 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpypdf.readthedocs.io" target="_blank" title="https://pypdf.readthedocs.io" ref="nofollow noopener noreferrer">pypdf.readthedocs.io</a></li>
<li>pdfplumber 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjsvine%2Fpdfplumber" target="_blank" title="https://github.com/jsvine/pdfplumber" ref="nofollow noopener noreferrer">github.com/jsvine/pdfp…</a></li>
<li>reportlab 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reportlab.com%2Fdocs%2F" target="_blank" title="https://www.reportlab.com/docs/" ref="nofollow noopener noreferrer">www.reportlab.com/docs/</a></li>
</ul>
<p>#首发于魔搭研习社</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从0到1：智能汇 AI 全栈实战，拆解多模态 AI 应用开发全流程]]></title>    <link>https://juejin.cn/post/7573508361741074432</link>    <guid>https://juejin.cn/post/7573508361741074432</guid>    <pubDate>2025-11-17T11:21:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573508361741074432" data-draft-id="7572434032517709870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从0到1：智能汇 AI 全栈实战，拆解多模态 AI 应用开发全流程"/> <meta itemprop="keywords" content="前端,Vue.js,Node.js"/> <meta itemprop="datePublished" content="2025-11-17T11:21:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="编程干货铺"/> <meta itemprop="url" content="https://juejin.cn/user/52383084474680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从0到1：智能汇 AI 全栈实战，拆解多模态 AI 应用开发全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52383084474680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    编程干货铺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:21:04.000Z" title="Mon Nov 17 2025 11:21:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab6c91048004434b933d56702b29d2dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=96kQn2dSYoOvKpkPZ%2FJBTGWIHMQ%3D" alt="2.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4398dbdb77534329936bb0c3e5e89f38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=5Wpp8tlzQc4LlcIl%2B%2F1MVG%2B1tQQ%3D" alt="6.png" loading="lazy"/></p>
<p>  我近期完成了一个兼具实用性与技术深度的多模态 AI 项目 ——<strong>智能汇 AI</strong>。这个项目整合了对话、写作、绘画三大核心能力，从技术选型到落地部署全程踩坑无数，也沉淀了一套完整的开发方法论。本文将从技术架构、核心功能实现、工程化实践三个维度，带你吃透全栈 AI 应用的开发逻辑。</p>
<h2 data-id="heading-0">项目背景：解决多模态 AI 应用的核心痛点</h2>
<p>在实际开发中，开发者和创作者往往面临「工具分散、效率低下、AI 能力割裂」的问题：学习编程需要查文档 + 问 AI，写文案要切换编辑器 + 设计工具，多模态能力集成更是涉及流式响应、跨端适配等技术难点。</p>
<p>智能汇 AI 的核心目标就是：<strong>用现代化全栈架构，封装复杂的 AI 能力，打造一个「开箱即用」的一站式工作台</strong>。既解决技术层面的「多模态集成、实时响应、性能优化」问题，也满足用户层面的「高效协作、功能闭环」需求。</p>
<hr/>
<h2 data-id="heading-1">一、技术架构：兼顾性能与扩展性的全栈选型</h2>
<h3 data-id="heading-2">核心技术栈选型（附选型思路）</h3>
<h4 data-id="heading-3">后端架构：轻量高效，聚焦 AI 能力封装</h4>



































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>技术栈</td><td>选型理由</td><td>核心作用</td></tr><tr><td>Node.js + Express 5.1</td><td>轻量无侵入，中间件生态完善，适合快速迭代 AI 接口</td><td>构建 RESTful API，处理 AI 请求转发与响应</td></tr><tr><td>Prisma ORM + MySQL</td><td>类型安全特性适配 TypeScript，迁移工具简化数据库迭代</td><td>用户数据、会话记录、生成内容的持久化</td></tr><tr><td>JWT 认证</td><td>无状态设计，适配分布式部署，减少数据库查询</td><td>用户身份校验与权限控制</td></tr><tr><td>SSE 流式响应</td><td>相比 WebSocket 更轻量，无需双向通信，适配 AI 文本流式输出</td><td>实现 AI 回复「打字机效果」，降低前端等待感</td></tr></tbody></table>
<h4 data-id="heading-4">前端架构：响应式优先，优化交互体验</h4>








































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>技术栈</td><td>选型理由</td><td>核心作用</td></tr><tr><td>Vue 3.5 + Composition API</td><td>组合式 API 更适合复杂逻辑复用，响应式系统性能优于 Vue 2</td><td>构建组件化、高复用的前端界面</td></tr><tr><td>Element Plus</td><td>企业级组件库，支持按需引入，减少 UI 开发工作量</td><td>快速搭建一致的交互界面（表单、弹窗、导航等）</td></tr><tr><td>Pinia</td><td>相比 Vuex 更简洁，原生支持 TypeScript，状态管理更清晰</td><td>管理全局状态（用户信息、会话列表、AI 模型配置）</td></tr><tr><td>Vite</td><td>冷启动速度快，热更新高效，适配大型前端项目</td><td>提升开发效率，优化生产环境构建体积</td></tr><tr><td>@tanstack/vue-virtual</td><td>专为 Vue 3 优化，内存占用低，支持大数据量渲染</td><td>解决长对话列表卡顿问题</td></tr></tbody></table>
<h4 data-id="heading-5">AI 能力集成：按需选择，平衡速度与质量</h4>
<ul>
<li><strong>豆包快速模型</strong>（doubao-seed-1-6-flash-250828）：响应延迟 &lt; 500ms，适合日常对话、简单查询</li>
</ul>

<ul>
<li><strong>豆包深度思考模型</strong>（doubao-seed-1-6-thinking-250715）：支持思维链输出，适合代码调试、复杂推理</li>
</ul>

<ul>
<li><strong>豆包 Seedream 4.0</strong>（doubao-seedream-4-0-250828）：图像生成分辨率高（最高 1024x1024），风格还原度好</li>
</ul>
<h3 data-id="heading-6">三大技术亮点（附踩坑与解决方案）</h3>
<h4 data-id="heading-7">1. SSE 流式响应：攻克 AI 对话实时性与格式完整性难题</h4>
<p>AI 对话的核心体验痛点是「等待感」和「格式错乱」—— 流式输出能解决等待问题，但逐段返回的文本容易导致 Markdown 代码块、表格被分割。我们的解决方案如下：</p>
<ul>
<li><strong>缓冲区 + 分段解析机制</strong>：将 AI 返回的 chunk 累积到缓冲区，按「换行符」分割，仅处理完整行，剩余内容保留在缓冲区</li>
</ul>

<ul>
<li><strong>Markdown 格式保护</strong>：检测到代码块起始标记（```）后，暂停分段解析，直到收到结束标记才统一渲染</li>
</ul>

<ul>
<li><strong>双模型适配逻辑</strong>：快速模型直接流式输出结果，深度模型先输出「思维链」（带thinking:前缀），再输出最终答案</li>
</ul>

<ul>
<li><strong>异常重试机制</strong>：网络中断时，基于已接收的文本片段重试请求，避免用户重新输入</li>
</ul>
<pre><code class="hljs"/></pre>
<p><code>// 优化后的流式处理核心代码</code></p>
<p><code>class StreamParser {</code></p>
<p><code>constructor(modelType) {</code></p>
<p><code>this.buffer = '';</code></p>
<p><code>this.modelType = modelType;</code></p>
<p><code>this.inCodeBlock = false; // 标记是否处于代码块中</code></p>
<p><code>}</code></p>
<p><code>parse(chunk) {</code></p>
<p><code>this.buffer += chunk.toString('utf-8');</code></p>
<p><code>const results = [];</code></p>
<p><code>// 代码块处理逻辑：未结束则不分割</code></p>
<p><code>if (this.inCodeBlock) {</code></p>
<p><code>const codeEndIndex = this.buffer.indexOf('```');</code></p>
<p><code>if (codeEndIndex === -1) return results; // 代码块未结束，返回空</code></p>
<p><code>// 提取完整代码块</code></p>
<p><code>results.push(this.buffer.slice(0, codeEndIndex + 3));</code></p>
<p><code>this.buffer = this.buffer.slice(codeEndIndex + 3);</code></p>
<p><code>this.inCodeBlock = false;</code></p>
<p><code>}</code></p>
<p><code>// 分割完整行（非代码块状态）</code></p>
<p><code>const lines = this.buffer.split('\n');</code></p>
<p><code>this.buffer = lines.pop() || ''; // 保留最后一行（可能不完整）</code></p>
<p><code>for (const line of lines) {</code></p>
<p><code>if (line.includes('```')) {</code></p>
<p><code>this.inCodeBlock = true;</code></p>
<p><code>}</code></p>
<p><code>// 区分思维链和最终答案（深度模型）</code></p>
<p><code>if (this.modelType === 'thinking' &amp;&amp; line.startsWith('thinking:')) {</code></p>
<p><code>results.push({ type: 'thinking', content: line.slice(9) });</code></p>
<p><code>} else {</code></p>
<p><code>results.push({ type: 'answer', content: line });</code></p>
<p><code>}</code></p>
<p><code>}</code></p>
<p><code>return results;</code></p>
<p><code>}</code></p>
<p><code>}</code></p>
<h4 data-id="heading-8">2. Prisma ORM：类型安全提升开发效率 80%</h4>
<p>传统 SQL 开发中，「字段名写错」「类型不匹配」是高频 bug。使用 Prisma 后，这些问题几乎消失：</p>
<ul>
<li><strong>Schema 定义驱动开发</strong>：先定义数据模型，Prisma 自动生成 TypeScript 类型，前后端类型一致</li>
</ul>

<ul>
<li><strong>示例 Schema（核心模型）</strong> ：</li>
</ul>
<pre><code class="hljs"/></pre>
<p><code>// 用户模型</code></p>
<p><code>model User {</code></p>
<p><code>id String @id @default(uuid())</code></p>
<p><code>username String @unique</code></p>
<p><code>email String @unique</code></p>
<p><code>passwordHash String</code></p>
<p><code>sessions Session[] // 关联会话</code></p>
<p><code>notes Note[] // 关联笔记</code></p>
<p><code>createdAt DateTime @default(now())</code></p>
<p><code>}</code></p>
<p><code>// 会话模型（AI对话）</code></p>
<p><code>model Session {</code></p>
<p><code>id String @id @default(uuid())</code></p>
<p><code>title String</code></p>
<p><code>userId String</code></p>
<p><code>user User @relation(fields: [userId], references: [id], onDelete: Cascade)</code></p>
<p><code>messages Message[] // 关联消息</code></p>
<p><code>modelType String // 模型类型：flash/thinking</code></p>
<p><code>createdAt DateTime @default(now())</code></p>
<p><code>updatedAt DateTime @updatedAt</code></p>
<p><code>}</code></p>
<ul>
<li><strong>迁移管理</strong>：修改 Schema 后，执行prisma migrate dev自动生成 SQL 迁移文件，避免手动改库</li>
</ul>

<ul>
<li><strong>查询优化</strong>：内置连接池（默认 10 个连接），支持批量查询和事务，减少数据库压力</li>
</ul>
<h4 data-id="heading-9">3. 虚拟滚动：支撑 10000 + 条对话无卡顿</h4>
<p>长对话列表是 AI 应用的常见场景，传统渲染方式会导致 DOM 节点过多、内存占用飙升。我们的优化方案：</p>
<ul>
<li>使用@tanstack/vue-virtual实现「可视区域渲染」，仅渲染当前屏幕能看到的对话项</li>
</ul>

<ul>
<li>对话项高度自适应：通过estimateSize函数动态计算每条消息的高度，避免固定高度导致的布局错乱</li>
</ul>

<ul>
<li>性能指标：10000 条对话时，DOM 节点数量从 10000 + 减少到 50 以内，内存占用从 800MB 降至 50MB，滚动 FPS 稳定 60+</li>
</ul>
<hr/>
<h2 data-id="heading-10">二、核心功能：多模态能力的技术实现细节</h2>
<h3 data-id="heading-11">1. AI 对话：从「能聊」到「好用」的体验优化</h3>
<h4 data-id="heading-12">核心特性与技术实现</h4>
<ul>
<li><strong>双模型切换</strong>：前端通过 Pinia 管理模型状态，切换时保留当前会话上下文，后端自动适配流式输出逻辑</li>
</ul>

<ul>
<li><strong>思维链展示</strong>：前端识别type: thinking的消息，用灰色小字 +「思考中...」前缀展示，与最终答案区分</li>
</ul>

<ul>
<li><strong>提示词模板管理</strong>：后端存储模板分类（写作 / 编程 / 学习），前端用树形组件展示，选择后自动填充到输入框</li>
</ul>

<ul>
<li><strong>Markdown 渲染</strong>：使用marked解析 Markdown，highlight.js实现代码高亮，katex支持数学公式渲染</li>
</ul>

<ul>
<li><strong>会话搜索</strong>：基于 Prisma 的contains查询，支持模糊搜索会话标题和消息内容，前端用防抖优化输入体验</li>
</ul>
<h4 data-id="heading-13">界面效果（附核心交互逻辑）</h4>
<p>**<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c25a72bd134cd08e44bc515d128b79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=SbGyEdvik6vS85ipK%2B31mBtB2QQ%3D" alt="AI对话界面" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li>输入框支持「发送」「换行」快捷键（Enter 发送，Shift+Enter 换行）</li>
</ul>

<ul>
<li>对话项支持「复制」「收藏」「删除」，操作栏 hover 显示</li>
</ul>

<ul>
<li>滚动到底部自动加载更多历史消息（分页查询，每页 20 条）</li>
</ul>
<h3 data-id="heading-14">2. 智能笔记：AI 与富文本编辑器的深度融合</h3>
<h4 data-id="heading-15">技术难点与解决方案</h4>
<ul>
<li><strong>流式插入不打乱编辑</strong>：AI 生成内容时，先记录光标位置（通过 WangEditor 的getSelectionRange），生成的内容插入后，用restoreSelection恢复光标位置</li>
</ul>

<ul>
<li><strong>双模式编辑</strong>：支持 Markdown 和富文本切换，通过marked和html-to-markdown实现双向转换</li>
</ul>

<ul>
<li><strong>自动保存</strong>：每 3 秒触发一次保存，前端防抖避免频繁请求，后端用 Prisma 的upsert实现「有则更新，无则创建」</li>
</ul>
<h4 data-id="heading-16">核心代码片段（AI 辅助写作）</h4>
<pre><code class="hljs"/></pre>
<p><code>// 前端触发AI润色功能</code></p>
<p><code>async function aiPolish(content) {</code></p>
<p><code>const loading = ElMessage.info('AI润色中...');</code></p>
<p><code>try {</code></p>
<p><code>// 发起SSE请求，携带当前笔记内容和操作类型（polish）</code></p>
<p><code>const stream = await fetchSSE('/api/note/ai-assist', {</code></p>
<p><code>method: 'POST',</code></p>
<p><code>body: JSON.stringify({</code></p>
<p><code>content,</code></p>
<p><code>type: 'polish' // 支持polish/summary/translate/continue</code></p>
<p><code>}),</code></p>
<p><code>headers: { 'Content-Type': 'application/json' }</code></p>
<p><code>});</code></p>
<p><code>// 流式接收AI生成的内容，实时插入编辑器</code></p>
<p><code>let result = '';</code></p>
<p><code>for await (const chunk of stream) {</code></p>
<p><code>result += chunk;</code></p>
<p><code>editor.setHtml(result); // 实时更新编辑器内容</code></p>
<p><code>restoreCursorPosition(); // 恢复光标位置</code></p>
<p><code>}</code></p>
<p><code>} catch (err) {</code></p>
<p><code>ElMessage.error('润色失败：' + err.message);</code></p>
<p><code>} finally {</code></p>
<p><code>loading.close();</code></p>
<p><code>}</code></p>
<p><code>}</code></p>
<h4 data-id="heading-17">界面效果</h4>
<p>**<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d2e9b37e7b140f9908eb700126cbb51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=KBsrxvG43nZ0rnkp4mpT6MvXI2k%3D" alt="智能笔记界面" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<h3 data-id="heading-18">3. AI 绘画：高质量图像生成与管理</h3>
<h4 data-id="heading-19">技术实现关键点</h4>
<ul>
<li><strong>参数化生成</strong>：前端提供尺寸（1024x1024/1024x768/768x1024）、风格（写实 / 动漫 / 抽象）、数量（1-4 张）等参数，后端转发至豆包 Seedream 4.0 API</li>
</ul>

<ul>
<li><strong>并发下载优化</strong>：生成多张图像时，用Promise.all限制并发数（最多 2 个），避免服务器带宽占用过高</li>
</ul>

<ul>
<li><strong>图像存储策略</strong>：生成的图像 URL 先保存到数据库，同时异步下载到服务器本地（路径：/uploads/images/{uuid}.png），避免第三方 API 失效导致图像丢失</li>
</ul>

<ul>
<li><strong>元数据记录</strong>：数据库存储图像的完整参数（提示词、尺寸、风格、生成时间），支持按关键词搜索生成记录</li>
</ul>
<h4 data-id="heading-20">界面效果</h4>
<p>**<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d15be9b712a74673a2bbe10a8874ef80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=C52B1xwZMyN5BA1wsMRo9yMZkr8%3D" alt="AI绘画界面1" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bbf83ea7e794547867e7f11e3931fcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983264&amp;x-signature=DfUjBVqZAftyPhP6dbAwUh1VkBA%3D" alt="AI绘画界面2" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<hr/>
<h2 data-id="heading-21">三、工程化实践：从开发到部署的完整流程</h2>
<h3 data-id="heading-22">1. 需求分析与设计阶段</h3>
<ul>
<li><strong>UI 设计</strong>：使用 MasterGo AI 快速生成原型，再手动优化细节，导出组件切图（避免重复设计）</li>
</ul>

<ul>
<li><strong>接口设计</strong>：基于 OpenAPI 3.0 规范，用 Swagger 生成接口文档，前后端同步开发（前端可先用 Mock 数据）</li>
</ul>

<ul>
<li><strong>数据库建模</strong>：先梳理实体关系（用户 - 会话 - 消息 - 笔记 - 图像），再用 Prisma Schema 定义模型，避免后期大规模改表</li>
</ul>
<h3 data-id="heading-23">2. 开发阶段：效率与质量并重</h3>
<h4 data-id="heading-24">后端开发规范</h4>
<ul>
<li>分层架构：Controller（接收请求）→ Service（业务逻辑）→ Repository（数据访问），职责单一</li>
</ul>

<ul>
<li>统一响应格式：</li>
</ul>
<pre><code class="hljs"/></pre>
<p><code>// 成功响应</code></p>
<p><code>res.json({ code: 200, message: 'success', data: result });</code></p>
<p><code>// 错误响应</code></p>
<p><code>res.status(400).json({ code: 400, message: '参数错误', error: err.message });</code></p>
<ul>
<li>日志记录：使用winston记录请求日志、错误日志，按日期分割日志文件（便于问题排查）</li>
</ul>

<ul>
<li>AI 工具辅助：用 Cursor 自动生成重复代码（如 CRUD 接口），手动优化核心逻辑（如流式处理）</li>
</ul>
<h4 data-id="heading-25">前端开发规范</h4>
<ul>
<li>组件化设计：拆分基础组件（Button、Input、Card）、业务组件（ChatItem、NoteEditor）、页面组件（ChatPage、NotePage）</li>
</ul>

<ul>
<li>响应式适配：使用vw+flex布局，适配 PC（≥1200px）、平板（768px-1199px）、手机（&lt;768px）</li>
</ul>

<ul>
<li>性能优化：</li>
</ul>

<ul>
<li>
<ul>
<li>路由懒加载：const ChatPage = () =&gt; import('@/views/ChatPage.vue')</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>图片懒加载：使用vue-lazyload，延迟加载非首屏图像</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>资源压缩：Vite 配置terser压缩 JS/CSS，imagemin压缩图片</li>
</ul>
</li>
</ul>
<h3 data-id="heading-26">3. 测试与部署阶段</h3>
<h4 data-id="heading-27">测试策略</h4>
<ul>
<li>接口测试：用Supertest编写 API 测试用例，覆盖核心接口（用户登录、会话创建、AI 生成）</li>
</ul>

<ul>
<li>前端测试：用Vitest测试工具函数（如流式解析、Markdown 渲染），用Cypress做关键流程 E2E 测试</li>
</ul>

<ul>
<li>性能测试：用k6模拟 100 并发用户访问 AI 对话接口，确保响应时间 &lt; 2s</li>
</ul>
<h4 data-id="heading-28">部署方案（Docker+Nginx）</h4>
<ol>
<li><strong>容器化打包</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>后端：基于 Node.js 镜像，安装依赖、复制代码，暴露 3000 端口</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>前端：Vite 构建生成静态文件，基于 Nginx 镜像部署</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>用 Docker Compose 管理服务（后端、前端、MySQL）</li>
</ul>
</li>
</ul>
<ol>
<li><strong>Nginx 配置</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>反向代理：将/api请求转发至后端服务</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>静态资源缓存：设置 CSS/JS/ 图片缓存时间（7 天）</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>HTTPS 配置：使用 Let's Encrypt 申请免费证书，开启 HTTPS</li>
</ul>
</li>
</ul>
<ol>
<li><strong>服务器环境</strong>：2 核 4G 云服务器（CentOS 7），MySQL 8.0，Docker 20.10+</li>
</ol>
<hr/>
<h2 data-id="heading-29">四、技术价值与学习路径</h2>
<h3 data-id="heading-30">适合谁学习？</h3>
<ul>
<li>想入门全栈 AI 应用开发的开发者</li>
</ul>

<ul>
<li>熟悉 Vue/Node.js，想提升工程化实践能力的开发者</li>
</ul>

<ul>
<li>对多模态 AI 集成、流式响应技术感兴趣的技术爱好者</li>
</ul>
<h3 data-id="heading-31">核心学习要点</h3>
<ol>
<li><strong>SSE 流式响应</strong>：理解 HTTP 流式传输原理，掌握缓冲区解析、格式保护的实现</li>
</ol>

<ol>
<li><strong>TypeScript 全栈实践</strong>：前后端统一类型定义，减少类型错误</li>
</ol>

<ol>
<li><strong>Prisma ORM 使用</strong>：从 Schema 定义到查询优化，简化数据库操作</li>
</ol>

<ol>
<li><strong>多模态 AI API 集成</strong>：文本生成、图像生成的接口适配与错误处理</li>
</ol>

<ol>
<li><strong>性能优化技巧</strong>：虚拟滚动、懒加载、数据库索引优化</li>
</ol>
<h3 data-id="heading-32">技术门槛（低至中等）</h3>
<ul>
<li>前端：HTML/CSS/JS 基础，Vue 3 Composition API 入门</li>
</ul>

<ul>
<li>后端：Node.js 基础，Express 框架使用经验</li>
</ul>

<ul>
<li>数据库：SQL 基础（Prisma 可屏蔽复杂 SQL）</li>
</ul>

<ul>
<li>工具：Git、Docker 基础（部署用）</li>
</ul>
<h3 data-id="heading-33">项目亮点总结</h3>
<p>✅ <strong>流式响应 + 格式保护</strong>：解决 AI 对话实时性与完整性的核心矛盾</p>
<p>✅ <strong>多模态能力无缝集成</strong>：文本、图像生成一站式实现，接口设计统一</p>
<p>✅ <strong>工程化规范完善</strong>：从代码规范到部署流程，可直接复用为企业级项目模板</p>
<p>✅ <strong>性能优化到位</strong>：虚拟滚动、懒加载等技术确保大规模数据下的流畅体验</p>
<p>✅ <strong>TypeScript 全栈覆盖</strong>：类型安全提升开发效率，降低维护成本</p>
<hr/>
<h2 data-id="heading-34">五、项目演示与学习资源</h2>
<p>这个项目的完整开发流程已整理成视频教程，包含：</p>
<ul>
<li>需求分析与 UI 设计（MasterGo AI 使用）</li>
</ul>

<ul>
<li>后端接口开发（Express+Prisma）</li>
</ul>

<ul>
<li>前端组件与交互实现（Vue 3+Element Plus）</li>
</ul>

<ul>
<li>SSE 流式响应核心代码拆解</li>
</ul>

<ul>
<li>Docker 部署与服务器配置</li>
</ul>
<p>感兴趣的朋友可以扫码查看详细教程和源码：</p>
<h2 data-id="heading-35">多模态 AI项目开发技术学习：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoding.imooc.com%2Fclass%2F954.html" title="https://coding.imooc.com/class/954.html" target="_blank" ref="nofollow noopener noreferrer">coding.imooc.com/class/954.h…</a></h2>
<hr/>
<h2 data-id="heading-36">总结</h2>
<p>智能汇 AI 项目的核心价值，在于将复杂的多模态 AI 能力与现代化全栈技术结合，提供了一套「可复用、可扩展」的开发方案。从技术角度看，SSE 流式响应、Prisma 类型安全、虚拟滚动这三大技术亮点，解决了 AI 应用开发中的核心痛点；从工程化角度看，完整的开发流程、规范的代码结构、便捷的部署方案，让项目具备了实际落地价值。</p>
<p>对于开发者而言，这个项目不仅是一次技术实践，更是对 AI 时代开发模式的探索 —— 未来的应用开发，将更多是「AI 能力封装 + 用户体验优化」的结合。希望本文能为你提供一份清晰的开发指南，帮助你快速上手全栈 AI 应用开发！</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[对标ChatGPT！千问App正式上线：AI应用终局之战正在打响]]></title>    <link>https://juejin.cn/post/7573273271799595048</link>    <guid>https://juejin.cn/post/7573273271799595048</guid>    <pubDate>2025-11-17T11:11:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573273271799595048" data-draft-id="7573523709299605539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="对标ChatGPT！千问App正式上线：AI应用终局之战正在打响"/> <meta itemprop="keywords" content="人工智能,资讯"/> <meta itemprop="datePublished" content="2025-11-17T11:11:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="算家计算"/> <meta itemprop="url" content="https://juejin.cn/user/1426490793396571"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            对标ChatGPT！千问App正式上线：AI应用终局之战正在打响
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1426490793396571/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    算家计算
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:11:32.000Z" title="Mon Nov 17 2025 11:11:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>阿里战略升级，全力进军AI to C市场。</p>
</blockquote>
<p>今天，阿里全力进军AI to C市场，统一其to C品牌：千问App公测版正式上线各大应用商店。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/163f5415a76c46878753d34674342ab6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763982691&amp;x-signature=kDAKm8V6mld8e%2FhljcT4MlniO8g%3D" alt="图片" loading="lazy"/></p>
<p>据悉，阿里内部将这一项目视为“AI时代的未来之战”，由董事长兼CEO吴泳铭亲自带队，集结了100多名工程师，在杭州总部两层专属办公区已秘密研发数月。</p>
<p>在此之前，阿里在AI to C领域的布局主要依靠夸克这样的“工具缝合应用”，缺少能直接对标ChatGPT或豆包的原生AI交互入口。</p>
<p>虽然阿里早在2023年4月就推出过原通义App，是第一批推出AI助手应用的国内大厂，但早期并没有在To C侧投入太多资源，更多是通过展示模型功能来吸引用户。</p>
<p>现在阿里正对体系内的To C产品进行归类整合，曾经的通义听悟相关能力已被整合到千问App中，以达到统一应用出口的目的。</p>
<p>千问App基于阿里全球性能第一的开源模型Qwen3打造，官方介绍称其不仅能与用户对话，更能为用户办事，致力于打造未来的AI生活入口。</p>
<p>该应用计划覆盖办公、地图、健康、购物等多个生活场景，未来还将增加AI代理功能，支持在淘宝、天猫等平台上用自然语言购物。</p>
<p><strong>竞争白热化的AI应用市场</strong></p>
<p>千问App加入之际，AI应用市场已经异常拥挤。根据QuestMobile数据，截至2025年3月，国内AI应用市场已形成移动端原生App、移动端应用插件和PC端网页应用三足鼎立的格局。</p>
<p>在原生App领域，竞争尤为激烈。DeepSeek、豆包等应用的月活跃用户规模均已过亿，而阿里原有的通义App月活仅在100到500万之间，与头部产品差距显著。</p>
<p>手机厂商凭借预装优势，在AI综合助手赛道占据主导地位，华为小艺、OPPO小布助手等月活均超过1.5亿。互联网企业的原生AI应用则呈现出总体上升明显但厂商两极分化的态势。</p>
<p>阿里此次推出千问App，将有效补齐C端影响力，直接对标ChatGPT和豆包。但面临的市场环境已今非昔比，AI用户渗透存在阶段性上限，且用户面临ChatBot供给过剩。</p>
<p>基于此，千问未来的增长来源，不会主要是等待转化的潜在群体，而是可能需要从应用市场直接争夺现有用户。</p>
<p><strong>技术优势能否转化为产品胜势？</strong></p>
<p>作为广大开发者心中的“源神”，Qwen可以凭借所积累的口碑占据一定优势。目前，Qwen系列已经是全球开源社区下载量第一、衍生模型数量第一的头号模型，截至2024年9月，Qwen系列模型全球下载量已突破6亿次。</p>
<p>但在开源上的认知优势可能很难转化为C端产品的竞争优势。专业人士做模型私有化部署时会想到Qwen，但使用联网C端产品时，大概率也会选择ChatGPT或Claude。</p>
<p>当前AI产品获得C端用户，已经不能再依靠投流和运营，更多要借助底层模型的能力提升。DeepSeek没花一分钱广告费，在短短7天内就完成了1亿用户的增长，正是因为模型能力断层领先。</p>
<p><strong>AI应用未来竞争焦点</strong></p>
<p>随着千问App的加入，AI应用市场的竞争格局更加清晰。未来的竞争重点已经从单纯的对话能力，转向了实际办事能力。</p>
<p>阿里计划将地图、外卖、订票、办公、学习、购物、健康等各类生活场景接入千问APP，让其具备更强大的办事能力。这种一站式解决方案的定位，与其他AI应用形成了差异化竞争。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4670a899478a4ea6a957b214dd9cf89d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763982691&amp;x-signature=%2Bb%2FLnbvoiFHCssV%2FfGV4V5Ykgzo%3D" alt="图片" loading="lazy"/></p>
<p>千问App的国际版也在同步研发中，希望借助Qwen模型在开发者圈的影响力，与ChatGPT在海外市场直接竞争。</p>
<p>随着阿里全面入局，AI应用市场的竞争将更加激烈，也更加清晰。而未来的格局也将由此重塑。</p>
<p>而无论是千问背后的Qwen模型，还是正在崛起的其他AI应用，它们的训练、推理与迭代，都离不开稳定、高效、可扩展的计算能力支撑。</p>
<p>如果您正在进行AI领域的创业或研究，却受困于高昂的算力成本或高并发下的推理稳定性等问题，欢迎留言或私信我们，找到您的降本增效突破口~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这是一篇写给AI大模型入门的新手小白手册（附文档）]]></title>    <link>https://juejin.cn/post/7573525634212151339</link>    <guid>https://juejin.cn/post/7573525634212151339</guid>    <pubDate>2025-11-17T11:38:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525634212151339" data-draft-id="7573511426867560467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这是一篇写给AI大模型入门的新手小白手册（附文档）"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-17T11:38:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这是一篇写给AI大模型入门的新手小白手册（附文档）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:38:44.000Z" title="Mon Nov 17 2025 11:38:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>学AI大模型也有一段时间了，之前学大模型一直都是东一榔头，西一棒槌，这学一点那学一点，网上很多名义上说是系统化大模型教程的，到后面也是零零散散，拼拼凑凑的教程，我花了几个月的时间才构建起对大模型的整体认知，但不够细致......</p>
<p>所以，为了让大家避免我之前踩过的坑，今天特地梳理了一下大致的学习框架，让大家有目的有方向的学习，这样可以节省很多的时间。</p>
<p>首先，大家应该明白一件事，<strong>大模型技术是人工智能技术的一个分支，是目前主流的一个研究方向，但并不是唯一的方向</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/478e1f619e524f1a8a639ae929d5eab9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=1MK2ELQV%2BdIb%2Ff7%2F9GT6cdHn4P8%3D" alt="图片" loading="lazy"/></p>
<p>以上都是可以深入学习的方向。</p>
<p>下面来给大家讲讲AI大模型入门手册的具体内容，主要分为六个部分：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f627171045a439db51103a906a91d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=OENVDoaHJc16BmcXbONAg%2FK42nc%3D" alt="图片" loading="lazy"/></p>
<p><strong>第一章：深度学习基础知识 (难度⭐⭐)</strong></p>
<p>Transformer作为当前大模型的核心基础框架，主流大模型均围绕Transformer架构进行衍生改进。此外，还需掌握神经网络的基础知识，例如Batch Normalization（BN）与Layer Normalization（LN）的差异、不同优化器的性能对比等。相较于初级的深度学习入门内容，这部分知识的复杂度有所提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ca2b05bcf6b4836a7dbad558042c479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=gGrDsZHUXTLDatgrhxUx6nVy%2BZw%3D" alt="图片" loading="lazy"/></p>
<p><strong>第二章：自然语言处理基础知识 （难度⭐⭐⭐）</strong></p>
<p>掌握NLP的基础知识是学习LLM的前提条件，例如需要熟悉分词器（Tokenizer）的工作原理。此外，当前主流的NLP模型如Bert（Bidirectional Encoder Representations from Transformers）具有里程碑意义——该模型的问世验证了大模型通过‌预训练（Pre-training）‌与‌微调（Fine-tuning）‌相结合的范式可行性。最后，在自然语言处理任务中，‌困惑度（Perplexity）‌作为核心评估指标，其重要性不可忽视。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f7b9a59258d4a48a70df30aba7a5240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=tjI5E%2F0cE8SoMysEkiejcwz3U9g%3D" alt="图片" loading="lazy"/></p>
<p><strong>第三章：大语言模型基础知识 （难度⭐⭐⭐⭐）</strong></p>
<p>这部分的内容包括大模型训练框架，比如Megatron-LM, DeepSpeed, 高效参数微调的方法，当前主流的开源大模型，RLHF流程的介绍，COT和TOT的介绍，监督微调的训练，最后是混合专家模型MOE。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32949a88dc034c98b682c5593a2b20ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=D6t%2F%2FaZqcrkpvSxgrAHssIlio5g%3D" alt="图片" loading="lazy"/></p>
<p><strong>第四章：大语言模型推理 （难度⭐⭐⭐）</strong></p>
<p>在完成模型训练后，大模型的输出结果即构成推理流程。本节将重点说明HuggingFace的推理参数配置、推理过程中KVCache机制的作用，以及LLM推理所需付出的成本代价。‌实际应用中的核心考量因素‌始终在于推理速度与资源消耗的平衡。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc11a58b83124b6d9a9f42e9f651ef55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=47O7QfYIqlSt2UzsGqnGWs7Ujm0%3D" alt="图片" loading="lazy"/></p>
<p><strong>第五章：大语言模型应用（难度</strong>* <em>⭐⭐⭐）</em>*</p>
<p>不同大模型的数据格式，API接口等都不一样，可以通过Langchain来统一管理这些，支持大模型的统一化调用，支持便捷的prompt模版设置，还有智能体的高阶应用，建议结合相关视频教程来学习langchain</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d047f732e7064ea6ac0c75023c3b2aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=nN9BFbOaxCnfpEbOamI1YRxpoO8%3D" alt="图片" loading="lazy"/></p>
<p><strong>第六章：大语言模型前沿（难度⭐⭐⭐）</strong></p>
<p>本部分聚焦于LLM（大语言模型）相关博客的推荐。由于大模型技术迭代迅速，建议通过阅读专业博客主动跟进学习，同时关注顶会（如NeurIPS、ACL等）的前沿论文。当前可参考的资料较为有限，后续可逐步补充完善。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de23349cda03401dbfc6f6121183b408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984323&amp;x-signature=akc%2FZU84IGY1KJXs%2BjWB9u8Boew%3D" alt="图片" loading="lazy"/></p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于No Chatbot的思考]]></title>    <link>https://juejin.cn/post/7573524348129181759</link>    <guid>https://juejin.cn/post/7573524348129181759</guid>    <pubDate>2025-11-17T11:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573524348129181759" data-draft-id="7573511426867445779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于No Chatbot的思考"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-17T11:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HeteroCat"/> <meta itemprop="url" content="https://juejin.cn/user/2221479480010573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于No Chatbot的思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2221479480010573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HeteroCat
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:27:22.000Z" title="Mon Nov 17 2025 11:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/729f82fe449a45eb882d3b25a42e3e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGV0ZXJvQ2F0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983642&amp;x-signature=XrD3WiWEClNAA9hGb7N6DhS4x2E%3D" alt="AI概念图标" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>近期在大模型圈子里，“No Chatbot”这一概念潇潇浮出江面，它意指不再将智能体局限于传统的对话式问答系统，而是发展为具备主动规划、调用工具和协作能力的智能助理。作为一名长期研究提示词工程和智能体应用的创作者，我想结合最近的思考，与大家探讨这一趋势的内涵与意义。</p>
<h3 data-id="heading-1">什么是“No Chatbot”</h3>
<p>“No Chatbot”并不是不要聊天机器人，而是指下一代智能体需要突破单纯聊天交互的框架，具备更强的自主性和执行力。它主要包含以下特征：</p>
<ul>
<li><strong>任务导向</strong>：关注完成复杂任务，而不是只回答问题。系统会根据目标自动规划步骤、调用能力并反馈进度。</li>
<li><strong>多模态交互</strong>：不仅支持文本对话，还能处理图片、语音、表格等多种媒介，提升信息获取和表达的丰富性。</li>
<li><strong>工具调度</strong>：可以调用代码执行器、搜索引擎、知识库、第三方接口等工具，根据需要组合使用完成任务。</li>
<li><strong>长期记忆与反思</strong>：具备持久记忆，能够总结经验并自我置错，在多轮任务中不断优化策略。</li>
</ul>
<h3 data-id="heading-2">Agent发展的新趋势</h3>
<p>围绕“No Chatbot”，智能体技术正在出现一些新趋势：</p>
<ol>
<li><strong>从对话到执行</strong>：早期智能体主要在聊天框架下回答问题，今天的Agent则更加注重执行，例如自动化撰写报告、批量处理数据、调用外部API完成事务。</li>
<li><strong>Prompt 工程进阶</strong>：提示词设计从简单指令发展到包含角色设定、上下文规划、分步流程及示例演示等多元素组合。良好的提示词是智能体可靠执行的关键。</li>
<li><strong>自我反省与调度</strong>：越来越多框架加入了 self‑reflection 和验证模块，让Agent在行动中不断检查输出是否合理。</li>
<li><strong>生态融合</strong>：Agent不再因隔运行，而是嵌入应用场景，如电商运营、数据分析、开发辅助。通过结合现有系统，智能体的价值才能真正释放。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9f8bc1731ba4359be9b56f345613d90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGV0ZXJvQ2F0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983642&amp;x-signature=5on2BS9qzG7rgTMCYx4rKvo0AAM%3D" alt="\u591a\u6a21\u6001\u4ea4\u4e92\u56fe\u6807" loading="lazy"/></p>
<h3 data-id="heading-3">实践与案例</h3>
<p>近年来流出几多探索“No Chatbot”的项目。例如：</p>
<ul>
<li><strong>AutoGPT / BabyAGI 系列</strong>：通过设定目标，智能体自动规划并调用工具链完成复杂任务，例如爬取信息、生成报告等。</li>
<li><strong>企业内部 Agent 平台</strong>：各公司开始搭建智能体平台，让员工通过自然语言指令调度内部系统，提升效率。</li>
<li><strong>个人创新项目</strong>：我在之前的《扭子AI应用：AI鲜花画布》中构建了一个图片编辑智能体，它结合多模型生成海报和优化商品图，体现了多工具协作的思路。</li>
</ul>
<p>这些探索表明，未来的智能体将不局限于聊天，而是朝着专业助手甚至自动化协作者走发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c370f1f452641b8b2b83ec85cbaa586~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGV0ZXJvQ2F0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763983642&amp;x-signature=klFY0EYc5h5DWfXV9LNOITBUHmw%3D" alt="\u8bb0\u5fc6\u53cd\u601d\u56fe\u6807" loading="lazy"/></p>
<h3 data-id="heading-4">总结与展望</h3>
<p>“No Chatbot”不是口号，而是智能体发展方向的提醒：真正有用的 AI 应该能理解用户目标、主动策划、多模态沟通、调用工具完成任务，并在过程中自我改进。对于创作者来说，我们需要不断学习新的提示词技巧、借鉴先进框架，同时结合自身场景设计应用。未来我相信，智能体将在教育、科研、商业等达多领域发挥更大作用，成为人类工作与生活的有力伴侣。让我们携手拥抱“No Chatbot”时代的到来。</p>
<p>注本文由openai atlas生成</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[利用CMDB数据实现指标业务维度的动态扩展]]></title>    <link>https://juejin.cn/post/7573504290066137103</link>    <guid>https://juejin.cn/post/7573504290066137103</guid>    <pubDate>2025-11-17T11:48:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573504290066137103" data-draft-id="7573508361740943360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="利用CMDB数据实现指标业务维度的动态扩展"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2025-11-17T11:48:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            利用CMDB数据实现指标业务维度的动态扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T11:48:40.000Z" title="Mon Nov 17 2025 11:48:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>很多客户已经建有 Prometheus/Zabbix 等采集方式，通常不会贸然替换 DataKit 进行直采，往往是通过 DataKit 去获取其它工具采集的结果。如 Prometheus remote write，Zabbix export 等。</p>
<p>为了增加不同数据类型的关联性，需要对已有的指标数据添加更多业务 TAG，如应用名，所属项目，部门等。为实现此类需求，需要能够获得原始的相关配置信息，如 CMDB 数据等。然后通过观测云 Pipeline 中的 refere_table() 方法实现关联数据并添加 TAG。</p>
<p>本文档基于客户方实际案例，介绍如何使用 reference table，以及在使用过程中的注意事项。</p>
<p>更多关于 refer_table 用法参考官网文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.guance.com%2Fpipeline%2Fuse-pipeline%2Fpipeline-refer-table%2F" target="_blank" title="https://docs.guance.com/pipeline/use-pipeline/pipeline-refer-table/" ref="nofollow noopener noreferrer">Reference Table</a> 。</p>
<h2 data-id="heading-1">观测云</h2>
<p>观测云是一款专为 IT 工程师打造的全链路可观测产品，它集成了基础设施监控、应用程序性能监控和日志管理，为整个技术栈提供实时可观察性。这款产品能够帮助工程师全面了解端到端的用户体验追踪，了解应用内函数的每一次调用，以及全面监控云时代的基础设施。此外，观测云还具备快速发现系统安全风险的能力，为数字化时代提供安全保障。</p>
<h2 data-id="heading-2">实现原理</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aa690c84e2f4998bde9c4428eb9e608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=kQIAOJen%2B3LRyqgOI9cC%2B7R1DIo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">实践步骤</h2>
<h3 data-id="heading-4">1. 新建 Func 脚本</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建两个方法，一个用于pipeline获取json数据（get_reference_table),一个用于获取json数据并放入redis中。这样可以减少对原业务系统数据库的访问压力。</span>
<span class="hljs-meta">@DFF.API(<span class="hljs-params"><span class="hljs-string">'获取reference table'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_reference_table</span>():
    <span class="hljs-comment"># 从redis中获取已缓存的数据</span>
    earth = json.loads(DFF.CACHE.get(<span class="hljs-string">'refer_tab_earth'</span>))
    <span class="hljs-keyword">return</span> [earth]

<span class="hljs-comment"># 此处的earth平台是客户方集群管理系统。</span>
<span class="hljs-comment"># 此案例中需根据Prometheus中的字段关联project，app信息。</span>
<span class="hljs-comment"># 分页获取原始数据，组装reference table要求的数据结构，并将结果放入redis</span>
<span class="hljs-meta">@DFF.API(<span class="hljs-params"><span class="hljs-string">'缓存earth映射表'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_earth_table</span>():
    db = DFF.CONN(<span class="hljs-string">'mysql_earth'</span>)
    <span class="hljs-comment"># get project data</span>
    project_dict = {o[<span class="hljs-string">'id'</span>]: o <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> db.query(<span class="hljs-string">'select id,name,cmdb_app_id,cmdb_app from project'</span>)}
    service_count = db.query(<span class="hljs-string">'select count(1) count from service'</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">'count'</span>]
    offset = <span class="hljs-number">0</span>
    rows =[]
    <span class="hljs-keyword">while</span> offset &lt; service_count:
        rslt = db.query(<span class="hljs-string">f'select a.id service_id, a.name service_name, b.project_id from service a left join application b on a.application_id = b.id limit <span class="hljs-subst">{offset}</span>,1000'</span>)
        <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> rslt:
            p = project_dict[o[<span class="hljs-string">'project_id'</span>]]
            cmdb_app = json.loads(p[<span class="hljs-string">'cmdb_app'</span>])[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">if</span> p[<span class="hljs-string">'cmdb_app'</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>
            row = [<span class="hljs-string">f"service-<span class="hljs-subst">{o[<span class="hljs-string">'service_id'</span>]}</span>"</span>, <span class="hljs-string">f"project-<span class="hljs-subst">{p[<span class="hljs-string">'id'</span>]}</span>"</span>, o[<span class="hljs-string">'service_name'</span>], p[<span class="hljs-string">'name'</span>], p[<span class="hljs-string">'cmdb_app_id'</span>], cmdb_app]
            rows.append(row)
        offset += <span class="hljs-built_in">len</span>(rslt)
    data = {
        <span class="hljs-string">'table_name'</span>: <span class="hljs-string">'earth'</span>,
        <span class="hljs-string">'column_name'</span>: [<span class="hljs-string">'earth_service'</span>, <span class="hljs-string">'earth_project'</span>, <span class="hljs-string">'service_name'</span>, <span class="hljs-string">'project_name'</span>, <span class="hljs-string">'appId'</span>, <span class="hljs-string">'appName'</span>],
        <span class="hljs-string">'column_type'</span>: [<span class="hljs-string">'string'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-string">'string'</span>],
        <span class="hljs-string">'row_data'</span>: rows
    }
    DFF.CACHE.<span class="hljs-built_in">set</span>(<span class="hljs-string">'refer_tab_earth'</span>, json.dumps(data))
</code></pre>
<h3 data-id="heading-5">2. 创建 Func 同步链接</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/180dff69290c4092a47d3769db50b3d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=3ti8OsEosjaxjgKv7%2BlF21Q7TNs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3. 配置 Pipeline 获取 Reference Table 地址</h3>
<p>编辑 DataKit 的主配置文件 <code>datakit.conf</code>，配置 Pipeline 下的 <code>refer_table_url</code> 为上一步创建的同步 API 链接。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1278c7a49ccd4d7b94f6bc0e5927f290~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=yJwoLifnfMO8umMOW4dNJpylJic%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">4. 创建 Pipeline</h3>
<p>通过观测云管理菜单下面的 Pipeline 菜单进入 Pipeline 菜单管理页面（因为是需要对指标数据进行 Pipeline 处理，只能通过该菜单进入才能创建处理指标的 Pipeline），并创建一个新的 Pipeline。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943ecbabdf1c41cb99faee28bfd0ab96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=QqDVPExZoTBk27Vo6tMZ%2F1JhGWc%3D" alt="" loading="lazy"/></p>
<p>配置 Pipeline 名称以及合适的过滤条件（由于本案例是用单独的 DataKit 采集 prom 指标，故无过滤条件）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1af928a884ef4a53ad2ebc885569805d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=mBS8U0oieIUOXzCRybnAYUwJAAw%3D" alt="" loading="lazy"/></p>
<p>编辑 Pipeline 脚本并保存。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">grok</span>(pod,"service-%{INT:serviceId}")
controller_name = 'service-' + serviceId
<span class="hljs-built_in">set_tag</span>('service_id',  serviceId)
<span class="hljs-built_in">set_tag</span>('controller_name', controller_name)
# 从reference <span class="hljs-selector-tag">table</span>中获取earth_service 为controller_name的数据
<span class="hljs-built_in">query_refer_table</span>('earth','earth_service', controller_name)
<span class="hljs-built_in">drop_key</span>('serviceId')
if project_name != nil {
    <span class="hljs-built_in">set_tag</span>('project_name', project_name)
    <span class="hljs-built_in">set_tag</span>('container_name', service_name)
    <span class="hljs-built_in">set_tag</span>('app_id', appId)
    <span class="hljs-built_in">set_tag</span>('app_name', appName)
    k = <span class="hljs-built_in">slice_string</span>(pod, len(container), <span class="hljs-built_in">len</span>(pod))
    k = service_name + k
    <span class="hljs-built_in">set_tag</span>('pod_name',k)
  
}
</code></pre>
<h3 data-id="heading-8">5. 验证结果</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/901418b19f2a45f7b9e37b482f707a2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763984920&amp;x-signature=K2qygh6FarPwUKCimhDq0e1qKZA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">注意事项</h2>
<ol>
<li>如若使用中心 Pipeline，请确保中心 Pipeline 功能已开启（默认关闭）；</li>
<li>如果使用本地 Pipeline，请确保每个涉及到该类数据采集的 DataKit 实例都有正确配置refere table url；</li>
<li>编辑 Pipeline 时，如果页面提示解析失败，可以忽略，因为页面调试使用的是中心 Pipeline，如果中心 Pipeline 没有配置 refer table 获取地址的话，会报错；</li>
<li>JSON 文件会被加载到内存中，注意 table 大小。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[swiftui使用WKWebView加载自签的https服务，允许不安全访问]]></title>    <link>https://juejin.cn/post/7573528564025589806</link>    <guid>https://juejin.cn/post/7573528564025589806</guid>    <pubDate>2025-11-17T09:52:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573528564025589806" data-draft-id="7573521516323897371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="swiftui使用WKWebView加载自签的https服务，允许不安全访问"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-17T09:52:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024小神"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            swiftui使用WKWebView加载自签的https服务，允许不安全访问
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024小神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:52:07.000Z" title="Mon Nov 17 2025 09:52:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我的开源项目PakePlus可以将网页/Vue/React项目打包为桌面/手机应用并且小于5M只需几分钟，官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpakeplus.com" target="_blank" title="https://pakeplus.com" ref="nofollow noopener noreferrer">pakeplus.com</a></p><p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed6ec3de4342454995c0d0055b482beb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2458" loading="lazy"/></p><p/>
<p>这个错误是 <strong>SSL 证书验证失败</strong> 导致的（<code>code=-1202</code> 对应 <code>NSURLErrorServerCertificateUntrusted</code>），因为你的服务端 <code>https://192.168.31.197:5173/</code> 使用的是自签名证书或未被 iOS 信任的证书。以下是完整的解决方案，包含证书信任配置和 WKWebView 正确实现：</p>
<p>在 <code>Info.plist</code> 中添加以下配置：</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSAppTransportSecurity</span>&lt;/key&gt;
<span class="hljs-operator">&lt;</span>dict<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSAllowsArbitraryLoads</span>&lt;/key&gt;
    <span class="hljs-operator">&lt;</span><span class="hljs-literal">true</span><span class="hljs-operator">/&gt;</span>
    <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSAllowsLocalNetworking</span>&lt;/key&gt;
    <span class="hljs-operator">&lt;</span><span class="hljs-literal">true</span><span class="hljs-operator">/&gt;</span>
<span class="hljs-operator">&lt;/</span>dict<span class="hljs-operator">&gt;</span></code></pre>
<p>或者更精确的配置：</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-operator">&lt;!--</span> 允许非<span class="hljs-type">HTTPS请求（可选，若服务端后续可能切换HTTP）</span> <span class="hljs-operator">--&gt;</span>
<span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSAppTransportSecurity</span>&lt;/key&gt;
<span class="hljs-operator">&lt;</span>dict<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSAllowsArbitraryLoads</span>&lt;/key&gt;
    <span class="hljs-operator">&lt;</span><span class="hljs-literal">true</span><span class="hljs-operator">/&gt;</span>
    <span class="hljs-operator">&lt;!--</span> 单独允许目标<span class="hljs-type">IP的HTTPS请求（更安全的写法）</span> <span class="hljs-operator">--&gt;</span>
    <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSExceptionDomains</span>&lt;/key&gt;
    <span class="hljs-operator">&lt;</span>dict<span class="hljs-operator">&gt;</span>
        <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-number">192.168</span>.<span class="hljs-number">31.197</span><span class="hljs-operator">&lt;/</span>key<span class="hljs-operator">&gt;</span>
        <span class="hljs-operator">&lt;</span>dict<span class="hljs-operator">&gt;</span>
            <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSIncludesSubdomains</span>&lt;/key&gt;
            <span class="hljs-operator">&lt;</span><span class="hljs-literal">true</span><span class="hljs-operator">/&gt;</span>
            <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSTemporaryExceptionAllowsInsecureHTTPLoads</span>&lt;/key&gt;
            <span class="hljs-operator">&lt;</span><span class="hljs-literal">true</span><span class="hljs-operator">/&gt;</span>
            <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSTemporaryExceptionMinimumTLSVersion</span>&lt;/key&gt;
            <span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span><span class="hljs-type">TLSv1</span>.<span class="hljs-number">2</span><span class="hljs-operator">&lt;/</span>string<span class="hljs-operator">&gt;</span>
        <span class="hljs-operator">&lt;/</span>dict<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;/</span>dict<span class="hljs-operator">&gt;</span>
<span class="hljs-operator">&lt;/</span>dict<span class="hljs-operator">&gt;</span>

<span class="hljs-operator">&lt;!--</span> iOS <span class="hljs-number">14</span><span class="hljs-operator">+</span> 要求：允许加载本地网络资源 <span class="hljs-operator">--&gt;</span>
<span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><span class="hljs-type">NSLocalNetworkUsageDescription</span>&lt;/key&gt;
<span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span>需要访问本地网络以加载服务端内容<span class="hljs-operator">&lt;/</span>string<span class="hljs-operator">&gt;</span></code></pre>
<h4 data-id="heading-0"/>
<h4 data-id="heading-1">实现 WKWebView 并忽略 SSL 证书验证</h4>
<p>WKWebView 默认严格验证 SSL 证书，需要通过 <code>WKNavigationDelegate</code> 手动忽略验证（仅用于开发环境，生产环境需使用正规证书）：</p>
<pre><code class="hljs language-Swift" lang="Swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Coordinator</span>: <span class="hljs-title class_">NSObject</span>, <span class="hljs-title class_">WKNavigationDelegate</span> {
    <span class="hljs-keyword">let</span> parent: <span class="hljs-type">WebView</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">parent</span>: <span class="hljs-type">WebView</span>) {
        <span class="hljs-keyword">self</span>.parent <span class="hljs-operator">=</span> parent
    }
    
    <span class="hljs-comment">// 关键：强制信任所有SSL证书（仅开发环境！）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">webView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">webView</span>: <span class="hljs-type">WKWebView</span>, <span class="hljs-params">didReceive</span> <span class="hljs-params">challenge</span>: <span class="hljs-type">URLAuthenticationChallenge</span>, <span class="hljs-params">completionHandler</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">URLSession</span>.<span class="hljs-type">AuthChallengeDisposition</span>, <span class="hljs-type">URLCredential</span>?) -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-comment">// 1. 检查是否是服务器信任验证</span>
        <span class="hljs-keyword">guard</span> challenge.protectionSpace.authenticationMethod <span class="hljs-operator">==</span> <span class="hljs-type">NSURLAuthenticationMethodServerTrust</span> <span class="hljs-keyword">else</span> {
            completionHandler(.performDefaultHandling, <span class="hljs-literal">nil</span>)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 2. 获取服务器信任对象</span>
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> serverTrust <span class="hljs-operator">=</span> challenge.protectionSpace.serverTrust <span class="hljs-keyword">else</span> {
            completionHandler(.cancelAuthenticationChallenge, <span class="hljs-literal">nil</span>)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 3. 强制信任证书（关键：忽略证书有效性检查）</span>
        <span class="hljs-keyword">let</span> credential <span class="hljs-operator">=</span> <span class="hljs-type">URLCredential</span>(trust: serverTrust)
        completionHandler(.useCredential, credential)
        
        <span class="hljs-comment">// 调试：打印证书信息，确认是否是目标服务器</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"强制信任证书：<span class="hljs-subst">\(challenge.protectionSpace.host)</span>:<span class="hljs-subst">\(challenge.protectionSpace.port <span class="hljs-operator">??</span> <span class="hljs-number">0</span>)</span>"</span>)
    }
    
    <span class="hljs-comment">// 加载失败时打印详细错误（方便排查）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">webView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">webView</span>: <span class="hljs-type">WKWebView</span>, <span class="hljs-params">didFailProvisionalNavigation</span> <span class="hljs-params">navigation</span>: <span class="hljs-type">WKNavigation</span>!, <span class="hljs-params">withError</span> <span class="hljs-params">error</span>: <span class="hljs-type">Error</span>) {
        <span class="hljs-keyword">let</span> nsError <span class="hljs-operator">=</span> error <span class="hljs-keyword">as</span> <span class="hljs-type">NSError</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"加载失败："</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误码：<span class="hljs-subst">\(nsError.code)</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误描述：<span class="hljs-subst">\(nsError.localizedDescription)</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误域名：<span class="hljs-subst">\(nsError.domain)</span>"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> failureReason <span class="hljs-operator">=</span> nsError.localizedFailureReason {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"失败原因：<span class="hljs-subst">\(failureReason)</span>"</span>)
        }
    }
}</code></pre>
<p/>
大家好，我是1024小神，技术群 / 私活群 / 股票群 或 交朋友 都可以私信我。
如果你觉得本文有用，一键三连 (点赞、评论、关注)，就是对我最大的支持~</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[支持鸿蒙！开源三个月，uView Pro 开源库近期更新全面大盘点，及未来计划]]></title>    <link>https://juejin.cn/post/7573486671297069098</link>    <guid>https://juejin.cn/post/7573486671297069098</guid>    <pubDate>2025-11-17T10:03:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573486671297069098" data-draft-id="7568859869694001188" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="支持鸿蒙！开源三个月，uView Pro 开源库近期更新全面大盘点，及未来计划"/> <meta itemprop="keywords" content="前端,Vue.js,uni-app"/> <meta itemprop="datePublished" content="2025-11-17T10:03:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端梦工厂"/> <meta itemprop="url" content="https://juejin.cn/user/4230576472589976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            支持鸿蒙！开源三个月，uView Pro 开源库近期更新全面大盘点，及未来计划
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576472589976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端梦工厂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:03:45.000Z" title="Mon Nov 17 2025 10:03:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>uView Pro 开源近三个月以来，收到了良好的反馈和迭代。目前 uView Pro 已经迭代了 40+ 个版本，平均每两天就会发布版本，主要是优化性能、新增\增强组件功能、bug修复、兼容性完善等。</p>
<p>所以目前 uView Pro 在稳定性、功能性与跨平台兼容性方面已经有了良好的表现。主要实现了 APP、鸿蒙、微信、支付宝、头条等小程序平台的兼容，后续也会继续进行迭代。</p>
<p>本文基于最近的 changelog 汇总，面向开发者与项目贡献者，系统介绍新增组件、关键修复、工具能力以及如何在项目中快速体验这些特性，并提供示例代码与资源链接，方便你在实际工程中落地使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7312958ca6cb48678110e98d6de51881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=aT1HaPFIso7uS3g4BjTwseW%2BPHI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、总体概览</h2>
<p>目前最新版本（0.3.15 及此前若干小版本）覆盖三大方向：</p>
<ul>
<li>平台兼容与 bug 修复：适配更多小程序平台（包括鸿蒙/各小程序支持的完善），修复了 canvas 渲染、表单响应、picker 初始化、组件兼容性等若干跨端问题。</li>
<li>新组件与用户体验优化：推出并增强若干特色组件，如 <code>u-fab</code>（悬浮按钮）、<code>u-text</code>、<code>u-loading-popup</code>、<code>u-textarea</code>、<code>u-safe-bottom</code>、<code>u-status-bar</code>、<code>u-root-portal</code>，以满足常见 UI 场景需求。</li>
<li>工具链与框架能力：增强 <code>http</code> 插件与 <code>useCompRelation</code>（组件关系管理 Hooks），使业务层网络请求与复杂组件协作更便捷。</li>
</ul>
<p>接下来我们把重点放在新增与优化的功能、示例使用以及工程实践建议上。</p>
<p>详情可查看官网及近期更新日志：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2F" target="_blank" title="https://uviewpro.cn/" ref="nofollow noopener noreferrer">uviewpro.cn/</a></p>
<h2 data-id="heading-1">二、亮点功能与新增组件（逐个拆解）</h2>
<h3 data-id="heading-2">1) u-fab（悬浮按钮）</h3>
<p>简介：<code>u-fab</code> 是面向移动端常见的悬浮操作入口，支持多种预设定位、拖动吸边（<code>autoStick</code>）以及 <code>gap</code> 属性的精细化配置。该组件在交互与无障碍体验上进行了增强，能兼容多端布局差异。</p>
<p>主要特性：</p>
<ul>
<li>预设 position（如右下、左下、右中等）便于在不同 UI 布局中快速放置。</li>
<li>支持 gap 的对象式配置（top/right/bottom/left），使 demo 与真实项目兼容性更好。</li>
<li>autoStick：拖动后自动吸边，提升交互体验。</li>
</ul>
<p>示例：</p>
<p>示例（Vue 3 Composition API）：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">u-fab</span> <span class="hljs-attr">position</span>=<span class="hljs-string">"right-bottom"</span> <span class="hljs-attr">:gap</span>=<span class="hljs-string">"gapObj"</span> <span class="hljs-attr">:draggable</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">:autoStick</span>=<span class="hljs-string">"true"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">u-button</span> <span class="hljs-attr">shape</span>=<span class="hljs-string">"circle"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"mini"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onFabClick"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">u-icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"thumb-up"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"40"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">u-button</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">u-fab</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">const</span> gapObj = { <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">16</span> };
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onFabClick</span>(<span class="hljs-params"/>) {
	uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'悬浮按钮点击'</span> });
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>建议：在移动端应结合 safe area（如 <code>u-safe-bottom</code>）与页面常驻按钮布局谨慎使用 <code>u-fab</code>，避免遮挡关键内容。</p>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2Ffab.html" target="_blank" title="https://uviewpro.cn/zh/components/fab.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9ff3f1fc10149a6baf27e7599608a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=t9HjH7Bys6gSRXM1tcVZiMQlZGo%3D" alt="12.png" loading="lazy"/></p>
<h3 data-id="heading-3">2) u-text</h3>
<p>简介：<code>u-text</code> 提供更灵活的文字样式与插槽支持，能在长文本、富文本展示场景中替代常规标签并统一样式控制。</p>
<p>主要特性：</p>
<ul>
<li>支持默认插槽与多种文本截断/换行策略。</li>
<li>更友好的样式穿透能力，方便主题化。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 主题颜色文字 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"主色文字"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 拨打电话 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"phone"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"15019479320"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 日期格式化 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"date"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"1612959739"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 超链接 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"link"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"Go to uView Pro docs"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://uviewpro.cn"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 姓名脱敏 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"张三三"</span> <span class="hljs-attr">format</span>=<span class="hljs-string">"encrypt"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 显示金额 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"728732.32"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 默认插槽 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"desc"</span>&gt;</span>这是一个示例文本，支持自定义插槽与样式<span class="hljs-tag">&lt;/<span class="hljs-name">u-text</span>&gt;</span>

</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2Ftext.html" target="_blank" title="https://uviewpro.cn/zh/components/text.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/156c377563f5497d810498dc0f56abcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=sPp%2FZgGIWcZudQKQwkaFiuktCao%3D" alt="9.png" loading="lazy"/></p>
<h3 data-id="heading-4">3) u-loading-popup</h3>
<p>简介：一个可配置的加载弹窗组件，支持多种加载风格与遮罩配置，方便替代项目中散落的 loading 逻辑。</p>
<p>示例（最小用法）：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 默认纵向加载 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-loading-popup</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"正在加载..."</span> /&gt;</span>
<span class="hljs-comment">&lt;!-- 横向加载 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-loading-popup</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">direction</span>=<span class="hljs-string">"horizontal"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"正在加载..."</span> /&gt;</span>
</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2FloadingPopup.html" target="_blank" title="https://uviewpro.cn/zh/components/loadingPopup.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f95dbc95d5844e09c405e253fe68acd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=9fR81SRVtyqkfCOZQNnNi2BupG8%3D" alt="11.png" loading="lazy"/></p>
<h3 data-id="heading-5">4) u-textarea</h3>
<p>简介：独立的 <code>u-textarea</code> 组件从 <code>u-input</code> 中拆分而来，增强了字数统计、伸缩、和独立样式控制能力，满足复杂表单与长文本输入场景。</p>
<p>示例：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 字数统计 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-textarea</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:maxlength</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">count</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- 自动高度 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-textarea</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入内容"</span> <span class="hljs-attr">autoHeight</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-textarea</span>&gt;</span>
</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2Ftextarea.html" target="_blank" title="https://uviewpro.cn/zh/components/textarea.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db5f9e62248d41b2a51fcabcfe7d4f06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=aMErujAEtBuHbSjpFen6idREA6w%3D" alt="13.png" loading="lazy"/></p>
<h3 data-id="heading-6">5) u-safe-bottom 与 u-status-bar</h3>
<p>用途：与设备安全区（notch/safearea）相关的布局组件，用来保证底部/状态栏的展示在不同平台上都不会被遮挡或错位。适配了多端差异（iOS、Android、不同小程序宿主）。</p>
<p>如果有需要，您可以在任何地方引用它，它会自动判断在并且在 IPhone X 等机型的时候，给元素加上一个适当 底部内边距，在 APP 上，即使您保留了原生安全区占位(offset设置为auto)，也不会导致底部出现双倍的空白区域，也即 APP 上 offset 设置为 auto 时。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>
    ......
    <span class="hljs-tag">&lt;<span class="hljs-name">u-safe-bottom</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-safe-bottom</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2FsafeAreaInset.html" target="_blank" title="https://uviewpro.cn/zh/components/safeAreaInset.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<h3 data-id="heading-7">6) u-root-portal</h3>
<p>简介：提供将节点传送到根节点的能力（Portal 模式），适用于模态、全局浮层等需要脱离当前 dom 层级的场景，兼容多端实现细节。</p>
<p>根节点传送组件仅支持微信小程序、支付宝小程序、APP和H5平台，组件会自动根据平台选择合适的实现方式：</p>
<p>这类场景最常见的例子就是全屏的模态框。理想情况下，我们希望触发模态框的按钮和模态框本身的代码是在同一个单文件组件中，因为它们都与组件的开关状态有关。</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">u-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"show = true"</span>&gt;</span>显示弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">u-button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">u-root-portal</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"show"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>这是一个全局弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">u-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"show = false"</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">u-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">u-root-portal</span>&gt;</span>
</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2FrootPortal.html" target="_blank" title="https://uviewpro.cn/zh/components/rootPortal.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<h3 data-id="heading-8">7) 自定义主题</h3>
<p>uView Pro 目前可以自定主题色，字体颜色，边框颜色等，所有组件内部的样式，都基于同一套主题，比如您修改了primary主题色，所有用到了primary颜色 的组件都会受影响。</p>
<p>由于 uView 官方版本，组件内部存在许多硬编码颜色配置，无法动态根据 <code>scss</code> 变量，现在，我们可以统一跟随主题配置了。</p>
<p>通过官网主题颜色配置完后，在页面底部下载文件，会得到一个名为<code>uview-pro.theme.scss</code>和<code>uview-pro.theme.ts</code>的文件。</p>
<p>配置 scss 变量</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* uni.scss */</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">'uview-pro/theme.scss'</span>;
</code></pre>
<p>配置 ts 变量</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> theme <span class="hljs-keyword">from</span> <span class="hljs-string">'@/common/uview-pro.theme'</span>
<span class="hljs-keyword">import</span> uViewPro <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>)
  <span class="hljs-comment">// 引入uView Pro 主库，及theme主题</span>
  app.<span class="hljs-title function_">use</span>(uViewPro, { theme })
  <span class="hljs-keyword">return</span> {
    app
  }
}
</code></pre>
<p>以上步骤完成之后，所有颜色均跟随主题色。</p>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fguide%2Ftheme.html" target="_blank" title="https://uviewpro.cn/zh/guide/theme.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/guide/th…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79877cd89bf344c0a73b913712293892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=vaeKWdJktGPWJuVgQetQ%2BrNcwX0%3D" alt="8.png" loading="lazy"/></p>
<h3 data-id="heading-9">8) 自定义样式</h3>
<p>uView Pro 默认提供了一套美观且统一的组件样式，但在实际项目开发中，往往需要根据业务需求进行个性化定制。参考自定义主题。</p>
<p>然而，如果仅是需要覆盖组件的默认样式，或增加样式，uView Pro 则支持两种主流的自定义样式方式，灵活满足各种场景：</p>
<p>目前，所有组件均支持 <code>custom-class</code> 样式穿透和 <code>custom-style</code> 内联样式</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- custom-class 样式穿透 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">u-button</span> <span class="hljs-attr">custom-class</span>=<span class="hljs-string">"my-btn"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 自定义内联样式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">u-button</span>
        <span class="hljs-attr">custom-style</span>=<span class="hljs-string">"background: linear-gradient(90deg,#2979ff,#00c6ff);color:#fff;border-radius:8px;"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">u-button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.my-page</span> {
  :<span class="hljs-built_in">deep</span>(.my-btn) {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2979ff</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</code></pre>
<p>更多用法请参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fguide%2Fstyle.html" target="_blank" title="https://uviewpro.cn/zh/guide/style.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/guide/st…</a></p>
<h2 data-id="heading-10">三、工具链改进与新能力</h2>
<h3 data-id="heading-11">1) http 插件（httpPlugin）</h3>
<p>简介：提供统一的请求封装，支持 TypeScript、Vue3、组合式 API，插件化、全局配置、请求/响应拦截器、请求元信息类型（toast/loading 灵活控制），开箱即用，便于在项目中进行全局化网络管理。。</p>
<p>示例：基本请求</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>

<span class="hljs-comment">// GET</span>
http.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-comment">/* ... */</span>
})

<span class="hljs-comment">// POST</span>
http.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/login'</span>, { <span class="hljs-attr">username</span>: <span class="hljs-string">'xx'</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">'xx'</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-comment">/* ... */</span>
})

<span class="hljs-comment">// PUT/DELETE</span>
http.<span class="hljs-title function_">put</span>(<span class="hljs-string">'/api/user/1'</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'new'</span> })
http.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'/api/user/1'</span>)
</code></pre>
<p>高级：支持请求拦截器、全局错误处理与 meta 配置，适合接入鉴权、重试、限流等策略。</p>
<p>最佳实践：定义拦截器配置 =&gt; 注册拦截器 =&gt; 统一 API 管理</p>
<p>定义拦截器配置</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RequestConfig</span>, <span class="hljs-title class_">RequestInterceptor</span>, <span class="hljs-title class_">RequestMeta</span>, <span class="hljs-title class_">RequestOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>

<span class="hljs-comment">// 全局请求配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">httpRequestConfig</span>: <span class="hljs-title class_">RequestConfig</span> = {
  baseUrl,
  <span class="hljs-attr">header</span>: {
    <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>
  },
  <span class="hljs-attr">meta</span>: {
    <span class="hljs-attr">originalData</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">toast</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>
  }
}

<span class="hljs-comment">// 全局请求/响应拦截器</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">httpInterceptor</span>: <span class="hljs-title class_">RequestInterceptor</span> = {
  <span class="hljs-attr">request</span>: <span class="hljs-function">(<span class="hljs-params">config: RequestOptions</span>) =&gt;</span> {
    <span class="hljs-comment">// 请求拦截</span>
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-attr">response</span>: <span class="hljs-function">(<span class="hljs-params">response: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-comment">// 响应拦截</span>
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
  }
}
</code></pre>
<p>注册拦截器：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> uViewPro, { httpPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>
<span class="hljs-keyword">import</span> { httpInterceptor, httpRequestConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'http.interceptor'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>)

  <span class="hljs-comment">// 注册uView-pro</span>
  app.<span class="hljs-title function_">use</span>(uViewPro)

  <span class="hljs-comment">// 注册http插件</span>
  app.<span class="hljs-title function_">use</span>(httpPlugin, {
    <span class="hljs-attr">interceptor</span>: httpInterceptor,
    <span class="hljs-attr">requestConfig</span>: httpRequestConfig
  })

  <span class="hljs-keyword">return</span> { app }
}
</code></pre>
<p>统一 API 管理</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// api/index.ts</span>
<span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = data =&gt; http.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/login'</span>, data,  { <span class="hljs-attr">meta</span>: { <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">toast</span>: <span class="hljs-literal">true</span> } })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUser</span> = id =&gt; http.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, { id },  { <span class="hljs-attr">meta</span>: { <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> } })
</code></pre>
<p>以上示例为经典最佳实践，更多用法请查看 http 插件文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Ftools%2Fhttp.html" target="_blank" title="https://uviewpro.cn/zh/tools/http.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/tools/ht…</a></p>
<h3 data-id="heading-12">2) useCompRelation（组件关系管理 Hooks）</h3>
<p>目的：替代传统的 <code>provide/inject</code> 在多平台（尤其是一些小程序宿主）可能存在的兼容问题，提供更可靠的父子组件连接和事件广播机制。</p>
<p>应用场景：复杂表单、级联菜单、带有子项动态增删的组件集合等。</p>
<p>父组件示例（伪代码）：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useParent } <span class="hljs-keyword">from</span> <span class="hljs-string">'uview-pro'</span>;

<span class="hljs-keyword">const</span> { children, broadcast } = <span class="hljs-title function_">useParent</span>(<span class="hljs-string">'u-dropdown'</span>);

<span class="hljs-comment">// 广播调用子组件函数</span>
<span class="hljs-title function_">broadcast</span>(<span class="hljs-string">'childFunctionName'</span>, { payload });

<span class="hljs-comment">// 收集所有子组件指定值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getChildrenValues</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">values</span>: <span class="hljs-built_in">any</span>[] = [];
    children.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">child: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (child.<span class="hljs-property">getExposed</span>?.()?.<span class="hljs-property">isChecked</span>.<span class="hljs-property">value</span>) {
            values.<span class="hljs-title function_">push</span>(child.<span class="hljs-property">getExposed</span>?.()?.<span class="hljs-property">name</span>);
        }
    });
}
</code></pre>
<p>子组件示例（伪代码）：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> { parentExposed, emitToParent } = <span class="hljs-title function_">useChildren</span>(<span class="hljs-string">'u-dropdown-item'</span>, <span class="hljs-string">'u-dropdown'</span>);

<span class="hljs-comment">// 触发父组件的函数</span>
<span class="hljs-title function_">emitToParent</span>(<span class="hljs-string">'parentFunctionName'</span>);

<span class="hljs-comment">// 获取父组件的变量</span>
<span class="hljs-keyword">const</span> activeColor = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> parentExposed.<span class="hljs-property">value</span>?.<span class="hljs-property">activeColor</span>);
</code></pre>
<p>更多用法请参考组件源码：<code>useCompRelation.ts</code></p>
<h3 data-id="heading-13">3) 提供 llms.txt</h3>
<p><code>llms.txt</code>的作用是什么，一般它用来告诉大模型是否允许抓取网站数据用于训练的文件，类似于 <code>robots.txt</code> 控制爬虫权限，因此 uView Pro 也提供了即时更新的 <code>llms.txt</code> 文件，便于训练大模型，更好的为我们服务，链接如下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fllms.txt" target="_blank" title="https://uviewpro.cn/llms.txt" ref="nofollow noopener noreferrer">uviewpro.cn/llms.txt</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fllms-full.txt" target="_blank" title="https://uviewpro.cn/llms-full.txt" ref="nofollow noopener noreferrer">uviewpro.cn/llms-full.t…</a></p>
<h2 data-id="heading-14">四、多脚手架支持</h2>
<h3 data-id="heading-15">1) create-uni</h3>
<p>create-uni 提供一键生成、模板丰富的项目引导能力，旨在增强 uni-app 系列产品的开发体验，官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Funi-helper.cn%2Fcreate-uni%2Fcore" target="_blank" title="https://uni-helper.cn/create-uni/core" ref="nofollow noopener noreferrer">uni-helper.cn/create-uni/…</a></p>
<pre><code class="hljs language-bash" lang="bash">pnpm create uni &lt;项目名称&gt; --ts -m pinia -m unocss -u uview-pro -e
</code></pre>
<p>表示：</p>
<ul>
<li>启用 TypeScript</li>
<li>集成 ESLint 代码规范</li>
<li>启用 pinia</li>
<li>集成 unocss</li>
<li>选择 uview-pro组件库</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ce4788f195e4c4fbdf3124dbab6657b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=Cmqy9e0dBoCR8V04zMLwoe1KgZo%3D" alt="6.png" loading="lazy"/></p>
<p>如果你想用 create-uni 交互式创建一个项目，请执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create uni
</code></pre>
<p>进入交互式选择界面，选择 <code>uView Pro</code> 模板或组件，其他的相关插件可按需选择：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29aaed2884434a89b66340e269258e41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=EpppGdb8gRUXRwYJMDMWykJd2rQ%3D" alt="2.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f8e4453c55340b68ec2cc2e1bc65893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=u7pvqE4dHab3wMq8vSrNm7XKknY%3D" alt="image.png" loading="lazy"/></p>
<p>使用 create-uni 快速创建 <code>uView Pro Starter</code> 启动模板，请执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create uni &lt;项目名称&gt; -t uview-pro-starter
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/001fa7d3f50f4bcd9254ff81cf75a5f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=lSoKoEfEEa%2BPTl6TFrjJM6Qim0Q%3D" alt="4.png" loading="lazy"/></p>
<p>使用 create-uni 快速创建 <code>uView Pro</code> 完整组件演示模板，请执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create uni &lt;项目名称&gt; -t uview-pro-demo
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaa7060e2eec4db99d50cdac867e4f7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=3995s5r6dwZbaq3XwNAjYV0zN%2Fs%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-16">2) unibest</h3>
<p>unibest 是目前最火的 uni-app 脚手架，它是菲鸽大佬联同众多 uni-app 开发者共同贡献的 uni-app 框架，集成了最新技术栈和开发工具，官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Funibest.tech%2F" target="_blank" title="https://unibest.tech/" ref="nofollow noopener noreferrer">unibest.tech/</a></p>
<p>如果你想用 unibest 和 uView Pro 来创建项目，请执行以下命令：</p>
<p>一行代码创建项目：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create unibest &lt;项目名称&gt; -t base-uview-pro
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263db75fe3174d428697fe8b72f7663a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=KAGcC59op8kWtL0f5GwxjB6Sxu4%3D" alt="1.png" loading="lazy"/></p>
<p>交互式创建项目：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create unibest
</code></pre>
<p>选择 <code>base-uview-pro</code> 模板：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87817ca652df44f2940641f7018f1160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=AHltgzd%2Fo6VMsrfWKunzUXN0Rsw%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-17">3) 官方cli</h3>
<p>第一种：创建以 javascript 开发的工程</p>
<pre><code class="hljs language-bash" lang="bash">npx degit dcloudio/uni-preset-vue<span class="hljs-comment">#vite my-vue3-project</span>
</code></pre>
<p>第二种：创建以 typescript 开发的工程</p>
<pre><code class="hljs language-bash" lang="bash">npx degit dcloudio/uni-preset-vue<span class="hljs-comment">#vite-ts my-vue3-project</span>
</code></pre>
<p>引入uview—pro组件库即可，不再过多介绍，可参考快速配置：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn%2Fzh%2Fcomponents%2Fsetting.html" target="_blank" title="https://uviewpro.cn/zh/components/setting.html" ref="nofollow noopener noreferrer">uviewpro.cn/zh/componen…</a></p>
<h2 data-id="heading-18">五、近期修复若干关键问题</h2>
<ul>
<li>u-circle-progress 的 canvas 渲染问题已修复，解决了微信小程序 canvas 2D 在不同平台上下文差异导致的绘制异常。</li>
<li>u-form 相关多个修复：处理 model 替换导致校验失效、resetFields 修复、u-form-item 样式与光标问题修复，提升表单在小程序端兼容性。</li>
<li>picker、index-list、popup 等组件的跨端兼容修复，减少在头条/支付宝/微信等宿主上的差异表现。</li>
</ul>
<p>这些修复的综合效果是：在多端使用 uView‑Pro 构建页面时，出现的平台差异与边缘 bug 大幅减少，开发成本降低。</p>
<h2 data-id="heading-19">六、跨平台支持说明</h2>
<p>当前 uView‑Pro 已兼容并在以下平台进行适配与测试：</p>
<ul>
<li>鸿蒙（HarmonyOS）</li>
<li>Android（原生应用及 WebView）</li>
<li>iOS（原生应用及 WebView）</li>
<li>微信小程序</li>
<li>支付宝小程序</li>
<li>头条小程序</li>
</ul>
<p>后续仍然会对多端小程序兼容性的持续投入，很多修复直接针对宿主差异展开（例如 Canvas 行为、provide/inject 实现差异、样式差异等）。</p>
<p>近期在鸿蒙6.0系统上运行uView Pro源码，效果还不错，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53b3e9f1d36443d79d1bb9133458fd5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5qKm5bel5Y6C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978624&amp;x-signature=cN7M4BFbiX%2Bmgi56rMtJJKd26Yg%3D" alt="7.png" loading="lazy"/></p>
<h2 data-id="heading-20">七、未来计划</h2>
<p>根据规划，未来几个方向包括：</p>
<ul>
<li>持续优化现有组件，新增组件，提升用户体验</li>
<li>国际化（i18n）支持：统一组件的语言切换能力，方便多语言产品线接入。</li>
<li>暗黑模式（Dark Mode）：与运行时主题切换能力结合，提供暗色皮肤一键切换体验。</li>
<li>优化现有平台兼容性，扩展更多平台的适配测试（保持对小程序宿主的兼容修复）。</li>
<li>uni-app x 支持：目前还在调研中。</li>
<li>mcp 支持。</li>
</ul>
<h2 data-id="heading-21">八、结语</h2>
<p>如果你在项目中使用到以上组件或工具，并希望参与贡献，请参考仓库的贡献指南。欢迎提 issue、提交 PR，或在插件市场与社区中反馈使用体验。</p>
<ul>
<li>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanyup%2FuView-Pro" target="_blank" title="https://github.com/anyup/uView-Pro" ref="nofollow noopener noreferrer">github.com/anyup/uView…</a></li>
<li>Gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fanyup%2FuView-Pro" target="_blank" title="https://gitee.com/anyup/uView-Pro" ref="nofollow noopener noreferrer">gitee.com/anyup/uView…</a></li>
<li>快速启动仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanyup%2FuView-Pro-Starter" target="_blank" title="https://github.com/anyup/uView-Pro-Starter" ref="nofollow noopener noreferrer">github.com/anyup/uView…</a></li>
<li>插件市场（DCloud）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D24633" target="_blank" title="https://ext.dcloud.net.cn/plugin?id=24633" ref="nofollow noopener noreferrer">ext.dcloud.net.cn/plugin?id=2…</a></li>
<li>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuviewpro.cn" target="_blank" title="https://uviewpro.cn" ref="nofollow noopener noreferrer">uviewpro.cn</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分页查询的稳定性陷阱与根治方案]]></title>    <link>https://juejin.cn/post/7573524348129017919</link>    <guid>https://juejin.cn/post/7573524348129017919</guid>    <pubDate>2025-11-17T10:35:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573524348129017919" data-draft-id="7573332163387670582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分页查询的稳定性陷阱与根治方案"/> <meta itemprop="keywords" content="MySQL,Elasticsearch,后端"/> <meta itemprop="datePublished" content="2025-11-17T10:35:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="转转技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分页查询的稳定性陷阱与根治方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    转转技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:35:28.000Z" title="Mon Nov 17 2025 10:35:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在后端开发中，分页查询是最基础也最常用的功能之一。无论是运营后台各模块的列表，还是APP上商品列表、帖子列表、关注/粉丝列表等，几乎都离不开「按时间倒序+分页」的查询组合。但就是这个看似简单的需求，却因“锚点不稳定”而暗藏数据重复、丢失的陷阱，轻则影响体验，重则导致资损。本文将揭示这一问题的根本原因，对比分析三种主流解决方案的优劣，并最终给出可落地的工程规范，帮助你一劳永逸地解决分页稳定性问题。</p>
<h2 data-id="heading-0">案例</h2>
<p>首先我们基于一些案例来感受一下，什么是“分页锚点不稳定”问题。</p>
<p>**案例1：**社交场景展示的帖子列表按「最新时间排序」，当有新帖子发布时，用户在翻页过程中会发现同一条帖子重复出现在不同的页码。</p>
<p>**案例2：**运营人员正在批量发放优惠券，此时新增了一批优惠券数据。发放完成后发现，部分用户收到了多张相同的优惠券，造成资损。</p>
<p>**案例3：**某支付流水查询页面，因为排序字段不唯一，导致数据展示顺序混乱，甚至出现数据丢失，给用户带来困扰。</p>
<p>当我们使用LIMIT offset, size（MySQL）或from + size（ES）时，分页的依据是「当前查询结果集的行数偏移」。而新数据插入或旧数据的删除会直接改变结果集的行数，进而导致下一页的偏移量失效。</p>
<p><strong>案例1</strong>只是导致用户体验类的bug，而另外两个案例则影响更加严重，很容易出现资损。</p>
<h2 data-id="heading-1">分析</h2>
<p>我们从<strong>案例1</strong>入手分析。假设用户A正在浏览帖子列表，操作流程如下：</p>
<p><strong>第1步：加载第1页</strong></p>
<p>执行SQL：<code>select * from t order by create_time desc LIMIT 0,10</code></p>
<p>返回帖子 P1~P10（P1 为最新，P10 为第10新的帖子）。</p>
<p><strong>第2步：加载第2页</strong></p>
<p>此时，其他用户发布了一条新帖子 P0（时间比 P1 更新）。</p>
<p>用户A继续滑动，执行SQL：<code>select * from t order by create_time desc LIMIT 10,10</code></p>
<p>按理应该返回 P11<del>P20，但由于新插入了1条数据，整个结果集向后偏移，实际返回的是 P10</del>P19。</p>
<p><strong>结果：P10 在第1页和第2页都出现了，造成数据重复。</strong></p>
<p>更极端的情况是，如果新数据插入量大于等于页大小，用户可能会遇到「连续多页显示相同数据」，甚至「永远无法看到后续数据」的问题。</p>
<h2 data-id="heading-2">解决方案</h2>
<h3 data-id="heading-3">方案 1：「时间戳 + 唯一键」做「游标分页」</h3>
<p>这是目前最主流、最彻底的方案，核心是<strong>放弃「偏移量（offset）」，改用「上一页最后一条数据的标记」作为分页锚点</strong>，彻底摆脱结果集变化的影响。</p>
<p><strong>实现原理</strong></p>
<ol>
<li>确定「唯一排序键」：必须包含「时间字段（如create_time）+ 唯一键（如id）」，确保排序唯一（解决场景 3 的顺序混乱）。</li>
<li>分页时不传递offset，而是传递「上一页最后一条数据的create_time和id」。</li>
<li>下一页查询用「大于 / 小于」条件过滤，替代LIMIT offset, size。</li>
</ol>
<p><strong>SQL示例</strong></p>
<ul>
<li>第 1 页查询（无锚点，取最新 10 条）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, title, create_time <span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>, id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>假设第 1 页最后一条数据为create_time='2024-05-20 14:30:00'，id=100。</p>
<ul>
<li>第 2 页查询（用锚点过滤）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, title, create_time <span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&lt;=</span> <span class="hljs-string">'2024-05-20 14:30:00'</span> <span class="hljs-comment">-- 时间早于上一页最后一条</span>
<span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span> <span class="hljs-comment">-- 时间相同则id更小</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>, id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>方案优势</strong></p>
<ul>
<li>彻底解决重复/跳过：锚点是具体数据标记，不受新数据插入、旧数据删除影响。</li>
<li>性能优异：where 条件可创建联合索引(create_time, id)，避免全表扫描。</li>
<li>兼容性强：同时解决排序不唯一问题。</li>
</ul>
<p><strong>方案劣势</strong></p>
<ul>
<li>不支持直接跳页：无法像LIMIT 40,10那样直接跳转到第 5 页，仅支持上一页/下一页或滑动加载。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>所有C端滑动加载场景（帖子、商品、评论列表等）。</li>
<li>数据量较大（万级以上），需优化分页性能的场景。</li>
<li>同样适合定时任务通过此方法遍历全表刷历史数据。</li>
</ul>
<h3 data-id="heading-4">方案 2：时间戳过滤</h3>
<p>由于<strong>方案1</strong>无法支持自由分页，可通过「固定查询时间范围」减少新数据影响，核心是让每次分页查询的「时间窗口」固定，避免新数据进入结果集。</p>
<p><strong>实现原理</strong></p>
<ol>
<li>第一次查询时，记录「当前时间」作为max_create_time。</li>
<li>后续分页查询均加create_time &lt;= max_create_time条件，新插入数据不满足条件被排除；</li>
<li>用户刷新页面时，重新获取最新max_create_time，更新时间窗口。</li>
</ol>
<p><strong>SQL示例</strong></p>
<ul>
<li>第 1 页查询（记录时间窗口）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设当前时间为2024-05-20 15:00:00</span>
<span class="hljs-keyword">SELECT</span> id, title, create_time <span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&lt;=</span> <span class="hljs-string">'2024-05-20 15:00:00'</span> <span class="hljs-comment">-- 固定时间窗口</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>, id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">10</span>;
</code></pre>
<ul>
<li>第 2 页查询（沿用时间窗口）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, title, create_time <span class="hljs-keyword">FROM</span> posts
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&lt;=</span> <span class="hljs-string">'2024-05-20 15:00:00'</span> <span class="hljs-comment">-- 不更新时间</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>, id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>,<span class="hljs-number">10</span>; <span class="hljs-comment">-- 正常取第二页数据即可，区别**方案1**</span>
</code></pre>
<p><strong>方案优势</strong></p>
<ul>
<li>实现简单，成本低，只需记录首次查询时间，无需修改核心逻辑；首次查询的时间可以传给客户端，后续分页查询让客户端把首次查询的时间传给服务端即可，不需要服务器暂存此参数。</li>
<li>快速解决新数据重复：新数据被排除在时间窗口外，结果集稳定。</li>
</ul>
<p><strong>方案劣势</strong></p>
<ul>
<li>无法解决数据删除导致的跳过：若时间窗口内数据被删除，会导致部分数据被跳过。</li>
<li>数据滞后，用户滑动分页时看不到新数据，需刷新页面或者重新查询才能更新。</li>
<li>深分页性能问题，比如LIMIT 1000000, 10。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>所有C端滑动加载场景（帖子、商品、评论列表等）。</li>
<li>特别适合只增不删的场景，比如查看访客记录。</li>
<li>适合不存在深分页的业务场景，用户手动翻页一般很少翻到100页往后。</li>
</ul>
<h3 data-id="heading-5">方案 3：适用于Elasticsearch的专属优化方案</h3>
<p>上面讲到的<strong>方案1和2</strong>同样适用于Elasticsearch，参考MySQL的实现方式，可以在Elasticsearch手动实现。但<strong>方案2</strong>在深分页场景下，Elasticsearch默认限制查询结果窗口大小为10000条记录，超过该值会触发错误提示“Result window is too large”。</p>
<p>为解决此类问题，Elasticsearch 提供 “滚动查询（Scroll）” 和“Search_after”功能。</p>
<ul>
<li>
<p>Search_after：分页时需要排序，原理是从上一次的排序值开始，查询下一页数据，不需要指定偏移量from，直接取前size条即可。官方推荐使用的方式。和方案1实现原理类似。</p>
</li>
<li>
<p>Scroll：原理将排序后的文档ID形成快照，保存在内存，后续分页基于快照查询，不受数据更新影响。官方已经不推荐使用。</p>
</li>
</ul>
<p><strong>代码示例（search_after方式）</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 第1页查询</span>
<span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">"posts"</span>);
<span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">sourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();
sourceBuilder.query(QueryBuilders.matchAllQuery());
<span class="hljs-comment">// 按create_time（降序）、id（降序）排序</span>
sourceBuilder.sort(<span class="hljs-string">"create_time"</span>, SortOrder.DESC);
sourceBuilder.sort(<span class="hljs-string">"id"</span>, SortOrder.DESC);
sourceBuilder.size(<span class="hljs-number">10</span>);
request.source(sourceBuilder);
<span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);

<span class="hljs-comment">// 获取第1页最后一条数据的排序值（作为下一页的游标）</span>
<span class="hljs-type">SearchHit</span> <span class="hljs-variable">lastHit</span> <span class="hljs-operator">=</span> response.getHits().getHits()[response.getHits().getHits().length - <span class="hljs-number">1</span>];
<span class="hljs-comment">// [1716215400000（create_time的时间戳）, "100"（id）]</span>
Object[] lastSortValues = lastHit.getSortValues();

<span class="hljs-comment">// 第2页查询（用Search After）</span>
sourceBuilder.searchAfter(lastSortValues); <span class="hljs-comment">// 传入上一页的游标</span>
sourceBuilder.size(<span class="hljs-number">10</span>);
request.source(sourceBuilder);
<span class="hljs-type">SearchResponse</span> <span class="hljs-variable">page2Response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);
</code></pre>
<p><strong>方案优势</strong></p>
<ol>
<li>
<p>适合ES海量数据的获取：避免from + size在from较大时的性能问题（ES 会将前 N 条数据加载到内存）。</p>
</li>
<li>
<p>兼容性强：同时解决排序不唯一问题。</p>
</li>
</ol>
<p><strong>方案劣势</strong></p>
<ol>
<li>不支持直接跳页：无法像LIMIT 40,10那样直接跳转到第 5 页，仅支持上一页/下一页或滑动加载。</li>
</ol>
<p><strong>适用场景</strong></p>
<ol>
<li>
<p>ES 大数据量全量导出（如导出近 1 个月日志、批量导出 Excel）</p>
</li>
<li>
<p>同方案1列举的场景</p>
</li>
</ol>
<h2 data-id="heading-6">总结</h2>
<ol>
<li>问题本质：分页重复/跳过源于「锚点不稳定」（用offset易受数据增删影响）和「排序不唯一」（单一字段排序规则不固定），解法是用「数据标记锚点」（如游标）和「唯一排序组合」（如create_time + id）。</li>
<li>方案选择逻辑：按「是否需跳页→数据量→更新频率」决策，如B端需跳页且数据量小用LIMIT + 时间戳，C 端滑动加载且数据量大用游标分页，ES 批量导出用Search_after。</li>
<li>规范价值：技术方案解决单次问题，建立工程规范（需求 - 编码 - 测试 - 监控）将个人经验转化为团队标准，CR分页查询代码重点关注排序项是否唯一、是否游标分页、分页是否有防重措施等，避免重复踩坑，保障分页功能稳定，提升用户体验与业务营收。</li>
</ol>
<blockquote>
<p>关于作者，黄敬乾，侠客汇Java开发工程师。</p>
</blockquote>
<blockquote>
<p>转转研发中心及业界小伙伴们的技术学习交流平台，定期分享一线的实战经验及业界前沿的技术话题。
关注公众号「转转技术」（综合性）、「大转转FE」（专注于FE）、「转转QA」（专注于QA），更多干货实践，欢迎交流分享~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[隐式vs显式：解密C#类型转换的底层逻辑]]></title>    <link>https://juejin.cn/post/7573512056088772643</link>    <guid>https://juejin.cn/post/7573512056088772643</guid>    <pubDate>2025-11-17T10:58:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573512056088772643" data-draft-id="7572841327295512628" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="隐式vs显式：解密C#类型转换的底层逻辑"/> <meta itemprop="keywords" content="前端,C#"/> <meta itemprop="datePublished" content="2025-11-17T10:58:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            隐式vs显式：解密C#类型转换的底层逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:58:10.000Z" title="Mon Nov 17 2025 10:58:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是类型转换？</h2>
<p>类型转换是将一个数据类型的值转换为另一个数据类型的过程。例如，将一个整数 <code>int</code> 转换为一个双精度浮点数 <code>double</code>，或者将一个字符串 <code>string</code> 转换为一个整数 <code>int</code>。</p>
<h3 data-id="heading-1">1. 隐式转换 (Implicit Conversion) -- 自动完成</h3>
<p><strong>隐式转换</strong>是一种安全、自动的转换。它发生在<strong>从一个“小范围”或精度较低的类型转换为一个“大范围”或精度更高的类型时</strong>。因为这个过程不会导致数据丢失或引发异常，所以C#编译器会自动为你完成，无需任何特殊语法。</p>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 从 int 转换为 double</span>
<span class="hljs-built_in">int</span> myInt = <span class="hljs-number">100</span>;
<span class="hljs-built_in">double</span> myDouble = myInt; <span class="hljs-comment">// 隐式转换，编译器自动完成</span>

Console.WriteLine(myInt);    <span class="hljs-comment">// 输出: 100</span>
Console.WriteLine(myDouble); <span class="hljs-comment">// 输出: 100</span>

<span class="hljs-comment">// 2. 从 long 转换为 float</span>
<span class="hljs-built_in">long</span> myLong = <span class="hljs-number">123456789L</span>;
<span class="hljs-built_in">float</span> myFloat = myLong; <span class="hljs-comment">// 隐式转换</span>

Console.WriteLine(myFloat); <span class="hljs-comment">// 输出: 123456790</span>
</code></pre>
<p><strong>核心原则</strong>：隐式转换是“万无一失”的，编译器确保转换过程不会丢失数据。</p>
<h3 data-id="heading-2">2. 显式转换 -- 主动完成</h3>
<p><strong>显式转换</strong>（也称为<strong>强制类型转换</strong>）需要使用强制转换运算符 <code>(目标类型)</code> 来执行完成类型的转换。</p>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 从 double 转换为 int (小数部分会丢失)</span>
<span class="hljs-built_in">double</span> pi = <span class="hljs-number">3.14159</span>;
<span class="hljs-built_in">int</span> integerPi = (<span class="hljs-built_in">int</span>)pi; <span class="hljs-comment">// 显式转换</span>

Console.WriteLine(pi);         <span class="hljs-comment">// 输出: 3.14159</span>
Console.WriteLine(integerPi);  <span class="hljs-comment">// 输出: 3 (小数部分被截断)</span>

<span class="hljs-comment">// 2. 从 long 转换为 int (可能导致数据溢出)</span>
<span class="hljs-built_in">long</span> bigNumber = <span class="hljs-number">3000000000L</span>;
<span class="hljs-comment">// 下面的转换会导致溢出，因为 bigNumber 超出了 int 的最大值</span>
<span class="hljs-built_in">int</span> smallNumber = (<span class="hljs-built_in">int</span>)bigNumber; <span class="hljs-comment">// 在运行时会得到一个不正确的值</span>
Console.WriteLine(smallNumber); <span class="hljs-comment">//输出: -1294967296</span>
</code></pre>
<p><strong>风险警告</strong>：执行显式转换时，你必须对数据有充分的了解。如果源类型的值超出了目标类型的范围，结果将是不可预测的（对于数字类型通常是溢出后的值），这会成为程序中难以发现的Bug。</p>
<h2 data-id="heading-3">二、隐式转换 vs. 显式转换</h2>






























<table><thead><tr><th>特性</th><th>隐式转换 (Implicit)</th><th>显式转换 (Explicit / Cast)</th></tr></thead><tbody><tr><td><strong>安全性</strong></td><td>绝对安全，无数据丢失风险</td><td>有风险，可能导致数据丢失或异常</td></tr><tr><td><strong>语法</strong></td><td>无需特殊语法，自动发生</td><td>必须使用 <code>(目标类型)</code> 运算符</td></tr><tr><td><strong>编译器行为</strong></td><td>编译器自动执行</td><td>必须由开发者显式指定</td></tr><tr><td><strong>示例</strong></td><td><code>int</code> -&gt; <code>double</code></td><td><code>double</code> -&gt; <code>int</code></td></tr></tbody></table>
<h2 data-id="heading-4">三、使用辅助类进行转换</h2>
<p>除了基本的强制类型转换，.NET框架还提供了一些强大的辅助类和方法来处理更复杂的转换，尤其是与字符串之间的转换。</p>
<ul>
<li>
<p><strong><code>Convert</code> 类</strong>：一个非常实用的静态类，可以在多种基元数据类型之间进行转换。它在转换失败时会抛出异常。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> numberStr = <span class="hljs-string">"123"</span>;
<span class="hljs-built_in">int</span> convertedInt = Convert.ToInt32(numberStr);
</code></pre>
</li>
<li>
<p><strong><code>Parse()</code> 和 <code>TryParse()</code> 方法</strong>：几乎所有的数值和日期类型都提供了这两个方法。</p>
<ul>
<li><code>Parse()</code>：将字符串转换为目标类型，如果字符串格式不正确，会抛出异常。</li>
<li><code>TryParse()</code>：更安全的选择！它尝试转换字符串，如果成功，返回 <code>true</code> 并通过 <code>out</code> 参数输出结果；如果失败，返回 <code>false</code> 而不会抛出异常。这是处理用户输入等不确定数据的首选方法。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> userInput = <span class="hljs-string">"456"</span>;
<span class="hljs-built_in">int</span> result;

<span class="hljs-built_in">bool</span> isSuccess = <span class="hljs-built_in">int</span>.TryParse(userInput, <span class="hljs-keyword">out</span> result);

<span class="hljs-keyword">if</span> (isSuccess)
{
    Console.WriteLine(<span class="hljs-string">"转换成功: "</span> + result);
}
<span class="hljs-keyword">else</span>
{
    Console.WriteLine(<span class="hljs-string">"转换失败，输入的不是一个有效的整数。"</span>);
}
</code></pre>
</li>
</ul>
<h2 data-id="heading-5">结语</h2>
<p><strong>点个赞，关注我获取更多实用 C# 技术干货！如果觉得有用，记得收藏本文！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这两个开源项目在世界互联网大会乌镇峰会获奖]]></title>    <link>https://juejin.cn/post/7573225720698683444</link>    <guid>https://juejin.cn/post/7573225720698683444</guid>    <pubDate>2025-11-17T09:31:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573225720698683444" data-draft-id="7573225720698601524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这两个开源项目在世界互联网大会乌镇峰会获奖"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2025-11-17T09:31:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这两个开源项目在世界互联网大会乌镇峰会获奖
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:31:25.000Z" title="Mon Nov 17 2025 09:31:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 <strong>“直通乌镇”全球互联网大赛</strong>是世界互联网大会乌镇峰会重要活动之一，自 2019 年以来已连续举办 7 届。本届大赛以“发现未来新势力 共筑数字新生态”为主题，设置人工智能、智联出行、数智医疗、智能制造、智能终端、开源项目（分为开源模型应用赛和开源竞技挑战赛）六大赛道。</p>
<p>自 6 月启动报名以来，共吸引来自全球 29 个国家的 1082 个项目报名参赛，其中国内项目 864 个、海外项目 218 个。经过激烈角逐，共有 71 个项目入围决赛，包含海外项目 11 个。在最终的决赛中：</p>
<p><strong>Spring AI Alibaba</strong> 和 <strong>Higress</strong> 分别获得了开源先锋社区、开源优秀社区的称号，两位社区贡献者<strong>张圣航</strong>（GitHubID: shenghang）、<strong>刑国富</strong>（GitHubID: erasernoob）获得最具价值贡献者奖。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a0d99cdda84403b940981542a4684e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976685&amp;x-signature=k42zGPMQOzF%2Bo9%2Fd655anmQZiHw%3D" alt="4ba2f7045ec7bcd4b27a2f459fce62dc.jpg" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae65ec06d44c4bed9d094c5456040924~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976685&amp;x-signature=9NSelnuYW9Pt8BRpr4sf2DWmdB8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56ace434492c469d9173fe99b3ec060a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976685&amp;x-signature=9SqNB%2BTDmTqggZl3AuPTT3OkimU%3D" alt="图片" loading="lazy"/></p>
<p>感谢所有社区贡献者和开发者用户们的信任。</p>
<h3 data-id="heading-0">关于 Spring AI Alibaba</h3>
<p>Spring AI Alibaba 开源项目基于 Spring AI 构建，是阿里云通义系列模型及服务在 Java AI 应用开发领域的最佳实践，提供高层次的 AI API 抽象与云原生基础设施集成方案，帮助开发者快速构建 AI 应用。目前，Spring AI Alibaba 底层正升级到 AgentScope，未来作为 AgentScope 生态的一环，定位是做好 Spring 和 AgentScope 的连接。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3605fb5990214f5eb48c38b4d72e3ac4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976685&amp;x-signature=nNGIkNZcrDVpcbghbRRuCXlWL6I%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">关于 Higress</h3>
<p>Higress 是一款开源的 API 网关，内核基于 Istio 和 Envoy，可以用 Go/Rust/JS 等编写 Wasm 插件，提供对 K8s 集群的 Ingress 入口网关, 并且兼容了大量 K8s Nginx Ingress 的注解，可以从 K8s Nginx Ingress 快速平滑迁移到 Higress。此外，作为一款 AI 网关，提供 LLM API 和 MCP API 的统一管理。已服务于通义千问、阿里云百炼、携程、蚂蚁数科、钉钉、优酷、快手、Paypal、汤臣倍健、UU跑腿、Sealos、国泰产险等互联网、金融、IT 服务等多行业的企业客户。</p>
<p>率先在国内开源 AI 网关的通用能力，包括</p>
<ul>
<li>面向大模型：统一代理各主流大模型和自建大模型服务，提供 OpenAI 兼容的访问方式，并提供二次 API KEY 签发、限流、安全防护、观测等治理能力 。</li>
<li>面向 Agent：用户可便捷、安全地将各类智能体能力无缝集成至业务系统，实现智能对话、流程自动化等创新功能，助力企业高效构建智能化应用生态。</li>
<li>面向 MCP：支持 API-to-MCP 快速转化，并提供 MCP Server 代理、安全认证，以及统一观测、限流等治理能力。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端支持的主要数据类型及其使用方式]]></title>    <link>https://juejin.cn/post/7573519273029648430</link>    <guid>https://juejin.cn/post/7573519273029648430</guid>    <pubDate>2025-11-17T09:39:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573519273029648430" data-draft-id="7573310642960269350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端支持的主要数据类型及其使用方式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-17T09:39:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户013608756688"/> <meta itemprop="url" content="https://juejin.cn/user/1704711328379395"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端支持的主要数据类型及其使用方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1704711328379395/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户013608756688
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:39:11.000Z" title="Mon Nov 17 2025 09:39:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前端发送HTTP请求可以发送多种数据，不限于二进制。下面是支持的主要类型</h3>
<h6 data-id="heading-1">1.文本类</h6>
<ul>
<li>application/json
API交互、提交结构化数据</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> })
});
</code></pre>
<ul>
<li>text/plain
纯文本内容（如日志、简单消息）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/log'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> },
  <span class="hljs-attr">body</span>: <span class="hljs-string">'User clicked button at 10:00'</span>
});
</code></pre>
<ul>
<li>application/x-www-form-urlencoded
传统表单提交（类似form默认行为）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>();
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Alice'</span>);
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/submit'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span> },
  <span class="hljs-attr">body</span>: params
});
</code></pre>
<h6 data-id="heading-2">2.表单与文件混合Multipart</h6>
<p>multipart/form-data</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'Alice'</span>);
formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'avatar'</span>, fileInput.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 二进制文件</span>

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/upload'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: formData }); <span class="hljs-comment">// 不要手动设 Content-Type！</span>
</code></pre>
<h6 data-id="heading-3">3.二进制类Binary</h6>
<ul>
<li>原始二进制流（application/octet-stream）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">72</span>, <span class="hljs-number">101</span>, <span class="hljs-number">108</span>, <span class="hljs-number">108</span>, <span class="hljs-number">111</span>]); <span class="hljs-comment">// "Hello"</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/raw-binary'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span> },
  <span class="hljs-attr">body</span>: buffer
});
</code></pre>
<ul>
<li>动态生成的二进制数据（如 Canvas 导出图片）</li>
</ul>
<pre><code class="hljs language-js" lang="js">canvas.<span class="hljs-title function_">toBlob</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> {
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/upload-image'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: blob <span class="hljs-comment">// 自动识别为二进制</span>
  });
}, <span class="hljs-string">'image/png'</span>);
</code></pre>
<h6 data-id="heading-4">4. 其他特殊类型</h6>
<p>application/xml 或 text/xml</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">xml</span> = `&lt;user&gt;&lt;name&gt;Alice&lt;/name&gt;&lt;/user&gt;`;
<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">'/legacy-api'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/xml'</span> },
  <span class="hljs-attr">body</span>: xml
});
</code></pre>
<h6 data-id="heading-5">将二进制数据（如 Blob 或 File）转换为一个临时的、可访问的 URL</h6>
<p>核心API：URL.createObjectURL()
接收一个Blob或File对象
返回一个形如blob:<a href="https://link.juejin.cn?target=https%3A%2F%2Fxxx.com%2Fuuid" target="_blank" title="https://xxx.com/uuid" ref="nofollow noopener noreferrer">xxx.com/uuid</a> 的临时URL
该 URL 在当前文档（页面）生命周期内有效
替代方式：</p>























<table><thead><tr><th>方式</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>URL.createObjectURL()</td><td>高效、支持任意二进制、可重复使用</td><td>需手动释放内存</td><td>图片/视频预览、大文件下载</td></tr><tr><td>FileReader.readAsDataURL()</td><td>返回 base64 字符串，无需释放</td><td>内存占用高（base64 比原数据大 33%）、不适合大文件</td><td>小图标、简单文本预览</td></tr></tbody></table>
<p><strong>务必在适当时机调用 <code>URL.revokeObjectURL()</code> <strong>如果不释放，可能导致</strong>内存泄漏</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Bootstrap一天搞定响应式网站：前端小白的救命稻草]]></title>    <link>https://juejin.cn/post/7573486671296970794</link>    <guid>https://juejin.cn/post/7573486671296970794</guid>    <pubDate>2025-11-17T09:40:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573486671296970794" data-draft-id="7573300346263240758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Bootstrap一天搞定响应式网站：前端小白的救命稻草"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2025-11-17T09:40:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Bootstrap一天搞定响应式网站：前端小白的救命稻草
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:40:02.000Z" title="Mon Nov 17 2025 09:40:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否挣扎在CSS的兼容性地狱？面对不同屏幕尺寸是否感到绝望？别担心，Bootstrap就是为你而来的救星！
还记得第一次做响应式网站的痛苦吗？媒体查询写得头晕眼花，在不同设备上测试到崩溃，布局总是不听话。更可怕的是，还要处理各种浏览器的怪异行为。现在，让我带你走进Bootstrap的世界，看看它如何让你在一天内做出漂亮的响应式网站</p>
<h2 data-id="heading-0">Bootstrap框架</h2>
<p>简单来说，Bootstrap是一个强大的、<strong>移动优先</strong>的CSS/JavaScript框架。它由Twitter的设计师和开发者创建，提供了一系列预定义的CSS样式类和JavaScript插件。
你可以把它理解为一个<strong>巨大的“UI零件库”</strong> ：</p>
<ul>
<li><strong>CSS零件</strong>：提供了现成的按钮、表格、表单、导航栏等组件的样式。</li>
<li><strong>布局零件</strong>：提供了一套成熟的网格系统，让你能轻松创建响应式布局。</li>
<li><strong>JS零件</strong>：提供了一些常见的交互组件，如模态框、轮播图、下拉菜单等。
使用Bootstrap，你无需从零开始写CSS，只需要在HTML元素上添加对应的类名，就能快速应用一套成熟、美观的样式</li>
</ul>
<h2 data-id="heading-1">核心概念与语法详解</h2>
<h3 data-id="heading-2">1. 引入Bootstrap</h3>
<p>使用Bootstrap的第一步是将其CSS和JS文件引入到你的HTML项目中。最简单的方式是使用CDN（内容分发网络）</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的第一个Bootstrap页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 引入 Bootstrap CSS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, Bootstrap!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 引入 Bootstrap JS (包含 Popper) --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 布局的灵魂：网格系统</h3>
<p>Bootstrap的网格系统是其最核心的功能。它使用容器、行和列来布局和对齐内容，并且是<strong>响应式</strong>的，能自动适应不同大小的屏幕</p>
<h4 data-id="heading-4">核心概念：</h4>
<ul>
<li><code>.container</code>： 固定宽度的容器，用于包裹整个页面内容。<code>.container-fluid</code> 是100%宽度的容器。</li>
<li><code>.row</code>： 行，用于包裹一组列</li>
<li><code>.col-*</code>： 列，是内容的直接容器
Bootstrap的网格将一行分为12等份。通过指定 <code>.col-</code> 的后缀来决定一列占多少份</li>
</ul>
<h4 data-id="heading-5">代码示例：一个三栏布局</h4>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container my-5"</span>&gt;</span> <span class="hljs-comment">&lt;!-- my-5 是上下边距的工具类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 在中等屏幕及以上，每列占4份（12/4=3，即三栏） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-3 border bg-light"</span>&gt;</span> <span class="hljs-comment">&lt;!-- 内边距、边框和背景色工具类 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>左侧栏<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>一些内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-3 border bg-light"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>主内容区<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>更多内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-3 border bg-light"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>右侧栏<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>其他内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">3. 丰富的组件：按钮</h3>
<p>Bootstrap提供了多种样式和状态的按钮，只需一个类名即可搞定</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- 基础按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-secondary"</span>&gt;</span>次要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span>&gt;</span>成功按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger"</span>&gt;</span>危险按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-warning"</span>&gt;</span>警告按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-info"</span>&gt;</span>信息按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-light"</span>&gt;</span>浅色按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-dark"</span>&gt;</span>深色按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 描边按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>描边主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 不同大小的按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-lg"</span>&gt;</span>大按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-sm"</span>&gt;</span>小按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">4. 常用组件：导航栏</h3>
<p>导航栏是每个网站几乎必备的组件，Bootstrap让它变得非常简单</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-expand-lg navbar-dark bg-dark"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-bs-target</span>=<span class="hljs-string">"#navbarNav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler-icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse navbar-collapse"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"navbarNav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link active"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>联系方式<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">5. 交互组件：模态框</h3>
<p>模态框（Modal）是一个弹窗组件，无需写JavaScript即可激活</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- 触发按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"modal"</span> <span class="hljs-attr">data-bs-target</span>=<span class="hljs-string">"#exampleModal"</span>&gt;</span>
  启动演示模态框
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 模态框结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal fade"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"exampleModal"</span> <span class="hljs-attr">tabindex</span>=<span class="hljs-string">"-1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-title"</span>&gt;</span>模态框标题<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-close"</span> <span class="hljs-attr">data-bs-dismiss</span>=<span class="hljs-string">"modal"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-body"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>模态框正文内容在这里。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal-footer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-secondary"</span> <span class="hljs-attr">data-bs-dismiss</span>=<span class="hljs-string">"modal"</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>保存更改<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-9">总结</h2>
<ul>
<li>✅  <strong>移动优先原则</strong>：从小屏幕开始设计，再用断点类适配大屏</li>
<li>✅ <strong>JavaScript依赖</strong>：交互功能必须引入Bootstrap的JS文件</li>
<li>✅  <strong>避免样式冲突</strong>：不要同时使用多个UI框架，会冲突</li>
<li>✅  <strong>自定义样式</strong>：自定义CSS要在Bootstrap之后引入</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SCALE | 2025 年 10 月《大模型 SQL 能力排行榜》发布]]></title>    <link>https://juejin.cn/post/7573241978902937615</link>    <guid>https://juejin.cn/post/7573241978902937615</guid>    <pubDate>2025-11-17T09:19:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573241978902937615" data-draft-id="7573241978902904847" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SCALE | 2025 年 10 月《大模型 SQL 能力排行榜》发布"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-17T09:19:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱可生开源社区"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SCALE | 2025 年 10 月《大模型 SQL 能力排行榜》发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱可生开源社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:19:30.000Z" title="Mon Nov 17 2025 09:19:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8814d8c2444d74873065584740ab7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=yMaRzGXrN4wkF0sglROulPfbOEM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">一、本月导览与核心看点</h2>
<p>2025 年 10 月，<a href="https://link.juejin.cn?target=https%3A%2F%2Fsql-llm-leaderboard.com%2Franking%2F2025-10" title="https://sql-llm-leaderboard.com/ranking/2025-10" target="_blank" ref="nofollow noopener noreferrer">SCALE</a> 评测基准持续追踪 AI 在专业 SQL 领域的最新进展。本月，榜单迎来了蚂蚁百灵大模型团队发布的两大 万亿级 参数的模型：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FinclusionAI%2FLing-1T" target="_blank" title="https://huggingface.co/inclusionAI/Ling-1T" ref="nofollow noopener noreferrer">Ling-1T</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FinclusionAI%2FRing-1T" target="_blank" title="https://huggingface.co/inclusionAI/Ring-1T" ref="nofollow noopener noreferrer">Ring-1T</a>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66d3a7c5c08548e0a40b8987c1c2ced0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=ZTna70McYAWcGLWKD3JA%2BuI6%2FIo%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Ling-1T</strong> ：蚂蚁百灵大模型 <strong>Ling 2.0</strong> 系列的第一款旗舰模型。</li>
<li><strong>Ring-1T</strong> ：一款基于 <strong>Ling 2.0</strong> 架构的思考模型，也是全球首个开源万亿参数思考模型。</li>
</ul>
<p>本期核心看点：</p>
<ul>
<li><strong>新增模型评测</strong> ：首次引入蚂蚁 <em>Ling-1T</em> 与 <em>Ring-1T</em> 模型。评测数据显示，两款模型呈现出清晰的能力分化：
<ul>
<li>Ling-1T 在「<strong>国产数据库</strong>」转换场景中表现突出，获得满分！</li>
<li>Ring-1T 在「<strong>SQL 优化</strong> 」和「<strong>SQL 理解</strong> 」维度展现了 <strong>更为均衡和稳健的综合能力</strong>，总分均进入榜单上游。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">二、评测基准说明</h2>
<p>为保证评测结果的长期可比性和权威性，本月我们的核心评测基准与算法保持不变，继续沿用 <strong>SCALE</strong> 自创立之初便确立的三维评测体系，确保所有模型与工具在统一、标准的测试环境下进行评估，以提供公正、可复现的评测结果。</p>
<ul>
<li><strong>SQL 优化</strong>：考察模型提升查询效率与性能的意识和能力。</li>
<li><strong>方言转换</strong>：考察模型在主流数据库之间进行语法迁移的准确性。</li>
<li><strong>SQL 理解</strong>：考察模型是否能精准解析复杂的查询逻辑与用户意图的能力。</li>
</ul>
<p>本月所有新增模型均在此标准体系下进行评估。</p>
<h2 data-id="heading-2">三、焦点分析</h2>
<h3 data-id="heading-3">专题一：Ling-1T 首次评测</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3efaa8ebe0084138926236e0402bc536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=qKIgmjllhYe1ufvflmGg9htPP3k%3D" alt="发布日期：2025-10-09" loading="lazy"/></p>
<p><em>Ling-1T</em> 作为 <strong>Ling 2.0</strong> 系列的首款旗舰非思考模型，在本月首次参评。其各维度总分分别为：</p>
<ul>
<li><strong>SQL 优化</strong>：62.5</li>
<li><strong>方言转换</strong>：59.2</li>
<li><strong>SQL 理解</strong>：59.4</li>
</ul>
<p>评测结果显示，该模型能力特点鲜明，在特定场景表现优异，但在复杂任务处理上仍存在明显短板。</p>
<h4 data-id="heading-4">SQL 优化能力：62.5</h4>
<p><em>Ling-1T</em> 在 <strong>SQL 优化</strong> 维度获得 62.5 分。根据细分指标数据显示，该模型在「<strong>逻辑等价</strong>」方面表现出色，以 84.2 分位列该项第 5 名。</p>
<p>然而，其在「<strong>优化深度</strong> 」上表现不足，得分仅为 51.1 分（排名第 17），同时「<strong>语法错误检测</strong> 」得分也偏低（84.2分）（排名第 18），分析测评报告可见，模型将符合 MySQL 宽松模式的 <code>GROUP BY</code> 查询误判为有语法错误；对 <code>UNION</code> 查询中 <code>ORDER BY/LIMIT</code> 的语法规则理解不准确。</p>
<p><strong>核心缺陷</strong> ：模型缺乏对数据库特定模式（如 MySQL 的 <code>ONLY_FULL_GROUP_BY</code>）和 <strong>SQL 标准/方言差异</strong> 的上下文感知能力，过度依赖教条式语法规则，无法根据数据库配置灵活判断语法正确性，导致在边界情况下的误判。这一系列分数表明，模型具备保障逻辑一致性的能力，但在应用深度优化策略和保障语法规范性方面仍有较大提升空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb683584662e4c9599ae35e84d96795e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=xThp7ZWwdEgjhgEZ7aKYlTJJSTc%3D" alt="Ling-1T：SQL 优化维度评分" loading="lazy"/></p>
<h4 data-id="heading-5">方言转换能力：59.2</h4>
<p>此维度得分呈现出显著的能力分化（总分 59.2，排名第 17）。<strong>其最大亮点在于对国内数据库生态的适配性</strong> ，其「<strong>国产数据库</strong> 」转换子项获得 100 分满分（与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsqlshift.cn%2F" target="_blank" title="https://sqlshift.cn/" ref="nofollow noopener noreferrer">SQLShift</a> 并列），展现了其在该特定场景下的卓越能力。</p>
<p>然而，模型在处理复杂迁移任务时表现挣扎。「<strong>大 SQL 转换</strong> 」得分仅为 12.9分（排名第 20）。测评报告显示，在复杂 SQL 方言转换中，模型误用不兼容语法（如保留 <code>SET NOCOUNT ON</code>、混用 <code>DBMS_OUTPUT</code> 等），且对控制流、游标、异常处理等结构的语义理解不足，导致转换后语法不兼容或逻辑不等价，这体现出模型对复杂结构化代码的全局理解能力，以及对多方言语义差异的精确把握能力还有待提升。同时，其「<strong>逻辑等价</strong> 」（61.3分）和「<strong>语法错误检测</strong>」（69.0分）得分中等，表明其在处理非国产数据库的复杂转换时，难以保证代码的规范性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/963aca4110dc46abb4fb6e2e19838c17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=RatasSNS4bnOqOT9CjOTPLSXP3o%3D" alt="Ling-1T：方言转换维度评分" loading="lazy"/></p>
<h4 data-id="heading-6">SQL 理解能力：59.4</h4>
<p>该分数表明 <em>Ling-1T</em> 具备基础的 SQL 解析能力。数据细分显示，其在「<strong>语法错误检测</strong> 」上表现突出，以 87.1 分的成绩与 <em>Claude 3.5 Sonnet</em> 并列该指标测评的第 1 名。</p>
<p>然而，其在「<strong>执行准确性</strong> 」方面表现不佳，得分仅为 52.9 分（排名第 19），分析测评报告可见，模型在日期条件测评中易出错，如 <code>due_date &lt; '2025-06-07'</code> 的查询中返回了 <code>due_date='2025-06-10'</code> 的记录，明显违反了条件。这类错误反映了模型在执行 SQL 查询时，对日期比较的语义理解与严谨性不足。这是其主要短板之一。</p>
<p>此外，其「<strong>执行计划检测</strong> 」得分为 57.1 分，模型在执行计划预测时，对 DDL 中未定义索引的字段错误预测了 <code>key</code> 和 <code>possible_keys</code>。例如查询 <code>WHERE fruit_name = 'Banana'</code> 时，模型预测 <code>key: "fruit_name"</code> 和 <code>possible_keys: "fruit_name"</code>，但 DDL 中 <code>fruit_name</code> 字段没有索引，反映出模型过于基于查询模式推测出现误判，在约束验证能力和结构化解析与推理上仍有较大提升空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6efcfdb4fd7a44639614c794efb48388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=9yy1njgeK90rk8y2lu7z3UgRDMI%3D" alt="Ling-1T：SQL 理解维度评分" loading="lazy"/></p>
<h3 data-id="heading-7">专题二：Ring-1T 首次评测</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9567423aeb2946d3bd837a1bbd29d291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=RigLZFFnj%2Bkg%2FsgJHGStu%2BjaL0g%3D" alt="发布日期：2025-10-14" loading="lazy"/></p>
<p><em>Ring-1T</em> 作为基于 <strong>Ling 2.0</strong> 架构的万亿级参数思考模型，展现了比 <em>Ling-1T</em> 更强的综合实力。其各维度总分分别为：</p>
<ul>
<li><strong>SQL 优化</strong>：70.5</li>
<li><strong>方言转换</strong>：69.5</li>
<li><strong>SQL 理解</strong>：78.1</li>
</ul>
<p>能力表现更为均衡。</p>
<h4 data-id="heading-8">SQL 优化能力：70.5</h4>
<p>该分数体现了模型在 SQL 优化方面的均衡能力。其「<strong>语法错误检测</strong> 」获得 100 分满分（与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsqlflash.ai%2F" target="_blank" title="https://sqlflash.ai/" ref="nofollow noopener noreferrer">SQLFlash</a> 并列），保证了优化后代码的规范性与可用性。「<strong>逻辑等价</strong> 」得分为 84.2 分（排名第 6），表现优异。「<strong>优化深度</strong>」得分为 60.0 分（排名第 4），表明模型能够应用常规的优化策略，但在处理复杂的查询、进行深度重构以追求极致性能方面，仍有进步空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/697cb86af8714dea8b8e4dddbfc19731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=fCLLq%2BMSup9HjisnUkBNvs7aKIc%3D" alt="Ring-1T：SQL 优化维度评分" loading="lazy"/></p>
<h4 data-id="heading-9">方言转换能力：69.5</h4>
<p><em>Ring-1T</em> 在方言转换维度获得 69.5 分（排名第 11）。细分数据显示，其在「<strong>国产数据库</strong> 」转换（94.7分）、「<strong>语法错误检测</strong> 」（73.8 分，排名第 9）和「<strong>逻辑等价</strong>」（71.0 分）上均表现稳健。</p>
<p>其短板在于「<strong>大 SQL 转换</strong> 」，得分仅为 41.9 分（排名第 12），模型在处理跨数据库访问（如 SQL Server 的 <code>[server].database.schema.table</code>）、控制流（如 GOTO 标签跳转）、错误处理机制（如 <code>@@ERROR</code> 检查、<code>BEGIN TRY/CATCH</code>）、动态 SQL 执行（如 <code>sp_executesql</code> 参数绑定）等复杂结构时，存在语法混用、语义不等价、结构转换不完整等问题。</p>
<p><strong>核心缺陷</strong> ：缺乏对复杂结构化代码的全局理解能力，以及对多方言语义差异的精确映射能力，导致转换后的 SQL 在语法正确性或逻辑等价性上存在缺陷。相较于 <em>Ling-1T</em> 的 12.9 分，该分数有了显著提升，表明其在处理「<strong>大 SQL 转换</strong>」和保证代码规范性方面具备更强的能力，使其成为一个更可靠的数据库迁移工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5c402c3760943629df960904e7d0d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=2SQRQBIj%2BChs5qfrtFZwfigT6tA%3D" alt="Ring-1T：方言转换维度评分" loading="lazy"/></p>
<h4 data-id="heading-10">SQL 理解能力：78.1</h4>
<p>得分 78.1 分，这是一个稳健的分数。其在「<strong>执行准确性</strong> 」上表现稳定（84.3分）。但其「<strong>执行计划检测</strong> 」（60.7分）和「<strong>语法错误检测</strong>」（67.1分）得分偏低。</p>
<p>模型混淆了标准 SQL 语法与数据库特定规则，将正确的标准语法误判为错误（如 GROUP BY 中使用别名 <code>category_prefix</code>、<code>INSERT</code> 子查询 <code>INSERT INTO table (SELECT ...)</code>、<code>CREATE VIEW</code> 中使用 <code>HAVING</code> 等），同时对复杂结构理解不准确，导致误判和漏判并存，反映了模型对标准 SQL 规范的准确理解不足，以及对语法规则判断的机械性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7623046815e84be39b3335e5fc3d3dcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=Czgs3stKIqtlfrNJhmE092z%2Fs5w%3D" alt="Ring-1T：SQL 理解维度评分" loading="lazy"/></p>
<h2 data-id="heading-11">四、专家点评</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29c38e0708ba4d06bdedda92933baf75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976184&amp;x-signature=v0GMfBY8tjG9FwoA40aV43ERWBw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>林春</strong>，中国太平洋保险数智研究院首席数据库专家，OceanBase 客户专家委员会（OBCE）专家委员，获得 OBCE 认证。获得 Oracle OCM、PostgreSQL PCM、MySQL OCP 认证。墨天轮 MVP，中国数据库技术大会（DTCC）演讲嘉宾。</p>
</blockquote>
<p>SCALE 2025 年 10 月《大模型 SQL 能力排行榜》的发布，堪称 AI 与数据库协同领域的关键行业参照。其依托"<strong>SQL优化+方言兼容+SQL理解</strong> "的三维测评框架，将大模型在数据库场景的落地能力进行了体系化量化，尤其在 Ling-1T、Ring-1T 等模型的分项表现中，清晰呈现了自然语言与数据库操作的适配差异，<strong>为企业级 AI+ 数据库的技术选型提供了精准的能力标尺</strong>。</p>
<p>这个榜单通过月度迭代的动态测评范式，既强化了对大模型数据库能力演进的追踪性，又以"细分场景得分+综合能力排名"的形式，缓解了企业对大模型"泛能力强、垂直场景弱"的选型焦虑，这与当前数据库向智能化、场景化演进的趋势高度契合。<strong>它不仅为中小企业提供了低成本评估 AI 数据库工具的参照标准，更倒逼大模型行业加速垂直能力优化 ------ 在 SQL 复杂查询适配、多数据库方言兼容等领域形成技术迭代</strong>。</p>
<p>SCALE 榜单的价值在于以标准化测评姿态打通了大模型能力与数据库需求的匹配链路，推动"<strong>模型能力评估-场景技术选型-落地效果验证</strong>"全流程的理性化重构，为下一代智能数据系统的技术适配提供了极具实践意义的行业范本。</p>
<p>我们可以看到，Ring-1T 模型在数据库场景中的核心优势场景包括：</p>
<ul>
<li>
<p><strong>复杂 SQL 查询生成</strong>：在多表关联、嵌套子查询等复杂 SQL 构建任务中表现突出（SQL 优化能力得分 70.5），可高效将自然语言需求转化为高性能 SQL 语句。</p>
</li>
<li>
<p><strong>多数据库方言兼容</strong>：适配 MySQL、Oracle 等主流数据库的语法差异（方言兼容能力得分 69.5），能自动生成符合不同数据库语法规范的操作语句。</p>
</li>
<li>
<p><strong>SQL 语义理解与纠错</strong>：对模糊需求、表述不规范的查询指令，具备较强的语义解析与纠错能力（SQL 理解能力得分 78.1），降低自然语言交互的精准度门槛。</p>
</li>
<li>
<p><strong>批量数据操作适配</strong>：在批量插入、更新等数据操作场景中，可生成高效且符合数据库性能要求的 SQL 脚本，适配企业级数据批量处理需求。</p>
</li>
</ul>
<h2 data-id="heading-12">五、总结与展望</h2>
<p>随着蚂蚁百灵 <em>Ling-1T</em> 和 <em>Ring-1T</em> 两款新模型的加入，<strong>SCALE</strong> 评测榜单已累计收录超过 20 款业界主流 AI 模型及专业工具。本月评测清晰地展示了 <strong>Ling 2.0</strong> 系列两款模型的特点：</p>
<ul>
<li><strong>Ling-1T</strong> 在国产数据库适配上表现出众，但在复杂任务处理上存在短板</li>
<li><strong>Ring-1T</strong> 则展现了更均衡、更强大的综合 SQL 处理能力，特别是在 SQL 理解和优化方面表现稳健</li>
</ul>
<p>展望未来，SCALE 将继续秉持客观、严谨的原则：</p>
<ul>
<li>持续追踪：我们将继续追踪并迅速引入业界前沿的大模型和 SQL 工具。</li>
<li>深化场景：我们计划引入更多维度的企业级真实应用场景，使评测结果更贴近实际生产环境。</li>
</ul>
<blockquote>
<p>一个开放、透明的评测生态需要社区的共同建设。我们诚挚地邀请国内外更多的模型开发者、数据库工具提供商提交您的产品参与 SCALE 评测。通过在同一基准下与全球顶尖模型竞技，不仅可以精准定位产品优势与不足，更能提升品牌在开发者社区中的影响力。</p>
<p>即刻访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsql-llm-leaderboard.com%2Franking%2F2025-09" target="_blank" title="https://sql-llm-leaderboard.com/ranking/2025-09" ref="nofollow noopener noreferrer">sql-llm-leaderboard.com/ranking/202…</a></p>
<p>查看完整榜单并联系我们提交您的产品。</p>
</blockquote>
<p><strong>SCALE ------ 为专业 SQL 任务，选专业 AI 模型。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 一个小型游戏对象模型渐进式设计（一）——继承机制解读：从基础类到防止重写]]></title>    <link>https://juejin.cn/post/7573468493569622052</link>    <guid>https://juejin.cn/post/7573468493569622052</guid>    <pubDate>2025-11-17T09:41:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493569622052" data-draft-id="7553864179158614042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 一个小型游戏对象模型渐进式设计（一）——继承机制解读：从基础类到防止重写"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-17T09:41:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 一个小型游戏对象模型渐进式设计（一）——继承机制解读：从基础类到防止重写
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:41:43.000Z" title="Mon Nov 17 2025 09:41:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么必须有“继承”</h2>
<p>在真实世界里，我们习惯把事物归类：车 → 自行车 → 双人自行车。</p>
<p>Swift 的 class 类型允许我们用同样的层级方式建模，把公共的代码放在“上层”，把差异化的代码放在“下层”，这就是继承（Inheritance）。</p>
<p>它带来的三大价值：</p>
<ol>
<li>代码复用：公共逻辑写一次。</li>
<li>统一接口：上层可用“父类指针”操作一切子类。</li>
<li>多态：运行时才决定到底执行哪段代码。</li>
</ol>
<h2 data-id="heading-1">基础概念速览</h2>
<ol>
<li>基类（Base Class）：不继承任何类的类。</li>
<li>子类（Subclass）：写在冒号后面的类，它自动拥有父类所有成员。</li>
<li>重写（Override）：子类对继承来的成员重新实现，需加关键字 override。</li>
<li>super：在子类内部访问“父类实现”的前缀。</li>
<li>final：阻止后面的人再继续重写或继承。</li>
</ol>
<h2 data-id="heading-2">基类长什么样</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// 基类：最普通的“车”</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-keyword">var</span> currentSpeed <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>          <span class="hljs-comment">// 存储属性，默认 0</span>
    
    <span class="hljs-comment">/// 计算属性：只读，返回人类可读的描述</span>
    <span class="hljs-keyword">var</span> description: <span class="hljs-type">String</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"traveling at <span class="hljs-subst">\(currentSpeed)</span> mph"</span>
    }
    
    <span class="hljs-comment">/// 实例方法：基类里什么都不做，留给子类去“填坑”</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeNoise</span>() {
        <span class="hljs-comment">// 空实现</span>
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">let</span> someVehicle <span class="hljs-operator">=</span> <span class="hljs-type">Vehicle</span>()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Vehicle: <span class="hljs-subst">\(someVehicle.description)</span>"</span>)
<span class="hljs-comment">// 打印：Vehicle: traveling at 0.0 mph</span>
</code></pre>
<h2 data-id="heading-3">子类化（Subclassing）</h2>
<p>语法：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> 子类: 父类 { <span class="hljs-comment">/* 新增或覆盖 */</span> }
</code></pre>
<p>示例 1：自行车</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bicycle</span>: <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-keyword">var</span> hasBasket <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">// 新增属性</span>
}

<span class="hljs-keyword">let</span> bike <span class="hljs-operator">=</span> <span class="hljs-type">Bicycle</span>()
bike.hasBasket <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
bike.currentSpeed <span class="hljs-operator">=</span> <span class="hljs-number">15</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Bicycle: <span class="hljs-subst">\(bike.description)</span>"</span>)
<span class="hljs-comment">// 打印：Bicycle: traveling at 15.0 mph</span>
</code></pre>
<p>示例 2：双人自行车（子类还能再被继承）</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tandem</span>: <span class="hljs-title class_">Bicycle</span> {
    <span class="hljs-keyword">var</span> currentNumberOfPassengers <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
}

<span class="hljs-keyword">let</span> tandem <span class="hljs-operator">=</span> <span class="hljs-type">Tandem</span>()
tandem.hasBasket <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
tandem.currentNumberOfPassengers <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
tandem.currentSpeed <span class="hljs-operator">=</span> <span class="hljs-number">22</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Tandem: <span class="hljs-subst">\(tandem.description)</span>"</span>)
<span class="hljs-comment">// 打印：Tandem: traveling at 22.0 mph</span>
</code></pre>
<h2 data-id="heading-4">重写（Override）全规则</h2>
<ol>
<li>方法重写：必须写 override；否则编译器报错。</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Train</span>: <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeNoise</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Choo Choo"</span>)
    }
}
<span class="hljs-type">Train</span>().makeNoise()   <span class="hljs-comment">// Choo Choo</span>
</code></pre>
<ol start="2">
<li>
<p>属性重写</p>
<p>子类“看不到”父类属性到底是存储型还是计算型，只能按“名字 + 类型”去匹配。</p>
<p>a) 只读变读写：可以补充 setter。</p>
<p>b) 读写变只读：❌ 不允许。</p>
</li>
</ol>
<p>示例：给车加“档位”描述</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>: <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-keyword">var</span> gear <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> description: <span class="hljs-type">String</span> {
        <span class="hljs-comment">// 先拿父类描述，再拼接自己的</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.description <span class="hljs-operator">+</span> <span class="hljs-string">" in gear <span class="hljs-subst">\(gear)</span>"</span>
    }
}

<span class="hljs-keyword">let</span> car <span class="hljs-operator">=</span> <span class="hljs-type">Car</span>()
car.currentSpeed <span class="hljs-operator">=</span> <span class="hljs-number">25</span>
car.gear <span class="hljs-operator">=</span> <span class="hljs-number">3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Car: <span class="hljs-subst">\(car.description)</span>"</span>)
<span class="hljs-comment">// 打印：Car: traveling at 25.0 mph in gear 3</span>
</code></pre>
<ol start="3">
<li>
<p>属性观察器重写</p>
<p>可以为任何继承来的属性（无论存储/计算）添加 willSet/didSet。</p>
<p>典型场景：自动档根据速度换挡。</p>
</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AutomaticCar</span>: <span class="hljs-title class_">Car</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> currentSpeed: <span class="hljs-type">Double</span> {
        <span class="hljs-keyword">didSet</span> {
            gear <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>(currentSpeed <span class="hljs-operator">/</span> <span class="hljs-number">10</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>   <span class="hljs-comment">// 自己算档位</span>
        }
    }
}

<span class="hljs-keyword">let</span> auto <span class="hljs-operator">=</span> <span class="hljs-type">AutomaticCar</span>()
auto.currentSpeed <span class="hljs-operator">=</span> <span class="hljs-number">35</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"AutomaticCar: <span class="hljs-subst">\(auto.description)</span>"</span>)
<span class="hljs-comment">// 打印：AutomaticCar: traveling at 35.0 mph in gear 4</span>
</code></pre>
<h2 data-id="heading-5">防止继承与重写——final</h2>
<ol>
<li>防重写</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">var</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>          <span class="hljs-comment">// 子类不能 override</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">foo</span>() {}       <span class="hljs-comment">// 子类不能 override</span>
}
</code></pre>
<ol start="2">
<li>防继承</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tool</span> {}         <span class="hljs-comment">// 任何人写 class MyTool: Tool {} 都会编译失败</span>
</code></pre>
<h2 data-id="heading-6">super 的使用场景小结</h2>
<ol>
<li>在 override 方法里：<code>super.someMethod()</code></li>
<li>在 override 属性 getter/setter 里：<code>super.someProperty</code></li>
<li>在 override 下标里：<code>super[index]</code></li>
</ol>
<h2 data-id="heading-7">容易踩的坑</h2>
<ol>
<li>忘记写 override → 编译期报错。</li>
<li>重写时把只读属性改成只写 setter， Swift 不允许。</li>
<li>在 init 里访问 super 属性前，必须保证本类存储属性已初始化（初始化器规则）。</li>
<li>把 struct 拿去继承 → Swift 只有 class 支持继承，struct/enum 不行。</li>
</ol>
<h2 data-id="heading-8">继承的边界与替代方案</h2>
<p>继承是“白盒复用”，子类会依赖父类实现细节，容易造成“脆弱基类”问题。Swift 提供了更轻量的组合手段：</p>
<ol>
<li>协议（protocol）+ 默认实现 → 无需继承即可获得多态。</li>
<li>值类型（struct）+ 组合 → 把“能力”做成属性，而非父类。</li>
<li>面向协议编程（POP）→ 把“is-a”转成“can-do”，降低耦合。</li>
</ol>
<h2 data-id="heading-9">实战扩展：一个小型游戏对象模型</h2>
<p>需求：</p>
<ul>
<li>所有游戏实体都有血量 hp 与坐标 (x,y)。</li>
<li>玩家可以攻击，造成随机伤害。</li>
<li>BOSS 血量低于 20% 时进入狂暴模式，攻击力翻倍。</li>
</ul>
<p>代码：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 基类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Entity</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span>, y: <span class="hljs-type">Double</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">hp</span>: <span class="hljs-type">Double</span>, <span class="hljs-params">x</span>: <span class="hljs-type">Double</span>, <span class="hljs-params">y</span>: <span class="hljs-type">Double</span>) {
        <span class="hljs-keyword">self</span>.hp <span class="hljs-operator">=</span> hp; <span class="hljs-keyword">self</span>.x <span class="hljs-operator">=</span> x; <span class="hljs-keyword">self</span>.y <span class="hljs-operator">=</span> y
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">10.0</span>   <span class="hljs-comment">// 默认伤害</span>
    }
}

<span class="hljs-comment">// 2. 普通小怪</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Monster</span>: <span class="hljs-title class_">Entity</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-keyword">let</span> damage <span class="hljs-operator">=</span> <span class="hljs-type">Double</span>.random(in: <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">6</span>) <span class="hljs-operator">+</span> <span class="hljs-number">5</span>
        <span class="hljs-keyword">return</span> damage
    }
}

<span class="hljs-comment">// 3. BOSS</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Boss</span>: <span class="hljs-title class_">Entity</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-keyword">let</span> base <span class="hljs-operator">=</span> <span class="hljs-keyword">super</span>.attack()
        <span class="hljs-comment">// 狂暴判断</span>
        <span class="hljs-keyword">let</span> rage <span class="hljs-operator">=</span> hp <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span>   <span class="hljs-comment">// 假设 maxHp = 100</span>
        <span class="hljs-keyword">return</span> rage <span class="hljs-operator">?</span> base <span class="hljs-operator">*</span> <span class="hljs-number">2</span> : base
    }
}

<span class="hljs-comment">// 4. 使用</span>
<span class="hljs-keyword">let</span> boss <span class="hljs-operator">=</span> <span class="hljs-type">Boss</span>(hp: <span class="hljs-number">15</span>, x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"BOSS 伤害：<span class="hljs-subst">\(boss.attack())</span>"</span>)  <span class="hljs-comment">// 血量&lt;20，伤害翻倍</span>
</code></pre>
<h2 data-id="heading-10">总结与思考</h2>
<ol>
<li>继承是 Swift 面向对象体系的基石，但“能用”不等于“该用”。</li>
<li>优先把“共性”做成协议或工具函数，再考虑是否抽象出基类。</li>
<li>重写时始终加 override，既安全又自文档化。</li>
<li>用 final 明确“设计边界”，让后来者少踩坑。</li>
<li>与值类型、协议、组合搭配，才能发挥 Swift 真正的威力。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跟着AI速度cli源码三-交互问答系统]]></title>    <link>https://juejin.cn/post/7573519273029697582</link>    <guid>https://juejin.cn/post/7573519273029697582</guid>    <pubDate>2025-11-17T09:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573519273029697582" data-draft-id="7573519273029681198" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跟着AI速度cli源码三-交互问答系统"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2025-11-17T09:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘴平伊之豬"/> <meta itemprop="url" content="https://juejin.cn/user/2885545320261870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跟着AI速度cli源码三-交互问答系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2885545320261870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘴平伊之豬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:43:11.000Z" title="Mon Nov 17 2025 09:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">阶段 3: 交互式问答系统</h2>
<h3 data-id="heading-1">📌 核心知识点</h3>
<h4 data-id="heading-2">1. prompts 库简介</h4>
<p><strong>prompts</strong> 是一个轻量级、美观的命令行交互式问答库。</p>
<h5 data-id="heading-3">安装:</h5>
<pre><code class="hljs language-bash" lang="bash">pnpm add prompts
</code></pre>
<h5 data-id="heading-4">基本用法:</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'username'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入用户名:'</span>
})

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">username</span>)  <span class="hljs-comment">// 用户输入的值</span>
</code></pre>
<hr/>
<h4 data-id="heading-5">2. 问题对象 (PromptObject) 详解</h4>
<p>每个问题是一个对象，包含以下字段：</p>
<h5 data-id="heading-6">核心字段:</h5>



































<table><thead><tr><th>字段</th><th>类型</th><th>必需</th><th>说明</th></tr></thead><tbody><tr><td><code>type</code></td><td><code>string | function</code></td><td>✅</td><td>问题类型或动态判断函数</td></tr><tr><td><code>name</code></td><td><code>string</code></td><td>✅</td><td>答案的字段名</td></tr><tr><td><code>message</code></td><td><code>string | function</code></td><td>✅</td><td>问题文本或动态生成函数</td></tr><tr><td><code>initial</code></td><td><code>any</code></td><td>❌</td><td>默认值</td></tr></tbody></table>
<h5 data-id="heading-7">常用字段:</h5>









































<table><thead><tr><th>字段</th><th>类型</th><th>说明</th><th>适用类型</th></tr></thead><tbody><tr><td><code>choices</code></td><td><code>Array</code></td><td>选项列表</td><td><code>select</code>, <code>multiselect</code></td></tr><tr><td><code>active</code></td><td><code>string</code></td><td>"是"选项文本</td><td><code>toggle</code></td></tr><tr><td><code>inactive</code></td><td><code>string</code></td><td>"否"选项文本</td><td><code>toggle</code></td></tr><tr><td><code>hint</code></td><td><code>string</code></td><td>提示信息</td><td>所有类型</td></tr><tr><td><code>validate</code></td><td><code>function</code></td><td>验证函数</td><td>所有类型</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-8">3. 问题类型 (type) 详解</h4>
<h5 data-id="heading-9">3.1 text - 文本输入</h5>
<p><strong>用途:</strong> 获取用户输入的字符串</p>
<p><strong>示例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'projectName'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目名称:'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-string">'my-app'</span>
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs language-perl" lang="perl">? 请输入项目名称: › <span class="hljs-keyword">my</span>-app
</code></pre>
<p><strong>使用场景:</strong> 项目名、用户名、邮箱等</p>
<hr/>
<h5 data-id="heading-10">3.2 number - 数字输入</h5>
<p><strong>用途:</strong> 获取数字</p>
<p><strong>示例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'port'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入端口号:'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-number">3000</span>
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">?</span> <span class="hljs-string">请输入端口号:</span> <span class="hljs-string">›</span> <span class="hljs-number">3000</span>
</code></pre>
<hr/>
<h5 data-id="heading-11">3.3 toggle - 开关/确认</h5>
<p><strong>用途:</strong> 是/否选择</p>
<p><strong>示例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'toggle'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'shouldOverwrite'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'目标文件非空，是否覆盖？'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">active</span>: <span class="hljs-string">'是'</span>,
  <span class="hljs-attr">inactive</span>: <span class="hljs-string">'否'</span>
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs">? 目标文件非空，是否覆盖？ › 否 / 是
</code></pre>
<p><strong>使用场景:</strong> 确认操作、开关设置</p>
<hr/>
<h5 data-id="heading-12">3.4 select - 单选列表</h5>
<p><strong>用途:</strong> 从列表中选择一项</p>
<p><strong>示例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'templateType'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'请选择模板:'</span>,
  <span class="hljs-attr">choices</span>: [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'base(推荐)'</span>, <span class="hljs-attr">value</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'base'</span> } },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'demo(演示)'</span>, <span class="hljs-attr">value</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'demo'</span> } }
  ],
  <span class="hljs-attr">initial</span>: <span class="hljs-number">0</span>
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs language-css" lang="css">? 请选择模板: › - Use arrow-keys. Return to submit.
❯ <span class="hljs-built_in">base</span>(推荐)
  <span class="hljs-built_in">demo</span>(演示)
</code></pre>
<p><strong>使用场景:</strong> 模板选择、框架选择</p>
<hr/>
<h5 data-id="heading-13">3.5 multiselect - 多选列表</h5>
<p><strong>用途:</strong> 从列表中选择多项</p>
<p><strong>示例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'multiselect'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'features'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'选择需要的功能:'</span>,
  <span class="hljs-attr">choices</span>: [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'TypeScript'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'ts'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'ESLint'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'eslint'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'Prettier'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'prettier'</span> }
  ]
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs">? 选择需要的功能: (空格选择，回车确认)
❯ ◉ TypeScript
  ◯ ESLint
  ◉ Prettier
</code></pre>
<hr/>
<h4 data-id="heading-14">4. 动态问题 - type 和 message 可以是函数</h4>
<p>这是 prompts 最强大的特性之一！</p>
<h5 data-id="heading-15">4.1 动态 type - 条件显示问题</h5>
<p><strong>用途:</strong> 根据前一个答案决定是否显示当前问题</p>
<p><strong>语法:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> {
  <span class="hljs-comment">// prevValue 是上一个问题的答案</span>
  <span class="hljs-keyword">return</span> 条件 ? <span class="hljs-string">'问题类型'</span> : <span class="hljs-literal">null</span>  <span class="hljs-comment">// null 表示跳过</span>
}
</code></pre>
<p><strong>create-unibest 实际案例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 文件覆盖问题 - 只在目录非空时显示</span>
{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'shouldOverwrite'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> {
    <span class="hljs-comment">// prevValue 是上一个问题的答案 (projectName)</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">canSkipEmptying</span>(prevValue) ? <span class="hljs-literal">null</span> : <span class="hljs-string">'toggle'</span>
  },
  <span class="hljs-attr">message</span>: <span class="hljs-string">'目标文件非空，是否覆盖？'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">active</span>: <span class="hljs-string">'是'</span>,
  <span class="hljs-attr">inactive</span>: <span class="hljs-string">'否'</span>
}
</code></pre>
<p><strong>执行流程:</strong></p>
<pre><code class="hljs language-bash" lang="bash">用户输入项目名: <span class="hljs-string">"my-app"</span>
       ↓
<span class="hljs-built_in">type</span> 函数被调用: <span class="hljs-built_in">type</span>(<span class="hljs-string">"my-app"</span>)
       ↓
检查: canSkipEmptying(<span class="hljs-string">"my-app"</span>)
       ├─ <span class="hljs-literal">true</span>  → 返回 null → 跳过这个问题
       └─ <span class="hljs-literal">false</span> → 返回 <span class="hljs-string">'toggle'</span> → 显示问题
</code></pre>
<hr/>
<h5 data-id="heading-16">4.2 动态 message - 根据上下文生成问题文本</h5>
<p><strong>用途:</strong> 根据前面的答案动态生成问题内容</p>
<p><strong>语法:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">message</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`根据 <span class="hljs-subst">${prevValue}</span> 生成的问题文本`</span>
}
</code></pre>
<p><strong>create-unibest 实际案例:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'shouldOverwrite'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> <span class="hljs-title function_">canSkipEmptying</span>(prevValue) ? <span class="hljs-literal">null</span> : <span class="hljs-string">'toggle'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> {
    <span class="hljs-comment">// prevValue 是项目名</span>
    <span class="hljs-keyword">const</span> dirForPrompt = prevValue === <span class="hljs-string">'.'</span>
      ? <span class="hljs-string">'当前文件'</span>
      : <span class="hljs-string">`目标文件"<span class="hljs-subst">${prevValue}</span>"`</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${dirForPrompt}</span>非空，是否覆盖？`</span>
  },
  <span class="hljs-attr">initial</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">active</span>: <span class="hljs-string">'是'</span>,
  <span class="hljs-attr">inactive</span>: <span class="hljs-string">'否'</span>
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 如果项目名是 "my-app"</span>
? 目标文件<span class="hljs-string">"my-app"</span>非空，是否覆盖？ › 否 / 是

<span class="hljs-comment">// 如果项目名是 "."</span>
? 当前文件非空，是否覆盖？ › 否 / 是
</code></pre>
<hr/>
<h4 data-id="heading-17">5. 验证器 (overwriteChecker) 模式</h4>
<p><strong>问题:</strong> 用户选择"否"时如何中断流程？</p>
<p><strong>解决方案:</strong> 使用隐藏的验证器问题</p>
<p><strong>代码:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'overwriteChecker'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prevValues</span>) =&gt;</span> {
    <span class="hljs-comment">// prevValues 是上一个问题的答案</span>
    <span class="hljs-keyword">if</span> (prevValues === <span class="hljs-literal">false</span>) {
      <span class="hljs-comment">// 用户选择了"否"，抛出错误中断</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'操作已取消'</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>  <span class="hljs-comment">// 返回 null 不显示问题</span>
  }
}
</code></pre>
<p><strong>工作原理:</strong></p>
<pre><code class="hljs language-bash" lang="bash">用户选择: 是否覆盖？
       ├─ 选择<span class="hljs-string">"是"</span> (<span class="hljs-literal">true</span>)
       │     ↓
       │  <span class="hljs-built_in">type</span>(<span class="hljs-literal">true</span>) → null → 跳过验证器 → 继续下一个问题
       │
       └─ 选择<span class="hljs-string">"否"</span> (<span class="hljs-literal">false</span>)
             ↓
          <span class="hljs-built_in">type</span>(<span class="hljs-literal">false</span>) → 抛出错误 → 整个流程中断
</code></pre>
<hr/>
<h4 data-id="heading-18">6. create-unibest 问答系统架构</h4>
<h5 data-id="heading-19">文件结构:</h5>
<pre><code class="hljs language-bash" lang="bash">src/question/
├── index.ts           <span class="hljs-comment"># 主入口，组合所有问题</span>
├── name.ts            <span class="hljs-comment"># 项目名问题</span>
├── file.ts            <span class="hljs-comment"># 文件覆盖问题</span>
└── template/
    ├── index.ts       <span class="hljs-comment"># 模板选择问题</span>
    └── templateDate.ts <span class="hljs-comment"># 模板数据</span>
</code></pre>
<hr/>
<h5 data-id="heading-20">6.1 主入口 (src/question/index.ts)</h5>
<p><strong>代码:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> { bold, red } <span class="hljs-keyword">from</span> <span class="hljs-string">'kolorist'</span>
<span class="hljs-keyword">import</span> figures <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts/lib/util/figures.js'</span>
<span class="hljs-keyword">import</span> projectName <span class="hljs-keyword">from</span> <span class="hljs-string">'./name'</span>
<span class="hljs-keyword">import</span> template <span class="hljs-keyword">from</span> <span class="hljs-string">'./template'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">question</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 组合所有问题</span>
  <span class="hljs-keyword">const</span> questions = [
    ...<span class="hljs-title function_">projectName</span>(),  <span class="hljs-comment">// 项目名 + 文件覆盖</span>
    <span class="hljs-title function_">template</span>(),        <span class="hljs-comment">// 模板选择</span>
  ]

  <span class="hljs-comment">// 取消处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onCancel</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(figures.cross)}</span> <span class="hljs-subst">${bold(<span class="hljs-string">'操作已取消'</span>)}</span>`</span>)
  }

  <span class="hljs-comment">// 执行问答</span>
  <span class="hljs-keyword">const</span> answers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>(questions, { onCancel })

  <span class="hljs-keyword">return</span> answers
}
</code></pre>
<p><strong>关键点:</strong></p>
<ol>
<li>使用展开运算符 <code>...</code> 组合问题数组</li>
<li><code>onCancel</code> 处理用户按 Ctrl+C 的情况</li>
<li><code>await</code> 等待用户输入完成</li>
<li>返回答案对象</li>
</ol>
<hr/>
<h5 data-id="heading-21">6.2 项目名问题 (src/question/name.ts)</h5>
<p><strong>代码:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PromptObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> filePrompt <span class="hljs-keyword">from</span> <span class="hljs-string">'./file'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (): <span class="hljs-title class_">PromptObject</span>&lt;<span class="hljs-built_in">string</span>&gt;[] =&gt; {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'projectName'</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目名称:'</span>,
      <span class="hljs-attr">initial</span>: <span class="hljs-string">'unibest'</span>,
    },
    ...<span class="hljs-title function_">filePrompt</span>(),  <span class="hljs-comment">// 嵌入文件覆盖问题</span>
  ]
}
</code></pre>
<p><strong>特点:</strong></p>
<ul>
<li>返回问题<strong>数组</strong>（不是单个问题）</li>
<li>包含项目名问题 + 文件覆盖问题</li>
<li>使用 <code>...filePrompt()</code> 展开</li>
</ul>
<hr/>
<h5 data-id="heading-22">6.3 文件覆盖问题 (src/question/file.ts)</h5>
<p><strong>完整代码分析:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PromptObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> { bold, red } <span class="hljs-keyword">from</span> <span class="hljs-string">'kolorist'</span>
<span class="hljs-keyword">import</span> figures <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts/lib/util/figures.js'</span>
<span class="hljs-keyword">import</span> { canSkipEmptying } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (targetDir?: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">PromptObject</span>&lt;<span class="hljs-built_in">string</span>&gt;[] =&gt; {
  <span class="hljs-keyword">return</span> [
    <span class="hljs-comment">// 问题 1: 覆盖确认</span>
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'shouldOverwrite'</span>,

      <span class="hljs-comment">// 🎯 动态 type: 根据目录状态决定是否显示</span>
      <span class="hljs-attr">type</span>: <span class="hljs-function"><span class="hljs-params">prevValue</span> =&gt;</span> (
        <span class="hljs-title function_">canSkipEmptying</span>(targetDir ?? prevValue)
          ? <span class="hljs-literal">null</span>        <span class="hljs-comment">// 目录空/不存在 → 跳过</span>
          : <span class="hljs-string">'toggle'</span>    <span class="hljs-comment">// 目录非空 → 显示 toggle</span>
      ),

      <span class="hljs-comment">// 🎯 动态 message: 根据目录名生成问题文本</span>
      <span class="hljs-attr">message</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> _targetDir = targetDir ?? prevValue
        <span class="hljs-keyword">const</span> dirForPrompt = _targetDir === <span class="hljs-string">'.'</span>
          ? <span class="hljs-string">'当前文件'</span>
          : <span class="hljs-string">`目标文件"<span class="hljs-subst">${_targetDir}</span>"`</span>

        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${dirForPrompt}</span>非空，是否覆盖？`</span>
      },

      <span class="hljs-attr">initial</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">active</span>: <span class="hljs-string">'是'</span>,
      <span class="hljs-attr">inactive</span>: <span class="hljs-string">'否'</span>,
    },

    <span class="hljs-comment">// 问题 2: 验证器（隐藏）</span>
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'overwriteChecker'</span>,

      <span class="hljs-comment">// 🎯 如果用户选择"否"，抛出错误</span>
      <span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prevValues</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (prevValues === <span class="hljs-literal">false</span>)
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(figures.cross)}</span> <span class="hljs-subst">${bold(<span class="hljs-string">'操作已取消'</span>)}</span>`</span>)

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>  <span class="hljs-comment">// 不显示这个问题</span>
      },
    },
  ]
}
</code></pre>
<p><strong>执行流程:</strong></p>
<pre><code class="hljs language-bash" lang="bash">场景 1: 目录不存在
  projectName = <span class="hljs-string">"new-app"</span>
       ↓
  canSkipEmptying(<span class="hljs-string">"new-app"</span>) = <span class="hljs-literal">true</span>
       ↓
  <span class="hljs-built_in">type</span>(prevValue) 返回 null
       ↓
  跳过 shouldOverwrite 问题
       ↓
  跳过 overwriteChecker 问题
       ↓
  继续模板选择

场景 2: 目录存在且非空，用户选择<span class="hljs-string">"是"</span>
  projectName = <span class="hljs-string">"existing-app"</span>
       ↓
  canSkipEmptying(<span class="hljs-string">"existing-app"</span>) = <span class="hljs-literal">false</span>
       ↓
  <span class="hljs-built_in">type</span>(prevValue) 返回 <span class="hljs-string">'toggle'</span>
       ↓
  显示: ? 目标文件<span class="hljs-string">"existing-app"</span>非空，是否覆盖？
       ↓
  用户选择: 是 (<span class="hljs-literal">true</span>)
       ↓
  overwriteChecker: <span class="hljs-built_in">type</span>(<span class="hljs-literal">true</span>) 返回 null
       ↓
  继续模板选择

场景 3: 目录存在且非空，用户选择<span class="hljs-string">"否"</span>
  projectName = <span class="hljs-string">"existing-app"</span>
       ↓
  显示: ? 目标文件<span class="hljs-string">"existing-app"</span>非空，是否覆盖？
       ↓
  用户选择: 否 (<span class="hljs-literal">false</span>)
       ↓
  overwriteChecker: <span class="hljs-built_in">type</span>(<span class="hljs-literal">false</span>) 抛出错误
       ↓
  整个流程中断，程序退出
</code></pre>
<hr/>
<h5 data-id="heading-23">6.4 模板选择问题 (src/question/template/index.ts)</h5>
<p><strong>代码:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PromptObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> { templateList } <span class="hljs-keyword">from</span> <span class="hljs-string">'./templateDate'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (): <span class="hljs-title class_">PromptObject</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'templateType'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'请选择 uni-app 模板？'</span>,
    <span class="hljs-attr">hint</span>: <span class="hljs-string">'使用方向键选择，回车确认'</span>,
    <span class="hljs-attr">choices</span>: [
      ...templateList,  <span class="hljs-comment">// 从配置文件导入</span>
    ],
    <span class="hljs-attr">initial</span>: <span class="hljs-number">0</span>,  <span class="hljs-comment">// 默认选中第一个</span>
  }
}
</code></pre>
<p><strong>templateList 数据结构:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/question/template/templateDate.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">templateList</span>: <span class="hljs-title class_">TemplateList</span>[] = [
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">`base<span class="hljs-subst">${green(<span class="hljs-string">'(推荐)'</span>)}</span>`</span>,        <span class="hljs-comment">// 显示文本</span>
    <span class="hljs-attr">description</span>: <span class="hljs-string">`<span class="hljs-subst">${red(<span class="hljs-string">'(多TAB base项目)'</span>)}</span>`</span>,  <span class="hljs-comment">// 描述</span>
    <span class="hljs-attr">value</span>: {                                <span class="hljs-comment">// 返回值</span>
      <span class="hljs-attr">type</span>: <span class="hljs-string">'base'</span>,
      <span class="hljs-attr">branch</span>: <span class="hljs-string">'base'</span>,
      <span class="hljs-attr">url</span>: {
        <span class="hljs-attr">gitee</span>: <span class="hljs-string">'https://gitee.com/codercup/unibest.git'</span>,
        <span class="hljs-attr">github</span>: <span class="hljs-string">'https://github.com/codercup/unibest.git'</span>,
      },
    },
  },
  <span class="hljs-comment">// ... 更多模板</span>
]
</code></pre>
<p><strong>显示效果:</strong></p>
<pre><code class="hljs language-scss" lang="scss">? 请选择 uni-app 模板？ › - 使用方向键选择，回车确认
❯ <span class="hljs-built_in">base</span>(推荐) - (多TAB base项目)
  <span class="hljs-built_in">demo</span>(演示项目) - (多TAB演示项目)
  <span class="hljs-built_in">i18n</span>(多语言) - (多TAB多语言项目)
</code></pre>
<hr/>
<h4 data-id="heading-24">7. 取消处理 (onCancel)</h4>
<p><strong>用途:</strong> 处理用户按 Ctrl+C 或 Esc 的情况</p>
<p><strong>语法:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCancel</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 处理取消逻辑</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'操作已取消'</span>)  <span class="hljs-comment">// 抛出错误</span>
  <span class="hljs-comment">// 或</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">// 返回 true 继续，false 抛出默认错误</span>
}

<span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>(questions, { onCancel })
</code></pre>
<p><strong>create-unibest 的实现:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">onCancel</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(figures.cross)}</span> <span class="hljs-subst">${bold(<span class="hljs-string">'操作已取消'</span>)}</span>`</span>)
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> answers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>(questions, { onCancel })
} <span class="hljs-keyword">catch</span> (cancelled) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cancelled.<span class="hljs-property">message</span>)
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
}
</code></pre>
<p><strong>效果:</strong></p>
<pre><code class="hljs">? 请输入项目名称: › ^C
✖ 操作已取消
</code></pre>
<hr/>
<h4 data-id="heading-25">8. 问答结果对象</h4>
<p><strong>输入示例:</strong></p>
<pre><code class="hljs language-bash" lang="bash">pnpm create unibest
</code></pre>
<p><strong>用户交互:</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">? 请输入项目名称: › my-app
? 目标文件<span class="hljs-string">"my-app"</span>非空，是否覆盖？ › 是
? 请选择 uni-app 模板？ › <span class="hljs-keyword">base</span>(推荐)
</code></pre>
<p><strong>返回的 answers 对象:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">projectName</span>: <span class="hljs-string">'my-app'</span>,
  <span class="hljs-attr">shouldOverwrite</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">templateType</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'base'</span>,
    <span class="hljs-attr">branch</span>: <span class="hljs-string">'base'</span>,
    <span class="hljs-attr">url</span>: {
      <span class="hljs-attr">gitee</span>: <span class="hljs-string">'https://gitee.com/codercup/unibest.git'</span>,
      <span class="hljs-attr">github</span>: <span class="hljs-string">'https://github.com/codercup/unibest.git'</span>
    }
  }
}
</code></pre>
<p><strong>注意:</strong></p>
<ul>
<li><code>overwriteChecker</code> 不在结果中（它的 type 返回 null）</li>
<li>跳过的问题也不在结果中</li>
</ul>
<hr/>
<h4 data-id="heading-26">9. 完整执行流程</h4>
<pre><code class="hljs language-ini" lang="ini">用户执行: pnpm create unibest
       ↓
   printBanner()
       ↓
   解析参数: <span class="hljs-attr">projectName</span> = undefined
       ↓
   走路径 A: 完全交互式
       ↓
   调用 question() 函数
       ↓
┌─────────────────────────────────┐
│  问题 1: 请输入项目名称          │
│  用户输入: "my-app"              │
│  <span class="hljs-attr">answers.projectName</span> = <span class="hljs-string">"my-app"</span> │
└─────────────────────────────────┘
       ↓
   检查目录: canSkipEmptying("my-app")
       ├─ true  → 跳过问题 2
       └─ false → 显示问题 2
       ↓
┌─────────────────────────────────┐
│  问题 2: 是否覆盖？              │
│  用户选择: 是                    │
│  <span class="hljs-attr">answers.shouldOverwrite</span> = <span class="hljs-literal">true</span> │
└─────────────────────────────────┘
       ↓
   验证器检查: <span class="hljs-attr">shouldOverwrite</span> === <span class="hljs-literal">true</span>
       ↓ 通过
┌─────────────────────────────────┐
│  问题 3: 选择模板                │
│  用户选择: base                  │
│  <span class="hljs-attr">answers.templateType</span> = {...}   │
└─────────────────────────────────┘
       ↓
   返回 answers 对象
       ↓
   开始下载模板...
</code></pre>
<hr/>
<h3 data-id="heading-27">💡 设计思路总结</h3>
<h4 data-id="heading-28">1. 智能动态问题</h4>
<p><strong>问题:</strong> 不是所有情况都需要询问</p>
<p><strong>解决方案:</strong></p>
<ul>
<li>使用函数式 <code>type</code></li>
<li>根据上下文动态决定是否显示</li>
</ul>
<p><strong>好处:</strong></p>
<ul>
<li>减少不必要的问题</li>
<li>提升用户体验</li>
<li>逻辑清晰</li>
</ul>
<hr/>
<h4 data-id="heading-29">2. 链式验证模式</h4>
<p><strong>问题:</strong> 用户选择"否"时如何优雅退出？</p>
<p><strong>解决方案:</strong></p>
<ul>
<li>添加隐藏的验证器问题</li>
<li><code>type</code> 返回 <code>null</code> 不显示</li>
<li>在验证器中抛出错误</li>
</ul>
<p><strong>好处:</strong></p>
<ul>
<li>即时反馈</li>
<li>流程清晰</li>
<li>避免无效操作</li>
</ul>
<hr/>
<h4 data-id="heading-30">3. 问题模块化</h4>
<p><strong>架构:</strong></p>
<pre><code class="hljs language-bash" lang="bash">question/
├── index.ts     <span class="hljs-comment"># 组合器</span>
├── name.ts      <span class="hljs-comment"># 项目名模块</span>
├── file.ts      <span class="hljs-comment"># 文件覆盖模块</span>
└── template/    <span class="hljs-comment"># 模板选择模块</span>
</code></pre>
<p><strong>好处:</strong></p>
<ul>
<li>职责分离</li>
<li>易于维护</li>
<li>可复用</li>
</ul>
<hr/>
<h4 data-id="heading-31">4. 用户友好</h4>
<p><strong>细节:</strong></p>
<ol>
<li>提供默认值 (<code>initial: 'unibest'</code>)</li>
<li>提供提示 (<code>hint: '使用方向键选择，回车确认'</code>)</li>
<li>彩色高亮 (<code>green('(推荐)')</code>)</li>
<li>清晰的描述 (<code>description: '(多TAB base项目)'</code>)</li>
</ol>
<hr/>
<h3 data-id="heading-32">🔧 prompts API 速查表</h3>
<h4 data-id="heading-33">问题类型</h4>













































<table><thead><tr><th>类型</th><th>用途</th><th>返回值类型</th></tr></thead><tbody><tr><td><code>text</code></td><td>文本输入</td><td><code>string</code></td></tr><tr><td><code>number</code></td><td>数字输入</td><td><code>number</code></td></tr><tr><td><code>confirm</code></td><td>是/否</td><td><code>boolean</code></td></tr><tr><td><code>toggle</code></td><td>开关</td><td><code>boolean</code></td></tr><tr><td><code>select</code></td><td>单选</td><td><code>any</code></td></tr><tr><td><code>multiselect</code></td><td>多选</td><td><code>any[]</code></td></tr><tr><td><code>autocomplete</code></td><td>自动完成</td><td><code>any</code></td></tr></tbody></table>
<h4 data-id="heading-34">常用字段</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span> | <span class="hljs-string">'number'</span> | <span class="hljs-string">'select'</span> | ...,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'fieldName'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-string">'问题文本'</span>,
  <span class="hljs-attr">initial</span>: 默认值,
  <span class="hljs-attr">choices</span>: [{ title, value }],  <span class="hljs-comment">// select/multiselect</span>
  <span class="hljs-attr">active</span>: <span class="hljs-string">'是'</span>,                 <span class="hljs-comment">// toggle</span>
  <span class="hljs-attr">inactive</span>: <span class="hljs-string">'否'</span>,               <span class="hljs-comment">// toggle</span>
  <span class="hljs-attr">hint</span>: <span class="hljs-string">'提示信息'</span>,
  <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">format</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> newValue,
  <span class="hljs-attr">onState</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> { ... }
}
</code></pre>
<h4 data-id="heading-35">动态字段</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 动态 type</span>
<span class="hljs-attr">type</span>: <span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> 条件 ? <span class="hljs-string">'类型'</span> : <span class="hljs-literal">null</span>

<span class="hljs-comment">// 动态 message</span>
<span class="hljs-attr">message</span>: <span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> <span class="hljs-string">`根据 <span class="hljs-subst">${prev}</span> 生成的消息`</span>

<span class="hljs-comment">// 验证</span>
<span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> || <span class="hljs-string">'不能为空'</span>
</code></pre>
<hr/>
<h3 data-id="heading-36">📚 延伸阅读</h3>
<h4 data-id="heading-37">prompts 官方文档</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fterkelg%2Fprompts" target="_blank" title="https://github.com/terkelg/prompts" ref="nofollow noopener noreferrer">GitHub: terkelg/prompts</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fprompts" target="_blank" title="https://www.npmjs.com/package/prompts" ref="nofollow noopener noreferrer">npm: prompts</a></li>
</ul>
<h4 data-id="heading-38">其他交互式库</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js" target="_blank" title="https://github.com/SBoudrias/Inquirer.js" ref="nofollow noopener noreferrer">inquirer</a> - 功能最全</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fenquirer%2Fenquirer" target="_blank" title="https://github.com/enquirer/enquirer" ref="nofollow noopener noreferrer">enquirer</a> - 性能更好</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnatemoo-re%2Fclack" target="_blank" title="https://github.com/natemoo-re/clack" ref="nofollow noopener noreferrer">clack</a> - 现代化设计</li>
</ul>
<hr/>
<h3 data-id="heading-39">✅ 阶段 3 总结</h3>
<h4 data-id="heading-40">你学到了:</h4>
<ol>
<li>✅ <strong>prompts 基本用法</strong> - 各种问题类型</li>
<li>✅ <strong>动态问题机制</strong> - type 和 message 函数</li>
<li>✅ <strong>验证器模式</strong> - 隐藏问题实现流程控制</li>
<li>✅ <strong>取消处理</strong> - onCancel 回调</li>
<li>✅ <strong>模块化架构</strong> - 问题组织和复用</li>
<li>✅ <strong>用户体验优化</strong> - 默认值、提示、彩色输出</li>
</ol>
<h4 data-id="heading-41">关键要点:</h4>





























<table><thead><tr><th>概念</th><th>作用</th></tr></thead><tbody><tr><td><code>type</code> 函数</td><td>动态决定是否显示问题</td></tr><tr><td><code>message</code> 函数</td><td>根据上下文生成问题文本</td></tr><tr><td>验证器模式</td><td>隐藏问题 + 错误抛出 = 流程控制</td></tr><tr><td><code>onCancel</code></td><td>处理用户取消操作</td></tr><tr><td>展开运算符</td><td>组合问题数组</td></tr></tbody></table>
<hr/>
<p><strong>准备好进入阶段 4 了吗?</strong> 🚀</p>
<p>下一阶段将学习 <strong>文件系统操作</strong>，揭秘目录遍历、清空、创建的实现！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[云栖实录 | 洋钱罐基于 EMR Serverless 产品构建全球一体化数字金融平台]]></title>    <link>https://juejin.cn/post/7573225720698634292</link>    <guid>https://juejin.cn/post/7573225720698634292</guid>    <pubDate>2025-11-17T09:28:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573225720698634292" data-draft-id="7573170756869963828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="云栖实录 | 洋钱罐基于 EMR Serverless 产品构建全球一体化数字金融平台"/> <meta itemprop="keywords" content="大数据,运维"/> <meta itemprop="datePublished" content="2025-11-17T09:28:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            云栖实录 | 洋钱罐基于 EMR Serverless 产品构建全球一体化数字金融平台
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:28:47.000Z" title="Mon Nov 17 2025 09:28:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>演讲人：宋晓峰 洋钱罐大数据运维总监</p>
<h2 data-id="heading-0">十年破壁：从数据筑基到智能生态的全链路实践</h2>
<h3 data-id="heading-1">一、数据筑基——自建大数据集群的攻坚与突破</h3>
<h4 data-id="heading-2">背景介绍</h4>
<p>瓴岳科技（Fintopia）是以大数据和人工智能为基础的数字科技集团，为全球用户提供卓越的金融体验。2015年成立至今，瓴岳科技始终聚焦消费金融，业务遍布中国大陆、东南亚、拉丁美洲和非洲等；集团旗下拥有洋钱罐、Easycash等知名品牌，截至2025年，服务全球金融机构超过114家，全球注册用户超过1.81亿，全球累计交易额超过5400亿元。在公司发展的过程中，我们大数据部门为智能风控、精准营销、产品创新三大核心业务提供数据支撑，整合多源数据，利用机器学习算法实时识别欺诈风险，构建全流程风控体系，基于用户行为、偏好等数据，定制个性化金融服务推荐，通过分析市场趋势与用户需求数据，为产品开发提供精准方向，助力瓴岳科技全球化业务布局。</p>
<h4 data-id="heading-3">大数据技术栈迭代与升级路径</h4>
<p>过去十年，洋钱罐的大数据技术栈经历了多次迭代。</p>
<p>2018年，面对数据孤岛问题及传统MySQL数据库无法有效支持复杂分析任务的挑战，我们自建了首个基于十多个节点的Hadoop大数据集群。当时用户规模约2000万，每日新增数据量约300GB。</p>
<p>随着业务需求的增长，特别是在2018年至2021年间，原有的MapReduce 框架因处理延迟较高而难以满足日益增长的数据处理时效性要求。因此，在2021年，我们将离线数据处理引擎由MapReduce迁移至Apache spark 2.x，并同步升级了Hive版本至3.x以提升数据仓库性能。彼时，系统每天运行约3,000个批处理作业。</p>
<p>为进一步提高数据处理效率并响应业务对数据实时性的更高期待，2022年我们引入了数据湖技术Apache Hudi，从而将原本的日全量数据抽取转变为增量更新模式，显著提升了数据的新鲜度至小时级别。</p>
<p>此外，为了更好地支持交互式查询场景，在2023年我们采用StarRocks作为新的Ad-hoc查询引擎，取代了之前依赖于Spark Thrift Server实现的方法。截至目前，Ad-hoc 日均SQL查询请求量超过8,000，P95响应时间控制在60秒以内。鉴于全球化布局带来的弹性资源、业务稳定性和成本优化要求，我们在2024年对整个集群架构进行了重大升级，将自建集群迁移至阿里云EMR Serverless平台，Yarn 节点规模超过一千台，在此过程中，我们也将spark 2.x升级到了spark 3.x。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c31852e3ea4464aa09bfdc7dfd58762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=qYSkdAVS2PxytKnIY6k0YTh0wHU%3D" alt="image.png" loading="lazy"/></p>
<p>当前，我们集群的整体存储能力已经达到单副本10PB的规模，每日新增数据量约为30TB。核心业务报表数量超过3000份，而调度工作流数量已突破15000个。在StarRocks集群方面，我们同时采用了存算一体化架构与存算分离架构，并根据不同的业务线进行了划分，因此目前拥有超过30个独立的StarRocks集群实例。左侧展示的是我们的调度能力和 Ad-hoc 查询能力，YARN日执行job量超过4万。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b47dbd019f244532afd73dc2aa66ed97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=DnM1yX68XRimFB%2FZHRKknZqYMZU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">从稳定性到效率：自建集群的困境解析</h4>
<p>在自建大数据集群的过程中，我们遇到了诸多挑战，主要集中在稳定性、弹性资源管理和运维效率三个方面。</p>
<p>首先，在稳定性方面，我们面临的主要问题是业务SLA破线。这种情况往往源于底层 NodeManager 因网络带宽限制或shuffle 量大而导致任务失败率上升。此外，在使用开源组件过程中，也存在一些 bug 或者性能问题，比如我们在使用 Hive3.x 开源版本时，在高并发的场景下会出现进程卡死等问题，从而影响业务稳定性，无法满足生产环境的要求。</p>
<p>其次，在弹性资源管理上，自建集群缺乏快速扩展的能力以应对突发流量需求。例如，在凌晨遇到紧急情况时，希望迅速增加计算资源来解决问题变得不可行。同时，即使进行了物理服务器的扩容，在YARN的容量调度策略下，也难以有效平衡不同队列之间的负载分布，导致部分队列利用率过高而其他队列则相对空闲，整体上降低了集群资源利用效率。</p>
<p>最后，关于运维效率的问题，大数据集群的维护工作相当复杂且耗时。从硬件采购到最终完成配置并投入使用，整个过程通常需要两至三天时间。此外，开发人员还需投入大量精力进行性能调优、故障排除及日常巡检等任务，这不仅增加了人力成本，也影响了团队的工作效率。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96e9adefcc4f4fa1a05b3e76414a7515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=rJo5sSwg7lSkFb6L5O5lWGPq3e0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">Spark 引擎核心痛点解析</h4>
<p>在使用Apache Spark引擎的过程中，我们遇到了几个核心痛点，这些问题主要集中在资源管理、性能与稳定性、版本升级以及成本控制等方面。</p>
<p>首先，在资源管理方面，我们面临的主要问题之一是峰值资源的优化。例如，在凌晨执行大规模任务时，该任务可能会占用队列中90%以上的资源，而其他较小的任务虽然只占用了剩余10%左右的资源，但其完成时间却可能更长。这表明了当前资源分配机制存在不合理之处，需要更加精细地调整以提高整体效率。另一个问题是谷值期间资源利用率低下。特别是在非高峰时段（如午夜过后），集群的整体资源利用率往往只能达到30%左右，导致大量计算能力被闲置。</p>
<p>其次，在性能与稳定性方面也存在问题。当我们使用自建的大数据集群部署Spark时，采用的是开源版的Shuffle Service作为NodeManager组件。然而，在高负载情况下，这种服务的表现并不理想，容易成为瓶颈，并且当单个NodeManager出现问题时，会严重影响到整个集群上运行任务的稳定性和性能。</p>
<p>第三点关于引擎版本固化的问题也非常突出。比如将 spark 2.x迁移到spark 3.x，不仅耗时较长，还需要充分考虑新旧版本之间的兼容性问题、系统稳定性测试以及对现有业务流程的影响评估等多方面因素。</p>
<p>最后，在成本控制方面同样存在着挑战。由于不同业务线之间可能存在交叉需求，比如风控场景下的离线数据仓库处理与Adhoc查询同时进行，这就使得很难按照单一业务维度来精确划分和管理相关费用。因此，如何有效地衡量并优化跨部门使用的Spark资源成本，成为了我们需要解决的重要课题之一。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6df1cb7bd8714549bce9acaeec6d887d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=xw%2FfTO72PB9Qd18F9DEJN%2Fanu3s%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">StarRocks 问题解析</h4>
<p>在使用 StarRocks 的过程中，我们也遇到了一些挑战，主要集中在数据导入、资源隔离及系统稳定性三个方面。</p>
<p>首先，在数据导入方面，StreamLoad 导入速度慢，支持的数据量有限，当提高数据导入频率时，可能会触发 FE 内存问题，会出现MVC相关报错。Broker Load 虽然导入速度快，但是软性资源隔离策略会影响读性能，最后我们还是要依赖Spark集群的Spark Load解决大数据量导入问题</p>
<p>其次，关于资源隔离的问题，虽然开源版StarRocks提供了基本的资源隔离功能，但它是软隔离，而非硬性隔离，数据导入与查询操作之间存在竞争关系，尤其是大规模查询请求可能会影响其他小型查询请求的响应时间。</p>
<p>最后，在系统运维与稳定性保障方面，开源版本没有自带的管控页面，运维人员不得不自行开发一系列脚本来完成扩缩容等请求，增加了运维难度。此外，在面对版本升级时，升级耗时长，还需额外进行业务回归测试以验证新版本兼容性和系统稳定性。</p>
<p>以上因素共同构成了 StarRocks 在实际应用中面临的主要技术挑战。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e064f5667264f1888c0017cfb57e663~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=ftYYZj96%2FkBfX2KPL4J34VsJUaU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">二、云帆起航——迁移阿里云 EMR 的全链路实践</h3>
<p>面对上述挑战，我们对大数据架构进行了全面升级，全面切换至阿里云生态组件。此次升级的核心在于构建了一个符合数据湖理念的全新平台架构，该架构不仅满足了当前业务需求，还为公司未来向数据湖方向的发展奠定了坚实基础。此次升级主要对两个计算引擎进行了重大改造。</p>
<p>首先，我们将Hive SQL完全迁移至Spark SQL。因为相较于Hive SQL，Spark SQL展现出更优的执行效率，这也是业界共识。整体迁移过程非常丝滑，在性能与兼容性方面，EMR Serverless Spark 表现亮眼，还支持丰富的开源生态，如Kyuubi、Livy等。</p>
<p>其次，我们将 StarRocks 存算一体版本切换为了存算分离版本，这也顺应了Serverless 架构的发展趋势。</p>
<p>基于计算引擎升级，我们在上层构建了自己的数据应用产品，如一站式开发平台、标签系统、实时开发平台、数据质量监控系统、Ad-hoc查询等。</p>
<p>我们还将底层存储从传统HDFS切换为阿里云OSS-HDFS，消除了原生Hadoop文件系统中存在的单点故障问题。相比自建集群成本，新架构成本仅为其十分之一左右。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d07a12ef8c5484d905dcf5ebb4c3e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=mNn5KoNKm%2F1hMpOna0EDmjXZMfA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">EMR Serverless Spark：一站式数据平台服务</h4>
<p>EMR Serverless Spark 提供了一站式的数据平台服务，包括任务开发、调试、调度和运维等，极大地简化了数据处理和模型训练的全流程。内置 SQLEditor、Notebook 开发环境，提供版本管理，工作流调度，以及运维诊断能力。 版本管理功能使得用户能轻松切换Spark版本，只需确保SQL语句能正常运行，数据能正常处理即可，无需考虑底层基础设施的复杂性。</p>
<p>针对Spark和Python环境，用户可以根据具体业务需求进行配置，如调整spark-defaults.conf文件中的参数值，来优化特定应用场景下的性能表现。通过简单的spark-submit命令配合相关参数，即可快速切换到所需的运行时环境，极大提高了工作效率。</p>
<p>监控与诊断方面，EMR Serverless Spark 还提供完善的监控与诊断功能。提供工作空间、队列以及任务等各种维度的资源指标统计，方便用户更清晰地掌握作业运行情况。在Spark任务完成之后，收集和分析该任务的各种资源消耗指标，并根据这些指标给出合理的优化建议。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bf4f6f41ba44bbd9b0aa082222655af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=V1%2BIbY2chWtg13Z7S6wbAmz9aPM%3D" alt="image.png" loading="lazy"/></p>
<p>EMR Serverless Spark 还提供极致资源弹性与性能。首先，在弹性伸缩方面，支持 Driver/Executor级别进程弹性，最低支持一核力度，容器拉起时间在20秒以内。资源供给方面，底层是 Iaas + 神龙资源池，提供海量供给，自迁移至 EMR Serverless Spark 以来，我们尚未遇到任何资源短缺问题。</p>
<p>此外，EMR Serverless Spark 采用类似于YARN的资源管理模式。Workspace/队列两层Quota管理支持用户根据业务特性选择合适的提交路径。平台提供了基于Workspace/队列/作业的多维度、精确到天/时/分的多周期资源观测能力。</p>
<p>性能方面，EMR Serverless Spark 自研 Fusion 引擎，内置高性能向量化计算和 RSS 能力，相比开源版本性能大幅提升。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a033b89182684ba0a2af37f0e739febb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=%2F8adrdU9TbXKVQnKDE%2F42tibRWA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">EMR Serverless StarRocks：功能丰富、性能卓越</h4>
<p>EMR Serverless StarRocks在管控能力方面显著优于自建方案，提供实例管理功能，包括创建，扩容缩容，升降配，网络管理，白名单管理，操作任务管理，网关管理等。</p>
<p>此外，其管控平台提供实例健康报告与慢SQL诊断分析、可视化缓存管理、支持大/小版本主动触发滚动升级、支持全链路实例操作审计等功能。</p>
<p>值得一提的是，EMR Serverless StarRocks 实现了真正的存算分离架构，提供物理隔离能力，不同计算组作业负载相互独立，支持多计算组独立配置。在我们的实际应用场景下，存算分离内表查询较开源性能提升约100%，数据湖查询较开源性能提升约50%。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f9ad3949fa24f8ca3f9312946be352f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=H2iQM%2FgQs%2F4hAaepOOkZxoRJD%2BI%3D" alt="image.png" loading="lazy"/></p>
<p>下图展示了基于EMR Serverless StarRocks 的湖仓新范式，StarRocks 作为统一 Lakehouse，基于湖表进行自助分析查询。数据写入 StarRocks 提供极速分析；数据写入开放数据湖，使用 StarRocks 直接分析数据湖；在DWD、DWS以及ADS层，通过构建物化视图并实施分层建模策略，不仅能够有效支撑各类报表需求，同时也为OLAP提供了强有力的支持。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f085f8a2d1614425bed1799900655653~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=5NqCSqrodpXqKKUfa%2BO3yMP3MMk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">架构升级带来的关键价值</h4>
<p>上述重大架构升级，带来了哪些关键价值呢？</p>
<p>首先，在成本优化方面，通过引入弹性资源，显著提高了资源利用率。</p>
<p>其次，从业务稳定性角度来看，EMR Serverless Spark 自带的高性能 Shuffle 服务，极大地增强了系统的稳定性和可靠性。此外，StarRocks 的性能优化也进一步提升了整体业务处理能力与响应速度。</p>
<p>关于业务敏捷性，新架构支持快速部署新业务场景所需的计算资源，从而大幅缩短了业务上线周期。</p>
<p>运维效率方面，得益于 EMR Serverless Spark与 EMR Serverless StarRocks 丰富的管控能力，开发团队所需投入的日常维护工作量显著减少。同时，平台提供了全天候的技术支持服务，确保即使面对突发问题也能迅速获得解决方案，进一步保障了系统的连续可用性。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/779a7ef5859c41949dea78aa1aeaaef8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=bZAx%2FzRro6Bg7hmMIiuMqBfwOh4%3D" alt="image.png" loading="lazy"/></p>
<p>具体而言，在保持业务规模不变的前提下，与传统的自建方案相比，基于 EMR Serverless 构建的解决方案能够实现约25.4%的成本节约。基于 EMR Serverless StarRocks 进行查询（如标签系统和用户圈选场景），SQL 查询执行时长缩短了30%。此外，在相同成本情况下，EMR Serverless Spark 作业的执行时间也缩短了30%以上。最值得注意的是运维效率方面的改进，实现了近40%的大幅提升。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c191d6612a470da1b7cce37a023b55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=LAbmV7V01vC8hhXJp3cG8kvg3o8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">三、智创未来——未来基于阿里云的智能生态布局</h3>
<p>在完成架构升级后，整体稳定性得到显著提升。展望未来，我们的目标是构建一个更加智能化的金融生态环境。为此，我们设想了四个主要发展方向：</p>
<p>首先，在数据处理方面，我们计划基于阿里云EMR及机器学习平台PAI来实现高效的数据协同架构。</p>
<p>其次，在业务流程优化上，通过整合阿里云的大规模模型能力，旨在创建一个既简化又高效的运营环境，涵盖预测式风控、自动化运营，大智能化监控等领域。</p>
<p>再者，在应用层面，致力于形成以数据为驱动并支持智能决策的完整业务闭环。</p>
<p>最后，在算法创新方面，我们将依托于阿里云机器学习平台PAI，专注于开发适用于特定行业的专属AI模型库。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe167d183244fb6b99a0455ab2a284e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976526&amp;x-signature=xCPV1rLa5BLIz6dPZNo39JLBm0c%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AiOnly大模型深度测评：调用GPT-5 API+RAG知识库，快速构建智能客服机器人]]></title>    <link>https://juejin.cn/post/7573486671296856106</link>    <guid>https://juejin.cn/post/7573486671296856106</guid>    <pubDate>2025-11-17T09:26:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573486671296856106" data-draft-id="7573336057481281542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AiOnly大模型深度测评：调用GPT-5 API+RAG知识库，快速构建智能客服机器人"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-11-17T09:26:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AiOnly大模型深度测评：调用GPT-5 API+RAG知识库，快速构建智能客服机器人
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:26:07.000Z" title="Mon Nov 17 2025 09:26:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>AI 技术加速渗透各行各业的今天，你是否也面临这样的困境：想调用 GPT-5、Claude4.5等顶尖模型却被海外注册、跨平台适配搞得焦头烂额？想快速搭建智能客服、内容生成工具，却因模型接口差异、成本不可控而望而却步？或是作为中小团队，既想享受 AI 红利，又受限于技术门槛和预算压力？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aiionly.com%2Flogin%3FinviteCode%3D0047994" target="_blank" title="https://www.aiionly.com/login?inviteCode=0047994" ref="nofollow noopener noreferrer">AiOnly平台</a>的出现，正是为了打破这些壁垒。</p>
<p>本文将从实战角度出发，带你全方位解锁这个「全球顶尖大模型 MaaS 平台」：从 5 分钟完成注册到 API 密钥创建，从单模型调用到融合 RAG 知识库的智能体开发，然后手把手教你在 Windows 环境部署一个日均成本不足 0.5 元的电商客服机器人。无论你是 AI 开发者、企业运营者，还是想低成本尝试 AI 应用的新手，都能在这里找到从「想法」到「落地」的完整路径 —— 无需纠结底层技术，专注用 AI 解决实际问题。</p>
<h3 data-id="heading-1">第一部分：平台概览</h3>
<h4 data-id="heading-2">1.1 平台定位与核心价值</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aiionly.com%2Flogin%3FinviteCode%3D0047994" target="_blank" title="https://www.aiionly.com/login?inviteCode=0047994" ref="nofollow noopener noreferrer">AiOnly</a> 是<strong>全球顶尖大模型 MaaS（模型即服务）平台</strong>，核心定位是 “降低模型应用门槛，加速场景智能化进程”，通过 “一键调用、敏捷开发” 的核心设计，将全球前沿模型（如 GPT-5、Claude 4.5）整合为标准化 API 接口与模块化 “智能积木”，让开发者无需关注底层技术细节，即可快速集成 AI 能力。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed90c65253ab42e3b746e7fc7a56dafb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=QK9%2BXlWYUNwuI5lAqvxTKgbid9Q%3D" alt="image.png" loading="lazy"/></p>
<p>其核心优势可概括为四点：</p>
<ul>
<li><strong>高效便捷</strong>：免海外模型开户、免跨平台注册，高速专线支持，开箱即用（如调用 GPT-5 无需 OpenAI 账号）；</li>
<li><strong>价格友好</strong>：按量计费（Token / 次数），价格低于官方刊例价，支持 “先用后付” 与 “优惠量包”，新人首充 1 元可享 100 元权益；</li>
<li><strong>类型全面</strong>：覆盖文本、图像、视频、语音、多模态全场景模型，海外（GPT/Claude/Gemini）与国产（DeepSeek/Qwen/Doubao）模型兼备；</li>
<li><strong>稳定流畅</strong>：官方正规授权，API 接口标准化兼容原厂全参数，SLA 达 99.9%，保障生产环境稳定运行。</li>
</ul>
<h4 data-id="heading-3">1.2 平台特色功能亮点</h4>
<ol>
<li>
<p><strong>统一 API 与密钥管理</strong>：一个 API Key 可调用多模型，支持 “标准模式”（基础 API）与 “融合模式”（关联组件 / 知识库），分应用创建密钥便于权限管控；</p>
</li>
<li>
<p><strong>增强开发工具</strong>：</p>
<ul>
<li><strong>Prompt 优解</strong>：自动优化提示词结构，提升模型推理准确率；</li>
<li><strong>RAG 知识库管理</strong>：多源数据（文档 / 表格）智能清洗 + 向量检索，实现精准问答；</li>
<li><strong>组件商店</strong>：三方集成 Claude Code、Dify（智能体平台）、WPS AI 等三方工具，无需额外开发；</li>
</ul>
</li>
<li>
<p><strong>精细化运营工具</strong>：实时调用统计（Token 消耗监控）、开通管理（量包使用状态）、财务计费（账单明细），降低企业成本管控难度；</p>
</li>
</ol>
<h3 data-id="heading-4">第二部分：AiOnly 平台使用详解</h3>
<h4 data-id="heading-5">2.1 平台注册与 API Key 创建（完整操作步骤）</h4>
<h5 data-id="heading-6">步骤 1：注册与登录（5 分钟完成）</h5>
<ol>
<li>访问官方平台：PC 端打开 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aiionly.com%2Flogin%3FinviteCode%3D0047994" target="_blank" title="https://www.aiionly.com/login?inviteCode=0047994" ref="nofollow noopener noreferrer">AiOnly官网</a></strong></li>
<li>点击右上角「登录 / 注册」，新用户<strong>必须选择 “手机号验证码登录”</strong>（首次注册需完成手机号验证），支持支付宝 / 微信快捷登录（老用户）；</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3beae11c805049ddaaae5bedb56643b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=793clJPonIImi8awruuEwRrMw9E%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>登录后点击顶部「控制台」，进入核心操作页面（模型开通、Key 管理、财务等功能聚合于此）；
<ul>
<li>注意：新用户登录后自动发放 15 元代金券，金币与 RMB 1:1 等值，可直接抵扣模型调用费用。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d316e2de04bd48008841777a72522bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=ZFO%2FoNnm9hpKEldSf2xpud2zJng%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ol>
<h5 data-id="heading-7">步骤 2：模型服务开通（以 GPT-5 为例）</h5>
<ol>
<li>
<p>进入模型广场：控制台左侧导航栏点击「模型广场」，或首页直接选择 “热门模型”→“GPT-5”；
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f31f6ee57aa844a5b1c2f5d5dc6cdf47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=SQlmR7XC3jaB8x6oMzCOl2pWYAY%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>选择开通方式（二选一）：</p>
<ul>
<li><strong>先用后付</strong>：按实际 Token 消耗计费</li>
<li><strong>优惠量包</strong>：点击 “优惠量包” 切换页面，选择对应套餐</li>
</ul>
</li>
</ol>
<p>这里我们先选择先用后付进行测试
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb90003ecb24232a9efe332c99afb02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=emagHTkKvCopT8b5MM8nAf9ycu0%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>支付订单：
<ul>
<li>支持 “金币余额支付”（控制台「财务」→「余额充值」可补充金币）或 “现金支付”（微信 / 支付宝）；</li>
<li>勾选《AiOnly 服务订购协议》，点击「确认支付」；</li>
</ul>
</li>
<li>验证开通状态：支付成功后，进入控制台「开通管理」，若模型 “服务状态” 显示 “运行中”，即表示可正常调用。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76911c37d31642ea9fb6cd5b7a7c947c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=Nn4tq%2FhghZ6Wwq4xNM1fXCEdw1c%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h5 data-id="heading-8">步骤 3：API Key 创建与 API URL 获取（核心凭证）</h5>
<ol>
<li>
<p><strong>API Key 创建（务必保密）</strong>：</p>
<ul>
<li>
<p>控制台左侧点击「API Key」→「新增 API Key」；
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72b4abebf404466987fc0267cb2bce3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=qLXCzwmPLMwZfZvE6wpdqQ3QP8c%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>填写基础信息：</p>
<ul>
<li>类型：「标准模式」（仅调用基础模型 API）</li>
<li>名称：自定义别名（如 “GPT-5 客服项目 Key”）；</li>
<li>描述：可选，记录用途（如 “生产环境 - 电商客服机器人”）；</li>
</ul>
</li>
<li>
<p>点击「保存」，生成专属 API Key（长期生效，<strong>切勿公开分享</strong>，避免未授权调用导致经济损失）；
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d92628aa2cf440119807ca00a6dee42b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=%2FLLqYyQFOdYWMbUzNqSJUNhlntU%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
</li>
<li>
<p><strong>API URL 获取（按功能区分）</strong>：</p>
<ul>
<li>
<p>方式 1：「开通管理」页面右上角点击 “接口 URL 地址”，获取当前模型的专属接口；
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb7b646760f4f10965546a15904a982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=pj130XbZYl6nT0qjM9XW%2F1DTzMI%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>方式 2：参考官方标准化接口（常用地址如下）：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/863d39fa8d3f4794b59ee8c0d36f7429~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=ktjBK%2BILDT5NzdaUIUF1PgkbOYg%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-9">2.2 API 密钥管理与安全注意事项</h4>
<ul>
<li><strong>分场景隔离</strong>：为测试环境、生产环境创建独立 API Key（如 “GPT-5 - 测试 Key”“GPT-5 - 生产 Key”），避免测试误操作影响生产；</li>
<li><strong>安全防护</strong>：
<ul>
<li>不硬编码 API Key（通过环境变量或配置文件加载）；</li>
<li>不存储于公开代码仓库（如 GitHub）；</li>
<li>不通过邮件、即时通讯工具随意发送；</li>
</ul>
</li>
<li><strong>异常监控</strong>：通过「调用统计」实时查看 Key 的 Token 消耗，若发现异常波动（如突然激增），立即进入「API Key」页面点击 “停用”；</li>
<li><strong>权限最小化</strong>：非必要不使用 “融合模式” Key，避免权限过度开放导致风险。</li>
</ul>
<h4 data-id="heading-10">2.3 API 调用流程（Python 实战示例）</h4>
<p>以 “调用 GPT-5 实现文本对话” 为例，完整流程如下：</p>
<h5 data-id="heading-11">前提条件</h5>
<ul>
<li>已开通 GPT-5 模型服务（「开通管理」中状态为 “运行中”）；</li>
<li>已获取 API Key 与文本对话接口 URL；</li>
<li>本地环境：Python 3.7+（或其他支持 HTTP 请求的语言）。</li>
</ul>
<h5 data-id="heading-12">步骤 1：环境准备</h5>
<ol>
<li>
<p>安装依赖库（使用<code>requests</code>发送 HTTP 请求）：</p>
<pre><code class="hljs language-bash" lang="bash">pip install requests python-dotenv
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f508771bc3514b5e88ed50e56d0f7574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=YaZs2xGlPfcXfCbhrqSENw4EpJE%3D" alt="a9bf9279c154ddb390d03b738cb78eec.png" loading="lazy"/></p>
</li>
<li>
<p>创建<code>.env</code>配置文件（避免硬编码 Key）：</p>
<pre><code class="hljs language-env" lang="env">AIONLY_API_KEY=your_api_key_here  # 替换为你的API Key
AIONLY_CHAT_URL=https://api.aiionly.com/v1/chat/completions
</code></pre>
</li>
</ol>
<h5 data-id="heading-13">步骤 2：编写调用代码</h5>
<p>运行</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-comment"># 1. 加载配置</span>
load_dotenv()
API_KEY = os.getenv(<span class="hljs-string">"AIONLY_API_KEY"</span>)
API_URL = os.getenv(<span class="hljs-string">"AIONLY_CHAT_URL"</span>)
HEADERS = {
    <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{API_KEY}</span>"</span>,  <span class="hljs-comment"># 固定格式：Bearer + 空格 + API Key</span>
    <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
}

<span class="hljs-comment"># 2. 构造请求参数（Prompt设计）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">build_chat_payload</span>(<span class="hljs-params">user_message, system_prompt=<span class="hljs-string">"你是专业的AI助手，回答简洁准确"</span></span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-5"</span>,  <span class="hljs-comment"># 必须与开通的模型名称一致</span>
        <span class="hljs-string">"messages"</span>: [
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: system_prompt},  <span class="hljs-comment"># 系统指令（定义角色）</span>
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_message}       <span class="hljs-comment"># 用户输入</span>
        ],
        <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>,  <span class="hljs-comment"># 随机性：0（严谨）~1（创意）</span>
        <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">512</span>    <span class="hljs-comment"># 最大输出Token数（避免超长回复）</span>
    }

<span class="hljs-comment"># 3. 发送请求并解析结果</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_aionly_chat</span>(<span class="hljs-params">user_message</span>):
    payload = build_chat_payload(user_message)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 发送POST请求</span>
        response = requests.post(API_URL, headers=HEADERS, json=payload)
        response.raise_for_status()  <span class="hljs-comment"># 捕获HTTP错误（如401密钥无效、403权限不足）</span>
        
        <span class="hljs-comment"># 解析响应</span>
        result = response.json()
        reply = result[<span class="hljs-string">"choices"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>]  <span class="hljs-comment"># 机器人回复</span>
        token_usage = result[<span class="hljs-string">"usage"</span>]  <span class="hljs-comment"># Token消耗统计（输入+输出）</span>
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"success"</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">"reply"</span>: reply,
            <span class="hljs-string">"token_used"</span>: token_usage[<span class="hljs-string">"total_tokens"</span>],
            <span class="hljs-string">"prompt_tokens"</span>: token_usage[<span class="hljs-string">"prompt_tokens"</span>],
            <span class="hljs-string">"completion_tokens"</span>: token_usage[<span class="hljs-string">"completion_tokens"</span>]
        }
    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># 错误处理</span>
        error_msg = <span class="hljs-built_in">str</span>(e)
        <span class="hljs-keyword">if</span> response:
            error_msg += <span class="hljs-string">f" | 错误详情：<span class="hljs-subst">{response.json()}</span>"</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"success"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"error"</span>: error_msg}

<span class="hljs-comment"># 4. 测试调用</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    user_input = <span class="hljs-string">"用Python写一个快速排序算法，带注释"</span>
    result = call_aionly_chat(user_input)
    <span class="hljs-keyword">if</span> result[<span class="hljs-string">"success"</span>]:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"AI回复：\n"</span>, result[<span class="hljs-string">"reply"</span>])
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nToken消耗：总计<span class="hljs-subst">{result[<span class="hljs-string">'token_used'</span>]}</span>（输入<span class="hljs-subst">{result[<span class="hljs-string">'prompt_tokens'</span>]}</span>+输出<span class="hljs-subst">{result[<span class="hljs-string">'completion_tokens'</span>]}</span>）"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"调用失败："</span>, result[<span class="hljs-string">"error"</span>])
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4c5c626a55b4b53b6488d7ab693cd51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=max0dWs9YSSr1gDedDowTvAXAMs%3D" alt="00fe8142-a922-46b7-863e-bd0ee120e981.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34d4342ffb0746e095ec134d5cec12a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=cJqHB%2FTron%2FUeofyyRfsMeGEyX8%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到和我们在平台-调用统计看到的结果是一致的
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2583a76d04f349f4ad8e4f2891bdf2e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=J2eVDN8I1BJkmEQY4GfRPHBuwKs%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-14">步骤 3：常见问题排查</h5>

























<table><thead><tr><th>错误码</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>401</td><td>API Key 错误 / 已停用</td><td>检查 Key 是否正确，进入「API Key」确认状态</td></tr><tr><td>403</td><td>模型未开通 / Key 权限不匹配（如标准 Key 调用融合功能）</td><td>「开通管理」确认模型状态，重新创建对应类型 Key</td></tr><tr><td>429</td><td>QPS 超限（超过模型设定的并发限制）</td><td>降低调用频率，或联系客服提升 QPS</td></tr></tbody></table>
<h3 data-id="heading-15">第三部分：实战应用案例 —— 智能客服机器人开发</h3>
<h4 data-id="heading-16">3.1 项目背景与技术栈</h4>
<h5 data-id="heading-17">应用场景</h5>
<p>电商平台轻量化智能客服工具，聚焦<strong>订单查询、售后咨询、产品推荐</strong>等核心需求，适合中小商家快速部署，无需专业服务器维护，本地 Windows 环境即可运行，单日成本可控制在 0.5 元以内。</p>
<h5 data-id="heading-18">技术栈选型</h5>



































<table><thead><tr><th>模块</th><th>选型理由</th><th/></tr></thead><tbody><tr><td>核心接口</td><td>AiOnly API（GPT-5+RAG 知识库）</td><td>保持多模型兼容与知识库检索能力，降低开发复杂度</td></tr><tr><td>后端框架</td><td>Flask（轻量 Web 框架）</td><td>适合 Windows 环境快速启动，无需复杂配置</td></tr><tr><td>会话缓存</td><td>内存字典（Python 内置）</td><td>替代 Redis 存储对话上下文，简化部署（仅适合小规模使用）</td></tr><tr><td>前端</td><td>HTML+CSS+JavaScript</td><td>保留响应式界面，支持本地浏览器访问</td></tr><tr><td>运行环境</td><td>Windows 10/11 + Python 3.13.5</td><td>无需服务器，个人电脑即可部署测试</td></tr></tbody></table>
<h4 data-id="heading-19">3.2 核心功能设计</h4>
<ol>
<li><strong>基础多轮对话</strong>：通过内存字典存储用户历史对话（最多保留 10 轮），支持上下文关联（如连续咨询同一订单问题）；</li>
<li><strong>智能 RAG 融合</strong>：使用与知识库绑定的“融合模式” API Key，平台自动检索并融入知识库上下文，生成更精准回复；</li>
<li><strong>轻量化部署</strong>：无需安装数据库和服务器软件，Python 脚本直接运行，适合非技术人员操作。</li>
</ol>
<h4 data-id="heading-20">3.3 完整实现步骤（Windows 环境适配）</h4>
<h5 data-id="heading-21">步骤 1：AiOnly RAG 知识库创建（控制台操作）</h5>
<ol>
<li>
<p>进入知识库管理：控制台左侧点击「知识库管理」→「新建知识库」，命名 “电商客服 FAQ”；
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e70dcb32aea94d6cba5c6df490e0c5d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=MQWB492gTV%2FW2lj2uZ7SfnCwHVc%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd2afd3c2b54a278ecf322379f0e235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=CIBMaCKxvEcgZDM1nNXZP3Hk3Go%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>上传 FAQ 数据：支持上传文档（.md/.docx）、表格（.xlsx），示例数据如下（“退款政策.md”）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 电商客服FAQ</span>
<span class="hljs-bullet">1.</span> 退款申请后多久到账？
答：退款将在1-3个工作日内原路返回，具体到账时间以银行为准。

<span class="hljs-bullet">2.</span> 订单发货时间？
答：普通商品48小时内发货，预售商品以详情页标注时间为准。

<span class="hljs-bullet">3.</span> 如何修改收货地址？
答：订单发货前可在“我的订单”→“修改地址”中操作；已发货需联系快递拦截。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c5496985cc1475591b97993586fa227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=ZM6r1jCUcqYbM9dk7ra%2BCA33No0%3D" alt="image.png" loading="lazy"/></p>
</li>
</ol>
<h5 data-id="heading-22">步骤 2：创建融合模式 API Key（关键步骤）</h5>
<ul>
<li>
<p>进入「API Key」→「新增 API Key」，类型选择“融合模式”。</p>
</li>
<li>
<p>在“知识库”配置中选择“电商客服 FAQ”，开启绑定。</p>
</li>
<li>
<p>保存生成的 Key，并在 <code>.env</code> 中替换 <code>AIONLY_API_KEY</code>。</p>
</li>
<li>
<p>融合模式 Key 会自动在调用时进行知识库检索与上下文融合，无需手动检索接口。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8895932959bc437a8feeb7da2176f068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=uz9HnDEOwAF1ZafmxYeLd4ofgvM%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
<h5 data-id="heading-23">步骤 3：项目结构与代码实现</h5>
<h6 data-id="heading-24">3.1 项目结构</h6>
<pre><code class="hljs language-plaintext" lang="plaintext">ecommerce-ai-chatbot/
├── app.py          # Flask主程序（含会话管理）
├── aionly_client.py# AiOnly API客户端
├── .env            # 配置文件
├── requirements.txt# 依赖库
└── templates/
    └── index.html  # 前端界面
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/878aa812bf3f4523868caaf128682a44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=FkTg3vlVP7vPqUKwCaNQ7lej7f0%3D" alt="5283e441-5cd2-4299-beb6-72e550218086.png" loading="lazy"/></p>
<h6 data-id="heading-25">3.2 依赖库配置（requirements.txt）</h6>
<pre><code class="hljs language-plaintext" lang="plaintext">flask==2.3.3
requests==2.31.0
python-dotenv==1.0.0
</code></pre>
<h6 data-id="heading-26">3.3 配置文件更新 (.env)</h6>
<pre><code class="hljs language-env" lang="env">AIONLY_API_KEY=your_fusion_mode_api_key_here
AIONLY_CHAT_URL=https://api.aiionly.com/v1/chat/completions
</code></pre>
<h6 data-id="heading-27">3.4 AiOnly API 客户端（aionly_client.py）</h6>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-comment"># 全局内存存储用户对话历史（替代Redis）</span>
user_history = {}  <span class="hljs-comment"># 格式：{user_id: [{"role": "...", "content": "..."}, ...]}</span>

load_dotenv()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AiOnlyClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.api_key = os.getenv(<span class="hljs-string">"AIONLY_API_KEY"</span>)
        self.chat_url = os.getenv(<span class="hljs-string">"AIONLY_CHAT_URL"</span>)
        self.headers = {
            <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{self.api_key}</span>"</span>,
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_knowledge</span>(<span class="hljs-params">self, user_message</span>):
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chat_reply</span>(<span class="hljs-params">self, user_id, user_message</span>):
        <span class="hljs-string">"""获取AI回复（含内存对话管理）"""</span>
        <span class="hljs-comment"># 1. 初始化/获取用户历史</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> user_history:
            user_history[user_id] = []
        
        messages = [
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是电商AI客服，请根据知识库内容和用户问题，友好地回答。"</span>}
        ] + user_history[user_id] + [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_message}]
        
        payload = {
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-5"</span>,
            <span class="hljs-string">"messages"</span>: messages,
            <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.6</span>,
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">1024</span>
        }
        
        <span class="hljs-keyword">try</span>:
            response = requests.post(self.chat_url, headers=self.headers, json=payload)
            response.raise_for_status()
            result = response.json()
            
            reply = result[<span class="hljs-string">"choices"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>]
            token_used = result[<span class="hljs-string">"usage"</span>][<span class="hljs-string">"total_tokens"</span>]
            
            <span class="hljs-comment"># 更新历史</span>
            user_history[user_id].append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_message})
            user_history[user_id].append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: reply})
            user_history[user_id] = user_history[user_id][-<span class="hljs-number">20</span>:]
            
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"success"</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">"reply"</span>: reply, <span class="hljs-string">"token_used"</span>: token_used}
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            error_msg = <span class="hljs-built_in">str</span>(e)
            <span class="hljs-keyword">if</span> response:
                error_msg += <span class="hljs-string">f" | <span class="hljs-subst">{response.json()}</span>"</span>
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"success"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"error"</span>: error_msg}

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_user_history</span>(<span class="hljs-params">self, user_id</span>):
        <span class="hljs-string">"""清除用户历史（内存版）"""</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">in</span> user_history:
            <span class="hljs-keyword">del</span> user_history[user_id]
</code></pre>
<h6 data-id="heading-28">3.5 Flask 主程序（app.py）</h6>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify, render_template
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">from</span> aionly_client <span class="hljs-keyword">import</span> AiOnlyClient

app = Flask(__name__)
ai_client = AiOnlyClient()

<span class="hljs-comment"># 1. 前端界面</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">"index.html"</span>)

<span class="hljs-comment"># 2. 对话API</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/api/chat"</span>, methods=[<span class="hljs-string">"POST"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">chat</span>():
    data = request.json
    user_id = data.get(<span class="hljs-string">"user_id"</span>)
    user_message = data.get(<span class="hljs-string">"message"</span>, <span class="hljs-string">""</span>).strip()
    
    <span class="hljs-comment"># 生成用户ID（首次访问）</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_id:
        user_id = <span class="hljs-built_in">str</span>(uuid.uuid4())
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_message:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">"success"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"error"</span>: <span class="hljs-string">"请输入有效消息"</span>})
    
    <span class="hljs-comment"># 获取回复</span>
    result = ai_client.get_chat_reply(user_id, user_message)
    result[<span class="hljs-string">"user_id"</span>] = user_id
    <span class="hljs-keyword">return</span> jsonify(result)

<span class="hljs-comment"># 3. 清除历史API</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">"/api/clear-history"</span>, methods=[<span class="hljs-string">"POST"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_history</span>():
    data = request.json
    user_id = data.get(<span class="hljs-string">"user_id"</span>)
    <span class="hljs-keyword">if</span> user_id:
        ai_client.clear_user_history(user_id)
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">"success"</span>: <span class="hljs-literal">True</span>})
    <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">"success"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"error"</span>: <span class="hljs-string">"user_id不能为空"</span>}), <span class="hljs-number">400</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># Windows环境直接运行，默认端口5000</span>
    app.run(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)
</code></pre>
<h6 data-id="heading-29">3.6 前端界面（templates/index.html）</h6>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>电商AI客服<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">box-sizing</span>: border-box; }
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: Arial, sans-serif; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.chat-container</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">overflow</span>: hidden; }
        <span class="hljs-selector-class">.chat-header</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#2272f9</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>; }
        <span class="hljs-selector-class">.chat-history</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>; <span class="hljs-attribute">overflow-y</span>: auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#fafafa</span>; }
        <span class="hljs-selector-class">.message</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">8px</span> <span class="hljs-number">0</span>; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">70%</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>; }
        <span class="hljs-selector-class">.user-message</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#2272f9</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">margin-left</span>: auto; }
        <span class="hljs-selector-class">.ai-message</span> { <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>; <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>; <span class="hljs-attribute">margin-right</span>: auto; }
        <span class="hljs-selector-class">.system-message</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>; <span class="hljs-attribute">text-align</span>: center; <span class="hljs-attribute">margin</span>: <span class="hljs-number">8px</span> <span class="hljs-number">0</span>; }
        <span class="hljs-selector-class">.input-container</span> { <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>; }
        <span class="hljs-selector-id">#message-input</span> { <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>; <span class="hljs-attribute">border</span>: none; <span class="hljs-attribute">outline</span>: none; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
        <span class="hljs-selector-id">#send-btn</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">24px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#2272f9</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">border</span>: none; <span class="hljs-attribute">cursor</span>: pointer; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
        <span class="hljs-selector-id">#clear-btn</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">16px</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff4444</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">border</span>: none; <span class="hljs-attribute">cursor</span>: pointer; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-header"</span>&gt;</span>AiOnly电商AI客服（7×24小时在线）<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-history"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chat-history"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"system-message"</span>&gt;</span>欢迎咨询，我可以帮您查询订单、处理售后问题~<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"message-input"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入您的问题（如：退款多久到账？）"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"clear-btn"</span>&gt;</span>清除历史<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"send-btn"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 从本地存储获取用户ID（避免刷新丢失）</span>
        <span class="hljs-keyword">let</span> userId = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">"ecommerce_chat_userid"</span>);
        <span class="hljs-keyword">const</span> chatHistory = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"chat-history"</span>);
        <span class="hljs-keyword">const</span> messageInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"message-input"</span>);
        <span class="hljs-keyword">const</span> sendBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"send-btn"</span>);
        <span class="hljs-keyword">const</span> clearBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"clear-btn"</span>);

        <span class="hljs-comment">// 添加消息到界面</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">addMessage</span>(<span class="hljs-params">content, isUser = <span class="hljs-literal">false</span></span>) {
            <span class="hljs-keyword">const</span> messageDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>);
            messageDiv.<span class="hljs-property">className</span> = isUser ? <span class="hljs-string">"message user-message"</span> : <span class="hljs-string">"message ai-message"</span>;
            messageDiv.<span class="hljs-property">textContent</span> = content;
            chatHistory.<span class="hljs-title function_">appendChild</span>(messageDiv);
            <span class="hljs-comment">// 滚动到底部</span>
            chatHistory.<span class="hljs-property">scrollTop</span> = chatHistory.<span class="hljs-property">scrollHeight</span>;
        }

        <span class="hljs-comment">// 发送消息</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> message = messageInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
            <span class="hljs-keyword">if</span> (!message) <span class="hljs-keyword">return</span>;

            <span class="hljs-comment">// 显示用户消息</span>
            <span class="hljs-title function_">addMessage</span>(message, isUser = <span class="hljs-literal">true</span>);
            messageInput.<span class="hljs-property">value</span> = <span class="hljs-string">""</span>;

            <span class="hljs-comment">// 调用后端API</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/chat"</span>, {
                    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
                    <span class="hljs-attr">headers</span>: { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span> },
                    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">user_id</span>: userId, <span class="hljs-attr">message</span>: message })
                });
                <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

                <span class="hljs-comment">// 保存用户ID</span>
                userId = result.<span class="hljs-property">user_id</span>;
                <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">"ecommerce_chat_userid"</span>, userId);

                <span class="hljs-comment">// 显示AI回复</span>
                <span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
                    <span class="hljs-title function_">addMessage</span>(result.<span class="hljs-property">reply</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-title function_">addMessage</span>(<span class="hljs-string">`抱歉，服务暂时 unavailable：<span class="hljs-subst">${result.error}</span>`</span>, isUser = <span class="hljs-literal">false</span>);
                }
            } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-title function_">addMessage</span>(<span class="hljs-string">"网络错误，请稍后再试"</span>, isUser = <span class="hljs-literal">false</span>);
            }
        }

        <span class="hljs-comment">// 清除历史</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearHistory</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (userId) {
                <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/clear-history"</span>, {
                    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
                    <span class="hljs-attr">headers</span>: { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span> },
                    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">user_id</span>: userId })
                });
            }
            chatHistory.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;div class="system-message"&gt;欢迎咨询，我可以帮您查询订单、处理售后问题~&lt;/div&gt;'</span>;
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">"ecommerce_chat_userid"</span>);
            userId = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// 绑定事件</span>
        sendBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, sendMessage);
        messageInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"keypress"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">"Enter"</span>) <span class="hljs-title function_">sendMessage</span>();
        });
        clearBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, clearHistory);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-30">步骤 3：Windows 环境部署与运行</h5>
<h6 data-id="heading-31">3.1 环境准备</h6>
<ol>
<li>
<p><strong>安装 Python 3.13.5</strong>：</p>
<ul>
<li>访问Python 官网下载对应 Windows 安装包</li>
<li>安装时勾选 “Add Python to PATH”，完成后打开命令提示符（Win+R→cmd）</li>
<li>验证安装：<code>python --version</code> 显示 3.13.5 即为成功</li>
</ul>
</li>
<li>
<p><strong>创建项目文件夹</strong>：</p>
<pre><code class="hljs language-cmd" lang="cmd">mkdir C:\ecommerce-ai-chatbot
cd C:\ecommerce-ai-chatbot
</code></pre>
</li>
<li>
<p><strong>创建配置文件</strong>：</p>
<ul>
<li>
<p>在文件夹中新建<code>.env</code>文件，内容如下：</p>
<pre><code class="hljs language-env" lang="env">AIONLY_API_KEY=你的API密钥
AIONLY_CHAT_URL=https://api.aiionly.com/v1/chat/completions
</code></pre>
</li>
</ul>
</li>
</ol>
<h6 data-id="heading-32">3.2 安装依赖与启动服务</h6>
<ol>
<li>
<p><strong>安装依赖库</strong>：</p>
<pre><code class="hljs language-cmd" lang="cmd">pip install -r requirements.txt
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d89a3d2f81154541a926f51251aea661~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=ogZIqGUG6KTWM%2B7ltv%2FmW%2F1CYj8%3D" alt="image.png" loading="lazy"/></p>
<p>（若提示 pip 版本问题，先运行<code>python -m pip install --upgrade pip</code>）</p>
</li>
<li>
<p><strong>启动服务</strong>：</p>
<pre><code class="hljs language-cmd" lang="cmd">python app.py
</code></pre>
<p>看到类似以下输出即为成功：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">* Running on http://127.0.0.1:5000 (Press CTRL+C to quit)
</code></pre>
<p>PS：警告忽略即可
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3d920bb43e6461693c326f557df6cf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=a9gbUxqfG6W918z6%2FG96qr%2Fu4d4%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>访问客服界面</strong>：</p>
<ul>
<li>打开浏览器，输入<code>http://127.0.0.1:5000</code></li>
<li>即可开始使用智能客服（关闭命令提示符即停止服务）</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e0f1acbd5f84a669a89b209755af848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=GOulT2JYY6Y4GsMqCCQTp%2FXhCPk%3D" alt="" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1dd01602e6044c990065e75b8474cd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976403&amp;x-signature=MQKWQypp15wbnxs5h7Zx85yTHwM%3D" alt="bace6d42b13227970f67168a34d8b873.png" loading="lazy"/></p>
<h4 data-id="heading-33">3.4 效果展示与适用场景</h4>
<h5 data-id="heading-34">功能测试结果</h5>





























<table><thead><tr><th>测试场景</th><th>实际效果</th><th>耗时</th><th>准确率</th></tr></thead><tbody><tr><td>FAQ 匹配（“退款到账时间”）</td><td>直接返回知识库答案</td><td>&lt;200ms</td><td>100%</td></tr><tr><td>多轮对话（“查订单→改地址”）</td><td>基于内存历史保持上下文理解</td><td>300-400ms</td><td>90%</td></tr><tr><td>复杂问题（“推荐性价比高的商品”）</td><td>调用 GPT-5 生成个性化推荐</td><td>400-600ms</td><td>85%</td></tr></tbody></table>
<h5 data-id="heading-35">适用场景</h5>
<ul>
<li>个人卖家或小团队：无需服务器，本地电脑即可部署，日均成本≈0.3 元</li>
<li>临时活动客服：促销期间快速上线，活动结束后直接关闭，无资源浪费</li>
<li>测试验证：快速验证 AI 客服效果，再决定是否扩展为企业级方案</li>
</ul>
<h5 data-id="heading-36">局限性说明</h5>
<ul>
<li>内存存储对话历史，重启服务后丢失（适合临时使用）</li>
<li>不支持高并发（建议同时在线用户≤10 人）</li>
<li>需保持命令提示符窗口开启（可最小化，不可关闭）</li>
</ul>
<h3 data-id="heading-37">第四部分：结语</h3>
<h4 data-id="heading-38">4.1 平台核心优势总结</h4>
<ol>
<li><strong>接入门槛极低</strong>：无需技术背景也能 10 分钟完成注册→开通模型→API 调用，开发者无需适配不同模型的接口差异；</li>
<li><strong>成本可控性强</strong>：按量计费 + 优惠量包 + 新人福利，大幅降低试错成本</li>
<li><strong>场景覆盖全面</strong>：从个人 AIGC 创作（图片 / 视频生成）到企业级智能体开发（客服 / 数据分析），全链路需求均可满足；</li>
<li><strong>技术支撑完善</strong>：标准化 API + 专业工单客服 + RAG/Prompt 优解工具，开发者专注业务逻辑，无需关注模型维护。</li>
</ol>
<h4 data-id="heading-39">4.2 适用人群与场景</h4>






























<table><thead><tr><th>人群 / 角色</th><th>推荐场景</th><th>核心价值</th></tr></thead><tbody><tr><td>AI 开发者</td><td>智能客服、代码助手、多模态交互系统</td><td>快速集成多模型，降低开发成本</td></tr><tr><td>内容创作者</td><td>短视频脚本生成、图片素材制作、文案撰写</td><td>提升创作效率，降低素材成本</td></tr><tr><td>企业运营 / 客服团队</td><td>7×24 小时智能客服、客户问题自动分类</td><td>替代 30% 人工工作，降低运营成本</td></tr><tr><td>高校科研人员</td><td>前沿模型实验、学术数据分析、论文辅助撰写</td><td>低成本调用顶尖模型，支持科研创新</td></tr></tbody></table>
<h4 data-id="heading-40">4.3 后续探索建议</h4>
<ol>
<li>尝试多模型协作：用 “GPT-5 生成文案 +Gemini-2.5-flash-image（Nano Banana） + Sora 2 生成短视频”，构建完整 AIGC 流水线；</li>
<li>深入 RAG 功能：上传企业私有文档（如产品手册、内部流程），构建专属知识库，提升回答精准度；</li>
</ol>
<p><strong>如需进一步学习，可访问
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aiionly.com%2Flogin%3FinviteCode%3D0047994" target="_blank" title="https://www.aiionly.com/login?inviteCode=0047994" ref="nofollow noopener noreferrer">AiOnly企业级MaaS平台官网</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aiionly.com%2Flogin%3FinviteCode%3D0047994" target="_blank" title="https://www.aiionly.com/login?inviteCode=0047994" ref="nofollow noopener noreferrer">GPT/Claude/Gemini API接入文档</a>
获取最新技术动态与专属支持</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VinciCoder：多模态统一代码生成框架和视觉反馈强化学习，数据代码模型权重已开源]]></title>    <link>https://juejin.cn/post/7573506713866354739</link>    <guid>https://juejin.cn/post/7573506713866354739</guid>    <pubDate>2025-11-17T09:31:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573506713866354739" data-draft-id="7573242085610700851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VinciCoder：多模态统一代码生成框架和视觉反馈强化学习，数据代码模型权重已开源"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-17T09:31:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VinciCoder：多模态统一代码生成框架和视觉反馈强化学习，数据代码模型权重已开源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:31:31.000Z" title="Mon Nov 17 2025 09:31:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>长期以来，多模态代码生成（Multimodal Code Generation）的训练严重依赖于特定任务的监督微调（SFT）。尽管这种范式在 Chart-to-code 等单一任务上取得了显著成功 ，但其 “狭隘的训练范围” 从根本上限制了模型的泛化能力，阻碍了通用视觉代码智能（Generalized VIsioN Code Intelligence）的发展 。同时，「SFT-only」的范式在确保代码可执行性和高视觉保真度方面存在显著瓶颈 。</p>
<p>在此背景下，中科院 &amp; 美团研究团队推出了 VinciCoder ，一个旨在打破 SFT 瓶颈的统一多模态代码生成模型。VinciCoder 首次将强化学习的奖励机制从文本域转向视觉域，提出视觉强化学习（ViRL） ，专攻 SFT 无法解决的视觉保真度难题。</p>
<p>本文提出的系统性框架 VinciCoder，通过 “大规模 SFT + 粗细粒度 ViRL” 的两阶段策略，有效统一了从图表、网页、SVG 到科学绘图（LaTeX、化学分子）等多样化代码生成任务 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8192aa8a0b4165b13b88b48c401bd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976690&amp;x-signature=3tyDaX38rb2TvKQemZuYgliBEiA%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>论文标题：VinciCoder: Unifying Multimodal Code Generation via Coarse-to-fine Visual Reinforcement Learning </p>
</li>
<li>
<p>论文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.00391%25C2%25A0" target="_blank" title="https://arxiv.org/abs/2511.00391%C2%A0" ref="nofollow noopener noreferrer">arxiv.org/abs/2511.00…</a></p>
</li>
<li>
<p>Github 链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDocTron-hub%2FVinciCoder%25C2%25A0" target="_blank" title="https://github.com/DocTron-hub/VinciCoder%C2%A0" ref="nofollow noopener noreferrer">github.com/DocTron-hub…</a></p>
</li>
</ul>
<p>数据代码模型权重已开源。</p>
<p>核心创新与技术突破</p>
<p>该论文同样对传统 SFT 范式的局限性进行了深入分析，发现其关键问题在于训练目标与最终任务之间存在 “视觉鸿沟”：</p>
<ul>
<li>
<p>目标是局部的：SFT 采用自回归的 “下一词元预测” 目标 ，这本质上是局部的，无法为代码 “可执行性” 等全局属性提供监督信号 。</p>
</li>
<li>
<p>缺乏视觉反馈：模型在训练时完全看不到代码的渲染结果 。这是一个致命缺陷，因为在代码中 “微小的修改就可能导致渲染图像发生巨大变化” 。</p>
</li>
</ul>
<p>这种 “视觉 - 代码” 监督的缺失，直接导致了两个关键问题：</p>
<ul>
<li>
<p>保真度低且不可靠：模型仅在词元层面（token-level）进行优化 ，无法保证渲染出的图像在视觉上与输入对齐，也无法保证代码可以成功执行 。</p>
</li>
<li>
<p>泛化能力差：依赖特定任务的数据集进行 SFT，难以形成一个统一的多模态代码生成框架 。</p>
</li>
</ul>
<p>考虑到 SFT 的根本局限性，研究者认为必须引入一个能够提供全局视觉反馈的机制。然而，传统的 RL 方法依赖难以泛化的 “基于规则的文本奖励” 。VinciCoder 的破局点在于 —— 将奖励机制从文本域彻底转向视觉域 。</p>
<p>VinciCoder 的核心思路是：用大规模、多样化的 SFT 构建强大的代码基础能力 ，再通过创新的 ViRL 策略专门优化 SFT 无法触及的视觉保真度和可执行性 。训练框架由「1.6M 大规模 SFT 阶段」和「42k 粗细粒度 ViRL 阶段」两部分组成 ，核心是通过两阶段协作，同时实现强大的代码理解与高保真的视觉对齐。</p>
<ol>
<li>大规模 SFT 语料库与代码优化任务</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f448cf425444e14a164fae85639e6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976690&amp;x-signature=R0IcEbXFpyWlc6LccAEdsMA1La4%3D" alt="图片" loading="lazy"/></p>
<p>研究团队首先构建了一个包含 1.6M 图像 - 代码对的大规模监督微调（SFT）语料库 。该语料库不仅覆盖了直接代码生成任务，还引入 “视觉代码优化” 的新任务 。在这项任务中，模型会接收到一个目标图像和一个 “有缺陷” 的代码片段（包含逻辑错误或只能部分渲染）。模型的目标是修正这段代码，使其视觉输出与目标图像精确对齐 。这一设计极大地提升了模型在代码层面的纠错和优化能力，为后续的强化学习阶段奠定了坚实基础 。</p>
<ol start="2">
<li>从 “文本奖励” 到 “视觉奖励”：粗细粒度 ViRL 框架</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53a263acf8cf4775b27135a3847cda91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976690&amp;x-signature=0Xsr4pMYWbhArXSRfnmgF6MaU08%3D" alt="图片" loading="lazy"/></p>
<p>传统 SFT 训练在多模态代码生成上存在根本缺陷：它缺乏 “视觉 - 代码” 的闭环反馈 ，且无法保证代码的全局可执行性 。</p>
<p>为解决此问题，VinciCoder 引入了视觉强化学习 (ViRL) 框架 。该框架摒弃了传统强化学习中脆弱的、基于规则的 “文本奖励” ，转而从视觉直接获取奖励信号 。</p>
<p>其核心突破在于一套粗 - 细粒度（Coarse-to-fine）视觉奖励机制：</p>
<ul>
<li>
<p>渲染与编码：模型生成的代码被实时渲染成图像 。</p>
</li>
<li>
<p>粗粒度（全局）：通过下采样生成缩略图，评估整体结构的相似性 。</p>
</li>
<li>
<p>细粒度（局部）：将高分辨率图像分割为多个局部图块（patches），精确计算局部细节的保真度 。</p>
</li>
<li>
<p>ViT 奖励模型：使用 DINOv2-L 计算渲染图像与目标图像在两个粒度上的视觉相似度，作为奖励信号。</p>
</li>
<li>
<p>对齐奖励 ：引入一个辅助的语言对齐奖励，用于惩罚生成了错误代码语言（如要求 Python 却生成了 LaTeX 的行为）</p>
</li>
<li>
<p>策略优化：采用群组相对策略优化 (GRPO) 算法 对模型进行微调，显著提升视觉对齐度和代码可执行性。</p>
</li>
</ul>
<p>据我们所知，VinciCoder 是第一个应用强化学习（RL）来实现统一视觉代码生成领域中 “跨领域视觉保真度” 提升的视觉语言模型 。</p>
<p>实验结果与性能表现</p>
<p>论文在五大多模态代码生成基准上进行了全面实验，对比了包括 Qwen、InternVL 等开源模型以及 Gemini-2.5-Pro、Claude-4.5、GPT-5 等闭源模型 ，核心结果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baf8581e0b1c4c248b966b9989dfa52e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976690&amp;x-signature=HRH3vvaR3VDl2xaQWsA7FUJWnVw%3D" alt="图片" loading="lazy"/></p>
<p>实验结果令人瞩目：VinciCoder 在多个主流多模态代码生成基准上均取得了卓越表现。</p>
<ul>
<li>
<p>SOTA 性能：VinciCoder 在开源模型对比中树立了新的 SOTA 标准 ，其性能显著优于所有同等规模的竞争对手 。</p>
</li>
<li>
<p>媲美闭源模型：在如 Image-to-SVG 和化学分子式生等高难度任务上，VinciCoder 展现出超越顶尖闭源模型的卓越性能 。</p>
</li>
<li>
<p>策略有效性：消融实验证明，仅 SFT 阶段的 VinciCoder-SFT 就已建立起强大的基线 ；而 ViRL 阶段的引入，则成功将模型性能提升至 SOTA 水平 ，充分验证了 SFT-ViRL 两阶段策略的压倒性优势。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85479c23df78428583513967d097db13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976690&amp;x-signature=UW%2BUbfrf%2BCMcMiVxhmq2B7sq%2BFE%3D" alt="图片" loading="lazy"/></p>
<p>研究意义与应用前景</p>
<p>VinciCoder 的研究不仅在技术上取得了重大突破，也为多模态代码生成领域提供了全新的研究范式：</p>
<ul>
<li>
<p>验证 RL 新路径：证明了 “视觉强化学习” 是突破 SFT 瓶颈、提升代码视觉保真度的有效途径，将奖励机制从文本域成功扩展到视觉域 。</p>
</li>
<li>
<p>统一框架的实现：打破了过去模型 “各自为战” 的狭隘范式 ，提供了一个强大的统一框架，能够处理包括 Python、HTML、SVG、LaTeX 乃至化学 SMILES 在内的多样化代码生成任务 。</p>
</li>
<li>
<p>高保真度奖励机制：“粗 - 细粒度” 奖励设计为处理高分辨率、高复杂度视觉输入的 RL 任务提供了健壮且可扩展的解决方案 。</p>
</li>
</ul>
<p>结论</p>
<p>VinciCoder 的核心价值并非单纯地堆砌 SFT 数据，而是通过 “SFT + 粗细粒度 ViRL” 的组合，证明了 “以视觉反馈指导代码生成” 的可行性与优越性。这一思路不仅解决了传统 SFT 范式在可执行性与视觉保真度上的痛点，也为后续通用多模态智能体的研发提供了新的思路。</p>
<p>在总体思路上，该论文的思路与 R1-Style 方法高度相关，都验证了强化学习在提升基础模型高级能力上的巨大潜力。VinciCoder 的成功探索表明，RL 不仅可以用于优化数学推理等文本任务，更可以作为连接 “视觉” 与 “代码” 两大模态的桥梁，解决 SFT 无法企及的跨模态对齐难题。</p>
<p>更多细节请参阅原论文。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 一个小型游戏对象模型渐进式设计（二）——协议与默认实现：如何写出不用继承的多态]]></title>    <link>https://juejin.cn/post/7573525927792623642</link>    <guid>https://juejin.cn/post/7573525927792623642</guid>    <pubDate>2025-11-17T09:46:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927792623642" data-draft-id="7553830228105986102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 一个小型游戏对象模型渐进式设计（二）——协议与默认实现：如何写出不用继承的多态"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-17T09:46:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 一个小型游戏对象模型渐进式设计（二）——协议与默认实现：如何写出不用继承的多态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:46:56.000Z" title="Mon Nov 17 2025 09:46:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>用 protocol + extension 把上一篇的 BOSS 战例彻底重构，让代码轻量、可测试、易扩展</p>
<h2 data-id="heading-0">为什么“不用继承”</h2>
<p>上一篇我们用 <code>class Entity → Monster / Boss</code> 的经典继承树完成了需求，但留下几个隐痛：</p>
<ol>
<li>值类型无法参与：Swift 的 struct 不能继承 class。</li>
<li>多继承死路：一个 BOSS 既要“可攻击”又要“可飞行”还要“可分裂”，Swift 不支持多类继承。</li>
<li>隐式共享状态：父类新增的存储属性，所有子类被迫买单，造成“胖基类”。</li>
<li>单元测试困难：想单独测“狂暴逻辑”必须把整个 Boss 实例 new 出来，还要喂血量。</li>
</ol>
<h2 data-id="heading-1">协议（protocol）是什么</h2>
<p>一句话：协议只定义“契约”，不关心“怎么存”。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span>
}
</code></pre>
<p>任何类型（class / struct / enum / actor）只要实现 <code>attack()</code>，就自动“符合” Attackable，从而获得多态能力。</p>
<p>协议本身不能存属性，但可以通过“关联属性”或“协议扩展”给出默认实现，达到“代码复用”而“不强制继承”。</p>
<h2 data-id="heading-2">协议扩展：给协议加“默认实现”</h2>
<p>语法：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> { <span class="hljs-number">10.0</span> }   <span class="hljs-comment">// 默认伤害</span>
}
</code></pre>
<p>现在任何符合者如果不自己写 <code>attack()</code>，就自动拿到 10 点伤害。</p>
<p>想定制？在自己的类型里重新实现即可，不需要 <code>override</code> 关键字——因为协议不涉继承链。</p>
<h2 data-id="heading-3">拆成“能力插件”</h2>
<ol>
<li>可攻击</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span>
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> { <span class="hljs-number">10.0</span> }
}
</code></pre>
<ol start="2">
<li>可定位</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Locatable</span> {
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }
    <span class="hljs-keyword">var</span> y: <span class="hljs-type">Double</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }
}
</code></pre>
<ol start="3">
<li>可受伤</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Woundable</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }
    <span class="hljs-keyword">var</span> maxHp: <span class="hljs-type">Double</span> { <span class="hljs-keyword">get</span> }
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Woundable</span> {
    <span class="hljs-keyword">var</span> isRage: <span class="hljs-type">Bool</span> { hp <span class="hljs-operator">&lt;</span> maxHp <span class="hljs-operator">*</span> <span class="hljs-number">0.2</span> }   <span class="hljs-comment">// 狂暴判断</span>
}
</code></pre>
<ol start="4">
<li>可随机伤害</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">RandomDamage</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">randomDamage</span>(<span class="hljs-params">base</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">range</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Double</span>
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">RandomDamage</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">randomDamage</span>(<span class="hljs-params">base</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">range</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-type">Double</span>.random(in: <span class="hljs-number">0.0</span><span class="hljs-operator">..&lt;</span><span class="hljs-type">Double</span>(range)) <span class="hljs-operator">+</span> <span class="hljs-type">Double</span>(base)
    }
}
</code></pre>
<h2 data-id="heading-4">用 struct 组装各种实体</h2>
<p>Swift 的 struct 可以符合多个协议，享受所有默认实现，零继承。</p>
<ol>
<li>普通小怪</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Monster</span>: <span class="hljs-title class_">Attackable</span>, <span class="hljs-title class_">Locatable</span>, <span class="hljs-title class_">Woundable</span>, <span class="hljs-title class_">RandomDamage</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">let</span> maxHp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> y: <span class="hljs-type">Double</span>
    
    <span class="hljs-comment">// 自己定制伤害</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        randomDamage(base: <span class="hljs-number">5</span>, range: <span class="hljs-number">6</span>)
    }
}
</code></pre>
<ol start="2">
<li>BOSS</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Boss</span>: <span class="hljs-title class_">Attackable</span>, <span class="hljs-title class_">Locatable</span>, <span class="hljs-title class_">Woundable</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">let</span> maxHp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> y: <span class="hljs-type">Double</span>
    
    <span class="hljs-comment">// 狂暴机制</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-keyword">let</span> base: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>
        <span class="hljs-keyword">return</span> isRage <span class="hljs-operator">?</span> base <span class="hljs-operator">*</span> <span class="hljs-number">2</span> : base
    }
}
</code></pre>
<ol start="3">
<li>飞行小怪（新增能力，无需改旧代码）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Flyable</span> {
    <span class="hljs-keyword">var</span> altitude: <span class="hljs-type">Double</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }
}
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">FlyingMonster</span>: <span class="hljs-title class_">Attackable</span>, <span class="hljs-title class_">Locatable</span>, <span class="hljs-title class_">Woundable</span>, <span class="hljs-title class_">Flyable</span>, <span class="hljs-title class_">RandomDamage</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">let</span> maxHp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> y: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> altitude: <span class="hljs-type">Double</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Double</span> {
        randomDamage(base: <span class="hljs-number">4</span>, range: <span class="hljs-number">5</span>) <span class="hljs-operator">+</span> <span class="hljs-number">2</span>   <span class="hljs-comment">// 空对地加 2</span>
    }
}
</code></pre>
<h2 data-id="heading-5">多态依旧可用：协议作为类型</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> army: [<span class="hljs-keyword">any</span> <span class="hljs-type">Attackable</span> &amp; <span class="hljs-type">Woundable</span>] <span class="hljs-operator">=</span> [
    <span class="hljs-type">Monster</span>(hp: <span class="hljs-number">30</span>, maxHp: <span class="hljs-number">30</span>, x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>),
    <span class="hljs-type">Boss</span>(hp: <span class="hljs-number">100</span>, maxHp: <span class="hljs-number">100</span>, x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span>),
    <span class="hljs-type">FlyingMonster</span>(hp: <span class="hljs-number">20</span>, maxHp: <span class="hljs-number">20</span>, x: <span class="hljs-number">2</span>, y: <span class="hljs-number">2</span>, altitude: <span class="hljs-number">10</span>)
]

<span class="hljs-keyword">for</span> unit <span class="hljs-keyword">in</span> army {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"伤害=<span class="hljs-subst">\(unit.attack())</span>, 狂暴=<span class="hljs-subst">\(unit.isRage)</span>"</span>)
}
</code></pre>
<p>打印示例：</p>
<pre><code class="hljs language-arduino" lang="arduino">伤害=<span class="hljs-number">8.857546603881572</span>, 狂暴=<span class="hljs-literal">false</span>
伤害=<span class="hljs-number">10.0</span>, 狂暴=<span class="hljs-literal">false</span>
伤害=<span class="hljs-number">9.333377580674401</span>, 狂暴=<span class="hljs-literal">false</span>
</code></pre>
<p>把 Boss 的血量打到 19 再跑一次，就能看到伤害翻倍，逻辑与继承版完全一致。</p>
<h2 data-id="heading-6">单元测试变得多简单？</h2>
<p>想测“狂暴判断”只要 new 一个符合 <code>Woundable</code> 的伪对象即可，完全不用构造整个 Boss：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Mock</span>: <span class="hljs-title class_">Woundable</span> {
    <span class="hljs-keyword">var</span> hp: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">let</span> maxHp: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>
}

<span class="hljs-keyword">let</span> mock <span class="hljs-operator">=</span> <span class="hljs-type">Mock</span>(hp: <span class="hljs-number">19</span>)
<span class="hljs-type">XCTAssertTrue</span>(mock.isRage)
</code></pre>
<h2 data-id="heading-7">协议组合（Protocol Composition）的语法糖</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">typealias</span> <span class="hljs-type">GameUnit</span> <span class="hljs-operator">=</span> <span class="hljs-type">Attackable</span> &amp; <span class="hljs-type">Woundable</span> &amp; <span class="hljs-type">Locatable</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">move</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">unit</span>: <span class="hljs-keyword">inout</span> <span class="hljs-type">GameUnit</span>, <span class="hljs-params">toX</span> <span class="hljs-params">x</span>: <span class="hljs-type">Double</span>, <span class="hljs-params">y</span>: <span class="hljs-type">Double</span>) {
    unit.x <span class="hljs-operator">=</span> x
    unit.y <span class="hljs-operator">=</span> y
}
</code></pre>
<p>一个类型别名即可把“能力包”当成一个整体使用，比继承树清爽得多。</p>
<h2 data-id="heading-8">什么时候仍需要 class 继承</h2>
<ol>
<li>需要 Objective-C 运行时动态替换（KVO、Swizzle）。</li>
<li>需要析构器 deinit 做资源清理。</li>
<li>需要共享引用语义（多个指针指向同一对象）。</li>
<li>需要互斥锁、原子操作等“引用计数”场景。</li>
</ol>
<p>其余场景，优先 struct + 协议。</p>
<h2 data-id="heading-9">小结：一条决策流程图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff7af0bc169b474690ac527b53e830e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW5yYXZlbDIwMjU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977615&amp;x-signature=ZX2RZsH76wXfyAmdoSf%2BwWi4BvU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用户选剧情，AI写故事：Trae Solo+GLM-4.6实现沉浸式小说创作体验]]></title>    <link>https://juejin.cn/post/7573468493569589284</link>    <guid>https://juejin.cn/post/7573468493569589284</guid>    <pubDate>2025-11-17T09:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573468493569589284" data-draft-id="7573336057481297926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用户选剧情，AI写故事：Trae Solo+GLM-4.6实现沉浸式小说创作体验"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-17T09:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_摘星_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用户选剧情，AI写故事：Trae Solo+GLM-4.6实现沉浸式小说创作体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _摘星_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:26:00.000Z" title="Mon Nov 17 2025 09:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5198527003bf4a67a19606b3117e03e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=1299W9dvbcJ3i4%2B0wq3xaGoGK0g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">用户选剧情，AI写故事：Trae Solo+GLM-4.6实现沉浸式小说创作体验</h2>
<h3 data-id="heading-1">项目背景</h3>
<p>在人工智能技术迅猛发展的今天，内容创作正经历从“人工主导”向“人机协同”的深刻变革。传统小说创作往往面临灵感枯竭、结构混乱、节奏把控难等痛点，而现有AI写作工具多为单向输出，缺乏互动性与叙事张力。为打破这一局限，我们打造了一款轻量级、免登录的 AI小说创作平台，旨在通过前沿大模型能力赋能每一位故事创作者。</p>
<p>本项目深度融合 Trae Solo 的高效前端开发与任务调度能力，以及 GLM-4.6 在中文叙事、情节构建和风格一致性上的卓越表现，构建出“用户选剧情，AI写故事”的沉浸式创作闭环。用户只需输入一个故事开头，系统即刻生成三个风格各异的情节分支概览；选定其一后，AI将续写300–500字的高质量正文，并在此基础上持续衍生新分支，形成一棵动态生长的故事树。整个过程无需注册，API Key 通过本地存储安全保存，兼顾隐私与便捷。</p>
<p>平台采用 新粗野主义（Neo-Brutalism） 视觉风格，以白色为基底，搭配橙、绿、蓝、灰等高对比色块，强调操作反馈与信息层级，营造出兼具个性与流畅交互的创作体验。我们相信，AI不应替代创作者，而应成为激发想象力的伙伴——这款平台正是对“人机共创”未来的一次实践探索。</p>
<h3 data-id="heading-2">智谱大模型</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2F" target="_blank" title="https://www.bigmodel.cn/" ref="nofollow noopener noreferrer">智谱AI</a>（Zhipu AI）是中国领先的大模型技术公司，致力于推动通用人工智能（AGI）的发展。其自主研发的GLM（General Language Model）系列大模型，凭借强大的语言理解与生成能力、多模态融合能力以及高效的推理性能，已在学术界和产业界获得广泛认可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74c638c4a9044b328a505562da46e508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=GHZU9Lt2skEP4q77TIzWiS4XKHY%3D" alt="" loading="lazy"/></p>
<p>最新发布的GLM-4.6不仅在逻辑推理、代码生成、多语言支持等方面实现显著突破，还具备更强的上下文理解与长文本处理能力；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16ad64f02f4c413f9b5cab1bb8291e6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=W6dlj6mH857S9IP3RnZipahsOV4%3D" alt="" loading="lazy"/></p>
<p>在“AI小说创作平台”这一应用中，我们正是依托 Trae Solo 的高效调度能力，结合 GLM-4.6 在叙事生成、情节延展与风格控制上的强大语言建模优势，实现了从用户输入的故事开头到多分支剧情概览、再到沉浸式章节内容的端到端智能创作。通过本地化 API 管理与无登录轻量架构，智谱大模型不仅为写作者提供了低门槛、高自由度的创作杠杆，更重新定义了 AI 驱动下互动式小说生成的新范式。</p>
<h4 data-id="heading-3">获取API KEY</h4>
<p>在智谱AI开放平台的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fusercenter%2Fproj-mgmt%2Fapikeys" target="_blank" title="https://www.bigmodel.cn/usercenter/proj-mgmt/apikeys" ref="nofollow noopener noreferrer">控制台</a>中，即可添加账号的API KEY</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/537e063ac2014f328d9b4dd0fb5a969e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=SKqj4ljcsZReLVV0MQaRnBOk2h4%3D" alt="" loading="lazy"/></p>
<p>添加完之后需要使用的时候直接复制API KEY即可</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fc40498effa4bd4b10c0416abf9391c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=CNQpVQI8Kx26CX0yQPCCLATJP6w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">GLM-4.6</h4>
<p>智谱最新旗舰，代码能力全面对齐 Claude Sonnet 4，是国内最好的编程模型。在真实编程、长上下文处理、推理能力、信息搜索、写作能力与智能体应用等多个方面实现全面提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ce7fbc26324b168158b02b97a3f13d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=%2FdeHGA7nkboVXwxR6NWmcvyL3S4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a9fc3dcd13f4a4badc65e0e1c73a831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=7y5NfvlJOhSiShMUNDbql21osNs%3D" alt="" loading="lazy"/></p>
<p>GLM-4.6调用示例</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
    -H <span class="hljs-string">"Content-Type: application/json"</span> \
    -H <span class="hljs-string">"Authorization: Bearer your-api-key"</span> \
    -d <span class="hljs-comment">'{</span>
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
        <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"作为一名营销专家，请为我的产品创作一个吸引人的口号"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"当然，要创作一个吸引人的口号，请告诉我一些关于您产品的信息"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"智谱AI 开放平台"</span>
        }
            ],
            <span class="hljs-string">"thinking"</span>: {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
        },
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">65536</span>,
            <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>
        }<span class="hljs-comment">'</span>
</code></pre>
<h3 data-id="heading-5">Trae Solo</h3>
<p>过去几年，Prompt Engineering（提示词工程）风靡一时——人们通过精心雕琢输入文本，试图“引导”大模型输出理想结果。然而，随着 AI 应用日益深入复杂场景，仅靠静态、孤立的提示词已难以为继。</p>
<p>以智能客服为例：系统不仅要理解用户当前的提问，还需融合历史对话、用户身份、业务状态，甚至动态调用不同后端服务。此时，传统 Prompt Engineering 的局限性暴露无遗——它把 AI 调用当作一次性的“黑箱请求”，缺乏对整体交互脉络的把握。</p>
<p>正是在这样的背景下，Context Engineering（上下文工程）应运而生，而 Trae Solo 正是这一范式演进的先行者与核心推动者。Trae Solo 不满足于仅仅优化提示词，而是构建了一个结构化、可演化、可追溯的上下文空间——在正确的时间，为正确的模型，注入正确的上下文信息。它将 AI 交互从“单次问答”升级为“持续、智能、情境感知的对话流”，真正实现了从 Prompt Engineering 到 Context Engineering 的跃迁。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/990aef66c4d348fc938f9964c164bea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=gXsn2icpxRBasD0z%2FCpW3PJmv88%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">Trae Solo开发实践</h3>
<h4 data-id="heading-7">开发提示词</h4>
<p>准备好下方的开发提示词并输入Solo：</p>
<pre><code class="hljs language-rust" lang="rust">我现在要开发一个叫做AI小说创作平台，流程是用户给出一个故事的开头,应用会调用GLM-<span class="hljs-number">4.6</span>,生成后续三个情节分支概览,用户可以任意选择一个分支。选择分支之后立马调用GLM-<span class="hljs-number">4.6</span>生成具体的情节,大约<span class="hljs-number">300</span>-<span class="hljs-number">500</span>百字左右。未被选择的分支就抛弃掉，选择的分支使用树形结构一级一级往下展示，但是始终展示当前的分支，持续重复。采用React技术，风格使用新粗野风格，多用白色、橙色、绿色、蓝色、灰色等，流畅的交互设计。这个没有登录，就是所有人都可以用，而且只有两个页面，一个是首页-核心功能，一个是API Key 的配置页面（保存到本地的local storage中），在产品需求文档中加入GLM4.<span class="hljs-number">6</span>调用示例：
<span class="hljs-keyword">const</span> url = ' https:<span class="hljs-comment">//open.bigmodel.cn/api/paas/v4/chat/completions ';</span>
<span class="hljs-keyword">const</span> options = {
method: <span class="hljs-symbol">'POST</span>',
headers: {Authorization: <span class="hljs-symbol">'Bearer</span> &lt;token&gt;', <span class="hljs-symbol">'Content</span>-Type': <span class="hljs-symbol">'application</span>/json'},
body: '{<span class="hljs-string">"model"</span>:<span class="hljs-string">"glm-4.6"</span>,<span class="hljs-string">"messages"</span>:[{<span class="hljs-string">"role"</span>:<span class="hljs-string">"system"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"你是一个有用的AI助手。"</span>},{<span class="hljs-string">"role"</span>:<span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>:<span class="hljs-string">"请介绍一下人工智能的发展历程。"</span>}],<span class="hljs-string">"temperature"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"max_tokens"</span>:<span class="hljs-number">65536</span>,<span class="hljs-string">"stream"</span>:<span class="hljs-literal">false</span>}'};
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ab6a0f282af490eace990dc6746fc34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=%2BK8wj5sL%2FMk0EpKTQXiULNb9amo%3D" alt="" loading="lazy"/></p>
<p>Solo首先会创建一份产品需求文档和技术架构文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22a40973b64a4b338717698f2d6de011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=VMo5eaTrZmQj88MgWzaEqbfeeyA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15747531b9cc4168a52001edef9eca3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=PxTq9YZZgDJn3Cso5UlM0WejSsY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">开发文档</h4>
<p>产品需求文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e3bac35a5e4499a438930dc7df53dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=c777I%2F2wLOJygvxihjHP4uc3Utg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf96ec1189443259004b05a12980e70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=zO1hRpgY20nxEtjTd3s7cTrdnpU%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># AI小说创作平台 - 产品需求文档</span>

<span class="hljs-section">## 1. 产品概述</span>

AI小说创作平台是一个基于GLM-4.6大语言模型的交互式故事创作工具，用户可以输入故事开头，系统自动生成多个情节分支供用户选择，形成个性化的故事发展路径。

该平台旨在为创作者、小说爱好者和娱乐用户提供一个简单易用的AI辅助创作工具，通过树形结构展示故事发展脉络，让每个用户都能创作出独特的故事。

<span class="hljs-section">## 2. 核心功能</span>

<span class="hljs-section">### 2.1 用户角色</span>

本产品无需用户注册登录，所有访问者均可直接使用全部功能。

<span class="hljs-section">### 2.2 功能模块</span>

我们的AI小说创作平台包含以下主要页面：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**首页（故事创作页面）**</span>：故事输入区域、情节分支选择区域、故事树形展示区域、当前情节显示区域
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**API Key配置页面**</span>：API Key输入表单、配置保存功能、配置状态显示

<span class="hljs-section">### 2.3 页面详情</span>

| 页面名称        | 模块名称   | 功能描述                                     |
| ----------- | ------ | ---------------------------------------- |
| 首页          | 故事输入区域 | 提供文本输入框，用户输入故事开头（50-200字），包含输入提示和字数统计    |
| 首页          | 情节分支生成 | 调用GLM-4.6 API生成三个不同的情节分支概览，每个分支50-100字描述 |
| 首页          | 分支选择区域 | 展示三个情节分支选项，用户点击选择其中一个，包含分支预览和选择按钮        |
| 首页          | 详细情节生成 | 基于用户选择的分支调用GLM-4.6生成300-500字的详细情节内容      |
| 首页          | 故事树形展示 | 使用树形结构展示故事发展路径，高亮当前选择的分支，显示历史选择路径        |
| 首页          | 当前情节显示 | 展示当前生成的详细情节内容，包含继续创作和重新开始功能              |
| 首页          | 导航功能   | 提供返回上一步、重新开始、前往配置页面的导航按钮                 |
| API Key配置页面 | 配置表单   | 提供API Key输入框，包含输入验证和格式检查                 |
| API Key配置页面 | 本地存储   | 将API Key保存到localStorage，包含保存确认和清除功能      |
| API Key配置页面 | 配置状态   | 显示当前API Key配置状态，包含连接测试功能                 |

<span class="hljs-section">## 3. 核心流程</span>

<span class="hljs-strong">**主要用户操作流程：**</span>

<span class="hljs-bullet">1.</span> 用户访问首页，检查API Key配置状态
<span class="hljs-bullet">2.</span> 如未配置API Key，引导用户前往配置页面设置
<span class="hljs-bullet">3.</span> 用户在首页输入故事开头
<span class="hljs-bullet">4.</span> 系统调用GLM-4.6生成三个情节分支概览
<span class="hljs-bullet">5.</span> 用户选择其中一个分支
<span class="hljs-bullet">6.</span> 系统基于选择的分支生成详细情节内容
<span class="hljs-bullet">7.</span> 用户可以继续基于当前情节生成新的分支，或重新开始创作

<span class="hljs-strong">**GLM-4.6 API调用示例：**</span>

<span class="hljs-code">```javascript
const url = 'https://open.bigmodel.cn/api/paas/v4/chat/completions';

const options = {
  method: 'POST',
  headers: {
    Authorization: 'Bearer &lt;token&gt;', 
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    "model": "glm-4.6",
    "messages": [
      {
        "role": "system",
        "content": "你是一个专业的小说创作助手，擅长根据给定的故事开头创作引人入胜的情节发展。"
      },
      {
        "role": "user",
        "content": "请基于以下故事开头，生成三个不同的情节发展方向..."
      }
    ],
    "temperature": 1,
    "max_tokens": 65536,
    "stream": false
  })
};
```</span>

<span class="hljs-code">```mermaid
graph TD
  A[首页] --&gt; B{检查API Key}
  B --&gt;|未配置| C[API Key配置页面]
  B --&gt;|已配置| D[输入故事开头]
  C --&gt; E[保存API Key到localStorage]
  E --&gt; A
  D --&gt; F[生成三个情节分支]
  F --&gt; G[选择分支]
  G --&gt; H[生成详细情节]
  H --&gt; I[展示在故事树中]
  I --&gt; J{继续创作?}
  J --&gt;|是| F
  J --&gt;|否| K[重新开始]
  K --&gt; D
```</span>

<span class="hljs-section">## 4. 用户界面设计</span>

<span class="hljs-section">### 4.1 设计风格</span>

采用新粗野主义（Neo-Brutalism）设计风格，具体包括：

<span class="hljs-bullet">*</span> <span class="hljs-strong">**主色调**</span>：白色 (#FFFFFF) 作为背景色

<span class="hljs-bullet">*</span> <span class="hljs-strong">**强调色**</span>：橙色 (#FF6B35)、绿色 (#4ECDC4)、蓝色 (#45B7D1)

<span class="hljs-bullet">*</span> <span class="hljs-strong">**辅助色**</span>：深灰色 (#2C3E50)、浅灰色 (#BDC3C7)

<span class="hljs-bullet">*</span> <span class="hljs-strong">**按钮风格**</span>：粗边框、高对比度、方形设计，带有阴影效果

<span class="hljs-bullet">*</span> <span class="hljs-strong">**字体**</span>：粗体无衬线字体，主标题18-24px，正文14-16px

<span class="hljs-bullet">*</span> <span class="hljs-strong">**布局风格**</span>：网格化布局，明确的区块分割，大胆的色彩对比

<span class="hljs-bullet">*</span> <span class="hljs-strong">**图标风格**</span>：简洁的线性图标，配合品牌色彩

<span class="hljs-section">### 4.2 页面设计概览</span>

| 页面名称    | 模块名称   | UI元素                           |
| ------- | ------ | ------------------------------ |
| 首页      | 故事输入区域 | 白色背景的大型文本框，橙色边框，字数计数器，绿色提交按钮   |
| 首页      | 分支选择区域 | 三个并排的卡片，蓝色边框，悬停时橙色高亮，粗体标题      |
| 首页      | 故事树展示  | 深灰色背景，白色连接线，彩色节点（橙/绿/蓝），当前节点高亮 |
| 首页      | 情节内容区  | 白色背景，深灰色文字，绿色边框，滚动条样式定制        |
| 首页      | 导航按钮   | 粗边框按钮，不同功能使用不同颜色，悬停效果明显        |
| API配置页面 | 配置表单   | 居中布局，白色卡片，橙色输入框边框，大型保存按钮       |
| API配置页面 | 状态显示   | 彩色状态指示器，成功为绿色，错误为橙色，未配置为灰色     |

<span class="hljs-section">### 4.3 响应式设计</span>

产品采用桌面优先的响应式设计：

<span class="hljs-bullet">*</span> <span class="hljs-strong">**桌面端（1200px+）**</span>：三栏布局，故事树、内容区、分支选择并排显示

<span class="hljs-bullet">*</span> <span class="hljs-strong">**平板端（768px-1199px）**</span>：两栏布局，故事树折叠为抽屉式，主要显示内容区和分支选择

<span class="hljs-bullet">*</span> <span class="hljs-strong">**移动端（&lt;768px）**</span>：单栏布局，各模块垂直堆叠，优化触摸交互

<span class="hljs-bullet">*</span> <span class="hljs-strong">**交互优化**</span>：支持触摸手势，按钮尺寸适配移动端，文字大小自适应
</code></pre>
<p>技术架构文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dd36b9954a148b1b3f80b485fec76b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=g0obzgxngGqra1aSQbMGOVLK%2BQY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d56b97a8f35644e4a4cbb7582f951736~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=LM7Mi26pWljLPuPnnGl5O6mIJtM%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"># AI小说创作平台 - 技术架构文档

## <span class="hljs-number">1</span>. 架构设计

```mermaid
graph <span class="hljs-selector-tag">TD</span>
  <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[用户浏览器]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[React前端应用]</span>
  <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[GLM-4.6 API]</span>
  <span class="hljs-selector-tag">B</span> --&gt; D<span class="hljs-selector-attr">[LocalStorage]</span>

  subgraph "前端层"
    <span class="hljs-selector-tag">B</span>
    D
  end

  subgraph "外部服务"
    C
  end
```

## <span class="hljs-number">2</span>. 技术描述

- **前端**: React@<span class="hljs-number">18</span> + TypeScript + Vite + TailwindCSS
- **状态管理**: React Context + useReducer
- **HTTP客户端**: Fetch API
- **本地存储**: LocalStorage API
- **外部服务**: GLM-<span class="hljs-number">4.6</span> API (智谱AI)

## <span class="hljs-number">3</span>. 路由定义

| 路由 | 用途 |
|------|-----|
| / | 首页，故事创作主界面，包含输入区域、分支选择、故事树展示 |
| /config | API Key配置页面，用于设置和管理GLM-<span class="hljs-number">4.6</span>的API密钥 |

## <span class="hljs-number">4</span>. API定义

### <span class="hljs-number">4.1</span> GLM-<span class="hljs-number">4.6</span> API集成

**生成情节分支概览**
```
POST https://open.bigmodel.cn/api/paas/v4/chat/completions
```

请求参数:
| 参数名称 | 参数类型 | 是否必需 | 描述 |
|---------|---------|---------|------|
| model | string | true | 固定值 <span class="hljs-string">"glm-4.6"</span> |
| messages | array | true | 对话消息数组，包含系统提示和用户输入 |
| temperature | number | true | 生成随机性，设置为<span class="hljs-number">0.8</span>以保证创意性 |
| max_tokens | number | true | 最大生成token数，分支概览设置为<span class="hljs-number">200</span> |
| stream | boolean | true | 是否流式输出，设置为false |

响应参数:
| 参数名称 | 参数类型 | 描述 |
|---------|---------|------|
| choices | array | 生成的回复选项数组 |
| choices[<span class="hljs-number">0</span>].message.content | string | 生成的文本内容 |

**生成详细情节内容**
```
POST https://open.bigmodel.cn/api/paas/v4/chat/completions
```

请求参数:
| 参数名称 | 参数类型 | 是否必需 | 描述 |
|---------|---------|---------|------|
| model | string | true | 固定值 <span class="hljs-string">"glm-4.6"</span> |
| messages | array | true | 包含故事上下文和选择分支的消息数组 |
| temperature | number | true | 生成随机性，设置为<span class="hljs-number">0.7</span> |
| max_tokens | number | true | 最大生成token数，详细情节设置为<span class="hljs-number">800</span> |
| stream | boolean | true | 是否流式输出，设置为false |

示例请求:
```json
{
  "model": <span class="hljs-string">"glm-4.6"</span>,
  <span class="hljs-string">"messages"</span>: [
    {
      "role": <span class="hljs-string">"system"</span>,
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个专业的小说创作助手，擅长根据给定的故事开头和选择的情节方向创作引人入胜的详细情节。请生成300-500字的详细情节内容。"</span>
    },
    {
      "role": <span class="hljs-string">"user"</span>,
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"故事开头：[用户输入的开头] \n选择的情节方向：[用户选择的分支] \n请基于以上内容生成详细的情节发展。"</span>
    }
  ],
  "temperature": <span class="hljs-number">0.7</span>,
  <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">800</span>,
  <span class="hljs-string">"stream"</span>: false
}
```

### <span class="hljs-number">4.2</span> 本地存储API

**API Key管理**
```typescript
// 保存API Key
localStorage<span class="hljs-selector-class">.setItem</span>('glm_api_key', apiKey);

// 获取API Key
const apiKey = localStorage<span class="hljs-selector-class">.getItem</span>('glm_api_key');

// 删除API Key
localStorage<span class="hljs-selector-class">.removeItem</span>('glm_api_key');
```

**故事数据缓存**
```typescript
// 保存当前故事状态
localStorage<span class="hljs-selector-class">.setItem</span>('current_story', JSON<span class="hljs-selector-class">.stringify</span>(storyData));

// 获取故事状态
const storyData = JSON<span class="hljs-selector-class">.parse</span>(localStorage<span class="hljs-selector-class">.getItem</span>('current_story') || '{}');
```

## <span class="hljs-number">5</span>. 数据模型

### <span class="hljs-number">5.1</span> 数据模型定义

```mermaid
erDiagram
  STORY ||<span class="hljs-attr">--o</span>{ STORY_NODE : contains
  STORY_NODE ||--o{ BRANCH_OPTION : has
  
  STORY {
    string id PK
    string title
    string initialContent
    date createdAt
    string currentNodeId
  }
  
  STORY_NODE {
    string id PK
    string storyId FK
    string parentNodeId FK
    string <span class="hljs-attribute">content</span>
    int level
    boolean isSelected
    date createdAt
  }
  
  BRANCH_OPTION {
    string id PK
    string nodeId FK
    string title
    string description
    boolean isSelected
    int <span class="hljs-attribute">order</span>
  }
```

### <span class="hljs-number">5.2</span> TypeScript类型定义

```typescript
// 故事分支选项
interface BranchOption {
  id: string;
  title: string;
  description: string;
  isSelected: boolean;
  <span class="hljs-attribute">order</span>: number;
}

// 故事节点
interface StoryNode {
  id: string;
  parentNodeId?: string;
  <span class="hljs-attribute">content</span>: string;
  level: number;
  isSelected: boolean;
  createdAt: Date;
  branches?: BranchOption[];
}

// 完整故事数据
interface Story {
  id: string;
  title: string;
  initialContent: string;
  nodes: StoryNode[];
  currentNodeId?: string;
  createdAt: Date;
}

// API响应类型
interface GLMResponse {
  choices: Array&lt;{
    message: {
      <span class="hljs-attribute">content</span>: string;
      role: string;
    };
    finish_reason: string;
  }&gt;;
  usage: {
    prompt_tokens: number;
    completion_tokens: number;
    total_tokens: number;
  };
}

// 应用状态类型
interface AppState {
  story: Story | null;
  isLoading: boolean;
  error: string | null;
  apiKey: string | null;
  currentStep: <span class="hljs-string">'input'</span> | <span class="hljs-string">'branches'</span> | <span class="hljs-string">'content'</span>;
}
```

## <span class="hljs-number">6</span>. 组件架构

### <span class="hljs-number">6.1</span> 组件层次结构

```mermaid
graph <span class="hljs-selector-tag">TD</span>
  <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[App]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[Router]</span>
  <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[HomePage]</span>
  <span class="hljs-selector-tag">B</span> --&gt; D<span class="hljs-selector-attr">[ConfigPage]</span>
  
  C --&gt; E<span class="hljs-selector-attr">[StoryInput]</span>
  C --&gt; F<span class="hljs-selector-attr">[BranchSelector]</span>
  C --&gt; G<span class="hljs-selector-attr">[StoryTree]</span>
  C --&gt; H<span class="hljs-selector-attr">[ContentDisplay]</span>
  C --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[Navigation]</span>
  
  D --&gt; J<span class="hljs-selector-attr">[ApiKeyForm]</span>
  D --&gt; K<span class="hljs-selector-attr">[ConfigStatus]</span>
  
  subgraph "共享组件"
    L<span class="hljs-selector-attr">[Button]</span>
    M<span class="hljs-selector-attr">[Loading]</span>
    N<span class="hljs-selector-attr">[ErrorMessage]</span>
    O<span class="hljs-selector-attr">[Modal]</span>
  end
```

### <span class="hljs-number">6.2</span> 核心组件说明

**StoryInput组件**
- 功能：处理用户故事开头输入
- Props：onSubmit, isLoading, maxLength
- 状态：inputValue, charCount, validation

**BranchSelector组件**
- 功能：展示和选择情节分支
- Props：branches, onSelect, isLoading
- 状态：selectedBranch, hoverBranch

**StoryTree组件**
- 功能：树形展示故事发展路径
- Props：story, currentNodeId, onNodeClick
- 状态：expandedNodes, treeLayout

**ContentDisplay组件**
- 功能：显示当前情节内容
- Props：<span class="hljs-attribute">content</span>, isLoading, onContinue
- 状态：displayText, animationState

**ApiKeyForm组件**
- 功能：API Key配置和验证
- Props：onSave, initialValue
- 状态：apiKey, isValid, testResult

## <span class="hljs-number">7</span>. 状态管理

### <span class="hljs-number">7.1</span> Context设计

```typescript
// 故事状态Context
const StoryContext = createContext&lt;{
  state: AppState;
  dispatch: Dispatch&lt;StoryAction&gt;;
}&gt;({} as any);

// 配置状态Context
const ConfigContext = createContext&lt;{
  apiKey: string | null;
  setApiKey: (key: string) =&gt; void;
  isConfigured: boolean;
}&gt;({} as any);
```

### <span class="hljs-number">7.2</span> 状态更新流程

```mermaid
graph LR
  <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[用户操作]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[Action Dispatch]</span>
  <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[Reducer处理]</span>
  C --&gt; D<span class="hljs-selector-attr">[状态更新]</span>
  D --&gt; E<span class="hljs-selector-attr">[组件重渲染]</span>
  E --&gt; F<span class="hljs-selector-attr">[UI更新]</span>
```

## <span class="hljs-number">8</span>. 部署架构

### <span class="hljs-number">8.1</span> 构建配置

- **构建工具**: Vite
- **输出格式**: 静态HTML/CSS/JS文件
- **代码分割**: 路由级别的懒加载
- **资源优化**: 图片压缩、CSS/JS压缩

### <span class="hljs-number">8.2</span> 部署方案

- **推荐部署**: Vercel、Netlify等静态托管平台
- **备选方案**: GitHub Pages、云服务器静态托管
- **CDN加速**: 自动配置，提升全球访问速度
- **HTTPS**: 默认支持，确保API调用安全
</code></pre>
<h4 data-id="heading-9">开发调整</h4>
<p>检查完毕开发文档，发现确实按照自己所想的话，就可以直接让Solo根据文档进行开发了。如果文档有问题的话，可以手动进行调整，也可以让输入需求Solo进行调整。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efc62e52276443c4b0b84438f6a606a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=x3KVlYv11yZf9JE8V4y8uWPc%2FRQ%3D" alt="" loading="lazy"/></p>
<p>Solo不仅会自动定义需要实现的要点和任务，也会初始化项目基础架构，包括下载依赖，配置环境这些，Solo统统给你打包完成，根本不需要自己操心：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eee090585514739b334833272599eca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=BQJpnQLUq0zZVs6dX4tzPzrAxDA%3D" alt="" loading="lazy"/></p>
<p>Solo会严格按照自己指定的任务进行完成，如果我们再开发的过程中发现了Solo的方向不对，或者有需要补充的时候，可以直接打断Solo输入需求，因为Solo完全遵守上下文工程的理念的，不管从哪里开始，他都会项目目前各个信息整合之后进行开发，完全不用担心打断会对Solo的开发进度产生什么影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c0ff31fbb894fbeb5288c3ae095ef2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=V09D0CqvOxM2AiTtMI0HtMoUorE%3D" alt="" loading="lazy"/></p>
<p>开发完毕之后可以再内置浏览其中进行操作测试</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7efb5c78f8b4db0a2f77c905b4efe75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=WZjp%2BQhXU2%2BWPUwdarCNMbQEWfM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030785197e6244a7908d64d464289bb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=UUpj6HRSDcw%2BdKlM1k%2FS8EZXF64%3D" alt="" loading="lazy"/></p>
<p>但是我在测试的过程中发现，应用在API调用失败的时候会使用模拟数据，这是绝对不允许的，那么输入下方提示词让Solo给我改成回来！</p>
<pre><code class="hljs language-vbnet" lang="vbnet">项目中绝对不允许使用模拟数据，必须是AI生成的数据，API调用参考：
curl -X POST <span class="hljs-string">" https://open.bigmodel.cn/api/paas/v4/chat/completions "</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer your-api-key"</span> \
-d <span class="hljs-comment">'{</span>
<span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
<span class="hljs-string">"messages"</span>: [
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"作为一名营销专家，请为我的产品创作一个吸引人的口号"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"当然，要创作一个吸引人的口号，请告诉我一些关于您产品的信息"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"智谱AI 开放平台"</span>
}
],
<span class="hljs-string">"thinking"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
},
<span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">65536</span>,
<span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p>那么Solo在接收到修改需求之后，还是严格按照先定义任务列表，将大任务拆解成小任务一项一项的去完成任务这个理念：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9c2abe870ed41979b4c7d362aa94044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=pTLUtRyvGuLeIv6wxnkj6Akl%2B%2Fc%3D" alt="" loading="lazy"/></p>
<p>并且Solo在修改的过程中还会进行自测，确保我们想要的功能给到我们的时候是准备无误的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d870ee6fd789431da358605b887fce51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=fwu4XwXQAT6WDFLpEnX5lNv9amQ%3D" alt="" loading="lazy"/></p>
<p>这时候我又发现，在AI调用的过程中的超时时间太短了，导致AI报错，那么我们就可以直接点击控制台中的日志报错，添加到对话中，并给出具体的需求，这样Solo就会帮我们针对性的解决报错问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f58a0f040fa642498e77eb6ab97b2f3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=48ttEARqR93DldNfmL8QKcPgHTY%3D" alt="" loading="lazy"/></p>
<p>如果页面中还有什么不满意的地方，也可以继续让Solo继续改正，比如我发现在生成文章分支的时候只是一味的转圈等待，并没有进度条显示，这样的话用户就会干等着，会让用户体验感下降，我们就可以跟Solo说让他加上动态效果的进度条，让用户知道我们后台正在持续不断的运行中~</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5601d4a9f87249399da41ceafa732177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=sQO3ouHhUbOu6saz8R6V9Erfvf4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">部署展示</h3>
<p>所有的功能都按照自己的想法开发完毕之后，就可以进入到部署阶段。在 Trae Solo 中，Vercel 被深度集成作为默认的前端部署与托管平台，极大简化了从开发到上线的全流程。开发者只需在 Trae Solo 项目中完成基础配置（如框架类型、构建命令等），即可通过内置的 “Deploy to Vercel” 一键发布功能，将 React、Next.js 等现代前端应用快速部署至全球 CDN 网络。Vercel 提供的自动 HTTPS、边缘函数支持、预览部署（Preview Deployments）以及环境变量管理，与 Trae Solo 的 AI 辅助开发理念高度契合——不仅加速了迭代速度，还确保了生产环境的稳定性与安全性。此外，Vercel 的无缝 Git 集成（支持 GitHub、GitLab 等）使得每次代码推送都能自动触发构建与部署，真正实现“写完即上线”。对于像 AI 小说创作平台这类轻量级、静态优先的应用，Vercel 的免费套餐已完全满足需求，是 Trae Solo 推荐的高效、可靠部署方案。Trae Solo</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85004701916a48bea6f195810bc5a991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=MePdHAsRasoqVnhkogWsW9YHuGE%3D" alt="" loading="lazy"/></p>
<p>在Solo中只需一句话即可完成部署，而且整个过程是完全自动的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6656e6d77a284d51aa36eba00fb3dfd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=ckOv4zl3IAJRqDXmIeOf4H4Gn7w%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7fb9fb1f4fe4d698d3d542004cdb189~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=FqDowsnxm9R1RtbSYemf1LAn5yc%3D" alt="" loading="lazy"/></p>
<p>并且这时候可以再vercel的项目管理中看到项目的运行状态：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bca077e983a4af4ac8efde37ccb3497~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=2eO%2BcvVHEcCwAS8jPmF%2BjunwsTA%3D" alt="" loading="lazy"/></p>
<p>通过项目链接直接进入到项目中，在进入项目之前需要配置一下智谱的API KEY，这个操作在前文也提到过，这里不过多赘述：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df97f33926014518aa8df03457166770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=nX9jTdwL%2BhQXl7pM8d8sQzHjCUc%3D" alt="" loading="lazy"/></p>
<p>输入API KEY之后，点击测试配置，检验API KEY是否正确，或者账户余额是否充足，测试完毕之后即可保存设置</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7457fc1c0ad8414a951faba9a9689086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=zrzARiVds1Xt2hrgPUdM9HI%2BSws%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4566a0a4e4a748d3b8978b4a7038efb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=NDcm64SYINwJvMltxKip6VeKAlo%3D" alt="" loading="lazy"/></p>
<p>配置完毕之后，即可开启故事创作，那么需要自己先拟定一个故事标题，和故事的开头，然后点击生成故事分支</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab4b19c05bf40278bca9ae2621d2e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=HUt%2FVggabUrjgXPGbnywCMpT8c8%3D" alt="" loading="lazy"/></p>
<p>点击之后会先讲当前操作的内容保存到创作树中</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edd8c60f67644a2d81dae4c03d7c5a29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=lJTWbRi4CwUSPumiMMS6pEYbYW8%3D" alt="" loading="lazy"/></p>
<p>然后回到首页点击生成新分支</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd5fc87770f342ce96687ea5d9c19fe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=UQ6jmbHaP%2F4B82JVVTPxzky5VuU%3D" alt="" loading="lazy"/></p>
<p>可以看到进度量实时展示着创作的进度</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/961031dfe4694110a12a142074894456~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=WV2ZidW6Mg7UTBoQgV57ty2AqkM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/231842353d524b5caeede14be8ac8c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=SD9qDNxvRcQFmCVH033433XNcHg%3D" alt="" loading="lazy"/></p>
<p>不一会儿就生成出三个不同的故事分支</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006c48a2686f4cde86f426aa52ea908e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=sErmTbbOcHD7oLb%2BKer%2FNP3Yx2c%3D" alt="" loading="lazy"/></p>
<p>这里我们选择任一一个故事分支，点击生成分支的详细内容</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e55d13289204f6fbe6fb1f033fa3e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=YAZMySR9aKYzNRks7ln0CWj3qOE%3D" alt="" loading="lazy"/></p>
<p>可以看到生成的详细内容，可以说是很有创意性了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1aa2367abd2406487d21b039e38c786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=3bO6jIeWC7GG7697Sl%2B5Y5tZi%2BY%3D" alt="" loading="lazy"/></p>
<p>这时候再回到创作树中，可以看到刚刚选择的分支以及详情，这样不管创作多久也可以返回看到自己的创作历程</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fb147e3465a4a53b4bdea0e14bcf421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=aIsT3PiP6DmK8%2F9fdHgSvhH3OVQ%3D" alt="" loading="lazy"/></p>
<p>接下来就是不断重复这个过程，一遍又一遍选择新的分支，探索不同分支带来的不同结果，最后形成一篇小说</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb9c484e7d14f5199f32c668c6deba2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976360&amp;x-signature=sTntICxJeY3JKTGZSOBb56BDz78%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 一个小型游戏对象模型渐进式设计（三）——把能力再抽象一层，写一套“伤害计算器”框架]]></title>    <link>https://juejin.cn/post/7573336057481412614</link>    <guid>https://juejin.cn/post/7573336057481412614</guid>    <pubDate>2025-11-17T09:51:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573336057481412614" data-draft-id="7553867623856652298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 一个小型游戏对象模型渐进式设计（三）——把能力再抽象一层，写一套“伤害计算器”框架"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-17T09:51:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 一个小型游戏对象模型渐进式设计（三）——把能力再抽象一层，写一套“伤害计算器”框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:51:46.000Z" title="Mon Nov 17 2025 09:51:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么要“再抽象一层”</h2>
<p>上两篇我们已经用协议把“攻击”拆成了能力插件，但遗留了一个硬核问题：</p>
<ul>
<li>游戏前期用 <code>Int</code> 足够，后期为了避免除法误差想换成 <code>Double</code>，甚至金融级精度要用 <code>Decimal</code>；</li>
<li>如果给每种数值类型都复制一份协议，就会出现 <code>AttackableInt</code>、<code>AttackableDouble</code>…爆炸式增长。</li>
</ul>
<p>Swift 的泛型（Generic）+ 关联类型（associatedtype）可以“一次性”写出算法，然后让编译器在调用点自动生成对应版本的代码，既保证类型安全，又保持运行时零成本。</p>
<h2 data-id="heading-1">把 Attackable 升级成泛型协议</h2>
<ol>
<li>定义“数值”契约</li>
</ol>
<p>先约定一个“可运算、可比较”的基本协议，把 <code>+</code>、<code>*</code>、<code>/</code>、<code>&gt;</code> 等运算符包进去：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">NumericValue</span>: <span class="hljs-title class_">Comparable</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">+</span> (<span class="hljs-params">lhs</span>: <span class="hljs-keyword">Self</span>, <span class="hljs-params">rhs</span>: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">*</span> (<span class="hljs-params">lhs</span>: <span class="hljs-keyword">Self</span>, <span class="hljs-params">rhs</span>: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">/</span> (<span class="hljs-params">lhs</span>: <span class="hljs-keyword">Self</span>, <span class="hljs-params">rhs</span>: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-keyword">Self</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">&gt;</span> (<span class="hljs-params">lhs</span>: <span class="hljs-keyword">Self</span>, <span class="hljs-params">rhs</span>: <span class="hljs-keyword">Self</span>) -&gt; <span class="hljs-type">Bool</span>   <span class="hljs-comment">// 与标量乘</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">value</span>: <span class="hljs-type">Int</span>)                               <span class="hljs-comment">// 能从整数字面量初始化</span>
}
</code></pre>
<ol start="2">
<li>让标准库类型自动符合</li>
</ol>
<p>Swift 5.7 之后可以用 <code>extension</code> 给标准库类型“批量”实现：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Int</span>: <span class="hljs-title class_">NumericValue</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Double</span>: <span class="hljs-title class_">NumericValue</span> {}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Decimal</span>: <span class="hljs-title class_">NumericValue</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">*</span>(<span class="hljs-params">lhs</span>: <span class="hljs-type">Decimal</span>, <span class="hljs-params">rhs</span>: <span class="hljs-type">Double</span>) -&gt; <span class="hljs-type">Decimal</span> {
        lhs <span class="hljs-operator">*</span> <span class="hljs-type">Decimal</span>(rhs)
    }
}
</code></pre>
<p>（<code>Float</code>、<code>CGFloat</code> 同理）</p>
<ol start="3">
<li>泛型版 Attackable</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Value</span>: <span class="hljs-type">NumericValue</span>   <span class="hljs-comment">// ① 关联类型</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Value</span>
}
</code></pre>
<p>注意：</p>
<p>① 这里不能再给 <code>attack()</code> 提供默认实现，因为返回类型是泛型，不同数值的“默认伤害”语义不同；</p>
<p>② 如果确实想提供默认，可以再包一层泛型扩展</p>
<h2 data-id="heading-2">给“默认伤害”一个泛型实现</h2>
<p>利用协议扩展的“where 子句”只对特定数值生效：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Attackable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Value</span> == <span class="hljs-title class_">Double</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Value</span> { <span class="hljs-number">10.0</span> }
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Attackable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Value</span> == <span class="hljs-title class_">Int</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Value</span> { <span class="hljs-number">10</span> }
}
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Attackable</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">Value</span> == <span class="hljs-title class_">Decimal</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Value</span> { <span class="hljs-type">Decimal</span>(<span class="hljs-number">10</span>) }
}
</code></pre>
<p>这样任何符合者只要 <code>Value</code> 是上述三种之一，不实现 <code>attack()</code> 也能编译通过；想定制就再写一遍覆盖即可。</p>
<h2 data-id="heading-3">把“伤害计算器”也做成泛型组件</h2>
<p>需求：</p>
<ul>
<li>支持“暴击”、“易伤”、“免伤”多层修正；</li>
<li>算法写一次，对 <code>Int / Double / Decimal</code> 全部生效；</li>
<li>编译期决定类型，无运行时派发。</li>
</ul>
<ol>
<li>定义计算器协议</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">DamageCalculator</span>&lt;<span class="hljs-title class_">Value</span>&gt; {
    <span class="hljs-keyword">associatedtype</span> <span class="hljs-type">Value</span>: <span class="hljs-type">NumericValue</span>
    <span class="hljs-comment">/// 传入基础伤害，返回最终伤害</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">base</span>: <span class="hljs-type">Value</span>) -&gt; <span class="hljs-type">Value</span>
}
</code></pre>
<ol start="2">
<li>默认实现：暴击 * 1.5</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CritCalculator</span>&lt;<span class="hljs-title class_">Value</span>: <span class="hljs-title class_">NumericValue</span>&gt;: <span class="hljs-title class_">DamageCalculator</span> {
    <span class="hljs-keyword">let</span> rate: <span class="hljs-type">Value</span>   <span class="hljs-comment">// 暴击倍率</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">base</span>: <span class="hljs-type">Value</span>) -&gt; <span class="hljs-type">Value</span> {
        base <span class="hljs-operator">*</span> rate
    }
}
</code></pre>
<ol start="3">
<li>链式组合：装饰器模式</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MultiplierCalculator</span>&lt;<span class="hljs-title class_">Value</span>: <span class="hljs-title class_">NumericValue</span>&gt;: <span class="hljs-title class_">DamageCalculator</span> {
    <span class="hljs-keyword">let</span> upstream: <span class="hljs-keyword">any</span> <span class="hljs-type">DamageCalculator</span>&lt;<span class="hljs-type">Value</span>&gt;  <span class="hljs-comment">// 上游计算器</span>
    <span class="hljs-keyword">let</span> multiplier: <span class="hljs-type">Double</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">base</span>: <span class="hljs-type">Value</span>) -&gt; <span class="hljs-type">Value</span> {
        <span class="hljs-keyword">let</span> upstreamDamage <span class="hljs-operator">=</span> upstream.calculate(base: base)
        <span class="hljs-keyword">return</span> upstreamDamage <span class="hljs-operator">*</span> multiplier
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> crit: <span class="hljs-keyword">any</span> <span class="hljs-type">DamageCalculator</span>&lt;<span class="hljs-type">Double</span>&gt; <span class="hljs-operator">=</span> <span class="hljs-type">CritCalculator</span>(rate: <span class="hljs-number">1.5</span>)
<span class="hljs-keyword">let</span> vulnerable <span class="hljs-operator">=</span> <span class="hljs-type">MultiplierCalculator</span>(upstream: crit, multiplier: <span class="hljs-number">1.2</span>)  <span class="hljs-comment">// 易伤 +20%</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword">final</span> <span class="hljs-operator">=</span> vulnerable.calculate(base: <span class="hljs-number">100</span>)   <span class="hljs-comment">// 100 * 1.5 * 1.2 = 180.0</span>
</code></pre>
<h2 data-id="heading-4">把计算器塞进实体——“能力注入”</h2>
<p>我们不再让实体“继承”伤害逻辑，而是把计算器当成属性注入：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Warrior</span>&lt;<span class="hljs-title class_">Value</span>: <span class="hljs-title class_">NumericValue</span>&gt;: <span class="hljs-title class_">Attackable</span> {
    <span class="hljs-keyword">let</span> calculator: <span class="hljs-keyword">any</span> <span class="hljs-type">DamageCalculator</span>&lt;<span class="hljs-type">Value</span>&gt;
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">attack</span>() -&gt; <span class="hljs-type">Value</span> {
        <span class="hljs-keyword">let</span> base: <span class="hljs-type">Value</span> <span class="hljs-operator">=</span> <span class="hljs-type">Value</span>(<span class="hljs-number">50</span>)        <span class="hljs-comment">// 自己定基础值</span>
        <span class="hljs-keyword">return</span> calculator.calculate(base: base)
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> warriorD <span class="hljs-operator">=</span> <span class="hljs-type">Warrior</span>&lt;<span class="hljs-type">Double</span>&gt;(calculator: vulnerable)
<span class="hljs-built_in">print</span>(warriorD.attack())   <span class="hljs-comment">// 90.0</span>
</code></pre>
<h2 data-id="heading-5">一个文件里同时玩三种精度</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> wInt    <span class="hljs-operator">=</span> <span class="hljs-type">Warrior</span>&lt;<span class="hljs-type">Int</span>&gt;(calculator: <span class="hljs-type">CritCalculator</span>(rate: <span class="hljs-number">2</span>))
<span class="hljs-keyword">let</span> wDouble <span class="hljs-operator">=</span> <span class="hljs-type">Warrior</span>&lt;<span class="hljs-type">Double</span>&gt;(calculator: <span class="hljs-type">CritCalculator</span>(rate: <span class="hljs-number">2</span>))
<span class="hljs-keyword">let</span> wDec    <span class="hljs-operator">=</span> <span class="hljs-type">Warrior</span>&lt;<span class="hljs-type">Decimal</span>&gt;(calculator: <span class="hljs-type">CritCalculator</span>(rate: <span class="hljs-number">2</span>))

<span class="hljs-built_in">print</span>(wInt.attack())     <span class="hljs-comment">// 100</span>
<span class="hljs-built_in">print</span>(wDouble.attack())  <span class="hljs-comment">// 100.0</span>
<span class="hljs-built_in">print</span>(wDec.attack())     <span class="hljs-comment">// 100</span>
</code></pre>
<p>同一套算法，编译器自动生成三份特化（specialization）代码，运行时无盒子、无动态派发。</p>
<h2 data-id="heading-6">性能实测：零开销承诺是否兑现？</h2>
<p>测试环境：M1 Mac / Swift 5.9 / -O 优化</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> p <span class="hljs-operator">=</span> <span class="hljs-type">Warrior</span>&lt;<span class="hljs-type">Double</span>&gt;(calculator: <span class="hljs-type">CritCalculator</span>(rate: <span class="hljs-number">1.8</span>))
measure {
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-number">1_000_000</span> { <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> p.attack() }
}
</code></pre>
<p>结果：</p>
<ul>
<li>泛型特化版本：0.047 s</li>
<li>手写 <code>Double</code> 专用版本：0.046 s</li>
</ul>
<p>差距在 2% 以内，属于测量误差；汇编层面已无线程堆分配、无 protocol witness 调用。</p>
<h2 data-id="heading-7">什么时候回到引用语义？</h2>
<ol>
<li>计算器需要状态缓存（如随机种子、CD 计时）且要共享；</li>
<li>需要继承 NSObjec 以兼容 KVO / Core Data；</li>
<li>需要互斥锁、原子引用计数。</li>
</ol>
<p>其余场景继续 <code>struct + 泛型协议</code>。</p>
<h2 data-id="heading-8">最终决策清单（速查表）</h2>



































<table><thead><tr><th>需求场景</th><th>首选方案</th><th>备选方案</th></tr></thead><tbody><tr><td>只是多态</td><td>protocol 默认实现</td><td>class + override</td></tr><tr><td>多精度算法</td><td>泛型 protocol + associatedtype</td><td>宏/模板代码生成</td></tr><tr><td>共享可变状态</td><td>class</td><td>actor</td></tr><tr><td>值语义 + 组合</td><td>struct + protocol</td><td>无</td></tr><tr><td>运行时动态替换</td><td>class + objc</td><td>SwiftUI 的 AnyView 类型擦除</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[技术融合创新：Trae+KAT-Coder+GLM-4.6打造医疗报告翻译官]]></title>    <link>https://juejin.cn/post/7573332163388735542</link>    <guid>https://juejin.cn/post/7573332163388735542</guid>    <pubDate>2025-11-17T09:24:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573332163388735542" data-draft-id="7573300346263224374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="技术融合创新：Trae+KAT-Coder+GLM-4.6打造医疗报告翻译官"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-17T09:24:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_摘星_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            技术融合创新：Trae+KAT-Coder+GLM-4.6打造医疗报告翻译官
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _摘星_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:24:33.000Z" title="Mon Nov 17 2025 09:24:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93943b9c97b1427f8dc0bf354f1413ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=UjBKZ1XJm4Toa7xhsn848EU7QNc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">技术融合创新：Trae+KAT-Coder+GLM-4.6打造医疗报告翻译官</h2>
<h3 data-id="heading-1">摘要</h3>
<p>作为这款“医疗报告翻译官”应用的开发者，我深切体会到技术真正落地于生活痛点时的力量。面对父母辈拿着体检单一脸茫然的样子，我决定用自己手中的工具做点什么——于是，我将字节的 Trae IDE 作为开发主战场，接入快手 KAT-Coder 强大的代码生成与智能代理能力，并融合智谱 GLM-4.6 的语言理解与 GLM-4.5V 的视觉识别优势，构建出一个能“看懂报告、说得明白”的AI助手。从一句提示词出发，到完整项目自动生成、本地调试、反复迭代，整个过程高效而充满成就感。最终，这个应用不仅能把“低密度脂蛋白”变成“血管里的垃圾车”，更让医学知识不再高不可攀——这是我作为一名开发者，送给普通用户、尤其是中老年群体的一份技术温度。</p>
<h3 data-id="heading-2">产品展示</h3>
<p>进入到首页</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e7a14b75f1439083488ea78b17a894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=yx4Sk7AX3aY32Q%2Fe9rGZhh1REvs%3D" alt="" loading="lazy"/></p>
<p>首先要设置GLM密钥，才能使用后续的GLM4.6和GLM4.5V服务</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0aa07e165364b1ba45b87781a708491~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=ipMj7qYkp7ie2q%2Fkl9Pk9FafK1Y%3D" alt="" loading="lazy"/></p>
<p>这里我们将这个病例单上传到应用中</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3098677e7f8d41db9ded2683052efea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=2Mm7DP5KH0NptXp6KZSGNvTDnA8%3D" alt="" loading="lazy"/></p>
<p>GLM4.5V开始识别图片</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/873e91b30c514d46866bd3fbfd732672~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=z9yDAr4Bgz5TKUQ1F9l1shaMiAA%3D" alt="" loading="lazy"/></p>
<p>识别完毕之后还会对原有的内容进行一个结构化的内容输出</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b65b001db12a4a7baabd22cb7fadfbf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=Y9%2Foq2Hcv3CJ9%2B7jv4ruU4cpOn4%3D" alt="" loading="lazy"/>点击继续翻译直接跳转到文本翻译中，当然这里也可以自己输入内容：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc4f4ec38da641b59d90ead8a7b1b20f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=ZkkeNfPU5C1ZEkGj958ziUu%2BIS4%3D" alt="" loading="lazy"/></p>
<p>点击开始翻译会就将晦涩难懂的内容给翻译成通俗易懂的内容：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ba38b51ac964a7e89d342c866e9960c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=5qdMAKVxCVJZJU2lLbM87h3cFBg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db7b9f959f844d278c564d080302c064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=%2FocLrEyecJvfyWe9Qrdqi72K4DQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1491d193689a4052a356e262937d9d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=c6DvHYwIg%2FeSGOB%2F0Wm1FqrJfPk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">项目背景</h3>
<p>在当今医疗健康领域，医患沟通不畅已成为普遍问题。患者面对检查报告中的专业医学术语如"低密度脂蛋白胆固醇"、"C反应蛋白"等时，往往难以理解，这种信息不对称不仅影响健康管理决策，还可能导致不必要的焦虑和延误治疗。</p>
<p>据统计，超过60%的患者无法准确理解医疗报告中的关键指标，约40%的患者因此延误必要医疗干预。传统解决方案如医生口头解释或在线查询，存在时效性差、个性化不足等问题，尤其在医疗资源紧张的情况下难以满足需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1287119c3dbe4feeb7e36d513f53c3c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=BoTLRyWdtRNnpMy0IiIVBgqYenw%3D" alt="" loading="lazy"/></p>
<p>随着大语言模型技术的突破，AI为解决这一痛点提供了新可能。本项目旨在构建智能医疗报告翻译官应用，通过先进AI模型将专业医学术语转化为生活化语言，为患者提供即时、准确、易懂的报告解读服务，让专业医学知识变得触手可及。</p>
<h3 data-id="heading-4">KAT-Coder</h3>
<p>KAT-Coder官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.streamlake.com%2Fproduct%2Fkat-coder" target="_blank" title="https://www.streamlake.com/product/kat-coder" ref="nofollow noopener noreferrer">www.streamlake.com/product/kat…</a></p>
<p>KAT-Coder-Pro-V1是快手旗下StreamLake平台推出的一款顶级编码AI助手，代表了当前AI编程领域的最先进水平。 该模型在SWE-Bench评测中获得了73.4%的解决率，这一成绩甚至超过了GPT-5和Claude Sonnet 4等国际知名模型，展示了其在复杂任务处理方面的卓越能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d701028af128490bb0729e7570522077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=UF7XJ460gm7kRXVfST6SZPrT1ew%3D" alt="" loading="lazy"/></p>
<p>KAT-Coder-Pro-V1的核心优势在于其先进的智能代理能力。该模型支持多工具并行调用，能够自主完成复杂任务，这种能力对于构建医疗报告翻译官这样需要多步骤处理的应用至关重要。 在实际应用中，KAT-Coder-Pro-V1生成的代码不仅可以直接运行，还展现出较为成熟的工程化水平，包括前端界面设计、内置应用集成等，这为快速构建完整的医疗应用提供了强大支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ea1809806384acab79a91d047e56c0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=Db3hznXcPm%2F3BqpcGBOyc%2B5Mv1s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">Trae</h3>
<p>Trae官网：<a href="https://www.trae.ai/" target="_blank" title="https://www.trae.ai/" ref="nofollow noopener noreferrer">www.trae.ai/</a></p>
<p>Trae是由字节跳动推出的一款AI驱动的智能集成开发环境（IDE），旨在通过人工智能技术显著提升软件开发效率。 作为一款现代化的AI编程助手，Trae不仅支持主流的AI模型如Anthropic和OpenAI，还提供了强大的自定义模型集成能力，这使其成为构建专业领域AI应用的理想平台。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c64605228e844f1b4155a5659f79f1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=yRK0rkYy%2BQatTqbWVndqdb1sFFI%3D" alt="" loading="lazy"/></p>
<p>Trae对OpenRouter等开放平台的支持，这为开发者提供了更大的灵活性，使其能够根据具体需求选择和集成最适合的AI模型。 同时，社区正在积极推动对自定义模型服务商base_url的支持能力，这将进一步增强Trae在企业级应用中的适应性。这些特性使得Trae成为连接自定义AI模型（如KAT-Coder-Pro-V1）与专业应用场景（如医疗报告翻译）的理想桥梁，为我们的项目提供了坚实的技术基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12a7ba79f1894defa4a8035f452bfb61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=2dRomH3ncH51%2BXiOvQApT%2FxNhX4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">Trae接入自定义模型KAT-Coder</h3>
<p>官方文档参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKXSRoBaME_Wvv2wlRZ_FaA" target="_blank" title="https://mp.weixin.qq.com/s/KXSRoBaME_Wvv2wlRZ_FaA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/KXSRoBaME…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f08abee52b174284bd2e2eed7afb06bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=kGMrgH1HX7H%2FZq%2F9QOa8xYb3224%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">获取API Key</h4>
<p>访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnovita.ai%2Fsettings%2Fkey-management" target="_blank" title="https://novita.ai/settings/key-management" ref="nofollow noopener noreferrer">novita.ai/settings/ke…</a>novita.ai服务商点击密钥管理</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0a2577f207a4cbcbcd21e79d40003b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=etaQg8ggsNNuuSD%2FiTWlOZk5BsM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">接入Trae</h4>
<p>Trae中点击【设置】-【模型】-【自定义模型】</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad7b15e4334447a8dbdadc5f935e0d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=xe2aiiMQTw%2BnJXe7lNC303vEmZg%3D" alt="" loading="lazy"/></p>
<p>选择novita.ai服务商，模型输入kat-coder，密钥就是刚刚创建的密钥</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8128fe0fb5414c0bb7d4003fba84fea7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=iurHxI5cnV2otKA10Hjne5RE2XE%3D" alt="" loading="lazy"/></p>
<p>自定义模型kat-coder加入成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a9dc43699c442d9b7066bc8eedc273e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=VMz91FWxkvwvFeSa8wUZzCMQuVc%3D" alt="" loading="lazy"/></p>
<p>在对话中选择Kat-coder</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffd741ad816d4dab92a04e487229e52a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=mMlaZn%2F9%2FCt%2BBDsKrTHyy9IyI3c%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">智谱大模型</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2F" target="_blank" title="https://www.bigmodel.cn/" ref="nofollow noopener noreferrer">智谱AI</a>（Zhipu AI）是中国领先的大模型技术公司，致力于推动通用人工智能（AGI）的发展。其自主研发的GLM（General Language Model）系列大模型，凭借强大的语言理解与生成能力、多模态融合能力以及高效的推理性能，已在学术界和产业界获得广泛认可。</p>
<p>在医疗报告翻译官应用中，我们采用GLM-4.6与GLM-4.5V双模型协同架构，分别负责语言理解和视觉识别两大核心功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/246130590e974d9da4d7e948b3d61096~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=RCq4HwHS%2B5Mtca1T0FJ3EftBh88%3D" alt="" loading="lazy"/></p>
<p>GLM-4.6作为智谱AI的旗舰语言模型，采用355B参数的混合专家架构，拥有200K超长上下文处理能力，稳居国内模型性能榜首。 该模型在工具使用和代理任务方面表现卓越，能高效集成到复杂的工作流中，特别适合将专业医疗术语转化为生活化表达。 其token消耗比前代降低30%，为实时交互提供了成本效益保障。</p>
<p>GLM-4.5V则是专为视觉任务设计的开源多模态模型，在42个视觉语言基准测试中表现优异。 该模型具备强大的OCR能力，能够精准提取医疗报告图像中的文字内容，包括复杂的医学图表和手写体。 在医疗影像分析方面，GLM-4.5V能精确定位图像中的关键元素，为后续的语言解释提供准确的视觉输入。</p>
<p>双模型协同工作流程为：GLM-4.5V负责处理用户上传的纸质或电子报告图片，通过OCR技术提取文本内容；GLM-4.6则接收提取的文本，将专业医学术语转化为通俗易懂的日常表达。 这种分工模式充分发挥了各自优势，确保系统既能"看得清"报告内容，又能"说得懂"医学含义，为患者提供无缝的医疗报告解读体验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b7f27517345433ca1f70b2be2ee8ceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=%2Fjo3WohWHAXYHt1KOQM44WKFkPY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">获取API KEY</h4>
<p>在智谱AI开放平台的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fusercenter%2Fproj-mgmt%2Fapikeys" target="_blank" title="https://www.bigmodel.cn/usercenter/proj-mgmt/apikeys" ref="nofollow noopener noreferrer">控制台</a>中，即可添加账号的API KEY</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8644bb20b9a348218f8d470ef90a821f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=YngpTsJ%2BPBv%2FePJnZyxnXdssrB8%3D" alt="" loading="lazy"/></p>
<p>添加完之后需要使用的时候直接复制API KEY即可</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c844a16587443aebe38f8cfb4fc4f72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=Jm0RQ6%2FYS89laq53BlSh6733KTY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">GLM-4.6</h4>
<p>智谱最新旗舰，代码能力全面对齐 Claude Sonnet 4，是国内最好的编程模型。在真实编程、长上下文处理、推理能力、信息搜索、写作能力与智能体应用等多个方面实现全面提升。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99b5860fe92f4e2f9a655f179c064cfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=t4M7gUJDRaPlCkKqatau2kj%2BTK8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/141ad591f4b94e6a80806b8d0043a307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=Ckh8JR0ahM3Ri%2BXMhaLsDaBUfBU%3D" alt="" loading="lazy"/></p>
<p>GLM-4.6调用示例</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
    -H <span class="hljs-string">"Content-Type: application/json"</span> \
    -H <span class="hljs-string">"Authorization: Bearer your-api-key"</span> \
    -d <span class="hljs-comment">'{</span>
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
        <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"作为一名营销专家，请为我的产品创作一个吸引人的口号"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"当然，要创作一个吸引人的口号，请告诉我一些关于您产品的信息"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"智谱AI 开放平台"</span>
        }
            ],
            <span class="hljs-string">"thinking"</span>: {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
        },
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">65536</span>,
            <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>
        }<span class="hljs-comment">'</span>
</code></pre>
<h4 data-id="heading-12">GLM-4.5V</h4>
<p>GLM-4.5V 是智谱新一代基于 MOE 架构的视觉推理模型，以 106B 的总参数量和 12B 激活参数量，在各类基准测试中达到全球同级别开源多模态模型 SOTA，涵盖图像、视频、文档理解及 GUI 任务等常见任务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b85eec11df3425ca128370d4f9c8536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=fTLtcoDp3wjPiKTKI1w2M3xS%2Bb8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0a52341548740a58dceb6b1b33a0a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=towuAW%2BYwiRNjbb23QXQkh%2FWpTU%3D" alt="" loading="lazy"/></p>
<p>调用示例</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -X POST \
  https:<span class="hljs-comment">//open.bigmodel.cn/api/paas/v4/chat/completions \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.5v"</span>,
    <span class="hljs-string">"messages"</span>: [
      {
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
        <span class="hljs-string">"content"</span>: [
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
              <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://cloudcovert-1305175928.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87grounding.PNG"</span>
            }
          },
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"Where is the second bottle of beer from the right on the table?  Provide coordinates in [[xmin,ymin,xmax,ymax]] format"</span>
          }
        ]
      }
    ],
    <span class="hljs-string">"thinking"</span>: {
      <span class="hljs-string">"type"</span>:<span class="hljs-string">"enabled"</span>
    }
  }'
</code></pre>
<h3 data-id="heading-13">开发实践</h3>
<h4 data-id="heading-14">开发提示词</h4>
<p>准备好开发提示词并输入：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">我要做一个医疗报告翻译官应用，目的是解决中老年人看不懂纸质病例上的专业医学术语
功能：
<span class="hljs-number">1</span>、语言交互：输入检查报告结论，调用GLM-<span class="hljs-number">4.6</span>用生活化语言解释指标意义，也就是说将繁琐的医疗术语翻译成普通人都能听得懂的样子（如“低密度脂蛋白=血管垃圾车”），翻译出的语言用精美柔和的卡片风格展示。
<span class="hljs-number">2</span>、视觉交互：拍照上传医院的纸质报告单或者电子报告单，调用GLM-<span class="hljs-number">4.5</span>V识别文字后，再重复语言交互的过程
<span class="hljs-number">3</span>、GLM的密钥存放在localstorage中，每次进入页面的时候需要在设置中手动输入，设置中包含测试链接的按钮
<span class="hljs-number">4</span>、整体以医疗极简风格，使用低饱和的辅助色（如蓝、绿）：蓝色代表信任与科技，绿色代表健康与安心，避免使用红色、橙色等刺激性暖色
GLM4.<span class="hljs-number">6</span>接入示例：
curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
    -H <span class="hljs-string">"Content-Type: application/json"</span> \
    -H <span class="hljs-string">"Authorization: Bearer your-api-key"</span> \
    -d <span class="hljs-comment">'{</span>
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
        <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"作为一名营销专家，请为我的产品创作一个吸引人的口号"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"当然，要创作一个吸引人的口号，请告诉我一些关于您产品的信息"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"智谱AI 开放平台"</span>
        }
            ],
            <span class="hljs-string">"thinking"</span>: {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
        },
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">65536</span>,
            <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>
        }<span class="hljs-comment">'</span>
GLM4.<span class="hljs-number">5</span>V接入示例：
curl -X POST \
  https://open.bigmodel.cn/api/paas/v4/chat/completions \
  -H <span class="hljs-string">"Authorization: Bearer your-api-key"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.5v"</span>,
    <span class="hljs-string">"messages"</span>: [
      {
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
        <span class="hljs-string">"content"</span>: [
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
              <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://cloudcovert-1305175928.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87grounding.PNG"</span>
            }
          },
          {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"Where is the second bottle of beer from the right on the table?  Provide coordinates in [[xmin,ymin,xmax,ymax]] format"</span>
          }
        ]
      }
    ],
    <span class="hljs-string">"thinking"</span>: {
      <span class="hljs-string">"type"</span>:<span class="hljs-string">"enabled"</span>
    }
  }<span class="hljs-comment">'</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7d384bb83af44a8b0116bcf350d2803~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=OMv4QHOG%2BcY5Sm7XWoXGNq7zzx0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">开发文档</h4>
<p>我会先让其生成开发文档，这样不会在后续的过程中走偏方向，以下是文档的具体内容：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 1. 产品概述</span>
医疗报告翻译官应用旨在帮助中老年人理解纸质病历上的专业医学术语，将复杂的医疗报告转化为通俗易懂的生活化语言。

通过AI技术将医疗术语翻译成形象的比喻（如"低密度脂蛋白=血管垃圾车"），让普通用户能够轻松理解自己的健康状况。

<span class="hljs-section">## 2. 核心功能</span>

<span class="hljs-section">### 2.1 用户角色</span>
| 角色 | 注册方式 | 核心权限 |
|------|----------|----------|
| 普通用户 | 无需注册，直接使用 | 文本输入翻译、图片上传识别、API密钥设置 |

<span class="hljs-section">### 2.2 功能模块</span>
应用包含以下主要页面：
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**首页**</span>：功能选择、使用引导、最近翻译记录
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**文本翻译页**</span>：医疗术语输入、翻译结果展示、收藏功能
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**图片识别页**</span>：拍照上传、图片预览、识别结果展示
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**设置页**</span>：API密钥输入、测试连接、使用说明

<span class="hljs-section">### 2.3 页面详情</span>
| 页面名称 | 模块名称 | 功能描述 |
|-----------|-------------|-------------|
| 首页 | 功能选择区 | 显示文本翻译和图片识别两个主要功能入口，使用大图标和简洁文字说明 |
| 首页 | 使用引导 | 展示应用使用步骤，帮助用户快速上手 |
| 首页 | 最近记录 | 显示最近5条翻译记录，点击可查看详情 |
| 文本翻译页 | 输入区域 | 多行文本框输入医疗报告结论，支持粘贴和清空操作 |
| 文本翻译页 | 翻译按钮 | 调用GLM-4.6 API进行翻译，显示加载状态 |
| 文本翻译页 | 结果展示 | 精美卡片展示翻译结果，包含原文和通俗解释 |
| 文本翻译页 | 收藏功能 | 支持收藏常用翻译结果，本地存储 |
| 图片识别页 | 拍照上传 | 支持拍照和从相册选择，图片压缩和预览 |
| 图片识别页 | 识别过程 | 显示识别进度，调用GLM-4.5V API提取文字 |
| 图片识别页 | 结果确认 | 展示识别的文字内容，用户可编辑修正 |
| 图片识别页 | 翻译跳转 | 识别完成后跳转到文本翻译页继续翻译 |
| 设置页 | API密钥设置 | 输入GLM API密钥，本地存储在localStorage |
| 设置页 | 连接测试 | 测试API连接状态，显示成功或失败提示 |
| 设置页 | 使用说明 | 详细的应用使用指南和注意事项 |

<span class="hljs-section">## 3. 核心流程</span>

<span class="hljs-section">### 文本翻译流程</span>
<span class="hljs-bullet">1.</span> 用户在文本翻译页输入医疗报告结论
<span class="hljs-bullet">2.</span> 点击翻译按钮，调用GLM-4.6 API
<span class="hljs-bullet">3.</span> API返回生活化语言解释
<span class="hljs-bullet">4.</span> 以精美卡片形式展示翻译结果
<span class="hljs-bullet">5.</span> 用户可选择收藏或分享

<span class="hljs-section">### 图片识别翻译流程</span>
<span class="hljs-bullet">1.</span> 用户在图片识别页拍照或选择图片
<span class="hljs-bullet">2.</span> 图片预览和压缩处理
<span class="hljs-bullet">3.</span> 调用GLM-4.5V API识别图片中的文字
<span class="hljs-bullet">4.</span> 展示识别结果，用户可编辑修正
<span class="hljs-bullet">5.</span> 将修正后的文本发送到文本翻译流程

<span class="hljs-code">```mermaid
graph TD
    A[首页] --&gt; B[文本翻译页]
    A --&gt; C[图片识别页]
    C --&gt; D[图片预览]
    D --&gt; E[文字识别]
    E --&gt; F[识别结果确认]
    F --&gt; B
    B --&gt; G[翻译结果展示]
    A --&gt; H[设置页]
    H --&gt; I[API密钥配置]
    I --&gt; J[连接测试]
```</span>

<span class="hljs-section">## 4. 用户界面设计</span>

<span class="hljs-section">### 4.1 设计风格</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**主色调**</span>：低饱和度蓝色 (#4A90E2) - 代表信任与科技
<span class="hljs-bullet">-</span> <span class="hljs-strong">**辅助色**</span>：低饱和度绿色 (#7ED321) - 代表健康与安心
<span class="hljs-bullet">-</span> <span class="hljs-strong">**背景色**</span>：浅灰色 (#F5F7FA) - 营造医疗专业感
<span class="hljs-bullet">-</span> <span class="hljs-strong">**按钮样式**</span>：圆角矩形，柔和阴影，悬停效果
<span class="hljs-bullet">-</span> <span class="hljs-strong">**字体**</span>：思源黑体，主标题18px，正文14px，小字12px
<span class="hljs-bullet">-</span> <span class="hljs-strong">**布局风格**</span>：卡片式布局，大间距，简洁明了
<span class="hljs-bullet">-</span> <span class="hljs-strong">**图标风格**</span>：线性图标，简洁易懂

<span class="hljs-section">### 4.2 页面设计概述</span>
| 页面名称 | 模块名称 | UI元素 |
|-----------|-------------|-------------|
| 首页 | 功能选择区 | 两个大圆形按钮，蓝色和绿色渐变，中央放置图标和文字，按钮间距充足 |
| 首页 | 使用引导 | 三步流程图，使用柔和的绿色连接线，每步配有简洁图标 |
| 首页 | 最近记录 | 白色卡片列表，显示原文摘要和翻译时间，右侧箭头指示 |
| 文本翻译页 | 输入区域 | 浅蓝色边框的文本域，圆角设计，支持自动高度调整 |
| 文本翻译页 | 翻译按钮 | 绿色渐变按钮，圆形设计，包含翻译图标 |
| 文本翻译页 | 结果展示 | 精美的白色卡片，蓝色标题栏，内部展示通俗解释，底部操作按钮 |
| 图片识别页 | 拍照区域 | 虚线边框的上传区域，中央相机图标，支持拖拽上传 |
| 图片识别页 | 图片预览 | 圆角图片展示，支持缩放和旋转，底部操作栏 |
| 设置页 | API输入 | 安全的密码输入框，显示/隐藏切换按钮，测试按钮 |

<span class="hljs-section">### 4.3 响应式设计</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**桌面优先**</span>：主要面向平板和手机使用，采用响应式设计
<span class="hljs-bullet">-</span> <span class="hljs-strong">**断点设置**</span>：768px（平板）、1024px（桌面）
<span class="hljs-bullet">-</span> <span class="hljs-strong">**触摸优化**</span>：按钮尺寸最小44px，支持手势操作
<span class="hljs-bullet">-</span> <span class="hljs-strong">**字体适配**</span>：根据屏幕大小自动调整字体大小
</code></pre>
<h4 data-id="heading-16">开发交互</h4>
<p>开始生成之后可以在控制台实时监控</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39136e590790407290e6078698c513c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=cqs53ZlCs3vpkJo%2B3KH9j6e4vYE%3D" alt="" loading="lazy"/></p>
<p>不一会就生成成了一整个完整的项目</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cec5b6f58deb444db992dfebc7c9a0cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=TuCpiKBwI8PPLIA8RxhsCXSXHzY%3D" alt="" loading="lazy"/></p>
<p>并且也是在本地启动了，这时候我们需要进行一次测试，并且不断的给出反馈：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90e406b4226b41688f3d2cfe373ed18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=8l51YhqFF9511aZ421U4LgF3bzA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee887db02a4346bb842e105ad7daae0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=lou%2Bl2hjJncm1HSbfJpjvEVRCyY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebd394f5153a405fbdfb5a2f2716d87d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=4ADOxtHGauUpfB9NyVHsnetXoMs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ccc461859e4b6d9ad59540ec620ca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976273&amp;x-signature=6jp54cbJAoupW2fDkv%2FpuLrEsoQ%3D" alt="" loading="lazy"/></p>
<p>重复几次之后就会得到我们想要的结果，接下来就是部署上线~</p>
<h4 data-id="heading-17">总结</h4>
<p>本文系统介绍了“医疗报告翻译官”应用的开发全流程，聚焦于解决中老年人难以理解专业医疗术语的核心痛点。项目基于<strong>Trae IDE</strong>作为开发环境，集成<strong>KAT-Coder</strong>（由快手StreamLake提供）实现高效代码生成与工程化能力，并结合<strong>智谱AI</strong>的双模型架构——<strong>GLM-4.6</strong>（负责自然语言理解与通俗化翻译）与<strong>GLM-4.5V</strong>（负责医疗报告图像的OCR识别与结构化提取）——构建端到端的智能翻译系统。应用支持文本输入与图片上传两种交互模式，采用医疗友好型UI设计，强调低饱和蓝绿色调与卡片式布局，注重可用性与情感体验。整个开发过程通过提示词驱动、自动生成、本地测试与迭代优化，体现了AI原生开发范式在垂直领域产品落地中的高效性与可行性。</p>
<h4 data-id="heading-18">参考链接</h4>
<ul>
<li><strong>Trae IDE 官网</strong>：<a href="https://www.trae.ai/" target="_blank" title="https://www.trae.ai/" ref="nofollow noopener noreferrer">www.trae.ai/</a></li>
<li><strong>KAT-Coder 产品页</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.streamlake.com%2Fproduct%2Fkat-coder" target="_blank" title="https://www.streamlake.com/product/kat-coder" ref="nofollow noopener noreferrer">www.streamlake.com/product/kat…</a></li>
<li><strong>智谱AI 开放平台</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2F" target="_blank" title="https://www.bigmodel.cn/" ref="nofollow noopener noreferrer">www.bigmodel.cn/</a></li>
<li><strong>GLM-4.6 与 GLM-4.5V API 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2F" target="_blank" title="https://open.bigmodel.cn/" ref="nofollow noopener noreferrer">open.bigmodel.cn/</a></li>
<li><strong>自定义模型接入 Trae 指南</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKXSRoBaME_Wvv2wlRZ_FaA" target="_blank" title="https://mp.weixin.qq.com/s/KXSRoBaME_Wvv2wlRZ_FaA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/KXSRoBaME…</a></li>
<li><strong>Novita.ai 密钥管理</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnovita.ai%2Fsettings%2Fkey-management" target="_blank" title="https://novita.ai/settings/key-management" ref="nofollow noopener noreferrer">novita.ai/settings/ke…</a></li>
</ul>
<p>#AI医疗 #智能翻译 #Trae #KATCoder #GLM4.6 #GLM4.5V</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Trae Solo+豆包Version1.6+Seedream4.0打造"AI识菜通"]]></title>    <link>https://juejin.cn/post/7573336057481314310</link>    <guid>https://juejin.cn/post/7573336057481314310</guid>    <pubDate>2025-11-17T09:26:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573336057481314310" data-draft-id="7573332163388751926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Trae Solo+豆包Version1.6+Seedream4.0打造&quot;AI识菜通&quot;"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-17T09:26:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_摘星_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Trae Solo+豆包Version1.6+Seedream4.0打造"AI识菜通"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _摘星_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:26:30.000Z" title="Mon Nov 17 2025 09:26:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1476bdb094a450384058ad83af0cbc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=d5KReQaPMwCngvjpc5g%2FdWUavVc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">Trae Solo+豆包Version1.6+Seedream4.0打造"AI识菜通"</h2>
<h3 data-id="heading-1">摘要</h3>
<p>在人工智能技术迅猛发展的今天，大模型正以前所未有的深度与广度渗透进日常生活的各个场景。从智能客服到内容创作，从代码生成到图像理解，AI 正在重塑人与信息、人与服务之间的交互方式。而在餐饮这一高频、高感知的领域，语言障碍与菜单理解困难长期困扰着跨国旅行者、留学生乃至本地食客——面对一张满是陌生文字或模糊排版的菜单，如何快速识别菜品、理解其风味、并准确下单？正是在这一现实痛点驱动下，我们开发了“AI识菜通”——一款融合多模态感知、跨语言理解与生成式视觉的智能点餐助手。</p>
<p>“AI识菜通”的核心目标，是让用户只需上传一张任意语言的菜单图片，即可在数秒内获得结构化、本地化（中文）的菜品列表，每道菜附带精准描述与逼真图像，并支持一键加入购物车、生成可直接向服务员展示的点餐字符串。这一看似简单的流程背后，实则涉及图像识别、多语言翻译、语义理解、图像生成、状态管理与前端交互等多个技术模块的协同。而要让这些模块高效、准确、一致地工作，关键不在于单个模型的性能上限，而在于如何构建一个强大、灵活、可维护的<strong>上下文工程（Context Engineering）体系</strong>。</p>
<p>在本项目中，我们创新性地以 <strong>Trae Solo</strong> 作为上下文工程的核心引擎，协同 <strong>字节跳动豆包大模型 Version 1.6</strong>（负责多语言理解与结构化输出）与 <strong>Seedream 4.0</strong>（负责高质量菜品图像生成），共同构建了一个端到端的智能点餐系统。本文将重点剖析 Trae Solo 在“AI识菜通”中的上下文工程实践，揭示其如何通过精细化的上下文设计、动态记忆管理与多轮意图对齐，显著提升整个系统的准确性、鲁棒性与用户体验。</p>
<h3 data-id="heading-2">Trae Solo</h3>
<p>官网：<a href="https://www.trae.ai/solo" target="_blank" title="https://www.trae.ai/solo" ref="nofollow noopener noreferrer">www.trae.ai/solo</a>，目前Trae Solo模式需要在官网申请体验码，感兴趣的小伙伴赶快去申请吧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4864a1e6e0fb43e4bf124213ddeb4744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=ocv1W%2FvhtqxZjPQW7zMXXS55SFs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">1. 从 Prompt Engineering 到 Context Engineering</h4>
<p>过去几年，Prompt Engineering（提示词工程）被视为驾驭大模型的核心技能。开发者通过精心设计输入文本，引导模型输出期望结果。然而，随着AI应用场景从单轮问答走向多步骤、多模态、状态依赖的复杂任务（如智能客服、自动化办公、个性化推荐），静态、孤立的 prompt 已显乏力。问题在于：真实世界的任务往往具有<strong>上下文依赖性</strong>——当前操作依赖于历史行为，模型输出需与系统状态对齐，用户意图在交互中动态演化。</p>
<p>正是在这一背景下，<strong>上下文工程（Context Engineering）</strong> 应运而生。它不再将AI调用视为一次性的“黑箱请求”，而是将其嵌入一个<strong>结构化、可演化、可追溯的上下文空间</strong>中。上下文工程关注的核心问题是：<strong>如何在正确的时间，向正确的模型，提供正确的上下文信息，以驱动整个系统达成目标？</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c268c13c980e49cb875d209c3bd68836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=EAsk6zKst2zA92OacoNUag29F0U%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">2. Trae Solo：上下文工程的操作系统</h4>
<p>Trae Solo 并非一个大语言模型，而是一个专为复杂AI应用设计的<strong>上下文编排与推理调度平台</strong>。它旨在成为AI系统的“操作系统”，负责管理任务流、维护状态、协调多模型协作，并确保上下文在全生命周期中的一致性与有效性。</p>
<p>Trae Solo 的核心能力可概括为以下四点：</p>
<p><strong>（1）结构化上下文建模</strong><br/>
Trae Solo 允许开发者以声明式方式定义整个应用的上下文结构。这包括：</p>
<ul>
<li><strong>输入上下文</strong>：用户上传的图像、文本、地理位置、设备类型等原始数据；</li>
<li><strong>系统状态上下文</strong>：当前任务阶段、已提取的实体、用户选择、错误状态等；</li>
<li><strong>模型能力上下文</strong>：各AI模型的接口规范、输入输出格式、性能边界、调用成本等；</li>
<li><strong>领域知识上下文</strong>：预加载的行业术语、常见实体库、业务规则等。</li>
</ul>
<p>这些上下文被组织为一个动态更新的“上下文图谱”（Context Graph），所有模块均可读写，确保信息同步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c1f1aa5b7554ea19fe84c8fc336e1ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=AXWpEv599h5A0wIuE8iWurRkcik%3D" alt="" loading="lazy"/></p>
<p><strong>（2）动态上下文注入与路由</strong><br/>
在调用任一AI模型前，Trae Solo 会根据当前任务阶段与系统状态，<strong>动态组装最合适的上下文包</strong>。例如，在菜单识别阶段，它会将图像、语言先验、菜系知识、任务指令等打包发送给豆包模型；而在生成点餐字符串时，则只传递选中的菜品列表与格式要求。这种按需注入机制，既提升了模型输出的相关性，又避免了信息过载。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5c8767d29664092b9d52d4769cdd9f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=8VvOo%2FyzfXfnVu7qmXrvo0sv9lc%3D" alt="" loading="lazy"/></p>
<p><strong>（3）多轮意图对齐与状态管理</strong><br/>
用户交互是动态的。Trae Solo 内置强大的状态机与意图识别模块，能够实时捕获用户行为（如点击、取消、修改），并更新上下文图谱。更重要的是，它支持<strong>上下文回溯、分支与合并</strong>——当用户修改选择时，系统能快速撤销相关操作，而不会导致状态混乱。这种对用户意图的持续对齐，是构建流畅体验的基础。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0a35fe3e05043f89134d8a32228117b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=GjIHZhGo2CDUae98Fw9Eqg49%2BkM%3D" alt="" loading="lazy"/></p>
<p><strong>（4）错误处理与降级策略</strong><br/>
AI模型并非100%可靠。Trae Solo 提供了完善的错误监控与降级机制。例如，若豆包模型返回格式错误，系统可自动切换至备用OCR+翻译流程；若Seedream图像生成失败，则回退至默认占位图。所有错误均被记录到上下文日志中，便于后续分析与优化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdf930b7895a4396a866d83bf4ae2c48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=RR9PDcBq6C5dK59CjguOM1DZtl0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">3. 上下文工程的价值：从“能用”到“好用”</h4>
<p>通过 Trae Solo 实施上下文工程，AI系统实现了三大跃升：</p>
<ul>
<li><strong>准确性提升</strong>：上下文提供领域知识与任务约束，显著减少模型幻觉；</li>
<li><strong>鲁棒性增强</strong>：状态管理与错误处理机制保障系统在异常情况下仍可运行；</li>
<li><strong>可维护性提高</strong>：上下文结构清晰，模块解耦，便于迭代与调试。</li>
</ul>
<p>可以说，上下文工程是AI应用从“技术演示”走向“产品落地”的必经之路。而 Trae Solo，正是这条路上的强大引擎。</p>
<p>而 <strong>Trae Solo</strong>，正是为实现这一目标而设计的上下文工程框架。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d35e5dd88c4347afd46901599d1256~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=%2FncVco1RlxdSzClaxPZfAFadCkM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">豆包大模型接入指南</h3>
<p>本项目所用的视觉理解大模型和文生图大模型均采用火山引擎Mass平台，分别是doubao-seed-1-6-vision-250815和doubao-seedream-4-0-250828</p>
<h4 data-id="heading-7">火山引擎Mass平台</h4>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.volcengine.com%2F" target="_blank" title="https://www.volcengine.com/" ref="nofollow noopener noreferrer">www.volcengine.com/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/780d34c2eec64d9696ed5e6a04b4f134~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=Kow7mqm2Q8U8w1LxfP2XzEAOGxw%3D" alt="" loading="lazy"/></p>
<p>点击需要的AI API进入</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db94acdcff9c48fbbf019560b652b9a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=2otmfEzkYTdujC1bzTS3HfhMtzc%3D" alt="" loading="lazy"/></p>
<p>进行快捷API 接入即可</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3886602a3c2d42ffaad04c0e35520f5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=jCKDbBaS2StvuDvwzwUknmW5rPg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">doubao-seed-1-6-vision</h4>
<p>doubao-seed-1-6-vision：适用于视频理解、Grounding、GUI Agent等高复杂度的场景，与Doubao-1.5-thinking-vision-pro相比，在教育、图像审核、巡检与安防和AI搜索问答等场景下展现出更强的通用多模态理解和推理能力，支持 256k 上下文窗口，输出长度支持最大 64k tokens。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eae046d7fd274303b87a3931f42d1c88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=CmUuEgAs7v7fDhWzJtBhCqHQmT8%3D" alt="" loading="lazy"/></p>
<p>下方是调用示例：</p>
<pre><code class="hljs language-arduino" lang="arduino">curl https:<span class="hljs-comment">//ark.cn-beijing.volces.com/api/v3/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your api key" \
  -d $'{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seed-1-6-vision-250815"</span>,
    <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"content"</span>: [
                {
                    <span class="hljs-string">"image_url"</span>: {
                        <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.ivolces.com/images/view.jpeg"</span>
                    },
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>
                },
                {
                    <span class="hljs-string">"text"</span>: <span class="hljs-string">"图片主要讲了什么?"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>
                }
            ],
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>
        }
    ]
}'
</code></pre>
<h4 data-id="heading-9">doubao-seedream-4.0</h4>
<p>doubao-seedream-4.0基于领先架构的SOTA级多模态图像创作模型。其打破传统文生图模型的创作边界，原生支持文本、单图和多图输入，用户可自由融合文本与图像，在同一模型下实现基于主体一致性的多图融合创作、图像编辑、组图生成等多样玩法，让图像创作更加自由可控。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12f9c8570e75490eb91a0d21ed90dc7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=OBc0OBHrxIhw5lAV%2B2ndbTZbEtg%3D" alt="" loading="lazy"/></p>
<p>下方是接入示例：</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -X POST https:<span class="hljs-comment">//ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your api key" \
  -d '{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedream-4-0-250828"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Generate 3 images of a girl and a cow plushie happily riding a roller coaster in an amusement park, depicting morning, noon, and night."</span>,
    <span class="hljs-string">"image"</span>: [<span class="hljs-string">"https://ark-doc.tos-ap-southeast-1.bytepluses.com/doc_image/seedream4_imagesToimages_1.png"</span>, <span class="hljs-string">"https://ark-doc.tos-ap-southeast-1.bytepluses.com/doc_image/seedream4_imagesToimages_2.png"</span>],
    <span class="hljs-string">"sequential_image_generation"</span>: <span class="hljs-string">"auto"</span>,
    <span class="hljs-string">"sequential_image_generation_options"</span>: {
        <span class="hljs-string">"max_images"</span>: <span class="hljs-number">3</span>
    },
    <span class="hljs-string">"response_format"</span>: <span class="hljs-string">"url"</span>,
    <span class="hljs-string">"size"</span>: <span class="hljs-string">"2K"</span>,
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"watermark"</span>: <span class="hljs-literal">true</span>
}'
</code></pre>
<h3 data-id="heading-10">项目开发</h3>
<h4 data-id="heading-11">开发提示词</h4>
<p>准备好如下开发提示词：</p>
<pre><code class="hljs language-bash" lang="bash">我要做一个AI识菜通应用。功能是：用户可以上传一张任何语言菜单图片，调用视觉理解模型doubao-seed-1-6-vision-250815，分析菜单中的内容并翻译为中文，之后进入第二个页面：点菜页面，点菜页面会将AI翻译后的中文菜单一一展示，并且用户可以点菜。每一道菜都包含它的名字、它的介绍和一张图片，图片调用doubao-seedream-4-0-250828模型的生成图片，然后用户点加号可以把这道菜加入他的购物车，最后点提交生成一个一串字符，上面写他想要点哪些菜，方便他跟服务员说他要点哪些。这个字符应该包合中文名和他元语言的名字。项目需要使用react 实现，使用 shadcn、redix 组件库。AI模型的API KEY放在<span class="hljs-built_in">local</span> storage，通过网页右上角的齿轮按钮输入。
</code></pre>
<p>输入到Trae Solo对话框中，Trae Solo不会直接开始开发，而是会先设计两份文档，待我们确认之后才会开始开发。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ca5eab56f6249f998b81b49d0610f80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=Xk1xR%2FyWMUm3D5nce4%2F7reTpS5w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">项目文档</h4>
<p>Trae Solo会自动帮你创建两份文档，分别是需求文档和架构文档：</p>
<h5 data-id="heading-13">AI识菜通产品需求文档</h5>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># AI识菜通产品需求文档</span>

<span class="hljs-comment">## 1. 产品概述</span>

AI识菜通是一款智能菜单识别与点餐应用，帮助用户快速理解任何语言的菜单内容并完成点餐。
用户只需上传菜单图片，AI即可自动识别并翻译菜单内容，生成精美的菜品图片，让用户轻松完成点餐流程。
该产品主要面向出国旅游、商务出差或在多语言环境用餐的用户，解决语言障碍带来的点餐困扰。

<span class="hljs-comment">## 2. 核心功能</span>

<span class="hljs-comment">### 2.1 用户角色</span>

本产品无需用户注册，所有功能对所有用户开放。

<span class="hljs-comment">### 2.2 功能模块</span>

我们的AI识菜通应用包含以下主要页面：

1. **首页**：菜单上传功能、应用介绍、导航菜单
2. **点餐页面**：菜品展示列表、购物车管理、订单生成
3. **设置页面**：API密钥配置、应用设置

<span class="hljs-comment">### 2.3 页面详情</span>

| 页面名称 | 模块名称   | 功能描述                              |
| ---- | ------ | --------------------------------- |
| 首页   | 菜单上传区域 | 支持拖拽或点击上传菜单图片，显示上传进度和预览           |
| 首页   | 应用介绍   | 展示应用功能特色和使用说明                     |
| 首页   | 导航栏    | 包含设置按钮和应用标题                       |
| 点餐页面 | 菜品列表   | 展示AI识别的菜品信息，包含中文名称、原文名称、描述和AI生成图片 |
| 点餐页面 | 购物车    | 显示已选菜品数量和总览，支持增减数量                |
| 点餐页面 | 订单生成   | 生成包含中文和原文的点餐清单字符串                 |
| 设置页面 | API配置  | 输入和保存Doubao API密钥                 |
| 设置页面 | 应用设置   | 语言偏好、主题设置等基础配置                    |

<span class="hljs-comment">## 3. 核心流程</span>

**主要用户操作流程：**

1. 用户进入首页，点击或拖拽上传菜单图片
2. 系统调用视觉识别AI分析菜单内容并翻译为中文
3. 跳转到点餐页面，展示识别结果和AI生成的菜品图片
4. 用户浏览菜品，点击加号将心仪菜品加入购物车
5. 确认选择后，生成包含中文和原文的点餐清单
6. 用户可将清单展示给服务员完成点餐

```mermaid
graph TD
    A[首页] --&gt; B[上传菜单图片]
    B --&gt; C[AI识别处理]
    C --&gt; D[点餐页面]
    D --&gt; E[浏览菜品]
    E --&gt; F[添加到购物车]
    F --&gt; G[生成点餐清单]
    A --&gt; H[设置页面]
    H --&gt; I[配置API密钥]
```

<span class="hljs-comment">## 4. 用户界面设计</span>

<span class="hljs-comment">### 4.1 设计风格</span>

* **主色调**：现代蓝色 (<span class="hljs-comment">#3B82F6) 和温暖橙色 (#F59E0B)</span>

* **辅助色**：中性灰色系 (<span class="hljs-comment">#6B7280, #F3F4F6)</span>

* **按钮样式**：圆角设计，悬停效果，阴影层次

* **字体**：中文使用思源黑体，英文使用 Inter 字体，主要字号 16px

* **布局风格**：卡片式设计，顶部导航，响应式网格布局

* **图标风格**：线性图标，统一的视觉语言，支持深浅主题

<span class="hljs-comment">### 4.2 页面设计概览</span>

| 页面名称 | 模块名称 | 界面元素                       |
| ---- | ---- | -------------------------- |
| 首页   | 上传区域 | 虚线边框的拖拽区域，上传图标，进度条，图片预览卡片  |
| 首页   | 导航栏  | 应用Logo，标题，设置齿轮图标按钮         |
| 点餐页面 | 菜品卡片 | 圆角卡片，AI生成图片，菜名标题，描述文本，加号按钮 |
| 点餐页面 | 购物车  | 浮动购物车图标，数量徽章，侧边栏展开面板       |
| 设置页面 | 配置表单 | 输入框，保存按钮，状态提示，分组设置项        |

<span class="hljs-comment">### 4.3 响应式设计</span>

应用采用移动优先的响应式设计，完美适配手机、平板和桌面设备。在移动端优化触摸交互体验，确保按钮大小适合手指操作。

4.4 API调用示例

doubao-seedream-4-0-250828调用示例如下

curl -X POST &lt;https://ark.cn-beijing.volces.com/api/v3/images/generations&gt; \

-H <span class="hljs-string">"Content-Type: application/json"</span> \

-H <span class="hljs-string">"Authorization: Bearer your api key"</span> \

-d '{

<span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedream-4-0-250828"</span>,

<span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Generate 3 images of a girl and a cow plushie happily riding a roller coaster in an amusement park, depicting morning, noon, and night."</span>,

<span class="hljs-string">"image"</span>: [<span class="hljs-string">" &lt;https://ark-doc.tos-ap-southeast-1.bytepluses.com/doc_image/seedream4_imagesToimages_1.png&gt; "</span>, <span class="hljs-string">" &lt;https://ark-doc.tos-ap-southeast-1.bytepluses.com/doc_image/seedream4_imagesToimages_2.png&gt; "</span>],

<span class="hljs-string">"sequential_image_generation"</span>: <span class="hljs-string">"auto"</span>,

<span class="hljs-string">"sequential_image_generation_options"</span>: {

<span class="hljs-string">"max_images"</span>: 3

},

<span class="hljs-string">"response_format"</span>: <span class="hljs-string">"url"</span>,

<span class="hljs-string">"size"</span>: <span class="hljs-string">"2K"</span>,

<span class="hljs-string">"stream"</span>: true,

<span class="hljs-string">"watermark"</span>: true

}'

doubao-seed-1-6-vision-250815调用示例

curl &lt;https://ark.cn-beijing.volces.com/api/v3/chat/completions&gt; \

-H <span class="hljs-string">"Content-Type: application/json"</span> \

-H <span class="hljs-string">"Authorization: Bearer your api key"</span> \

-d $'{

<span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seed-1-6-vision-250815"</span>,

<span class="hljs-string">"messages"</span>: [

{

<span class="hljs-string">"content"</span>: [

{

<span class="hljs-string">"image_url"</span>: {

<span class="hljs-string">"url"</span>: <span class="hljs-string">" &lt;https://ark-project.tos-cn-beijing.ivolces.com/images/view.jpeg&gt; "</span>

},

<span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>

},

{

<span class="hljs-string">"text"</span>: <span class="hljs-string">"图片主要讲了什么?"</span>,

<span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>

}

],

<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>

}

]

}'
</code></pre>
<h5 data-id="heading-14">AI识菜通技术架构文档</h5>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># AI识菜通技术架构文档</span>

<span class="hljs-comment">## 1. Architecture design</span>

```mermaid
graph TD
    A[用户浏览器] --&gt; B[React前端应用]
    B --&gt; C[Doubao Vision API]
    B --&gt; D[Doubao Image Generation API]
    B --&gt; E[LocalStorage]

    subgraph <span class="hljs-string">"前端层"</span>
        B
        F[shadcn/ui组件]
        G[Radix UI组件]
        H[状态管理]
        B --&gt; F
        B --&gt; G
        B --&gt; H
    end

    subgraph <span class="hljs-string">"外部服务"</span>
        C
        D
    end

    subgraph <span class="hljs-string">"本地存储"</span>
        E
    end
```

<span class="hljs-comment">## 2. Technology Description</span>

* Frontend: React@<span class="hljs-number">18</span> + TypeScript + Vite + TailwindCSS

* UI Components: shadcn/ui + Radix UI

* State Management: React Context + useState/useReducer

* HTTP Client: Fetch API

* Storage: LocalStorage

* Icons: Lucide React

* External APIs: Doubao Vision API, Doubao Image Generation API

<span class="hljs-comment">## 3. Route definitions</span>

| Route     | Purpose               |
| --------- | --------------------- |
| /         | 首页，菜单图片上传和AI处理        |
| /menu     | 点菜页面，显示翻译后的菜品列表和购物车功能 |
| /settings | 设置页面，配置API密钥和应用设置     |

<span class="hljs-comment">## 4. API definitions</span>

<span class="hljs-comment">### 4.1 Core API</span>

<span class="hljs-comment">#### Doubao Vision API 调用</span>

```
POST https:<span class="hljs-comment">//ark.cn-beijing.volces.com/api/v3/chat/completions</span>
```

Request Headers:

| Header Name   | Value             | Description |
| ------------- | ----------------- | ----------- |
| Authorization | Bearer {API_KEY} | API密钥认证     |
| Content-Type  | application/json  | 请求内容类型      |

Request Body:

```json
{
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seed-1-6-vision-250815"</span>,
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
      <span class="hljs-string">"content"</span>: [
        {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-string">"text"</span>: <span class="hljs-string">"请识别这张菜单图片中的所有菜品，并翻译为中文。请按照以下JSON格式返回：{"</span>dishes<span class="hljs-string">": [{"</span>originalName<span class="hljs-string">": "</span>原文名称<span class="hljs-string">", "</span>chineseName<span class="hljs-string">": "</span>中文名称<span class="hljs-string">", "</span>description<span class="hljs-string">": "</span>菜品描述<span class="hljs-string">", "</span>estimatedPrice<span class="hljs-string">": "</span>预估价格<span class="hljs-string">"}]}"</span>
        },
        {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
          <span class="hljs-string">"image_url"</span>: {
            <span class="hljs-string">"url"</span>: <span class="hljs-string">"data:image/jpeg;base64,{base64_image}"</span>
          }
        }
      ]
    }
  ]
}
```

<span class="hljs-comment">#### Doubao Image Generation API 调用</span>

```
POST https:<span class="hljs-comment">//ark.cn-beijing.volces.com/api/v3/images/generations</span>
```

Request Headers:

| Header Name   | Value             | Description |
| ------------- | ----------------- | ----------- |
| Authorization | Bearer {API_KEY} | API密钥认证     |
| Content-Type  | application/json  | 请求内容类型      |

Request Body:

```json
{
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedream-4-0-250828"</span>,
  <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"高质量的{菜品名称}美食摄影，专业餐厅级别，自然光线，精美摆盘"</span>,
  <span class="hljs-string">"n"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">"size"</span>: <span class="hljs-string">"1024x1024"</span>,
  <span class="hljs-string">"quality"</span>: <span class="hljs-string">"standard"</span>
}
```

<span class="hljs-comment">### 4.2 数据类型定义</span>

```typescript
<span class="hljs-comment">// 菜品信息</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Dish</span> </span>{
  id: <span class="hljs-keyword">string</span>;
  originalName: <span class="hljs-keyword">string</span>;
  chineseName: <span class="hljs-keyword">string</span>;
  description: <span class="hljs-keyword">string</span>;
  estimatedPrice?: <span class="hljs-keyword">string</span>;
  imageUrl?: <span class="hljs-keyword">string</span>;
  isGeneratingImage?: <span class="hljs-keyword">boolean</span>;
}

<span class="hljs-comment">// 购物车项目</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CartItem</span> </span>{
  dish: Dish;
  quantity: number;
}

<span class="hljs-comment">// API配置</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApiConfig</span> </span>{
  visionApiKey: <span class="hljs-keyword">string</span>;
  imageApiKey: <span class="hljs-keyword">string</span>;
}

<span class="hljs-comment">// 应用状态</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AppState</span> </span>{
  dishes: Dish[];
  cart: CartItem[];
  isProcessing: <span class="hljs-keyword">boolean</span>;
  processingStep: <span class="hljs-string">'uploading'</span> | <span class="hljs-string">'analyzing'</span> | <span class="hljs-string">'translating'</span> | <span class="hljs-string">'generating_images'</span> | <span class="hljs-string">'completed'</span>;
  apiConfig: ApiConfig;
}
```

<span class="hljs-comment">## 5. Data model</span>

<span class="hljs-comment">### 5.1 LocalStorage 数据结构</span>

由于这是一个纯前端应用，所有数据都存储在浏览器的LocalStorage中：

```typescript
<span class="hljs-comment">// API配置存储</span>
localStorage.<span class="hljs-title function_ invoke__">setItem</span>(<span class="hljs-string">'ai-menu-api-config'</span>, JSON.<span class="hljs-title function_ invoke__">stringify</span>({
  <span class="hljs-attr">visionApiKey</span>: <span class="hljs-keyword">string</span>,
  <span class="hljs-attr">imageApiKey</span>: <span class="hljs-keyword">string</span>
}));

<span class="hljs-comment">// 最近处理的菜单缓存</span>
localStorage.<span class="hljs-title function_ invoke__">setItem</span>(<span class="hljs-string">'ai-menu-recent-dishes'</span>, JSON.<span class="hljs-title function_ invoke__">stringify</span>({
  <span class="hljs-attr">timestamp</span>: number,
  <span class="hljs-attr">dishes</span>: Dish[]
}));

<span class="hljs-comment">// 用户偏好设置</span>
localStorage.<span class="hljs-title function_ invoke__">setItem</span>(<span class="hljs-string">'ai-menu-preferences'</span>, JSON.<span class="hljs-title function_ invoke__">stringify</span>({
  <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,
  <span class="hljs-attr">imageQuality</span>: <span class="hljs-string">'standard'</span>,
  <span class="hljs-attr">autoGenerateImages</span>: <span class="hljs-literal">true</span>
}));
```

<span class="hljs-comment">### 5.2 组件状态管理</span>

```typescript
<span class="hljs-comment">// 全局应用状态 Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AppContext</span> = createContext&lt;{
  state: AppState;
  dispatch: React.Dispatch&lt;AppAction&gt;;
}&gt;();

<span class="hljs-comment">// 状态更新动作</span>
type AppAction = 
  | { type: <span class="hljs-string">'SET_DISHES'</span>; payload: Dish[] }
  | { type: <span class="hljs-string">'ADD_TO_CART'</span>; payload: Dish }
  | { type: <span class="hljs-string">'REMOVE_FROM_CART'</span>; payload: <span class="hljs-keyword">string</span> }
  | { type: <span class="hljs-string">'UPDATE_CART_QUANTITY'</span>; payload: { dishId: <span class="hljs-keyword">string</span>; quantity: number } }
  | { type: <span class="hljs-string">'SET_PROCESSING'</span>; payload: <span class="hljs-keyword">boolean</span> }
  | { type: <span class="hljs-string">'SET_PROCESSING_STEP'</span>; payload: AppState[<span class="hljs-string">'processingStep'</span>] }
  | { type: <span class="hljs-string">'UPDATE_DISH_IMAGE'</span>; payload: { dishId: <span class="hljs-keyword">string</span>; imageUrl: <span class="hljs-keyword">string</span> } };
```

<span class="hljs-comment">## 6. 项目结构</span>

```
ai-menu/
├── src/
│   ├── components/
│   │   ├── ui/                 <span class="hljs-comment"># shadcn/ui组件</span>
│   │   ├── ImageUpload.tsx     <span class="hljs-comment"># 图片上传组件</span>
│   │   ├── DishCard.tsx        <span class="hljs-comment"># 菜品卡片组件</span>
│   │   ├── Cart.tsx            <span class="hljs-comment"># 购物车组件</span>
│   │   ├── OrderSummary.tsx    <span class="hljs-comment"># 订单摘要组件</span>
│   │   └── ApiKeySettings.tsx  <span class="hljs-comment"># API密钥设置组件</span>
│   ├── pages/
│   │   ├── HomePage.tsx        <span class="hljs-comment"># 首页</span>
│   │   ├── MenuPage.tsx        <span class="hljs-comment"># 点菜页面</span>
│   │   └── SettingsPage.tsx    <span class="hljs-comment"># 设置页面</span>
│   ├── hooks/
│   │   ├── useApiConfig.ts     <span class="hljs-comment"># API配置管理</span>
│   │   ├── useImageUpload.ts   <span class="hljs-comment"># 图片上传处理</span>
│   │   └── useCart.ts          <span class="hljs-comment"># 购物车逻辑</span>
│   ├── services/
│   │   ├── doubaoApi.ts        <span class="hljs-comment"># Doubao API调用</span>
│   │   └── imageService.ts     <span class="hljs-comment"># 图片处理服务</span>
│   ├── context/
│   │   └── AppContext.tsx      <span class="hljs-comment"># 全局状态管理</span>
│   ├── types/
│   │   └── index.ts            <span class="hljs-comment"># TypeScript类型定义</span>
│   ├── utils/
│   │   ├── storage.ts          <span class="hljs-comment"># LocalStorage工具</span>
│   │   └── imageUtils.ts       <span class="hljs-comment"># 图片处理工具</span>
│   └── App.tsx
├── <span class="hljs-keyword">public</span>/
├── package.json
├── tailwind.config.js
├── vite.config.ts
└── tsconfig.json
```
</code></pre>
<h4 data-id="heading-15">上下文工程开发</h4>
<p>如果说对于SOLO生成的文档不满意，或者有部分地方需要修改的话，是可以直接在文档中进行编辑的，这一点 做得可谓是非常丝滑，SOLO给我的整体体验就是整个项目开发过程全在你的掌控中一般。👍</p>
<p>文档其实就是Trae对整个项目的理解，这个修正过程是很有必要的，在确保Trae完全理解了我们的意思，也就是确认文档无误之后即可向Trae Solo发出命令：按照文档进行开发！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/732b69e5d2cc4a8bb5c1076481e95ab9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=e0BTgkMdJehWQj2wC3SS47QR%2Be4%3D" alt="" loading="lazy"/></p>
<p>Trae Solo会在开发的过程中自动下载依赖、创建配置文件、生成函数、运行终端，运到的问题也都会被当做上下文继续完善开发，不愧是国产之光，第一位上下文工程IDE，让整个从0到1的过程无比丝滑流畅：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714cd0caec8a404491f1276859de9c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=gjqKnZeM7B0glSTY%2Fl5QkqKc3sE%3D" alt="" loading="lazy"/></p>
<p>可以看到Trae Solo不光是会创建文件，下载依赖，并且下载依赖中的错误，也都一并给解决掉：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c8d700f566a4cd686cad24fdd4d91b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=AMoycdiIu8eDFLq5pms3T%2Bzo7Mg%3D" alt="" loading="lazy"/></p>
<p>遇到错误之后也可以一键添加到上下文中进行修复，并且还会根据上下文自测一番，比起传统的复制控制台的错误，再进行自测，这种方式不知道有多让程序员安心：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d813b7399cbb44f98bb4893906c031e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=muT15VsNqAo%2BIkkNlLsO1lT4d14%3D" alt="" loading="lazy"/></p>
<p>若有什么小问题也可以随时打断并提出问题，Trae Solo会根据上下文进行重新思考，并且会结合已经生成的内容加上刚刚提出的内容进行综合考量，所以不必担心说突然的打断会让Trae乱了阵脚，这其实一切都在它的掌控之中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0cfa96054074fbaaa2abb26db99b76e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=wTkTKNhBsugvYImlAbPDvptavLo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">成果展示</h3>
<h4 data-id="heading-17">1. 部署阶段</h4>
<p>在项目“AI识菜通”的最终部署阶段，我选择了 Vercel 作为前端应用的托管平台。Vercel 以其卓越的开发者体验和对现代前端框架的深度支持，极大简化了部署流程。本项目基于 React 构建，并使用了 shadcn/ui 和 Radix UI 组件库，Vercel 能自动识别项目结构，实现一键部署和持续集成。每次代码推送至 GitHub 仓库，Vercel 都会自动构建并生成预览链接，方便快速测试与迭代。更重要的是，Vercel 提供全球边缘网络分发，确保用户无论身处何地，都能快速加载应用页面。整个“AI识菜通”从前端交互、图片上传，到调用豆包大模型进行多语言菜单识别与菜品图像生成，最终生成点餐字符串，全部通过 Vercel 高效、稳定地交付给用户。借助 Vercel 的免费计划和无缝 DevOps 能力，我得以将精力聚焦在核心 AI 功能开发上，而无需担心服务器运维，真正实现了“开发即部署”的现代 Web 开发体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9a28175eda0480c9d763a163df8f364~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=ywg84FUoWdJJ4H6kPbDDS6PSOTw%3D" alt="" loading="lazy"/></p>
<p>并且整体的部署流程也仅仅只需要一句话而已，如果说缺少了KEY或者依赖等等，Trae也会及时的提醒你补充信息，省去了繁琐的部署流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d41e6bd5cb1342a59628deb1064156a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=PUpvlUgwm%2Btthk42HEncyG9vaQk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">2. 首页</h4>
<p>那么在部署完毕之后访问AI识菜通网址的第一印象就是首页，可以说这个界面整体，简洁大气，比很多竞品生成的都要爽目，这也是我喜欢Trae Solo的点，审美非常在线！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbd94394485b42c0a8d18bd1a8f0fe47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=kdEFjkXU71MQ4uymHFBLbNICSC4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">3. 设置API密钥</h4>
<p>那么想要使用本项目的话，第一件事就是设置豆包大模型的API密钥，这里声明一下：用户自己的API密钥存放在本地的storage中，并不会上传到云端，确保用户的密钥安全。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf0991be7c84779ba4be14ddd42d2ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=kShZ5EDCp8cUwbvXnueAhOryRW4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/732bddb7b9944556ba522f961734402b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=WId%2Fqww%2FLYh%2B824qRSK1gB5owrU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">4. 识别菜单</h4>
<p>前置条件准备好之后，我从网上下载了一份英文菜单进行测试，看看项目到底能不能打：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a8b01c7e6484bd98197f4c200a9e38d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=OZMZdEIyZ9fBJpp%2BwJD51P%2Bl5SI%3D" alt="" loading="lazy"/></p>
<p>上传图片之后项目就会调用豆包大模型进行分析，整体的时间根据菜单内容的多少会有些出入，静静等待几分钟就好：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbf62791e0014ee98df2d66986f2e322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=kp0FqrH4up%2FIWKIUTO0GVvoKEPs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7d9e028a4ee4c5bb94e9f3f0d2dd55f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=qMfrUtCdE4UMPZaBEt3XKOKNvDk%3D" alt="" loading="lazy"/></p>
<p>菜单识别完毕之后，首页会提示，点击去点菜即可看到生成的中文菜单</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b631edb6b82d42c18b7b1a2bf7c883bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=TaTJnHFmWyJpLnOy4SX11UjHiZQ%3D" alt="" loading="lazy"/></p>
<p>以下是生成后的结果，可以看到，生成的图片是很符合菜单中的样子的，这样让本来晦涩难懂的菜单有了活力，这也许就是科技带给我们的意义吧，服务生活，然后这样就可以顺利点菜了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a3e3884fc3d4951ba4e2b16380db4f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=Z%2B2z0xzacf8fNPu%2FhTeh15FjACQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2f02085bd4648a6a7da0d6b6f7c6684~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=y%2BlCJkUMqHGyFfsMl1e7tTG%2BmOw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">5. 点餐进入购物车</h4>
<p>选择自己需要点的视频加入购物车</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea2e4fe2efa4c6881d76b269c6771df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=LnmpmS2uK6Oie9dbabQZ34gupDo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afa908f196ee491cbc60bf5a327a4023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=GQ3xRpiE8vcWCXt8VzWHFZAeJH0%3D" alt="" loading="lazy"/></p>
<p>点击生成订单汇总，会生成一份刚刚的点菜TXT格式的清单：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6182f8189e7c422999cef368d8bf236c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763976390&amp;x-signature=hPaq8oUHX%2FnSKYg9G%2BK5Rmhp1Gs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">总结</h3>
<p>“AI识菜通”是一个融合多模态AI能力的智能点餐应用，通过用户上传任意语言的菜单图片，自动调用豆包大模型（doubao-seed-1.6-vision）进行视觉识别与翻译，再结合 Seedream 4.0 生成高质量菜品图像，最终实现结构化中文菜单展示、购物车管理与点餐清单生成。整个项目采用 React + TypeScript 技术栈，集成 shadcn/ui 与 Radix UI 组件库，所有数据（包括 API 密钥）均本地存储于浏览器 LocalStorage，无需后端依赖。项目通过 Vercel 实现一键部署，具备完整的响应式设计与流畅的用户交互体验。</p>
<p>在开发过程中，上下文工程（Context Engineering）成为项目成功的关键。相比传统 Prompt Engineering，Trae Solo 提供的结构化上下文建模、动态注入、多轮意图对齐与错误降级机制，显著提升了系统在复杂任务中的准确性与鲁棒性。尤其在多模型协同（视觉识别 + 图像生成）、状态管理（如购物车同步、图片生成状态追踪）和异常处理（如 API 调用失败回退）方面，上下文工程让整个流程更可控、可维护。此外，将 API 密钥统一简化为单字段配置、加入识别进度条等细节优化，也极大提升了用户体验。</p>
<p>Trae Solo 不仅是一款开发工具，更像一位“全栈 AI 工程师搭档”。它从需求理解开始，自动生成产品文档与技术架构，再逐步完成项目初始化、依赖安装、组件开发、错误修复与部署上线，全程丝滑流畅。其上下文感知能力极强——即使中途打断或修改需求，也能基于已有上下文智能调整，确保逻辑连贯。更难得的是，它对开发者体验极度友好：自动处理依赖冲突、一键修复语法错误、实时预览效果，真正实现了“Talk. Think. Ship.”的开发哲学。作为国产上下文工程 IDE 的先行者，Trae Solo 极大降低了复杂 AI 应用的开发门槛，堪称“国产之光”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[京东云张晨 受邀参加KCD 杭州站 x OpenInfra Days China，分享AI时代的大型集群数据处理之道]]></title>    <link>https://juejin.cn/post/7573521516323815451</link>    <guid>https://juejin.cn/post/7573521516323815451</guid>    <pubDate>2025-11-17T09:41:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573521516323815451" data-draft-id="7573525927792541722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="京东云张晨 受邀参加KCD 杭州站 x OpenInfra Days China，分享AI时代的大型集群数据处理之道"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-17T09:41:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            京东云张晨 受邀参加KCD 杭州站 x OpenInfra Days China，分享AI时代的大型集群数据处理之道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:41:05.000Z" title="Mon Nov 17 2025 09:41:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI正在重塑一切，驱动云原生基础设施经历其诞生以来最深刻的变革。这一变革对底层设施提出了前所未有的新要求：更极致的弹性伸缩、更高效的算力利用、更复杂的跨域调度和更全面的安全防护。面对如此系统性的挑战，单一技术栈或社区已难以给出完美答案。</p>
<p>KCD（Kubernetes Community Days，Kubernetes 社区日）是由社区组织的活动，汇聚开源和云原生领域的采用者和技术人员，旨在促进教育、协作和交流。KCD 活动由云原生计算基金会（CNCF）提供支持。</p>
<p>OpenInfra Days 每年由开源社区生态系统中的本地用户组和公司组织和主办，包含主题演讲、分组会议甚至研讨会。这是一个绝佳的机会，在活动上可以直接聆听杰出的开源基础设施领导者的演讲，学习用户案例，建立人脉，并融入当地社区。</p>
<p><strong>今年由两个社区组织联合发起的开创性融合盛会，标志着云计算领域两大核心基础设施技术的深度协作与创新。它充分展现了开源社区的开放精神和跨社区协作的强大力量，我们将共同推动 AI 与云计算技术 的进步与发展。</strong></p>
<p>本次会议由 京东，亚马逊, Nvidia, 阿里，蚂蚁，字节，百度，华为，中科院, Linux foundation等国内外顶级专家学者分享CNCF/openinfra相关技术议题。本次会议JDOS 的Chen因Kata container等开源社区贡献受邀参加此次会议并做出技术分享。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0469bfb7087b47c4a753dff947d127e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977265&amp;x-signature=EES9X8mAFeQwfaPuRytoIE43uw8%3D" alt="图片" loading="lazy"/></p>
<p>作为对共同挑战的回应，KCD杭州站与OpenInfra Days China将于11月15日在杭州首度联合举办，共同呈现一场开创性的技术盛会。这标志着围Kubernetes敏捷应用编排与OpenInfra稳定基础设施构建的两大生态，正主动打破壁垒，迈向融合协同的新阶段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d83cde56dca44b0bb57855e1c052686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977265&amp;x-signature=F7bhyXMWkCte05huL5Kp7m0V748%3D" alt="图片" loading="lazy"/></p>
<p>京东云高级工程师张晨受邀将在本次大会中进行分享，他的主题是《大型集群中的数据处理：如何兼顾效率、可拓展性与可持续性》。</p>
<h4 data-id="heading-0">Chen Zhang</h4>
<p>Chen Zhang is a staff software engineer at JD cloud and a maintainer of the </p>
<p>QEMU project. He works in the virtualization field for many years.  As an accomplished speaker, Chen has presented at several international conferences, including KVM Forum 2022, Xen Summit 2019, LinuxCon China 2017, Open Source Summit Japan 2017, and CLK 2022, among others.</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4860af0c2a64a8eab8964ab2d3b7dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977265&amp;x-signature=Xnfa1HtQP0Zw1VTzZY0PNR%2B%2BRJQ%3D" alt="图片" loading="lazy"/>在AI驱动的数据洪流时代，大规模集群的数据处理能力是衡量云基础设施核心竞争力的关键。张晨将基于京东云在超大规模复杂场景下的深厚实践，分享如何构建既高效、又可平滑扩展，同时保证长期运营可持续性的数据处理架构与策略。他的分享将为业界同行应对相似挑战提供宝贵的思路与实战经验。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7ba332520f47d59cca2b0227d0c03b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977265&amp;x-signature=jzC%2B6ImdtXZiZHjYCpzgFs1OhRs%3D" alt="图片" loading="lazy"/>运营大型 Kubernetes 集群的企业面临一个关键难题：如何在不牺牲容器性能与密度的前提下实现强隔离。通过采用 Kata 容器，京东云成功实现了安全与性能隔离，并支持在线应用与离线任务在数十万个节点上的共处而彼此互不干扰，大幅提高物理 CPU 的利用率以节省巨额成本。这一方式在“618 购物节”期间显著降低能耗。本次演讲将深入解析京东在部署 Kata 容器中的历程，涵盖架构设计、动机出发点及关键性能指标。另外分享京东自研的Kata Disk I/O 性能加速技术，对比默认配置可最高提升40%的通用磁盘性能。我将分享一套经实际部署的方案经验，如何在严苛的真实场景中基于虚拟机的隔离提升安全性与效率，并剖析其实际应用价值与注意事项。<br/>
京东云高级工程师-张晨 《大型集群中的数据处理：如何兼顾效率、可拓展性与可持续性》现场分享内容<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80230b8bba7e46e998ca6975e4a74b23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977265&amp;x-signature=FvMjxeLHw5uoaDBD7XClAe35T2k%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Win11最新开发版开源工具新版发布，蓝屏、死机原因、内存诊断功能都有，教程来了]]></title>    <link>https://juejin.cn/post/7573525927792607258</link>    <guid>https://juejin.cn/post/7573525927792607258</guid>    <pubDate>2025-11-17T09:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573525927792607258" data-draft-id="7566845621001535498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Win11最新开发版开源工具新版发布，蓝屏、死机原因、内存诊断功能都有，教程来了"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-17T09:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="搜罗万相"/> <meta itemprop="url" content="https://juejin.cn/user/4116175105041085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Win11最新开发版开源工具新版发布，蓝屏、死机原因、内存诊断功能都有，教程来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4116175105041085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    搜罗万相
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T09:43:11.000Z" title="Mon Nov 17 2025 09:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么工具？</h2>
<p>ViveTool是一款专为Windows系统设计的开源工具，主要用于启用系统中的实验性隐藏功能。</p>
<p>它是一个第三方开源的C#库和控制台应用程序，也提供GUI版本。ViveTool通过功能ID来识别可用功能，可以通过命令行或GUI实用程序，使用功能ID来启用或禁用Windows计算机上的某些功能。例如，使用“vivetool /enable /id:功能ID”命令可以启用特定功能，使用“vivetool /disable /id:功能ID”命令则可以禁用功能。</p>
<p>ViveTool主要用于Windows 10和Windows 11系统，特别是对于那些运行Windows 11开发版或Insider Preview版本的用户来说，它可以帮助用户绕过微软实施的A/B测试限制，一些仅对部分用户开放的新功能可以被所有感兴趣的用户所使用。这些功能本质上是实验性的，激活它们有时可能会导致一些问题，因此在使用前最好备份系统。</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bf1d23644c84db5875aa3eb02a5012f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=gB8Y6BEvUPkIdmDfhW6I1ofqXrE%3D" alt="alt text" loading="lazy"/>​</p>
<p>微软官方表示，推出该功能的主要目的是帮助提升系统的可靠性。如果你的电脑出现错误检查（意外重启），可能会在登录时看到一条通知：建议进行快速内存扫描。</p>
<h2 data-id="heading-1">常见的一些问题</h2>
<p>蓝屏奔溃问题；</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d72fbcbda1d64082a6ef795bb80344ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=uYuUVr5aXsnL0h%2B8RyEtYWkgbKY%3D" alt="alt text" loading="lazy"/>​</p>
<p>莫名未知问题；</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6db9e8fa7b53474e8b71578abd4df67d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=e3M19%2FFf61bZLvhgQ9izMDk7%2B8o%3D" alt="alt text" loading="lazy"/>​</p>
<p>和内存相关的崩溃、蓝屏死机及黑屏问题，而且这种故障的诱因较为多样，像内存运行不稳定、内存硬件出现故障、内存模块型号不兼容，或者是XMP/EXPO超频参数设置不合理等，都可能导致问题发生。</p>
<p>通过主动执行内存诊断扫描，该软件可以判断设备崩溃是否由内存相关问题引发还是什么其它原因。</p>
<p>内存诊断功能将率先在Windows 11 Insider Preview Build 26220.6982（开发者频道）中上线。</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaef316666a744699d986917d8c197c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=o6d5de9VeGt2SmH%2BooToREQLwNE%3D" alt="alt text" loading="lazy"/>​</p>
<h2 data-id="heading-2">使用教程</h2>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ba2e4cb907f4bc8aa8634922fc5adc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=utTqBS7vZybLJYW4r%2BIDRWKRDZU%3D" alt="alt text" loading="lazy"/>​</p>
<p>命令提示符：右键点击开始菜单选择终端或终端管理员，在终端设置里找到命令提示符，将管理员身份运行配置文件启用。</p>
<p>终端设置需要点击右上角的小箭头选中</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9195b7acd434aa0bd21ac1193e622d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=w01jf89cqRb7%2FfIet9ddNw9ZL%2Bg%3D" alt="alt text" loading="lazy"/>​</p>
<p>然后在终端设置里带点击左侧导航栏的启动，在最上面将默认配置文件修改为命令提示符，完成后再点击底部保存按钮。如果是PowerShell也可以。</p>
<p>首先下载 ViveTool 工具，下载完成后将其解压到电脑任意指定位置。接下来找到 ViveTool 的解压文件夹并进入，在文件路红上面直接输入cmd按回车。</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7fd120ba6f644a29d010ae95323cef7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=KtwO2K%2FOUwC48M3u3Y5GdH%2FUxDY%3D" alt="alt text" loading="lazy"/>​</p>
<p>然后在终端里敲入 “vivetool”，按回车看看会不会报错。如果能正常弹出一堆参数说明，就说明之前的步骤都没问题；如果是弹出红色错误或者提示找不到命令，那可能是文件夹没找对，继续重新来一遍。</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714d59ac17714c3b85aa9ce9abaeac9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=HnhN75Hjt9wc7%2FWMlf1nPcgNLaw%3D" alt="alt text" loading="lazy"/>​</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment">#在ViveTool v3.0+版中，启用和禁用功能分别如下</span>
<span class="hljs-comment">#启用某个功能</span>
vivetool /enable /id:数字
<span class="hljs-comment">#禁用某个功能</span>
vivetool /disable /id:数字
<span class="hljs-comment">#数字代表功能的标识符</span>
<span class="hljs-comment">#在ViveTool 2.0及以下版本中启用和禁用功能分别如下</span>
<span class="hljs-comment">#启用某个功能</span>
vivetool addconfig 数字 2
<span class="hljs-comment">#禁用某个功能</span>
vivetool delconfig 数字 2
</code></pre>
<p>比如启用功能：输入以下命令并按回车键：vivetool /enable /id:57048231,47205210,56328729,48433719</p>
<p>新的界面</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23327ff3ed1b4c09ac49b5fe6143bb83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=lZCGIWZly2HrXqiwaygHFL%2BdOj8%3D" alt="alt text" loading="lazy"/>​</p>
<p>注意要重启电脑</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3525dad746d54328b72b70f9031a9e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pCc572X5LiH55u4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763977390&amp;x-signature=8p43JYln3oBdYy68pPpj2%2Bg6PoQ%3D" alt="alt text" loading="lazy"/>​</p>
<h2 data-id="heading-3">ViveTool最新版下载地址：</h2>
<p>前往Github项目主页下载ViveTool最新版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthebookisclosed%2FViVe%2Freleases%2F" target="_blank" title="https://github.com/thebookisclosed/ViVe/releases/" ref="nofollow noopener noreferrer">github.com/thebookiscl…</a></p>
<p>如果不好下载，我这里也提供了</p>
<p>地址获取一： <a href="https://link.juejin.cn?target=https%3A%2F%2Fweibo.com%2Fttarticle%2Fp%2Fshow%3Fid%3D2309405227188327940866" target="_blank" title="https://weibo.com/ttarticle/p/show?id=2309405227188327940866" ref="nofollow noopener noreferrer">系统优化工具一</a></p>
<p>地址获取二： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.toutiao.com%2Farticle%2F7566624543708561947%2F" target="_blank" title="https://www.toutiao.com/article/7566624543708561947/" ref="nofollow noopener noreferrer">系统优化工具二</a></p>
<p>‍</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini 3“超前点映”效果炸场，巴菲特305亿重仓谷歌]]></title>    <link>https://juejin.cn/post/7573172586840375348</link>    <guid>https://juejin.cn/post/7573172586840375348</guid>    <pubDate>2025-11-17T10:02:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573172586840375348" data-draft-id="7573512056088592419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini 3“超前点映”效果炸场，巴菲特305亿重仓谷歌"/> <meta itemprop="keywords" content="Gemini,AI编程,Trae"/> <meta itemprop="datePublished" content="2025-11-17T10:02:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini 3“超前点映”效果炸场，巴菲特305亿重仓谷歌
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-17T10:02:25.000Z" title="Mon Nov 17 2025 10:02:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Gemini 3 还未正式发布，“超前点映” 已悄悄亮相。</p>
<p>许多网友都分享了自己的一手实测，表示 Gemini 3 的表现实在是强到飞起。</p>
<p>它可以将不同游戏缝合到一起，在网页中创建一个《我的世界》风格的塔防游戏；</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5a0e6c4f574f04859ac67f879e4da1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=0Qh%2BSvvG3ftWOhNlpDghKMOwV7I%3D" alt="" loading="lazy"/></p>
<p>也可以用 SVG 动画直接在网页中复刻一个 Switch，还是带屏幕能模拟宝可梦的那种。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e6f5f91533042e9a763a4efb5d1720b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=2p9xkFdblWHrIofRwlzHdyaspKE%3D" alt="" loading="lazy"/></p>
<p>不仅能力超强，Gemini 3 的关注度也是相当火热。</p>
<p>甚至有机构发起了猜猜乐，消息还被谷歌 CEO 劈柴哥亲自转发，并配上了两个耐人寻味的 emoji 符号。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c580357af5b43c3bdbe4b992d57737b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=50jRdYMaB2xVQhR53iIbCgAKXw0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">Gemini 3“超前点映” 上线</h2>
<p>据网友介绍，Gemini 3“超前点映” 的入口藏在 APP 当中。</p>
<p>需要将 APP 更新然后打开，并使用基于 Gemini Pro 2.5 的 Canvas 功能，实际调用的就是 Gemini 3。</p>
<p>这名网友还放出了 APP 和网页端的对比 ，同样使用 2.5 版本的 Canvas，结果表现差异明显。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61bbb8c3f4ac42fbbee61760a9218023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=WJSt2283o9JhMXvdHACqgevhI5E%3D" alt="" loading="lazy"/></p>
<p>不过随后又有其他网友表示，网页端也已经上线了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2031479b450e45e296db0c728d88c601~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=yZd90Ke7oOzNAxTr2IGCV2%2BF24k%3D" alt="" loading="lazy"/></p>
<p>除了官方途径之外，一些第三方平台，例如 OpenRouter 当中，也据传藏有 Gemini 3.0。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031a403610794ced9b27fa1ab64bda5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=UlNr13qLdfyclU9ZBp2jfao3dGU%3D" alt="" loading="lazy"/></p>
<p>想亲自体验的话可以按照上面说的试试，接下来我们继续看 Gemini 3 都被网友玩出了哪些花样。</p>
<p>比如做一个 “新粗野风格” 的网页，Gemini 3 的设计优美，看上去颜值相当在线。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b0f80bcd6c642bc84418209afb5aee1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=PxUgGBN%2BM48uHmM7pOWbrwf4zq0%3D" alt="" loading="lazy"/></p>
<p>并且 Gemini 3 在 SVG 图形绘制上大有长进，绘制出的苹果手机，已经完全没有了矢量元素拼接的不真实感。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47d688f4f9c84d00b7e3f6492229061a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=akHqsSb9gBzTCgiNMFp5T%2FH4oso%3D" alt="" loading="lazy"/></p>
<p>而且 SVG 不仅限于静态，还支持交互，比如这个网页版风扇，不仅形状和谐，还支持开关和风速调节。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73faafce381841d18025882bb750a42c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=lLwFd6NrjQymUP05gnyefV8l2H8%3D" alt="" loading="lazy"/></p>
<p>当然说到交互，还有更复杂的效果，下面这个《我的世界》风格的竞技场，不仅画风毫无二致，还支持像在真的游戏当中一样移动探索。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f39cefedfa934bf5a6d751960669e566~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=IgHhMRun%2FWAZmCdlX2b7y%2BReL8A%3D" alt="" loading="lazy"/></p>
<p>甚至是克隆一个 YouTube，还是有视频能播放的那种。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79b6cd3cf0094670804b4983bea747da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=Qy3KF98cFdD86ru%2FFU17KNnyJ4o%3D" alt="" loading="lazy"/></p>
<p>凭借这样的表现，Gemini 3 这波 “超前点映” 除了吸引了网友的目光，也让投资界开始蠢蠢欲动。</p>
<h2 data-id="heading-1">巴菲特 305 亿重仓谷歌</h2>
<p>谷歌 Gemini 3 发布在即，对市场观望已久的股神巴菲特出手了，直接抛出 43 亿美元（约 305 亿人民币）加仓 Alphabet。</p>
<p>并且据传谷歌让他提前体验了一波 Gemini 3，他看到 Gemini 3 一次就完成了一个复杂的 Python 到 Rust 迁移任务之后，做出了重仓的决定。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a2a0b5525bf462bb18be7398b0a0114~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=KTDE5hysMBmkriBu1qFknhyrBuI%3D" alt="" loading="lazy"/></p>
<p>巴菲特的伯克希尔 · 哈撒韦公司披露，Alphabet 已成为该集团第十大最有价值的持股。</p>
<p>对比更鲜明的是，过去一年多以来，巴菲特揣着大把现金就是不投资，一直在回避 AI 热潮。</p>
<p>他此前的 1540 亿美元财富，也是通过投资可靠但并不引人注目的公司获得，基本上避开了科技投资。</p>
<p>今年以来，Alphabet 的股价飙升了 46%，人工智能的需求推动了其云业务的发展，并巩固了其在搜索和 YouTube 领域的统治地位。</p>
<p>实际上，自从 2022 年底 ChatGPT 横空出世以来，大家普遍觉得谷歌好像在 AI 上慢了一拍，在后面拼命追赶。</p>
<p>为了追赶，谷歌使出了它的看家本领，也就是全栈优势——它不仅自己有能力研发 AI 模型，还拥有庞大的产品来分销，更有自己的云业务提供基础技术设施支持。</p>
<p>特别是随着 Nano Banana 的炸场，使用 Gemini 的用户快速飙升，而且 AI 非但没有动摇谷歌最赚钱的广告生意，反而使其得到了增强。</p>
<p>增长之下，要求 CEO 劈柴哥辞职的呼声也逐渐平息。</p>
<p>巴菲特甚至承认，多年前没有买入谷歌是他 “错失良机”。</p>
<h2 data-id="heading-2">One More Thing</h2>
<p>除了 Gemini 3，Nano Banana2 也据传将在本周发布。</p>
<p>另外还有知情人士表示，除了这两个模型，谷歌还将会有其他发布。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82490317a70e4bc3b28f74af3fcd7d7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763978545&amp;x-signature=qST0%2FUv%2B6EBOBmx86VDZrTu25%2FQ%3D" alt="" loading="lazy"/></p>
<p>可以狠狠期待一波了。</p>
<p>参考链接：<br/>
[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fminchoi%2Fstatus%2F1989372162336301115" target="_blank" title="https://x.com/minchoi/status/1989372162336301115" ref="nofollow noopener noreferrer">x.com/minchoi/sta…</a><br/>
[2]<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.businessinsider.com%2Fgemini-3-launch-google-ai-race-chatgpt-2025-11" target="_blank" title="https://www.businessinsider.com/gemini-3-launch-google-ai-race-chatgpt-2025-11" ref="nofollow noopener noreferrer">www.businessinsider.com/gemini-3-la…</a><br/>
[3]<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.dailymail.co.uk%2Fyourmoney%2Farticle-15292817%2Fwarren-buffett-alphabet-investment.html" target="_blank" title="https://www.dailymail.co.uk/yourmoney/article-15292817/warren-buffett-alphabet-investment.html" ref="nofollow noopener noreferrer">www.dailymail.co.uk/yourmoney/a…</a></p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>