<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[AI 之旅：大模型]]></title>    <link>https://juejin.cn/post/7601076694105604132</link>    <guid>https://juejin.cn/post/7601076694105604132</guid>    <pubDate>2026-02-01T12:21:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105604132" data-draft-id="7598587406706884649" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 之旅：大模型"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-01T12:21:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="薛定猫的谔"/> <meta itemprop="url" content="https://juejin.cn/user/905653310726328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 之旅：大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310726328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    薛定猫的谔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T12:21:22.000Z" title="Sun Feb 01 2026 12:21:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简介</h2>
<p>2022 年 11 月 30 日，OpenAI 正式发布 ChatGPT，人类自此迈入真正可用的 AI 工具时代。在此之前，AI 仅局限于专业研究领域，普通人很少听过或者使用 AI 工具，日常接触最多的也只是车牌识别（文字识别）、语音识别等基础应用；而从 ChatGPT 诞生起，大模型的广泛应用让普通人得以在日常生活中受益，无论是利用 AI 生成视频、辅助写作、编写代码，还是进行智能对话，AI 都已深度融入各类日常场景。</p>
<p>自 1956 年 AI 概念正式诞生以来，行业先后经历了黄金年代、第一次 AI 寒冬、繁荣期、第二次 AI 寒冬与冷静发展期，如今已正式步入大模型时代。当下，大量 AI 应用持续造福人类，正深刻改变着人们的生活方式。</p>
<p>大模型究竟是什么？复杂来说，大模型是基于海量数据训练而成的巨型人工智能模型，其核心原理是通过海量参数学习数据中的复杂模式，采用“预训练+微调”的框架，先通过无监督学习掌握通用知识，再针对具体任务进行优化，最终形成真正可用的 AI 工具。简单来讲，大模型就是一个通过数学计算模拟人类认知推理过程的工具，它并没有多数人想象中那么强大——没有意识，并非无所不知，甚至可以将其看作一个函数，接受输入、产生输出，只是多数情况下，输出内容能贴合我们的预期而已。比如我们向模型输入问题：“地球和太阳之间有哪些行星？”，大模型会输出：“根据太阳系行星的轨道顺序，在地球和太阳之间的行星有两颗，按照距离太阳由近到远的顺序，分别是水星和金星。” 事实上，大模型未必能完全理解这个问题，甚至不清楚自己输出的内容是否正确，它只是机械地根据此前的训练数据，逐一生成对应的 token 而已。</p>
<p>但无论如何，大模型（像 GPT 系列、文心一言、豆包、通义千问、Grok、DeepSeek）确实能帮我们解决不少问题，至少可以辅助甚至替代人类完成一些简单或机械化的任务，并且它必将持续深刻地改变人类的生活。</p>
<p>接下来，我们就一起来了解大模型时代必备的一些 AI 相关术语。</p>
<h2 data-id="heading-1">术语</h2>
<h3 data-id="heading-2">AI</h3>
<p><strong>英文全称</strong>：Artificial Intelligence<br/>
<strong>解释</strong>：直译为人工智能，即通过技术手段让机器模拟人类的智能行为，涵盖思考、学习、决策及执行各类任务的能力。</p>
<h3 data-id="heading-3">AIGC</h3>
<p><strong>英文全称</strong>：Artificial Intelligence Generated Content<br/>
<strong>解释</strong>：直译为人工智能生成内容，指由人工智能系统自动生成或创造的各类内容，常见的有文本、图片、音频、视频等。</p>
<h3 data-id="heading-4">LLM</h3>
<p><strong>英文全称</strong>：Large Language Model<br/>
<strong>解释</strong>：直译为大语言模型，是指在海量数据上训练而成、拥有数十亿甚至万亿级参数的深度学习模型。例如我们熟悉的ChatGPT-3.5（参数量约200亿）、DeepSeek-V3.2（参数量约6850亿）、豆包1.5（参数量约2000亿）。<br/>
<strong>基座模型</strong>：指未经过特定任务微调、具备通用能力的原始大模型。<br/>
<strong>多模态</strong>：目前许多 LLM 不仅能处理文本信息，还能兼容图像、音频等多种格式的信息，这类模型被称为“多模态大模型”。</p>
<h3 data-id="heading-5">Prompt</h3>
<p><strong>解释</strong>：直译为提示词，是用户与LLM进行交互的核心指令和输入内容，也是引导模型生成特定、高质量输出的关键。<br/>
一个优质的提示词通常包含：<strong>角色、任务、上下文、输出格式</strong>等要素，如：</p>
<blockquote>
<p><strong>角色：</strong> 你是一名顶级的行业战略顾问。
<strong>任务：</strong> 为我分析中国新能源汽车行业2024年的竞争格局，并预测未来2年的关键发展趋势。
<strong>分析框架：</strong> 请运用经典的波特五力模型展开分析，并补充SWOT分析中的核心机遇与威胁。
<strong>输出格式：</strong> 请以清晰的Markdown格式呈现，运用标题、列表并加粗关键结论。</p>
</blockquote>
<h3 data-id="heading-6">SFT</h3>
<p><strong>英文全称</strong>：Supervised Fine-Tuning<br/>
<strong>解释</strong>：直译为监督微调，指在通用大模型（即基座模型）的基础上，利用特定领域、高质量的标注数据对其进行额外训练，使其能更好地适配特定任务或应用领域。</p>
<h3 data-id="heading-7">Token</h3>
<p><strong>解释</strong>：是大模型理解和处理文本的基本单位。大模型生成内容时，会先将用户输入转换成一个个 Token，通常一个英文单词或一个汉字是一个 Token（具体取决于词汇本身及分词器的设计），再逐一生成 Token，最终形成可正常阅读的文本。大模型对输入和输出的处理存在限制，单次交互中能够读取和考量的 Token 数量有上限，这一上限被称为 Token 窗口（也叫上下文窗口）。窗口大小直接决定了单次可向模型输入的信息量，GPT-3 最初的窗口仅为 2K Tokens，而目前最新的部分模型已支持 200K 甚至 1M 以上的窗口规模了。</p>
<h3 data-id="heading-8">RAG</h3>
<p><strong>英文全称</strong>：Retrieval-Augmented Generation
<strong>解释</strong>：直译为检索增强生成，其核心逻辑是：当用户提出问题时，系统会先从外部知识库（如文档、数据库等）中检索出与问题相关的信息，再将这些信息作为上下文，与用户的问题一同提交给大模型，由模型结合检索到的信息生成最终答案。</p>
<h3 data-id="heading-9">MCP</h3>
<p><strong>英文全称</strong>：Model Context Protocol<br/>
<strong>解释</strong>：直译为模型上下文协议，是由 Anthropic 公司（Claude 的研发机构）提出的一种开放协议标准。它规范了应用程序向大语言模型提供上下文的方式，通过标准化接口，可实现大模型与各类外部工具、数据源的高效联动。</p>
<h3 data-id="heading-10">Agent</h3>
<p><strong>解释</strong>：译为智能体，是一种更高级的 AI 应用模式。它不仅具备生成回复的能力，还能自主感知环境、规划任务目标、调用相关工具，进而完成一系列复杂的任务。AI Agent 是 AI 应用的最终形态，可以帮助人类完成复杂的任务，如可以帮助程序员写代码的 Agent，可以自动回答和处理订单的客服 Agent。</p>
<h2 data-id="heading-11">总结</h2>
<p>以上便是大模型时代核心 AI 术语的系统解析，从 AI 的基础定义的到 Agent 的高级应用形态，从 ChatGPT 开启的 AI 工具新时代，到大模型“预训练+微调”的核心逻辑，我们梳理了入门必备的关键知识。这些术语不仅是理解 AI 技术的基础，更是我们高效运用大模型、把握其发展趋势的前提，而随着技术的不断迭代，大模型与各类 AI 应用的深度融合，也必将持续深刻地重塑我们的生活与工作方式。</p>
<h2 data-id="heading-12">彩蛋</h2>
<p>彩蛋：这篇文章/视频也是在 AI 润色等辅助下进行的</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年终总结-迷途漫漫，终有一归]]></title>    <link>https://juejin.cn/post/7601444617695199242</link>    <guid>https://juejin.cn/post/7601444617695199242</guid>    <pubDate>2026-02-01T12:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601444617695199242" data-draft-id="7601843004958048302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年终总结-迷途漫漫，终有一归"/> <meta itemprop="keywords" content="前端,程序员"/> <meta itemprop="datePublished" content="2026-02-01T12:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大前端helloworld"/> <meta itemprop="url" content="https://juejin.cn/user/3070301798935687"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年终总结-迷途漫漫，终有一归
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3070301798935687/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大前端helloworld
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T12:28:02.000Z" title="Sun Feb 01 2026 12:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>时间过去真快啊，不知不觉26年已经到来了，也挺久没写文章了。入职了新的公司，不像之前那么轻松了，之前上班无聊还可以写写文章，现在不行了，没那么多时间和精力去写了。<strong>虽然是早九晚六的工作，但工作强度比之前大点，下班了就没什么精力去思考，去写作，加上也懒了下来。不像之前那样去思考，把自己的感受写下来，回来就想躺床上，或者去外面溜达溜达，放松放松自己。</strong> 2025年呢，可以说是经历很多，情感上，生活上，工作上，社会上。感情上呢，从喜欢一个人，到黯然离去，从自卑到自信。生活上，从广东到上海，从四季都是常青树，到了上海，也算是体验到了什么是秋天，冬天。工作上从上家公司离职到找到工作入职，而新公司呢，也给了我不一样的感受，且听我后面娓娓道来。社会上呢，也许只有经历过那种很难的维权，才知道生活的不易，成年人的世界有多难，总有一种说不上的伤感。也许吧，可能年龄到了。</p>
<p><strong>经历虽多，体会也颇多，也许人生就应该多经历，多体验。多出去走走，体会人间的酸甜苦辣，也不至于老了之后总谈，村里的那两三亩地之事。</strong> 到了老之后，也做一位喋喋不休的老人，之前我去过上海，在哪工作，身边都是一群很厉害的人，跟什么博士生啊，硕士生啊，一起共事过，在上海，去看过东方明珠，哪里有多繁华，消费可高了。去过南京，尝了鸭血粉丝汤，看了梧桐落叶，经历了第一场雪，也爬了中山陵。到苏州，去过虎丘，看哪金黄色的银杏，有多美，也去看了吴下名园-----留园，还有杭州的西湖美景......,已经可以想象晚年时，自己对着村里一群孩童吹嘘当年自己走过的路。然后他们一脸不可置信的模样，想想就挺有意思的。<strong>报纸上说，生活不是你活过的样子，而是你记住的样子。人生海海，潮落之后时潮起，你说那是消磨，笑柄，罪过，但那就是我的英雄主义。</strong></p>
<h3 data-id="heading-1">感情上-感情上是波折的，喜欢是埋藏在酒里的</h3>
<p>去年过年回去的时候认识了一位女老师，挺喜欢的，因为不管是对方的模样，还是谈吐，还是阅历都挺不错的，毕竟是教语文的。刚好我又是一名小文艺的爱好者，当然本人可不文艺，想着找另外一半文艺点。刚好方方面面都是我喜欢的类型，就陷入了恋爱脑，感性了起来，不过现在看看当时的自己，是有点让自己脚趾头都能抠出个三室一厅出来的“尴尬”。但我不认否那段经历，还有写下的文章。现在给我写我也写不出如此感性的文章。故事很长，感兴趣的你且去看吧。</p>
<p><a href="https://juejin.cn/post/7482656785863049267" target="_blank" title="https://juejin.cn/post/7482656785863049267">这是写在春天的故事</a></p>
<p><a href="https://juejin.cn/post/7483496985954598938" target="_blank" title="https://juejin.cn/post/7483496985954598938">那个男孩长大了。</a></p>
<p><a href="https://juejin.cn/post/7519647677022863411" target="_blank" title="https://juejin.cn/post/7519647677022863411">反正今天我觉得是很美很充实的一天就行了</a></p>
<p>最近热播一部动漫《剑来》我挺喜欢的，不仅是喜欢那种江湖的快意恩仇。什么是江湖？人即是江湖。什么是江湖，恩怨即是江湖。江湖是美丽的，在深夜的街头独自挥舞着刻着自己名字的剑，像风一样潇洒；江湖是无奈的，看着自己的师友至爱喋血黄沙，为报仇也只能十年面壁。这就是江湖。</p>
<p>挺喜欢剑来的有一句话：<strong>喜欢一个人，总得让她开心吧，如果觉得喜欢谁，谁就一定要跟自己在一起，这还是喜欢吗？ 说到这里，少年眼泪便流了下来。</strong> 是我就是嘴上这么说说的，其实我都快伤心死了。 我其实恨不得整个倒悬山，整个浩然天下，都知道我喜欢那个姑娘。可是要是你的宁姑娘不喜欢你呢？一位好姑娘不喜欢你，一定是你还不够好。等到你哪天觉得自己足够好了，姑娘兴许也嫁了人，然后连她的孩子都可以出门打酒了。在路上见着了你，喊你叔叔，那会儿，也别伤心，是缘份错了，不是你喜欢错了人。记住，那位姑娘嫁人之后，就别纠缠不清了，把那份喜欢藏好，都放在酒里。每次喝酒的时候，念着点她把未来日子过得好，别总想着什么她日子过不好，回心转意来找你。那才是一个男人，真正的喜欢一个姑娘。这可能就是喜欢吧。</p>
<p><strong>又或许我们一开始读的《小王子》就告诉了我们什么是爱。‘‘十几岁的时候渴慕着小王子，一天之间可以看四十四次日落。是在多久之后才明白，看四十四次日落的小王子，他有多么难过”，《小王子》从来不是一个关于星球的童话，它是一面镜子，映照着每一个曾经相信爱、失去爱、又重新寻找爱的灵魂。在这个物质至上的时代，我们比任何时候都更需要这样一个声音，提醒我们什么是真正重要的东西 —— 那些眼睛看不见的东西。</strong></p>
<p>当然，生活不是小说。毕业后愈发明白，再浪漫的叙事也离不开现实的土壤。感情上是波折的，喜欢是埋藏在酒里的，毕业后中国式的爱情是基于物质基础上的。不像上学时那样的纯粹。其实不管是中国，还是国外，你看《呼啸山庄》，还是《简爱》，《霍乱时期的爱情故事》哪一个男主不是贵族，就算不是，最后也会发家，才有的爱情故事，在我看来，这些故事男主都是恋爱脑，有一个好处是这个动力很明显，有一种为了某个人而努力，比较坚定，意志力也比较顽强，也比较疯狂，有这种精神做什么都会成功。而我做不到，得不到就得不到吧，人总不可能死在一棵树上，这就是感情上的经历。</p>
<p><strong>弗洛姆说，爱的本质是要为某种东西付出“劳动”以及“使某种东西成长”；林清玄说，与爱同等重要的是努力的实践与真实的表达，没有透过实践与表达的爱，是无形的、虚妄的。</strong></p>
<h3 data-id="heading-2">生活上- 体验了四季的色彩</h3>
<p>故事还是从拖欠工资开始。因为上一份工作一直拖欠工资，不正常发工资。这个真的很影响人的精神，各种各样的影响，就比如，我也怀疑在这坚持的意义是什么，老板画了一个大饼又一个，但工资还是依然拖着不发。没了收入，人啊，是会变的不自信的。我同事说，他跟女朋友出去玩都不敢花钱，因为不知道公司什么时候会发钱。会陷入这种内耗中去。<strong>而我呢，也是这样，也变得不自信起来，刚好那女老师在那时候闯进我的世界，我就知道这个故事的结局是个悲剧</strong>。 后来我啊，开始养点花，来逃避这种焦虑的生活。但时间一长，会不会滚雪球，这雪球会不会更大，公司会不会倒闭，那时候我也想到这个事情，我也问同事，他说，他也不懂，几百号人的公司，总不能说倒闭就倒闭吧。心里想着：外面的行情也不好，这里包住，有自己的食堂很便宜，几块钱一餐，晚点发就晚点发吧。<strong>人啊，喜欢上了安逸的生活，就不再想折腾，就会变得麻木起来。</strong> 找工作很麻烦的，不是很想面试。</p>
<p>那时候跟同事关系都挺好，一起打台球，一起吃饭喝酒，聊天，因为大部分都是同龄人，相差不大，所以玩的比较来。我们总喜欢喝酒高声论谈，一起蛐蛐领导，因为这个领导确实是不太喜欢当人。公司一拖工资，然后大家也陆陆续续离职了。这一年写满了别离，聚了一次又一次都是在跟好友道别，周五才跟部门的同事聚了，今晚也跟室友喝了。诺大的宿舍也只剩下我一个。<strong>最后在百合花开后，我也悄悄离开，给这一年半的青春画上了句号。是麻木的，是焦虑的，是不舍的，是迷茫的.....</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ae3cfb96774e188ac24d8886f472f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=YSGNILUjRQbmhd%2BVIGahJnks1Vc%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/482d8afea5c943c69a9b9dca32872a44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=fwve5buieEGCUzt2%2Fcbc0UWxJiE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>后面就是回家，找工作，也写下了这篇文章，关于求职记录的。经历那么多，总要留下什么，就用文字把它给记录下来。</p>
<p><a href="https://juejin.cn/post/7544302209161527335" target="_blank" title="https://juejin.cn/post/7544302209161527335">写下自己求职记录也给正在求职得一些建议</a></p>
<p><strong>报纸上说：生活是如此的令人绝望，但人们兴高采烈地活着。这些文邹邹的话，当然是报纸上说的，我是说不出来。</strong></p>
<p>最后决定来上海的工作的时候，心里是紧张的，也带有些不安。虽然之前在上海实习过，但想想离家那么远，真的有必要嘛？但生活不就是“向钱”看嘛，上海这边的待遇，给的比较高，如果加上年终奖，但上海的消费也真的高，纠结再三，跟上海的面试官沟通了一下，这边不加班，在郊区租房不是很贵。广东给的待遇也还行，也不低，但想了很久，我在广州生活了三年多了，我想换种生活方式，也想换个地方生活。</p>
<p>关于是继续留在广州，还是去上海的这个问题，当时跟朋友讨论了很久。也看了一本书《人生》。<strong>人生的道路虽然漫长，但紧要处常常只有几步，特别是当人年轻的时候，没有一个人的生活道路是笔直的、没有岔道的。有些岔道口，譬如政治上的岔道口，事业上的岔道口，个人生活上的岔道口，你走错一步，可以影响人生的一个时期，也可以影响一生。</strong></p>
<p>如果你是高加林你如何去续写《人生》，有人说，他可能是回去当民教老师了，因为好像这很合适他的经历，经历大起大落后，感悟了人生，想要过上安稳的生活，而巧珍跟她姐也为他去说服书记，书记也点了头，好像这个结局，更多人喜欢。也许其他人从中作梗，又或许是因为之前的行为让他良心不安，还是其它的因素呢，没当成老师或许不想当老师了呢，他回去继续当起了农民。也有人说，见过了大城市模样，读过书的他又岂会甘心待在这高村，他才二十四岁！</p>
<p>那你呢，如何去续写自己的人生呢。之前同学找工作，找了一份薪资一般的工作，我说这工资，除开这，除开那，挣不了多少钱的，还不如回广西发展，虽然会比这少一点，好像最后剩下的钱差不多吧。他说，是差不多，但外面好玩点，有时间可以去市区走走，看看繁华的都市，机会也多一些，还年轻，在外面总比在广西要好。<strong>现在到我了，生活回旋镖命中了我。</strong></p>
<p><strong>其实我们每个人都是自己人生的‘高加林’，站在岔路口，笔下写着未来的剧本。生活总是这样，不能叫人处处都满意。但我们还要热情地活下去。人活一生，值得爱的东西很多，不要因为一个方面不满意，就灰心。</strong></p>
<p><strong>国人总喜欢做阅读理解，试图把自己带入进去，我也不例外。</strong></p>
<p>如果说之前的经历了是人生"四季",生活也是体验了四季。</p>
<p>之前一直在广州工作，周围都是四季常青树。来到这边才发现，原来秋天，也有其它颜色，银杏的金黄色，梧桐的焦糖色，还有枫叶红色。还有冬天也会有白色。上海的秋，与南国的秋不同。</p>
<blockquote>
<p>骑上我的小电驴
去看秋，吹秋风
看那
染上焦糖色的梧桐
烧得正烈的枫叶
裹着金箔的银杏
看到喜欢的落叶
悄悄捡几片装进口袋
把秋的碎品一一收藏🍂
这个秋与以前的秋不同
是藏在色彩里别样的风景
对于常待在一年四季
都是常青树的人来说
是那么的新鲜
不一样的秋。</p>
</blockquote>
<p>这是南方人对秋颜色的喜爱，与惊奇，原来秋不仅是落叶，也有其它颜色。我还特地跑去苏州虎丘，看了金黄色的银杏，看了红色的枫叶，跑去南京看焦糖色的梧桐叶。好像人生仿佛多了一种颜色，好像过上了人生的第一个秋天。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/609a6eb790f24ab38f85308e89e94a13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=8CzNWWv7nOhtyRoL7vz0%2Bt7KSFE%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f1ddbb756d54913b99eacc799a634ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=V5JwwghE%2Byf4Hnj1Yj%2FS1UrwAU0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>对于看雪，这是南方的人执着，就好像北方人对看海的执着一样。很幸运，去南京跨年，刚好南京下了第一场雪，跟朋友去爬中山陵看了，这是我第一次体验到雪的温度，就像站在开着冰箱门，站在门口一样，冷。也堆了个小雪人，丑萌丑萌的，甚是喜欢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36b4f323e87f48a1845b2c7e4653697c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=0J64sZLFF8rGkG393A1asHDBzkg%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e52f85928544b1b485bc770f9c18d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=cu5kZmfaMwpCLN6u3L3r0%2Fc%2FBEs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>幸运的不止南京的第一场雪，你说巧不巧，上海也下了一场许久未下的雪，算是看到了飘雪与下雪。想起了两句诗：<strong>忽有故人心上过，回首山河已入冬。他朝若是同淋雪，此生也算共白头。</strong> 这时候才能明白这首诗的意思。<strong>白头若是雪可替，世间何来伤心人。此时若有君在侧，何须淋雪作白头。</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6417cd66ee7a47738d6a4fbea1569af7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=iSlGvZOoVsUGv4epILOaRY3umrw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>人生也算补齐了两季，秋与冬，“四季圆满”。</strong></p>
<h3 data-id="heading-3">工作上-从技术到业务，AI时代技术重要呢，还是业务重要呢</h3>
<p>这是一进入新公司leader就丢给我的问题，你的技术基本工可以了，我想让你去搞业务，这样你能走的更远。因为这里的技术是相对于来说比较老，而业务是比较吃香的，毕竟是搞自动驾驶的。这个赛道也进入了决赛圈。入职到现在也有五个多月了，最大的感受，高学历的人跟我这些普通本科的毕业，相比来说：他们的综合能力真的强，学习能力，演讲能力，逻辑表达能力是真的强，做事也很严谨，看起来比较“专业”。但也有一点不好，就是比较思维固定化，比较喜欢按“规矩”，流程，办事，所以技术还是用的比较老。这是给我最直接的感受。</p>
<p>在AI工具日益强大，甚至能自动生成代码的今天，技术的价值在哪里？一个只会埋头实现的技术人员，是否会被替代？业务重要还是技术重要。这看起来是比较题。其实这不是比较题，而是两者都是必选题。每次AI一出来，前端都要鞭尸一次，反复鞭尸。看了很多的博主也是在反复宣传，带节凑，然后卖课。换个角度，现在AI是风口，动不动就几十亿，他搞AI那么厉害，还会出来给你卖课嘛？他自己为什么不去搞，是不行吗，现在的AI岗位开的很高啊，所以冷静点，当然这些课程对你AI学习有帮助，你也当成兴趣哪就去学，也能为你未来带来的收益，那就去学。但AI这个我看岗位很多都是卡学历，学历是一个门槛。当然我的认知是浅薄的，信息差，渠道差各种，人与人之间是存在很多的差距的。</p>
<p>我的体会是，<strong>技术的深度依然是基本盘，是让你立得住脚的根基。没有扎实的技术，无法判断AI生成代码的优劣，无法在复杂系统中定位核心问题，更谈不上技术创新</strong>。但仅仅有技术，是远远不够的。技术最终要服务于业务，为社会创造价值。AI解放的是重复性的编码劳动，但无法替代的是对业务场景的深刻洞察、将模糊需求转化为技术方案的能力，以及跨领域沟通的智慧。</p>
<p>这就好比，给你世界上最先进的画笔和颜料，但画什么、为什么而画、这幅画要传递给观众什么情感，这才是决定作品层次的关键。</p>
<p>而对于业务呢？</p>
<p>听到这样的一句话，创业的第一步不是注册公司，租办公室，买设备，招员工，应该是先拿到一个足以支撑公司长期运营的项目。</p>
<p>三连问：谁来为你的产品买单?为什么他愿意为你的产品买单?你去那里找到这类人?</p>
<p>做产品之前先想明白这三个问题，而不是埋头去干，找不对方向，你能力越强会让你离目标越远。客户画像是什么，市场规模有多少，做出来哪些人要用，咨询过相关行业的专家吗，到底有没有实际价值，有没有竞品，未来发展如何，写个PPT和人讨论过没有，在软件公司做过一点点管理，有完整的项目经验都不会这么随意等等，以找不到工作为理由去创业纯属浪费人生。公司一定要有一两款自己的拳头产品，如果只是接客户的单子，必倒无疑。</p>
<p>有人觉得技术很重要，其实技术是最不值钱的，渠道，业务，才值钱，技术人总有一种错觉，觉得自己啥都会，出来接单，其实如何变现才是最难的，销售比技术重要。我们一直在谈的一句话，如何抓住用户痛点，解决用户需求，让客户为你的产品买单，但凡懂点产品都知道的道理。哪如何让用户买你单，其实不止是产品本身，更重要的是对人性的研究。懂产品固然重要，但懂用户更重要。为什么老板大部分是销售出身，<strong>因为他们更懂用户是怎样的人。</strong></p>
<p><strong>对于一个能够提供价值的产品，技术是最不重要的，重要的是你的产品思维和设计能力。 程序员和画家是一样的，相比于你用什么画笔、什么颜料画画，更重要的是你的作品。</strong></p>
<p>会做的干不过会说的。有这样的一句话：<strong>所有的成功都是从谎言开始，就看你是想成虫还是成龙，只有不断的居危进取，才能圆满让谎言成真，直到成功都没有被戳穿的谎言叫预言。</strong> 这样的哲学，靠PPT打动客户，有了客户，再去开发。这就是成功的预言。客户不会关心我们用了什么技术，客户只会关心这个产品给它们带来了什么收益，带来的价值是什么。</p>
<p>但对于我们这些搞技术来说，技术可以说是基本工。技术的深度决定我们能走多稳，而对业务与人的理解，将决定我们能走多远。在这个时代，做一个“能解决真实问题”的人，比做一个“只会写代码”的人更重要。之前我写过一篇文章。</p>
<p><a href="https://juejin.cn/post/7547527373882294272" target="_blank" title="https://juejin.cn/post/7547527373882294272">从初中级如何迈入中高级-其实技术只是“入门卷”</a></p>
<p><strong>当你的见识，跟知识体系足够大足够深的时候，你就能够跟大部分的面试官聊得来，技术广度，跟技术得深度，决定了你哪所谓得运气得大小。技术广度，我觉得是一种见识，而深度是一种好奇心思想，只有多问几个问什么，才会层层深入思考，打破沙锅问到底，这才会有这个深度。而广度是学习扩展得一种过程。在我看过来，这种广度不止是前端体系广度，更有交流沟通，用户交互，用户心理，社会，在产品中前端是怎样得一个角色，那看看产品得书籍以这种全局得思想去看待，也可以多跟大佬交流，前提是你认知能get他得表达意思。同时也要他认真跟你分享他得思想，而不是听他得。这种突破技术上得认知，这种见识得扩展是不是更好点。</strong></p>
<p>对于体系化的学习:</p>
<p><a href="https://juejin.cn/post/7549399482590347279" target="_blank" title="https://juejin.cn/post/7549399482590347279">前端梳理体系从常问问题去完善-基础篇（html,css,js,ts)</a></p>
<p><a href="https://juejin.cn/post/7552041099174690868" target="_blank" title="https://juejin.cn/post/7552041099174690868">前端梳理体系从常问问题去完善-工程篇（webpack,vite）</a></p>
<p><a href="https://juejin.cn/post/7558320134252494882" target="_blank" title="https://juejin.cn/post/7558320134252494882">前端梳理体系从常问问题去完善-框架篇（react生态)</a></p>
<p><a href="https://juejin.cn/post/7559905027567370255" target="_blank" title="https://juejin.cn/post/7559905027567370255">前端梳理体系从常问问题去完善-框架篇（Vue2&amp;Vue3）</a></p>
<p><a href="https://juejin.cn/post/7559981310472585250" target="_blank" title="https://juejin.cn/post/7559981310472585250">前端梳理体系从常问问题去完善-网络篇</a></p>
<p><strong>认知，经验，沟通，表达，理解，学习，这些综合能力提升，在AI的时代才能让我们走的更长远。哪怕换个赛道，这些也是你的底气。</strong></p>
<h3 data-id="heading-4">社会上-维权不易，为什么会有那么多的“多愁善感”的诗人算是明白了。</h3>
<p>之前也谈到公司拖欠工资，害，一直拿不到钱，仲裁也没用。公司竟以工资算错为由进行上诉拖着。关键是这理由也能通过。想给点压力，也像拳头打在棉花上。但凡想拉个横幅，就会有人先来找你。道理都懂，程序也走了，可最后发现，手里能用的力气，好像只剩下“等”和“认”。</p>
<p>这时候，才真正明白了，为什么古往今来，会有那么多“多愁善感”的诗人。</p>
<p>诗人的“多愁善感”，或许从来不是无病呻吟，而是面对庞大现实时，个体所能发出的、最执拗的回响。</p>
<p>在公司也承诺各种证据时，还是没能拿到钱那种无奈感。最后还出现了三方协商给出的方案。公司给出的方案让人觉得可笑。总的来说，给公司时间去运营，今年七月份开始结清百分之1的钱，一个月结百分之1。明确告诉你不按它的方案来，你维权就是困难的，公司就是脱着不给你钱的。可笑可笑，我都离职了，跟这家公司都没瓜葛了。还要我接受它的方案。对我来说，要么你倒闭清算，早点倒闭公司还有点资产。等过段时间倒闭了，资产转移完了，那真的资产什么都没有了。而且离职的时候公司已经给出承诺书，什么时候结清。到了时间点一份不结。信誉呢，你觉得哪方案可笑嘛。<strong>被拖欠的薪水、被消耗的时间、被践踏的契约精神——最终都被抽象成了一个案号。</strong></p>
<p>这种无力感，不是愤怒。愤怒需要对象，需要一座可以冲锋的山头。而它是一片沼泽，陷在里面，找不到一个可以着力捶打的东西。面对的，是一整套精密、冰冷、按部就班的“程序正义”。它没有面孔，没有温度，它只是缓慢地、无可指摘地运转着。</p>
<p>突然就懂了杜甫。懂了他在秋风中呼号“安得广厦千万间”时，那背后是眼睁睁看着具体的人在水深火热中挣扎，而自己除了写下诗句，无能为力的焦灼。也懂了白居易。懂了他在《卖炭翁》里，为什么要事无巨细地写下“满面尘灰烟火色，两鬓苍苍十指黑”，那不是闲笔，那是他知道，若不把一个人的苦难写得如此具体、如此触手可及，它就会轻易地被历史的烟尘盖过，被一句轻飘飘的“民生多艰”所概括。</p>
<p>诗人的“善感”，是因为他们无法对具体的人的痛苦闭上眼睛。而诗人的“多愁”，则是因为他们清醒地知道，自己的笔墨，或许改变不了那架嘎吱作响的庞然大物分毫。他们的“愁”，是对不公的敏感；他们的“感”，是对沉默的大多数的共情。当正常的路径无法疏解这种憋闷，文字就成了最后的气孔。</p>
<p>维权，是在用现代的、理性的规则，去争取一个古老的、质朴的公道。这个过程，会冷酷地剥去人的所有浪漫的想象，看见系统缝隙里的灰尘，和灰尘下面，一个个具体的人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1687b76df63a4eda9e59a821baf6f3a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5YmN56uvaGVsbG93b3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770554765&amp;x-signature=7AfAXLvZGtXzFc3gaKMvmBhlHk4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>那是一个个清醒的灵魂，在无力改变世界时，为自己，也为同类，所做的悲壮记录。他们用“多愁善感”，守护着人之为人的温度，对抗着世道惯常的麻木与遗忘。</p>
<p><strong>有时候我甚至想过弃码从文，因为文字的声音比程序更有力量，奈何没那个实力。</strong></p>
<h3 data-id="heading-5">总结</h3>
<p>报纸上说，生活是部压榨机，把人榨成了渣子，但人本身是压榨机中的头号零件。人生海海，世上只有一种英雄主义，就是在认清了生活真相后依然选择热爱生活。经历的多了，感慨就多了，也许就像刻在弗兰茨的墓碑上的一句话：迷途漫漫,终有一归。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用AI写代码18个月后，我发现了这些真相]]></title>    <link>https://juejin.cn/post/7601073900526354474</link>    <guid>https://juejin.cn/post/7601073900526354474</guid>    <pubDate>2026-02-01T12:47:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601073900526354474" data-draft-id="7601159804491251731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用AI写代码18个月后，我发现了这些真相"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-02-01T12:47:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="9号达人"/> <meta itemprop="url" content="https://juejin.cn/user/2450136052270077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用AI写代码18个月后，我发现了这些真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450136052270077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    9号达人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T12:47:10.000Z" title="Sun Feb 01 2026 12:47:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>用了AI写代码18个月，我发现一个真相，聊聊我的所思所想。</p>
<hr/>
<h2 data-id="heading-0">AI不是工具，是"初级工程师"</h2>
<p>以前我觉得AI就是个工具，用它就是让它帮我干活。</p>
<p>但有个观点挺对的：<strong>AI更像是一个初级工程师，你需要引导它、培养它，甚至还要驯化它。</strong></p>
<p>因为AI有默认的一些思维模型：它想尽快完成任务，然后获得你的表扬。</p>
<p>这会导致什么问题？</p>
<p>它会做一些<strong>看似正确但实际上很蠢的决策</strong>。</p>
<p>举个例子，比如你让写测试，他很多时候会各种mock数据，让你的测试完美通过，实际上你的业务代码是一个没测到，又比如你让他解决死锁问题，他竟然想出让进程休眠2秒这种离谱的方案。</p>
<p>为什么？</p>
<p>因为这样能快速解决问题啊！但这是不是基于当前业务规范的解决方案？它不在乎。</p>
<p>所以你需要的不是简单地使用AI，而是要<strong>引导它用正确的方式做事</strong>。</p>
<p>比如在提示词里强调要用规范的方式。</p>
<p>不要说：解决这个问题</p>
<p>要说：用一个规范的方式解决这个问题</p>
<p>还有，不要让它直接写代码，要它先解释清楚这个函数的意图。</p>
<p>这些细节挺重要的。</p>
<hr/>
<h2 data-id="heading-1">AI擅长什么？不擅长什么？</h2>
<p>这点太关键了，很多人要么过度吹AI，要么过度黑AI。</p>
<p>用了一年半AI编程助手后，我有几个挺实在的总结。</p>
<h3 data-id="heading-2">AI擅长的3件事</h3>
<p><strong>写业务逻辑代码</strong></p>
<p>这点我也有体会。</p>
<p>普通的增删改查、API接口、数据转换这些业务逻辑，AI写得比我快，有时候质量还真不错。</p>
<p>听着扎心，但确实是事实。</p>
<p><strong>找bug</strong></p>
<p>这个真的强。</p>
<p>我用到现在，还没遇到AI找不到的bug。</p>
<p>你只要描述症状，它能读代码、分析、找到根因。然后你让它解释为什么会这样，你会发现它的分析是对的。</p>
<p>有时候遇到复杂的bug，我会让AI先建立自己的心智模型，然后再找bug。</p>
<p>这样能找到一些很隐蔽的问题。</p>
<p><strong>理解烂代码和栈追踪</strong></p>
<p>AI真的很擅长读那些让人头大的烂代码，还有那些超长的报错堆栈信息。</p>
<p>这对接手别人项目、排查线上问题太有用了。</p>
<h3 data-id="heading-3">AI不擅长的3件事</h3>
<p><strong>前端界面的持续迭代</strong></p>
<p>我用AI写网页界面和终端界面，效果都不太好。可能刚开始还行，迭代迭代着就容易</p>
<p>崩，只有崩了一次，就很容易原地打转。</p>
<p><strong>复杂的性能优化</strong></p>
<p>前面说的死锁那个例子就很典型。</p>
<p>AI会想一些看似能解决但实际很蠢的方案，比如让进程休眠2秒。</p>
<p>要让它找到好的解决方案，你需要非常具体地引导它。</p>
<p><strong>需要深层理解的架构决策</strong></p>
<p>AI能生成代码，但它不真正理解你的系统。</p>
<p>它不知道你的业务场景、性能要求、团队情况、技术栈历史。</p>
<p>所以架构层面的决策，还是得靠人。</p>
<hr/>
<h2 data-id="heading-4">如何更好的写作？</h2>
<p>总结了几个很实用的技巧，可以借鉴一下。</p>
<h3 data-id="heading-5">引导它用规范的方式</h3>
<p>在提示词里强调要用规范的方式。</p>
<p>不要说：解决问题</p>
<p>要说：用规范的方式解决问题</p>
<p>不要说：写个测试</p>
<p>要说：写个测试，关注<strong>被测函数的意图</strong></p>
<p>这些小细节会让AI生成的代码质量提升很多。</p>
<h3 data-id="heading-6">让它先建立心智模型</h3>
<p>在找复杂bug时，我会先让AI建立自己的心智模型。</p>
<p>让AI先理解系统的整体架构、数据流、关键组件，然后再让它分析问题。</p>
<p>这个架构说明，更需要在工作中进行实时更新，维护好整体的项目说明</p>
<h3 data-id="heading-7">把它当成结对编程伙伴</h3>
<p>结对编程大家都知道，两个人一起写代码，互相评审、互相讨论。</p>
<p>我觉得：<strong>AI就是你的结对编程伙伴</strong>。</p>
<p>但它不是一个经验丰富的高级工程师，更像是一个需要你指导的初级工程师。</p>
<p>你要做的是：</p>
<ul>
<li>明确告诉它你的目标</li>
<li>给它提供足够的上下文</li>
<li>审校它生成的代码</li>
<li>引导它用正确的方式做事</li>
</ul>
<p><strong>你现在就是AI的编辑，不是写代码的人。</strong></p>
<hr/>
<h2 data-id="heading-8">最终的感受</h2>
<p>用了一年多的AI编程助手，我有几个很真实的感受。</p>
<h3 data-id="heading-9">程序员的角色真的在变</h3>
<p>以前我觉得程序员的价值在于写代码的速度。</p>
<p>但现在看来，这个价值正在快速下降。</p>
<p>因为AI写得比你快、比你准（在某些场景）。</p>
<p>那程序员的核心价值变成什么了？</p>
<p>我觉得是：</p>
<ul>
<li><strong>审校能力</strong>：判断AI生成的代码好不好</li>
<li><strong>引导能力</strong>：知道如何让AI用正确的方式做事</li>
<li><strong>架构能力</strong>：理解系统整体，做对的技术决策</li>
<li><strong>沟通能力</strong>：把业务需求翻译成技术方案</li>
</ul>
<h3 data-id="heading-10">手写代码可能会逐步变成爱好，不是工作</h3>
<p>有句话让我印象深刻：<strong>手写代码仍然有乐趣和价值，但不要指望这是你的工作。</strong></p>
<p>这话听着有点扎心，但确实是现实。</p>
<p>就像现在还有人手写汇编、手写C语言，但这不是主流开发者的日常工作。</p>
<p>也许以后手写代码也一样，变成了一种情怀，一种爱好，而不是谋生手段。</p>
<hr/>
<h2 data-id="heading-11">最后说几句</h2>
<p>ai编程了一段时间后，我的最大启发是：<strong>不要把AI当工具，要把它当伙伴来培养。</strong></p>
<p>它不是一个完美的助手，它有缺陷、有盲区。</p>
<p>但你如果你去引导它、驯化它，它真的能成为你最好的配对编程伙伴（也许未来都不需要太多的引导）。</p>
<p>编程在进化，程序员也在进化。</p>
<p>这不是坏事。</p>
<p>就像从汇编到C，从C到Java，每一次进化都让程序员从繁琐的细节中解放出来，专注于更重要的事情。</p>
<p>AI编程也是一样。</p>
<p><strong>我们只能拥抱变化，而不是恐惧它。</strong></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JSyncQueue——一个开箱即用的鸿蒙异步任务同步队列]]></title>    <link>https://juejin.cn/post/7601073900525223978</link>    <guid>https://juejin.cn/post/7601073900525223978</guid>    <pubDate>2026-01-31T14:55:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601073900525223978" data-draft-id="7601076694104375332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JSyncQueue——一个开箱即用的鸿蒙异步任务同步队列"/> <meta itemprop="keywords" content="HarmonyOS,TypeScript,Android"/> <meta itemprop="datePublished" content="2026-01-31T14:55:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="江澎涌"/> <meta itemprop="url" content="https://juejin.cn/user/1820446986338504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JSyncQueue——一个开箱即用的鸿蒙异步任务同步队列
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446986338504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    江澎涌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T14:55:40.000Z" title="Sat Jan 31 2026 14:55:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">零、JSyncQueue</h2>
<p>JSyncQueue 是一个开箱即用的鸿蒙异步任务同步队列。</p>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FzincPower%2FJSyncQueue" target="_blank" title="https://github.com/zincPower/JSyncQueue" ref="nofollow noopener noreferrer">github.com/zincPower/J…</a></p>
<h2 data-id="heading-1">一、JSyncQueue 有什么作用</h2>
<p>在鸿蒙应用开发中，有时需要让多个异步任务按顺序执行，例如状态的转换处理，如果不加控制，会因为执行顺序混乱而产生一些莫名其妙的问题。 所以 <code>JSyncQueue</code> 提供了一个简洁的解决方案：</p>
<ul>
<li><strong>保证顺序执行</strong>：所有任务严格按照入队顺序执行，即使任务内部有异步操作也能保证顺序</li>
<li><strong>两种执行模式</strong>：支持 "立即执行" 和 "延时执行" 两种模式，可以满足不同场景需求</li>
<li><strong>两种任务类型</strong>：支持向同步队列添加 "Message 类型任务" 和 "Runnable 类型任务"</li>
<li><strong>任务取消和管理</strong>：可随时取消指定任务或清空整个队列</li>
<li><strong>获取任务结果</strong>：通过任务的 <code>getResult()</code> 获取执行结果</li>
</ul>
<p>项目架构如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4fcd88072de4f9da8ff3d1c7fcd252f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5r6O5raM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770476139&amp;x-signature=P4ubIEk%2Fg3o%2BgFBgiyrcXeg8rBU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">二、如何安装 JSyncQueue</h2>
<p><strong>第一种方式：</strong> 在需要使用 <code>JSyncQueue</code> 的模块中运行以下命令</p>
<pre><code class="hljs language-bash" lang="bash">ohpm install jsyncqueue
</code></pre>
<p><strong>第二种方式：</strong> 在需要使用 <code>JSyncQueue</code> 的模块 <code>oh-package.json5</code> 中添加以下依赖</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sample"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Please describe the basic information."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"jsyncqueue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span> <span class="hljs-comment">// 添加这一行，请根据需要修改版本号</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">三、JSyncQueue API 介绍</h2>
<h3 data-id="heading-4">3-1、JSyncQueue 类</h3>
<h4 data-id="heading-5">构造函数</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">queueName: <span class="hljs-built_in">string</span></span>)
</code></pre>
<p>创建一个同步队列实例。</p>
<ul>
<li><code>queueName</code>: 队列名称，用于标识和调试</li>
</ul>
<h4 data-id="heading-6">方法</h4>



























































<table><thead><tr><th>方法</th><th>参数</th><th>返回值</th><th>说明</th></tr></thead><tbody><tr><td><code>post(runnable)</code></td><td><code>runnable: (taskId: number) =&gt; Promise&lt;Any&gt;</code></td><td><code>Task</code></td><td>立即执行闭包</td></tr><tr><td><code>postDelay(runnable, delay)</code></td><td><code>runnable: (taskId: number) =&gt; Promise&lt;Any&gt;</code>, <code>delay: number</code></td><td><code>Task</code></td><td>延时 delay 毫秒执行闭包</td></tr><tr><td><code>sendMessage(message)</code></td><td><code>message: Message</code></td><td><code>Task</code></td><td>立即发送消息</td></tr><tr><td><code>sendMessageDelay(message, delay)</code></td><td><code>message: Message</code>, <code>delay: number</code></td><td><code>Task</code></td><td>延时 delay 毫秒发送消息</td></tr><tr><td><code>cancel(taskId)</code></td><td><code>taskId: number</code></td><td><code>void</code></td><td>取消指定任务</td></tr><tr><td><code>clear()</code></td><td>-</td><td><code>void</code></td><td>清空队列中所有等待的任务</td></tr><tr><td><code>dumpInfo()</code></td><td>-</td><td><code>string</code></td><td>获取队列调试信息</td></tr><tr><td><code>onHandleMessage(message, taskId)</code></td><td><code>message: Message</code>, <code>taskId: number</code></td><td><code>Promise&lt;Any&gt;</code></td><td>消息处理方法，子类可重写</td></tr></tbody></table>
<h4 data-id="heading-7">属性</h4>




















<table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>queueName</code></td><td><code>string</code></td><td>队列名称（只读）</td></tr><tr><td><code>length</code></td><td><code>number</code></td><td>当前队列中的任务数量（只读）</td></tr></tbody></table>
<h3 data-id="heading-8">3-2、Message 接口</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Message</span> {
  <span class="hljs-attr">what</span>: <span class="hljs-built_in">string</span>   <span class="hljs-comment">// 消息类型</span>
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Any</span>      <span class="hljs-comment">// 消息数据</span>
}
</code></pre>
<h3 data-id="heading-9">3-3、Task 接口</h3>
<p>所有添加的任务，包括“Message 类型任务”和“Runnable 类型任务”，均会返回该类型实例，通过该实例可以“取消任务”、“获取任务结果”、“任务 Id”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Task</span> {
  <span class="hljs-title function_">cancel</span>(): <span class="hljs-built_in">void</span>                  <span class="hljs-comment">// 取消任务</span>
  <span class="hljs-title function_">getResult</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Any</span>&gt;       <span class="hljs-comment">// 获取任务结果</span>
  <span class="hljs-title function_">getTaskId</span>(): <span class="hljs-built_in">number</span>             <span class="hljs-comment">// 获取任务 ID</span>
}
</code></pre>
<h3 data-id="heading-10">3-4、异常类型</h3>
<h4 data-id="heading-11">JSyncQueueCancelException</h4>
<p>当任务被取消时，会抛出该类型的异常。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">JSyncQueueCancelException</span> {
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<h4 data-id="heading-12">JSyncQueueException</h4>
<p>当 JSyncQueue 内部发生异常时，会抛出该类型的异常。</p>
<blockquote>
<p>值得注意：使用者编写的逻辑中抛出的异常会原封不动的抛到 <code>Task.getResult().catch</code> 中，而<strong>不是以 <code>JSyncQueueException</code> 类型抛出</strong>。</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">JSyncQueueException</span> {
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<h2 data-id="heading-13">四、如何使用 JSyncQueue</h2>
<h3 data-id="heading-14">4-1、使用 JSyncQueue 创建同步队列</h3>
<p>如果你处理的场景<strong>均是简单的一次性任务</strong>，那么直接使用 <code>JSyncQueue</code> 创建一个同步队列，并压入 <code>Runnable</code> 闭包即可。</p>
<p>以下代码展示的逻辑细节：</p>
<ul>
<li>代码中使用了 delay 函数模拟了两次耗时操作，并且返回结果</li>
<li>外部通过 <code>Task</code> 类型实例接收返回结果，并且打印</li>
<li>在第四次循环（即 i 为 3）的时候，会模拟抛出异常，异常内容会原封不动的抛到 <code>catch</code> 中</li>
</ul>
<p><strong>值得注意：</strong></p>
<ul>
<li><strong>立即执行任务会严格按入队顺序执行</strong></li>
<li>任务结果的接收处理（即对 <code>Task.getResult()</code> 的处理）和 <code>JSyncQueue</code> 对任务的处理是<strong>不保证顺序</strong>的，因为 <code>Task.getResult()</code> 的处理已不在队列范围内</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">immediatelyJSyncQueue</span>: <span class="hljs-title class_">JSyncQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSyncQueue</span>(<span class="hljs-string">"ImmediatelyJSyncQueue"</span>)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyJSyncQueue</span>.<span class="hljs-title function_">post</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>) {
      <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> } <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>
    }

    <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

    <span class="hljs-keyword">return</span> <span class="hljs-string">`jiangpengyong-添加5个Runnable <span class="hljs-subst">${i}</span>`</span>
  })
  task.<span class="hljs-title function_">getResult</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable-执行成功】i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable-执行异常】i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable-执行结束】i=<span class="hljs-subst">${i}</span>`</span>)
    })
}

<span class="hljs-comment">// ========================================= 输出日志 =========================================</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=0 第一段 将会模拟耗时=239</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=0 第二段 将会模拟耗时=315</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=1 第一段 将会模拟耗时=379</span>
<span class="hljs-comment">// 【添加5个Runnable-执行成功】i=0 result=jiangpengyong-添加5个Runnable 0</span>
<span class="hljs-comment">// 【添加5个Runnable-执行结束】i=0</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=1 第二段 将会模拟耗时=391</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=2 第一段 将会模拟耗时=499</span>
<span class="hljs-comment">// 【添加5个Runnable-执行成功】i=1 result=jiangpengyong-添加5个Runnable 1</span>
<span class="hljs-comment">// 【添加5个Runnable-执行结束】i=1</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=2 第二段 将会模拟耗时=395</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=3 第一段 将会模拟耗时=478</span>
<span class="hljs-comment">// 【添加5个Runnable-执行成功】i=2 result=jiangpengyong-添加5个Runnable 2</span>
<span class="hljs-comment">// 【添加5个Runnable-执行结束】i=2</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=4 第一段 将会模拟耗时=166</span>
<span class="hljs-comment">// 【添加5个Runnable-执行异常】i=3 e={"message":"模拟异常"}</span>
<span class="hljs-comment">// 【添加5个Runnable-执行结束】i=3</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=4 第二段 将会模拟耗时=33</span>
<span class="hljs-comment">// 【添加5个Runnable-执行成功】i=4 result=jiangpengyong-添加5个Runnable 4</span>
<span class="hljs-comment">// 【添加5个Runnable-执行结束】i=4</span>
</code></pre>
<p><strong>取消同步任务</strong></p>
<p>通过返回的 <code>Task</code> 类型实例调用 <code>cancel</code> 方法可以进行取消任务。</p>
<p>下面的代码会取消第四次任务，所以在日志中会看到对应的取消异常，并且不会执行该任务。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">task</span>: <span class="hljs-title class_">Task</span> | <span class="hljs-literal">undefined</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> tempTask = <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyJSyncQueue</span>.<span class="hljs-title function_">post</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

    <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> } <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">`jiangpengyong-移除Runnable <span class="hljs-subst">${i}</span>`</span>
  })
  tempTask.<span class="hljs-title function_">getResult</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: Any</span>) =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
  }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】执行完成 i=<span class="hljs-subst">${i}</span>`</span>)
  })
  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>) {
    task = tempTask
  }
}
<span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Runnable】取消任务 task=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(task)}</span>`</span>)
task?.<span class="hljs-title function_">cancel</span>()

<span class="hljs-comment">// ========================================= 输出日志 =========================================</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=0 第一段 将会模拟耗时=263</span>
<span class="hljs-comment">// 【移除Runnable】取消任务 task={"taskId":13,"queue":{},"promise":{}}</span>
<span class="hljs-comment">// 【移除Runnable】执行异常 i=3 e={"message":"Cancel task by cancel function."}</span>
<span class="hljs-comment">// 【移除Runnable】执行完成 i=3</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=0 第二段 将会模拟耗时=474</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=1 第一段 将会模拟耗时=318</span>
<span class="hljs-comment">// 【移除Runnable】执行成功 i=0 result=jiangpengyong-移除Runnable 0</span>
<span class="hljs-comment">// 【移除Runnable】执行完成 i=0</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=1 第二段 将会模拟耗时=6</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=2 第一段 将会模拟耗时=406</span>
<span class="hljs-comment">// 【移除Runnable】执行成功 i=1 result=jiangpengyong-移除Runnable 1</span>
<span class="hljs-comment">// 【移除Runnable】执行完成 i=1</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=2 第二段 将会模拟耗时=212</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=4 第一段 将会模拟耗时=226</span>
<span class="hljs-comment">// 【移除Runnable】执行异常 i=2 e={"message":"模拟异常"}</span>
<span class="hljs-comment">// 【移除Runnable】执行完成 i=2</span>
<span class="hljs-comment">// 【移除Runnable】执行逻辑 i=4 第二段 将会模拟耗时=439</span>
<span class="hljs-comment">// 【移除Runnable】执行成功 i=4 result=jiangpengyong-移除Runnable 4</span>
<span class="hljs-comment">// 【移除Runnable】执行完成 i=4</span>
</code></pre>
<p><strong>延时执行 Runnable 类型任务</strong></p>
<p>添加延时任务只需改用 <code>postDelay</code> 方法并传入延时参数</p>
<ul>
<li>下面代码记录了添加任务到真正执行的延时，通过 <code>realDelay</code> 参数可以查看</li>
<li>使用了 <code>delay</code> 函数模拟了两次耗时操作，并模拟返回了处理结果</li>
<li>第四次任务抛出了异常，异常消息会原封不动的在 <code>catch</code> 的日志展示</li>
<li>因为延时任务的添加是按索引进行累加的，所以添加顺序其实并没变化，从最后的日志输出可以看到保证了执行顺序</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> startTime = systemDateTime.<span class="hljs-title function_">getTime</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> delayTime = i * <span class="hljs-number">100</span>
  <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">delayJSyncQueue</span>.<span class="hljs-title function_">postDelay</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> endTime = systemDateTime.<span class="hljs-title function_">getTime</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">const</span> realDelay = endTime - startTime
    <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行逻辑 delay=<span class="hljs-subst">${delayTime}</span> realDelay=<span class="hljs-subst">${realDelay}</span> i=<span class="hljs-subst">${i}</span> 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

    <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>) {
      <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> } <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">`jiangpengyong-添加5个Runnable <span class="hljs-subst">${i}</span>`</span>
  }, delayTime)
  task.<span class="hljs-title function_">getResult</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Runnable】执行结束 i=<span class="hljs-subst">${i}</span>`</span>)
    })
}

<span class="hljs-comment">// ========================================= 输出日志 =========================================</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 delay=0 realDelay=1 i=0 第一段 将会模拟耗时=473</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=0 第二段 将会模拟耗时=410</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 delay=100 realDelay=888 i=1 第一段 将会模拟耗时=178</span>
<span class="hljs-comment">// 【添加5个Runnable】执行成功 i=0 result=jiangpengyong-添加5个Runnable 0</span>
<span class="hljs-comment">// 【添加5个Runnable】执行结束 i=0</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=1 第二段 将会模拟耗时=204</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 delay=200 realDelay=1272 i=2 第一段 将会模拟耗时=410</span>
<span class="hljs-comment">// 【添加5个Runnable】执行成功 i=1 result=jiangpengyong-添加5个Runnable 1</span>
<span class="hljs-comment">// 【添加5个Runnable】执行结束 i=1</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=2 第二段 将会模拟耗时=36</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 delay=300 realDelay=1721 i=3 第一段 将会模拟耗时=475</span>
<span class="hljs-comment">// 【添加5个Runnable】执行成功 i=2 result=jiangpengyong-添加5个Runnable 2</span>
<span class="hljs-comment">// 【添加5个Runnable】执行结束 i=2</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=3 第二段 将会模拟耗时=483</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 delay=400 realDelay=2686 i=4 第一段 将会模拟耗时=9</span>
<span class="hljs-comment">// 【添加5个Runnable】执行异常 i=3 e={"message":"模拟异常"}</span>
<span class="hljs-comment">// 【添加5个Runnable】执行结束 i=3</span>
<span class="hljs-comment">// 【添加5个Runnable】执行逻辑 i=4 第二段 将会模拟耗时=395</span>
<span class="hljs-comment">// 【添加5个Runnable】执行成功 i=4 result=jiangpengyong-添加5个Runnable 4</span>
<span class="hljs-comment">// 【添加5个Runnable】执行结束 i=4</span>
</code></pre>
<p><strong>取消延时任务</strong></p>
<p>延时任务的取消操作和立即执行的取消操作是完全一样的，都是通过返回的 <code>Task</code> 实例调用 <code>cancel</code> 方法，这里就不再赘述。</p>
<h3 data-id="heading-15">4-2、继承 JSyncQueue 创建同步队列</h3>
<p><strong>如果你的同步逻辑需要集中管理或进行复用，可以考虑 <code>Message</code> 类型任务。</strong></p>
<p>处理 <code>Message</code> 类型任务，需要继承 <code>JSyncQueue</code> 实现 <code>onHandleMessage</code> 方法，在该方法中会按入队顺序接收到 <code>Message</code> ：</p>
<ul>
<li>通过 <code>Message.what</code> 属性区分不同类别消息实现不同处理逻辑</li>
<li>通过 <code>Message.data</code> 属性可以获取外部传入的数据，数据类型是 <code>Any</code> 可以是任意类型数据，使用者自行转换为真实类型进行逻辑处理</li>
</ul>
<p>具体操作如下：</p>
<ul>
<li>定义一个 <code>ImmediatelyQueue</code> 类继承 <code>JSyncQueue</code> ，实现 <code>onHandleMessage</code> 方法</li>
<li>创建一个 <code>ImmediatelyQueue</code> 实例，并通过这个实例进行发送 Message 消息，同步队列会按入队顺序一个个进行分发给该实例的 <code>onHandleMessage</code> 方法进行处理</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 自定义 JSyncQueue</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmediatelyQueue</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">JSyncQueue</span> {
  <span class="hljs-keyword">private</span> count = <span class="hljs-number">0</span>

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onHandleMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Any</span>&gt; {
    <span class="hljs-keyword">switch</span> (message.<span class="hljs-property">what</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"say_hello"</span>: {
        <span class="hljs-keyword">const</span> name = message.<span class="hljs-property">data</span>[<span class="hljs-string">"name"</span>]
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>

        <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-string">"ImmediatelyQueue"</span>, <span class="hljs-string">`【say_hello】执行逻辑 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

        <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-string">"ImmediatelyQueue"</span>, <span class="hljs-string">`【say_hello】执行逻辑 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> % <span class="hljs-number">10</span> == <span class="hljs-number">5</span>) {
          <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">`你好，<span class="hljs-subst">${name}</span>。这是第<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>次打招呼。`</span>
      }
      <span class="hljs-comment">// ... 其他 what 处理逻辑</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params">ms: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Any</span>&gt;(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms))
  }
}

<span class="hljs-comment">// 使用逻辑</span>
<span class="hljs-attr">immediatelyQueue</span>: <span class="hljs-title class_">JSyncQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImmediatelyQueue</span>(<span class="hljs-string">"ImmediatelyQueue"</span>)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> tempTask = <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">sendMessage</span>({
    <span class="hljs-attr">what</span>: <span class="hljs-string">`say_hello`</span>,
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'江澎涌'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> + i },
  })
  tempTask.<span class="hljs-title function_">getResult</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行结束i=<span class="hljs-subst">${i}</span>`</span>)
    })
}
<span class="hljs-comment">// ========================================= 输出日志 =========================================</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":20}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=92</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=143</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":21}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=276</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=377</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":22}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=120</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=223</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":23}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=424</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=444</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":24}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=181</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=402</span>
</code></pre>
<p><strong>移除 Message 消息</strong></p>
<p>使用 <code>sendMessage</code> 方法压入 “Message 类型任务” 同样会返回 <code>Task</code> 类型实例，调用该实例的 <code>cancel</code> 方法就可以取消该任务。</p>
<p>下列代码会取消第二个任务，所以不会看到 <code>"age":11</code> 的消息。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">task</span>: <span class="hljs-title class_">Task</span> | <span class="hljs-literal">undefined</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> tempTask = <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">sendMessage</span>({
    <span class="hljs-attr">what</span>: <span class="hljs-string">`remove_message`</span>,
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'jiang peng yong'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">10</span> + i },
  })
  tempTask.<span class="hljs-title function_">getResult</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Message】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: Any</span>) =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Message】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
  }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Message】执行完成 i=<span class="hljs-subst">${i}</span>`</span>)
  })
  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span>) {
    task = tempTask
  }
}
<span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【移除Message】取消任务 task=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(task)}</span>`</span>)
task?.<span class="hljs-title function_">cancel</span>()
<span class="hljs-comment">// ========================================= 输出日志 =========================================</span>
<span class="hljs-comment">// onHandleMessage message={"what":"remove_message","data":{"name":"jiang peng yong","age":10}}</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第一段 将会模拟耗时=497</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第二段 将会模拟耗时=397</span>
<span class="hljs-comment">// onHandleMessage message={"what":"remove_message","data":{"name":"jiang peng yong","age":12}}</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第一段 将会模拟耗时=162</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第二段 将会模拟耗时=283</span>
<span class="hljs-comment">// onHandleMessage message={"what":"remove_message","data":{"name":"jiang peng yong","age":13}}</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第一段 将会模拟耗时=193</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第二段 将会模拟耗时=93</span>
<span class="hljs-comment">// onHandleMessage message={"what":"remove_message","data":{"name":"jiang peng yong","age":14}}</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第一段 将会模拟耗时=359</span>
<span class="hljs-comment">// 【remove_message】执行逻辑 第二段 将会模拟耗时=145</span>
</code></pre>
<p><strong>延时执行 Message 类型任务</strong></p>
<ul>
<li>定义一个 <code>DelayQueue</code> 类继承 <code>JSyncQueue</code> ，主要重写 <code>onHandleMessage</code> 方法，用于接收处理 <code>Message</code></li>
<li>创建 <code>DelayQueue</code> 实例，通过这个实例调用 <code>sendMessageDelay</code> 方法即可达到相应的延时效果</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayQueue</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">JSyncQueue</span> {
  <span class="hljs-keyword">private</span> count = <span class="hljs-number">0</span>

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onHandleMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Any</span>&gt; {
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-string">"DelayQueue"</span>, <span class="hljs-string">`onHandleMessage message=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(message)}</span>`</span>)
    <span class="hljs-keyword">switch</span> (message.<span class="hljs-property">what</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"say_hello"</span>: {
        <span class="hljs-keyword">const</span> name = message.<span class="hljs-property">data</span>[<span class="hljs-string">"name"</span>]
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>

        <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-string">"DelayQueue"</span>, <span class="hljs-string">`【say_hello】执行逻辑 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

        <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-string">"DelayQueue"</span>, <span class="hljs-string">`【say_hello】执行逻辑 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> % <span class="hljs-number">10</span> == <span class="hljs-number">5</span>) {
          <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello，<span class="hljs-subst">${name}</span>. This is the <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span> th greeting.`</span>
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params">ms: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Any</span>&gt;(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms))
  }
}

<span class="hljs-attr">delayQueue</span>: <span class="hljs-title class_">JSyncQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>(<span class="hljs-string">"DelayQueue"</span>)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> delayTime = i * <span class="hljs-number">100</span>
  <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">delayQueue</span>.<span class="hljs-title function_">sendMessageDelay</span>({
    <span class="hljs-attr">what</span>: <span class="hljs-string">`say_hello`</span>,
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'江澎涌'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> + i },
  }, delayTime)
  task.<span class="hljs-title function_">getResult</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加5个Message】执行结束i=<span class="hljs-subst">${i}</span>`</span>)
    })
}
<span class="hljs-comment">// ========================================= 输出日志 ========================================= </span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":20}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=356</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=302</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":21}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=67</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=344</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":22}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=339</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=384</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":23}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=442</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=392</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"江澎涌","age":24}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=443</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=199</span>
</code></pre>
<p><strong>取消延时的 Message 类型任务</strong></p>
<p>延时任务的取消操作和立即执行的取消操作是完全一样的，都是通过返回的 <code>Task</code> 实例调用 <code>cancel</code> 方法，这里就不再赘述。</p>
<p><strong>同一队列压入 Message 类型任务和 Runnable 类型任务</strong></p>
<p>对 <code>JSyncQueue</code> 同一实例压入 <code>Message</code> 和 <code>Runnable</code> 两种类型任务是支持的，会按照压入顺序进行执行和分发。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ImmediatelyQueue 源码就不再展示，需要可以移步 Github 上查阅</span>
<span class="hljs-attr">immediatelyQueue</span>: <span class="hljs-title class_">JSyncQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImmediatelyQueue</span>(<span class="hljs-string">"ImmediatelyQueue"</span>)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
  <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">post</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加10个Message和Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

      <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【添加10个Message和Runnable】执行逻辑 i=<span class="hljs-subst">${i}</span> 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

      <span class="hljs-keyword">if</span> (i / <span class="hljs-number">2</span> == <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">throw</span> { <span class="hljs-attr">message</span>: <span class="hljs-string">"模拟异常"</span> } <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-string">`小朋友-添加10个Message和Runnable <span class="hljs-subst">${i}</span>`</span>
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">sendMessage</span>({
      <span class="hljs-attr">what</span>: <span class="hljs-string">`say_hello`</span>,
      <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'小朋友'</span>, <span class="hljs-attr">age</span>: i },
    })
  }
}
<span class="hljs-comment">// ========================================= 输出日志 ========================================= </span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=0 第一段 将会模拟耗时=416</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=0 第二段 将会模拟耗时=41</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"小朋友","age":1}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=184</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=63</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=2 第一段 将会模拟耗时=451</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=2 第二段 将会模拟耗时=223</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"小朋友","age":3}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=99</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=27</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=4 第一段 将会模拟耗时=273</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=4 第二段 将会模拟耗时=193</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"小朋友","age":5}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=20</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=231</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=6 第一段 将会模拟耗时=46</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=6 第二段 将会模拟耗时=198</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"小朋友","age":7}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=179</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=0</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=8 第一段 将会模拟耗时=131</span>
<span class="hljs-comment">// 【添加10个Message和Runnable】执行逻辑 i=8 第二段 将会模拟耗时=401</span>
<span class="hljs-comment">// onHandleMessage message={"what":"say_hello","data":{"name":"小朋友","age":9}}</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第一段 将会模拟耗时=452</span>
<span class="hljs-comment">// 【say_hello】执行逻辑 第二段 将会模拟耗时=40</span>
</code></pre>
<h3 data-id="heading-16">4-3、取消队列中所有任务</h3>
<p>对 <code>JSyncQueue</code> 实例调用 <code>clear</code> 方法，就会把队列中等待执行的任务，包括延时执行和立即执行的任务，全都取消。同时会抛出 <code>JSyncQueueCancelException</code> 类型异常。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
  <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">post</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> delayTime1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【清空队列】执行逻辑 i=<span class="hljs-subst">${i}</span> 第一段 将会模拟耗时=<span class="hljs-subst">${delayTime1}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime1)

    <span class="hljs-keyword">const</span> delayTime2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【清空队列】执行逻辑 i=<span class="hljs-subst">${i}</span> 第二段 将会模拟耗时=<span class="hljs-subst">${delayTime2}</span>`</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delay</span>(delayTime2)

    <span class="hljs-keyword">return</span> <span class="hljs-string">`小朋友-清空队列 <span class="hljs-subst">${i}</span>`</span>
  })
  task.<span class="hljs-title function_">getResult</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【清空队列】执行成功 i=<span class="hljs-subst">${i}</span> result=<span class="hljs-subst">${result}</span>`</span>)
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">e</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【清空队列】执行异常 i=<span class="hljs-subst">${i}</span> e=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>)
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">i</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`【清空队列】执行结束 i=<span class="hljs-subst">${i}</span>`</span>)
    })
}
<span class="hljs-variable language_">this</span>.<span class="hljs-property">immediatelyQueue</span>.<span class="hljs-title function_">clear</span>()
<span class="hljs-comment">// ========================================= 输出日志 ========================================= </span>
<span class="hljs-comment">// 【清空队列】执行逻辑 i=0 第一段 将会模拟耗时=14</span>
<span class="hljs-comment">// 【清空队列】执行异常 i=1 e={"message":"Cancel task by clear function."}</span>
<span class="hljs-comment">// 【清空队列】执行异常 i=2 e={"message":"Cancel task by clear function."}</span>
<span class="hljs-comment">// 【清空队列】执行异常 i=3 e={"message":"Cancel task by clear function."}</span>
<span class="hljs-comment">// 【清空队列】执行异常 i=4 e={"message":"Cancel task by clear function."}</span>
<span class="hljs-comment">// 【清空队列】执行结束 i=1</span>
<span class="hljs-comment">// 【清空队列】执行结束 i=2</span>
<span class="hljs-comment">// 【清空队列】执行结束 i=3</span>
<span class="hljs-comment">// 【清空队列】执行结束 i=4</span>
<span class="hljs-comment">// 【清空队列】执行逻辑 i=0 第二段 将会模拟耗时=125</span>
<span class="hljs-comment">// 【清空队列】执行成功 i=0 result=小朋友-清空队列 0</span>
<span class="hljs-comment">// 【清空队列】执行结束 i=0</span>
</code></pre>
<h2 data-id="heading-17">五、作者博客</h2>
<p>掘金：<a href="https://juejin.im/user/5c3033ef51882524ec3a88ba/posts" target="_blank" title="https://juejin.im/user/5c3033ef51882524ec3a88ba/posts">juejin.im/user/5c3033…</a></p>
<p>csdn：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_37625173" target="_blank" title="https://blog.csdn.net/weixin_37625173" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_3762…</a></p>
<p>公众号：微信搜索 "江澎涌"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot 是如何实现永久记忆的？]]></title>    <link>https://juejin.cn/post/7601053058857156614</link>    <guid>https://juejin.cn/post/7601053058857156614</guid>    <pubDate>2026-01-31T12:28:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601053058857156614" data-draft-id="7601053058857140230" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot 是如何实现永久记忆的？"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-31T12:28:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序猿DD"/> <meta itemprop="url" content="https://juejin.cn/user/131597123993358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot 是如何实现永久记忆的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123993358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序猿DD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T12:28:56.000Z" title="Sat Jan 31 2026 12:28:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    30
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾经和AI助手聊了一整晚，第二天打开对话却发现它完全忘了你们讨论过的关键细节？或者当你在多个项目之间切换时，AI总是在问"你指的是哪个API"，让你不厌其烦地重复背景信息。这种"金鱼式记忆"是当下大多数云端AI产品的通病——它们要么只能记住有限的上下文，要么把所有数据都存储在厂商的服务器上。</p>
<p>但如果有一个AI助手，它能像一位真正的私人助理那样，永远记住你的偏好、你的项目细节、甚至你三个月前提过的小习惯？更妙的是，这些记忆完全存储在你自己的电脑上，由你全权掌控。</p>
<p>这就是Clawdbot正在做的事情。作为一款开源的个人AI助手，Clawdbot在GitHub上已经获得了超过125,000个Star。与运行在云端的ChatGPT或Claude不同，Clawdbot直接运行在你的本地机器上，并且能够集成到你日常使用的聊天平台中（Discord、WhatsApp、Telegram等）。</p>
<p>它不仅是一个聊天机器人，更是一个能自主处理实际任务的助手：管理邮件、安排日历、处理航班值机、按计划运行后台任务。但最吸引我的是它的持久化记忆系统——它能实现24/7的全天候上下文保持，记住对话内容，并无限期地基于之前的交互进行累积。</p>
<p>如果你读过我之前关于ChatGPT记忆和Claude记忆的文章，就知道我对不同AI产品如何处理记忆这个问题非常着迷。Clawdbot采用了一种截然不同的方法：它不是基于云端、由公司控制的记忆，而是将一切保存在本地，让用户完全拥有自己的上下文和技能数据。</p>
<p>让我们一起深入了解它是如何工作的。</p>
<blockquote>
<p>以下内容翻译自<a href="https://link.juejin.cn?target=https%3A%2F%2Fmanthanguptaa.in%2Fposts%2Fclawdbot_memory" target="_blank" title="https://manthanguptaa.in/posts/clawdbot_memory" ref="nofollow noopener noreferrer">《How Clawdbot Remembers Everything》</a></p>
</blockquote>
<h2 data-id="heading-0">上下文是如何构建的</h2>
<p>在深入探讨记忆之前，我们先来理解模型在每次请求时能看到什么：</p>
<pre><code class="hljs language-text" lang="text">[0] 系统提示词（静态指令 + 条件指令）
[1] 项目上下文（引导文件：AGENTS.md、SOUL.md 等）
[2] 对话历史（消息、工具调用、压缩摘要）
[3] 当前消息
</code></pre>
<p>系统提示词定义了Agent的能力和可用工具。与记忆相关的是"项目上下文"，它包含了用户可编辑的Markdown文件，这些文件会被注入到每次请求中：</p>
<p>这些文件位于Agent的工作空间中，与记忆文件并存，使得整个Agent的配置变得透明且可编辑。</p>
<h2 data-id="heading-1">上下文 vs 记忆</h2>
<p>理解上下文和记忆之间的区别，是理解Clawdbot的基础。</p>
<p><strong>上下文</strong>是模型在单次请求中能看到的一切：</p>
<pre><code class="hljs language-text" lang="text">上下文 = 系统提示词 + 对话历史 + 工具结果 + 附件
</code></pre>
<p>上下文的特性：</p>
<ul>
<li><strong>临时的</strong>——只存在于本次请求期间</li>
<li><strong>有限的</strong>——受限于模型的上下文窗口（例如20万token）</li>
<li><strong>昂贵的</strong>——每个token都计入API成本和速度</li>
</ul>
<p><strong>记忆</strong>是存储在磁盘上的内容：</p>
<pre><code class="hljs language-text" lang="text">记忆 = MEMORY.md + memory/*.md + 会话转录文件
</code></pre>
<p>记忆的特性：</p>
<ul>
<li><strong>持久的</strong>——在重启、日复一日、月复一月后依然存在</li>
<li><strong>无限的</strong>——可以无限增长</li>
<li><strong>低成本的</strong>——存储不产生API费用</li>
<li><strong>可搜索的</strong>——建立索引以支持语义检索</li>
</ul>
<h2 data-id="heading-2">记忆工具</h2>
<p>Agent通过两个专用工具来访问记忆：</p>
<h3 data-id="heading-3">1. memory_search</h3>
<p><strong>用途</strong>：在所有文件中查找相关的记忆</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory_search"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"强制性回忆步骤：在回答关于之前工作、决策、日期、人员、偏好或待办事项的问题之前，对MEMORY.md和memory/*.md进行语义搜索"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"我们对API做了什么决定？"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"maxResults"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"minScore"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.35</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回结果</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"results"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory/2026-01-20.md"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"startLine"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"endLine"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">52</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.87</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"snippet"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"## API 讨论\n决定为了简单起见使用REST而不是GraphQL..."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text-embedding-3-small"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">2. memory_get</h3>
<p><strong>用途</strong>：在找到内容后读取具体内容</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory_get"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"在使用memory_search后，从记忆文件中读取特定行"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory/2026-01-20.md"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lines"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回结果</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"memory/2026-01-20.md"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"## API 讨论\n\n与团队讨论API架构。\n\n### 决策\n我们选择REST而非GraphQL，原因如下：\n1. 实现更简单\n2. 更好的缓存支持\n3. 团队更熟悉\n\n### 端点\n- GET /users\n- POST /auth/login\n- GET /projects/:id"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">写入记忆</h3>
<p>并没有专门的memory_write工具。Agent使用标准的写入和编辑工具来写入记忆——这些工具它本来就在用于处理任何文件。由于记忆就是普通的Markdown，你也可以手动编辑这些文件（它们会被自动重新索引）。</p>
<p>写入位置的决策是通过AGENTS.md中的提示来驱动的：</p>
<p>在预压缩刷新和会话结束时，也会自动进行写入（后续章节会介绍）。</p>
<h2 data-id="heading-6">记忆存储</h2>
<p>Clawdbot的记忆系统建立在"记忆就是Agent工作空间中的纯Markdown"这一原则之上。</p>
<h3 data-id="heading-7">双层记忆系统</h3>
<p>记忆位于Agent的工作空间中（默认：~/clawd/）：</p>
<pre><code class="hljs language-text" lang="text">~/clawd/
├── MEMORY.md              - 第二层：长期策划的知识
└── memory/
    ├── 2026-01-26.md      - 第一层：今天的笔记
    ├── 2026-01-25.md      - 昨天的笔记
    ├── 2026-01-24.md      - ...以此类推
    └── ...
</code></pre>
<p><strong>第一层：每日日志（memory/YYYY-MM-DD.md）</strong></p>
<p>这些是仅追加的每日笔记，Agent会在一天中随时写入。当Agent想要记住某事，或被明确告知要记住某事时，就会写入这里。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 2026-01-26</span>

<span class="hljs-section">## 10:30 AM - API 讨论</span>
与用户讨论REST vs GraphQL。决策：为了简单使用REST。
关键端点：/users、/auth、/projects。

<span class="hljs-section">## 2:15 PM - 部署</span>
将v2.3.0部署到生产环境。没有问题。

<span class="hljs-section">## 4:00 PM - 用户偏好</span>
用户提到他们喜欢TypeScript胜过JavaScript。
</code></pre>
<p><strong>第二层：长期记忆（MEMORY.md）</strong></p>
<p>这是经过策划的、持久的知识。当发生重大事件、想法、决策、观点和学到的教训时，Agent会写入这里。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 长期记忆</span>

<span class="hljs-section">## 用户偏好</span>
<span class="hljs-bullet">-</span> 喜欢TypeScript胜过JavaScript
<span class="hljs-bullet">-</span> 喜欢简洁的解释
<span class="hljs-bullet">-</span> 正在做"Acme Dashboard"项目

<span class="hljs-section">## 重要决策</span>
<span class="hljs-bullet">-</span> 2026-01-15：选择PostgreSQL作为数据库
<span class="hljs-bullet">-</span> 2026-01-20：采用REST而非GraphQL
<span class="hljs-bullet">-</span> 2026-01-26：使用Tailwind CSS进行样式设计

<span class="hljs-section">## 关键联系人</span>
<span class="hljs-bullet">-</span> Alice (alice@acme.com) - 设计负责人
<span class="hljs-bullet">-</span> Bob (bob@acme.com) - 后端工程师
</code></pre>
<h3 data-id="heading-8">Agent如何知道要读取记忆</h3>
<p><code>AGENTS.md</code>文件（会自动加载）包含以下指令：</p>
<pre><code class="hljs language-text" lang="text">## 每次会话

在做其他事情之前：
1. 阅读 SOUL.md - 这是你是谁
2. 阅读 USER.md - 这是你在帮助谁
3. 阅读 memory/YYYY-MM-DD.md（今天和昨天）获取近期上下文
4. 如果是在主会话中（与你的主人直接聊天），还要阅读 MEMORY.md

不要请求许可，直接做。
</code></pre>
<h2 data-id="heading-9">记忆如何被索引</h2>
<p>当你保存一个记忆文件时，后台会发生以下事情：</p>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────────────────────────────┐
│  1. 文件保存                                                │
│     ~/clawd/memory/2026-01-26.md                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 文件监视器检测到变化                                    │
│     Chokidar 监视 MEMORY.md + memory/**/*.md                │
│     防抖1.5秒以批量处理快速写入                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 分块                                                    │
│     分割成约400 token的块，重叠80 token                     │
│                                                             │
│     ┌────────────────┐                                      │
│     │ 块 1           │                                      │
│     │ 第 1-15 行     │──────┐                               │
│     └────────────────┘      │                               │
│     ┌────────────────┐      │ (80 token 重叠)               │
│     │ 块 2           │◄─────┘                               │
│     │ 第 12-28 行    │──────┐                               │
│     └────────────────┘      │                               │
│     ┌────────────────┐      │                               │
│     │ 块 3           │◄─────┘                               │
│     │ 第 25-40 行    │                                      │
│     └────────────────┘                                      │
│                                                             │
│     为什么用400/80？平衡语义连贯性与粒度。                  │
│     重叠确保跨越块边界的事实能被两边捕获。                   │
│     两个值都是可配置的。                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 嵌入                                                    │
│     每个块 -&gt; 嵌入提供商 -&gt; 向量                            │
│                                                             │
│     "讨论REST vs GraphQL" -&gt;                                │
│         OpenAI/Gemini/Local -&gt;                              │
│         [0.12, -0.34, 0.56, ...]  (1536 维)                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  5. 存储                                                    │
│     ~/.clawdbot/memory/&lt;agentId&gt;.sqlite                     │
│                                                             │
│     表：                                                    │
│     - chunks (id, path, start_line, end_line, text, hash)   │
│     - chunks_vec (id, embedding)      -&gt; sqlite-vec         │
│     - chunks_fts (text)               -&gt; FTS5 全文搜索      │
│     - embedding_cache (hash, vector)  -&gt; 避免重复嵌入       │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<blockquote>
<p><strong>sqlite-vec</strong> 是一个SQLite扩展，它直接在SQLite中实现向量相似度搜索，无需外部向量数据库。</p>
</blockquote>
<blockquote>
<p><strong>FTS5</strong> 是SQLite内置的全文搜索引擎，为BM25关键词匹配提供支持。两者结合，使Clawdbot能够从一个轻量级数据库文件中运行混合搜索（语义 + 关键词）。</p>
</blockquote>
<h2 data-id="heading-10">记忆如何被搜索</h2>
<p>当你搜索记忆时，Clawdbot会并行运行两种搜索策略。向量搜索（语义）找到意思相同的内容，BM25搜索（关键词）找到包含确切token的内容。</p>
<p>结果通过加权评分合并：</p>
<pre><code class="hljs language-text" lang="text">最终得分 = (0.7 * 向量得分) + (0.3 * 文本得分)
</code></pre>
<p>为什么是70/30？语义相似性是记忆回忆的主要信号，但BM25关键词匹配能捕捉向量可能遗漏的确切术语（名称、ID、日期）。低于minScore阈值（默认0.35）的结果会被过滤掉。所有这些值都是可配置的。</p>
<p>这确保无论你是在搜索概念（"那个数据库的事情"）还是具体内容（"POSTGRES_URL"），都能获得良好的结果。</p>
<h2 data-id="heading-11">多Agent记忆</h2>
<p>Clawdbot支持多个Agent，每个Agent都有完全独立的记忆：</p>
<pre><code class="hljs language-text" lang="text">~/.clawdbot/memory/              # 状态目录（索引）
├── main.sqlite                  # "main" Agent的向量索引
└── work.sqlite                  # "work" Agent的向量索引

~/clawd/                         # "main" Agent工作空间（源文件）
├── MEMORY.md
└── memory/
    └── 2026-01-26.md

~/clawd-work/                    # "work" Agent工作空间（源文件）
├── MEMORY.md
└── memory/
    └── 2026-01-26.md
</code></pre>
<p>Markdown文件（事实来源）位于每个工作空间中，而SQLite索引（派生数据）位于状态目录中。每个Agent都有自己的工作空间和索引。记忆管理器通过agentId + workspaceDir来区分，因此不会自动发生跨Agent记忆搜索。</p>
<p><strong>Agent能读取彼此的记忆吗？</strong> 默认不能。每个Agent只能看到自己的工作空间。但是，工作空间是一个软沙盒（默认工作目录），而不是硬边界。除非启用严格的沙盒机制，否则Agent理论上可以使用绝对路径访问另一个工作空间。</p>
<p>这种隔离对于分离上下文很有用。一个用于WhatsApp的"个人"Agent和一个用于Slack的"工作"Agent，各自拥有独立的记忆和个性。</p>
<h3 data-id="heading-12">压缩</h3>
<p>每个AI模型都有上下文窗口限制。Claude有20万token，GPT-5.1有100万。长对话最终会触及这个上限。</p>
<p>当这种情况发生时，Clawdbot使用压缩：将旧对话总结为紧凑的条目，同时保留最近消息的完整性。</p>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────────────────────────────┐
│  压缩前                                                     │
│  上下文：180,000 / 200,000 token                            │
│                                                             │
│  [第1轮] 用户："我们建个API吧"                              │
│  [第2轮] Agent："好的！你需要什么端点？"                    │
│  [第3轮] 用户："用户和认证相关的"                           │
│  [第4轮] Agent：*创建了500行模式定义*                       │
│  [第5轮] 用户："加上限流功能"                               │
│  [第6轮] Agent：*修改代码*                                  │
│  ...（还有100多轮）...                                      │
│  [第150轮] 用户："状态怎么样了？"                           │
│                                                             │
│  ⚠️ 接近限制                                                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  触发压缩                                                   │
│                                                             │
│  1. 将第1-140轮总结为紧凑摘要                               │
│  2. 保留第141-150轮不变（近期上下文）                       │
│  3. 将摘要持久化到JSONL转录文件                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  压缩后                                                     │
│  上下文：45,000 / 200,000 token                             │
│                                                             │
│  [摘要] "构建了带/users、/auth端点的REST API。              │
│   实现了JWT认证、限流（100次/分钟）、PostgreSQL数据库。      │
│   已部署到预发布环境v2.4.0。                                 │
│   当前重点：生产环境部署准备。"                              │
│                                                             │
│  [第141-150轮原样保留]                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-13">自动 vs 手动压缩</h3>
<p><strong>自动</strong>：当接近上下文限制时触发</p>
<ul>
<li>在详细模式下你会看到：🧹 自动压缩完成</li>
<li>原始请求会用压缩后的上下文重试</li>
</ul>
<p><strong>手动</strong>：使用 /compact 命令</p>
<pre><code class="hljs language-bash" lang="bash">/compact 重点关注决策和未解决的问题
</code></pre>
<p>与某些优化不同，压缩会持久化到磁盘。摘要被写入会话的JSONL转录文件，因此未来的会话以压缩后的历史开始。</p>
<h2 data-id="heading-14">记忆刷新</h2>
<p>基于LLM的压缩是一个有损过程。重要信息可能被总结掉并可能丢失。为了应对这一点，Clawdbot使用了预压缩记忆刷新。</p>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────────────────────────────┐
│  上下文接近限制                                             │
│                                                             │
│  ████████████████████████████░░░░░░░░  上下文的75%         │
│                              ↑                              │
│                    超过软阈值                               │
│                    (contextWindow - reserve - softThreshold)│
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  静默记忆刷新轮次                                           │
│                                                             │
│  系统："预压缩记忆刷新。现在存储持久的                      │
│          记忆（使用 memory/YYYY-MM-DD.md）。                │
│          如果没有要存储的，回复 NO_REPLY。"                 │
│                                                             │
│  Agent：审查对话中的重要信息                                │
│         将关键决策/事实写入记忆文件                         │
│         -&gt; NO_REPLY（用户看不到任何内容）                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  安全进行压缩                                               │
│                                                             │
│  重要信息现在已在磁盘上                                     │
│  压缩可以在不丢失知识的情况下进行                           │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<p>记忆刷新可以在clawdbot.yaml文件或clawdbot.json文件中配置。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"compaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"reserveTokensFloor"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"memoryFlush"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"softThresholdTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"systemPrompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"会话接近压缩。现在存储持久的记忆。"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"将持久的笔记写入 memory/YYYY-MM-DD.md；如果没有要存储的，回复 NO_REPLY。"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-15">剪枝</h2>
<p>工具结果可能非常庞大。单个exec命令可能输出5万个字符的日志。剪枝会修剪这些旧输出，而不重写历史。这是一个有损过程，旧输出无法恢复。</p>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────────────────────────────┐
│  剪枝前（内存中）                                           │
│                                                             │
│  工具结果（exec）：[5万个字符的npm install输出]               │
│  工具结果（read）：[大型配置文件，1万个字符]                  │
│  工具结果（exec）：[构建日志，3万个字符]                      │
│  用户："构建成功了吗？"                                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼ （软修剪 + 硬清除）
┌─────────────────────────────────────────────────────────────┐
│  剪枝后（发送给模型）                                       │
│                                                             │
│  工具结果（exec）："npm WARN deprecated...[已截断]           │
│                       ...成功安装。"                        │
│  工具结果（read）："[旧工具结果内容已清除]"                   │
│  工具结果（exec）：[保留 - 太新，不适合剪枝]                  │
│  用户："构建成功了吗？"                                      │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<p>磁盘上的JSONL文件：保持不变（完整输出仍然在那里）</p>
<h3 data-id="heading-16">缓存TTL剪枝</h3>
<p>Anthropic会对提示词前缀进行最多5分钟的缓存，以减少重复调用的延迟和成本。当相同的提示词前缀在TTL窗口内发送时，缓存的token成本降低约90%。TTL过期后，下一个请求必须重新缓存整个提示词。</p>
<p>问题：如果会话在TTL之后闲置，下一个请求会失去缓存，必须以完整的"缓存写入"价格重新缓存完整的对话历史。</p>
<p>缓存TTL剪枝通过在缓存过期后检测并修剪旧工具结果来解决这个问题。更小的提示词重新缓存意味着更低的成本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"contextPruning"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cache-ttl"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"ttl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"600"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"keepLastAssistants"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"softTrim"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"maxChars"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"headChars"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tailChars"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hardClear"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"placeholder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[旧工具结果内容已清除]"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-17">会话生命周期</h2>
<p>会话不会永远持续。它们根据可配置的规则进行重置，为记忆创建自然的边界。默认行为是每天重置。但也有其他模式可用。</p>
<h3 data-id="heading-18">会话记忆钩子</h3>
<p>当你运行 /new 开始一个新会话时，会话记忆钩子可以自动保存上下文：</p>
<pre><code class="hljs language-text" lang="text">/new
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  触发会话记忆钩子                                           │
│                                                             │
│  1. 从结束会话中提取最后15条消息                            │
│  2. 通过LLM生成描述性slug                                   │
│  3. 保存到 ~/clawd/memory/2026-01-26-api-design.md          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  新会话开始                                                 │
│                                                             │
│  之前的上下文现在可以通过 memory_search 搜索                │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h2 data-id="heading-19">总结</h2>
<p>Clawdbot的记忆系统之所以成功，是因为它遵循了几个关键原则：</p>
<p><strong>1. 透明优于黑盒</strong></p>
<p>记忆是纯Markdown。你可以阅读、编辑、版本控制它。没有不透明数据库或专有格式。</p>
<p><strong>2. 搜索优于注入</strong></p>
<p>与其用所有内容塞满上下文，不如让Agent搜索相关内容。这保持上下文聚焦并降低成本。</p>
<p><strong>3. 持久优于会话</strong></p>
<p>重要信息作为文件保存在磁盘上，而不仅仅存在于对话历史中。压缩无法摧毁已经保存的内容。</p>
<p><strong>4. 混合优于单一</strong></p>
<p>纯向量搜索会漏掉精确匹配。纯关键词搜索会漏掉语义。混合搜索两者兼得。</p>
<h2 data-id="heading-20">参考资料</h2>
<ul>
<li>Clawdbot文档(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.clawd.bot%2F" target="_blank" title="https://docs.clawd.bot/" ref="nofollow noopener noreferrer">docs.clawd.bot/</a>) - 官方文档，涵盖设置、配置和所有功能</li>
<li>GitHub仓库(<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fclawdbot%2Fclawdbot" target="_blank" title="https://github.com/clawdbot/clawdbot" ref="nofollow noopener noreferrer">github.com/clawdbot/cl…</a>) - 源代码、问题和社区贡献</li>
</ul>
<p>感谢阅读，如果对Vibe Coding和Agent开发感兴趣，也可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdidispace.com%2F" target="_blank" title="https://didispace.com/" ref="nofollow noopener noreferrer">关注我的博客：程序猿DD</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[H5手势操作完全指南：滑动、长按、缩放实战详解]]></title>    <link>https://juejin.cn/post/7601441475987308590</link>    <guid>https://juejin.cn/post/7601441475987308590</guid>    <pubDate>2026-02-01T11:08:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441475987308590" data-draft-id="7601441797117902899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="H5手势操作完全指南：滑动、长按、缩放实战详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-01T11:08:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            H5手势操作完全指南：滑动、长按、缩放实战详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:08:12.000Z" title="Sun Feb 01 2026 11:08:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">H5手势操作完全指南：滑动、长按、缩放实战详解</h2>
<h3 data-id="heading-1">一、前言：H5手势操作的重要性</h3>
<p>在移动互联网时代，手势操作已成为用户体验的核心部分。无论是电商应用的轮播图滑动、社交媒体的图片缩放，还是游戏中的长按操作，都离不开流畅自然的手势交互。本文将深入探讨H5中如何实现<strong>滑动、长按、缩放</strong>三大核心手势操作，并提供完整的代码实现和优化方案。</p>
<h3 data-id="heading-2">二、手势操作基本原理与流程</h3>
<h4 data-id="heading-3">2.1 触摸事件模型</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户触摸屏幕] --&gt; B[touchstart 事件]
    B --&gt; C{touchmove 事件}
    C --&gt; D[滑动/拖拽手势]
    C --&gt; E[捏合手势]
    C --&gt; F[其他手势]
    B --&gt; G[touchend 事件]
    B --&gt; H[touchcancel 事件]
    D --&gt; I[触发对应业务逻辑]
    E --&gt; I
    F --&gt; I
</code></pre>
<h4 data-id="heading-4">2.2 事件对象关键属性</h4>
<pre><code class="hljs language-javascript" lang="javascript">touchEvent = {
    <span class="hljs-attr">touches</span>: [],       <span class="hljs-comment">// 当前所有触摸点</span>
    <span class="hljs-attr">targetTouches</span>: [], <span class="hljs-comment">// 当前元素上的触摸点</span>
    <span class="hljs-attr">changedTouches</span>: [], <span class="hljs-comment">// 发生变化的触摸点</span>
    <span class="hljs-attr">timeStamp</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-comment">// 时间戳</span>
    <span class="hljs-attr">preventDefault</span>: <span class="hljs-title class_">Function</span> <span class="hljs-comment">// 阻止默认行为</span>
}
</code></pre>
<p>每个触摸点（Touch对象）包含：</p>
<pre><code class="hljs language-javascript" lang="javascript">touch = {
    <span class="hljs-attr">identifier</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-comment">// 唯一标识符</span>
    <span class="hljs-attr">screenX</span>: <span class="hljs-title class_">Number</span>,   <span class="hljs-comment">// 屏幕X坐标</span>
    <span class="hljs-attr">screenY</span>: <span class="hljs-title class_">Number</span>,   <span class="hljs-comment">// 屏幕Y坐标</span>
    <span class="hljs-attr">clientX</span>: <span class="hljs-title class_">Number</span>,   <span class="hljs-comment">// 视口X坐标</span>
    <span class="hljs-attr">clientY</span>: <span class="hljs-title class_">Number</span>,   <span class="hljs-comment">// 视口Y坐标</span>
    <span class="hljs-attr">pageX</span>: <span class="hljs-title class_">Number</span>,     <span class="hljs-comment">// 页面X坐标</span>
    <span class="hljs-attr">pageY</span>: <span class="hljs-title class_">Number</span>      <span class="hljs-comment">// 页面Y坐标</span>
}
</code></pre>
<h3 data-id="heading-5">三、滑动（Swipe）手势实现</h3>
<h4 data-id="heading-6">3.1 基础滑动实现</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>滑动手势示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.swipe-container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">overflow</span>: hidden;
            user-select: none;
            touch-action: pan-y;
        }
        
        <span class="hljs-selector-class">.swipe-content</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
        }
        
        <span class="hljs-selector-class">.indicator</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>);
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
        }
        
        <span class="hljs-selector-class">.indicator-dot</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>);
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
        }
        
        <span class="hljs-selector-class">.indicator-dot</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: white;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.5</span>);
        }
        
        <span class="hljs-selector-class">.debug-info</span> {
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Courier New'</span>, monospace;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"swipe-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"swipeArea"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"swipe-content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"slide-content"</span>&gt;</span>滑动我！<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-dot active"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-dot"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-dot"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator-dot"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>状态: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"status"</span>&gt;</span>等待操作...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>方向: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"direction"</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>距离: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"distance"</span>&gt;</span>0px<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>速度: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"velocity"</span>&gt;</span>0px/ms<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwipeGesture</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">element</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span> = element;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">threshold</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 最小滑动距离</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">restraint</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 方向约束</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">allowedTime</span> = <span class="hljs-number">300</span>; <span class="hljs-comment">// 最大允许时间</span>
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
            }
            
            <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchend'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                
                <span class="hljs-comment">// 添加鼠标事件支持（桌面端调试）</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseDown</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
            }
            
            <span class="hljs-title function_">handleTouchStart</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touch = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = touch.<span class="hljs-property">clientX</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span> = touch.<span class="hljs-property">clientY</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span> = <span class="hljs-literal">true</span>;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'触摸开始'</span>);
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleTouchMove</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span> || event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touch = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> = touch.<span class="hljs-property">clientX</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> = touch.<span class="hljs-property">clientY</span>;
                
                <span class="hljs-comment">// 计算移动距离</span>
                <span class="hljs-keyword">const</span> deltaX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>;
                <span class="hljs-keyword">const</span> deltaY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span>;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDebugInfo</span>(deltaX, deltaY);
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleTouchEnd</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> elapsedTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                <span class="hljs-keyword">const</span> deltaX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>;
                <span class="hljs-keyword">const</span> deltaY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span>;
                
                <span class="hljs-comment">// 判断是否为有效滑动</span>
                <span class="hljs-keyword">if</span> (elapsedTime &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">allowedTime</span>) {
                    <span class="hljs-comment">// 检查是否达到最小滑动距离</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaX) &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">threshold</span> || <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaY) &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">threshold</span>) {
                        <span class="hljs-comment">// 判断滑动方向</span>
                        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaX) &gt;= <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaY)) {
                            <span class="hljs-comment">// 水平滑动</span>
                            <span class="hljs-keyword">if</span> (deltaX &gt; <span class="hljs-number">0</span>) {
                                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSwipe</span>(<span class="hljs-string">'right'</span>, deltaX);
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSwipe</span>(<span class="hljs-string">'left'</span>, deltaX);
                            }
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-comment">// 垂直滑动</span>
                            <span class="hljs-keyword">if</span> (deltaY &gt; <span class="hljs-number">0</span>) {
                                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSwipe</span>(<span class="hljs-string">'down'</span>, deltaY);
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSwipe</span>(<span class="hljs-string">'up'</span>, deltaY);
                            }
                        }
                    }
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'触摸结束'</span>);
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-comment">// 鼠标事件处理（用于桌面端调试）</span>
            <span class="hljs-title function_">handleMouseDown</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = event.<span class="hljs-property">clientX</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span> = event.<span class="hljs-property">clientY</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span> = <span class="hljs-literal">true</span>;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'鼠标按下'</span>);
            }
            
            <span class="hljs-title function_">handleMouseMove</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> = event.<span class="hljs-property">clientX</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> = event.<span class="hljs-property">clientY</span>;
                
                <span class="hljs-keyword">const</span> deltaX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>;
                <span class="hljs-keyword">const</span> deltaY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span>;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDebugInfo</span>(deltaX, deltaY);
            }
            
            <span class="hljs-title function_">handleMouseUp</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleTouchEnd</span>({ <span class="hljs-attr">touches</span>: [] });
            }
            
            <span class="hljs-title function_">onSwipe</span>(<span class="hljs-params">direction, distance</span>) {
                <span class="hljs-keyword">const</span> elapsedTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                <span class="hljs-keyword">const</span> velocity = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(distance) / elapsedTime;
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">`滑动手势: <span class="hljs-subst">${direction}</span>`</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'direction'</span>).<span class="hljs-property">textContent</span> = direction;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'velocity'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${velocity.toFixed(<span class="hljs-number">2</span>)}</span>px/ms`</span>;
                
                <span class="hljs-comment">// 实际应用中，这里触发对应的业务逻辑</span>
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Swipe <span class="hljs-subst">${direction}</span>, Distance: <span class="hljs-subst">${distance}</span>px, Velocity: <span class="hljs-subst">${velocity}</span>px/ms`</span>);
                
                <span class="hljs-comment">// 示例：添加滑动动画反馈</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(<span class="hljs-subst">${direction === <span class="hljs-string">'left'</span> ? <span class="hljs-string">'-10px'</span> : <span class="hljs-string">'10px'</span>}</span>)`</span>;
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'translateX(0)'</span>;
                }, <span class="hljs-number">200</span>);
            }
            
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text</span>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'status'</span>).<span class="hljs-property">textContent</span> = text;
            }
            
            <span class="hljs-title function_">updateDebugInfo</span>(<span class="hljs-params">deltaX, deltaY</span>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'direction'</span>).<span class="hljs-property">textContent</span> = 
                    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaX) &gt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(deltaY) ? 
                    (deltaX &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'right'</span> : <span class="hljs-string">'left'</span>) : 
                    (deltaY &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'down'</span> : <span class="hljs-string">'up'</span>);
                
                <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(deltaX * deltaX + deltaY * deltaY);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'distance'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(distance)}</span>px`</span>;
            }
        }
        
        <span class="hljs-comment">// 初始化滑动检测</span>
        <span class="hljs-keyword">const</span> swipeArea = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'swipeArea'</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SwipeGesture</span>(swipeArea);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">3.2 高级滑动特性实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedSwipe</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">SwipeGesture</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">element, options = {}</span>) {
        <span class="hljs-variable language_">super</span>(element);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
            <span class="hljs-attr">enableMomentum</span>: <span class="hljs-literal">true</span>,           <span class="hljs-comment">// 启用惯性滑动</span>
            <span class="hljs-attr">momentumDeceleration</span>: <span class="hljs-number">0.001</span>,    <span class="hljs-comment">// 惯性减速度</span>
            <span class="hljs-attr">momentumBounce</span>: <span class="hljs-literal">true</span>,           <span class="hljs-comment">// 启用回弹效果</span>
            <span class="hljs-attr">bounceDuration</span>: <span class="hljs-number">300</span>,            <span class="hljs-comment">// 回弹时间</span>
            <span class="hljs-attr">enableEdgeResistance</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 边缘阻力</span>
            <span class="hljs-attr">edgeResistance</span>: <span class="hljs-number">0.5</span>,            <span class="hljs-comment">// 边缘阻力系数</span>
            ...options
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">momentumActive</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span> = <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-title function_">handleTouchEnd</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">handleTouchEnd</span>(event);
        
        <span class="hljs-comment">// 惯性滑动处理</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">enableMomentum</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSwiping</span>) {
            <span class="hljs-keyword">const</span> elapsedTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
            <span class="hljs-keyword">const</span> deltaX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentX</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = deltaX / elapsedTime;
            
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>) &gt; <span class="hljs-number">0.5</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startMomentum</span>();
            }
        }
    }
    
    <span class="hljs-title function_">startMomentum</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">momentumActive</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">animateMomentum</span>();
    }
    
    <span class="hljs-title function_">animateMomentum</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">momentumActive</span> || <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>) &lt; <span class="hljs-number">0.01</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">momentumActive</span> = <span class="hljs-literal">false</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 应用惯性</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> *= (<span class="hljs-number">1</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">momentumDeceleration</span>);
        
        <span class="hljs-comment">// 更新位置</span>
        <span class="hljs-keyword">const</span> currentTransform = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTransformValues</span>();
        <span class="hljs-keyword">const</span> newX = currentTransform.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> * <span class="hljs-number">16</span>; <span class="hljs-comment">// 16ms对应60fps</span>
        
        <span class="hljs-comment">// 边缘检测和回弹</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">enableEdgeResistance</span>) {
            <span class="hljs-keyword">const</span> elementRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
            <span class="hljs-keyword">const</span> containerRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
            
            <span class="hljs-keyword">if</span> (newX &gt; containerRect.<span class="hljs-property">right</span> - elementRect.<span class="hljs-property">width</span> || 
                newX &lt; containerRect.<span class="hljs-property">left</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> *= <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">edgeResistance</span>;
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">momentumBounce</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyBounceEffect</span>();
                }
            }
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(<span class="hljs-subst">${newX}</span>px)`</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationId</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">animateMomentum</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    }
    
    <span class="hljs-title function_">getTransformValues</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> style = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getComputedStyle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>);
        <span class="hljs-keyword">const</span> matrix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMMatrixReadOnly</span>(style.<span class="hljs-property">transform</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: matrix.<span class="hljs-property">m41</span>, <span class="hljs-attr">y</span>: matrix.<span class="hljs-property">m42</span> };
    }
    
    <span class="hljs-title function_">applyBounceEffect</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">`transform <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.bounceDuration}</span>ms cubic-bezier(0.25, 0.46, 0.45, 0.94)`</span>;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">''</span>;
        }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">bounceDuration</span>);
    }
}
</code></pre>
<h3 data-id="heading-8">四、长按（Long Press）手势实现</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>长按手势示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.longpress-container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#f093fb</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#f5576c</span> <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            user-select: none;
            touch-action: manipulation;
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">overflow</span>: hidden;
        }
        
        <span class="hljs-selector-class">.progress-ring</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
        }
        
        <span class="hljs-selector-class">.progress-circle</span> {
            fill: none;
            stroke: white;
            stroke-<span class="hljs-attribute">width</span>: <span class="hljs-number">4</span>;
            stroke-linecap: round;
            stroke-dasharray: <span class="hljs-number">565</span>; <span class="hljs-comment">/* 2 * π * 90 */</span>
            stroke-dashoffset: <span class="hljs-number">565</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">90deg</span>);
            <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">50%</span> <span class="hljs-number">50%</span>;
        }
        
        <span class="hljs-selector-class">.icon</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
        }
        
        <span class="hljs-selector-class">.instructions</span> {
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
        }
        
        <span class="hljs-selector-class">.visual-feedback</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0</span>);
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
        }
        
        <span class="hljs-selector-class">.active</span> <span class="hljs-selector-class">.visual-feedback</span> {
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
        }
        
        <span class="hljs-selector-class">.vibration</span> {
            <span class="hljs-attribute">animation</span>: vibrate <span class="hljs-number">0.1s</span> linear infinite;
        }
        
        <span class="hljs-keyword">@keyframes</span> vibrate {
            <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>); }
            <span class="hljs-number">25%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">1px</span>); }
            <span class="hljs-number">75%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">1px</span>); }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"longpress-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"longpressArea"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"visual-feedback"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-ring"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">circle</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-circle"</span> <span class="hljs-attr">cx</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">cy</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"90"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">circle</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span>&gt;</span>⏰<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>长按激活<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"instructions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>长按圆形区域1秒以上触发动作<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>状态: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"longpressStatus"</span>&gt;</span>等待长按...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>持续时间: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"duration"</span>&gt;</span>0ms<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>进度: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"progress"</span>&gt;</span>0%<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongPressGesture</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">element, options = {}</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span> = element;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
                    <span class="hljs-attr">threshold</span>: <span class="hljs-number">1000</span>,          <span class="hljs-comment">// 长按阈值（毫秒）</span>
                    <span class="hljs-attr">tolerance</span>: <span class="hljs-number">10</span>,            <span class="hljs-comment">// 允许的移动容差</span>
                    <span class="hljs-attr">enableVibration</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 启用震动反馈</span>
                    <span class="hljs-attr">enableProgress</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 显示进度环</span>
                    <span class="hljs-attr">onLongPress</span>: <span class="hljs-literal">null</span>,        <span class="hljs-comment">// 长按回调</span>
                    <span class="hljs-attr">onPressStart</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 按压开始回调</span>
                    <span class="hljs-attr">onPressEnd</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// 按压结束回调</span>
                    ...options
                };
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pressTimer</span> = <span class="hljs-literal">null</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasTriggered</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressCircle</span> = element.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.progress-circle'</span>);
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
            }
            
            <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 触摸事件</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchend'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchcancel'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchCancel</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                
                <span class="hljs-comment">// 鼠标事件（桌面端支持）</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseDown</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseUp</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                
                <span class="hljs-comment">// 防止上下文菜单（长按时弹出菜单）</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'contextmenu'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> e.<span class="hljs-title function_">preventDefault</span>());
            }
            
            <span class="hljs-title function_">handleTouchStart</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touch = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startPress</span>(touch.<span class="hljs-property">clientX</span>, touch.<span class="hljs-property">clientY</span>);
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleMouseDown</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startPress</span>(event.<span class="hljs-property">clientX</span>, event.<span class="hljs-property">clientY</span>);
            }
            
            <span class="hljs-title function_">startPress</span>(<span class="hljs-params">clientX, clientY</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasTriggered</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = clientX;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span> = clientY;
                
                <span class="hljs-comment">// 开始计时</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pressTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasTriggered</span>) {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerLongPress</span>();
                    }
                }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">threshold</span>);
                
                <span class="hljs-comment">// 视觉反馈</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProgress</span>(<span class="hljs-number">0</span>);
                
                <span class="hljs-comment">// 触发按压开始回调</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">onPressStart</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-title function_">onPressStart</span>();
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'按压开始'</span>);
            }
            
            <span class="hljs-title function_">handleTouchMove</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> || event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touch = event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>];
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkMovement</span>(touch.<span class="hljs-property">clientX</span>, touch.<span class="hljs-property">clientY</span>);
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleMouseMove</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span>) <span class="hljs-keyword">return</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkMovement</span>(event.<span class="hljs-property">clientX</span>, event.<span class="hljs-property">clientY</span>);
            }
            
            <span class="hljs-title function_">checkMovement</span>(<span class="hljs-params">clientX, clientY</span>) {
                <span class="hljs-keyword">const</span> deltaX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(clientX - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>);
                <span class="hljs-keyword">const</span> deltaY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(clientY - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startY</span>);
                
                <span class="hljs-comment">// 如果移动超过容差，取消长按</span>
                <span class="hljs-keyword">if</span> (deltaX &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">tolerance</span> || deltaY &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">tolerance</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cancelPress</span>();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 更新进度显示</span>
                    <span class="hljs-keyword">const</span> elapsed = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                    <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(elapsed / <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">threshold</span>, <span class="hljs-number">1</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProgress</span>(progress * <span class="hljs-number">100</span>);
                }
            }
            
            <span class="hljs-title function_">handleTouchEnd</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">endPress</span>();
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleMouseUp</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">endPress</span>();
            }
            
            <span class="hljs-title function_">handleTouchCancel</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cancelPress</span>();
            }
            
            <span class="hljs-title function_">endPress</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> elapsed = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasTriggered</span>) {
                    <span class="hljs-keyword">if</span> (elapsed &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">threshold</span>) {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerLongPress</span>();
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cancelPress</span>();
                    }
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanup</span>();
            }
            
            <span class="hljs-title function_">cancelPress</span>(<span class="hljs-params"/>) {
                <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pressTimer</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'已取消'</span>);
                
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">onPressEnd</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-title function_">onPressEnd</span>(<span class="hljs-literal">false</span>);
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cleanup</span>();
            }
            
            <span class="hljs-title function_">triggerLongPress</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasTriggered</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">const</span> elapsed = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                
                <span class="hljs-comment">// 震动反馈</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">enableVibration</span> &amp;&amp; <span class="hljs-string">'vibrate'</span> <span class="hljs-keyword">in</span> navigator) {
                    navigator.<span class="hljs-title function_">vibrate</span>([<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>]);
                }
                
                <span class="hljs-comment">// 视觉反馈</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'vibration'</span>);
                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'vibration'</span>);
                }, <span class="hljs-number">200</span>);
                
                <span class="hljs-comment">// 触发回调</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">onLongPress</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-title function_">onLongPress</span>(elapsed);
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">`长按触发 (<span class="hljs-subst">${elapsed}</span>ms)`</span>);
                
                <span class="hljs-comment">// 触发按压结束回调</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">onPressEnd</span> === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-title function_">onPressEnd</span>(<span class="hljs-literal">true</span>);
                }
                
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Long press triggered after <span class="hljs-subst">${elapsed}</span>ms`</span>);
            }
            
            <span class="hljs-title function_">updateProgress</span>(<span class="hljs-params">percent</span>) {
                <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'duration'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${duration}</span>ms`</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'progress'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(percent)}</span>%`</span>;
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">enableProgress</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressCircle</span>) {
                    <span class="hljs-keyword">const</span> circumference = <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">90</span>;
                    <span class="hljs-keyword">const</span> offset = circumference - (percent / <span class="hljs-number">100</span>) * circumference;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressCircle</span>.<span class="hljs-property">style</span>.<span class="hljs-property">strokeDashoffset</span> = offset;
                }
            }
            
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text</span>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'longpressStatus'</span>).<span class="hljs-property">textContent</span> = text;
            }
            
            <span class="hljs-title function_">cleanup</span>(<span class="hljs-params"/>) {
                <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pressTimer</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPressing</span> = <span class="hljs-literal">false</span>;
                
                <span class="hljs-comment">// 重置视觉反馈</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProgress</span>(<span class="hljs-number">0</span>);
            }
        }
        
        <span class="hljs-comment">// 初始化长按检测</span>
        <span class="hljs-keyword">const</span> longpressArea = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'longpressArea'</span>);
        <span class="hljs-keyword">const</span> longPress = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongPressGesture</span>(longpressArea, {
            <span class="hljs-attr">threshold</span>: <span class="hljs-number">1000</span>,
            <span class="hljs-attr">onLongPress</span>: <span class="hljs-function">(<span class="hljs-params">duration</span>) =&gt;</span> {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">`长按成功！持续时间：<span class="hljs-subst">${duration}</span>ms`</span>);
            },
            <span class="hljs-attr">onPressStart</span>: <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'按压开始'</span>);
            },
            <span class="hljs-attr">onPressEnd</span>: <span class="hljs-function">(<span class="hljs-params">success</span>) =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`按压结束，是否成功：<span class="hljs-subst">${success}</span>`</span>);
            }
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">五、缩放（Pinch）手势实现</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>缩放手势示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.pinch-container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1a1a1a</span>;
            touch-action: none;
            user-select: none;
        }
        
        <span class="hljs-selector-class">.pinch-content</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#3498db</span>, <span class="hljs-number">#2ecc71</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> linear;
        }
        
        <span class="hljs-selector-class">.content-inner</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">text-align</span>: center;
        }
        
        <span class="hljs-selector-class">.debug-panel</span> {
            <span class="hljs-attribute">position</span>: fixed;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Courier New'</span>, monospace;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
            <span class="hljs-attribute">min-width</span>: <span class="hljs-number">200px</span>;
            backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);
        }
        
        <span class="hljs-selector-class">.touch-points</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">pointer-events</span>: none;
        }
        
        <span class="hljs-selector-class">.touch-point</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0.7</span>);
            <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid white;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
        }
        
        <span class="hljs-selector-class">.scale-line</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">2px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>);
            <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-selector-class">.controls</span> {
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">justify-content</span>: center;
        }
        
        <span class="hljs-selector-class">.control-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
        }
        
        <span class="hljs-selector-class">.control-btn</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#2980b9</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pinch-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pinchContainer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pinch-content"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pinchContent"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-inner"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: 48px;"</span>&gt;</span>📱<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>双指缩放演示<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>使用两个手指进行缩放操作<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>可配合旋转、平移操作<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"touch-points"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"touchPoints"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"debug-panel"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>手势信息<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>触摸点数: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"touchCount"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>缩放比例: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"scaleValue"</span>&gt;</span>1.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>旋转角度: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rotationValue"</span>&gt;</span>0°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>位移X: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"translateX"</span>&gt;</span>0px<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>位移Y: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"translateY"</span>&gt;</span>0px<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>状态: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pinchStatus"</span>&gt;</span>等待操作<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"resetTransform()"</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"toggleBounds()"</span>&gt;</span>切换边界限制<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">PinchGesture</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, content</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPoints</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'touchPoints'</span>);
                
                <span class="hljs-comment">// 状态变量</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 存储触摸点信息</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastDistance</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastAngle</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPinching</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">minScale</span> = <span class="hljs-number">0.5</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScale</span> = <span class="hljs-number">3</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">enableBounds</span> = <span class="hljs-literal">true</span>;
                
                <span class="hljs-comment">// 初始化变换</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTransform</span>();
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
            }
            
            <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchend'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchcancel'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleTouchEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">false</span> });
                
                <span class="hljs-comment">// 更新调试信息</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDebugInfo</span>();
            }
            
            <span class="hljs-title function_">handleTouchStart</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouches</span>(event.<span class="hljs-property">touches</span>);
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> &gt;= <span class="hljs-number">2</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPinching</span> = <span class="hljs-literal">true</span>;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateInitialValues</span>();
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'双指操作中'</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> === <span class="hljs-number">1</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'单指操作中'</span>);
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouchVisualization</span>();
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleTouchMove</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouches</span>(event.<span class="hljs-property">touches</span>);
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> &gt;= <span class="hljs-number">2</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPinching</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleMultiTouch</span>();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> === <span class="hljs-number">1</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleSingleTouch</span>();
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTransform</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouchVisualization</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDebugInfo</span>();
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">handleTouchEnd</span>(<span class="hljs-params">event</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouches</span>(event.<span class="hljs-property">touches</span>);
                
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> &lt; <span class="hljs-number">2</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPinching</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> === <span class="hljs-number">1</span> ? <span class="hljs-string">'单指操作'</span> : <span class="hljs-string">'等待操作'</span>);
                }
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTouchVisualization</span>();
                event.<span class="hljs-title function_">preventDefault</span>();
            }
            
            <span class="hljs-title function_">updateTouches</span>(<span class="hljs-params">touchList</span>) {
                <span class="hljs-comment">// 清空已结束的触摸点</span>
                <span class="hljs-keyword">const</span> currentIdentifiers = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(touchList).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">identifier</span>);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> identifier <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">keys</span>()) {
                    <span class="hljs-keyword">if</span> (!currentIdentifiers.<span class="hljs-title function_">includes</span>(identifier)) {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">delete</span>(identifier);
                    }
                }
                
                <span class="hljs-comment">// 更新/添加触摸点</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> touch <span class="hljs-keyword">of</span> touchList) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">set</span>(touch.<span class="hljs-property">identifier</span>, {
                        <span class="hljs-attr">clientX</span>: touch.<span class="hljs-property">clientX</span>,
                        <span class="hljs-attr">clientY</span>: touch.<span class="hljs-property">clientY</span>,
                        <span class="hljs-attr">pageX</span>: touch.<span class="hljs-property">pageX</span>,
                        <span class="hljs-attr">pageY</span>: touch.<span class="hljs-property">pageY</span>
                    });
                }
            }
            
            <span class="hljs-title function_">calculateInitialValues</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touches = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">values</span>());
                <span class="hljs-keyword">const</span> point1 = touches[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">const</span> point2 = touches[<span class="hljs-number">1</span>];
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastDistance</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDistance</span>(point1, point2);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastAngle</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAngle</span>(point1, point2);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCenter</span>(point1, point2);
            }
            
            <span class="hljs-title function_">handleMultiTouch</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> touches = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">values</span>());
                <span class="hljs-keyword">if</span> (touches.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> point1 = touches[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">const</span> point2 = touches[<span class="hljs-number">1</span>];
                
                <span class="hljs-comment">// 计算当前距离和角度</span>
                <span class="hljs-keyword">const</span> currentDistance = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDistance</span>(point1, point2);
                <span class="hljs-keyword">const</span> currentAngle = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAngle</span>(point1, point2);
                <span class="hljs-keyword">const</span> currentCenter = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCenter</span>(point1, point2);
                
                <span class="hljs-comment">// 计算缩放比例</span>
                <span class="hljs-keyword">const</span> distanceRatio = currentDistance / <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastDistance</span>;
                <span class="hljs-keyword">const</span> newScale = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> * distanceRatio;
                
                <span class="hljs-comment">// 应用缩放限制</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">minScale</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScale</span>, newScale));
                
                <span class="hljs-comment">// 计算旋转角度（弧度转角度）</span>
                <span class="hljs-keyword">const</span> angleDelta = currentAngle - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastAngle</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> += angleDelta * (<span class="hljs-number">180</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>);
                
                <span class="hljs-comment">// 计算位移（基于中心点变化）</span>
                <span class="hljs-keyword">const</span> centerDeltaX = currentCenter.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span>.<span class="hljs-property">x</span>;
                <span class="hljs-keyword">const</span> centerDeltaY = currentCenter.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span>.<span class="hljs-property">y</span>;
                
                <span class="hljs-comment">// 考虑缩放影响</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> += centerDeltaX;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> += centerDeltaY;
                
                <span class="hljs-comment">// 更新参考值</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastDistance</span> = currentDistance;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastAngle</span> = currentAngle;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span> = currentCenter;
                
                <span class="hljs-comment">// 限制边界</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">enableBounds</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyBounds</span>();
                }
            }
            
            <span class="hljs-title function_">handleSingleTouch</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> touches = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">values</span>());
                <span class="hljs-keyword">if</span> (touches.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
                
                <span class="hljs-keyword">const</span> touch = touches[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">const</span> containerRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
                
                <span class="hljs-comment">// 更新中心点为当前触摸点</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCenter</span> = {
                    <span class="hljs-attr">x</span>: touch.<span class="hljs-property">clientX</span> - containerRect.<span class="hljs-property">left</span>,
                    <span class="hljs-attr">y</span>: touch.<span class="hljs-property">clientY</span> - containerRect.<span class="hljs-property">top</span>
                };
            }
            
            <span class="hljs-title function_">getDistance</span>(<span class="hljs-params">point1, point2</span>) {
                <span class="hljs-keyword">const</span> dx = point2.<span class="hljs-property">clientX</span> - point1.<span class="hljs-property">clientX</span>;
                <span class="hljs-keyword">const</span> dy = point2.<span class="hljs-property">clientY</span> - point1.<span class="hljs-property">clientY</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(dx * dx + dy * dy);
            }
            
            <span class="hljs-title function_">getAngle</span>(<span class="hljs-params">point1, point2</span>) {
                <span class="hljs-keyword">const</span> dx = point2.<span class="hljs-property">clientX</span> - point1.<span class="hljs-property">clientX</span>;
                <span class="hljs-keyword">const</span> dy = point2.<span class="hljs-property">clientY</span> - point1.<span class="hljs-property">clientY</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(dy, dx);
            }
            
            <span class="hljs-title function_">getCenter</span>(<span class="hljs-params">point1, point2</span>) {
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">x</span>: (point1.<span class="hljs-property">clientX</span> + point2.<span class="hljs-property">clientX</span>) / <span class="hljs-number">2</span>,
                    <span class="hljs-attr">y</span>: (point1.<span class="hljs-property">clientY</span> + point2.<span class="hljs-property">clientY</span>) / <span class="hljs-number">2</span>
                };
            }
            
            <span class="hljs-title function_">updateTransform</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> transform = <span class="hljs-string">`
                    translate(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateX}</span>px, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateY}</span>px)
                    scale(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.scale}</span>)
                    rotate(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rotation}</span>deg)
                `</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = transform;
            }
            
            <span class="hljs-title function_">applyBounds</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">const</span> contentRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
                <span class="hljs-keyword">const</span> containerRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
                
                <span class="hljs-comment">// 计算边界限制</span>
                <span class="hljs-keyword">const</span> maxTranslateX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, (contentRect.<span class="hljs-property">width</span> - containerRect.<span class="hljs-property">width</span>) / <span class="hljs-number">2</span>);
                <span class="hljs-keyword">const</span> maxTranslateY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, (contentRect.<span class="hljs-property">height</span> - containerRect.<span class="hljs-property">height</span>) / <span class="hljs-number">2</span>);
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(-maxTranslateX, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxTranslateX, <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(-maxTranslateY, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxTranslateY, <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span>));
            }
            
            <span class="hljs-title function_">updateTouchVisualization</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 清空之前的可视化</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPoints</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
                
                <span class="hljs-comment">// 绘制触摸点</span>
                <span class="hljs-keyword">let</span> index = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [identifier, touch] <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>) {
                    <span class="hljs-keyword">const</span> point = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
                    point.<span class="hljs-property">className</span> = <span class="hljs-string">'touch-point'</span>;
                    point.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${touch.clientX}</span>px`</span>;
                    point.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${touch.clientY}</span>px`</span>;
                    point.<span class="hljs-property">textContent</span> = index;
                    
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPoints</span>.<span class="hljs-title function_">appendChild</span>(point);
                    index++;
                }
                
                <span class="hljs-comment">// 绘制连接线（当有两个点时）</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span> === <span class="hljs-number">2</span>) {
                    <span class="hljs-keyword">const</span> touches = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-title function_">values</span>());
                    <span class="hljs-keyword">const</span> line = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
                    line.<span class="hljs-property">className</span> = <span class="hljs-string">'scale-line'</span>;
                    
                    <span class="hljs-keyword">const</span> dx = touches[<span class="hljs-number">1</span>].<span class="hljs-property">clientX</span> - touches[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span>;
                    <span class="hljs-keyword">const</span> dy = touches[<span class="hljs-number">1</span>].<span class="hljs-property">clientY</span> - touches[<span class="hljs-number">0</span>].<span class="hljs-property">clientY</span>;
                    <span class="hljs-keyword">const</span> length = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(dx * dx + dy * dy);
                    <span class="hljs-keyword">const</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(dy, dx) * (<span class="hljs-number">180</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>);
                    
                    line.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${length}</span>px`</span>;
                    line.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${touches[<span class="hljs-number">0</span>].clientX}</span>px`</span>;
                    line.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${touches[<span class="hljs-number">0</span>].clientY}</span>px`</span>;
                    line.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`rotate(<span class="hljs-subst">${angle}</span>deg)`</span>;
                    
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPoints</span>.<span class="hljs-title function_">appendChild</span>(line);
                }
            }
            
            <span class="hljs-title function_">updateDebugInfo</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'touchCount'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">touches</span>.<span class="hljs-property">size</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'scaleValue'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'rotationValue'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rotation.toFixed(<span class="hljs-number">1</span>)}</span>°`</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'translateX'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateX.toFixed(<span class="hljs-number">0</span>)}</span>px`</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'translateY'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateY.toFixed(<span class="hljs-number">0</span>)}</span>px`</span>;
            }
            
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text</span>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'pinchStatus'</span>).<span class="hljs-property">textContent</span> = text;
            }
            
            <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTransform</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateDebugInfo</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'已重置'</span>);
            }
            
            <span class="hljs-title function_">toggleBounds</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">enableBounds</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">enableBounds</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateStatus</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">enableBounds</span> ? <span class="hljs-string">'边界限制已启用'</span> : <span class="hljs-string">'边界限制已禁用'</span>);
            }
        }
        
        <span class="hljs-comment">// 初始化缩放手势检测</span>
        <span class="hljs-keyword">const</span> pinchContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'pinchContainer'</span>);
        <span class="hljs-keyword">const</span> pinchContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'pinchContent'</span>);
        <span class="hljs-keyword">const</span> pinchGesture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PinchGesture</span>(pinchContainer, pinchContent);
        
        <span class="hljs-comment">// 全局函数供按钮调用</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">resetTransform</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            pinchGesture.<span class="hljs-title function_">reset</span>();
        };
        
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">toggleBounds</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            pinchGesture.<span class="hljs-title function_">toggleBounds</span>();
        };
        
        <span class="hljs-comment">// 添加键盘快捷键支持</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">'r'</span> || event.<span class="hljs-property">key</span> === <span class="hljs-string">'R'</span>) {
                pinchGesture.<span class="hljs-title function_">reset</span>();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">'b'</span> || event.<span class="hljs-property">key</span> === <span class="hljs-string">'B'</span>) {
                pinchGesture.<span class="hljs-title function_">toggleBounds</span>();
            }
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">六、性能优化与最佳实践</h3>
<h4 data-id="heading-11">6.1 性能优化策略</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedGestureHandler</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rafId</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// requestAnimationFrame ID</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateInterval</span> = <span class="hljs-number">16</span>; <span class="hljs-comment">// ~60fps</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventQueue</span> = [];
        
        <span class="hljs-comment">// 使用事件委托减少监听器数量</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchend'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleEvent</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startAnimationLoop</span>();
    }
    
    <span class="hljs-title function_">handleEvent</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-comment">// 节流处理</span>
        <span class="hljs-keyword">const</span> now = performance.<span class="hljs-title function_">now</span>();
        <span class="hljs-keyword">if</span> (now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateInterval</span>) {
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> = now;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processEvent</span>(event);
    }
    
    <span class="hljs-title function_">processEvent</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-comment">// 使用位运算进行快速状态判断</span>
        <span class="hljs-keyword">const</span> touches = event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span>;
        
        <span class="hljs-comment">// 事件类型快速判断</span>
        <span class="hljs-keyword">switch</span>(event.<span class="hljs-property">type</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchstart'</span>:
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleTouchStart</span>(event);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchmove'</span>:
                <span class="hljs-keyword">if</span> (touches === <span class="hljs-number">1</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleSingleTouchMove</span>(event);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (touches === <span class="hljs-number">2</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleMultiTouchMove</span>(event);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchend'</span>:
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleTouchEnd</span>(event);
                <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-title function_">startAnimationLoop</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">animate</span> = (<span class="hljs-params">timestamp</span>) =&gt; {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rafId</span> = <span class="hljs-title function_">requestAnimationFrame</span>(animate);
            
            <span class="hljs-comment">// 批量处理事件</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventQueue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">batchProcessEvents</span>();
            }
            
            <span class="hljs-comment">// 惯性动画等</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateAnimations</span>(timestamp);
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rafId</span> = <span class="hljs-title function_">requestAnimationFrame</span>(animate);
    }
    
    <span class="hljs-comment">// 使用CSS transforms进行硬件加速</span>
    <span class="hljs-title function_">applyHardwareAcceleration</span>(<span class="hljs-params">element</span>) {
        element.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'translate3d(0,0,0)'</span>;
        element.<span class="hljs-property">style</span>.<span class="hljs-property">willChange</span> = <span class="hljs-string">'transform'</span>;
    }
}
</code></pre>
<h4 data-id="heading-12">6.2 兼容性处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossPlatformGesture</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 检测设备支持</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsTouch</span> = <span class="hljs-string">'ontouchstart'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsPointer</span> = <span class="hljs-string">'PointerEvent'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>;
        
        <span class="hljs-comment">// 统一事件接口</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = {
            <span class="hljs-attr">start</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsTouch</span> ? <span class="hljs-string">'touchstart'</span> : 
                   <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsPointer</span> ? <span class="hljs-string">'pointerdown'</span> : <span class="hljs-string">'mousedown'</span>,
            <span class="hljs-attr">move</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsTouch</span> ? <span class="hljs-string">'touchmove'</span> : 
                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsPointer</span> ? <span class="hljs-string">'pointermove'</span> : <span class="hljs-string">'mousemove'</span>,
            <span class="hljs-attr">end</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsTouch</span> ? <span class="hljs-string">'touchend'</span> : 
                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsPointer</span> ? <span class="hljs-string">'pointerup'</span> : <span class="hljs-string">'mouseup'</span>
        };
    }
    
    <span class="hljs-title function_">getEventPoints</span>(<span class="hljs-params">event</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsTouch</span> &amp;&amp; event.<span class="hljs-property">touches</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(event.<span class="hljs-property">touches</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">touch</span> =&gt;</span> ({
                <span class="hljs-attr">x</span>: touch.<span class="hljs-property">clientX</span>,
                <span class="hljs-attr">y</span>: touch.<span class="hljs-property">clientY</span>,
                <span class="hljs-attr">id</span>: touch.<span class="hljs-property">identifier</span>
            }));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">supportsPointer</span>) {
            <span class="hljs-keyword">return</span> [{
                <span class="hljs-attr">x</span>: event.<span class="hljs-property">clientX</span>,
                <span class="hljs-attr">y</span>: event.<span class="hljs-property">clientY</span>,
                <span class="hljs-attr">id</span>: event.<span class="hljs-property">pointerId</span>
            }];
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> [{
                <span class="hljs-attr">x</span>: event.<span class="hljs-property">clientX</span>,
                <span class="hljs-attr">y</span>: event.<span class="hljs-property">clientY</span>,
                <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>
            }];
        }
    }
}
</code></pre>
<h3 data-id="heading-13">七、综合应用示例：图片查看器</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>手势图片查看器<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.image-viewer</span> {
            <span class="hljs-attribute">position</span>: fixed;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.95</span>);
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
            touch-action: none;
        }
        
        <span class="hljs-selector-class">.image-container</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">position</span>: relative;
        }
        
        <span class="hljs-selector-class">.image-wrapper</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">transform-origin</span>: center center;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.15s</span> linear;
        }
        
        <span class="hljs-selector-class">.image-wrapper</span> <span class="hljs-selector-tag">img</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">max-height</span>: <span class="hljs-number">90vh</span>;
            <span class="hljs-attribute">display</span>: block;
            user-select: none;
            -webkit-user-drag: none;
        }
        
        <span class="hljs-selector-class">.gesture-hint</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.7</span>;
            <span class="hljs-attribute">pointer-events</span>: none;
        }
        
        <span class="hljs-selector-class">.controls</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">30px</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
        }
        
        <span class="hljs-selector-class">.control-btn</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);
            <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
        }
        
        <span class="hljs-selector-class">.control-btn</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
        }
        
        <span class="hljs-selector-class">.close-btn</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">border</span>: none;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1001</span>;
        }
        
        <span class="hljs-selector-class">.page-indicator</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">100px</span>;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"openImageViewer()"</span>&gt;</span>打开图片查看器<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-viewer"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"imageViewer"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: none;"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeImageViewer()"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gesture-hint"</span>&gt;</span>双指缩放 · 单指拖动 · 长按保存<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-wrapper"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"imageWrapper"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/800/600"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewerImage"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"示例图片"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-indicator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"currentPage"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> / <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"totalPages"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"previousImage()"</span>&gt;</span>←<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"resetImage()"</span>&gt;</span>↺<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-btn"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"nextImage()"</span>&gt;</span>→<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageViewerGesture</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">viewerId, wrapperId</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewer</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(viewerId);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapper</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(wrapperId);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapper</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'img'</span>);
                
                <span class="hljs-comment">// 手势状态</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-number">0</span>;
                
                <span class="hljs-comment">// 边界限制</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">minScale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScale</span> = <span class="hljs-number">5</span>;
                
                <span class="hljs-comment">// 当前图片索引</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span> = [
                    <span class="hljs-string">'https://picsum.photos/800/600?random=1'</span>,
                    <span class="hljs-string">'https://picsum.photos/800/600?random=2'</span>,
                    <span class="hljs-string">'https://picsum.photos/800/600?random=3'</span>,
                    <span class="hljs-string">'https://picsum.photos/800/600?random=4'</span>,
                    <span class="hljs-string">'https://picsum.photos/800/600?random=5'</span>
                ];
                
                <span class="hljs-comment">// 初始化</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadGestures</span>();
            }
            
            <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updatePageIndicator</span>();
            }
            
            <span class="hljs-title function_">loadGestures</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 滑动手势（切换图片）</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SwipeGesture</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">viewer</span>, {
                    <span class="hljs-attr">threshold</span>: <span class="hljs-number">30</span>,
                    <span class="hljs-attr">onSwipe</span>: <span class="hljs-function">(<span class="hljs-params">direction, distance</span>) =&gt;</span> {
                        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> &gt; <span class="hljs-number">1.1</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 缩放状态下不切换</span>
                        
                        <span class="hljs-keyword">if</span> (direction === <span class="hljs-string">'left'</span>) {
                            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">nextImage</span>();
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (direction === <span class="hljs-string">'right'</span>) {
                            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">previousImage</span>();
                        }
                    }
                });
                
                <span class="hljs-comment">// 缩放手势</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PinchGesture</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">viewer</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapper</span>);
                
                <span class="hljs-comment">// 长按手势（保存图片）</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongPressGesture</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span>, {
                    <span class="hljs-attr">threshold</span>: <span class="hljs-number">800</span>,
                    <span class="hljs-attr">onLongPress</span>: <span class="hljs-function">() =&gt;</span> {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveImage</span>();
                    }
                });
            }
            
            <span class="hljs-title function_">nextImage</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>) % <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-property">length</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>();
            }
            
            <span class="hljs-title function_">previousImage</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> - <span class="hljs-number">1</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-property">length</span>) % <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-property">length</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>();
            }
            
            <span class="hljs-title function_">loadImage</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 重置变换</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTransform</span>();
                
                <span class="hljs-comment">// 加载新图片</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.5'</span>;
                <span class="hljs-keyword">const</span> newImage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
                newImage.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span>.<span class="hljs-property">src</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>];
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'1'</span>;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updatePageIndicator</span>();
                };
                newImage.<span class="hljs-property">src</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>];
            }
            
            <span class="hljs-title function_">saveImage</span>(<span class="hljs-params"/>) {
                <span class="hljs-comment">// 创建虚拟链接下载图片</span>
                <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
                link.<span class="hljs-property">href</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">image</span>.<span class="hljs-property">src</span>;
                link.<span class="hljs-property">download</span> = <span class="hljs-string">`image_<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.currentIndex + <span class="hljs-number">1</span>}</span>.jpg`</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
                link.<span class="hljs-title function_">click</span>();
                <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
                
                <span class="hljs-comment">// 提示用户</span>
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">'图片已开始下载'</span>);
            }
            
            <span class="hljs-title function_">resetImage</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">scale</span> = <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-number">0</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateTransform</span>();
            }
            
            <span class="hljs-title function_">updateTransform</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapper</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`
                    translate(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateX}</span>px, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.translateY}</span>px)
                    scale(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.scale}</span>)
                    rotate(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rotation}</span>deg)
                `</span>;
            }
            
            <span class="hljs-title function_">updatePageIndicator</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'currentPage'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>;
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'totalPages'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-property">length</span>;
            }
        }
        
        <span class="hljs-comment">// 全局实例</span>
        <span class="hljs-keyword">let</span> imageViewer;
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">openImageViewer</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'imageViewer'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'flex'</span>;
            
            <span class="hljs-keyword">if</span> (!imageViewer) {
                imageViewer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageViewerGesture</span>(<span class="hljs-string">'imageViewer'</span>, <span class="hljs-string">'imageWrapper'</span>);
            }
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">closeImageViewer</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'imageViewer'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">previousImage</span>(<span class="hljs-params"/>) {
            imageViewer.<span class="hljs-title function_">previousImage</span>();
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextImage</span>(<span class="hljs-params"/>) {
            imageViewer.<span class="hljs-title function_">nextImage</span>();
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">resetImage</span>(<span class="hljs-params"/>) {
            imageViewer.<span class="hljs-title function_">resetImage</span>();
        }
        
        <span class="hljs-comment">// 初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
            imageViewer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageViewerGesture</span>(<span class="hljs-string">'imageViewer'</span>, <span class="hljs-string">'imageWrapper'</span>);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">八、总结与注意事项</h3>
<h4 data-id="heading-15">8.1 关键要点总结</h4>
<ol>
<li><strong>事件顺序</strong>：始终遵循 <code>touchstart</code> → <code>touchmove</code> → <code>touchend</code> 的事件流</li>
<li><strong>性能优化</strong>：使用 <code>transform</code> 进行动画，避免 <code>setTimeout</code>，多用 <code>requestAnimationFrame</code></li>
<li><strong>兼容性</strong>：同时处理触摸事件和鼠标事件，支持跨平台</li>
<li><strong>用户体验</strong>：提供视觉反馈，设置合理的阈值和容差</li>
<li><strong>边界处理</strong>：所有手势操作都要考虑边界情况</li>
</ol>
<h4 data-id="heading-16">8.2 常见问题解决</h4>
<ol>
<li><strong>事件冲突</strong>：使用 <code>event.preventDefault()</code> 阻止默认行为</li>
<li><strong>滚动冲突</strong>：设置 <code>touch-action</code> CSS属性</li>
<li><strong>多点触控</strong>：使用 <code>identifier</code> 跟踪不同的触摸点</li>
<li><strong>内存泄漏</strong>：及时清理事件监听器</li>
</ol>
<h4 data-id="heading-17">8.3 推荐的第三方库</h4>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fhammerjs.github.io%2F" target="_blank" title="http://hammerjs.github.io/" ref="nofollow noopener noreferrer">Hammer.js</a>：轻量级手势库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Finteractjs.io%2F" target="_blank" title="https://interactjs.io/" ref="nofollow noopener noreferrer">Interact.js</a>：强大的拖拽、缩放、手势库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAlloyTeam%2FAlloyFinger" target="_blank" title="https://github.com/AlloyTeam/AlloyFinger" ref="nofollow noopener noreferrer">AlloyFinger</a>：腾讯AlloyTeam的手势库</li>
</ul>
<p>通过本文的详细讲解和代码示例，相信你已经掌握了H5手势操作的核心技术。在实际开发中，建议根据具体需求选择合适的技术方案，并始终以用户体验为核心进行优化。</p>
<hr/>
<p><strong>如果觉得文章有帮助，欢迎点赞、收藏、关注！</strong><br/>
<strong>有任何问题或建议，欢迎在评论区留言讨论！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-深度拆解 v-if 、 v-for 、 v-show]]></title>    <link>https://juejin.cn/post/7601843004957884462</link>    <guid>https://juejin.cn/post/7601843004957884462</guid>    <pubDate>2026-02-01T11:11:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601843004957884462" data-draft-id="7601169244455157786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-深度拆解 v-if 、 v-for 、 v-show "/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-02-01T11:11:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-深度拆解 v-if 、 v-for 、 v-show 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:11:46.000Z" title="Sun Feb 01 2026 11:11:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 Vue 模板开发中，指令的优先级和渲染机制直接决定了应用的性能。尤其是 <code>v-if</code> 与 <code>v-for</code> 的“爱恨情仇”，在 Vue 2 和 Vue 3 中经历了完全相反的变革。本文将带你从底层逻辑出发，看透这些指令的本质。</p>
<h2 data-id="heading-1">一、 v-if 与 v-for 的优先级之战</h2>
<h3 data-id="heading-2">1. Vue 2 时代：v-for 称王</h3>
<p>在 Vue 2 中，<code>v-for</code> 的优先级<strong>高于</strong> <code>v-if</code>。</p>
<p>这意味着如果你在同一个元素上同时使用它们，Vue 会先执行循环，再对循环出的每一个项进行条件判断。</p>
<ul>
<li><strong>后果</strong>：即使 <code>v-if</code> 为 <code>false</code>，循环依然会完整执行，造成极大的性能浪费。</li>
</ul>
<h3 data-id="heading-3">2. Vue 3 时代：v-if 反超</h3>
<p>在 Vue 3 中，<code>v-if</code> 的优先级<strong>高于</strong> <code>v-for</code>。</p>
<p>此时，如果两者并列，<code>v-if</code> 会先执行。但由于此时循环尚未开始，<code>v-if</code> 无法访问到 <code>v-for</code> 循环中的变量，会导致报错。</p>
<h3 data-id="heading-4">3. 最佳实践：永远不要同台竞技</h3>
<p>无论哪个版本，永远不要把v-if和v-for同时用在同一个元素上。如果非要一起使用可以通过如下方式：</p>
<ul>
<li>
<p><strong>方案 A：外层包裹 <code>template</code>（推荐）</strong></p>
<p>如果判断条件与循环项无关，先判断再循环。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template v-if="isShow"&gt;
  &lt;div v-for="item in items" :key="item.id"&gt;{{ item.name }}&lt;/div&gt;
&lt;/template&gt;
</code></pre>
</li>
<li>
<p><strong>方案 B：使用计算属性 <code>computed</code>（推荐）</strong></p>
<p>如果需要根据条件过滤列表项，先过滤再循环。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { computed } from 'vue';
const activeItems = computed(() =&gt; items.value.filter(item =&gt; item.isActive));
&lt;/script&gt;

&lt;template&gt;
  &lt;div v-for="item in activeItems" :key="item.id"&gt;{{ item.name }}&lt;/div&gt;
&lt;/template&gt;
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、 v-if 与 v-show：隐藏背后的玄机</h2>
<p>两者都能控制显隐，但“手段”截然不同。</p>
<h3 data-id="heading-6">1. 核心区别对照表</h3>



































<table><thead><tr><th><strong>特性</strong></th><th><strong>v-if</strong></th><th><strong>v-show</strong></th></tr></thead><tbody><tr><td><strong>手段</strong></td><td>真正的数据驱动，动态添加/删除 DOM 元素</td><td>CSS 驱动，切换 <code>display: none</code> 属性</td></tr><tr><td><strong>本质</strong></td><td>组件的销毁与重建</td><td>元素的显示与隐藏</td></tr><tr><td><strong>初始渲染</strong></td><td>若初始为 false，则完全不渲染</td><td>无论真假，都会渲染并保留 DOM</td></tr><tr><td><strong>切换消耗</strong></td><td>较高（涉及生命周期与 DOM 增删）</td><td>较低（仅改变 CSS）</td></tr><tr><td><strong>生命周期</strong></td><td>切换时触发完整生命周期</td><td>不触发生命周期钩子</td></tr></tbody></table>
<h3 data-id="heading-7">2. 生命周期触发逻辑（Vue 3 + TS 视角）</h3>
<p>由于 <code>v-if</code> 是真实的销毁与重建，它会完整走一遍生命周期。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { onMounted, onUnmounted } from 'vue';

// 假设这是一个被 v-if 控制的子组件
onMounted(() =&gt; {
  console.log('子组件已创建并挂载 (v-if 为 true)');
});

onUnmounted(() =&gt; {
  console.log('子组件已卸载并销毁 (v-if 为 false)');
});
&lt;/script&gt;
</code></pre>
<ul>
<li>
<p><strong>v-if 切换</strong>：</p>
<ul>
<li><code>false -&gt; true</code>：触发 <code>onBeforeMount</code>, <code>onMounted</code> 等。</li>
<li><code>true -&gt; false</code>：触发 <code>onBeforeUnmount</code>, <code>onUnmounted</code> 等。</li>
</ul>
</li>
<li>
<p><strong>v-show 切换</strong>：</p>
<ul>
<li>不会触发上述任何钩子，因为组件实例始终保存在内存中。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-8">三、 总结：如何选型？</h2>
<ul>
<li><strong>选择 <code>v-show</code></strong>：如果元素在页面上<strong>频繁切换</strong>（如 Tab 标签、折叠面板），<code>v-show</code> 的性能表现更优。</li>
<li><strong>选择 <code>v-if</code></strong>：如果运行条件下<strong>改变较少</strong>，或者该部分包含大量复杂的子组件，使用 <code>v-if</code> 可以保证初始渲染的轻量化，并在不需要时彻底释放内存。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么优秀的开发，最后都在学“管理产品”]]></title>    <link>https://juejin.cn/post/7601076694105554980</link>    <guid>https://juejin.cn/post/7601076694105554980</guid>    <pubDate>2026-02-01T11:25:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105554980" data-draft-id="7601159804490924051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么优秀的开发，最后都在学“管理产品”"/> <meta itemprop="keywords" content="前端,程序员,产品经理"/> <meta itemprop="datePublished" content="2026-02-01T11:25:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IAM17"/> <meta itemprop="url" content="https://juejin.cn/user/1953149470376301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么优秀的开发，最后都在学“管理产品”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1953149470376301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IAM17
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:25:03.000Z" title="Sun Feb 01 2026 11:25:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多开发觉得，只要代码写得漂亮、技术能力强，问题就会迎刃而解。<br/>
可现实往往并不如此：交付延期的根本原因，很多时候不是技术难，而是需求不明确、产品拖延，或者组织流程不健全。</p>
<p>我曾在一个团队中观察到这样的情况：产品本身是技术出身，他习惯对实现方式进行干预，同时在下发任务时常拖延需求。作为开发，我们很弱势，延期就是我们的责任，而产品延期几乎没人追责。</p>
<p>这种环境下，单靠技术能力是很难保护自己和团队的。举个几乎每个开发都会遇到的场景：</p>
<p>产品：</p>
<pre>这个需求差不多了，
你先按现在的理解做着吧，
周五肯定要给我一个版本。
</pre>
<p>对于这样的要求，开发怎么回答？</p>
<p>说需求没确认不能做？那肯定是不行，会被扣上不配合的帽子。</p>
<p>说保证完成任务那肯定也是不行的，那样会把你当成消耗品，默默的消耗你。比如你刚开发了一个功能，产品可能立即会对你说，你做的不对，需要改成xxx。你修改了一次又一次，但没人记得你的功劳，因为最后的成品可能只是一个很简单的页面。你只能成为被随意驱使的机器，没有思考，只有执行。产品很差劲，无法一次设计出完整的产品，只能不断的修改。但是，一旦体验不好，老板会说，为什么开发没有提出建议？设计的人是产品，但设计出问题让开发担责。你在疲于奔命，你心里在咆哮，但也只能默默忍受，为什么只能忍受，因为在很多组织中，开发都是弱势的，在老板兜着产品、却没人兜开发的环境里，开发没有对抗的底气。开发弱势到什么程度？我亲耳听到一个初级产品在需求沟通会上理直气壮的说：你们前端没有设计稿就不能开发了吗？没有人回应。不是不敢，而是争论这个没有意义，因为老板就是这么想的。通常产品拖延没人问，开发延期需要层层审批解释，还会有很大的概率不被批准。回复很可能是：不行加加班吧...，你那是人不够吗？不行给你加两个人差不多了吧...</p>
<p>在开发弱势环境中，怎样回答才算是不亢不卑呢？</p>
<p>首先要知道，不能硬刚，除非你想换个游戏重新玩。必须说可以做。</p>
<p>我可以先按当前理解推进一个 <strong>demo</strong>，<br/>
但这版<strong>不作为最终交付版本</strong>，<br/>
相关细节确认后需要补改。</p>
<p>由于缺少相关的细节， 建议1，2，3...，因为产品没有完成他的职责，开发只能帮他完善。记住，可以不是最后的产品设计，但不能没有。因为如果没有产品设计，最后评估开发工作的时候，产品可以任意拿捏开发。完成产品设计后，必须锁定产品需求，即使锁定期很短。</p>
<p>比如：在周五前，不接受新的需求。按已经确认的demo版本的需求，周五将会出demo版本。</p>
<p>这样是明确一个边界，也是明确 demo 版本的成本。如果产品并不接受这种大的边界，还是想随意修改需求，开发要尽力给他画小一些的边界：如果周三前确定xxx，是可以完成xxx的。如果周四前能确认xxx，是可以完成xxx的。边界确认后，就是要留下证据，正式些的，发邮件，不过如于开发弱势，这样做显得太高调，会让产品不服务，毕竟是给特权套上马笼头，一般在群里发一下就行了。其实产品真的不遵守，也不能把这个拿出来，除非你要撕跛脸，这样做的作用，是给产品一些心里压力，毕竟正常情况下大家心里对是非都有一个判断。</p>
<p>在画边界时要果断，语气必须肯定。一旦说出，不能随意妥协，除非修改前置条件。有些开发比较腼腆，喜欢把排期单独发给产品，这是大忌。产品无视你的成本为0，可是你承受的风险会达到100%。</p>
<p>现在的产品一般是不懂技术的，这样产品和技术沟通起来可能会有些障碍，于是开发就想，如果产品懂技术就好了。但是当产品真的懂技术，开发就会发现，烦恼（温和的说法）不断。因为他会仍然用“技术负责人 / 架构师”的心态写需求，把 <em>“怎么做”</em> 当成产品职责，你会发现，他把产品需求写成了详细设计。在这样的产品下面，要怎么做才能避免在技术上被锁死，但出了事，却要承担全部责任？</p>
<p>首先，不能直接否定他，那样会掉进自证陷阱。因为你否定他，他就要你证明他哪里错了。这个很难。因为实现方案很难说哪个对哪个错，要选哪个方案，是多方面考虑的，比如开发熟悉（以前做过）也是一个理由 ，但是这样的理由是没办法说服产品的。</p>
<p>可以先肯定他的方案，这个方案从结果上是 OK 的。不过实现上可能存在一些不确定性。我建议需求里先只约定<strong>业务结果和约束条件</strong>，具体实现我来<strong>保证</strong>，保证按时交付，保证代码质量。后面是委婉的说明需要给开发留出发挥空间，最后指明，开发才是代码质量的100%责任人，不是产品。千万不要这样说：你这个方案不对，
这个设计不专业，你不懂这个技术细节。要尽力避免和产品 PK 技术，尽力从责任上说问题。把“技术反对”翻译成“产品风险”，你要做的是 <strong>不讨论“你对不对”，只讨论“这样会带来什么后果”</strong> 。</p>
<p>说白了一切都是因为开发太弱势的错，否则开发直接怼：你一个产品不好好写需求，我怎么写代码关你毛线事？心里再补上一句“狗拿耗子，多管闲事。“</p>
<p>最后总结一下，要始终记住三句话</p>
<ol>
<li><strong>需求是产品的，结果是一起的，实现是开发的</strong></li>
<li><strong>没有冻结的需求，就没有承诺的排期</strong></li>
<li><strong>所有延期，都必须有可追溯的时间点</strong></li>
</ol>
<p>你不是在“对抗产品”，是在给团队建立边界。保护自己，保护团队的人。</p>
<p>我最终把这篇文章发到了前端分类，因为我是一个前端，讲述也是是前端角度。标签还加了产品经理，希望能有产品看到，多给开发一些理解。虽然这篇文章没有讲技术本身，但却比技术重要的多。这就应了那句话，做的好不如说的好，说的好不如说到点子上。踏实肯干，精益求精，这是每个开发都应有的基本品质，但也需要学会沟通，懂得保护自己，保护团队。</p>
<p>不要试图去改变组织的风格，不可能成功（从开发这个角色发起，不可能成功）。不要试图去改变某个产品的风格，成功率接近于0。人是很难改变的，尤其是你处于弱势的前提下。除非你和产品私下打好关系。说白了，只要关系到位，一切都不是问题，但这个实现起来显然比我前面说的那些难的多，更多的是靠天赋，也靠人与人之间的缘分。</p>
<p>标题中的管理产品是说开发在职业成长过程中，学会去<strong>管理与产品相关的不确定性和边界</strong>。</p>
<p>最后永远保持清醒，不要和产品发生争执。在有可能擦枪走火的情况下，把产品拉到无人的地方讨论。因为争执一旦发生，产品可能没什么事，你肯定会被减分。因为在多数组织里，技术是为产品<strong>服务</strong>的。要学会用“流程”对抗“组织风格”。不要带情绪，用事实说话。作为开发，要发挥开发的长处：</p>
<p>开发是“复杂度翻译器”</p>
<p>你能把：</p>
<ul>
<li>混乱需求</li>
<li>模糊承诺<br/>
翻译成：</li>
<li>风险</li>
<li>时间</li>
<li>依赖</li>
</ul>
<p>👉 这件事<strong>产品做不了，老板也做不好</strong>。别再只闷头研究技术了，多练习一下复杂度翻译器这个能力，这个能力比技术还要重要。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-Computed 与 Watch 深度解读与选型指南]]></title>    <link>https://juejin.cn/post/7601486204173647922</link>    <guid>https://juejin.cn/post/7601486204173647922</guid>    <pubDate>2026-02-01T11:32:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601486204173647922" data-draft-id="7601441475987341358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-Computed 与 Watch 深度解读与选型指南"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-02-01T11:32:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-Computed 与 Watch 深度解读与选型指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:32:09.000Z" title="Sun Feb 01 2026 11:32:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 Vue 的响应式世界里，<code>computed</code>（计算属性）和 <code>watch</code>（侦听器）是我们处理数据联动最常用的两把利器。虽然它们都能响应数据变化，但背后的设计哲学和应用场景却大相径庭。本文将结合 Vue 3 组合式 API 与 TypeScript，带你理清两者的本质区别。</p>
<h2 data-id="heading-1">一、 Computed：智能的“数据加工厂”</h2>
<p><code>computed</code> 的核心在它是一个计算属性。它会根据所依赖的数据动态计算结果，并具备强大的缓存机制。</p>
<h3 data-id="heading-2">1. 核心特性</h3>
<ul>
<li><strong>具备缓存性</strong>：只有当它依赖的响应式数据发生变化时，才会重新计算。否则，无论多少次访问该属性，都会立即返回上次缓存的结果。</li>
<li><strong>必须有返回值</strong>：它必须通过 <code>return</code> 返回计算后的结果。</li>
<li><strong>惰性求值</strong>：只有在被读取时才会执行计算。</li>
</ul>
<h3 data-id="heading-3">2. Vue 3 + TS 示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref, computed } from 'vue';

const count = ref&lt;number&gt;(1);

// computedValue1 为计算出的新属性
const computedValue1 = computed&lt;number&gt;(() =&gt; {
  console.log('正在执行计算...'); // 只有 count 改变时才会打印
  return count.value + 1;
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;原值: {{ count }} | 计算值: {{ computedValue1 }}&lt;/div&gt;
  &lt;button @click="count++"&gt;增加&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h2 data-id="heading-4">二、 Watch：敏锐的“数据监控员”</h2>
<p><code>watch</code> 的核心在于<strong>响应副作用</strong>。当监听的值发生改变时执行特定的回调函数。</p>
<h3 data-id="heading-5">1. 核心特性</h3>
<ul>
<li>
<p><strong>无缓存性</strong>：它不是为了产生新值，而是为了在值变化时执行逻辑。</p>
</li>
<li>
<p><strong>无返回值</strong>：回调函数中通常处理的是异步操作、修改 DOM 或更改其他状态。</p>
</li>
<li>
<p><strong>配置灵活</strong>：</p>
<ul>
<li><strong><code>immediate</code></strong>：设置为 <code>true</code> 时，在初始化时立即执行一次。</li>
<li><strong><code>deep</code></strong>：设置为 <code>true</code> 时，可以深度监听对象内部属性的变化。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2. Vue 3 + TS 示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref, watch } from 'vue';

interface UserInfo {
  name: string;
  age: number;
}

const user = ref&lt;UserInfo&gt;({ name: '张三', age: 25 });

// 监听对象深度变化
watch(
  user,
  (newVal, oldVal) =&gt; {
    // 注意：由于是引用类型，newVal 和 oldVal 指向的是同一个对象，只有开启deep: true才能监听到
    console.log('用户信息变了', newVal.age);
  },
  { 
    deep: true,      // 开启深度监听
    immediate: false // 初始化时不立即执行
  }
);
&lt;/script&gt;
</code></pre>
<hr/>
<h2 data-id="heading-7">三、 扩展：Vue 3 中的 WatchEffect</h2>
<p>在 Vue 3 中，除了 <code>watch</code>，还有一个更自动化的 <strong><code>watchEffect</code></strong>。</p>
<ul>
<li><strong>区别</strong>：<code>watchEffect</code> 不需要手动指定监听哪个属性，它会自动收集回调函数中用到的所有响应式变量。</li>
<li><strong>场景</strong>：当你需要在一个函数里用到多个响应式数据，且不关心旧值时，<code>watchEffect</code> 代码更简洁。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref, watchEffect } from 'vue';

const user = ref({ name: '张三', age: 25 });

// watchEffect 会自动追踪依赖
watchEffect(() =&gt; {
  console.log('watchEffect 监听 age:', user.value.age);
  // 自动收集 user.value.age 作为依赖
  // 当 age 变化时会自动执行
});
&lt;/script&gt;
</code></pre>
<hr/>
<h2 data-id="heading-8">四、 深度对比：我该选哪一个？</h2>



































<table><thead><tr><th><strong>特性</strong></th><th><strong>Computed (计算属性)</strong></th><th><strong>Watch (侦听器)</strong></th></tr></thead><tbody><tr><td><strong>主要功能</strong></td><td>生成一个新属性（派生状态）</td><td>响应数据变化并执行代码（副作用）</td></tr><tr><td><strong>缓存</strong></td><td><strong>有缓存</strong>，依赖不变不计算</td><td><strong>无缓存</strong>，变化即触发</td></tr><tr><td><strong>异步</strong></td><td><strong>不支持</strong>异步逻辑</td><td><strong>支持</strong>异步操作（如接口请求）</td></tr><tr><td><strong>代码结构</strong></td><td>必须有 <code>return</code></td><td>不需要 <code>return</code></td></tr><tr><td><strong>使用场景</strong></td><td>格式化数据、多值组合、性能优化</td><td>异步数据请求、手动操作 DOM、监听路由变化</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-Key唯一标识作用]]></title>    <link>https://juejin.cn/post/7601486204173664306</link>    <guid>https://juejin.cn/post/7601486204173664306</guid>    <pubDate>2026-02-01T11:45:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601486204173664306" data-draft-id="7601441475987472430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-Key唯一标识作用"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-02-01T11:45:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-Key唯一标识作用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:45:27.000Z" title="Sun Feb 01 2026 11:45:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在开发 Vue 列表渲染时，编辑器总是提醒我们“必须绑定 key”。很多人习惯性地填入 <code>index</code>。但你是否思考过：<code>key</code> 到底在底层起到了什么作用？为什么不合理的 <code>key</code> 会导致组件状态错乱甚至性能崩溃？</p>
<h2 data-id="heading-1">一、 :key 的核心作用：虚拟 DOM 的“导航仪”</h2>
<p>在 Vue 更新 DOM 时，其核心算法是 <strong>Diff 算法</strong>。<code>key</code> 的主要作用是<strong>更高效地更新虚拟 DOM</strong>。</p>
<h3 data-id="heading-2">1. 节点复用的关键</h3>
<p>Vue 会通过判断两个节点是否为“相同节点”，从而决定是<strong>销毁重建</strong>还是<strong>原地复用</strong>。 判断相同节点的必要条件包括：</p>
<ul>
<li><strong>元素类型</strong>与<strong>Key 值</strong> ：Vue判断两个节点是否相同时，主要判断两者的key和元素类型是否相等，因此如果不设置key且元素类型相同的话，它的值就是undefined（而undefined恒等于undefined），则vue可能永远认为这是两个相同节点，只能去做更新操作，从而尝试“原地复用”它们。</li>
</ul>
<blockquote>
<p><strong>提示</strong>：虚拟Dom与diff算法会在后续单独讲解</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">二、 为什么要绑定 Key？</h2>
<h3 data-id="heading-4">1. 不带 key（原地复用策略）</h3>
<p>当列表顺序被打乱时，Vue 不会移动 DOM 元素来匹配列表项的顺序，而是<strong>就地更新</strong>每个元素。</p>
<ul>
<li><strong>弊端</strong>：如果列表项包含有状态的子组件或受控输入框（如 <code>&lt;input&gt;</code>），原本属于 A 项的输入框内容会“残留”在 B 项的位置上，造成 UI 错乱。</li>
<li><strong>性能</strong>：导致频繁的属性更新和 DOM 操作，效率低下。</li>
</ul>
<h3 data-id="heading-5">2. 带有 key（精准匹配策略）</h3>
<p>有了 <code>key</code> 作为唯一标识，Vue 能根据 <code>key</code> 精准找到旧节点树中对应的节点。</p>
<ul>
<li><strong>优势</strong>：Vue 会移动元素而非重新渲染，极大减少了不必要的 DOM 操作，显著提升性能。</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、为什么不推荐使用 Index 作为 Key？</h2>
<p>这使用 <code>index</code> 在进行<strong>增删、排序</strong>操作时，如果在列表头部添加一个新子项时，原列表所有的子项index都会+1，这会让vue认为列表全改变了，需要全部重新生成，从而造成性能损耗。</p>
<h3 data-id="heading-7">示例：</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref } from 'vue'

interface User {
  id: number;
  name: string;
}

const users = ref&lt;User[]&gt;([
  { id: 1, name: '张三' },
  { id: 2, name: '李四' }
])

const insertUser = () =&gt; {
  // 在头部插入一条数据
  users.value.unshift({ id: Date.now(), name: '新同学' })
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;button @click="insertUser"&gt;头部插入数据&lt;/button&gt;
    &lt;ul&gt;
      &lt;li v-for="(item, index) in users" :key="index"&gt;
        {{ item.name }} &lt;input type="text" placeholder="输入评价" /&gt;
      &lt;/li&gt;
      
      &lt;hr /&gt;

      &lt;li v-for="item in users" :key="item.id"&gt;
        {{ item.name }} &lt;input type="text" placeholder="输入评价" /&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h2 data-id="heading-8">四、 总结</h2>
<ol>
<li><strong>唯一性</strong>：<code>key</code> 必须在当前循环层级中是唯一的，不能重复。</li>
<li><strong>稳定性</strong>：不要使用 <code>Math.random()</code> 作为 <code>key</code>，否则每次渲染都会强制销毁重建所有节点，性能极其低效。</li>
<li><strong>undefined 陷阱</strong>：如果不设置 <code>key</code>，它的值就是 <code>undefined</code>。在 Diff 对比时，Vue 会认为两个 <code>undefined</code> 节点是“相同”的，这正是导致频繁更新、影响性能的根源。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[月费 8 块的 AI 私人助手，不会写代码也能搭（OpenClaw 零基础教程）]]></title>    <link>https://juejin.cn/post/7601313474719645731</link>    <guid>https://juejin.cn/post/7601313474719645731</guid>    <pubDate>2026-02-01T11:53:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719645731" data-draft-id="7601355703239901224" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="月费 8 块的 AI 私人助手，不会写代码也能搭（OpenClaw 零基础教程）"/> <meta itemprop="keywords" content="AIGC,Agent,OpenAI"/> <meta itemprop="datePublished" content="2026-02-01T11:53:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            月费 8 块的 AI 私人助手，不会写代码也能搭（OpenClaw 零基础教程）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T11:53:42.000Z" title="Sun Feb 01 2026 11:53:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>后台留言里出现最多的一句话，不是"牛逼"，是这句：</p>
<p><strong>"看完很激动，但我连终端都不会打开……"</strong></p>
<p>说实话，这种小白不在少数。</p>
<p>我写了好几篇 OpenClaw 的文章，把 80 多个技能装了个遍，Skills 研究了 565 个。数据还行，阅读转发都不错。但我忽略了一个事实——</p>
<p><strong>我的读者里，有相当一部分不是程序员。</strong></p>
<p>运营、产品、自媒体人、独立创业者、甚至纯粹对 AI 感兴趣的学生——他们对 AI 助手充满好奇，但一看到"打开终端输入命令"就劝退了。</p>
<p>今天这篇，就是为你们写的。</p>
<p><strong>你不需要会写代码。不需要懂 Linux。甚至不需要打开终端。</strong></p>
<p>腾讯云已经把 OpenClaw 做成了一键部署模板——买服务器的时候勾一下，全程网页操作，填几个 Key 就搞定了。</p>
<p><strong>比注册一个新 App 还简单。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/054f03ba9c894fc8b0e31e470b8b196a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=S5Mu6uF3FVc4F6QNF7%2B4%2FjnIWMA%3D" alt="" loading="lazy"/></p>
<p>（我的私人助手小墨，已经有了自己的个人主页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaomo.dev%2F%25EF%25BC%2589" target="_blank" title="https://xiaomo.dev/%EF%BC%89" ref="nofollow noopener noreferrer">xiaomo.dev/）</a></p>
<hr/>
<h2 data-id="heading-0">01 先搞明白：这东西到底有什么用？</h2>
<p>如果你觉得"AI 助手"就是 ChatGPT 换了个皮肤，那你亏大了。</p>
<p>ChatGPT 是你问一句答一句，关掉网页它就不存在了。它不知道你昨天做了什么，不知道你明天有什么会议，不知道你正在焦虑什么项目。每次对话都从零开始。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9497ea645bab4d189a04fd15d78aeae0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=eBXoXxD%2F53g%2B06tpmuQpJwsjQr0%3D" alt="" loading="lazy"/></p>
<p>而一个真正的 AI 私人助手：</p>
<ul>
<li>
<p>你睡觉的时候，它帮你看邮件</p>
</li>
<li>
<p>开会前 2 小时，它主动提醒你准备材料</p>
</li>
<li>
<p>你上周提过的想法，它这周帮你跟进</p>
</li>
<li>
<p>它不需要你"去找它"——<strong>它会主动来找你</strong></p>
</li>
</ul>
<p>我的助手小墨，上线第一周就干了这些事：</p>
<ul>
<li>
<p>每天早上自动查 Gmail，把重要邮件摘要发到我手机</p>
</li>
<li>
<p>管理日历，发现时间冲突直接报警</p>
</li>
<li>
<p>监控 5 个网站的 SEO 数据，周报自动生成</p>
</li>
<li>
<p>帮我写代码、写初稿、Review PR</p>
</li>
</ul>
<p>以前这些事每天花我 2-3 小时。<strong>现在？0. 它自己干了。</strong></p>
<p>月成本 100 块左右，干了一个实习生的活儿，还不请假、不摸鱼、24 小时在线。</p>
<p><strong>你告诉我这笔账划不划算。</strong></p>
<hr/>
<h2 data-id="heading-1">02 你需要准备什么？</h2>
<p>别慌，门槛比你想的低得多：</p>
<p><strong>① 一台****云服务器</strong></p>
<p>腾讯云轻量应用服务器（Lighthouse）已经内置了 OpenClaw 应用模板——买的时候选一下，系统自动帮你装好，开箱即用。</p>
<ul>
<li>
<p>最低 <strong>¥99/年（≈¥8.25/月）</strong>：2 核 2G，完全够用</p>
</li>
<li>
<p>推荐 ¥199/年（2 核 4G），更宽裕</p>
</li>
<li>
<p>海外节点（新加坡等）也有，适合出海场景</p>
</li>
<li>
<p><strong>专属优惠链接：****<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fact%2Fpro%2Flighthouse-moltbot" target="_blank" title="https://cloud.tencent.com/act/pro/lighthouse-moltbot" ref="nofollow noopener noreferrer">OpenClaw 服务器优惠</a></strong></p>
</li>
</ul>
<p><strong>② 一个聊天平台账号</strong></p>
<p>你的 AI 助手需要通过一个聊天工具跟你对话。腾讯云的配置面板直接支持：</p>
<ul>
<li>
<p><strong>QQ</strong> — 国内最方便，大家都有</p>
</li>
<li>
<p><strong>企业微信</strong> — 适合工作场景</p>
</li>
<li>
<p><strong>飞书</strong> — 适合团队协作</p>
</li>
<li>
<p><strong>钉钉</strong> — 同上</p>
</li>
<li>
<p><strong>Telegram</strong> <strong>/ Discord / WhatsApp</strong> — 海外用户首选</p>
</li>
</ul>
<p><strong>③ 一个 AI 模型的"钥匙</strong>**"（**<strong>API</strong> <strong>Key）</strong></p>
<p>腾讯云配置面板直接支持这些国内模型：</p>
<ul>
<li>
<p><strong>腾讯混元</strong> — 腾讯自家模型</p>
</li>
<li>
<p><strong>腾讯云 DeepSeek</strong> — 通过腾讯云调用 DeepSeek，稳定好用</p>
</li>
<li>
<p><strong>通义千问（Qwen）</strong> — 阿里出品</p>
</li>
<li>
<p><strong>Moonshot Kimi</strong> — 国产最强之一</p>
</li>
<li>
<p><strong>智谱（<strong><strong>GLM</strong></strong>）</strong> — 清华技术底座</p>
</li>
<li>
<p><strong>豆包</strong> — 字节出品</p>
</li>
</ul>
<blockquote>
<p>💡 推荐新手先用<strong>腾讯云 DeepSeek</strong>，在腾讯云控制台直接创建 API Key，一步到位，不用跑到别的平台注册。</p>
</blockquote>
<p><strong>④ 30 分钟</strong></p>
<p>就这些。<strong>不需要装开发工具，不需要学编程，甚至不需要打开终端。</strong></p>
<blockquote>
<p>💰 <strong>全程费用</strong>：服务器最低 ¥8.25/月 + AI 模型按量付费（日常几块钱）≈ <strong>一杯奶茶的钱</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">03 术语翻译（一分钟看完，后面就不慌了）</h2>
<p>我知道你最怕满屏幕看不懂的名词。这里一次性"翻译"成人话：</p>
<ul>
<li>
<p><strong>服务器</strong> → 一台 24 小时不关机的远程电脑</p>
</li>
<li>
<p><strong>应用模板</strong> → 买服务器时帮你预装好软件，你不用自己装</p>
</li>
<li>
<p><strong>API</strong> <strong>Key</strong> → 一把钥匙，让你的助手能调用 AI 大模型的能力</p>
</li>
<li>
<p><strong>Channel</strong> → 聊天渠道，就是你通过什么 App 跟助手对话（QQ/企微/飞书等）</p>
</li>
<li>
<p><strong>控制台</strong> → 腾讯云的网页管理界面，在浏览器里操作一切</p>
</li>
</ul>
<p><strong>看完了？恭喜，你已经比 90% 说"我不懂技术"的人强了。</strong></p>
<hr/>
<h2 data-id="heading-3"><strong>04 第一步：买服务器 + 自动安装 OpenClaw（5 分钟）</strong></h2>
<ol>
<li>
<p>打开 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fact%2Fpro%2Flighthouse-moltbot" target="_blank" title="https://cloud.tencent.com/act/pro/lighthouse-moltbot" ref="nofollow noopener noreferrer">OpenClaw 专属优惠页</a></strong>，微信扫码登录</p>
</li>
<li>
<p>选择套餐（推荐 ¥99/年 的 2 核 2G 起步）</p>
</li>
<li>
<p><strong>应用模板选择</strong>：AI 智能体 → <strong>OpenClaw （Clawdbot）</strong></p>
</li>
<li>
<p>地域按需选（接 QQ 选国内，接 Discord/Telegram 选海外）</p>
</li>
<li>
<p>点"立即购买"，微信支付</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcbfe9fafbdc4060a1c71a37808e3ad6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=9ATVCSWhk0su3zy0Y4gr81uSPFM%3D" alt="" loading="lazy"/></p>
<p><strong>买完就装好了。</strong> 不需要你登录服务器，不需要敲任何命令。</p>
<hr/>
<h2 data-id="heading-4">05 第二步：配置 AI 模型（5 分钟）</h2>
<p>在腾讯云控制台找到你刚买的服务器，进入 <strong>"应用管理"</strong> 页签——你会看到一个可视化的配置面板。</p>
<p><strong>配置模型</strong> <strong>API</strong> <strong>Key：</strong></p>
<p>以腾讯云 DeepSeek 为例：</p>
<ol>
<li>
<p>点击 <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Flkeap%2Fapi" target="_blank" title="https://console.cloud.tencent.com/lkeap/api" ref="nofollow noopener noreferrer">API Key 管理页</a>，创建一个 API Key</p>
</li>
<li>
<p>复制 Key</p>
</li>
<li>
<p>回到服务器的应用管理面板，粘贴进"模型配置"输入框</p>
</li>
<li>
<p>点"应用"保存</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c7d7450682d46b18b6876e521805b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=XkbUK8bcmVVyqV5Nu3ywHxyDjXg%3D" alt="" loading="lazy"/></p>
<p><strong>全程网页操作，不碰命令行。</strong></p>
<hr/>
<h2 data-id="heading-5">06 第三步：接入聊天平台（5 分钟）</h2>
<p>同样在应用管理面板里，找到 <strong>"Channel</strong> <strong>配置"</strong>。</p>
<p>以 QQ 为例：</p>
<ol>
<li>
<p>去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fq.qq.com%2F" target="_blank" title="https://q.qq.com/" ref="nofollow noopener noreferrer">QQ 开放平台</a> 创建一个机器人，拿到 App ID 和 App Secret</p>
</li>
<li>
<p>粘贴到面板对应的输入框</p>
</li>
<li>
<p>点"应用"保存</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62a65da2aca94899bc6a9b2d1e325d37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=9P%2BZuVL0PhfhWzTwdFFzHOsPQpY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>📱 <strong>企业微信、<strong><strong>飞书</strong></strong>、钉钉</strong> 的接入方式类似——在对应平台创建机器人，拿到 Key，粘贴到面板里。详细步骤可参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2624973" target="_blank" title="https://cloud.tencent.com/developer/article/2624973" ref="nofollow noopener noreferrer">腾讯云 OpenClaw 接入教程合集</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">07 发送你的第一条消息</h2>
<p>配置完成后，打开你选择的聊天平台（QQ / 企微 / 飞书……），找到你的 AI 机器人，发一句：</p>
<p><strong>"你好"</strong></p>
<p>等几秒。你会收到回复。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d5a9edba0f046a8aff49dae6c7174f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=fPnSfX2abdai%2BJpAW0DDYpss6dA%3D" alt="" loading="lazy"/></p>
<p><strong>就这样。</strong></p>
<p>你拥有了一个跑在云端、24 小时在线的 AI 私人助手。</p>
<p>全程没写一行代码。没打开过终端。没看过一行报错。</p>
<p><strong>在网页上点了几下、粘贴了几个 Key，搞定了。</strong></p>
<hr/>
<h2 data-id="heading-7">08 然后呢？</h2>
<p>现在的助手还是"出厂模式"——能聊天，但不认识你，也不会主动干活。就像一个刚入职的天才实习生，能力很强但不知道你要啥。</p>
<p>接下来你可以：</p>
<p><strong>给它一个灵魂</strong> — 定义它的性格和说话方式。想让它像一只话唠的猫？一个冷静的管家？随你。</p>
<p><strong>给它装技能</strong> — 天气查询、Gmail 管理、日历提醒、SEO 分析……社区有 500+ 现成技能，一条命令就能装。</p>
<p><strong>让它主动工作</strong> — 设置心跳机制，让它定期检查邮件、日历、数据。你不用管，它自己来。</p>
<p>我和我的 AI 助手小墨一起写了一份 <strong>3 万字的完整指南</strong>，从 Day 1 到 Day 7，覆盖灵魂定制、技能安装、邮件日历接入、心跳机制、定时任务……手把手带你从"能说话"一路升级到"能干活"。<strong>全部免费，直接看：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8016a9c2d2b4a6caa7415017c85f72e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770551621&amp;x-signature=CSM2etPxTpaaU4ikMFalfCI58hU%3D" alt="" loading="lazy"/></p>
<p>👉 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmy.feishu.cn%2Fwiki%2FYkWgwqSchi9xW3kEuZscAm0lnFf" target="_blank" title="https://my.feishu.cn/wiki/YkWgwqSchi9xW3kEuZscAm0lnFf" ref="nofollow noopener noreferrer">小墨 AI 助手 — OpenClaw 7天搭建指南</a></strong></p>
<hr/>
<h2 data-id="heading-8">写在最后</h2>
<p>我写这篇之前犹豫过——会不会太基础了？程序员读者会不会觉得"这也要教"？</p>
<p>后来想通了。</p>
<p><strong>技术不该是门槛，而是工具。工具的意义就在于让更多人用得上。</strong></p>
<p>OpenClaw 的意义恰恰在于——它把"拥有一个 AI 助手"这件原本属于极客圈的事，变成了所有人都能做的事。腾讯云把它做成了应用模板，买个服务器勾一下就装好，网页上配几个 Key 就能用。</p>
<p><strong>你不需要成为程序员，才能让 AI 替你工作。</strong></p>
<p>说句可能被喷的话：<strong>我觉得不出一年，没有自己 AI 助手的人，会被有 AI 助手的人在效率上甩开一个量级。</strong></p>
<p>不是因为 AI 本身多神奇。而是那些"每天省下 2 小时"的人，把这 2 小时拿去做了更重要的事。日积月累，差距就是这么拉开的。</p>
<p>工具就在这里。一杯奶茶的钱。网页上点几下。</p>
<p><strong>你还在等什么？</strong></p>
<hr/>
<blockquote>
<p>🚀 想和更多 AI 助手玩家交流？可以通过主页与我联系。</p>
</blockquote>
<hr/>
<hr/>
<p>想看更多干货？欢迎关注我，个人简介有完整资源汇总 📋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-插槽 (Slot) 的多种高级玩法]]></title>    <link>https://juejin.cn/post/7601843004957966382</link>    <guid>https://juejin.cn/post/7601843004957966382</guid>    <pubDate>2026-02-01T12:00:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601843004957966382" data-draft-id="7601444617695084554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-插槽 (Slot) 的多种高级玩法"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-02-01T12:00:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-插槽 (Slot) 的多种高级玩法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T12:00:16.000Z" title="Sun Feb 01 2026 12:00:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在组件化开发中，<strong>插槽 (Slot)</strong> 是实现内容分发（Content Distribution）的核心机制。它允许我们将组件的“外壳”与“内容”解耦，让组件具备极高的扩展性。</p>
<h2 data-id="heading-1">一、 什么是插槽？</h2>
<p>插槽是子组件提供给父组件的 <strong>“占位符”</strong> ，用 <code>&lt;slot&gt;&lt;/slot&gt;</code> 标签表示。父组件传递的任何模板代码（HTML、组件等）都会替换子组件中的 <code>&lt;slot&gt;</code> 标签。</p>
<hr/>
<h2 data-id="heading-2">二、 插槽的三大类型</h2>
<h3 data-id="heading-3">1. 默认插槽 (Default Slot)</h3>
<p>最基础的插槽，不需要定义 <code>name</code> 属性。</p>
<ul>
<li><strong>特点</strong>：一个子组件通常只建议使用一个默认插槽。</li>
</ul>
<h4 data-id="heading-4">示例：</h4>
<pre><code class="hljs language-vue" lang="vue"> &lt;!-- 子组件 --&gt;
  &lt;template&gt;
    &lt;div class="card"&gt;
      &lt;div class="card-title"&gt;通用卡片标题&lt;/div&gt;
      &lt;div class="card-content"&gt;
        &lt;slot&gt; 这里是默认的填充文本 &lt;/slot&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/template&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue"> &lt;!-- 父组件 --&gt;
  &lt;template&gt;
    &lt;div class="app"&gt;
      &lt;MyCard&gt; 这是我传递给卡片的具体内容。 &lt;/MyCard&gt;
    &lt;/div&gt;
  &lt;/template&gt;
</code></pre>
<h3 data-id="heading-5">2. 具名插槽 (Named Slots)</h3>
<p>当子组件需要多个占位符时，通过 <code>name</code> 属性来区分。</p>
<ul>
<li><strong>语法糖</strong>：<code>v-slot:header</code> 可以简写为 <strong><code>#header</code></strong>。</li>
</ul>
<h4 data-id="heading-6">示例：</h4>
<pre><code class="hljs language-vue" lang="vue"> &lt;!-- 子组件:LayoutComponent.vue --&gt;
&lt;template&gt;
  &lt;div class="layout"&gt;
    &lt;header class="header"&gt;
      &lt;slot name="header"&gt;&lt;/slot&gt;
    &lt;/header&gt;
    
    &lt;main class="content"&gt;
      &lt;slot&gt;&lt;/slot&gt; 
    &lt;/main&gt;
    
    &lt;footer class="footer"&gt;
      &lt;slot name="footer"&gt;&lt;/slot&gt;
    &lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
 &lt;!-- Vue 3 Composition API 模式下，逻辑部分可以保持简洁 --&gt;
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue" lang="vue"> &lt;!-- 父组件使用示例 --&gt;
&lt;template&gt;
  &lt;LayoutComponent&gt;
    &lt;template #header&gt;
      &lt;h1&gt;页面标题&lt;/h1&gt;
      &lt;nav&gt;导航菜单&lt;/nav&gt;
    &lt;/template&gt;
    
    &lt;p&gt;这是主体内容，将填充到默认插槽中...&lt;/p&gt;
    
    &lt;template #footer&gt;
      &lt;p&gt;版权信息 &amp;copy; 2026&lt;/p&gt;
    &lt;/template&gt;
  &lt;/LayoutComponent&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import LayoutComponent from './LayoutComponent.vue';
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-7">3. 作用域插槽 (Scoped Slots)</h3>
<p><strong>核心价值</strong>： <strong>“子传父”</strong> 的特殊形式。子组件将内部数据绑定在 <code>&lt;slot&gt;</code> 上，父组件在填充内容时可以接收并使用这些数据。</p>
<h4 data-id="heading-8">示例：</h4>
<pre><code class="hljs language-vue" lang="vue"> &lt;!-- 子组件：`UserList.vue` --&gt;
&lt;template&gt;
  &lt;ul&gt;
    &lt;li v-for="user in users" :key="user.id"&gt;
      &lt;slot :user="user" :index="user.id"&gt;
        {{ user.name }}
      &lt;/slot&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
interface User {
  id: number;
  name: string;
  role: string;
}

const users: User[] = [
  { id: 1, name: '张三', role: '管理员' },
  { id: 2, name: '李四', role: '开发者' }
];
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-xml" lang="xml"> <span class="hljs-comment">&lt;!-- 父组件使用示例 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ user }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ color: user.role === '管理员' ? 'red' : 'blue' }"</span>&gt;</span>
        {{ user.name }} - 【{{ user.role }}】
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">UserList</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">三、 补充：插槽的默认内容</h2>
<p>在子组件中，你可以在 <code>&lt;slot&gt;</code> 标签内部放置内容。如果父组件<strong>没有</strong>提供任何插槽内容，则会渲染这些“后备内容”；如果提供了，则会被覆盖。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;slot&gt;这是如果没有内容时显示的默认文本&lt;/slot&gt;
</code></pre>
<hr/>
<h2 data-id="heading-10">四、 总结：如何选择插槽？</h2>





















<table><thead><tr><th><strong>插槽类型</strong></th><th><strong>使用场景</strong></th></tr></thead><tbody><tr><td><strong>默认插槽</strong></td><td>组件只有一个扩展点时使用。</td></tr><tr><td><strong>具名插槽</strong></td><td>组件有多个固定区域（如 Header/Main/Footer）需要自定义时使用。</td></tr><tr><td><strong>作用域插槽</strong></td><td>需要根据子组件的内部数据来决定父组件渲染样式的场景（如列表展示）。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw 远程浏览器使用指南：从入门到踩坑]]></title>    <link>https://juejin.cn/post/7600986495927386153</link>    <guid>https://juejin.cn/post/7600986495927386153</guid>    <pubDate>2026-01-31T02:52:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600986495927386153" data-draft-id="7600989427906101302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw 远程浏览器使用指南：从入门到踩坑"/> <meta itemprop="keywords" content="OpenAI,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-31T02:52:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只会飞的旺旺"/> <meta itemprop="url" content="https://juejin.cn/user/1151943915355965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw 远程浏览器使用指南：从入门到踩坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943915355965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只会飞的旺旺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T02:52:26.000Z" title="Sat Jan 31 2026 02:52:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这两天看公众号都是安装教程,也没看到其他使用上的问题, 我来分享一下我的一些使用经验吧!</p>
<p>这几天晚上经常用OpenClaw 帮我操作点东西，结果发现浏览器又连不上了。重启 Gateway 后，我又得打开 Chrome，手动点击那个 Browser Relay 插件的图标, 这大冬天的,谁愿意起来碰电脑啊, 这让我苦恼不已!</p>
<h2 data-id="heading-0">简单介绍</h2>
<p>OpenClaw（前身为 Clawdbot/Moltbot）是一款强大的 AI 助手框架，其浏览器自动化功能让 AI 能够"看见"并"操作"网页。本文将深入介绍 OpenClaw 的远程浏览器功能——特别是 Chrome Extension Relay 模式，以及我在使用过程中遇到的问题和解决方案。至于为嘛不用内置的浏览器功能,因为启动一个chrome我的小服务器就快顶不住了!</p>
<h2 data-id="heading-1">什么是 Browser Relay？</h2>
<p>OpenClaw 提供了两种浏览器控制模式：</p>
<ol>
<li><strong>Managed Browser（托管浏览器）</strong> ：OpenClaw 启动一个独立的 Chrome 实例，完全隔离于你的日常浏览器</li>
<li><strong>Extension Relay（扩展中继）</strong> ：通过 Chrome 扩展控制你<strong>现有的 Chrome 标签页</strong></li>
</ol>
<p>Extension Relay 的核心价值在于：你可以让 AI 操作你已经登录的网页、正在浏览的内容，而不需要重新在隔离环境中登录。</p>
<h3 data-id="heading-2">架构解析</h3>
<p>Browser Relay 由三个核心组件构成：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d1747f220744a1f82161209e2101069~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=T%2BMnWSN9LTqj7U35Mxpa2MDMUoQ%3D" alt="photo_2026-01-31_10-38-03" loading="lazy"/></p>
<h2 data-id="heading-3">安装与配置</h2>
<blockquote>
<p>官方教程: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Ftools%2Fchrome-extension" target="_blank" title="https://docs.openclaw.ai/tools/chrome-extension" ref="nofollow noopener noreferrer">docs.openclaw.ai/tools/chrom…</a></p>
</blockquote>
<h3 data-id="heading-4">1. 安装 Chrome 扩展</h3>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># 安装扩展到稳定路径</span>
openclaw <span class="hljs-built_in">browser</span> extension install

<span class="hljs-comment"># 查看扩展目录路径</span>
openclaw <span class="hljs-built_in">browser</span> extension path
</code></pre>
<p>然后将这个文件夹下载下来：</p>
<ol>
<li>打开其他电脑上的Chrome → <code>chrome://extensions</code></li>
<li>启用"开发者模式"</li>
<li>点击"加载已解压的扩展程序"</li>
<li>选择上面命令输出的目录</li>
<li>将扩展图标固定到工具栏</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5707ad43911e40708d63fe140038bf8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=%2FRrGnbKLzbv5PgAhGEOjZLjTaK4%3D" alt="image-20260131101205040" loading="lazy"/></p>
<h3 data-id="heading-5">2. 配置文件详解</h3>
<p>在 <code>~/.openclaw/openclaw.json</code> 中：</p>
<p>我这块因为用的是SSH隧道的方案,所以直接采用的默认的配置,只设置了几个参数,如下图!</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed7711d534c4204a4fabda1ba3c6c03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=gL4Pnpok3s8y7BBChG42G4TxRcc%3D" alt="image-20260131101429790" loading="lazy"/></p>
<h3 data-id="heading-6">3.插件配置</h3>
<p>这里需要用命令创建SSH隧道,因为我安装openclaw时用的默认配置,都是监听的127.0.0.1,外网是无法访问这些端口的.可以在电脑上运行以下命令建立隧道! 不过这个需要一直保持cmd窗口开启,你可以让AI给你写一个后台启动的方案!</p>
<blockquote>
<p>ssh -L 18792:127.0.0.1:18792 root@服务器IP</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5635cda2d1c4cb6b32d1546e369820f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=uz8s%2BbmAZfNAvbO%2FyRv0uaqgDTU%3D" alt="image-20260131101956940" loading="lazy"/></p>
<h3 data-id="heading-7">徽章状态说明</h3>





















<table><thead><tr><th>徽章</th><th>含义</th></tr></thead><tbody><tr><td><code>ON</code></td><td>已附加，OpenClaw 可以控制该标签页</td></tr><tr><td><code>…</code></td><td>正在连接到本地中继</td></tr><tr><td><code>!</code></td><td>中继不可达（最常见：本地未运行浏览器中继服务）</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3191911aa534f5299922aae8270bb8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=mVKmlTH2UqPZolWFQc5lxEPyQGA%3D" alt="image-20260131101458972" loading="lazy"/></p>
<h2 data-id="heading-8">常见问题</h2>
<p>使用过程中遇到了下面几个问题,可能2026.1.29 版本的浏览器插件已经更新修复了,若没有修复,你可以用我优化后的插件.我的这个需要在你工作区tools.md中强调一下!</p>
<blockquote>
<p>PS: 其实只要能和AI对话,这些都能让他给你慢慢排查!</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c024941472d74a2fad1cc76ce1640586~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Lya6aOe55qE5pe65pe6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770432745&amp;x-signature=1%2F%2F22N0Ub409tNzA6fh8Vhl4iP8%3D" alt="image-20260131102602420" loading="lazy"/></p>
<h3 data-id="heading-9">问题 1："tab not found" 错误</h3>
<p><strong>现象</strong>：<code>tabs</code> 命令能正确列出标签页，但 <code>screenshot</code> 或 <code>snapshot</code> 报错 <code>Error: tab not found</code></p>
<p><strong>环境示例</strong>：</p>
<ul>
<li>Gateway 运行在云服务器 (Linux)</li>
<li>Chrome + 扩展运行在 Windows 主机</li>
<li>中继可达（<code>cdpReady: true</code>）</li>
</ul>
<p><strong>根本原因</strong>： 当多个标签页同时附加时，它们共享同一个 WebSocket URL (<code>ws://127.0.0.1:18792/cdp</code>)，Playwright 在解析目标时无法确定应该操作哪个标签页。</p>
<p><strong>临时解决方案</strong>（社区验证有效）：</p>
<p>一次只附加一个标签页：</p>
<ol>
<li>在标签页 1 上点击扩展图标关闭（OFF）</li>
<li>在标签页 2 上点击扩展图标开启（ON）</li>
<li>执行截图/快照操作</li>
<li>按需切换</li>
</ol>
<p><strong>官方修复</strong>： 在 2026.1.29 版本中，开发团队添加了 <strong>URL 匹配回退机制</strong>：</p>
<blockquote>
<p>"Browser: fall back to URL matching for extension relay target resolution. (#1999)"</p>
</blockquote>
<p>当 CDP session 方式失败时，系统会尝试通过 URL 匹配来定位页面。</p>
<h3 data-id="heading-10">问题 2：cdpReady: false</h3>
<p><strong>现象</strong>：状态显示 <code>cdpReady: false</code>，无法执行快照操作</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"running"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cdpReady"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cdpHttp"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tabs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<p>这个问题在 Issue #1160 中已修复（commit <code>6c3a9fc</code> - "fix: handle extension relay session reuse"）。</p>
<p>如果你使用的是 2026.1.23-1 或更早版本，建议：</p>
<ol>
<li>升级到最新版本：<code>npm install -g openclaw@latest</code></li>
<li>或从 GitHub 主分支安装</li>
</ol>
<h3 data-id="heading-11">问题 3：扩展模式恢复问题</h3>
<p><strong>现象</strong>：扩展附加后，过一段时间操作失败</p>
<p><strong>修复</strong>：在 2026.1.15 版本中已修复：</p>
<blockquote>
<p>"Browser: extension mode recovers when only one tab is attached (stale targetId fallback)."</p>
<p>"Browser: fix <code>tab not found</code> for extension relay snapshots/actions when Playwright blocks <code>newCDPSession</code> (use the single available Page)."</p>
</blockquote>
<h3 data-id="heading-12">问题 4：Sandbox 会话中的浏览器控制</h3>
<p><strong>现象</strong>：在 sandbox 模式下无法使用扩展中继</p>
<p><strong>原因</strong>：Sandbox 会话默认 <code>target="sandbox"</code>，而扩展中继需要控制 host 浏览器</p>
<p><strong>解决方案</strong>：</p>
<p>方案 A：在非 sandbox 会话中使用扩展</p>
<p>方案 B：在配置中允许 host 浏览器控制：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sandbox"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"browser"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"allowHostControl"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后在调用 browser 工具时指定 <code>target="host"</code>。</p>
<h2 data-id="heading-13">总结</h2>
<p>OpenClaw 的 Browser Relay 功能为 AI 助手提供了强大的网页自动化能力。虽然早期版本存在一些稳定性问题（特别是多标签页场景），但开发团队已经在最新版本中修复了大部分问题。</p>
<p><strong>最佳实践</strong>：</p>
<ol>
<li>保持 OpenClaw 更新到最新版本</li>
<li>一次只附加一个标签页（直到多标签页支持完全稳定）</li>
<li>使用专用 Chrome Profile 进行自动化操作</li>
<li>通过 ssh隧道 保护远程访问</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比黄金暴跌更难过的是 Vue 3.6 构建工具全线换成 Rolldown 了😰]]></title>    <link>https://juejin.cn/post/7600989427906199606</link>    <guid>https://juejin.cn/post/7600989427906199606</guid>    <pubDate>2026-01-31T03:41:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600989427906199606" data-draft-id="7601028900886609966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比黄金暴跌更难过的是 Vue 3.6 构建工具全线换成 Rolldown 了😰"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T03:41:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VaJoy"/> <meta itemprop="url" content="https://juejin.cn/user/800100193674760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比黄金暴跌更难过的是 Vue 3.6 构建工具全线换成 Rolldown 了😰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/800100193674760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VaJoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T03:41:32.000Z" title="Sat Jan 31 2026 03:41:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    177
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在尝试解析 Vue 3.6 的源码，前些天从底层构建系统着手，辛辛苦苦分析了 Vue 是如何通过 Rollup 和 esbuild 来分别构建出生产环境、开发环境产物的，并精心沉淀出了第一篇技术文章。</p>
<p>今天一看天塌了 ———— Vue 3.6 beta5 开始把全线构建工具统一为了 <a href="https://link.juejin.cn?target=https%3A%2F%2Frolldown.rs%2F" target="_blank" title="https://rolldown.rs/" ref="nofollow noopener noreferrer">Rolldown</a>，所有构建相关的脚本均被改写，意味着我之前案牍劳形进行的分析、写的文章好像打了水漂。</p>
<p>这简直比黄金暴跌更让我心疼！！（因为我其实也没买）。</p>
<blockquote>
<p>官方改动具体见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Fcommit%2F7da7615fb68c28433006f748100a99937133d809" target="_blank" title="https://github.com/vuejs/core/commit/7da7615fb68c28433006f748100a99937133d809" ref="nofollow noopener noreferrer">Commit - build: use rolldown</a>。</p>
</blockquote>
<p>Rolldown 目前处于 RC 预发布候选版本，所以没预料到 Vue 这么快就将其应用在源码构建上，盲猜其原因为：</p>
<ul>
<li>Rolldown 在 Vite 生态内部已经经历了较长时间的真实项目验证，官方团队对其成熟度相对有信心，得以进一步推进到 Vue 源码仓库中集成使用。</li>
<li>Rolldown 是使用 Rust 编写的现代化打包器，据称在性能上会比 Rollup 快 10～30 倍。</li>
<li>Rollup 的模块图主要面向「一次性构建」设计，缺乏面向长期运行进程的增量构建能力（这是之前为何要使用 esbuild 作为开发环境构建工具的原因）；而 Rolldown 把模块图视为长期驻留的一等公民，从架构层面支持精确失效与增量重建，得以适配开发态的高频变更场景。</li>
<li>开发环境和构建环境统一只使用一套「构建底座」，可以大幅提升构建配置和脚本的一致性，例如不同的需求（例如占位符替换）不再需要配套不同的构建插件，进而大幅降低维护成本。</li>
</ul>
<p>对此个人很欣赏 Vue 与时俱进的态度，也期待 3.6 正式版本能早日顺利发布。</p>
<p>最后贴下 Rollup 搭配 esbuild 的「老款」构建系统解析文章，还是可以帮助大家了解 Vue 项目底层构建的流程和原理。</p>
<hr/>
<p><em><strong>《Vue 3.6 beta 4 源码解析 —— 项目结构和构建雏形 Pt.1》</strong></em></p>
<blockquote>
<p>本文基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Ftree%2Fv3.6.0-beta.4" target="_blank" title="https://github.com/vuejs/core/tree/v3.6.0-beta.4" ref="nofollow noopener noreferrer">Vue 3.6 beta 4</a> 版本。</p>
<p>本文案例源码可在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVaJoy%2Fvue-3.6-source-analysis%2Ftree%2F1.1.1%2Fvue" target="_blank" title="https://github.com/VaJoy/vue-3.6-source-analysis/tree/1.1.1/vue" ref="nofollow noopener noreferrer">Github 仓库（Tag 1.1.1）</a> 上获取。</p>
</blockquote>
<p>Vue 3.6 的源码并不是一个单体项目，而是一个高度模块化、工程化的系统。在正式深入分析各个核心模块之前，如果不先理解其整体的项目结构与工程形态，很容易在阅读源码时陷入局部实现细节，而缺乏对整体设计与模块协作关系的把握。</p>
<p>作为本专栏的开篇，本文将从工程视角出发，介绍并讨论 Vue 3.6 的项目结构雏形与构建技术选型，并实现一个最基础的工程化方案。</p>
<h2 data-id="heading-0">1、项目初始化</h2>
<p>我们创建一个名为 <code>vue</code> 的文件夹作为源码项目，执行 <code>pnpm init</code> 进行初始化、生成 <code>package.json</code> 文件。</p>
<p>Vue 源码项目是严格要求使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Finstallation%23using-npm" target="_blank" title="https://pnpm.io/installation#using-npm" ref="nofollow noopener noreferrer">pnpm</a> 来作为包管理器的，我们可以在 <code>package.json</code> 的 <code>script</code> 字段添加 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fscripts%23npm-ci" target="_blank" title="https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-ci" ref="nofollow noopener noreferrer"><code>preinstall</code></a> 钩子指令，在使用者通过包管理器安装项目依赖时，能自动检查并确保项目只能使用 pnpm 作为包管理器：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"vue"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"preinstall"</span>: <span class="hljs-string">"npx only-allow pnpm"</span>    <span class="hljs-comment">// 确保项目只能使用 pnpm 作为包管理器</span>
  },
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"MIT"</span>
}
</code></pre>
<p>其中 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fonly-allow" target="_blank" title="https://github.com/pnpm/only-allow" ref="nofollow noopener noreferrer">only-allow</a> 是 pnpm 官方提供的一个检测工具，可以检测当前项目是否使用了指定的包管理器（若不符合条件会<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fonly-allow%2Fblob%2Fmaster%2Fbin.js%23L24" target="_blank" title="https://github.com/pnpm/only-allow/blob/master/bin.js#L24" ref="nofollow noopener noreferrer">报错并强行退出程序</a>）。</p>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fusing-npm%2Fscripts%23npm-ci" target="_blank" title="https://docs.npmjs.com/cli/v8/using-npm/scripts#npm-ci" ref="nofollow noopener noreferrer"><code>preinstall</code></a> 钩子中，我们通过 <code>npx only-allow pnpm</code> 来确保项目只能使用 pnpm 作为包管理器。</p>
<blockquote>
<p>💡 Vue 是基于 Monorepo 架构来维护各模块的，而 pnpm 对 Monorepo 有很好的支持，我们会在后文了解到这一点。</p>
</blockquote>
<h2 data-id="heading-1">2、Monorepo</h2>
<h3 id="user-content-md-monorepo" data-id="heading-2">2.1 Vue 中的 Monorepo</h3>
<p>在业务项目中，我们可以通过 <code>npm install vue</code> <a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fquick-start.html%23creating-a-vue-application" target="_blank" title="https://vuejs.org/guide/quick-start.html#creating-a-vue-application" ref="nofollow noopener noreferrer">等方式</a>来下载和使用 Vue，不过 Vue 除了这个覆盖完整功能的 npm 包，还提供了多个独立的核心子模块包，每个包都有其特定的功能和作用：</p>
<ul>
<li><code>@vue/shared</code>：Vue 3 中被各模块共享的工具函数模块。</li>
<li><code>@vue/reactivity</code>：Vue 3 的响应式模块。</li>
<li><code>@vue/compiler-core</code>：Vue 3 的模板编译核心模块。</li>
<li><code>@vue/compiler-dom</code>：Vue 3 的 DOM 编译模块。</li>
<li><code>@vue/runtime-core</code>：Vue 3 的运行时核心模块。</li>
<li>...</li>
</ul>
<p>例如你可以在业务项目中独立下载 Vue 的响应式模块 <code>@vue/reactivity</code>：</p>
<pre><code class="hljs language-bash" lang="bash">npm install @vue/reactivity
</code></pre>
<p>并在项目中使用它：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/reactivity'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">'hi'</span> })
</code></pre>
<p>此举仅会下载 <code>@vue/reactivity</code> 模块（及其依赖模块）的代码，而不会下载 Vue 的所有模块。</p>
<p>然而 Vue 并没有给每个核心子模块都独立创建一个 Git 仓库，而是将它们统一放在 Vue 源码项目的 <code>packages</code> 文件夹下进行维护：</p>
<pre><code class="hljs language-js" lang="js">vue
├── packages
│   ├── shared
│   ├── reactivity
│   ├── compiler-core
│   ├── compiler-dom
│   ├── runtime-core
│   ├── ...
</code></pre>
<p>此类「单仓库多模块」的架构形式，被称为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FMonorepo" target="_blank" title="https://en.wikipedia.org/wiki/Monorepo" ref="nofollow noopener noreferrer">Monorepo</a> 。</p>
<h3 data-id="heading-3">2.2 以 <code>shared</code> 为例的模块结构</h3>
<p>以「共享工具函数模块」<code>shared</code> 为例，其目录结构 <code>packages/shared</code> 非常简练：</p>
<pre><code class="hljs language-js" lang="js">vue
├── packages
│   ├── shared
│   │   ├── src           <span class="hljs-comment">// 存放实际源码</span>
│   │   │   ├── general.<span class="hljs-property">ts</span>
│   │   │   ├── makeMap.<span class="hljs-property">ts</span>
│   │   │   ├── ...
│   │   │   └── index.<span class="hljs-property">ts</span>
│   │   ├── package.<span class="hljs-property">json</span>  <span class="hljs-comment">// npm 包配置</span>
│   │   └── index.<span class="hljs-property">ts</span>      <span class="hljs-comment">// 包入口</span>
</code></pre>
<h4 data-id="heading-4">src 文件夹</h4>
<p><code>shared/src</code> 文件夹用于存放 <code>shared</code> 模块实际的源码文件，源码文件会按功能维度拆分成多个子模块。</p>
<p>简单起见，我们目前只实现 <code>shared/src/general.ts</code> 和 <code>shared/src/makeMap.ts</code> 两个功能子模块，它们的代码如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/makeMap.ts **/</span>

<span class="hljs-comment">/**
 * 把一个用逗号分隔的字符串（例如 "a,b,c" ）预处理成一个“成员判断函数”，
 * 用于在运行时高频地判断某个 key 是否属于某个固定集合。
 * 
 * 示例：
 * const isHTMLTag = makeMap('div,span,p')
 * isHTMLTag('div') // true
 * isHTMLTag('a')   // false
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeMap</span>(<span class="hljs-params">str: string</span>): <span class="hljs-function">(<span class="hljs-params">key: string</span>) =&gt;</span> boolean {
  <span class="hljs-keyword">const</span> map = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> str.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)) map[key] = <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> val <span class="hljs-keyword">in</span> map
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/general.ts **/</span>

<span class="hljs-keyword">import</span> { makeMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'./makeMap'</span>

<span class="hljs-comment">/** 空对象 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_OBJ</span>: { readonly [<span class="hljs-attr">key</span>: string]: any } = {}

<span class="hljs-comment">/** 空数组 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_ARR</span>: readonly never[] = []

<span class="hljs-comment">/** 空函数 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NOOP</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {}

<span class="hljs-comment">/** 生成一个方法，用于判断一个属性名是否是保留属性 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isReservedProp</span>: <span class="hljs-function">(<span class="hljs-params">key: string</span>) =&gt;</span> boolean = <span class="hljs-comment">/*@__PURE__*/</span> <span class="hljs-title function_">makeMap</span>(
  <span class="hljs-string">',key,ref,ref_for,ref_key,'</span> +
    <span class="hljs-string">'onVnodeBeforeMount,onVnodeMounted,'</span> +
    <span class="hljs-string">'onVnodeBeforeUpdate,onVnodeUpdated,'</span> +
    <span class="hljs-string">'onVnodeBeforeUnmount,onVnodeUnmounted'</span>,
)
</code></pre>
<p>接着我们在模块的内部出口文件 <code>shared/src/index.ts</code> 中，导出所有功能子模块（目前仅 <code>general</code> 和 <code>makeMap</code>）的接口：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/src/index.ts **/</span>

<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./general'</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./makeMap'</span>
</code></pre>
<p>后续仅需引用该出口文件，就能通过「一拖多」的形式间接引入 <code>shared</code> 模块的全部功能接口。</p>
<h4 id="user-content-md-dist" data-id="heading-5">待构建的 dist 文件夹</h4>
<p>作为一个被多运行时、多构建环境复用的基础工具模块，通常需要提供多种构建格式（例如 ESM、CJS 等），以适配不同的加载方式与运行场景。</p>
<p>对于 <code>shared</code> 模块而言，其职责是为 Vue 各核心包提供最基础、最通用的工具能力，因此需要将 <code>shared/src</code> 下的源码构建为多种产出物，以覆盖以下几类典型使用场景：</p>
<ul>
<li>
<p><strong>开发环境下的 CommonJS 引用</strong></p>
<p>即通过 <code>require('@vue/shared')</code> 引入 <code>shared</code> 模块，且运行于开发环境（<code>process.env.NODE_ENV === 'development'</code>）的场景，需确保所引用的 <code>shared</code> 模块产出物为 CommonJS 版本，且包含用于开发期的调试逻辑（如 warning、assert 等）。</p>
<p>我们拟定该产出物名为 <code>shared.cjs.js</code>。</p>
</li>
<li>
<p><strong>生产环境下的 CommonJS 引用</strong></p>
<p>即同样通过 <code>require('@vue/shared')</code> 引入 <code>shared</code> 模块，但运行于生产环境的场景，需确保所引用的 <code>shared</code> 模块产出物为 CommonJS 版本，且剔除了所有用于开发期的调试逻辑（确保最终代码体积最小）。</p>
<p>我们拟定该产出物名为 <code>shared.cjs.prod.js</code>。</p>
</li>
<li>
<p><strong>ESM 引用（Bundler 场景）</strong></p>
<p>即通过 <code>import</code> 引入 <code>shared</code> 模块的场景，需确保所引用的 <code>shared</code> 模块产出物为 ESM bundler 版本。</p>
<p>我们拟定该产出物名为 <code>shared.esm-bundler.js</code>。</p>
<blockquote>
<p>💡 与 CommonJS 不同，ESM 版本并不会拆分出「开发环境」和「生产环境」两套文件。</p>
<p>💡 这得益于 ESM 的静态导入特性，Vue 框架使用者在业务侧进行二次构建的过程中，构建工具可在编译期将环境变量替换为常量，并通过 Tree-shaking / Dead Code Elimination 精确移除不可达的环境逻辑，从而保证最终生产代码中不存在任何冗余分支。</p>
</blockquote>
</li>
</ul>
<p>在后文我们会通过构建工具，将 <code>shared/src</code> 的源文件构建出适配上述三个场景的产出物，并创建 <code>shared/dist</code> 文件夹来存放这些产物。</p>
<p>另外我们也将为 <code>shared</code> 模块构建其 TypeScript 声明文件 <code>shared/dist/shared.d.ts</code>，用于在 TypeScript 项目中提供类型检查与智能提示。</p>
<h4 data-id="heading-6">npm 包入口文件</h4>
<p><code>shared/index.ts</code> 是 <code>shared</code> 模块的包入口文件，在下文将介绍的 <code>shared/package.json</code> 中会通过 <code>main</code> 字段指定该文件为 CommonJS 生态下的传统入口。</p>
<p>其内容为根据当前的运行环境，引入对应的 CommonJS 版本构建产物：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/shared.cjs.prod.js'</span>)
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/shared.cjs.js'</span>)
}
</code></pre>
<p>留意在这类 CommonJS 入口文件中，Vue 都对它们启用了严格模式（<code>'use strict'</code>），这是为了确保代码能及时暴露一些潜在的问题（例如使用未声明的变量），并提升代码的质量和可维护性。</p>
<blockquote>
<p>💡 严格模式在 ESM 里是默认开启的，因此 ESM 模块里无需标记 <code>'use strict'</code>。</p>
</blockquote>
<h4 data-id="heading-7">npm 包配置文件</h4>
<p><code>shared/package.json</code> 是 <code>shared</code> 模块的 npm 包配置文件，其职责不只是提供「npm 发布描述」，还包含了工程化相关的配置信息：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** shared/package.json **/</span>

{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@vue/shared"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,                     <span class="hljs-comment">// 指定 CommonJS 生态下的传统入口，主要用于 不支持 exports 的旧 NodeJS / 工具链</span>
  <span class="hljs-string">"module"</span>: <span class="hljs-string">"dist/shared.esm-bundler.js"</span>, <span class="hljs-comment">// 指定 ESM bundler 生态下的入口</span>
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/shared.d.ts"</span>,            <span class="hljs-comment">// 指定类型声明文件</span>
  <span class="hljs-string">"files"</span>: [                              <span class="hljs-comment">// 指定了在发布到 npm 时，哪些文件会被包含在发布包中（避免将 src、测试代码、构建脚本等无关内容发布到 npm）</span>
    <span class="hljs-string">"index.js"</span>,
    <span class="hljs-string">"dist"</span>
  ],
  <span class="hljs-string">"exports"</span>: {                            <span class="hljs-comment">// 更为完善的新规范入口配置字段</span>
    <span class="hljs-string">"."</span>: {
      <span class="hljs-string">"types"</span>: <span class="hljs-string">"./dist/shared.d.ts"</span>,                 <span class="hljs-comment">// 指定类型声明文件</span>
      <span class="hljs-string">"node"</span>: {                                      <span class="hljs-comment">// 传统 NodeJS（CommonJS），开发环境和生产环境对应的入口</span>
        <span class="hljs-string">"production"</span>: <span class="hljs-string">"./dist/shared.cjs.prod.js"</span>,
        <span class="hljs-string">"development"</span>: <span class="hljs-string">"./dist/shared.cjs.js"</span>,
        <span class="hljs-string">"default"</span>: <span class="hljs-string">"./index.js"</span>
      },
      <span class="hljs-string">"module"</span>: <span class="hljs-string">"./dist/shared.esm-bundler.js"</span>,      <span class="hljs-comment">// ESM bundler 入口（用于部分构建工具识别）</span>
      <span class="hljs-string">"import"</span>: <span class="hljs-string">"./dist/shared.esm-bundler.js"</span>,      <span class="hljs-comment">// ESM bundler 入口（用于 NodeJS 侧识别）</span>
      <span class="hljs-string">"require"</span>: <span class="hljs-string">"./index.js"</span>                        <span class="hljs-comment">// 传统 CommonJS 默认入口（兜底）</span>
    },
    <span class="hljs-string">"./*"</span>: <span class="hljs-string">"./*"</span>                                     <span class="hljs-comment">// 指定可访问的子路径映射</span>
  },
  <span class="hljs-string">"sideEffects"</span>: <span class="hljs-literal">false</span>          <span class="hljs-comment">// 声明该包在模块【初始化阶段】不存在副作用，当模块的导出未被使用时，整个模块可被剔除（Tree-shaking）</span>
  }
}
</code></pre>
<p>其中 <code>main</code>、<code>module</code> 和 <code>types</code> 三个字段是为了兼容旧生态所保留的约定式入口，<code>exports</code> 则是更为完善的新规范字段（可以指定更细粒度的入口映射），现代 NodeJS 或构建工具会优先采用 <code>exports</code> 字段指定的入口。</p>
<h3 data-id="heading-8">2.3 Monorepo 模块之间的联系</h3>
<h4 data-id="heading-9">新建 reactivity 模块</h4>
<p>为了更好地了解 Monorepo 下各独立模块之间的联系，我们仿照 <code>shared</code> 模块的结构，在 <code>packages</code> 下创建一个名为 <code>reactivity</code> 的响应式模块：</p>
<pre><code class="hljs language-js" lang="js">vue
├── packages
│   ├── reactivity        <span class="hljs-comment">// 新增响应式模块文件夹</span>
│   │   ├── src           <span class="hljs-comment">// 存放实际源码</span>
│   │   │   ├── reactive.<span class="hljs-property">ts</span>
│   │   │   └── index.<span class="hljs-property">ts</span>
│   │   ├── package.<span class="hljs-property">json</span>  <span class="hljs-comment">// npm 包配置</span>
│   │   └── index.<span class="hljs-property">ts</span>      <span class="hljs-comment">// 包入口</span>
</code></pre>
<blockquote>
<p><code>reactivity</code> 下各文件的内容和 <code>shared</code> 的基本一致。</p>
</blockquote>
<p>目前我们仅打算搭建一个项目雏形，因此 <code>reactivity</code> 模块的内容尽量简单化，其中 <code>src/reactive.ts</code> 的代码仅用来模拟 <code>shared</code> 模块接口的引入和导出：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** src/reactive.ts **/</span>

<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/shared'</span>  <span class="hljs-comment">// 仅用于调试</span>
</code></pre>
<p>此时你会看到 IDE 中会标红报错，提示 TypeScript 找不到 <code>@vue/shared</code> 模块：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6e3e463f9e347dea39da1e52b0bfc36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770456683&amp;x-signature=4G2K%2FdnayDNqQDG3xc5zgUCHV4U%3D" alt="p1.png" loading="lazy"/></p>
<p>我们可以在 <code>vue</code> 根目录下新增 <code>tsconfig.json</code> 文件，用于配置 TypeScript 的编译选项：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"rootDir"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {                            <span class="hljs-comment">// IDE 类型检查路径</span>
      <span class="hljs-string">"@vue/*"</span>: [<span class="hljs-string">"./packages/*/src"</span>],     <span class="hljs-comment">// 把 @vue/xxx 映射到 packages/xxx/src 下</span>
      <span class="hljs-string">"*"</span>: [<span class="hljs-string">"./*"</span>]
    }
  },
  <span class="hljs-string">"include"</span>: [
    <span class="hljs-string">"packages/*/src"</span>,
  ]
}
</code></pre>
<p>此时 <code>src/reactive.ts</code> 中不再标红报错，IDE 的 TypeScript 类型检查功能已可成功识别到 <code>@vue/shared</code> 模块。</p>
<h4 data-id="heading-10">pnpm 的 <code>workspace</code> 协议</h4>
<p>如同<a href="#md-monorepo" title="#md-monorepo">「2.1 Vue 中的 Monorepo」</a>所提及的，<code>@vue/reactivity</code> 需要被独立发布到 npm 上（供开发者下载），我们需要为其声明对 <code>@vue/shared</code> npm 包的依赖：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** reactivity/package.json **/</span>

{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@vue/reactivity"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.6.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-string">"module"</span>: <span class="hljs-string">"dist/reactivity.esm-bundler.js"</span>,
  <span class="hljs-comment">// 略...（和 shared/package.json 基本一致）</span>

  <span class="hljs-string">"dependencies"</span>: {                 <span class="hljs-comment">// 补充对 shared 模块的依赖信息</span>
    <span class="hljs-string">"@vue/shared"</span>: <span class="hljs-string">"3.6.0"</span>
  }
}
</code></pre>
<p>然而这里所填入的 <code>@vue/shared</code> 版本号 <code>3.6.0</code> 存在一个问题 —— 该远程版本的内容并非我们本地上最新的 <code>packages/shared</code> 下的内容，且每次发布 npm 包之前都需要手动更新该依赖包的版本号，一旦遗漏就会出错。</p>
<p>pnpm 官方提供了一个解决方案，即使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fworkspaces" target="_blank" title="https://pnpm.io/workspaces" ref="nofollow noopener noreferrer"><code>workspace</code> 协议</a>来替换依赖包的版本号，它表示该依赖必须解析自当前 Monorepo 中声明的 workspace 包，而不会从远程 npm registry 下载：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** reactivity/package.json **/</span>

  <span class="hljs-string">"dependencies"</span>: {      
    <span class="hljs-string">"@vue/shared"</span>: <span class="hljs-string">"workspace:*"</span>     <span class="hljs-comment">// 更替为 workspace 协议</span>
  }
</code></pre>
<p>另外，我们还需在 <code>vue</code> 根目录下新增 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fpnpm-workspace_yaml" target="_blank" title="https://pnpm.io/pnpm-workspace_yaml" ref="nofollow noopener noreferrer"><code>pnpm-workspace.yaml</code> 文件</a>，用于告知 pnpm「哪些文件夹可以作为独立的 workspace」：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** pnpm-workspace.yaml **/</span>

<span class="hljs-attr">packages</span>:
  - <span class="hljs-string">"packages/*"</span>  <span class="hljs-comment">// 把 packages 文件夹里的每一个一级子目录，都当作一个独立的 workspace 包</span>
</code></pre>
<p>pnpm 在执行时会扫描 <code>pnpm-workspace.yaml</code> 中所配置的目录，并将其中包含 <code>package.json</code> 的子目录注册为 workspace 成员，后续在解析 <code>workspace:*</code> 时，会从这些 workspace 成员中进行检索和匹配。</p>
<p>在经过这番配置后，通过 <code>pnpm publish</code> 指令来发布 <code>@vue/reactivity</code> 包时，pnpm 会把将要提交到 npm registry 的 manifest 中的 <code>@vue/shared</code> 依赖包版本号，填写为本地对应 workspace 成员 <code>packages.json</code>（即 <code>packages/shared/package.json</code>）中的版本号。</p>
<h2 data-id="heading-11">3、构建系统雏形</h2>
<p>在理解了 Vue 3.6 的 Monorepo 结构与包之间的依赖关系之后，下一步就是要实现一个基础的构建系统，将分散在 <code>packages/*/src</code> 目录下的源码，构建出<a href="#md-dist" title="#md-dist">预期的各版本</a>并放置在 <code>packages/*/dist</code> 中）。</p>
<h3 data-id="heading-12">3.1 技术选型</h3>
<p>Vue 使用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2F" target="_blank" title="https://rollupjs.org/" ref="nofollow noopener noreferrer">Rollup</a> 作为「生产构建器」，开发态的快速构建则采用的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild</a>。</p>
<h4 data-id="heading-13">生产构建选择 Rollup 的原因</h4>
<p>Rollup 自诞生以来就是为了打包 JavaScript 库而设计的：</p>
<ul>
<li><strong>Tree-shaking 的极致优化</strong> —— Rollup 基于 ES Modules (ESM)，它能生成非常「扁平」的输出代码，进而确保冗余代码能被精确裁剪、输出内容足够干净。</li>
<li><strong>作用域提升（Scope Hoisting）</strong> —— Rollup 默认会将所有模块提升到同一个作用域内，这不仅进一步减小了代码体积，还能提高执行性能。</li>
<li><strong>多格式输出支持</strong> —— Rollup 的插件系统和配置机制，可以高效地构建出 Vue 的多版本产物：
<ul>
<li><code>esm-bundler</code> (给 Vite / Webpack 用)；</li>
<li><code>esm-browser</code> (给浏览器 <code>&lt;script type="module"&gt;</code> 用)；</li>
<li><code>cjs</code> (CommonJS 语法，给 NodeJS 环境用)；</li>
<li><code>global</code> (传统的 <code>&lt;script&gt;</code> 引入) 。</li>
</ul>
</li>
</ul>
<p>最重要的是，Vue 需要被构建为一个「通用的前端框架库」，而不是被构建为一个「Web 应用」，因此需要尽可能地保证输出代码的可阅读性。相比 Webpack 会在每个模块周围包裹大量的 <code>__webpack_require__</code> 等运行时代码，Rollup 输出的代码更加「原汁原味」、易于使用者阅读和调试。</p>
<h4 data-id="heading-14">开发构建选择 esbuild 的原因</h4>
<p>虽然 Rollup 产物精美，但在速度上它并不是最快的。</p>
<p>在开发、调试场景中，我们对于构建速度的需求要远高于极致性能的需求，而 esbuild 非常契合这一场景：</p>
<ul>
<li><strong>极速的增量构建</strong> —— esbuild 采用了基于 Go 语言的编译后端，编译速度非常快，能够在毫秒级完成增量构建，适合频繁改动源码、快速看效果的 watch 开发。</li>
<li><strong>简单的配置</strong> —— esbuild 的配置选项非常简单，无需复杂的插件系统即可实现基本的构建需求。</li>
</ul>
<p>因此，虽然 esbuild 的输出代码不够完美（例如 Tree-Shaking 没有 Rollup 极致），但非常适用于在开发场景中用于响应迅速的「粗加工」。</p>
<blockquote>
<p>💡 读者需注意区分各类构建面向的主体对象 —— Vue 源码项目的「生产构建」是面向 Vue 框架使用者的，因此「生产构建」的产物包括了使用者在其<strong>生产环境</strong>中使用的产物，也包括了使用者在其<strong>开发环境</strong>中使用的产物；而 Vue 源码项目的「开发构建」只面向 Vue 源码开发者（与使用者无关）。</p>
</blockquote>
<h3 data-id="heading-15">3.2 <code>shared</code> 模块的生产构建方案实现</h3>
<h4 data-id="heading-16"><code>rollup.config.js</code> 配置</h4>
<p>Vue 是通过拼接 Rollup 的命令行指令来执行生产构建的，我们可以按照 <a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2Fcommand-line-interface%2F" target="_blank" title="https://rollupjs.org/command-line-interface/" ref="nofollow noopener noreferrer">Rollup 官方文档</a>，先在项目根目录创建一个 <code>rollup.config.js</code> 配置文件，用于告诉 Rollup 在执行指令时「如何打包一个 package」。</p>
<p>以「构建一个 <code>packages/shared/dist/shared.cjs.js</code> 为例」，其配置内容参考如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-esbuild'</span>

<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'.'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))

<span class="hljs-keyword">const</span> packageConfigs = [{
  <span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),

  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// 插件</span>
    <span class="hljs-title function_">esbuild</span>({       <span class="hljs-comment">// TypeScript / JS 语法转译</span>
      <span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
      <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
    }),
  ],

  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">"cjs"</span>,
  },
  <span class="hljs-attr">treeshake</span>: {
    <span class="hljs-attr">moduleSideEffects</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// 声明模块无副作用，允许 Rollup 安全地进行 Tree-Shaking</span>
  },
}];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs
</code></pre>
<p>留意这里我们使用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fegoist%2Frollup-plugin-esbuild" target="_blank" title="https://github.com/egoist/rollup-plugin-esbuild" ref="nofollow noopener noreferrer"><code>rollup-plugin-esbuild</code></a> 插件，这是因为 Rollup 本身是无法识别 TypeScript 语法的，因此需要利用 esbuild 来充当「语法翻译官」，把 TypeScript 代码转译为 JavaScript 代码。</p>
<blockquote>
<p>💡 esbuild 在开发模式中充当了构建器 + bundler + runner 的角色，但在本小节的生产构建中被降级为一个编译器插件。</p>
<p>💡 读者请自行安装 <code>rollup</code>、<code>typescript</code>、<code>rollup-plugin-esbuild</code> 等 npm 依赖包，本系列文章不会提及依赖包的安装。</p>
</blockquote>
<p>此时执行 <code>rollup -c</code> 即可构建出 <code>packages/shared/dist/shared.cjs.js</code> 文件。</p>
<p>然而除了 <code>cjs</code> 格式的文件，还要为 <code>shared</code> 模块构建 <code>esm-bundler</code> 格式的文件，这需要往 <code>packageConfigs</code> 数组中 push 多个配置项，我们可以封装一个 <code>createConfig</code> 方法来创建配置项：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// 略...</span>

<span class="hljs-keyword">const</span> outputConfigs = {
  <span class="hljs-string">'esm-bundler'</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.esm-bundler.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>,
  },
  <span class="hljs-string">'cjs'</span>: {
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.js'</span>),
    <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>,
  },
}

<span class="hljs-keyword">const</span> packageFormats = [<span class="hljs-string">'esm-bundler'</span>, <span class="hljs-string">'cjs'</span>]

<span class="hljs-keyword">const</span> packageConfigs = packageFormats.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> <span class="hljs-title function_">createConfig</span>(format, outputConfigs[format]))

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在创建 <span class="hljs-subst">${format}</span> 格式的构建配置...`</span>)

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
    <span class="hljs-attr">plugins</span>: [   
      <span class="hljs-title function_">esbuild</span>({  
        <span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
        <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
      }),
      ...plugins    <span class="hljs-comment">// 支持扩展自定义插件</span>
    ],
    output,
    <span class="hljs-attr">treeshake</span>: {
      <span class="hljs-attr">moduleSideEffects</span>: <span class="hljs-literal">false</span>,
    },
  }
}
</code></pre>
<p>此时执行 <code>rollup -c</code> 可构建出 <code>packages/shared/dist/shared.cjs.js</code> 和 <code>packages/shared/dist/shared.esm-bundler.js</code> 文件。</p>
<h4 data-id="heading-17">利用 <code>NODE_ENV</code> 和 <code>PROD_ONLY</code> 参数指定产出物环境</h4>
<p>根据<a href="#md-dist" title="#md-dist">「待构建的 dist 文件夹」</a>小节所罗列的构建产物，我们还需为 <code>shared</code> 模块构建一个 CommonJS 格式的<strong>生产环境</strong>产物 <code>shared.cjs.prod.js</code>。</p>
<p>另外，Vue 属于一个多模块、复杂度较高的项目，会有「按需构建」的需求，用于节省构建的等待时间。例如开发者会希望通过执行不同的 Rollup 的指令来满足如下三种场景：</p>
<ul>
<li>构建所有生产环境和开发环境的产物；</li>
<li>只构建生产环境的产物；</li>
<li>只构建开发环境的产物。</li>
</ul>
<p>我们可以通过 Rollup 执行指令中的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.rollupjs.org%2Fcommand-line-interface%2F%23environment-values" target="_blank" title="https://cn.rollupjs.org/command-line-interface/#environment-values" ref="nofollow noopener noreferrer"><code>environment</code> 参数</a>来传值处理：</p>
<ul>
<li>执行 <code>rollup -c --environment NODE_ENV:production</code> 时构建出所有生产环境和开发环境的产物；</li>
<li>执行 <code>rollup -c --environment NODE_ENV:production,PROD_ONLY:true</code> 时只构建生产环境的产物；</li>
<li>执行 <code>rollup -c --environment NODE_ENV:development</code> 时只构建开发环境的产物。</li>
</ul>
<p>这里我们自定义了两个参数 <code>NODE_ENV</code> 和 <code>PROD_ONLY</code>，分别用于指定「构建目标环境」和「是否只构建生产环境的产物」，我们可以在 <code>rollup.config.js</code> 中通过 <code>process.env</code> 来读取传入的自定义参数值，并做相应的逻辑处理：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// 略...</span>
<span class="hljs-keyword">const</span> packageFormats = [<span class="hljs-string">'esm-bundler'</span>, <span class="hljs-string">'cjs'</span>]

<span class="hljs-comment">// 通过 process.env 获取传入的 PROD_ONLY 参数</span>
<span class="hljs-keyword">const</span> packageConfigs = process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD_ONLY</span> ? [] : packageFormats.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> <span class="hljs-title function_">createConfig</span>(format, outputConfigs[format]))

<span class="hljs-comment">// 若需要构建生产环境产物，针对 cjs 格式，添加其生产环境的配置项</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {    <span class="hljs-comment">// 通过 process.env 获取传入的 NODE_ENV 参数</span>
  packageFormats.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">format</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (format === <span class="hljs-string">'cjs'</span>) {
      packageConfigs.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">createProductionConfig</span>(format))
    }
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> packageConfigs

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
	<span class="hljs-keyword">const</span> isProductionBuild = <span class="hljs-regexp">/\.prod\.js$/</span>.<span class="hljs-title function_">test</span>(output.<span class="hljs-property">file</span>)
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在创建<span class="hljs-subst">${isProductionBuild ? <span class="hljs-string">'生产环境'</span> : <span class="hljs-string">'开发环境'</span>}</span> <span class="hljs-subst">${format}</span> 格式的构建配置...`</span>)

	<span class="hljs-keyword">return</span> {
	  <span class="hljs-comment">// 略...</span>
	}
}

<span class="hljs-comment">// 创建生产环境配置项</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createProductionConfig</span>(<span class="hljs-params">format</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createConfig</span>(format, {
    ...outputConfigs[format],
    <span class="hljs-attr">file</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/dist/shared.cjs.prod.js'</span>),  <span class="hljs-comment">// 构建 cjs.prod.js 文件</span>
  })
}
</code></pre>
<p>此时执行 <code>rollup -c --environment NODE_ENV:production,PROD_ONLY:true</code>，会单独构建出 <code>packages/shared/dist/shared.cjs.prod.js</code> 文件。</p>
<h4 data-id="heading-18">开发环境占位符 <code>__DEV__</code> 及其替换</h4>
<p>查看前文所构建出的 <code>shared.cjs.js</code> 和 <code>shared.cjs.prod.js</code> 文件，会发现它们的内容是完全相同的，读者可能会因此感到困惑。</p>
<p>为了便于区分不同环境产物的内容（而不仅仅是文件名不同），我们修改 <code>packages/shared/src/general.ts</code> 的代码，加上一个自定义的开发环境占位符 <code>__DEV__</code>：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/** packages/shared/src/general.ts */</span>

<span class="hljs-comment">/** 空对象 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_OBJ</span>: { <span class="hljs-keyword">readonly</span> [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span> } = __DEV__
  ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({})
  : {}

<span class="hljs-comment">/** 空数组 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMPTY_ARR</span>: <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">never</span>[] = __DEV__ ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>([]) : []
</code></pre>
<p>此举目的是让 Vue 框架使用者在开发环境中，通过 <code>Object.freeze</code> 来避免改动到 Vue 源码内置的空对象和空数组两个常量，在生产环境时则改为使用性能最优的空对象和空数组即可。</p>
<blockquote>
<p>IDE 在此时会对 <code>__DEV__</code> 进行标红，提示「找不到名称__DEV__」，我们可以在 <code>packages</code> 下创建一个 <code>global.d.ts</code> 文件，用于声明这些自定义的变量：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// Global compile-time constants</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">var</span> <span class="hljs-attr">__DEV__</span>: <span class="hljs-built_in">boolean</span>
</code></pre>
</blockquote>
<p>接着我们在 <code>rollup.config.js</code> 中，通过 <code>rollup-plugin-esbuild</code> 插件的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2Fapi%2F%23define" target="_blank" title="https://esbuild.github.io/api/#define" ref="nofollow noopener noreferrer"><code>define</code></a> 属性，对 <code>__DEV__</code> 占位符进行替换：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-comment">// 略...</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
  <span class="hljs-keyword">const</span> isProductionBuild = <span class="hljs-regexp">/\.prod\.js$/</span>.<span class="hljs-title function_">test</span>(output.<span class="hljs-property">file</span>)
  <span class="hljs-keyword">const</span> isBundlerESMBuild = <span class="hljs-regexp">/esm-bundler/</span>.<span class="hljs-title function_">test</span>(format)      <span class="hljs-comment">// 是否为 ESM Bundler 格式的构建</span>
  <span class="hljs-comment">// 略...</span>

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
    <span class="hljs-attr">plugins</span>: [  
      ...<span class="hljs-title function_">resolveReplace</span>(),
      <span class="hljs-title function_">esbuild</span>({  
        <span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
        <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
        <span class="hljs-attr">define</span>: <span class="hljs-title function_">resolveDefine</span>(),    <span class="hljs-comment">// 替换自定义占位符</span>
      }),
      ...plugins
    ],
    <span class="hljs-comment">// 略...</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveDefine</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> replacements = {}

    <span class="hljs-keyword">if</span> (isBundlerESMBuild) {
      replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-string">`!!(process.env.NODE_ENV !== 'production')`</span>
    } <span class="hljs-keyword">else</span> {
      replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-title class_">String</span>(!isProductionBuild)
    }

    <span class="hljs-keyword">return</span> replacements
  }
}
</code></pre>
<p>留意在新增的 <code>resolveDefine</code> 方法中，是否处于 ESM Bundler 格式的构建会影响占位符 <code>__DEV__</code> 的替换内容：</p>
<ul>
<li>ESM Bundler 格式的构建产物会把 <code>__DEV__</code> 占位符替换为 <code>!!(process.env.NODE_ENV !== 'production')</code>，因为该产物是会交由业务侧去执行二次构建的，由业务侧的构建工具再进一步去替换 <code>process.env.NODE_ENV</code> 即可；</li>
<li>非 ESM Bundler 格式的构建产物属于「最终运行时代码」，不会经历二次构建，因此要把 <code>__DEV__</code> 占位符根据构建环境替换为明确的 <code>true</code> 或 <code>false</code>，esbuild 插件会在构建过程通过 Tree-Shaking 移除未命中的逻辑分支，确保产物简洁且可以直接运行。</li>
</ul>
<p>然而此时执行 <code>rollup -c --environment NODE_ENV:production</code> 指令，会出现报错：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- [!] (plugin esbuild) Error: Transform failed with 1 error:</span>
<span class="hljs-deletion">- error: Invalid define value (must be an entity name or JS literal): !!(process.env.NODE_ENV !== 'production')</span>
</code></pre>
<p>这是因为 esbuild 的 <code>define</code> 对替换内容具有严格的要求，其仅用于将全局标识符替换为<strong>静态常量</strong>，它要求替换的内容必须是布尔值、数字、字符串，或者是另一个标识符，但不能是 <code>!!(process.env.NODE_ENV !== 'production')</code> 这样的表达式语句。</p>
<blockquote>
<p>esbuild 会试图把自定义的 Key 替换成一个合法的 AST 节点，当要替换的值是一个复杂的表达式时，esbuild 解析器无法将其作为一个单一的「值」或「标识符」插入到 AST 中，因此会直接抛出 <code>Invalid define value</code> 错误来阻止构建。</p>
</blockquote>
<p>针对此问题，我们可以在 ESM Bundler 场景改为使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frollup%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Freplace" target="_blank" title="https://github.com/rollup/plugins/tree/master/packages/replace" ref="nofollow noopener noreferrer"><code>@rollup/plugin-replace</code></a> 插件来进行占位符替换：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** rollup.config.js */</span>

<span class="hljs-keyword">import</span> replace <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-replace'</span>
<span class="hljs-comment">// 略...</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">format, output, plugins = []</span>) {
  <span class="hljs-comment">// 略...</span>

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">input</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'./packages/shared/src/index.ts'</span>),
    <span class="hljs-attr">plugins</span>: [
      ...<span class="hljs-title function_">resolveReplace</span>(),     <span class="hljs-comment">// 使用 @rollup/plugin-replace 插件</span>
      <span class="hljs-title function_">esbuild</span>({
        <span class="hljs-attr">tsconfig</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'tsconfig.json'</span>),
        <span class="hljs-attr">minify</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">target</span>: <span class="hljs-string">'es2016'</span>,
        <span class="hljs-attr">define</span>: <span class="hljs-title function_">resolveDefine</span>(),
      }),
      ...plugins
    ],
    <span class="hljs-comment">// 略...</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveDefine</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> replacements = {}

    <span class="hljs-keyword">if</span> (!isBundlerESMBuild) {
      replacements.<span class="hljs-property">__DEV__</span> = <span class="hljs-title class_">String</span>(!isProductionBuild)
    }

    <span class="hljs-keyword">return</span> replacements
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveReplace</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> replacements = {}

    <span class="hljs-comment">// ESM Bundler 格式的构建产物使用 @rollup/plugin-replace 来替换占位符</span>
    <span class="hljs-keyword">if</span> (isBundlerESMBuild) {
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(replacements, {
        <span class="hljs-attr">__DEV__</span>: <span class="hljs-string">`!!(process.env.NODE_ENV !== 'production')`</span>,
      })
    }

    <span class="hljs-keyword">return</span> [<span class="hljs-title function_">replace</span>({
      <span class="hljs-attr">values</span>: replacements,
      <span class="hljs-attr">preventAssignment</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// 若变量出现在赋值号（ = ）的左边，就不要进行替换。目的是防止把赋值语句当成常量替换（例如 __DEV__ = true）</span>
    })]
  }
}
</code></pre>
<p>此时执行 <code>rollup -c --environment NODE_ENV:production</code> 指令，构建出的所有 <code>shared</code> 模块产物内容如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.cjs.js */</span>
<span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({}) ;
<span class="hljs-comment">// 略...</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">EMPTY_OBJ</span> = <span class="hljs-variable constant_">EMPTY_OBJ</span>;
<span class="hljs-comment">// 略...</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.cjs.prod.js */</span>
<span class="hljs-meta">
'use strict'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = {};
<span class="hljs-comment">// 略...</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">EMPTY_OBJ</span> = <span class="hljs-variable constant_">EMPTY_OBJ</span>;
<span class="hljs-comment">// 略...</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** packages/shared/dist/shared.esm-bundler.js */</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMPTY_OBJ</span> = !!(process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">"production"</span>) ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({}) : {};
<span class="hljs-comment">// 略...</span>

<span class="hljs-keyword">export</span> { 
  <span class="hljs-variable constant_">EMPTY_OBJ</span>, 
  <span class="hljs-comment">// 略... </span>
}
</code></pre>
<blockquote>
<p>我们会在下篇文章为构建系统补充 <code>reactivity</code> 等其它模块的构建能力。</p>
</blockquote>
<h3 data-id="heading-19">3.3 <code>shared</code> 模块的开发构建方案实现</h3>
<p>我们已经在前文了解过，Vue 源码项目只通过 esbuild 来负责开发调试时的构建，我们在 Vue 源码项目的根目录创建 <code>./scripts/dev.js</code> 文件来配置 esbuild：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** scripts/dev.js **/</span>

<span class="hljs-keyword">import</span> esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'esbuild'</span>
<span class="hljs-keyword">import</span> { dirname, relative, resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> { parseArgs } <span class="hljs-keyword">from</span> <span class="hljs-string">'util'</span>

<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))

<span class="hljs-keyword">const</span> {
  <span class="hljs-attr">values</span>: { <span class="hljs-attr">format</span>: rawFormat, prod, },
} = <span class="hljs-title function_">parseArgs</span>({
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">format</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
      <span class="hljs-attr">short</span>: <span class="hljs-string">'f'</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">'cjs'</span>,
    },
    <span class="hljs-attr">prod</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>,
      <span class="hljs-attr">short</span>: <span class="hljs-string">'p'</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>,
    },
  },
})

<span class="hljs-keyword">const</span> format = rawFormat || <span class="hljs-string">'cjs'</span>
<span class="hljs-keyword">const</span> outputFormat = format === <span class="hljs-string">'cjs'</span> ? <span class="hljs-string">'cjs'</span> : <span class="hljs-string">'esm'</span>

<span class="hljs-keyword">const</span> pkgBasePath = <span class="hljs-string">`../packages/shared`</span>
<span class="hljs-keyword">const</span> outfile = <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`<span class="hljs-subst">${pkgBasePath}</span>/dist/shared.<span class="hljs-subst">${format}</span>.<span class="hljs-subst">${prod ? <span class="hljs-string">`prod.`</span> : <span class="hljs-string">``</span>}</span>js`</span>)

<span class="hljs-keyword">const</span> relativeOutfile = <span class="hljs-title function_">relative</span>(process.<span class="hljs-title function_">cwd</span>(), outfile)


<span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">Array&lt;import('esbuild').Plugin&gt;</span>} */</span>
<span class="hljs-keyword">const</span> plugins = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'log-rebuild'</span>,    <span class="hljs-comment">// 在构建完成时，打印构建完成的文件路径</span>
    <span class="hljs-title function_">setup</span>(<span class="hljs-params">build</span>) {
      build.<span class="hljs-title function_">onEnd</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`built: <span class="hljs-subst">${relativeOutfile}</span>`</span>)
      })
    },
  },
]

<span class="hljs-keyword">const</span> entry = <span class="hljs-string">'index.ts'</span>

esbuild
  .<span class="hljs-title function_">context</span>({
    <span class="hljs-attr">entryPoints</span>: [<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`<span class="hljs-subst">${pkgBasePath}</span>/src/<span class="hljs-subst">${entry}</span>`</span>)],
    outfile,
    <span class="hljs-attr">bundle</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">format</span>: outputFormat,
    <span class="hljs-attr">platform</span>: format === <span class="hljs-string">'cjs'</span> ? <span class="hljs-string">'node'</span> : <span class="hljs-string">'browser'</span>,
    plugins,
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__DEV__</span>: prod ? <span class="hljs-string">`false`</span> : <span class="hljs-string">`true`</span>,
    },
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> ctx.<span class="hljs-title function_">watch</span>())    <span class="hljs-comment">// 监听源码变化并执行实时增量构建</span>
</code></pre>
<p>其中我们使用了 NodeJS <code>util</code> 原生模块的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Futil.html%23utilparseargsconfig" target="_blank" title="https://nodejs.org/api/util.html#utilparseargsconfig" ref="nofollow noopener noreferrer"><code>parseArgs</code></a> 来解析命令行参数，例如：</p>
<pre><code class="hljs language-bash" lang="bash">node scripts/dev.js -f esm-bundler
</code></pre>
<p>当执行该指令时，<code>parseArgs</code> 会捕获传入的 <code>f</code> 参数并将其值（<code>esm-bundler</code>）赋给 <code>rawFormat</code> 变量。</p>
<p>最后我们调用了 esbuild 的 <code>context</code> 方法来自定义配置并执行构建。以上述的指令为例，esbuild 会直接构建出 <code>packages/shared/dist/shared.esm-bundler.js</code> 文件，且实时监听 <code>shared</code> 模块的源码变化并执行增量构建。</p>
<blockquote>
<p>💡 Vue 源码在开发调试环节，需要通过 esbuild 构建的场景其实不多（在开发后期可以创建一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2F" target="_blank" title="https://vite.dev/" ref="nofollow noopener noreferrer">vite</a> 项目来配合调试），开发的前期更多还是通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvitest.dev%2F" target="_blank" title="https://vitest.dev/" ref="nofollow noopener noreferrer">vitest</a> 对模块源码进行单元测试。我们会在后续的文章中进行了解。</p>
</blockquote>
<p>补充：鉴于 Vue 3.6 beta 5 已全线替换构建工具，本文「后续的文章」也只能跟着断更。后续可能以 Vue 官方最新版的项目重新进行源码解析和输出解析文章。共勉。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills工作流：从入门到实战]]></title>    <link>https://juejin.cn/post/7600994087588053011</link>    <guid>https://juejin.cn/post/7600994087588053011</guid>    <pubDate>2026-01-31T01:51:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600994087588053011" data-draft-id="7600986495927205929" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills工作流：从入门到实战"/> <meta itemprop="keywords" content="Java,AI编程"/> <meta itemprop="datePublished" content="2026-01-31T01:51:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills工作流：从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T01:51:22.000Z" title="Sat Jan 31 2026 01:51:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Agent Skills工作流：从入门到实战</h2>
<h3 data-id="heading-1">前言</h3>
<p>在人工智能快速发展的今天，Agent智能体技术正在改变我们构建应用的方式。Agent Skills工作流作为连接智能体与具体能力的桥梁，为开发者提供了一种灵活、可扩展的架构模式。本文将从基础概念出发，结合实际案例，带你深入了解Agent Skills的设计与实现。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c2bc2d2a5214350b58a5a623a9f951c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=iRvpk%2FUHq4gqhdUvRPQgam2Auqo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">一、什么是Agent Skills</h3>
<h4 data-id="heading-3">1.1 核心概念</h4>
<p><strong>Agent（智能体）</strong>：具有自主决策能力的实体，能够理解任务、规划行动并执行操作。</p>
<p><strong>Skill（技能）</strong>：Agent可以调用的具体能力单元，如文件读取、数据查询、文本分析等。</p>
<p><strong>Agent Skills工作流</strong>：Agent通过识别任务需求，动态选择并调用合适的Skill，最终完成用户目标的过程。</p>
<h4 data-id="heading-4">1.2 架构设计</h4>
<p>Agent Skills架构包含四个核心层次：</p>
<ul>
<li><strong>Agent Core</strong>：智能体核心，负责决策和协调</li>
<li><strong>Skill Registry</strong>：技能注册中心，管理所有可用技能</li>
<li><strong>Execution Engine</strong>：执行引擎，处理技能调用和错误重试</li>
<li><strong>Skill Implementations</strong>：具体技能实现层</li>
</ul>
<p>这种分层设计确保了系统的可扩展性和可维护性。</p>
<h3 data-id="heading-5">二、核心组件实现</h3>
<h4 data-id="heading-6">2.1 Agent接口设计</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.agent;

<span class="hljs-keyword">import</span> com.example.skills.Skill;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;

<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * Agent智能体接口
 * 定义Agent的基本行为和能力
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Agent</span> {

    <span class="hljs-comment">/**
     * 获取Agent名称
     */</span>
    String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取Agent描述
     */</span>
    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 执行任务
     *
     * <span class="hljs-doctag">@param</span> task 任务内容
     * <span class="hljs-doctag">@param</span> context 执行上下文
     * <span class="hljs-doctag">@return</span> 执行结果
     */</span>
    AgentResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, AgentContext context)</span>;

    <span class="hljs-comment">/**
     * 注册技能
     *
     * <span class="hljs-doctag">@param</span> skill 技能实例
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerSkill</span><span class="hljs-params">(Skill skill)</span>;

    <span class="hljs-comment">/**
     * 获取已注册的所有技能
     */</span>
    java.util.Collection&lt;Skill&gt; <span class="hljs-title function_">getSkills</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * Agent执行结果
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentResult</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> success;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object data;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> executionTime;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span> success, String message, Object data, <span class="hljs-type">long</span> executionTime)</span> {
            <span class="hljs-built_in">this</span>.success = success;
            <span class="hljs-built_in">this</span>.message = message;
            <span class="hljs-built_in">this</span>.data = data;
            <span class="hljs-built_in">this</span>.executionTime = executionTime;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">success</span><span class="hljs-params">(String message, Object data)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">true</span>, message, data, <span class="hljs-number">0</span>);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">success</span><span class="hljs-params">(String message, Object data, <span class="hljs-type">long</span> executionTime)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">true</span>, message, data, executionTime);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentResult <span class="hljs-title function_">failure</span><span class="hljs-params">(String message)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentResult</span>(<span class="hljs-literal">false</span>, message, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSuccess</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> success;
        }

        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMessage</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> message;
        }

        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> data;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getExecutionTime</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> executionTime;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"AgentResult{"</span> +
                    <span class="hljs-string">"success="</span> + success +
                    <span class="hljs-string">", message='"</span> + message + <span class="hljs-string">'\''</span> +
                    <span class="hljs-string">", data="</span> + data +
                    <span class="hljs-string">", executionTime="</span> + executionTime + <span class="hljs-string">"ms"</span> +
                    <span class="hljs-string">'}'</span>;
        }
    }
}

</code></pre>
<p>Agent接口定义了智能体的基本行为，其中最关键的是<code>execute</code>方法，它接收任务和上下文，返回执行结果。</p>
<h4 data-id="heading-7">2.2 Skill接口设计</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.skills;

<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * Skill技能接口
 * 定义Agent可以执行的具体技能
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Skill</span> {

    <span class="hljs-comment">/**
     * 获取技能名称
     */</span>
    String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取技能描述
     */</span>
    String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * 获取技能版本
     */</span>
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1.0.0"</span>;
    }

    <span class="hljs-comment">/**
     * 判断技能是否可以执行该任务
     *
     * <span class="hljs-doctag">@param</span> task 任务内容
     * <span class="hljs-doctag">@return</span> 是否可以执行
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span>;

    <span class="hljs-comment">/**
     * 执行技能
     *
     * <span class="hljs-doctag">@param</span> task 任务内容
     * <span class="hljs-doctag">@param</span> parameters 参数
     * <span class="hljs-doctag">@return</span> 执行结果
     */</span>
    SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span>;

    <span class="hljs-comment">/**
     * 获取技能的超时时间（毫秒）
     * 默认30秒
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">30000</span>;
    }

    <span class="hljs-comment">/**
     * 技能执行前的验证
     *
     * <span class="hljs-doctag">@param</span> task 任务内容
     * <span class="hljs-doctag">@param</span> parameters 参数
     * <span class="hljs-doctag">@return</span> 验证是否通过
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validate</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-keyword">return</span> task != <span class="hljs-literal">null</span> &amp;&amp; !task.trim().isEmpty();
    }

    <span class="hljs-comment">/**
     * 技能执行后的清理
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 默认不需要清理</span>
    }
}

</code></pre>
<p>Skill接口采用策略模式，每个技能实现独立的功能，并通过<code>canExecute</code>方法声明自己能处理哪些任务。</p>
<h4 data-id="heading-8">2.3 技能调用流程</h4>
<p>完整的技能调用流程包括10个步骤：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d81964197c964a8ead67b9ddf715333e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=Q01D015VgZmn1k5nK%2BasnAO%2BD6g%3D" alt="" loading="lazy"/></p>
<ol>
<li>接收用户请求</li>
<li>解析任务意图</li>
<li>匹配可用技能</li>
<li>验证执行权限</li>
<li>准备执行参数</li>
<li>调用技能接口</li>
<li>监控执行状态</li>
<li>处理执行结果</li>
<li>返回响应数据</li>
<li>更新执行历史</li>
</ol>
<p>每个步骤都有其特定的职责，确保任务能够安全、高效地执行。</p>
<h3 data-id="heading-9">三、基础技能实现</h3>
<h4 data-id="heading-10">3.1 文件读取技能</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.skills.impl;

<span class="hljs-keyword">import</span> com.example.skills.Skill;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.nio.file.Files;
<span class="hljs-keyword">import</span> java.nio.file.Path;
<span class="hljs-keyword">import</span> java.nio.file.Paths;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 文件读取技能
 * 用于读取本地文件内容
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileReadSkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(FileReadSkill.class);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"FileReadSkill"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"读取本地文件内容，支持文本文件、配置文件等"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span> {
        <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-type">String</span> <span class="hljs-variable">lowerTask</span> <span class="hljs-operator">=</span> task.toLowerCase();
        <span class="hljs-keyword">return</span> lowerTask.contains(<span class="hljs-string">"文件"</span>) &amp;&amp;
               (lowerTask.contains(<span class="hljs-string">"读取"</span>) || lowerTask.contains(<span class="hljs-string">"打开"</span>) || lowerTask.contains(<span class="hljs-string">"查看"</span>));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validate</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-keyword">if</span> (!Skill.<span class="hljs-built_in">super</span>.validate(task, parameters)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 检查文件路径参数</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"filePath"</span>);
        <span class="hljs-keyword">if</span> (filePath == <span class="hljs-literal">null</span>) {
            logger.warn(<span class="hljs-string">"filePath parameter is missing"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath.toString());
        <span class="hljs-keyword">if</span> (!Files.exists(path)) {
            logger.warn(<span class="hljs-string">"File does not exist: {}"</span>, filePath);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (!Files.isReadable(path)) {
            logger.warn(<span class="hljs-string">"File is not readable: {}"</span>, filePath);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"filePath"</span>).toString();

            logger.info(<span class="hljs-string">"Reading file: {}"</span>, filePath);

            <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath);

            <span class="hljs-comment">// 读取文件内容</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Files.readAllBytes(path), StandardCharsets.UTF_8);

            <span class="hljs-comment">// 获取文件信息</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">fileSize</span> <span class="hljs-operator">=</span> Files.size(path);
            <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> path.getFileName().toString();

            <span class="hljs-comment">// 构建元数据</span>
            Map&lt;String, Object&gt; metadata = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.HashMap&lt;&gt;();
            metadata.put(<span class="hljs-string">"filePath"</span>, filePath);
            metadata.put(<span class="hljs-string">"fileName"</span>, fileName);
            metadata.put(<span class="hljs-string">"fileSize"</span>, fileSize);
            metadata.put(<span class="hljs-string">"lines"</span>, content.split(<span class="hljs-string">"\n"</span>).length);

            <span class="hljs-type">long</span> <span class="hljs-variable">executionTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;

            logger.info(<span class="hljs-string">"File read successfully: {} ({} bytes)"</span>, fileName, fileSize);

            <span class="hljs-keyword">return</span> SkillResult.success(
                    <span class="hljs-string">"文件读取成功: "</span> + fileName,
                    content,
                    executionTime,
                    metadata
            );

        } <span class="hljs-keyword">catch</span> (IOException e) {
            logger.error(<span class="hljs-string">"Error reading file"</span>, e);
            <span class="hljs-keyword">return</span> SkillResult.failure(<span class="hljs-string">"文件读取失败: "</span> + e.getMessage(), e.getMessage());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">10000</span>; <span class="hljs-comment">// 10秒超时</span>
    }

    <span class="hljs-comment">/**
     * 读取文件行
     */</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">readLines</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(filePath);
        <span class="hljs-keyword">return</span> Files.readAllLines(path, StandardCharsets.UTF_8);
    }

    <span class="hljs-comment">/**
     * 检查文件是否存在
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">exists</span><span class="hljs-params">(String filePath)</span> {
        <span class="hljs-keyword">return</span> Files.exists(Paths.get(filePath));
    }

    <span class="hljs-comment">/**
     * 获取文件大小
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getFileSize</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">return</span> Files.size(Paths.get(filePath));
    }
}

</code></pre>
<h4 data-id="heading-11">3.2 数据查询技能</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataQuerySkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; database;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataQuerySkill</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.database = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        initializeSampleData();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canExecute</span><span class="hljs-params">(String task)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lowerTask</span> <span class="hljs-operator">=</span> task.toLowerCase();
        <span class="hljs-keyword">return</span> lowerTask.contains(<span class="hljs-string">"查询"</span>) ||
               lowerTask.contains(<span class="hljs-string">"数据"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">tableName</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"tableName"</span>).toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"condition"</span>).toString();

        List&lt;Map&lt;String, Object&gt;&gt; results = performQuery(
            tableName, condition, <span class="hljs-number">100</span>
        );

        <span class="hljs-keyword">return</span> SkillResult.success(
            <span class="hljs-string">"查询成功，找到"</span> + results.size() + <span class="hljs-string">"条记录"</span>,
            results
        );
    }
}
</code></pre>
<h4 data-id="heading-12">3.3 文本分析技能</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextAnalysisSkill</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Skill</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SkillResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, Map&lt;String, Object&gt; parameters)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"text"</span>).toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">operation</span> <span class="hljs-operator">=</span> parameters.get(<span class="hljs-string">"operation"</span>).toString();

        <span class="hljs-keyword">switch</span> (operation) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"stats"</span>:
                <span class="hljs-keyword">return</span> analyzeStats(text);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"keywords"</span>:
                <span class="hljs-keyword">return</span> extractKeywords(text);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"sentiment"</span>:
                <span class="hljs-keyword">return</span> analyzeSentiment(text);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> fullAnalysis(text);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">四、Agent交互机制</h3>
<h4 data-id="heading-14">4.1 时序交互</h4>
<p>Agent与Skills之间的交互遵循明确的时序关系：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b67db1da034019b43c5a67137d13c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=9sa%2F4iHlH2zwQJ2MD6Uck55Q9gk%3D" alt="" loading="lazy"/></p>
<ol>
<li>用户向Agent发送任务请求</li>
<li>Agent查询Skill Registry获取可用技能</li>
<li>Registry返回匹配的技能列表</li>
<li>Agent调用具体技能执行任务</li>
<li>技能返回执行结果</li>
<li>Agent整合结果并返回给用户</li>
</ol>
<h4 data-id="heading-15">4.2 上下文管理</h4>
<p>AgentContext在执行过程中传递和存储数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.agent;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;

<span class="hljs-comment">/**
 * Agent执行上下文
 * 用于在Agent执行过程中传递和存储数据
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentContext</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String requestId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; attributes;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; sessionData;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> createdAt;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentContext</span><span class="hljs-params">(String requestId)</span> {
        <span class="hljs-built_in">this</span>.requestId = requestId;
        <span class="hljs-built_in">this</span>.attributes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.sessionData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.createdAt = System.currentTimeMillis();
    }

    <span class="hljs-comment">/**
     * 获取请求ID
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> requestId;
    }

    <span class="hljs-comment">/**
     * 设置属性
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAttribute</span><span class="hljs-params">(String key, Object value)</span> {
        attributes.put(key, value);
    }

    <span class="hljs-comment">/**
     * 批量设置属性
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAttributes</span><span class="hljs-params">(Map&lt;String, Object&gt; attributes)</span> {
        <span class="hljs-keyword">if</span> (attributes != <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.attributes.putAll(attributes);
        }
    }

    <span class="hljs-comment">/**
     * 获取属性
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getAttribute</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> attributes.get(key);
    }

    <span class="hljs-comment">/**
     * 获取属性（带类型转换）
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getAttribute</span><span class="hljs-params">(String key, Class&lt;T&gt; type)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> attributes.get(key);
        <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span> &amp;&amp; type.isInstance(value)) {
            <span class="hljs-keyword">return</span> (T) value;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/**
     * 移除属性
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeAttribute</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> attributes.remove(key);
    }

    <span class="hljs-comment">/**
     * 设置会话数据
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSessionData</span><span class="hljs-params">(String key, Object value)</span> {
        sessionData.put(key, value);
    }

    <span class="hljs-comment">/**
     * 获取会话数据
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getSessionData</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">return</span> sessionData.get(key);
    }

    <span class="hljs-comment">/**
     * 获取所有属性
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getAllAttributes</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(attributes);
    }

    <span class="hljs-comment">/**
     * 清空属性
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        attributes.clear();
    }

    <span class="hljs-comment">/**
     * 获取上下文创建时间
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCreatedAt</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> createdAt;
    }

    <span class="hljs-comment">/**
     * 获取上下文存活时间（毫秒）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> System.currentTimeMillis() - createdAt;
    }

    <span class="hljs-comment">/**
     * 创建新的上下文
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentContext <span class="hljs-title function_">create</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> create(generateRequestId());
    }

    <span class="hljs-comment">/**
     * 创建带请求ID的上下文
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentContext <span class="hljs-title function_">create</span><span class="hljs-params">(String requestId)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentContext</span>(requestId);
    }

    <span class="hljs-comment">/**
     * 生成请求ID
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"req-"</span> + System.currentTimeMillis() + <span class="hljs-string">"-"</span> + Thread.currentThread().getId();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"AgentContext{"</span> +
                <span class="hljs-string">"requestId='"</span> + requestId + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", attributes="</span> + attributes.size() +
                <span class="hljs-string">", sessionData="</span> + sessionData.size() +
                <span class="hljs-string">", age="</span> + getAge() + <span class="hljs-string">"ms"</span> +
                <span class="hljs-string">'}'</span>;
    }
}

</code></pre>
<p>上下文分为临时属性和会话数据，临时属性在单次请求中有效，会话数据可以跨请求共享。</p>
<h3 data-id="heading-16">五、多Agent协作</h3>
<h4 data-id="heading-17">5.1 协作架构</h4>
<p>在复杂系统中，多个Agent协同工作可以完成更复杂的任务：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa77a39164004687bab75b4510b31ab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=wUtShnqzeUn8ZXZtQR7Enb5aNoE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Agent Orchestrator</strong>：协调整个系统的运行</li>
<li><strong>Message Bus</strong>：实现Agent间的异步通信</li>
<li><strong>Specialized Agents</strong>：专门处理特定领域的Agent</li>
</ul>
<h4 data-id="heading-18">5.2 消息传递</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageBus</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, List&lt;Agent&gt;&gt; subscribers;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(String topic, Message message)</span> {
        List&lt;Agent&gt; agents = subscribers.get(topic);
        <span class="hljs-keyword">for</span> (Agent agent : agents) {
            executor.submit(() -&gt;
                agent.execute(message.getContent(), message.getContext())
            );
        }
    }
}
</code></pre>
<h3 data-id="heading-19">六、实战案例：智能数据分析系统</h3>
<h4 data-id="heading-20">6.1 系统设计</h4>
<p>我们以一个智能数据分析系统为例，展示Agent Skills的实际应用：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8853fbcecc41c99e635eb5d607971c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=WVHMAx%2B8YVw6VJzMgtcYY1GeYJU%3D" alt="" loading="lazy"/></p>
<p>系统包含以下关键组件：</p>
<ul>
<li><strong>前端应用</strong>：Web界面和移动端</li>
<li><strong>API Gateway</strong>：统一入口，处理认证和限流</li>
<li><strong>Agent Layer</strong>：多个专门的数据处理Agent</li>
<li><strong>Skills Layer</strong>：8种核心技能</li>
<li><strong>Data Sources</strong>：多种数据源支持</li>
</ul>
<h4 data-id="heading-21">6.2 数据分析Agent实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> com.example.agent.Agent;
<span class="hljs-keyword">import</span> com.example.agent.AgentContext;
<span class="hljs-keyword">import</span> com.example.agent.BaseAgent;
<span class="hljs-keyword">import</span> com.example.skills.SkillResult;
<span class="hljs-keyword">import</span> com.example.skills.impl.DataQuerySkill;
<span class="hljs-keyword">import</span> com.example.skills.impl.FileReadSkill;
<span class="hljs-keyword">import</span> com.example.skills.impl.TextAnalysisSkill;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 数据分析Agent
 * 专门处理数据分析相关任务
 * <span class="hljs-doctag">@version</span> 1.0.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataAnalysisAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseAgent</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DataAnalysisAgent.class);

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataAnalysisAgent</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">"DataAnalysisAgent"</span>, <span class="hljs-string">"数据分析智能体，提供数据查询、分析和可视化能力"</span>);

        <span class="hljs-comment">// 注册技能</span>
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DataQuerySkill</span>());
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextAnalysisSkill</span>());
        registerSkill(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReadSkill</span>());
    }

    <span class="hljs-comment">/**
     * 执行数据分析任务
     */</span>
    <span class="hljs-keyword">public</span> Agent.AgentResult <span class="hljs-title function_">analyzeData</span><span class="hljs-params">(String query, AgentContext context)</span> {
        logger.info(<span class="hljs-string">"[DataAnalysisAgent] Starting data analysis: {}"</span>, query);

        <span class="hljs-comment">// 设置分析参数</span>
        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"tableName"</span>, <span class="hljs-string">"users"</span>);
        parameters.put(<span class="hljs-string">"condition"</span>, query);
        parameters.put(<span class="hljs-string">"limit"</span>, <span class="hljs-number">100</span>);

        context.setAttributes(parameters);

        <span class="hljs-keyword">return</span> execute(<span class="hljs-string">"查询用户数据: "</span> + query, context);
    }

    <span class="hljs-comment">/**
     * 生成数据分析报告
     */</span>
    <span class="hljs-keyword">public</span> Agent.AgentResult <span class="hljs-title function_">generateReport</span><span class="hljs-params">(String filePath, AgentContext context)</span> {
        logger.info(<span class="hljs-string">"[DataAnalysisAgent] Generating report from file: {}"</span>, filePath);

        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"filePath"</span>, filePath);

        context.setAttributes(parameters);

        <span class="hljs-type">AgentResult</span> <span class="hljs-variable">fileResult</span> <span class="hljs-operator">=</span> execute(<span class="hljs-string">"读取数据文件"</span>, context);

        <span class="hljs-keyword">if</span> (fileResult.isSuccess()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> fileResult.getData().toString();

            <span class="hljs-comment">// 分析文本内容</span>
            Map&lt;String, Object&gt; analysisParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            analysisParams.put(<span class="hljs-string">"text"</span>, content);
            analysisParams.put(<span class="hljs-string">"operation"</span>, <span class="hljs-string">"analyze"</span>);

            context.setAttributes(analysisParams);

            <span class="hljs-keyword">return</span> execute(<span class="hljs-string">"分析文本内容"</span>, context);
        }

        <span class="hljs-keyword">return</span> fileResult;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">preprocess</span><span class="hljs-params">(String task, AgentContext context)</span> {
        <span class="hljs-built_in">super</span>.preprocess(task, context);
        context.setAttribute(<span class="hljs-string">"agentType"</span>, <span class="hljs-string">"data-analysis"</span>);
        context.setAttribute(<span class="hljs-string">"timestamp"</span>, System.currentTimeMillis());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postprocess</span><span class="hljs-params">(String task, SkillResult result, AgentContext context)</span> {
        <span class="hljs-built_in">super</span>.postprocess(task, result, context);

        <span class="hljs-comment">// 记录分析结果</span>
        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            context.setSessionData(<span class="hljs-string">"lastAnalysis"</span>, result.getData());
            context.setSessionData(<span class="hljs-string">"lastAnalysisTime"</span>, System.currentTimeMillis());
        }
    }
}

</code></pre>
<h4 data-id="heading-22">6.3 使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 创建Agent</span>
        <span class="hljs-type">DataAnalysisAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataAnalysisAgent</span>();

        <span class="hljs-comment">// 执行查询</span>
        <span class="hljs-type">AgentContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> AgentContext.create();
        <span class="hljs-type">AgentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> agent.analyzeData(<span class="hljs-string">"技术部"</span>, context);

        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            System.out.println(<span class="hljs-string">"查询结果: "</span> + result.getData());
        }
    }
}
</code></pre>
<h3 data-id="heading-23">七、生产环境部署</h3>
<h4 data-id="heading-24">7.1 部署架构</h4>
<p>生产环境需要考虑高可用、可扩展和监控：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7102076b5f88431797a5cc1f30f72c89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770429086&amp;x-signature=65uOAjmiVi%2FYteisNlbPq75Y8Oc%3D" alt="" loading="lazy"/></p>
<p>关键设计要点：</p>
<ul>
<li><strong>负载均衡</strong>：使用Nginx或云负载均衡</li>
<li><strong>多副本部署</strong>：每个Agent部署多个实例</li>
<li><strong>监控体系</strong>：Prometheus + Grafana</li>
<li><strong>日志收集</strong>：ELK Stack统一管理日志</li>
</ul>
<h4 data-id="heading-25">7.2 性能优化</h4>
<ol>
<li><strong>连接池管理</strong>：复用数据库和HTTP连接</li>
<li><strong>异步执行</strong>：使用线程池并行处理任务</li>
<li><strong>缓存策略</strong>：缓存常用查询结果</li>
<li><strong>超时控制</strong>：防止技能执行时间过长</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseAgent</span> {
    <span class="hljs-keyword">protected</span> ExecutorService executorService;

    <span class="hljs-keyword">protected</span> SkillResult <span class="hljs-title function_">executeSkill</span><span class="hljs-params">(Skill skill, String task,
                                       Map&lt;String, Object&gt; parameters)</span> {
        Future&lt;SkillResult&gt; future = executorService.submit(
            () -&gt; skill.execute(task, parameters)
        );
        <span class="hljs-keyword">return</span> future.get(skill.getTimeout(), TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<h4 data-id="heading-26">7.3 错误处理</h4>
<p>完善的错误处理机制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    <span class="hljs-type">SkillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeSkill(skill, task, parameters);
    <span class="hljs-keyword">if</span> (result.isSuccess()) {
        <span class="hljs-keyword">return</span> AgentResult.success(result.getMessage(), result.getData());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 记录错误日志</span>
        logger.error(<span class="hljs-string">"Skill execution failed: {}"</span>, result.getError());
        <span class="hljs-comment">// 尝试备用技能</span>
        <span class="hljs-keyword">return</span> executeFallbackSkill(task, context);
    }
} <span class="hljs-keyword">catch</span> (TimeoutException e) {
    <span class="hljs-keyword">return</span> AgentResult.failure(<span class="hljs-string">"执行超时"</span>);
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">return</span> AgentResult.failure(<span class="hljs-string">"执行异常: "</span> + e.getMessage());
}
</code></pre>
<h3 data-id="heading-27">八、测试策略</h3>
<h4 data-id="heading-28">8.1 单元测试</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@DisplayName("TextAnalysisSkill测试")</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextAnalysisSkillTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-meta">@DisplayName("测试情感分析")</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSentimentAnalysis</span><span class="hljs-params">()</span> {
        <span class="hljs-type">TextAnalysisSkill</span> <span class="hljs-variable">skill</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextAnalysisSkill</span>();

        Map&lt;String, Object&gt; parameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        parameters.put(<span class="hljs-string">"text"</span>, <span class="hljs-string">"今天心情非常好！"</span>);
        parameters.put(<span class="hljs-string">"operation"</span>, <span class="hljs-string">"sentiment"</span>);

        <span class="hljs-type">SkillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> skill.execute(<span class="hljs-string">"情感分析"</span>, parameters);

        assertTrue(result.isSuccess());
        assertNotNull(result.getData());
    }
}
</code></pre>
<h4 data-id="heading-29">8.2 集成测试</h4>
<p>测试Agent与Skills的协作：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-meta">@DisplayName("测试Agent完整流程")</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">testAgentWorkflow</span><span class="hljs-params">()</span> {
    <span class="hljs-type">DataAnalysisAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataAnalysisAgent</span>();
    <span class="hljs-type">AgentContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> AgentContext.create();

    <span class="hljs-type">AgentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> agent.analyzeData(<span class="hljs-string">"技术部"</span>, context);

    assertTrue(result.isSuccess());
    assertNotNull(result.getData());
}
</code></pre>
<h3 data-id="heading-30">九、最佳实践</h3>
<h4 data-id="heading-31">9.1 技能设计原则</h4>
<ol>
<li><strong>单一职责</strong>：每个技能只做一件事</li>
<li><strong>幂等性</strong>：相同输入产生相同输出</li>
<li><strong>超时控制</strong>：设置合理的执行超时</li>
<li><strong>资源清理</strong>：执行完成后释放资源</li>
</ol>
<h4 data-id="heading-32">9.2 Agent设计原则</h4>
<ol>
<li><strong>专注领域</strong>：每个Agent专注特定领域</li>
<li><strong>可观测性</strong>：记录完整的执行日志</li>
<li><strong>容错性</strong>：优雅处理各种异常情况</li>
<li><strong>可测试性</strong>：便于编写单元测试</li>
</ol>
<h3 data-id="heading-33">十、总结</h3>
<p>Agent Skills工作流为我们提供了一种优雅的架构模式，将AI智能体与传统软件开发有机结合。</p>
<p>未来，随着AI技术的发展，Agent Skills将在更多领域发挥重要作用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-从 Vue 2 到 Vue 3：生命周期全图鉴与实战指南]]></title>    <link>https://juejin.cn/post/7601028900886806574</link>    <guid>https://juejin.cn/post/7601028900886806574</guid>    <pubDate>2026-01-31T04:19:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601028900886806574" data-draft-id="7600953879501783091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-从 Vue 2 到 Vue 3：生命周期全图鉴与实战指南"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-01-31T04:19:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-从 Vue 2 到 Vue 3：生命周期全图鉴与实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T04:19:37.000Z" title="Sat Jan 31 2026 04:19:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>生命周期钩子（Lifecycle Hooks）是 Vue 组件从诞生到销毁的全过程记录。掌握生命周期，不仅能让我们在正确的时间点执行逻辑，更是优化性能、排查内存泄露的关键。</p>
<h2 data-id="heading-1">一、 生命周期四大阶段</h2>
<p>Vue 的生命周期大体可分为：<strong>创建、挂载、更新、销毁</strong>。</p>
<hr/>
<h2 data-id="heading-2">二、 Vue 2 vs Vue 3 生命周期对比图</h2>
<p>在 Vue 3 组合式 API 中，生命周期钩子需要从 <code>vue</code> 中导入，且命名上增加了 <code>on</code> 前缀。</p>









































<table><thead><tr><th><strong>阶段</strong></th><th><strong>Vue 2 (选项式 API)</strong></th><th><strong>Vue 3 (组合式 API)</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><strong>创建</strong></td><td><code>beforeCreate</code> / <code>created</code></td><td><strong><code>setup()</code></strong></td><td>Vue 3 中 <code>setup</code> 包含了这两个时期</td></tr><tr><td><strong>挂载</strong></td><td><code>beforeMount</code> / <code>mounted</code></td><td><code>onBeforeMount</code> / <strong><code>onMounted</code></strong></td><td>常用：操作 DOM、请求接口</td></tr><tr><td><strong>更新</strong></td><td><code>beforeUpdate</code> / <code>updated</code></td><td><code>onBeforeUpdate</code> / <code>onUpdated</code></td><td>响应式数据变化时触发</td></tr><tr><td><strong>销毁</strong></td><td><code>beforeDestroy</code> / <code>destroyed</code></td><td><strong><code>onBeforeUnmount</code></strong> / <strong><code>onUnmounted</code></strong></td><td>注意：Vue 3 中命名的变更</td></tr><tr><td><strong>缓存</strong></td><td><code>activated</code> / <code>deactivated</code></td><td><code>onActivated</code> / <code>onDeactivated</code></td><td>配合 <code>&lt;keep-alive&gt;</code> 使用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">三、 详细解析与实战场景</h2>
<h3 data-id="heading-4">1. 创建阶段 (Creation)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeCreate</code> / <code>created</code>)</strong> ：</p>
<ul>
<li><code>beforeCreate</code>：组件实例刚在内存中被创建，此时还没有初始化好 <code>data</code> 和 <code>methods </code>属性。适合插件开发，注入全局变量。</li>
<li><code>created</code>：实例已创建，响应式数据<code>data、methods</code> 已准备好。
<ul>
<li><strong>场景</strong>：最早可发起异步请求的时机。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>setup</code>)</strong> ：</p>
<ul>
<li>在 Vue 3 中，<code>setup</code> 的执行早于 <code>beforeCreate</code>，它是组合式 API 的入口。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">2. 挂载阶段 (Mounting)</h3>
<ul>
<li><strong>Vue 2 (<code>beforeMount</code> / <code>mounted</code>)</strong> ：
<ul>
<li>
<p><code>beforeMount</code>：此时已经完成了模板的编译，但是还没有挂载到页面中</p>
</li>
<li>
<p><code>mounted</code>：此时已经将编译好的模板挂载到了页面指定的容器中，<strong>可以访问页面中的dom了</strong></p>
<ul>
<li>
<p><strong>场景</strong>：dom已创建，可用于获取接口数据和dom元素、访问子组件</p>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Vue 3 (<code>onBeforeMount</code> / <code>onMounted</code>)</strong> ：
<ul>
<li>
<p><code>onBeforeMount</code>：模板编译完成，但尚未渲染到 DOM 树中。</p>
</li>
<li>
<p><code>onMounted</code>：组件已挂载，可以安全地访问 DOM 元素。</p>
<ul>
<li><strong>场景</strong>：获取接口数据、初始化第三方插件（如 ECharts）、访问子组件。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">3. 更新阶段 (Updating)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeUpdate</code> / <code>updated</code>)</strong> ：</p>
<ul>
<li>
<p><code>beforeUpdate</code>：数据状态更新之前执行，此时 data 中的状态值是最新的，但是界面上显示的数据还是旧的，因为此时还没有开始重新渲染DOM节点。</p>
<ul>
<li><strong>场景</strong> ：此时view层还未更新，可用于获取更新前各种状态。</li>
</ul>
</li>
<li>
<p><code>updated</code>：实例更新完毕之后调用，此时 data 中的状态值和界面上显示的数据，都已经完成了更新，界面已经被重新渲染好了。</p>
</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>onBeforeUpdate</code> / <code>onUpdated</code>)</strong> ：</p>
<ul>
<li><code>onBeforeUpdate</code>：数据已更新，但 DOM 尚未重新渲染。可用于获取更新前的 DOM 状态。</li>
<li><code>onUpdated</code>：DOM 已完成更新。注意：不要在此钩子中修改状态，否则可能导致死循环。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">4. 销毁阶段 (Unmounting / Destruction)</h3>
<ul>
<li>
<p><strong>Vue 2 (<code>beforeDestroy</code> / <code>destroyed</code>)</strong> ：</p>
<ul>
<li><code> beforeDestroy</code>：实例销毁之前调用。
<ul>
<li><strong>场景</strong>：清理工作，如 <strong>清除定时器 (<code>setInterval</code>)、解绑全局事件监听、取消订阅</strong>。</li>
</ul>
</li>
<li><code>destroyed</code>：Vue 实例销毁后调用。组件彻底从 DOM 中移除，所有的指令和事件监听都会被解除。</li>
</ul>
</li>
<li>
<p><strong>Vue 3 (<code>onBeforeUnmount</code> / <code>onUnmounted</code>)</strong> ：</p>
<ul>
<li>
<p><code>onBeforeUnmount</code>：实例销毁之前调用。</p>
</li>
<li>
<p><code>onUnmounted</code>：组件彻底从 DOM 中移除，所有的指令和事件监听都会被解除。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">5. 缓存阶段 (Keep-alive)</h3>
<p><strong>如果使用了keep-alive缓存组件会新增两个生命周期函数</strong></p>
<ul>
<li><strong><code>onActivated</code></strong>：组件进入视野，被重新激活时调用。</li>
<li><strong><code>onDeactivated</code></strong>：组件移出视野，进入缓存状态时调用。</li>
</ul>
<h2 data-id="heading-9">四、 Vue 3 + TypeScript 实战演示</h2>
<p>以下是使用 <code>script setup</code> 语法编写的生命周期示例：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div ref="container"&gt;
    &lt;h2&gt;当前计数：{{ count }}&lt;/h2&gt;
    &lt;button @click="count++"&gt;增加&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { 
  ref, 
  onMounted, 
  onBeforeUpdate, 
  onUpdated, 
  onBeforeUnmount 
} from 'vue'

const count = ref&lt;number&gt;(0)
const container = ref&lt;HTMLElement | null&gt;(null)
let timer: number | null = null

// 挂载阶段
onMounted(() =&gt; {
  console.log('Component Mounted. DOM element:', container.value)
  // 模拟一个定时任务
  timer = window.setInterval(() =&gt; {
    console.log('Timer running...')
  }, 1000)
})

// 运行阶段
onBeforeUpdate(() =&gt; {
  console.log('Data updated, but DOM is not yet re-rendered.')
})

onUpdated(() =&gt; {
  console.log('Data updated and DOM re-rendered.')
})

// 销毁阶段
onBeforeUnmount(() =&gt; {
  console.log('Cleanup before unmount.')
  if (timer) {
    clearInterval(timer) // 关键：防止内存泄漏
  }
})
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-10">五、 进阶：父子组件生命周期执行顺序</h2>
<p>为了清晰起见，我们将顺序拆解为三个主要场景（vue3）：</p>
<h3 data-id="heading-11">1. 初始挂载阶段</h3>
<p>父组件必须等待所有子组件挂载完成后，才能完成自己的挂载逻辑。</p>
<ol>
<li><strong>父</strong> <code>setup</code>（开始创建）</li>
<li><strong>父</strong> <code>onBeforeMount</code></li>
<li><strong>子</strong> <code>setup</code></li>
<li><strong>子</strong> <code>onBeforeMount</code></li>
<li><strong>子</strong> <code>onMounted</code> （子组件渲染完毕，向上通知）</li>
<li><strong>父</strong> <code>onMounted</code> （父组件接收到信号，宣布整体挂载完毕）</li>
</ol>
<blockquote>
<p><strong>记忆口诀：</strong> 父创 -&gt; 子创 -&gt; 子挂 -&gt; 父挂。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">2. 更新阶段</h3>
<p>当父组件传递给子组件的 <code>props</code> 发生变化时，更新逻辑如下：</p>
<ul>
<li><strong>父</strong> <code>onBeforeUpdate</code></li>
<li><strong>子</strong> <code>onBeforeUpdate</code></li>
<li><strong>子</strong> <code>onUpdated</code></li>
<li><strong>父</strong> <code>onUpdated</code></li>
</ul>
<blockquote>
<p><strong>注意：</strong> 如果只是父组件自身的私有状态更新，且未影响到子组件，则子组件的更新钩子不会被触发。</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">3. 销毁阶段</h3>
<p>销毁过程同样是“递归”式的，父组件先启动销毁，等子组件销毁完毕后，父组件正式功成身退。</p>
<ol>
<li><strong>父</strong> <code>onBeforeUnmount</code></li>
<li><strong>子</strong> <code>onBeforeUnmount</code></li>
<li><strong>子</strong> <code>unmounted</code></li>
<li><strong>父</strong> <code>onUnmounted</code></li>
</ol>
<hr/>
<h2 data-id="heading-14">六、 Vue 3 + TS 模拟演示</h2>
<p>你可以通过以下代码在控制台直接观察执行逻辑。</p>
<h3 data-id="heading-15">父组件 <code>Parent.vue</code></h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { onMounted, onBeforeMount } from 'vue'
import Child from './Child.vue'

console.log('1. 父 - setup')

onBeforeMount(() =&gt; console.log('3. 父 - onBeforeMount'))
onMounted(() =&gt; console.log('8. 父 - onMounted'))
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="parent"&gt;
    &lt;h1&gt;父组件&lt;/h1&gt;
    &lt;Child /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-16">子组件 <code>Child.vue</code></h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { onMounted, onBeforeMount } from 'vue'

console.log('4. 子 - setup')

onBeforeMount(() =&gt; console.log('6. 子 - onBeforeMount'))
onMounted(() =&gt; console.log('7. 子 - onMounted'))
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="child"&gt;子组件内容&lt;/div&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h2 data-id="heading-17">📝 总结与避坑</h2>
<ol>
<li>
<p><strong>接口请求放哪里？</strong></p>
<ul>
<li>如果子组件的渲染依赖父组件接口返回的数据，请在父组件的 <code>created</code>（Vue 2）或 <code>setup</code>（Vue 3）中请求。</li>
<li><strong>注意</strong>：即便你在父组件的 <code>onMounted</code> 发请求，子组件此时也已经渲染完成了。</li>
</ul>
</li>
<li>
<p><strong>Refs 访问时机</strong>：</p>
<ul>
<li>父组件想通过 <code>ref</code> 访问子组件实例，<strong>必须</strong>在父组件的 <code>onMounted</code> 之后，因为只有这时子组件才真正挂载完成。</li>
</ul>
</li>
<li>
<p><strong>异步组件</strong>：</p>
<ul>
<li>如果子组件是异步组件（如使用 <code>defineAsyncComponent</code>），顺序会发生变化，父组件可能会先执行 <code>onMounted</code>。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据“显微镜”：蜂群图让每个数据点都发声]]></title>    <link>https://juejin.cn/post/7601018079620530191</link>    <guid>https://juejin.cn/post/7601018079620530191</guid>    <pubDate>2026-01-31T06:21:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601018079620530191" data-draft-id="7601049142865477632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据“显微镜”：蜂群图让每个数据点都发声"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-31T06:21:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据“显微镜”：蜂群图让每个数据点都发声
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T06:21:08.000Z" title="Sat Jan 31 2026 06:21:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下夏日的花丛中，成群的蜜蜂围绕着花朵忙碌地飞舞。每只蜜蜂都是一个独立的数据点，它们既保持群体聚集的形态，又不会完全重叠在一起。</p>
<p>这就是<strong>蜂群图</strong>（<code>Swarm Plot</code>）的<strong>核心理念</strong>——在有限的空间内展示所有数据点，让每个点都能被清晰看见。</p>
<p><strong>蜂群图</strong>是一种特殊的数据可视化图表，它将分类数据与数值数据结合起来，展示数据的分布情况。</p>
<p>与传统的条形图或箱线图不同，蜂群图不进行任何数据聚合，而是展示每一个原始数据点，避免了信息丢失。</p>
<h2 data-id="heading-0">1. 蜂群图核心特点</h2>
<p><strong>蜂群图</strong>最巧妙的地方在于它的布局算法。</p>
<p>当多个数据点具有相似数值时，它们不会简单地重叠在一起，而是像有“排斥力”一样，在垂直方向（或水平方向）上轻微偏移，形成一个类似蜂群的分布。</p>
<p>比如，下面是<strong>同一组数据</strong>在<strong>散点图</strong>和<strong>蜂群图</strong>中展示的效果。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4caf03d4b0d24f74842c22c27c2a702e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=0MjPiDO20sLmLVRzrLMrrIF6Wwk%3D" alt="" loading="lazy"/></p>
<p>从中可以看出蜂群图的核心特点有：</p>
<ol>
<li><strong>绝不重叠</strong>： 它通过算法检测数据点的重叠情况，一旦发现两个点数值相近，就会自动把它们向水平方向推开。</li>
<li><strong>保留分布形态</strong>： 散开后的形状，天然形成了一种类似“小提琴”或“山峰”的轮廓，直观地展示了数据的密度。</li>
<li><strong>参数调整</strong>： 我们可以调整点的大小（marker size）和排列的紧密程度。点越大，视觉冲击力越强，但需要的水平空间也越多。</li>
</ol>
<h2 data-id="heading-1">2. 蜂群图 vs. 条形图：从摘要到细节</h2>
<p><strong>条形图</strong>就像是一份数据摘要报告，它告诉我们每个类别的平均值或总计值，但隐藏了数据内部的分布细节。</p>
<p>而<strong>蜂群图</strong>则像是一次数据点的全员大会，每个数据点都有发言的机会。</p>
<p>下面针对同一组数据，我们分别绘制了<strong>条形图</strong>、<strong>箱线图</strong>和<strong>蜂群图</strong>，一起来感受一下它们之间不同的展示效果。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成示例数据</span>
np.random.seed(<span class="hljs-number">123</span>)
categories = [<span class="hljs-string">"产品A"</span>, <span class="hljs-string">"产品B"</span>, <span class="hljs-string">"产品C"</span>, <span class="hljs-string">"产品D"</span>]
data_comparison = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    n_points = <span class="hljs-number">40</span>
    <span class="hljs-keyword">if</span> category == <span class="hljs-string">"产品A"</span>:
        values = np.random.normal(<span class="hljs-number">75</span>, <span class="hljs-number">8</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"产品B"</span>:
        values = np.random.normal(<span class="hljs-number">82</span>, <span class="hljs-number">12</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"产品C"</span>:
        values = np.random.normal(<span class="hljs-number">65</span>, <span class="hljs-number">5</span>, n_points)
    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 产品D</span>
        <span class="hljs-comment"># 创建一个双峰分布</span>
        values1 = np.random.normal(<span class="hljs-number">55</span>, <span class="hljs-number">6</span>, n_points // <span class="hljs-number">2</span>)
        values2 = np.random.normal(<span class="hljs-number">85</span>, <span class="hljs-number">7</span>, n_points // <span class="hljs-number">2</span>)
        values = np.concatenate([values1, values2])

    <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values:
        data_comparison.append({<span class="hljs-string">"产品"</span>: category, <span class="hljs-string">"用户评分"</span>: value})

<span class="hljs-comment"># 1. 条形图（平均值）</span>
means = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    cat_data = [d[<span class="hljs-string">"用户评分"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data_comparison <span class="hljs-keyword">if</span> d[<span class="hljs-string">"产品"</span>] == category]
    means.append(np.mean(cat_data))

bars = axes[<span class="hljs-number">0</span>].bar(
    categories, means, color=[<span class="hljs-string">"#1f77b4"</span>, <span class="hljs-string">"#ff7f0e"</span>, <span class="hljs-string">"#2ca02c"</span>, <span class="hljs-string">"#d62728"</span>]
)


<span class="hljs-comment"># 在条形上标注平均值</span>
<span class="hljs-comment"># 省略...</span>

<span class="hljs-comment"># 2. 箱线图</span>
box_data = []
<span class="hljs-keyword">for</span> category <span class="hljs-keyword">in</span> categories:
    cat_data = [d[<span class="hljs-string">"用户评分"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data_comparison <span class="hljs-keyword">if</span> d[<span class="hljs-string">"产品"</span>] == category]
    box_data.append(cat_data)

boxplot = axes[<span class="hljs-number">1</span>].boxplot(
    box_data, tick_labels=categories, patch_artist=<span class="hljs-literal">True</span>, boxprops=<span class="hljs-built_in">dict</span>(facecolor=<span class="hljs-string">"lightblue"</span>)
)
<span class="hljs-comment"># 省略...</span>

<span class="hljs-comment"># 3. 蜂群图</span>
data_df = pd.DataFrame(data_comparison)
sns.swarmplot(
    x=<span class="hljs-string">"产品"</span>,
    y=<span class="hljs-string">"用户评分"</span>,
    hue=<span class="hljs-string">"产品"</span>,
    data=data_df,
    ax=axes[<span class="hljs-number">2</span>],
    size=<span class="hljs-number">5</span>,
    palette=<span class="hljs-string">"Set2"</span>,
    edgecolor=<span class="hljs-string">"black"</span>,
    linewidth=<span class="hljs-number">0.5</span>,
)
<span class="hljs-comment"># 省略...</span>

plt.tight_layout()
plt.show()

</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95d09191b174b04afe13368017263c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=SWcMKvD0V3DjIb2CgnNpxYsZJRc%3D" alt="" loading="lazy"/></p>
<p>绘制蜂群图可以用<code>seaborn</code>这个库中的<code>swarmplot</code>函数。</p>
<p>从上面的对比可以看出：</p>
<ul>
<li><strong>条形图</strong>告诉我们产品D的平均分约为70分</li>
<li><strong>箱线图</strong>提示产品D的数据分布范围很广</li>
<li>但只有<strong>蜂群图</strong>清晰地揭示了产品D实际上有两个明显的用户群体：一个低评分群体和一个高评分群体</li>
</ul>
<h2 data-id="heading-2">3. 蜂群图 vs. 散点图：从混乱到有序</h2>
<p>传统<strong>散点图</strong>在处理分类数据时，常常导致数据点大量重叠，形成"黑团"，我们无法看清数据点的真实分布。</p>
<p><strong>蜂群图</strong>通过智能布局算法解决了这个问题。</p>
<p>下面构造一个不同密度的数据，看看蜂群图和散点图的展示效果。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 比较散点图与蜂群图的视觉效果</span>
fig, axes = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 生成具有不同密度的数据</span>
np.random.seed(<span class="hljs-number">42</span>)
density_data = []
categories = [<span class="hljs-string">"低密度"</span>, <span class="hljs-string">"中等密度"</span>, <span class="hljs-string">"高密度"</span>]
<span class="hljs-keyword">for</span> i, category <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(categories):
    n_points = <span class="hljs-number">20</span> + i * <span class="hljs-number">30</span>  <span class="hljs-comment"># 不同密度</span>
    <span class="hljs-keyword">if</span> category == <span class="hljs-string">"低密度"</span>:
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">15</span>, n_points)
    <span class="hljs-keyword">elif</span> category == <span class="hljs-string">"中等密度"</span>:
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">8</span>, n_points)
    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 高密度</span>
        values = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">4</span>, n_points)

    <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> values:
        density_data.append({<span class="hljs-string">"类别"</span>: category, <span class="hljs-string">"数值"</span>: value})

<span class="hljs-comment"># 左侧：传统散点图</span>
<span class="hljs-keyword">for</span> i, category <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(categories):
    cat_data = [d[<span class="hljs-string">"数值"</span>] <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> density_data <span class="hljs-keyword">if</span> d[<span class="hljs-string">"类别"</span>] == category]
    x_positions = np.full(<span class="hljs-built_in">len</span>(cat_data), i)
    axes[<span class="hljs-number">0</span>].scatter(x_positions, cat_data, alpha=<span class="hljs-number">0.6</span>, s=<span class="hljs-number">60</span>, label=category)

<span class="hljs-comment">#省略...</span>

<span class="hljs-comment"># 右侧：蜂群图</span>
density_data_df = pd.DataFrame(density_data)
sns.swarmplot(
    x=<span class="hljs-string">"类别"</span>,
    y=<span class="hljs-string">"数值"</span>,
    hue=<span class="hljs-string">"类别"</span>,
    data=density_data_df,
    ax=axes[<span class="hljs-number">1</span>],
    size=<span class="hljs-number">6</span>,
    palette=<span class="hljs-string">"coolwarm"</span>,
    edgecolor=<span class="hljs-string">"black"</span>,
    linewidth=<span class="hljs-number">0.5</span>,
)
<span class="hljs-comment">#省略...</span>

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e57e532d22f4ad4a068c2c244080e88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770445271&amp;x-signature=5%2BeEHyWRB4VpR%2BOvr3UTi4Y%2BqGw%3D" alt="" loading="lazy"/></p>
<p><strong>蜂群图</strong>解决了 <strong>“重叠（Overplotting）”</strong> 的问题。在数据量适中（几百到几千个点）时，它是展示分布密度的最佳选择。</p>
<h2 data-id="heading-3">4. 蜂群图的适用场景</h2>
<p><strong>蜂群图</strong>并不是为了取代<strong>条形图</strong>或<strong>散点图</strong>，它有自己的适用场景和局限性。</p>
<p>适合使用<strong>蜂群图</strong>的场景：</p>
<ul>
<li>样本量适中（通常少于几百个点）时，展示完整数据分布</li>
<li>需要同时看到整体趋势和个体数据点</li>
<li>数据有多个分类变量，需要比较不同类别分布</li>
<li>希望发现异常值或特殊模式（如双峰分布）</li>
</ul>
<p/>
<p><strong>蜂群图</strong>的<strong>局限性</strong>主要有：</p>
<ol>
<li>大数据集可能导致图表过于拥挤</li>
<li>对于非常大规模数据，箱线图或小提琴图可能更合适</li>
<li>精确的数值比较不如条形图直观</li>
</ol>
<h2 data-id="heading-4">5. 总结</h2>
<p><strong>蜂群图</strong>就像数据可视化领域的"显微镜"，它让我们既能观察到数据的整体分布形态，又能看到每一个数据点的具体位置。</p>
<p>与只能显示摘要信息的<strong>条形图</strong>和容易产生重叠的<strong>散点图</strong>相比，<strong>蜂群图</strong>在显示中小型数据集的完整分布信息方面具有独特优势。</p>
<p>在数据可视化实践中，选择正确的图表类型就像选择正确的工具一样重要。</p>
<p>当下一次你需要展示分类数据的分布时，不妨尝试一下蜂群图，它可能会揭示出你从未注意到的数据秘密。</p>
<p>文中的完整代码共享在：<a href="https://link.juejin.cn?target=https%3A%2F%2Furl11.ctfile.com%2Ff%2F45455611-8639900394-9a109f%3Fp%3D6872" target="_blank" title="https://url11.ctfile.com/f/45455611-8639900394-9a109f?p=6872" ref="nofollow noopener noreferrer">蜂群图.ipynb</a> (访问密码: 6872)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建无障碍组件之Breadcrumb Pattern]]></title>    <link>https://juejin.cn/post/7601169987396436019</link>    <guid>https://juejin.cn/post/7601169987396436019</guid>    <pubDate>2026-01-31T08:32:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169987396436019" data-draft-id="7600982613655126066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建无障碍组件之Breadcrumb Pattern"/> <meta itemprop="keywords" content="前端,设计,HTML"/> <meta itemprop="datePublished" content="2026-01-31T08:32:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="anOnion"/> <meta itemprop="url" content="https://juejin.cn/user/553809592722589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建无障碍组件之Breadcrumb Pattern
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592722589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    anOnion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T08:32:47.000Z" title="Sat Jan 31 2026 08:32:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Breadcrumb Pattern 详解：构建无障碍面包屑导航</h2>
<p>面包屑导航是 Web 页面中不可或缺的导航组件，它以层级链接的形式展示当前页面在网站结构中的位置，帮助用户快速了解自己所处的位置并轻松返回上级页面。根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Fbreadcrumb%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/breadcrumb/" ref="nofollow noopener noreferrer">W3C WAI-ARIA Breadcrumb Pattern</a> 规范，正确实现的面包屑导航不仅要提供清晰的层级导航路径，更要确保所有用户都能顺利使用，包括依赖屏幕阅读器等辅助技术的用户。本文将深入探讨 Breadcrumb Pattern 的核心概念、实现要点以及最佳实践。</p>
<h3 data-id="heading-1">一、面包屑导航的定义与核心功能</h3>
<p>面包屑导航（Breadcrumb Trail）是由一系列指向父级页面的链接组成的导航路径，按照层级顺序展示当前页面在网站架构中的位置。它的主要功能是帮助用户了解自己在网站中的位置，并在需要时快速返回上级页面。面包屑导航通常水平放置在页面主体内容之前，为用户提供清晰的导航参考。</p>
<p>在实际应用中，面包屑导航广泛应用于内容层级较深的网站，例如电商平台的产品分类页、博客文章的分类归档页、企业官网的产品介绍页等。一个设计良好的面包屑导航能够显著提升用户体验，降低用户的迷失感，同时也有利于搜索引擎更好地理解网站的结构层次。</p>
<h3 data-id="heading-2">二、键盘交互规范</h3>
<p>面包屑导航的键盘交互具有特殊性。由于面包屑导航仅由静态链接组成，用户不需要进行任何特殊的键盘操作来与之交互。链接本身已经支持标准的键盘导航行为，用户可以通过 Tab 键在各个链接之间切换，通过 Enter 键激活链接进行页面跳转。这种标准的行为已经满足了键盘可访问性的要求，无需额外的键盘事件处理。</p>
<p>因此，Breadcrumb Pattern 规范明确指出，面包屑导航不需要特殊的键盘交互支持。开发者只需要确保链接元素是标准的 HTML 元素，即可获得完整的键盘可访问性支持。这一特点使得面包屑导航的实现相对简单，重点应放在正确的语义标记和 ARIA 属性使用上。</p>
<h3 data-id="heading-3">三、WAI-ARIA 角色、状态和属性</h3>
<p>正确使用 WAI-ARIA 属性是构建无障碍面包屑导航的技术基础。虽然面包屑导航不涉及复杂的交互逻辑，但正确的语义标记对于屏幕阅读器用户理解导航结构至关重要。</p>
<h4 data-id="heading-4">3.1 导航容器标记</h4>
<p>面包屑导航必须放置在导航地标区域（Navigation Landmark）内。这可以通过使用 nav 元素或为其他元素添加 role="navigation" 来实现。导航地标区域需要通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-labelledby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-labelledby" ref="nofollow noopener noreferrer">aria-labelledby</a> 进行标记，以便屏幕阅读器向用户描述这个导航区域的用途。</p>
<p>示例：使用 nav 元素包裹面包屑导航：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/"</span>&gt;</span>产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/electronics/"</span>&gt;</span>电子产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>笔记本电脑<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<p>示例：使用 role 属性定义导航地标：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"navigation"</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/blog/"</span>&gt;</span>博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>2025 年技术趋势<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">3.2 当前页面状态标记</h4>
<p>面包屑导航中的当前页面链接需要使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a> 属性来标识。aria-current="page" 明确告诉辅助技术当前元素代表的是用户正在浏览的页面。这一属性对于屏幕阅读器用户理解面包屑导航的结构非常重要，使他们能够区分可导航的父级页面和当前所在页面。</p>
<p>值得注意的是，如果代表当前页面的元素不是链接（例如使用 span 或其他元素呈现），那么 aria-current 属性是可选的。但为了保持一致性，建议始终为当前页面元素添加 aria-current="page"。</p>
<p>示例：当前页面为链接时的标记：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>文档<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/guides/"</span>&gt;</span>指南<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/guides/getting-started/"</span>
        <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>
        &gt;</span>快速入门&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<p>示例：当前页面为非链接元素时的标记：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/shop/"</span>&gt;</span>商店<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/shop/clothing/"</span>&gt;</span>服装<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>春季新品<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">四、完整示例</h3>
<p>以下是使用不同方式实现面包屑导航的完整示例，展示了标准的 HTML 结构、ARIA 属性应用以及样式设计：</p>
<h4 data-id="heading-7">4.1 基础面包屑导航实现</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/"</span>&gt;</span>所有产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/products/electronics/"</span>&gt;</span>电子产品<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>智能手表<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">4.2 带分隔符的面包屑导航</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-nav"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>首页&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/categories/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>分类&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span>
        <span class="hljs-attr">href</span>=<span class="hljs-string">"/categories/books/"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-link"</span>
        &gt;</span>图书&lt;/a
      &gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-separator"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>
      /
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>
      <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-current"</span>&gt;</span>编程指南<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">4.3 电商网站产品页面包屑导航</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>
  <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"商品位置"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"product-breadcrumb"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/"</span>&gt;</span>家用电器<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/kitchen/"</span>&gt;</span>厨房电器<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/electronics/kitchen/coffee/"</span>&gt;</span>咖啡机<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>全自动咖啡机 X2000<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">五、最佳实践</h3>
<h4 data-id="heading-11">5.1 语义化 HTML 结构</h4>
<p>面包屑导航应使用语义化的 HTML 元素构建。使用 nav 元素定义导航区域，使用 ol 或 ul 元素创建有序或无序列表，使用 li 元素包含各个导航项。这种结构不仅对搜索引擎友好，也便于屏幕阅读器向用户传达导航的层级关系。</p>
<p>在列表的选择上，ol 元素更适合面包屑导航，因为它能够传达各个项之间的顺序关系。但如果网站没有强制的层级顺序要求，ul 元素同样可以接受。无论选择哪种列表元素，都要确保列表项之间的逻辑顺序与面包屑导航的层级结构保持一致。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 推荐做法：使用语义化元素 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/docs/"</span>&gt;</span>文档<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>当前页面<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">5.2 正确使用 ARIA 属性</h4>
<p>面包屑导航的 ARIA 属性使用相对简单，但有几个关键点需要注意。首先，导航容器必须使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-labelledby" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-labelledby" ref="nofollow noopener noreferrer">aria-labelledby</a> 进行标记，以便用户了解这个导航区域的用途。其次，当前页面项必须使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page" 进行标记。最后，确保分隔符元素使用 aria-hidden="true"，以避免辅助技术用户听到不必要的标点符号朗读。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ARIA 属性使用规范 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"面包屑导航"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/blog/"</span>&gt;</span>博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">aria-current</span>=<span class="hljs-string">"page"</span>&gt;</span>文章标题<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">5.3 响应式设计考虑</h4>
<p>面包屑导航在移动设备上可能面临空间受限的挑战。对于层级较深的导航，可以考虑以下策略：一是使用省略号隐藏中间层级，只保留首页和最后几级；二是允许用户展开查看完整路径；三是将面包屑导航改为垂直布局。无论采用哪种策略，都要确保用户能够访问完整的导航信息。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 响应式面包屑导航 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.breadcrumb-list</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
  }

  <span class="hljs-selector-class">.breadcrumb-separator</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">90deg</span>);
  }
}
</code></pre>
<h3 data-id="heading-14">六、面包屑导航与主导航的区别</h3>
<p>面包屑导航和主导航栏虽然都是网站导航的重要组成部分，但它们服务于不同的目的，理解这种区别对于正确使用这两种导航组件至关重要。</p>
<p>面包屑导航的主要作用是展示用户在网站层级结构中的当前位置，它反映的是网站的逻辑结构，而非用户的浏览历史。面包屑导航通常只出现在层级较深的页面中，帮助用户理解当前位置与网站整体结构的关系。相比之下，主导航栏提供的是网站的整体架构概览，允许用户直接跳转到任何主要版块，而不考虑当前的层级位置。</p>
<p>从实现角度来看，面包屑导航强调的是层级关系，因此通常使用有序列表（ol）来体现这种顺序性。而主导航栏更强调功能分区的划分，可能使用无序列表（ul）或更复杂的布局结构。两者在 ARIA 属性使用上也不同：面包屑导航需要明确标记当前页面（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page"），而主导航栏通常不需要这种标记。</p>
<h3 data-id="heading-15">七、总结</h3>
<p>构建无障碍的面包屑导航需要关注语义化结构、ARIA 属性应用和视觉样式三个层面的细节。从语义化角度，应使用 nav 元素定义导航区域，使用 ol 或 ul 元素创建列表结构。从 ARIA 属性角度，需要使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-label" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-label" ref="nofollow noopener noreferrer">aria-label</a> 为导航区域提供标签，使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23aria-current" target="_blank" title="https://www.w3.org/TR/wai-aria-1.2/#aria-current" ref="nofollow noopener noreferrer">aria-current</a>="page" 标记当前页面。从视觉样式角度，应确保链接易于识别，分隔符清晰，当前页面状态明确。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Fbreadcrumb%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/breadcrumb/" ref="nofollow noopener noreferrer">WAI-ARIA Breadcrumb Pattern</a> 为我们提供了清晰的指导方针，遵循这些规范能够帮助我们创建更加包容和易用的 Web 应用。每一个正确实现的面包屑导航组件，都是提升用户体验和网站可访问性的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第0章 GStreamer开发环境配置 (2026.02.1 v1.0.0)]]></title>    <link>https://juejin.cn/post/7601444617694887946</link>    <guid>https://juejin.cn/post/7601444617694887946</guid>    <pubDate>2026-02-01T09:59:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601444617694887946" data-draft-id="7601169244454928410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第0章 GStreamer开发环境配置 (2026.02.1 v1.0.0)"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T09:59:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="微_笑_i"/> <meta itemprop="url" content="https://juejin.cn/user/1593637795532043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第0章 GStreamer开发环境配置 (2026.02.1 v1.0.0)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1593637795532043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    微_笑_i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:59:32.000Z" title="Sun Feb 01 2026 09:59:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>所有示例代码和详细笔记都开源在GitHub仓库中，持续更新：<strong>👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZongChang-Liu%2FGStreamerLearning" target="_blank" title="https://github.com/ZongChang-Liu/GStreamerLearning" ref="nofollow noopener noreferrer">github.com/ZongChang-L…</a></strong></p>
<hr/>
<h2 data-id="heading-0">第0章 GStreamer开发环境配置 <em>(2026.02.1 v1.0.0)</em></h2>
<p><strong>本章内容主要介绍如何在不同操作系统上配置GStreamer的开发环境，并通过简单程序验证配置是否成功。</strong></p>
<p><strong>如果您已有GStreamer开发环境配置经验，可以跳过本章内容，直接进入下一章。</strong></p>
<p><strong>如果您是第一次接触GStreamer，请详细阅读本章内容，以确保开发环境配置正确无误。</strong></p>
<hr/>
<h3 data-id="heading-1">🎯 本章目标</h3>
<p>通过本章学习，您将能够：</p>
<ol>
<li>
<p>在Windows/Linux/macOS系统上正确安装GStreamer</p>
</li>
<li>
<p>配置必要的环境变量和依赖项</p>
</li>
<li>
<p>使用CMake构建包含GStreamer的项目</p>
</li>
<li>
<p>编写并运行一个简单的GStreamer程序</p>
</li>
</ol>
<h3 data-id="heading-2">📚 目录</h3>
<ul>
<li>
<p><a href="#-windows%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" title="#-windows%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">🪟 Windows下配置GStreamer开发环境</a></p>
</li>
<li>
<p><a href="#-linux%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" title="#-linux%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">🐧 Linux下配置GStreamer开发环境</a></p>
</li>
<li>
<p><a href="#-macos%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" title="#-macos%E4%B8%8B%E9%85%8D%E7%BD%AEgstreamer%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">🍎 macOS下配置GStreamer开发环境</a></p>
</li>
<li>
<p><a href="#-cmake%E9%A1%B9%E7%9B%AE%E5%BC%95%E5%85%A5gstreamer" title="#-cmake%E9%A1%B9%E7%9B%AE%E5%BC%95%E5%85%A5gstreamer">🔧 CMake项目引入GStreamer</a></p>
</li>
<li>
<p><a href="#-hello-gstreamer%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E4%B8%8E%E8%BF%90%E8%A1%8C" title="#-hello-gstreamer%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E4%B8%8E%E8%BF%90%E8%A1%8C">👋 Hello GStreamer程序编写与运行</a></p>
</li>
<li>
<p><a href="#-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94" title="#-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94">❓ 常见问题解答</a></p>
</li>
<li>
<p><a href="#-%E5%B0%8F%E7%BB%93" title="#-%E5%B0%8F%E7%BB%93">📝 小结</a></p>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">🪟 Windows下配置GStreamer开发环境</h3>
<h4 data-id="heading-4">安装GStreamer</h4>
<h5 data-id="heading-5">1. 访问GStreamer官方网站的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgstreamer.freedesktop.org%2Fdownload%2F" target="_blank" title="https://gstreamer.freedesktop.org/download/" ref="nofollow noopener noreferrer">下载页面</a></h5>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-1.png" alt="00-1.png" loading="lazy"/></p>
<h5 data-id="heading-6">2. 选择适合您系统的安装包。</h5>
<blockquote>
<p>💡 <strong>版本选择建议</strong></p>
<ul>
<li><strong>MSVC版本</strong>：如果您使用Visual Studio进行开发</li>
<li><strong>MinGW版本</strong>：如果您使用MinGW/GCC进行开发</li>
<li>通常建议选择<strong>MSVC 64-bit</strong>版本以兼容大多数开发环境</li>
</ul>
</blockquote>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-2.png" alt="00-2.png" loading="lazy"/></p>
<h5 data-id="heading-7">3. 下载完成后，以管理员身份运行安装程序，按照提示完成安装：</h5>
<ol>
<li>选择安装类型：建议选择"Install for all users"</li>
<li>安装路径：建议使用默认路径（<code>C:\Program Files\gstreamer\1.0\msvc_x86_64</code>）</li>
<li>选择组件：建议选择"Full installation"安装，以确保所有必要插件可用</li>
</ol>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-3.png" alt="00-3.png" loading="lazy"/></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-4.png" alt="00-4.png" loading="lazy"/></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-5.png" alt="00-5.png" loading="lazy"/></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-6.png" alt="00-6.png" loading="lazy"/></p>
<h5 data-id="heading-8">4. 配置环境变量</h5>
<h6 data-id="heading-9">4.1 打开环境变量设置</h6>
<p>在Windows搜索栏中输入"环境变量"，选择"编辑系统环境变量"。</p>
<blockquote>
<p>⚠️ <strong>注意</strong>：配置系统环境变量需要管理员权限。如果无法修改系统变量，可以配置用户环境变量，配置方法类似。</p>
</blockquote>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-8_1.png" alt="00-8.png" loading="lazy"/></p>
<h6 data-id="heading-10">4.2 编辑Path变量</h6>
<ol>
<li>
<p>在"系统属性"窗口中点击"环境变量"</p>
</li>
<li>
<p>在"系统变量"部分选择"Path"，点击"编辑"</p>
</li>
<li>
<p>点击"新建"，添加GStreamer的bin目录路径</p>
</li>
</ol>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-9_1.png" alt="00-9.png" loading="lazy"/></p>
<p><strong>默认路径为：</strong></p>
<ul>
<li>MSVC版本：<code>C:\Program Files\gstreamer\1.0\msvc_x86_64\bin</code> (如果安装的是MSVC 64-bit版本)</li>
</ul>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-10_1.png" alt="00-10.png" loading="lazy"/></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-11_1.png" alt="00-11.png" loading="lazy"/></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-12_1.png" alt="00-12.png" loading="lazy"/></p>
<h4 data-id="heading-11">验证环境变量配置</h4>
<p>打开<strong>新的</strong>命令提示符（重要！需要重新加载环境变量），执行以下命令：</p>
<p><strong>验证gst-launch-1.0工具</strong></p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 --version
</code></pre>
<p>如果显示版本信息说明安装成功！</p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-13_1.png" alt="00-13.png" loading="lazy"/></p>
<p><strong>测试视频流水线</strong>（应该能看到测试图案窗口）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 videotestsrc ! autovideosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-14_1.png" alt="00-14.png" loading="lazy"/></p>
<p><strong>测试音频流水线</strong>（应该能听到测试音频）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 audiotestsrc ! autoaudiosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-15_1.png" alt="00-15.png" loading="lazy"/></p>
<blockquote>
<p>⚠️ <strong>如果遇到"命令未找到"错误</strong></p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-16_1.png" alt="00-16_1.png" loading="lazy"/></p>
<p><strong>请按以下步骤排查：</strong></p>
<ol>
<li>
<p>检查环境变量Path是否正确配置</p>
</li>
<li>
<p>关闭所有命令提示符窗口，重新打开一个新的</p>
</li>
<li>
<p>如果仍不行，尝试重启计算机</p>
</li>
<li>
<p>手动进入GStreamer的bin目录执行命令，确认安装无误</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>⚠️ <strong>关于Windows版本的注意事项</strong></p>
<p>在1.28.0之前的版本，GStreamer的Windows安装包分为Runtime和Development两部分。Runtime包含运行时所需的库，而Development包含开发所需的头文件和库文件。</p>
<p><strong>从1.28.0版本开始</strong>，GStreamer将这两部分合并为一个安装包，简化了安装过程。现在，安装GStreamer时，只需下载并安装一个包含Runtime和Development的完整包即可，无需分别安装两部分。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">🐧 Linux下配置GStreamer开发环境</h3>
<h4 data-id="heading-13">安装GStreamer</h4>
<h5 data-id="heading-14">Ubuntu/Debian系统</h5>
<p><strong>更新软件包列表</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo apt update 
</code></pre>
<p><strong>安装GStreamer核心库和开发文件</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo apt install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
                 libgstreamer-plugins-good1.0-dev libgstreamer-plugins-bad1.0-dev \
                 gstreamer1.0-plugins-base gstreamer1.0-plugins-good \
                 gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly \
                 gstreamer1.0-libav gstreamer1.0-tools \
                 gstreamer1.0-x gstreamer1.0-alsa gstreamer1.0-gl \
                 gstreamer1.0-gtk3 gstreamer1.0-qt5 \
                 gstreamer1.0-pulseaudio
</code></pre>
<h4 data-id="heading-15">验证环境变量配置</h4>
<p>打开终端，执行以下命令：</p>
<p><strong>验证gst-launch-1.0工具</strong></p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 --version 
</code></pre>
<p><strong>测试视频流水线</strong>（应该能看到测试图案窗口）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 videotestsrc ! autovideosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-18_1.png" alt="00-18.png" loading="lazy"/></p>
<p><strong>测试音频流水线</strong>（应该能听到测试音频）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 audiotestsrc ! autoaudiosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-19_1.png" alt="00-19.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-16">🍎 macOS下配置GStreamer开发环境</h3>
<h4 data-id="heading-17">方法一：安装包安装GStreamer（推荐）</h4>
<h5 data-id="heading-18">1. 访问GStreamer官方网站的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgstreamer.freedesktop.org%2Fdownload%2F" target="_blank" title="https://gstreamer.freedesktop.org/download/" ref="nofollow noopener noreferrer">下载页面</a></h5>
<h5 data-id="heading-19">2. 下载适用于macOS的安装包</h5>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-20.png" alt="00-21.png" loading="lazy"/></p>
<blockquote>
<p>⚠️ <strong>注意事项：</strong></p>
<ol>
<li>
<p>需要根据你的macOS版本选择合适的安装包，通常建议选择最新的稳定版本。</p>
</li>
<li>
<p><strong>需要同时安装Runtime和Development两个包</strong>。</p>
</li>
<li>
<p>如果你有debug需求，可以选择安装Debug包。</p>
</li>
</ol>
</blockquote>
<h5 data-id="heading-20">3. 安装GStreamer</h5>
<p>双击下载的<code>.pkg</code>文件，按照提示完成安装，<strong>建议使用默认安装路径</strong>（<code>/Library/Frameworks/GStreamer.framework/Versions/1.0</code>）。</p>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-21_1.png" alt="00-22_1.png" loading="lazy"/></p>
<h5 data-id="heading-21">4. 配置环境变量</h5>
<p><strong>如果使用Zsh：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export GSTREAMER_DIR="/Library/Frameworks/GStreamer.framework/Versions/1.0"'</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="$GSTREAMER_DIR/bin:$PATH"'</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export LD_LIBRARY_PATH="$GSTREAMER_DIR/lib:$LD_LIBRARY_PATH"'</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PKG_CONFIG_PATH="$GSTREAMER_DIR/lib/pkgconfig:$PKG_CONFIG_PATH"'</span> &gt;&gt; ~/.zshrc
</code></pre>
<p><strong>如果使用Bash：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export GSTREAMER_DIR="/Library/Frameworks/GStreamer.framework/Versions/1.0"'</span> &gt;&gt; ~/.bash_profile
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="$GSTREAMER_DIR/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export LD_LIBRARY_PATH="$GSTREAMER_DIR/lib:$LD_LIBRARY_PATH"'</span> &gt;&gt; ~/.bash_profile
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export PKG_CONFIG_PATH="$GSTREAMER_DIR/lib/pkgconfig:$PKG_CONFIG_PATH"'</span> &gt;&gt; ~/.bash_profile
</code></pre>
<h5 data-id="heading-22">5. 使环境变量生效</h5>
<p>执行以下命令使配置生效：</p>
<p><strong>如果使用Zsh：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
<p><strong>如果使用Bash：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bash_profile
</code></pre>
<h4 data-id="heading-23">方法二：使用Homebrew安装GStreamer</h4>
<blockquote>
<p>⚠️ <strong>重要提示：</strong></p>
<p><strong>如果您已经通过包安装方式安装了GStreamer，建议不要再使用Homebrew安装，以避免版本冲突和插件缺失问题。</strong></p>
<p>可以跳转到<a href="#%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE-2" title="#%E9%AA%8C%E8%AF%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE-2">验证环境变量配置</a>部分，确认GStreamer是否安装成功。</p>
</blockquote>
<blockquote>
<p>💡 <strong>版本选择建议</strong></p>
<p>Homebrew安装GStreamer与包安装方式不同，Homebrew会自动处理依赖关系，并且可以更方便地进行版本管理和更新。</p>
<p><strong>注意：</strong> Homebrew安装的GStreamer可能不包含所有官方包中的插件，具体取决于Homebrew的配方。因此，如果需要特定插件，建议使用方法一的包安装方式。</p>
<p><strong>总结：</strong> 如果你需要完整的GStreamer功能，建议使用包安装方式。如果只是进行简单的开发和测试，Homebrew安装方式可能更为便捷。</p>
</blockquote>
<h5 data-id="heading-24">1. 安装Homebrew（如果尚未安装）</h5>
<pre><code class="hljs language-bash" lang="bash">/bin/bash -c <span class="hljs-string">"<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>"</span>
</code></pre>
<blockquote>
<p>⚠️ <strong>注意</strong>：中国大陆用户可能需要配置Homebrew的镜像源以加快下载速度。可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.brew.sh%2FInstallation" target="_blank" title="https://docs.brew.sh/Installation" ref="nofollow noopener noreferrer">Homebrew中文文档</a>了解如何配置镜像源。</p>
</blockquote>
<h5 data-id="heading-25">2. 使用Homebrew安装GStreamer</h5>
<p><strong>方案A：一次性安装核心库和常用插件包（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install gstreamer gst-plugins-base gst-plugins-good gst-plugins-bad gst-plugins-ugly gst-libav
</code></pre>
<p><strong>方案B：分步骤安装（更灵活控制）</strong></p>
<p><strong>安装核心GStreamer：</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install gstreamer
</code></pre>
<p><strong>安装基础插件集（推荐）：</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install gst-plugins-base
</code></pre>
<p><strong>安装常用插件包：</strong></p>
<ul>
<li><strong>良好插件集 (Good Plugins)</strong> - 包含常见格式支持：autodetect、avi、flv、flac、mp3等
<pre><code class="hljs language-bash" lang="bash">brew install gst-plugins-good
</code></pre>
</li>
<li><strong>坏插件集 (Bad Plugins)</strong> - 包含较新或不稳定的插件：webm、mms、rsvg等
<pre><code class="hljs language-bash" lang="bash">brew install gst-plugins-bad
</code></pre>
</li>
<li><strong>丑陋插件集 (Ugly Plugins)</strong> - 包含有专利/法律问题的插件：a52dec、mpeg2dec、x264等
<pre><code class="hljs language-bash" lang="bash">brew install gst-plugins-ugly
</code></pre>
</li>
</ul>
<p><strong>可选插件包安装：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># LADSPA音频插件</span>
brew install gst-plugins-ladspa

<span class="hljs-comment"># 音频处理工具</span>
brew install gst-plugins-soundtouch

<span class="hljs-comment"># RTSP服务器</span>
brew install gst-rtsp-server

<span class="hljs-comment"># 视频处理</span>
brew install gst-plugins-gl

<span class="hljs-comment"># libav支持</span>
brew install gst-libav

<span class="hljs-comment"># GStreamer开发工具</span>
brew install gst-devtools
</code></pre>
<h4 data-id="heading-26">验证环境变量配置</h4>
<blockquote>
<p>⚠️ <strong>注意</strong>：brew安装GStreamer通常会自动配置环境变量。但加载相关动态库时可能耗时较长，建议耐心等待。</p>
</blockquote>
<p>打开终端，执行以下命令：</p>
<p><strong>验证gst-launch-1.0工具</strong></p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 --version 
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-22.png" alt="00-22.png" loading="lazy"/></p>
<p><strong>测试视频流水线</strong>（应该能看到测试图案窗口）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 videotestsrc ! autovideosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-23.png" alt="00-23.png" loading="lazy"/></p>
<p><strong>测试音频流水线</strong>（应该能听到测试音频）</p>
<pre><code class="hljs language-bash" lang="bash">gst-launch-1.0 audiotestsrc ! autoaudiosink
</code></pre>
<p><img src="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/assets/image/00-24.png" alt="00-24.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-27">🔧 CMake项目引入GStreamer</h3>
<p>GStreamer 1.14+ 提供了CMake配置文件，可以方便地在CMake项目中集成GStreamer</p>
<p>以下是一个简单的CMakeLists.txt示例，展示如何在项目中引入GStreamer，你可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZongChang-Liu%2FGStreamerLearning%2Fraw%2Fmain%2Fexamples%2Fbasic_examples%2F00-hello-gstreamer" target="_blank" title="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/examples/basic_examples/00-hello-gstreamer" ref="nofollow noopener noreferrer">examples/basic_examples/00-hello-gstreamer</a>下找到完整项目，并运行测试。</p>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.25)

# 项目名称
set(PROJECT_NAME "hello-gstreamer")

# 设定项目语言为C++
project(${PROJECT_NAME} LANGUAGES CXX)

# 查找PkgConfig模块
find_package(PkgConfig REQUIRED)

# 使用PkgConfig查找GStreamer核心库
pkg_check_modules(GSTREAMER REQUIRED IMPORTED_TARGET
        gstreamer-1.0
        gstreamer-video-1.0
        gstreamer-audio-1.0
        gstreamer-app-1.0
)

# 使用PkgConfig查找GStreamer基础插件库
pkg_check_modules(GSTREAMER_PLUGINS_BASE REQUIRED IMPORTED_TARGET
        gstreamer-plugins-base-1.0
)

# 添加可执行文件
add_executable(${PROJECT_NAME} main.cpp)

# 链接GStreamer库
target_link_libraries(${PROJECT_NAME}
        PkgConfig::GSTREAMER
        PkgConfig::GSTREAMER_PLUGINS_BASE
)
</code></pre>
<hr/>
<h3 data-id="heading-28">👋 Hello GStreamer程序编写与运行</h3>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZongChang-Liu%2FGStreamerLearning%2Fraw%2Fmain%2Fexamples%2Fbasic_examples%2F00-hello-gstreamer" target="_blank" title="https://github.com/ZongChang-Liu/GStreamerLearning/raw/main/examples/basic_examples/00-hello-gstreamer" ref="nofollow noopener noreferrer">examples/basic_examples/00-hello-gstreamer</a>目录下，有一个简单的Hello GStreamer程序示例。你可以参考以下代码：</p>
<p>该程序初始化GStreamer，打印版本信息，并创建一个简单的音视频流水线进行播放，直至关闭窗口。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;gst/gst.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">main_func</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{
    <span class="hljs-comment">// 初始化GStreamer</span>
    <span class="hljs-built_in">gst_init</span>(&amp;argc, &amp;argv);

    <span class="hljs-comment">// 打印版本信息</span>
    std::cout &lt;&lt; <span class="hljs-string">"Hello, GStreamer! "</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"GStreamer Version: "</span>
            &lt;&lt; GST_VERSION_MAJOR &lt;&lt; <span class="hljs-string">"."</span>
            &lt;&lt; GST_VERSION_MINOR &lt;&lt; <span class="hljs-string">"."</span>
            &lt;&lt; GST_VERSION_MICRO &lt;&lt; std::endl;

    <span class="hljs-comment">// 创建GStreamer管道</span>
    GstElement *pipeline = <span class="hljs-built_in">gst_parse_launch</span>(<span class="hljs-string">"videotestsrc ! autovideosink ! audiotestsrc ! autoaudiosink"</span>, <span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span> (!pipeline) {
        std::cerr &lt;&lt; <span class="hljs-string">"Failed to create pipeline."</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }

    <span class="hljs-comment">// 设置管道状态为播放</span>
    <span class="hljs-built_in">gst_element_set_state</span>(pipeline, GST_STATE_PLAYING);

    std::cout &lt;&lt; <span class="hljs-string">"Pipeline is playing. Close the video window to exit."</span> &lt;&lt; std::endl;

    <span class="hljs-comment">// 等待直到错误或EOS消息</span>
    GstBus *bus = <span class="hljs-built_in">gst_element_get_bus</span>(pipeline);
    GstMessage *msg = <span class="hljs-built_in">gst_bus_timed_pop_filtered</span>(bus, GST_CLOCK_TIME_NONE,
                                                    <span class="hljs-built_in">static_cast</span>&lt;GstMessageType&gt;(GST_MESSAGE_ERROR | GST_MESSAGE_EOS));

    <span class="hljs-comment">// 处理消息</span>
    <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-built_in">gst_message_unref</span>(msg);
    }
    
    <span class="hljs-comment">// 清理</span>
    <span class="hljs-built_in">gst_object_unref</span>(bus);
    <span class="hljs-built_in">gst_element_set_state</span>(pipeline, GST_STATE_NULL);
    <span class="hljs-built_in">gst_object_unref</span>(pipeline);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{
<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __APPLE__</span>
    <span class="hljs-built_in">gst_macos_main</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;GstMainFunc&gt;(main_func), argc, argv, <span class="hljs-literal">NULL</span>);
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-built_in">main_func</span>(argc, argv);
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-29">❓ 常见问题解答</h3>
<h4 data-id="heading-30">Q1: 安装GStreamer后命令行找不到gst-launch-1.0怎么办？</h4>
<p><strong>A1:</strong> 请确认环境变量Path中已正确添加GStreamer的bin目录路径。重新打开命令行窗口以加载新的环境变量。如果问题仍然存在，尝试重启计算机。</p>
<h4 data-id="heading-31">Q2: 运行gst-launch-1.0命令时报错找不到插件怎么办？</h4>
<p><strong>A2:</strong> 请确认已安装必要的插件包（如good、bad、ugly等）。在Linux上，可以使用包管理器安装缺失的插件。在Windows和macOS上，确保安装了完整的GStreamer包。</p>
<h4 data-id="heading-32">Q3: 在CMake项目中找不到GStreamer怎么办？</h4>
<p><strong>A3:</strong> 请确保CMakeLists.txt中正确使用了<code>pkg_check_modules</code>查找GStreamer库，并且GStreamer的pkg-config文件路径已包含在<code>PKG_CONFIG_PATH</code>环境变量中。</p>
<h4 data-id="heading-33">Q4: 找不到PkgConfig模块怎么办？</h4>
<p><strong>A4:</strong> 请确保已安装PkgConfig工具。在Linux上，可以使用包管理器安装。在Windows上，可以通过MSYS2或其他方式安装。在macOS上，Homebrew通常会自动安装PkgConfig。</p>
<hr/>
<h3 data-id="heading-34">📝 小结</h3>
<p>本章详细介绍了在Windows、Linux和macOS系统上配置GStreamer开发环境的完整流程。您学会了：</p>
<ol>
<li>
<p><strong>环境安装</strong>：在不同操作系统上安装GStreamer及其插件</p>
</li>
<li>
<p><strong>环境配置</strong>：设置必要的环境变量和依赖项</p>
</li>
<li>
<p><strong>项目集成</strong>：使用CMake构建包含GStreamer的项目</p>
</li>
<li>
<p><strong>程序开发</strong>：编写并运行简单的GStreamer应用程序</p>
</li>
</ol>
<h4 data-id="heading-35">下一步</h4>
<p>配置好开发环境后，您可以：</p>
<ol>
<li>
<p>尝试修改示例代码，探索不同的GStreamer元素</p>
</li>
<li>
<p>学习使用<code>gst-launch-1.0</code>命令行工具快速测试流水线</p>
</li>
<li>
<p>阅读GStreamer官方文档了解核心概念</p>
</li>
<li>
<p>进入下一章学习GStreamer的基本概念和架构</p>
</li>
</ol>
<h4 data-id="heading-36">实用命令速查</h4>





























<table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>检查版本</td><td><code>gst-launch-1.0 --version</code></td></tr><tr><td>测试视频</td><td><code>gst-launch-1.0 videotestsrc ! autovideosink</code></td></tr><tr><td>测试音频</td><td><code>gst-launch-1.0 audiotestsrc ! autoaudiosink</code></td></tr><tr><td>查看可用元素</td><td><code>gst-inspect-1.0</code></td></tr><tr><td>查看特定元素详情</td><td><code>gst-inspect-1.0 videotestsrc</code></td></tr></tbody></table>
<h4 data-id="heading-37">资源推荐</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgstreamer.freedesktop.org%2Fdocumentation%2F" target="_blank" title="https://gstreamer.freedesktop.org/documentation/" ref="nofollow noopener noreferrer">GStreamer官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgstreamer.freedesktop.org%2Fdocumentation%2Fapplication-development%2F" target="_blank" title="https://gstreamer.freedesktop.org/documentation/application-development/" ref="nofollow noopener noreferrer">GStreamer应用程序开发手册</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgstreamer.freedesktop.org%2Fdocumentation%2Fplugin-development%2F" target="_blank" title="https://gstreamer.freedesktop.org/documentation/plugin-development/" ref="nofollow noopener noreferrer">GStreamer插件编写指南</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitlab.freedesktop.org%2Fgstreamer%2Fgstreamer%2F-%2Ftree%2Fmaster%2Fsubprojects%2Fgst-plugins-base%2Ftests%2Fexamples" target="_blank" title="https://gitlab.freedesktop.org/gstreamer/gstreamer/-/tree/master/subprojects/gst-plugins-base/tests/examples" ref="nofollow noopener noreferrer">GStreamer示例代码</a></li>
</ul>
<hr/>
<p><strong>如果遇到任何问题：</strong></p>
<ol>
<li>
<p>请参考本章的<strong>常见问题解答</strong>部分</p>
</li>
<li>
<p>查阅GStreamer官方文档和社区论坛</p>
</li>
<li>
<p>在GitHub仓库中提交issue寻求帮助</p>
</li>
</ol>
<p><strong>同时也欢迎通过Email与我联系交流：<a href="https://link.juejin.cn?target=mailto%3Azongchang.smile%40gmail.com" target="_blank" title="mailto:zongchang.smile@gmail.com" ref="nofollow noopener noreferrer">zongchang.smile@gmail.com</a></strong></p>
<p>祝您GStreamer开发顺利！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[简单有效地提升 Shopify 站点性能：自定义加载脚本]]></title>    <link>https://juejin.cn/post/7601073900526157866</link>    <guid>https://juejin.cn/post/7601073900526157866</guid>    <pubDate>2026-02-01T09:45:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601073900526157866" data-draft-id="7601076694105358372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="简单有效地提升 Shopify 站点性能：自定义加载脚本"/> <meta itemprop="keywords" content="性能优化,前端"/> <meta itemprop="datePublished" content="2026-02-01T09:45:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ouch"/> <meta itemprop="url" content="https://juejin.cn/user/2441387102177159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            简单有效地提升 Shopify 站点性能：自定义加载脚本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441387102177159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ouch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:45:20.000Z" title="Sun Feb 01 2026 09:45:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简单有效地提升 Shopify 站点性能：自定义加载脚本</h2>
<p>影响性能的一个常见因素是脚本的加载、编译、执行，这点在 Shopify 站点体现得更明显，因为平台默认集成一些支付、平台监控、分析追踪等工具，加上普遍需要安装插件、引入营销类工具脚本（比如GTM）等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51dc3cfdfc164744b1ae5c2a132131cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3VjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543920&amp;x-signature=IaNPhWtaiSxWuWLJWXxzBb5It%2Fw%3D" alt="third-party.png" loading="lazy"/></p>
<p>一个合理的解决思路是延迟一些"次要"脚本的加载和执行，那么在 Shopify 中我们可以检视代码，看到一些第三方脚本是这么被加载进网页的：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> isLoaded = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (isLoaded) <span class="hljs-keyword">return</span>;
    isLoaded = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> urls = [<span class="hljs-string">"https:\/\/api-na2.hubapi.com\/scriptloader\/v1\/243343319.js?shop=xxx.myshopify.com"</span>,<span class="hljs-string">"\/\/cdn.shopify.com\/proxy\/873ef8dfc1568c840b7856dcd2d82f2cfd17e5417d1f1f835d2563af741ac47e\/d1639lhkj5l89m.cloudfront.net\/js\/storefront\/uppromote.js?shop=xxx.myshopify.com\u0026sp-cache-control=cHVibGljLCBtYXgtYWdlPTkwMA"</span>,<span class="hljs-string">"\/\/cdn.shopify.com\/proxy\/20ab8c4c7e87500ef9d7bb98203fee1481a2e7a2e2153af4e3ddbb1e8446f26f\/api.goaffpro.com\/loader.js?shop=xxx.myshopify.com\u0026sp-cache-control=cHVibGljLCBtYXgtYWdlPTkwMA"</span>];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; urls.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">var</span> s = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
      s.<span class="hljs-property">type</span> = <span class="hljs-string">'text/javascript'</span>;
      s.<span class="hljs-property">async</span> = <span class="hljs-literal">true</span>;
      s.<span class="hljs-property">src</span> = urls[i];
      <span class="hljs-keyword">var</span> x = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">'script'</span>)[<span class="hljs-number">0</span>];
      x.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">insertBefore</span>(s, x);
    }
  };
  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">attachEvent</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">'onload'</span>, asyncLoad);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, asyncLoad, <span class="hljs-literal">false</span>);
  }
})();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>（attachEvent 是 IE 时代的 API，现已废弃）大致逻辑是在页面监听 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWindow%2Fload_event" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event" ref="nofollow noopener noreferrer">load</a> 事件，load 触发后再通过 asyncLoad 函数逐一创建以 async 异步加载的外部脚本标签插入网页。</p>
<p>注意这里加载的脚本带 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTML%2FReference%2FElements%2Fscript%23async" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/script#async" ref="nofollow noopener noreferrer">async</a>，意味着加载时机可以灵活一些，因此触发 asyncLoad 的时机也可以灵活一些，我们就可以这么修改以实现自定义加载脚本了：</p>
<h3 data-id="heading-1">修改 content_for_header（theme.liquid）</h3>
<p>我习惯不处理购物车页，所以判断 <code>template.name != 'cart'</code>。替换 load 为 CustomLoad：</p>
<pre><code class="hljs language-liquid" lang="liquid">{% if template.name != 'cart'  %}
  {{ content_for_header | replace: "addEventListener('load'", "addEventListener('CustomLoad'" }}
{% else %}
  {{ content_for_header }}
{% endif %}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5a733f7f687400c8f4905bb0d827ac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3VjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543920&amp;x-signature=8hqQfraYr1nKWr3qBfCQDaYRwaU%3D" alt="custom-load.png" loading="lazy"/></p>
<h3 data-id="heading-2">触发自定义事件</h3>
<p>在 theme.liquid 底部，body 闭合前，加入以下代码：</p>
<pre><code class="hljs language-html" lang="html">{% if template.name != 'cart' %}
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> events = [<span class="hljs-string">'scroll'</span>, <span class="hljs-string">'mousemove'</span>, <span class="hljs-string">'keydown'</span>, <span class="hljs-string">'click'</span>, <span class="hljs-string">'touchstart'</span>];
    <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">actionEvent</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">return</span>;
      flag = <span class="hljs-literal">true</span>;
      
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">"CustomLoad"</span>));
    }
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
      events.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">eventType</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(eventType, actionEvent, {
          <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>
        });
      });
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
{% endif %}
</code></pre>
<p>这样就能实现一个简单有效的延迟加载脚本控制器了，当网站用户产生交互时再加载这些脚本。</p>
<p>以上代码仅供参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如果一个脚本既有 async 又有 defer 属性，会发生什么情况？]]></title>    <link>https://juejin.cn/post/7601757036486361098</link>    <guid>https://juejin.cn/post/7601757036486361098</guid>    <pubDate>2026-02-01T09:49:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036486361098" data-draft-id="7601441797117788211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如果一个脚本既有 async 又有 defer 属性，会发生什么情况？"/> <meta itemprop="keywords" content="JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-01T09:49:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smilezyl"/> <meta itemprop="url" content="https://juejin.cn/user/3438928103504088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如果一个脚本既有 async 又有 defer 属性，会发生什么情况？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928103504088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smilezyl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:49:32.000Z" title="Sun Feb 01 2026 09:49:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如果一个脚本既有 async 又有 defer 属性，会发生什么情况？</h2>
<h3 data-id="heading-1">核心答案</h3>
<p><strong>async 优先级更高，defer 会被忽略。</strong> 当一个 <code>&lt;script&gt;</code> 标签同时具有 <code>async</code> 和 <code>defer</code> 属性时，浏览器会按照 <code>async</code> 的行为执行——脚本并行下载，下载完成后立即执行，不保证执行顺序。</p>
<p>这是 HTML 规范明确定义的行为，<code>defer</code> 在这种情况下作为<strong>降级回退</strong>存在，用于兼容不支持 <code>async</code> 的老旧浏览器。</p>
<h3 data-id="heading-2">深入解析</h3>
<h4 data-id="heading-3">HTML 规范中的优先级</h4>
<p>根据 HTML Living Standard，浏览器处理 <code>&lt;script&gt;</code> 标签的逻辑如下：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">if</span> (脚本有 src 属性) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> 属性存在) {
        <span class="hljs-operator">→</span> 使用 <span class="hljs-keyword">async</span> 模式
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">defer</span> 属性存在) {
        <span class="hljs-operator">→</span> 使用 <span class="hljs-keyword">defer</span> 模式
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-operator">→</span> 使用传统阻塞模式
    }
}
</code></pre>
<p>关键点：<strong>async 的判断在 defer 之前</strong>，所以 async 优先。</p>
<h4 data-id="heading-4">为什么要这样设计？</h4>
<p>这是一个<strong>优雅降级</strong>的设计：</p>





















<table><thead><tr><th>浏览器支持情况</th><th>行为</th></tr></thead><tbody><tr><td>支持 async</td><td>使用 async（忽略 defer）</td></tr><tr><td>不支持 async，支持 defer</td><td>使用 defer</td></tr><tr><td>都不支持</td><td>传统阻塞加载</td></tr></tbody></table>
<p>在 async 刚推出时（约 2010 年），老版本 IE（IE9 及以下）不支持 async 但支持 defer。同时写两个属性可以让：</p>
<ul>
<li>现代浏览器使用 async</li>
<li>老浏览器回退到 defer</li>
</ul>
<h4 data-id="heading-5">三种模式对比</h4>
<pre><code class="hljs language-swift" lang="swift">                    下载        执行时机              顺序保证    阻塞解析
无属性              阻塞        下载完立即执行         <span class="hljs-operator">✅</span>         <span class="hljs-operator">✅</span>
<span class="hljs-keyword">async</span>              并行        下载完立即执行         <span class="hljs-operator">❌</span>         <span class="hljs-operator">❌</span>
<span class="hljs-keyword">defer</span>              并行        <span class="hljs-type">DOM</span> 解析完成后        <span class="hljs-operator">✅</span>         <span class="hljs-operator">❌</span>
<span class="hljs-keyword">async</span> <span class="hljs-operator">+</span> <span class="hljs-keyword">defer</span>      并行        下载完立即执行         <span class="hljs-operator">❌</span>         <span class="hljs-operator">❌</span>
</code></pre>
<h4 data-id="heading-6">常见误区</h4>
<p><strong>误区 1：</strong> "两个属性会产生某种组合效果"</p>
<ul>
<li>错误。不存在 "async-defer" 混合模式，只会选择其中一个</li>
</ul>
<p><strong>误区 2：</strong> "defer 会覆盖 async"</p>
<ul>
<li>错误。恰恰相反，async 优先级更高</li>
</ul>
<p><strong>误区 3：</strong> "现代开发中同时写两个属性有意义"</p>
<ul>
<li>基本没有意义了。async 的浏览器支持率已经非常高（IE10+），不需要 defer 作为回退</li>
</ul>
<h4 data-id="heading-7">内联脚本的特殊情况</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- async 和 defer 对内联脚本无效 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'我是内联脚本，async 和 defer 都被忽略'</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>async</code> 和 <code>defer</code> 只对<strong>外部脚本</strong>（有 <code>src</code> 属性）有效。</p>
<h3 data-id="heading-8">代码示例</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 同时有 async 和 defer --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 等价于（在现代浏览器中） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">验证行为的测试代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"a.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <span class="hljs-comment">&lt;!-- 输出 A --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"b.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <span class="hljs-comment">&lt;!-- 输出 B --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"c.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <span class="hljs-comment">&lt;!-- 输出 C --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'DOMContentLoaded'</span>);
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

<span class="hljs-comment">&lt;!--
可能的输出顺序（取决于下载速度）：
B, A, C, DOMContentLoaded
或
A, C, B, DOMContentLoaded
或其他任意顺序

如果是纯 defer，输出一定是：
A, B, C, DOMContentLoaded
--&gt;</span>
</code></pre>
<h4 data-id="heading-10">实际应用场景</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 2010-2015 年的兼容性写法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 现代写法：直接用 async 或 defer --&gt;</span>
<span class="hljs-comment">&lt;!-- 独立脚本（如统计、广告）用 async --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 有依赖关系的脚本用 defer --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">面试技巧</h3>
<h4 data-id="heading-12">可能的追问方向</h4>
<ol>
<li>
<p><strong>"为什么 async 优先级更高？"</strong></p>
<ul>
<li>这是 HTML 规范的设计，目的是让 defer 作为 async 的降级回退</li>
<li>体现了渐进增强/优雅降级的设计思想</li>
</ul>
</li>
<li>
<p><strong>"现在还需要同时写两个属性吗？"</strong></p>
<ul>
<li>基本不需要。async 支持率已经很高</li>
<li>如果要兼容 IE9，应该用其他方案（如 polyfill 或条件注释）</li>
</ul>
</li>
<li>
<p><strong>"module 类型的脚本呢？"</strong></p>
<ul>
<li><code>&lt;script type="module"&gt;</code> 默认就是 defer 行为</li>
<li>可以加 async 变成 async 行为</li>
<li>不需要显式写 defer</li>
</ul>
</li>
<li>
<p><strong>"动态创建的脚本呢？"</strong></p>
<ul>
<li>动态创建的 <code>&lt;script&gt;</code> 默认是 async 行为</li>
<li>可以设置 <code>script.async = false</code> 来改变</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">展示深度的回答方式</h4>
<blockquote>
<p>"当 async 和 defer 同时存在时，async 优先，defer 被忽略。这是 HTML 规范明确定义的行为，设计初衷是让 defer 作为 async 的降级回退——在 async 刚推出时，老版本 IE 不支持 async 但支持 defer，同时写两个属性可以实现优雅降级。不过在现代开发中，这种写法已经没有必要了。"</p>
</blockquote>
<h3 data-id="heading-14">一句话总结</h3>
<blockquote>
<p><strong>async + defer = async；defer 只是 async 的降级回退，现代开发中无需同时使用。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[既然有了 defer，我们还需要像以前那样把 <script>标签放到 <body>的最底部吗？]]></title>    <link>https://juejin.cn/post/7601441797117804595</link>    <guid>https://juejin.cn/post/7601441797117804595</guid>    <pubDate>2026-02-01T09:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441797117804595" data-draft-id="7601441475987079214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="既然有了 defer，我们还需要像以前那样把 &lt;script&gt;标签放到 &lt;body&gt;的最底部吗？"/> <meta itemprop="keywords" content="JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-01T09:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smilezyl"/> <meta itemprop="url" content="https://juejin.cn/user/3438928103504088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            既然有了 defer，我们还需要像以前那样把 &lt;script&gt;标签放到 &lt;body&gt;的最底部吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928103504088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smilezyl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:51:19.000Z" title="Sun Feb 01 2026 09:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">既然有了 defer，我们还需要像以前那样把 <code>&lt;script&gt;</code> 标签放到 <code>&lt;body&gt;</code> 的最底部吗？如果我把带 defer 的脚本放在 <code>&lt;head&gt;</code> 里，会有性能问题吗？</h2>
<h3 data-id="heading-1">核心答案</h3>
<p><strong>不需要了。</strong> 使用 <code>defer</code> 属性后，把 <code>&lt;script&gt;</code> 放在 <code>&lt;head&gt;</code> 里不仅没有性能问题，反而是<strong>更优的做法</strong>。</p>
<p>原因：</p>
<ol>
<li><code>defer</code> 脚本会<strong>并行下载</strong>，不阻塞 HTML 解析</li>
<li>脚本执行会<strong>延迟到 DOM 解析完成后</strong>，但在 <code>DOMContentLoaded</code> 事件之前</li>
<li>放在 <code>&lt;head&gt;</code> 里可以让浏览器<strong>更早发现并开始下载</strong>脚本</li>
</ol>
<h3 data-id="heading-2">深入解析</h3>
<h4 data-id="heading-3">浏览器解析机制</h4>
<pre><code class="hljs language-swift" lang="swift">传统 <span class="hljs-operator">&lt;</span>script<span class="hljs-operator">&gt;</span>（无 <span class="hljs-keyword">defer</span><span class="hljs-operator">/</span><span class="hljs-keyword">async</span>）:
<span class="hljs-type">HTML</span> 解析 <span class="hljs-operator">──▶</span> 遇到 script <span class="hljs-operator">──▶</span> 暂停解析 <span class="hljs-operator">──▶</span> 下载脚本 <span class="hljs-operator">──▶</span> 执行脚本 <span class="hljs-operator">──▶</span> 继续解析

<span class="hljs-keyword">defer</span> 脚本:
<span class="hljs-type">HTML</span> 解析 <span class="hljs-operator">────────────────────────────────────────────▶</span> <span class="hljs-type">DOM</span> 解析完成 <span class="hljs-operator">──▶</span> 执行脚本
     <span class="hljs-operator">└──▶</span> 并行下载脚本 <span class="hljs-operator">──────────────────────────────────────────────────┘</span>
</code></pre>
<h4 data-id="heading-4">为什么 <code>&lt;head&gt;</code> 里的 defer 更好？</h4>




















<table><thead><tr><th>位置</th><th>发现脚本时机</th><th>开始下载时机</th></tr></thead><tbody><tr><td><code>&lt;head&gt;</code></td><td>解析开始时</td><td>立即</td></tr><tr><td><code>&lt;body&gt;</code> 底部</td><td>解析接近完成时</td><td>较晚</td></tr></tbody></table>
<p>放在 <code>&lt;head&gt;</code> 里，浏览器可以在解析 HTML 的同时下载脚本，<strong>充分利用网络带宽</strong>。</p>
<h4 data-id="heading-5">常见误区</h4>
<p><strong>误区 1：</strong> "defer 脚本放 <code>&lt;head&gt;</code> 会阻塞渲染"</p>
<ul>
<li>错误。defer 脚本的下载和 HTML 解析是并行的</li>
</ul>
<p><strong>误区 2：</strong> "放 <code>&lt;body&gt;</code> 底部更保险"</p>
<ul>
<li>这是 defer 出现之前的最佳实践，现在已过时</li>
<li>放底部反而会延迟脚本的发现和下载</li>
</ul>
<p><strong>误区 3：</strong> "defer 和放底部效果一样"</p>
<ul>
<li>不一样。放底部时，脚本下载要等到 HTML 解析到那里才开始</li>
<li>defer 在 <code>&lt;head&gt;</code> 里可以更早开始下载</li>
</ul>
<h4 data-id="heading-6">defer vs async vs 传统方式</h4>
<pre><code class="hljs language-swift" lang="swift">                    下载时机        执行时机              执行顺序
传统 script         阻塞解析        下载完立即执行         按文档顺序
<span class="hljs-keyword">async</span>              并行下载        下载完立即执行         不保证顺序
<span class="hljs-keyword">defer</span>              并行下载        <span class="hljs-type">DOM</span> 解析完成后        按文档顺序
</code></pre>
<h3 data-id="heading-7">代码示例</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ✅ 推荐：defer 脚本放在 &lt;head&gt; --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>页面标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 浏览器立即发现并开始下载，但不阻塞解析 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"styles.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- HTML 内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

<span class="hljs-comment">&lt;!-- ❌ 过时做法：放在 body 底部 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>页面标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- HTML 内容 --&gt;</span>

  <span class="hljs-comment">&lt;!-- 要等 HTML 解析到这里才开始下载 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"vendor.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">验证下载时机的方法</h4>
<p>打开 Chrome DevTools → Network 面板，观察脚本的下载开始时间：</p>
<ul>
<li><code>&lt;head&gt;</code> 里的 defer 脚本：在 HTML 下载初期就开始</li>
<li><code>&lt;body&gt;</code> 底部的脚本：在 HTML 解析接近完成时才开始</li>
</ul>
<h3 data-id="heading-9">面试技巧</h3>
<h4 data-id="heading-10">可能的追问方向</h4>
<ol>
<li>
<p><strong>"defer 和 async 有什么区别？"</strong></p>
<ul>
<li>async 下载完立即执行，不保证顺序</li>
<li>defer 等 DOM 解析完才执行，保证顺序</li>
</ul>
</li>
<li>
<p><strong>"多个 defer 脚本的执行顺序是怎样的？"</strong></p>
<ul>
<li>按照在文档中出现的顺序执行</li>
<li>即使后面的脚本先下载完，也会等前面的</li>
</ul>
</li>
<li>
<p><strong>"defer 脚本和 DOMContentLoaded 的关系？"</strong></p>
<ul>
<li>defer 脚本在 DOM 解析完成后、DOMContentLoaded 触发前执行</li>
</ul>
</li>
<li>
<p><strong>"什么情况下还是要放 body 底部？"</strong></p>
<ul>
<li>需要兼容不支持 defer 的古老浏览器（IE9 以下）</li>
<li>现代开发中基本不需要考虑</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">展示深度的回答方式</h4>
<blockquote>
<p>"defer 放 <code>&lt;head&gt;</code> 不仅没有性能问题，反而是更优的选择。因为浏览器的预加载扫描器（Preload Scanner）可以在解析 HTML 的早期就发现这些脚本并开始下载，充分利用网络带宽。而放在 <code>&lt;body&gt;</code> 底部的话，脚本的发现时机会延后，相当于浪费了并行下载的机会。"</p>
</blockquote>
<h3 data-id="heading-12">一句话总结</h3>
<blockquote>
<p><strong>defer 脚本放 <code>&lt;head&gt;</code> 是现代最佳实践：更早发现、并行下载、不阻塞解析、按序执行。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[火爆全网的Skills，看这一篇就够了！]]></title>    <link>https://juejin.cn/post/7601077290682286132</link>    <guid>https://juejin.cn/post/7601077290682286132</guid>    <pubDate>2026-02-01T09:44:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601077290682286132" data-draft-id="7601077290682220596" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="火爆全网的Skills，看这一篇就够了！"/> <meta itemprop="keywords" content="前端,Android,AI编程"/> <meta itemprop="datePublished" content="2026-02-01T09:44:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员码歌"/> <meta itemprop="url" content="https://juejin.cn/user/764915820529831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            火爆全网的Skills，看这一篇就够了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915820529831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员码歌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:44:46.000Z" title="Sun Feb 01 2026 09:44:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53a2adfd3f444a77855c7960512ef107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=rLi1O5ee%2FFCgGmKM%2FXOFN0EpYio%3D" alt="" loading="lazy"/></p>
<p>大家好，我是势必要把Skills咬烂嚼碎的码哥！</p>
<p>Skills 最近火得一塌糊涂，热度不亚于去年的MCP ，经过几周零碎时间的研究摸索，写下了这篇可能是全网最详细的Skills教程了，哈哈😃！</p>
<h2 data-id="heading-0">一、什么是Skill     </h2>
<p>首先了解下什么是Claude Agent Skills？ Skills翻译成中文就是“技能”，你可以理解为你执行某件事的方法论。</p>
<p>举个生活的例子：我会打网球，当球飞过来，我拿起球拍跑位，在合适的时机、用合适的力度击球，让球准确落在对方场地不出界，这一整套操作逻辑，就叫打网球“技能”。</p>
<p>在 AI 界，Skills 就是让大模型按照特定的方法论去行动的机制，你可以理解为“超级进化版的提示词”，通常由三部分组成：</p>
<p>1、元数据 (Metadata)： 包含对这个技能的简短描述。它保存在全局上下文中，因为体积小，所以非常节省 Tokens（省钱又省心）。</p>
<p>2、行动指南 (Action Guide)： 这部分才是真正的提示词，规定了 AI 每一步该怎么做。</p>
<p>3、资源文件 (Resources)： 这是最厉害的地方！它可能包含 Python 代码 或其他执行程序，保证程序在调用 Skill 时能完成复杂的动作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c88b047784f04238acc07a78bd5232a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=txBEybrBjqWaTMWPskhDJJOUOkY%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e22fb16d0c8348a3a7481a94781a8be6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=G9F44bbu3QULqCYS2RA1mQX%2FdVs%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/213a9e98772c4c43841e739a49344efd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=N8fotymj02UoDSwGKUgDCoc3iz0%3D" alt="" loading="lazy"/></p>
<p>Skills 最核心的机制是通过<strong>渐进式披露</strong> (Progressive Disclosure)，通过分层加载信息，确保 AI 总能获取所需知识，同时最大化利用上下文的效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f30ae54a26a4b3a8b369488f3149301~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=4J1DrXSDMeOKDCMxPj8KffLl%2FLI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、Skills与MCP的区别        </h2>
<p>Skills 与MCP 有什么区别呢，先说结论：<br/>
MCP 解决"连接"问题，让 AI 能访问外部世界<br/>
Skill 解决"方法论"问题，教 AI 怎么做某类任务</p>
<p>大白话理解：<br/>
Skills 主要聚焦于工具处理。一套完整的方法论。 例如处理文件、设计、写文章。</p>
<p>MCP 主要起到连接作用。适合深度集成外部系统，自定义上传、下载、推送等流程。</p>
<p>两者的关系：<br/>
Skills 与 MCP 并不是竞争或替代的关系，而是结合关系。</p>
<p>对于普通用户、日常工作，大部分时候只需要 Skills 就足够；<br/>
对于复杂的企业场景、跨平台/自动分发等任务，使用 Skills + MCP 可以实现更加稳定和高效的输出。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8ce3a5650284473a0a62e8171d23011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=JB%2B6azyKQFI%2F8O7QIfbFWFE17GU%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26d3ef6308ec43b496188a411c360c7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=7lH95vAu4ynGdyzgr%2F4MdxjmxW8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">三、Skills使用场景&amp;链路     </h2>
<h5 data-id="heading-3"/>
<h5 data-id="heading-4">什么时候用Skills？</h5>
<p><strong>判断标准</strong>：任务是"如何做"还是"做什么"？</p>
<ul>
<li><strong>Skills</strong>当你有固定的<strong>工作流程</strong>，需要AI按步骤执行时</li>
</ul>

<ul>
<li>示例："按什么格式写技术教程"、"代码审查的5个步骤"</li>
</ul>

<ul>
<li><strong>MCP</strong>当你需要AI<strong>访问外部数据或服务</strong>时</li>
</ul>

<ul>
<li>示例："查询GitHub的Issue"、"读取SQLite数据库"</li>
<li/>
</ul>
<h5 data-id="heading-5">什么时候用MCP？</h5>
<p><strong>判断标准</strong>：是否需要结构化输入输出？</p>
<ul>
<li>MCP擅长：<strong>工具化操作</strong></li>
</ul>

<ul>
<li>输入：JSON结构化参数（<code>{"value": 10}</code>）输出：结构化结果（<code>{"total": 15}</code>）优势：可组合、可测试、可缓存</li>
</ul>

<ul>
<li>Skills擅长：<strong>文本化流程</strong></li>
</ul>

<ul>
<li>输入：自然语言描述输出：自然语言结果优势：灵活、易读、易维护</li>
<li/>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67ac91d53eaa457d9ef4a22e93893b4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=YeScB3Jn5xgwwm16VmyC%2Fcn59tQ%3D" alt="" loading="lazy"/></p>
<p>你可能会觉得很混乱，那么多专业名词概念，到底怎么才能玩好，别急，你试着把这些串起来，就是AI 工作的完整逻辑。</p>
<ol>
<li><strong>Prompt（指令）</strong> ：你用自然语言精准告诉 AI“要做什么、要什么结果”——这是启动信号，核心是让模型听懂需求；</li>
<li><strong>Skills（技能包）</strong> ：AI 根据指令，从“专业能力库”里挑选封装好的流程和知识（比如竞品分析框架、代码编写规范）；</li>
<li><strong>Projects（工作区）</strong> ：AI 在专属的持久化空间里推进任务，背景资料、中间成果全程可用，无需重复沟通；</li>
<li><strong>MCP（协议）</strong> ：AI 通过标准化接口，安全接入企业数据库、云盘等外部资源，落地执行真实业务操作（比如查询销售数据、调用业务接口）。</li>
</ol>
<p><strong>一句话终极总结：</strong></p>
<p>Prompt 是“让模型听懂的指令”，Skills 是“模型做事的专业流程”，Projects 是“模型工作的专属空间”，MCP 是“模型连接真实世界的桥梁”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c8fe1bf0fc467d9b7b53fb3d32cf6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=MDPvdPL7C3dw9BdeF8%2FPwdQf3tY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">四、怎么使用Skills         </h2>
<h5 data-id="heading-7"/>
<h5 data-id="heading-8">1、cursor使用Skills只需4步</h5>
<p>4步就能使用上，非常简单。<br/>
第一步、安装OpenSkills<br/>
npm install -g openskills@1.2.1</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f812f8a377d4ce3838bc71ae0f3e26e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=F6fz%2BJANlYza64xQe%2F5akHpYowI%3D" alt="" loading="lazy"/></p>
<p>第二步、安装官方Skills，需能访问github<br/>
openskills install anthropics/skills</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c58dddd866c4be485464369f3029cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=T4BZhLs9%2F0JgYYLqYaY0DYXJEoc%3D" alt="" loading="lazy"/></p>
<p>第三步、创建AGENTS.md ，执行同步命令<br/>
openskills sync</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eda0c9294674523bfd666ae6936e235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=M8o%2F3njitcqbACuCAhSSGMW62XQ%3D" alt="" loading="lazy"/></p>
<p>第四步、cursor上使用案例<br/>
使用xlsx skills生成20条登录注册用例</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3afc055d13c45029ced814200d0728d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=i1F%2B9YjRMQQs8rB16qu0ZwMUYe4%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eabcaeca3b194a31a2e6789f153eab3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=ADA5fr8tAdzuKkgGRES7ZAY67VM%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-9"/>
<h5 data-id="heading-10">2、claude code使用skills</h5>
<p><strong>第一步，安装 Claude Code</strong></p>
<p>终端中输入：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>然后选择一个文件夹，终端输入： claude，即可启动（要挂梯子，纯国外邮箱，也可以找些代理商）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d01a7d943c543f5926d5231bf635edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=oUJ0re%2FCMIG93YsF6iiIsdPlJoI%3D" alt="" loading="lazy"/></p>
<p>**<br/>
**</p>
<p><strong>第二步，在 Claude Code 中安装 Skills</strong></p>
<p>介绍2种安装方式，分别是：</p>
<p>方式一：自然语言安装</p>
<p>你可以直接让 CC 来安装，直接提需求：</p>
<pre><code class="hljs language-ruby" lang="ruby">帮我安装下 skill，项目地址是：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/anthropics</span><span class="hljs-regexp">/skills/blob</span><span class="hljs-regexp">/mai
n/skills</span><span class="hljs-regexp">/pptx
</span></code></pre>
<p>可以看到他能理解需求，并直接帮安装好了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8453f6edd80446558bbf963f279e63c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=37WpuW9gjKfbaUYmXy2l6sfnGG8%3D" alt="" loading="lazy"/></p>
<p>方式二：手动安装</p>
<p>下载 skill 安装包，然后直接放到 .claude/skills/，这个目录下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2635fa09d221445ab9440332acc6a45c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=RiL51NP%2FXB9k%2FZ4CVv%2FwzoQBo%2BA%3D" alt="" loading="lazy"/></p>
<p><strong>第三步：使用</strong></p>
<p>使用更简单了，你可以直接指定 skill，也可以按照用户意图，Agent 自动选择合适的 skill。</p>
<p>比如输入 prompt：</p>
<p>用 pptx skill 创建一个关于 Claude Skills 的演示文稿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cb28e831ec64d0ebadfff892796cb36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=AhYHm%2FalwlU7xtZz7dDKpPKfmjU%3D" alt="" loading="lazy"/></p>
<p>喝杯茶的时间，Claude Skills 就完成了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c338235cc75647b4b3de75dbe51957cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=1N1plpwRiWtdr7guUBNfWPTXegc%3D" alt="" loading="lazy"/></p>
<p>我们来看下效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88778af37e02465f99c472250a2a1310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=AOa0t5caTyNy7NqtDO%2BKIooL6ns%3D" alt="" loading="lazy"/></p>
<p>一把梭生成的效果还是非常不错的，一个做 PPT 的 skill 就这样安装好了。</p>
<h2 data-id="heading-11">六、怎么创建Skills          </h2>
<p>再聊下，如何制作自己的 Skills ，每个人在某个领域可能都有自己的一套做事方法论，制作属于自己的Skills至关重要。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b3395be36174a45a67d01d67f608092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=wzq1aOmcHvGmPbKiPSR%2FyPuwois%3D" alt="" loading="lazy"/></p>
<p>非常推荐大家先安装 Anthropic 官方的一个 skill：skill-creator，他就是专门用来创建 skill 的 skill。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef01f0e32e784e81be10e10af64e4007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=FHl9SN3II7EnZBg9XFGqbint9jY%3D" alt="" loading="lazy"/></p>
<p>按照同样的方法先安装这个 skill：</p>
<pre><code class="hljs language-ruby" lang="ruby">复制代码帮我直接安装这个skill，地址：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/anthropics</span><span class="hljs-regexp">/skills/blob</span><span class="hljs-regexp">/main/skills</span><span class="hljs-regexp">/skill-creator，克隆这个 skill 到我的已存在的技能目录~/</span>.claude/skills
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0313f8514b584372bfe084597eb89d31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=nFnncBDFntTS7ccqOLyFhiquZYw%3D" alt="" loading="lazy"/></p>
<p>下面就演示下如何在 Cursor 里面快速的创建 skill</p>
<p>创建一个 skill，能自动将 pdf 转为 PPT</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d556194d70ef4724893795521a75d126~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=EBVsZyyHMChgwrdKOuo6Oj%2FGl%2F0%3D" alt="" loading="lazy"/></p>
<p>开始一顿操作来创建这个 skill 了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d07f4dd432f141eeaaad77fc80bee1aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=Tf90IeS2Wi0%2BE9Ek0z3aUnb1DYk%3D" alt="" loading="lazy"/></p>
<p>接下来就什么都不用管了，很快就生成好了这个 skill：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9f70ecb45774eab9abe3414836f2ac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=Bg2bTsUkagI4BAykuIpebr2IpSY%3D" alt="" loading="lazy"/></p>
<p>对应的文件夹也生成 ok 了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d23ac819538c4171b87c2df08a4da341~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=Iwlp6tiEbx4FcozuTKDEpKwIzVE%3D" alt="" loading="lazy"/></p>
<p>来做下验证，输入以下提示词：</p>
<p>帮我把“阿里巴巴Android开发手册.pdf”转为 ppt 格式阿里巴巴Android开发手册.pdf<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c0b38012fe1439993399329afaaeae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=fvfClg2aJo00kYHL1gn73%2FOJi6M%3D" alt="" loading="lazy"/></p>
<p>转好了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e877963220c14fed80858147dfd256c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=w99egeHvOL4NQ3YFXR%2F0sKuiMBQ%3D" alt="" loading="lazy"/></p>
<p>来看看效果，没什么问题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/612bd4ec35a54af1a8ecc4aea8452821~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=FZ%2BObq3D1v4b3hk0a2Iew9Pog%2Bo%3D" alt="" loading="lazy"/></p>
<p>做一个 skill 几分钟时间，非常方便。</p>
<h2 data-id="heading-12">七、都有哪些好用的Skills</h2>
<h4 data-id="heading-13">推荐5个值得一试的 Claude Skills</h4>
<p>它们的共同特点是：<strong>热度适中（万星级别）、应用场景明确、学习成本可控</strong>。无论你是前端开发、后端工程师，还是数据分析师，都能从中找到适合自己的工具</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3cc60cc224e4b0f9d14cea5f16de145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=weW%2B6jl8XUXhkp1hvys0hg37DwY%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-14"/>
<h5 data-id="heading-15">1、code-reviewer：多语言代码审查全能助手</h5>
<p><strong>来源</strong>：davila7/claude-code-templates（14.0k 星）</p>
<p><strong>核心定位</strong>：支持多语言的智能化代码审查工具</p>
<p><strong>解决痛点</strong>：弥补人工审查效率低、标准不一、跨语言知识盲区，突破传统静态分析工具局限</p>
<p><strong>核心能力</strong>：</p>
<ol>
<li>覆盖 TS/JS/Python/Swift/Kotlin/Go 等多语言专属检查规则</li>
<li>从代码质量、最佳实践、安全扫描、性能优化多维度深度分析</li>
<li>生成优先级排序的审查清单 + 具体修改建议 &amp; 代码示例<strong>适用场景</strong>：小团队开发、开源项目 PR 审查、技术债务清理<strong>使用方式</strong>：插件市场安装后，PR 审查时输入指令：“用 code-reviewer 审查这个 PR 的代码变更”</li>
</ol>
<h5 data-id="heading-16"/>
<h5 data-id="heading-17">2、pair-programming：AI 驱动结对编程系统</h5>
<p><strong>来源</strong>：ruvnet/claude-flow（9.9k 星）</p>
<p><strong>核心定位</strong>：多模式 AI 辅助结对编程工具</p>
<p><strong>解决痛点</strong>：传统结对编程人力成本高、节奏难匹配、远程协作困难</p>
<p><strong>核心能力</strong>：</p>
<ol>
<li>三种工作模式：Driver（AI 编写 + 人工把控）、Navigator（人工编写 + AI 实时反馈）、Switch（自动角色切换）</li>
<li>实时代码审查、安全扫描、性能分析 + Truth-score 建议可靠性评分</li>
</ol>
<p><strong>差异化优势</strong>：区别于 Copilot 的代码补全，提供对话式协作、实时 Review、开发方法论引导</p>
<p><strong>典型场景</strong>：TDD 开发、遗留代码重构、新技术探索</p>
<h5 data-id="heading-18"/>
<h5 data-id="heading-19">3、sql-optimization-patterns：SQL 性能优化手册</h5>
<p><strong>来源</strong>：wshobson/agents（23.4k 星）</p>
<p><strong>核心定位</strong>：数据库查询优化与性能诊断工具</p>
<p><strong>解决痛点</strong>：70% 应用性能问题源于低效 SQL，开发者缺乏执行原理认知</p>
<p><strong>核心能力</strong>：</p>
<ol>
<li>自动解读 EXPLAIN 输出，定位全表扫描、索引未使用等瓶颈</li>
<li>提供索引设计指导（平衡选择性、查询频率与写入成本）</li>
<li>识别 N+1 查询、隐式类型转换、SELECT * 等常见反模式</li>
</ol>
<p><strong>适用场景</strong>：慢查询排查、数据库设计评审、ORM 生成 SQL 审查</p>
<p><strong>优化效果</strong>：典型场景性能提升 40 倍（200ms→5ms）</p>
<h5 data-id="heading-20"/>
<h5 data-id="heading-21">4、dbt-transformation-patterns：数据转换最佳实践</h5>
<p><strong>来源</strong>：wshobson/agents（23.4k 星）</p>
<p><strong>核心定位</strong>：dbt 工程化实践指南与工具</p>
<p><strong>解决痛点</strong>：传统数据转换脚本难维护、质量无保障、协作冲突频繁</p>
<p><strong>核心能力</strong>：</p>
<ol>
<li>推荐 models 分层架构（staging→intermediate→marts）</li>
<li>生成增量更新配置（支持 unique_key、schema 变更自适应）</li>
<li>自动生成字段级测试（非空、唯一、数值校验）与结构化文档</li>
</ol>
<p><strong>适用人群</strong>：数据分析师、数据工程师、BI 团队</p>
<h5 data-id="heading-22">5、senior-prompt-engineer：LLM 应用开发提示词专家</h5>
<p><strong>来源</strong>：davila7/claude-code-templates（14.0k 星）</p>
<p><strong>核心定位</strong>：提示词工程与 AI 产品开发工具</p>
<p><strong>解决痛点</strong>：开发者缺乏 Prompt 设计技巧，输出质量不稳定、无评估体系</p>
<p><strong>核心能力</strong>：</p>
<ol>
<li>提供 Few-shot Learning、Chain-of-Thought 等 Prompt 设计模式库</li>
<li>支持结构化 JSON 输出规范，确保可解析性</li>
<li>优化 RAG 检索策略与 Prompt 组织，提升知识库问答效果</li>
<li>辅助设计多 Agent 架构与工作流（如自动化客服系统）</li>
</ol>
<p><strong>适用场景</strong>：AI 产品开发、LLM 应用调优、企业 AI 落地</p>
<h4 data-id="heading-23"/>
<h4 data-id="heading-24">再推荐4个受欢迎的skills仓库</h4>
<h4 data-id="heading-25"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da90e0ee34954965913b5bf050e5ee34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543886&amp;x-signature=IrQzpYcnEfjiRV6xF9OB2jKSj8I%3D" alt="" loading="lazy"/></h4>
<h5 data-id="heading-26">1. Anthropic官方Skills市场</h5>
<p>🔗<strong>访问链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a><br/>
<strong>一句话总结</strong>：由Anthropic官方维护，提供超50,000+标准化技能包，覆盖PDF处理、代码生成等高频场景，支持一键安装与跨平台兼容。</p>
<h5 data-id="heading-27">2. GitHub社区生态市场</h5>
<p>🔗<strong>访问链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.github.com%2F" target="_blank" title="https://skills.github.com/" ref="nofollow noopener noreferrer">skills.github.com/</a><br/>
<strong>一句话总结：</strong> 开发者主导的开源Skills集合地，集成GitHub Actions实现交互式学习，主打灵活自定义与技术创新（如持续集成、CLI开发等）。</p>
<h5 data-id="heading-28">3. ObraSuperpowers社区市场</h5>
<p>🔗<strong>访问链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmcpmarket.cn%2Fskills%2F" target="_blank" title="https://mcpmarket.cn/skills/" ref="nofollow noopener noreferrer">mcpmarket.cn/skills/</a><br/>
<strong>一句话总结：</strong> 极客向第三方技能库，专注轻量化、高精度工作流（如Linear问题解析），以“自我反思指令集”降低上下文开销。</p>
<h5 data-id="heading-29">4、awesome-claude-skills 社区市场</h5>
<p>🔗<strong>访问链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FComposioHQ%2Fawesome-claude-skills" target="_blank" title="https://github.com/ComposioHQ/awesome-claude-skills" ref="nofollow noopener noreferrer">github.com/ComposioHQ/…</a><br/>
<strong>一句话总结</strong>：开发者社区主导的 <strong>开源 Skills 资源库</strong>，汇集 500+ 高质量技能包，覆盖文档处理、数据分析、商业自动化等 9 大高频场景，支持模块化调用与分层加载机制，显著提升 Claude 的垂直领域执行力</p>
<h2 data-id="heading-30">八、Skills常见踩坑指南         </h2>
<h3 data-id="heading-31"/>



































<table><thead><tr><th>序号</th><th>问题</th><th>原因</th><th>解决方法</th></tr></thead><tbody><tr><td>1</td><td>Skill触发不稳定</td><td>description不够明确</td><td>在请求中显式指定"使用xxx Skill"</td></tr><tr><td>2</td><td>上下文消耗大</td><td>SKILL.md内容太多</td><td>引用外部文件：参考 resources/checklist.md</td></tr><tr><td>3</td><td>版本混乱</td><td>Skill修改后没有生效</td><td>删除旧版本或重命名Skill文件夹</td></tr><tr><td>4</td><td>API调用超时未处理</td><td>未设置合理的超时机制和错误重试逻辑，导致用户请求卡死</td><td>1. 设置请求超时时间 2. 实现重试降级逻辑 3. 引入异步调用避免阻塞</td></tr></tbody></table>
<h2 data-id="heading-32">九、我们如何选择Skills         </h2>
<p>Skills生态正在快速发展，从5万+技能的市场，到专业的能力框架，选择越来越多，如何选择Skills，记住一个核心判断标准：<strong>它能不能帮提你高效率，让你事半功倍甚至锦上添花。</strong></p>
<p>另外，面对越来越多的Skills，<strong>建议先去使用，用熟悉了后面再根据自己的SOP写Skills。</strong></p>
<p>感谢你耐心看完这篇文章，希望对你有帮助，点赞收藏不迷路！打完收工，再会。</p>
<p>我是”<strong>程序员码歌</strong>“，<strong>全网昵称统一</strong>，10+年大厂程序员，专注AI工具落地与AI编程实战输出，在职场，玩转副业，目标副业年收入百万，探索可复利、可复制的一人企业成长模式，<strong>可去gzh围观</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot介绍与平台部署]]></title>    <link>https://juejin.cn/post/7601441797117870131</link>    <guid>https://juejin.cn/post/7601441797117870131</guid>    <pubDate>2026-02-01T10:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441797117870131" data-draft-id="7601441475987210286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot介绍与平台部署"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-01T10:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="每日AI新事件"/> <meta itemprop="url" content="https://juejin.cn/user/4455689186448920"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot介绍与平台部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4455689186448920/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    每日AI新事件
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T10:28:02.000Z" title="Sun Feb 01 2026 10:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Clawdbot（近期更名为 <strong>Moltbot/OpenClaw</strong>）是近期 GitHub 上爆火的开源自托管个人 AI 助手，被称为"住在电脑里的贾维斯"。它区别于传统网页版 AI，是一个真正拥有"手脚"和"记忆"的本地智能体。</p>
<hr/>
<h2 data-id="heading-0">一、Clawdbot 核心介绍</h2>
<h3 data-id="heading-1">1. 产品定位</h3>
<p><strong>Personal AI Assistant</strong> —— 不是简单的聊天机器人，而是一个运行在你本地设备（Mac/Linux/Windows）上的<strong>数字管家</strong> ：</p>
<ul>
<li><strong>本地优先</strong>：所有对话记录、操作日志存储在你的硬盘上，数据完全自主可控</li>
<li><strong>跨平台入口</strong>：通过你日常使用的聊天软件（WhatsApp、Telegram、Discord、Slack、Signal、iMessage 等）与 AI 交互</li>
<li><strong>系统级操作能力</strong>：能执行 Shell 命令、浏览器自动化、文件操作、任务调度等实际工作</li>
</ul>
<h3 data-id="heading-2">2. 核心特性</h3>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><strong>持久记忆</strong></td><td>双层记忆结构：短期记忆维持多轮对话上下文，长期记忆形成个人知识库</td></tr><tr><td><strong>主动服务</strong></td><td>可设置定时任务，主动推送提醒和信息，而非仅被动应答</td></tr><tr><td><strong>Web 自动化</strong></td><td>自动填表、抓取数据、监控价格、执行浏览器操作</td></tr><tr><td><strong>多渠道支持</strong></td><td>支持 12+ 聊天平台，打破应用壁垒</td></tr><tr><td><strong>技能扩展</strong></td><td>支持安装插件（Skill）扩展功能，如接入飞书、企业微信等</td></tr></tbody></table>
<h3 data-id="heading-3">3. 适用场景</h3>
<ul>
<li><strong>个人知识管理</strong>：自动整理笔记、总结文档、归类文件</li>
<li><strong>开发运维辅助</strong>：运行测试脚本、监控系统状态、批量重命名文件</li>
<li><strong>智能生活控制</strong>：连接智能家居、根据天气调整设备、自动下单采买</li>
<li><strong>办公自动化</strong>：整理会议纪要、生成报表、管理日程、跨系统同步数据</li>
</ul>
<h3 data-id="heading-4">4. 系统要求</h3>
<p><strong>硬件要求</strong>：</p>
<ul>
<li>处理器：任意现代处理器</li>
<li>内存：<strong>至少 2GB RAM</strong>（推荐 4GB+，运行大模型需更高）</li>
<li>存储：至少 1GB 可用空间</li>
</ul>
<p><strong>软件要求</strong>：</p>
<ul>
<li><strong>macOS 12.0+</strong>（推荐，体验最佳）</li>
<li><strong>Linux</strong>：Ubuntu 20.04+ / Debian 11+ / CentOS Stream 9+</li>
<li><strong>Windows</strong>：10/11（需要 WSL2，强烈推荐使用）</li>
<li><strong>Node.js</strong>：v22.17.0 或更高版本（必须）</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、部署方案详解</h2>
<p>Clawdbot 提供多种部署方式，从一键脚本到 Docker 容器化，适合不同技术水平的用户。</p>
<h3 data-id="heading-6">方案一：官方一键脚本（适合新手）</h3>
<p>这是最简单的方式，自动安装依赖并完成初始化 ：</p>
<p><strong>macOS / Linux</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://clawd.bot/install.sh | bash
</code></pre>
<p><strong>Windows（PowerShell）</strong>：</p>
<pre><code class="hljs language-powershell" lang="powershell">iwr -useb https://clawd.bot/install.ps1 | iex
</code></pre>
<p>安装完成后，运行引导式配置：</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot onboard --flow quickstart
</code></pre>
<p><strong>配置流程</strong>：</p>
<ol>
<li>选择 <strong>Yes</strong> 确认风险提示（系统会提示这是 powerful 且 inherently risky 的工具）</li>
<li>选择 <strong>QuickStart</strong> 使用默认配置快速启动</li>
<li>选择 LLM 提供商（推荐 Qwen、OpenAI、Google 等）</li>
<li>输入 API Key 或进行 OAuth 授权</li>
<li>选择需要安装的 Skills（技能包）和 Hooks（记忆功能等）</li>
<li>启动网关服务并绑定聊天渠道（Telegram/WhatsApp 等）</li>
</ol>
<h3 data-id="heading-7">方案二：Docker 部署（推荐生产环境）</h3>
<p>Docker 方式环境隔离、易于维护，支持官方预构建镜像 ：</p>
<h4 data-id="heading-8">基础部署命令</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取官方镜像</span>
docker pull clawdbot/clawdbot:latest

<span class="hljs-comment"># 启动容器（后台运行）</span>
docker run -d \
  --name clawdbot \
  -p 7860:7860 \
  -p 18780:18780 \
  -v ~/.clawdbot:/root/.clawdbot \
  -v ~/clawdbot-workspace:/app/workspace \
  --restart=unless-stopped \
  clawdbot/clawdbot:latest
</code></pre>
<p><strong>端口说明</strong>：</p>
<ul>
<li><code>7860</code>：Web UI 控制台（Gradio 界面）</li>
<li><code>18780</code>：WebSocket 网关（供聊天渠道接入）</li>
</ul>
<h4 data-id="heading-9">Docker Compose 完整方案（含本地模型）</h4>
<p>如果需要对接本地 Qwen3:32B 模型（通过 Ollama），可使用以下编排 ：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">clawdbot:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">clawdbot/clawdbot:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">clawdbot-qwen3</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>    <span class="hljs-comment"># Web 访问端口</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"18780:18780"</span>  <span class="hljs-comment"># 网关端口</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9100:9100"</span>    <span class="hljs-comment"># Prometheus 监控</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">~/.clawdbot:/root/.clawdbot</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">~/workspace:/app/workspace</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CLAWDBOT_LLM_PROVIDER=ollama</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CLAWDBOT_LLM_BASE_URL=http://localhost:11434</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CLAWDBOT_LLM_MODEL=qwen3:32b</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

  <span class="hljs-attr">ollama:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">ollama/ollama:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">ollama</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ollama-models:/root/.ollama</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"11434:11434"</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">ollama-models:</span>
</code></pre>
<h4 data-id="heading-10">设备授权（安全机制）</h4>
<p>Clawdbot 默认启用设备配对机制，首次访问需要授权 ：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看待授权设备列表</span>
docker <span class="hljs-built_in">exec</span> -it clawdbot clawdbot devices list

<span class="hljs-comment"># 批准设备（替换 abc123 为实际设备 ID）</span>
docker <span class="hljs-built_in">exec</span> -it clawdbot clawdbot devices approve abc123
</code></pre>
<p>批准后访问 <code>http://localhost:7860</code> 即可使用 Web 界面。</p>
<h3 data-id="heading-11">方案三：云平台预装镜像（极简方案）</h3>
<p>阿里云、京东云、七牛云等国内云厂商已提供 Clawdbot 预装镜像，适合无 Linux 基础的用户 ：</p>
<p><strong>阿里云方案</strong>：</p>
<ul>
<li>进入阿里云 ECS 控制台，选择<strong>轻量应用服务器</strong></li>
<li>镜像市场中搜索 <strong>"OpenClaw"</strong>（或 Clawdbot/Moltbot）</li>
<li>选择规格：建议 <strong>2核4G</strong> 起步</li>
<li>创建后通过云厂商提供的<strong>一键启动脚本</strong>自动完成初始化</li>
</ul>
<p><strong>京东云方案</strong>：</p>
<ul>
<li>镜像选择 <strong>Moltbot</strong></li>
<li>创建轻量云主机后，通过 WebTerminal 登录</li>
<li>运行配置脚本 <code>clawdbot onboard</code></li>
<li>可对接京东 JoyBuilder 模型平台（支持 DeepSeek、Qwen 等模型）</li>
<li>支持飞书插件一键安装：<code>clawdbot plugins install @m1heng-clawd/feishu</code></li>
</ul>
<h3 data-id="heading-12">方案四：对接 Ollama 本地大模型</h3>
<p>如果你想完全离线运行，不依赖云端 API ：</p>
<p><strong>步骤 1</strong>：安装 Ollama 并拉取模型</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Ollama</span>
curl -fsSL https://ollama.com/install.sh | sh

<span class="hljs-comment"># 拉取 Qwen3:32B 模型（约 20GB）</span>
ollama pull qwen3:32b
</code></pre>
<p><strong>步骤 2</strong>：配置 Clawdbot 使用 Ollama
编辑配置文件 <code>~/.clawdbot/config.yaml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">llm:</span>
  <span class="hljs-attr">provider:</span> <span class="hljs-string">"ollama"</span>
  <span class="hljs-attr">base_url:</span> <span class="hljs-string">"http://localhost:11434"</span>
  <span class="hljs-attr">model:</span> <span class="hljs-string">"qwen3:32b"</span>
  <span class="hljs-attr">temperature:</span> <span class="hljs-number">0.7</span>
  <span class="hljs-attr">max_tokens:</span> <span class="hljs-number">2048</span>
</code></pre>
<p><strong>步骤 3</strong>：重启服务并验证</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重启 Clawdbot</span>
docker restart clawdbot

<span class="hljs-comment"># 查看日志确认连接成功</span>
docker logs clawdbot --<span class="hljs-built_in">tail</span> 20 | grep <span class="hljs-string">"LLM provider initialized"</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">三、聊天渠道配置示例</h2>
<p>Clawdbot 的核心价值在于<strong>在你熟悉的聊天软件里操作</strong>，以下是 Telegram 的配置示例 ：</p>
<ol>
<li><strong>获取 Bot Token</strong>：在 Telegram 中搜索 <code>@BotFather</code>，发送 <code>/newbot</code> 创建机器人，保存 Token</li>
<li><strong>配置渠道</strong>：
<pre><code class="hljs language-bash" lang="bash">clawdbot channels add
<span class="hljs-comment"># 选择 Telegram，输入 Token</span>
</code></pre>
</li>
<li><strong>启动网关</strong>：
<pre><code class="hljs language-bash" lang="bash">clawdbot gateway --port 18780 --verbose
</code></pre>
</li>
<li><strong>测试</strong>：在 Telegram 中向你的机器人发送消息，即可看到回复</li>
</ol>
<p><strong>飞书配置</strong>类似 ：</p>
<ul>
<li>访问飞书开放平台创建企业自建应用</li>
<li>添加"机器人"能力，获取 <strong>App ID</strong> 和 <strong>App Secret</strong></li>
<li>安装飞书插件并配置凭证</li>
<li>在"事件与回调"中开启长连接模式</li>
</ul>
<hr/>
<h2 data-id="heading-14">四、安全与权限提醒</h2>
<p>Clawdbot 具备<strong>系统级操作能力</strong>，请务必注意：</p>
<ol>
<li><strong>权限控制</strong>：默认情况下 Clawdbot 可以执行 Shell 命令，建议在配置中限制危险操作</li>
<li><strong>设备授权</strong>：首次使用新设备访问 Web UI 时，必须在终端执行 <code>clawdbot devices approve</code> 批准，防止未授权访问</li>
<li><strong>网络隔离</strong>：如果在云端部署，建议不要将 <code>18780</code> 端口暴露到公网，使用 SSH 隧道或 VPN 访问</li>
<li><strong>数据备份</strong>：<code>~/.clawdbot</code> 目录存储了所有配置和记忆，建议定期备份</li>
</ol>
<hr/>
<h2 data-id="heading-15">五、进阶：双镜像协同（Clawdbot + MoltBot）</h2>
<p>Clawdbot 侧重"深度思考"，MoltBot（轻量级前端）侧重"广泛连接"，两者可协同部署 ：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 MoltBot，指向 Clawdbot 作为推理后端</span>
docker run -d \
  --name moltbot \
  -e TELEGRAM_BOT_TOKEN=YOUR_TOKEN \
  -e CLAWDBOT_API_URL=http://host.docker.internal:18780 \
  -e CLAWDBOT_MODEL=vllm/Qwen3-4B-Instruct-2507 \
  --add-host=host.docker.internal:host-gateway \
  moltbot/moltbot:latest
</code></pre>
<p>这样，Telegram 中的简单查询由 MoltBot 直接处理，复杂任务自动转交给 Clawdbot 的大模型处理。</p>
<hr/>
<p><strong>总结</strong>：Clawdbot 代表了 AI 从"对话"向"执行"的进化，通过本地部署既保障了数据隐私，又实现了真正的自动化办公。对于技术小白，推荐使用<strong>云平台预装镜像</strong>；对于开发者，<strong>Docker + Ollama 本地模型</strong>是最佳选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【C语言进阶】数组与字符串]]></title>    <link>https://juejin.cn/post/7601076976442900520</link>    <guid>https://juejin.cn/post/7601076976442900520</guid>    <pubDate>2026-02-01T10:06:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076976442900520" data-draft-id="7601076976442867752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【C语言进阶】数组与字符串"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-02-01T10:06:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="byte轻骑兵"/> <meta itemprop="url" content="https://juejin.cn/user/3995005743010080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【C语言进阶】数组与字符串
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3995005743010080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    byte轻骑兵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T10:06:52.000Z" title="Sun Feb 01 2026 10:06:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>C语言中的数组与字符是学习C语言时非常重要的基础部分。它们不仅用于存储和处理数据，还是理解更复杂数据结构（如字符串、结构体、指针等）的基石。</p>
<h2 data-id="heading-0">一、数组</h2>
<h3 data-id="heading-1">1.1. 定义</h3>
<p>数组是一种基础的数据结构，用于在计算机内存中连续存储相同类型的数据。每个元素在数组中的位置通过索引（或下标）来访问，索引通常是从0开始的。意味着第一个元素的索引是0，第二个元素的索引是1，依此类推。</p>
<h3 data-id="heading-2">1.2. 声明与初始化</h3>
<ul>
<li>
<p><strong>声明数组</strong>：</p>
<p>int arr[10]; // 声明了一个整型数组，大小为10，但未初始化，其值是不确定的。</p>
</li>
<li>
<p><strong>初始化数组</strong>：</p>
<p>int arr[5] = {1, 2, 3, 4, 5}; // 声明并初始化了一个整型数组，大小为5，元素依次为1, 2, 3, 4, 5。</p>
</li>
</ul>
<p>如果初始化时提供的元素少于数组的大小，剩余的元素将自动初始化为0（对于整型数组）。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">int</span> arr[<span class="hljs-number">10</span>] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}; <span class="hljs-comment">// 数组的前三个元素被初始化为1, 2, 3，其余元素自动初始化为0。</span>
</code></pre>
<h3 data-id="heading-3">1.3. 访问元素</h3>
<p>通过索引访问数组元素：</p>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">secondElement</span> = arr[<span class="hljs-number">1</span>]<span class="hljs-comment">; // 访问数组的第二个元素（索引为1的元素）</span>
</code></pre>
<h3 data-id="heading-4">1.4. 遍历数组</h3>
<p>使用循环结构（如for循环）遍历数组：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span>  </span>
  
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{  
    <span class="hljs-type">int</span> arr[<span class="hljs-number">5</span>] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};  
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {  
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, arr[i]); <span class="hljs-comment">// 遍历数组并打印每个元素  </span>
    }  
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c30af5b32a7d47d9bcba8856f65a3529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnl0Zei9u-mqkeWFtQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770545263&amp;x-signature=XNxi%2FAFqxymTuky9niaH7lUOSv0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">二、字符串</h2>
<h3 data-id="heading-6">2.1. 定义与特性</h3>
<p>在C语言中，字符串是一个非常重要的概念，它是以空字符（<code>'\0'</code>）结尾的一串字符的集合，实际上是以字符数组的形式实现的。这种以空字符结尾的特性使得C语言能够识别字符串的结束位置，而不需要额外的长度信息。字符串字面量（如 <code>"Hello, World!"</code>）在程序中被编译器处理为这样的字符数组，并自动在末尾添加一个空字符。</p>
<h3 data-id="heading-7">2.2. 声明与初始化</h3>
<p>字符串的声明与初始化通常有两种方式：</p>
<p><strong>1. 使用****字符数组</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-type">char</span> <span class="hljs-type">str</span>[] = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// 声明并初始化一个字符数组，编译器会自动在末尾添加'\0'</span>
</code></pre>
<p><code>str</code> 是一个字符数组，它包含了字符串 <code>"Hello"</code> 和其结尾的空字符。</p>
<p><strong>2. 使用字符指针</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">char *<span class="hljs-attr">ptr</span> = <span class="hljs-string">"Hello"</span><span class="hljs-comment">; // 声明一个字符指针，指向字符串字面量 "Hello"</span>
</code></pre>
<p><code>ptr</code> 是一个指向常量字符串的指针，字符串 <code>"Hello"</code> 存储在只读内存区域中。尝试通过 <code>ptr</code> 修改字符串的内容将导致未定义行为，因为字符串字面量通常位于程序的只读数据段。</p>
<h3 data-id="heading-8">2.3. 操作字符串</h3>
<p>C标准库提供了一系列函数来操作字符串，这些函数都依赖于字符串以空字符结尾的特性来确定字符串的结束位置。常用的字符串操作函数包括：</p>
<ul>
<li>
<p><code>strlen(const char *str)</code>: 计算字符串 <code>str</code> 的长度（不包括空字符）。<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_37800531%2Farticle%2Fdetails%2F141944562" target="_blank" title="https://blog.csdn.net/weixin_37800531/article/details/141944562" ref="nofollow noopener noreferrer">字符串长度计算函数strlen()详解-CSDN博客</a></p>
</li>
<li>
<p><code>strcpy(char *dest, const char *src)</code>: 将字符串 <code>src</code>（包括空字符）复制到字符串 <code>dest</code>。需要确保 <code>dest</code> 有足够的空间来存储复制的字符串。<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_37800531%2Farticle%2Fdetails%2F141947145" target="_blank" title="https://blog.csdn.net/weixin_37800531/article/details/141947145" ref="nofollow noopener noreferrer">字符串复制函数strcpy()和strncpy()详解-CSDN博客</a></p>
</li>
<li>
<p><code>strcat(char *dest, const char *src)</code>: 将字符串 <code>src</code> 连接到字符串 <code>dest</code> 的末尾，并包括 <code>src</code> 的空字符。同样需要确保 <code>dest</code> 有足够的空间来存储连接后的字符串。<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_37800531%2Farticle%2Fdetails%2F141949336" target="_blank" title="https://blog.csdn.net/weixin_37800531/article/details/141949336" ref="nofollow noopener noreferrer">字符串连接函数strcat()和strncat()详解-CSDN博客</a></p>
</li>
<li>
<p><code>strcmp(const char *str1, const char *str2)</code>: 比较字符串 <code>str1</code> 和 <code>str2</code>。如果 <code>str1</code> 和 <code>str2</code> 字符串相等，则返回 0；如果 <code>str1</code> 在字典序上小于 <code>str2</code>，则返回负数；如果 <code>str1</code> 在字典序上大于 <code>str2</code>，则返回正数。<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_37800531%2Farticle%2Fdetails%2F141977891" target="_blank" title="https://blog.csdn.net/weixin_37800531/article/details/141977891" ref="nofollow noopener noreferrer">字符串比较函数strcmp()和strncmp()详解-CSDN博客</a></p>
</li>
</ul>
<h2 data-id="heading-9">三、使用场景</h2>
<p>C语言中的数组和字符串是编程中非常重要的基础部分，它们具有广泛的应用场景。以下是它们各自的主要应用场景。</p>
<h3 data-id="heading-10">3.1. 数组的应用场景</h3>
<p><strong>1.</strong> <strong>数据存储和处理</strong>：</p>
<ul>
<li>
<p>数组用于存储大量同类型的数据，通过索引可以快速访问和操作数组中的元素，使得数据的存储和处理变得高效和方便。</p>
</li>
<li>
<p>例如，可以使用数组来存储学生的成绩、商品的库存量等，并通过循环遍历数组进行求和、平均值计算、排序等操作。</p>
</li>
</ul>
<p><strong>2. 批量处理</strong>：</p>
<ul>
<li>
<p>使用数组可以实现批量数据的处理，如批量读取、写入文件，批量计算等。</p>
</li>
<li>
<p>通过对数组中的每个元素执行相同的操作，可以简化代码并提高程序的执行效率。</p>
</li>
</ul>
<p><strong>3. 简化代码</strong>：</p>
<ul>
<li>
<p>通过使用数组，可以将多个相关变量组合成一个数组，从而简化代码并提高代码的可读性。</p>
</li>
<li>
<p>例如，在处理多个学生的信息时，可以将每个学生的姓名、年龄、成绩等信息存储在一个结构体数组中，而不是使用多个独立的变量。</p>
</li>
</ul>
<p><strong>4. 函数参数传递</strong>：</p>
<ul>
<li>
<p>在函数调用时，可以通过数组将多个数据一次性传递给函数，简化函数参数的传递过程。</p>
</li>
<li>
<p>有助于提高函数的复用性和灵活性。</p>
</li>
</ul>
<p><strong>5. 统计数据</strong>：</p>
<ul>
<li>
<p>使用数组可以方便地统计数据的频率、分布等信息，如统计一组数据中的最大值、最小值、平均值等。</p>
</li>
<li>
<p>通过对数组中的数据进行统计分析，可以实现各种数据挖掘和机器学习算法。</p>
</li>
</ul>
<p><strong>6. 动态内存分配</strong>：</p>
<ul>
<li>
<p>在需要动态改变数组大小时，可以使用动态内存分配函数（如<code>malloc</code>、<code>calloc</code>、<code>realloc</code>）来分配和释放内存。</p>
</li>
<li>
<p>使得数组的使用更加灵活，可以适应不同规模的数据处理需求。</p>
</li>
</ul>
<p><strong>7. 数据结构实现</strong>：</p>
<ul>
<li>
<p>数组可以用作实现其他数据结构的基础，如链表、栈、队列等。</p>
</li>
<li>
<p>例如，可以使用数组来模拟一个链表，通过数组中的每个元素来存储链表节点的信息。</p>
</li>
</ul>
<h3 data-id="heading-11">3.2. 字符串的应用场景</h3>
<p>字符串在C语言中通常通过字符数组来实现，因此它继承了数组的一些特性，并具有自己独特的应用场景。</p>
<p><strong>1. 文本处理</strong>：</p>
<ul>
<li>
<p>字符串在文本处理中有广泛的应用，如读取文件内容、搜索替换、分割字符串等操作。</p>
</li>
<li>
<p>这些操作是文本编辑、编译器、解释器等工具的基础。</p>
</li>
</ul>
<p><strong>2. 用户界面</strong>：</p>
<ul>
<li>
<p>在图形用户界面（GUI）开发中，字符串用来显示消息、按钮标签、菜单项等。</p>
</li>
<li>
<p>它们是用户与程序交互的重要媒介。</p>
</li>
</ul>
<p><strong>3. 网络编程</strong>：</p>
<ul>
<li>
<p>在网络编程中，字符串被用来表示网络数据包的内容、URL地址等。</p>
</li>
<li>
<p>它们是网络通信中数据交换的基础。</p>
</li>
</ul>
<p><strong>4. 数据库操作</strong>：</p>
<ul>
<li>
<p>数据库操作中经常需要处理字符串，如拼接SQL语句、解析数据、处理查询结果等。</p>
</li>
<li>
<p>字符串处理是数据库编程中不可或缺的一部分。</p>
</li>
</ul>
<p><strong>5. 游戏开发</strong>：</p>
<ul>
<li>
<p>在游戏开发中，字符串用来存储游戏内文本、用户输入、游戏设置等信息。</p>
</li>
<li>
<p>它们为游戏提供了丰富的交互性和可玩性。</p>
</li>
</ul>
<p><strong>6. 日志记录</strong>：</p>
<ul>
<li>
<p>在日志记录中，字符串被用来记录系统运行信息、错误信息等。</p>
</li>
<li>
<p>它们是系统监控和故障排查的重要工具。</p>
</li>
</ul>
<p><strong>7. 加密解密</strong>：</p>
<ul>
<li>
<p>在加密解密算法中，字符串被用来存储密钥、明文、密文等数据。</p>
</li>
<li>
<p>字符串处理是信息安全领域中的基础操作之一。</p>
</li>
</ul>
<h2 data-id="heading-12">四、注意事项</h2>
<p>在C语言中，数组和字符串的使用是编程过程中的基础且重要的部分。以下是它们在使用时需要注意的事项。</p>
<h3 data-id="heading-13">4.1. 数组的使用注意事项</h3>
<p><strong>1. 定义与初始化</strong></p>
<ul>
<li>
<p>数组的元素个数不能为0。</p>
</li>
<li>
<p>数组的类型是一种自定义数据类型，如<code>int arr[10]</code>的类型为<code>int[10]</code>。</p>
</li>
<li>
<p>数组在定义时可以初始化，若只初始化部分元素，则剩余元素自动初始化为0（对于静态存储期或全局数组）。</p>
</li>
</ul>
<p><strong>2. 下标访问</strong></p>
<ul>
<li>
<p>数组下标从0开始，n个元素的数组最后一个元素的下标为n-1。</p>
</li>
<li>
<p>访问数组时索引必须小于数组的大小，否则会导致未定义行为，可能覆盖内存中的其他数据或导致程序崩溃。</p>
<p>int arr[5];<br/>
arr[5] = 6; // 错误：数组越界</p>
</li>
</ul>
<p><strong>3. 内存****连续性</strong></p>
<ul>
<li>
<p>数组在内存中是连续存放的，访问效率较高。</p>
</li>
<li>
<p>但这种连续性也意味着如果数组过大，可能会占用过多的连续内存空间。</p>
</li>
</ul>
<p><strong>4. 大小计算</strong></p>
<ul>
<li>可以使用<code>sizeof</code>运算符计算数组的大小（以字节为单位）和元素个数（通过<code>sizeof(数组)/sizeof(数组[0])</code>计算）。</li>
</ul>
<p><strong>5. 数组大小不可变</strong>：</p>
<p>一旦数组被声明，其大小就不能改变。如果需要动态改变数组大小，可以使用指针和动态内存分配（如<code>malloc</code>、<code>realloc</code>和<code>free</code>）。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span>  </span>
<span class="hljs-type">int</span> *dynamicArray = (<span class="hljs-type">int</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">10</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)); <span class="hljs-comment">// 动态分配一个整型数组  </span>
<span class="hljs-keyword">if</span> (dynamicArray != <span class="hljs-literal">NULL</span>) {  
    <span class="hljs-comment">// 使用dynamicArray  </span>
    <span class="hljs-built_in">free</span>(dynamicArray); <span class="hljs-comment">// 使用完毕后释放内存  </span>
}
</code></pre>
<p><strong>6. 变长数组（<strong><strong>VLA</strong></strong>）</strong></p>
<ul>
<li>
<p>C99标准引入了变长数组的概念，允许使用变量指定数组大小，但变长数组的长度只能在运行时确定，且不能初始化。</p>
</li>
<li>
<p>使用变长数组时要特别注意其生命周期和内存使用，因为它们通常在栈上分配空间，可能会导致栈溢出。</p>
</li>
</ul>
<p><strong>7. 动态内存分配</strong></p>
<ul>
<li>
<p>对于需要动态改变大小的数组，可以使用<code>malloc</code>、<code>calloc</code>、<code>realloc</code>等函数在堆上动态分配内存。</p>
</li>
<li>
<p>使用动态内存分配时要确保正确管理内存，避免内存泄漏或野指针等问题。</p>
</li>
</ul>
<h3 data-id="heading-14">4.2. 字符串的使用注意事项</h3>
<p><strong>1. 字符串定义</strong></p>
<ul>
<li>
<p>字符串在C语言中通常通过字符数组表示，以空字符（<code>\0</code>）作为结束标志。</p>
</li>
<li>
<p>字符串常量（如<code>"hello"</code>）在编译时会被自动存储为字符数组，并在末尾添加<code>\0</code>。</p>
</li>
</ul>
<p><strong>2. 字符串操作</strong></p>
<ul>
<li>
<p>字符串不能直接被赋值（除了初始化时），但可以通过字符数组的形式来修改字符串的内容。</p>
</li>
<li>
<p>使用标准库函数（如<code>strcpy</code>、<code>strcat</code>等）时，要确保目标缓冲区足够大以容纳源字符串及其结束符<code>\0</code>。</p>
</li>
</ul>
<p><strong>3. 缓冲区溢出</strong></p>
<ul>
<li>
<p>字符串操作中最常见的问题是缓冲区溢出，可能导致程序崩溃或安全漏洞。</p>
</li>
<li>
<p>要特别注意使用<code>strncpy</code>、<code>strncat</code>等函数来限制复制的字符数，或使用动态内存分配来确保缓冲区足够大。</p>
</li>
</ul>
<p><strong>4. 字符串函数</strong></p>
<ul>
<li>
<p>C语言标准库提供了一系列操作字符串的函数（如<code>strlen</code>、<code>strcmp</code>、<code>strcpy</code>等），使用时要注意其参数类型和返回值类型。</p>
</li>
<li>
<p>确保字符串以<code>\0</code>结尾，否则可能会导致字符串函数的行为异常。</p>
</li>
</ul>
<p><strong>5. 内存****管理</strong></p>
<ul>
<li>如果字符串是通过动态内存分配得到的，那么在使用完毕后要及时释放内存，避免内存泄漏。</li>
</ul>
<p><strong>6. 字符串数组</strong></p>
<ul>
<li>
<p>当需要存储多个字符串时，可以使用字符串数组（即字符数组的数组）。</p>
</li>
<li>
<p>注意每个字符串的末尾都要有<code>\0</code>作为结束标志，并且整个字符串数组也需要足够的空间来存储这些<code>\0</code>字符。</p>
</li>
</ul>
<blockquote>
<p><strong>C语言中的数组和字符串在使用时需要注意定义与初始化、下标访问、<strong><strong>内存</strong></strong>连续性、大小计算、变长数组的使用、<strong><strong>动态内存分配</strong></strong>、字符串操作、缓冲区溢出、字符串函数的使用以及内存管理等方面的问题。</strong></p>
</blockquote>
<h2 data-id="heading-15">五、总结</h2>
<p>在C语言的学习中，数组和字符串是构建程序逻辑和处理数据不可或缺的基础数据结构。它们各自拥有独特的特性和应用场景，对于深入理解C语言以及后续编程语言的学习都至关重要。</p>
<h3 data-id="heading-16">5.1. 数组</h3>
<ul>
<li>
<p>数组是一种连续存储相同类型数据的结构。它允许程序员通过索引（或下标）快速访问和操作每个元素。</p>
</li>
<li>
<p>数组的声明需要指定类型和大小，大小在声明后不可改变（除非使用动态内存分配如<code>malloc</code>或<code>calloc</code>）。</p>
</li>
<li>
<p>数组的初始化可以在声明时进行，未初始化的元素默认值为0（对于全局和静态数组）。</p>
</li>
<li>
<p>访问数组元素时需要注意索引不要越界，否则可能导致未定义行为，如访问非法内存区域。</p>
</li>
<li>
<p>遍历数组通常使用循环结构，如<code>for</code>循环或<code>while</code>循环。</p>
</li>
</ul>
<h3 data-id="heading-17">5.2. 字符串</h3>
<ul>
<li>
<p>字符串在C语言中是以空字符（<code>'\0'</code>）结尾的字符数组。这种以空字符结尾的特性使得C语言能够识别字符串的结束位置。</p>
</li>
<li>
<p>字符串字面量（如<code>"Hello, World!"</code>）在内存中也是以这种方式存储的，编译器会自动在末尾添加一个空字符。</p>
</li>
<li>
<p>字符串可以通过字符数组或字符指针来声明和初始化。使用字符数组时，需要为整个字符串（包括空字符）分配足够的空间；使用字符指针时，应注意字符串字面量通常存储在只读内存区域，不应被修改。</p>
</li>
<li>
<p>C标准库提供了一系列函数来操作字符串，如<code>strlen</code>、<code>strcpy</code>、<code>strcat</code>、<code>strcmp</code>等。这些函数依赖于字符串以空字符结尾的特性来确定字符串的结束位置。</p>
</li>
<li>
<p>操作字符串时需要特别小心，确保目标数组有足够的空间来存储结果字符串，以防止缓冲区溢出等安全问题。</p>
</li>
</ul>
<h3 data-id="heading-18">5.3. 注意事项</h3>
<ul>
<li>
<p>对于数组，要注意索引不要越界，避免访问非法内存区域。</p>
</li>
<li>
<p>对于字符串，要确保字符串的末尾有空字符，否则函数可能会读取到内存中的垃圾数据。</p>
</li>
<li>
<p>使用<code>strcpy</code>、<code>strcat</code>等函数时要确保目标数组有足够的空间，防止缓冲区溢出。</p>
</li>
<li>
<p>字符串字面量通常存储在只读内存区域，不应尝试修改它们。</p>
</li>
</ul>
<p>掌握数组和字符串的声明、初始化、访问、遍历以及相关的注意事项，是深入学习C语言和其他编程语言的重要基础。它们不仅用于处理基础的数据存储和文本处理任务，还是实现更复杂数据结构（如链表、栈、队列等）和算法（如排序、搜索等）的基础。因此，在学习C语言的过程中，务必重视数组和字符串的学习和应用。</p>
<h2 data-id="heading-19">六、测试</h2>
<blockquote>
<p><strong>问题</strong>：以下代码输出结果是什么？为什么？（某互联网公司2023年C语言面试题）</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">char</span> str1[] = <span class="hljs-string">"abc"</span>;
    <span class="hljs-type">char</span> str2[] = <span class="hljs-string">"abc\0def"</span>;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d, %d"</span>, <span class="hljs-built_in">strlen</span>(str1), <span class="hljs-built_in">strlen</span>(str2));
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
</blockquote>
<p><strong>答案</strong>：</p>
<p>输出<code>3, 3</code>。</p>
<p>原因：C语言中<code>strlen</code>函数计算字符串长度时，以<code>'\0'</code>为结束标志（不包含<code>'\0'</code>），<code>str2</code>中<code>'\0'</code>后的<code>def</code>不会被统计。</p>
<blockquote>
<p><strong>问题</strong>：数组越界会导致什么后果？如何避免数组越界？</p>
</blockquote>
<p><strong>答案</strong>：</p>
<p>后果：程序崩溃、内存数据被篡改、出现未定义行为（如访问非法内存）；</p>
<p>避免方法：</p>
<p>① 访问时确保索引在<code>0~n-1</code>（n为数组长度）；</p>
<p>② 用<code>sizeof(数组)/sizeof(数组[0])</code>动态获取数组长度；</p>
<p>③ 避免使用变长数组时过度分配栈空间；</p>
<p>④ 动态数组需合理管理内存边界。</p>
<blockquote>
<p><strong>问题</strong>：<code>strcpy</code>和<code>strncpy</code>的核心区别是什么？使用<code>strcpy</code>时需注意什么？（某大厂2024年嵌入式开发面试题）</p>
</blockquote>
<p><strong>答案</strong>：</p>
<p>核心区别：<code>strcpy</code>无长度限制，会将源字符串（含<code>'\0'</code>）完整复制到目标地址，直到遇到<code>'\0'</code>；<code>strncpy</code>需指定复制长度<code>n</code>，最多复制<code>n-1</code>个字符，剩余位置补<code>'\0'</code>。</p>
<p>使用<code>strcpy</code>注意事项：确保目标缓冲区有足够空间容纳源字符串（含<code>'\0'</code>），否则会导致缓冲区溢出。</p>
<blockquote>
<p><strong>问题</strong>：<code>sizeof</code> 和 <code>strlen</code> 在处理字符数组时有何根本区别？</p>
</blockquote>
<p><strong>答案：</strong></p>
<p><code>sizeof</code>是编译时运算符，返回数组或类型占用的总内存字节数（包括<code>\0</code>）。<code>strlen</code>是运行时函数，计算从给定地址到第一个<code>\0</code>字符前的字符个数（不包括<code>\0</code>）。例如，<code>char str[100] = "hello";</code>，<code>sizeof(str)</code>是100，而<code>strlen(str)</code>是5。</p>
<p>**问题：**在C语言中，数组名作为函数参数传递时，会发生什么？请解释“数组退化为指针”的含义。</p>
<p><strong>答案：</strong></p>
<p>数组名作为函数参数时，会退化为指向其首元素的指针，同时丢失其大小信息。因此，在函数内部无法用<code>sizeof(参数)</code>获得原数组长度，通常需要额外传递一个长度参数。例如，<code>void func(int arr[])</code> 实际上等价于 <code>void func(int *arr)</code>。</p>
<blockquote>
<p><strong>问题</strong>：以下代码存在什么安全隐患？如何安全地修正？</p>
<pre><code class="hljs language-scss" lang="scss">char dest<span class="hljs-selector-attr">[10]</span>;
char <span class="hljs-attribute">src</span><span class="hljs-selector-attr">[]</span> = "This is <span class="hljs-selector-tag">a</span> very long string that will cause <span class="hljs-attribute">overflow</span>";
<span class="hljs-built_in">strcpy</span>(dest, src);
</code></pre>
</blockquote>
<p><strong>答案</strong>：</p>
<p>存在缓冲区溢出风险。<code>src</code>远长于<code>dest</code>，<code>strcpy</code>会越过<code>dest</code>边界写入内存，导致未定义行为（程序崩溃、数据损坏或被恶意利用）。</p>
<p>安全修正：使用 <code>snprintf(dest, sizeof(dest), "%s", src);</code> 或确保复制前检查长度。</p>
<blockquote>
<p><strong>题目</strong>：C语言中，数组和指针有什么区别？请举例说明。</p>
</blockquote>
<p><strong>答案</strong>：</p>
<p>数组是连续内存块，大小固定，声明后不能改变；指针是变量，存储地址，可重新指向其他内存。例如，<code>int arr[5]</code>定义数组，<code>int *ptr</code>定义指针，<code>ptr = arr</code>使指针指向数组首元素。数组名在多数情况下退化为指针，但 <code>sizeof(arr)</code>返回数组总大小，而 <code>sizeof(ptr)</code>返回指针大小。</p>
<blockquote>
<p><strong>题目</strong>：如何安全地复制字符串？比较 <code>strcpy</code>和 <code>strncpy</code>的优缺点。</p>
</blockquote>
<p><strong>答案</strong>：</p>
<p><code>strcpy</code>直接复制整个字符串，可能导致缓冲区溢出；<code>strncpy</code>可指定最大复制字符数，更安全，但不会自动添加空字符，需手动处理。例如，使用 <code>strncpy(dest, src, size-1)</code>并设置 <code>dest[size-1] = '\0'</code>。</p>
<blockquote>
<p><strong>题目</strong>：C语言中，字符串字面量为什么通常不可修改？尝试修改会导致什么？</p>
</blockquote>
<p><strong>答案</strong>：</p>
<p>字符串字面量（如 <code>"hello"</code>）存储在只读内存段（如.rodata），修改会触发未定义行为（如程序崩溃）。这是因为编译器为优化和安全性设计。应使用字符数组（如 <code>char str[] = "hello"</code>）进行修改。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）]]></title>    <link>https://juejin.cn/post/7601101531921104942</link>    <guid>https://juejin.cn/post/7601101531921104942</guid>    <pubDate>2026-02-01T08:24:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531921104942" data-draft-id="7600489282840002570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）"/> <meta itemprop="keywords" content="深度学习,NLP,开源"/> <meta itemprop="datePublished" content="2026-02-01T08:24:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柠柠酱"/> <meta itemprop="url" content="https://juejin.cn/user/3739876675556569"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3739876675556569/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柠柠酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:24:25.000Z" title="Sun Feb 01 2026 08:24:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>想给简历加个 NLP 实战项目？本文记录了我从零搭建一个企业级规范的恶意评论检测系统的全过程。</p>
</blockquote>
<p><strong>摘要</strong>：想给简历加个 NLP 实战项目？本文记录了我从零搭建一个<strong>企业级规范</strong>的恶意评论检测系统的全过程，从Kaggle数据集预处理、Word2Vec词向量构建，到Bi-LSTM模型搭建、工程化代码编写，再到模型评估与可视化，全程复盘新手易踩的技术坑。项目使用的数据集来自Kaggle的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Fcompetitions%2Fjigsaw-toxic-comment-classification-challenge%2Fdata" target="_blank" title="https://www.kaggle.com/competitions/jigsaw-toxic-comment-classification-challenge/data" ref="nofollow noopener noreferrer">Toxic Comment Classification Challenge</a>，包括训练集和测试集，目标是对网络评论进行多标签恶意属性分类。完整可运行代码已上传至<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSalem532%2FToxic_Comment_Detection" target="_blank" title="https://github.com/Salem532/Toxic_Comment_Detection" ref="nofollow noopener noreferrer">GitHub</a>，新手可直接参考避坑、快速上手运行项目。</p>
<p><em>关键词：NLP实战；Word2Vec；Bi-LSTM；恶意评论检测；多标签分类；Kaggle实战；PyTorch工程化；深度学习新手避坑</em></p>
<h2 data-id="heading-0">🧐 为什么做这个？</h2>
<p>作为一个深度学习新手，之前我们已经完成了车道线分割的CV实战，但NLP项目一直没动手实践过。NLP入门的经典任务（文本分类、情感分析、命名实体识别）看似简单，但要做到<strong>工程化、模块化、可复现</strong>，其实并不容易。</p>
<p>而企业招人的时候，<strong>根本不看你会不会跑demo，更看重工程化思维和项目落地能力</strong>——能不能把一个想法变成可复现、可维护、可优化的完整系统。</p>
<p>为了让简历上的NLP项目不再像“玩具”，也为了真正搞懂NLP基础任务的完整流程，这次我决定按<strong>企业级工程标准</strong>（Config参数分离、模块化设计、日志管理、结果可视化）来做经典NLP任务——<strong>恶意评论检测</strong>。毕竟，把基础任务做规范，比硬啃复杂模型更有实际意义。</p>
<h2 data-id="heading-1">🎯 任务目标：不仅是“好人坏人”，而是多标签精准分类</h2>
<p>我们要处理的是 Kaggle 上的经典比赛：<strong>Toxic Comment Classification</strong>，核心是对网络评论进行恶意属性标注，也是NLP入门必做的多标签分类任务。</p>
<h3 data-id="heading-2">⚠️ （回顾）新手核心知识点：多标签分类 vs 多分类</h3>
<p>很多新手会把这两个概念搞混（我就是个典型的例子），这里用最通俗的话讲清楚：</p>
<ul>
<li><strong>多分类</strong>：从多个互斥的类别中选一个，比如“猫/狗/鸟”，一张图片只能是其中一种；</li>
<li><strong>多标签</strong>：从多个不互斥的类别中选任意多个，比如评论可以同时是“恶意+侮辱+威胁”，就像一个人可以同时是“程序员+铲屎官+咖啡爱好者”。</li>
</ul>
<h3 data-id="heading-3">本次任务标签定义</h3>
<p>我们需要让模型对每条评论，同时预测6种恶意属性的概率（0=无，1=有），标签对应关系如下：</p>





























<table><thead><tr><th>标签名</th><th>含义</th><th>标签名</th><th>含义</th></tr></thead><tbody><tr><td>toxic</td><td>普通恶意</td><td>threat</td><td>威胁性评论</td></tr><tr><td>severe_toxic</td><td>重度恶意</td><td>insult</td><td>侮辱性评论</td></tr><tr><td>obscene</td><td>淫秽性评论</td><td>identity_hate</td><td>身份仇恨评论</td></tr></tbody></table>
<h2 data-id="heading-4">🛠️ 技术栈与“强迫症”工程结构（新手可直接默写）</h2>
<p>抛弃了以前“一把梭”的写法，这次采用<strong>模块化、可复现、易优化</strong>的分离式架构，所有模块解耦，改参数、换模型、加功能都不用动核心代码，新手照抄这个结构，做任何NLP基础任务都能用。</p>
<h3 data-id="heading-5">核心技术栈</h3>








































<table><thead><tr><th>模块</th><th>技术选型</th><th>选型原因（新手友好版）</th></tr></thead><tbody><tr><td>词向量构建</td><td>Word2Vec</td><td>轻量、易训练、适合中小规模数据集，是NLP词向量基础</td></tr><tr><td>特征提取</td><td>Bi-LSTM（双向LSTM）</td><td>相比基础RNN解决了梯度消失问题，能捕捉文本上下文信息，双向设计更贴合语言理解</td></tr><tr><td>配置管理</td><td>YAML</td><td>纯文本格式，易编写、易读取，不用在代码里硬编码参数</td></tr><tr><td>日志管理</td><td>Python logging</td><td>记录训练过程中的关键信息，跑崩了可追溯问题</td></tr><tr><td>可视化</td><td>Matplotlib + TSNE</td><td>词向量可视化、训练曲线可视化，直观验证模型效果</td></tr><tr><td>评估指标</td><td>AUC + F1 + 准确率</td><td>多维度评估模型，避免单一指标的误导</td></tr></tbody></table>
<h3 data-id="heading-6">企业级目录结构（附各文件夹/文件核心作用）</h3>
<p>新手最容易犯的错是“所有代码堆在一个文件里”，下面这个结构把<strong>数据、模型、训练、配置</strong>完全分离，每个模块只做一件事，注释写清了每个文件夹里该放什么，直接照搬就行：</p>
<pre><code class="hljs language-text" lang="text">toxic_comment_detection/
├── configs/            # 所有超参数/路径都在这，改参不用动代码！
│   └── config.yaml     # 包含批次大小、学习率、词向量维度、LSTM层数等所有参数
├── src/                # 核心代码库（模块化设计，显得专业且易维护）
│   ├── data/           # 数据相关所有代码（重点：NLP大部分坑在这）
│   │   ├── __init__.py
│   │   ├── data_clean.py  # 数据清洗：去特殊符号、去停用词、小写转换等
│   │   ├── tokenizer.py   # 分词、词表构建、OOV（未登录词）处理
│   │   ├── dataset.py     # PyTorch自定义Dataset，加载/处理训练/测试数据
│   │   └── word2vec_utils.py     # Word2Vec词向量训练与加载
│   ├── models/         # 模型定义，换模型只改这里！
│   │   ├── __init__.py
│   │   └── lstm.py     # Word2Vec+Bi-LSTM+全连接层，多标签输出
│   ├── trainer.py      # 训练循环核心逻辑：前向传播、损失计算、优化器更新
│   ├── evaluator.py    # 评估逻辑：AUC/F1/准确率计算，模型推理
│   └── utils/          # 工具函数：日志初始化、模型保存/加载、可视化
│       ├── __init__.py
│       ├── logger.py
│       ├── model_utils.py
│       └── visualization.py
├── saved/              # 自动保存，无需手动操作
│   ├── logs/           # 训练日志文件，记录每轮损失、验证集指标
│   ├── models/         # 自动保存的最优模型权重（按AUC筛选）
│   └── results/        # 测试集预测结果、可视化图片、评估报告
├── train.py            # 训练入口文件（一行命令启动训练，新手友好）
├── evaluate.py         # 评估入口文件（加载模型，跑测试集评估+可视化）
├── predict.py          # 单条评论预测入口（实际落地用，输入一句话直接出结果）
├── visualize.py        # 词向量TSNE可视化入口（验证词向量质量）
└── requirements.txt    # 锁死所有依赖版本，避免环境问题
</code></pre>
<h2 data-id="heading-7">📝 前置必备：NLP数据预处理全流程（新手踩坑重灾区）</h2>
<p>NLP任务中，<strong>数据预处理的质量决定了模型效果的上限</strong>，模型再牛，数据没处理好也是白搭。很多新手直接跳过清洗步骤就开始训练，结果模型效果差到离谱，还不知道问题出在哪。</p>
<p>本次项目基于Kaggle原始数据集，做了<strong>工业级标准的数据预处理流程</strong>，每一步都有明确的目的，新手可直接复用代码，以下是核心步骤（附代码片段和新手注意点）：</p>
<h3 data-id="heading-8">步骤1：数据加载与初步探索</h3>
<p>首先加载Kaggle的<code>train.csv</code>和<code>test.csv</code>，查看数据规模、标签分布、评论长度，<strong>重点看样本是否均衡、有无缺失值</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 加载数据</span>
train_df = pd.read_csv(<span class="hljs-string">"train.csv"</span>)
test_df = pd.read_csv(<span class="hljs-string">"test.csv"</span>)
test_labels_df = pd.read_csv(<span class="hljs-string">"test_labels.csv"</span>)

<span class="hljs-comment"># 检查缺失值，直接删除或填充</span>
train_df = train_df.dropna(subset=[<span class="hljs-string">'comment_text'</span>])
test_df = test_df.dropna(subset=[<span class="hljs-string">'comment_text'</span>])

<span class="hljs-comment"># 查看标签分布（了解样本不均衡情况）</span>
label_cols = [<span class="hljs-string">'toxic'</span>, <span class="hljs-string">'severe_toxic'</span>, <span class="hljs-string">'obscene'</span>, <span class="hljs-string">'threat'</span>, <span class="hljs-string">'insult'</span>, <span class="hljs-string">'identity_hate'</span>]
<span class="hljs-built_in">print</span>(train_df[label_cols].<span class="hljs-built_in">sum</span>())
</code></pre>
<p>你会发现：普通恶意（toxic）评论约15000条，而身份仇恨（identity_hate）仅约1500条，样本极度不均衡，此时我们需要在后续训练中使用<strong>AUC指标</strong>，而不是准确率。</p>
<h4 data-id="heading-9">💣  避坑指南：AUC 是啥？为什么用 AUC 而不是准确率？</h4>
<p>很多新手在做分类任务时，第一反应是看“准确率（Accuracy）”。但在恶意评论检测这个场景下，准确率是一个极其危险的指标。在 Kaggle 的这个数据集里，90% 以上都是正常评论。这意味着，即使我的模型是个“复读机”，只会预测“正常”，它也能拿到 90% 以上的准确率。但这样的模型在实际业务中完全无法识别恶意攻击，是毫无意义的。</p>
<p>而 <strong>AUC (Area Under Curve)</strong> 指标，专门用来衡量模型区分正负样本的能力。</p>
<ul>
<li>它不看表面分数，看排序能力：AUC 衡量的是模型是否有能力把“恶意评论”打的分数比“正常评论”高。</li>
<li>它对样本分布不敏感：哪怕正负样本比例是 1:100，AUC 依然能公正地评估出模型的区分能力。</li>
<li>数值含义：AUC 越接近 1，代表模型区分“好坏”的能力越强。</li>
</ul>
<h3 data-id="heading-10">步骤2：文本清洗（去除噪声，让模型专注有效信息）</h3>
<p>网络评论包含大量噪声：特殊符号（@、#、&amp;）、多余空格、大写字母、停用词（the/a/an等无意义词汇），这些都会干扰模型学习，必须清洗干净。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">def</span> <span class="hljs-title function_">clean_text</span>(<span class="hljs-params">text</span>):
    <span class="hljs-comment"># 转小写（避免Hello/hello/HELLO被视为不同词汇）</span>
    text = <span class="hljs-built_in">str</span>(text).lower()
    <span class="hljs-comment"># 正则过滤：仅保留小写字母和空格，去除其他所有字符（符号、数字、表情等）</span>
    text = re.sub(<span class="hljs-string">r'[^a-z\s]'</span>, <span class="hljs-string">''</span>, text)
    <span class="hljs-comment"># 按空格分词，返回单词列表</span>
    <span class="hljs-keyword">return</span> text.split()
</code></pre>
<blockquote>
<p><strong>注意点</strong>：不要过度清洗！比如不要去除所有标点，部分标点（！、？）能传递情绪，但网络评论的标点杂乱，本次直接全部去除更稳妥。</p>
</blockquote>
<h3 data-id="heading-11">步骤3：分词与词表构建（让计算机“认识”单词）</h3>
<p>计算机看不懂文字，只能看懂数字，所以需要：</p>
<ol>
<li><strong>分词</strong>：把句子拆成单个单词，比如<code>You are stupid</code>→<code>[You, are, stupid]</code>；</li>
<li><strong>词表构建</strong>：给每个唯一单词分配一个数字ID（词汇表），比如<code>You=1, are=2, stupid=3</code>；</li>
<li><strong>OOV处理</strong>：对词表外的未登录词，分配统一的ID（比如1），避免模型报错。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> .data_clean <span class="hljs-keyword">import</span> clean_text  <span class="hljs-comment"># 导入独立的清洗函数</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextTokenizer</span>:
    <span class="hljs-string">"""
    分词器核心类：负责词表构建、文本→ID序列转换、Tokenizer保存与加载
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_len=<span class="hljs-number">200</span>, min_freq=<span class="hljs-number">2</span></span>):
        self.max_len = max_len  <span class="hljs-comment"># 序列固定长度（截断/填充）</span>
        self.min_freq = min_freq  <span class="hljs-comment"># 词汇最小出现频率（过滤低频词）</span>
        <span class="hljs-comment"># 初始词表：&lt;PAD&gt;填充符（ID=0）、&lt;UNK&gt;未登录词（ID=1）</span>
        self.word2idx = {<span class="hljs-string">"&lt;PAD&gt;"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"&lt;UNK&gt;"</span>: <span class="hljs-number">1</span>}
        self.idx2word = {<span class="hljs-number">0</span>: <span class="hljs-string">"&lt;PAD&gt;"</span>, <span class="hljs-number">1</span>: <span class="hljs-string">"&lt;UNK&gt;"</span>}
        self.vocab_size = <span class="hljs-number">2</span>  <span class="hljs-comment"># 初始词表大小（2个特殊符号）</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_vocab</span>(<span class="hljs-params">self, texts</span>):
        <span class="hljs-string">"""
        基于输入文本构建词表
        Args:
            texts: 文本列表（list[str]），如 [ "I hate you", "You are stupid" ]
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Building vocabulary..."</span>)
        word_counter = Counter()  <span class="hljs-comment"># 统计词频</span>

        <span class="hljs-comment"># 遍历所有文本，统计有效词频</span>
        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:
            clean_words = clean_text(text)  <span class="hljs-comment"># 调用独立清洗函数</span>
            word_counter.update(clean_words)

        <span class="hljs-comment"># 过滤低频词，更新词表（仅保留出现次数≥min_freq的词）</span>
        <span class="hljs-keyword">for</span> word, freq <span class="hljs-keyword">in</span> word_counter.items():
            <span class="hljs-keyword">if</span> freq &gt;= self.min_freq:
                self.word2idx[word] = self.vocab_size
                self.idx2word[self.vocab_size] = word
                self.vocab_size += <span class="hljs-number">1</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Vocab building completed! Final vocab size: <span class="hljs-subst">{self.vocab_size}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_tokens_to_ids</span>(<span class="hljs-params">self, text</span>):
        <span class="hljs-string">"""
        文本→ID序列：清洗→分词→ID转换→截断/填充
        Args:
            text: 单条原始文本（str）
        Returns:
            固定长度的ID序列（list[int]）
        """</span>
        <span class="hljs-comment"># 1. 文本清洗+分词</span>
        clean_words = clean_text(text)
        <span class="hljs-comment"># 2. 转换为ID（未登录词用&lt;UNK&gt;的ID=1）</span>
        ids = [self.word2idx.get(word, self.word2idx[<span class="hljs-string">"&lt;UNK&gt;"</span>]) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> clean_words]
        <span class="hljs-comment"># 3. 截断（超长）或填充（超短）到max_len</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ids) &gt; self.max_len:
            ids = ids[:self.max_len]  <span class="hljs-comment"># 截断：保留前max_len个ID</span>
        <span class="hljs-keyword">else</span>:
            ids += [self.word2idx[<span class="hljs-string">"&lt;PAD&gt;"</span>]] * (self.max_len - <span class="hljs-built_in">len</span>(ids))  <span class="hljs-comment"># 填充：末尾补&lt;PAD&gt;的ID=0</span>
        <span class="hljs-keyword">return</span> ids

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self, save_path</span>):
        <span class="hljs-string">"""
        保存Tokenizer到本地（pickle格式，方便后续复用词表）
        Args:
            save_path: 保存路径（如 "saved/tokenizer.pkl"）
        """</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(save_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:
            pickle.dump(self, f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Tokenizer successfully saved to: <span class="hljs-subst">{save_path}</span>"</span>)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">load_path</span>):
        <span class="hljs-string">"""
        从本地加载Tokenizer（无需重新构建词表）
        Args:
            load_path: 加载路径（如 "saved/tokenizer.pkl"）
        Returns:
            加载后的TextTokenizer实例
        """</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(load_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            tokenizer = pickle.load(f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Tokenizer successfully loaded from: <span class="hljs-subst">{load_path}</span>"</span>)
        <span class="hljs-keyword">return</span> tokenizer
</code></pre>
<blockquote>
<p><strong>注意点</strong>：序列长度的选择！太短会截断有效信息，太长会增加计算量、引入噪声。一般选择<strong>95%分位数</strong>的长度作为max_len，既能覆盖大部分样本，又不会过长。</p>
</blockquote>
<h3 data-id="heading-12">步骤4：构建PyTorch Dataset（适配模型训练）</h3>
<p>最后把处理好的数字序列和标签，封装成PyTorch的<code>Dataset</code>类，让模型能批量加载数据，这是PyTorch训练的标准操作，新手必须掌握。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToxicDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, texts, labels, tokenizer</span>):
        self.texts = texts
        self.labels = labels
        self.tokenizer = tokenizer

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.texts)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):
        <span class="hljs-comment"># 获取单条文本和标签</span>
        text = self.texts[idx]
        label = self.labels[idx]

        <span class="hljs-comment"># 文本→ID序列（调用Tokenizer的转换方法）</span>
        input_ids = self.tokenizer.convert_tokens_to_ids(text)

        <span class="hljs-comment"># 转换为PyTorch Tensor（匹配模型输入格式）</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"input_ids"</span>: torch.tensor(input_ids, dtype=torch.long),  <span class="hljs-comment"># 文本ID序列：(max_len,)</span>
            <span class="hljs-string">"label"</span>: torch.tensor(label, dtype=torch.float32)       <span class="hljs-comment"># 标签：(6,)</span>
        }
</code></pre>
<h2 data-id="heading-13">🧠 模型原理：从Word2Vec到Bi-LSTM，新手也能懂的NLP基础模型</h2>
<p>本次项目的核心模型是<strong>Word2Vec（词向量）+ Bi-LSTM（特征提取）+ 全连接层（多标签输出）</strong> ，都是NLP的基础模型，看似复杂，用通俗的比喻+示意图就能彻底搞懂，新手不用怕！</p>
<h3 data-id="heading-14">先搞懂：为什么需要Word2Vec？（计算机的“语言翻译官”）</h3>
<p>计算机只能处理数字，但文字是符号，直接把单词转成随机数字（比如You=1, are=2），模型根本学不到单词的语义——比如<code>stupid</code>和<code>idiot</code>是近义词，但随机数字没有任何关联。</p>
<p><strong>Word2Vec的核心作用</strong>：把每个单词转换成一个<strong>低维稠密的向量（Embedding）</strong> ，让<strong>语义相近的单词，向量在空间中距离更近</strong>。比如<code>stupid</code>和<code>idiot</code>的向量几乎重合，<code>good</code>和<code>nice</code>的向量距离很近，而<code>stupid</code>和<code>good</code>的向量距离很远。</p>
<h4 data-id="heading-15">Word2Vec的两种核心模式</h4>
<p>Word2Vec主要有两种训练方式，都是基于“上下文预测单词”的思想，本次项目用<strong>Skip-gram</strong>（适合中小规模数据集）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5aa6f660dd4324bc01279b18925a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=oZozcHzRtpoaw%2Bo0PWlSPmUnKYQ%3D" alt="Word2Vec.png" loading="lazy"/></p>
<ul>
<li><strong>Skip-gram</strong>：给中心词，预测周围的上下文词，适合稀有词较多的数据集（比如本次的恶意评论，有很多小众脏话）；</li>
<li><strong>CBOW</strong>：给上下文词，预测中心词，训练速度快，适合大规模通用数据集。</li>
</ul>
<h3 data-id="heading-16">再搞懂：LSTM是什么？为什么比RNN强？</h3>
<p>这个内容在<a href="https://juejin.cn/post/7597080391879671818" target="_blank" title="https://juejin.cn/post/7597080391879671818">【深度学习Day14】</a>里讲过，这里简要复盘，方便新手理解LSTM的核心原理。</p>
<p>处理文本这种<strong>序列数据</strong>，最基础的模型是RNN（循环神经网络），但RNN有个致命缺陷——<strong>梯度消失</strong>，当句子较长时，RNN会忘记前面的单词（比如读到句子末尾，已经忘了开头说的是什么），根本无法捕捉长距离上下文信息。<strong>LSTM（长短期记忆网络）</strong> 是RNN的改进版，核心是加入了<strong>记忆单元和门控机制</strong>，可以理解为一个“带筛选功能的笔记本”——能记住重要的信息，忘记无用的信息，完美解决了RNN的梯度消失问题。</p>
<h4 data-id="heading-17">LSTM的核心结构：3个门控+1个记忆单元</h4>
<p>不用记复杂的数学公式，用“笔记本”的比喻理解3个门控的作用：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a851998f649844288f7740e1374e68c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=I%2BHNSCot6vlWIHWsAnpu8e1sDfI%3D" alt="LSTM细胞.png" loading="lazy"/></p>
<ul>
<li><strong>遗忘门</strong>：决定哪些记忆需要被忘记，比如评论里的“的/地/得”，完全可以忘记；</li>
<li><strong>输入门</strong>：决定哪些新信息需要被记住，比如“stupid”“idiot”这些恶意关键词，必须牢牢记住；</li>
<li><strong>输出门</strong>：决定当前需要输出哪些记忆给下一个LSTM细胞，比如读到“you are”，需要把这个信息传递下去，方便后续判断是否是恶意评论；</li>
<li><strong>细胞状态</strong>：LSTM的核心，像一条“传送带”，从句子开头到结尾全程保存记忆，几乎不会丢失信息。</li>
</ul>
<h4 data-id="heading-18">Bi-LSTM（双向LSTM）：更贴合人类的“阅读方式”</h4>
<p>人类阅读时，会结合上下文理解语义（比如读到“You are stupid, but I like you”这句话，需要结合后半句才知道前半句不是恶意），而普通LSTM只能<strong>从左到右</strong>读文本，无法捕捉反向的上下文信息。<strong>Bi-LSTM（双向LSTM）</strong> 就是把两个LSTM叠加在一起：一个从左到右读，一个从右到左读，最后把两个LSTM的输出拼接起来，这样模型就能同时捕捉<strong>正向和反向</strong>的上下文信息，比单LSTM的效果提升一个档次，也是目前NLP基础任务的标配。</p>
<h3 data-id="heading-19">核心模型代码片段（Bi-LSTM多标签分类）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LSTMClassifier</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size, embed_dim, hidden_dim, num_layers, 
                 bidirectional, num_classes, dropout, embedding_matrix=<span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>(LSTMClassifier, self).__init__() 
        
        <span class="hljs-comment"># Embedding 层</span>
        self.embedding = nn.Embedding(vocab_size, embed_dim, padding_idx=<span class="hljs-number">0</span>) <span class="hljs-comment"># 初始化 Embedding 层</span>
        <span class="hljs-keyword">if</span> embedding_matrix <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Loading pretrained embedding matrix..."</span>)
            self.embedding.weight.data.copy_(embedding_matrix) <span class="hljs-comment"># 加载预训练的 Word2Vec 权重</span>
            self.embedding.weight.requires_grad = <span class="hljs-literal">False</span> <span class="hljs-comment"># 冻结 Word2Vec 权重</span>
        
        <span class="hljs-comment"># LSTM 层</span>
        self.lstm = nn.LSTM(
            input_size=embed_dim,
            hidden_size=hidden_dim,
            num_layers=num_layers,
            bidirectional=bidirectional,
            batch_first=<span class="hljs-literal">True</span>,
            dropout=dropout <span class="hljs-keyword">if</span> num_layers &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        )
        
        <span class="hljs-comment"># 全连接层</span>
        lstm_out_dim = hidden_dim * <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> bidirectional <span class="hljs-keyword">else</span> hidden_dim <span class="hljs-comment"># 双向 LSTM 输出维度翻倍</span>
        self.fc = nn.Sequential(
            nn.Linear(lstm_out_dim, hidden_dim), 
            nn.ReLU(), 
            nn.Dropout(dropout), 
            nn.Linear(hidden_dim, num_classes) 
        )
        self.sigmoid = nn.Sigmoid()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        embedded = self.embedding(x)
        output, (hidden, cell) = self.lstm(embedded)
         
        <span class="hljs-comment"># 取最后一个时间步 (双向则拼接最后两个隐状态)</span>
        <span class="hljs-keyword">if</span> self.lstm.bidirectional:
            final_feature = torch.cat((hidden[-<span class="hljs-number">2</span>,:,:], hidden[-<span class="hljs-number">1</span>,:,:]), dim=<span class="hljs-number">1</span>)
        <span class="hljs-keyword">else</span>:
            final_feature = hidden[-<span class="hljs-number">1</span>,:,:]
            
        logits = self.fc(final_feature)
        <span class="hljs-keyword">return</span> self.sigmoid(logits)
</code></pre>
<h2 data-id="heading-20">💣 踩坑实录（含泪总结）：</h2>
<p>这个项目看似是NLP入门任务，但从环境配置到模型训练，满地都是坑，以下是我踩过的3个坑，每个坑都包含<strong>报错原因、解决方法、核心教训</strong>，新手照做就能避坑，不用再走我的弯路。</p>
<h3 data-id="heading-21">坑1：NumPy 2.0 的“背刺”——环境配置的隐形雷</h3>
<p><strong>报错现象</strong>：刚配好环境，跑数据预处理脚本直接崩，一大堆 <code>ImportError: cannot import name 'xxx' from 'numpy'</code>，涉及<code>matplotlib</code>、<code>gensim</code>、<code>sklearn</code>等多个库。</p>
<p><strong>报错原因</strong>：NumPy 2.0 版本在2024年更新后，大量API发生了不兼容变动，而<code>gensim</code>（训练Word2Vec的库）、<code>matplotlib</code>等库还没适配，直接被“背刺”。</p>
<p><strong>解决方法</strong>：在<code>requirements.txt</code>里<strong>锁死NumPy版本</strong>，禁止安装2.0及以上版本，同时锁死其他核心库的版本，避免环境冲突。</p>
<p><strong>核心教训</strong>：环境配置是项目的第一步，也是最容易被新手忽略的一步！<strong>所有依赖必须锁死版本</strong>，不要盲目追求最新版本，稳定才是第一位的。</p>
<h3 data-id="heading-22">坑2：Kaggle 测试集的“陷阱”——-1标签的无效数据</h3>
<p><strong>报错现象</strong>：跑测试集的结果AUC只有0.6，准确率惨不忍睹，完全摸不着头脑。</p>
<p><strong>报错原因</strong>：Kaggle的<code>test_labels.csv</code>里，有大量标签值为-1的无效数据——官方为了防止作弊，把这些数据标记为“不参与评分”，如果不剔除，模型就是在对着一堆无效数据瞎猜，分数当然低。</p>
<p><strong>解决方法</strong>：在评估前，先清洗测试集，<strong>剔除所有标签为-1的行</strong>，只保留有效数据进行评估。</p>
<p><strong>核心教训</strong>：使用公开数据集前，<strong>一定要仔细阅读数据集说明</strong>，了解数据的格式、标记规则，避免踩官方的“陷阱”。</p>
<h3 data-id="heading-23">坑3：词表构建的OOV问题——未登录词让模型“看不懂”</h3>
<p><strong>报错现象</strong>：模型在训练集上效果很好，但在测试集上效果差很多，仔细看发现测试集里有很多生僻词（比如小众脏话、网络流行语），模型根本不认识。</p>
<p><strong>报错原因</strong>：词表是用训练集构建的，测试集里的一些单词在训练集里没出现过（未登录词，OOV），如果不处理，模型会把这些词当成未知，直接忽略，导致理解错误。</p>
<p><strong>解决方法</strong>：</p>
<ol>
<li>构建词表时，预留UNK标记，给未登录词分配统一的ID（比如1）；</li>
<li>适当增大最大词汇量（<code>max_vocab_size</code>），尽可能包含更多的单词；</li>
<li>数据清洗时，不要过度清洗，保留一些常见的网络词汇。</li>
</ol>
<p><strong>核心教训</strong>：NLP任务中，<strong>未登录词是不可避免的</strong>，必须提前处理，不要假设测试集的单词都在训练集里。</p>
<h2 data-id="heading-24">📈 最终战果：工业级可用的模型效果（AUC0.97+）</h2>
<p>在清洗后的测试集上（63978条有效样本），模型跑出了<strong>0.97的AUC</strong>，属于工业级可用的水平，看到结果的瞬间，感觉通宵调参都值了！以下是完整的测试集评估报告，包含多维度指标，全面验证模型效果：</p>
<pre><code class="hljs language-bash" lang="bash">==============================
       测试集最终评估报告
==============================
🏆 ROC-AUC Score: 0.97353
📊 Global Accuracy: 0.97366
📉 Macro F1 Score : 0.82013
------------------------------
</code></pre>
<h3 data-id="heading-25">可视化1：Word2Vec词向量TSNE降维——模型真的“学懂了”英语</h3>
<p>为了验证Word2Vec真的学到了单词的语义，我用<strong>TSNE</strong>把词向量降维到2维：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3b184bc49954cb8a61927c5c3f8c091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=3kqpQdYdlia5E90%2BkEBDytqqEiQ%3D" alt="embedding_visualization.png" loading="lazy"/>
<strong>神奇现象</strong>：模型自动把近义词几乎重合在一起。这就是深度学习的魔法——模型没有任何人教它哪些是脏话，却通过学习训练集，自己学会了单词的“物以类聚”。</p>
<h3 data-id="heading-26">可视化2：单条评论预测——实际落地可用</h3>
<p>为了让模型能实际落地，我写了<code>predict.py</code>脚本，输入任意一条英文评论，模型能直接输出6个标签的概率，并标注出是否为恶意评论，示例如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行单条评论预测</span>
python predict.py --text <span class="hljs-string">"You are stupid, but I like you"</span>
</code></pre>
<p>👀这里有个有趣的<strong>插曲</strong>：</p>
<p>前面在讲解 Bi-LSTM 原理时，我举了 “You are stupid, but I like you” 的例子，认为模型应该识别出这不是恶意。但实际上手测试时，模型依然把它预测为了 Toxic。</p>
<p>为什么 Bi-LSTM 也会“翻车”？ 这其实揭示了深度学习的一个特性——数据偏见（Data Bias）。在 Kaggle 的训练集中，包含 "stupid" 的样本 99% 都是真实的辱骂，极少有“打情骂俏”的正样本。因此，模型学到了一个强特征：只要出现 stupid，大概率就是恶意。即便 Bi-LSTM 捕捉到了 "but I like you" 的上下文，但 "stupid" 的权重实在太大了，压过了上下文的修正作用。</p>
<p>我换了一些评论测试，模型都能给出合理的概率输出：</p>
<ul>
<li>“I will kill you.”（我要杀了你-恶意）但 “I need to kill this process.”（我需要杀死这个进程-正常）</li>
<li>“You are crazy.”（你是疯子-恶意） 但 “The crowd went crazy for the band.”（人群为乐队疯狂-正常）</li>
</ul>
<p>这也提醒我们：NLP 模型的判断标准来源于数据，而非真正的逻辑推理。 如果想解决这个问题，我们需要在训练集中增加更多“反讽”或“开玩笑”的样本进行数据增强。</p>
<h2 data-id="heading-27">🚀 项目总结与新手建议</h2>
<p>通过这个项目，我最大的收获不是跑出了0.97的AUC，而是<strong>真正掌握了NLP基础任务的完整流程和工程化思维</strong>——从数据集探索、数据预处理，到模型搭建、训练调试，再到评估可视化、项目落地，每一步都踩过坑，但每一步都有实实在在的收获。</p>
<h3 data-id="heading-28">给NLP新手的3条核心建议</h3>
<ol>
<li><strong>先把基础任务做规范，再啃复杂模型</strong>：先把恶意评论检测、文本分类、情感分析这些基础任务做透，掌握完整的流程和工程化方法，再去学习BERT、GPT等预训练模型，否则只会知其然不知其所以然；</li>
<li><strong>动手写代码，不要只看教程</strong>：看100遍教程，不如自己动手写一遍代码，跑通一个完整的项目，遇到问题自己调试，哪怕跑崩10次，也比光看不动手强；</li>
<li><strong>重视实验记录和复盘</strong>：训练过程中记录每轮的指标，改参数后对比效果，踩坑后及时复盘总结，形成自己的“避坑手册”，这是深度学习工程师的核心能力。</li>
</ol>
<p>完整的代码我已经开源在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSalem532%2FToxic_Comment_Detection" target="_blank" title="https://github.com/Salem532/Toxic_Comment_Detection" ref="nofollow noopener noreferrer">GitHub</a>了，包含<strong>完整的工程化代码、锁死版本的requirements.txt、一键启动/评估/预测脚本、详细的注释</strong>，新手可以直接克隆下来，按README的步骤跑通，也可以在此基础上修改，做自己的NLP项目。</p>
<p><em>觉得有帮助的话，GitHub求个 Star ⭐️！你的支持是我继续更新的最大动力~</em></p>
<h2 data-id="heading-29">📌 下期预告</h2>
<p>搞定了文本分类，你的 NLP 技能树已经点亮了重要的一环。下一期，我们将开启推荐系统实战，搭建一个基于 GNN 的推荐系统。我们下期不见不散~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent]]></title>    <link>https://juejin.cn/post/7601757036486098954</link>    <guid>https://juejin.cn/post/7601757036486098954</guid>    <pubDate>2026-02-01T09:10:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036486098954" data-draft-id="7601757036486082570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T09:10:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼人"/> <meta itemprop="url" content="https://juejin.cn/user/2279731967827264"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2279731967827264/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:10:41.000Z" title="Sun Feb 01 2026 09:10:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着生成式 AI（Generative AI）技术的迅猛发展，AI Agent（智能代理）正成为构建下一代智能应用的核心范式。在 .NET 生态中，微软推出的 <strong>Microsoft Agent Framework（MAF）</strong> 为开发者提供了一套结构清晰、模块化且与 .NET 深度集成的框架，用于构建具备规划、记忆、工具调用和多技能协同能力的 AI Agent。</p>
<p>本文将手把手带你基于 .NET 8，使用 Microsoft Agent Framework 创建一个具备“天气查询”和“数学计算”能力的 AI Agent，并深入讲解如何通过 <strong>Skills（技能）</strong> 扩展其智能边界。</p>
<hr/>
<h3 data-id="heading-0">一、什么是 Microsoft Agent Framework？</h3>
<p>Microsoft Agent Framework 是微软在 Semantic Kernel 基础上进一步抽象出的高级 Agent 构建框架，旨在简化复杂 AI 应用的开发。它提供以下核心能力：</p>
<ul>
<li><strong>Agent 容器</strong>：托管多个 Skill，管理生命周期。</li>
<li><strong>Skill 模型</strong>：以插件形式封装具体功能（如调用 API、执行代码）。</li>
<li><strong>Planner（规划器）</strong> ：自动分析用户意图，选择并编排合适的 Skill。</li>
<li><strong>Memory 与 Context</strong>：支持短期/长期记忆，维持对话状态。</li>
<li><strong>.NET 原生支持</strong>：强类型、依赖注入、异步编程模型无缝集成。</li>
</ul>
<blockquote>
<p>💡 注意：截至 2026 年初，Microsoft Agent Framework 仍处于预览阶段，但已可通过 GitHub 和 NuGet 获取实验性版本。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">二、准备工作：创建 .NET 项目并引入依赖</h3>
<pre><code class="hljs language-sql" lang="sql">dotnet <span class="hljs-keyword">new</span> console <span class="hljs-operator">-</span>n DotNetAgentDemo
cd DotNetAgentDemo
dotnet <span class="hljs-keyword">add</span> package Microsoft.Agent <span class="hljs-comment">--prerelease</span>
dotnet <span class="hljs-keyword">add</span> package Microsoft.SemanticKernel <span class="hljs-comment">--prerelease</span>
</code></pre>
<p>你还需要一个 OpenAI 或 Azure OpenAI 的 API Key（用于 LLM 推理）。</p>
<p>在 <code>appsettings.json</code> 中配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"OpenAI"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ApiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ModelId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4o"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">三、定义第一个 Skill：数学计算器</h3>
<p>Skill 在 MAF 中是一个带有 <code>[Skill]</code> 特性的类，其方法通过 <code>[Function]</code> 标记为可被 Agent 调用。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Skills/MathSkill.cs</span>
<span class="hljs-keyword">using</span> Microsoft.Agent.Abstractions;

[<span class="hljs-meta">Skill(<span class="hljs-string">"Math"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MathSkill</span>
{
    [<span class="hljs-meta">Function(<span class="hljs-string">"Add two numbers"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span> =&gt; a + b;

    [<span class="hljs-meta">Function(<span class="hljs-string">"Multiply two numbers"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Multiply</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span> =&gt; a * b;
}
</code></pre>
<p>每个 <code>[Function]</code> 的描述文本将被 LLM 用于理解该函数的用途。</p>
<hr/>
<h3 data-id="heading-3">四、定义第二个 Skill：天气查询（模拟）</h3>
<p>实际项目中可调用天气 API（如 OpenWeatherMap），此处简化为模拟：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Skills/WeatherSkill.cs</span>
<span class="hljs-keyword">using</span> Microsoft.Agent.Abstractions;

[<span class="hljs-meta">Skill(<span class="hljs-string">"Weather"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherSkill</span>
{
    [<span class="hljs-meta">Function(<span class="hljs-string">"Get current weather for a city"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetWeather</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> city</span>)</span>
    {
        <span class="hljs-keyword">return</span> city.ToLowerInvariant() <span class="hljs-keyword">switch</span>
        {
            <span class="hljs-string">"beijing"</span> =&gt; <span class="hljs-string">"Sunny, 22°C"</span>,
            <span class="hljs-string">"shanghai"</span> =&gt; <span class="hljs-string">"Cloudy, 18°C"</span>,
            _ =&gt; <span class="hljs-string">"Unknown city"</span>
        };
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">五、构建并运行 AI Agent</h3>
<p>在 <code>Program.cs</code> 中组装 Agent：</p>
<pre><code class="hljs language-ini" lang="ini">// Program.cs
using Microsoft.Agent<span class="hljs-comment">;</span>
using Microsoft.Extensions.Configuration<span class="hljs-comment">;</span>
using Microsoft.Extensions.DependencyInjection<span class="hljs-comment">;</span>
using Microsoft.SemanticKernel<span class="hljs-comment">;</span>

var <span class="hljs-attr">config</span> = new ConfigurationBuilder()
    .AddJsonFile("appsettings.json")
    .Build()<span class="hljs-comment">;</span>

var <span class="hljs-attr">services</span> = new ServiceCollection()<span class="hljs-comment">;</span>
services.AddAgentFramework()<span class="hljs-comment">; // 注册 MAF 核心服务</span>

// 配置 Semantic Kernel（作为 LLM 后端）
services.AddKernel()
    .AddOpenAIChatCompletion(
        modelId: config<span class="hljs-section">["OpenAI:ModelId"]</span>!,
        apiKey: config<span class="hljs-section">["OpenAI:ApiKey"]</span>!)<span class="hljs-comment">;</span>

// 注册自定义 Skills
services.AddSingleton&lt;MathSkill&gt;()<span class="hljs-comment">;</span>
services.AddSingleton&lt;WeatherSkill&gt;()<span class="hljs-comment">;</span>

var <span class="hljs-attr">serviceProvider</span> = services.BuildServiceProvider()<span class="hljs-comment">;</span>
var <span class="hljs-attr">agentHost</span> = serviceProvider.GetRequiredService&lt;IAgentHost&gt;()<span class="hljs-comment">;</span>

// 创建 Agent 实例
var <span class="hljs-attr">agent</span> = await agentHost.CreateAgentAsync(new AgentOptions
{
    <span class="hljs-attr">Name</span> = <span class="hljs-string">"SmartAssistant"</span>,
    <span class="hljs-attr">Description</span> = <span class="hljs-string">"A helpful assistant that can do math and check weather."</span>,
    <span class="hljs-attr">Skills</span> = { typeof(MathSkill), typeof(WeatherSkill) }
})<span class="hljs-comment">;</span>

// 用户交互循环
while (true)
{
    Console.Write("\nYou: ")<span class="hljs-comment">;</span>
    var <span class="hljs-attr">input</span> = Console.ReadLine()<span class="hljs-comment">;</span>
    if (string.IsNullOrEmpty(input)) break<span class="hljs-comment">;</span>

    var <span class="hljs-attr">response</span> = await agent.InvokeAsync(input)<span class="hljs-comment">;</span>
    Console.WriteLine($"Agent: {response}")<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-5">六、测试你的智能 Agent</h3>
<p>运行程序后，尝试以下对话：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">You:</span> What<span class="hljs-comment">'s 15 times 6?</span>
<span class="hljs-symbol">Agent:</span> The result <span class="hljs-built_in">is</span> <span class="hljs-number">90</span>.

<span class="hljs-symbol">You:</span> What<span class="hljs-comment">'s the weather in Beijing?</span>
<span class="hljs-symbol">Agent:</span> Sunny, <span class="hljs-number">22</span>°C.

<span class="hljs-symbol">You:</span> <span class="hljs-keyword">If</span> I add <span class="hljs-number">10</span> <span class="hljs-keyword">to</span> Beijing<span class="hljs-comment">'s temperature, what do I get?</span>
<span class="hljs-symbol">Agent:</span> Beijing<span class="hljs-comment">'s temperature is 22°C. Adding 10 gives 32.</span>
</code></pre>
<blockquote>
<p>✅ Agent 成功跨 Skill 协同：先调用 <code>WeatherSkill</code> 获取温度，再调用 <code>MathSkill</code> 进行加法！</p>
</blockquote>
<p>这背后是 MAF 内置的 <strong>AutoPlanner</strong> 在起作用——它利用 LLM 分析用户请求，生成执行计划（Plan），并按需调用多个 Skill。</p>
<hr/>
<h3 data-id="heading-6">七、进阶：添加记忆与上下文</h3>
<p>MAF 支持会话级记忆。通过 <code>agent.SetContext("user", "Alice")</code> 可注入上下文，后续对话中 LLM 可引用：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> agent.SetContextAsync(<span class="hljs-string">"user_name"</span>, <span class="hljs-string">"Alice"</span>);
<span class="hljs-keyword">var</span> reply = <span class="hljs-keyword">await</span> agent.InvokeAsync(<span class="hljs-string">"Hello!"</span>);
<span class="hljs-comment">// LLM 可能回复："Hello, Alice!"</span>
</code></pre>
<p>你还可以集成向量数据库实现长期记忆（需结合 Semantic Kernel 的 MemoryStore）。</p>
<hr/>
<h3 data-id="heading-7">八、最佳实践建议</h3>
<ol>
<li><strong>Skill 设计原则</strong>：单一职责、幂等、带清晰描述。</li>
<li><strong>输入验证</strong>：在 Skill 方法中校验参数，避免无效调用。</li>
<li><strong>错误处理</strong>：抛出异常会被 Agent 捕获并转为自然语言反馈。</li>
<li><strong>性能监控</strong>：记录每个 Skill 调用耗时，便于优化。</li>
<li><strong>安全沙箱</strong>：对敏感操作（如文件删除）添加权限控制层。</li>
</ol>
<hr/>
<h3 data-id="heading-8">结语</h3>
<p>Microsoft Agent Framework 将复杂的 AI Agent 架构封装为 .NET 开发者熟悉的依赖注入、接口和属性模型，极大降低了构建智能应用的门槛。通过组合不同的 Skill，你可以快速搭建客服机器人、运维助手、数据分析代理等场景化 AI 应用。</p>
<p>未来，随着框架的成熟和与 .NET Aspire、Orleans 等云原生技术的深度集成，基于 .NET 的 AI Agent 将成为企业智能化转型的重要基石。</p>
<blockquote>
<p>🚀 现在就动手，用 C# 编写你的第一个 AI Agent 吧！代码即智能，.NET 正在拥抱 AI 新时代。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件]]></title>    <link>https://juejin.cn/post/7601441475986931758</link>    <guid>https://juejin.cn/post/7601441475986931758</guid>    <pubDate>2026-02-01T09:13:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441475986931758" data-draft-id="7601169244454830106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-02-01T09:13:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ETA8"/> <meta itemprop="url" content="https://juejin.cn/user/608445545328347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/608445545328347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ETA8
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:13:22.000Z" title="Sun Feb 01 2026 09:13:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天，我们的项目要继续深入一个“看起来简单、实则暗流涌动”的功能场景：<strong>页面状态缓存 —— KeepAlive</strong>。</p>
<p>你可能已经见过这样的需求：</p>
<blockquote>
<p>“用户从首页点进详情页，再返回时，首页又要重新加载？能不能记住我之前滑到哪了？”</p>
</blockquote>
<p>这不只是用户体验的问题，更是对前端架构的一次考验。</p>
<hr/>
<h2 data-id="heading-0">一、问题起点：为什么首页总在“重复劳动”？</h2>
<p>在 React 单页应用中，路由切换并不会刷新页面，但组件会经历完整的挂载与卸载过程。</p>
<p>以常见的首页为例：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/home"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span>} /&gt;
</code></pre>
<p>当用户从 <code>/home</code> 切换到 <code>/detail</code> 时，React 会执行 <code>Home.unmount()</code>；<br/>
再次返回时，则重新执行 <code>Home.mount()</code> —— 所有 <code>useState</code> 清零，<code>useEffect</code> 重跑，接口重发，列表重渲染。</p>
<p>结果就是：</p>
<ul>
<li>用户每次回来都要等数据加载；</li>
<li>滚动位置回到顶部；</li>
<li>已填写的搜索条件丢失；</li>
<li>动画闪烁明显。</li>
</ul>
<p>这不是 SPA 应该有的样子。我们需要的是：<strong>视觉上离开，逻辑上留下</strong>。</p>
<p>于是，<code>KeepAlive</code> 出现了。</p>
<hr/>
<h2 data-id="heading-1">二、目标拆解：一个合格的 KeepAlive 要解决什么问题？</h2>
<p>别急着引入第三方库，先明确我们的核心诉求：</p>
<ol>
<li><strong>组件状态保留</strong>：包括 state、ref、DOM 结构、滚动位置；</li>
<li><strong>按需缓存</strong>：不是所有页面都需要缓存，要可配置；</li>
<li><strong>内存可控</strong>：不能无限制缓存，避免内存泄漏；</li>
<li><strong>与路由系统良好集成</strong>：支持 React Router 等主流方案；</li>
<li><strong>组件卸载时自动清理资源</strong>：防止事件监听、定时器残留。</li>
</ol>
<p>这些要求听起来像 Vue 的 <code>&lt;keep-alive&gt;</code>？没错，但在 React 中，它需要我们更主动地去构建这套机制。</p>
<hr/>
<h2 data-id="heading-2">三、方案选型：自研 vs 第三方库</h2>
<h3 data-id="heading-3">方案一：手写简易版 KeepAlive</h3>
<p>我们可以用最朴素的方式模拟缓存行为：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({});
<span class="hljs-keyword">const</span> [activeKey, setActiveKey] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 缓存当前组件</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (children &amp;&amp; activeId) {
    <span class="hljs-title function_">setCache</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [activeId]: children }));
  }
}, [activeId, children]);

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    {Object.entries(cache).map(([key, comp]) =&gt; (
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{key}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">key</span> === <span class="hljs-string">activeKey</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>
        {comp}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    ))}
  <span class="hljs-tag">&lt;/&gt;</span></span>
);
</code></pre>
<h4 data-id="heading-4">✅ 优点：</h4>
<ul>
<li>原理清晰，适合教学理解；</li>
<li>不依赖额外包，轻量；</li>
<li>可完全掌控缓存策略。</li>
</ul>
<h4 data-id="heading-5">❌ 缺点：</h4>
<ul>
<li>无法真正保留组件实例（如 ref、内部 state 生命周期）；</li>
<li>子组件更新可能导致缓存失效；</li>
<li>难以处理复杂嵌套结构；</li>
<li>没有统一的缓存管理机制。</li>
</ul>
<blockquote>
<p>这种方式更适合静态内容或演示用途，不适合生产环境。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">方案二：使用 <code>react-activation</code></h3>
<p>这是一个专门为 React 实现类似 Vue keep-alive 行为的成熟库。</p>
<p>它提供了三个核心能力：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AliveScope</span>, <span class="hljs-title class_">KeepAlive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AliveScope</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">path</span>=<span class="hljs-string">"/home"</span>
            <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
              &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home"</span> <span class="hljs-attr">saveScrollPosition</span>=<span class="hljs-string">"screen"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
            }
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">AliveScope</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-7">核心组件说明：</h4>





















<table><thead><tr><th>组件</th><th>作用</th></tr></thead><tbody><tr><td><code>&lt;AliveScope&gt;</code></td><td>全局缓存容器，必须作为根节点包裹整个应用或需要缓存的部分</td></tr><tr><td><code>&lt;KeepAlive&gt;</code></td><td>包裹需要缓存的组件，通过 <code>name</code> 做唯一标识</td></tr><tr><td><code>useActivate/useUnactivate</code></td><td>替代 useEffect，监听组件激活/失活状态</td></tr></tbody></table>
<h4 data-id="heading-8">✅ 真正做到了什么？</h4>
<ul>
<li>组件卸载时不销毁实例，而是移入缓存池；</li>
<li>再次激活时直接复用原有实例，state 完全保留；</li>
<li>支持滚动位置记忆（<code>saveScrollPosition</code>）；</li>
<li>提供钩子函数控制数据刷新时机。</li>
</ul>
<p>这才是我们想要的“活”的组件。</p>
<hr/>
<h2 data-id="heading-9">四、实践细节：如何安全高效地使用 KeepAlive？</h2>
<h3 data-id="heading-10">1. 合理设置缓存粒度</h3>
<p>不是所有页面都值得被缓存。比如：</p>
<ul>
<li>登录页、支付成功页这类一次性页面，不应缓存；</li>
<li>数据强实时性页面（如股票行情），缓存反而会造成信息滞后。</li>
</ul>
<p>✅ 建议只对以下类型启用：</p>
<ul>
<li>首页、推荐流、商品列表等高频访问页；</li>
<li>Tab 类布局中的子页面（可用 name 动态生成）；</li>
<li>用户常往返跳转的路径。</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">KeepAlive</span> name={<span class="hljs-string">`list_<span class="hljs-subst">${category}</span>`</span>}&gt;...&lt;/<span class="hljs-title class_">KeepAlive</span>&gt;
</code></pre>
<h3 data-id="heading-11">2. 控制数据更新节奏：useActivate 是关键</h3>
<p>由于组件不会重新 mount，<code>useEffect(() =&gt; {}, [])</code> 只会在首次进入时触发一次。</p>
<p>这意味着：<strong>后续返回不会拉取最新数据</strong>。</p>
<p>解决方案是使用专属钩子：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useActivate } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-comment">// 每次激活时执行</span>
  <span class="hljs-title function_">useActivate</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Home 被唤醒'</span>);
    <span class="hljs-title function_">fetchLatestData</span>().<span class="hljs-title function_">then</span>(setData);
  });

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 渲染内容 */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>这样既保留了状态，又能保证内容不过期。</p>
<hr/>
<h3 data-id="heading-12">3. 内存与性能的平衡</h3>
<p>虽然 <code>react-activation</code> 做了很多优化，但我们仍需警惕：</p>
<ul>
<li>长期缓存大量组件会导致内存占用上升；</li>
<li>特别是在移动端，内存资源有限。</li>
</ul>
<p>📌 <strong>建议措施</strong>：</p>
<ul>
<li>设置最大缓存数量（可通过封装中间层控制）；</li>
<li>对非活跃页面手动清除缓存（调用 <code>dropByCacheKey</code>）；</li>
<li>在开发工具中监控内存变化，及时发现问题。</li>
</ul>
<hr/>
<h3 data-id="heading-13">4. 清理副作用：别忘了事件监听和定时器</h3>
<p>即使组件被缓存，也不能放任副作用不管。</p>
<p>错误示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(polling, <span class="hljs-number">5000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer); <span class="hljs-comment">// ❌ 只在 unmount 时清理</span>
});
</code></pre>
<p>如果组件一直被缓存，这个定时器将永远运行！</p>
<p>✅ 正确做法是结合 <code>useUnactivate</code>：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(polling, <span class="hljs-number">5000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);
}, []);

<span class="hljs-comment">// 或者使用专用钩子</span>
<span class="hljs-title function_">useUnactivate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Home 暂时休眠'</span>);
  <span class="hljs-comment">// 可在此暂停轮询、断开 WebSocket 等</span>
});
</code></pre>
<p>让组件在“休眠”前主动释放资源，醒来后再恢复。</p>
<hr/>
<h2 data-id="heading-14">五、总结：KeepAlive 是一种思维转变</h2>
<p><code>KeepAlive</code> 不只是一个技术组件，它代表了一种新的开发范式：</p>
<blockquote>
<p><strong>我们不再假设组件每次出现都是“全新”的，而要开始考虑它的“生命周期状态”</strong>。</p>
</blockquote>
<p>就像人离开房间又回来，不应该忘记自己刚才在做什么。</p>

























<table><thead><tr><th>能力</th><th>在本组件中的体现</th></tr></thead><tbody><tr><td>状态持久化</td><td>保留 scrollY、form 输入、局部状态</td></tr><tr><td>性能优化</td><td>避免重复渲染、减少网络请求</td></tr><tr><td>用户体验</td><td>返回即原样，无闪烁无等待</td></tr><tr><td>工程化思维</td><td>合理缓存、资源清理、可维护性</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">六、结语</h2>
<p>前端开发的魅力就在于：<br/>
那些最容易被忽略的小功能，往往藏着最深的设计哲学。</p>
<p>从“回到顶部”到“页面缓存”，我们在一次次打磨中学会思考：</p>
<blockquote>
<p>“用户真正需要的是什么？”<br/>
“我们是在做功能，还是在解决问题？”</p>
</blockquote>
<p>KeepAlive 不是为了炫技，而是为了让用户感受到：<strong>这个页面记得我</strong>。</p>
<p>下次当你接到“首页老是重新加载”的反馈时，不妨试试给它加一层 <code>KeepAlive</code> —— 让页面变得更有“记忆”。</p>
<p>欢迎点赞收藏，也期待你在评论区分享你的缓存策略或踩坑经历。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始搭建部署 block/goose 完整攻略]]></title>    <link>https://juejin.cn/post/7601144981169864754</link>    <guid>https://juejin.cn/post/7601144981169864754</guid>    <pubDate>2026-01-31T16:18:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601144981169864754" data-draft-id="7601144981169848370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始搭建部署 block/goose 完整攻略"/> <meta itemprop="keywords" content="大数据,数据库,开源"/> <meta itemprop="datePublished" content="2026-01-31T16:18:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大厂技术总监下海"/> <meta itemprop="url" content="https://juejin.cn/user/4091714106833577"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始搭建部署 block/goose 完整攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4091714106833577/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大厂技术总监下海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T16:18:25.000Z" title="Sat Jan 31 2026 16:18:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从零开始搭建部署 goose 完整攻略</h2>
<p><strong>新手入门指南 - V1.0版本</strong></p>
<h3 data-id="heading-1">📋 目录</h3>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B" title="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82" title="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82">系统要求</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85" title="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85">系统安装</a></li>
<li><a href="#%E9%A6%96%E6%AC%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%90%E8%A1%8C" title="#%E9%A6%96%E6%AC%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%90%E8%A1%8C">首次配置与运行</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8" title="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8">常用指令大全</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E7%A4%BA%E4%BE%8B%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C" title="#%E9%80%9A%E8%BF%87%E7%A4%BA%E4%BE%8B%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C">通过示例快速体验</a></li>
<li><a href="#%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4" title="#%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4">日常维护</a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4" title="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li>
<li><a href="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE" title="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE">进阶配置</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83%E5%8D%A1" title="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83%E5%8D%A1">资源链接与快速参考卡</a></li>
</ul>
<h3 data-id="heading-2">简介</h3>
<p>goose 是一个<strong>本地化、可扩展、开源</strong>的 AI 智能体框架，旨在<strong>自动化复杂的软件工程任务</strong>。与传统的代码补全工具不同，goose 能够理解高层次的目标，并自主执行从代码编写、文件操作、命令运行到调试、测试的完整工作流。它是一个运行在你机器上的“AI 工程师助手”。</p>
<p><strong>核心功能概览</strong>：</p>
<ul>
<li>🤖 <strong>自主任务执行</strong>：根据自然语言指令，完成从项目创建到代码部署的多种任务。</li>
<li>🔧 <strong>本地优先与可扩展</strong>：核心逻辑在本地运行，支持通过 Model Context Protocol (MCP) 集成多种工具和扩展。</li>
<li>💻 <strong>多模态交互</strong>：提供桌面图形界面 (GUI) 和命令行界面 (CLI)，满足不同场景需求。</li>
<li>📦 <strong>灵活的模型支持</strong>：可配置使用云端或本地的多种大型语言模型 (LLM)。</li>
<li>📁 <strong>项目感知与操作</strong>：内置开发者工具，可直接读写文件、运行 Shell 命令、分析代码结构。</li>
</ul>
<p><strong>版本说明</strong>：本指南基于 goose 主分支（版本约 1.21.0）编写。项目处于活跃开发中，部分功能可能更新，请以官方文档为准。</p>
<p><strong>教程约定</strong>：</p>
<ul>
<li><code>命令</code>：表示在终端中执行的命令。</li>
<li><code>$</code>：表示命令提示符，其后的内容是需要你输入的命令。</li>
<li><code>(GUI)</code>：表示在桌面应用程序中进行的操作。</li>
<li><code>路径/文件名</code>：表示文件系统路径或文件名。</li>
</ul>
<h3 data-id="heading-3">系统要求</h3>
<p>在安装 goose 前，请确保你的系统满足以下基础要求。</p>















































<table><thead><tr><th align="left">组件</th><th align="left">最低要求</th><th align="left">推荐配置</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>操作系统</strong></td><td align="left">Windows 10 (1809+), macOS 11+, Linux (主流发行版)</td><td align="left">最新稳定版</td><td align="left">需为64位系统。</td></tr><tr><td align="left"><strong>处理器</strong></td><td align="left">支持 SSE2 的 x86_64 或 Apple Silicon (arm64)</td><td align="left">多核处理器</td><td align="left">主要用于运行客户端，重型计算在模型服务端。</td></tr><tr><td align="left"><strong>内存</strong></td><td align="left">4 GB RAM</td><td align="left">8 GB RAM 或更高</td><td align="left">运行桌面应用和多个扩展时需要更多内存。</td></tr><tr><td align="left"><strong>磁盘空间</strong></td><td align="left">500 MB 可用空间</td><td align="left">1 GB 或更多</td><td align="left">用于安装二进制文件、存储配置和缓存。</td></tr><tr><td align="left"><strong>网络连接</strong></td><td align="left">可访问互联网</td><td align="left">稳定的宽带连接</td><td align="left">用于下载安装包、与模型 API 通信。</td></tr><tr><td align="left"><strong>依赖环境</strong></td><td align="left">无（二进制版本）</td><td align="left">Git, Rust（从源码编译时）</td><td align="left">大多数用户只需下载二进制文件。</td></tr></tbody></table>
<p><strong>各系统额外要求与提示</strong>：</p>
<ul>
<li><strong>Windows</strong>：建议在 <strong>WSL 2</strong> (Windows Subsystem for Linux) 环境下使用 CLI，以获得最佳兼容性。原生 Windows 命令提示符或 PowerShell 也可运行。</li>
<li><strong>macOS</strong>：可能需要允许运行来自“未识别开发者”的应用（首次运行时在系统偏好设置的“安全性与隐私”中批准）。</li>
<li><strong>Linux</strong>：需要基础的开发库（如 <code>libssl</code>, <code>ca-certificates</code>）。使用包管理器安装（如 <code>apt</code>, <code>yum</code>, <code>dnf</code>）即可。</li>
<li><strong>通用提示</strong>：
<ul>
<li><strong>代理设置</strong>：如果你所在网络需要代理才能访问 GitHub 或模型 API，请提前在系统或终端中配置好 HTTP/HTTPS 代理。</li>
<li><strong>权限问题</strong>：安装和运行可能需要管理员/root权限（如安装到 <code>/usr/local/bin</code>）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">系统安装</h3>
<p>goose 提供多种安装方式，你可以根据操作系统和偏好选择最合适的一种。</p>
<h4 data-id="heading-5">方案一：使用官方安装脚本（推荐，适用于所有主流系统）</h4>
<p>这是最简单快捷的方式，脚本会自动检测系统并下载对应的预编译二进制文件。</p>
<ol>
<li>
<p><strong>打开终端</strong> (Windows 可使用 PowerShell, CMD, 或 WSL终端)。</p>
</li>
<li>
<p><strong>执行安装命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载并运行安装脚本</span>
$ curl -fsSL https://github.com/block/goose/releases/download/stable/download_cli.sh | bash
</code></pre>
<p><strong>脚本行为说明</strong>：</p>
<ul>
<li>自动检测你的操作系统（Linux, macOS, Windows）和架构（x86_64, arm64）。</li>
<li>默认将 <code>goose</code> 二进制下载到 <code>$HOME/.local/bin/</code> 目录（Windows 为 <code>%USERPROFILE%\goose</code>）。</li>
<li>安装完成后，会尝试引导你进行首次配置（可跳过，后续手动进行）。</li>
</ul>
</li>
<li>
<p><strong>将 goose 添加到 PATH</strong>（如果脚本提示）：
安装后，如果终端提示 <code>GOOSE_BIN_DIR</code> 不在 PATH 中，你需要手动添加。</p>
<ul>
<li><strong>Linux/macOS</strong>：将以下行添加到 <code>~/.bashrc</code>, <code>~/.zshrc</code> 或你所用 shell 的配置文件中。
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.local/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
然后执行 <code>source ~/.bashrc</code>（或对应配置文件）使其生效。</li>
<li><strong>Windows (PowerShell)</strong>：将以下行添加到 <code>$PROFILE</code> 文件中。
<pre><code class="hljs language-powershell" lang="powershell">$env:Path = "$env:USERPROFILE\goose;" + $env:Path
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>验证安装</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose --version
</code></pre>
<p>如果成功，将显示类似 <code>goose 1.21.0</code> 的版本信息。</p>
</li>
</ol>
<h4 data-id="heading-6">方案二：使用 Docker（适合容器化环境）</h4>
<p>如果你熟悉 Docker，这是保持环境纯净的好方法。项目提供了官方的 Docker 镜像。</p>
<ol>
<li>
<p><strong>拉取 goose 镜像</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker pull ghcr.io/block/goose:latest
</code></pre>
</li>
<li>
<p><strong>运行 goose 容器</strong>（基础命令）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 以交互模式运行，并挂载当前目录到容器内以便 goose 操作文件</span>
$ docker run -it --<span class="hljs-built_in">rm</span> -v $(<span class="hljs-built_in">pwd</span>):/home/goose/workspace ghcr.io/block/goose:latest
<span class="hljs-comment"># 获取帮助</span>
$ docker run --<span class="hljs-built_in">rm</span> ghcr.io/block/goose:latest --<span class="hljs-built_in">help</span>
</code></pre>
<p><strong>注意</strong>：Docker 方式主要运行 CLI。如需桌面应用或更复杂的集成，建议使用其他安装方式。</p>
</li>
</ol>
<h4 data-id="heading-7">方案三：桌面应用程序（适合偏好图形界面的用户）</h4>
<p>如果你不想使用命令行，可以直接下载并运行桌面应用。</p>
<ol>
<li><strong>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fblock%2Fgoose%2Freleases" target="_blank" title="https://github.com/block/goose/releases" ref="nofollow noopener noreferrer">GitHub Releases</a></strong> 页面。</li>
<li>找到最新的版本，在“Assets”部分下载对应你系统的安装包：
<ul>
<li><strong>macOS</strong>: <code>.dmg</code> 文件 (Apple Silicon 或 Intel)</li>
<li><strong>Windows</strong>: <code>.exe</code> 安装程序或 <code>.zip</code> 压缩包</li>
<li><strong>Linux</strong>: <code>.AppImage</code>, <code>.deb</code>, 或 <code>.rpm</code> 文件</li>
</ul>
</li>
<li>像安装普通软件一样完成安装并启动。</li>
</ol>
<h4 data-id="heading-8">方案四：从源代码构建（适合开发者或定制需求）</h4>
<p>此方式要求已安装 Rust 工具链。</p>
<ol>
<li>
<p><strong>安装 Rust</strong> (如未安装):</p>
<pre><code class="hljs language-bash" lang="bash">$ curl --proto <span class="hljs-string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
$ <span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.cargo/env
</code></pre>
</li>
<li>
<p><strong>克隆仓库并构建</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">$ git <span class="hljs-built_in">clone</span> https://github.com/block/goose.git
$ <span class="hljs-built_in">cd</span> goose
<span class="hljs-comment"># 构建 CLI</span>
$ cargo build --release --package goose-cli
<span class="hljs-comment"># 构建完成后，二进制位于 target/release/goose</span>
$ <span class="hljs-built_in">cp</span> target/release/goose ~/.local/bin/  <span class="hljs-comment"># 或其它 PATH 目录</span>
</code></pre>
</li>
</ol>
<p><strong>安装后验证</strong>：无论采用哪种方式，都请执行 <code>goose --version</code> 或启动桌面应用，确认安装成功。</p>
<h3 data-id="heading-9">首次配置与运行</h3>
<p>首次运行 goose 需要进行基础配置，主要是设置 AI 模型。</p>
<h4 data-id="heading-10">1. 启动配置向导</h4>
<p>在终端中执行：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose configure
</code></pre>
<p>此命令将启动一个交互式配置向导。</p>
<h4 data-id="heading-11">2. 核心配置步骤</h4>
<p>向导会引导你完成以下关键设置：</p>
<ul>
<li>
<p><strong>选择 Provider (模型提供商)</strong>：
你会看到如 <code>databricks</code>、<code>openai</code> 等选项。这取决于你想要使用的 AI 服务。</p>
<ul>
<li>如果你使用 <strong>OpenAI</strong> 的模型（如 GPT-4），选择 <code>openai</code>。</li>
<li>如果你使用 <strong>Databricks</strong> 提供的模型（项目示例中提到的 <code>goose</code> 模型），选择 <code>databricks</code>。</li>
<li>其他选项对应其他支持的模型服务。</li>
</ul>
</li>
<li>
<p><strong>配置 API 密钥</strong>：
选择 Provider 后，系统会提示你输入相应的 <strong>API 密钥</strong>。</p>
<ul>
<li>对于 OpenAI：你需要一个有效的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">OpenAI API Key</a>。</li>
<li>对于 Databricks：你需要配置 Databricks 主机和令牌。</li>
<li><strong>安全提示</strong>：API 密钥是敏感信息，请妥善保管。goose 会将其加密存储在本地配置文件中（通常位于 <code>~/.config/goose/config.toml</code>）。</li>
</ul>
</li>
<li>
<p><strong>选择模型</strong>：
根据上一步选择的 Provider，系统会列出可用的模型（例如 <code>gpt-4o</code>, <code>gpt-4-turbo</code>, <code>claude-3-5-sonnet</code> 或 <code>databricks</code> 特定的模型名）。选择你想使用的模型。</p>
</li>
<li>
<p><strong>工作目录设置</strong>：
配置 goose 操作文件的默认目录。可以保持默认（当前用户目录），或指定一个专用路径。</p>
</li>
</ul>
<h4 data-id="heading-12">3. 配置完成与快速测试</h4>
<p>配置完成后，你可以通过一个简单命令测试 goose 是否工作正常：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 向 goose 发送一个简单指令</span>
$ goose run <span class="hljs-string">"请用当前目录下的文件名创建一个 Markdown 列表"</span>
</code></pre>
<p>如果配置正确，goose 会列出当前目录的文件。你可能会看到它调用了相关工具（如 <code>developer</code> 扩展）来完成此任务。</p>
<h4 data-id="heading-13">4. （可选）启动桌面应用</h4>
<p>如果你安装了桌面版，首次启动时，应用界面内通常也会有类似的配置流程，引导你输入 Provider 和 API Key。</p>
<h3 data-id="heading-14">常用指令大全</h3>
<p>掌握以下核心命令将帮助你高效使用 goose CLI。</p>
<h4 data-id="heading-15">基础命令</h4>






























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose --version</code></td><td align="left">查看版本信息。</td><td align="left"><code>$ goose --version</code></td></tr><tr><td align="left"><code>goose --help</code></td><td align="left">查看全局帮助。</td><td align="left"><code>$ goose --help</code></td></tr><tr><td align="left"><code>goose configure</code></td><td align="left">交互式配置向导。</td><td align="left"><code>$ goose configure</code></td></tr><tr><td align="left"><code>goose doctor</code></td><td align="left">运行诊断，检查系统环境和配置。</td><td align="left"><code>$ goose doctor</code></td></tr></tbody></table>
<h4 data-id="heading-16">任务执行命令</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose run &lt;指令&gt;</code></td><td align="left">执行单条自然语言指令。</td><td align="left"><code>$ goose run "创建一个简单的Python HTTP服务器"</code></td></tr><tr><td align="left"><code>goose chat</code></td><td align="left">进入交互式对话模式。</td><td align="left"><code>$ goose chat</code></td></tr><tr><td align="left"><code>goose cook &lt;recipe文件&gt;</code></td><td align="left">执行一个预定义的“食谱”任务。</td><td align="left"><code>$ goose cook recipe.yaml</code></td></tr></tbody></table>
<h4 data-id="heading-17">扩展管理命令</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose extensions list</code></td><td align="left">列出已安装和可用的扩展。</td><td align="left"><code>$ goose extensions list</code></td></tr><tr><td align="left"><code>goose extensions add &lt;名称&gt;</code></td><td align="left">安装一个新扩展。</td><td align="left"><code>$ goose extensions add fetch</code></td></tr><tr><td align="left"><code>goose extensions remove &lt;名称&gt;</code></td><td align="left">移除一个扩展。</td><td align="left"><code>$ goose extensions remove fetch</code></td></tr></tbody></table>
<h4 data-id="heading-18">会话与日志命令</h4>




















<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose sessions list</code></td><td align="left">列出历史会话。</td><td align="left"><code>$ goose sessions list</code></td></tr><tr><td align="left"><code>goose logs</code></td><td align="left">查看 goose 的运行日志（需指定日志路径，通常在配置中）。</td><td align="left"><code>$ tail -f ~/.config/goose/logs/goose.log</code></td></tr></tbody></table>
<h4 data-id="heading-19">服务器命令（用于高级集成）</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose server start</code></td><td align="left">启动 goose 的本地 API 服务器。</td><td align="left"><code>$ goose server start --port 3001</code></td></tr><tr><td align="left"><code>goose server stop</code></td><td align="left">停止本地 API 服务器。</td><td align="left"><code>$ goose server stop</code></td></tr><tr><td align="left"><code>goose server status</code></td><td align="left">查看服务器状态。</td><td align="left"><code>$ goose server status</code></td></tr></tbody></table>
<h3 data-id="heading-20">通过示例快速体验</h3>
<p>理论不如实践。让我们通过运行一个内置的“食谱”来直观感受 goose 的能力。我们将执行 <code>recipe.yaml</code> 中描述的 <code>404Portfolio</code> 任务。</p>
<ol>
<li>
<p><strong>准备 recipe 文件</strong>：
将项目中的 <code>recipe.yaml</code> 内容保存为一个文件，例如 <code>404recipe.yaml</code>，放在你的工作目录。</p>
</li>
<li>
<p><strong>执行食谱任务</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose cook ./404recipe.yaml
</code></pre>
</li>
<li>
<p><strong>与 goose 交互</strong>：
命令执行后，goose 会开始处理这个复杂任务。它会：</p>
<ul>
<li>理解任务目标：创建一个基于用户公开资料的个性化 404 页面。</li>
<li><strong>向你提问</strong>：首先，它会询问你使用哪个平台（GitHub, Dev.to, Bluesky）及对应的用户名。</li>
<li><strong>自主执行</strong>：根据你的回答，它会调用内置的 <code>developer</code> 扩展来创建目录和文件，并可能调用 <code>fetch</code> 等扩展（如果已安装）去获取公开API数据。</li>
<li><strong>编写代码</strong>：最终，它会在一个名为 <code>404-story</code> 的文件夹中生成一个完整的、包含 HTML、CSS、JavaScript 的静态网站。</li>
</ul>
</li>
<li>
<p><strong>查看结果</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">ls</span> -la ./404-story/
$ open ./404-story/index.html  <span class="hljs-comment"># 在macOS中打开</span>
<span class="hljs-comment"># 或</span>
$ start ./404-story/index.html <span class="hljs-comment"># 在Windows中打开</span>
</code></pre>
</li>
</ol>
<p>这个例子展示了 goose 如何将高层次的需求分解为一系列具体操作（提问、获取数据、编写代码、组织文件），并自主完成。</p>
<h3 data-id="heading-21">日常维护</h3>
<ol>
<li>
<p><strong>检查更新</strong>：
goose 项目迭代较快。定期查看 GitHub Releases 页面，或使用桌面应用内的更新检查功能（如有）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 对于 CLI，重新运行安装脚本通常可以更新到最新稳定版</span>
$ curl -fsSL https://github.com/block/goose/releases/download/stable/download_cli.sh | bash
</code></pre>
</li>
<li>
<p><strong>管理配置</strong>：
配置文件通常位于 <code>~/.config/goose/config.toml</code>。你可以手动编辑它，但建议使用 <code>goose configure</code> 命令修改主要设置。</p>
</li>
<li>
<p><strong>清理缓存</strong>：
扩展和模型可能会产生缓存。缓存目录通常也在配置文件夹下（<code>~/.cache/goose/</code>）。定期清理可以释放磁盘空间。</p>
</li>
<li>
<p><strong>日志管理</strong>：
遇到问题时，日志是第一手资料。默认日志路径在 <code>~/.config/goose/logs/</code>。你可以配置日志级别（如 <code>RUST_LOG=debug</code>）来获取更详细的信息。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 以调试模式运行并查看输出</span>
$ RUST_LOG=debug goose run <span class="hljs-string">"你的指令"</span> 2&gt;&amp;1 | less
</code></pre>
</li>
</ol>
<h3 data-id="heading-22">故障排除</h3>
<p><strong>问题：命令未找到 (<code>command not found: goose</code>)</strong></p>
<ul>
<li><strong>原因</strong>：<code>goose</code> 二进制所在目录未加入系统 PATH。</li>
<li><strong>解决</strong>：参考 <a href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85" title="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85">系统安装</a> 章节，将 <code>$HOME/.local/bin</code>（或你自定义的目录）添加到 shell 的 PATH 环境变量中。</li>
</ul>
<p><strong>问题：配置 API 密钥后，运行任务失败，提示认证错误</strong></p>
<ul>
<li><strong>原因</strong>：API 密钥无效、过期，或网络无法访问对应服务商。</li>
<li><strong>解决</strong>：
<ol>
<li>重新在对应服务商平台检查并复制正确的 API 密钥。</li>
<li>运行 <code>goose configure</code> 重新配置。</li>
<li>检查网络连接和代理设置。</li>
<li>运行 <code>goose doctor</code> 查看更详细的错误信息。</li>
</ol>
</li>
</ul>
<p><strong>问题：执行文件操作或 Shell 命令时权限被拒绝</strong></p>
<ul>
<li><strong>原因</strong>：goose 进程权限不足以访问目标目录或执行命令。</li>
<li><strong>解决</strong>：
<ol>
<li>确保工作目录路径正确且 goose 有读写权限。</li>
<li>在 Linux/macOS 下，避免在 <code>/root</code> 或 <code>/etc</code> 等系统目录下直接操作，建议在用户目录内进行。</li>
<li>检查是否有防病毒软件或沙盒机制阻止了 goose 的操作。</li>
</ol>
</li>
</ul>
<p><strong>问题：桌面应用启动失败或崩溃</strong></p>
<ul>
<li><strong>原因</strong>：可能是缺少运行时依赖，或与系统图形环境不兼容。</li>
<li><strong>解决</strong>：
<ol>
<li>确保系统已安装必要的图形库（如 Linux 下的 <code>libgtk</code> 系列）。</li>
<li>尝试以命令行启动桌面应用（如果支持），查看错误输出。</li>
<li>查看应用日志（通常可在 <code>~/.config/Goose/logs/</code> 找到）。</li>
<li>考虑使用 CLI 版本作为替代。</li>
</ol>
</li>
</ul>
<p><strong>通用诊断流程</strong>：</p>
<ol>
<li><strong>运行 <code>goose doctor</code></strong>：这是内置的诊断工具，能检查核心配置和依赖。</li>
<li><strong>检查日志</strong>：查看详细错误信息。</li>
<li><strong>简化复现</strong>：尝试一个最简单的指令（如 <code>goose run "echo hello"</code>）是否能成功。</li>
<li><strong>查阅社区</strong>：前往 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2Fgoose-oss" target="_blank" title="https://discord.gg/goose-oss" ref="nofollow noopener noreferrer">Discord</a> 或 GitHub Issues 搜索类似问题。</li>
</ol>
<h3 data-id="heading-23">进阶配置</h3>
<p>goose 的配置文件 (<code>~/.config/goose/config.toml</code>) 支持更精细的调整。以下是一个配置示例片段及其说明：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[agent]</span>
<span class="hljs-comment"># 默认使用的模型提供商和模型</span>
<span class="hljs-attr">provider</span> = <span class="hljs-string">"openai"</span>
<span class="hljs-attr">model</span> = <span class="hljs-string">"gpt-4o"</span>

<span class="hljs-comment"># 工作目录</span>
<span class="hljs-attr">working_dir</span> = <span class="hljs-string">"/Users/yourname/Projects"</span>

<span class="hljs-section">[agent.openai]</span>
<span class="hljs-comment"># OpenAI 特定的配置</span>
<span class="hljs-attr">api_key</span> = <span class="hljs-string">"sk-..."</span> <span class="hljs-comment"># 建议通过 configure 设置，这里会自动填充</span>
<span class="hljs-attr">base_url</span> = <span class="hljs-string">"https://api.openai.com/v1"</span> <span class="hljs-comment"># 可指向自定义端点</span>

<span class="hljs-section">[extensions]</span>
<span class="hljs-comment"># 自动启用的内置扩展</span>
<span class="hljs-attr">enabled</span> = [<span class="hljs-string">"developer"</span>, <span class="hljs-string">"computercontroller"</span>]

<span class="hljs-comment"># 自定义扩展配置</span>
<span class="hljs-section">[[extensions.custom]]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"my_mcp_tool"</span>
<span class="hljs-attr">type</span> = <span class="hljs-string">"stdio"</span> <span class="hljs-comment"># 通过标准输入输出通信</span>
<span class="hljs-attr">cmd</span> = <span class="hljs-string">"uvx"</span>    <span class="hljs-comment"># 使用 uvx 工具运行</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"my-mcp-server"</span>] <span class="hljs-comment"># 服务器命令</span>
</code></pre>
<p><strong>适用场景</strong>：</p>
<ul>
<li><strong>多模型切换</strong>：你可以创建多个配置节，通过环境变量或命令行参数快速切换。</li>
<li><strong>自定义 MCP 服务器</strong>：集成自己编写的或第三方的 MCP 服务器以扩展 goose 的工具集。</li>
<li><strong>网络与代理</strong>：在配置中指定代理服务器地址。</li>
</ul>
<h3 data-id="heading-24">常见问题</h3>
<p><strong>Q：goose 会把我本地的代码上传到云端吗？</strong>
A：<strong>不会。</strong> goose 是一个本地优先的框架。代码、文件操作都在你的机器上完成。只有为了理解指令和生成计划，你选择的 <strong>LLM 提供商（如 OpenAI）会收到相关的文本提示</strong>。API 密钥和模型调用是你的直接交互。务必阅读并理解你所选模型提供商的数据使用政策。</p>
<p><strong>Q：支持哪些编程语言和框架？</strong>
A：goose 不限于特定语言。它的能力取决于其集成的工具（扩展）和背后 LLM 的知识。内置的 <code>developer</code> 扩展可以操作任何文本文件，因此理论上可以处理任何语言的代码。对于特定框架的深度支持，需要相应的扩展或 LLM 具备相关知识。</p>
<p><strong>Q：运行 goose 成本高吗？</strong>
A：成本主要来自你使用的 <strong>云端 LLM API 调用</strong>（如 OpenAI, Anthropic）。goose 本身是免费开源的。你可以通过以下方式控制成本：
- 使用更经济的模型（如 <code>gpt-4o-mini</code> 而非 <code>gpt-4o</code>）。
- 在配置中设置使用限制。
- 对于简单任务，考虑使用本地开源模型（需要额外配置兼容的 MCP 服务器）。</p>
<p><strong>Q：如何为 goose 开发扩展？</strong>
A：goose 通过 <strong>Model Context Protocol (MCP)</strong> 集成扩展。你可以遵循 MCP 协议开发任何语言编写的服务器，并通过配置文件将其添加为 <code>stdio</code> 类型的扩展。参考 <code>rmpc</code> crate 和 MCP 官方文档进行开发。</p>
<p><strong>Q：<code>goose run</code> 和 <code>goose chat</code> 有什么区别？</strong>
A：<code>goose run</code> 是<strong>单次指令执行</strong>模式，适合明确的、独立的任务。<code>goose chat</code> 是<strong>交互式会话</strong>模式，会保留对话历史上下文，适合需要多轮讨论、调试或探索的复杂任务。</p>
<h3 data-id="heading-25">资源链接与快速参考卡</h3>
<p><strong>官方资源</strong>：</p>
<ul>
<li><strong>GitHub 仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fblock%2Fgoose" target="_blank" title="https://github.com/block/goose" ref="nofollow noopener noreferrer">github.com/block/goose</a> (代码、Issues、Releases)</li>
<li><strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblock.github.io%2Fgoose%2Fdocs" target="_blank" title="https://block.github.io/goose/docs" ref="nofollow noopener noreferrer">block.github.io/goose/docs</a></li>
<li><strong>Discord 社区</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2Fgoose-oss" target="_blank" title="https://discord.gg/goose-oss" ref="nofollow noopener noreferrer">discord.gg/goose-oss</a> (获取实时帮助和交流)</li>
<li><strong>项目官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoose.blocks" target="_blank" title="https://goose.blocks" ref="nofollow noopener noreferrer">goose.blocks</a> (如有)</li>
</ul>
<p><strong>快速参考卡 (Cheatsheet)</strong>：</p>













































<table><thead><tr><th align="left">场景</th><th align="left">核心命令</th></tr></thead><tbody><tr><td align="left"><strong>安装与更新</strong></td><td align="left"><code>curl -fsSL ...download_cli.sh | bash</code></td></tr><tr><td align="left"><strong>首次配置</strong></td><td align="left"><code>goose configure</code></td></tr><tr><td align="left"><strong>执行一个任务</strong></td><td align="left"><code>goose run “你的指令”</code></td></tr><tr><td align="left"><strong>交互式对话</strong></td><td align="left"><code>goose chat</code></td></tr><tr><td align="left"><strong>运行食谱</strong></td><td align="left"><code>goose cook recipe.yaml</code></td></tr><tr><td align="left"><strong>列出扩展</strong></td><td align="left"><code>goose extensions list</code></td></tr><tr><td align="left"><strong>启动API服务</strong></td><td align="left"><code>goose server start --port 3001</code></td></tr><tr><td align="left"><strong>查看版本</strong></td><td align="left"><code>goose --version</code></td></tr><tr><td align="left"><strong>诊断问题</strong></td><td align="left"><code>goose doctor</code></td></tr></tbody></table>
<p><strong>反馈与贡献</strong>：</p>
<ul>
<li>发现 bug 或有功能建议？请在 GitHub Issues 创建。</li>
<li>想贡献代码？请阅读仓库中的 <code>CONTRIBUTING.md</code>（如有）和 <code>GOVERNANCE.md</code> 文件。</li>
<li>翻译或文档改进也是宝贵的贡献。</li>
</ul>
<hr/>
<p><strong>祝你使用 goose 开发愉快，提升工程效率！</strong> 🦢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot]]></title>    <link>https://juejin.cn/post/7601175299011444751</link>    <guid>https://juejin.cn/post/7601175299011444751</guid>    <pubDate>2026-02-01T09:20:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601175299011444751" data-draft-id="7595831648825016360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2026-02-01T09:20:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="郡杰"/> <meta itemprop="url" content="https://juejin.cn/user/1823423934236172"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1823423934236172/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    郡杰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:20:30.000Z" title="Sun Feb 01 2026 09:20:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读43分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpringBoot 简介</h2>
<p><strong>SpringBoot</strong> 是由 Pivotal 团队提供的全新框架，其设计目的是为了<strong>简化</strong> Spring 应用的<strong>初始搭建</strong>与<strong>开发过程</strong>。</p>
<p>Spring 框架本身已经在一定程度上简化了 Java 企业级开发，而 SpringBoot 则是在此基础上进一步简化。由此可见，SpringBoot 旨在追求极致的开发简便性与广泛适用性。</p>
<p>为了理解 SpringBoot 带来的简化，我们可以先回顾一下传统 SpringMVC 应用的开发流程：</p>
<ol>
<li><strong>创建工程，并在 <code>pom.xml</code> 配置文件中配置所依赖的坐标</strong></li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring MVC --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Servlet API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${servlet-api.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<ul>
<li>需要手动创建 Maven 工程。</li>
<li>在 <code>pom.xml</code> 中精确配置 SpringMVC、Servlet API 等相关依赖的坐标，并处理可能的版本兼容性问题。</li>
</ul>
<ol start="2">
<li><strong>编写 <code>web3.0</code> 的配置类</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 这是Spring 3.2+提供的更高级别的抽象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() {
        <span class="hljs-comment">// 返回Spring根容器的配置类（用于Service、DAO等非Web组件）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{SpringConfig.class};
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() {
        <span class="hljs-comment">// 返回SpringMVC的配置类（用于Controller等Web组件）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{SpringMvcConfig.class};
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> String[] getServletMappings() {
        <span class="hljs-comment">// 配置DispatcherServlet的映射路径</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"/"</span>};
    }
    <span class="hljs-comment">// 还可以重写其他方法进行更多配置</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Filter[] getServletFilters() {
        <span class="hljs-comment">// 添加过滤器</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filter</span>[]{<span class="hljs-keyword">new</span> <span class="hljs-title class_">CharacterEncodingFilter</span>(<span class="hljs-string">"UTF-8"</span>)};
    }
}
</code></pre>
<ul>
<li>需要编写一个类来实现 <code>WebApplicationInitializer</code> 接口，用于替代传统的 <code>web.xml</code> 文件。</li>
<li>在此类中，需手动注册 Spring 的 <code>DispatcherServlet</code>，并指定配置文件位置、URL 映射等，代码较为模板化且繁琐。</li>
</ul>
<ol start="3">
<li><strong>编写 SpringMVC 配置类</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>  <span class="hljs-comment">// 启用Spring MVC</span>
<span class="hljs-meta">@ComponentScan("com.example.controller")</span>  <span class="hljs-comment">// 扫描控制器组件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringMvcConfig</span> {
}
</code></pre>
<ul>
<li>需要创建配置类（使用 <code>@Configuration</code> 注解）。</li>
<li>在该类中启用 MVC 注解驱动（<code>@EnableWebMvc</code>）、配置视图解析器、静态资源处理等组件。这仅完成了应用程序基础框架的搭建。</li>
</ul>
<ol start="4">
<li><strong>编写业务 Controller</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@RestController</span>  <span class="hljs-comment">// 声明这是一个REST风格的控制器，所有方法返回JSON数据</span>
<span class="hljs-meta">@RequestMapping("/books")</span>  <span class="hljs-comment">// 定义该类所有请求的基础路径为"/books"</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {
    <span class="hljs-meta">@Autowired</span>   <span class="hljs-comment">// 自动注入BookService实例</span>
    <span class="hljs-keyword">private</span> BookService bookService;
    
    <span class="hljs-comment">// 处理HTTP GET请求，路径为"/books/{id}"</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-comment">// 定义查询方法，参数id来自URL路径</span>
    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 调用业务层方法，根据id查询书籍信息</span>
        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> bookService.getById(id);
        <span class="hljs-comment">// 根据查询结果设置状态码：成功或失败</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> book != <span class="hljs-literal">null</span> ? Code.GET_OK : Code.GET_ERR;
        <span class="hljs-comment">// 根据查询结果设置消息：成功时为空，失败时显示错误信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> book != <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : <span class="hljs-string">"数据查询失败，请重试！"</span>;
        <span class="hljs-comment">// 返回统一格式的结果对象，包含状态码、数据和消息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(code, book, msg);
    }
}
</code></pre>
<ul>
<li>至此，才能开始编写真正的业务逻辑，例如提供一个简单的 <code>Controller</code> 类和请求处理方法。</li>
</ul>
<p>从以上流程可以看出，步骤 1 到 3 主要集中于<strong>环境搭建和配置</strong>，这些步骤相对固定且重复。SpringBoot 的核心价值正是为了<strong>自动化这些初始配置步骤</strong>，让开发者能更专注于业务代码的编写。</p>
<p>接下来，我们将通过一个入门案例来具体展示 SpringBoot 是如何极大地简化 Spring 应用开发的。</p>
<h3 data-id="heading-1">SpringBoot 快速入门</h3>
<h4 data-id="heading-2">开发步骤</h4>
<p><code>SpringBoot</code> 开发起来特别简单，分为如下几步：</p>
<ol>
<li><strong>创建新模块</strong>，选择 Spring Initializr，并配置模块相关基础信息</li>
<li><strong>选择当前模块需要使用的技术集</strong></li>
<li><strong>开发控制器类</strong></li>
<li><strong>运行自动生成的 Application 类</strong></li>
</ol>
<p>接下来我们进行具体的操作。</p>
<h5 data-id="heading-3">1. 创建新模块</h5>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p><strong>配置项目基本信息</strong><br/>
到 <strong><code>新建项目</code></strong> 界面，在 <strong><code>生成器</code></strong> 栏找到并点击 <strong><code>Spring Boot</code></strong> ，填写 <strong><code>名称</code></strong>、<strong><code>项目文件位置</code></strong>，选择 <strong><code>类型：Maven</code></strong>、<strong><code>打包：Jar</code></strong>。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e73c30deea454aa4847be4845ece37f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=wBi%2Bfd793ueSGjmUY392BzxaFgU%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong><code>类型：Maven</code></strong>、<strong><code>打包：Jar</code></strong> 选择理由</p>
<ul>
<li>我们使用这种方式构建的 <code>SpringBoot</code> 工程其实也是 <code>Maven</code> 工程，而该方式只是一种快速构建的方式</li>
<li>打包方式这里需要设置为 <code>Jar</code>（这是 SpringBoot 的默认打包方式，不同于传统的 war 包）</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>选择依赖</strong><br/>
找到 <strong><code>依赖项</code></strong> - <strong><code>Web</code></strong> - <strong><code>Spring Web</code></strong>，并勾选。Spring Boot版本按需选择。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dfa8dc6d1a40549c3d825bdd4ec65f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=fqpbTa6ErrOxhg25U82R4Rpqo3o%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong>理解</strong>：<br/>
由于我们需要开发一个 <code>web</code> 程序，使用到了 <code>SpringMVC</code> 技术，所以需要勾选 <code>Spring Web</code> 依赖<br/>
这些依赖相当于我们传统 Maven 项目中的 pom.xml 依赖配置，但 Spring Initializr 帮我们自动添加了</p>
</blockquote>
</li>
<li>
<p><strong>完成创建</strong><br/>
经过以上步骤后会创建如下结构的模块：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4818d64d7a449de8e16c499bd906334~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=DeDP8o6q6KQWG%2Bne%2FmmFvd2%2BLn4%3D" alt="image.png" width="50%" loading="lazy"/></p>
</li>
</ol>
<blockquote>
<p>为方便后续学习，项目结构保持与资料基本一致，图中的包名、java类名经过重命名。重命名后直接运行失败，执行 “构建-构建项目Build Project”后解决，运行按钮旁出现两个 Application，删除旧的绿色无效配置</p>
</blockquote>
<blockquote>
<p><strong>清理建议</strong>：</p>
<p>创建好的项目会自动生成一些文件，这些文件目前对我们学习来说不是必需的，可以删除以下目录和文件以保持项目简洁：</p>
<ul>
<li><code>.mvn/</code> 目录（Maven 包装器相关，如果不需要跨环境一致可以删除）</li>
<li><code>.gitignore</code> 文件（如果要使用 Git 管理，建议保留）</li>
<li><code>HELP.md</code> 文件</li>
<li><code>mvnw</code> 和 <code>mvnw.cmd</code> 文件（Maven 包装器脚本）</li>
</ul>
</blockquote>
<h5 data-id="heading-4">2. 创建 Controller</h5>
<p>在 <code>com.itheima</code> 包下创建<code>controller</code>包，再在其中创建 <code>BookController.java</code> 类，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * BookController - 书籍控制器类
 * 
 * 这个类演示了 SpringBoot 中 RESTful API 的基本写法
 * 
 * 知识点讲解：
 * 1. <span class="hljs-doctag">@RestController</span>：表示这是一个控制器类，方法的返回值直接作为 HTTP 响应体，而不是视图名称
 *    因此，所有方法的返回值都会自动转换为 JSON 格式
 * 
 * 2. <span class="hljs-doctag">@RequestMapping</span>("/books")：类级别的映射注解
 *    - 指定这个控制器处理以 "/books" 开头的所有请求
 *    - 这个路径会与方法的映射路径拼接起来，形成完整的 URL
 * 
 * 3. <span class="hljs-doctag">@GetMapping</span>("/{id}")：方法级别的映射注解
 *    - 表示这个方法处理 HTTP GET 请求
 *    - "/{id}" 是路径变量，用 {} 括起来的部分表示这是一个可变部分
 *    - 完整的访问路径是：GET http://localhost:8080/books/{id}
 * 
 * 4. <span class="hljs-doctag">@PathVariable</span> Integer id：路径变量绑定
 *    - 将 URL 中的 {id} 部分绑定到方法的参数 id 上
 *    - 参数名必须与 <span class="hljs-doctag">@PathVariable</span> 中的变量名一致（如果省略参数名，需要确保变量名与占位符名称一致）
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">/**
     * 根据ID获取书籍信息
     * 
     * 示例：访问 http://localhost:8080/books/1
     * - 会匹配到这个方法
     * - id 参数会获取到 1
     * - 方法返回的字符串会直接作为 HTTP 响应体
     * 
     * <span class="hljs-doctag">@param</span> id 书籍ID，从URL路径中获取
     * <span class="hljs-doctag">@return</span> 返回一个简单的字符串（实际项目中通常会返回对象或JSON）
     */</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 在实际项目中，这里通常会调用Service层获取数据</span>
        <span class="hljs-comment">// 例如：Book book = bookService.getById(id);</span>
        <span class="hljs-comment">// 返回：return book;</span>
        
        System.out.println(<span class="hljs-string">"id ==&gt; "</span> + id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>创建控制器类步骤</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 第一步：导入必要的注解</span>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-comment">// 第二步：添加 @RestController 注解</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-comment">// 第三步：添加 @RequestMapping 定义基础路径（可选）</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {
    
    <span class="hljs-comment">// 第四步：编写处理请求的方法</span>
    <span class="hljs-comment">// 示例1：GET请求，带路径参数</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
    }
    
    <span class="hljs-comment">// 示例2：GET请求，不带参数</span>
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"所有数据"</span>;
    }
    
    <span class="hljs-comment">// 示例3：POST请求</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"创建成功"</span>;
    }
}
</code></pre>
<blockquote>
<p><strong>常见映射注解</strong>：</p>
<ul>
<li><code>@GetMapping</code> - 处理 GET 请求</li>
<li><code>@PostMapping</code> - 处理 POST 请求</li>
<li><code>@PutMapping</code> - 处理 PUT 请求</li>
<li><code>@DeleteMapping</code> - 处理 DELETE 请求</li>
<li><code>@PatchMapping</code> - 处理 PATCH 请求</li>
</ul>
</blockquote>
<h5 data-id="heading-5">3. 启动服务器</h5>
<p>运行 SpringBoot 工程不需要使用本地的 Tomcat 和插件，只需运行项目 <code>com.itheima</code> 包下的 <code>Application</code> 类。  运行后控制台会显示类似以下信息：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06bce97193b1433386d557ec9463941a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=0zQ4EVsH3WOFf4L4MrhkEWU7p5U%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong>关键信息解读：</strong></p>
<ol>
<li><strong><code>Tomcat initialized with port(s): 8080 (http)</code></strong> - 内嵌的 Tomcat 服务器已启动，监听 8080 端口</li>
<li><strong><code>Started Application in 1.168 seconds</code></strong> - 应用启动耗时 1.168 秒</li>
<li><strong><code>with context path '/'</code></strong> - 应用上下文路径为空，表示根路径</li>
</ol>
<p><strong>与传统的 Spring MVC 对比：</strong></p>

























<table><thead><tr><th>传统 Spring MVC</th><th>SpringBoot</th></tr></thead><tbody><tr><td>需要外部 Tomcat</td><td>内嵌 Tomcat，无需安装配置</td></tr><tr><td>需要 web.xml 配置</td><td>零 XML 配置</td></tr><tr><td>需要手动配置 DispatcherServlet</td><td>自动配置</td></tr><tr><td>部署时需要打 war 包</td><td>可执行 jar 包，直接运行</td></tr></tbody></table>
</blockquote>
<h5 data-id="heading-6">4. 进行测试</h5>
<p>使用 Postman 工具来测试我们的程序：</p>
<p><strong>Postman 测试步骤：</strong></p>
<ol>
<li><strong>打开 Postman</strong>：如果没有安装，可以从官网下载</li>
<li><strong>创建新请求</strong>：
<ul>
<li>请求方法：GET</li>
<li>请求 URL：<code>http://localhost:8080/books/1</code></li>
</ul>
</li>
<li><strong>发送请求</strong>：点击 Send 按钮</li>
<li><strong>查看响应</strong>：在响应体部分应该看到 <code>hello, spring boot!</code></li>
</ol>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e01f0b5c2614e65aeb12f9e3e68348e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=wQDF1HoELI0RjcdSZfrCQ9xS%2FGg%3D" alt="image.png" width="100%" loading="lazy"/>
<p>通过上面的入门案例我们可以看到使用 SpringBoot 进行开发，使整个开发变得很简单，那它是如何做到的呢？<br/>
要研究这个问题，我们需要看看 <code>Application</code> 类和 <code>pom.xml</code> 都书写了什么：</p>
<p><strong>Application 类分析：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 导入必要的包</span>
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-comment">/**
 * SpringBoot 应用的主启动类
 * 
 * 这个类是整个应用的入口点，也是 SpringBoot 应用的核心
 * 
 * <span class="hljs-doctag">@SpringBootApplication</span> 注解详解：
 * 这个注解告诉 Spring Boot：
 * 1. 这是一个 Spring Boot 应用
 * 2. 启用自动配置
 * 3. 扫描当前包及其子包下的组件
 */</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    
    <span class="hljs-comment">/**
     * 主方法 - 应用启动入口
     * 
     * 这个方法只有一个核心操作：SpringApplication.run()
     * 
     * SpringApplication.run() 方法的作用：
     * 1. 创建 Spring 应用上下文（ApplicationContext）
     * 2. 注册所有 Bean（包括自动配置的 Bean）
     * 3. 启动内嵌的 Web 服务器（如 Tomcat）
     * 4. 启动 Spring Boot 应用
     * 
     * 方法的参数说明：
     * - Application.class: 主配置类
     * - args: 命令行参数
     * 
     * 方法的返回值：ConfigurableApplicationContext，可以用于获取 Bean
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 这行代码完成了传统 Spring MVC 中的所有配置工作</span>
        SpringApplication.run(Application.class, args);
        
        <span class="hljs-comment">// 启动后，应用会一直运行，直到收到关闭信号</span>
        <span class="hljs-comment">// 可以通过 Ctrl+C 或调用 context.close() 来关闭应用</span>
    }
}
</code></pre>
<p><strong>pom.xml 分析：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> 
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 
    这是父工程配置，指定了一个父工程 - SpringBoot 的精髓之一
    作用：
    1. 版本管理：统一管理所有依赖的版本
    2. 默认配置：提供合理的默认配置
    3. 依赖继承：子工程可以继承父工程的依赖
    
    传统 Maven 项目需要为每个依赖指定版本号，容易冲突
    SpringBoot 通过父工程统一管理，避免版本冲突
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目坐标 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itheima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot_01_quickstart<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 指定 JDK 版本 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 
        Spring Web Starter - Web 应用起步依赖，是我们在创建 SpringBoot 工程勾选的那个 Spring Web 产生的
        这个依赖是 SpringBoot 简化开发的关键
        
        什么是起步依赖（Starter）？
        起步依赖是一组预配置的依赖集合，它包含了开发某种应用所需的所有基础依赖。
        
        传统方式：需要手动添加几十个依赖，并解决版本冲突
        SpringBoot：只需要添加这一个起步依赖
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 注意：这里没有指定版本号，版本由父工程统一管理 --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 
        测试起步依赖
        作用：提供测试所需的依赖（JUnit, Mockito, Spring Test等）
        注意：scope 为 test，表示只在测试时使用，不会打包到生产环境
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 构建配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 
            Spring Boot Maven 插件
            作用：
            1. 将应用打包成可执行的 JAR 文件（包含所有依赖）
            2. 提供运行、打包等 Maven 目标（goals）
            3. 支持热部署（spring-boot:run）
            
            传统方式：
            - 打 war 包，需要部署到外部 Tomcat
            - 依赖需要单独部署
            
            SpringBoot 方式：
            - 打可执行 JAR 包，包含所有依赖和内嵌服务器
            - 直接运行：java -jar app.jar
            --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">对比</h4>
<p>做完 <code>SpringBoot</code> 的入门案例后，接下来对比一下 <code>Spring</code> 程序和 <code>SpringBoot</code> 程序。如下图</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6146e87a9d21411e957c8064db386ea9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=5M%2Fx4fMB0FGLot1bjBhkqf3GXxU%3D" alt="image.png" width="100%" loading="lazy"/>
<ul>
<li><strong>坐标</strong><br/>
<code>Spring</code> 程序中的坐标需要自己编写，而且坐标非常多<br/>
<code>SpringBoot</code> 程序中的坐标是我们在创建工程时进行勾选自动生成的</li>
<li><strong>web3.0配置类</strong><br/>
<code>Spring</code> 程序需要自己编写这个配置类。这个配置类大家之前编写过，肯定感觉很复杂<br/>
<code>SpringBoot</code> 程序不需要我们自己书写</li>
<li><strong>配置类</strong><br/>
<code>Spring/SpringMVC</code> 程序的配置类需要自己书写。而 <code>SpringBoot</code>  程序则不需要书写。</li>
</ul>
<blockquote>
<ul>
<li><strong>基于 Idea 的 Spring Initializr 需要联网</strong>，因为它需要从 Spring 官方服务器获取模板和依赖列表</li>
<li>如果无法联网，可以：
<ul>
<li>手动创建 Maven 项目，添加 SpringBoot 依赖</li>
<li>使用本地缓存（如果之前下载过）</li>
</ul>
</li>
</ul>
</blockquote>
<h4 data-id="heading-8">官网构建工程</h4>
<p>通过IDEA快速创建的Spring Boot工程，其底层实现实际上是调用了Spring官方提供的在线构建工具——<strong>Spring Initializr</strong>。</p>
<p>了解如何在官网直接使用Spring Initializr构建工程，不仅能理解其原理，还能确保在没有IDEA或其他IDE的环境下，依然可以创建项目。</p>
<p><strong>访问 Spring Initializr</strong></p>
<p>直接在浏览器中输入Spring Initializr的地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstart.spring.io" target="_blank" title="https://start.spring.io" ref="nofollow noopener noreferrer">start.spring.io</a></strong>。</p>
<p>打开后的界面如下图所示，它与你在IDEA中看到的创建向导在核心功能上完全一致：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/757cebcc989e4621aad9d6fa92ff2bf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=LqYXO1rJTNE8yuSOUHyVWsDg%2BR0%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>配置项目信息与依赖</strong></p>
<p>在Spring Initializr页面上，你需要完成与IDEA中类似的配置：</p>
<p><strong>1. 项目基础信息</strong><br/>
你需要填写或选择页面顶部的几个关键元数据：</p>
<ul>
<li><strong>Project</strong>： 选择构建工具，如 <strong>Maven</strong> 或 <strong>Gradle</strong>。</li>
<li><strong>Language</strong>： 选择编程语言，如 <strong>Java</strong>。</li>
<li><strong>Spring Boot</strong>： 选择Spring Boot的版本（建议选择标注有 <strong><code>(SNAPSHOT)</code></strong> 以外的稳定版本）。</li>
<li><strong>Project Metadata</strong>：
<ul>
<li><code>Group</code>： 组织标识，通常使用倒写的域名（例如 <code>com.example</code>）。</li>
<li><code>Artifact</code>： 项目标识，即你的项目名（例如 <code>demo</code>）。</li>
<li>其他如 <code>Name</code>、<code>Description</code>、<code>Package name</code> 会根据前两项自动生成，通常无需修改。</li>
</ul>
</li>
</ul>
<p><strong>2. 添加项目依赖</strong><br/>
这是Spring Initializr的核心功能之一，用于为你的项目自动生成对应的依赖配置。</p>
<ul>
<li>点击 <strong>“ADD DEPENDENCIES”</strong> 按钮（或按 <code>Ctrl + B</code> 快捷键），会弹出依赖搜索面板。</li>
<li>在搜索框中输入你需要的技术名称，例如 <strong>“Web”</strong>。</li>
<li>从搜索结果中选择 <strong>“Spring Web”</strong> 依赖，它将负责添加构建一个Web应用所需的所有基础库（包含内嵌的Tomcat服务器、Spring MVC等）。</li>
<li>你还可以根据需要添加更多依赖，例如 “Spring Data JPA”、“MySQL Driver”、“Lombok” 等。</li>
</ul>
<p><strong>3. 生成并下载项目</strong></p>
<p>所有信息配置完成后：</p>
<ol>
<li>点击页面底部的 <strong>“GENERATE”</strong> 按钮（或按 <code>Ctrl + 回车</code>）。</li>
<li>浏览器会自动下载一个以你填写的 <code>Artifact</code> 命名的 <code>.zip</code> 压缩包（例如 <code>demo.zip</code>）。</li>
</ol>
<p><strong>4. 解压与导入IDE</strong></p>
<ol>
<li>将下载的 <code>.zip</code> 文件解压到你本地的工作目录。</li>
<li>解压后的目录结构与你用IDEA生成的项目<strong>完全一致</strong>，标准的Maven项目结构如下：
demo/
├── src/
│   ├── main/
│   │   ├── java/com/example/demo/
│   │   │   └── DemoApplication.java  # Spring Boot 主启动类
│   │   └── resources/
│   │       ├── static/
│   │       ├── templates/
│   │       └── application.properties  # 配置文件
│   └── test/                          # 测试目录
└── pom.xml                           # Maven 项目核心配置文件</li>
<li>打开 <code>pom.xml</code> 文件，你可以看到Spring Boot父工程坐标以及你刚才选择的 <strong>“Spring Web”</strong> 依赖都已经自动配置好了。</li>
<li>最后，你可以用IDEA、Eclipse等IDE的 <strong>“Open”</strong> 或 <strong>“Import”</strong> 功能，选择这个解压后的项目目录，将其导入为现有项目进行开发。</li>
</ol>
<h4 data-id="heading-9">工程快速启动-Jar包</h4>
<h5 data-id="heading-10">问题导入：解决前后端协作的部署依赖</h5>
<p>在前后端分离的协作开发中，前端开发者通常需要后端服务处于运行状态，以便测试接口、调试页面功能。这会造成前端工作进度受制于后端开发者本地的开发环境。</p>
<p><strong>传统方式的局限</strong>：如果让前端开发者在自己电脑上配置完整的后端开发环境（如安装JDK、Tomcat、Idea，并导入项目），过程非常繁琐且不现实。</p>
<p><strong>SpringBoot的解决方案</strong>：利用SpringBoot可以将工程打包成一个<strong>独立可执行的Jar文件</strong>。这个Jar包内嵌了Web服务器（如Tomcat），因此<strong>运行它不需要预先安装任何外部的Tomcat或IDE</strong>，只需要目标机器上有Java运行环境（JRE）即可。</p>
<p>这样，后端开发者只需将打包好的Jar文件交给前端，前端开发者（或任何需要的人）就可以在自己的电脑上，通过一条简单的命令独立启动后端服务，<strong>唯一的前提是能访问到项目所需的数据库等外部资源</strong>。</p>
<h5 data-id="heading-11">打包：生成可执行Jar包</h5>
<p>SpringBoot工程能够打包成“可执行Jar”（也称为“Fat Jar”），核心在于 <code>pom.xml</code> 中配置的 <code>spring-boot-maven-plugin</code> 插件。</p>
<p><strong>打包步骤</strong>：</p>
<ol>
<li>
<p><strong>确认插件</strong>：确保你的 <code>pom.xml</code> 文件的 <code>&lt;build&gt;</code> -&gt; <code>&lt;plugins&gt;</code> 部分包含该插件配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 这是生成可执行Jar的关键插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<blockquote>
<p><strong>重要提示</strong>：使用Spring Initializr创建的工程<strong>默认已包含</strong>此配置。如果缺失，打包出的Jar将无法以 <code>java -jar</code> 方式直接启动。</p>
</blockquote>
</li>
<li>
<p><strong>执行打包</strong>：</p>
</li>
</ol>
<p>在IDEA中打包Spring Boot项目，有两种直观的方法：</p>
<p><strong>方法一：使用IDEA右侧的Maven图形化工具</strong></p>
<ol>
<li><strong>打开Maven工具窗口</strong>：在IDEA主界面右侧，找到并点击 <strong>「Maven」</strong> 标签栏。如果没看到，请通过顶部菜单 <strong>View（视图） → Tool Windows（工具窗口） → Maven</strong> 打开。</li>
<li><strong>找到你的项目</strong>：在展开的Maven面板中，你会看到你的项目名（例如 <code>springboot_01_quickstart</code>）。点开它下面的 <strong>Lifecycle（生存期）</strong> 文件夹。</li>
<li><strong>执行打包</strong>：在 <code>Lifecycle</code> 里，找到 <strong>package</strong> 并 <strong>双击它</strong>。IDEA就会开始执行打包过程。</li>
</ol>
<p>执行时你会看到：IDEA底部会弹出「Run」工具窗口，显示详细的Maven构建日志。最后出现 <strong><code>BUILD SUCCESS</code></strong> 就表示打包成功。</p>
<p><strong>方法二：使用IDEA内置的终端（命令行）</strong></p>
<p>这个方法更接近真实的生产环境操作。</p>
<ol>
<li><strong>打开终端</strong>：在IDEA左边栏下部，找到并点击 <strong>Terminal（终端）</strong> 标签页。它会<strong>自动打开并定位在你的项目根目录</strong>（即 <code>pom.xml</code> 文件所在的目录）。</li>
<li><strong>输入命令</strong>：在终端里，直接输入以下命令并按回车：
<pre><code class="hljs language-bash" lang="bash">mvn clean package
</code></pre>
</li>
</ol>
<p>执行时你会看到：同样会在终端里滚动输出构建信息，直到出现 <code>BUILD SUCCESS</code>。</p>
<ol start="3">
<li><strong>获取产物</strong>：命令执行成功后，在项目的 <code>target</code> 目录下即可找到生成的Jar包，其命名格式通常为 <code>项目名-版本号.jar</code>（例如 <code>springboot_01_quickstart-0.0.1-SNAPSHOT.jar</code>）。</li>
</ol>
<h5 data-id="heading-12">启动：运行Jar包</h5>
<p>启动这个Jar包非常简单，无需任何容器。</p>
<ol>
<li><strong>打开命令行</strong>：进入 <code>target</code> 目录（<code>cd target</code>），或者记住Jar包的完整路径。</li>
<li><strong>执行启动命令</strong>：
<pre><code class="hljs language-bash" lang="bash">java -jar Jar包名
</code></pre>
</li>
<li><strong>观察日志</strong>：执行命令后，SpringBoot的启动日志会直接输出在控制台，你将会看到熟悉的启动信息，包括内嵌Tomcat的端口号。</li>
</ol>
<p>上述可以 在IDEA的终端中操作，也可以在系统的命令行中操作。</p>
<h3 data-id="heading-13">SpringBoot 概述</h3>
<p><code>SpringBoot</code> 是由 Pivotal 团队提供的全新框架，其设计目的就是<strong>简化</strong> Spring 应用的<strong>初始搭建</strong>和<strong>开发过程</strong>。</p>
<p>通过与原始 Spring 环境对比，可以清晰看到 SpringBoot 的核心价值：</p>





















<table><thead><tr><th align="left">原始 Spring 开发痛点</th><th align="left">SpringBoot 对应的解决方案</th></tr></thead><tbody><tr><td align="left"><strong>配置繁琐</strong><br/>需要大量 XML 或 Java 配置</td><td align="left"><strong>自动配置 (Auto Configuration)</strong><br/>根据类路径和设置，自动配置 Bean 和组件。</td></tr><tr><td align="left"><strong>依赖设置繁琐</strong><br/>需要手动管理大量依赖及其兼容版本</td><td align="left"><strong>起步依赖 (Starter Dependencies)</strong><br/>提供预设的、版本协调好的依赖包。</td></tr><tr><td align="left"><strong>部署依赖外部服务器</strong><br/>需要独立安装和配置 Tomcat 等服务器</td><td align="left"><strong>辅助功能 (如内置服务器)</strong><br/>内置 Tomcat、Jetty 等服务器，打包即可独立运行。</td></tr></tbody></table>
<h4 data-id="heading-14">起步依赖</h4>
<p>在使用 Spring Initializr 创建工程时，<code>pom.xml</code> 中自动生成的、名称中包含 <strong><code>starter</code></strong> 的依赖，就是 <strong>起步依赖</strong>。它们是简化依赖管理的核心。</p>
<p>起步依赖的实现机制主要基于两个关键设计：<strong>继承父工程 (<code>parent</code>)</strong> 和<strong>引入启动器 (<code>starter</code>)</strong></p>
<h5 data-id="heading-15">探索父工程：统一版本管理</h5>
<p>在项目的 <code>pom.xml</code> 中，通过 <code>&lt;parent&gt;</code> 指定了一个父工程（如 <code>spring-boot-starter-parent</code>）。这个父工程的核心作用是进行<strong>统一的依赖版本管理</strong>，而非直接引入所有依赖。</p>
<ul>
<li><strong>版本仓库 (<code>&lt;properties&gt;</code>)</strong>：父工程的 <code>pom.xml</code> 中，<code>&lt;properties&gt;</code> 标签像一个大仓库，定义了数百个常用技术依赖（如 Servlet、MySQL Driver、Jackson 等）的<strong>兼容版本号</strong>。</li>
<li><strong>依赖管理 (<code>&lt;dependencyManagement&gt;</code>)</strong>：<code>&lt;dependencyManagement&gt;</code> 标签则利用这个仓库，对大部分可能用到的依赖进行了<strong>版本锁定</strong>。</li>
<li><strong>对你的影响</strong>：正因为继承了此父工程，当你在项目中添加依赖时，<strong>通常只需指定 <code>groupId</code> 和 <code>artifactId</code>，无需再写 <code>version</code></strong>。SpringBoot 会自动从父工程管理的版本仓库中选取一个经过兼容性测试的版本，这从根本上避免了版本冲突问题。</li>
</ul>
<h5 data-id="heading-16">探索起步依赖：功能聚合包</h5>
<p>以 <code>spring-boot-starter-web</code> 为例，当你在 <code>pom.xml</code> 中声明此依赖后，它实际上会引入一个<strong>功能相关的依赖包集合</strong>，而不仅仅是一个库。</p>
<p>进入 <code>spring-boot-starter-web</code> 的 <code>pom.xml</code>，你会发现它自身又引入了多个协调好的依赖：</p>
<ul>
<li><code>spring-web</code> 和 <code>spring-webmvc</code>（用于实现 Spring MVC Web 框架）</li>
<li><code>spring-boot-starter-tomcat</code>（内嵌了 Tomcat 服务器）</li>
<li><code>spring-boot-starter-json</code>（提供了 JSON 处理能力）</li>
</ul>
<p><strong>结论</strong>：<code>starter</code> 是一个<strong>功能导向</strong>的依赖描述。你需要什么功能（例如做 Web 开发、操作数据库、进行安全控制），就引入对应的 <code>starter</code>（例如 <code>spring-boot-starter-web</code>、<code>spring-boot-starter-data-jpa</code>、<code>spring-boot-starter-security</code>）。这个 <code>starter</code> 会帮你把实现该功能所需的一整套、版本协调好的技术依赖全部引入进来。</p>
<p><strong>实际开发中的使用守则</strong>：</p>
<ol>
<li><strong>引入依赖</strong>：通常只需要写 <code>groupId</code> 和 <code>artifactId</code>，<strong>不写 <code>version</code></strong>，依赖版本由父工程统一管理。</li>
<li><strong>选择依赖</strong>：根据所需功能选择对应的 <code>spring-boot-starter-*</code>。</li>
<li><strong>处理版本冲突（特殊情况）</strong>：如果必须使用特定版本，可以在 <code>pom.xml</code> 中手动指定 <code>&lt;version&gt;</code>，但需谨慎评估兼容性。</li>
</ol>
<h4 data-id="heading-17">程序启动-引导类</h4>
<p>在 Spring Boot 中，每个项目都有一个核心的入口类，通常称为 <strong>引导类</strong> (Bootstrap Class) 或 <strong>主启动类</strong>。它通常是项目创建后自动生成的，类名格式默认为 <code>[项目名]Application</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例：Springboot01QuickstartApplication 就是一个引导类</span>
<span class="hljs-meta">@SpringBootApplication</span> <span class="hljs-comment">// 核心注解：标记此为SpringBoot应用，并启用自动配置</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot01QuickstartApplication</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 核心启动方法：这行代码负责启动整个SpringBoot应用</span>
        SpringApplication.run(Springboot01QuickstartApplication.class, args);
    }
}
</code></pre>
<p><strong>关键要点：</strong></p>
<ol>
<li><strong>唯一入口</strong>：<code>main</code> 方法是整个 Spring Boot 应用的唯一启动入口。</li>
<li><strong>核心注解</strong>：<code>@SpringBootApplication</code> 是一个组合注解，它整合了配置、组件扫描和自动配置启用等关键功能。</li>
<li><strong>启动原理</strong>：当你运行 <code>main</code> 方法时，<code>SpringApplication.run()</code> 会：
<ul>
<li>初始化 Spring 容器。</li>
<li>启动内嵌的 Web 服务器（因为你引入了 <code>spring-boot-starter-web</code> 依赖，所以默认是 Tomcat）。</li>
<li>运行你的应用程序。</li>
</ul>
</li>
<li><strong>打包方式</strong>：Spring Boot <strong>默认采用 jar 包</strong>的打包方式（而非传统的 war 包）。这使得应用成为一个<strong>独立、可携带</strong>的单元，只需 JDK 环境即可通过 <code>java -jar</code> 命令运行，非常适合微服务和云原生部署。</li>
</ol>
<h4 data-id="heading-18">切换 Web 服务器</h4>
<p>Spring Boot 默认使用 Tomcat 作为内嵌服务器，但它支持轻松切换为其他服务器，如 Jetty 或 Undertow。</p>
<p><strong>切换核心思想</strong>：<strong>“先排除，后引入”</strong>——从当前 Web 起步依赖中排除默认的 Tomcat，然后引入你想要的服务器起步依赖。</p>
<p><strong>操作步骤（以切换到 Jetty 为例）</strong></p>
<p><strong>第一步：排除默认的 Tomcat 依赖</strong></p>
<p>在 <code>pom.xml</code> 文件中，修改 <code>spring-boot-starter-web</code> 依赖，添加 <code>&lt;exclusions&gt;</code> 标签来排除 Tomcat。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 关键：排除自带的Tomcat --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>第二步：引入 Jetty 起步依赖</strong></p>
<p>在同一个 <code>pom.xml</code> 文件中，添加 Jetty 的起步依赖。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>第三步：验证切换</strong></p>
<p>完成以上修改后，点击 “<strong>同步Maven更改</strong>” 以保存 <code>pom.xml</code>，再重新启动引导类（运行 <code>main</code> 方法）。在控制台输出的启动日志中，将不再看到 Tomcat 的字样，取而代之的是 Jetty 的相关信息，类似如下：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d54222056734c828b4da7a80772c374~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=LSAsJi6z0mfH5%2B8He9WaWKkiqHU%3D" alt="image.png" width="100%" loading="lazy"/></p>
<p><strong>实践提示</strong>：</p>
<ul>
<li>这个例子清晰地展示了 Spring Boot <strong>起步依赖</strong>的强大之处：<strong>切换一项核心技术，通常只需要更换对应的 <code>starter</code> 即可</strong>，所有复杂的依赖传递和版本管理都由框架自动处理。</li>
<li>在真实项目中，如果你没有对 Jetty 或 Undertow 的特殊需求，使用<strong>默认的 Tomcat</strong> 是最稳妥、兼容性最好的选择。</li>
</ul>
<h2 data-id="heading-19">配置文件</h2>
<p>Spring Boot 的强大之处在于其 <strong>“约定大于配置”</strong> 的理念，它提供了合理的默认值。但当我们需要自定义设置（如更改端口、配置数据库）时，就要用到<strong>配置文件</strong>。你可以将它理解为你应用程序的 <strong>“遥控器”</strong> ，通过修改它，无需改动代码就能改变程序的行为。</p>
<h3 data-id="heading-20">配置文件格式</h3>
<p><strong>核心作用：自定义应用设置</strong></p>
<p>Spring Boot 应用启动时，许多设置（如服务器端口）都有默认值。如果想修改这些默认设置，就需要使用配置文件。</p>
<p><strong>举个例子</strong>：默认的服务器端口是 <code>8080</code>，访问地址是 <code>http://localhost:8080/books/1</code>。如果想把端口改成更常见的 <code>80</code>（HTTP默认端口，访问时可省略），使得访问地址变为 <code>http://localhost/books/1</code>，就需要通过配置文件来实现。</p>
<p>Spring Boot 支持三种主流的配置文件格式，它们功能相同，只是语法不同。</p>





























<table><thead><tr><th align="left">格式</th><th align="left">文件后缀</th><th align="left">语法特点</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><strong><code>.properties</code></strong></td><td align="left"><code>application.properties</code></td><td align="left">键值对，使用等号（<code>=</code>）连接。最传统，但层次结构不直观。</td><td align="left"><code>server.port=80</code></td></tr><tr><td align="left"><strong><code>.yml</code></strong></td><td align="left"><code>application.yml</code></td><td align="left">树状结构，使用冒号（<code>:</code>）和缩进来表示层级。<strong>结构清晰，推荐使用。</strong></td><td align="left"><code>yaml server: port: 81 </code></td></tr><tr><td align="left"><strong><code>.yaml</code></strong></td><td align="left"><code>application.yaml</code></td><td align="left">与 <code>.yml</code> 完全相同，只是后缀名不同。</td><td align="left">同 <code>.yml</code></td></tr></tbody></table>
<blockquote>
<p><strong>关键规则</strong>：Spring Boot 配置文件的<strong>主文件名必须是 <code>application</code></strong>，只有后缀名可以变化。</p>
</blockquote>
<h4 data-id="heading-21">环境准备</h4>
<p>创建一个新的 Spring Boot 项目（例如命名为 <code>springboot_02_base_config</code>）用来演示不同的配置文件，并创建一个简单的 <code>BookController</code> 控制器，用于后续测试配置是否生效。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703faaac4a1e4112bbd1a7087301b177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=E2ZlURSxwOseVRJHUxNfegddV%2Fw%3D" alt="image.png" width="50%" loading="lazy"/>
<p>在该工程中的 <code>com.itheima.controller</code> 包下创建一个名为 <code>BookController</code> 的控制器。内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>{
        System.out.println(<span class="hljs-string">"id ==&gt; "</span>+id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello , spring boot!"</span>;
    }
}
</code></pre>
<h4 data-id="heading-22">三种配置文件演示</h4>
<p><strong>1. 使用 <code>application.properties</code></strong><br/>
在 <code>src/main/resources/</code> 目录下找到或创建 <code>application.properties</code> 文件，添加一行配置：</p>
<pre><code class="hljs language-properties" lang="properties">server.port=80
</code></pre>
<p>启动应用，观察控制台日志，若看到 ↓，说明配置生效。\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44a2d3f86cd455cbd3d84a50a575123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=eZDab%2BgktXES8NA3SzmQ0jEMI0s%3D" alt="image.png" width="50%" loading="lazy"/></p>
<p><strong>2. 使用 <code>application.yml</code> (推荐)</strong><br/>
在相同目录中创建 <code>application.yml</code> 文件，将 <code>.properties</code> 文件中的所有配置项，转换为 YAML 语法后，完整写入 <code>.yml</code> 文件。再将原来的 <code>application.properties</code> 文件<strong>删除</strong>，或者将其<strong>重命名</strong>（例如改为 <code>application.properties.bak</code> 作为备份）。<code>.yml</code> 文件端口配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
</code></pre>
<p>启动应用，端口应变为 <code>81</code>。</p>
<blockquote>
<p><strong>YAML语法注意</strong>：</p>
<ol>
<li><strong>缩进</strong>：<strong>必须使用空格（通常2个）进行缩进</strong>，<strong>不能使用Tab键</strong>。同一层级的元素必须左对齐。</li>
<li><strong>冒号</strong>：每个键的后面<strong>必须紧跟一个英文冒号和一个空格</strong>，然后才是值。
<ul>
<li>✅ 正确：<code>port: 80</code></li>
<li>❌ 错误：<code>port:80</code>（缺少空格）或 <code>port: 80</code>（冒号错误）</li>
</ul>
</li>
</ol>
</blockquote>
<p><strong>3. 使用 <code>application.yaml</code></strong><br/>
操作与 <code>.yml</code> 完全一样，只是文件后缀名不同。<code>application.yaml</code>内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">82</span>
</code></pre>
<p>启动应用，端口应变为 <code>82</code>。</p>
<p><strong>提示功能</strong></p>
<p>三种配置文件都有提示功能，在 <code>.yml</code> 配置文件中，我们也可以在该文件中书写 <code>port</code> ，然后 IDEA 就会提示并书写成YAML格式：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b556338e8ee84811b3bc68fcbeda6de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=1QRgkXHwbfRD6QCOtBzDWzz93%2FI%3D" alt="image.png" width="60%" loading="lazy"/></p>
<h4 data-id="heading-23">配置文件的优先级</h4>
<p>如果三种格式的配置文件<strong>同时存在</strong>，且配置了同一个属性（如端口），Spring Boot 会按以下<strong>优先级</strong>决定使用哪一个：
<strong><code>application.properties</code> &gt; <code>application.yml</code> &gt; <code>application.yaml</code></strong></p>
<p><strong>高优先级的配置会覆盖低优先级的相同配置</strong>。在项目中，通常建议只使用一种格式（推荐 <code>.yml</code>），以避免混淆。</p>
<h3 data-id="heading-24">YAML 格式</h3>
<p><strong>YAML</strong> (YAML Ain‘t Markup Language) 是一种专门用来<strong>编写配置文件</strong>的数据序列化格式。近年来，它凭借清晰的层次结构，在 Spring Boot 等现代框架中已成为主导的配置格式。</p>
<p>与之前的配置格式相比，YAML 的优势非常明显。我们可以通过一个公司信息的例子来直观对比：</p>

























<table><thead><tr><th align="left">格式</th><th align="left">示例</th><th align="left">特点分析</th></tr></thead><tbody><tr><td align="left"><strong>XML</strong> (早期)</td><td align="left"><code>&lt;enterprise&gt;</code><br/>    <code>&lt;name&gt;itcast&lt;/name&gt;</code> <br/>     <code>&lt;age&gt;16&lt;/age&gt;</code> <br/>     <code>&lt;tel&gt;4006184000&lt;/tel&gt;</code> <br/> <code>&lt;/enterprise&gt;</code></td><td align="left"><strong>注重格式</strong>：标签嵌套，结构严谨但冗余，可读性一般，数据被标签“包裹”。</td></tr><tr><td align="left"><strong>Properties</strong></td><td align="left"><code>enterprise.name=itcast</code><br/><code>enterprise.age=16</code><br/><code>enterprise.tel=4006184000</code></td><td align="left"><strong>平铺直叙</strong>：使用“点”分隔层级，结构简单但层级深时难以阅读。</td></tr><tr><td align="left"><strong>YAML</strong> (主流)</td><td align="left"><code>enterprise:</code><br/>    <code>name: itcast</code><br/>    <code>age: 16</code><br/>    <code>tel: 4006184000</code></td><td align="left"><strong>注重数据</strong>：<strong>树状缩进</strong>，层级一目了然，去除了不必要的符号，<strong>最易阅读和维护</strong>。</td></tr></tbody></table>
<p><strong>文件扩展名</strong>：<code>.yml</code>（最常用） 或 <code>.yaml</code>，两者完全等效。</p>
<h4 data-id="heading-25">语法规则</h4>
<ul>
<li>大小写敏感</li>
<li>属性层级关系使用多行描述，每行结尾使用冒号结束</li>
<li>使用缩进表示层级关系，同层级左侧对齐，只允许使用空格（不允许使用Tab键）<br/>
空格的个数并不重要，只要保证同层级的左侧对齐即可。</li>
<li>属性值前面添加空格（属性名与属性值之间使用<code>冒号+空格</code>作为分隔）</li>
<li><code>#</code> 表示注释，其后的内容会被忽略。</li>
</ul>

<ul>
<li><strong>数组（List）的表示</strong><br/>
在属性下方，使用 <strong><code>-</code> 减号</strong>（后面跟一个空格）来表示数组中的一个元素。
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">enterprise:</span>
  <span class="hljs-attr">subject:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Java</span>       <span class="hljs-comment"># 数组第一项</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">前端</span>        <span class="hljs-comment"># 数组第二项</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">大数据</span>      <span class="hljs-comment"># 数组第三项</span>
<span class="hljs-comment"># 这等价于Java中的：List&lt;String&gt; subject = Arrays.asList("Java", "前端", "大数据");</span>

<span class="hljs-comment"># 部门信息 (对象数组)</span>
<span class="hljs-attr">departments:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">研发部</span>
  <span class="hljs-attr">manager:</span> <span class="hljs-string">张三</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">市场部</span>
  <span class="hljs-attr">manager:</span> <span class="hljs-string">李四</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-26">YAML 配置文件数据读取</h3>
<p>这一节我们将学习三种从 <code>application.yml</code> 配置文件中读取数据的方法，这是将静态配置转化为程序中可用变量的关键步骤。</p>
<p>下面我们开始具体的环境准备和三种方式的详解。</p>
<h4 data-id="heading-27">环境准备</h4>
<p>新创建一个名为 <code>springboot_03_read_data</code> 的 <code>SpringBoot</code> 工程，目录结构如下：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/075f2fec49b34878acba59af8462f093~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=p7YjAaevELZaugiIWmC2Qmee%2BvA%3D" alt="image.png" width="50%" loading="lazy"/>
<p>在 <code>com.itheima.controller</code> 包写创建名为 <code>BookController</code> 的控制器，内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>{
        System.out.println(<span class="hljs-string">"id ==&gt; "</span>+id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello , spring boot!"</span>;
    }
}
</code></pre>
<p>在 <code>com.itheima.domain</code> 包下创建一个名为 <code>Enterprise</code> 的实体类等会用来封装数据，内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Enterprise</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">private</span> String tel;
    <span class="hljs-keyword">private</span> String[] subject;
    
    <span class="hljs-comment">//setter and getter</span>
    
    <span class="hljs-comment">//toString</span>
}
</code></pre>
<p>在 <code>resources</code> 下创建一个名为 <code>application.yml</code> 的配置文件，里面配置了不同的数据，内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">lesson:</span> <span class="hljs-string">SpringBoot</span>

<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>

<span class="hljs-attr">enterprise:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">itcast</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">16</span>
  <span class="hljs-attr">tel:</span> <span class="hljs-number">4006184000</span>
  <span class="hljs-attr">subject:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Java</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">前端</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">大数据</span>
</code></pre>
<h4 data-id="heading-28">三种读取配置数据的方式</h4>
<h5 data-id="heading-29"><code>@Value</code> 注解（读取单个值）</h5>
<p>这种方式简单直接，适合读取少量、零散的配置值。</p>
<p><strong>工作原理</strong>：在字段上使用 <code>${一级属性名.二级属性名……}</code>，Spring 会自动将对应的配置值注入到字段中。</p>
<p><strong>在 <code>BookController</code> 中的使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 1. 读取简单值 (lesson: SpringBoot)</span>
    <span class="hljs-meta">@Value("${lesson}")</span>
    <span class="hljs-keyword">private</span> String lesson;

    <span class="hljs-comment">// 2. 读取嵌套值 (server.port)</span>
    <span class="hljs-meta">@Value("${server.port}")</span>
    <span class="hljs-keyword">private</span> Integer port;

    <span class="hljs-comment">// 3. 读取数组中的第一个元素 (enterprise.subject[0])</span>
    <span class="hljs-meta">@Value("${enterprise.subject[0]}")</span>
    <span class="hljs-keyword">private</span> String subject_00;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        System.out.println(lesson);
        System.out.println(port);
        System.out.println(subject_00);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<h5 data-id="heading-30">注入 <code>Environment</code> 对象（动态读取）</h5>
<p>这种方式将<strong>所有配置</strong>都加载到一个 <code>Environment</code> 对象中，可以动态地根据键名获取值。</p>
<p><strong>在 <code>BookController</code> 中的使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 自动注入Environment对象</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Environment env;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 通过 getProperty 方法根据键名获取值</span>
        System.out.println(env.getProperty(<span class="hljs-string">"lesson"</span>));
        System.out.println(env.getProperty(<span class="hljs-string">"enterprise.name"</span>));
        System.out.println(env.getProperty(<span class="hljs-string">"enterprise.subject[0]"</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>缺点</strong>：</p>
<ol>
<li><strong>类型不安全</strong>：<code>getProperty</code> 返回的是 <code>String</code>，需要自己转换类型。</li>
<li><strong>键名拼写易错</strong>：配置键名以字符串形式书写，没有IDE的检查和提示，容易出错。
因此，在需要读取大量配置的常规业务开发中<strong>很少直接使用</strong>。</li>
</ol>
<h5 data-id="heading-31">自定义对象（用于正式项目）</h5>
<p>这是最规范、最面向对象的方式，尤其适用于<strong>将一组逻辑相关的配置（如<code>enterprise</code>下的所有属性）一次性加载到一个自定义的JavaBean中</strong>。</p>
<p><strong>第一步：改造实体类 <code>Enterprise</code></strong><br/>
在 <code>com.itheima.domain</code> 包下的 <code>Enterprise</code> 类上添加关键注解：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 1. 将此类的对象交给Spring容器管理</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "enterprise")</span> <span class="hljs-comment">// 2. 指定要绑定配置的前缀</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Enterprise</span> {
    <span class="hljs-comment">// 3. 字段名必须与配置文件中 ‘prefix.’ 后面的部分严格对应</span>
    <span class="hljs-comment">// 例如 ‘enterprise.name’ 对应字段 ‘name’</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">private</span> String tel;
    <span class="hljs-keyword">private</span> String[] subject;

    <span class="hljs-comment">// 4. 必须为每一个字段提供其getter和setter方法，否则Spring无法注入值</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> name; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> { <span class="hljs-built_in">this</span>.name = name; }
    <span class="hljs-comment">// ... 其他字段的getter/setter</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Enterprise{"</span> +
                <span class="hljs-string">"name='"</span> + name + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", age="</span> + age +
                <span class="hljs-string">", tel='"</span> + tel + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", subject="</span> + Arrays.toString(subject) +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p><strong>第二步：在 <code>BookController</code> 中注入使用</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 像注入普通Bean一样注入配置绑定好的Enterprise对象</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Enterprise enterprise;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 直接使用对象的getter方法获取配置值，类型安全，有代码提示</span>
        System.out.println(enterprise.getName());
        System.out.println(enterprise.getAge());
        System.out.println(enterprise.getSubject());
        System.out.println(enterprise.getTel());
        System.out.println(enterprise.getSubject()[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>注意</strong>：消除 <code>@ConfigurationProperties</code> 的IDEA警告<br/>
在类上添加 <code>@ConfigurationProperties</code> 注解后，IDEA可能会显示一个警告（如黄色波浪线）。这个警告的意思是：<strong>“我（IDEA）不知道你配置了哪些属性，所以无法为你提供属性名的代码提示和拼写检查。”</strong></p>
<p><strong>解决方案</strong>：在 <code>pom.xml</code> 中添加一个<strong>编译期注解处理器</strong>依赖。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span> <span class="hljs-comment">&lt;!-- 注意：optional=true 表示此依赖不会传递到其他模块 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-32">多环境配置</h3>
<p>在实际开发中，应用通常需要在<strong>开发（dev）</strong>、<strong>测试（test）</strong>、<strong>生产（pro）</strong> 等不同环境中运行。每个环境的配置（如数据库地址、日志级别、服务器端口）往往不同。频繁手动修改配置文件不仅麻烦，而且容易出错。\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8634f9db0a374492b2cf4224a8dd53d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=VyYScRFSjdxJAKvKSOAvHbjOjbI%3D" alt="image.png" width="60%" loading="lazy"/></p>
<p>Spring Boot 提供了强大的多环境配置支持，让你能轻松地在不同环境间切换。主要有以下三种方式：</p>
<h4 data-id="heading-33">YAML 文件配置（推荐）</h4>
<p>YAML 文件支持在<strong>单个文件</strong>内使用 <code>---</code> 分隔符定义多个环境配置，结构非常清晰。</p>
<p><strong>基本语法与示例</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 第一部分：设置默认激活的环境 (必须放在最前面)</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 这里设置默认激活的是dev环境</span>

<span class="hljs-comment"># 用三个减号(---)进行分隔</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第二部分：开发环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 为此段配置命名为 ‘dev’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/dev-api</span>  <span class="hljs-comment"># 为所有请求路径添加统一前缀，便于区分是什么环境中的接口</span>
<span class="hljs-attr">logging:</span>        <span class="hljs-comment"># logging.level根据不同环境设置不同的日志级别</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">debug</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第三部分：测试环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">test</span> <span class="hljs-comment"># 为此段配置命名为 ‘test’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">info</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第四部分：生产环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">pro</span> <span class="hljs-comment"># 为此段配置命名为 ‘pro’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">82</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">warn</span>
</code></pre>
<p><strong>关键点说明</strong></p>
<ol>
<li><strong>激活环境</strong>：通过 <code>spring.config.activate.on-profile</code> 属性设置在文件顶部，决定应用启动时默认使用哪一段配置。</li>
<li><strong>分隔符</strong>：<code>---</code> 是YAML中定义文档段落的标记，Spring Boot用它来区分不同环境的配置。</li>
<li><strong>环境命名</strong>：
<ul>
<li><strong>新方式（推荐）</strong>：使用 <code>spring.config.activate.on-profile</code> 为配置段命名（如 <code>dev</code>, <code>test</code>）。</li>
<li><strong>旧方式（已过时）</strong>：<code>spring.profiles</code> 属性，新项目不建议再使用。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-34">Properties 文件配置</h4>
<p>Properties 格式通过<strong>创建多个文件</strong>来管理多环境配置，这是另一种常见的做法。</p>
<p><strong>文件命名规则与结构</strong><br/>
你需要创建一系列遵循特定命名规则的文件：</p>
<ul>
<li><code>application.properties</code>：<strong>主配置文件</strong>，用于设置激活哪个环境。</li>
<li><code>application-{profile}.properties</code>：<strong>环境专属配置文件</strong>，<code>{profile}</code> 替换为环境名（如 <code>dev</code>, <code>test</code>, <code>pro</code>）。</li>
</ul>
<p><strong>配置示例</strong><br/>
<strong>1. 主配置文件 (<code>application.properties</code>)</strong>：<br/>
在此文件中指定激活的环境配置</p>
<pre><code class="hljs language-properties" lang="properties"># 例如激活生产环境pro
spring.profiles.active=pro
</code></pre>
<p><strong>2. 环境专属配置文件</strong>：</p>
<ul>
<li><code>application-dev.properties</code> (开发环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=8080  # 这里配置端口号为 8080
</code></pre>
</li>
<li><code>application-test.properties</code> (测试环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=8081
</code></pre>
</li>
<li><code>application-pro.properties</code> (生产环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=80
</code></pre>
</li>
</ul>
<p>启动应用时，Spring Boot 会加载 <code>application.properties</code> 中 <code>spring.profiles.active</code> 指定的环境对应文件（此例为 <code>application-pro.properties</code>），并将其中配置与主文件合并。</p>
<h4 data-id="heading-35">命令行参数设置（最灵活）</h4>
<p>当<code>SpringBoot</code> 开发的程序打包成 <strong>JAR 文件</strong>后，仍然可以在启动时通过命令行参数<strong>临时覆盖或指定</strong>配置，而无需修改打包在 JAR 内的配置文件。</p>
<p><strong>常用命令示例</strong></p>
<ol>
<li>
<p><strong>激活指定环境</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --spring.profiles.active=<span class="hljs-built_in">test</span>
</code></pre>
<p>这会让应用使用 <code>test</code> 环境的配置，无论打包时默认设置的是什么。</p>
</li>
<li>
<p><strong>临时修改特定配置项</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --server.port=8888
</code></pre>
<p>这会临时将服务器端口改为 8888。</p>
</li>
<li>
<p><strong>组合使用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --spring.profiles.active=pro --server.port=443 --logging.level.root=error
</code></pre>
<p>可以同时指定环境、修改端口和日志级别等多个参数。</p>
</li>
</ol>
<h4 data-id="heading-36">配置优先级与实践建议</h4>
<p>当同一个配置项通过多种方式（默认配置、环境配置、命令行等）被设置时，Spring Boot 遵循一个明确的<strong>优先级顺序</strong>，优先级高的会覆盖优先级低的。</p>
<p>配置的优先级在 <code>SpringBoot</code> 官网已经进行了说明，参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-boot%2Fdocs%2Fcurrent%2Freference%2Fhtml%2Fspring-boot-features.html%23boot-features-external-config" target="_blank" title="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config" ref="nofollow noopener noreferrer">Externalized Configuration</a>，进入上面网站后会看到如下页面：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3010462781d45cc8e1c4325b7ba7ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=JSz5WvV%2FolDItgEfPocjrYjhEqQ%3D" alt="image.png" width="100%" loading="lazy"/></p>
<p><strong>对比建议</strong></p>





























<table><thead><tr><th align="left">配置方式</th><th align="left">适用场景</th><th align="left">优点</th><th align="left">缺点</th></tr></thead><tbody><tr><td align="left"><strong>YAML 多文档</strong></td><td align="left">配置相对简单，且希望集中管理。</td><td align="left">结构清晰，所有配置在一个文件中。</td><td align="left">环境很多时文件会变得冗长。</td></tr><tr><td align="left"><strong>Properties 多文件</strong></td><td align="left">不同环境配置差异很大，或团队习惯文件分离。</td><td align="left">环境间隔离性好，便于按需打包。</td><td align="left">文件数量较多。</td></tr><tr><td align="left"><strong>命令行参数</strong></td><td align="left"><strong>生产部署、紧急调试、临时测试</strong>。</td><td align="left">优先级最高，最灵活，无需改动文件。</td><td align="left">不适合作为常规配置方式。</td></tr></tbody></table>
<ol>
<li><strong>开发阶段</strong>：在 <code>application.yml</code> 中使用多文档块，将 <code>dev</code> 设为默认环境，方便本地开发。</li>
<li><strong>打包阶段</strong>：在 <code>application.properties</code> 中通过 <code>spring.profiles.active=pro</code> 设置好生产环境为默认，避免打包后忘记切换。</li>
<li><strong>部署与运维阶段</strong>：掌握命令行参数覆盖技巧，以便在服务器上灵活调整配置。这是成为一名合格后端开发者的必备技能。</li>
</ol>
<h3 data-id="heading-37">配置文件分类与优先级</h3>
<p>想象一个场景：应用开发完成后，测试人员需要进行测试。由于测试环境和开发环境的配置（如数据库地址、服务端口等）通常不同，测试人员可能需要通过如下一长串复杂的命令行参数来启动应用，非常不便：</p>
<pre><code class="hljs language-bash" lang="bash">java –jar springboot.jar –-spring.profiles.active=<span class="hljs-built_in">test</span> --server.port=85 --server.servlet.context-path=/heima ……（更多参数）
</code></pre>
<p>为了解决这个问题，并让应用能灵活适应不同部署环境，Spring Boot 设计了一套<strong>配置文件放置位置的规则</strong>。应用会从多个预定位置加载 <code>application.yml</code> 或 <code>application.properties</code> 文件，并且 <strong>“位置”本身决定了配置的优先级</strong>。</p>
<h4 data-id="heading-38">优先级规则</h4>
<p>Spring Boot 支持从4个标准位置加载配置文件，其<strong>优先级由高到低</strong>如下：</p>
<ol>
<li>项目<strong>外部</strong>的 <code>/config</code> 目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>file:./config/</code></li>
<li><strong>含义</strong>：与最终打包的 <strong>JAR包（或WAR包）在同一目录</strong>下，且位于 <code>config</code> 子文件夹内的配置文件。</li>
</ul>
<ol start="2">
<li>项目<strong>外部</strong>的根目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>file:./</code></li>
<li><strong>含义</strong>：与最终打包的 <strong>JAR包（或WAR包）在同一目录</strong>下的配置文件。</li>
</ul>
<ol start="3">
<li>项目<strong>内部</strong>的 <code>/config</code> 目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>classpath:/config/</code></li>
<li><strong>含义</strong>：打包在 <strong>JAR/WAR包内部</strong>，位于类路径 <code>config</code> 目录下的配置文件。在开发项目中，对应 <code>src/main/resources/config/</code> 目录。</li>
</ul>
<ol start="4">
<li>项目<strong>内部</strong>的类路径根目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>classpath:/</code></li>
<li><strong>含义</strong>：打包在 <strong>JAR/WAR包内部</strong>，位于类路径根目录下的配置文件。在开发项目中，对应 <code>src/main/resources/</code> 目录。</li>
</ul>
<p><strong>核心规则</strong></p>
<ul>
<li>文件系统中JAR包外部的配置，优先级<strong>高于</strong>打包在JAR包内部的配置。</li>
<li>无论在外部还是内部，位于 <code>config</code> 子目录下的配置，优先级<strong>高于</strong>直接放在根目录下的配置。</li>
<li><strong>覆盖原则</strong>：高优先级配置文件中的属性会<strong>覆盖</strong>低优先级配置文件中定义的<strong>相同属性</strong>。</li>
</ul>
<h4 data-id="heading-39">环境准备</h4>
<p>下面我们通过实验来验证上述优先级规则。</p>
<p>创建一个名为 <code>springboot_06_config_file</code> 的 <code>SpringBoot</code> 工程，目录结构如下:\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78d928af549a48e08001654bf83462bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=HQ0nVlSi%2ByHga770Aavzhb%2FEJQg%3D" alt="image.png" width="50%" loading="lazy"/></p>
<p>在 <code>resources</code> 下创建一个名为 <code>config</code> 的目录，在该目录中创建 <code>application.yml</code> 配置文件，而在该配置文件中将端口号设置为 <code>81</code>，内容如下:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># resources/config/application.yml，第3级，类路径下的config目录</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
</code></pre>
<p>在 <code>resources</code> 下创建的 <code>application.yml</code> 配置文件中并将端口号设置为 <code>80</code>，内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># resources/application.yml，第4级，类路径根目录</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
</code></pre>
<h4 data-id="heading-40">验证优先级</h4>
<p><strong>验证第3级与第4级的优先级</strong></p>
<p>运行启动引导类，观察控制台日志。你会发现应用使用的端口是 <strong><code>81</code></strong>。</p>
<p><strong>结论</strong>：位于 <code>classpath:/config/</code>（第3级）的配置文件，其优先级<strong>高于</strong> <code>classpath:/</code>（第4级）的配置文件。所以 <code>81</code> 覆盖了 <code>80</code>。</p>
<p><strong>验证第1级与第3级的优先级</strong></p>
<p>接下来，我们创建一个更高优先级（第1级）的配置来覆盖之前的设置。</p>
<ol>
<li><strong>打包应用</strong>：在IDEA的Maven工具窗口中，双击 <code>Lifecycle</code> 下的 <code>package</code>，将工程打成 <code>jar</code> 包。</li>
<li><strong>定位JAR包</strong>：在项目 <code>target</code> 目录下找到生成的 <code>springboot_06_config_file-0.0.1-SNAPSHOT.jar</code> 文件。</li>
<li><strong>创建外部配置文件</strong>：
<ol>
<li>在 <strong><code>jar</code>包所在的同级目录</strong>下，创建一个名为 <code>config</code> 的文件夹。</li>
<li>在该 <code>config</code> 文件夹内，创建一个 <code>application.yml</code> 文件，并设置端口：</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
<span class="hljs-attr">port:</span> <span class="hljs-number">82</span>   <span class="hljs-comment"># 端口设置为82</span>
</code></pre>
</li>
<li><strong>通过命令行启动</strong>：打开命令行，进入JAR包所在目录，执行：
<pre><code class="hljs language-bash" lang="bash">java -jar springboot_06_config_file-0.0.1-SNAPSHOT.jar
</code></pre>
</li>
</ol>
<p>观察控制台日志，应用使用的端口是 <strong><code>82</code></strong>。</p>
<p><strong>结论</strong>：位于 <code>file:./config/</code>（第1级，JAR包外部的config目录）的配置文件，其优先级<strong>最高</strong>，覆盖了所有内部配置。</p>
<blockquote>
<p>注意：<br/>
<strong>配置文件加载是叠加的</strong>：Spring Boot 会从<strong>所有这4个位置</strong>加载配置文件，并将它们合并。高优先级位置的配置值会覆盖低优先级位置的<strong>相同属性</strong>，而不同属性则会<strong>累积生效</strong>。</p>
</blockquote>
<h4 data-id="heading-41">实际应用意义</h4>
<p>理解配置文件的优先级，在项目部署和运维中至关重要：</p>

























<table><thead><tr><th align="left">场景</th><th align="left">操作与好处</th></tr></thead><tbody><tr><td align="left"><strong>开发阶段</strong></td><td align="left">使用 <code>resources/application.yml</code> （第4级），配置个人开发环境。</td></tr><tr><td align="left"><strong>团队测试</strong></td><td align="left">测试人员可以在JAR包外的 <code>config/application.yml</code> （第1级）放置测试数据库等配置，<strong>无需修改或重新打包项目</strong>。</td></tr><tr><td align="left"><strong>生产部署</strong></td><td align="left">运维人员将包含数据库密码等敏感信息的生产配置放在服务器上JAR包外部的 <code>config</code> 目录下，实现<strong>代码与敏感配置分离</strong>，更安全。</td></tr><tr><td align="left"><strong>临时调试</strong></td><td align="left">在JAR包同级目录（第2级）放一个简易配置，可快速覆盖某个属性进行调试。</td></tr></tbody></table>
<h2 data-id="heading-42">SpringBoot 整合 JUnit</h2>
<p>单元测试是保证代码质量的重要环节。相较于传统的 Spring 项目，SpringBoot 整合测试框架变得特别简单。</p>
<h3 data-id="heading-43">环境准备</h3>
<ol>
<li>
<p>创建一个名为 <code>springboot_07_test</code> 的 <code>SpringBoot</code> 工程，工程目录结构如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00e0106c039f401cb7ad4c57cde4ad05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=SS3E9mI3lb1vB3auCOPdSb9ink0%3D" alt="image.png" width="50%" loading="lazy"/></p>
</li>
<li>
<p>创建业务层接口与实现类，这是待测试的目标。</p>
</li>
</ol>
<ul>
<li><strong>接口 (<code>BookService</code>)</strong>: 在 <code>com.itheima.service</code> 包下。
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 业务接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BookService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;
}
</code></pre>
</li>
<li><strong>实现类 (<code>BookServiceImpl</code>)</strong>: 在 <code>com.itheima.service.impl</code> 包下。<strong><code>@Service</code></strong> 注解将其声明为Spring容器管理的Bean。
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span> <span class="hljs-comment">// 关键：这个注解将该实现类注册为Spring的Bean</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book service is running ..."</span>);
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-44">编写测试类</h3>
<p>在 <code>src/test/java</code> 下的对应包（通常与主代码包名一致，例如 <code>com.itheima</code>）中创建测试类，并将 <code>BookService</code> 注入到该测试类中。</p>
<p><strong>核心步骤</strong>：</p>
<ol>
<li><strong>添加测试注解</strong>：在类上标注 <code>@SpringBootTest</code>。这个注解是测试的基石，它会启动一个为测试准备的Spring应用上下文。</li>
<li><strong>注入测试对象</strong>：使用 <code>@Autowired</code> 像在普通Spring Bean中一样，注入要测试的Service。</li>
<li><strong>编写测试方法</strong>：在方法上使用JUnit的 <code>@Test</code> 注解。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 标记此类为SpringBoot测试类，运行测试时会加载完整的应用上下文</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot07TestApplicationTests</span> {

    <span class="hljs-comment">// 2. 自动注入要测试的业务组件</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BookService bookService;

    <span class="hljs-comment">// 3. 测试方法</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSave</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 调用方法并断言结果</span>
        bookService.save();
        <span class="hljs-comment">// 此处可以添加更多断言，例如：</span>
        <span class="hljs-comment">// assertThat(...).isEqualTo(...);</span>
    }
}
</code></pre>
<p><strong>执行测试</strong><br/>
在IDEA中，你可以直接点击测试方法旁边的绿色箭头运行单个测试，或直接运行整个测试类。执行后控制台将看到：</p>
<ol>
<li>Spring Boot 测试上下文启动。</li>
<li>你的 <code>BookServiceImpl</code> 被成功注入。</li>
<li>控制台输出：<code>book service is running ...</code></li>
<li>测试通过（通常以绿色对勾显示）。</li>
</ol>
<p><strong>最重要的规则：包位置约定</strong></p>
<p><code>@SpringBootTest</code> 注解在<strong>默认情况</strong>下，会从<strong>当前测试类所在的包开始，向上扫描</strong>，寻找主配置类（<code>@SpringBootApplication</code> 标注的类）。</p>
<p><strong>为了保证主配置类能自动找到，请遵循以下约定：</strong></p>
<blockquote>
<p><strong>测试类的逻辑包名（由 <code>package</code> 语句定义），必须是主启动类的逻辑包名的子包或同一个包。</strong><br/>
判断逻辑包名是否匹配，与这个类物理上位于 <code>src/main/java</code> 还是 <code>src/test/java</code> 无关。测试类放在 <code>src/test/java/com/itheima</code>，主启动类在 <code>src/main/java/com/itheima</code>，这是完全正确且能正常运行的，它们在逻辑上属于同一个包 <code>com.itheima</code>。</p>
</blockquote>
<p><strong>不符合约定时如何解决？</strong></p>
<p>如果测试类无法放在约定范围内，必须在 <code>@SpringBootTest</code> 注解中<strong>显式指定主启动类</strong>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 当测试类不在主启动类所在包或其子包下时</span>
<span class="hljs-meta">@SpringBootTest(classes = Springboot07TestApplication.class)</span> <span class="hljs-comment">// 手动指定主启动类的Class对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherPackageTest</span> {
    ......
}
</code></pre>
<p><strong>同时也建议在 <code>@SpringBootTest</code> 注解中，总是通过 <code>classes</code> 属性显式指定主启动类。这是最明确、最可靠的方式。</strong></p>
<h2 data-id="heading-45">SpringBoot 整合 Mybatis</h2>
<h3 data-id="heading-46">回顾传统 Spring 整合 Mybatis 的复杂性</h3>
<p>传统的 Spring 整合 Mybatis 需要编写大量的配置类，步骤繁琐，主要体现在：</p>
<ol>
<li><strong>数据源配置</strong>：需手动读取 <code>jdbc.properties</code> 并创建 <code>DataSource</code> Bean。</li>
<li><strong>Mybatis 集成</strong>：需手动配置 <code>SqlSessionFactoryBean</code> 和 <code>MapperScannerConfigurer</code>。</li>
<li><strong>配置组装</strong>：需通过 <code>@Import</code> 将多个配置类组合。</li>
</ol>
<p>这种方式配置项分散，依赖管理复杂，容易出错。</p>
<h3 data-id="heading-47">SpringBoot 整合 Mybatis（极简步骤）</h3>
<p>SpringBoot 通过 <strong>“起步依赖”</strong> 和 <strong>“自动配置”</strong> 极大简化了整合过程。只需几步：</p>
<ol>
<li>
<p>创建模块并选择依赖<br/>
使用 Spring Initializr 创建模块勾选依赖时，勾选上 <strong><code>SQL</code> -&gt; <code>MyBatis Framework</code></strong> 和 <strong><code>MySQL Driver</code></strong>。IDEA 会自动在 <code>pom.xml</code> 中添加相应依赖。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb72656f9e7e4d2aabe102793ac4aa58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=zL0W40%2BAcFP19WwMywsBe0G3gMc%3D" alt="image.png" width="80%" loading="lazy"/></p>
</li>
<li>
<p>定义实体类 (<code>Book</code>)<br/>
在 <code>com.itheima.domain</code> 包下创建，包含属性及 getter/setter。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String type;
    <span class="hljs-keyword">private</span> String description;
    <span class="hljs-comment">// ... getter, setter, toString</span>
}
</code></pre>
</li>
<li>
<p>定义 Dao 接口 (<code>BookDao</code>)<br/>
在 <code>com.itheima.dao</code> 包下创建。在接口上添加 <strong><code>@Mapper</code></strong> 注解，这样 MyBatis 才会为其创建实现类并交给 Spring 管理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span> <span class="hljs-comment">// 关键注解：标识这是一个 MyBatis 的 Mapper 接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-meta">@Select("select * from tbl_book where id = #{id}")</span> <span class="hljs-comment">// MyBatis 注解，定义 SQL</span>
    <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">getById</span><span class="hljs-params">(Integer id)</span>;
}
</code></pre>
</li>
<li>
<p>定义测试类<br/>
在 <code>src/test/java</code> 的对应包（如 <code>com.itheima</code>）下创建。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot08MybatisApplicationTests</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BookDao bookDao; <span class="hljs-comment">// 直接注入 MyBatis Mapper</span>

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetById</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> bookDao.getById(<span class="hljs-number">1</span>);
        System.out.println(book);
    }
}
</code></pre>
</li>
<li>
<p>编写数据库配置 (<code>application.yml</code>)<br/>
所有配置集中于一个文件，结构清晰。</p>
</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span> <span class="hljs-comment"># 数据库驱动</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span> <span class="hljs-comment"># 数据库连接URL，注意时区参数</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span> <span class="hljs-comment"># 用户名</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span> <span class="hljs-comment"># 密码</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：若使用 <code>SpringBoot</code> 版本低于2.4.3(不含)，Mysql驱动版本高于8.0时，，<strong>必须在 <code>url</code> 中配置时区</strong>，如 <code>serverTimezone=UTC</code> 或 <code>Asia/Shanghai</code>，否则可能连接失败。</p>
</blockquote>
<ol start="7">
<li>切换为 Druid 数据源（可选）<br/>
SpringBoot 默认使用 HikariCP 数据源，如需换为阿里 Druid：
<ol>
<li>添加 Druid 依赖 (<code>pom.xml</code>)：</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ol start="2">
<li>修改配置文件 (<code>application.yml</code>)，通过 <code>type</code> 指定数据源类型：</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span> <span class="hljs-comment"># 关键：指定使用 Druid 数据源</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-48">综合案例：将传统 SSM 项目迁移至 SpringBoot</h2>
<p>这个案例旨在将你之前用 Spring + SpringMVC + MyBatis (SSM) 完成的整合项目，改造成 SpringBoot 项目。</p>
<p>改造的核心是 <strong>“做减法”</strong>：移除 XML 和 Java 配置类，利用 SpringBoot 的自动配置和起步依赖。下图清晰地展示了从传统 SSM 迁移到 SpringBoot 的核心变化与操作流程：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/410a1b00a9aa4e1589908cc735778c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=40ehmKySkh9iKDcp%2BPlXzDs0agE%3D" alt="deepseek_mermaid_20260201_a514c0.png" width="100%" loading="lazy"/></p>
<h3 data-id="heading-49">创建 SpringBoot 工程</h3>
<ol>
<li>使用 Spring Initializr 创建新模块，命名为 <code>springboot_09_ssm</code>。</li>
<li><strong>关键步骤</strong>：在选择依赖时，必须勾选：
<ul>
<li><strong><code>Spring Web</code></strong> (提供Web能力)</li>
<li><strong><code>MyBatis Framework</code></strong> (整合MyBatis)</li>
<li><strong><code>MySQL Driver</code></strong> (连接MySQL)</li>
</ul>
</li>
<li>由于案例使用 Druid 数据源，还需在创建后，手动在 <code>pom.xml</code> 中添加其依赖坐标。
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-50">代码迁移与改造</h3>
<p>将原有 SSM 项目 (<code>springmvc_11_page</code>) 中的业务代码直接拷贝到新工程的对应包下。这是迁移中<strong>最大的一块工作，但主要是复制粘贴</strong>。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f64ffc4f310c43feb6c7f388a3250a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=VsZGSwZ6OCsgtkLjAki7S7Ke4%2BM%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>需要进行的改造非常有限，只有以下三点：</strong></p>
<ul>
<li>删除<code>config</code> 包及包内所有配置类（<code>/config</code> 目录），SpringBoot 的自动配置已经替代了这些手动配置。</li>
<li><code>dao</code> 包下的接口拷贝到 <code>springboot_09-ssm</code> 工程中后，在每一个接口定义上方添加 <code>@Mapper</code> 注解
<blockquote>
<p><strong>替代方案</strong>：如果Dao接口很多，不想每个都加，可以在<strong>主启动类</strong>上添加 <code>@MapperScan(“com.itheima.dao”)</code> 注解，一次性扫描整个包。但在此案例中为求清晰，推荐使用 <code>@Mapper</code>。</p>
</blockquote>
</li>
<li><code>BookServiceTest</code> 测试需要改成 <code>SpringBoot</code> 整合 <code>junit</code> 的形式。</li>
</ul>
<h3 data-id="heading-51">编写配置文件 (<code>application.yml</code>)</h3>
<p>在 <code>application.yml</code> 配置文件中需要配置如下内容</p>
<ul>
<li>服务的端口号</li>
<li>连接数据库的信息</li>
<li>数据源</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 服务器配置</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>  <span class="hljs-comment"># 将端口改为80，访问时可省略端口号</span>

<span class="hljs-comment"># Spring相关配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-comment"># 1. 指定使用 Druid 数据源</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
    <span class="hljs-comment"># 2. 数据库驱动 (MySQL 8.0+ 使用 `cj.jdbc.Driver`)</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-comment"># 3. 数据库连接URL，注意时区参数</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=Asia/Shanghai</span>
    <span class="hljs-comment"># 4. 用户名和密码</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
</code></pre>
<p><strong>说明</strong>：</p>
<ul>
<li><code>type</code>：指定数据源类型。如果不指定，SpringBoot 默认使用高性能的 <code>HikariDataSource</code>。</li>
<li><code>serverTimezone</code>：连接 MySQL 8.0 或更高版本时，<strong>强烈建议在URL中设置时区</strong>，如 <code>Asia/Shanghai</code> 或 <code>UTC</code>，否则可能因时区不一致导致连接失败或时间错误。</li>
</ul>
<h3 data-id="heading-52">处理静态资源（页面、图片、CSS/JS）</h3>
<p>这是与SSM项目<strong>结构上差异最大</strong>的地方。</p>
<ul>
<li><strong>SSM 惯例</strong>：静态资源放在 <code>webapp</code> 目录下（如 <code>webapp/pages/</code>）。</li>
<li><strong>SpringBoot 惯例</strong>：<strong>没有 <code>webapp</code> 目录</strong>。静态资源需要放在 <code>src/main/resources</code> 下的特定子目录中。</li>
</ul>
<p><strong>SpringBoot 寻找静态资源的默认路径（优先级从高到低）</strong>：</p>
<ol>
<li><code>classpath:/META-INF/resources/</code></li>
<li><code>classpath:/resources/</code></li>
<li><code>classpath:/static/</code> <strong>（最常用、推荐的位置）</strong></li>
<li><code>classpath:/public/</code></li>
</ol>
<p><strong>操作</strong>：将旧项目 <code>webapp</code> 下的所有内容（如 <code>.html</code>, <code>.css</code>, <code>.js</code>, 图片），<strong>整体拷贝</strong>到新项目的 <code>src/main/resources/static/</code> 目录下即可。</p>
<p>例如，你的 <code>index.html</code> 原来在 <code>webapp/pages/index.html</code>，现在应该放在 <code>src/main/resources/static/pages/index.html</code>。启动应用后，可以直接通过 <code>http://localhost/pages/index.html</code> 访问。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？]]></title>    <link>https://juejin.cn/post/7601757036486180874</link>    <guid>https://juejin.cn/post/7601757036486180874</guid>    <pubDate>2026-02-01T09:22:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036486180874" data-draft-id="7601374668961087538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2026-02-01T09:22:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="javadaydayup"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497635703"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497635703/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    javadaydayup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:22:22.000Z" title="Sun Feb 01 2026 09:22:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题背景</h2>
<p>在微服务的 application.properties 文件中有一个 <code>test.container-name</code> 配置。原始配置如下：</p>
<pre><code class="hljs language-json" lang="json">test.container-name=Tomcat
</code></pre>
<p>同时有一个 Java 类 <code>TestConfigProperty</code> 中通过 <code>@ConfigurationProperties</code> 注解注入这个配置属性到它的变量 <code>containerName</code> 中，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ConfigurationProperties(prefix = "test")</span>  
<span class="hljs-meta">@Component</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestConfigProperty</span> {  
    <span class="hljs-keyword">private</span> String containerName;  
  
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getContainerName</span><span class="hljs-params">()</span> {  
        <span class="hljs-keyword">return</span> containerName;  
    }  
  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContainerName</span><span class="hljs-params">(String containerName)</span> {  
        <span class="hljs-built_in">this</span>.containerName = containerName;  
    }  
}
</code></pre>
<p>现在因为 <code>test.container-name</code> 配置包含敏感信息，不能直接配置原始的值，需要配置加密之后的值，在微服务启动的时候解密。现在是 <code>test.container-name</code> 配置引用了 <code>TEST_CONTAINER_NAME</code> 环境变量。配置如下：</p>
<pre><code class="hljs language-json" lang="json">test.container-name=$<span class="hljs-punctuation">{</span>TEST_CONTAINER_NAME<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后在环境变量中配置了加密之后的值。在本案例中为了简化，这里加密就用的 Base64 编码作为示例演示。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca0f88057f3e4d5eae36f559d6e01316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=gMr0YUyh5qjOQBz3ADuPbKgWnkA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e52a4f158d6a4f6e93734ccf6d542123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=3VNIDUS4SGCIatuyqV5mykvdiuY%3D" alt="image.png" loading="lazy"/></p>
<p>在项目中有框架提供了在微服务启动时对加密后的字符串解密的能力，实现的基本原理是提供了一个 <code>DecryptEnvironmentPostProcessor</code> 类扩展了 <code>EnvironmentPostProcessor</code>。</p>
<p>在它的 <code>postProcessEnvironment()</code> 方法中，判断环境变量配置的值是否是以 <code>ENC_</code> 开头，如果是则进行解密。解密之后放到一个 <code>MapPropertySource</code> 里面，然后添加到所有的 <code>PropertySource</code> 的前面。示例代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecryptEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span>, Ordered {  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DECRYPTED_SOURCE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"decryptedSystemEnvironment"</span>;  
  
    <span class="hljs-meta">@Override</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {  
        <span class="hljs-type">String</span> <span class="hljs-variable">systemEnvName</span> <span class="hljs-operator">=</span> StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME;  
        <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">systemEnvSource</span> <span class="hljs-operator">=</span> (MapPropertySource) environment.getPropertySources().get(systemEnvName);  
        Map&lt;String, Object&gt; decryptedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  
        <span class="hljs-keyword">if</span> (systemEnvSource == <span class="hljs-literal">null</span>) {  
            <span class="hljs-keyword">return</span>;  
        }  
        systemEnvSource.getSource().forEach((key, value) -&gt; {  
            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String strVal) {  
                <span class="hljs-comment">// 这里进行了解密</span>
                <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(strVal) &amp;&amp; strVal.startsWith(<span class="hljs-string">"ENC_"</span>)) {  
                    <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getDecoder().decode(strVal.substring(<span class="hljs-number">4</span>)));  
                    decryptedMap.put(key, plainText);  
                }  
            }  
        });  
  
        <span class="hljs-keyword">if</span> (!decryptedMap.isEmpty()) {  
            <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">decryptedSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(DECRYPTED_SOURCE_NAME, decryptedMap);  
            <span class="hljs-comment">// 这里添加到所有的PropertySource的前面</span>
            environment.getPropertySources().addBefore(systemEnvName, decryptedSource);  
        }  
    }  
  
    <span class="hljs-meta">@Override</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> {  
        <span class="hljs-keyword">return</span> Ordered.LOWEST_PRECEDENCE;  
    }  
}
</code></pre>
<p>按照上述配置，通过调试发现类 <code>TestConfigProperty</code> 里面注入的还是加密之后的值，而并不是想要的解密之后的值。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7febef8cf8d64f9eab907bfc32976d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=3I3BTahEgirLSaZpetbx551a75E%3D" alt="image.png" loading="lazy"/>
查看 <code>Environment</code> 的 <code>getPropertySources()</code> 方法的返回值中，解密之后的环境变量属性配置确实是在未解密的环境变量属性配置之前，按照直观上的理解，那应该注入的是解密之后的值才对，但是实际结果却不是这样的。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/391d4555f2d24e7590c802929faa12a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=v8iGSq8AM1P5eIPa68BSjrhBwuM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">问题原理</h2>
<p>之前的文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1920208706978678739" target="_blank" title="https://zhuanlan.zhihu.com/p/1920208706978678739" ref="nofollow noopener noreferrer">这就是宽松的适配规则！</a>里面讲了宽松适配的原理。在 Spring 的框架体系中是在 <code>ConfigurationPropertiesBindingPostProcessor</code> 中的 <code>postProcessBeforeInitialization()</code> 中实现对有 <code>@ConfigurationProperties</code> 注解修饰类的属性进行绑定的。</p>
<p>在它的内部实际上是通过调用 <code>ConfigurationPropertiesBinder</code> 的 <code>bind()</code> 来实现属性绑定的。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationPropertiesBindingPostProcessor</span>
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span>, PriorityOrdered, ApplicationContextAware, InitializingBean {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
        <span class="hljs-keyword">if</span> (!hasBoundValueObject(beanName)) {
            bind(ConfigurationPropertiesBean.get(<span class="hljs-built_in">this</span>.applicationContext, bean, beanName));
        }
        <span class="hljs-keyword">return</span> bean;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertiesBean bean)</span> {
        <span class="hljs-keyword">if</span> (bean == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        Assert.state(bean.asBindTarget().getBindMethod() != BindMethod.VALUE_OBJECT,
                <span class="hljs-string">"Cannot bind @ConfigurationProperties for bean '"</span> + bean.getName()
                        + <span class="hljs-string">"'. Ensure that @ConstructorBinding has not been applied to regular bean"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 这里实际上是调用了ConfigurationPropertiesBinder的bind()方法</span>
            <span class="hljs-built_in">this</span>.binder.bind(bean);
        }
        <span class="hljs-keyword">catch</span> (Exception ex) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationPropertiesBindException</span>(bean, ex);
        }
    }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30abd11f72ee4451bd3485b0efd1b517~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=zkmWXk%2BIPF0kJ62wXNgIDc7hwEQ%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>ConfigurationPropertiesBinder</code> 的 <code>bind()</code> 方法又调用了 <code>Binder</code> 的 <code>bind()</code> 方法。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96c6b918c1c149d097e70002cd3ce457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=AbRbeZHWRpArvIKHGQC7b%2BvJx2U%3D" alt="image.png" loading="lazy"/></p>
<p>在调用  <code>Binder</code> 的 <code>bind()</code> 方法时，会把注解上配置的前缀传进去，在本案例中就是 <code>test</code>，并基于这个前缀创建一个 <code>ConfigurationPropertyName</code> 对象，然后最终调用到 <code>bindObject()</code> 方法。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Binder</span> {
    <span class="hljs-keyword">public</span> &lt;T&gt; BindResult&lt;T&gt; <span class="hljs-title function_">bind</span><span class="hljs-params">(String name, Bindable&lt;T&gt; target, BindHandler handler)</span> {
        <span class="hljs-comment">// 这里基于test前缀创建了ConfigurationPropertyName对象</span>
        <span class="hljs-keyword">return</span> bind(ConfigurationPropertyName.of(name), target, handler);
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, BindHandler handler, Context context,
        <span class="hljs-type">boolean</span> allowRecursiveBinding, <span class="hljs-type">boolean</span> create)</span> {
        <span class="hljs-keyword">try</span> {
            Bindable&lt;T&gt; replacementTarget = handler.onStart(name, target, context);
            <span class="hljs-keyword">if</span> (replacementTarget == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> handleBindResult(name, target, handler, context, <span class="hljs-literal">null</span>, create);
            }
            target = replacementTarget;
            <span class="hljs-comment">// 调用bindObject()方法</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> bindObject(name, target, handler, context, allowRecursiveBinding);
            <span class="hljs-keyword">return</span> handleBindResult(name, target, handler, context, bound, create);
        }
        <span class="hljs-keyword">catch</span> (Exception ex) {
            <span class="hljs-keyword">return</span> handleBindError(name, target, handler, context, ex);
        }
    }
}
</code></pre>
<p>在  <code>bindObject()</code> 中首先调用 <code>findProperty()</code> 方法查找属性，因为当前只是前缀 <code>test</code>，因此肯定是找不到对应的属性配置的。 因此往下走会调用到 <code>bindDataObject()</code>方法。对于 JavaBean 来说，在 <code>Binder</code> 的 <code>bindDataObject()</code> 方法最终会调用到 <code>JavaBeanBinder</code> 的 <code>bind()</code> 方法。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Binder</span> {
    <span class="hljs-keyword">private</span> &lt;T&gt; Object <span class="hljs-title function_">bindObject</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, BindHandler handler,
	    Context context, <span class="hljs-type">boolean</span> allowRecursiveBinding)</span> {
	    <span class="hljs-type">ConfigurationProperty</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> findProperty(name, target, context);
	    <span class="hljs-keyword">if</span> (property == <span class="hljs-literal">null</span> &amp;&amp; context.depth != <span class="hljs-number">0</span> &amp;&amp; containsNoDescendantOf(context.getSources(), name)) {
	        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	    }
	    <span class="hljs-comment">// 省略中间代码</span>
	    
	    <span class="hljs-comment">//调用bindDataObject()方法</span>
	    <span class="hljs-keyword">return</span> bindDataObject(name, target, handler, context, allowRecursiveBinding);
	}

    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">bindDataObject</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;?&gt; target, BindHandler handler,
            Context context, <span class="hljs-type">boolean</span> allowRecursiveBinding)</span> {
        <span class="hljs-keyword">if</span> (isUnbindableBean(name, target, context)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        Class&lt;?&gt; type = target.getType().resolve(Object.class);
        <span class="hljs-type">BindMethod</span> <span class="hljs-variable">bindMethod</span> <span class="hljs-operator">=</span> target.getBindMethod();
        <span class="hljs-keyword">if</span> (!allowRecursiveBinding &amp;&amp; context.isBindingDataObject(type)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 注意这里的lambda表达式，在JavaBeanBinder的bind()方法最终又会调用到这个lambda表达式</span>
        <span class="hljs-type">DataObjectPropertyBinder</span> <span class="hljs-variable">propertyBinder</span> <span class="hljs-operator">=</span> (propertyName, propertyTarget) -&gt; bind(name.append(propertyName),
                propertyTarget, handler, context, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                
	    <span class="hljs-comment">// 这里会调用到JavaBeanBinder的bind()方法</span>
        <span class="hljs-keyword">return</span> context.withDataObject(type, () -&gt; fromDataObjectBinders(bindMethod,
                (dataObjectBinder) -&gt; dataObjectBinder.bind(name, target, context, propertyBinder)));
    }
}
</code></pre>
<p>在 <code>JavaBeanBinder</code> 的 <code>bind()</code> 方法中会获取这个对象的所有的 <code>BeanProperty</code>，然后又反调用回 <code>Binder</code> 中的lambda表达式了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaBeanBinder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DataObjectBinder</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, Context context,
            DataObjectPropertyBinder propertyBinder)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasKnownBindableProperties</span> <span class="hljs-operator">=</span> target.getValue() != <span class="hljs-literal">null</span> &amp;&amp; hasKnownBindableProperties(name, context);
        Bean&lt;T&gt; bean = Bean.get(target, hasKnownBindableProperties);
        <span class="hljs-keyword">if</span> (bean == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        BeanSupplier&lt;T&gt; beanSupplier = bean.getSupplier(target);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> bind(propertyBinder, bean, beanSupplier, context);
        <span class="hljs-keyword">return</span> (bound ? beanSupplier.get() : <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(DataObjectPropertyBinder propertyBinder, Bean&lt;T&gt; bean, BeanSupplier&lt;T&gt; beanSupplier,
        Context context)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (BeanProperty beanProperty : bean.getProperties().values()) { <span class="hljs-comment">// 获取这个对象上所有的BeanProperty属性</span>
            bound |= bind(beanSupplier, propertyBinder, beanProperty);
            context.clearConfigurationProperty();
        }
        <span class="hljs-keyword">return</span> bound;
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(BeanSupplier&lt;T&gt; beanSupplier, DataObjectPropertyBinder propertyBinder,
        BeanProperty property)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">propertyName</span> <span class="hljs-operator">=</span> determinePropertyName(property);
        <span class="hljs-type">ResolvableType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> property.getType();
        Supplier&lt;Object&gt; value = property.getValue(beanSupplier);
        Annotation[] annotations = property.getAnnotations();
        <span class="hljs-type">Object</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> propertyBinder.bindProperty(propertyName, <span class="hljs-comment">//这个地方实际上又反调用回Binder中的lambda表达式了</span>
                Bindable.of(type).withSuppliedValue(value).withAnnotations(annotations));
        <span class="hljs-keyword">if</span> (bound == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">if</span> (property.isSettable()) {
            property.setValue(beanSupplier, bound);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span> || !bound.equals(value.get())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"No setter found for property: "</span> + property.getName());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p><code>BeanProperty</code> 对象会将 JavaBean 中的属性统一为 Dash 格式。在本案例中属性名称是 <code>containerName</code>，统一之后就变成了 <code>container-name</code>。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8eb95c0912154e9c998600207f72451f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=Qg0dmDKlyy1kzjRH%2F%2FS6uc7tY9U%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>Binder</code> 中 lambda 表达式会将属性拼接到已有的 <code>ConfigurationPropertyName</code> 前缀上，在本案例中就变成了 <code>test.container-name</code>。然后又递归调用 <code>bind()</code> 方法，然后又调用 <code>findProperty()</code> 方法尝试从从对应的 <code>ConfigurationPropertySource</code> 中获取对应的配置中查找这个属性。</p>
<p>Spring 提供了 <code>SpringIterableConfigurationPropertySource</code> 作为 <code>ConfigurationPropertySource</code> 实现类， 它实际是对 <code>PropertySource</code> 的一个适配，内部有一个 <code>propertySource</code> 表示真正的配置。通过调试 <code>contex.getSource()</code> 方法的返回值，可以看到加密之后的 <code>PropertySource</code> 确实是在没有加密的前面。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">DataObjectPropertyBinder</span> <span class="hljs-variable">propertyBinder</span> <span class="hljs-operator">=</span> (propertyName, propertyTarget) -&gt; bind(name.append(propertyName), <span class="hljs-comment">//这里将属性名称拼接到test前缀上</span>
		propertyTarget, handler, context, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                
<span class="hljs-keyword">private</span> &lt;T&gt; ConfigurationProperty <span class="hljs-title function_">findProperty</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target,
    Context context)</span> {
    <span class="hljs-keyword">if</span> (name.isEmpty() || target.hasBindRestriction(BindRestriction.NO_DIRECT_PROPERTY)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">for</span> (ConfigurationPropertySource source : context.getSources()) {
        <span class="hljs-type">ConfigurationProperty</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> source.getConfigurationProperty(name);
        <span class="hljs-keyword">if</span> (property != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> property;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61dc8d5ecac64fafa6638bb1c22e1d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=Ze2HUTIra0Fo%2BWL%2FCYZ%2FYG7krL4%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>getConfigurationProperty()</code> 方法中首先调用父类 <code>SpringConfigurationPropertySource</code> 的 <code>getConfigurationProperty()</code> 方法。在该方法中会调用 <code>PropertyMapper</code> 的 <code>map()</code> 方法对传入的 <code>ConfigurationPropertyName</code> 类型的 <code>name</code> 进行转换，然后根据转换后拿到的名称去 <code>PropertySource</code> 中获取对应的属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigurationPropertySource</span> {
    <span class="hljs-keyword">public</span> ConfigurationProperty <span class="hljs-title function_">getConfigurationProperty</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">for</span> (PropertyMapper mapper : <span class="hljs-built_in">this</span>.mappers) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (String candidate : mapper.map(name)) { <span class="hljs-comment">// 这里先通过PropertyMapper转换名称</span>
                    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> getPropertySource().getProperty(candidate); <span class="hljs-comment">// 根据转换后的名称获取获取对应的属性</span>
                    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
                        <span class="hljs-type">Origin</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> PropertySourceOrigin.get(<span class="hljs-built_in">this</span>.propertySource, candidate);
                        <span class="hljs-keyword">return</span> ConfigurationProperty.of(<span class="hljs-built_in">this</span>, name, value, origin);
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (Exception ex) {
                <span class="hljs-comment">// Ignore</span>
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>在创建 <code>SpringConfigurationPropertySource</code> 对象时，会根据 <code>PropertySource</code> 是 <code>MapPropertySource</code> 还是 <code>SystemEnvironmentPropertySource</code> ，从而设置不同的 <code>mappers</code> 属性，对于 <code>SystemEnvironmentPropertySource</code>，它会多一个 <code>SystemEnvironmentPropertyMapper</code> 。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigurationPropertySource</span> {
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> PropertyMapper[] DEFAULT_MAPPERS = { DefaultPropertyMapper.INSTANCE };

   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> PropertyMapper[] SYSTEM_ENVIRONMENT_MAPPERS = { SystemEnvironmentPropertyMapper.INSTANCE,
    DefaultPropertyMapper.INSTANCE };
    
   <span class="hljs-keyword">static</span> SpringConfigurationPropertySource <span class="hljs-title function_">from</span><span class="hljs-params">(PropertySource&lt;?&gt; source)</span> {
        Assert.notNull(source, <span class="hljs-string">"Source must not be null"</span>);
        PropertyMapper[] mappers = getPropertyMappers(source);
        <span class="hljs-keyword">if</span> (isFullEnumerable(source)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringIterableConfigurationPropertySource</span>((EnumerablePropertySource&lt;?&gt;) source, mappers);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span>(source, mappers);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> PropertyMapper[] getPropertyMappers(PropertySource&lt;?&gt; source) {
        <span class="hljs-comment">// 这里判断了如果是SystemEnvironmentPropertySource则会返回SYSTEM_ENVIRONMENT_MAPPERS，里面包含了SystemEnvironmentPropertyMapper</span>
        <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> SystemEnvironmentPropertySource &amp;&amp; hasSystemEnvironmentName(source)) {
            <span class="hljs-keyword">return</span> SYSTEM_ENVIRONMENT_MAPPERS;
        }
        <span class="hljs-keyword">return</span> DEFAULT_MAPPERS;
    }
}
</code></pre>
<p>对于 <code>DefaultPropertyMapper</code> 它的 <code>map()</code> 方法会直接返回 <code>ConfigurationPropertyName</code> 的名称，在本案例中就会直接返回 <code>test.container-name</code>。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultPropertyMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertyMapper</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(ConfigurationPropertyName configurationPropertyName)</span> {
        <span class="hljs-comment">// Use a local copy in case another thread changes things</span>
        LastMapping&lt;ConfigurationPropertyName, List&lt;String&gt;&gt; last = <span class="hljs-built_in">this</span>.lastMappedConfigurationPropertyName;
        <span class="hljs-keyword">if</span> (last != <span class="hljs-literal">null</span> &amp;&amp; last.isFrom(configurationPropertyName)) {
            <span class="hljs-keyword">return</span> last.getMapping();
        }
        <span class="hljs-comment">// 这里直接返回ConfigurationPropertyName的名称</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">convertedName</span> <span class="hljs-operator">=</span> configurationPropertyName.toString();
        List&lt;String&gt; mapping = Collections.singletonList(convertedName);
        <span class="hljs-built_in">this</span>.lastMappedConfigurationPropertyName = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LastMapping</span>&lt;&gt;(configurationPropertyName, mapping);
        <span class="hljs-keyword">return</span> mapping;
    }
}
</code></pre>
<p>对于 <code>SystemEnvironmentPropertyMapper</code> 它会返回两个格式的名称，在本案例中就会返回 <code>TEST_CONTAINERNAME</code> 和 <code>TEST_CONTAINER_NAME</code> 两种格式。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemEnvironmentPropertyMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertyMapper</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">PropertyMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemEnvironmentPropertyMapper</span>();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(ConfigurationPropertyName configurationPropertyName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> convertName(configurationPropertyName);
        <span class="hljs-type">String</span> <span class="hljs-variable">legacyName</span> <span class="hljs-operator">=</span> convertLegacyName(configurationPropertyName);
        <span class="hljs-keyword">if</span> (name.equals(legacyName)) {
            <span class="hljs-keyword">return</span> Collections.singletonList(name);
        }
        <span class="hljs-comment">// 这里会返回两个格式的名称</span>
        <span class="hljs-keyword">return</span> Arrays.asList(name, legacyName);
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertName</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-keyword">return</span> convertName(name, name.getNumberOfElements());
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertName</span><span class="hljs-params">(ConfigurationPropertyName name, <span class="hljs-type">int</span> numberOfElements)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numberOfElements; i++) {
            <span class="hljs-keyword">if</span> (!result.isEmpty()) {
                result.append(<span class="hljs-string">'_'</span>);
            }
            result.append(name.getElement(i, Form.UNIFORM).toUpperCase(Locale.ENGLISH));
        }
        <span class="hljs-keyword">return</span> result.toString();
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertLegacyName</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; name.getNumberOfElements(); i++) {
            <span class="hljs-keyword">if</span> (!result.isEmpty()) {
                result.append(<span class="hljs-string">'_'</span>);
            }
            result.append(convertLegacyNameElement(name.getElement(i, Form.ORIGINAL)));
        }
        <span class="hljs-keyword">return</span> result.toString();
    }

    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">convertLegacyNameElement</span><span class="hljs-params">(String element)</span> {
        <span class="hljs-keyword">return</span> element.replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">'_'</span>).toUpperCase(Locale.ENGLISH);
    }
}
</code></pre>
<p>在本案例中<code>decryptedSystemEnvironment</code> 的 <code>PropertySource</code> 类型是 <code>MapPropertySource</code>，存放的内容是 <code>TEST_CONTAINER_NAME=Tomcat</code>。它只有 <code>DefaultPropertyMapper</code>；</p>
<p>名称为 <code>systemEnvironment</code> 的 <code>PropertySource</code> 类型是 <code>SystemEnvironmentPropertySource</code>，存放的内容是 <code>TEST_CONTAINER_NAME=ENC_VG9tY2F0</code>。它有<code>DefaultPropertyMapper</code> 和 <code>SystemEnvironmentPropertyMapper</code>。</p>
<p><code>decryptedSystemEnvironment</code> 在顺序上排在 <code>systemEnvironment</code> 前面。这个时候开始查找传入名称为 <code>test.container-name</code> 的 <code>ConfigurationPropertyName</code>，这个时候先从 <code>decryptedSystemEnvironment</code> 开始找，经过 <code>DefaultPropertyMapper</code> 转换之后拿到的属性名称是 <code>test.container-name</code>，配置里面没有这个配置；然后从 <code>systemEnvironment</code> 开始找，经过 <code>SystemEnvironmentPropertyMapper</code> 转换之后拿到的属性名称是<code>TEST_CONTAINERNAME</code> 和 <code>TEST_CONTAINER_NAME</code>，根据 <code>TEST_CONTAINER_NAME</code> 就拿到了 <code>ENC_VG9tY2F0</code> 。这就解释了为啥配置类注入的还是加密之后的值了。</p>
<h2 data-id="heading-2">问题解决</h2>
<p>知道问题的原理了之后，问题就好解决了。一种方法是可以在 <code>DecryptEnvironmentPostProcessor</code> 类的 <code>postProcessBeforeInitialization()</code> 方法中把添加的 <code>MapPropertySource</code> 类型改为 <code>SystemEnvironmentPropertySource</code> 就可以了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {  
    <span class="hljs-type">String</span> <span class="hljs-variable">systemEnvName</span> <span class="hljs-operator">=</span> StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME;  
    <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">systemEnvSource</span> <span class="hljs-operator">=</span> (MapPropertySource) environment.getPropertySources().get(systemEnvName);  
    Map&lt;String, Object&gt; decryptedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  
    <span class="hljs-keyword">if</span> (systemEnvSource == <span class="hljs-literal">null</span>) {  
        <span class="hljs-keyword">return</span>;  
    }  
    systemEnvSource.getSource().forEach((key, value) -&gt; {  
        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String strVal) {  
            <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(strVal) &amp;&amp; strVal.startsWith(<span class="hljs-string">"ENC_"</span>)) {  
                <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getDecoder().decode(strVal.substring(<span class="hljs-number">4</span>)));  
                decryptedMap.put(key, plainText);  
            }  
        }  
    });  
  
    <span class="hljs-keyword">if</span> (!decryptedMap.isEmpty()) {  
		<span class="hljs-comment">// 这里原来添加的是MapPropertySource类型，现在调整为SystemEnvironmentPropertySource类型</span>
        <span class="hljs-comment">// MapPropertySource decryptedSource = new MapPropertySource(DECRYPTED_SOURCE_NAME, decryptedMap);  </span>
        environment.getPropertySources().addBefore(systemEnvName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemEnvironmentPropertySource</span>(DECRYPTED_SOURCE_NAME, decryptedMap));  
        System.out.println(<span class="hljs-string">""</span>);  
    }  
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐]]></title>    <link>https://juejin.cn/post/7601313474719301667</link>    <guid>https://juejin.cn/post/7601313474719301667</guid>    <pubDate>2026-02-01T09:22:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719301667" data-draft-id="7601077764423483442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐"/> <meta itemprop="keywords" content="人工智能,DeepSeek,LangChain"/> <meta itemprop="datePublished" content="2026-02-01T09:22:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:22:49.000Z" title="Sun Feb 01 2026 09:22:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上篇文章《<a href="https://juejin.cn/post/7597650322409291828" target="_blank" title="https://juejin.cn/post/7597650322409291828">大模型训练全流程实战指南基础篇（四）——本地部署大模型API调用实战：Python对接OpenAI格式全解析</a>》介绍了如何通过代码调用本地部署的大模型，实现自动化任务处理。至此，大家已经掌握了模型文件结构、模型本地部署与API代码调用的基本技能。</p>
<p>从本期内容开始，本系列将进入<strong>工具篇</strong>。在<strong>工具篇</strong>笔者首先会系统梳理大模型训练的整体流程，并针对训练流程的每个阶段推荐相应的实用工具；随后，笔者将挑选其中具有代表性的工具进行详细讲解与实战演示。工具篇之后将进入<strong>实战篇</strong>，笔者会带领大家运用所学工具，完整走通从数据准备、模型训练到最终部署上线的全流程。可以说，工具篇是承上启下的关键环节，希望大家认真学习，为后续实战打下坚实基础。</p>
<p>本期内容笔者会帮助大家建立对大模型训练全流程的结构化认知，同时为每个环节提供可操作的工具推荐。大家可以借助推荐工具动手实践，逐步构建属于自己的大模型训练工作流。</p>
<p>需要注意的是，大模型训练对计算资源尤其是GPU显存有较高要求。为降低学习与实践门槛，笔者已与国内主流云平台合作，为大家争取到了<strong>H100 GPU 6.5小时</strong>的免费算力体验机会。只需点击链接 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> 即可领取。本系列所有实战环节均将基于该平台完成，助力大家以更低成本上手大模型训练。</p>
<h2 data-id="heading-1">一、大模型训练全流程概述</h2>
<p>大模型训练的整体流程通常可分为三大核心阶段：<strong>数据阶段</strong>、<strong>训练阶段</strong>与<strong>评测阶段</strong>。每个阶段又可进一步细分为若干关键步骤。</p>
<ul>
<li><strong>数据工程</strong>：主要包括文本采集、文本过滤、文本清洗与去重及数据集构建等步骤。</li>
<li><strong>训练工程</strong>：若从零开始设计模型，通常需经历选择基础架构、确定模型规模、设计模型结构与功能，随后进行预训练、监督微调（SFT）及强化学习对齐（RLHF）等步骤。然而，完全从头训练需消耗海量数据与巨额算力（例如数十亿条数据与数十台服务器并行），这对中小团队或个人开发者而言往往难以承担。因此，更常见的做法是在已有的预训练模型基础上，进行<strong>增量预训练</strong>、<strong>微调</strong>和<strong>强化学习</strong>步骤，本系列内容笔者首先会分享基于Qwen3等开源大模型的训练，在最后扩展篇也会带大家使用Pytorch从0到1手写模型并完成训练部署。</li>
<li><strong>评测工程</strong>：模型训练完成后必须经过系统评估，主要包括自动基准测试评估与人工深入评估两部分。</li>
</ul>
<p>了解整体流程后，大家可能仍对每个子环节的具体作用，以及应选用哪些工具进行处理感到困惑。别担心，接下来笔者将逐一详解各环节，并推荐相应的常用工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21a785e525a24cf5845453827e3793af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=6YXdXN4fM3rR2HTCMEUJP3H2g88%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-2">二、数据工程阶段详解</h2>
<p>数据工程阶段的核心任务，是将原始数据转化、处理为可用于大模型训练的高质量数据集。大模型本质上可以视作一个庞大的“知识库”，其能力直接源自于训练数据中所蕴含信息的广度与质量。尤其对于大语言模型（LLM）而言，如何获取并有效处理高价值的文本语料，是整个训练流程中最为关键的基石。该阶段主要包含以下四个核心环节。</p>
<h3 data-id="heading-3">2.1 文本采集</h3>
<p>文本采集旨在从各类来源收集原始文本材料，为后续处理提供基础原料。</p>
<p><strong>数据来源分类：</strong></p>
<ol>
<li><strong>需自行采集与处理的数据源</strong>：包括网页数据、书籍、学术论文、百科全书、社交媒体文本等。</li>
<li><strong>已公开的成熟数据集</strong>：例如由专业机构发布的 <code>Common Crawl</code>（PB级网络爬虫数据仓库）等大规模语料库。</li>
<li><strong>大模型知识蒸馏</strong>：通过构造覆盖特定知识领域的问题集，从现有大模型（如 GPT-4、Claude 等）的回复中提取知识，生成训练数据。相关原理可参考<a href="https://juejin.cn/post/7471648566849241128#heading-0" target="_blank" title="https://juejin.cn/post/7471648566849241128#heading-0">《大模型指南——蒸馏、量化、微调》</a>。</li>
<li><strong>商业数据采购</strong>：直接向专业数据公司购买经过清洗和标注的高质量数据集。</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li>
<p><strong>自行采集数据</strong>：可使用专业爬虫工具（如<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bazhuayu.com%2Fabout%3Fref%3DzMROaF%26snid%3D1769871274214030731_xBCKjLSp%26x_collect_uid%3D4281d340ad8fa681f9bfadd5500339c7" target="_blank" title="https://www.bazhuayu.com/about?ref=zMROaF&amp;snid=1769871274214030731_xBCKjLSp&amp;x_collect_uid=4281d340ad8fa681f9bfadd5500339c7" ref="nofollow noopener noreferrer">八爪鱼</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bright.cn%2F%3Fps_partner_key%3Dd2VpanVuemh1OTEzNQ%26ps_xid%3DJ2teLLup1rP75t%26gsxid%3DJ2teLLup1rP75t%26gspk%3Dd2VpanVuemh1OTEzNQ%26utm_source%3Daffiliates%26utm_campaign%3Dd2VpanVuemh1OTEzNQ" target="_blank" title="https://www.bright.cn/?ps_partner_key=d2VpanVuemh1OTEzNQ&amp;ps_xid=J2teLLup1rP75t&amp;gsxid=J2teLLup1rP75t&amp;gspk=d2VpanVuemh1OTEzNQ&amp;utm_source=affiliates&amp;utm_campaign=d2VpanVuemh1OTEzNQ" ref="nofollow noopener noreferrer">亮数据</a>）或自行编写脚本（推荐使用 Python 的 <code>Scrapy</code> 等框架）。若目标为训练通用大模型，建议参考百度百科或学科门类（我国共13类：哲、经、法、教、文、史、理、工、农、医、军、管、艺）进行针对性爬取，以保证数据多样性及质量。若爬取得到的数据源为图片或扫描件，需通过 OCR 技术（推荐 <code>MinerU</code>工具、<code>DeepSeek-OCR</code> 模型）转为文本，更多OCR工具可参考笔者文章<a href="https://juejin.cn/post/7564921269491040271" target="_blank" title="https://juejin.cn/post/7564921269491040271">OCR技术简史: 从深度学习到大模型，最强OCR大模型花落谁家</a>。</p>
</li>
<li>
<p><strong>使用公开数据集</strong>：Hugging Face、ModelScope 等平台汇聚了大量开源数据集。例如，下图展示了智源研究院在 ModelScope 上开源的 <code>IndustryCorpus2</code> 分类预训练数据集，可直接下载使用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5fd995a6a974cafb63daddbcbd39935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=aOtvtO9p8LjTiliCGAfoyipdtRY%3D" alt="1.png" loading="lazy"/></p>
</li>
<li>
<p><strong>大模型知识蒸馏</strong>：核心是编写 Python 脚本调用大模型 API 进行问答生成。工具方面，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.easy-dataset.com%2F" target="_blank" title="https://docs.easy-dataset.com/" ref="nofollow noopener noreferrer">EasyDataset</a> 提供了便捷的界面，可指定主题（如“中国历史”）后自动构造问题并从大模型中蒸馏数据。</p>
</li>
</ul>
<h3 data-id="heading-4">2.2 文本过滤</h3>
<p>采集到的原始数据（尤其是网络爬虫数据）通常质量参差不齐，必须过滤掉低价值或有害内容，以保证训练数据的纯净度。</p>
<p><strong>处理流程：</strong></p>
<p>此步骤旨在识别并剔除广告、仇恨言论、大量无意义重复文本等低质量内容。公开数据集与蒸馏数据通常质量较高，可适度简化此步骤。</p>
<p><strong>相关处理与工具推荐：</strong></p>
<p>文本过滤通常需自行编写处理脚本，主要有以下三类方法：</p>
<ol>
<li><strong>模型过滤</strong>：调用大模型 API（如本地部署的模型），利用其强大的理解能力判断文本质量。<strong>优点</strong>：准确性高；<strong>缺点</strong>：处理速度慢，成本较高。</li>
<li><strong>统计指标过滤</strong>：编写 Python 脚本，计算文本的 n-gram、词汇多样性等统计特征，并训练轻量级分类模型（如基于 TF-IDF 的模型）进行自动过滤。</li>
<li><strong>规则过滤</strong>：基于专家经验，编写正则表达式或关键词列表，快速匹配并过滤垃圾短语、特定违规内容等。</li>
</ol>
<h3 data-id="heading-5">2.3 文本清洗与去重</h3>
<p>过滤后的文本需进一步规范化，并去除冗余信息，以确保数据的一致性和高效性。</p>
<p><strong>处理流程：</strong></p>
<ol>
<li><strong>清洗</strong>：检测并处理剩余的无效片段（非有害但无信息量的文本）、统一文本编码格式（如统一转为 UTF-8）、处理特殊字符与乱码。</li>
<li><strong>多语言对齐</strong>：若需训练跨语言模型，需进行平行语料（如中-英句子对）的对齐工作。</li>
<li><strong>去重</strong>：在文档级、段落级或句子级识别并去除重复内容，避免模型过度拟合相同信息。</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li><strong>编码规范化</strong>：使用 Python 的 <code>codecs</code> 或 <code>chardet</code> 库进行自动检测与转换。</li>
<li><strong>无效片段检测</strong>：可继续使用大模型或轻量级文本分类模型进行判断。</li>
<li><strong>平行语料对齐</strong>：可使用专业工具，如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tmxmall.com%2Faligner%2Fhome" target="_blank" title="https://www.tmxmall.com/aligner/home" ref="nofollow noopener noreferrer">Tmxmall 在线对齐工具</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcorpus.shisu.edu.cn%2F5a%2Ff1%2Fc9380a154353%2Fpage.htm" target="_blank" title="https://corpus.shisu.edu.cn/5a/f1/c9380a154353/page.htm" ref="nofollow noopener noreferrer">SISU Aligner 2.0.0</a>。也可编写脚本调用机器翻译 API 进行粗对齐后人工校验。</li>
<li><strong>去重</strong>：可使用高效的算法（如 MinHash）编写脚本自行实现，或直接使用 Hugging Face 的 <strong>SemHash</strong> 开源工具去重。</li>
</ul>
<h3 data-id="heading-6">2.4 数据集构建</h3>
<p>此环节将清洗后的高质量原始文本，转换为大模型训练可直接使用的标准化数据格式。</p>
<p><strong>处理流程与数据格式：</strong></p>
<ol>
<li>
<p><strong>预训练数据集</strong>：格式通常为连续的纯文本块（<code>json</code>或<code>jsonl</code> 格式，每个对象包含一个 <code>"text"</code> 字段）。关键在于文本块的切分策略，需尽量保证知识单元的完整性（如按段落、章节切分）。可借鉴 RAG（检索增强生成）中知识库的文档切分算法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0465097199402ba4875dba776e17f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=s1D%2FJHRosC%2B8dbWDVMy4gLPr8fY%3D" alt="3.png" loading="lazy"/></p>
</li>
<li>
<p><strong>监督微调（SFT）数据集</strong>：格式为对话或指令-回答对（多轮对话）。若需训练模型具备思维链（Chain-of-Thought）能力，数据中需包含推理过程（常置于 <code>&lt;think&gt;...&lt;/think&gt;</code> 标签内，并将其和输出合并置于ouput字段）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6c3f3383c64c66aab4d3719f26de87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=zubWwWvld6BNJKR7diPpWtsteSU%3D" alt="4.png" loading="lazy"/></p>
</li>
<li>
<p><strong>偏好对齐数据集</strong>：用于训练PPO算法中的关键奖励模型（RM）或进行 DPO/ORPO 训练。每条数据包含一个指令（或问题），以及一个被选中的（<code>chosen</code>）优质回答和一个被拒绝的（<code>rejected</code>）劣质回答。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74d0a467de4c4e0cb7bb1b69be69d337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=K5n3yvizszm763Mft1EL37%2BilsM%3D" alt="5.png" loading="lazy"/></p>
</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li><strong>预训练数据切分</strong>：编写python脚本处理，可借鉴 RAGFlow、Dify 等工具中的智能分块算法，或自行实现固定长度、文档结构、章节感知等分块算法。</li>
<li><strong>监督微调数据生成</strong>：可使用 <code>EasyDataset</code> 等工具辅助生成，或编写脚本调用大模型 API 批量合成。</li>
<li><strong>偏好对齐数据生成</strong> 通常选取大量的评测集对初步训练的模型进行测试，选取表现较差的问答对，将问题预期的结果作为<code>chosen</code>, 实际生成的较差的回答作为<code>rejected</code>。</li>
</ul>
<h3 data-id="heading-7">2.5 工具调用与最佳实践</h3>
<p>数据质量是决定大模型性能上限的关键因素。在实际工作中，数据工程往往占据整个训练流程80%以上的精力。</p>
<ul>
<li>
<p><strong>对于领域适配或指令微调</strong>：推荐组合使用以下工具：</p>
<ul>
<li>使用 <strong>RAGFlow</strong> 等知识库的智能文本分割算法处理长文档。</li>
<li>使用 <strong>EasyDataset</strong> 高效构建指令微调、思维链或知识蒸馏数据集。</li>
</ul>
</li>
<li>
<p><strong>对于追求极致性能的精细优化</strong>：通常需要深入代码层面，进行数据合成增强、难度分级、负样本挖掘等更复杂的操作。相关高阶技巧与代码实践，将在本系列的扩展篇中详细展开。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd22a270f6d4ccead98c2b74a2aefd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=NBIvQY6EYTZ8%2F7cuah9aaGUFMiU%3D" alt="14.png" loading="lazy"/></p>
<h2 data-id="heading-8">三、 训练工程阶段详解</h2>
<p>与数据工程相比，训练工程阶段的工具链和标准化流程更为成熟。整个训练过程通常划分为三个核心且环环相扣的阶段：<strong>预训练</strong>、<strong>监督微调（SFT）</strong>  和 <strong>强化学习对齐（如RLHF）</strong> 。关于这三阶段的作用，笔者在 <a href="https://juejin.cn/post/7594655863548297268" target="_blank" title="https://juejin.cn/post/7594655863548297268">大模型训练全流程实战指南（一）——为什么要学习大模型训练？</a>也基本提及过，笔者将其形象地比喻为  <strong>“培养一位超级学霸”</strong>  的过程：先海量阅读构建知识体系，再接受专业指导掌握方法，最后通过实践反馈优化言行。</p>
<h3 data-id="heading-9">3.1 预训练阶段</h3>
<p>预训练的核心目标，是将经过处理的海量文本数据中的语言规律和世界知识，“压缩”存储到大模型的参数中。在 <a href="https://juejin.cn/post/7594728203258347554" target="_blank" title="https://juejin.cn/post/7594728203258347554">大模型训练全流程实战指南基础篇（二）——大模型文件结构解读与原理解析</a>中笔者提过大模型预测的本质是学习语言的概率分布：模型通过数十亿乃至数万亿的token，学会根据给定的上文预测下一个最可能的词，从而掌握语法、事实和基础推理能力。这相当于让模型“读完整个图书馆的书”，建立起对世界的通用认知框架。</p>
<p>对于希望获得领域专家的模型（如法律、医疗），直接从头预训练成本过高。更可行的路径是 <strong>增量预训练（Continued Pre-training）</strong> ：在一个通用基座模型（如LLaMA、Qwen）基础上，使用领域专有数据（如法律条文、医学文献）继续训练。这能显著提升模型在特定领域的知识深度，但需注意可能伴随的 <strong>灾难性遗忘</strong> 问题——即模型在新领域变强的同时，可能损失部分原有通用能力。</p>
<h3 data-id="heading-10">3.2 微调阶段</h3>
<p>预训练模型虽“学识渊博”，却不懂如何与人类交流。例如，当被问及“长江”时，它可能仅基于统计关联回答“黄河”，而非给出有用信息。<strong>监督微调（SFT）</strong>  正是为了解决“如何与人对话”的问题。此阶段使用 <strong>高质量的指令-回答对数据集</strong>，以有监督的方式训练模型，目标是：</p>
<ul>
<li><strong>理解意图</strong>：学会解析各式各样的人类指令（如“写诗”、“总结文章”）。</li>
<li><strong>安全合规</strong>：遵循伦理准则，避免生成有害、偏见或虚构内容。</li>
<li><strong>格式化输出</strong>：能够按要求组织答案（如使用列表、分点论述）。</li>
</ul>
<p>这个过程好比让那位“学霸”进入实习期，由导师（高质量数据）手把手地教导其沟通礼仪、回答技巧与行为边界。在实际应用中，许多垂直领域模型会直接对通用基座模型进行SFT，以快速“激活”其在该领域的潜在能力，而跳过增量预训练阶段。</p>
<h3 data-id="heading-11">3.3 强化学习阶段</h3>
<p>掌握了知识与方法后，还需要通过反馈机制来优化行为，使其更符合人类的主观偏好和价值判断。这便是强化学习对齐阶段的任务。</p>
<p>以主流的 基于人类反馈的强化学习（RLHF）为例，该阶段通常分为两步：</p>
<ol>
<li><strong>训练奖励模型（RM）</strong> ：使用 偏好数据集（包含人类标注员选择的“好回答”与“差回答”），训练一个独立的模型作为“裁判”，学习评判回答质量的高低。</li>
<li><strong>优化策略模型</strong>：利用PPO等强化学习算法，让待优化的大模型（策略模型）生成回答，并由奖励模型打分。模型通过不断试错，学习生成能获得更高奖励（即更符合人类偏好）的回答。</li>
</ol>
<p>这如同为“实习生”配备了一位严格的实战教练，通过持续的练习与即时反馈，不断打磨其表现，直至其产出结果既专业又令人满意。</p>
<h3 data-id="heading-12">3.4 工具调用与最佳实践</h3>
<p>在工程实现上，模型训练主要分为两种路径，对应不同的开发深度与效率需求：</p>
<p><strong>1. 底层研发式训练</strong><br/>
适用于需要全新架构探索或深度定制的研究团队，通常是从0开发大模型的团队</p>
<ul>
<li><strong>核心框架</strong>：直接使用 <strong>PyTorch</strong> 与 <strong>Transformers</strong> 库从零构建训练流程。</li>
<li><strong>分布式与优化</strong>：大模型训练必须依赖分布式技术。典型组合是：<strong>Ray</strong>（分布式计算框架） + <strong>DeepSpeed</strong>（深度学习优化库，支持ZeRO、卸载等技术）来实现多机多卡高效训练。</li>
</ul>
<p><strong>2. 高效微调与一体化训练（推荐）</strong><br/>
对于绝大多数基于现有模型进行适配的专用模型训练场景，使用高层框架可以极大提升效率。</p>
<ul>
<li>
<p><strong>单卡高效微调</strong>：<strong>Unsloth</strong> 是当前的性能标杆，专注于极致优化LoRA等参数高效微调技术。</p>
</li>
<li>
<p><strong>一体化训练框架</strong>：</p>
<ul>
<li><strong>LLaMA Factory</strong>：提供Web UI和命令行，无需编码即可完成预训练、全参数/高效微调、强化学习等全流程。本系列后续实战将基于此框架进行。</li>
<li><strong>MS-SWIFT</strong>：由阿里团队开源，深度优化对Qwen系列模型的训练支持，同样提供易用的配置化训练。</li>
</ul>
</li>
<li>
<p><strong>强化学习专用库</strong>：</p>
<ul>
<li><strong>VeRL</strong>：字节跳动开源的通用强化学习库。</li>
<li><strong>Easy-R1</strong>：与LLaMA Factory同团队开发，基于VeRL，专门为大模型及多模态的强化学习对齐设计。</li>
</ul>
</li>
</ul>
<p><strong>最佳实践建议</strong>：<br/>
对于希望快速上手的开发者，推荐使用 <strong>LLaMA Factory</strong> 完成从数据准备到模型微调的全流程。本系列合作的实训平台 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> 已提供预置环境，可一键开启实践。对于有定制化强化学习需求的场景，可在VeRL或Easy-R1的基础上进行二次开发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b114bff3c3f546fb9a9e441a75767f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=ZzUL4FjUwK7Ib78xFjeSYl10fpg%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-13">四、评测工程阶段详解</h2>
<p>模型训练完成并非终点，科学、系统的评估是衡量模型能力、发现潜在缺陷并指导后续迭代的关键环节。评测工程的目标是全面回答一个问题： <strong>“训练的模型效果究竟如何？”</strong>  通常从两个层次分析模型的实际效果：<strong>自动化的基准测试</strong>与<strong>深入的人工评估</strong>，这就好像一个学生既要参加标准化的期末考试，也需要老师在期末的时候写评语。</p>
<h3 data-id="heading-14">4.1 自动化基准测试</h3>
<p>自动评估通过一系列精心设计的标准化测试集和量化指标，对模型的各项能力进行快速、可重复的客观衡量。</p>
<p><strong>自动化评测常用数据集</strong>：</p>
<ul>
<li><strong>知识与推理</strong>：使用如 <strong>MMLU</strong>（大规模多任务语言理解）、<strong>C-Eval</strong>（中文知识评估）、<strong>GSM8K</strong>（数学推理）等基准，评估模型在专业领域、常识和逻辑推理方面的能力。</li>
<li><strong>代码能力</strong>：使用 <strong>HumanEval</strong>、<strong>MBPP</strong> 等数据集，评估模型生成可执行、符合要求的代码的能力。</li>
<li><strong>中文综合能力</strong>：针对中文模型，常用 <strong>CMMLU</strong>、<strong>Gaokao-Bench</strong>（高考题库）等评估其本土化理解与知识应用水平。</li>
<li><strong>对齐与安全性</strong>：使用 <strong>SafeBench</strong>、<strong>CValues</strong> 等数据集，评估模型输出是否安全、无害、符合价值观。</li>
</ul>
<p>以上测试集中既包含<strong>MMLU</strong>、<strong>C-Eval</strong>等一些专项知识的选择题，又包含<strong>GSM8K</strong>含标准答案的模型推理题以及<strong>Gaokao-Bench</strong>等主观求解题，全面评测模型的全部能力。</p>
<p><strong>关键指标：</strong></p>
<ul>
<li><strong>准确率（Accuracy）</strong> ：最直观的指标，适用于选择题、判断题等封闭式任务。</li>
<li><strong>NLP指标</strong>：文本类指标评测，评判生成回答与预期结果之间的语言相关程度，包括<strong>召回率（Rouge）、精确度（Precision）、F1分数、BLEU指标</strong>(这些指标具体含义笔者在介绍评测工具使用时会详细讲解)。</li>
<li><strong>基于大模型打分的评估（LLM-as-a-Judge）</strong> ：利用DeepSeek等强大模型作为“裁判”，编写提示词，评估生成答案在相关性、有用性、安全性等方面的质量，也是评估开放性任务的主流方法。</li>
</ul>
<h3 data-id="heading-15">4.2 人工深入评估</h3>
<p>自动化测试虽高效，但难以完全捕捉模型在复杂、开放场景下的真实表现和细微缺陷。<strong>人工深入评估</strong>不可或缺，它侧重于：</p>
<ul>
<li><strong>指令遵循度</strong>：模型是否精确理解了复杂、多层次的指令</li>
<li><strong>输出逻辑与连贯性</strong>：答案是否条理清晰、逻辑自洽</li>
<li><strong>事实准确性</strong>：生成的内容是否存在“幻觉”（编造事实）</li>
<li><strong>安全与伦理边界</strong>：在边缘案例中，模型的应对是否妥当</li>
</ul>
<p>此阶段通常由领域专家或标注团队，通过设计多样化的真实用户场景（如客服对话、创意写作、分析报告）进行系统性测试和主观评分。</p>
<h3 data-id="heading-16">4.3 工具调用与最佳实践</h3>
<p>目前主流的开源评测工具已经极大地提升了评估效率。</p>
<ul>
<li><strong>OpenCompass</strong>：由上海人工智能实验室推出，是<strong>国内最全面的开源评测体系</strong>。它集成了海量的主流评测数据集，支持一键发起对多个模型在数百个能力维度上的自动化评测，并生成详细的排行榜和可视化报告，是进行基准测试的“瑞士军刀”。</li>
<li><strong>EvalScope</strong>：由阿里团队推出，一个<strong>面向生产场景的、可扩展的评测平台</strong>。它的核心优势在于  <strong>“集成”与“工作流”</strong>  。它不仅能将 OpenCompass 作为其一个强大的评测后端引擎来调用，还可以灵活集成企业内部的私有评测集、人工评估流程以及自定义的评估脚本。它提供了统一的评估任务管理、结果分析和对比界面，旨在将分散的评估工作标准化、流程化。</li>
</ul>
<p>综合来看，虽然 OpenCompass 在基准评测的广度上排名No.1，但对于追求从研发到上线全链路质量管控的团队而言，更推荐将 <strong>EvalScope</strong> 作为评测阶段的工具，<strong>EvalScope</strong>不仅可以快速集成OpenCompass后台，还具备模型服务压力测试等额外功能，适合全面的分析评测。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef0f772e39af459fafd2204f78b296ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=oxobMHkLuuolCLMgiu88KlekQNQ%3D" alt="12.png" loading="lazy"/></p>
<h2 data-id="heading-17">五、总结</h2>
<p>本篇内容系统分享了大模型训练三大核心阶段（数据工程、训练工程、评测工程）的全流程，为每个环节推荐了如EasyDataset、LLaMA Factory、EvalScope等关键实用工具，旨在帮助读者构建清晰的训练路径。</p>
<p>从下期内容开始，笔者将分享这些工具的详细使用指南，首先分享OCR工具的相关知识，看看我们是如何把大家爬取的文档识别为统一的markdown格式，大家敬请期待！</p>
<p>大模型训练对计算资源有一定要求，尤其是GPU显存。为降低学习门槛，笔者与国内主流云平台合作，大家可以通过打开链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> ，体验<strong>H100 GPU 6.5小时</strong>的算力。本系列所有实战教程均将在该平台上完成，帮助大家低成本上手实践。</p>
<p>除大模型训练外，笔者也在同步更新<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>免费专栏，要说明该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 37 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端生存指南：离了这十个工具，我写代码像在裸奔]]></title>    <link>https://juejin.cn/post/7601076694105079844</link>    <guid>https://juejin.cn/post/7601076694105079844</guid>    <pubDate>2026-02-01T06:36:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105079844" data-draft-id="7601103779392438335" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端生存指南：离了这十个工具，我写代码像在裸奔"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-01T06:36:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="霞浦小码哥"/> <meta itemprop="url" content="https://juejin.cn/user/1996368847058071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端生存指南：离了这十个工具，我写代码像在裸奔
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1996368847058071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    霞浦小码哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:36:02.000Z" title="Sun Feb 01 2026 06:36:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>键盘敲得冒火星，不如插件点一下</p>
</blockquote>
<p>作为一名在代码海洋里摸爬滚打了六年的“霞浦小码哥”，我发现程序员分两种：一种是用对工具的，一种是加班到深夜的。今天，就让我掏出压箱底的<strong>十个前端神器</strong>，它们就像是我的“外挂装备”，没了它们，我写代码简直像在迷雾中裸奔。</p>
<h2 data-id="heading-0">1. Vite：启动快得像“开了挂”</h2>
<p><strong>定位</strong>：下一代前端构建工具</p>
<p>如果你还在用 Webpack 等热更新要3秒以上的工具，试试 Vite 吧，它会让你有种“机械硬盘换 NVMe 固态”的错觉。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目只要一行命令</span>
npm create vite@latest my-project -- --template react
</code></pre>
<p><strong>神奇之处</strong>：</p>
<ul>
<li>冷启动时间从几十秒降到<strong>1秒内</strong></li>
<li>热更新几乎是<strong>即时反馈</strong>（不到100ms）</li>
<li>天然的ES模块支持，不用再等打包</li>
</ul>
<p><strong>小码哥体验</strong>：第一次用 Vite 时，我盯着秒开的开发服务器，愣是刷新了三次浏览器，怀疑自己电脑是不是被谁偷偷升级了。</p>
<h2 data-id="heading-1">2. ESLint + Prettier：代码界的“强迫症二人组”</h2>
<p><strong>定位</strong>：代码质量守护神</p>
<p>这对组合就像你的代码“保洁阿姨”和“格式管家”，一个负责找脏乱差，一个负责收拾整齐。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .eslintrc.json 经典配置</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"airbnb"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"prettier"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"plugins"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"prettier"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"rules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prettier/prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"error"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>为什么离不开</strong>：</p>
<ul>
<li>ESLint：在你写出<code>==</code>时立刻提醒“应该用<code>===</code>”</li>
<li>Prettier：保存时自动格式化，团队代码像一个人写的</li>
<li>搭配 VS Code 保存自动修复，代码整洁度直接拉满</li>
</ul>
<h2 data-id="heading-2">3. Vue DevTools / React Developer Tools</h2>
<p><strong>定位</strong>：框架专属“X光透视仪”</p>
<p>这是调试 Vue 或 React 应用的“作弊器”，能直接看到组件树、状态变化，甚至能实时修改 props。</p>
<p><strong>超能力展示</strong>：</p>
<ul>
<li>组件层级一目了然，再深的嵌套也不怕</li>
<li>状态变化时间旅行，像看视频回放一样调试</li>
<li>性能分析，找出拖慢应用的那个“罪魁祸首”</li>
</ul>
<p><strong>真实场景</strong>：有一次产品说“这个按钮点了没反应”，我打开 DevTools，两秒定位到是某个 state 没更新，避免了半小时的 console.log 盲猜。</p>
<h2 data-id="heading-3">4. Tailwind CSS：我的“原子级CSS武器库”</h2>
<p><strong>定位</strong>：实用优先的 CSS 框架</p>
<p>传统 CSS 写法像是手动组装家具，Tailwind 则是给你一套完美的乐高积木。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 以前要写一堆CSS类名 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 现在直接组合实用类 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-6 max-w-sm mx-auto bg-white rounded-xl shadow-lg"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 样式都在HTML里，一目了然 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>真香理由</strong>：</p>
<ul>
<li>再也不用为类名起什么而纠结（告别<code>.user-card-wrapper-inner-content</code>）</li>
<li>设计一致性天然保障</li>
<li>打包时自动移除未使用的 CSS，最终文件小得感人</li>
</ul>
<h2 data-id="heading-4">5. Framer Motion：让动画简单得像“拖拽”</h2>
<p><strong>定位</strong>：React 动画库的“降维打击”</p>
<p>如果普通的 CSS 动画是自行车，Framer Motion 就是磁悬浮列车。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { motion } <span class="hljs-keyword">from</span> <span class="hljs-string">'framer-motion'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">motion.div</span>
  <span class="hljs-attr">initial</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0</span>, <span class="hljs-attr">y:</span> <span class="hljs-attr">20</span> }}
  <span class="hljs-attr">animate</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">opacity:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">y:</span> <span class="hljs-attr">0</span> }}
  <span class="hljs-attr">transition</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">duration:</span> <span class="hljs-attr">0.5</span> }}
&gt;</span>
  我会优雅地淡入并向上移动！
<span class="hljs-tag">&lt;/<span class="hljs-name">motion.div</span>&gt;</span></span>
</code></pre>
<p><strong>惊艳之处</strong>：</p>
<ul>
<li>声明式API，动画逻辑清晰得像写配置</li>
<li>手势识别（拖拽、点击、悬停）内置支持</li>
<li>布局动画自动处理，元素位置变化时有平滑过渡</li>
</ul>
<h2 data-id="heading-5">6. Storybook：组件库的“独立展示厅”</h2>
<p><strong>定位</strong>：UI组件开发与测试环境</p>
<p>把你的组件像博物馆展品一样单独陈列、测试、文档化。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化Storybook</span>
npx storybook init
</code></pre>
<p><strong>工作流革命</strong>：</p>
<ul>
<li>开发组件时<strong>无需启动整个应用</strong></li>
<li>可视化测试不同 props 下的组件状态</li>
<li>自动生成组件文档，产品、设计、测试都能看明白</li>
</ul>
<p><strong>团队价值</strong>：我们团队用 Storybook 后，设计师直接在里面看组件效果，省去了“我改好了，你刷新看看”的无限循环。</p>
<h2 data-id="heading-6">7. Chrome Lighthouse：网站的“全身体检仪”</h2>
<p><strong>定位</strong>：网页性能一站式审计工具</p>
<p>在 Chrome DevTools 里直接按 F12 找到 Lighthouse，它就像给你的网站做全面体检，并给出“健康报告”。</p>
<p><strong>体检项目包括</strong>：</p>
<ul>
<li>性能评分（为什么我的页面这么慢？）</li>
<li>无障碍访问（视障用户能正常使用吗？）</li>
<li>SEO 优化（搜索引擎喜欢我的页面吗？）</li>
<li>最佳实践检查（用了HTTPS吗？控制台有错误吗？）</li>
</ul>
<p><strong>小码哥忠告</strong>：每次项目上线前跑一次 Lighthouse，能避免80%的性能问题投诉。</p>
<h2 data-id="heading-7">8. Figma插件生态：设计到代码的“传送门”</h2>
<p><strong>定位</strong>：设计协作平台的强大扩展</p>
<p>虽然 Figma 本身是设计工具，但它的插件生态对前端来说简直是“金矿”。</p>
<p><strong>必装插件</strong>：</p>
<ul>
<li><strong>Figma to Code</strong>：直接从设计稿生成 React/Vue/HTML 代码</li>
<li><strong>Content Reel</strong>：快速填充真实数据替代 Lorem ipsum</li>
<li><strong>Icon Scout</strong>：海量图标直接拖拽使用</li>
</ul>
<p><strong>工作流升级</strong>：设计师更新了样式，我这边插件一点，代码建议就出来了，再也不用像素眼对齐了。</p>
<h2 data-id="heading-8">9. Web Vitals扩展：性能监控的“仪表盘”</h2>
<p><strong>定位</strong>：实时核心Web指标监控</p>
<p>Google 推出的这个 Chrome 扩展，能在你浏览时实时显示页面的核心性能指标。</p>
<p><strong>三个关键指标</strong>：</p>
<ul>
<li><strong>LCP</strong>（最大内容绘制）：页面主要内容加载速度</li>
<li><strong>FID</strong>（首次输入延迟）：用户首次交互的响应速度</li>
<li><strong>CLS</strong>（累积布局偏移）：页面稳定性，防跳闪</li>
</ul>
<p><strong>实用场景</strong>：竞品分析时打开这个扩展，瞬间知道对方网站的性能底细，产品问“别人能做到为什么我们不行”时，数据说话。</p>
<h2 data-id="heading-9">10. GitHub Copilot：我的“AI结对编程伙伴”</h2>
<p><strong>定位</strong>：AI智能代码补全工具</p>
<p>这可能是最近两年最具争议也最震撼的工具。它不只是补全代码，而是能理解你的意图。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我输入注释：</span>
<span class="hljs-comment">// 函数：防抖函数，延迟执行</span>

<span class="hljs-comment">// Copilot自动补全：</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
  <span class="hljs-keyword">let</span> timeout;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executedFunction</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">later</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(timeout);
      <span class="hljs-title function_">func</span>(...args);
    };
    <span class="hljs-built_in">clearTimeout</span>(timeout);
    timeout = <span class="hljs-built_in">setTimeout</span>(later, wait);
  };
}
</code></pre>
<p><strong>使用心得</strong>：</p>
<ul>
<li>写工具函数时，描述一下功能，代码就出来了</li>
<li>写重复业务代码时，能节省大量敲键盘时间</li>
<li>学习新API时，看它给的示例比自己查文档快</li>
</ul>
<p><strong>重要提醒</strong>：Copilot 是很好的“副驾驶”，但别让它完全“掌握方向盘”，始终要保持对代码的理解和把控。</p>
<h2 data-id="heading-10">小码哥的工具哲学</h2>
<p>用了这么多工具，我悟出一个道理：<strong>好工具不是让你变懒，而是让你聚焦真正重要的问题</strong>。</p>
<p>这些工具帮我从：</p>
<ul>
<li>“为什么样式不对？” → 快速定位问题</li>
<li>“怎么实现这个动画？” → 复制粘贴改参数</li>
<li>“性能怎么优化？” → 数据驱动决策</li>
<li>“代码怎么写规范？” → 自动强制执行</li>
</ul>
<p>工具在变，但核心不变：<strong>用更少的时间，解决更多的问题，留出更多的时间给生活</strong>（比如我的乒乓球和摄影）。</p>
<hr/>
<p><strong>最后的建议</strong>：不要一次性把所有工具都装上，那样就像背着一身神装却不知道怎么用。选一两个最痛点的开始，等用顺手了再加新的。</p>
<p>毕竟，最好的工具，永远是那个你用起来像“手臂自然延伸”的工具。现在，就去给你的开发环境装上一两个“外挂”吧！</p>
<p>（写完这篇文章，我默默关掉了还在用 Webpack 的老项目，打开了 Vite 新项目，真香！）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【设计模式-2.1】创建型——单例模式]]></title>    <link>https://juejin.cn/post/7601441797117657139</link>    <guid>https://juejin.cn/post/7601441797117657139</guid>    <pubDate>2026-02-01T09:28:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441797117657139" data-draft-id="7601441475986948142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【设计模式-2.1】创建型——单例模式"/> <meta itemprop="keywords" content="设计模式"/> <meta itemprop="datePublished" content="2026-02-01T09:28:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何中应"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【设计模式-2.1】创建型——单例模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何中应
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:28:18.000Z" title="Sun Feb 01 2026 09:28:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说明：设计模式根据用途分为创建型、结构性和行为型。创建型模式主要用于描述如何创建对象，本文介绍创建型中的单例模式。</p>
<h2 data-id="heading-0">饿汉式单例</h2>
<p>单例模式是比较常见的一种设计模式，旨在确保对象的唯一性，什么时候去使用这个对象都是同一个。这样设计的目的是为了避免对象重复创建，浪费资源，同时也保证了对象的唯一性，不至于多个相同的对象，状态不一致的情况。</p>
<p>以下是单例模式的简单实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 太阳类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sun</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sun</span>();

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Sun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>需要注意，==对象的创建是在对象类内部，且为static final修饰，并且私有化构造方法，使其不能在外部被创建，其次创建一个静态方法，返回其对象==；</p>
<p>此时，外部通过类名.方法名的方式，可以访问到该对象，且始终为同一个；</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Sun</span> <span class="hljs-variable">sun1</span> <span class="hljs-operator">=</span> Sun.getInstance();
        <span class="hljs-type">Sun</span> <span class="hljs-variable">sun2</span> <span class="hljs-operator">=</span> Sun.getInstance();
        System.out.println(sun1 == sun2);
    }
}
</code></pre>
<p>两次获取到的对象相同</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43be59f3d3f4132baf9e7ab897346ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543050&amp;x-signature=t6KHOWNv5SActLLEyg1zmpru%2FiU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>上面这种创建方式，称为==饿汉式单例（Eager Singleton），即类加载完成时就创建对象==；</p>
<h2 data-id="heading-1">懒汉式单例</h2>
<p>以下这种方式，称为==懒汉式单例（Lazy Singleton），在调用静态方法时才创建对象==；</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>这种创建方式，可以实现延迟加载，节约资源。但是==在多线程并发时，如果有多个线程在if (sun == null)，就会导致对象被创建多次==，所以我们很容易想到的是加锁，将静态方法加上锁，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>但是，给方法加上锁后，会影响性能，可以考虑减少锁的范围，只锁住创建对象这一行，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (LazySun.class) {
                sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
            }
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<h2 data-id="heading-2">双重检查锁定</h2>
<p>但是，还有问题。在多线程并发下，如果线程A在创建对象（未完成），线程B、C在if (sun == null) 这里判断为true，即便对象创建完成，线程B、C通过了if判断，也还是会依次再创建对象，也造成了对象被重复创建。因此，还需要改造，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 双重检查锁定
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 第一次判断</span>
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (LazySun.class) {
                <span class="hljs-comment">// 第二次判断</span>
                <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>){
                    sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>就是==在锁住的代码块里面再进行一次非空判断，称为双重检查锁定（Double-Check Locking）==，同时，单例对象修饰符加上volatile，确保多个线程都能正确处理；</p>
<h2 data-id="heading-3">IoDH</h2>
<p>饿汉式单例，是在类被加载时就创建了对象。不需要考虑多线程，但是无论是否使用到对象都创建，造成了资源浪费。而懒汉式单例，虽然做到了延迟加载，但是需要处理好多线程情况下的对象创建，使用了锁，影响了性能。</p>
<p>那有没有一种更好了方式，既能在多线程下使用，又不会影响性能？</p>
<p>在《设计模式的艺术》（刘伟著）中作者提供了一种更好的创建方式，称为IoDH（Initialization on Demand Holder，按需初始化），代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * IoDH
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HolderClass</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> HolderClass.instance;
    }
}
</code></pre>
<p>这种方式是对饿汉式单例的改进，是在单例类里创建了一个内部类，将单例对象的创建放在了这个内部类里面。因为单例对象不是单例类的一个成员变量，所以对象在类加载时不会被创建，而是会在调用静态方法时被创建，这样既能延迟加载，又没有使用锁，影响性能，一举两得。</p>
<p>书中说，<em><strong>通过使用IoDH，既可以实现延迟加载，又可以保证线程安全，不影响系统性能。因此，IoDH不失为一种最好的Java语言单例模式实现方式；其缺点是与编程语言本身的特性相关，很多面向对象语言不支持IoDH。</strong></em></p>
<h2 data-id="heading-4">总结</h2>
<p>本文参考《设计模式的艺术》、《秒懂设计模式》两书</p>
<h2 data-id="heading-5">首次发布</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F134617851" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/134617851" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/det…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境]]></title>    <link>https://juejin.cn/post/7601075423003787300</link>    <guid>https://juejin.cn/post/7601075423003787300</guid>    <pubDate>2026-02-01T09:33:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003787300" data-draft-id="7601075423003754532" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境"/> <meta itemprop="keywords" content="前端,Vite"/> <meta itemprop="datePublished" content="2026-02-01T09:33:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端develop"/> <meta itemprop="url" content="https://juejin.cn/user/3861140565142478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3861140565142478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端develop
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:33:48.000Z" title="Sun Feb 01 2026 09:33:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0. 引言：一个真实的故事</h2>
<blockquote>
<p>产品经理："我们需要在所有产品中添加一个新的用户反馈功能，下周上线！"</p>
<p>前端开发："😰 我们有8个产品，每个都需要单独修改，这得加班到什么时候啊..."</p>
<p>技术总监："🤔 这样下去不是办法，维护成本太高了。我们需要一个更好的解决方案！"</p>
<p>隔壁老王："我来！用 Vite Plugin Modular，一次修改，所有产品自动同步更新！"</p>
<p>前端开发："真的假的？这么神奇？"</p>
<p>技术总监："哇哦！（兴奋）好厉害！（星星眼🌟）这就是我们需要的！（一脸崇拜😍）"</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">1. 项目背景与痛点</h2>
<p>在我们公司的实际业务中，随着业务的快速发展，我们面临着一个具体的挑战：公司拥有许多不同的产品，但各产品都有类似的功能模块。传统的实现方案是为每个产品创建独立的前端项目，各自维护对应的功能。这种方式在初期可能运行良好，但随着业务的不断扩展，问题逐渐凸显：</p>
<ul>
<li><strong>维护成本高</strong>：功能变更需要在多个项目中重复实现，耗费N倍的人力。例如，当需要修改一个通用的登录功能时，需要在所有产品的前端项目中逐一修改，不仅耗时耗力，还容易出现遗漏。</li>
<li><strong>代码冗余</strong>：相似功能在不同项目中重复编写，导致代码库臃肿，增加了存储和维护成本。</li>
<li><strong>一致性难以保证</strong>：不同项目的相同功能可能出现实现差异，导致用户在使用不同产品时体验不一致，影响品牌形象。</li>
<li><strong>部署和配置复杂</strong>：每个项目都需要独立的部署流程和配置管理，增加了DevOps团队的工作负担。</li>
<li><strong>团队协作效率低</strong>：开发者需要在多个项目间切换，增加了上下文切换成本，降低了开发效率。</li>
<li><strong>技术债务累积</strong>：随着时间推移，各项目可能采用不同的技术栈和实现方式，导致技术债务不断累积，难以统一升级和维护。</li>
</ul>
<p>为了解决这些实际业务问题，我们开发了 Vite Plugin Modular，一个专为多模块、多环境前端项目设计的 Vite 插件。它通过将多个相关产品的功能模块整合到单个项目中，实现了代码的复用和统一管理，大幅降低了维护成本，提高了开发效率，为公司的业务发展提供了更灵活、更高效的前端技术支持。</p>
<h2 data-id="heading-2">2. 核心功能介绍</h2>
<h3 data-id="heading-3">2.1 多模块管理</h3>
<p>Vite Plugin Modular 允许在单个项目中管理多个独立的功能模块，每个模块都有自己的源码目录、入口文件和配置。通过命令行工具，开发者可以轻松添加、删除和管理模块：</p>
<ul>
<li><strong>模块化目录结构</strong>：自动生成标准化的模块目录结构，保持代码组织清晰</li>
<li><strong>独立的模块配置</strong>：每个模块可以有自己的标题、入口文件、输出目录等配置</li>
<li><strong>模块间隔离</strong>：模块间相互独立，避免命名冲突和代码耦合</li>
</ul>
<h3 data-id="heading-4">2.2 多环境配置</h3>
<p>针对每个模块，Vite Plugin Modular 支持配置多个环境（如 development、production、test 等），实现环境的精细化管理：</p>
<ul>
<li><strong>环境变量注入</strong>：自动将配置的环境变量注入到代码中，可通过 <code>import.meta.env</code> 访问</li>
<li><strong>环境特定配置</strong>：为不同环境提供不同的配置，满足各种部署场景需求</li>
<li><strong>统一的环境管理</strong>：通过命令行工具方便地添加和删除环境配置</li>
</ul>
<h3 data-id="heading-5">2.3 命令行工具</h3>
<p>提供了功能强大的命令行工具（<code>vmod</code>），简化模块和环境的管理：</p>
<ul>
<li><strong>模块管理命令</strong>：<code>add</code>、<code>delete</code>、<code>list</code> 等命令用于模块的生命周期管理</li>
<li><strong>环境管理命令</strong>：<code>addEnv</code>、<code>deleteEnv</code> 等命令用于环境配置的管理</li>
<li><strong>配置管理命令</strong>：<code>config</code> 命令用于修改模块配置</li>
<li><strong>智能命令生成</strong>：自动为每个模块和环境生成对应的 npm 脚本命令</li>
</ul>
<h3 data-id="heading-6">2.4 智能构建系统</h3>
<p>Vite Plugin Modular 集成了智能的构建系统，为每个模块和环境提供定制化的构建配置：</p>
<ul>
<li><strong>动态入口解析</strong>：根据当前模式自动解析模块入口路径</li>
<li><strong>自定义输出目录</strong>：每个模块可以配置独立的输出目录</li>
<li><strong>HTML 自动转换</strong>：替换 HTML 页面标题和入口脚本为模块配置的值</li>
<li><strong>构建优化</strong>：继承 Vite 的优秀构建性能，同时提供模块级别的优化</li>
</ul>
<h3 data-id="heading-7">2.5 环境变量处理</h3>
<p>提供了灵活的环境变量处理机制，简化配置管理：</p>
<ul>
<li><strong>自动环境变量注入</strong>：将配置的环境变量转换为 <code>VITE_</code> 前缀的环境变量</li>
<li><strong>命名规范转换</strong>：自动将驼峰命名转换为蛇形命名，保持环境变量命名一致性</li>
<li><strong>模块特定环境变量</strong>：每个模块可以有自己的环境变量配置</li>
</ul>
<h2 data-id="heading-8">3. 技术选型理由</h2>
<h3 data-id="heading-9">3.1 方案选型对比</h3>
<p>在设计 Vite Plugin Modular 之前，我们评估了多种前端多模块开发方案，包括：</p>






























<table><thead><tr><th>方案</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td><strong>npm 组件库</strong></td><td>• 代码复用性高 • 版本管理清晰 • 可跨项目使用</td><td>• 发布流程繁琐 • 调试不便 • 依赖管理复杂 • 无法共享完整页面级功能 • 不适用于经常变更的业务需求</td></tr><tr><td><strong>Monorepo</strong></td><td>• 代码集中管理 • 版本统一管理 • 跨包依赖便捷</td><td>• 初始设置复杂 • 构建时间长 • 学习成本高 • 配置繁琐</td></tr><tr><td><strong>Vite 多页</strong></td><td>• 配置简单 • 共享依赖 • 构建性能好</td><td>• 页面级隔离，无法实现模块级隔离 • 环境配置管理复杂 • 缺乏统一的模块管理工具 • 开发环境 URL 需要指定到具体的 HTML 文件</td></tr><tr><td><strong>Vite Plugin Modular</strong></td><td>• 模块级隔离 • 多环境配置 • 命令行工具支持 • 快速开发构建 • 统一管理与代码复用</td><td>• 依赖 Vite 生态 • 对单模块项目优势不明显</td></tr></tbody></table>
<h3 data-id="heading-10">3.2 基于 Vite</h3>
<p>选择 Vite 作为基础构建工具，主要考虑以下因素：</p>
<ul>
<li><strong>快速的开发服务器</strong>：Vite 的开发服务器采用原生 ESM，启动速度极快，适合多模块开发场景</li>
<li><strong>优化的构建性能</strong>：使用 Rollup 进行生产构建，提供优秀的代码分割和 tree-shaking</li>
<li><strong>丰富的插件生态</strong>：Vite 拥有活跃的插件生态系统，便于扩展功能</li>
<li><strong>现代前端特性支持</strong>：内置对 TypeScript、JSX、CSS 预处理器等的支持</li>
<li><strong>环境变量处理</strong>：Vite 内置了环境变量处理机制，与我们的需求高度契合</li>
</ul>
<h3 data-id="heading-11">3.3 TypeScript 开发</h3>
<p>采用 TypeScript 进行开发，带来以下优势：</p>
<ul>
<li><strong>类型安全</strong>：提供静态类型检查，减少运行时错误</li>
<li><strong>更好的 IDE 支持</strong>：TypeScript 提供了更强大的代码补全和类型提示</li>
<li><strong>可维护性</strong>：类型定义使代码更易于理解和维护</li>
<li><strong>更好的重构支持</strong>：类型系统使重构更加安全和高效</li>
</ul>
<h3 data-id="heading-12">3.4 命令行工具选型</h3>
<p>命令行工具采用以下技术栈：</p>
<ul>
<li><strong>Commander.js</strong>：用于解析命令行参数和选项</li>
<li><strong>Inquirer.js</strong>：提供交互式命令行界面，提升用户体验</li>
<li><strong>Chalk</strong>：用于终端彩色输出，提高日志可读性</li>
<li><strong>Node.js 文件系统 API</strong>：用于文件和目录的操作</li>
</ul>
<h4 data-id="heading-13">命令行工具效果展示</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eaf9aadca624a3b93e2e110080eccbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=FsIJjnyAU20lEgfC7eI4oS6O77E%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">4. 实现原理与流程</h2>
<h3 data-id="heading-15">4.1 核心工作流程</h3>
<p>Vite Plugin Modular 的核心工作流程如下所示，通过 Vite 插件机制，在构建过程中动态解析模块和环境信息，实现模块化的配置管理和构建流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47663a285e6d4805a5e2858e67b13b46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=hXuGNbgf9%2BxugdvDGf7akVr3Gno%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">4.1.1 模块解析机制</h4>
<ol>
<li><strong>模式解析</strong>：通过 Vite 的 <code>mode</code> 参数，解析模块和环境信息。例如，当运行 <code>vite --mode module1-dev</code> 时，插件会自动解析出模块名称为 <code>module1</code>，环境为 <code>dev</code>。</li>
<li><strong>配置加载</strong>：根据解析出的模块名称，加载对应的模块配置。配置文件采用 JSONC 格式，支持注释，提高了可读性和可维护性。</li>
<li><strong>路径转换</strong>：根据模块配置，动态转换入口文件路径和输出目录路径。例如，将 <code>src/main.ts</code> 转换为 <code>src/modules/module1/main.ts</code>，将输出目录设置为 <code>dist/module1</code>。</li>
<li><strong>HTML 处理</strong>：通过 Vite 的 HTML 转换钩子，替换页面标题和入口脚本为模块配置的值，确保每个模块都有正确的页面标题和入口点。</li>
</ol>
<h4 data-id="heading-17">4.1.2 环境变量处理</h4>
<ol>
<li><strong>变量注入</strong>：将模块配置中的 <code>define</code> 字段转换为环境变量，通过 Vite 的 <code>define</code> 选项注入到代码中。例如，将 <code>{ "apiUrl": "https://api.example.com" }</code> 转换为 <code>import.meta.env.VITE_API_URL</code>。</li>
<li><strong>命名规范</strong>：自动将驼峰命名转换为蛇形命名，保持环境变量命名的一致性。例如，将 <code>apiUrl</code> 转换为 <code>VITE_API_URL</code>。</li>
<li><strong>环境覆盖</strong>：支持环境特定的变量覆盖，确保不同环境可以使用不同的变量值。</li>
</ol>
<h3 data-id="heading-18">4.2 命令行工具实现</h3>
<p>命令行工具（<code>vmod</code>）的实现基于以下核心流程：</p>
<ol>
<li><strong>命令注册</strong>：使用 Commander.js 注册各种模块管理命令，如 <code>add</code>、<code>delete</code>、<code>list</code>、<code>addEnv</code>、<code>deleteEnv</code> 等。</li>
<li><strong>交互式界面</strong>：使用 Inquirer.js 实现交互式命令行界面，在用户执行命令时提供智能提示和选择。</li>
<li><strong>文件操作</strong>：使用 Node.js 文件系统 API 进行文件和目录的操作，如创建模块目录、生成配置文件、复制模板文件等。</li>
<li><strong>配置管理</strong>：实现配置文件的读取、修改和写入，确保模块配置的一致性和完整性。</li>
<li><strong>命令生成</strong>：在添加模块或环境时，自动生成对应的 npm 脚本命令，方便用户运行和构建模块。</li>
</ol>
<h3 data-id="heading-19">4.3 与 Vite 的集成</h3>
<p>Vite Plugin Modular 与 Vite 的集成主要通过以下钩子实现：</p>
<ol>
<li><strong>config</strong>：在 Vite 配置阶段，修改配置对象，设置正确的入口文件路径、输出目录路径和环境变量。</li>
<li><strong>transformIndexHtml</strong>：在 HTML 转换阶段，替换页面标题和入口脚本为模块配置的值，确保每个模块都有正确的页面标题和入口点。</li>
</ol>
<p>这两个钩子是实际实现中使用的核心钩子，通过它们实现了模块解析、配置加载、路径转换和 HTML 处理等核心功能。</p>
<h3 data-id="heading-20">4.4 模块隔离机制</h3>
<p>Vite Plugin Modular 实现了模块间的隔离，确保各模块之间相互独立，避免代码冲突和依赖混乱：</p>
<ol>
<li><strong>目录隔离</strong>：每个模块都有自己的目录，独立存放源码和资源文件。</li>
<li><strong>配置隔离</strong>：每个模块都有自己的配置，支持不同的入口文件、输出目录和环境变量。</li>
<li><strong>依赖隔离</strong>：各模块共享项目级的依赖，但可以通过条件导入实现模块特定的依赖。</li>
<li><strong>构建隔离</strong>：每个模块的构建过程相互独立，避免构建过程中的相互影响。</li>
</ol>
<h2 data-id="heading-21">5. 与传统多项目方案的对比</h2>
<p>针对公司多产品、功能重复的场景，Vite Plugin Modular 与传统的多项目方案相比具有显著优势：</p>




























































<table><thead><tr><th>特性</th><th>传统多项目方案</th><th>Vite Plugin Modular</th></tr></thead><tbody><tr><td>项目结构</td><td>多个独立项目，各自维护</td><td>单个项目多模块结构，集中管理</td></tr><tr><td>功能变更</td><td>需要在多个项目中重复实现，耗费N倍人力</td><td>集中修改，所有模块自动同步更新</td></tr><tr><td>代码复用</td><td>复制粘贴或通过 npm 包共享，复用成本高</td><td>项目内直接共享代码，复用成本低</td></tr><tr><td>一致性保证</td><td>不同项目可能出现实现差异，用户体验不一致</td><td>统一实现，确保所有产品功能一致性</td></tr><tr><td>开发流程</td><td>多项目切换，上下文切换成本高</td><td>单项目内开发，流程简化</td></tr><tr><td>部署管理</td><td>每个项目独立部署，配置复杂</td><td>统一部署配置，模块化部署</td></tr><tr><td>环境配置</td><td>每个项目独立管理环境变量</td><td>统一环境管理，模块化配置</td></tr><tr><td>构建性能</td><td>每个项目独立构建，构建时间长</td><td>共享构建配置，优化构建性能</td></tr><tr><td>学习成本</td><td>新成员需要熟悉多个项目结构</td><td>只需熟悉一个项目结构和模块配置</td></tr><tr><td>扩展性</td><td>新增产品需要创建新项目，周期长</td><td>新增模块即可，快速响应业务需求</td></tr></tbody></table>
<h2 data-id="heading-22">5. 快速开始指南</h2>
<h3 data-id="heading-23">5.1 安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm</span>
npm install @ad-feiben/vite-plugin-modular --save-dev

<span class="hljs-comment"># 使用 yarn</span>
yarn add @ad-feiben/vite-plugin-modular -D

<span class="hljs-comment"># 使用 pnpm</span>
pnpm add @ad-feiben/vite-plugin-modular -D
</code></pre>
<h3 data-id="heading-24">5.2 配置</h3>
<ol>
<li><strong>初始化配置</strong></li>
</ol>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 使用 CLI 命令初始化</span>
npx vmod <span class="hljs-keyword">init</span>

<span class="hljs-meta"># 或使用简写</span>
npx vm <span class="hljs-keyword">init</span>
</code></pre>
<p>2.  <strong>在 vite.config.ts 中注册插件</strong></p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VitePluginModular</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ad-feiben/vite-plugin-modular'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">VitePluginModular</span>()
  ]
})
</code></pre>
<h3 data-id="heading-25">5.3 创建模块</h3>
<p>以下是创建模块的流程图，展示了从执行命令到模块创建完成的完整过程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6882c8c1a8014c679746c9270453caa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=3ruXL2mAhH0A2VCvZsQrgUhDAJA%3D" alt="" loading="lazy"/></p>
<p>以下是创建模块的实际效果展示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/288be5e087914a2f96bbbdcd8cf034e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=xnJSvF8aV4HCiJmlZxIGnJnIOEo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26">5.4 开发和构建</h3>
<p>创建模块后，Vite Plugin Modular 会自动生成对应的 npm 脚本命令：</p>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># 运行特定模块的开发服务器</span>
npm run dev<span class="hljs-operator">:</span>module1<span class="hljs-operator">-</span>dev

<span class="hljs-comment"># 构建特定模块的生产版本</span>
npm run build<span class="hljs-operator">:</span>module1<span class="hljs-operator">-</span><span class="hljs-built_in">prod</span>
</code></pre>
<h3 data-id="heading-27">5.5 目录结构</h3>
<p>创建模块后，会自动生成以下目录结构，保持代码组织清晰：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d46687f3cfa46abbe2aab0cf6051861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=Yc4EB5%2BqlZO%2FM8gebQ4mRazJwv8%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">src/modules/
├── module1/          <span class="hljs-comment"># 模块目录</span>
└── module2/
└── moduleN/
</code></pre>
<h2 data-id="heading-28">6. 适用场景</h2>
<p>Vite Plugin Modular 特别适合以下场景：</p>
<h3 data-id="heading-29">6.1 多产品公司</h3>
<p>对于拥有多个相关产品的公司，Vite Plugin Modular 可以将这些产品的前端代码整合到单个项目中，实现代码复用和统一管理。</p>
<h3 data-id="heading-30">6.2 微前端架构</h3>
<p>在微前端架构中，Vite Plugin Modular 可以作为微前端模块的开发和构建工具，简化模块的管理和部署。</p>
<h3 data-id="heading-31">6.3 企业内部系统</h3>
<p>企业内部通常有多个功能相关的系统（如 CRM、ERP、OA 等），Vite Plugin Modular 可以将这些系统的前端代码整合到单个项目中，提高开发和维护效率。</p>
<h3 data-id="heading-32">6.4 SaaS 产品</h3>
<p>对于 SaaS 产品，不同客户可能有不同的定制需求，Vite Plugin Modular 可以通过模块和环境的配置，轻松实现不同客户的定制版本。</p>
<h3 data-id="heading-33">6.5 快速原型开发</h3>
<p>在需要快速开发多个相关原型的场景中，Vite Plugin Modular 可以帮助开发者快速创建和管理多个原型模块，提高原型开发效率。</p>
<h2 data-id="heading-34">7. 未来规划</h2>
<p>Vite Plugin Modular 是一个持续发展的项目，我们计划在未来的版本中添加以下功能：</p>
<h3 data-id="heading-35">7.1 国际化支持</h3>
<ul>
<li>实现模块级别的国际化配置，支持不同模块使用不同的语言设置</li>
<li>提供多语言资源管理系统，方便管理和维护多语言内容</li>
<li>支持自动语言切换，根据用户环境或配置自动选择合适的语言</li>
</ul>
<h3 data-id="heading-36">7.2 UI 界面</h3>
<ul>
<li>开发可视化的模块管理界面，提供直观的模块创建、编辑、删除功能</li>
<li>实现配置编辑器，通过图形界面编辑模块配置，减少手动编辑配置文件的错误</li>
<li>提供实时预览功能，在修改配置后立即查看效果</li>
<li>集成项目状态监控，显示模块构建状态、依赖关系等信息</li>
<li>支持拖放操作，通过拖放方式管理模块间的依赖关系</li>
</ul>
<h3 data-id="heading-37">7.3 完善文档</h3>
<ul>
<li>编写详细的 API 文档，覆盖所有插件配置选项和命令行参数</li>
<li>提供全面的使用指南，包括快速开始、高级配置、最佳实践等</li>
<li>建立社区支持渠道，收集用户反馈和建议，持续改进插件功能</li>
</ul>
<h2 data-id="heading-38">结语</h2>
<p>Vite Plugin Modular 为前端多模块开发提供了一种全新的思路，通过将多个相关产品的功能模块整合到单个项目中，实现了代码的复用和统一管理，大幅降低了维护成本，提高了开发效率。它不仅是一个技术工具，更是一种前端工程化的最佳实践。</p>
<p>无论您是在开发多个相关产品，还是在构建微前端架构，Vite Plugin Modular 都能为您的项目带来显著的价值。我们相信，随着它的不断发展和完善，它将成为前端多模块开发的标准解决方案之一。</p>
<p>立即尝试 Vite Plugin Modular，体验前端模块化开发的新境界！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟]]></title>    <link>https://juejin.cn/post/7601075423003770916</link>    <guid>https://juejin.cn/post/7601075423003770916</guid>    <pubDate>2026-02-01T09:32:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003770916" data-draft-id="7601159804490907667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟"/> <meta itemprop="keywords" content="Cursor,AI编程,代码规范"/> <meta itemprop="datePublished" content="2026-02-01T09:32:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Genyuan的AI工程"/> <meta itemprop="url" content="https://juejin.cn/user/143390347639064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/143390347639064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Genyuan的AI工程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:32:08.000Z" title="Sun Feb 01 2026 09:32:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟</h2>
<p>大家好，我是 <strong>Genyuan</strong>。</p>
<p>在日常后端开发中，<strong>Code Review（CR）</strong> 是保障代码质量的关键环节。但在高频迭代的现实下，CR 正在变成一件<strong>高消耗、易疲劳、且质量高度依赖个人状态</strong>的事情。</p>
<p>在实际工程实践中我越来越明确一件事：</p>
<blockquote>
<p><strong>人类更擅长判断业务逻辑和上下文是否合理，但在重复性、规则性检查上，反而非常容易出错。</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>团队规范很多，但某一次 CR 很容易被忽略</li>
<li>空指针、边界判断、异常处理等低级问题，在连续 Review 时极易漏掉</li>
</ul>
<p>因此，我们在团队中引入了一种方式：<br/>
👉 <strong>先用 AI 做一轮前置 Code Review，再由人完成最终 Review。</strong></p>
<p>这篇文章记录的是我在团队中，<strong>使用 Cursor 提升 Code Review 效率的一次工程化实践</strong>。</p>
<hr/>
<h3 data-id="heading-1">一、问题背景：为什么人工 CR 越来越“累”</h3>
<p>在双周甚至更快的迭代节奏下，人工 CR 普遍面临这些问题：</p>
<ul>
<li>Review 时间长，精力消耗大</li>
<li>边界条件、异常分支检查容易疲劳</li>
<li>Review 质量随 Reviewer 状态波动</li>
</ul>
<p>尤其是一些<strong>业务价值不高，但线上风险极大</strong>的问题（如空指针、越界、异常处理），非常适合交给 AI 处理。</p>
<hr/>
<h3 data-id="heading-2">二、传统 CR 的局限</h3>
<p>不使用 AI 的情况下，CR 主要依赖：</p>
<ul>
<li>Reviewer 的个人经验</li>
<li>团队规范文档</li>
<li>口头或代码评审中的反复强调</li>
</ul>
<p>这会带来几个明显问题：</p>
<ul>
<li>新人学习成本高</li>
<li>代码量一大就容易漏审</li>
<li>难以形成统一、可复用、可持续演进的检查流程</li>
</ul>
<p>整体效率和稳定性都有限。</p>
<hr/>
<h3 data-id="heading-3">三、AI 介入方案：Cursor + 命令式 Review</h3>
<p>在多种尝试之后，我选择使用 <strong>Cursor</strong> 来辅助 Code Review。</p>
<blockquote>
<p>Cursor 自带的 <strong>Diff with Main</strong> 功能是可用的，但它更偏“个人工具”，<br/>
并不适合做 <strong>团队级、可维护、可演进</strong> 的 CR 流程。</p>
</blockquote>
<p>我的做法是：<br/>
👉 <strong>把 Code Review 这件事，封装成一个“命令”，让 AI 按统一规则执行。</strong></p>
<hr/>
<h3 data-id="heading-4">四、整体方案概览</h3>
<p>这套方案的核心是三点：</p>
<ol>
<li>用 <strong>review.md</strong> 统一定义 CR 规则</li>
<li>用 Cursor 的 <strong>Command + MCP Git</strong> 执行审查</li>
<li>输出 <strong>结构化 Review 报告</strong>，作为人工 CR 的前置输入</li>
</ol>
<hr/>
<h4 data-id="heading-5">1️⃣ 环境准备</h4>
<ul>
<li>Cursor <code>2.3.35 (Universal)</code></li>
<li>Git</li>
<li>MCP 中的 Git 工具</li>
</ul>
<p>Git MCP 配置示例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72e36db52ebf4c4299105cdf9c8adb3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=pDrql8wg9Yi%2BWlS9k2wdi4Qo%2BBE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"git"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-server-git"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">2️⃣ Review 规则维护</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d3ffcae90eb44c2be4f96b8842497b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=hlCuLPSgu8az1VGHsGUG%2BVbqzMM%3D" alt="image.png" loading="lazy"/></p>
<p>所有 CR 规则统一维护在 <code>review.md</code> 中：</p>
<p>👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FApolloNaco%2FAITools%2Fblob%2Fmain%2Freview.md" target="_blank" title="https://github.com/ApolloNaco/AITools/blob/main/review.md" ref="nofollow noopener noreferrer">github.com/ApolloNaco/…</a></p>
<p>核心思想只有一句话：</p>
<blockquote>
<p><strong>把“人脑里的 Review 经验”，写成 AI 可以稳定执行的规则。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-7">五、如何执行 AI Review 命令</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b9d963dcfd4a76a9d913b8c5193ec7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=goZR9hhWVbDReIizgvf9Acmssr0%3D" alt="image.png" loading="lazy"/>
有了 <code>review.md</code> 规则后，团队成员只需运行一个命令，即可让 Cursor 按规则执行 AI Code Review。</p>
<pre><code class="hljs language-bash" lang="bash">/review --b 当前分支
</code></pre>
<h4 data-id="heading-8">执行流程说明</h4>
<ol>
<li>
<p><strong>指定分支</strong></p>
<ul>
<li>
<p><code>--b 当前分支</code>：对当前开发分支进行审查</p>
</li>
<li>
<p>可选参数：</p>
<ul>
<li><code>-o</code>：输出报告</li>
<li><code>--file</code>：审查指定文件</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>AI 自动执行规则</strong></p>
<ul>
<li>读取 <code>review.md</code> 中定义的规则</li>
<li>按文件类型过滤</li>
<li>对代码进行规范检查、问题分级分析</li>
</ul>
</li>
<li>
<p><strong>生成结构化报告</strong></p>
<ul>
<li>包含变更分析、问题列表、风险评估和合入建议</li>
<li>输出到 Terminal，也可直接同步到 PR 评论或 CI</li>
</ul>
</li>
<li>
<p><strong>开发者操作简化</strong></p>
<ul>
<li>不需要手动比对 diff</li>
<li>不需要逐行检查低级错误</li>
<li>人只需聚焦 <strong>业务逻辑和架构决策</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>执行一次命令，即可完成前置 AI 审查，保证低级错误被拦截，同时提高 Review 效率和一致性。</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">Review Command 的核心设计</h3>
<h4 data-id="heading-10">① Git 命令执行规范（最关键）</h4>
<p><strong>问题：</strong><br/>
Git 命令在 Cursor 中非常容易被分页器（pager）卡住，导致流程失败。</p>
<p><strong>解决方式：</strong></p>
<ul>
<li>使用 <code>git --no-pager</code></li>
<li>统一通过 Cursor 内置 <code>run_terminal_cmd</code> 执行</li>
<li>从命令输出中按需提取信息</li>
</ul>
<p>👉 如果不处理这个问题，AI CR 基本不可用。</p>
<hr/>
<h4 data-id="heading-11">② 文件范围控制</h4>
<p>只审查以下文件：</p>
<ul>
<li><code>.java</code></li>
<li><code>.xml</code></li>
<li><code>.properties</code></li>
</ul>
<p>目的只有一个：<br/>
👉 <strong>聚焦真正影响逻辑和行为的代码，提高审查效率。</strong></p>
<hr/>
<h4 data-id="heading-12">③ 团队规范检查（强约束）</h4>
<p>在 <code>review.md</code> 中的：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">## 团队规范检查</span></span>
</code></pre>
<p>这个模块下，由技术 Leader 维护<strong>必须被拦截的问题</strong>，例如：</p>
<ul>
<li>方法 / Map key-value 是否强制注释</li>
<li>是否存在应抽取却未抽取的公共逻辑</li>
<li>是否存在冗余 if/else 分支</li>
<li>URL / 配置是否走统一封装</li>
</ul>
<p><strong>原则很简单：</strong></p>
<blockquote>
<p>这些问题一旦出现，就不能被合入。</p>
</blockquote>
<hr/>
<h4 data-id="heading-13">④ 问题分级机制</h4>
<p>在规则中明确问题优先级：</p>
<ul>
<li><strong>严重问题</strong>：线程安全、内存泄漏、安全漏洞、架构违规</li>
<li><strong>中等问题</strong>：性能问题、异常处理、数据一致性</li>
<li><strong>轻微问题</strong>：规范、可读性、可维护性</li>
</ul>
<p>这样可以让：</p>
<ul>
<li>AI 自动聚焦重点</li>
<li>人类 Reviewer 快速扫高风险问题</li>
</ul>
<p>避免被细节淹没。</p>
<hr/>
<h4 data-id="heading-14">⑤ 统一审查报告输出</h4>
<p>AI 最终输出结构化 Review 报告，包括：</p>
<ul>
<li>变更内容分析</li>
<li>问题列表（按严重程度）</li>
<li>风险评估</li>
<li>合入建议</li>
</ul>
<p>可以直接同步到 PR 评论或 CI 流程中。</p>
<hr/>
<h3 data-id="heading-15">六、实际效果</h3>
<p>在真实项目中的效果非常直观：</p>
<ul>
<li><strong>单次 Review 时间</strong>：30–45 分钟 → 10–15 分钟</li>
<li>命名、规范、空指针等低级问题几乎被完全拦截</li>
<li>新同学可以快速对齐团队规范</li>
<li>Review 质量明显更稳定</li>
</ul>
<p>组内反馈非常一致：</p>
<blockquote>
<p>“不用 Cursor 做辅助，Review 会明显更累。”</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">七、团队如何落地这套方案</h3>
<h4 data-id="heading-17">1️⃣ 技术 Leader 如何维护</h4>
<p>Leader 只需要维护两块内容：</p>
<ul>
<li><strong>团队规范检查</strong>：定义哪些问题必须被拦截</li>
<li><strong>问题分级规则</strong>：决定哪些问题必须优先处理</li>
</ul>
<p>本质上是把 <strong>Leader 的经验工程化</strong>。</p>
<hr/>
<h4 data-id="heading-18">2️⃣ 团队成员如何使用</h4>
<ul>
<li>同步最新 <code>review.md</code></li>
<li>写完模块后，先执行一次 AI CR</li>
<li>修掉低级错误，再提 PR</li>
</ul>
<p>👉 把问题拦在最早的阶段。</p>
<hr/>
<h4 data-id="heading-19">3️⃣ 工作流嵌入</h4>
<ul>
<li>AI Review 输出直接同步到 PR 评论</li>
<li>作为人工 CR 的前置输入</li>
<li>形成半自动 Code Review 流程</li>
</ul>
<hr/>
<h3 data-id="heading-20">八、为什么我认为这套方案在工程上是“对的”</h3>
<p>这不是功能堆砌，而是几条清晰的设计原则：</p>
<ol>
<li>
<p>写成了命令风格，对开发友好。只需要按照提示敲命令即可。例如：<code>/review --b -o [需要CR的分支]</code></p>
</li>
<li>
<p>用了Cursor AI的内置函数 <code>run_terminal_cmd</code> 提高执行效率</p>
</li>
<li>
<p>解决了cursor调git命令发生的常见问题：</p>
<ol>
<li>引入Git MCP</li>
<li><code>git --no-pager [command]</code> 处理代码时的分页问题</li>
<li><code>git fetch --all --prune</code> 避免了 CR的分支代码没有和最新的master分支对比的问题（多人开发尤其容易出现这个问题）</li>
</ol>
</li>
<li>
<p>设置了“团队规范检查”点，你可以在这个模块下写你们团队的常见团队规范，让AI在代码CR的时候帮你发现问题</p>
</li>
<li>
<p>设置严格的问题分级，可以聚焦重点问题的处理。</p>
</li>
<li>
<p>可以让AI最后分析的结果输出报告，集成到你们企业的CI/CD流程中。</p>
</li>
<li>
<p>让团队成员在每次写完代码之后，都先自己用AI CR一遍，把常见的团队问题和代码规范、低级错误自己先通过AICR的方式去避免。</p>
</li>
</ol>
<blockquote>
<p><strong>人负责判断业务和架构，AI 负责拦截低级错误。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-21">九、不足与后续规划</h3>
<p>目前这套 AI CR 仍有明显边界：</p>
<ul>
<li>无法校验真实业务逻辑是否正确</li>
<li>无法判断代码是否与项目结构匹配</li>
<li>团队级命令需要统一同步机制</li>
</ul>
<p>这些问题，我会在后续文章中展开</p>
<hr/>
<p><strong>Genyuan</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Obsidian 使用指南：从零开始搭建你的个人知识库]]></title>    <link>https://juejin.cn/post/7601313474719121443</link>    <guid>https://juejin.cn/post/7601313474719121443</guid>    <pubDate>2026-02-01T07:00:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719121443" data-draft-id="7601076815449997327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Obsidian 使用指南：从零开始搭建你的个人知识库"/> <meta itemprop="keywords" content="笔记,笔记测评"/> <meta itemprop="datePublished" content="2026-02-01T07:00:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BugShare"/> <meta itemprop="url" content="https://juejin.cn/user/4469992354742361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Obsidian 使用指南：从零开始搭建你的个人知识库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4469992354742361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BugShare
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:00:48.000Z" title="Sun Feb 01 2026 07:00:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>我并不认为 Obsidian 是一款使用门槛很高的软件。</strong>
事实上，只使用 Obsidian 自带的核心功能，就已经可以非常高效地管理我们的笔记与知识。</p>
<p>写这篇文章的目的也很简单：
👉 <strong>希望刚接触，或还没有接触 Obsidian 的朋友，可以通过这篇文章快速上手这款软件。</strong></p>
<p>不讲复杂理论，不强推插件，只讲真正「一上手就能用」的部分。</p>
<hr/>
<h2 data-id="heading-0">一、安装</h2>
<p>Obsidian 是一款跨平台的本地笔记软件，支持 macOS / Windows / Linux / iOS / Android。</p>
<p>官方下载地址：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fobsidian.md" target="_blank" title="https://obsidian.md" ref="nofollow noopener noreferrer">obsidian.md</a></p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/dab1af8e-df63-48f6-8ffe-916909469776.png" alt="screenshot-1.0-hero-combo.png" loading="lazy"/></p>
<p>下载安装到本地即可，无需注册账号也能直接使用。</p>
<hr/>
<h2 data-id="heading-1">二、仓库（Vault）</h2>
<p>在 Obsidian 中，<strong>仓库（Vault）本质上就是一个普通文件夹</strong>，你的所有笔记都会以 Markdown 文件的形式存放在这里。</p>
<blockquote>
<p>如果你使用的是 Mac，非常推荐把仓库位置放在 iCloud 中，方便多设备同步。</p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/55eb70a7-5ecf-4251-81bc-a6a495be7618.png" alt="PixPin_2026-01-31_19-45-11.png" loading="lazy"/></p>
<p>优点只有一句话：
👉 <strong>数据完全属于你，不被任何平台绑定。</strong></p>
<hr/>
<h2 data-id="heading-2">三、布局</h2>
<h3 data-id="heading-3">1. 堆叠标签页</h3>
<p>如果你已经看腻了传统浏览器式的标签页布局，可以试试 <strong>堆叠标签页</strong>，整体视觉会更紧凑，也更有“工作区”的感觉。</p>
<p><img src="http://openwrite.cn/uploads/19748/59215/7978c0e9-edd6-4539-bff1-58c6f767a0a7.png" alt="1769862805965.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">2. 自由拖动标签</h3>
<ul>
<li>支持通过鼠标自由拖动标签页位置</li>
<li>可以分屏、上下或左右排列</li>
</ul>
<p>💡 <strong>Tips</strong>
当你调整好一个顺手的布局后，记得保存下来，后面可以一键恢复（下面的「工作区」插件会讲）。</p>
<p><img src="http://openwrite.cn/uploads/19748/59215/6f4a09aa-7794-4075-8592-50b72acccfd7.png" alt="PixPin_2026-01-31_20-40-24.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">四、笔记</h2>
<h3 data-id="heading-6">1. 创建笔记</h3>
<p>强烈建议你从一开始就 <strong>养成添加笔记属性（Frontmatter）</strong> 的习惯。</p>
<ul>
<li>在笔记中输入 <code>---</code></li>
<li>然后敲回车</li>
<li>Obsidian 会自动生成属性区域</li>
<li>点击最左侧图标可以选择属性类型
<img src="http://openwrite.cn/uploads/19748/59215/060a3e44-4168-40d6-9f2b-f607ce515f84.png" alt="PixPin_2026-01-31_21-55-18.png" loading="lazy"/></li>
</ul>
<p>这一步会在后期做检索、分类、自动化时非常有价值。</p>
<hr/>
<h3 data-id="heading-7">2. 出链与反链</h3>
<p>这是 Obsidian 最核心、也是最有价值的能力之一。</p>
<ul>
<li>输入 <code>[[</code> 即可创建或引用笔记</li>
<li>跳转到目标笔记后，可以看到哪些笔记引用了它（反链）</li>
<li><strong>即使没有显式加链接，只要提到了笔记名称，也会被识别</strong></li>
<li>当前笔记中还能发现「潜在链接」
<img src="http://openwrite.cn/uploads/19748/59215/59e532c6-02af-48a6-a6a1-8998fb14e4ec.png" alt="1769869292611.png" loading="lazy"/></li>
</ul>
<p>一句话总结：
👉 <strong>笔记之间会自然“长”成一张知识网络。</strong></p>
<hr/>
<h3 data-id="heading-8">3. 命令面板</h3>
<p>如果你记不住快捷键或语法，命令面板几乎可以解决 90% 的问题。</p>
<ul>
<li>左侧栏点击图标打开</li>
<li>或使用快捷键：<code>Command + P</code>
<img src="http://openwrite.cn/uploads/19748/59215/21b156f3-b158-4625-95fe-555772a81656.png" alt="PixPin_2026-01-31_22-40-33.png" loading="lazy"/></li>
</ul>
<p>很多功能你根本不需要记，只需要 <strong>会搜索</strong>。</p>
<hr/>
<h2 data-id="heading-9">五、语法</h2>
<h3 data-id="heading-10">1. 链接语法</h3>
<ul>
<li>使用 <code>|</code> 设置别名
<code>[[我的第二篇笔记|自定义名称]]</code></li>
<li>使用 <code>#</code> 定位到标题
<code>[[我的第二篇笔记#标题1]]</code></li>
<li>使用 <code>^</code> 定位到具体段落
<code>[[我的第二篇笔记^第二篇笔记的一句话]]</code>
<img src="http://openwrite.cn/uploads/19748/59215/ee0f1f3f-af28-441a-af03-033b8e05ecd2.png" alt="PixPin_2026-02-01_01-29-53.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-11">2. 嵌入笔记</h3>
<p>在链接前加一个 <code>!</code>，即可把内容直接嵌入当前笔记。</p>
<ul>
<li>嵌入整篇笔记
<code>![[我的第二篇笔记]]</code></li>
<li>嵌入某个标题
<code>![[我的第二篇笔记#标题1]]</code></li>
<li>嵌入某一段内容
<code>![[我的第二篇笔记^第二篇笔记的一句话]]</code>
<img src="http://openwrite.cn/uploads/19748/59215/a75bab02-1273-47a8-9b3f-64538a115e4d.png" alt="PixPin_2026-02-01_01-35-51.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-12">3. 外部链接</h3>
<p>标准 Markdown 语法：</p>
<pre><code class="hljs language-markdown" lang="markdown">[<span class="hljs-string">bugshare</span>](<span class="hljs-link">https://www.bugshare.cn</span>)
</code></pre>
<p><img src="http://openwrite.cn/uploads/19748/59215/0417ea81-8399-423f-9d9f-a9c5b09b5b37.png" alt="PixPin_2026-02-01_01-39-28.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">4. 其它常用语法</h3>
<ul>
<li>高亮：<code>==高亮内容==</code></li>
<li>加粗：<code>**加粗**</code> 或 <code>__加粗__</code></li>
<li>斜体：<code>*斜体*</code> 或 <code>_斜体_</code></li>
<li>删除线：<code>~~删除线~~</code></li>
<li>无序列表：<code>- </code></li>
<li>有序列表：<code>1. </code></li>
<li>待办事项：<code>- [ ] 任务</code></li>
<li>引用：<code>&gt; </code></li>
<li>标注块：
<code>&gt; [!NOTE]</code>
<code>&gt; [!SUCCESS]</code></li>
<li>注释：
<code>[^1]</code>
<code>^[这是注释]</code></li>
<li>表格：命令面板搜索「插入表格」
<img src="http://openwrite.cn/uploads/19748/59215/76fab748-9161-4c8f-a912-df86d86ba2da.png" alt="PixPin_2026-02-01_13-16-59.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-14">六、核心插件（强烈建议启用）</h2>
<blockquote>
<p>这里必须强调一句：
<strong>真的没必要 All in One。</strong>
不要把时间浪费在折腾插件上，有需求再装插件，别问我为什么 😖</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">1. 工作区</h3>
<p>用于保存和快速切换布局。</p>
<ul>
<li>设置 → 核心插件 → 工作区 → 启用</li>
<li>左侧会出现「工作区」图标</li>
<li>给当前布局起个名字即可保存
<img src="http://openwrite.cn/uploads/19748/59215/a02d3c58-5a87-46aa-a5f2-489c003f269a.png" alt="PixPin_2026-01-31_21-08-07.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-16">2. 白板</h3>
<p>适合做结构梳理、思维发散。</p>
<ul>
<li>设置 → 核心插件 → 白板 → 启用
<img src="http://openwrite.cn/uploads/19748/59215/a47efa8c-91bd-437e-8b1c-3a762b57f74b.png" alt="PixPin_2026-01-31_23-01-57.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-17">3. 关系图谱</h3>
<p>可以非常直观地看到你的知识是如何一步步生长的。</p>
<ul>
<li>设置 → 核心插件 → 关系图谱 → 启用</li>
<li>打开「生长动画」效果更明显
<img src="http://openwrite.cn/uploads/19748/59215/4f231824-a728-42a8-9186-c25186ed0b0c.png" alt="PixPin_2026-01-31_23-21-06.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-18">4. 模板</h3>
<p>用于快速创建统一结构的笔记。</p>
<ul>
<li>设置 → 核心插件 → 模板 → 启用
<img src="http://openwrite.cn/uploads/19748/59215/0ea9cb73-4bc9-4d23-80e0-b84ee0f1fea6.png" alt="PixPin_2026-01-31_23-54-46.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-19">七、第三方插件（按需）</h2>
<p>首次使用需要关闭「安全模式」。</p>
<p>插件推荐网站：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fobsidian.md%2Fplugins" target="_blank" title="https://obsidian.md/plugins" ref="nofollow noopener noreferrer">obsidian.md/plugins</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpkmer.cn%2Fproducts%2Fplugin%2FpluginMarket" target="_blank" title="https://pkmer.cn/products/plugin/pluginMarket" ref="nofollow noopener noreferrer">pkmer.cn/products/pl…</a></p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/2733e0f7-59c0-49db-b7be-8d12e1923f55.png" alt="PixPin_2026-02-01_12-47-01.png" loading="lazy"/></p>
<h3 data-id="heading-20">推荐插件（只列我觉得<strong>真的有用的</strong>）</h3>
<ul>
<li><strong>Iconize</strong>：自定义文件夹图标</li>
<li><strong>Link Favicons</strong>：外部链接显示站点图标</li>
<li><strong>Novel Word Count</strong>：统计文件夹内笔记数量与字数</li>
<li><strong>Number Headings</strong>：自动给多级标题编号</li>
<li><strong>Excalidraw</strong>：在笔记中嵌入手绘图</li>
<li><strong>Git</strong>：自动提交、拉取、推送笔记版本</li>
</ul>
<hr/>
<h2 data-id="heading-21">八、快捷键</h2>
<h3 data-id="heading-22">常用快捷键</h3>
<ul>
<li><code>Command + O</code>：快速切换笔记</li>
<li><code>Command + P</code>：命令面板</li>
</ul>
<h3 data-id="heading-23">自定义快捷键</h3>
<ul>
<li>设置 → 快捷键</li>
<li>搜索操作 → 添加快捷键</li>
<li>按下你想要的组合即可
<img src="http://openwrite.cn/uploads/19748/59215/0c872634-ad4a-46f4-a1a4-78136f23b28a.png" alt="PixPin_2026-01-31_23-21-55.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-24">写在最后</h2>
<p>如果你是第一次使用 Obsidian，我的建议只有一句话：</p>
<blockquote>
<p><strong>先用起来，再慢慢优化。</strong></p>
</blockquote>
<p>笔记系统不是一次性设计出来的，而是在长期使用中不断演化的。
Obsidian 的价值，也正是在于它给了你这种「自由生长」的空间。</p>
<p>后续分享 《Obsidian 怎么使用 Claude Code》，欢迎关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入了解 GitHub CLI（`gh`）的前世今生]]></title>    <link>https://juejin.cn/post/7601103779392782399</link>    <guid>https://juejin.cn/post/7601103779392782399</guid>    <pubDate>2026-02-01T07:15:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601103779392782399" data-draft-id="7601073900525879338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入了解 GitHub CLI（`gh`）的前世今生"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-02-01T07:15:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8491371754716"/> <meta itemprop="url" content="https://juejin.cn/user/2744800640504071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入了解 GitHub CLI（`gh`）的前世今生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2744800640504071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8491371754716
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:15:20.000Z" title="Sun Feb 01 2026 07:15:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从网页点击到命令行操作，GitHub CLI 如何彻底改变了开发者与 GitHub 的交互方式？</p>
</blockquote>
<h2 data-id="heading-0">引言</h2>
<p>在日常开发中，你是否经常需要在浏览器和终端之间来回切换？创建 Pull Request 需要打开网页、查看 Issue 需要打开网页、合并代码还是需要打开网页……这种繁琐的工作流程不仅打断开发思路，更大大降低了工作效率。</p>
<p>本文将带你深入了解 GitHub CLI（<code>gh</code>）的前世今生，从它的诞生背景到核心设计，再到实际应用场景。阅读本文，你将学到：</p>
<ul>
<li>GitHub CLI 诞生的历史背景和设计理念</li>
<li><code>gh</code> 命令的核心架构和功能模块</li>
<li>从基础操作到高级工作流的实战技巧</li>
<li>如何通过 <code>gh</code> 提升团队协作效率</li>
</ul>
<h2 data-id="heading-1">历史背景：从网页到命令行</h2>
<h3 data-id="heading-2">前传：Web 时代的局限</h3>
<p>在 Git 诞生后的很长一段时间里，开发者与 GitHub 的交互模式是分裂的：</p>
<ul>
<li><strong>代码管理</strong>：通过 <code>git</code> 命令在终端完成</li>
<li><strong>协作管理</strong>：通过浏览器在 GitHub 网页完成</li>
</ul>
<p>这种分裂模式带来了明显的痛点：</p>
<ol>
<li><strong>上下文切换频繁</strong>：从终端到浏览器，打断开发心流</li>
<li><strong>操作效率低下</strong>：创建 PR、查看 Issue 等操作需要多次点击</li>
<li><strong>自动化困难</strong>：网页操作难以脚本化</li>
<li><strong>远程协作受限</strong>：SSH 环境下无法使用网页界面</li>
</ol>
<h3 data-id="heading-3">GitHub CLI 的诞生</h3>
<p><strong>2020年9月</strong>，GitHub CLI 1.0 正式发布，代号 <code>gh</code>。它的设计理念非常明确：</p>
<blockquote>
<p><strong>"将 GitHub 的所有功能带到终端"</strong></p>
</blockquote>
<p><strong>关键里程碑</strong>：</p>





























<table><thead><tr><th>时间</th><th>事件</th></tr></thead><tbody><tr><td>2020年5月</td><td>GitHub CLI 的 beta 版开始发布（0.x 系列版本）</td></tr><tr><td>2020年9月</td><td><strong>正式发布 GitHub CLI 1.0 稳定版本</strong>，支持核心功能如 PR、Issue、Repo、API 等</td></tr><tr><td>2021年8月</td><td><strong>GitHub CLI 2.0 发布</strong>，增加扩展支持，使用户可创建/安装自定义命令</td></tr><tr><td>2021-2022年</td><td>持续发布 2.x 系列版本，功能更加成熟和完善（包含 Actions 支持、增强命令等）</td></tr><tr><td>2023年至今</td><td>2.x 系列持续更新（引入更多功能、优化 UX、增强 API 支持等）</td></tr></tbody></table>
<h2 data-id="heading-4">核心架构设计</h2>
<h3 data-id="heading-5">整体架构</h3>
<p><code>gh</code> 采用了<strong>模块化插件架构</strong>设计：</p>
<pre><code class="hljs language-bash" lang="bash">gh (核心)
├── auth       <span class="hljs-comment"># 认证模块</span>
├── repo       <span class="hljs-comment"># 仓库操作</span>
├── <span class="hljs-built_in">pr</span>         <span class="hljs-comment"># Pull Request 管理</span>
├── issue      <span class="hljs-comment"># Issue 管理</span>
├── api        <span class="hljs-comment"># 通用 API 调用</span>
├── gist       <span class="hljs-comment"># Gist 管理</span>
├── workflow   <span class="hljs-comment"># GitHub Actions</span>
└── extensions <span class="hljs-comment"># 扩展系统</span>
</code></pre>
<p><strong>设计亮点</strong>：</p>
<ol>
<li><strong>统一认证机制</strong>：一次登录，全局使用</li>
<li><strong>RESTful API 封装</strong>：所有操作最终调用 GitHub REST API</li>
<li><strong>可扩展架构</strong>：支持自定义扩展命令</li>
<li><strong>跨平台支持</strong>：Linux、macOS、Windows 全覆盖</li>
</ol>
<h3 data-id="heading-6">核心原理</h3>
<p><code>gh</code> 的工作流程可以概括为以下四步：</p>
<pre><code class="hljs">用户输入命令 → 参数解析 → API 调用 → 结果格式化 → 终端输出
</code></pre>
<p><strong>示例</strong>：当你执行 <code>gh pr list</code> 时，幕后发生的事情：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 解析命令</span>
<span class="hljs-comment"># 2. 调用 GitHub API: GET /repos/{owner}/{repo}/pulls</span>
<span class="hljs-comment"># 3. 解析 JSON 响应</span>
<span class="hljs-comment"># 4. 格式化输出为表格</span>
</code></pre>
<h2 data-id="heading-7">核心功能详解</h2>
<h3 data-id="heading-8">0. 快速安装</h3>
<p>在开始使用之前，需要先安装 <code>gh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS（推荐使用 Homebrew）</span>
brew install gh

<span class="hljs-comment"># Windows（推荐使用 Winget）</span>
winget install --<span class="hljs-built_in">id</span> GitHub.cli

<span class="hljs-comment"># Linux（使用包管理器）</span>
<span class="hljs-comment"># Ubuntu/Debian</span>
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo <span class="hljs-built_in">dd</span> of=/usr/share/keyrings/githubcli-archive-keyring.gpg
<span class="hljs-built_in">echo</span> <span class="hljs-string">"deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/github-cli.list &gt; /dev/null
sudo apt update
sudo apt install gh

<span class="hljs-comment"># 验证安装</span>
gh --version
</code></pre>
<h3 data-id="heading-9">1. 认证系统</h3>
<p><code>gh</code> 的认证机制设计得非常优雅：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方式：手动配置 Token（繁琐）</span>
git config --global github.token xxx

<span class="hljs-comment"># gh 的方式：交互式登录（简单）</span>
gh auth login
</code></pre>
<p><strong>认证流程</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 步骤1：启动登录</span>
gh auth login

<span class="hljs-comment"># 步骤2：选择认证方式</span>
? What account <span class="hljs-keyword">do</span> you want to <span class="hljs-built_in">log</span> into?
  &gt; GitHub.com
    GitHub Enterprise Server

<span class="hljs-comment"># 步骤3：选择认证协议</span>
? What is your preferred protocol <span class="hljs-keyword">for</span> Git operations?
  &gt; HTTPS
    SSH

<span class="hljs-comment"># 步骤4：浏览器确认</span>
<span class="hljs-comment"># 自动打开浏览器，一键授权</span>

<span class="hljs-comment"># 步骤5：完成</span>
✓ Logged <span class="hljs-keyword">in</span> as username
</code></pre>
<p><strong>技术实现</strong>：使用 OAuth 2.0 协议，支持设备流和浏览器授权两种方式。</p>
<h3 data-id="heading-10">2. Pull Request 工作流</h3>
<p>这是 <code>gh</code> 最核心、最常用的功能。</p>
<h4 data-id="heading-11">创建 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方式（需要多步操作）</span>
git push origin feature-branch
<span class="hljs-comment"># 然后打开浏览器</span>
<span class="hljs-comment"># 点击 "Compare &amp; pull request"</span>
<span class="hljs-comment"># 填写标题、描述</span>
<span class="hljs-comment"># 点击 "Create pull request"</span>

<span class="hljs-comment"># gh 方式（一行命令）</span>
gh <span class="hljs-built_in">pr</span> create --title <span class="hljs-string">"添加新功能"</span> --body <span class="hljs-string">"详细描述"</span>
</code></pre>
<p><strong>完整示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 切换到新分支</span>
git checkout -b feature/user-auth

<span class="hljs-comment"># 2. 提交代码</span>
git add .
git commit -m <span class="hljs-string">"添加用户认证功能"</span>
git push origin feature/user-auth

<span class="hljs-comment"># 3. 创建 PR</span>
gh <span class="hljs-built_in">pr</span> create \
  --title <span class="hljs-string">"feat: 添加用户认证功能"</span> \
  --body <span class="hljs-string">"## 功能说明
- 实现了用户登录
- 添加了 Token 认证

## 测试
已通过单元测试和集成测试

## 截图
![功能截图](https://...)"</span> \
  --base main \
  --reviewer @team-leader
</code></pre>
<h4 data-id="heading-12">查看 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有 PR</span>
gh <span class="hljs-built_in">pr</span> list

<span class="hljs-comment"># 输出示例（简化格式）：</span>
<span class="hljs-comment"># #23  修复登录Bug              user1  2 hours ago</span>
<span class="hljs-comment"># #22  添加新功能               user2  1 day ago</span>
<span class="hljs-comment"># #21  更新文档                 user3  2 days ago</span>

<span class="hljs-comment"># 查看 PR 详情</span>
gh <span class="hljs-built_in">pr</span> view 23

<span class="hljs-comment"># 在浏览器中打开</span>
gh <span class="hljs-built_in">pr</span> view 23 --web

<span class="hljs-comment"># 筛选特定状态的 PR</span>
gh <span class="hljs-built_in">pr</span> list --state open --author <span class="hljs-string">"@me"</span>
</code></pre>
<h4 data-id="heading-13">审查和合并 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看变更（类似 git diff）</span>
gh <span class="hljs-built_in">pr</span> diff 23

<span class="hljs-comment"># 添加评论</span>
gh <span class="hljs-built_in">pr</span> comment 23 --body <span class="hljs-string">"这个地方可以优化"</span>

<span class="hljs-comment"># 批准 PR</span>
gh <span class="hljs-built_in">pr</span> review 23 --approve

<span class="hljs-comment"># 请求变更</span>
gh <span class="hljs-built_in">pr</span> review 23 --request-changes --body <span class="hljs-string">"需要修改XX"</span>

<span class="hljs-comment"># 合并 PR</span>
gh <span class="hljs-built_in">pr</span> merge 23 --squash --delete-branch
</code></pre>
<h3 data-id="heading-14">3. Issue 管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 Issue</span>
gh issue create \
  --title <span class="hljs-string">"Bug: 用户无法登录"</span> \
  --body <span class="hljs-string">"## 复现步骤
1. 打开登录页面
2. 输入密码
3. 点击登录

## 期望
登录成功

## 实际
提示密码错误"</span> \
  --label bug,high-priority

<span class="hljs-comment"># 列出 Issue</span>
gh issue list --label bug --state open

<span class="hljs-comment"># 查看 Issue</span>
gh issue view 42

<span class="hljs-comment"># 在本地编辑 Issue</span>
gh issue edit 42 --add-label <span class="hljs-string">"in-progress"</span>
</code></pre>
<h3 data-id="heading-15">4. 仓库操作</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建仓库</span>
gh repo create my-awesome-project --public --<span class="hljs-built_in">source</span>=. --remote=origin

<span class="hljs-comment"># Fork 仓库</span>
gh repo fork username/repo

<span class="hljs-comment"># Clone 仓库</span>
gh repo <span class="hljs-built_in">clone</span> username/repo

<span class="hljs-comment"># 设置仓库可见性</span>
gh repo edit --visibility private
</code></pre>
<h3 data-id="heading-16">5. Actions 工作流</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看工作流运行记录</span>
gh run list

<span class="hljs-comment"># 查看特定运行详情</span>
gh run view 456

<span class="hljs-comment"># 查看运行日志</span>
gh run view 456 --<span class="hljs-built_in">log</span>

<span class="hljs-comment"># 重新运行失败的 workflow</span>
gh run rerun 456

<span class="hljs-comment"># 监控运行（实时输出）</span>
gh run watch
</code></pre>
<h3 data-id="heading-17">6. API 调用</h3>
<p>这是 <code>gh</code> 最强大的功能之一，允许你直接调用 GitHub API：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取用户信息</span>
gh api /users/octocat

<span class="hljs-comment"># 创建 Release</span>
gh api \
  --method POST \
  -H <span class="hljs-string">"Accept: application/vnd.github.v3+json"</span> \
  /repos/owner/repo/releases \
  -f tag_name=v1.0.0 \
  -f name=<span class="hljs-string">"v1.0.0"</span> \
  -f body=<span class="hljs-string">"发布说明"</span>

<span class="hljs-comment"># 查询 GraphQL API</span>
gh api graphql \
  -f query=<span class="hljs-string">'
    query {
      viewer {
        login
        contributionsCollection {
          totalCommitContributions
        }
      }
    }'</span>
</code></pre>
<h2 data-id="heading-18">实战应用场景</h2>
<h3 data-id="heading-19">场景一：高效的 PR 工作流</h3>
<p><strong>问题</strong>：每天需要处理大量 PR，在网页和终端之间切换非常累。</p>
<p><strong>解决方案</strong>：使用 <code>gh</code> 的组合命令</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看需要我审核的 PR</span>
gh <span class="hljs-built_in">pr</span> list --search <span class="hljs-string">"review-requested:@me"</span>

<span class="hljs-comment"># 2. 查看 PR 的代码变更</span>
gh <span class="hljs-built_in">pr</span> diff 123

<span class="hljs-comment"># 3. 如果没问题，直接批准</span>
gh <span class="hljs-built_in">pr</span> review 123 --approve -b <span class="hljs-string">"LGTM!"</span>

<span class="hljs-comment"># 4. 合并 PR</span>
gh <span class="hljs-built_in">pr</span> merge 123 --squash

<span class="hljs-comment"># 一键操作：查看 + 批准 + 合并</span>
gh <span class="hljs-built_in">pr</span> merge 123 --squash --subject <span class="hljs-string">"Merge PR #123"</span> --body <span class="hljs-string">"自动合并"</span>
</code></pre>
<h3 data-id="heading-20">场景二：批量操作 Issues</h3>
<p><strong>问题</strong>：需要批量关闭已解决的 Issue。</p>
<p><strong>前置条件</strong>：需要安装 <code>jq</code> 工具来处理 JSON 数据</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS</span>
brew install jq

<span class="hljs-comment"># Linux</span>
sudo apt install jq
</code></pre>
<p><strong>解决方案</strong>：结合 <code>jq</code> 进行批量操作</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有标注为 "done" 的 Issue</span>
gh issue list --label <span class="hljs-keyword">done</span> --json number,title --jq <span class="hljs-string">'.[].number'</span>

<span class="hljs-comment"># 批量关闭</span>
gh issue list --label <span class="hljs-keyword">done</span> --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -I {} gh issue close {} --comment <span class="hljs-string">"已完成，自动关闭"</span>
</code></pre>
<h3 data-id="heading-21">场景三：自动化 Release 流程</h3>
<p><strong>问题</strong>：每次发布需要手动创建 Release、上传 Asset。</p>
<p><strong>解决方案</strong>：使用 <code>gh</code> 脚本化</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># release.sh</span>

VERSION=<span class="hljs-variable">$1</span>

<span class="hljs-comment"># 构建</span>
npm run build

<span class="hljs-comment"># 创建 Tag</span>
git tag -a <span class="hljs-variable">$VERSION</span> -m <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span>"</span>
git push origin <span class="hljs-variable">$VERSION</span>

<span class="hljs-comment"># 创建 Release</span>
gh release create <span class="hljs-variable">$VERSION</span> \
  ./dist/bundle.zip \
  --title <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span>"</span> \
  --notes <span class="hljs-string">"## 更新内容
- 新增功能 X
- 修复 Bug Y

## 安装
\`\`\`bash
npm install @my/package@<span class="hljs-variable">$VERSION</span>
\`\`\`"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span> created successfully!"</span>
</code></pre>
<p>使用方法：</p>
<pre><code class="hljs language-bash" lang="bash">./release.sh v1.2.0
</code></pre>
<h3 data-id="heading-22">场景四：CI/CD 集成</h3>
<p><strong>GitHub Actions 示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">Release</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">GITHUB_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          gh release create ${{ github.ref_name }} \
            --title "Release ${{ github.ref_name }}" \
            --notes "自动发布"
</span></code></pre>
<h3 data-id="heading-23">场景五：团队协作优化</h3>
<p><strong>配置别名</strong>：在 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 中添加</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># PR 别名</span>
<span class="hljs-built_in">alias</span> prs=<span class="hljs-string">'gh pr list'</span>
<span class="hljs-built_in">alias</span> prc=<span class="hljs-string">'gh pr create'</span>
<span class="hljs-built_in">alias</span> prv=<span class="hljs-string">'gh pr view'</span>
<span class="hljs-built_in">alias</span> prm=<span class="hljs-string">'gh pr merge'</span>

<span class="hljs-comment"># Issue 别名</span>
<span class="hljs-built_in">alias</span> issues=<span class="hljs-string">'gh issue list'</span>
<span class="hljs-built_in">alias</span> issuec=<span class="hljs-string">'gh issue create'</span>

<span class="hljs-comment"># 常用查询</span>
<span class="hljs-built_in">alias</span> my-prs=<span class="hljs-string">'gh pr list --author "@me"'</span>
<span class="hljs-built_in">alias</span> my-issues=<span class="hljs-string">'gh issue list --author "@me"'</span>
<span class="hljs-built_in">alias</span> review-prs=<span class="hljs-string">'gh pr list --search "review-requested:@me"'</span>
</code></pre>
<h2 data-id="heading-24">扩展系统</h2>
<p><code>gh</code> 支持自定义扩展，这是它最强大的特性之一。</p>
<h3 data-id="heading-25">安装扩展</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从 GitHub 仓库安装扩展</span>
gh extension install https://github.com/meiji163/gh-pr-overflow

<span class="hljs-comment"># 列出已安装的扩展</span>
gh extension list
</code></pre>
<h3 data-id="heading-26">创建自定义扩展</h3>
<p>示例 1：快速统计贡献的扩展</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建扩展目录</span>
<span class="hljs-built_in">mkdir</span> -p ~/.local/share/gh/extensions/gh-stats

<span class="hljs-comment"># 2. 创建可执行文件</span>
<span class="hljs-built_in">cat</span> &gt; ~/.local/share/gh/extensions/gh-stats/gh-stats &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># 统计个人贡献</span>

<span class="hljs-comment"># 获取用户名</span>
USER=$(gh api /user --jq <span class="hljs-string">'.login'</span>)

<span class="hljs-comment"># 获取统计信息（优化 API 调用）</span>
PRS=$(gh <span class="hljs-built_in">pr</span> list --author <span class="hljs-string">"@me"</span> --json <span class="hljs-built_in">id</span> --jq <span class="hljs-string">'. | length'</span>)
ISSUES=$(gh issue list --author <span class="hljs-string">"@me"</span> --json <span class="hljs-built_in">id</span> --jq <span class="hljs-string">'. | length'</span>)
REPOS=$(gh repo list --json name --jq <span class="hljs-string">'. | length'</span>)

<span class="hljs-built_in">echo</span> <span class="hljs-string">"贡献统计 (@<span class="hljs-variable">$USER</span>)"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━━━"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PRs:      <span class="hljs-variable">$PRS</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Issues:   <span class="hljs-variable">$ISSUES</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Repos:    <span class="hljs-variable">$REPOS</span>"</span>
EOF

<span class="hljs-comment"># 3. 添加执行权限</span>
<span class="hljs-built_in">chmod</span> +x ~/.local/share/gh/extensions/gh-stats/gh-stats

<span class="hljs-comment"># 4. 使用扩展</span>
gh stats
</code></pre>
<p>示例 2：批量关闭 PR 的扩展</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建批量关闭 PR 的扩展</span>
<span class="hljs-built_in">mkdir</span> -p ~/.local/share/gh/extensions/gh-pr-close

<span class="hljs-built_in">cat</span> &gt; ~/.local/share/gh/extensions/gh-pr-close/gh-pr-close &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># 批量关闭已合并的 PR</span>

gh <span class="hljs-built_in">pr</span> list --state merged --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -I {} gh <span class="hljs-built_in">pr</span> close {} --comment <span class="hljs-string">"自动关闭已合并的 PR"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"已关闭所有已合并的 PR"</span>
EOF

<span class="hljs-built_in">chmod</span> +x ~/.local/share/gh/extensions/gh-pr-close/gh-pr-close
</code></pre>
<p><strong>输出示例</strong>：</p>
<pre><code class="hljs language-css" lang="css">贡献统计 (<span class="hljs-keyword">@octocat</span>)
━━━━━━━━━━━━━━━━━━━━━━
<span class="hljs-attribute">Commits</span>:  <span class="hljs-number">152</span>
<span class="hljs-attribute">PRs</span>:      <span class="hljs-number">23</span>
<span class="hljs-attribute">Issues</span>:   <span class="hljs-number">12</span>
</code></pre>
<h2 data-id="heading-27">与其他工具对比</h2>















































<table><thead><tr><th>特性</th><th>GitHub CLI (<code>gh</code>)</th><th>Hub</th><th>GitLab CLI (<code>glab</code>)</th></tr></thead><tbody><tr><td>官方支持</td><td>GitHub 官方</td><td>第三方</td><td>GitLab 官方</td></tr><tr><td>PR 操作</td><td>完整支持</td><td>基础支持</td><td>完整支持</td></tr><tr><td>Actions 支持</td><td>原生支持</td><td>不支持</td><td>CI/CD 有限支持</td></tr><tr><td>扩展系统</td><td>强大</td><td>不支持</td><td>有限支持</td></tr><tr><td>GraphQL API</td><td>支持</td><td>不支持</td><td>支持</td></tr><tr><td>学习曲线</td><td>简单</td><td>中等</td><td>简单</td></tr></tbody></table>
<p><strong>选择建议</strong>：</p>
<ul>
<li><strong>GitHub 用户</strong>：首选 <code>gh</code>，官方维护，功能完整</li>
<li><strong>GitLab 用户</strong>：使用 <code>glab</code>，设计理念类似</li>
<li><strong>需要跨平台</strong>：<code>gh</code> 支持最好</li>
</ul>
<p><strong>从 Hub 迁移到 gh</strong>：</p>
<p>如果你之前使用 Hub，迁移到 gh 非常简单：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Hub 命令 → gh 命令对照</span>
hub pull-request     → gh <span class="hljs-built_in">pr</span> create
hub <span class="hljs-built_in">pr</span> list          → gh <span class="hljs-built_in">pr</span> list
hub issue             → gh issue create
hub release           → gh release create
hub browse            → gh repo view --web
hub ci-status         → gh <span class="hljs-built_in">pr</span> checks
</code></pre>
<p>主要区别：</p>
<ul>
<li><code>gh</code> 默认不修改 Git 配置</li>
<li><code>gh</code> 需要显式认证（<code>gh auth login</code>）</li>
<li><code>gh</code> 使用子命令结构（如 <code>gh pr</code>）而不是 flag（如 <code>hub pr</code>）</li>
</ul>
<h2 data-id="heading-28">最佳实践</h2>
<h3 data-id="heading-29">1. 认证管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 多账号管理</span>
gh auth login --hostname github.company.com

<span class="hljs-comment"># 查看当前登录状态</span>
gh auth status

<span class="hljs-comment"># 退出登录</span>
gh auth <span class="hljs-built_in">logout</span>
</code></pre>
<h3 data-id="heading-30">2. 配置文件</h3>
<p>创建 <code>~/.config/gh/config.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 配置默认编辑器</span>
<span class="hljs-attr">editor:</span> <span class="hljs-string">vim</span>

<span class="hljs-comment"># 配置 Git 协议</span>
<span class="hljs-attr">git_protocol:</span> <span class="hljs-string">ssh</span>

<span class="hljs-comment"># 配置浏览器</span>
<span class="hljs-attr">browser:</span> <span class="hljs-string">chromium</span>
</code></pre>
<h3 data-id="heading-31">3. 别名和快捷键</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 常用别名</span>
<span class="hljs-built_in">alias</span> gh=<span class="hljs-string">'npx gh'</span>  <span class="hljs-comment"># 如果使用 npx 安装</span>

<span class="hljs-comment"># 快捷函数</span>
<span class="hljs-keyword">function</span> gh-pr-<span class="hljs-function"><span class="hljs-title">checkout</span></span>() {
  gh <span class="hljs-built_in">pr</span> checkout <span class="hljs-variable">$1</span>
}
</code></pre>
<h3 data-id="heading-32">4. 脚本集成</h3>
<p>在 CI/CD 脚本中广泛使用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 自动化脚本示例</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 检查 PR 是否通过 CI</span>
pr_number=<span class="hljs-variable">$1</span>
status=$(gh <span class="hljs-built_in">pr</span> view <span class="hljs-variable">$pr_number</span> --json statusCheckRollup --jq <span class="hljs-string">'.statusCheckRollup[] | select(.status == "COMPLETED") | .conclusion'</span>)

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$status</span>"</span> == <span class="hljs-string">"SUCCESS"</span> ]; <span class="hljs-keyword">then</span>
  gh <span class="hljs-built_in">pr</span> merge <span class="hljs-variable">$pr_number</span> --squash
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"CI 未通过，无法合并"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<h2 data-id="heading-33">性能优化</h2>
<h3 data-id="heading-34">缓存机制</h3>
<p><code>gh</code> 使用本地缓存减少 API 调用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看缓存列表</span>
gh cache list

<span class="hljs-comment"># 清除缓存</span>
gh cache reset

<span class="hljs-comment"># 禁用缓存（强制刷新）</span>
gh api /users/octocat --cache 0s

<span class="hljs-comment"># 设置缓存时间</span>
gh api /repos/user/repo --cache 5m
</code></pre>
<h3 data-id="heading-35">并发请求</h3>
<p>处理大量数据时，使用并发可以显著提升速度：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 xargs 并发处理（4 个并发）</span>
gh <span class="hljs-built_in">pr</span> list --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -P 4 -I {} gh <span class="hljs-built_in">pr</span> view {}

<span class="hljs-comment"># 对比：串行处理需要 10 秒，并发处理仅需 3 秒（约提升 70%）</span>
</code></pre>
<h3 data-id="heading-36">性能对比</h3>



































<table><thead><tr><th>操作</th><th>网页方式</th><th>gh 命令</th><th>效率提升</th></tr></thead><tbody><tr><td>创建 PR</td><td>~30 秒</td><td>~5 秒</td><td>约 83%</td></tr><tr><td>查看 PR 列表</td><td>~10 秒</td><td>~2 秒</td><td>约 80%</td></tr><tr><td>合并 PR</td><td>~15 秒</td><td>~3 秒</td><td>约 80%</td></tr><tr><td>批量关闭 Issue</td><td>~5 分钟</td><td>~30 秒</td><td>约 90%</td></tr></tbody></table>
<p><em>以上数据基于个人使用经验，实际速度取决于网络环境和操作复杂度</em></p>
<h2 data-id="heading-37">常见问题</h2>
<h3 data-id="heading-38">Q1: <code>gh</code> 命令执行很慢？</h3>
<p><strong>原因</strong>：每次都调用 GitHub API，网络延迟影响响应速度</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 使用缓存减少重复请求</span>
gh cache list  <span class="hljs-comment"># 查看缓存</span>
gh cache reset  <span class="hljs-comment"># 清除缓存</span>

<span class="hljs-comment"># 2. 减少查询字段</span>
gh <span class="hljs-built_in">pr</span> list --json number,title --<span class="hljs-built_in">limit</span> 10

<span class="hljs-comment"># 3. 限制返回数量</span>
gh issue list --<span class="hljs-built_in">limit</span> 20

<span class="hljs-comment"># 4. 使用并发处理</span>
gh <span class="hljs-built_in">pr</span> list --json number --jq <span class="hljs-string">'.[].number'</span> | xargs -P 4 -I {} gh <span class="hljs-built_in">pr</span> view {}
</code></pre>
<h3 data-id="heading-39">Q2: 如何在企业 GitHub 中使用？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录企业版</span>
gh auth login --hostname github.company.com

<span class="hljs-comment"># 查看当前登录状态</span>
gh auth status

<span class="hljs-comment"># 之后的命令会自动使用企业版实例</span>
gh repo list
</code></pre>
<h3 data-id="heading-40">Q3: 如何调试 API 请求？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用调试模式（查看详细的 API 调用信息）</span>
GH_DEBUG=1 gh <span class="hljs-built_in">pr</span> list

<span class="hljs-comment"># 查看 API 调用的详细信息</span>
gh api /user --verbose

<span class="hljs-comment"># 查看请求头和响应头</span>
gh api /user -i
</code></pre>
<h3 data-id="heading-41">Q4: 认证失败怎么办？</h3>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查登录状态</span>
gh auth status

<span class="hljs-comment"># 2. 重新登录</span>
gh auth <span class="hljs-built_in">logout</span>
gh auth login

<span class="hljs-comment"># 3. 刷新 Token</span>
gh auth refresh

<span class="hljs-comment"># 4. 检查网络连接</span>
gh api /user
</code></pre>
<h3 data-id="heading-42">Q5: 如何处理 API 速率限制？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看剩余配额</span>
gh api /rate_limit

<span class="hljs-comment"># 减少请求频率</span>
<span class="hljs-comment"># 方案1：使用缓存</span>
gh api /repos/user/repo --cache 5m

<span class="hljs-comment"># 方案2：批量操作</span>
gh <span class="hljs-built_in">pr</span> list --json number,title --<span class="hljs-built_in">limit</span> 100

<span class="hljs-comment"># 方案3：使用 GraphQL 一次获取多个数据</span>
gh api graphql -f query=<span class="hljs-string">'query { viewer { login repositories(first: 100) { nodes { name } } } }'</span>
</code></pre>
<h3 data-id="heading-43">Q6: 如何配置代理？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置环境变量</span>
<span class="hljs-built_in">export</span> HTTP_PROXY=http://proxy.example.com:8080
<span class="hljs-built_in">export</span> HTTPS_PROXY=http://proxy.example.com:8080

<span class="hljs-comment"># 或在配置文件中设置</span>
<span class="hljs-comment"># 编辑 ~/.config/gh/config.yml</span>
<span class="hljs-comment"># http_proxy: http://proxy.example.com:8080</span>
</code></pre>
<h2 data-id="heading-44">未来展望</h2>
<p><code>gh</code> 的发展趋势：</p>
<ol>
<li><strong>AI 集成</strong>：结合 GitHub Copilot 提供智能建议</li>
<li><strong>更多扩展</strong>：社区驱动的扩展生态</li>
<li><strong>性能优化</strong>：更快的响应速度</li>
<li><strong>GraphQL 增强</strong>：更强大的查询能力</li>
</ol>
<h2 data-id="heading-45">总结</h2>
<p>GitHub CLI (<code>gh</code>) 从诞生到成熟，彻底改变了开发者与 GitHub 的交互方式：</p>
<p><strong>核心价值</strong>：</p>
<ul>
<li><strong>效率提升</strong>：大幅减少网页操作，基于个人使用经验，可减少约 70-80% 的浏览器切换</li>
<li><strong>自动化友好</strong>：易于脚本化和集成到 CI/CD 流程</li>
<li><strong>学习成本低</strong>：简洁直观的命令设计</li>
<li><strong>扩展性强</strong>：支持自定义扩展</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>日常开发工作流</li>
<li>CI/CD 自动化</li>
<li>团队协作优化</li>
<li>批量操作</li>
</ul>
<p><strong>学习建议</strong>：</p>
<ol>
<li>从基础命令开始：<code>gh pr</code>, <code>gh issue</code>, <code>gh repo</code></li>
<li>掌握 <code>gh api</code> 的强大功能</li>
<li>结合实际工作流创建别名和脚本</li>
<li>探索社区扩展，发现更多玩法</li>
</ol>
<h2 data-id="heading-46">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fen%2Fcli" target="_blank" title="https://docs.github.com/en/cli" ref="nofollow noopener noreferrer">GitHub CLI 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcli%2Fcli" target="_blank" title="https://github.com/cli/cli" ref="nofollow noopener noreferrer">GitHub CLI GitHub 仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcli%2Fcli%2Fwiki%2FExtensions" target="_blank" title="https://github.com/cli/cli/wiki/Extensions" ref="nofollow noopener noreferrer">gh 扩展市场</a></li>
</ul>
<hr/>
<p>如果你在使用 <code>gh</code> 的过程中遇到问题，或者有更高效的使用技巧，欢迎在评论区分享！</p>
<p><strong>如果本文对你有帮助，别忘了点赞收藏关注~</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C 语言循环语句详解：从入门到熟练，搞定重复操作不再难]]></title>    <link>https://juejin.cn/post/7601076815450095631</link>    <guid>https://juejin.cn/post/7601076815450095631</guid>    <pubDate>2026-02-01T08:02:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450095631" data-draft-id="7601076815450062863" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C 语言循环语句详解：从入门到熟练，搞定重复操作不再难"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-02-01T08:02:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户11674320658"/> <meta itemprop="url" content="https://juejin.cn/user/4338018464577738"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C 语言循环语句详解：从入门到熟练，搞定重复操作不再难
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4338018464577738/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户11674320658
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:02:07.000Z" title="Sun Feb 01 2026 08:02:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>C 语言循环语句详解：从入门到熟练，搞定重复操作不再难</p>
<h2 data-id="heading-0">前言</h2>
<p>初学 C 语言时，你是不是也遇到过这样的场景：需要打印 100 遍「Hello World」，如果逐行写printf("Hello World");，不仅要写 100 行代码，还容易出错；需要计算 1 到 100 的累加和，手动计算既麻烦又不灵活。</p>
<p>这时候，「循环语句」就成了我们的「救星」—— 它能让程序重复执行某一段代码，大大简化工作量，提高代码效率和可维护性。</p>
<p>今天这篇文章，我们就来全面吃透 C 语言中的 3 大循环语句：for、while、do-while，包括它们的语法、用法、区别以及实战场景，新手也能轻松上手。</p>
<h2 data-id="heading-1">什么是循环语句</h2>
<p>在C语言中，循环语句是流程控制语句的一种，其核心作用是：在满足指定条件的前提下，重复执行某一段代码快（称为：循环体）。</p>
<p>在生活中，也有很多与循环有关的场景，比如：</p>
<p>1.每天早上 7 点起床→洗漱→吃早餐→上班，直到周末（条件：非周末）；</p>
<p>2.往杯子里倒水，直到水面到达杯口（条件：水杯未满）；</p>
<p>3.打印1到10的数字，重复执行（打印数字 + 数字+1）的操作，直到数字大于10。</p>
<p>C语言中有三种最基本的循环语句，分别是for，while，do-while，分别对应不同的场景，接下来让我们来逐一拆解。</p>
<h2 data-id="heading-2">三大循环语句详解</h2>
<h3 data-id="heading-3">一、while循环：简洁直观（适合未知循环次数，但知道终止条件的场景）</h3>
<h4 data-id="heading-4">语法格式：</h4>
<pre><code class="hljs language-c" lang="c">初始化表达式：
<span class="hljs-keyword">while</span>（条件判断表达式）
{
		循环体代码：<span class="hljs-comment">//条件为真时执行</span>
		更新表达式；<span class="hljs-comment">//修改循环变量，避免死循环</span>
}
</code></pre>
<h4 data-id="heading-5">执行流程</h4>
<p>1.先执行循环外的初始化表达式（仅一次）</p>
<p>2 执行while后的 [条件判断表达式] ,判断是否为真</p>
<p>3如果条件为真，则进入循环，并执行循环体代码；如果条件为假，则跳出循环</p>
<h4 data-id="heading-6">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> n = <span class="hljs-number">1</span>;
	<span class="hljs-keyword">while</span> (n &lt;= <span class="hljs-number">10</span>)
	{
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, n);
		n++;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/483aa9e9c5014952afd877515c0b7134~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=%2BFR6wwRuTP8L6cjkawKJKAeHwKw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这段代码的作用是从1打印到10.</p>
<h4 data-id="heading-7">提醒</h4>
<ol>
<li>
<p>while循环的初始化在循环体外，更新表达式在循环体内，一定要记得写（更新循环体）的代码，否则循环将无法终止，容易造成死循环（比如：上述代码如果没有n++；则该段代码将陷入死循环，无限打印0）</p>
</li>
<li>
<p>当然更新表达式这一步骤可以根据情况写在while括号后面的条件判断表达式中</p>
</li>
<li>
<p>当循环体只有一行代码时，大括号”{ }‘可以省略，但是并不推荐这样做，这会导致代码不方便阅读</p>
</li>
</ol>
<h3 data-id="heading-8">二、for循环：最常用，最灵活的循环（适合已知循环次数的场景）</h3>
<p>for循环吧（初始化，循环条件，更新变量）集中在一行，结构清晰，是使用频率最高的循环。</p>
<h4 data-id="heading-9">语法格式</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">for</span>(初始化表达式；条件判断表达式；更新表达式）
{
		循环体代码<span class="hljs-comment">//条件为真时，重复执行</span>
}
</code></pre>
<h4 data-id="heading-10">执行流程</h4>
<ol>
<li>执行初始化表达式（仅执行一次，用于初始化循环变量）</li>
<li>执行条件判断表达式（返回布尔值：真 / 假，C语言中用（非0表示真，0表示假）</li>
<li>如果条件为“真 ”，执行 [循环体代码] ; 如果条件为 “假” , 直接跳出循环，结束for循环</li>
<li>循环体代码执行完毕后，执行更新表达式</li>
<li>回到步骤2，重复执行，直到条件为假</li>
</ol>
<h4 data-id="heading-11">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> n = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span> (n = <span class="hljs-number">1</span>; n &lt;= <span class="hljs-number">10</span>; n++)
	{
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,n);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f87e7d48fa274049bd8ff47cade9229f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=sUvdQrZiVgbpVK7WEi3xu58IfUQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这段代码先初始化n = 0；然后开始进入for循环，首先先将n初始化为1，然后进行条件判断n &lt;= 10，发现条件满足，然后进入循环体开始执行循环语句，打印n的值，循环体代码执行完毕后，再进行更新表达式这一步骤，即n++，让n的值自增1；然后不断循环直到 [条件判断表达式] 为假，然后结束循环。</p>
<h4 data-id="heading-12">提醒</h4>
<ol>
<li>初始化表达式可以定义多个变量，每个变量间用逗号隔开，更新表达式也可以修改多个变量，比如（for（int i = 0, j = 10; i &lt;= 10; i++, j--);</li>
<li>循环体如果只有一行代码，大括号“{ }”可以省略，但是不推荐这样做，这会导致代码的可读性差，容易出错;</li>
<li>for()的“（）”后面不要加“ ；”，否则的话会导致无法正常进入循环体，而是先执行完 [更新表达式] 里面的代码后，再进入循环体内；</li>
<li>对比while循环，for循环更适合 [已知循环次数] ,而while循环更适合 [未知循环次数] ,但二者可以根据情况相互转换。</li>
</ol>
<h3 data-id="heading-13">三、do-while循环：先执行后判断</h3>
<p>do-while循环是 “先执行循环体，再判断条件”，无论条件是否为真，循环体都会至少执行一次，使用场景较少，但在某些特定场景下不可替代。</p>
<h4 data-id="heading-14">语法格式</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 语法格式</span>
初始化表达式; <span class="hljs-comment">// 循环变量初始化</span>
<span class="hljs-keyword">do</span> {
    循环体代码; <span class="hljs-comment">// 先执行1次，再判断条件</span>
    更新表达式; <span class="hljs-comment">// 修改循环变量</span>
} <span class="hljs-keyword">while</span> (条件判断表达式); <span class="hljs-comment">// 注意：末尾有分号</span>
</code></pre>
<h4 data-id="heading-15">执行流程</h4>
<ol>
<li>先执行循环外的 [初始化表达式];</li>
<li>进入do-while循环，先执行 [循环体代码] ,无论条件是否为真，都先执行一次；</li>
<li>执行 [更新表达式] ,修改循环变量；</li>
<li>执行while后面的 [条件判断表达式] ,判断是否为真。</li>
<li>如果条件为真：回到步骤2，继续进行循环。如果条件为假：则跳出循环。</li>
</ol>
<h4 data-id="heading-16">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span> <span class="hljs-comment">// 用于strcmp()函数：比较两个字符串是否相等</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 示例：用户登录验证，默认密码为"123456"，至少提示1次输入密码</span>
    <span class="hljs-type">char</span> password[<span class="hljs-number">20</span>]; <span class="hljs-comment">// 定义字符数组，存储用户输入的密码</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"=== 用户登录 ===\n"</span>);

    <span class="hljs-keyword">do</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"请输入登录密码："</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, password); <span class="hljs-comment">// 读取用户输入的密码（无需&amp;，字符数组名本身是地址）</span>

        <span class="hljs-comment">// strcmp(a, b)：比较字符串a和b，相等返回0，不相等返回非0</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(password, <span class="hljs-string">"123456"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"密码正确，登录成功！\n"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"密码错误，请重新输入！\n"</span>);
        }
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strcmp</span>(password, <span class="hljs-string">"123456"</span>) != <span class="hljs-number">0</span>); <span class="hljs-comment">// 终止条件：密码正确</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fed790d0ef7a46b88bd2f66b5e34fa05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=XDhkjnRE%2FPkkJVIc%2F%2BXXNbY%2B7Ok%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>根据代码运行结果可以看出，无论输入的密码是否正确，都会进入一次循环，并执行一次循环体的内容。</p>
<h4 data-id="heading-17">提醒</h4>
<ol>
<li>do-while循环中，while的“ （）”后面必须加 [ ; ]，这是C语言语法的要求。</li>
<li>循环体至少执行一次，这一点与for循环和while循环不同。</li>
<li>使用场景有限，仅在必须先执行一次循环体的情况下才会使用</li>
</ol>
<h3 data-id="heading-18">循环跳转关键字(break/continue）</h3>
<p>我们已经掌握了三种循环的基础用法，但在实际开发中往往还需要在循环执行的过程中 [提前终止整个循环] 或 [跳过本次循环的剩余内容]。这时我们就需要 break 和 continue 这两个关键字来解决上述问题，下面我们就来详细拆解他们的用法和区别。</p>
<h4 data-id="heading-19">break</h4>
<p>break的作用是提前终止整个循环，当代码运行到break时，break会使整个循环提前终止，跳出循环。</p>
<h5 data-id="heading-20">代码演示</h5>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt;= <span class="hljs-number">10</span>)
	{
		<span class="hljs-keyword">if</span> (i == <span class="hljs-number">6</span>)
		{
			<span class="hljs-keyword">break</span>;
		}
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, i);
		i++;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84522e07437b421080398c86b00f03d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=%2Fz6G4piVqsjRi9utMTaAc2uPSKI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>观察上述代码的运行结果，我们发现最后的结果并不是从0打印到10，为什么会出现这样的情况？</p>
<p>这是因为当 i 自增到6时会进入if的判断语句，i == 6，执行break，break使得循环强制终止，跳出循环，不再进入后面的循环。因此这段代码的运行结果是0 1 2 3 4 5.</p>
<h4 data-id="heading-21">continue</h4>
<p>continue的作用是当代码执行到continue时，continue会使得程序跳过本次循环后面的语句，进入下一次循环中。</p>
<h5 data-id="heading-22">代码演示</h5>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">10</span>)
	{
		i++;
		<span class="hljs-keyword">if</span> (i == <span class="hljs-number">6</span>)
		{
			<span class="hljs-keyword">continue</span>;
		}
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, i);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcbe71b56351489a9e66a86bda15f212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=62VwYSFGSm1QyFLuXZGnj%2B4r8Y4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>由代码运行结果可以看出，这段代码从1到10依次打印却跳过了6，这是为什么呢？</p>
<p>究其原因是因为当 i 自增到6时，进入if语句中，i == 6；执行continue语句，continue使得本次循环强制终止，并进入到下一次循环中，因此当 i = 6时，printf("%d ",i)这个语句被跳过了，并没有被执行，因此屏幕上并没有打印6.</p>
<h5 data-id="heading-23">提醒</h5>
<p>使用continue时，一定要确保循环变量在continue之前完成更新，否则的话会进入死循环。</p>
<h3 data-id="heading-24">实战练习</h3>
<p>题目 1：使用for循环，打印 99 乘法表（经典练习题，考察循环嵌套，可选做）；</p>
<p>题目 2：使用while循环，计算 1 到 100 中所有偶数的和</p>
<p>题目 3：使用do-while循环，实现一个简单的菜单（选择 1 打印当前时间、选择 2 退出，至少显示 1 次菜单）。</p>
<h3 data-id="heading-25">总结</h3>
<p>今天我们全面讲解了 C 语言中的 3 大循环语句：for、while、do-while，核心总结如下：</p>
<ol>
<li>循环语句的核心作用是「重复执行某段代码」，简化工作量，提高代码效率；</li>
<li>for循环适合已知循环次数，while循环适合未知循环次数，do-while循环适合循环体至少执行 1 次；</li>
<li>三者可以相互转换，但优先根据场景选择最简洁、可读性最高的循环；
4，开发中要避免无意造成的死循环，记得写「更新表达式」。</li>
</ol>
<p>循环语句是 C 语言的基础，也是后续学习「循环嵌套」「数组遍历」「算法实现」的前提，建议大家多动手练习，熟能生巧。</p>
<p>如果你有任何问题，欢迎在评论区留言，我们一起交流学习！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[传说中的C++精灵库，专治“C++恐惧症”?]]></title>    <link>https://juejin.cn/post/7601313474719219747</link>    <guid>https://juejin.cn/post/7601313474719219747</guid>    <pubDate>2026-02-01T08:04:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719219747" data-draft-id="7601077290682089524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="传说中的C++精灵库，专治“C++恐惧症”?"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-02-01T08:04:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李兴球"/> <meta itemprop="url" content="https://juejin.cn/user/1528748152725595"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            传说中的C++精灵库，专治“C++恐惧症”?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1528748152725595/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李兴球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:04:42.000Z" title="Sun Feb 01 2026 08:04:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这，是一个采用C++精灵库编写的程序，它画了一幅漂亮的图形：</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sprites.h"</span>  <span class="hljs-comment">//包含C++精灵库 </span></span>
Sprite turtle;      <span class="hljs-comment">//建立角色叫turtle</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> d)</span></span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)turtle.<span class="hljs-built_in">fd</span>(d).<span class="hljs-built_in">left</span>(<span class="hljs-number">72</span>);
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{        <span class="hljs-comment">//主功能块 </span>
   turtle.<span class="hljs-built_in">bgcolor</span>(<span class="hljs-string">"black"</span>);
   turtle.<span class="hljs-built_in">pensize</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">speed</span>(<span class="hljs-number">0</span>);
   <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> step=<span class="hljs-number">10</span>;step&lt;<span class="hljs-number">360</span>;step+=<span class="hljs-number">30</span>){
     turtle.<span class="hljs-built_in">color</span>(step);
     <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">12</span>;i++){
        turtle.<span class="hljs-built_in">pu</span>().<span class="hljs-built_in">fd</span>(step/<span class="hljs-number">2</span> ).<span class="hljs-built_in">right</span>(<span class="hljs-number">60</span>);
        turtle.<span class="hljs-built_in">pd</span>(); <span class="hljs-built_in">draw</span>(step/<span class="hljs-number">10</span>);
        turtle.<span class="hljs-built_in">pu</span>().<span class="hljs-built_in">left</span>(<span class="hljs-number">60</span>).<span class="hljs-built_in">bk</span>(step/<span class="hljs-number">2</span> );
        turtle.<span class="hljs-built_in">right</span>(<span class="hljs-number">30</span>);
     }
   }     
   turtle.<span class="hljs-built_in">ht</span>().<span class="hljs-built_in">done</span>();     <span class="hljs-comment">//完成了</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-comment">//返回0</span>
}
</code></pre>
<p>而，这是另一个由python turtle编写的程序，画的图形和上面C++的图形几乎一模一样：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> turtle <span class="hljs-keyword">as</span> t
<span class="hljs-keyword">import</span> colorsys

<span class="hljs-comment"># 设置画布</span>
t.bgcolor(<span class="hljs-string">"black"</span>)
t.colormode(<span class="hljs-number">255</span>)  <span class="hljs-comment"># 使用 0-255 的 RGB 范围</span>
t.speed(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 最快速度</span>
t.pensize(<span class="hljs-number">2</span>)
t.hideturtle()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">d</span>):
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
        t.forward(d)
        t.left(<span class="hljs-number">72</span>)

<span class="hljs-comment"># 主绘图逻辑</span>
<span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">360</span>, <span class="hljs-number">30</span>):
    <span class="hljs-comment"># 将 step 映射为颜色：使用 HSV 色彩空间，让颜色随 step 变化（彩虹效果）</span>
    hue = step / <span class="hljs-number">360.0</span>  <span class="hljs-comment"># 归一化到 [0, 1)</span>
    r, g, b = colorsys.hsv_to_rgb(hue, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>)
    t.color(<span class="hljs-built_in">int</span>(r * <span class="hljs-number">255</span>), <span class="hljs-built_in">int</span>(g * <span class="hljs-number">255</span>), <span class="hljs-built_in">int</span>(b * <span class="hljs-number">255</span>))    
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>):
        t.penup()
        t.forward(step / <span class="hljs-number">2</span>)
        t.right(<span class="hljs-number">60</span>)
        t.pendown()
        draw(step // <span class="hljs-number">10</span>)
        t.penup()
        t.left(<span class="hljs-number">60</span>)
        t.backward(step / <span class="hljs-number">2</span>)
        t.right(<span class="hljs-number">30</span>)
turtle.done()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a26a556facb4418bb418774c6248100d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YW055CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537882&amp;x-signature=qzsHGpaBs0kpIqQ45v6mkUJFYYA%3D" alt="2026-02-01_155350" loading="lazy"/></p>
<p><strong>等等！让我揉揉眼睛！</strong> 这到底是什么情况？！C++居然长得像Python？Python居然敢和C++撞衫？！是Python turtle出轨了C++的语法，还是C++红杏出墙学会了Python的撩人技巧？</p>
<p><strong>真相只有一个：因为有了C++精灵库（sprites.h），它专治“C++恐惧症”</strong></p>
<p>你看啊，传统的C++入门那是啥？<code>std::cout &lt;&lt; "Hello World" &lt;&lt; std::endl;</code> —— 这一串标点符号就能劝退半个班的新生！指针、内存管理、编译链接... 简直就是编程界的"高冷男神"，爱你但就是不让你靠近。</p>
<p>但是！有了C++精灵库之后呢？<code>turtle.fd(d).left(72)</code> —— 这链式调用，这丝滑手感，这简直是把C++从"西装革履的老干部"改造成了"穿着潮牌的邻家哥哥"！</p>
<p><strong>震惊！两行代码本质上居然一模一样！</strong></p>
<p>对比看看：</p>
<ul>
<li>C++：<code>turtle.pu().fd(step/2 ).right(60);</code></li>
<li>Python：<code>t.penup(); t.fd(step / 2); t.right(60)</code></li>
</ul>
<p>我的天！C++不仅学会了Python的简单，还保持了C++的优雅链式语法！就像一个人既会做饭又会浪漫，既懂底层又懂生活！</p>
<p><strong>等等，重点来了！这里有个惊天大秘密！</strong> 你以为这只是语法糖？只是简单的有样学样？ 这是<strong>双倍赋能</strong>啊朋友们！看到了没。</p>
<p>当你用Python turtle画图时，你学的是——怎么画图。仅此而已。</p>
<p>但当你用C++精灵库画图时，你学的是——<strong>怎么在数字世界的地基上画图！</strong></p>
<p>想想看，你的操作系统是谁写的？C/C++！你的浏览器内核是谁写的？C++！你的游戏引擎是谁写的？C++！连Python解释器本身，都是用C写的！这就好比，Python是精装修的房子，拎包入住很爽；但C++是钢筋混凝土的地基加精装修技能！<strong>既会盖楼又会装修，你不香吗？</strong></p>
<p><strong>我们可爱的</strong>Python 小海龟依旧玩得欢，它还是那个简单的Python。C++也依然是那个性能怪兽。</p>
<p>真正的"第三者"是<strong>C++精灵库</strong>这个伟大的媒婆！它让C++放下了身段，穿上了Python的便装，但骨子里还是那个能操控硬件、驾驭操作系统、构建数字文明的底层王者！</p>
<p><strong>结论：C++精灵库的出现是技术发展的必然。它让</strong>C++这位“深藏不露”的大佬，终于决定不再装高冷，用最温柔的方式，带你走上真正的技术巅峰！</p>
<p>想看视频的这里有链接： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.douyin.com%2Fvideo%2F7601797221754965288" target="_blank" title="https://www.douyin.com/video/7601797221754965288" ref="nofollow noopener noreferrer">www.douyin.com/video/76017…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数字]]></title>    <link>https://juejin.cn/post/7601076815450406927</link>    <guid>https://juejin.cn/post/7601076815450406927</guid>    <pubDate>2026-02-01T09:43:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450406927" data-draft-id="7601076815450374159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数字"/> <meta itemprop="keywords" content="数据结构,后端,前端"/> <meta itemprop="datePublished" content="2026-02-01T09:43:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="仍沫"/> <meta itemprop="url" content="https://juejin.cn/user/184373685261719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数字
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685261719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    仍沫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:43:20.000Z" title="Sun Feb 01 2026 09:43:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>提到数字时，会想到当前所需的数值范围是什么，使用什么类型的数字会比较合适，会不会存在溢出或精度丢失等情况。本文会简单介绍数字的概念，以及日常使用数字时需要注意的一些问题。</p>
<p>不同语言中，对数字的实现形式是不同的，比如在Go中数字有int32、int64、float32、float64等类型；在JavaScript中数字只有Number类型，是一种双精度浮点数，不管是整数还是浮点数，都是Number类型（表示范围上相当于Go的float64类型）。</p>
<p>Go：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> a <span class="hljs-type">float64</span> = <span class="hljs-number">1.0</span>
<span class="hljs-keyword">var</span> b <span class="hljs-type">int64</span> = <span class="hljs-number">1</span>
fmt.Printf(<span class="hljs-string">"%T %T\n"</span>, a, b) <span class="hljs-comment">// float64 int64</span>
</code></pre>
<p>JavaScript：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-number">1.0</span>;
<span class="hljs-keyword">let</span> b = <span class="hljs-number">1</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> a, <span class="hljs-keyword">typeof</span> b) <span class="hljs-comment">// number number</span>
</code></pre>
<p>数字的核心概念部分其实都是一样的，因为实现形式不同，数字在不同语言的代码中，表现可能会不同，要将核心概念和不同语言的特点结合使用。</p>
<p>接下来的数据结构等一系列文章，都以Go语言为例进行说明。</p>
<h2 data-id="heading-0">bit（比特）</h2>
<blockquote>
<p><strong>bit（比特 binary digit）</strong> 是信息的最小单位，表示一个二进制位（0 或 1）。</p>
</blockquote>
<p>硬件能比较精确地区分两种状态，例如低电平/高电平，断电/通电等，这些状态被抽象为了0或1的二进制位，<strong>所有数据</strong>最终都是以<strong>bit序列</strong>存储在计算机中的。（为什么是二进制位，不是三进制或者十进制？因为更多状态实现起来非常困难且不精确）</p>
<p>人们日常生活中，比较常用的是十进制数字，比如12个月，十进制数字12转换为二进制数字就是1100。</p>
<h2 data-id="heading-1">byte（字节）</h2>
<p>1byte=8bits</p>
<p>十进制12等于二进制1100，看起来只需要4bits就能存储12这个数了，但实际至少需要8bits来存储，因为在计算机中CPU 和内存系统能直接访问的最小数据单元是1byte，这和历史原因、硬件实现等有关，地址总线按字节寻址，数据总线的位数通常也为8的倍数。以读数据为例，CPU从内存“找”数据，内存给CPU“吐”数据的时候，地址和数据的最小单位就到字节，不能更小了。</p>
<p>顺便记录一下一些常见单位的换算方式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1</mn><mi>K</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>10</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>M</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>K</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>20</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>G</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>M</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>30</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>T</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>G</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>40</mn></msup><mi>B</mi><mspace linebreak="newline"/></mrow><annotation encoding="application/x-tex">1 KB = 1024 B  = 2^{10} B \\
1 MB  = 1024 KB = 2^{20} B \\
1 GB  = 1024 MB = 2^{30} B \\
1 TB  = 1024 GB = 2^{40} B \\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">20</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">TB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">40</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/></span></span></span></div>
<h2 data-id="heading-2">Go中的数字类型</h2>
<p>Go中的数字类型有整数、浮点数、复数。</p>
<ul>
<li>整数
<ul>
<li>有符号整数：int8 、int16 、int32、int64 、int</li>
<li>无符号整数：uint8(byte) 、uint16 、uint32 、uint64 、uint 、uintptr</li>
</ul>
</li>
<li>浮点数：float32、float64</li>
<li>复数：complex64、complex128</li>
</ul>
<p>rune类型是int32类型的别名，其实就是数字类型，但语义上是Unicode码点，指的是单个字符的类型。</p>
<p>Go语言中的byte类型就是uint8，是一种数据类型，和上面说过的那个byte（更多是存储单位）有所不同。例：</p>
<p>变量a的类型是byte（数据类型）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> a <span class="hljs-type">byte</span> = <span class="hljs-number">1</span>
</code></pre>
<p>“数字.md”这个文件的大小是15394byte（存储单位）：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">stat</span> -f%z 数字.md</span>

15394
</code></pre>
<h3 data-id="heading-3">整数</h3>
<p>以unit8和int8为例，无符号8位整数unit8的二进制表示是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b54d9203290d4ce296ca10d91d843338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=xlrkS976E33k55VSxY1ZNgxnppI%3D" alt="image.png" loading="lazy"/></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><msub><mi>b</mi><mn>7</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><msub><mi>b</mi><mn>6</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>6</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">数值=b_7·2^7 + b_6·2^6 + ... + b_1·2^1 + b_0·2^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>数值范围是 0 ~ 255，当所有位都为0时是最小值0，所有位都为1时，是最大值255：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>7</mn></mrow><mn>0</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mo>=</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>6</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><mn>2</mn><mo separator="true">⋅</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>8</mn></mrow><mn>1</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mo>=</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>8</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mspace linebreak="newline"/><msub><mi>S</mi><mn>2</mn></msub><mo>−</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>256</mn><mo>−</mo><mn>1</mn><mo>=</mo><mn>255</mn></mrow><annotation encoding="application/x-tex">S_1 =\sum_{i=7}^{0} b_i \cdot 2^i = 1·2^7 + 1·2^6 + ... + 1·2^1 + 1·2^0 \\
S_2 = 2 · S_1  =\sum_{i=8}^{1} b_i \cdot 2^i = 1·2^8 + 1·2^7 + ... + 1·2^2 + 1·2^1 \\
S_2 - S_1 = S_1 = 2^8 - 1 = 256 - 1 = 255
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">7</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">8</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">255</span></span></span></span></span></div>
<p><strong>有符号整数</strong>在计算机中通常是以<strong>补码</strong>的形式存储的，有符号整数有原码、反码、补码的概念，使用补码表示有符号整数，是为了用二进制表示负数，并且尽可能让运算简单。感兴趣的读者朋友可以详细了解下为什么，现在只需要记住补码的计算公式即可，有符号整数使用这个公式计算：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><msub><mi>b</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">−b_{n-1}⋅2^{n-1}+\sum_{i=0}^{n-2}b_i⋅2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"/><span class="mord">−</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>有符号8位整数int8的二进制表示是这样的：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba171fbed1324205b9cd2aed82ee29eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=%2BQ6R5aLSAlaAAk4gWQC8AEt3Koo%3D" alt="image 1.png" loading="lazy"/></p>
<p>符号位s就是第7位，<strong>符号位为1表示负数，为0表示正数</strong>。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><mo>−</mo><msub><mi>b</mi><mn>7</mn></msub><mo>⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>6</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">数值 = −b_7⋅2^7+\sum_{i=0}^6b_i⋅2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord">−</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>符号位为1，剩余位全为0时，是最小值-128：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mn>0</mn><mo>=</mo><mo>−</mo><mn>128</mn></mrow><annotation encoding="application/x-tex">-1·2^7 + 0 = -128</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">128</span></span></span></span></span></div>
<p>符号位为0，剩余位全为1时，是最大值：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><mn>0</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><msup><mn>2</mn><mn>7</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">-0·2^7 + 2^7 - 1 = 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">0</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></div>
<p>其他类型整数的计算方式uint8和int8是一样的，只是表示的数值范围根据二进制位数的不同而不同。
无符号n位整数的范围：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0</mn><mo>∼</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \sim 2^n - 1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7977em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<p>有符号n位整数的范围：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∼</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-2^{n-1} \sim 2^{n-1}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<p>整数中int、uint、unitptr类型根据不同平台的架构变化，通常在32位架构上是32位，在64位架构上是64位。</p>
<p>以下是已经计算好的一些整数类型的范围，方便使用时能对各类型的数值范围有大概的印象：</p>


















































<table><thead><tr><th>类型</th><th>范围</th><th>中文描述（大约值）</th></tr></thead><tbody><tr><td>int8</td><td>-128 ~ 127</td><td/></tr><tr><td>uint8</td><td>0 ~ 255</td><td/></tr><tr><td>int16</td><td>-32768 ~ 32767</td><td>-3万2千～ 3万2千</td></tr><tr><td>uint16</td><td>0 ~ 65535</td><td>0 ~ 6万5千</td></tr><tr><td>int32</td><td>-2147483648 ~ 2147483647</td><td>-21亿4748万 ～ 21亿4748万</td></tr><tr><td>uint32</td><td>0 ~ 4294967295</td><td>0 ～ 42亿9496万</td></tr><tr><td>int64</td><td>-9223372036854775808 ~ 9223372036854775807</td><td>-9223372万亿 ～9223372万亿</td></tr><tr><td>uint64</td><td>0 ~ 18446744073709551615</td><td>0 ~ 18446744 万亿</td></tr></tbody></table>
<p>比较常用的就是int32和int64类型。自增id，时间戳之类的可能会较大的值用int64， 一般数值范围比如一个视频的秒级时长就用int32。
PS：视频时长这种数字，已经明确了是正数了，不选择用uint32是为了和不同语言更好地兼容以及方便后续代码的扩展。</p>
<h4 data-id="heading-4">整数溢出表现</h4>
<p>接下来说一下在Go语言中，整数在运行期间溢出的表现，假设用一个int32或uint32变量来存放一个30分钟视频秒级别的总播放时长，在海量用户观看视频的过程中就一直在累加这个值。（只是为了举例，实际一般都会用有符号整数类型）</p>
<p>先看用int32的情况，已经累计到了最大值 2147483647，再加1的时候，得到的结果是什么：</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+                                   <span class="hljs-number">1</span>

= <span class="hljs-number">10000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
</code></pre>
<p>最大值+1会变成了int32负数的最小值：-2147483648。</p>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">var</span> maxInt32 <span class="hljs-type">int32</span> = math.MaxInt32

	fmt.Println(maxInt32 + <span class="hljs-number">1</span>) <span class="hljs-comment">// -2147483648</span>
</code></pre>
<p>如果是批量统计了再汇总，两个2147483647相加，得到的结果是什么：</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+   <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>

  <span class="hljs-number">1</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111110</span>
  ↑ 超过<span class="hljs-number">32</span>位的高位会被舍弃
=   <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111110</span>
</code></pre>
<p>会得到-2。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><mo>−</mo><mn>1</mn><mo>⋅</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>30</mn></mrow><mn>0</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>30</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>29</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><mn>0</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><mo stretchy="false">(</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mn>0</mn><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">数值 = −1⋅2^{31}+\sum_{i=30}^0b_i⋅2^i\\
= -2^{31} + 1·2^{30} + 1·2^{29} + ...  + 1·2^{2} + 1·2^{1} + 0·2^{0}\\
= -2^{31} + (2^{31} - 2) + 0 \\
= -2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">30</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">29</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">0</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">2</span></span></span></span></span></div>
<p>如果用uint32， 已经到了最大值4294967295，再加1的结果是什么：</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+                                     <span class="hljs-number">1</span>

  <span class="hljs-number">1</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
  ↑ 超过<span class="hljs-number">32</span>位的高位会被舍弃
=   <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
</code></pre>
<p>最大值+1会变成uint32类型的最小值0。</p>
<p>int32和uint32整数溢出时，都只会保留低32位。</p>
<p>假使这个视频总播放时长统计功能，使用了int32类型的整数来累加时长，那么溢出之后就会变成负数，计算完之后存到数据库中，统计界面查询的时候就可能看到总的播放时长是一个负数，于是产生了bug。（如果已经产生了bug并出现了脏数据，只能尝试从日志或其他数据中寻找方法，对脏数据进行修复）</p>
<p>怎么避免这种情况呢？</p>
<p>1）在计算前先做范围检查，判断两者相加不会大于最大值，也不会小于最小值。</p>
<pre><code class="hljs language-jsx" lang="jsx">func <span class="hljs-title function_">addInt32</span>(a, b int32) (int32, bool) {
    <span class="hljs-keyword">if</span> (b &gt; <span class="hljs-number">0</span> &amp;&amp; a &gt; math.<span class="hljs-property">MaxInt32</span>-b) || (b &lt; <span class="hljs-number">0</span> &amp;&amp; a &lt; math.<span class="hljs-property">MinInt32</span>-b) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-literal">false</span> <span class="hljs-comment">// 溢出的情况返回false，由外层进行告警或快照之类的处理</span>
    }
    <span class="hljs-keyword">return</span> a + b, <span class="hljs-literal">true</span>
}
</code></pre>
<p>2）换成数字范围更大的int64类型存储。</p>
<p>3）如果int64的范围都不够用，考虑使用big.Int类型：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"math/big"</span>
	<span class="hljs-string">"fmt"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddBigInt</span><span class="hljs-params">()</span></span> {
	a, _ := <span class="hljs-built_in">new</span>(big.Int).SetString(<span class="hljs-string">"9223372036854775807"</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// int64的最大值</span>
	b, _ := <span class="hljs-built_in">new</span>(big.Int).SetString(<span class="hljs-string">"9223372036854775807"</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// int64的最大值</span>

	sum := <span class="hljs-built_in">new</span>(big.Int).Add(a, b)
	fmt.Println(sum) <span class="hljs-comment">// 18446744073709551614</span>
}
</code></pre>
<p>int32和uint32的类型截断也是只保留低32位：</p>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">var</span> a <span class="hljs-type">uint64</span> = <span class="hljs-number">429496729500</span>
	<span class="hljs-keyword">var</span> b <span class="hljs-type">uint32</span> = <span class="hljs-type">uint32</span>(a)
	fmt.Println(b) <span class="hljs-comment">// 只保留低32位 4294967196 </span>
</code></pre>
<p>整数计算是不会有精度丢失的，因为计算机能精确表示整数。（一些疑似精度丢失（实则并不是）的情况，是由于溢出、类型截断之类的导致的）</p>
<p>浮点数能表示的数字范围比整数大得多，那么int64的数字范围不够用的时候，能考虑换成float64类型吗？下文浮点数的部分会给出答案。</p>
<h3 data-id="heading-5">浮点数</h3>
<p>浮点数的一般科学计数法是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mo>=</mo><mi>M</mi><mo separator="true">⋅</mo><msup><mi>R</mi><mi>E</mi></msup></mrow><annotation encoding="application/x-tex">N = M · R^E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8913em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>其中N为任何一个浮点数，M为尾数，E为阶码，R为阶码的基数。</p>
<p>十进制浮点数的表示形式大家应该都比较熟悉，123456.789 这个十进制浮点数，用科学计数法表示就是(d是十进制的意思)：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>123456.789</mn><mo>=</mo><mn>1.2345678</mn><msub><mn>9</mn><mi>d</mi></msub><mo separator="true">⋅</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">123456.789 = 1.23456789_d · 10 ^{5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">123456.789</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord">1.2345678</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>如果阶码E发生变化，小数点的位置也是会发生变化，这就是浮点数中的浮点的意思，小数点是“左右浮动”的。看上面这个数字，如果阶码E从 5 变为 6， 小数点向右移动一位变成1234567.89；阶码E从 5 变为 2，小数点向左移动3位变成123.456789。</p>
<p>二进制的科学计数法表示也是类似的，比如10111.110101这个二进制浮点数，用科学计数法表示就是(b是二进制的意思)：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>10111.110101</mn><mo>=</mo><mn>1.011111010</mn><msub><mn>1</mn><mi>b</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10111.110101 = 1.0111110101_{b} · 2^{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">10111.110101</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord">1.011111010</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Go语言中的float32和float64基本遵循IEEE-754标准，IEEE-754的浮点数计算公式为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (−1)^S×(1.Fraction)×2^{(Exp−bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.938em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<ul>
<li>
<p>基数R为2。</p>
</li>
<li>
<p>尾数M：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mtext>（</mtext><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext>）</mtext></mrow><annotation encoding="application/x-tex">M = (-1)^{S}×（1.Fraction）</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">（</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">）</span></span></span></span></span></div>
<ul>
<li>S是符号位：0表示正数，1表示负数。</li>
<li>Fraction是尾数。（虽然Fraction和M都被称为尾数，但它们表示的概念是不同的，Fraction只是M的一部分）</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">1.Fraction</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span></span> 表示最高位的1是隐含的。</li>
</ul>
</li>
<li>
<p>阶码E：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">E = Exp - bias</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">bia</span><span class="mord mathnormal">s</span></span></span></span></span></div>
<ul>
<li>Exp是指数，存的是带偏置的指数。</li>
<li>bias是偏置常数，值为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{k-1} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>，其中k是Exp的位数。
<ul>
<li>单精度浮点数(32-bit)的偏置常数是：127。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mn>8</mn><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">2^{8-1} - 1= 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></li>
<li>双精度浮点数(64-bit)的偏置常数是:  1023。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mn>11</mn><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>1023</mn></mrow><annotation encoding="application/x-tex">2^{11-1} - 1 = 1023</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1023</span></span></span></span></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0639d0d09c44490b90c4aeb59bfc8c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=3RcP3V6OUjDVLG%2FMBTJltgrmO0g%3D" alt="image 2.png" loading="lazy"/></p>
<p>IEEE标准中浮点数有这几类：正规数（normal）、次正规数（subnormal）、±0、 正负无穷大和NaN。</p>
<p>1）正规数 （normal）</p>
<ul>
<li>Exp即不是全为0，也不是全为1</li>
<li>有隐含1：有效数是1.Fraction</li>
<li>p：Fraction的bit位数（float32=23，float64=52）</li>
<li>frac：Fraction 这段比特当作无符号整数的值</li>
</ul>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mn>1.</mn><msub><mi>f</mi><mn>1</mn></msub><msub><mi>f</mi><mn>2</mn></msub><msub><mi>f</mi><mn>3</mn></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msub><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>f</mi><mi>p</mi></msub><mspace linebreak="newline"/><mo>=</mo><mn>1</mn><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mi>p</mi></mrow></msup></mrow><annotation encoding="application/x-tex">1.Fraction
= 1.f_1f_2f_3...f_{p-2}f_{p-1}f_{p}\\
= 1 + f_1 · 2^{-1}+ f_2 · 2^{-2} + ... + f_{p-1} · 2^{-(p-1)} + f_{p} · 2^{-p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord">1.</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">...</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2241em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1074em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Fraction部分当作整数时的值frac为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mi>p</mi></mrow></msup></mrow><annotation encoding="application/x-tex">frac = f_1 · 2^{p-1} + f_2 · 2^{p-2} + ... + f_{p-1} · 2^{1} + f_p · 2^0 \\
\frac{frac}{2^p} = f_1· 2^{-1} + f_2· 2^{-2} + ... + f_{p-1}· 2^{-(p-1)} + f_p· 2^{-p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1502em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1502em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2241em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1074em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>所以得到数值计算公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo separator="true">⋅</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo stretchy="false">)</mo><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (-1)^S · (1 + \frac{frac}{2^p}) · 2^{(Exp - bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>2）次正规数 (subnormal)</p>
<ul>
<li>Exp全为0，并且Fraction ≠ 0</li>
<li>没有隐含的1：有效数是0.Fraction</li>
<li>p：Fraction的bit位数（float32=23，float64=52）</li>
<li>frac：Fraction 这段比特当作无符号整数的值</li>
</ul>
<p>数值计算公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo separator="true">⋅</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo stretchy="false">)</mo><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (-1)^S · (\frac{frac}{2^p}) · 2^{(1 - bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>3）零（±0）</p>
<ul>
<li>Exp全为0，并且Fraction = 0</li>
<li>+0还是 -0根据S决定</li>
</ul>
<p>4）特殊值：正负无穷大和NaN</p>
<ul>
<li>Exp全为1
<ul>
<li>Fraction = 0， 为正负无穷大</li>
<li>Fraction ≠ 0，是NaN</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6"><strong>float32 （单精度，32位浮点数）</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52175cea39f2492a803f015a4a2e8396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=%2FPG3Ts2j%2BLrEcYl0f6%2Fxm%2FIOZgc%3D" alt="image 3.png" loading="lazy"/>
1）正规数</p>
<ul>
<li>Exp即不是全为0，也不是全为1</li>
<li>有隐含1：有效数是1.Fraction</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef6151557b7c48b89cf77d2fa53d56a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=b4JyJJDW3u4soovllh1mXE9R2RA%3D" alt="floa32正规数计算.drawio.svg" loading="lazy"/></p>
<p>2）次正规数</p>
<ul>
<li>Exp全为0，并且Fraction ≠ 0</li>
<li>没有隐含的1：有效数是0.Fraction</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/973159b9b53146bb8eab81d2b6f192f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=gYSv5z9UGIpurYVhze8JGTqaRQ4%3D" alt="float32次正规数的计算.drawio.svg" loading="lazy"/></p>
<p>3）零（±0）</p>
<ul>
<li>Exp全为0，并且Fraction = 0</li>
<li>+0还是 -0根据S决定</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd03fa9a20d4f4da065cebc21f11c7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=oJJw9Oj03CtgGB3GNSuhVrDukXM%3D" alt="image 4.png" loading="lazy"/></p>
<p>4）特殊值：正负无穷大和NaN</p>
<ul>
<li>Exp全为1
<ul>
<li>Fraction = 0， 为正负无穷大</li>
<li>Fraction ≠ 0，是NaN</li>
</ul>
</li>
</ul>
<p>正负无穷大：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3838751e2654f529a0bbe8119394c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=IA5xWBi6WGWFbyT%2F4V8SyZnTj8M%3D" alt="image 5.png" loading="lazy"/></p>
<p>NaN：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70b3999d77c740f7b9df0ac241039277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=ockjTlUlFfg2YXuuQPa8xirsk0I%3D" alt="image 6.png" loading="lazy"/></p>
<h4 data-id="heading-7"><strong>float64 （双精度，64位浮点数）</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1066e5ed565d4293be31fc8445f6a3ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=iHhohqOVX9aM3cgZTCxkF74TGKk%3D" alt="image 7.png" loading="lazy"/></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup><mspace linebreak="newline"/></mrow><annotation encoding="application/x-tex">Value = (−1)^S×(1.Fraction)×2^{(Exp−bias)}\\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.938em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"/></span></span></span></div>
<p>float64和float32的计算方式一样，只是Exp的位数、Fraction的位数，以及偏置常数与float32不同。</p>
<h4 data-id="heading-8">浮点数溢出表现</h4>
<p>按照IEEE标准规定，浮点数上溢时可能会变成±Inf，下溢时可能会变成次正规数或是0。</p>
<h4 data-id="heading-9">为什么浮点数会有精度丢失</h4>
<p>以小数点位全部为1的十进制小数和二进制小数举一个简单的例子：</p>
<p>只看小数的部分，十进制的小数部分是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mi>n</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \frac{1}{10^{n}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>比如十进制数0.111，就是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>1</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{10^1} + \frac{1}{10^{2}} + \frac{1}{10^{3}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>而二进制的小数部分是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mi>n</mi></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>比如二进制小数0.111，就是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mn>1</mn></msup></mfrac><mo>+</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>2</mn></msup></mfrac><mo>+</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>3</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^1} + \frac{1}{2^2} + \frac{1}{2^3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>十进制的小数转换为下面这个公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mi>n</mi></msup></mrow></mfrac><mspace linebreak="newline"/><mo>=</mo><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">⋅</mo><mn>5</mn><msup><mo stretchy="false">)</mo><mi>n</mi></msup></mrow></mfrac><mspace linebreak="newline"/><mo>=</mo><mfrac><mn>1</mn><mrow><msup><mn>2</mn><mi>n</mi></msup><mo separator="true">⋅</mo><msup><mn>5</mn><mi>n</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{10^n} \\
= \frac{1}{(2·5)^n} \\
= \frac{1}{2^n · 5^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">5</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>能很直观地看出只有在十进制小数的分母中不包含质因数5的时候（仅包含质因数2时），才能被二进制准确表示。下面两个是能被二进制精确表示的十进制数字：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0.</mn><msub><mn>5</mn><mi>d</mi></msub><mo>=</mo><mfrac><mn>5</mn><mn>10</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.</mn><msub><mn>1</mn><mi>b</mi></msub><mspace linebreak="newline"/><mtext> </mtext><mspace linebreak="newline"/><mn>0.25</mn><mo>=</mo><mfrac><mn>25</mn><mn>100</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>2</mn></msup></mfrac><mo>=</mo><mn>0.0</mn><msub><mn>1</mn><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">0.5_d = \frac{5}{10} = \frac{1}{2} = 0.1_b\\
~\\ 
0.25 = \frac{25}{100} = \frac{1}{2^2}  = 0.01_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0em;"/><span class="mspace nobreak"> </span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.25</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">100</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">25</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.0</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>十进制转换为最简分数后，如果质因数包含5，这个数字就不能被有限二进制位表示了：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0.1</mn><mo>=</mo><mfrac><mn>1</mn><mn>10</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mo separator="true">⋅</mo><mn>5</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">0.1 = \frac{1}{10} = \frac{1}{2·5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>能很直观看出十进制0.1没有这这种二进制位置：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mi>n</mi></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>从数学的概念上，0.1是能表示为二进制无限循环小数的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532e5973d1d647968648f70700b3870d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=XfwKMPikK96gusyUUQgKRyr3g14%3D" alt="微信图片_20260131224253_26_3.jpg" loading="lazy"/></p>
<p>但计算机用于表示浮点数的位数不是无限的，而是有限位，所以只能通过把无限循环的小数位截断，以及进行舍入，用一个和十进制0.1近似的二进制数表示0.1，比如：</p>
<pre><code class="hljs language-jsx" lang="jsx">真实:  <span class="hljs-number">0.0001100110011001100110011001100110011</span>...
存储:  <span class="hljs-number">0.00011001100110011001100</span>            （截断/舍入）
</code></pre>
<p>这就是浮点数精度丢失的原因，在进行运算的时候，两个近似值相加，再进行截断/舍入，就会放大这种差异，比如经典的0.1 + 0.2 不等于 0.3。</p>
<p>用Go和JS打印了下0.1+0.2，终端看到的值不一样（JS是用Node执行的），</p>
<p>Go：</p>
<pre><code class="hljs language-jsx" lang="jsx">fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.20f\n"</span>, <span class="hljs-number">0.1</span>	+ <span class="hljs-number">0.2</span>) <span class="hljs-comment">// 0.29999999999999998890</span>
</code></pre>
<p>JS：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0.1</span>+<span class="hljs-number">0.2</span>) <span class="hljs-comment">// 0.30000000000000004</span>
</code></pre>
<p>两边都是float64类型，遵循IEEE标准，所以底层存储应该是一样的，只是不同语言将这种存储转换为字符串的方式有所不同，一个取了较低的值（&lt;0.3），一个取了较高的值（&gt;0.3）。</p>
<p>为了解决浮点数的精度丢失问题，可以使用decimal包来做十进制的精确计算：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/shopspring/decimal"</span>
	<span class="hljs-string">"fmt"</span>
)

func <span class="hljs-title class_">AddNum</span>() {
	d1, _ := decimal.<span class="hljs-title class_">NewFromString</span>(<span class="hljs-string">"0.1"</span>)
	d2, _ := decimal.<span class="hljs-title class_">NewFromString</span>(<span class="hljs-string">"0.2"</span>)
	sum := d1.<span class="hljs-title class_">Add</span>(d2)

	fmt.<span class="hljs-title class_">Println</span>(sum.<span class="hljs-title class_">StringFixed</span>(<span class="hljs-number">20</span>)) <span class="hljs-comment">// 0.30000000000000000000</span>
}
</code></pre>
<p>二进制数无法通过有限的数位精确表示小数，所以会丢失精度，那么用来表示整数，是不是就是精确的了。比如int64整数溢出的时候，是否考虑用能表示的数字范围更广的float64类型。答案是不会，因为float64能精确表示的整数范围小于int64的范围，float64类型只能精确表示≤ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>53</mn></msup></mrow><annotation encoding="application/x-tex">2^{53}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">53</span></span></span></span></span></span></span></span></span></span></span></span></span> 的整数，超过这个范围的整数就不能精确表示了（这个和尾数Fraction的位数有关，float32只能精确表示≤ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup></mrow><annotation encoding="application/x-tex">2^{24}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span></span></span></span></span>的整数）。</p>
<p>二进制数无法通过有限的数位精确表示小数，所以会丢失精度，那么用来表示整数，是不是就是精确的了。比如int64整数溢出的时候，是否能考虑用数字范围更广的float64类型。答案是不能，因为float64能精确表示的整数范围小于int64的范围，float64类型只能精确表示≤ 2^53 的整数，超过这个范围的整数就不能精确表示了（这个和尾数Fraction的位数有关，float32只能精确表示≤ 2^24的整数）。</p>
<p>例如，float64是没有2^53 + 1这个整数的位置的：</p>
<pre><code class="hljs language-jsx" lang="jsx">	n := <span class="hljs-title function_">int64</span>(<span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">53</span> <span class="hljs-comment">// 2^53</span>

	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n))   <span class="hljs-comment">// 9007199254740992</span>
	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n+<span class="hljs-number">1</span>)) <span class="hljs-comment">// 9007199254740992（被舍入）</span>
	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n+<span class="hljs-number">2</span>)) <span class="hljs-comment">// 9007199254740994</span>
</code></pre>
<h2 data-id="heading-10">复数</h2>
<p>Go中的复数类型一般情况下不会用到，可以简单了解下是什么概念就可以了。</p>
<ul>
<li><strong>complex64</strong>：实部和虚部都是 float32，占 8 字节</li>
<li><strong>complex128</strong>：实部和虚部都是 float64，占 16 字节（默认是complex128类型）</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"math/cmplx"</span>
	<span class="hljs-string">"reflect"</span>
)

func <span class="hljs-title class_">ComplexNumber</span>() {
	a := <span class="hljs-number">3</span> + 4i
	b := <span class="hljs-number">1</span> - 2i

	fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">"a + b ="</span>, a+b)          <span class="hljs-comment">// (4+2i)</span>
	fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">"|a| ="</span>, cmplx.<span class="hljs-title class_">Abs</span>(a))   <span class="hljs-comment">// 5</span>
	fmt.<span class="hljs-title class_">Println</span>(reflect.<span class="hljs-title class_">TypeOf</span>(a))       <span class="hljs-comment">// complex128</span>
}
</code></pre>
<h2 data-id="heading-11">结尾</h2>
<p>数字涉及到的知识远不止于此，之后如果有数字相关的内容再单开文章写。</p>
<p>文中说过”所有数据最终都是以bit序列存储在计算机中的”，字符串也不例外。在这篇文章中已经大概了解到了数字是怎样以二进制方式存储的了，字符串中的字符其实也是转换成对应的数字之后，以二进制形式存储的，下一篇记录字符串相关的内容。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify]]></title>    <link>https://juejin.cn/post/7601159804491005971</link>    <guid>https://juejin.cn/post/7601159804491005971</guid>    <pubDate>2026-02-01T09:46:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804491005971" data-draft-id="7601103779393011775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-01T09:46:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:46:34.000Z" title="Sun Feb 01 2026 09:46:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年1月28日，北京Blue Note爵士俱乐部的灯光暗下，但这并不是一场传统的爵士演出。在这个充满了即兴与灵感的场域，昆仑万维旗下的昆仑天工把那层笼罩在AI音乐头上的“玩具”面纱狠狠扯了下来。</p>
<p>他们发布的Mureka V8音乐大模型，在这个寒冬里扔出了一句颇具火药味的宣言：AI音乐，要从“可生成”迈向“可发布”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.35.39-1024x576.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.35.39-1024x576.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f0d8017f8614edbb70f9883989182fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=S%2FTjW4ixtMg10PFBSCgLaLakznc%3D" alt="iShot_2026-02-01_17.35.39" loading="lazy"/></a></p>
<p>作为长期关注AI生成领域的观察者，我必须承认，过去的AI音乐总有一种“恐怖谷”效应——乍一听像那么回事，但多听几秒，你就能感受到那种拼凑感、廉价的电子味，以及不知所云的段落结构。但Mureka V8这次似乎真的换了脑子。</p>
<h4 data-id="heading-0">它学会了像制作人一样思考</h4>
<p>这就要提到这次的核心技术突破——MusiCoT（Music Chain-of-Thought），即“音乐思维链”。</p>
<p>以前的AI生成音乐，更像是一个听过很多歌的鹦鹉，它在模仿声音的波形，却不懂音乐的逻辑。而基于MusiCoT的Mureka V8，更像是一个受过科班训练的作曲家。在生成音频之前，它会先在大脑里构思一张蓝图：这首歌的情绪起伏是怎样的？主歌到副歌怎么推进？哪里需要一个强有力的Bass Drop？</p>
<p>这种“先谋篇布局，后落笔填词”的逻辑，直接解决了AI音乐最大的痛点——结构松散。根据官方盲测数据，V8在中文歌曲的表现上已经把曾经的王者Suno V5甩在了身后。现在的它，不仅能写出抓耳的Hook（记忆点），还能搞定复杂的编曲层次。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.33.30-1024x376.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.33.30-1024x376.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95ce369a705d485c9b933249fd1ee286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=%2F6oNAws4PoS9RA%2FN16p76lxI1RA%3D" alt="iShot_2026-02-01_17.33.30" loading="lazy"/></a></p>
<h4 data-id="heading-1">不仅是生成，更是成品</h4>
<p>如果你听过现场的演示，你会发现“质感”是V8最大的护城河。</p>
<p>在人声表现上，它不再是冷冰冰的虚拟歌姬。V8模拟出的歌手具有极强的“主唱存在感”，你能听到换气时的微弱呼吸，感受到情绪的递进，甚至能精准匹配性别和唱法。</p>
<p>在编曲和混音层面，它试图达到工业级的标准。声场不再是一团浆糊，而是有了空间感和立体感。昆仑万维董事长周亚辉甚至直言，相比两年前的V1版本，V8的能力实现了百倍的跃升。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.33.37-1024x690.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.33.37-1024x690.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed245382c144922b5a9b6b5558a4c59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=rHc75KpkXBFw3mpq4cqAbBd%2BFWY%3D" alt="iShot_2026-02-01_17.33.37" loading="lazy"/></a></p>
<h4 data-id="heading-2">不仅是工具，更是一场关于“品类”的辩论</h4>
<p>发布会现场最精彩的并不是技术参数的罗列，而是观点的碰撞。</p>
<p>一边是技术派的周亚辉，他认为AI集成了所有乐器，能让普通人低成本创作，这必将诞生一个新的“音乐品类”。另一边是音乐界的“老炮儿”高晓松，他虽然对AI持审慎态度，认为AI创造的是新的UGC产品而非传统版权音乐，但也承认AI带来的海量内容需要新的形态来承载。</p>
<p>更有趣的是资深制作人闻震的观点，他给出了一个非常务实的解法：AI负责把那80%的基础工作做到极致，而音乐人要做的，是那决定性的20%——审美、认知，以及如何用提示词去驾驭这个庞然大物。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fsdagsgdf-1024x591.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/sdagsgdf-1024x591.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e5f954745624351a9b207845c13136c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=KbejyxrXmWBpiOh%2F%2FYIL5H2W2oQ%3D" alt="sdagsgdf" loading="lazy"/></a></p>
<h4 data-id="heading-3">剑指海外，意在成为“AI版Spotify”</h4>
<p>昆仑天工的野心显然不止于做一个生成器。</p>
<p>看看它的商业版图：C端会员月费88元，并不便宜，但这背后是一整套生态。它想做的是海外市场的“AI版Spotify”，目标直指3-5亿月活。在国内，它选择与太合音乐这样的巨头联手，把AI塞进主流音乐的制作发行流程里。</p>
<p>这就意味着，未来你在流媒体平台上听到的某首爆款热歌，很可能就是由Mureka V8打底，再由人类制作人润色而成的。</p>
<h4 data-id="heading-4">写在最后</h4>
<p>Mureka V8的出现，标志着AI音乐正式告别了“听个响”的猎奇阶段。</p>
<p>它给了普通创作者一把打开音乐大门的钥匙，只要你会说话，你就能通过自然语言、甚至哼唱一段旋律，让AI帮你完成一首像模像样的作品。当然，正如高晓松所虑，当音乐生产的门槛被夷为平地，我们将面临的是创意的爆发还是垃圾内容的泛滥？这还需要时间来验证。</p>
<p>但至少现在，对于那些满脑子旋律却不懂乐理的人来说，最好的时代可能真的来了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行]]></title>    <link>https://juejin.cn/post/7601076694105423908</link>    <guid>https://juejin.cn/post/7601076694105423908</guid>    <pubDate>2026-02-01T09:51:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105423908" data-draft-id="7601076694105407524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-02-01T09:51:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:51:02.000Z" title="Sun Feb 01 2026 09:51:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果最新的 AI 模型能在你的手机上、IoT 设备上、甚至边缘设备上运行，而不需要依赖云端，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第9篇文章。今天带你了解的项目是 <strong>NexaSDK</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNexaAI%2Fnexa-sdk" target="_blank" title="https://github.com/NexaAI/nexa-sdk" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>想象一下，你可以在 Android 手机上运行 Qwen3-VL 多模态模型，在 iOS 设备上使用 Apple Neural Engine 进行语音识别，在 Linux IoT 设备上运行 Granite-4 模型，所有这一切都不需要连接到云端。这就是 NexaSDK 带来的革命性体验——让前沿 AI 模型真正"落地"到各种设备上。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🚀 <strong>NPU 优先</strong>：业界首个 NPU-first 的设备端 AI 运行时</li>
<li>📱 <strong>全平台支持</strong>：PC、Android、iOS、Linux/IoT 全覆盖</li>
<li>🎯 <strong>Day-0 模型支持</strong>：支持最新发布的模型（GGUF、MLX、NEXA 格式）</li>
<li>🔌 <strong>多模态能力</strong>：LLM、VLM、ASR、OCR、Rerank、图像生成等</li>
<li>🌟 <strong>社区认可</strong>：7.6k+ Stars，与 Qualcomm 合作举办设备端 AI 竞赛</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>NexaSDK 的核心概念和架构设计</li>
<li>如何在各种平台上运行设备端 AI 模型</li>
<li>NPU、GPU、CPU 三种计算后端的支持和使用</li>
<li>多模态 AI 能力的集成和使用</li>
<li>与其他设备端 AI 框架的对比分析</li>
<li>如何开始使用 NexaSDK 构建设备端 AI 应用</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对 LLM 和 AI 模型有基本了解</li>
<li>熟悉至少一种编程语言（Python、Go、Kotlin、Swift）</li>
<li>了解设备端 AI 的基本概念（可选）</li>
<li>对 NPU、GPU 等硬件加速有基本了解（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>NexaSDK</strong> 是一个<strong>跨平台的设备端 AI 运行时</strong>，支持在 GPU、NPU 和 CPU 上运行前沿的 LLM 和 VLM 模型。它提供了全面的运行时覆盖，支持 PC（Python/C++）、移动端（Android &amp; iOS）和 Linux/IoT（Arm64 &amp; x86 Docker）平台。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>设备端 AI 运行时碎片化，不同平台需要不同的解决方案</li>
<li>缺乏对 NPU 的原生支持，无法充分利用硬件加速</li>
<li>新模型发布后，设备端支持滞后（缺乏 day-0 支持）</li>
<li>多模态 AI 能力在设备端难以集成</li>
<li>跨平台开发成本高，需要为每个平台单独实现</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>需要构建设备端 AI 应用的开发者</li>
<li>希望利用 NPU 加速的移动应用开发者</li>
<li>需要在 IoT 设备上运行 AI 模型的开发者</li>
<li>对设备端 AI 感兴趣的研究人员</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：NexaAI</strong></p>
<ul>
<li><strong>背景</strong>：专注于设备端 AI 解决方案的团队</li>
<li><strong>合作伙伴</strong>：与 Qualcomm 合作，举办设备端 AI 竞赛</li>
<li><strong>贡献者</strong>：45 位贡献者，包括 @RemiliaForever、@zhiyuan8、@mengshengwu 等</li>
<li><strong>理念</strong>：让前沿 AI 模型能够在各种设备上高效运行</li>
</ul>
<p><strong>项目创建时间</strong>：2024年（从 GitHub 提交历史可以看出项目持续活跃）</p>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 7.6k+（持续快速增长）</li>
<li>🍴 <strong>Forks</strong>: 944+</li>
<li>📦 <strong>版本</strong>: v0.2.71（最新版本，2026年1月22日发布）</li>
<li>📄 <strong>License</strong>: Apache-2.0（CPU/GPU 组件），NPU 组件需要许可证</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">docs.nexa.ai</a></li>
<li>📚 <strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">完整文档</a></li>
<li>💬 <strong>社区</strong>: Discord、Slack 社区活跃</li>
<li>🏆 <strong>竞赛</strong>: Nexa × Qualcomm 设备端 AI 竞赛（$6,500 奖金）</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2024年：项目启动，初步版本发布</li>
<li>2024-2025年：快速发展，添加多平台支持</li>
<li>2025年：NPU 支持完善，与 Qualcomm 合作</li>
<li>2026年：持续迭代，添加更多模型和功能支持</li>
</ul>
<p><strong>支持的模型</strong>：</p>
<ul>
<li>OpenAI GPT-OSS</li>
<li>IBM Granite-4</li>
<li>Qwen-3-VL</li>
<li>Gemma-3n</li>
<li>Ministral-3</li>
<li>以及更多前沿模型</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>NexaSDK 的核心作用是<strong>提供统一的跨平台设备端 AI 运行时</strong>，让开发者能够：</p>
<ol>
<li><strong>在多种设备上运行 AI 模型</strong>：PC、手机、IoT 设备全覆盖</li>
<li><strong>充分利用硬件加速</strong>：NPU、GPU、CPU 三种后端自动选择</li>
<li><strong>快速集成新模型</strong>：Day-0 支持，新模型发布即可使用</li>
<li><strong>多模态 AI 能力</strong>：文本、图像、音频、视频等全方位支持</li>
<li><strong>简化开发流程</strong>：统一的 API，一套代码多平台运行</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<ol>
<li>
<p><strong>移动端 AI 应用</strong></p>
<ul>
<li>手机上的智能助手</li>
<li>离线语音识别和翻译</li>
<li>图像识别和处理</li>
<li>本地 LLM 对话应用</li>
</ul>
</li>
<li>
<p><strong>IoT 和边缘计算</strong></p>
<ul>
<li>智能家居设备的 AI 能力</li>
<li>工业 IoT 的智能分析</li>
<li>边缘服务器的 AI 推理</li>
<li>自动驾驶设备的感知能力</li>
</ul>
</li>
<li>
<p><strong>桌面应用集成</strong></p>
<ul>
<li>本地 AI 助手</li>
<li>文档智能处理</li>
<li>代码生成工具</li>
<li>创意内容生成</li>
</ul>
</li>
<li>
<p><strong>企业级应用</strong></p>
<ul>
<li>数据隐私保护（本地处理）</li>
<li>离线 AI 能力</li>
<li>降低云端成本</li>
<li>实时响应需求</li>
</ul>
</li>
<li>
<p><strong>研究和开发</strong></p>
<ul>
<li>模型性能测试</li>
<li>硬件加速研究</li>
<li>新模型验证</li>
<li>算法优化实验</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">CLI 方式（最简单）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Nexa CLI</span>
<span class="hljs-comment"># Windows (x64 with Intel/AMD NPU)</span>
<span class="hljs-comment"># 下载: nexa-cli_windows_x86_64.exe</span>

<span class="hljs-comment"># macOS (x64)</span>
<span class="hljs-comment"># 下载: nexa-cli_macos_x86_64.pkg</span>

<span class="hljs-comment"># Linux (ARM64)</span>
curl -L https://github.com/NexaAI/nexa-sdk/releases/latest/download/nexa-cli_linux_arm64.sh | bash

<span class="hljs-comment"># 运行第一个模型</span>
nexa infer ggml-org/Qwen3-1.7B-GGUF

<span class="hljs-comment"># 多模态：拖拽图片到 CLI</span>
nexa infer NexaAI/Qwen3-VL-4B-Instruct-GGUF

<span class="hljs-comment"># NPU 支持（Windows arm64 with Snapdragon X Elite）</span>
nexa infer NexaAI/OmniNeural-4B
</code></pre>
<h4 data-id="heading-12">Python SDK</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安装</span>
pip install nexaai

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">from</span> nexaai <span class="hljs-keyword">import</span> LLM, GenerationConfig, ModelConfig, LlmChatMessage

<span class="hljs-comment"># 创建 LLM 实例</span>
llm = LLM.from_(model=<span class="hljs-string">"NexaAI/Qwen3-0.6B-GGUF"</span>, config=ModelConfig())

<span class="hljs-comment"># 构建对话</span>
conversation = [
    LlmChatMessage(role=<span class="hljs-string">"user"</span>, content=<span class="hljs-string">"Hello, tell me a joke"</span>)
]
prompt = llm.apply_chat_template(conversation)

<span class="hljs-comment"># 流式生成</span>
<span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> llm.generate_stream(prompt, GenerationConfig(max_tokens=<span class="hljs-number">100</span>)):
    <span class="hljs-built_in">print</span>(token, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-13">Android SDK</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 添加到 build.gradle.kts</span>
dependencies {
    implementation(<span class="hljs-string">"ai.nexa:core:0.0.19"</span>)
}

<span class="hljs-comment">// 初始化 SDK</span>
NexaSdk.getInstance().<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>)

<span class="hljs-comment">// 加载和运行模型</span>
VlmWrapper.builder()
    .vlmCreateInput(VlmCreateInput(
        model_name = <span class="hljs-string">"omni-neural"</span>,
        model_path = <span class="hljs-string">"/data/data/your.app/files/models/OmniNeural-4B/files-1-1.nexa"</span>,
        plugin_id = <span class="hljs-string">"npu"</span>,
        config = ModelConfig()
    ))
    .build()
    .onSuccess { vlm -&gt;
        vlm.generateStreamFlow(<span class="hljs-string">"Hello!"</span>, GenerationConfig()).collect { print(it) }
    }
</code></pre>
<h4 data-id="heading-14">iOS SDK</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> NexaSdk

<span class="hljs-comment">// 示例：语音识别</span>
<span class="hljs-keyword">let</span> asr <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">Asr</span>(plugin: .ane)
<span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> asr.load(from: modelURL)

<span class="hljs-keyword">let</span> result <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> asr.transcribe(options: .<span class="hljs-keyword">init</span>(audioPath: <span class="hljs-string">"audio.wav"</span>))
<span class="hljs-built_in">print</span>(result.asrResult.transcript)
</code></pre>
<h4 data-id="heading-15">Linux Docker</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取镜像</span>
docker pull nexa4ai/nexasdk:latest

<span class="hljs-comment"># 运行（需要 NPU token）</span>
<span class="hljs-built_in">export</span> NEXA_TOKEN=<span class="hljs-string">"your_token_here"</span>
docker run --<span class="hljs-built_in">rm</span> -it --privileged \
  -e NEXA_TOKEN \
  nexa4ai/nexasdk:latest infer NexaAI/Granite-4.0-h-350M-NPU
</code></pre>
<h3 data-id="heading-16">核心特性</h3>
<ol>
<li>
<p><strong>NPU 优先支持</strong></p>
<ul>
<li>业界首个 NPU-first 的设备端 AI 运行时</li>
<li>支持 Qualcomm Hexagon NPU</li>
<li>支持 Apple Neural Engine (ANE)</li>
<li>支持 Intel/AMD NPU</li>
<li>显著提升性能和能效比</li>
</ul>
</li>
<li>
<p><strong>全平台运行时</strong></p>
<ul>
<li><strong>PC</strong>: Python/C++ SDK</li>
<li><strong>Android</strong>: Kotlin SDK，支持 NPU/GPU/CPU</li>
<li><strong>iOS</strong>: Swift SDK，支持 ANE</li>
<li><strong>Linux/IoT</strong>: Docker 镜像，支持 Arm64 &amp; x86</li>
</ul>
</li>
<li>
<p><strong>Day-0 模型支持</strong></p>
<ul>
<li>支持最新发布的模型</li>
<li>支持多种模型格式：GGUF、MLX、NEXA</li>
<li>快速集成新模型到设备端</li>
</ul>
</li>
<li>
<p><strong>多模态 AI 能力</strong></p>
<ul>
<li><strong>LLM</strong>: 大语言模型</li>
<li><strong>VLM</strong>: 视觉语言模型（多模态）</li>
<li><strong>ASR</strong>: 自动语音识别</li>
<li><strong>OCR</strong>: 光学字符识别</li>
<li><strong>Rerank</strong>: 重排序</li>
<li><strong>Object Detection</strong>: 目标检测</li>
<li><strong>Image Generation</strong>: 图像生成</li>
<li><strong>Embedding</strong>: 向量嵌入</li>
</ul>
</li>
<li>
<p><strong>统一的 API 接口</strong></p>
<ul>
<li>OpenAI 兼容的 API</li>
<li>Function calling 支持</li>
<li>流式生成支持</li>
<li>统一的配置接口</li>
</ul>
</li>
<li>
<p><strong>模型格式支持</strong></p>
<ul>
<li><strong>GGUF</strong>: 广泛使用的量化格式</li>
<li><strong>MLX</strong>: Apple MLX 框架格式</li>
<li><strong>NEXA</strong>: NexaSDK 原生格式</li>
</ul>
</li>
<li>
<p><strong>硬件加速优化</strong></p>
<ul>
<li>自动选择最佳计算后端</li>
<li>NPU &gt; GPU &gt; CPU 的优先级</li>
<li>针对不同硬件的优化</li>
</ul>
</li>
<li>
<p><strong>开发者友好</strong></p>
<ul>
<li>一行代码运行模型</li>
<li>详细的文档和示例</li>
<li>活跃的社区支持</li>
<li>丰富的 Cookbook</li>
</ul>
</li>
</ol>
<h3 data-id="heading-17">项目优势</h3>
<p>与其他设备端 AI 框架相比，NexaSDK 的优势：</p>




































































<table><thead><tr><th align="left">对比项</th><th align="left">NexaSDK</th><th align="left">Ollama</th><th align="left">llama.cpp</th><th align="left">LM Studio</th></tr></thead><tbody><tr><td align="left"><strong>NPU 支持</strong></td><td align="left">⭐⭐⭐⭐⭐ NPU-first</td><td align="left">❌ 不支持</td><td align="left">❌ 不支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Android/iOS SDK</strong></td><td align="left">⭐⭐⭐⭐⭐ 完整支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Linux Docker</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Day-0 模型支持</strong></td><td align="left">⭐⭐⭐⭐⭐ GGUF/MLX/NEXA</td><td align="left">❌ 滞后</td><td align="left">⚠️ 部分支持</td><td align="left">❌ 滞后</td></tr><tr><td align="left"><strong>多模态支持</strong></td><td align="left">⭐⭐⭐⭐⭐ 完整支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td></tr><tr><td align="left"><strong>跨平台支持</strong></td><td align="left">⭐⭐⭐⭐⭐ 全平台</td><td align="left">⚠️ 部分平台</td><td align="left">⚠️ 部分平台</td><td align="left">⚠️ 部分平台</td></tr><tr><td align="left"><strong>一行代码运行</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⚠️ 需要配置</td><td align="left">⭐⭐⭐⭐⭐ 支持</td></tr><tr><td align="left"><strong>OpenAI API 兼容</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td></tr></tbody></table>
<p><strong>为什么选择 NexaSDK？</strong></p>
<ul>
<li>✅ <strong>NPU 优先</strong>：充分利用硬件加速，性能和能效比最优</li>
<li>✅ <strong>全平台支持</strong>：一套 SDK 覆盖所有平台，降低开发成本</li>
<li>✅ <strong>Day-0 支持</strong>：新模型发布即可使用，无需等待</li>
<li>✅ <strong>多模态能力</strong>：完整的 AI 能力栈，满足各种需求</li>
<li>✅ <strong>开发者友好</strong>：简单的 API，丰富的文档和示例</li>
</ul>
<hr/>
<h2 data-id="heading-18">项目详细剖析</h2>
<h3 data-id="heading-19">架构设计</h3>
<p>NexaSDK 采用<strong>分层式架构</strong>，核心是统一的运行时抽象层：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────┐
│   应用层 (Applications)              │
│   - CLI / Python / Android / iOS    │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   SDK 层 (SDK Layer)                 │
│   - 统一的 API 接口                   │
│   - 模型加载和管理                     │
│   - 配置和优化                         │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   运行时层 (Runtime Layer)           │
│   - 计算后端抽象                       │
│   - 模型格式解析                       │
│   - 推理引擎                           │
└──────────────┬──────────────────────┘
               │
    ┌──────────┴──────────┐
    │                     │
┌───▼────┐         ┌─────▼─────┐
│  NPU   │         │   GPU     │
│ Plugin │         │  Plugin   │
└────────┘         └───────────┘
    │                     │
┌───▼─────────────────────▼─────┐
│   CPU Plugin (Fallback)        │
└────────────────────────────────┘
</code></pre>
<h3 data-id="heading-20">核心模块详解</h3>
<h4 data-id="heading-21">1. 计算后端抽象层</h4>
<p><strong>功能</strong>：统一管理不同的计算后端（NPU、GPU、CPU）</p>
<p><strong>设计特点</strong>：</p>
<ul>
<li>插件化架构，易于扩展</li>
<li>自动选择最佳后端</li>
<li>优先级：NPU &gt; GPU &gt; CPU</li>
<li>支持后端切换和回退</li>
</ul>
<p><strong>支持的 NPU</strong>：</p>
<ul>
<li>Qualcomm Hexagon NPU（Snapdragon）</li>
<li>Apple Neural Engine（iOS/macOS）</li>
<li>Intel/AMD NPU（Windows）</li>
</ul>
<h4 data-id="heading-22">2. 模型格式支持</h4>
<p><strong>GGUF 格式</strong>：</p>
<ul>
<li>广泛使用的量化格式</li>
<li>支持多种量化级别</li>
<li>兼容 llama.cpp 生态</li>
</ul>
<p><strong>MLX 格式</strong>：</p>
<ul>
<li>Apple MLX 框架格式</li>
<li>针对 Apple Silicon 优化</li>
<li>支持 macOS 和 iOS</li>
</ul>
<p><strong>NEXA 格式</strong>：</p>
<ul>
<li>NexaSDK 原生格式</li>
<li>针对 NPU 优化</li>
<li>更好的性能和兼容性</li>
</ul>
<h4 data-id="heading-23">3. 多模态能力</h4>
<p><strong>LLM（大语言模型）</strong>：</p>
<ul>
<li>文本生成和对话</li>
<li>支持流式输出</li>
<li>支持 Function Calling</li>
</ul>
<p><strong>VLM（视觉语言模型）</strong>：</p>
<ul>
<li>图像理解和生成</li>
<li>多模态对话</li>
<li>视觉问答</li>
</ul>
<p><strong>ASR（自动语音识别）</strong>：</p>
<ul>
<li>语音转文字</li>
<li>支持多种音频格式</li>
<li>实时识别支持</li>
</ul>
<p><strong>OCR（光学字符识别）</strong>：</p>
<ul>
<li>图像中的文字识别</li>
<li>多语言支持</li>
<li>高精度识别</li>
</ul>
<p><strong>其他能力</strong>：</p>
<ul>
<li>Rerank：文本重排序</li>
<li>Object Detection：目标检测</li>
<li>Image Generation：图像生成</li>
<li>Embedding：向量嵌入</li>
</ul>
<h4 data-id="heading-24">4. 平台特定实现</h4>
<p><strong>PC 平台（Python/C++）</strong>：</p>
<ul>
<li>Python SDK：易于使用</li>
<li>C++ SDK：高性能</li>
<li>支持 Windows、macOS、Linux</li>
</ul>
<p><strong>Android 平台</strong>：</p>
<ul>
<li>Kotlin SDK</li>
<li>支持 NPU（Snapdragon 8 Gen 4+）</li>
<li>支持 GPU 和 CPU 回退</li>
<li>最小 SDK 27</li>
</ul>
<p><strong>iOS 平台</strong>：</p>
<ul>
<li>Swift SDK</li>
<li>支持 Apple Neural Engine</li>
<li>iOS 17.0+ / macOS 15.0+</li>
<li>Swift 5.9+</li>
</ul>
<p><strong>Linux/IoT 平台</strong>：</p>
<ul>
<li>Docker 镜像</li>
<li>支持 Arm64 和 x86</li>
<li>支持 Qualcomm Dragonwing IQ9</li>
<li>适合边缘计算场景</li>
</ul>
<h3 data-id="heading-25">关键技术实现</h3>
<h4 data-id="heading-26">1. NPU 加速优化</h4>
<p><strong>挑战</strong>：不同厂商的 NPU 架构差异大</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>统一的 NPU 抽象层</li>
<li>针对不同 NPU 的优化实现</li>
<li>自动检测和选择 NPU</li>
<li>性能监控和调优</li>
</ul>
<h4 data-id="heading-27">2. 模型格式转换</h4>
<p><strong>挑战</strong>：支持多种模型格式，需要统一处理</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>格式解析器抽象</li>
<li>统一的模型表示</li>
<li>格式转换工具</li>
<li>缓存机制优化</li>
</ul>
<h4 data-id="heading-28">3. 跨平台兼容性</h4>
<p><strong>挑战</strong>：不同平台的 API 和限制不同</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>平台抽象层</li>
<li>条件编译</li>
<li>统一的配置接口</li>
<li>平台特定的优化</li>
</ul>
<h4 data-id="heading-29">4. 内存管理</h4>
<p><strong>挑战</strong>：设备端内存有限，需要高效管理</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>智能内存分配</li>
<li>模型量化支持</li>
<li>内存池管理</li>
<li>及时释放资源</li>
</ul>
<h3 data-id="heading-30">扩展机制</h3>
<h4 data-id="heading-31">1. 添加新的计算后端</h4>
<p>实现 Plugin 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> ComputeBackend <span class="hljs-keyword">interface</span> {
    Name() <span class="hljs-type">string</span>
    IsAvailable() <span class="hljs-type">bool</span>
    LoadModel(config ModelConfig) <span class="hljs-type">error</span>
    Generate(input Input, config GenerationConfig) (Output, <span class="hljs-type">error</span>)
}
</code></pre>
<h4 data-id="heading-32">2. 添加新的模型格式</h4>
<p>实现 FormatParser 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> FormatParser <span class="hljs-keyword">interface</span> {
    CanParse(path <span class="hljs-type">string</span>) <span class="hljs-type">bool</span>
    Parse(path <span class="hljs-type">string</span>) (*Model, <span class="hljs-type">error</span>)
    Optimize(model *Model, target Backend) <span class="hljs-type">error</span>
}
</code></pre>
<h4 data-id="heading-33">3. 添加新的 AI 能力</h4>
<p>实现 Capability 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Capability <span class="hljs-keyword">interface</span> {
    Name() <span class="hljs-type">string</span>
    SupportedModels() []<span class="hljs-type">string</span>
    Process(input Input, config Config) (Output, <span class="hljs-type">error</span>)
}
</code></pre>
<hr/>
<h2 data-id="heading-34">项目地址与资源</h2>
<h3 data-id="heading-35">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNexaAI%2Fnexa-sdk" target="_blank" title="https://github.com/NexaAI/nexa-sdk" ref="nofollow noopener noreferrer">github.com/NexaAI/nexa…</a></li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">docs.nexa.ai</a></li>
<li>📚 <strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">完整文档</a></li>
</ul>
<h3 data-id="heading-36">适用人群</h3>
<p><strong>强烈推荐</strong>：</p>
<ul>
<li>需要构建设备端 AI 应用的开发者</li>
<li>希望利用 NPU 加速的移动应用开发者</li>
<li>需要在 IoT 设备上运行 AI 模型的开发者</li>
<li>对设备端 AI 性能优化感兴趣的研究人员</li>
</ul>
<p><strong>也适合</strong>：</p>
<ul>
<li>想要学习设备端 AI 实现的学生</li>
<li>需要评估不同 AI 框架的架构师</li>
<li>对 NPU 加速感兴趣的技术人员</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Kotlin系列17】协程在Android中的最佳实践：从入门到精通]]></title>    <link>https://juejin.cn/post/7601159804491022355</link>    <guid>https://juejin.cn/post/7601159804491022355</guid>    <pubDate>2026-02-01T10:00:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804491022355" data-draft-id="7601103779393044543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Kotlin系列17】协程在Android中的最佳实践：从入门到精通"/> <meta itemprop="keywords" content="Kotlin,Android,编程语言"/> <meta itemprop="datePublished" content="2026-02-01T10:00:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Kotlin系列17】协程在Android中的最佳实践：从入门到精通
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T10:00:26.000Z" title="Sun Feb 01 2026 10:00:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>"用户点击按钮后应用卡死2秒,然后突然显示数据。"——这是我在Code Review时听到最多的问题描述之一。</p>
<p>几年前,我接手过一个Android项目,代码里充斥着各种<code>Thread { ... }.start()</code>,还有大量的<code>runOnUiThread</code>,以及让人头疼的内存泄漏。每次用户旋转屏幕,网络请求都会重新发起;当用户快速点击按钮时,多个请求并发执行导致界面显示错乱。最糟糕的是,当Activity销毁后,后台线程仍在运行,持有Activity引用,造成内存泄漏。</p>
<p><strong>Kotlin协程彻底改变了这一切。</strong> 配合Android的生命周期感知组件(ViewModel、Lifecycle),协程让异步编程变得简单、安全、高效。Google官方已经将协程作为Android异步编程的首选方案,Jetpack库全面支持协程。</p>
<p>本文将系统讲解Kotlin协程在Android开发中的最佳实践,涵盖:</p>
<ul>
<li>协程作用域的正确使用(lifecycleScope、viewModelScope、GlobalScope)</li>
<li>网络请求、数据库操作、文件读写的协程实践</li>
<li>UI更新与线程切换</li>
<li>异常处理与错误传播</li>
<li>性能优化与常见陷阱</li>
</ul>
<p>无论你是协程新手,还是想深入掌握协程在Android中的应用,这篇文章都会给你带来价值。</p>
<hr/>
<h2 data-id="heading-1">一、Android协程生态概览</h2>
<h3 data-id="heading-2">1.1 协程在Android架构中的位置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fc0c833e65d428e9d426763f6ab7550~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=famGuBNtqz7MxFG3KbK%2FA2TAnGg%3D" alt="17-01-android-coroutines-architecture.png" loading="lazy"/></p>
<p>在现代Android开发中,协程与以下组件深度集成:</p>
<p><strong>架构组件层</strong>:</p>
<ul>
<li><code>ViewModel</code> - 提供<code>viewModelScope</code>,自动取消协程</li>
<li><code>Lifecycle</code> - 提供<code>lifecycleScope</code>,生命周期感知</li>
<li><code>LiveData</code> - 通过<code>liveData {}</code>构建器支持协程</li>
<li><code>Room</code> - 原生支持<code>suspend</code>函数</li>
</ul>
<p><strong>网络层</strong>:</p>
<ul>
<li>Retrofit - 通过<code>suspend</code>关键字支持协程</li>
<li>OkHttp - 非阻塞I/O,与协程完美配合</li>
</ul>
<p><strong>数据持久化层</strong>:</p>
<ul>
<li>Room Database - <code>@Dao</code>接口支持<code>suspend</code>函数</li>
<li>DataStore - 完全基于协程和Flow</li>
</ul>
<h3 data-id="heading-3">1.2 核心依赖配置</h3>
<p>在<code>build.gradle.kts</code>中添加必要的依赖:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
    <span class="hljs-comment">// 协程核心库</span>
    implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span>)
    implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3"</span>)

    <span class="hljs-comment">// Lifecycle与协程集成</span>
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0"</span>)
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-runtime-ktx:2.7.0"</span>)
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-livedata-ktx:2.7.0"</span>)

    <span class="hljs-comment">// Room与协程集成</span>
    implementation(<span class="hljs-string">"androidx.room:room-ktx:2.6.1"</span>)

    <span class="hljs-comment">// Retrofit与协程集成</span>
    implementation(<span class="hljs-string">"com.squareup.retrofit2:retrofit:2.9.0"</span>)
    implementation(<span class="hljs-string">"com.jakewharton.retrofit:retrofit2-kotlin-coroutines-adapter:0.9.2"</span>)
}
</code></pre>
<h3 data-id="heading-4">1.3 三大协程作用域</h3>
<p>Android提供了三个主要的协程作用域:</p>





























<table><thead><tr><th align="left">作用域</th><th align="left">生命周期</th><th align="left">调度器</th><th align="left">使用场景</th></tr></thead><tbody><tr><td align="left"><code>viewModelScope</code></td><td align="left">ViewModel生命周期</td><td align="left"><code>Dispatchers.Main</code></td><td align="left">ViewModel中的数据加载</td></tr><tr><td align="left"><code>lifecycleScope</code></td><td align="left">Activity/Fragment生命周期</td><td align="left"><code>Dispatchers.Main</code></td><td align="left">UI相关操作</td></tr><tr><td align="left"><code>GlobalScope</code></td><td align="left">应用进程生命周期</td><td align="left">需手动指定</td><td align="left">❌ 通常不推荐使用</td></tr></tbody></table>
<p><strong>核心原则</strong>: 始终使用生命周期感知的作用域,避免内存泄漏和不必要的计算。</p>
<hr/>
<h2 data-id="heading-5">二、ViewModel中的协程实践</h2>
<h3 data-id="heading-6">2.1 viewModelScope的正确使用</h3>
<p><code>viewModelScope</code>是ViewModel的扩展属性,当ViewModel被清除时自动取消所有协程。</p>
<p><strong>基本用法</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _userState = MutableStateFlow&lt;UiState&lt;User&gt;&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> userState: StateFlow&lt;UiState&lt;User&gt;&gt; = _userState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _userState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
                _userState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _userState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">object</span> Loading : UiState&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : UiState&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UiState&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}
</code></pre>
<p><strong>关键点</strong>:</p>
<ul>
<li>使用<code>viewModelScope.launch</code>启动协程,无需手动取消</li>
<li>使用<code>StateFlow</code>暴露UI状态,替代LiveData</li>
<li>在协程中处理异常,转换为UI状态</li>
</ul>
<h3 data-id="heading-7">2.2 并发请求优化</h3>
<p><strong>场景</strong>: 需要同时加载用户信息、好友列表和帖子列表。</p>
<p><strong>❌ 错误方式:串行执行</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 串行执行:总耗时 = time1 + time2 + time3</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)        <span class="hljs-comment">// 1秒</span>
    <span class="hljs-keyword">val</span> friends = friendsRepository.getFriends(userId) <span class="hljs-comment">// 1秒</span>
    <span class="hljs-keyword">val</span> posts = postsRepository.getPosts(userId)     <span class="hljs-comment">// 1秒</span>
    <span class="hljs-comment">// 总耗时:3秒</span>
}
</code></pre>
<p><strong>✅ 正确方式:并发执行</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.async
<span class="hljs-keyword">import</span> kotlinx.coroutines.awaitAll

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Triple&lt;User, List&lt;Friend&gt;, List&lt;Post&gt;&gt; {
    <span class="hljs-keyword">return</span> coroutineScope {
        <span class="hljs-comment">// 并发执行三个请求</span>
        <span class="hljs-keyword">val</span> userDeferred = async { userRepository.getUser(userId) }
        <span class="hljs-keyword">val</span> friendsDeferred = async { friendsRepository.getFriends(userId) }
        <span class="hljs-keyword">val</span> postsDeferred = async { postsRepository.getPosts(userId) }

        <span class="hljs-comment">// 等待所有结果</span>
        Triple(
            userDeferred.await(),
            friendsDeferred.await(),
            postsDeferred.await()
        )
    }
    <span class="hljs-comment">// 总耗时:约1秒(最慢的那个请求)</span>
}
</code></pre>
<p><strong>在ViewModel中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DashboardViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> friendsRepository: FriendsRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postsRepository: PostsRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _dashboardState = MutableStateFlow&lt;DashboardState&gt;(DashboardState.Loading)
    <span class="hljs-keyword">val</span> dashboardState = _dashboardState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadDashboard</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _dashboardState.value = DashboardState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> (user, friends, posts) = loadAllData(userId)
                _dashboardState.value = DashboardState.Success(
                    Dashboard(user, friends, posts)
                )
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _dashboardState.value = DashboardState.Error(e.message ?: <span class="hljs-string">"加载失败"</span>)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Triple&lt;User, List&lt;Friend&gt;, List&lt;Post&gt;&gt; {
        <span class="hljs-keyword">return</span> coroutineScope {
            <span class="hljs-keyword">val</span> userDeferred = async { userRepository.getUser(userId) }
            <span class="hljs-keyword">val</span> friendsDeferred = async { friendsRepository.getFriends(userId) }
            <span class="hljs-keyword">val</span> postsDeferred = async { postsRepository.getPosts(userId) }

            Triple(
                userDeferred.await(),
                friendsDeferred.await(),
                postsDeferred.await()
            )
        }
    }
}
</code></pre>
<p><strong>性能对比</strong>:</p>
<ul>
<li>串行执行:3秒</li>
<li>并发执行:1秒</li>
<li><strong>性能提升:67%</strong></li>
</ul>
<h3 data-id="heading-8">2.3 处理用户操作防抖</h3>
<p><strong>场景</strong>: 用户在搜索框输入时实时搜索,避免频繁请求。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> searchRepository: SearchRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchQuery = MutableStateFlow(<span class="hljs-string">""</span>)

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchResults = MutableStateFlow&lt;List&lt;SearchResult&gt;&gt;(emptyList())
    <span class="hljs-keyword">val</span> searchResults = _searchResults.asStateFlow()

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 使用Flow操作符实现防抖</span>
        viewModelScope.launch {
            _searchQuery
                .debounce(<span class="hljs-number">300</span>)  <span class="hljs-comment">// 300ms防抖</span>
                .distinctUntilChanged()  <span class="hljs-comment">// 去重</span>
                .filter { it.length &gt;= <span class="hljs-number">2</span> }  <span class="hljs-comment">// 至少2个字符才搜索</span>
                .collectLatest { query -&gt;
                    searchInternal(query)
                }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateQuery</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        _searchQuery.value = query
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchInternal</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> results = searchRepository.search(query)
            _searchResults.value = results
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            _searchResults.value = emptyList()
        }
    }
}
</code></pre>
<p><strong>UI层调用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: SearchViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

        binding.searchEditText.addTextChangedListener { text -&gt;
            viewModel.updateQuery(text.toString())
        }

        lifecycleScope.launch {
            viewModel.searchResults.collect { results -&gt;
                updateSearchResults(results)
            }
        }
    }
}
</code></pre>
<p><strong>关键点</strong>:</p>
<ul>
<li>使用<code>debounce(300)</code>实现300ms防抖</li>
<li><code>distinctUntilChanged()</code>避免重复查询</li>
<li><code>collectLatest</code>确保只处理最新的搜索结果</li>
</ul>
<hr/>
<h2 data-id="heading-9">三、网络请求的协程实践</h2>
<h3 data-id="heading-10">3.1 Retrofit与协程集成</h3>
<p><strong>定义API接口</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiService</span> {
    <span class="hljs-meta">@GET(<span class="hljs-string">"users/{id}"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> userId: <span class="hljs-type">String</span>)</span></span>: User

    <span class="hljs-meta">@POST(<span class="hljs-string">"users"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUser</span><span class="hljs-params">(<span class="hljs-meta">@Body</span> user: <span class="hljs-type">User</span>)</span></span>: User

    <span class="hljs-meta">@GET(<span class="hljs-string">"users/{id}/posts"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserPosts</span><span class="hljs-params">(
        <span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> userId: <span class="hljs-type">String</span>,
        <span class="hljs-meta">@Query(<span class="hljs-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: List&lt;Post&gt;
}
</code></pre>
<p><strong>Repository层封装</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDao: UserDao
) {
    <span class="hljs-comment">// 先从本地获取,再从网络更新</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 尝试从网络获取最新数据</span>
                <span class="hljs-keyword">val</span> user = apiService.getUser(userId)
                <span class="hljs-comment">// 缓存到本地数据库</span>
                userDao.insertUser(user)
                user
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// 网络失败,从本地数据库获取</span>
                userDao.getUserById(userId) ?: <span class="hljs-keyword">throw</span> e
            }
        }
    }

    <span class="hljs-comment">// 分页加载帖子</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserPosts</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>, page: <span class="hljs-type">Int</span>)</span></span>: List&lt;Post&gt; {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            apiService.getUserPosts(userId, page)
        }
    }
}
</code></pre>
<h3 data-id="heading-11">3.2 处理网络错误与重试</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b57f433e68a43bc86c9802aacdd7b42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=QrHjUvPXu5qKVotHeFD%2BD4LWUoU%3D" alt="17-02-network-error-handling.png" loading="lazy"/></p>
<p><strong>实现智能重试机制</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 重试扩展函数</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryIO</span><span class="hljs-params">(
    times: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
    initialDelay: <span class="hljs-type">Long</span> = <span class="hljs-number">100</span>,
    maxDelay: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>,
    factor: <span class="hljs-type">Double</span> = <span class="hljs-number">2.0</span>,
    block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: T {
    <span class="hljs-keyword">var</span> currentDelay = initialDelay
    repeat(times - <span class="hljs-number">1</span>) { attempt -&gt;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">catch</span> (e: IOException) {
            <span class="hljs-comment">// 网络错误,进行重试</span>
            delay(currentDelay)
            currentDelay = (currentDelay * factor).toLong().coerceAtMost(maxDelay)
        }
    }
    <span class="hljs-keyword">return</span> block() <span class="hljs-comment">// 最后一次尝试,失败则抛出异常</span>
}

<span class="hljs-comment">// 在Repository中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService) {

    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithRetry</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            retryIO(times = <span class="hljs-number">3</span>) {
                apiService.getUser(userId)
            }
        }
    }
}
</code></pre>
<p><strong>处理不同类型的网络错误</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkResult</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : NetworkResult&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> exception: Exception) : NetworkResult&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">object</span> Loading : NetworkResult&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">safeApiCall</span><span class="hljs-params">(
    apiCall: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: NetworkResult&lt;T&gt; {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        <span class="hljs-keyword">try</span> {
            NetworkResult.Success(apiCall())
        } <span class="hljs-keyword">catch</span> (e: HttpException) {
            <span class="hljs-comment">// HTTP错误(4xx, 5xx)</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"网络请求失败: <span class="hljs-subst">${e.code()}</span>"</span>))
        } <span class="hljs-keyword">catch</span> (e: IOException) {
            <span class="hljs-comment">// 网络连接错误</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"网络连接失败"</span>))
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// 其他未知错误</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"未知错误: <span class="hljs-subst">${e.message}</span>"</span>))
        }
    }
}

<span class="hljs-comment">// 在ViewModel中使用</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    viewModelScope.launch {
        _userState.value = UiState.Loading

        <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> result = safeApiCall { userRepository.getUser(userId) }) {
            <span class="hljs-keyword">is</span> NetworkResult.Success -&gt; {
                _userState.value = UiState.Success(result.<span class="hljs-keyword">data</span>)
            }
            <span class="hljs-keyword">is</span> NetworkResult.Error -&gt; {
                _userState.value = UiState.Error(result.exception.message ?: <span class="hljs-string">"未知错误"</span>)
            }
            <span class="hljs-keyword">is</span> NetworkResult.Loading -&gt; {
                <span class="hljs-comment">// 不处理</span>
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">3.3 请求取消与超时</h3>
<p><strong>设置超时</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithTimeout</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        withTimeout(<span class="hljs-number">5000</span>) {  <span class="hljs-comment">// 5秒超时</span>
            apiService.getUser(userId)
        }
    }
}

<span class="hljs-comment">// 或者使用withTimeoutOrNull返回null而不是抛出异常</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithTimeoutOrNull</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User? {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        withTimeoutOrNull(<span class="hljs-number">5000</span>) {
            apiService.getUser(userId)
        }
    }
}
</code></pre>
<p><strong>取消正在进行的请求</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> loadUserJob: Job? = <span class="hljs-literal">null</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 取消之前的请求</span>
        loadUserJob?.cancel()

        loadUserJob = viewModelScope.launch {
            _userState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
                _userState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: CancellationException) {
                <span class="hljs-comment">// 协程被取消,不处理</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _userState.value = UiState.Error(e.message ?: <span class="hljs-string">"未知错误"</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cancelLoadUser</span><span class="hljs-params">()</span></span> {
        loadUserJob?.cancel()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-13">四、数据库操作的协程实践</h2>
<h3 data-id="heading-14">4.1 Room与协程集成</h3>
<p><strong>定义DAO接口</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> {
    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users WHERE id = :userId"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserById</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User?

    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getAllUsersFlow</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;User&gt;&gt;

    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>

    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertUsers</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span>

    <span class="hljs-meta">@Delete</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>

    <span class="hljs-meta">@Query(<span class="hljs-string">"DELETE FROM users WHERE id = :userId"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>
}
</code></pre>
<p><strong>在Repository中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDao: UserDao,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService
) {
    <span class="hljs-comment">// 从数据库读取用户(Flow自动在IO线程执行)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeUsers</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;User&gt;&gt; {
        <span class="hljs-keyword">return</span> userDao.getAllUsersFlow()
    }

    <span class="hljs-comment">// 从网络获取并缓存</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refreshUsers</span><span class="hljs-params">()</span></span> {
        withContext(Dispatchers.IO) {
            <span class="hljs-keyword">val</span> users = apiService.getUsers()
            userDao.insertUsers(users)
        }
    }

    <span class="hljs-comment">// 单一数据源模式(Single Source of Truth)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Flow&lt;User?&gt; = flow {
        <span class="hljs-comment">// 1. 先发射数据库中的数据</span>
        emit(userDao.getUserById(userId))

        <span class="hljs-comment">// 2. 从网络获取最新数据</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> user = apiService.getUser(userId)
            userDao.insertUser(user)
            <span class="hljs-comment">// 数据库更新后,Flow会自动发射新值</span>
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// 网络错误,使用数据库缓存</span>
        }
    }.flowOn(Dispatchers.IO)
}
</code></pre>
<h3 data-id="heading-15">4.2 实现离线优先策略</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2303cc6b42c24377ad1339ca5b49a5e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=V%2BZTF2xbVfIijPs1PLvzuLDXgog%3D" alt="17-03-offline-first-flow.png" loading="lazy"/></p>
<p><strong>完整的离线优先实现</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postDao: PostDao,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> connectivityManager: ConnectivityManager
) {
    <span class="hljs-comment">// 观察帖子列表(离线优先)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observePosts</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;Post&gt;&gt; = flow {
        <span class="hljs-comment">// 1. 立即发射本地缓存</span>
        emitAll(postDao.getAllPostsFlow())

        <span class="hljs-comment">// 2. 如果有网络,从服务器同步</span>
        <span class="hljs-keyword">if</span> (isNetworkAvailable()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> posts = apiService.getPosts()
                postDao.insertPosts(posts)
                <span class="hljs-comment">// 数据库更新后会自动触发新的emit</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// 网络同步失败,继续使用本地缓存</span>
            }
        }
    }.flowOn(Dispatchers.IO)

    <span class="hljs-comment">// 刷新(强制从网络加载)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span>: Result&lt;<span class="hljs-built_in">Unit</span>&gt; {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> posts = apiService.getPosts()
                postDao.deleteAllPosts()
                postDao.insertPosts(posts)
                Result.success(<span class="hljs-built_in">Unit</span>)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Result.failure(e)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">val</span> network = connectivityManager.activeNetwork ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">val</span> capabilities = connectivityManager.getNetworkCapabilities(network) ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">return</span> capabilities.hasCapability(NetworkCapabilities.NET_CAPABILITY_INTERNET)
    }
}
</code></pre>
<p><strong>在ViewModel中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostListViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postRepository: PostRepository
) : ViewModel() {

    <span class="hljs-keyword">val</span> posts: StateFlow&lt;List&lt;Post&gt;&gt; = postRepository.observePosts()
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),
            initialValue = emptyList()
        )

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _isRefreshing = MutableStateFlow(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">val</span> isRefreshing = _isRefreshing.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _isRefreshing.value = <span class="hljs-literal">true</span>
            postRepository.refresh()
            _isRefreshing.value = <span class="hljs-literal">false</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-16">4.3 批量操作优化</h3>
<p><strong>场景</strong>: 插入大量数据时使用事务提升性能。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PostDao</span> {
    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertPosts</span><span class="hljs-params">(posts: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Post</span>&gt;)</span></span>

    <span class="hljs-comment">// 使用事务批量删除并插入</span>
    <span class="hljs-meta">@Transaction</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">replaceAllPosts</span><span class="hljs-params">(posts: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Post</span>&gt;)</span></span> {
        deleteAllPosts()
        insertPosts(posts)
    }

    <span class="hljs-meta">@Query(<span class="hljs-string">"DELETE FROM posts"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteAllPosts</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// 在Repository中使用</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">syncPosts</span><span class="hljs-params">()</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-keyword">val</span> posts = apiService.getPosts()
        postDao.replaceAllPosts(posts)  <span class="hljs-comment">// 事务中执行,保证原子性</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-17">五、UI更新与线程切换</h2>
<h3 data-id="heading-18">5.1 Dispatchers详解</h3>
<p>Kotlin协程提供了四种调度器:</p>






























<table><thead><tr><th align="left">Dispatcher</th><th align="left">用途</th><th align="left">线程池</th></tr></thead><tbody><tr><td align="left"><code>Dispatchers.Main</code></td><td align="left">UI更新、轻量级操作</td><td align="left">主线程</td></tr><tr><td align="left"><code>Dispatchers.IO</code></td><td align="left">网络、文件、数据库</td><td align="left">共享线程池(最多64线程)</td></tr><tr><td align="left"><code>Dispatchers.Default</code></td><td align="left">CPU密集型计算</td><td align="left">线程数=CPU核心数</td></tr><tr><td align="left"><code>Dispatchers.Unconfined</code></td><td align="left">不限制线程(不推荐)</td><td align="left">调用者线程</td></tr></tbody></table>
<p><strong>最佳实践</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    <span class="hljs-comment">// 在主线程启动协程</span>

    <span class="hljs-keyword">val</span> user = withContext(Dispatchers.IO) {
        <span class="hljs-comment">// 切换到IO线程执行网络请求</span>
        apiService.getUser(userId)
    }
    <span class="hljs-comment">// 自动切回主线程</span>

    <span class="hljs-comment">// 更新UI(在主线程)</span>
    binding.userName.text = user.name
}
</code></pre>
<h3 data-id="heading-19">5.2 避免不必要的线程切换</h3>
<p><strong>❌ 过度切换</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = apiService.getData()

        withContext(Dispatchers.Main) {
            <span class="hljs-comment">// 不必要的切换</span>
            updateUI(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>✅ 优化后</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = withContext(Dispatchers.IO) {
        apiService.getData()
    }
    <span class="hljs-comment">// 自动在主线程</span>
    updateUI(<span class="hljs-keyword">data</span>)
}
</code></pre>
<h3 data-id="heading-20">5.3 在Activity/Fragment中收集Flow</h3>
<p><strong>使用lifecycleScope与repeatOnLifecycle</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: UserViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)

        <span class="hljs-comment">// ✅ 推荐:生命周期感知</span>
        viewLifecycleOwner.lifecycleScope.launch {
            viewLifecycleOwner.repeatOnLifecycle(Lifecycle.State.STARTED) {
                <span class="hljs-comment">// 只在STARTED状态收集Flow</span>
                viewModel.userState.collect { state -&gt;
                    <span class="hljs-keyword">when</span> (state) {
                        <span class="hljs-keyword">is</span> UiState.Loading -&gt; showLoading()
                        <span class="hljs-keyword">is</span> UiState.Success -&gt; showUser(state.<span class="hljs-keyword">data</span>)
                        <span class="hljs-keyword">is</span> UiState.Error -&gt; showError(state.message)
                    }
                }
            }
        }
    }
}
</code></pre>
<p><strong>为什么使用<code>repeatOnLifecycle(STARTED)</code></strong>:</p>
<ul>
<li>Fragment在后台时停止收集,节省资源</li>
<li>Fragment回到前台时自动恢复收集</li>
<li>避免内存泄漏和不必要的UI更新</li>
</ul>
<hr/>
<h2 data-id="heading-21">六、异常处理与错误传播</h2>
<h3 data-id="heading-22">6.1 协程中的异常类型</h3>
<p><strong>两种异常类型</strong>:</p>
<ol>
<li><strong>CancellationException</strong>: 协程取消,不会传播</li>
<li><strong>其他异常</strong>: 会传播到父协程,导致整个协程树取消</li>
</ol>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    launch {
        delay(<span class="hljs-number">100</span>)
        <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"子协程异常"</span>)
        <span class="hljs-comment">// 这个异常会传播到父协程,导致viewModelScope取消</span>
    }

    launch {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"这行代码不会执行"</span>)  <span class="hljs-comment">// 父协程已被取消</span>
    }
}
</code></pre>
<h3 data-id="heading-23">6.2 使用SupervisorJob隔离异常</h3>
<p><strong>SupervisorJob</strong>: 子协程异常不会影响其他子协程。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> supervisorScope = CoroutineScope(SupervisorJob() + Dispatchers.Main)

supervisorScope.launch {
    launch {
        delay(<span class="hljs-number">100</span>)
        <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"子协程1异常"</span>)
        <span class="hljs-comment">// 这个异常不会影响子协程2</span>
    }

    launch {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"子协程2继续执行"</span>)  <span class="hljs-comment">// 会执行</span>
    }
}
</code></pre>
<p><strong>在ViewModel中使用SupervisorJob</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> supervisorJob = SupervisorJob()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> scope = CoroutineScope(supervisorJob + Dispatchers.Main)

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadMultipleData</span><span class="hljs-params">()</span></span> {
        scope.launch {
            <span class="hljs-comment">// 启动多个独立的子任务</span>
            launch {
                <span class="hljs-keyword">try</span> {
                    loadUserData()
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    handleError(<span class="hljs-string">"用户数据加载失败"</span>, e)
                }
            }

            launch {
                <span class="hljs-keyword">try</span> {
                    loadPostsData()
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    handleError(<span class="hljs-string">"帖子数据加载失败"</span>, e)
                }
            }
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCleared()
        supervisorJob.cancel()
    }
}
</code></pre>
<h3 data-id="heading-24">6.3 全局异常处理</h3>
<p><strong>设置CoroutineExceptionHandler</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> exceptionHandler = CoroutineExceptionHandler { _, exception -&gt;
    Log.e(<span class="hljs-string">"Coroutine"</span>, <span class="hljs-string">"捕获到未处理的异常"</span>, exception)
    <span class="hljs-comment">// 上报到崩溃收集平台(如Firebase Crashlytics)</span>
}

<span class="hljs-keyword">val</span> scope = CoroutineScope(SupervisorJob() + Dispatchers.Main + exceptionHandler)

scope.launch {
    <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"未捕获的异常"</span>)
    <span class="hljs-comment">// 会被exceptionHandler捕获</span>
}
</code></pre>
<p><strong>在Application中设置全局处理器</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()

        <span class="hljs-comment">// 设置全局协程异常处理器</span>
        Thread.setDefaultUncaughtExceptionHandler { thread, throwable -&gt;
            Log.e(<span class="hljs-string">"GlobalHandler"</span>, <span class="hljs-string">"未捕获的异常"</span>, throwable)
            <span class="hljs-comment">// 上报崩溃</span>
            FirebaseCrashlytics.getInstance().recordException(throwable)
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-25">七、性能优化与常见陷阱</h2>
<h3 data-id="heading-26">7.1 避免内存泄漏</h3>
<p><strong>❌ 陷阱1: 使用GlobalScope</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakyActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
        GlobalScope.launch {
            <span class="hljs-comment">// 危险!Activity销毁后协程仍在运行</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData()
            updateUI(<span class="hljs-keyword">data</span>)  <span class="hljs-comment">// 可能访问已销毁的Activity</span>
        }
    }
}
</code></pre>
<p><strong>✅ 正确方式: 使用lifecycleScope</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
        lifecycleScope.launch {
            <span class="hljs-comment">// Activity销毁时自动取消</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData()
            updateUI(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>❌ 陷阱2: 静态引用持有Context</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-keyword">var</span> coroutineJob: Job? = <span class="hljs-literal">null</span>  <span class="hljs-comment">// 危险!</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    coroutineJob = GlobalScope.launch {
        <span class="hljs-comment">// context可能是Activity,导致内存泄漏</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData(context)
    }
}
</code></pre>
<p><strong>✅ 正确方式: 使用Application Context</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-keyword">val</span> appContext = context.applicationContext

    viewModelScope.launch {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData(appContext)
    }
}
</code></pre>
<h3 data-id="heading-27">7.2 控制并发数量</h3>
<p><strong>问题</strong>: 同时发起1000个网络请求导致OOM。</p>
<p><strong>✅ 解决方案: 使用Semaphore限流</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.sync.Semaphore
<span class="hljs-keyword">import</span> kotlinx.coroutines.sync.withPermit

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageLoader</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> semaphore = Semaphore(<span class="hljs-number">5</span>)  <span class="hljs-comment">// 最多5个并发</span>

    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImages</span><span class="hljs-params">(urls: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span>: List&lt;Bitmap&gt; {
        <span class="hljs-keyword">return</span> urls.map { url -&gt;
            async {
                semaphore.withPermit {
                    <span class="hljs-comment">// 最多同时执行5个</span>
                    loadImage(url)
                }
            }
        }.awaitAll()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImage</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span>: Bitmap {
        <span class="hljs-comment">// 下载图片</span>
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-comment">// 实际下载逻辑</span>
            TODO()
        }
    }
}
</code></pre>
<h3 data-id="heading-28">7.3 使用Channel避免背压问题</h3>
<p><strong>场景</strong>: 生产者速度 &gt;&gt; 消费者速度,导致内存占用暴涨。</p>
<p><strong>❌ 使用Flow(无背压控制)</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produceData</span><span class="hljs-params">()</span></span>: Flow&lt;Data&gt; = flow {
    repeat(<span class="hljs-number">1_000_000</span>) {
        emit(Data(it))  <span class="hljs-comment">// 快速发射数据</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consumeData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        produceData().collect { <span class="hljs-keyword">data</span> -&gt;
            delay(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 消费慢</span>
            process(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>✅ 使用Channel(有容量限制)</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> channel = Channel&lt;Data&gt;(capacity = <span class="hljs-number">100</span>)  <span class="hljs-comment">// 缓冲100个元素</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produceData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        repeat(<span class="hljs-number">1_000_000</span>) {
            channel.send(Data(it))  <span class="hljs-comment">// 缓冲满时挂起</span>
        }
        channel.close()
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consumeData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">data</span> <span class="hljs-keyword">in</span> channel) {
            delay(<span class="hljs-number">10</span>)
            process(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-29">7.4 避免阻塞Dispatchers.IO线程池</h3>
<p><strong>❌ 在IO线程池执行CPU密集型任务</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processLargeData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-comment">// CPU密集型计算,占用IO线程</span>
        <span class="hljs-keyword">data</span>.map { it * it * it }.sorted()
    }
}
</code></pre>
<p><strong>✅ 使用Dispatchers.Default</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processLargeData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    withContext(Dispatchers.Default) {
        <span class="hljs-comment">// CPU密集型任务使用Default</span>
        <span class="hljs-keyword">data</span>.map { it * it * it }.sorted()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-30">八、总结与最佳实践清单</h2>
<h3 data-id="heading-31">核心要点回顾</h3>
<ol>
<li>
<p><strong>使用生命周期感知的作用域</strong></p>
<ul>
<li><code>viewModelScope</code> for ViewModel</li>
<li><code>lifecycleScope</code> for Activity/Fragment</li>
<li>避免使用<code>GlobalScope</code></li>
</ul>
</li>
<li>
<p><strong>线程切换</strong></p>
<ul>
<li><code>Dispatchers.Main</code> - UI操作</li>
<li><code>Dispatchers.IO</code> - 网络、文件、数据库</li>
<li><code>Dispatchers.Default</code> - CPU密集型计算</li>
</ul>
</li>
<li>
<p><strong>错误处理</strong></p>
<ul>
<li>使用<code>try-catch</code>处理已知异常</li>
<li>使用<code>SupervisorJob</code>隔离子协程异常</li>
<li>设置<code>CoroutineExceptionHandler</code>全局捕获</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong></p>
<ul>
<li>使用<code>async</code>并发执行独立任务</li>
<li>使用<code>Semaphore</code>控制并发数量</li>
<li>避免在循环中创建协程</li>
</ul>
</li>
<li>
<p><strong>数据流管理</strong></p>
<ul>
<li>使用<code>StateFlow</code>替代<code>LiveData</code></li>
<li>使用<code>repeatOnLifecycle</code>收集Flow</li>
<li>实现离线优先策略</li>
</ul>
</li>
</ol>
<h3 data-id="heading-32">最佳实践检查清单</h3>
<p><strong>作用域管理</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>viewModelScope</code>在ViewModel中启动协程</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>lifecycleScope</code>在Activity/Fragment中启动协程</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 避免使用<code>GlobalScope</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在自定义作用域时使用<code>SupervisorJob</code></li>
</ul>
<p><strong>线程调度</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 网络请求使用<code>Dispatchers.IO</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 数据库操作使用<code>Dispatchers.IO</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> CPU密集型计算使用<code>Dispatchers.Default</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> UI更新在<code>Dispatchers.Main</code></li>
</ul>
<p><strong>异常处理</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在协程顶层使用<code>try-catch</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 区分<code>CancellationException</code>和其他异常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>CoroutineExceptionHandler</code>记录未捕获异常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在Repository层捕获并转换异常</li>
</ul>
<p><strong>性能优化</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>async</code>并发执行独立任务</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>Semaphore</code>限制并发数量</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 避免阻塞Dispatcher线程池</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>Flow.buffer()</code>控制背压</li>
</ul>
<p><strong>测试</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>runTest</code>测试suspend函数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>StandardTestDispatcher</code>控制测试时间</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Mock Repository和API</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试不同的UI状态</li>
</ul>
<h3 data-id="heading-33">学习资源</h3>
<p><strong>官方文档</strong>:</p>
<ul>
<li>Kotlin协程官方指南: <a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fcoroutines-guide.html" target="_blank" title="https://kotlinlang.org/docs/coroutines-guide.html" ref="nofollow noopener noreferrer">kotlinlang.org/docs/corout…</a></li>
<li>Android协程最佳实践: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fkotlin%2Fcoroutines%2Fcoroutines-best-practices" target="_blank" title="https://developer.android.com/kotlin/coroutines/coroutines-best-practices" ref="nofollow noopener noreferrer">developer.android.com/kotlin/coro…</a></li>
</ul>
<p><strong>推荐阅读</strong>:</p>
<ul>
<li>《Kotlin Coroutines by Tutorials》</li>
<li>《Asynchronous Programming with Kotlin》</li>
<li>Roman Elizarov的博客(协程库作者)</li>
</ul>
<p><strong>视频教程</strong>:</p>
<ul>
<li>Android Developers YouTube频道 - Coroutines系列</li>
<li>Kotlin Conf演讲 - Coroutines相关主题</li>
</ul>
<p><strong>系列文章导航:</strong></p>
<ul>
<li>👉 上一篇: <a href="https://juejin.cn/post/7599920572839919625" target="_blank" title="https://juejin.cn/post/7599920572839919625">性能优化：内联、内存与字节码分析</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助,欢迎点赞、收藏、分享!有任何问题或建议,欢迎在评论区留言讨论。让我们一起学习,一起成长!</em></p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的状态管理哲学]]></title>    <link>https://juejin.cn/post/7601076815450390543</link>    <guid>https://juejin.cn/post/7601076815450390543</guid>    <pubDate>2026-02-01T09:41:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450390543" data-draft-id="7601076976442769448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的状态管理哲学"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-02-01T09:41:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fe小陈"/> <meta itemprop="url" content="https://juejin.cn/user/4019470241892983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的状态管理哲学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4019470241892983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fe小陈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:41:50.000Z" title="Sun Feb 01 2026 09:41:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<blockquote>
<p>简单讲讲 react 状态管理的演进过程</p>
</blockquote>
<p>React状态管理的演进始终围绕“组件通信”与“状态复用”两大核心需求展开。</p>
<p>早期类组件时代，开发者依赖props实现组件间传值，通过state管理组件内部状态，但跨层级组件通信需借助“props drilling”（属性透传），代码冗余且维护成本高。</p>
<p>为解决这一问题，Redux、MobX 等第三方状态管理库应运而生，通过集中式存储、统一状态更新机制，实现了全局状态共享，但其繁琐的配置与概念（如reducer、action、中间件）也增加了开发门槛。</p>
<p>随着React 16.8推出Hook特性，函数组件得以拥有状态管理能力，useState、useContext等原生Hook的出现，为轻量型状态管理提供了可能，也推动开发者探索更简洁、无依赖的状态管理思路，逐步打破对第三方库的依赖。</p>
<p>React生态核心路由工具react-router（常用v6版本）虽不直接管理状态，但与状态管理深度关联。其路由参数、查询参数及导航状态需与全局/局部状态联动（如通过路由参数获取详情ID、同步登录状态控制跳转权限）。React Router v6适配Hook，提供useParams、useSearchParams等方法，可便捷操作路由状态，后续自定义的原生Hook状态管理方案可与其兼容，实现路由与业务状态的协同管控。</p>
<p>第三方状态管理库中，react-query（现更名TanStack Query）极具代表性，它跳出传统全局集中存储思路，专注服务端状态管理，补齐了传统库与原生Hook在异步数据处理上的短板。不同于Redux等通用库，它专为接口请求、数据缓存等服务端状态场景设计，无需手动维护加载、错误等冗余状态，大幅简化异步逻辑。但它不擅长客户端状态（如主题、弹窗），需搭配客户端状态管理方案使用，这也印证了状态管理无万能方案，需结合场景选型。</p>
<p>Zustand是一款轻量的第三方状态管理库，基于Hook设计，兼顾简洁性与实用性。它无需Context嵌套，通过自定义Hook即可便捷获取和修改全局状态，规避了Context重渲染的问题，同时简化了Redux等库的繁琐配置。</p>
<h2 data-id="heading-1">取舍</h2>
<p>只要经过长年多个项目的开发经历，就会发现，没有哪个方案非常适用于所有的场景。</p>
<ol>
<li>
<p><strong>Redux</strong>：优点是状态集中可追溯、生态完善、适合大型项目团队协作；缺点是配置繁琐、概念多（reducer/action等）、上手成本高，小型项目使用显冗余。</p>
</li>
<li>
<p><strong>Mobx</strong>：优点是响应式更新、编码灵活、无需手动编写大量模板代码；缺点是依赖装饰器语法（存在兼容问题）、状态变化隐性化，复杂项目易失控。</p>
</li>
<li>
<p><strong>Zustand</strong>：优点是轻量简洁、基于Hook设计、无Context嵌套、规避重渲染问题；缺点是生态不如Redux完善，大型项目复杂状态管控能力稍弱。</p>
</li>
<li>
<p><strong>react-query（TanStack Query）</strong> ：优点是专注服务端状态、自动处理缓存/重试/加载状态、大幅简化异步逻辑；缺点是不擅长客户端状态管理，需搭配其他方案使用。</p>
</li>
<li>
<p><strong>rxjs</strong>：优点是擅长处理复杂异步流、状态联动能力强、可复用性高；缺点是学习曲线陡峭、概念抽象，简单场景使用成本过高。虽然 rxjs 本身不是状态管理，但其处理异步流的能力可以轻松构造出灵活的状态管理方案。</p>
</li>
<li>
<p><strong>react-use、ahooks</strong>：优点是封装大量通用Hook（含状态管理相关）、复用性强，简化重复开发，贴合React Hook生态；缺点是侧重通用Hook合集，无专属全局状态管理体系，复杂状态联动需基于其二次封装。</p>
</li>
</ol>
<p><strong>实际使用会将方案组合使用，这里我们会发现存在两种矛盾：</strong></p>
<ol>
<li>
<p>如果你倾向于使用 react hook 去开发逻辑，那么共享状态采用 context，会出现 context 套 context，逻辑混合在UI 组件树上，极难看懂，复杂应用中容易陷入性能优化又劣化的循环中。</p>
</li>
<li>
<p>如果不想使用 react context 作为状态共享的方案，通常是希望应用的业务状态能与 UI 框架解耦，选择 redux 和 zustand。这时候又会发现，这些方案并没有提供与 react hook 类似的逻辑组合复用能力，进入堆叠面条代码 “大力出奇迹” 的陷阱。</p>
</li>
</ol>
<p>本文并不打算完全解决这种矛盾，这是我经验上判断 react 状态管理存在的问题，或许有些大佬有这方面的解决方案也说不一定。</p>
<h2 data-id="heading-2">沉思与创造</h2>
<p>相信一些对状态管理或者应用架构设计感兴趣的人，必然设计过自己趁手的状态管理库。</p>
<p><strong>我理想中的状态管理库应该能够做到以下的事情：</strong></p>
<ol>
<li>
<p><strong>响应式状态</strong>：存储状态、读取状态、更新状态、订阅状态变更。</p>
</li>
<li>
<p><strong>状态类</strong>：一组状态可以形成一个模版类型，并创建实例。</p>
</li>
<li>
<p><strong>副作用管理</strong>：一个状态实例会管理自己的副作用（如定时器、监听器等），实例销毁（destroy方法）会清除其所有的副作用。</p>
</li>
<li>
<p><strong>层次管理</strong>：一个状态实例A可能被另一个状态实例B持有，这是一种附属关系（如某种插件机制），实例B销毁的时候，实例A也会销毁（连带副作用清除）。</p>
</li>
<li>
<p><strong>聚合事件</strong>：是对 “多个分散状态变更 / 副作用触发” 的统一收口与联动管理</p>
</li>
<li>
<p><strong>组合复用机制</strong>：就像 react 自定义 Hook 一样，一些纯工具能力应该能轻易的复用并组合。</p>
</li>
</ol>
<p>我曾自己尝试过很多种方案组合并用在自己维护的项目上，上面可以说就是无数次错误尝试与痛苦挣扎的总结。</p>
<p>一切不优雅的 hack 方案和 shit 代码都是源于某些能力没有提供，而你没有办法让库的提供者提供你想要的能力，可能得到的回答就是 “我们需要保持简洁、纯净”，你可以通过某某方式间接实现。</p>
<p>为什么要委屈自己，去接受这草台般的世界？最终我决定了放下一切信仰，自己开宗立派。</p>
<p>让我们一步步推演出这个方案的摸样（仅考虑 API 的设计，因为实现不复杂且一直在变化）。</p>
<h3 data-id="heading-3"><strong>状态类</strong></h3>
<blockquote>
<p>一组状态可以形成一个模版类型，并创建实例。</p>
<p>虽然这是第二点，但还是先说说这个，存在 API 的依赖。</p>
</blockquote>
<p>基于理想中“状态类”的诉求，我们先定义状态模版的创建方式——通过 createModel 方法封装状态的初始化逻辑，支持传入 id 和自定义参数 param，让同一种状态模版可以生成多个独立实例，兼顾复用性与灵活性。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>)=&gt;</span>({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>
    }),
});
</code></pre>
<h3 data-id="heading-4"><strong>响应式状态</strong></h3>
<blockquote>
<p>存储状态、读取状态、更新状态、订阅状态变更。</p>
</blockquote>
<p>有了状态类的模版定义，接下来就要落地响应式核心能力——毕竟光有模版不能读写更新，跟空架子没区别。响应式API要足够简洁，还得兼顾灵活性，不用搞一堆冗余配置，直接在状态实例上挂载核心方法就行，具体用法如下：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 创建状态实例，调用 create 方法 (id,  param) 传入 initState</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">getState</span>();
stateIns.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> }); 
<span class="hljs-comment">// 或者 </span>
<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> ({<span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>}));
stateIns.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">state, prevState</span>)=&gt;</span>{ <span class="hljs-comment">/* 状态变更回调 */</span> });
</code></pre>
<p>这就够了吗？到这里看起来就是跟 Zustand 的 store 一样，没什么特别的。</p>
<p>不够！只有信奉极简主义者才会觉得这是够的。</p>
<p>subscribe 是一种极其简陋的实现，它存在以下问题：</p>
<ol>
<li>订阅粒度太粗，没法精准订阅某个字段，哪怕只改了状态里的一个字段，所有订阅者都会被触发，跟Context的重渲染坑一模一样，大型应用里纯属性能灾难。</li>
<li>只是订阅了状态的变化，应该有场景需要对初值进行回调，因此需要分开它们。</li>
</ol>
<p>可以使用 rxjs 提供 Subject 来暴露订阅接口。</p>
<pre><code class="hljs language-tsx" lang="tsx">stateIns.<span class="hljs-property">states</span> <span class="hljs-comment">// 分离字段的 BehaviorSubjects</span>
stateIns.<span class="hljs-property">fullState</span> <span class="hljs-comment">// 整体状态 BehaviorSubject</span>
stateIns.<span class="hljs-property">updates</span>  <span class="hljs-comment">// 分离字段的更新事件 Subject</span>
stateIns.<span class="hljs-property">fullUpdate</span> <span class="hljs-comment">// 整体状态的更新事件 Subject</span>
</code></pre>
<h3 data-id="heading-5">副作用管理</h3>
<blockquote>
<p>一个状态实例会管理自己的副作用（如定时器、监听器等），实例销毁（destroy方法）会清除其所有的副作用。</p>
</blockquote>
<p>先说说计算属性吧，计算属性作为 state 的衍生。需要追踪 state 变更并重新计算，为了减少重复计算，如果没有像 vue proxy 响应式机制，那么就只能自己手动给到了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
        <span class="hljs-attr">others1</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">others2</span>: <span class="hljs-number">456</span>,
    }),
    <span class="hljs-comment">// 添加 computed </span>
    <span class="hljs-attr">computed</span>: {
        <span class="hljs-attr">double</span>: {
            <span class="hljs-attr">dep</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> [s.<span class="hljs-property">count</span>],
            <span class="hljs-attr">run</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
        }
    },
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">getState</span>().<span class="hljs-property">double</span> <span class="hljs-comment">// 2</span>
</code></pre>
<p>这个设计，我只能说，很丑陋，实际也没想象中那么实用，后面再说。</p>
<p>再说说副作用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>)=&gt;</span>({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
        <span class="hljs-attr">others1</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">others2</span>: <span class="hljs-number">456</span>,
    }),
    <span class="hljs-comment">// 添加 effects</span>
    <span class="hljs-attr">effects</span>: {
        <span class="hljs-attr">effect1</span>: {
            <span class="hljs-attr">dep</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> [s.<span class="hljs-property">count</span>],
            <span class="hljs-attr">run</span>: <span class="hljs-function">(<span class="hljs-params">state, setState</span>)=&gt;</span>{
                <span class="hljs-keyword">const</span> t = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, state.<span class="hljs-property">count</span>)
                }, <span class="hljs-number">3000</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(t);
            }
        }
    }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">setState</span>({<span class="hljs-attr">count</span>: <span class="hljs-number">2</span>});
stateIns.<span class="hljs-title function_">setState</span>({<span class="hljs-attr">count</span>: <span class="hljs-number">3</span>}); <span class="hljs-comment">// 3s 后打印 "count is 3"</span>
</code></pre>
<p>表达了当 count 更新并稳定 3s 后打印它。</p>
<p>到这里，其实我也不知道自己在写什么了，effects 的存在究竟为了什么？为了模拟 react 的 useEffect 吗？不管怎么样，存在即合理，如果要把代码从 react 屎山迁过来，结果发现没有 effect 能力该是多头疼。</p>
<p>可以对比一下 Zustand，它根本就没有这两个东西。Zustand 直接返回状态和封装过的方法，不直接让使用方调用 setState，而是把状态更新逻辑封装在自定义方法里，更侧重“状态操作收口”。</p>
<p>但是代码写起来就是另一种意义上的丑陋了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// Zustand 典型用法</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash-es'</span>;

<span class="hljs-comment">// 直接创建store，封装状态和更新方法，不暴露setState</span>
<span class="hljs-keyword">const</span> useCountStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> logCount = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span>);
  }, <span class="hljs-number">3000</span>);

  <span class="hljs-keyword">return</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">double</span>: <span class="hljs-number">2</span>,
    <span class="hljs-comment">// 封装更新逻辑，使用方直接调用方法，无需手动setState</span>
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>, <span class="hljs-attr">double</span>: (state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>) * <span class="hljs-number">2</span> }))
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>, <span class="hljs-attr">double</span>: (state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>) * <span class="hljs-number">2</span> }))
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: val, <span class="hljs-attr">double</span>: val * <span class="hljs-number">2</span> })
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
  })
});
</code></pre>
<p>这大概就是为什么我始终没有大规模使用 Zustand（或许是用法不对吧）。</p>
<p>再回到自己的设计上来，我意识到直接让状态实例订阅自己的状态再执行计算属性变更和副作用，也能达到一样的效果。同时受到 Zustand 的启发，setState 就不应该暴露给外部使用，应该直接封死在内部的 actions 里面。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { debounceTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
      <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
   }),
  <span class="hljs-attr">actions</span>: <span class="hljs-function">(<span class="hljs-params">get, set</span>) =&gt;</span> ({
    <span class="hljs-attr">inc</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }),
    <span class="hljs-attr">dec</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }),
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: val }),
  }),
  <span class="hljs-comment">// 处理 computed 和 effect 的地方</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-comment">// 1. 直接通过同步监听 count 来设置 double</span>
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>
        .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> thisInstance.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> })),
      <span class="hljs-comment">// 2. 监听 count 再 pipe 一个 rxjs 防抖操作符</span>
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">3000</span>))
        .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, c)),
    ]
  }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>(); <span class="hljs-comment">// 3s 后打印 "count is 3"</span>
</code></pre>
<p>这个方案已经足够好用了，曾经我也这么认为，并在一个项目里面大规模使用，直到有人接手了我的代码并开始了吐槽。</p>
<p>我并不觉得 rxjs 是多么高深的技术，但事实如此 …… 不是谁都能接受的。</p>
<p>这个问题先按下不管，接着看。</p>
<p>createModel 内部通过返回 subscription 数组并在 destroy 的时候取消即可实现<strong>副作用的清理</strong>。</p>
<pre><code class="hljs language-tsx" lang="tsx">ins.<span class="hljs-property">_subscriptions</span> = <span class="hljs-title function_">setup</span>(ins);

ins.<span class="hljs-property">destroy</span> = <span class="hljs-function">()=&gt;</span>{
    ins.<span class="hljs-property">_subscriptions</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">sup</span>)=&gt;</span>{
        sup.<span class="hljs-title function_">unsubscribe</span>();
    })
}
</code></pre>
<p>上面的例子只在 setup 中实现了静态的副作用管理，当然还需要考虑动态添加副作用的情况。</p>
<p>比如在调用 action 方法的时候，开启一个定时器 interval 执行一些操作，同时还要考虑多次调用时对上一次副作用的清理。</p>
<p>这就需要引入一个动态副作用管理的工具了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Subscription</span>, <span class="hljs-title class_">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FunctionClean</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Cleanup</span> = <span class="hljs-title class_">Subscription</span> | <span class="hljs-title class_">FunctionClean</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">EffectHandle</span> = 
    <span class="hljs-title class_">Observable</span> 
    | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">FunctionClean</span>); 

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EffectManager</span> {
    <span class="hljs-title function_">addEffect</span>(<span class="hljs-attr">cleanup</span>: <span class="hljs-title class_">Cleanup</span>): <span class="hljs-title class_">FunctionClean</span>;
    <span class="hljs-title function_">runEffect</span>(<span class="hljs-attr">handle</span>: <span class="hljs-title class_">EffectHandle</span>): <span class="hljs-title class_">Cleanup</span>;
    <span class="hljs-title function_">cycleEffect</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">cb</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">EffectHandle</span> | <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-title function_">cleanAll</span>(): <span class="hljs-built_in">void</span>;
}
</code></pre>
<p>结合 EffectManager 使用示例，这时候静态副作用和动态副作用都可以用 EffectManager 管理，setup 里面也就可以显式添加副作用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 核心使用示例：结合状态模型的action动态管理副作用</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
    <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
  }),
  <span class="hljs-attr">actions</span>: <span class="hljs-function">(<span class="hljs-params">get, set, self</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inc</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }),
      <span class="hljs-attr">dec</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }),
      <span class="hljs-comment">// 动态副作用场景：调用action时开启定时器，多次调用自动清理上一次</span>
      <span class="hljs-attr">startCountLog</span>: <span class="hljs-function">() =&gt;</span> {
        self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cycleEffect</span>(<span class="hljs-string">'countLog'</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">return</span> self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">pipe</span>(
              <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">3000</span>), 
              <span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params">c</span>)=&gt;</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'log'</span>, c))
          );
        });
      },
      <span class="hljs-attr">stopCountLog</span>: <span class="hljs-function">()=&gt;</span>{
          <span class="hljs-comment">// 传空即可清除</span>
          self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cycleEffect</span>(<span class="hljs-string">'countLog'</span>, <span class="hljs-function">()=&gt;</span>{});
      }
    };
  },
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-comment">// 静态副作用：初始化时监听count，同步更新double</span>
    <span class="hljs-keyword">const</span> sub = self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> {
      self.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> });
    });
    <span class="hljs-comment">// 将静态副作用交给EffectManager管理</span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(sub);
  },
});

<span class="hljs-comment">// 组件/业务中使用</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">// 调用动态副作用</span>
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">startCountLog</span>();
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();  <span class="hljs-comment">// 3s 后 log 2</span>
</code></pre>
<p>createModel 内部的 destroy 也就变成了</p>
<pre><code class="hljs language-tsx" lang="tsx">ins.<span class="hljs-property">effectManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EffectManager</span>;
<span class="hljs-title function_">setup</span>(ins);

ins.<span class="hljs-property">destroy</span> = <span class="hljs-function">() =&gt;</span> {
    ins.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cleanAll</span>();
}
</code></pre>
<p>当然上面这个 destroy 是被简化过了，实际上还需要阻止 ins 上所有 rxjs Subject 继续被订阅。</p>
<h3 data-id="heading-6">层次管理</h3>
<blockquote>
<p>一个状态实例A可能被另一个状态实例B持有，这是一种附属关系（如某种插件机制），实例B销毁的时候，实例A也会销毁（连带副作用清除）。</p>
</blockquote>
<p>类似组件树，状态实例也可以是一个树状的组合关系，父节点调用 destroy，子节点递归调用 destroy，完成副作用的全面清理。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> a = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'a'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">//             通过调用 create 时第三个参数传入父节点</span>
<span class="hljs-keyword">const</span> b = <span class="hljs-title class_">StateModel2</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'b'</span>, { <span class="hljs-attr">other</span>: <span class="hljs-number">0</span> }, a);

a.<span class="hljs-title function_">destroy</span>() <span class="hljs-comment">// 连带触发 b.destroy() </span>
</code></pre>
<p>上面的例子已经说明了层次管理的含义，在插件化的设计中，围绕核心实体去挂载其他插件实体，可以确保核心实体销毁时插件实体也被销毁。</p>
<p>不过我想这一节可以顺便聊聊依赖注入。</p>
<h4 data-id="heading-7">基于层次管理实现依赖注入</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ContextModel 很重要，可以作为内部的一个导出</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ContextModel</span> = <span class="hljs-title function_">createModel</span>({...})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AppModel</span> = <span class="hljs-title function_">createModel</span>({...})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({...})
</code></pre>
<p>比如 FeatureModel1 依赖某个存储方法，通过一个 createDep 创建这个依赖。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">StoreDepToken</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'StoreDepToken'</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">StoreDepType</span> = {
   <span class="hljs-title function_">get</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;
   <span class="hljs-title function_">set</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureStoreDep</span> = createDependency&lt;<span class="hljs-title class_">StoreDepType</span>&gt;(<span class="hljs-title class_">StoreDepToken</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({...})
</code></pre>
<p>然后通过 ContextModel 上的 setDep 来提供它。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> context = <span class="hljs-title class_">ContextModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">''</span>, {});

context.<span class="hljs-property">actions</span>.<span class="hljs-title function_">setDependency</span>(
    <span class="hljs-title class_">FeatureStoreDep</span>.<span class="hljs-title function_">provide</span>({
        <span class="hljs-title function_">get</span>(<span class="hljs-params">name</span>){
           localstorage.<span class="hljs-title function_">getItem</span>(name);
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">name, content</span>){
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(name, content);
        }
    })
);
</code></pre>
<p>FeatureModel 可以在 setup 中获取到，进而实现了依赖注入。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({
    ...,
    <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>){
       <span class="hljs-comment">// 获取父节点中类型为 ContextModel 的 实例</span>
       <span class="hljs-keyword">const</span> context = self.<span class="hljs-title function_">getParent</span>(<span class="hljs-title class_">ContextModel</span>);
       <span class="hljs-comment">// 取出设置的依赖</span>
       <span class="hljs-keyword">const</span> storage = context.<span class="hljs-property">actions</span>.<span class="hljs-title function_">getDependency</span>(<span class="hljs-title class_">FeatureStoreDep</span>)
                           || {...} ; <span class="hljs-comment">// 注意兜底</span>
       <span class="hljs-comment">// 使用它们</span>
       storage.<span class="hljs-property">get</span>
       storage.<span class="hljs-property">set</span>
    }
})
</code></pre>
<h3 data-id="heading-8">聚合事件</h3>
<blockquote>
<p>对 “多个分散状态变更 / 副作用触发” 的统一收口与联动管理</p>
</blockquote>
<p>因为我构思的状态管理是多实例的，不同状态实例有其独有的事件流，实际开发中是有聚合事件的使用场景的。</p>
<ol>
<li>日志统一打印</li>
<li>错误事件统一处理</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title class_">StateModel</span>.<span class="hljs-property">aggregateEvent</span>.<span class="hljs-property">updates</span>
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">{key, value, preValue, instance}</span>)=&gt;</span>{

    });

<span class="hljs-title class_">StateModel</span>.<span class="hljs-property">aggregateEvent</span>.<span class="hljs-property">events</span>
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">{eventName, data, instance}</span>)=&gt;</span>{

    })
</code></pre>
<p>写到这里，其实我还意识到，actions 也应该提供聚合事件，actions 其实是一种事件输入，其处理逻辑应该放在 setup 内部同样使用事件流订阅处理。actions 被实现为一个 proxy 并对 key 创建出一个触发输入事件的函数。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//                            定义泛型 状态、输入事件、输出事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = createModel&lt;{count,double}, {inc}, {event}&gt;({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
    <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
  }),
  <span class="hljs-comment">// 这块就不要了</span>
  <span class="hljs-comment">// actions: (get, set, self) =&gt; {</span>
  <span class="hljs-comment">//   return {</span>
  <span class="hljs-comment">//    inc: () =&gt; set({ count: get().count + 1 }),</span>
  <span class="hljs-comment">//  },</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-comment">// 改为一个 actions.inc 事件订阅</span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(
      self.<span class="hljs-property">actions</span>.<span class="hljs-property">inc</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
        self.<span class="hljs-title function_">setState</span>({
            <span class="hljs-attr">count</span>: self.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>,
        })
      })
    );
    
    <span class="hljs-comment">// 这个是 memo </span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> {
        self.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> });
      }));
  },
});

<span class="hljs-comment">// 组件/业务中使用</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();
</code></pre>
<p>这样实现有什么作用呢？当你需要对输入事件做流处理如防抖的时候，就可以直接复用到 rxjs 操作符了。</p>
<h3 data-id="heading-9">组合复用机制</h3>
<blockquote>
<p>就像 react 自定义 Hook 一样，一些纯工具能力应该能轻易的复用并组合。</p>
</blockquote>
<p>如果你觉得前面那些还看得过去，并且用起来还不错。</p>
<p><strong>对不起，到了这个地方，不破不立，我要推翻一些东西了。</strong></p>
<p>本质原因是，我想用完全不同的思路去实现它，创造另外一个东西。</p>
<p>我开始思考成本问题</p>
<ol>
<li>
<p>迁移成本，已有代码使用 react hook 实现状态管理，迁移到任何一种外部状态管理库方案时，如何保证实现的逻辑是一样的？尤其是一个大量使用了社区 hook 的自定义 hook 实现？</p>
</li>
<li>
<p>维护成本，redux 和 zustand，很难找到类似 react hook 一样的组合逻辑的能力，这大大增加了维护成本。</p>
</li>
</ol>
<p>如果你们用过 vue 的 pinia 状态管理方案，大概就知道了，pinia store 的 setup 方法是可以在里面使用 vue composition api 的。</p>
<p>虽说实现框架无关是状态管理的共识，但是实现上总是以某种方式实现的，只要实现方式不影响最终的 UI 层，那么以什么方式实现，就没那么重要了。</p>
<p>这里我脑子里蹦出一个惊人的想法，外部状态管理，就不能使用 react hook 吗？react 的铁律告诉我们， hook 只能在组件里面使用！</p>
<p>先抛开固有限制，以前面实现 computed 和 effect 的例子来讲，为什么不能是这样的？使用一个 hook 方法，每次 state 变更重新跑 useMemo 和 useEffect ，并将结果合并到 hookState 中给外部使用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
   }),
  <span class="hljs-title function_">hook</span>(<span class="hljs-params">{state, setState, self}</span>) {
      <span class="hljs-keyword">const</span> double = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>, [state.<span class="hljs-property">count</span>]);

      <span class="hljs-keyword">const</span> inc = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">s</span>=&gt;</span>({<span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span>+<span class="hljs-number">1</span>}));
      }, []);
      
      <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>{
          <span class="hljs-keyword">const</span> t = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'log count'</span>, state.<span class="hljs-property">count</span>);
          }, <span class="hljs-number">3000</span>);
          
          <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(t);
      }, [state.<span class="hljs-property">count</span>]);
      
      <span class="hljs-comment">// hook 返回，对象合并到 hookState 里面</span>
      <span class="hljs-keyword">return</span> {
          double,
          inc,
      }
  }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });

<span class="hljs-keyword">await</span> stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-title function_">inc</span>();
<span class="hljs-keyword">await</span> stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-title function_">inc</span>(); <span class="hljs-comment">// 3s 后 log count 3</span>
stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-property">double</span> <span class="hljs-comment">// 6</span>
</code></pre>
<p>有人会说：“这不能吧，hook 只能在组件树上使用，例子上这样做会不会破坏 react 的规则？”</p>
<p>我的想法是，react 组件树并不一定要产生 UI 输出，也可以单纯维护状态实例树。</p>
<p>有什么好处？<strong>好处可太大了！</strong></p>
<p>你可以使用 react-query 发起请求，它帮你维护了请求状态(data, loading, fetching, error, time)，但是这是 hook 的用法，你把请求放在 Zustand store 里面，你将失去一切！</p>
<p>但是，在一个底层以 react hook 实现的外部状态管理库中，你得到了这一切。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e64ae9e291d4a27ac308c11243cd4d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmXlsI_pmYg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543712&amp;x-signature=6aFKMiwH0%2Fm6x%2BzNcVLJtRt34zk%3D" alt="image.png" loading="lazy"/></p>
<p>外部状态库可以直接使用 react hook 是一种巨大的吸引力，逻辑复用直接就是 react hook 的思路。react-use、ahooks，这些都能复用上了，像呼吸一样简单。</p>
<h2 data-id="heading-10">总结：复杂 or 简洁</h2>
<p>做稍微复杂的设计，是为了在结构上承载复杂的逻辑，让转移后的复杂度变得可控、可维护。前文设计的状态实例层次管理、聚合事件、动态副作用管控等特性，看似增加了方案本身的设计复杂度，实则是为了承接业务中多实例联动、多状态协同、异步流处理等复杂场景的需求——如果为了追求方案表面的简洁，省略这些设计，复杂度并不会消失，反而会转移到业务代码中，变成分散的冗余逻辑、难以维护的硬编码，最终形成“表面简洁、内在混乱”的代码困境。这种有目的的复杂设计，核心是通过结构化的方案设计，将业务复杂度收纳在合理的框架内，兼顾扩展性与可维护性，避免复杂度无序扩散。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘火爆的ClawdBot（Moltbot/OpenClaw）]]></title>    <link>https://juejin.cn/post/7601159804490858515</link>    <guid>https://juejin.cn/post/7601159804490858515</guid>    <pubDate>2026-02-01T08:13:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804490858515" data-draft-id="7601075423003672612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘火爆的ClawdBot（Moltbot/OpenClaw）"/> <meta itemprop="keywords" content="Agent,AI编程,AIGC"/> <meta itemprop="datePublished" content="2026-02-01T08:13:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序新视界"/> <meta itemprop="url" content="https://juejin.cn/user/3368559359568696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘火爆的ClawdBot（Moltbot/OpenClaw）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559359568696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序新视界
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:13:15.000Z" title="Sun Feb 01 2026 08:13:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>话说“AI一天，人间一年”，最近AI技术圈又出现一款火爆的产品ClawdBot，无论是在Github上、朋友圈以及公号文章中，都会看到它的身影。</p>
<p>有人这样评价ClawdBot，说“<strong>它是迄今为止最伟大的AI应用，相当于你24小时全天候专属AI员工。</strong> ”它的火爆甚至导致了Mac mini的大卖。</p>
<p>那么，ClawdBot到底有没有这么神奇？这篇文章带大家深度揭秘一下ClawdBot的一些相关知识。</p>
<h2 data-id="heading-0">ClawdBot名称的演变</h2>
<p>你可能在网上看到有人讲ClawdBot、有人讲Moltbot，又有人在讲OpenClaw，其实它们都是同一个开源项目，讲的都是ClawdBot。</p>
<p>在ClawdBot项目火爆后，由于它的发音与Anthropic的Claude Code等系列名称相近，涉嫌商标问题，于是改名为Moltbot（蜕壳之意），随后又改名为OpenClaw。大家知道有一回事就可以了，在后续我们使用最新的名称：<strong>OpenClaw</strong>。</p>
<h2 data-id="heading-1">OpenClaw的愿景</h2>
<p>在Github的项目说明中，OpenClaw的slogan为“<strong>Your own personal AI assistant.</strong> Any OS. Any Platform. The lobster way. 🦞”</p>
<p>关注的核心就是“你的私人AI助理”，同时记住这个龙虾🦞的图标，在大多数讲到OpenClaw的文章中你可能都会看到它。</p>
<p>OpenClaw不再仅仅是一个聊天机器人，而更像是一个拥有“手脚”的数字实体。它可以常驻在你的IM软件中，24小时在线，不仅能够聊天，还能够根据你的指令调用所在电脑的本地Shell、读写文件、控制浏览器等。</p>
<p>这里提到了“Any OS”，但目前看到广大网友的实践，对其他平台支持的并不是很友好，而且提供的大量的Tools都是针对Mac OS的，这也是导致Mac mini大卖的原因之一。</p>
<p>目前OpenClaw在Github上已经拥有130k+的Star，而且每天都以10k以上的速度增加，可见它的火爆程度。这里可以直观看一下它在Github上的增长趋势图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2379fc8fda7147a2a971b241e8d4122a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=rGY0hVnpYYiSca8j6mf9bcazd6E%3D" alt="Star History" loading="lazy"/></p>
<p>在了解了关于OpenClaw的一些基础信息之后，我们来具体看看它提供了哪些功能，让它如此的火爆。</p>
<h2 data-id="heading-2">OpenClaw是什么？</h2>
<p>如果用一句话来总结OpenClaw的功能就是：<strong>OpenClaw本质上是一个运行在个人电脑或服务器上的个人专属的人工智能助理（AI Agent），你可以通过即时通信工具与它进行交互，让它帮你处理各类任务，实现真正意义上的干活。同时，它也拥有了“记忆”功能，能够记住你的偏好和历史对话，更懂你。</strong></p>
<p>这里我们重点关注的是基于个人电脑或服务器的系统来实现真正意义的干活。像我们平时使用ChatGPT或Claude，大多数情况下是在“聊天”，它们只是在帮忙“出主意”，没办法真正意义上在操作系统上进行命令的执行。</p>
<p>而OpenClaw所迈出的重要一步是：当你将个人电脑或服务器的操作权限授予它之后，它可以在操作系统上执行你的命令，可以真正的替你干活了。</p>
<p>当然，在实现这一步操作中，它相当于把Claude Code变成了可视化的桌面，把社交软件作为远程指挥的工具，拓宽了人与执行任务的电脑（或服务器）的物理距离。初步实现了一个可持续运行，可执行任务的个人AI智能体。</p>
<h2 data-id="heading-3">OpenClaw的震撼点</h2>
<p>通过观察OpenClaw的具体案例，其实目前效果并不完美，还有许多坑，但它让AI Agent往前走了一步，具有以下的震撼点：</p>
<p><strong>第一，它可以控制你的电脑，它能“动手”，而不是只“出主意”。</strong> 只要你给OpenClaw充分授权，它便可以控制你的电脑，像人一样操作你的电脑。</p>
<p>OpenClaw迈出了这一步，但目前并不完美。在真实使用时，还是需要通过虚拟机、独立的服务器或一台独立的电脑、或独立的项目环境，或有限的操作权限来进行安全把控。</p>
<p>否则，一旦OpenClaw乱来（模型和Agent的幻觉问题等），将会面临不可预估的损失。这也是购买Mac mini的原因之一，它提供了一个相对独立的环境。</p>
<p><strong>第二，拥有长期记忆，不是一次性对话。</strong> OpenClaw内置了一套长期记忆系统，你说过的话，做过的事，都会被记录、总结、提取出来，并存入长期记忆当中。当它更了解你时，它也就是你的个人专属助理了。</p>
<p><strong>第三，可通过聊天工具来“遥控”交互。</strong> 当集成对应的聊天工具之后，你通过聊天工具给它发消息，便可对OpenClaw下达任务命令，这样便实现了远程指挥，全天24小时待命的效果。但这里特别提醒，OpenClaw在使用时，安全隐患非常大。</p>
<p><strong>第四，OpenClaw并不只是“能干活”，同时它几乎是100%用AI写出来的。</strong> 不会写代码的人，也能直接提交PR，这也算是AI编程的一个新的真实案例的突破。</p>
<p>这些特性汇总起来意味着：<strong>一台永不关机的电脑，里面住着一位能够记住你，能够自己上网，能够自己动手，能够随时被你指挥，还能够自我迭代更新的AI员工</strong>。</p>
<p>目前的OpenClaw并不完美，但它的出现就像早期的智能手机的越狱插件、NAS（发烧友玩的家庭服务器）、Kubernetes（技术圈的新玩意）、Docker等软件，随着逐步的发展迭代，最终会成为日常的标准。</p>
<h2 data-id="heading-4">OpenClaw的架构实现</h2>
<p>在架构设计上，OpenClaw采用了非常巧妙的Gateway（网关）模式，从而实现了指令消息、模型以及指令执行的解耦。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09aec786a0e542fa9df7d9436ca1c33b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=EjA5B3%2BTq2Cn85G%2FG%2FZtkA9kW84%3D" alt="架构实现" loading="lazy"/></p>
<p>基本的全流程实现逻辑为：</p>
<p>用户可通过WhatsApp或Telegram等通信软件发送消息（指令），消息传到电脑上的Gateway（网关），网关也是整个系统的控制中心，是连接指令和电脑能力的桥梁。</p>
<p>网关通过LLM API（比如Claude或任何模型的API）将消息分发给LLM（大脑）或Skills（手脚），从而实现在电脑上执行相关命令（或任务）。</p>
<p>在这个过程中，Gateway就像是智能体的“小脑”，负责维持各大IM平台（Channels）的长连接、会话保持、任务分发等功能。</p>
<p>而Skills和Tools赋予了AI“肉身”，Skills也是此架构中的一等公民，通过定义明确的接口，AI可以调用本地工具，比如执行具有毁灭性的操作“<code>rm -rf</code>”、访问本地文件系统、控制浏览器抓取信息等。</p>
<h2 data-id="heading-5">OpenClaw的功能案例</h2>
<p>目前OpenClaw已经能够实现基础的安装软件、执行脚本、管理文件、监控网页、发邮件、社交媒体发消息等功能。理论上，只要手动能够操作的，有对应的接口或权限，OpenClaw都可以搞定。</p>
<p>这里在分享一个网络上所说的“汽车购买自动谈判”的案例，本质上没有那么神奇，只是一些列功能的组合。</p>
<p>案例的执行分以下几个阶段：</p>
<ul>
<li>价格调研：提示OpenClaw搜索 Reddit（r/hyundaipalisade）查找马萨诸塞州的典型价格，发现大多数人支付约 $58,000。</li>
<li>车辆定位：使用在线库存工具搜索波士顿50英里内符合特定颜色组合的经销商；</li>
<li>初始联系：OpenClaw自动填写经销商联系表单，预填用户手机号；</li>
<li>自动谈判：设置cron任务，每隔几分钟检查邮件中来自经销商的消息。谈判最低销售价格，不谈判换购或利率。在回复任何重要内容前提示我。</li>
</ul>
<p>OpenClaw让经销商互相竞争，发送报价PDF。最终获得<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo separator="true">,</mo><mn>200</mn><mtext>经销商折扣，价格降至</mtext></mrow><annotation encoding="application/x-tex">4,200经销商折扣，价格降至</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">200</span><span class="mord cjk_fallback">经销商折扣，价格降至</span></span></span></span></span>56,000——低于目标价格。</p>
<p>当然，还有利用智能家居Skills来控制灯光、温度、空气净化器的案例等案例，感兴趣的朋友可以网络上搜索一下。</p>
<h4 data-id="heading-6">为什么要用Mac mini？</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcd3764bd35c4a26b486fa4517e8a536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=XdXYCkqd%2Fw8MK5kK61mj%2F1TwkfE%3D" alt="Mac mini" loading="lazy"/></p>
<p>最后，我们再聊聊为什么要用Mac mini？</p>
<p>从官方的介绍来说，理论上“Any OS”都是可以的，只不过使用Mac mini更加适配OpenClaw的使用场景。</p>
<p>原因可能有这几点：</p>
<p>第一，社交软件的整合更加方便。无论是希望AI助手能够管理社交软件，还是通过社交软件来下达命令，在Mac OS系统下都更加容易实现。</p>
<p>像WhatsApp和Telegram等都有开发的API，但它们在美国不如 iMessage（苹果短信）普及。而苹果严密封锁了 iMessage协议，只允许在苹果设备上运行。如果你想让你的 AI 助手能处理你的短信（比如“帮我查一下昨天的购物清单”），OpenClaw必须跑在一台登录了Apple ID的Mac上。</p>
<p>第二，Mac系统自带强大的自动化工具（Shortcuts快捷指令、AppleScript）这些都比Linux和Windows要强。</p>
<p>第三，OpenClaw针对Mac系统，自带了许多适配Mac OS的Skills，可以拿来即用。</p>
<p>另外，购买Mac mini也是处于在日常办公的电脑上的安全性问题，需要买一台独立的设备，而它恰好适合。</p>
<h2 data-id="heading-7">关于OpenClaw的创始人Peter</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a78aa3912a5d4ed6b14cf313e60a27c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=7S6y1EWrwKtlPd3zxvalgI8PJlw%3D" alt="OpenClaw的创始人" loading="lazy"/></p>
<p>OpenClaw的开源作者为Peter Steinberger，他的个人博客也有相关的文章，感兴趣的朋友可以去关注一下：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsteipete.me%2F" target="_blank" title="https://steipete.me/" ref="nofollow noopener noreferrer">steipete.me/</a>。</p>
<p>如果你去看他的Github（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsteipete" target="_blank" title="https://github.com/steipete" ref="nofollow noopener noreferrer">github.com/steipete</a>），会发现他同时开发了多个项目，而且代码的提交量非常疯狂，日均上万行。</p>
<p>他在采访中曾说：<strong>我一天写的代码，可能比我以前70人公司一个月写得都多。在这个新世界里，构建东西的速度已经完全变了。</strong></p>
<p>这样的代码量，手敲代码根本无法完成。Peter在采访中也坦言“<strong>它是百分之百用 AI 写出来的，里面没有一行代码是我亲手敲的。</strong> ”</p>
<p>简单推测作者的编码过程：</p>
<ul>
<li>设定任务目标（TODO List），一部分来自Github上的PR；</li>
<li>利用AI进行评估、拆分任务；</li>
<li>利用类似Claude Code等平台并行执行任务；</li>
<li>完成任务之后，代码合并到同一分支，利用AI进行Code Review；</li>
<li>最后，Merge、提交；</li>
</ul>
<p>目前OpenClaw的具有完整的电脑访问能力，也懂Github的工作方式。</p>
<h2 data-id="heading-8">展望一下</h2>
<p>再次想说的是，OpenClaw目前并不完美，但它代表了个人AI助理领域的重大突破，提供了一种可能性。它通过本地有先、自托管架构，将原本纯聊天给建议的LLM能力与真实的执行能力进行了整合。</p>
<p>在架构分层上，通过Gateway-&gt;Agent-&gt; Skills -&gt; Channels/Nodes模式，实现了清晰的关注点分离，即保持了开放标准，又实现了与Claude Code、Cursor等工具的生态兼容。</p>
<p>当然，目前在安全方面，还存在很大的挑战，最好在沙盒环境下运行。另外，在token的消耗上一般人吃不消，原本通过人工操作非常简单的事情，目前还需要大量的token消耗，结果还存在一定的稳定性问题。</p>
<p>但无论怎样，OpenClaw提供了一个AI与现实世界相结合的完整案例参考，也是一步大胆的尝试。</p>
<p>最后，用OpenClaw发起者的一句话来作为本文的结束语，这句话值得我们深思：<strong>从AI出现之后，我其实已经没那么在意“用什么语言”了。语言本身的重要性在下降，真正重要的是生态</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战]]></title>    <link>https://juejin.cn/post/7601103779392946239</link>    <guid>https://juejin.cn/post/7601103779392946239</guid>    <pubDate>2026-02-01T08:26:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601103779392946239" data-draft-id="7601076694105276452" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-02-01T08:26:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="寒璃"/> <meta itemprop="url" content="https://juejin.cn/user/2559318802827933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318802827933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    寒璃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:26:51.000Z" title="Sun Feb 01 2026 08:26:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战</h2>
<p>在上一篇中，我分享了为什么在 2026 年选择从 Cocos 游戏开发转战 HarmonyOS NEXT。今天，我们直接进入实战：聊聊环境搭建，并用 ArkTS 亲手撸一个 TodoList。</p>
<h3 data-id="heading-1">1. 环境配置：集成度极高的“傻瓜式”体验</h3>
<p>对于习惯了在 VS Code 里折腾各种插件、Webpack 配置和浏览器调试的前端开发者来说，DevEco Studio 的初体验可以用 <strong>“省心”</strong> 来形容。</p>
<ul>
<li><strong>全家桶式的集成：</strong> 你不需要再去纠结模拟器怎么装、预览器怎么配。DevEco Studio 几乎把所有工具都集成在了一个安装包里。</li>
<li><strong>Previewer 与模拟器：</strong> 它的预览器响应速度很快，基本做到了代码改动即刻生效，这对于我们这种追求“所见即所得”的开发者非常友好。</li>
<li><strong>内置 AI 的辅助：</strong> 虽然它内置的 AI 功能目前还比不上 Cursor 那样惊艳，但在处理一些基础的代码补全和 API 查询时，已经能节省不少翻文档的时间。</li>
</ul>
<p>但是需要注意的是，在DevEco Studio中预览我们项目，有3种方式：</p>
<ol>
<li>
<p>Previewer： Previewer是一种集成在DevEco 中的预览方式，它具备热更新的能力，当我们的代码修改后，previewer能够实时的做出改变</p>
<p>但是它也具有一些不足的地方：比如某些API不支持previewer环境，这一点十分的重要，所以一定在调试代码的时候一定要注意API的适用环境。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f26fefe68be0424c88f1738e53108289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Y5QaWWndGD1PEg8gssyprpoFlG4%3D" alt="image-20260201153159100" loading="lazy"/></p>
<ol start="2">
<li>模拟器：模拟器是在电脑上安装一个模拟器，模拟器是一个单独的APP，相当于在电脑上运行了一个模拟Harmony OS的APP，在使用模拟器之前，我们需要先在设备管理器中安装一个模拟器，然后运行这个模拟器，然后我们就可以运行的时候选择该模拟器作为运行环境了。</li>
</ol>
<div>
    <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5841789c1024e8fae6cda4eb96335b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=JiUIJ%2FIHb7Q1LWfB7BFI1KqAMgc%3D" loading="lazy"/>
    <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6fd07e38784cde825e898a2dec6063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Pydo1C5TLsurTiIPqMt9i14TxP0%3D" loading="lazy"/>
</div>
<ol start="3">
<li>真机调试：顾名思义，使用真机进行代码调试，对于一些特殊的场景只能使用真机调试的方式，比如意图开发场景中目前只支持真机调试。</li>
</ol>
<hr/>
<h3 data-id="heading-2">2. 核心思维转换：从命令式到 MVVM</h3>
<p>作为一个有着 5 年小游戏开发经验的人，我习惯了手动的去设置不同UI的值，但在 ArkUI 中，这种思维需要发生 180 度的转变。</p>
<h4 data-id="heading-3">数据驱动 UI（MVVM）</h4>
<p>在 ArkTS 中，你只需要关注<strong>数据（State）</strong> 。当你通过 <code>@State</code> 定义了一个变量，UI 就会像影子的主人一样，主人动（数据变），影子就跟着动（UI 刷新）。这一点与前端的Vue 框架很类似。</p>
<h4 data-id="heading-4">前端开发者的“撞墙”点</h4>
<p>虽然 ArkTS 看起来和 TypeScript 一模一样，但在父子组件通信上，它有几个非常硬核的“脾气”需要你适应：</p>
<ol start="0">
<li><strong>禁止传递函数：</strong> 在 React 或 Vue 中，父组件向子组件传递一个回调函数是常规操作。但在 ArkUI 里，<strong>父组件不能直接向子组件传递函数类型的值</strong>。这需要我们习惯使用 <code>@Link</code> 或自定义事件来处理交互。</li>
<li><strong>传值还是传址？</strong> 这是一个坑。参数传递方式的不同（值传递 vs 引用传递）会直接决定 UI 能否感应到数据的变化。比如你修改了对象内部的一个属性，如果没处理好引用关系，UI 可能会纹丝不动。</li>
</ol>
<hr/>
<h3 data-id="heading-5">3. 实战：手写一个TodoList</h3>
<p>我们来写一个最基础的 TodoList。虽然我以前不爱写 CSS，但 ArkUI 的链式调用确实让布局变得像写逻辑一样清晰。在编写这个例子的时候也让我来讲解一些ArkTS中的语法。</p>
<p>组件的定义，在ArkTS中，如果要定义一个组件需要使用 <code>struct</code> 关键字来定义，而不是继续使用<code>class</code> ，除了使用 <code>struct</code>以外，还需要使用 <code>@Component</code> 装饰器来修饰它。一般来说我们会把跟UI无关的逻辑封装在class中，而struct 则专门负责UI的逻辑。</p>
<h4 data-id="heading-6">数据绑定</h4>
<p>之前说了ArkTS是一种基于MVVM模型的双向数据绑定。需要UI响应的数据需要使用 <code>@State</code>装饰器修饰，如下面这个简单的例子</p>
<pre><code class="hljs language-kotlin" lang="kotlin">​
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct Index {
  <span class="hljs-meta">@State</span> message: string = <span class="hljs-string">'Hello World'</span>;
​
  <span class="hljs-keyword">private</span> flag: boolean = <span class="hljs-literal">true</span>;
​
  build() {
    Row() {
      Column() {
        Text(<span class="hljs-keyword">this</span>.message)
          .fontSize($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
          .fontWeight(FontWeight.Bold)
          .onClick(() =&gt; {
​
            <span class="hljs-keyword">this</span>.message = <span class="hljs-keyword">this</span>.flag ? <span class="hljs-string">'Welcome'</span> : <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-keyword">this</span>.flag = !<span class="hljs-keyword">this</span>.flag;
          })
      }
      .width(<span class="hljs-string">'100%'</span>)
    }
    .height(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2635675722764c35923cf26c307ffcc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=VsgpVixIcQudneslsLEedoGLI5Y%3D" alt="iShot_2026-02-01_15.42.29" loading="lazy"/></p>
<p>可以看到这种数据绑定的方式十分的方便。</p>
<p>我现在要展示一种比较反前端直觉的案例，比如父子组件传递函数的情况。</p>
<p>在ArkTS中，不允许这样的做法！除了一种情况例外，父子之间传递函数，只能传递<code>@Builder</code>装饰器修饰的函数！</p>
<p>我们来看这样一个例子。在父组件中定义了一个状态msg，然后向子组件中传递一个修改<code>msg</code> 值的函数，让子组件的UI来改变这个值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-meta">@Prop</span>
  <span class="hljs-attr">updateMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
​
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update parent message'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateMessage</span>(<span class="hljs-string">'from child msg'</span>);
    })
  }
}
​
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">updateMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = msg;
  }
  <span class="hljs-keyword">private</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;
​
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
          .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
​
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> ? <span class="hljs-string">'Welcome'</span> : <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;
          })
        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">updateMessage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateMessage</span> })
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}
​
</code></pre>
<p>编辑页面中并没有提示语法错误，但是一旦运行，编译器还是报错了。以下是报错信息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Error</span> <span class="hljs-attr">message</span>:<span class="hljs-meta">@Component</span> <span class="hljs-string">'@Component '</span><span class="hljs-title class_">Child</span><span class="hljs-string">'[8]'</span>: <span class="hljs-title class_">Illegal</span> variable value error <span class="hljs-keyword">with</span> decorated variable <span class="hljs-meta">@Prop</span> <span class="hljs-string">'updateMessage'</span>: failed <span class="hljs-attr">validation</span>: <span class="hljs-string">'undefined, null, number, boolean, string, or Object but not function, not V2 @ObservedV2 / @Trace class, and makeObserved return value either, attempt to assign value type: '</span><span class="hljs-keyword">function</span><span class="hljs-string">', value: '</span><span class="hljs-literal">undefined</span><span class="hljs-string">'!
</span></code></pre>
<p>大意就是不支持传递函数类型！那么应该如何修改呢？在ArkTS中，允许子组件直接修改父组件的状态！我们需要在子组件中把父组件传递的属性使用 <code>@Link</code>装饰器修饰，这表示这是一个父组件传递进来的状态，并且在子组件中修改它时，父组件中的值也会发生相应的变化！</p>
<p>我们把updateMessage 变为一个基本数据类型，并用 <code>@Link</code>装饰器修饰，然后在父组件中传递父组件的值。</p>
<pre><code class="hljs language-scss" lang="scss">​
<span class="hljs-keyword">@Component</span>
struct Child {
  <span class="hljs-keyword">@Link</span>
  <span class="hljs-attribute">parentMsg</span>: string;
  
  
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-selector-tag">Button</span>('update parent message')<span class="hljs-selector-class">.onClick</span>(() =&gt; {
      this<span class="hljs-selector-class">.parentMsg</span> = 'from Child Message';
    })
  }
}
  
  
<span class="hljs-keyword">@Entry</span>
<span class="hljs-keyword">@Component</span>
struct Index {
  <span class="hljs-built_in">build</span>() {
    ...
    <span class="hljs-built_in">Child</span>({ parentMsg: this.message })
  } 
}
</code></pre>
<p>运行效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89144312d697457cb99f5aac862262d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Xl2BodH6P3yOdyNypMBZr0jgvi4%3D" alt="iShot_2026-02-01_15.58.24" loading="lazy"/></p>
<p>有了以上的基础知识，我们可以开始开发一个基本的TodoList。</p>
<p>下面通过一个 TodoList 案例来展示 ArkTS 的核心语法。在鸿蒙中，我们推荐将数据逻辑封装在 <code>class</code> 中，而 UI 结构定义在 <code>struct</code> 内部。</p>
<h4 data-id="heading-7">为什么需要 <code>@Observed</code> 和 <code>@ObjectLink</code>？</h4>
<p>在开发 TodoList 这种包含对象数组的列表时，简单的 <code>@State</code> 是不够的。</p>
<ol>
<li><strong><code>@State</code> 的局限：</strong> 它只能观察到变量本身的变化。如果你修改了数组中某个对象成员的内部属性（例如 <code>task.isCompleted = true</code>），由于数组的引用地址没变，UI 不会触发刷新。</li>
<li><strong><code>@Observed</code>：</strong> 装饰在类定义上，使类成员的属性变化可以被追踪。</li>
<li><strong><code>@ObjectLink</code>：</strong> 装饰在子组件的变量上，用来接收父组件传来的 <code>Observed</code> 对象。这样子组件修改对象属性时，父组件对应的 UI 也会同步更新。</li>
</ol>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 定义数据模型，使用 @Observed 确保属性可被追踪</span>
<span class="hljs-keyword">@Observed</span>
class Task {
  id: number;
  <span class="hljs-attribute">content</span>: string = <span class="hljs-string">""</span>;
  isCompleted: boolean = false;
​
  <span class="hljs-built_in">constructor</span>(id: number, content: string, isCompleted: boolean = false) {
    this<span class="hljs-selector-class">.id</span> = id;
    this<span class="hljs-selector-class">.content</span> = <span class="hljs-attribute">content</span>;
    this<span class="hljs-selector-class">.isCompleted</span> = isCompleted;
  }
}
​
<span class="hljs-comment">// 2. 抽离列表项子组件，使用 @ObjectLink 同步状态</span>
<span class="hljs-keyword">@Component</span>
struct TaskView {
  <span class="hljs-keyword">@ObjectLink</span> <span class="hljs-attribute">task</span>: Task;
​
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-attribute">Flex</span>({ justifyContent: FlexAlign.SpaceAround }) {
      Text(this.task.id.toString())
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333333</span>')
        <span class="hljs-selector-class">.margin</span>({ right: <span class="hljs-number">10</span> })
      
      Text(this.task.content)
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333333</span>')
        <span class="hljs-selector-class">.margin</span>({ right: <span class="hljs-number">10</span> })
        <span class="hljs-selector-class">.decoration</span>({
          type: this.task.isCompleted ? TextDecorationType.LineThrough : TextDecorationType.None
        })
        <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)
​
      Text(this.task.isCompleted ? "已完成" : "未完成")
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>(this.task.isCompleted ? '#<span class="hljs-number">00</span>AA00' : '#FF0000')
        <span class="hljs-selector-class">.onClick</span>(() =&gt; {
          <span class="hljs-comment">// 修改状态，UI 自动响应</span>
          this<span class="hljs-selector-class">.task</span><span class="hljs-selector-class">.isCompleted</span> = !this<span class="hljs-selector-class">.task</span><span class="hljs-selector-class">.isCompleted</span>
        })
    }
    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">10</span>)
    <span class="hljs-selector-class">.backgroundColor</span>('#FFFFFF')
    <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">8</span>)
    <span class="hljs-selector-class">.margin</span>({ bottom: <span class="hljs-number">10</span> })
  }
}
​
<span class="hljs-comment">// 3. 主页面容器</span>
<span class="hljs-keyword">@Component</span>
export struct TodoList {
  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">list</span>: Task[] = [
    new Task(<span class="hljs-number">1</span>, <span class="hljs-string">"熟悉项目结构"</span>),
    new Task(<span class="hljs-number">2</span>, <span class="hljs-string">"运行模拟器"</span>, true),
    new Task(<span class="hljs-number">3</span>, <span class="hljs-string">"编写第一个组件"</span>)
  ];
​
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Column</span>() {
      Text("待办清单")
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">24</span>)
        <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)
        <span class="hljs-selector-class">.margin</span>(<span class="hljs-number">20</span>)
​
      <span class="hljs-built_in">ForEach</span>(this.list, (item: Task) =&gt; {
        <span class="hljs-built_in">TaskView</span>({ task: item });
      }, (item: Task) =&gt; item<span class="hljs-selector-class">.id</span><span class="hljs-selector-class">.toString</span>());
    }
    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.backgroundColor</span>('#F1F3F5')
  }
}
</code></pre>
<h3 data-id="heading-8">4. 总结</h3>
<p>通过 TodoList 的练习，可以发现鸿蒙开发的门槛并不在于语言，而在于对 <strong>Stage 模型</strong>和<strong>状态装饰器</strong>的理解。</p>
<p>对于前端开发者，ArkUI 的组件化思维是互通的，但需要额外关注父子组件间关于函数传递的限制。对于游戏开发者，从手动更新 UI 转向声明式的数据驱动，能够显著减少在界面维护上的逻辑代码量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术]]></title>    <link>https://juejin.cn/post/7601757036485902346</link>    <guid>https://juejin.cn/post/7601757036485902346</guid>    <pubDate>2026-02-01T07:52:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036485902346" data-draft-id="7601757036485754890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-02-01T07:52:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一个骇客"/> <meta itemprop="url" content="https://juejin.cn/user/644760908336608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644760908336608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一个骇客
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:52:19.000Z" title="Sun Feb 01 2026 07:52:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你在Y——一个拥有<strong>10亿月活</strong>的国民级社交平台——上刚刚点击了发布按钮。你可能没有意识到，此刻的平台，<strong>每天正吞吐着近8亿条新鲜动态</strong>，平均每秒就有近万条内容试图争夺眼球。若遇到"全民盛事"或"顶流空降"，流量峰值<strong>瞬间冲破每秒30万条</strong>也绝非天方夜谭。</p>
<p>这早已不是普通的信息展示，而是一场需要极高精度编排的<strong>数据风暴</strong>。今天，让我们深入幕后，探究那个让你流连忘返的"首页时间线"，如何在如此恐怖的规模下，依然保持令人愉悦的流畅。</p>
<h3 data-id="heading-0">第一幕：朴素的开端与数据结构</h3>
<p>最初的想法总是直接而单纯：每次用户下拉刷新，客户端就去数据库询问："我关心的人都更新了什么？"</p>
<p>首先，我们来看支撑这一功能的核心数据模型设计：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">erDiagram
    USER ||--o{ POST : "publishes"
    USER ||--o{ FOLLOW_RELATIONSHIP : "follows as follower"
    USER ||--o{ FOLLOW_RELATIONSHIP : "is followed as followee"
    
    POST {
        bigint id PK
        bigint author_id FK
        text content
        timestamp created_at
    }
    
    USER {
        bigint id PK
        varchar name
        varchar avatar_url
    }
    
    FOLLOW_RELATIONSHIP {
        bigint follower_id FK
        bigint followee_id FK
    }
</code></pre>
<p>基于这个模型，当请求你的首页时，系统会执行类似下面的查询：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> post.<span class="hljs-operator">*</span>, user.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> post
  <span class="hljs-keyword">JOIN</span> follow_relationship <span class="hljs-keyword">ON</span> post.author_id <span class="hljs-operator">=</span> follow_relationship.followee_id
  <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ON</span> post.author_id <span class="hljs-operator">=</span> user.id
  <span class="hljs-keyword">WHERE</span> follow_relationship.follower_id <span class="hljs-operator">=</span> current_user_id
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> post.created_at <span class="hljs-keyword">DESC</span>
  LIMIT <span class="hljs-number">1000</span>
</code></pre>
<p><strong>逻辑清晰易懂</strong>：找到你关注的人，取出他们的动态，按时间排序，呈现最新的1000条。</p>
<p>但让我们计算一下现实的残酷：
假设有1亿用户同时在线，平均每人每2秒请求一次。这就是<strong>每秒5000万次查询</strong>。更可怕的是，如果平均每人关注了500个账号，数据库为了准备你的一次刷新，需要在500份数据中进行关联、排序与合并…… 折算下来，相当于每秒要进行 <strong>超过250亿次</strong> 的底层数据操作。</p>
<p><strong>数据库的哀鸣</strong>："这压力，我承受不来。" 💥</p>
<p>这种简单的<strong>拉取（Pull）</strong> 模式，在面对国民级数据洪流时，如同企图用一根水管疏浚长江，从设计上就注定了失败。</p>
<h3 data-id="heading-1">第二幕：范式转换：从"拉取"到"推送"</h3>
<p>工程师们意识到问题的关键：为何要让海量请求反复"拉取"重复数据？何不主动"推送"一次？</p>
<p>于是，核心模式 <strong>扇出（Fan-out）</strong> 被引入。</p>
<p>流程被彻底重构：</p>
<ol>
<li><strong>内容发布</strong>：你在Y发布一条动态。</li>
<li><strong>粉丝列表查询</strong>：系统立刻检索你所有的粉丝（假设平均500人）。</li>
<li><strong>异步投递</strong>：系统将这则新内容，异步"写入"到这500位粉丝各自预置的 <strong>个人时间线缓存</strong> 中。</li>
</ol>
<p>这个"缓存"，在架构上被称为<strong>物化视图（Materialized View）</strong>。它遵循 <strong>以空间和写入复杂度换取读取性能</strong> 的黄金法则。读取首页变得极快——仅是从专属缓存中顺序读取。但发布动态的成本变高，从"一次写入"变为"500次写入"。</p>
<p>计算新方案的成本：假设每秒产生1.2万条新动态，平均扇出系数为500，则每秒需完成 <strong>600万次</strong> 缓存写入。这个数字依然巨大，但相比之前每秒<strong>250亿次</strong>的关联查询，已从"理论灾难"降维为"可解决的工程挑战"。</p>
<p><strong>系统逻辑</strong>："从被动查询（Pull）到主动分发（Push），这是本质的效率飞跃。"</p>
<h3 data-id="heading-2">第三幕：应对极端：长尾与巨头的挑战</h3>
<p>真实的社交图谱遵循幂律分布。这套"推送系统"面临两类极端场景：</p>
<ol>
<li>
<p><strong>重度关注者</strong>：用户A关注了上万个账号。每秒涌入其个人缓存的数据量极大。工程洞察发现：此类用户存在严重的"信息过载"，实际消费率很低。因此系统引入 <strong>采样降级（Sampling）</strong> ：对其时间线进行智能采样，仅保证部分核心内容的投递。用户体验："信息流似乎更清爽了？"（系统：成功卸载冗余负载🙃）</p>
</li>
<li>
<p><strong>现象级创作者</strong>：例如一位坐拥<strong>2亿粉丝</strong>的超级明星发布动态。同步扇出任务列表瞬间爆炸：需要执行<strong>2亿次</strong>写入。若按常规流程，整个分发链路会立刻阻塞。</p>
</li>
</ol>
<p>对此，任何形式的丢弃都是不可接受的。工程策略是：<strong>为巨头启用专用通道</strong>。</p>
<ul>
<li><strong>热点分离</strong>：明星的动态不进入常规的实时扇出流水线，而是被标记并写入一个<strong>独立的热点内容池</strong>。</li>
<li><strong>读取时合并</strong>：当普通用户读取其物化时间线时，系统在返回结果前，实时地从热点池中查询并合并其关注的明星最新动态。这巧妙地将不可承受的<strong>同步写入洪峰</strong>，转化为了可被缓存和水平扩展的<strong>读取时查询压力</strong>。</li>
</ul>
<p><strong>系统日志</strong>："服务一个巨头，其数据波动堪比一场数字海啸。但正是他们，定义了平台的生态高度。"</p>
<h3 data-id="heading-3">总结：在性能与成本的钢丝上优雅行走</h3>
<p>Y社交平台首页时间线的设计演进，是一场典型的大规模系统<strong>架构权衡实践</strong>：</p>
<ul>
<li><strong>核心策略转换</strong>：从简单但不可行的<strong>拉取（Pull）</strong> 模型，果断转向了基于<strong>扇出（Fan-out）</strong> 的<strong>推送（Push）</strong> 架构，这是应对海量并发读取的根本性方案。</li>
<li><strong>关键牺牲与收获</strong>：引入<strong>物化视图（Materialized View）</strong>，明智地<strong>以更高的写入成本和存储空间为代价</strong>，换取了读取端的响应速度，实现了用户体验的质的飞跃。</li>
<li><strong>应对现实复杂性</strong>：没有一种架构能通吃所有场景。通过 <strong>读写分离</strong> 将明星动态导入<strong>热点内容池</strong>，以及对超重度用户时间线进行<strong>采样降级</strong>，系统巧妙地避开了幂律分布带来的“长尾”与“巨头”陷阱，确保了整体的稳定性与资源利用率。</li>
</ul>
<p>最终，这套组合方案展示了一个核心工程哲学：<strong>优秀的架构不是寻找“完美”的解，而是在诸多约束下（性能、成本、复杂度）寻找到那个“恰到好处”的平衡点</strong>。当你在社交媒体上流畅地刷新信息流时，你所体验到的正是这种精密权衡后的结果。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python基本数据类型和打印指南]]></title>    <link>https://juejin.cn/post/7601046076944334863</link>    <guid>https://juejin.cn/post/7601046076944334863</guid>    <pubDate>2026-02-01T06:29:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601046076944334863" data-draft-id="7601077290681925684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python基本数据类型和打印指南"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-01T06:29:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xq9527"/> <meta itemprop="url" content="https://juejin.cn/user/1239904848712184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python基本数据类型和打印指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904848712184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xq9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:29:03.000Z" title="Sun Feb 01 2026 06:29:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python 基本数据类型和打印指南</h2>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%25A6%2582%25E8%25BF%25B0" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%A6%82%E8%BF%B0" ref="nofollow noopener noreferrer">概述</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%259F%25BA%25E6%259C%25AC%25E6%2595%25B0%25E6%258D%25AE%25E7%25B1%25BB%25E5%259E%258B" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" ref="nofollow noopener noreferrer">基本数据类型</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%258F%2598%25E9%2587%258F%25E5%2591%25BD%25E5%2590%258D%25E8%25A7%2584%25E5%2588%2599" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99" ref="nofollow noopener noreferrer">变量命名规则</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%2589%2593%25E5%258D%25B0%25E8%25BE%2593%25E5%2587%25BA-print" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%89%93%E5%8D%B0%E8%BE%93%E5%87%BA-print" ref="nofollow noopener noreferrer">打印输出 (print)</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5-input" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5-input" ref="nofollow noopener noreferrer">用户输入 (input)</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96" ref="nofollow noopener noreferrer">字符串格式化</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E7%25B1%25BB%25E5%259E%258B%25E8%25BD%25AC%25E6%258D%25A2" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" ref="nofollow noopener noreferrer">类型转换</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%259D%25A1%25E4%25BB%25B6%25E8%25AF%25AD%25E5%258F%25A5" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5" ref="nofollow noopener noreferrer">条件语句</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%25AE%259E%25E7%2594%25A8%25E7%25A4%25BA%25E4%25BE%258B" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%AE%9E%E7%94%A8%E7%A4%BA%E4%BE%8B" ref="nofollow noopener noreferrer">实用示例</a></li>
</ol>
<h3 data-id="heading-2">概述</h3>
<p>Python是一种简洁易读的编程语言，拥有丰富的内置数据类型。掌握基本数据类型和打印输出是学习Python的第一步，也是编程的基础技能。</p>
<h3 data-id="heading-3">基本数据类型</h3>
<h4 data-id="heading-4">1. 数值类型</h4>
<h5 data-id="heading-5">整数 (int)</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 正整数</span>
<span class="hljs-attr">x</span> = <span class="hljs-number">10</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>
<span class="hljs-attr">myNum</span> = <span class="hljs-number">123</span>
<span class="hljs-attr">myNumber</span> = <span class="hljs-number">456</span>
<span class="hljs-attr">_Number</span> = <span class="hljs-number">789</span>

<span class="hljs-comment"># 负整数</span>
<span class="hljs-attr">negative_num</span> = -<span class="hljs-number">5</span>

<span class="hljs-comment"># 大整数（Python支持任意精度）</span>
<span class="hljs-attr">big_number</span> = <span class="hljs-number">123456789012345678901234567890</span>

print(x)        <span class="hljs-comment"># 输出: 10</span>
print(age)      <span class="hljs-comment"># 输出: 18</span>
print(myNum)    <span class="hljs-comment"># 输出: 123</span>
</code></pre>
<h5 data-id="heading-6">浮点数 (float)</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 小数</span>
<span class="hljs-attr">y</span> = <span class="hljs-number">3.14</span>
<span class="hljs-attr">pi</span> = <span class="hljs-number">3.14159</span>
<span class="hljs-attr">temperature</span> = -<span class="hljs-number">2.5</span>

<span class="hljs-comment"># 科学计数法</span>
<span class="hljs-attr">scientific</span> = <span class="hljs-number">1.23</span>e-<span class="hljs-number">4</span>  <span class="hljs-comment"># 0.000123</span>

print(y)           <span class="hljs-comment"># 输出: 3.14</span>
print(f"π的值是: {pi}")
</code></pre>
<h4 data-id="heading-7">2. 字符串 (str)</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 单引号字符串</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"Alice"</span>
<span class="hljs-attr">the_name</span> = <span class="hljs-string">"name"</span>
<span class="hljs-attr">letter</span> = <span class="hljs-string">"abhbabsbbabw"</span>

<span class="hljs-comment"># 双引号字符串</span>
<span class="hljs-attr">message</span> = <span class="hljs-string">"Hello, World!"</span>

<span class="hljs-comment"># 多行字符串</span>
<span class="hljs-attr">multi_line</span> = <span class="hljs-string">"""这是第一行
这是第二行
这是第三行"""</span>

<span class="hljs-comment"># 字符串操作</span>
<span class="hljs-attr">upper_letter</span> = letter.upper()  <span class="hljs-comment"># 转换为大写</span>
print(upper_letter)            <span class="hljs-comment"># 输出: ABHBABSBBABW</span>
print(name)                    <span class="hljs-comment"># 输出: Alice</span>
</code></pre>
<h4 data-id="heading-8">3. 布尔值 (bool)</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 布尔值只有两个：True 和 False</span>
<span class="hljs-attr">is_valid</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">e</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">flag</span> = <span class="hljs-literal">True</span>

print(e)        <span class="hljs-comment"># 输出: False</span>
print(flag)     <span class="hljs-comment"># 输出: True</span>

<span class="hljs-comment"># 布尔值常用于条件判断</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>
if age &gt;= 18:
    print("你已经成年了")  <span class="hljs-comment"># 输出: 你已经成年了</span>
else:
    print("你还未成年")
</code></pre>
<h4 data-id="heading-9">4. 复合数据类型（简要介绍）</h4>
<h5 data-id="heading-10">列表 (list) - 可变有序集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_list</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">fruits</span> = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>]
<span class="hljs-attr">mixed_list</span> = [<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-number">3.14</span>, <span class="hljs-literal">True</span>]
</code></pre>
<h5 data-id="heading-11">元组 (tuple) - 不可变有序集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_tuple</span> = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
<span class="hljs-attr">coordinates</span> = (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
</code></pre>
<h5 data-id="heading-12">字典 (dict) - 键值对集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_dict</span> = {<span class="hljs-string">'name'</span>: <span class="hljs-string">'徐庆'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">18</span>}
<span class="hljs-attr">student</span> = {<span class="hljs-string">"姓名"</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-string">"年龄"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"成绩"</span>: <span class="hljs-number">85</span>}
</code></pre>
<h5 data-id="heading-13">集合 (set) - 无序不重复元素</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_set</span> = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
<span class="hljs-attr">unique_numbers</span> = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>}  <span class="hljs-comment"># 自动去重为 {1, 2, 3, 4}</span>
</code></pre>
<h3 data-id="heading-14">变量命名规则</h3>
<h4 data-id="heading-15">合法的变量名</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ✓ 正确的命名方式</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>           <span class="hljs-comment"># 全小写</span>
<span class="hljs-attr">myName</span> = <span class="hljs-string">"Alice"</span>   <span class="hljs-comment"># 驼峰命名法</span>
<span class="hljs-attr">my_number</span> = <span class="hljs-number">42</span>     <span class="hljs-comment"># 下划线分隔（推荐）</span>
<span class="hljs-attr">_number</span> = <span class="hljs-number">789</span>      <span class="hljs-comment"># 下划线开头</span>
<span class="hljs-attr">name123</span> = <span class="hljs-string">"test"</span>   <span class="hljs-comment"># 字母数字组合</span>

print(age)         <span class="hljs-comment"># 输出: 18</span>
print(myName)      <span class="hljs-comment"># 输出: Alice</span>
</code></pre>
<h4 data-id="heading-16">命名规范建议</h4>
<ul>
<li>使用有意义的变量名</li>
<li>推荐使用下划线分隔（snake_case）</li>
<li>变量名应能表达其含义</li>
<li>避免使用Python关键字作为变量名</li>
</ul>
<h3 data-id="heading-17">打印输出 (print)</h3>
<h4 data-id="heading-18">基本打印</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 打印字符串</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World!"</span>)           <span class="hljs-comment"># 输出: Hello, World!</span>

<span class="hljs-comment"># 打印变量</span>
x = <span class="hljs-number">10</span>
<span class="hljs-built_in">print</span>(x)                         <span class="hljs-comment"># 输出: 10</span>

<span class="hljs-comment"># 打印多个值</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name   --- &gt;  "</span> + name)   <span class="hljs-comment"># 字符串拼接</span>
<span class="hljs-built_in">print</span>(<span class="hljs-number">111</span>)                       <span class="hljs-comment"># 输出: 111</span>
<span class="hljs-built_in">print</span>(<span class="hljs-literal">True</span>)                      <span class="hljs-comment"># 输出: True</span>
</code></pre>
<h4 data-id="heading-19">格式化打印</h4>
<h5 data-id="heading-20">1. 字符串拼接</h5>
<pre><code class="hljs language-bash" lang="bash">name = <span class="hljs-string">"Alice"</span>
age = 18
<span class="hljs-built_in">print</span>(<span class="hljs-string">"My name is "</span> + name)                    <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name   --- &gt;  "</span> + name)                 <span class="hljs-comment"># 输出: name   --- &gt;  Alice</span>
</code></pre>
<h5 data-id="heading-21">2. f-string格式化（推荐）</h5>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"My name is <span class="hljs-subst">{name}</span>"</span>)                    <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"我今年<span class="hljs-subst">{age}</span>岁"</span>)                        <span class="hljs-comment"># 输出: 我今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>, 年龄: <span class="hljs-subst">{age}</span>"</span>)            <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h5 data-id="heading-22">3. format方法</h5>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"My name is {}"</span>.<span class="hljs-built_in">format</span>(name))            <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {}, 年龄: {}"</span>.<span class="hljs-built_in">format</span>(name, <span class="hljs-number">18</span>))   <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h5 data-id="heading-23">4. %格式化（较老的方式）</h5>
<pre><code class="hljs language-perl" lang="perl">name = <span class="hljs-string">"Alice"</span>
<span class="hljs-keyword">print</span>(<span class="hljs-string">"My name is %s"</span> % name)                  <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-keyword">print</span>(<span class="hljs-string">"姓名: %s, 年龄: %d"</span> % (name, <span class="hljs-number">18</span>))       <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h4 data-id="heading-24">高级打印技巧</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 打印换行</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"第一行"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"第二行"</span>)

<span class="hljs-comment"># 不换行打印</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello"</span>, end=<span class="hljs-string">" "</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"World"</span>)                                 <span class="hljs-comment"># 输出: Hello World</span>

<span class="hljs-comment"># 分隔符自定义</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>, sep=<span class="hljs-string">"-"</span>)    <span class="hljs-comment"># 输出: apple-banana-orange</span>

<span class="hljs-comment"># 打印到文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"output.txt"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"保存到文件的内容"</span>, file=f)
</code></pre>
<h3 data-id="heading-25">用户输入 (input)</h3>
<h4 data-id="heading-26">基本输入</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 获取用户输入</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入内容: "</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入的是: <span class="hljs-subst">{user_input}</span>"</span>)

<span class="hljs-comment"># 输入数字（需要转换类型）</span>
get_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数字："</span>)
number = <span class="hljs-built_in">int</span>(get_input)  <span class="hljs-comment"># 转换为整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入的数字是: <span class="hljs-subst">{number}</span>"</span>)
</code></pre>
<h4 data-id="heading-27">输入验证示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安全的数字输入</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_number_input</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">try</span>:
            user_input = <span class="hljs-built_in">input</span>(prompt)
            number = <span class="hljs-built_in">int</span>(user_input)
            <span class="hljs-keyword">return</span> number
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"请输入有效的数字！"</span>)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-comment"># age = get_number_input("请输入您的年龄: ")</span>
</code></pre>
<h3 data-id="heading-28">字符串格式化</h3>
<h4 data-id="heading-29">f-string（最推荐）</h4>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>
score = <span class="hljs-number">95.5</span>

<span class="hljs-comment"># 基本格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>"</span>)                          <span class="hljs-comment"># 输出: 姓名: Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>"</span>)                           <span class="hljs-comment"># 输出: 年龄: 18</span>

<span class="hljs-comment"># 数字格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"成绩: <span class="hljs-subst">{score:<span class="hljs-number">.1</span>f}</span>"</span>)                     <span class="hljs-comment"># 输出: 成绩: 95.5</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"成绩: <span class="hljs-subst">{score:<span class="hljs-number">.2</span>f}</span>"</span>)                     <span class="hljs-comment"># 输出: 成绩: 95.50</span>

<span class="hljs-comment"># 表达式计算</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"明年年龄: <span class="hljs-subst">{age + <span class="hljs-number">1</span>}</span>"</span>)                   <span class="hljs-comment"># 输出: 明年年龄: 19</span>
</code></pre>
<h4 data-id="heading-30">format方法</h4>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>

<span class="hljs-comment"># 位置参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {}, 年龄: {}"</span>.<span class="hljs-built_in">format</span>(name, age))

<span class="hljs-comment"># 关键字参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {name}, 年龄: {age}"</span>.<span class="hljs-built_in">format</span>(name=name, age=age))

<span class="hljs-comment"># 数字格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"成绩: {:.2f}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">95.567</span>))            <span class="hljs-comment"># 输出: 成绩: 95.57</span>
</code></pre>
<h3 data-id="heading-31">类型转换</h3>
<h4 data-id="heading-32">基本类型转换</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 字符串转数字</span>
str_num = <span class="hljs-string">"123"</span>
int_num = <span class="hljs-built_in">int</span>(str_num)          <span class="hljs-comment"># 转为整数</span>
float_num = <span class="hljs-built_in">float</span>(str_num)      <span class="hljs-comment"># 转为浮点数</span>

<span class="hljs-built_in">print</span>(int_num)                  <span class="hljs-comment"># 输出: 123</span>
<span class="hljs-built_in">print</span>(float_num)                <span class="hljs-comment"># 输出: 123.0</span>

<span class="hljs-comment"># 数字转字符串</span>
num = <span class="hljs-number">42</span>
str_num = <span class="hljs-built_in">str</span>(num)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"数字<span class="hljs-subst">{num}</span>转为字符串: '<span class="hljs-subst">{str_num}</span>'"</span>)

<span class="hljs-comment"># 布尔转换</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-number">0</span>))                  <span class="hljs-comment"># 输出: False</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-number">1</span>))                  <span class="hljs-comment"># 输出: True</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-string">""</span>))                 <span class="hljs-comment"># 输出: False</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-string">"hello"</span>))            <span class="hljs-comment"># 输出: True</span>
</code></pre>
<h4 data-id="heading-33">实用转换示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 用户输入数字处理</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入一个数字: "</span>)
<span class="hljs-keyword">try</span>:
    number = <span class="hljs-built_in">int</span>(user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"输入的数字是: <span class="hljs-subst">{number}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"数字的平方是: <span class="hljs-subst">{number ** <span class="hljs-number">2</span>}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"输入的不是有效数字！"</span>)
</code></pre>
<h3 data-id="heading-34">条件语句</h3>
<h4 data-id="heading-35">if-else语句</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本条件判断</span>
age = 18
<span class="hljs-keyword">if</span> age &gt;= 18:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你已经成年了"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你还未成年"</span>)

<span class="hljs-comment"># 多重条件判断</span>
score = 85
<span class="hljs-keyword">if</span> score &gt;= 90:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"优秀"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 80:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"良好"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 60:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"及格"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不及格"</span>)
</code></pre>
<h4 data-id="heading-36">数字判断示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 判断奇偶数</span>
get_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数字："</span>)
number = <span class="hljs-built_in">int</span>(get_input)

<span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是偶数"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是奇数"</span>)

<span class="hljs-comment"># 判断素数（简单版本）</span>
<span class="hljs-keyword">if</span> number == <span class="hljs-number">2</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是素数"</span>)
<span class="hljs-keyword">elif</span> number &lt; <span class="hljs-number">2</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不是素数"</span>)
<span class="hljs-keyword">else</span>:
    is_prime = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-built_in">int</span>(number ** <span class="hljs-number">0.5</span>) + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> number % i == <span class="hljs-number">0</span>:
            is_prime = <span class="hljs-literal">False</span>
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> is_prime:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"是素数"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"不是素数"</span>)
</code></pre>
<h3 data-id="heading-37">实用示例</h3>
<h4 data-id="heading-38">1. 简单计算器</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_calculator</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 简单计算器 ==="</span>)
    
    <span class="hljs-comment"># 获取用户输入</span>
    num1 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字: "</span>))
    operator = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入运算符 (+, -, *, /): "</span>)
    num2 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字: "</span>))
    
    <span class="hljs-comment"># 执行计算</span>
    <span class="hljs-keyword">if</span> operator == <span class="hljs-string">"+"</span>:
        result = num1 + num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"-"</span>:
        result = num1 - num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"*"</span>:
        result = num1 * num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"/"</span>:
        <span class="hljs-keyword">if</span> num2 != <span class="hljs-number">0</span>:
            result = num1 / num2
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误：除数不能为零"</span>)
            <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误：无效的运算符"</span>)
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{num1}</span> <span class="hljs-subst">{operator}</span> <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># simple_calculator()</span>
</code></pre>
<h4 data-id="heading-39">2. 个人信息录入系统</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">personal_info_system</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 个人信息录入系统 ==="</span>)
    
    <span class="hljs-comment"># 收集信息</span>
    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入姓名: "</span>)
    age = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入年龄: "</span>))
    height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入身高(cm): "</span>))
    is_student_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"是否为学生？(y/n): "</span>)
    is_student = is_student_input.lower() == <span class="hljs-string">'y'</span>
    
    <span class="hljs-comment"># 显示信息</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 个人信息 ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>岁"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"身高: <span class="hljs-subst">{height}</span>cm"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"学生身份: <span class="hljs-subst">{<span class="hljs-string">'是'</span> <span class="hljs-keyword">if</span> is_student <span class="hljs-keyword">else</span> <span class="hljs-string">'否'</span>}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># personal_info_system()</span>
</code></pre>
<h4 data-id="heading-40">3. 成绩等级判断系统</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">grade_system</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 成绩等级判断系统 ==="</span>)
    
    <span class="hljs-comment"># 获取成绩</span>
    chinese = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入语文成绩: "</span>))
    math = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数学成绩: "</span>))
    english = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入英语成绩: "</span>))
    
    <span class="hljs-comment"># 计算平均分</span>
    average = (chinese + math + english) / <span class="hljs-number">3</span>
    
    <span class="hljs-comment"># 判断等级</span>
    <span class="hljs-keyword">if</span> average &gt;= <span class="hljs-number">90</span>:
        grade = <span class="hljs-string">"优秀"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">80</span>:
        grade = <span class="hljs-string">"良好"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">70</span>:
        grade = <span class="hljs-string">"中等"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">60</span>:
        grade = <span class="hljs-string">"及格"</span>
    <span class="hljs-keyword">else</span>:
        grade = <span class="hljs-string">"不及格"</span>
    
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n平均成绩: <span class="hljs-subst">{average:<span class="hljs-number">.2</span>f}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"等级评定: <span class="hljs-subst">{grade}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># grade_system()</span>
</code></pre>
<h3 data-id="heading-41">学习建议</h3>
<ol>
<li><strong>多动手练习</strong> - 亲自编写代码比只看文档更重要</li>
<li><strong>理解概念</strong> - 不要死记硬背，要理解每种数据类型的用途</li>
<li><strong>注意细节</strong> - 变量命名、缩进、语法等都要规范</li>
<li><strong>循序渐进</strong> - 从简单的打印开始，逐步学习复杂的概念</li>
<li><strong>善用调试</strong> - 遇到问题时学会使用print()调试</li>
</ol>
<h3 data-id="heading-42">常见错误提醒</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误示例</span>
<span class="hljs-comment"># 1. 变量未定义就使用</span>
<span class="hljs-comment"># print(undefined_var)  # NameError</span>

<span class="hljs-comment"># 2. 字符串和数字直接拼接</span>
<span class="hljs-comment"># print("年龄: " + 18)  # TypeError</span>

<span class="hljs-comment"># 3. 输入转换错误</span>
<span class="hljs-comment"># user_input = input("输入数字: ")</span>
<span class="hljs-comment"># number = int(user_input)  # 如果输入非数字会报错</span>

<span class="hljs-comment"># ✓ 正确做法</span>
<span class="hljs-comment"># 1. 先定义变量</span>
message = <span class="hljs-string">"Hello"</span>
<span class="hljs-built_in">print</span>(message)

<span class="hljs-comment"># 2. 使用格式化</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>"</span>)

<span class="hljs-comment"># 3. 安全转换</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"输入数字: "</span>)
<span class="hljs-keyword">try</span>:
    number = <span class="hljs-built_in">int</span>(user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入了: <span class="hljs-subst">{number}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"请输入有效数字！"</span>)
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>