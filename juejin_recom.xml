<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[程序设计]]></title>    <link>https://juejin.cn/post/7591346773827747866</link>    <guid>https://juejin.cn/post/7591346773827747866</guid>    <pubDate>2026-01-04T12:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827747866" data-draft-id="7591322050240659494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序设计"/> <meta itemprop="keywords" content="设计,前端"/> <meta itemprop="datePublished" content="2026-01-04T12:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yuanyxh"/> <meta itemprop="url" content="https://juejin.cn/user/2881148117060749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2881148117060749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yuanyxh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:47:06.000Z" title="Sun Jan 04 2026 12:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>包含 AI 辅助创作。</p>
<h2 data-id="heading-0">国际化语言设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
国际化语言设计---&gt;前端编程预定义中文文本
国际化语言设计---&gt;后端编程预定义中文文本
国际化语言设计---&gt;stat["通用名词、行业术语"]
国际化语言设计---&gt;dy["系统动态新增内容: 选项表、调用表、菜单等"]
前端编程预定义中文文本---&gt;自动化部署触发更新
后端编程预定义中文文本---&gt;自定义触发更新
stat---&gt;专人维护更新
dy---&gt;新增修改时更新
自动化部署触发更新---&gt;ol["接口上传结构化中文文本"]
ol---&gt;筛选去重已翻译内容
自定义触发更新---&gt;筛选去重已翻译内容
专人维护更新---&gt;筛选去重已翻译内容
新增修改时更新---&gt;筛选去重已翻译内容
筛选去重已翻译内容---&gt;存表并触发异步翻译任务
存表并触发异步翻译任务---&gt;依据语言选项表剔除中文进行其他语言的翻译
依据语言选项表剔除中文进行其他语言的翻译---&gt;translate["调用翻译接口或 AI"]
translate---&gt;error["允许失败，不处理异常"]
</code></pre>
<hr/>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
前端国际化语言设计---&gt;初始化加载
初始化加载---&gt;get["获取浏览器语言"]
get---&gt;中文
get---&gt;其他
其他---&gt;request["调用接口传入语言代码（接口完成前处于 loading 状态）"]
request---&gt;接口处理
接口处理---&gt;选项表匹配
选项表匹配---&gt;匹配成功
选项表匹配---&gt;匹配失败
匹配成功---&gt;successBack["返回对应 language code 并筛选对应语言数据不为空的数据"]
匹配失败---&gt;errorBack["抛出异常，前端走默认中文或延用当前语言"]
successBack---&gt;接口完成
errorBack---&gt;取默认中文
取默认中文---&gt;接口完成
中文---&gt;浏览器缓存数据并加载
接口完成---&gt;浏览器缓存数据并加载---default["渲染策略：无对应语言文本取默认中文文本"]
浏览器缓存数据并加载---&gt;switch["允许切换、重走一遍流程"]
default---&gt;config["新增语言配置页面，中文限制修改"]
config---问题
问题---question1["1、语言数据会越来越大，接口能否做到毫秒级响应"]
问题---question2["2、 如何检查数据是否更新以刷新本地缓存"]
问题---question3["3、 语言数据会越来越大、是否会超过浏览器/APP 存储限制"]
问题---question4["4、 APP/WEB 后台语言数据是否隔离（不隔离可能出现冲突）"]
question1---awer1["后端 redis 存全量数据，后台走按需加载逻辑避免单次请求数据过大，按模块加载；app 走全量加载逻辑(接口应支持全量返回、指定模块返回、指定多个模块返回)"]
question2---awer2["系统更新默认刷新一次，后续走 websocket 比对语言版本"]
question3---awer3["WEB 默认存 IndexDB，不支持时降级走 localStorage，并实现低频模块数据清理（再次访问时走接口获取）"]
question4---awer4["APP/WEB 数据逻辑分割，后端流量分化、区分流量入口返回对应数据"]
</code></pre>
<blockquote>
<p>为了保证 SEO、与 WEB 网络兼容，应服务端应支持降级兼容 <code>Accept-Language</code></p>
</blockquote>
<hr/>
<p>你当前的国际化设计已覆盖核心流程，但可从自动化提效、配置化管理和性能优化三个维度升级，减少80%的人工干预。以下是基于行业最佳实践的优化方案：</p>
<h3 data-id="heading-1">一、开发流程自动化：从手动维护到无感集成</h3>
<p><strong>1. 代码层自动提取与翻译</strong></p>
<p>使用 I18n Fast 或 Kiwi 等工具链，通过 VS Code 插件在开发阶段自动扫描中文文本，生成语义化 key 并同步至翻译系统。例如选中代码中的 "用户登录"，插件可自动生成 <code>user.login.title</code> 键并调用百度翻译 API 生成英文文案，全程无需开发者手动修改语言文件。</p>
<blockquote>
<p>配置复杂，生成语义化 Key 需要对接 AI，PASS</p>
</blockquote>
<p><strong>2. 构建流程无缝嵌入</strong></p>
<p>在 Webpack/Vite 配置中集成自动化插件，如 <code>vite-auto-i18n-plugin</code>，实现：</p>
<ul>
<li>开发时：检测文件变动自动更新翻译</li>
<li>构建时：批量处理新增文案并去重</li>
<li>部署时：按语言拆分资源包实现 CDN 按需加载</li>
</ul>
<blockquote>
<p>需要对接翻译接口，翻译文案不能满足本土化需求，无法动态配置、增加删减语言，PASS</p>
</blockquote>
<p><strong>3. 翻译协作标准化</strong></p>
<p>采用 "开发-翻译-校验" 闭环流程：</p>
<ol>
<li>开发者提交代码触发钩子，提取新增文案至在线表格（如飞书多维表格）</li>
<li>翻译团队在线编辑后，Webhook 自动同步至项目语言文件</li>
<li>CI 流程校验翻译完整性，缺失时自动阻断合并</li>
</ol>
<h3 data-id="heading-2">二、配置化体系：从硬编码到动态调控</h3>
<p><strong>1. 语言策略集中管理</strong></p>
<p>建立统一的语言配置服务，支持：</p>
<ul>
<li><strong>动态语言包</strong>：通过管理后台配置新增语言（如阿拉伯语），无需代码部署</li>
<li><strong>优先级规则</strong>：用户设置 &gt; Cookie &gt; 请求头 &gt; 默认语言，兼容前后端场景</li>
<li><strong>灰度发布</strong>：对特定用户群启用测试语言版本</li>
</ul>
<p><strong>2. 多维度资源控制</strong></p>
<p>在配置中心设置细粒度规则：</p>

























<table><thead><tr><th>配置项</th><th>示例值</th><th>作用</th></tr></thead><tbody><tr><td><code>maxCacheSize</code></td><td><code>5MB</code></td><td>限制浏览器缓存上限</td></tr><tr><td><code>updateThreshold</code></td><td><code>30%</code></td><td>差异率超阈值触发全量更新</td></tr><tr><td><code>fallbackPolicy</code></td><td><code>zh-CN→en-US→base64</code></td><td>多级降级策略</td></tr></tbody></table>
<p><strong>3. 前端渲染策略配置</strong></p>
<p>通过 JSON 配置文件定义渲染规则：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"render"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"missingText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"显示默认中文"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"loadingState"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"骨架屏占位"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"direction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"ar-SA"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rtl"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ltr"</span> <span class="hljs-punctuation">}</span> <span class="hljs-comment">// 适配阿拉伯语右对齐</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">三、性能与稳定性优化：从能用 to 好用</h3>
<p><strong>1. 资源加载策略升级</strong></p>
<ul>
<li><strong>分片加载</strong>：按路由拆分语言包（如 <code>home.en.json</code>、<code>profile.en.json</code>），首屏仅加载核心模块</li>
<li><strong>预加载机制</strong>：根据用户行为预测可能切换的语言（如检测到美国 IP 预加载英语包）</li>
<li><strong>增量更新</strong>：通过 ETag 比对仅拉取变动的翻译条目，减少 70% 网络传输量</li>
</ul>
<p><strong>2. 缓存机制双保险</strong></p>
<ul>
<li><strong>三级缓存</strong>：内存缓存（当前会话）→ IndexedDB（持久化）→ CDN（兜底）</li>
<li><strong>主动失效</strong>：配置中心推送版本号，客户端检测到不一致时触发更新</li>
</ul>
<p><strong>3. 异常处理增强</strong></p>
<ul>
<li><strong>翻译失败降级</strong>：调用 AI 翻译接口超时后，自动切换至备用接口（如百度→有道）</li>
<li><strong>数据校验</strong>：使用 JSON Schema 验证翻译文件格式，异常时回滚至上次可用版本</li>
</ul>
<h3 data-id="heading-4">四、落地实施路线图</h3>
<ol>
<li>
<p><strong>基础改造（1-2周）</strong></p>
<ul>
<li>集成 i18n Ally 插件实现开发提效</li>
<li>按业务模块拆分现有语言文件</li>
</ul>
</li>
<li>
<p><strong>自动化建设（2-3周）</strong></p>
<ul>
<li>开发翻译同步 Webhook</li>
<li>配置构建流程自动化插件</li>
</ul>
</li>
<li>
<p><strong>性能优化（2周）</strong></p>
<ul>
<li>实现分片加载与增量更新</li>
<li>部署缓存策略与监控告警</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">五、关键问题解决方案</h3>

























<table><thead><tr><th>原问题</th><th>优化方案</th></tr></thead><tbody><tr><td>语言包体积膨胀</td><td>路由级分片+按需加载，配合 Tree-Shaking 移除未使用词条</td></tr><tr><td>缓存更新不及时</td><td>版本号比对 + WebSocket 推送更新通知</td></tr><tr><td>存储超限风险</td><td>LRU 淘汰策略+IndexedDB 容量监控，超限自动清理低频语言包</td></tr><tr><td>前后端数据冲突</td><td>统一语言服务API，前端通过<code>Accept-Language</code>传递上下文</td></tr></tbody></table>
<p>这种架构已在微策略、字节跳动等企业验证，可使新增语言的配置时间从 3 天缩短至 2 小时，翻译更新周期从周级降至分钟级。核心是将国际化从 "开发任务" 转变为 "配置项"，让开发者专注业务逻辑而非翻译维护。</p>
<h2 data-id="heading-6">主题设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
主题设计---&gt;mode["浅色、深色模式"]
mode---&gt;baseMode["基础模式，维护一套主题色和与之对应的深色主题色"]
主题设计---&gt;theme["主题模式"]
theme---&gt;themeTips["暂不实现，但实现基础模式时应支持快速扩展到主题模式"]
baseMode---themeFunction["维护一套通用变量：基础色、扩展色、圆角、padding、字体、尺寸、层级等"]
themeTips---&gt;themeFunction
themeFunction---&gt;init["前端初始化加载，取系统浅色、深色模式"]
init---&gt;用户切换
用户切换---&gt;cache["本地持久缓存，不因账号变更而清空"]
cache---&gt;extend["扩展：支持远控配置，根据不同国家风格显示、无障碍"]
</code></pre>
<h2 data-id="heading-7">配置化设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
配置化设计---&gt;用户本地个性化配置
用户本地个性化配置---&gt;localStorage["本地持久缓存配置，用户退出不清空"]
localStorage---localStorageEG["主题、语言、表格列配置等"]
localStorageEG---&gt;localStorageHint["结构设计合理，便于后续接入用户账号配置"]---&gt;version
配置化设计---&gt;用户账号配置
用户账号配置---&gt;accoutConfig["与用户账号关联的配置，比如：部分营销活动的推送开关、通知勿扰时段、用户头像等"]---&gt;version
配置化设计---&gt;set["组、角色、公司、平台、服务商配置"]
set---&gt;针对一组用户的配置
针对一组用户的配置---&gt;根据不同组的需求进行的配置---&gt;version["版本控制"]
配置化设计---&gt;通用配置
通用配置---&gt;polipry["配置优先级: 个人 &gt; 组 &gt; 系统默认配置"]---&gt;version
</code></pre>
<blockquote>
<p>那么后端如何根据这种配置设计进行后端代码的自适应呢？比如设置了某个组使用美西时区进行时间字段的格式化，或配置某些角色拥有查看用户完整电话的权限（与权限等其他设计关联）？或某个用户配置了当前时间的 晚上 9 点到早上 8 点不希望推送通知；如何在代码层面做好这些功能，而不必书写命令式的编程</p>
</blockquote>
<p>要实现后端代码的 “配置自适应”，核心思想是将 <strong>“硬编码逻辑” 转变为 “数据驱动逻辑”</strong>。</p>
<p>你提到的时区转换、字段脱敏、通知拦截，分别对应了后端处理链路中的三个关键环节：<strong>序列化层、AOP/中间件层、业务逻辑层</strong>。</p>
<p>以下是实现这些自适应功能的后端代码方案：</p>
<ol>
<li>
<p>时区自适应：上下文感知转换（序列化层）</p>
<p>不要在业务代码里手动转换时区。利用 Web 框架的拦截器，将配置的时区注入到当前请求的 <code>ThreadLocal</code>（上下文）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong></p>
<ol>
<li><strong>拦截器提取：</strong> 在请求入口处（Interceptor/Filter），根据配置引擎获取该组/用户的时区（如 <code>America/Los_Angeles</code>）。</li>
<li><strong>上下文存储：</strong> 存入 <code>UserContext</code>。</li>
<li><strong>JSON 序列化器适配：</strong> 自定义 Jackson/Fastjson 序列化器，在返回 Date 字段时动态读取上下文时区。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 定义上下文</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;ZoneId&gt; ZONE_ID = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setZone</span><span class="hljs-params">(ZoneId zone)</span> { ZONE_ID.set(zone); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ZoneId <span class="hljs-title function_">getZone</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> ZONE_ID.get() != <span class="hljs-literal">null</span> ? ZONE_ID.get() : ZoneOffset.UTC; }
}

<span class="hljs-comment">// 2. 自定义日期序列化器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurableDateSerializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JsonSerializer</span>&lt;LocalDateTime&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(LocalDateTime value, JsonGenerator gen, SerializerProvider serializers)</span> {
        <span class="hljs-comment">// 自动根据配置转换时区</span>
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedDateTime</span> <span class="hljs-operator">=</span> value.atZone(ZoneOffset.UTC).withZoneSameInstant(UserContext.getZone());
        gen.writeString(zonedDateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME));
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>字段权限自适应：声明式脱敏（注解驱动）</p>
<p>对于“查看完整电话”的需求，这属于 <strong>配置化脱敏</strong>。将配置设计映射到权限框架（如 Shiro/Spring Security）中。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
使用自定义注解配合 AOP（切面）或 返回值拦截。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@SensitiveMask(type = MaskType.PHONE, permissionConfig = "view_full_phone")</span>
    <span class="hljs-keyword">private</span> String phoneNumber;
}

<span class="hljs-comment">// AOP 处理逻辑</span>
<span class="hljs-meta">@Around("execution(* *(..)) &amp;&amp; @annotation(SensitiveMask)")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">maskData</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
    <span class="hljs-comment">// 1. 获取当前用户聚合配置中的 'view_full_phone' 开关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">canSee</span> <span class="hljs-operator">=</span> ConfigEngine.getBoolean(<span class="hljs-string">"view_full_phone"</span>);
    
    <span class="hljs-comment">// 2. 如果配置为 false，则执行正则脱敏 (138****0000)</span>
    <span class="hljs-keyword">if</span> (!canSee) {
        <span class="hljs-keyword">return</span> maskHelper.apply(result);
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>通知拦截自适应：策略模式 + 过滤器链（逻辑层）</p>
<p>对于 “晚上 9 点到早上 8 点不推送” 这种基于逻辑判断的配置，建议采用 <strong>“策略插件”</strong> 模式。</p>
<ul>
<li>
<p><strong>实现方案：</strong>
定义一个通知过滤器接口，业务代码只管发送通知，由过滤器决定是否 “丢弃” 或 “延迟”。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span>;
}

<span class="hljs-comment">// 时间窗口策略实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeWindowFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NotificationFilter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSend</span><span class="hljs-params">(User user, Notification content)</span> {
        <span class="hljs-comment">// 从聚合配置获取用户设置：{ "quiet_start": "21:00", "quiet_end": "08:00" }</span>
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> ConfigEngine.getUserConfig(user.getId());
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalTime.now(config.getZoneId());
        
        <span class="hljs-keyword">if</span> (isInQuietPeriod(now, config)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 拦截发送</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// 业务调用层 (非常简洁)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNotice</span><span class="hljs-params">(String userId)</span> {
    <span class="hljs-type">Notification</span> <span class="hljs-variable">notice</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>(<span class="hljs-string">"活动提醒"</span>);
    <span class="hljs-comment">// 自动遍历所有配置策略，只有全部通过才发送</span>
    <span class="hljs-keyword">if</span> (notificationService.evaluate(userId, notice)) {
        pusher.send(notice);
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>核心：自适应代码架构的三个原则</p>
<ol>
<li><strong>配置注入（Contextualization）：</strong>
通过拦截器将当前请求涉及到的所有层级配置（用户、组、平台）聚合后，放入 <strong>Request Context</strong>。后续所有代码只需从 Context 取值，不要再去查数据库。</li>
<li><strong>非侵入性（Non-Invasive）：</strong>
尽量使用 <strong>注解（Annotation）</strong>、<strong>过滤器（Filter）</strong> 或 <strong>中间件</strong>。业务逻辑代码应该写成：<code>saveOrder(order)</code>，而不是 <code>if (config == 'A') { saveA } else { saveB }</code>。</li>
<li><strong>默认行为（Fallthrough）：</strong>
在代码层面，必须为每种配置项定义 <strong>Default Value</strong>。当后端配置系统宕机或数据丢失时，系统应能回退到最保守的默认行为（如：默认脱敏、默认使用系统时区）。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-8">总结</h3>
<p>要实现后端 “自适应”，你需要在 <strong>数据的出口（序列化）</strong>、**访问的关卡（AOP）**和 <strong>逻辑的入口（过滤器）</strong> 设置配置挂钩点。这样，业务逻辑保持纯净，所有的差异化表现都由 “配置感知组件” 自动完成。</p>
<h2 data-id="heading-9">权限设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
权限设计---&gt;RBAC
RBAC---&gt;用户
RBAC---&gt;用户组
RBAC---&gt;角色
RBAC---&gt;权限
用户---&gt;拥有一个或多个相关角色
用户组---&gt;group["一组用户的集合，赋予组内用户相同的角色"]
角色---&gt;拥有一组与当前角色关联的权限
权限---&gt;permission["菜单、按钮、数据、字段权限"]
拥有一组与当前角色关联的权限---&gt;exclude["角色互斥：避免同一用户获得相斥的角色"]
拥有一组与当前角色关联的权限---&gt;level["角色分级，上级拥有下级所有权限"]
level---&gt;manager["分发管理压力"]
manager---&gt;create["上级角色创建下级角色、分发下级角色权限"]
manager---&gt;user["上级用户创建下级用户、分发下级用户角色"]
create---&gt;subclass["下级是上级的子集，下级角色、权限不能超过上级角色、权限"]
user----&gt;subclass
permission---&gt;permissionExtend["扩展"]
permissionExtend---&gt;minPermission["最小权限原则: 只分配工作必须的最小权限"]
permissionExtend---&gt;review["审计系统"]
</code></pre>
<hr/>
<p>要在代码中稳健地适配权限体系，避免因漏洞导致权限异常，关键在于将安全思维渗透到从前端到后端，再到数据层的每一个环节，并遵循严格的安全编码规范。下面我将从 <strong>权限校验的完整链条</strong> 和 <strong>安全编码的核心原则</strong> 两个方面，为您提供一个详实的方案。</p>
<h3 data-id="heading-10">🔒 构建全方位的权限校验链条</h3>
<p>一个健壮的权限体系需要在三个层面进行校验，形成纵深防御。</p>

























<table><thead><tr><th align="left">层级</th><th align="left">核心任务</th><th align="left">关键实现点与常见方案</th></tr></thead><tbody><tr><td align="left"><strong>前端界面层</strong></td><td align="left"><strong>提升用户体验</strong>，根据权限动态展示或隐藏界面元素（菜单、按钮、页面），实现 “可见即可操作”。</td><td align="left">• <strong>统一权限钩子/函数</strong>：封装权限判断逻辑，如定义一个 <code>usePermission(code)</code> 的钩子，在组件中调用 <code>const canEdit = usePermission('user:edit')</code>，再通过 <code>v-if</code> 或条件渲染控制元素。<br/>• <strong>路由守卫</strong>：在进入页面前校验用户是否有该页面权限，无权限则重定向到 403 页面。<strong>注意：前端校验仅为友好性设计，不可依赖为安全屏障。</strong></td></tr><tr><td align="left"><strong>后端 API 层</strong></td><td align="left"><strong>核心安全防线</strong>，对每一个 API 请求都必须进行严格的权限校验。</td><td align="left">• <strong>注解/装饰器（推荐）</strong>：在 API 入口方法上添加如 <code>@PreAuthorize("hasPermission('order', 'delete')")</code> 的注解，利用 AOP 在方法执行前自动拦截校验。<br/>• <strong>中间件/拦截器</strong>：定义全局权限拦截器，对请求路径进行匹配和鉴权。<br/>• <strong>服务内校验</strong>：在业务方法内部显式调用权限服务进行校验。<strong>此层校验必须执行，防止恶意绕过前端直接调用 API。</strong></td></tr><tr><td align="left"><strong>数据访问层</strong></td><td align="left"><strong>实现数据权限</strong>，控制用户能访问哪些数据记录（行级）或字段（列级）。</td><td align="left">• <strong>SQL 自动注入</strong>：在 ORM 框架或 SQL 生成阶段，自动拼接数据过滤条件（如 <code>WHERE department_id = ?</code>）。这是最高效的方式，避免先查出所有数据再在内存中过滤。<br/>• <strong>字段权限控制</strong>：在返回数据前，根据规则对实体的特定字段进行脱敏或过滤。</td></tr></tbody></table>
<h3 data-id="heading-11">️ 遵循安全编码核心原则</h3>
<p>在编写权限相关代码时，请时刻牢记以下几项基本原则。</p>
<ol>
<li>
<p><strong>最小权限原则 (Principle of Least Privilege)</strong></p>
<p>这是权限设计的黄金法则。应确保应用程序的运行账户、数据库连接账户以及分配给用户的权限，都是其完成操作所必需的 <strong>最小权限集合</strong>。例如，一个用于查询的报告服务，绝不应被授予<code>DELETE</code> 或 <code>ALTER</code> 等高危权限。</p>
</li>
<li>
<p><strong>输入验证与输出编码</strong></p>
<ul>
<li>
<p><strong>永不信任用户输入</strong>：所有来自客户端的参数，如用户 ID、资源 ID，都必须经过严格验证。检查其类型、格式、长度和范围，防止 SQL 注入或越权攻击。<strong>优先使用白名单验证</strong>，只允许已知安全的输入。</p>
</li>
<li>
<p><strong>安全地处理输出</strong>：将数据输出到前端时，要根据上下文（HTML, SQL, JavaScript）进行编码，防止 XSS 攻击。例如，将 <code>&lt;</code> 编码为 <code>&amp;lt;</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>默认拒绝与错误处理</strong></p>
<ul>
<li>
<p>权限检查逻辑应采用 <strong>默认拒绝</strong> 策略。即，当权限规则无法明确允许时，应直接拒绝请求。</p>
</li>
<li>
<p><strong>错误处理要谨慎</strong>：向用户返回通用的错误信息（如 “操作失败”），而 <strong>不要泄露详细的系统错误堆栈、SQL语句或文件路径</strong>，以免为攻击者提供线索。</p>
</li>
</ul>
</li>
<li>
<p><strong>管理依赖与安全更新</strong></p>
<p>及时更新项目中用于权限管理或安全相关的第三方库（如 Spring Security、Shiro，或专门的授权服务如 Permify），以避免使用含有已知漏洞的旧版本。</p>
</li>
</ol>
<h3 data-id="heading-12">⚠️ 重点规避的常见陷阱</h3>
<ul>
<li>
<p><strong>越权漏洞</strong>：这是最危险的漏洞之一，包括 <strong>水平越权</strong>（能操作不属于自己的数据，如用户 A 能修改用户 B 的数据）和 <strong>垂直越权</strong>（低权限用户能执行高权限操作）。防范的关键在于，API 中不仅要校验用户是否有操作权限，还必须校验当前操作的数据 ID 是否属于该用户授权的数据范围。</p>
</li>
<li>
<p><strong>前端权限幻觉</strong>：绝不能仅依赖前端隐藏按钮来控制权限。恶意用户完全可以跳过页面直接调用API，因此 <strong>后端必须对每个请求进行二次校验</strong>。</p>
</li>
<li>
<p><strong>性能瓶颈</strong>：权限校验是高频操作，要避免每次请求都执行复杂的数据库关联查询。解决方案是将用户的权限列表缓存在 Redis 等高性能缓存中，权限变更时刷新缓存即可。</p>
</li>
</ul>
<h3 data-id="heading-13">💎 总结与检查清单</h3>
<p>为了帮助您在开发过程中自查，可以对照以下清单：</p>





















<table><thead><tr><th align="left">阶段</th><th align="left">检查项</th></tr></thead><tbody><tr><td align="left"><strong>设计阶段</strong></td><td align="left">□ 是否遵循了最小权限原则？<br/>□ 是否明确了数据权限的规则（如基于部门、基于用户）？</td></tr><tr><td align="left"><strong>编码阶段</strong></td><td align="left">□ <strong>每个 API</strong> 是否都进行了权限校验？<br/>□ 操作数据时，是否校验了用户与数据项的归属关系？<br/>□ 是否对所有用户输入进行了验证？<br/>□ 错误信息是否避免了敏感信息泄露？</td></tr><tr><td align="left"><strong>测试阶段</strong></td><td align="left">□ 是否进行了越权测试（尝试用不同账号操作他人数据）？<br/>□ 是否测试了无权限、部分权限、全部权限等各种场景？</td></tr></tbody></table>
<p>最后，权限安全是一个持续的过程。建议引入 <strong>安全代码扫描工具</strong>（SAST）进行静态检查，并建立完善的 <strong>操作审计日志</strong>，记录所有关键的权限变更和敏感操作，以便事后追溯和分析。</p>
<p>希望这份详细的指南能帮助您在代码中构建一个坚固的权限防护体系。</p>
<h2 data-id="heading-14">文件服务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
文件服务设计---&gt;文件服务---&gt;COS
COS---&gt;COSApi["COS API"]
COS---&gt;目录分类
目录分类---&gt;临时文件---&gt;过期删除
目录分类---&gt;非高频访问文件---&gt;定时归档
文件服务---&gt;assertCOS["抽象对 COS 的访问"]
assertCOS---&gt;logic["在 COS 目录结构上抽象逻辑上的结构"]
logic---&gt;basic["基础结构: 文件 ID、文件业务类型（依据此字段选择 COS 目录）、文件名称、创建时间、更新时间、过期时间、COS 引用（URL）"]
basic---&gt;过期标记删除
assertCOS---&gt;fileServiceAPI["提供 API"]
logic---&gt;extendStructure["扩展结构：按用户、平台等维度分层（逻辑目录）"]
fileServiceAPI---&gt;后端接入
后端接入---&gt;文件上传
文件上传---&gt;tempUploadURL["动态生成临时上传 URL（COS 侧），指定时间内有效"]
tempUploadURL---&gt;frontURL["前端直接访问此 URL 上传文件（过期刷新）"]
frontURL---&gt;invokeFileService["调用 API 存入文件服务器"]---&gt;fileID["存储文件 ID"]
后端接入---&gt;download["文件下载、访问"]
download---&gt;viewFileID["检索文件 ID"]
viewFileID---&gt;存在---&gt;cosTempURL["COS API 生成临时文件 URL"]
viewFileID---&gt;不存在或标记删除---&gt;removed["提示不存在或已被删除"]
viewFileID---&gt;已被归档---&gt;用户手动解冻
已被归档---&gt;自动解冻
文件服务---&gt;扩展
扩展---&gt;鉴权
扩展---&gt;防盗链
扩展---&gt;秒传---&gt;fastUpload["计算文件 MD5 对比文件"]
扩展---&gt;删除策略---&gt;定时运行---&gt;noMap["COS 文件无对应文件服务实体或被标记删除则删除"]
删除策略---&gt;延迟激活---&gt;waitActive["文件服务存储成功时状态设置为待启用，后端业务成功时刷新文件状态为已启用，否则超时删除"]
</code></pre>
<h2 data-id="heading-15">缓存设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
缓存设计---&gt;持久缓存
持久缓存---&gt;localStorage["用户本地配置（主题、语言等）"]
localStorage---&gt;用户动作触发更新
缓存设计---&gt;临时缓存
临时缓存---&gt;userToken["用户 token、账号绑定配置等"]
userToken---&gt;生命周期内存在
生命周期内存在---&gt;推送更新
缓存设计---&gt;策略缓存
策略缓存---&gt;fallback["IndexDB 优先，回退 localStorage"]
fallback---&gt;normalize["抽象底层，统一接口"]
策略缓存---&gt;maxSize["定义最大值: localStorage、IndexDB 不同"]
maxSize---&gt;watchTime["细分存储模块，存储访问时间、访问次数、数据大小"]
watchTime---&gt;策略删除
策略删除---&gt;threshold["定义阈值：80%"]
策略删除---&gt;clear["清理策略: 计算缓存最近访问率，将访问率低的删除 (LRU 最近最少访问)"]
watchTime---&gt;策略访问
策略访问---&gt;look["内存缓存 &gt; 本地缓存 &gt; cdn 缓存 &gt; 兜底接口"]
look---&gt;cache["刷新本地缓存，缓存空间不足时存内存中，并执行策略删除"]
策略缓存---&gt;扩展
扩展---&gt;创建时间与过期时间定义
扩展---&gt;compress["数据压缩：lz-string"]
扩展---&gt;version["Schema 升级：缓存结构设计，定义缓存版本，清理旧版本"]
扩展---&gt;二级缓存刷新["访问时，发起一个 head 请求判断数据是否更新"]
</code></pre>
<h2 data-id="heading-16">登录鉴权设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
登录鉴权设计---&gt;用户登录
用户登录---&gt;cache["缓存 token、refreshToken"]
登录鉴权设计---&gt;退出登录
退出登录---&gt;logout["调用接口，token、refreshToken 失效"]
cache---&gt;普通接口响应
cache---&gt;tokenTime["Token 有效期较短（分钟或小时计）、RefreshToken 有效期较长（天计）"]
tokenTime---&gt;安全存储
安全存储---&gt;tokenStore["Token 存内存"]
安全存储---&gt;refreshTokenStore["Refresh Token 存 Cookie 并设置 httpOnly 限制修改"]
普通接口响应---&gt;401
401---&gt;refresh["调用 refresh 接口"]
refresh---&gt;success["刷新 Token 与 RefreshToken，回填缓存"]
success---&gt;restart["使用新的 token 继续上次失败请求"]
refresh---&gt;error["非正常响应状态码，强制重新登录、清理用户缓存"]
error---&gt;reback["后台：重新登录后回跳退出前页面"]
restart---&gt;扩展
reback----&gt;扩展
扩展---&gt;singleLogin["预留接口实现单点登录、黑名单等"]
扩展---&gt;sign["绑定浏览器指纹、设备指纹，不同时 Token、Refresh Token 默认失效"]
</code></pre>
<h2 data-id="heading-17">消息通知设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
消息通知设计---&gt;站内通知
消息通知设计---&gt;systemNotify["APP 系统通知"]
站内通知---&gt;后台---&gt;notifyType["通知类型（接口设计时考虑可扩展性便于接入通知接口）"]
站内通知--&gt;APP---&gt;notifyType
systemNotify---&gt;通知权限处理
systemNotify---&gt;通知类型细分
通知类型细分---&gt;允许针对部分场景通知关闭
通知类型细分---&gt;notifyType
notifyType---&gt;系统程序通知---&gt;pargam["语音包更新等用户无感知通知"]
notifyType---&gt;营销通知---&gt;extendMarketing["扩展：后台可配置通知、分流推送"]
notifyType---&gt;普通通知---&gt;非即时反馈通知
notifyType---紧急通知---&gt;urgentNotify["即时反馈通知：系统更新、系统公告、新工单、工单回复、异步任务状态变更"]
urgentNotify---&gt;notifyMode["弹窗、右下角浮窗"]
pargam---&gt;implete["通知实现：通知、已读未读计数、链接跳转、通知 ID 避免重复推送、通知清理"]
extendMarketing---&gt;implete
非即时反馈通知---&gt;implete
urgentNotify---&gt;implete
implete---&gt;接入国际化与时区
接入国际化与时区---&gt;question["问题：服务器主动推送、用户离线情况下如何得知用户本地语言环境、APP 系统通知推送时段"]
</code></pre>
<hr/>
<p>你的消息通知设计框架已覆盖基础功能分类和实现逻辑，但在用户体验、技术适配和商业化平衡上存在明显优化空间。对比喜马拉雅的亿级推送架构与微信订阅消息的合规实践，当前方案缺乏分级推送机制、离线送达保障和精细化用户控制能力，这可能导致高优先级消息被淹没或用户因骚扰关闭通知权限。</p>
<h3 data-id="heading-18">核心优化方向</h3>
<h4 data-id="heading-19">1. <strong>分级推送系统：从"一刀切"到优先级调度</strong></h4>
<p>现有设计将通知简单分为 "紧急/普通/营销"，但未解决资源竞争问题。喜马拉雅通过 <strong>Kafka多Topic优先级队列</strong> 实现消息插队机制，高优先级消息（如工单回复）可通过权重分配获得更多处理资源，避免被低优先级营销消息阻塞。建议：</p>
<ul>
<li>
<p><strong>建立四级优先级体系</strong>：系统级（如账号安全）、业务关键（如新工单）、交互反馈（如评论回复）、营销内容（如活动推广），对应不同推送通道和展示方式</p>
</li>
<li>
<p><strong>动态流量控制</strong>：参考"用户日接收阈值+消息级别"双重过滤，当用户单日接收超过 10 条通知后，仅保留前两级消息</p>
</li>
<li>
<p><strong>场景化展示策略</strong>：紧急通知采用全屏弹窗（需用户确认），普通通知使用悬浮窗（3 秒自动消失），营销内容仅在通知中心展示</p>
</li>
</ul>
<h4 data-id="heading-20">2. <strong>离线推送架构：跨平台送达保障</strong></h4>
<p>当前方案未解决 "用户离线时如何推送" 的关键问题。Android 系统对自启限制趋严，自建保活通道已失效，需接入厂商级推送服务：</p>
<ul>
<li>
<p><strong>国内场景</strong>：集成小米 MIUI 推送、华为 HMS、OPPO Push 等厂商通道，用户离线时通过系统级进程唤醒应用</p>
</li>
<li>
<p><strong>海外场景</strong>：对接谷歌 FCM 服务，需注意设备需安装 GMS 框架且连接海外网络的限制</p>
</li>
<li>
<p><strong>设备状态同步</strong>：APP 启动时上报 uid/deviceId 与推送 token 的绑定关系，通过 Kafka 实时更新设备状态，确保卸载重装后 token 自动刷新</p>
</li>
</ul>
<h4 data-id="heading-21">3. <strong>国际化与本地化：突破语言与时区限制</strong></h4>
<p>针对 "离线用户语言环境获取" 的问题，可采用三级解决方案：</p>
<ul>
<li>
<p><strong>预存储语言偏好</strong>：用户在线时记录其语言设置（如 zh-CN/en-US）和时区信息，存储于用户画像数据库</p>
</li>
<li>
<p><strong>端侧翻译缓存</strong>：关键通知模板（如系统公告）预编译多语言版本，推送时附带语言标签，客户端根据本地设置展示对应版本</p>
</li>
<li>
<p><strong>离线翻译服务</strong>：部署 LibreTranslate 本地化服务，当用户语言设置变更时，通过 API 动态翻译历史通知内容，支持 15 种以上语言互译</p>
</li>
</ul>
<h4 data-id="heading-22">4. <strong>用户控制体系：从被动接收转向主动管理</strong></h4>
<p>参考微信订阅消息的教训（从模板消息强制切换导致开发者强烈反弹），需平衡业务触达与用户体验：</p>
<ul>
<li>
<p><strong>精细化开关设计</strong>：提供"全类型-分类-单业务"三级控制，用户可关闭营销类但保留工单通知，或设置 "工作日 9:00-18:00 免打扰"</p>
</li>
<li>
<p><strong>智能静默机制</strong>：分析用户活跃时段（如夜间 11 点至凌晨 7 点），自动延迟非紧急通知至活跃时段推送</p>
</li>
<li>
<p><strong>订阅式营销</strong>：借鉴微信 "一次性订阅" 模式，营销通知需用户主动点击订阅卡片后才能发送，且每 30 天需重新授权</p>
</li>
</ul>
<h3 data-id="heading-23">技术实现关键点</h3>
<ul>
<li>
<p><strong>推送队列优化</strong>：用 Kafka 替代 RabbitMQ，通过 topic 优先级（如 priority-high/priority-low）和权重拉取（高优先级每次拉取 2 倍消息量）实现动态调度</p>
</li>
<li>
<p><strong>频控存储方案</strong>：采用 ehash 结构（支持 field 级过期的 Redis 扩展），存储 deviceId, msgType, 发送计数 三元组，解决 6 亿设备 ×60+ 业务场景的存储压力</p>
</li>
<li>
<p><strong>链路追踪</strong>：全流程记录消息状态（创建/过滤/发送/送达/点击），通过 Grafana 展示推送到达率、平均延迟等核心指标</p>
</li>
</ul>
<h3 data-id="heading-24">对比行业方案的劣势分析</h3>

























<table><thead><tr><th><strong>维度</strong></th><th><strong>当前设计</strong></th><th><strong>行业最佳实践</strong></th></tr></thead><tbody><tr><td><strong>送达率保障</strong></td><td>依赖 APP 在线状态</td><td>厂商通道+自建长连接双保险（喜马拉雅达 98.7%）</td></tr><tr><td><strong>用户干扰控制</strong></td><td>仅支持部分场景关闭</td><td>动态频控+静默时间+分级展示（微信订阅消息投诉率下降 62%）</td></tr><tr><td><strong>国际化支持</strong></td><td>未解决离线语言适配</td><td>预编译模板+端侧翻译缓存（ntfy 支持 20 种语言）</td></tr></tbody></table>
<h3 data-id="heading-25">落地路径建议</h3>
<ol>
<li><strong>第一阶段（1-2 个月）</strong>：完成优先级队列改造和基础厂商通道集成，重点保障紧急通知送达率</li>
<li><strong>第二阶段（3-4 个月）</strong>：上线用户控制中心和频控系统，支持按业务类型开关通知</li>
<li><strong>第三阶段（5-6 个月）</strong>：接入离线翻译服务和动态场景推送，实现全球化适配</li>
</ol>
<p>需特别注意，Android 各厂商推送 API 差异显著（如华为要求应用签名与开发者账号绑定），建议采用如极光推送等聚合 SDK 降低对接成本。最终目标是建立 "用户无感知高可用，开发者可配置，运营可追溯" 的闭环系统，在保障业务触达的同时将通知点击率提升 30% 以上。</p>
<h2 data-id="heading-26">异步任务设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
异步任务队列设计---&gt;定义通用任务接口
定义通用任务接口---&gt;接入通知接口
接入通知接口---&gt;pushNotify["推送通知"]
pushNotify---&gt;链接任务管理中心
定义通用任务接口---&gt;任务状态
任务状态---&gt;待执行
任务状态---&gt;完成
完成---&gt;成功
完成---&gt;部分成功
任务状态---&gt;失败
任务状态---&gt;进行中---&gt;进度显示
成功---&gt;显示结果
失败---&gt;显示结果---&gt;失败原因
部分成功---&gt;显示结果---&gt;失败部分的失败原因
显示结果---&gt;文本结果
显示结果---&gt;tempUrl["临时文件链接（针对导出场景）"]
显示结果---&gt;nagivate["跳转查询（针对导入订单场景）"]
定义通用任务接口---&gt;任务优先级
任务优先级---&gt;资源分配权重
任务优先级---&gt;排队策略
定义通用任务接口---&gt;delete["删除、取消任务"]
delete---&gt;release["移除任务队列、释放资源"]
异步任务队列设计---&gt;扩展---配置不同任务类型的自动删除时长
扩展---&gt;失败重试次数
</code></pre>
<h2 data-id="heading-27">自动更新设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动更新设计---&gt;version["编译打包、版本信息写入"]
version---&gt;推送更新
推送更新---&gt;WEB---&gt;弹窗提示刷新
推送更新---&gt;APP
APP---&gt;热更新
热更新---&gt;静默下载
静默下载---&gt;提示更新
提示更新---&gt;同意---&gt;热替换---&gt;重启应用
提示更新---&gt;拒绝---&gt;下次启动更新
APP---&gt;全量更新
全量更新---&gt;强制---&gt;阻塞弹窗---&gt;引导跳转应用商店
全量更新---&gt;非强制---&gt;弹窗提示---&gt;同意更新---&gt;跳转应用商店
弹窗提示---&gt;拒绝更新---&gt;关闭弹窗
自动更新设计---&gt;扩展
扩展---&gt;灰度发布
</code></pre>
<h2 data-id="heading-28">自动化部署设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
自动化部署设计---&gt;代码推送
代码推送---&gt;webhook
webhook---&gt;scanError["静态安全扫描和依赖项漏洞扫描"]
webhook---&gt;review["代码审查"]
scanError---&gt;测试用例自动化测试
webhook---&gt;测试用例自动化测试
review---&gt;测试用例自动化测试
测试用例自动化测试---&gt;持续交付部署
持续交付部署---&gt;dev["开发、测试环境"]
dev---&gt;定时触发
dev---&gt;自动触发
定时触发---&gt;customPushHook["自定义 hook"]
自动触发---&gt;customPushHook
customPushHook---&gt;同步国际化语言数据
持续交付部署---&gt;prod["生产环境：手动部署"]
prod---&gt;customDeployHook["触发 hook"]
customDeployHook---&gt;同步测试环境必要配置
customDeployHook---&gt;updateContent["提取 commit 更新内容"]
持续交付部署---&gt;扩展
扩展---&gt;部署日志
扩展---&gt;失败通知
dev---&gt;版本管理
prod---&gt;版本管理
版本管理---&gt;imageGenerate["镜像生成: 版本 tag"]
版本管理---&gt;部署失败自动回滚
版本管理---&gt;系统监控异常自动回滚
</code></pre>
<h2 data-id="heading-29">组件设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
组件设计---&gt;可扩展性
可扩展性---&gt;样式结构可扩展
可扩展性---&gt;外部可控制逻辑
组件设计---&gt;高内聚---&gt;完成一件事所用到的代码内聚在组件中
组件设计---&gt;可靠性---&gt;基准测试
可靠性---&gt;性能测试
组件设计---&gt;兼容更新---&gt;old["旧有外部接口、调用方式不变"]
组件设计---&gt;可读性与文档说明---&gt;代码注解与文档
</code></pre>
<hr/>
<p>您的组件设计涵盖了软件工程的核心原则，但在现代前端或全栈组件化开发中，还可以从 <strong>生命周期管理、状态驱动、容错性、以及国际化/文化适配</strong> 四个维度进一步深化。</p>
<p>以下是针对您 Mermaid 架构的优化建议和改进点：</p>
<ol>
<li>架构逻辑优化：从 “设计原则” 到 “实现机制”</li>
</ol>
<p>您原有的设计偏重于 “目标”，建议增加 <strong>“机制层”</strong>，使组件不仅 “可靠”，而且 “可预测”。</p>
<p>优化建议：</p>
<ul>
<li><strong>状态驱动 (State-Driven)</strong>：组件的 UI 应该是状态的函数，减少直接的 DOM 操作或逻辑耦合。</li>
<li><strong>防御式设计 (Robustness)</strong>：除了测试，组件应具备自愈能力（如 Error Boundary）。</li>
<li><strong>解耦策略</strong>：将“业务逻辑”与“渲染组件”分离（容器组件与展示组件模式）。</li>
</ul>
<hr/>
<ol start="2">
<li>改进后的 Mermaid 架构图</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
    组件设计 --&gt; 可扩展性
    组件设计 --&gt; 高内聚低耦合
    组件设计 --&gt; 可靠性与健壮性
    组件设计 --&gt; 演进式维护
    组件设计 --&gt; 体验与规范

    
    可扩展性---&gt;样式结构可扩展 --&gt; CSSVars["CSS 变量控制 (Themeable)"]
    可扩展性---&gt;外部可控制逻辑 --&gt; Hooks["插槽(Slots/RenderProps) 与 Hook 注入"]

    高内聚低耦合---&gt;完成一件事所用到的代码内聚在组件中 --&gt; 逻辑收拢
    逻辑收拢 --&gt; 职责单一["单一职责原则 (SRP)"]
    逻辑收拢 --&gt; 状态隔离["内部状态与外部 Props 严格区分"]

    可靠性与健壮性---&gt;基准测试 --&gt; 单元测试与集成测试
    可靠性与健壮性---&gt;性能测试 --&gt; 渲染频率监测与内存泄漏检查
    可靠性与健壮性---&gt;可靠性 --&gt; 容错处理["Error Boundary 与 兜底 UI"]

    演进式维护---&gt;兼容更新 --&gt; 版本隔离["版本化引用 (Semantic Versioning)"]
    演进式维护---&gt;old["旧有接口转换器 (Adapter Pattern)"]

    体验与规范---&gt;代码注解与文档说明 --&gt; Storybook["交互式文档 (Storybook/Docz)"]
    体验与规范 --&gt; 国际化感知["i18n &amp; 文化策略适配 (RTL支持等)"]
    体验与规范 --&gt; 无障碍性["A11y (无障碍访问支持)"]
</code></pre>
<hr/>
<ol start="3">
<li>核心改进点详细说明</li>
</ol>
<p>A. 引入 “适配器模式” 解决兼容更新 (Compatibility)</p>
<p>您提到的 “旧有接口不变” 是核心需求。在代码层面，可以引入 <strong>Adapter（适配器）</strong>：</p>
<ul>
<li><strong>做法</strong>：当组件内部逻辑重构时，不要直接修改原有的 Props 定义。保留旧 Props 入口，并在组件内部将其映射（Mapping）到新逻辑上。</li>
<li><strong>提示</strong>：在开发环境下，对使用旧接口的开发者抛出 <code>console.warn</code> 提示弃用进度，而非直接报错。</li>
</ul>
<p>B. 逻辑扩展：从 “外部控制” 到 “控制反转 (IoC)”</p>
<ul>
<li><strong>优化方案</strong>：除了简单的逻辑控制，提供 “钩子 (Hooks)” 或 “事件回调”。</li>
<li><strong>场景</strong>：如果这是一个文件上传组件，不要只给一个 <code>uploadURL</code> 属性，应该暴露 <code>onBeforeUpload</code>, <code>onProgress</code>, <code>onError</code> 等生命周期钩子，让外部业务能精细化介入。</li>
</ul>
<p>C. 高内聚的延伸：职责单一 (SRP)</p>
<ul>
<li><strong>改进</strong>：确保一个组件只解决一个层面的问题。例如，一个 “带区域分流逻辑的图片组件”，应该拆分为：
<ol>
<li><strong>数据层组件</strong>：负责根据区域分流配置获取正确的图片 URL。</li>
<li><strong>渲染层组件</strong>：纯粹负责显示图片、Loading 态和错误态。</li>
</ol>
</li>
</ul>
<p>D. 增加 “无障碍性 (Accessibility)” 与 “国际化感知”</p>
<p>作为一个优秀的组件设计，应考虑：</p>
<ul>
<li><strong>语义化</strong>：使用正确的 HTML 标签（或 ARIA 属性），确保盲人阅读器可访问。</li>
<li><strong>方向性</strong>：针对中东等地区，组件需支持 <strong>RTL (Right-to-Left)</strong> 布局自适应。</li>
</ul>
<p>E. 性能测试的具体落地</p>
<ul>
<li><strong>基准测试</strong>：不仅是跑通测试用例，还需关注 <strong>Re-render（重复渲染）</strong> 次数。</li>
<li><strong>工具推荐</strong>：集成 React Testing Library 或 Vue Test Utils，并结合 Lighthouse 进行性能评估。</li>
</ul>
<p>总结</p>
<p>您原来的设计已经非常扎实，改进后的版本强化了 <strong>防御式编程（容错）</strong>、版本演进（适配器）以及全球化适配（A11y/i18n）。这种设计能让您的组件在复杂的生产环境（特别是涉及 2025 年多端、多区域的大型项目）中更具生命力。</p>
<h2 data-id="heading-30">APP 轨迹、异常上报设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
app["APP 轨迹、异常上报设计"]---&gt;实时轨迹
app---&gt;异常
实时轨迹---&gt;mustInfo["必备信息: 用户 ID、发生时间、经纬度、当前任务（订单）"]
mustInfo---&gt;定时采集当前经纬度
定时采集当前经纬度---&gt;实时上报---&gt;watch["后台监控、数据分析"]
定时采集当前经纬度---&gt;after["离线缓存，后续上报"]---&gt;watch
after---&gt;question["问题"]
question---&gt;网络持续离线
question---&gt;后台保活
question---&gt;应用未启动
question---&gt;坐标系转换
异常---&gt;errorMustInfo["必备信息：用户 ID、设备信息、发生时间、错误信息、错误栈"]
errorMustInfo---&gt;离线缓存后续上报---&gt;数据分析
</code></pre>
<hr/>
<p>在 2025 年的开发环境下，要实现 “抓取轨迹、绘制地图、路径决策、实时定位、通行时长” 并兼顾 “离线可用”，最成熟的方案是采用 <strong>Google Maps Platform</strong> 的移动端 SDK。</p>
<p>以下是实现这一功能的架构设计与技术选型：</p>
<ol>
<li>核心技术栈</li>
</ol>
<ul>
<li>
<p><strong>实时定位与轨迹抓取：</strong> 使用 <strong>Google Maps SDK (Android/iOS)</strong> 的定位蓝点功能，配合手机原生 GPS 传感器。</p>
</li>
<li>
<p><strong>地图渲染与轨迹绘制：</strong> 通过 <code>Polyline</code> 对象将实时获取的经纬度点连接成线。</p>
</li>
<li>
<p><strong>路径决策与通行时长：</strong> 使用 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fmaps%2Fdocumentation%2Froutes" target="_blank" title="https://developers.google.com/maps/documentation/routes" ref="nofollow noopener noreferrer">Routes API (2025 新版)</a></strong>。它比旧版更轻量，且能返回详细的实时路况（Traffic-aware）和预计到达时间 (ETA)。</p>
</li>
<li>
<p><strong>离线功能：</strong> 依靠 <strong>Google Maps SDK Offline Maps</strong> 或地图瓦片缓存。</p>
</li>
</ul>
<hr/>
<ol start="2">
<li>功能实现细节</li>
</ol>
<p>A. 实时定位与轨迹抓取</p>
<p>程序通过 <code>FusedLocationProviderClient</code> 每隔几秒获取一次经纬度。</p>
<ul>
<li>
<p><strong>实时性：</strong> 结合 <code>LocationRequest</code> 的高精度模式（Priority High Accuracy）。</p>
</li>
<li>
<p><strong>轨迹记录：</strong> 将获取的点存储在本地数据库（如 SQLite/Room），以防网络中断导致数据丢失。</p>
</li>
</ul>
<p>B. 路线决策与通行时长 (Routes API)</p>
<p>在 2025 年，建议调用 <strong>Routes API</strong> 的 <code>computeRoutes</code> 方法：</p>
<ul>
<li>
<p><strong>决策因子：</strong> 可设置 <code>routingPreference</code> 为 <code>TRAFFIC_AWARE_OPTIMAL</code>（实时路况最优），以获取避开拥堵的实时路线。</p>
</li>
<li>
<p><strong>时长预估：</strong> API 会返回 <code>duration</code> 和 <code>staticDuration</code>（无交通拥堵时长），对比两者即可得出延误时间。</p>
</li>
</ul>
<p>C. 离线可用性的处理（关键点）</p>
<p>Google Maps 的官方 SDK 对纯离线开发有一定限制，通常采取以下策略：</p>
<ol>
<li>
<p><strong>预下载地图：</strong> 调用 <code>OfflineTileProvider</code> 或引导用户在 Google 地图 App 中预下载区域地图，SDK 会自动调用本地缓存。</p>
</li>
<li>
<p><strong>离线定位：</strong> GPS 传感器不依赖网络，程序仍能抓取经纬度。</p>
</li>
<li>
<p><strong>离线路由：</strong> 这是一个难点。如果必须在断网时 “重新决策路径”，建议集成开源的 <strong>GraphHopper</strong> 或 <strong>OSRM</strong> 作为离线路由引擎。</p>
</li>
</ol>
<p>D. 实时经纬度上传</p>
<ul>
<li><strong>异步上传：</strong> 使用 <code>WorkManager</code>（Android）在后台运行上传任务。</li>
<li><strong>断网重传机制：</strong> 当网络恢复时，程序应自动从本地数据库读取未上传的轨迹片段，批量补传到你的服务器后端。</li>
</ul>
<hr/>
<ol start="3">
<li>
<p>开发建议与合规性</p>
</li>
<li>
<p><strong>API 成本：</strong> Routes API 按调用次数计费。建议在车辆静止时降低轨迹抓取频率，在路线未偏离时减少重算路径的频率。</p>
</li>
<li>
<p><strong>隐私权限：</strong> 2025 年 iOS 和 Android 对后台位置权限要求极严。你必须在 <code>AndroidManifest.xml</code> 中声明 <code>ACCESS_BACKGROUND_LOCATION</code>，并向用户明确说明收集轨迹的用途。</p>
</li>
<li>
<p><strong>数据纠偏：</strong> 原始 GPS 坐标在城市高楼区会有偏移，建议在绘制和上传前通过 <strong>Roads API</strong> 将轨迹点纠偏到实际道路上。</p>
</li>
<li>
<p>推荐文档链接</p>
</li>
</ol>
<ul>
<li><strong>Android Maps SDK 快速入门</strong></li>
<li><strong>Routes API 迁移与功能指南</strong></li>
<li><strong>WorkManager 处理后台上传任务</strong></li>
</ul>
<h2 data-id="heading-31">PDF 生成设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB;
pdfGenerate["PDF 生成设计"]---&gt;预定义模版
预定义模版---&gt;系统供给数据
系统供给数据---&gt;engine["Electron 插件使用模版引擎（Handlebars、EJS、Pug/Jade）混入数据"]
engine---&gt;printOrGenerate["打印或生成 PDF"]
engine---&gt;pluginUnbind["插件解耦，不处理用户权限验证、模版存储，由后台系统传入"]
printOrGenerate---&gt;back["打印或回传数据流"]
预定义模版---&gt;扩展
扩展---&gt;用户自定义设计
扩展---&gt;模版预览
</code></pre>
<p>--end</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（21）Hibernate的映射文件是什么？]]></title>    <link>https://juejin.cn/post/7591360623469248522</link>    <guid>https://juejin.cn/post/7591360623469248522</guid>    <pubDate>2026-01-04T11:54:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469248522" data-draft-id="7591346773827485722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（21）Hibernate的映射文件是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-04T11:54:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（21）Hibernate的映射文件是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:54:03.000Z" title="Sun Jan 04 2026 11:54:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的映射文件（Mapping File）是用来定义Java类如何映射到数据库表的XML文件。尽管注解方式越来越流行，但映射文件仍然是配置Hibernate映射关系的重要方式之一。在映射文件中，你可以详细配置类与表、属性与列之间的映射关系，并定义一些特定的行为，如主键生成策略、关联关系等。</p>
<h3 data-id="heading-0">映射文件基本结构</h3>
<p>映射文件的基本结构如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
    <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.EntityName"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"table_name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"generation_strategy"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"property_name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"column_name"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- 其他属性或关联关系的映射 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，包括数据库配置、实体类、映射文件和使用Hibernate进行CRUD操作的代码。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射文件配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">实体类 <code>Person</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-4">映射文件 <code>Person.hbm.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">使用Hibernate进行CRUD操作</h3>
<h5 data-id="heading-6">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-7">CRUD操作类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertPerson(sessionFactory);

        <span class="hljs-comment">// 查询数据</span>
        queryPerson(sessionFactory);

        <span class="hljs-comment">// 更新数据</span>
        updatePerson(sessionFactory);

        <span class="hljs-comment">// 删除数据</span>
        deletePerson(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person: "</span> + person.getName());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Queried Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">25</span>);
                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person: "</span> + person.getName() + <span class="hljs-string">", Age: "</span> + person.getAge());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person: "</span> + person.getName());
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性配置以及实体类的映射文件路径。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/domain/Person.hbm.xml"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code></strong>：定义实体类及其属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 属性和方法</span>
}
</code></pre>
</li>
<li>
<p><strong>映射文件 <code>Person.hbm.xml</code></strong>：定义实体类与数据库表及其列的映射关系。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"native"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-comment">// 创建SessionFactory的代码</span>
}
</code></pre>
</li>
<li>
<p><strong>CRUD操作类</strong>：演示了如何使用Hibernate进行插入、查询、更新和删除操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-comment">// CRUD操作方法</span>
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">总结</h3>
<p>Hibernate的映射文件提供了一种配置Java类与数据库表映射关系的方式。通过配置映射文件，可以灵活地定义类与表、属性与列之间的关系，并指定主键生成策略、关联关系等。在配置映射文件之后，可以利用Hibernate的Session进行CRUD操作，实现对数据库的访问和操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验]]></title>    <link>https://juejin.cn/post/7591510742634315839</link>    <guid>https://juejin.cn/post/7591510742634315839</guid>    <pubDate>2026-01-04T15:23:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634315839" data-draft-id="7591510742634266687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验"/> <meta itemprop="keywords" content="前端,后端,代码规范"/> <meta itemprop="datePublished" content="2026-01-04T15:23:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Piper蛋窝"/> <meta itemprop="url" content="https://juejin.cn/user/844050443272557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 有你想不到，也它有做不到 | 2025 年深度使用 Cursor/Trae/CodeX 所得十条经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/844050443272557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Piper蛋窝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:23:57.000Z" title="Sun Jan 04 2026 15:23:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年的今天，我还在奋笔疾书地写着 VS Code + Roo Cline 的评测心得：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUdSThZX69c8CXkEw48Vy_w" target="_blank" title="https://mp.weixin.qq.com/s/UdSThZX69c8CXkEw48Vy_w" ref="nofollow noopener noreferrer">个人评测 | Cursor 免费平替：Roo Cline + DeepSeek-v3/Gemini-2.0 + RepoPrompt AI 辅助编程</a> 。当时的我没有想过：在 2025 年， Roo Cline 会被我迅速淘汰，我也成为了 Cursor 这类 Vibe Coding 工具的稳定用户之一。</p>
<p>站在 2026 年伊始的节点上，审视自己的工作流，发现已经完全被锚定在了如下工具链上：</p>
<ul>
<li>对话工具： ChatGPT 5.2 + Gemini 3 Pro</li>
<li>Vibe Coding ： 工作用 Cursor ，个人学习用 Trae 国际版 + CodeX ，辅以 VS Code + GitHub Copliot</li>
</ul>
<p>其中我仅为 ChatGPT 和 Trae 付过费（ ChatGPT 赠送 CodeX 订阅）， GitHub Copliot 使用的免费额度（每个月可调用次数不多）。</p>
<p>本文中，我把 2025 年一年的经验总结成十条，希望能够引起讨论，共同交流学习。</p>
<h3 data-id="heading-0">（一）聊天 AI 没有被淘汰，某些情况下，它们更好用</h3>
<p>很多朋友在拿到 Cursor 或 Trae 这种 IDE 后，容易养成一种习惯：一头扎进具体的代码文件中，试图用 Tab 和 CMD+K 解决所有问题。但经过这一年的实践，我发现网页版的聊天型 AI 和 IDE 调用的 API 模型是有本质区别的。</p>
<p>首先是模型的可控性。IDE 接入的模型往往为了代码生成做过微调，但在逻辑深度上，ChatGPT 5.2 的 Thinking Extended Thinking 模式或者 Gemini 3 Pro 的推理模式，显然比 Cursor 的 Agent 更加深思熟虑。</p>
<p>更关键的是上下文的管理。当你需要进行宏观架构设计时，IDE 的 RAG 检索有时会显得过于碎片化。我的做法是，利用 <code>git archive --format=zip HEAD -o project.zip</code> 将项目打包。这个命令的好处在于它只打包 Git 追踪的文件，自动排除了 <code>node_modules</code> 和临时数据。把这个压缩包扔给 ChatGPT，它现在的虚拟机能力非常强，可以自行解压、有选择地阅读文件。</p>
<p>相比于在 IDE 里敲敲打打，ChatGPT 这类工具更适合做“顶层设计”。比如技术选型和开发路线制定，它的 Web Searching 能力比 IDE 的 Agent 更广更深；再比如项目初始化，你可以直接让它生成一个包含完整目录结构的 zip 包，甚至顺便画出 mermaid 流程图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12f2c46458d4e1a964a2417ba0055d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=tgCxI0tfvpISS9k3Jnvr9PLRAyE%3D" alt="善于使用分支" loading="lazy"/></p>
<p>而在数学计算和复杂算法推导上，聊天 AI 更是降维打击。我自己研究油气管道调度问题时，就常把原始数据打包上传，利用 ChatGPT 的超长思考时间，结合“分支聊天”策略，同时探索整数规划、动态规划和强化学习三条路线。这种工程实践的第一步，目前的 IDE 还做不到这么好。</p>
<h3 data-id="heading-1">（二）善于使用 workspace 概念，不要浪费类 Cursor 工具的 RAG index</h3>
<p>Cursor 和 Trae 这类工具的核心优势在于云端索引（Index）。简单来说，它们把你的代码“读”了一遍并建立了一个向量数据库。这意味着在 Agent Chat 中，你不需要笨拙地把第 1 行到第 50 行代码复制进去，只需 <code>@</code> 一下相关文件，Agent 就能通过索引理解上下文，既高效又节省 tokens。</p>
<p>但在 Cursor / Trae 似乎忽略了 VS Code 祖传的 <code>workspace</code> 功能，导致 IDE 无法理解多模块项目的关系。Cursor 如果找不到明确的 root 目录，搜索和索引的效果就会大打折扣。</p>
<p>我现在的习惯是构建一个“手动的 workspace”。即使是前后端分离的项目，我也会把它们放在同一个目录下，比如创建一个 <code>_workspace</code> 文件夹，里面包含 <code>.cursorrules</code>、<code>frontend</code>、<code>backend</code> 和 <code>openapi</code> 目录。</p>
<p>不要单独打开 frontend 写前端，直接用 Cursor 打开 <code>_workspace</code>。这样在进行前后端联调时，Cursor 能够同时索引两端的代码，理解接口定义和业务逻辑的关联。你可以在 <code>.cursorrules</code> 中明确这是一个 monorepo，告诉 AI 前端用 pnpm，后端用 Python 3.12，甚至写明“调试前请运行 <code>source ./backend/env/bin/activate</code>”。这些环境上下文的注入，能让 AI 少问很多傻问题，极大地提升一次性代码通过率。</p>
<h3 data-id="heading-2">（三）MCP 、 Rule 还是 Skill ？模型越来越强，这类技术在被淘汰，适合项目的才是最好的</h3>
<p>记得 2024 年末，MCP（Model Context Protocol） 概念火得一塌糊涂。而现在， Claude 也在推广 Skill 。但到了现在，你会发现这些复杂的技巧正在被边缘化。本质原因是模型本身变强了，强到不再需要那么多拐杖。</p>
<p>MCP 虽然可以安全地连接数据库（比如限制只读权限等等），但配置起来依然繁琐，且生态本身的安全性也并非无懈可击。数次尝试后，我发现最朴素的方案反而是最有效的：让 AI 基于你的业务代码，写一套 Python 或 Shell 脚本工具。</p>
<p>比如，与其配置复杂的 MCP 去查询订单，不如让 AI 写一个 <code>scripts/get_order_info.py</code>。这样做的好处显而易见：你自己能用，AI 也能用。当你需要进行复杂测试时，直接告诉 AI：“你可以并行调用 <code>scripts/send_test_orders.py</code> 和 <code>scripts/listen_mock_executions.py</code>”。这其实就是一种定制化的、低成本的 MCP，而且完全掌握在你自己的代码仓库里。当然，记得在运行前检查一下 AI 生成的脚本，安全意识不能丢。</p>
<h3 data-id="heading-3">（四）给出具体的任务， AI 不是我们偷懒的借口，而是我们效率的乘数</h3>
<p>分享一个真实的翻车案例：前段时间有朋友把一份 Word 格式的简历扔给 Cursor，模型选的 Claude Opus 4.5，只给了一句指令：“帮我转成 HTML”。</p>
<p>结果 AI 搞得一团糟。因为它不理解这个 HTML 是要用来做静态展示，还是要部署到某个具体服务中。为了“完成任务”，AI 甚至不知道从哪搞来了一个公有云对象存储的 Token ，把简历里的照片上传到了某个不知名的 OSS 上，想删都删不掉，简直令人啼笑皆非。</p>
<p>这个教训告诉我们，AI 只是工具，决策还得靠人。正确的方式应该是先明确需求：这个 HTML 要放在哪里？是单页静态应用还是嵌入式组件？然后，利用 PLAN 模式或者先问 Chat AI：“我想把 Word 转 HTML，目前有哪些成熟工具？latex2html 还是 pandoc？或者先转 Markdown 再生成 HTML？”</p>
<p>当我们明确了技术路径（比如 Word -&gt; Markdown -&gt; HTML）后，再让 IDE 去执行。AI 是我们效率的乘数，它能把 1 变成 100，但如果我们给出的基数是 0 甚至负数（错误的决策），那结果只能是灾难。Cursor 的 PLAN 模式和 Trae 的 SOLO 模式（生成 <code>.docs/xxx.md</code>）都是很好的辅助思考工具，别为了省事直接蛮干。</p>
<h3 data-id="heading-4">（五）不要过度提示，你说的每个字 AI 都很上心</h3>
<p>在 Prompt Engineering 刚兴起时，我们习惯写一大堆提示词。但在 2025 年，面对更聪明的模型，过度提示反而成了累赘。</p>
<p>比如在中文语境下，我看到很多人喜欢在结尾加一句“请结合上下文修改代码”。这对人类来说是一句废话，但对 AI 来说可能是个干扰。它可能会死板地理解为“结合上面的代码和下面的代码”，然后去运行 <code>grep -C 10</code> 强行读取代码的物理上下行，反而忽略了原本高效的 RAG 索引逻辑。</p>
<p>现在的模型已经足够智能，能理解你的意图。简洁、清晰地描述需求，往往比堆砌“提示词魔法”效果更好。说得越多，模型“幻觉”的空间反而越大。</p>
<h3 data-id="heading-5">（六）提供充足的 context ，还包括操作系统环境和命令行日志</h3>
<p>虽然我们不该啰嗦，但在提供客观事实（Context）上，一定要大方。很多时候 AI 写出的代码跑不通，是因为它根本不知道你在什么环境下运行。</p>
<p>我有一个习惯，在开启复杂任务前，会先把终端里的环境信息甩给它：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
<span class="hljs-built_in">cat</span> /etc/os-release
<span class="hljs-comment"># 如果有报错日志</span>
<span class="hljs-built_in">tail</span> -20f /tmp/dev/server-error.log
</code></pre>
<p>将这些 Terminal 的输出直接粘贴到 Chat 框里，几乎不费什么功夫，消耗的 token 也可以忽略不计，但这对 AI 来说是极其关键的“地面实况”。</p>
<p>虽然 Cursor 宣称会读取 Terminal 输出，但具体的读取时机和触发规则是个黑盒。与其猜它读没读，不如主动喂给它。特别是在处理编译错误或环境依赖问题时，一份完整的日志远比你描述“它报错了”要管用一万倍。</p>
<h3 data-id="heading-6">（七）没有一蹴而就，别人的 rule / prompt 可能并不适合你</h3>
<p>网上流传着各种“神级 Prompt”和“万能 Rule”，但我建议你谨慎复制。模型在进化，工具在迭代，上个月好用的技巧，下个月可能就因为模型权重调整而失效了。</p>
<p>Rule 并不是越复杂越好。你没必要在 Rule 里把常识再强调一遍，比如写上“使用 pnpm 管理项目”就足够了，不需要再废话一句“具体命令请参考 package.json”，模型都懂。</p>
<p>更重要的是，如果你想教会 AI 使用某种内部框架，与其在 Rule 里用自然语言喋喋不休，不如直接把框架的核心代码放进 workspace 里，让它成为索引的一部分。代码本身就是最好的说明书。你的 Rule 应该是随着开发过程动态生长的，而不是一开始就塞进去一堆你自己都没读完的规则。</p>
<h3 data-id="heading-7">（八）无论是模型还是工具，时刻保留多套方案</h3>
<p>在 2025 年，唯一不变的就是变化。我们见证过模型突然“降智”，也遇到过支付渠道突然被切断的情况。</p>
<p>永远不要把所有希望寄托在单一模型上。某些模型就是有它的局限性，比如我有一次遇到一个棘手的前端 CSS 层叠上下文问题，在 ChatGPT 5.2 和 Gemini 3 Pro 上折腾了半天没解决，它们给出的方案总是在原地打转。最后我切到 GitHub Copilot 里的 Claude Opus 4.5，它一眼就看出了问题所在。</p>
<p>无论是 Cursor、Trae 还是 VS Code，无论是 OpenAI 还是 Google，保持工具链的冗余度，是你按时交付的最后一道防线。</p>
<h3 data-id="heading-8">（九）数据安全很重要，记得脱敏重要数据</h3>
<p>AI 行业竞争这么激烈，你很难保证这些 AI 公司为了活下去，不会拿你的数据去“炼丹”。所以，关于 Token、密钥（Secret Key）这类敏感信息，绝对不能交给 AI。</p>
<p>凡是你不敢提交到公共 Git 仓库的内容，也同样不要发给 AI。善用 <code>.cursorignore</code> 等配置文件，把存放密钥的文件屏蔽掉。</p>
<p>但开发又离不开这些密钥，怎么兼顾安全和方便呢？我的做法是让 AI 把所有敏感配置都提取成环境变量，而在 Codespace 之外的地方（比如本地的 <code>~/.bashrc</code>）去实际赋值。如果某个工具必须通过命令行传参（比如 <code>--token xxx</code>），我就让 AI 把这串命令封装成 <code>run.sh</code>，脚本里只写变量名。这样 AI 看到的只是 <code>$MY_SECRET_TOKEN</code>，而真实的密钥永远躺在你本地的硬盘里。你也不想你的 Token 在未来出现在某个糊涂蛋开源项目的 Prompt 示例里吧？</p>
<h3 data-id="heading-9">（十）大力不能出奇迹，不要陷入“只和 AI 聊天”就能解决所有问题的误区</h3>
<p>最后一条，也是最重要的一条：如果 AI 反复几次都解决不了一个问题，请立刻停止对话，动用你自己的脑子。</p>
<p>很多时候，我们容易陷入一种“赌徒心理”，觉得下一次 Prompt 就能修好了。举个我最近开发 Tauri 桌面应用（Rust + Vue3 + Vite）的例子：我在开发环境下（dev），点击按钮可以正常弹出模态框（Modal）；但打包安装后（build），按钮点击就毫无反应。</p>
<p>我换了三个模型，尝试了改 CSS <code>z-index</code>、查 Webview2 兼容性、对比 build/dev 环境变量，甚至让 Agent 在代码里到处打 log，折腾了一晚上都无解。Log 显示逻辑流转一切正常。</p>
<p>最后我实在没招了，在 dev 模式下主动打开了 Webview2 的控制台（Console）。一眼就看到了一个 Main Window 里的报错：<code>i18n</code> 报警，提示某个翻译占位符不能用 <code>@</code>，必须用 <code>{'@'}</code> 转义。这个错误在 dev 模式下只是个 Warning，不影响交互；但在 build 后的生产环境下，它直接阻断了后续 JS 的执行。</p>
<p>这个报错不在后端 Log 里，也不在显眼的终端输出里，AI 自然“看”不到。这提醒我们：AI 再强也只是辅助，作为工程师，排查问题的基本功（比如亲自看一眼控制台）永远不能丢。</p>
<hr/>
<p>2025 年年初，我还写了一篇关于 AI 的使用心得，除了发在咱国内的平台上，还发在了海外的技术论坛 dev.to 上，没有什么反响。</p>
<p>结果我发现，这篇文章被人洗稿了，并且绝大部分内容是原封不动地抄袭过去的。我是在 2025 年 2 月 21 日首发在 dev.to 上，它是在 2025 年 3 月 20 日把文章洗稿发到 generativeai.pub 上的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f08258b389340dc8294d7718fd78690~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=cXxs0zlEIgb6%2F5k%2FKGGv17NXWcE%3D" alt="文章标题都没有修改" loading="lazy"/></p>
<p>除了开头做了微小改动，剩下的正文部分内容基本一致。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4677fe6f98404e9bb89443a03e5a14f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=DsY0ZB42K3y5lSgkCKRq3MxrhyM%3D" alt="我的原文" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20093018a250458faa45fd3d0011ea43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGlwZXLom4vnqp0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768145037&amp;x-signature=GAvlXxtGm9YYpCHm5UnljiEeOU0%3D" alt="抄袭者文章" loading="lazy"/></p>
<p>原文链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fpiperliu%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" target="_blank" title="https://dev.to/piperliu/dont-let-ai-programming-ruin-your-career-treat-them-as-your-interns-not-employees-or-teachers-16bo" ref="nofollow noopener noreferrer">dev.to/piperliu/do…</a></li>
</ul>
<p>抄袭者链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgenerativeai.pub%2Fdont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" target="_blank" title="https://generativeai.pub/dont-let-ai-programming-ruin-your-career-treat-them-as-interns-instead-of-employees-teachers-62e278f4db02" ref="nofollow noopener noreferrer">generativeai.pub/dont-let-ai…</a></li>
</ul>
<p>好消息是：抄袭者的文章有许多点赞与评论，看来我写的文章还是有一定参考价值的。</p>
<p>坏消息是：都说中文互联网是垃圾堆，看起来英文互联网也没有好到哪里去。这对我这个 Hacker News 老读者的冲击有些大。</p>
<p>准备投诉/维权试一试，看看这些国际平台是否真的那么尊重原创与版权。</p>
<p>欢迎关注我，之后有结果了我也会把经历汇总成一篇文章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前注意加工：让你的图表抓住读者的眼球]]></title>    <link>https://juejin.cn/post/7591350620188999686</link>    <guid>https://juejin.cn/post/7591350620188999686</guid>    <pubDate>2026-01-04T15:08:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188999686" data-draft-id="7591510742634233919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前注意加工：让你的图表抓住读者的眼球"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-04T15:08:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前注意加工：让你的图表抓住读者的眼球
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:08:56.000Z" title="Sun Jan 04 2026 15:08:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你走进一个挤满人的房间，朋友向你招手--你几乎立刻就能看到他。</p>
<p>这是因为“招手”这个动作在你的大脑进行深入思考之前，就已经被注意到了。</p>
<p>再比如当你走在熙熙攘攘的大街上，如果所有人穿的都是黑灰色的大衣，而此时有一个人穿着鲜红色的风衣，你会看哪里？</p>
<p>毫无疑问，你的目光会瞬间被那抹红色吸引。</p>
<p>这就是<strong>前注意加工</strong>：我们的大脑能在极短时间内（约200-250毫秒）自动检测到某些视觉特征，而无需我们有意识地去寻找。</p>
<p>在数据可视化中，<strong>前注意加工</strong>就是我们用来引导读者注意力的“视觉魔术”。</p>
<p>通过巧妙地改变颜色、大小、形状等视觉属性，我们可以让图表中的关键信息（如最大值、最小值、异常值）像朋友招手一样“跳出来”，第一时间抓住读者的眼球。</p>
<h2 data-id="heading-0">1. 前注意加工的实用技巧</h2>
<ol>
<li><strong>少即是多</strong>：不要过度使用突出效果，否则会失去焦点</li>
<li><strong>一致性原则</strong>：在整个报告或仪表板中使用相同的突出颜色编码</li>
<li><strong>考虑色盲用户</strong>：避免仅依靠颜色区分，可结合形状、纹理等</li>
<li><strong>上下文相关</strong>：根据数据特点和观众背景选择合适的突出方式</li>
<li><strong>测试效果</strong>：让其他人查看你的图表，确认突出效果是否达到预期</li>
</ol>
<h2 data-id="heading-1">2. 前注意加工实例</h2>
<p>概念介绍完了，下面直接看代码，看看实际情况下如何使用<strong>前注意加工</strong>来提高我们的可视化效果。</p>
<h3 data-id="heading-2">2.1. 突出最大值和最小值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：突出最大值和最小值</span>
<span class="hljs-comment"># 创建数据</span>
np.random.seed(<span class="hljs-number">42</span>)
categories = [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>, <span class="hljs-string">'F'</span>, <span class="hljs-string">'G'</span>, <span class="hljs-string">'H'</span>]
values = np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">100</span>, size=<span class="hljs-number">8</span>)

<span class="hljs-comment"># 找出最大值和最小值的索引</span>
max_idx = np.argmax(values)
min_idx = np.argmin(values)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
bars1 = ax1.bar(categories, values, color=<span class="hljs-string">'lightblue'</span>, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出最大最小值）</span>
colors = [<span class="hljs-string">'lightblue'</span>] * <span class="hljs-built_in">len</span>(values)
colors[max_idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色突出最大值</span>
colors[min_idx] = <span class="hljs-string">'#4ECDC4'</span>  <span class="hljs-comment"># 青色突出最小值</span>

bars2 = ax2.bar(categories, values, color=colors, edgecolor=<span class="hljs-string">'black'</span>)

<span class="hljs-comment"># 在最大值和最小值上添加标签</span>
ax2.text(max_idx, values[max_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最大: <span class="hljs-subst">{values[max_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#FF6B6B'</span>)
ax2.text(min_idx, values[min_idx] + <span class="hljs-number">2</span>, <span class="hljs-string">f'最小: <span class="hljs-subst">{values[min_idx]}</span>'</span>,
         ha=<span class="hljs-string">'center'</span>, fontweight=<span class="hljs-string">'bold'</span>, color=<span class="hljs-string">'#4ECDC4'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5b3cfac63c404bae4e199caaea3ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=JIDdIdb1RTsmPmZg86kopP8HIEg%3D" alt="" loading="lazy"/></p>
<p>左图中，所有柱子都是相同的蓝色，读者需要逐个比较才能找出最大值和最小值。</p>
<p>右图中，最大值用醒目的红色标出，最小值用青色标出，读者一眼就能看到关键数据点。</p>
<p><strong>前注意加工的好处</strong>：就像在人群中为重要人物戴上特别的帽子，读者无需费力寻找就能立即识别关键数据点。</p>
<h3 data-id="heading-3">2.2. 突出异常值</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例2：突出异常值</span>
<span class="hljs-comment"># 创建包含异常值的数据</span>
np.random.seed(<span class="hljs-number">42</span>)
data_normal = np.random.normal(<span class="hljs-number">50</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
data_outliers = np.array([<span class="hljs-number">5</span>, <span class="hljs-number">125</span>, <span class="hljs-number">130</span>])  <span class="hljs-comment"># 异常值</span>
all_data = np.concatenate([data_normal, data_outliers])

<span class="hljs-comment"># 识别异常值（简单方法：超出平均值±2倍标准差）</span>
mean_val = np.mean(all_data)
std_val = np.std(all_data)
outlier_indices = np.where((all_data &lt; mean_val - <span class="hljs-number">2</span>*std_val) | (all_data &gt; mean_val + <span class="hljs-number">2</span>*std_val))[<span class="hljs-number">0</span>]

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
scatter1 = ax1.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=<span class="hljs-string">'gray'</span>, s=<span class="hljs-number">50</span>)
ax1.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax1.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax1.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出异常值）</span>
colors = [<span class="hljs-string">'gray'</span>] * <span class="hljs-built_in">len</span>(all_data)
sizes = [<span class="hljs-number">50</span>] * <span class="hljs-built_in">len</span>(all_data)

<span class="hljs-comment"># 突出异常值</span>
<span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> outlier_indices:
    colors[idx] = <span class="hljs-string">'#FF6B6B'</span>  <span class="hljs-comment"># 红色</span>
    sizes[idx] = <span class="hljs-number">150</span>  <span class="hljs-comment"># 更大</span>

scatter2 = ax2.scatter(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_data)), all_data, alpha=<span class="hljs-number">0.7</span>, c=colors, s=sizes)
ax2.axhline(y=mean_val, color=<span class="hljs-string">'black'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">f'平均值: <span class="hljs-subst">{mean_val:<span class="hljs-number">.1</span>f}</span>'</span>)
ax2.axhline(y=mean_val + <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>, label=<span class="hljs-string">'±2标准差'</span>)
ax2.axhline(y=mean_val - <span class="hljs-number">2</span>*std_val, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">':'</span>, alpha=<span class="hljs-number">0.5</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dae986c53b4fb0ad21e5223e0e7c26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VsBftwhA5%2BeJlU93WsU0Gjv%2BE1o%3D" alt="" loading="lazy"/></p>
<p>左图中，异常值混在普通数据点中，难以立即识别。</p>
<p>右图中，异常值用更大的红色点突出显示，即使数据量很大，读者也能立即注意到这些特殊点。</p>
<p><strong>前注意加工的好处</strong>：就像在平静湖面上标记出涟漪的起源，异常值不再隐藏在数据海洋中，而是成为分析的重点。</p>
<h3 data-id="heading-4">2.3. 突出趋势变化点</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例3：突出趋势变化点</span>
<span class="hljs-comment"># 创建包含趋势变化的时间序列数据</span>
np.random.seed(<span class="hljs-number">42</span>)
time_points = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)
trend_change_point = <span class="hljs-number">45</span>

<span class="hljs-comment"># 分段创建趋势数据</span>
trend1 = <span class="hljs-number">30</span> + <span class="hljs-number">0.5</span> * np.arange(<span class="hljs-number">0</span>, trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, trend_change_point)
trend2 = trend1[-<span class="hljs-number">1</span>] - <span class="hljs-number">0.8</span> * np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">100</span> - trend_change_point) + np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span> - trend_change_point)
data = np.concatenate([trend1, trend2])

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
line1 = ax1.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.8</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 右图：有前注意加工（突出趋势变化点）</span>
line2 = ax2.plot(time_points, data, color=<span class="hljs-string">'gray'</span>, alpha=<span class="hljs-number">0.6</span>, linewidth=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 突出趋势变化区域</span>
ax2.axvspan(trend_change_point-<span class="hljs-number">5</span>, trend_change_point+<span class="hljs-number">5</span>, alpha=<span class="hljs-number">0.3</span>, color=<span class="hljs-string">'#FF6B6B'</span>, label=<span class="hljs-string">'趋势变化区域'</span>)
ax2.scatter(trend_change_point, data[trend_change_point], color=<span class="hljs-string">'#FF6B6B'</span>, s=<span class="hljs-number">200</span>, zorder=<span class="hljs-number">5</span>, label=<span class="hljs-string">'变化点'</span>)
ax2.plot(time_points[:trend_change_point+<span class="hljs-number">1</span>], data[:trend_change_point+<span class="hljs-number">1</span>], color=<span class="hljs-string">'#4ECDC4'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'上升趋势'</span>)
ax2.plot(time_points[trend_change_point:], data[trend_change_point:], color=<span class="hljs-string">'#45B7D1'</span>, linewidth=<span class="hljs-number">3</span>, alpha=<span class="hljs-number">0.8</span>, label=<span class="hljs-string">'下降趋势'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8a2dbd998f5473984e0e6bd5ff15826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=RkX6bbP4BvgBLbvQevTRxvaJcIw%3D" alt="" loading="lazy"/></p>
<p>左图展示了一个完整的趋势线，但变化点不明显。</p>
<p>右图使用不同颜色区分趋势段，并用阴影区域和突出点标记变化区域，使趋势转折一目了然。</p>
<p><strong>前注意加工的好处</strong>：就像在道路地图上标记出转弯处，读者能立即看到趋势变化的关键时刻。</p>
<h3 data-id="heading-5">2.4. 突出特定类别</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例4：突出特定类别</span>
<span class="hljs-comment"># 创建饼图数据</span>
categories = [<span class="hljs-string">"电子产品"</span>, <span class="hljs-string">"服装"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"书籍"</span>, <span class="hljs-string">"其他"</span>]
values = [<span class="hljs-number">25</span>, <span class="hljs-number">18</span>, <span class="hljs-number">22</span>, <span class="hljs-number">15</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>]
highlight_category = <span class="hljs-string">"食品"</span>  <span class="hljs-comment"># 要突出的类别</span>
highlight_idx = categories.index(highlight_category)

<span class="hljs-comment"># 创建图表</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">14</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># 左图：没有前注意加工</span>
colors1 = [<span class="hljs-string">"#FF9AA2"</span>, <span class="hljs-string">"#FFB7B2"</span>, <span class="hljs-string">"#FFDAC1"</span>, <span class="hljs-string">"#E2F0CB"</span>, <span class="hljs-string">"#B5EAD7"</span>, <span class="hljs-string">"#C7CEEA"</span>]
wedges1, texts1, autotexts1 = ax1.pie(
    values, labels=categories, autopct=<span class="hljs-string">"%1.1f%%"</span>, colors=colors1, startangle=<span class="hljs-number">90</span>
)

<span class="hljs-comment"># 右图：有前注意加工（突出特定类别）</span>
<span class="hljs-comment"># 将突出类别的颜色改为醒目的颜色，其他类别用灰度</span>
colors2 = [<span class="hljs-string">"lightgray"</span>] * <span class="hljs-built_in">len</span>(categories)
colors2[highlight_idx] = <span class="hljs-string">"#FF6B6B"</span>  <span class="hljs-comment"># 突出类别用红色</span>

<span class="hljs-comment"># 突出显示：将特定类别"拉出"</span>
explode = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(categories)
explode[highlight_idx] = <span class="hljs-number">0.1</span>

wedges2, texts2, autotexts2 = ax2.pie(
    values,
    labels=categories,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,
    colors=colors2,
    explode=explode,
    startangle=<span class="hljs-number">90</span>,
)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27631577fe6442ff87cb3febe019a2d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=VVXo4UpyLMdw0BnGAD4q02R1Q1g%3D" alt="" loading="lazy"/></p>
<p>左图中，所有类别视觉权重相同，读者需要阅读标签或百分比才能找到特定类别。</p>
<p>右图中，目标类别被"拉出"并用醒目的红色显示，其他类别则用灰色淡化，读者一眼就能看到重点。</p>
<p><strong>前注意加工的好处</strong>：就像在合唱团中为独唱者打上聚光灯，特定类别立即成为视觉焦点。</p>
<p>同样，在绘制<strong>多条折线图</strong>（也就是俗称的“面条图”）时，如果每条线都用高饱和度的颜色，画面会非常混乱，读者不知道该看哪一条。</p>
<p>也可以用上面饼图类似的思路，降低非重点数据的<strong>不透明度</strong>（<code>Alpha</code>）和<strong>线宽</strong>（<code>Linewidth</code>），只保留重点数据的鲜明样式。</p>
<p>这就像舞台上的聚光灯，灯光打在哪里，观众就看哪里。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟时间序列数据</span>
x = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
<span class="hljs-comment"># 生成5条干扰线</span>
lines = [np.sin(x + i) * (<span class="hljs-number">1</span> + i/<span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]
<span class="hljs-comment"># 生成1条重点线（比如这是我们公司的产品）</span>
main_line = np.sin(x) * <span class="hljs-number">2.5</span> + <span class="hljs-number">1</span>

fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">5</span>))

<span class="hljs-comment"># --- 图1：没有前注意加工 ---</span>
<span class="hljs-comment"># 典型的面条图，所有线都在争夺注意力</span>
<span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines):
    ax1.plot(x, line, label=<span class="hljs-string">f'Competitor <span class="hljs-subst">{i}</span>'</span>)
ax1.plot(x, main_line, label=<span class="hljs-string">'Our Product'</span>)

<span class="hljs-comment"># --- 图2：有前注意加工 ---</span>
<span class="hljs-comment"># 策略：弱化背景，突出前景</span>
<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
    ax1.plot(x, line) <span class="hljs-comment"># 左图逻辑</span>
    <span class="hljs-comment"># 右图逻辑：灰色、细线、半透明</span>
    ax2.plot(x, line, color=<span class="hljs-string">'lightgray'</span>, linewidth=<span class="hljs-number">1</span>, alpha=<span class="hljs-number">0.6</span>)

<span class="hljs-comment"># 重点线：深青色、加粗、不透明</span>
ax2.plot(x, main_line, color=<span class="hljs-string">'teal'</span>, linewidth=<span class="hljs-number">3</span>, label=<span class="hljs-string">'Our Product'</span>)

plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b88a68d04722404b8e0a02299f04e02c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768144135&amp;x-signature=BT2qL1g8H2ysRLSUQpqaDEdFmBk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">3. 总结</h2>
<p><strong>前注意加工</strong>是数据可视化中的"视觉语法"，它通过预认知的视觉特征引导读者的注意力。</p>
<p>就像熟练的导游会指出风景中的亮点，有效的数据可视化应该引导读者立即看到数据故事中<strong>最关键</strong>的部分。</p>
<p>数据可视化不仅仅是把数据画出来，更是一场<strong>注意力的管理艺术</strong>。</p>
<ul>
<li><strong>不要让读者的眼睛去“工作”</strong>：如果他们需要花好几秒钟去找最大值，那是我们设计者的失职。</li>
<li><strong>利用对比</strong>：颜色（亮/暗）、大小（大/小）、位置（前/后），这些物理属性的对比能瞬间触发大脑的“系统1”（直觉系统）。</li>
</ul>
<p>下次使用 <code>Matplotlib</code> 绘图时，在 <code>plt.show()</code> 之前，请停下来问自己一个问题：“<strong>我这张图里，最想让读者第一眼看到的是什么？</strong>”</p>
<p>一旦确定了答案，就请大胆地使用上述技巧，把它“推”到读者眼前吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势]]></title>    <link>https://juejin.cn/post/7591348605865885731</link>    <guid>https://juejin.cn/post/7591348605865885731</guid>    <pubDate>2026-01-04T15:50:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865885731" data-draft-id="7591330139083603983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-04T15:50:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java小成"/> <meta itemprop="url" content="https://juejin.cn/user/3614849960783160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3614849960783160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java小成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:50:23.000Z" title="Sun Jan 04 2026 15:50:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 场景复现：那个让我头疼的时刻</h2>
<p>去年，我接手了一个"祖传" Go 项目。打开代码仓库的那一刻，我整个人都不好了——所有代码都塞在一个 <code>main.go</code> 里，足足 3000 多行。想加个功能？先花半小时找代码在哪。想写个单元测试？抱歉，函数全是私有的，而且互相耦合，根本没法单独测。</p>
<p>我当时就在想：<strong>如果当初写这个项目的人，能从第一天就用一个规范的结构，后面的人得少掉多少头发？</strong></p>
<p>后来我开始研究 Go 官方和社区推荐的项目布局，发现其实规则很简单，但很多人就是不知道。于是我写了这个 50 行代码的小 Demo，把 Go 项目结构的精髓浓缩进去。今天，我就带你一起拆解它。</p>
<h2 data-id="heading-1">2. 架构蓝图：上帝视角看设计</h2>
<p>先来看这个项目的目录结构：</p>
<pre><code class="hljs language-csharp" lang="csharp">series/<span class="hljs-number">01</span>/
├── cmd/
│   └── hello/
│       └── main.go        <span class="hljs-meta"># 程序入口，只做 I/O</span>
├── <span class="hljs-keyword">internal</span>/
│   └── reasons/
│       ├── reasons.go     <span class="hljs-meta"># 核心业务逻辑</span>
│       └── reasons_test.go <span class="hljs-meta"># 单元测试</span>
└── go.mod                  <span class="hljs-meta"># 模块定义</span>
</code></pre>
<p>这不是我随便画的，而是 Go 社区广泛认可的<strong>标准项目布局</strong>。我用一张图来展示数据是怎么流转的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 用户层
        A[命令行输入&lt;br/&gt;--name=小明 --lang=go]
    end
    
    subgraph cmd/hello
        B[main.go&lt;br/&gt;解析参数]
    end
    
    subgraph internal/reasons
        C[reasons.go&lt;br/&gt;业务逻辑]
        D[(reasonByLang&lt;br/&gt;map 数据)]
    end
    
    subgraph 输出层
        E[终端输出&lt;br/&gt;格式化结果]
    end
    
    A --&gt; B
    B --&gt;|调用 Reason 函数| C
    C --&gt;|查询| D
    D --&gt;|返回推荐理由| C
    C --&gt;|返回字符串| B
    B --&gt; E
</code></pre>
<p><strong>核心设计思想：关注点分离</strong></p>
<ul>
<li><code>cmd/</code> 目录：放可执行程序的入口。每个子目录对应一个可执行文件。<code>main.go</code> 只负责"接收输入、调用业务、输出结果"，不写任何业务逻辑。</li>
<li><code>internal/</code> 目录：放内部包。这个目录有个<strong>魔法属性</strong>——Go 编译器会强制禁止外部项目 import 这里的代码。这是 Go 语言级别的"私有化"保护。</li>
<li><code>go.mod</code>：Go Modules 的配置文件，声明模块名和 Go 版本。</li>
</ul>
<h2 data-id="heading-2">3. 源码拆解：手把手带你读核心</h2>
<h3 data-id="heading-3">3.1 入口文件：main.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"flag"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"runtime"</span>
    <span class="hljs-string">"strings"</span>
    <span class="hljs-string">"time"</span>

    <span class="hljs-string">"learn-go/series/01/internal/reasons"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    name := flag.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
    lang := flag.String(<span class="hljs-string">"lang"</span>, <span class="hljs-string">"go"</span>, <span class="hljs-string">"关注的语言"</span>)
    flag.Parse()

    lines := []<span class="hljs-type">string</span>{
        fmt.Sprintf(<span class="hljs-string">"你好，%s！"</span>, *name),
        fmt.Sprintf(<span class="hljs-string">"你正在体验：%s"</span>, strings.ToUpper(*lang)),
        fmt.Sprintf(<span class="hljs-string">"今天的结论：%s"</span>, reasons.Reason(*lang)),
        <span class="hljs-comment">// ... 省略部分</span>
    }

    fmt.Println(strings.Join(lines, <span class="hljs-string">"\n"</span>))
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 1 行 <code>package main</code></strong>：Go 规定，可执行程序的入口包必须叫 <code>main</code>，入口函数也必须叫 <code>main()</code>。这是铁律，没得商量。</p>
<p><strong>第 10-11 行 <code>flag.String(...)</code></strong>：这是 Go 标准库提供的命令行参数解析方案。</p>
<blockquote>
<p><strong>知识点贴士：flag 包</strong></p>
<p><code>flag.String("name", "默认值", "帮助说明")</code> 会返回一个 <code>*string</code>（字符串指针），而不是 <code>string</code>。为什么？因为 <code>flag.Parse()</code> 需要在解析完命令行后，把值"写回"到这个变量里。如果返回的是值而不是指针，就没法修改了。</p>
<p>类比 Java：这有点像 Java 里用 <code>AtomicReference</code> 来实现"可变的引用"。</p>
</blockquote>
<p><strong>第 12 行 <code>flag.Parse()</code></strong>：真正执行解析。调用这行之后，<code>name</code> 和 <code>lang</code> 指针指向的值才会被填充。</p>
<p><strong>第 15 行 <code>*name</code></strong>：这里的 <code>*</code> 是<strong>解引用操作符</strong>，意思是"取出指针指向的值"。</p>
<blockquote>
<p><strong>知识点贴士：指针</strong></p>
<p>Go 的指针比 C 简单很多——没有指针运算，只有"取地址 <code>&amp;</code>"和"解引用 <code>*</code>"两个操作。你可以把指针理解为"变量的门牌号"，<code>*</code> 就是"按门牌号找到房间里的东西"。</p>
</blockquote>
<p><strong>第 17 行 <code>reasons.Reason(*lang)</code></strong>：调用 <code>internal/reasons</code> 包里的 <code>Reason</code> 函数。注意这里的 <code>R</code> 是大写的。</p>
<blockquote>
<p><strong>知识点贴士：可见性规则</strong></p>
<p>Go 没有 <code>public</code>/<code>private</code> 关键字。它用一个极简的规则：<strong>首字母大写 = 公开，首字母小写 = 私有</strong>。所以 <code>Reason</code> 能被外部调用，而如果写成 <code>reason</code> 就只能在 <code>reasons</code> 包内部用。</p>
</blockquote>
<h3 data-id="heading-4">3.2 业务逻辑：reasons.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span>

<span class="hljs-keyword">var</span> reasonByLang = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
    <span class="hljs-string">"go"</span>:     <span class="hljs-string">"编译快、部署简单、并发模型清晰，适合做基础设施和服务端。"</span>,
    <span class="hljs-string">"python"</span>: <span class="hljs-string">"生态丰富、验证快，适合数据处理和脚本。"</span>,
    <span class="hljs-string">"java"</span>:   <span class="hljs-string">"工程成熟、生态庞大，适合大型企业级系统。"</span>,
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Reason</span><span class="hljs-params">(lang <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
    key := strings.ToLower(strings.TrimSpace(lang))
    <span class="hljs-keyword">if</span> key == <span class="hljs-string">""</span> {
        key = <span class="hljs-string">"go"</span>
    }
    <span class="hljs-keyword">if</span> reason, ok := reasonByLang[key]; ok {
        <span class="hljs-keyword">return</span> reason
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"先选一个目标场景，再决定语言。Go 适合服务端与工具链。"</span>
}
</code></pre>
<p><strong>逐行解读：</strong></p>
<p><strong>第 5-9 行 <code>var reasonByLang = map[string]string{...}</code></strong>：这是 Go 的 <code>map</code> 类型，相当于 Java 的 <code>HashMap</code> 或 Python 的 <code>dict</code>。</p>
<p>注意这里用的是<strong>包级变量</strong>（定义在函数外面），小写开头意味着它是私有的，外部包访问不到。这是一种常见的"模块内共享数据"的方式。</p>
<p><strong>第 16 行 <code>if reason, ok := reasonByLang[key]; ok</code></strong>：这是 Go 最经典的惯用法之一——<strong>comma ok</strong>。</p>
<blockquote>
<p><strong>知识点贴士：comma ok 惯用法</strong></p>
<p>在 Go 里访问 map，可以用两种方式：</p>
<ul>
<li><code>v := m[key]</code>：如果 key 不存在，返回零值（空字符串、0 等）</li>
<li><code>v, ok := m[key]</code>：<code>ok</code> 是个布尔值，告诉你 key 到底存不存在</li>
</ul>
<p>第二种方式能区分"key 存在但值为空"和"key 根本不存在"，更安全。</p>
</blockquote>
<h3 data-id="heading-5">3.3 单元测试：reasons_test.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"testing"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReason</span><span class="hljs-params">(t *testing.T)</span></span> {
    tests := []<span class="hljs-keyword">struct</span> {
        name <span class="hljs-type">string</span>
        lang <span class="hljs-type">string</span>
        want <span class="hljs-type">string</span>
    }{
        {name: <span class="hljs-string">"default"</span>, lang: <span class="hljs-string">""</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"go"</span>, lang: <span class="hljs-string">"go"</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
        {name: <span class="hljs-string">"python"</span>, lang: <span class="hljs-string">"python"</span>, want: reasonByLang[<span class="hljs-string">"python"</span>]},
    }

    <span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
        t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            <span class="hljs-keyword">if</span> got := Reason(tt.lang); got != tt.want {
                t.Fatalf(<span class="hljs-string">"Reason(%q) = %q, want %q"</span>, tt.lang, got, tt.want)
            }
        })
    }
}
</code></pre>
<p>这是 Go 社区推崇的**表驱动测试（Table-Driven Test）**风格。</p>
<blockquote>
<p><strong>知识点贴士：表驱动测试</strong></p>
<p>核心思想是：把测试用例组织成一个"表格"（切片），然后用循环遍历执行。好处是：</p>
<ol>
<li>新增用例只需要加一行数据，不用写重复的测试代码</li>
<li>测试逻辑集中，一眼就能看出覆盖了哪些场景</li>
<li><code>t.Run()</code> 会给每个用例起名字，失败时能精确定位</li>
</ol>
</blockquote>
<p><strong>第 16 行 <code>for _, tt := range tests</code></strong>：<code>range</code> 是 Go 遍历切片/map 的关键字。<code>_</code> 表示"我不关心索引，只要值"。</p>
<h2 data-id="heading-6">4. 避坑指南 &amp; 深度思考</h2>
<h3 data-id="heading-7">坑 1：忘记调用 flag.Parse()</h3>
<p>如果你删掉 <code>flag.Parse()</code> 这行，程序不会报错，但 <code>*name</code> 和 <code>*lang</code> 永远是默认值。这是个很隐蔽的 Bug。</p>
<h3 data-id="heading-8">坑 2：map 并发读写会 panic</h3>
<p>当前代码里的 <code>reasonByLang</code> 是只读的，没问题。但如果你想在运行时动态添加语言，<strong>千万不要</strong>在多个 goroutine 里同时读写这个 map——Go 的 map 不是并发安全的，会直接 panic。</p>
<p><strong>生产环境怎么办？</strong> 用 <code>sync.RWMutex</code> 加锁，或者用 <code>sync.Map</code>。</p>
<h3 data-id="heading-9">坑 3：internal 目录的"魔法"是编译器强制的</h3>
<p>有些同学以为 <code>internal</code> 只是个命名约定，其实不是。Go 编译器会<strong>硬性禁止</strong>外部模块 import <code>internal</code> 下的包。如果你的项目是个库，想暴露某些包给外部用，就不能放在 <code>internal</code> 里。</p>
<h3 data-id="heading-10">Demo 与生产代码的差距</h3>
<p>这个 Demo 为了教学做了简化，生产环境还需要考虑：</p>
<ol>
<li><strong>错误处理</strong>：当前代码没有任何 <code>error</code> 返回，真实场景要处理各种异常</li>
<li><strong>日志</strong>：用 <code>log</code> 或 <code>slog</code> 包记录关键操作</li>
<li><strong>配置管理</strong>：硬编码的 map 应该改成从配置文件或环境变量读取</li>
<li><strong>优雅退出</strong>：监听系统信号，做资源清理</li>
</ol>
<h2 data-id="heading-11">5. 快速上手 &amp; 改造建议</h2>
<h3 data-id="heading-12">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> series/01
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接运行</span>
go run ./cmd/hello
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，工程师！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:02:19+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 带参数运行</span>
go run ./cmd/hello --name=小明 --lang=python
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，小明！
你正在体验：PYTHON
今天的结论：生态丰富、验证快，适合数据处理和脚本。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:05:54+08:00
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行测试</span>
go <span class="hljs-built_in">test</span> ./internal/reasons -v
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">=== RUN   TestReason
=== RUN   TestReason/default
=== RUN   TestReason/go
=== RUN   TestReason/python
--- PASS: TestReason (0.00s)
    --- PASS: TestReason/default (0.00s)
    --- PASS: TestReason/go (0.00s)
    --- PASS: TestReason/python (0.00s)
PASS
ok      learn-go/series/01/internal/reasons     0.007s
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译成可执行文件</span>
go build -o hello ./cmd/hello
./hello --name=读者
</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-bash" lang="bash">你好，读者！
你正在体验：GO
今天的结论：编译快、部署简单、并发模型清晰，适合做基础设施和服务端。
运行环境：darwin/amd64
Go 版本：go1.25.5
生成时间：2026-01-04T23:07:16+08:00
</code></pre>
<h3 data-id="heading-13">工程化改造建议</h3>
<p><strong>建议 1：加入结构化日志</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"log/slog"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    slog.Info(<span class="hljs-string">"程序启动"</span>, <span class="hljs-string">"name"</span>, *name, <span class="hljs-string">"lang"</span>, *lang)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><code>slog</code> 是 Go 1.21 引入的标准库，支持 JSON 格式输出，方便对接日志系统。</p>
<p><strong>建议 2：配置外部化</strong></p>
<p>把 <code>reasonByLang</code> 改成从 YAML/JSON 文件读取：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"os"</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"encoding/json"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadReasons</span><span class="hljs-params">(path <span class="hljs-type">string</span>)</span></span> (<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    data, err := os.ReadFile(path)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">var</span> m <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>
    err = json.Unmarshal(data, &amp;m)
    <span class="hljs-keyword">return</span> m, err
}
</code></pre>
<p><strong>建议 3：添加版本信息</strong></p>
<p>利用 <code>go build -ldflags</code> 在编译时注入版本号：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Version = <span class="hljs-string">"dev"</span> <span class="hljs-comment">// 会被编译时覆盖</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"版本："</span>, Version)
}
</code></pre>
<p>编译命令：</p>
<pre><code class="hljs language-bash" lang="bash">go build -ldflags <span class="hljs-string">"-X main.Version=v1.0.0"</span> -o hello ./cmd/hello
</code></pre>
<h2 data-id="heading-14">6. 总结与脑图</h2>
<ul>
<li><strong>cmd/ 放入口，internal/ 放私有逻辑</strong>——这是 Go 项目结构的黄金法则</li>
<li><strong>flag 包返回指针</strong>，记得用 <code>*</code> 解引用，别忘了调用 <code>Parse()</code></li>
<li><strong>comma ok 惯用法</strong>（<code>v, ok := m[key]</code>）是安全访问 map 的标准姿势</li>
<li><strong>首字母大小写决定可见性</strong>，这是 Go 独特的"无关键字"设计哲学</li>
<li><strong>表驱动测试</strong>让你的测试代码更简洁、更易维护</li>
</ul>
<p>如果你正准备入坑 Go，不妨把这个 Demo clone 下来，亲手改一改、跑一跑。<strong>看十遍不如写一遍</strong>，这是我这些年最深的体会。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这是OpenTiny与开发者一起写下的2025答卷！]]></title>    <link>https://juejin.cn/post/7591515844866474018</link>    <guid>https://juejin.cn/post/7591515844866474018</guid>    <pubDate>2026-01-05T09:15:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591515844866474018" data-draft-id="7591655106723659776" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这是OpenTiny与开发者一起写下的2025答卷！"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-05T09:15:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这是OpenTiny与开发者一起写下的2025答卷！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:15:21.000Z" title="Mon Jan 05 2026 09:15:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>2025年，前端开发领域迎来智能化转型的浪潮，OpenTiny作为企业级前端开源解决方案的践行者，开始了从组件生态到智能开发平台的跨越式升级。这一年，我们拥抱变化，我们突破创新，我们把“智能化”写进了基因里；这一年，我们持续打磨组件库，我们持续优化低代码，我们持续完善图表、富文本、中后台管理系统等衍生项目；这一年，我们汇聚在HDC、HC大会，走过多个城市，与多位开发者进行深入交流，输出了90+技术文章，只为与大家分享前沿的“前端+AI”经验，沉淀更优质的技术产品，让前端开发更高效。
以下，是OpenTiny与开发者一起写下的2025答卷。</p>
<h2 data-id="heading-1">一、技术演进情况</h2>
<p>1、2025年OpenTiny在开源领域不断扎根，共计发布16个大版本，累计修复800+缺陷问题，新增代码916000+行，共提交2700+个commits，同时有150+外部贡献者参与项目共建，共建次数达1700+人次。<br/>
2、TinyVue 智能组件库在传统组件库基础上，支持在生成式 UI 场景中使用，AI 智能体可以根据用户意图，按需灵活选择 TinyVue 的组件，呈现给用户可视化的效果，并支持实时互动和交互。<br/>
3、TinyEngine智能低代码引擎在25年引入AI能力，结合Web MCP技术能力，持续演进，应用于多个应用系统。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/602eb431828a4777a6a1ca493321bbc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=Tn6Efs8Zkl8%2BFtvnY%2BGsHeZ9DTc%3D" alt="1.PNG" loading="lazy"/></p>
<h2 data-id="heading-2">二、核心里程碑事件</h2>
<p>2025年，<strong>OpenTiny重磅推出OpenTiny NEXT前端智能化解决方案，以生成式UI + WebMCP两大技术为核心</strong>，革新传统前端应用的交互模式，实现“自然语言驱动任务自主完成”的智能化升级，为企业应用智能化改造提供了低成本、高效率的落地路径。</p>
<h3 data-id="heading-3">技术革新：打破人机交互边界</h3>
<p>OpenTiny NEXT的核心创新在于构建了前端应用与AI智能体的标准化交互桥梁。通过WebMCP（Web Model Context Protocol）协议，开发者可将企业前端应用的功能封装为AI智能体可调用的MCP工具，再借助OpenTiny NEXT SDK连接Web Agent Server，让智能体能够精准识别用户意图并自主调用对应功能。相较于传统RPA方案，该技术在执行效率、准确率和成本控制上均实现质的提升，且完全兼容现有MCP生态，无需改动后端API服务及前端人机交互逻辑，大幅降低改造门槛。</p>
<p>了解官网详情：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2F" target="_blank" title="https://opentiny.design/" ref="nofollow noopener noreferrer">opentiny.design/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/270f77234d7545b8875fd0be962357ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=c7wAyF3UF3%2BTjzrUJCrfXyx%2Fa0Q%3D" alt="2.png" loading="lazy"/></p>
<h2 data-id="heading-4">三、线上线下联动，链接全球开发者</h2>
<p>2025年，OpenTiny以“技术交流+实践体验”为核心，构建线上线下联动等多种活动形式，通过行业盛会参与、专题训练营、线上技术分享等多种形式，与全球开发者深度互动，传递开源理念与技术成果。</p>
<h3 data-id="heading-5">HDC开发者大会</h3>
<p>其中HDC 2025作为年度重点活动，OpenTiny围绕前端智能化解决方案设置四大核心环节：专题论坛中，华为云高级前端开发工程师曾令卡发表《基于MCP协议：快速解锁AI操作Web组件》主题分享，深度解析TinyVue智能组件库的实践逻辑；展览展示区通过互动演示吸引300+名开发者、研究人员及企业代表交流；产品体验官活动让开发者亲身感受AI对话框与Web组件的语音/文字交互能力；两场CodeLabs训练营分别聚焦TinyVue智能组件开发与TinyEngine AI搭建能力，助力开发者快速上手实操。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006312976639490e87cfd76321b07103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=3z5oqIh11Zqje%2BfTUJrXMeG8qXg%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-6">HC华为全联接大会</h3>
<p>HC大会正式推出OpenTiny NEXT 企业前端智能解决方案，展台接待人数600+人。</p>
<p>同时在华为云AI工具助力智能化编程Codelabs训练营中：基于企业办公场景，让开发者了解OpenTiny NEXT 实现智能体代替用户操作页面的能力，接待高校开发者100+人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e579083026d042368ef990e1aa2ba2da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=OJuOiESuYYmtr1ZTBDoGM6WxhEY%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-7">GOSIMHANGZHOU2025</h3>
<p>本次活动通过议题分享、展台交流形式参与。引导开发者了解OpenTiny NEXT 企业前端智能化解决方案的核心技术及能力。在本次智能体互联网论坛中，华为Web前端框架专家、OpenTiny项目负责人莫春辉老师以《探索与实践智能体Web应用开发》为题，展开了一场关于下一代Web应用范式的分享。他提出：生成式UI与WebMCP技术的深度融合，将成为未来3-5年Agentic Web应用开发的核心基础设施，动态交互的AI原生应用将加速取代传统静态交互模式，重新定义人机协作边界。除主线演讲外，OpenTiny还设立了互动展位，工程师们系统拆解了OpenTiny NEXT前端智能化解决方案的技术底座：通过设计架构图直观呈现了基础设施层（IaaS）中WebAgent如何作为“连接 Agent 智能体与企业应用内置的 MCP 服务的手臂”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f4b2166e1b94191b46597c6725f0296~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=EXeE9DYdjSlhFSXL1mbETlHX7WU%3D" alt="5.PNG" loading="lazy"/></p>
<h3 data-id="heading-8">西安电子科技大学高校行</h3>
<p>通过参与开源之夏官方组织的高校行活动，对接计算机学院100+名学生，通过议题分享的方式，在线下与学生建立联系，进行TinyVue智能组件库技术布道,建立100+人学生交流群，视频号观看量5000+</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9616ccfeeba4e87ae2dcbe2a7f04928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=JubbMGJ5e%2Bt3Q2YGxw9jYJ44J0s%3D" alt="6.JPG" loading="lazy"/></p>
<h3 data-id="heading-9">开源之夏</h3>
<p>2025年OpenTiny社区参与中国科学院软件研究所发起的暑期编程活动开源之夏2025，创建赛题，吸引多位高校开发者共同参与共建，引导<strong>12个</strong>优秀作品提交至OpenTiny代码库。</p>
<p><strong>结项公示：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fsummer-ospp.ac.cn%2Ffinal%3Fname%3D%26orgName%3DOpenTiny%26pageNum%3D1%26pageSize%3D50%26programName" target="_blank" title="https://summer-ospp.ac.cn/final?name=&amp;orgName=OpenTiny&amp;pageNum=1&amp;pageSize=50&amp;programName" ref="nofollow noopener noreferrer">summer-ospp.ac.cn/final?name=…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28fc966944614a9593b8d203ba4017c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=HakVXEKEQHsSBqi2AqfUvYS3jVs%3D" alt="7.png" loading="lazy"/></p>
<h3 data-id="heading-10">线上体验官活动</h3>
<p>联合开发者联盟上线OpenTiny产品体验官活动，让线上开发者体验项目当前的智能化能力。共引导<strong>74位</strong>开发者报名参与</p>
<p><strong>活动地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huaweicloud.com%2Fsignup%2F4f8b07903ef2415f924e959d4947e5a1" target="_blank" title="https://developer.huaweicloud.com/signup/4f8b07903ef2415f924e959d4947e5a1" ref="nofollow noopener noreferrer">developer.huaweicloud.com/signup/4f8b…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1998aa312ce74e54a45db817637368f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=Jmq4VDl9Mp60ls0lf3AQvhDrJXs%3D" alt="8.png" loading="lazy"/></p>
<h2 data-id="heading-11">四、让“OpenTiny的声音”被世界听见</h2>
<p>持续推进体系化建设，打造系列技术课程。当前已完成《开发者技术实战课程》，《TinyEngine低代码引擎实战教程》、《OpenTiny前端解决方案技术解读》、《OpenTiny开源之夏项目解读》等技术课程，推出90+篇技术文章，包含《TinyVue智能组件库：基于MCP协议实现AI代替人操作Web组件》、《TinyVue表格重构逐帧拆解，虚拟滚动体验大提升！》、《产品经理要“通过大小、时间范围筛选”搜索？我 15 分钟用 SearchBox 交差！》等等。并通过运作12个社媒渠道，整体传播量达96.7W+，并荣获<strong>2025年开源中国共创社区荣誉</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50702f9913884ba199bd9b1b621bb8b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209320&amp;x-signature=4%2BgHRIirmg57wcJ6thmNwqqHikY%3D" alt="9.PNG" loading="lazy"/>
<strong>优质内容推荐：</strong></p>
<ul>
<li><a href="https://juejin.cn/post/7583613222345310234?searchId=20260105170509E261EF13465DCD6B03B6" target="_blank" title="https://juejin.cn/post/7583613222345310234?searchId=20260105170509E261EF13465DCD6B03B6">从千问灵光 App 看生成式 UI 技术的发展</a></li>
<li><a href="https://juejin.cn/post/7571342319893889059?searchId=2026010517052908F01C767848FB940B05" target="_blank" title="https://juejin.cn/post/7571342319893889059?searchId=2026010517052908F01C767848FB940B05">不止按钮和表格！TinyVue 偷偷上线 Space 组件，直接搞定「弹性+间距」布局</a></li>
<li><a href="https://juejin.cn/post/7537306981268340746?searchId=20260105170617C8CB9BA9A29C7D72CEBF" target="_blank" title="https://juejin.cn/post/7537306981268340746?searchId=20260105170617C8CB9BA9A29C7D72CEBF">TinyVue 表格重构逐帧拆解，虚拟滚动体验大提升！</a></li>
<li><a href="https://juejin.cn/post/7531962071404380195?searchId=2026010517063381D4BAFBEA56DA698346" target="_blank" title="https://juejin.cn/post/7531962071404380195?searchId=2026010517063381D4BAFBEA56DA698346">产品经理要“通过大小、时间范围筛选”搜索？我 15 分钟用 SearchBox 交差！</a></li>
<li><a href="https://juejin.cn/post/7565940210149064756?searchId=202601051707011A976552F3B4A6D273BE" target="_blank" title="https://juejin.cn/post/7565940210149064756?searchId=202601051707011A976552F3B4A6D273BE">如何使用 TinyEditor 快速部署一个协同编辑器</a></li>
<li><a href="https://juejin.cn/post/7583707681003454510?searchId=202601051707236BA7E02E06F2B121243F" target="_blank" title="https://juejin.cn/post/7583707681003454510?searchId=202601051707236BA7E02E06F2B121243F">TinyEngine2.9版本发布：更智能，更灵活，更开放！</a></li>
<li><a href="https://juejin.cn/post/7542868304471769128?searchId=20260105170740A321FC1BAAF9A86BCDB4" target="_blank" title="https://juejin.cn/post/7542868304471769128?searchId=20260105170740A321FC1BAAF9A86BCDB4">TinyEngine 2.8 正式上线：AI能力就位、Docker一键起飞！</a></li>
<li><a href="https://juejin.cn/post/7529960877316407332?searchId=202601051708091AE5B637A8BDDFE11266" target="_blank" title="https://juejin.cn/post/7529960877316407332?searchId=202601051708091AE5B637A8BDDFE11266">TinyEngine 2.7 版本发布！注册表功能重大更新，开启低代码新范式</a></li>
<li><a href="https://juejin.cn/post/7519474542933344265?searchId=20260105170832F68A0B215E7139AB76A9" target="_blank" title="https://juejin.cn/post/7519474542933344265?searchId=20260105170832F68A0B215E7139AB76A9">TinyEngine2.6版本焕新发布：实现页面树折叠！设计器 UI 及多项功能点升级！</a></li>
<li>......</li>
</ul>
<p><strong>系列课程：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F15284299%2Flists%2F4944547%3Ftype%3Dseason" target="_blank" title="https://space.bilibili.com/15284299/lists/4944547?type=season" ref="nofollow noopener noreferrer">2025OpenTiny技术分享</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F15284299%2Flists%2F5091846%3Ftype%3Dseason" target="_blank" title="https://space.bilibili.com/15284299/lists/5091846?type=season" ref="nofollow noopener noreferrer">TinyEngine低代码引擎实操教程</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F15284299%2Flists%2F5104619%3Ftype%3Dseason" target="_blank" title="https://space.bilibili.com/15284299/lists/5104619?type=season" ref="nofollow noopener noreferrer">OpenTiny社区开发者技术分享</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F15284299%2Flists%2F5421693%3Ftype%3Dseason" target="_blank" title="https://space.bilibili.com/15284299/lists/5421693?type=season" ref="nofollow noopener noreferrer">OpenTiny开源之夏2025专题</a></li>
<li>......</li>
</ul>
<h2 data-id="heading-12">五、听听你的心里话</h2>
<p>这一年，我们也采访了10+位开发者，了解用户在使用过程中的各种问题与疑惑。开发者们也表示从实际体验可知，相较于以往，页面渲染速度有了显著提升，在开发过程中能明显感知到这一变化。另外，采用TinyVue组件库进行页面开发后，也提高了本地开发的效率和响应速度，整体表现也能看出实用性很强。当然也有开发者提到：希望官方能持续优化，例如文档网站能支持多版本切换功能，让开发者能够便捷查阅不同版本的API，降低版本适配的认知负担。同时，也建议在文档中清晰划分时间节点，提供版本切换入口，以便团队在维护旧项目或升级新版本时更高效地获取对应版本的文档支持等等内容。</p>
<h2 data-id="heading-13">致谢|与开发者同行</h2>
<p>感谢所有社区开发者、企业伙伴、所有粉丝们，是你们的每一行代码、每一次 PR、每一个 Star，让 OpenTiny 从“小而美”走向“强而大”。</p>
<p>同时，也非常感谢所有投稿的开发者，包含Node.js系列文章作者屈金雄、曹杨毅；前端性能优化作者董福俊；字体性能优化作者张庭岑；AI知识科普作者合艳春；TinyVue相关内容作者曾令卡、郑志超、申君健、岑灌铭、刘坤等；TinyEngine相关内容作者伍其和、李锦浩、胡靖、王莉纯、李璇、李坤、观默等；OpenTiny开源之夏项目相关作者周天意、夏雯斐、张筠、张颢严、程锴、龚昱帆、宋子文、王晨光、周泽龙、张珈瑜、申曜枫、曹里林及其导师。</p>
<p>2026，我们继续“用 AI 重新定义前端”，愿与所有开发者携手，让<strong>前端未来</strong>更智能、更开放！</p>
<h2 data-id="heading-14">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～</p>
<p>OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue 源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
TinyEngine 源码： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
欢迎进入代码仓库 Star🌟TinyEngine、TinyVue、TinyNG、TinyCLI、TinyEditor~
如果你也想要共建，可以进入代码仓库，找到 good first issue 标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[腾讯云 PostgreSQL 最佳实践]]></title>    <link>https://juejin.cn/post/7591465142452551732</link>    <guid>https://juejin.cn/post/7591465142452551732</guid>    <pubDate>2026-01-05T09:21:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591465142452551732" data-draft-id="7591439305261842467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="腾讯云 PostgreSQL 最佳实践"/> <meta itemprop="keywords" content="PostgreSQL"/> <meta itemprop="datePublished" content="2026-01-05T09:21:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            腾讯云 PostgreSQL 最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:21:04.000Z" title="Mon Jan 05 2026 09:21:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">腾讯云 PostgreSQL 介绍</h2>
<p>腾讯云 PostgreSQL 是腾讯云基于全球最强大的开源数据库 PostgreSQL 打造的托管数据库服务，让您在云端轻松部署、运行和扩展 PostgreSQL 数据库，无需关心底层运维细节。</p>
<h2 data-id="heading-1">观测云</h2>
<p>观测云是一款专为 IT 工程师打造的全链路可观测产品，它集成了基础设施监控、应用程序性能监控和日志管理，为整个技术栈提供实时可观察性。这款产品能够帮助工程师全面了解端到端的用户体验追踪，了解应用内函数的每一次调用，以及全面监控云时代的基础设施。此外，观测云还具备快速发现系统安全风险的能力，为数字化时代提供安全保障。</p>
<h3 data-id="heading-2">部署 DataKit</h3>
<p>DataKit 是一个开源的、跨平台的数据收集和监控工具，由观测云开发并维护。它旨在帮助用户收集、处理和分析各种数据源，如日志、指标和事件，以便进行有效的监控和故障排查。DataKit 支持多种数据输入和输出格式，可以轻松集成到现有的监控系统中。</p>
<p>登录<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.guance.com%2F" target="_blank" title="https://www.guance.com/" ref="nofollow noopener noreferrer">观测云控制台</a>，在「集成」 - 「DataKit」选择对应安装方式，当前采用 Linux 主机部署 DataKit。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7f06aae26ff49d5b4678d578cee753b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=ikEnP%2FmQofCk6gkY9DUwELUg7Mw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">采集器配置</h3>
<h4 data-id="heading-4">前置准备</h4>
<p>首先我们需要安装用于数据采集的 Func 基础环境，Func 支持多种部署形态，您可根据自身提供的基础设施类型选择对应的安装方式进行Func部署：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffunc.guance.com%2Fdoc%2Fmaintenance-guide-installation%2F" target="_blank" title="https://func.guance.com/doc/maintenance-guide-installation/" ref="nofollow noopener noreferrer">Func 主机部署</a> / <a href="https://link.juejin.cn?target=https%3A%2F%2Ffunc.guance.com%2Fdoc%2Fmaintenance-guide-helm%2F" target="_blank" title="https://func.guance.com/doc/maintenance-guide-helm/" ref="nofollow noopener noreferrer">Kubernetes 部署</a> 。</p>
<p>完成部署后，首次登录 Func 页面会提示进行初始化配置，按提示填写配置信息后，进入 Func 主页。点击连接器，检查连接器配置。这里的连接器是您 Func 向观测云发送数据的上传通道，通常会默认创建两个通道，DataKit 和 Dataway，这里选择的是增加 Dataway 的连接方式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5484b870c8b4ce5ba96c7dad9526d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=owPuuEm6rK%2Bj%2FzLNKA64%2FKLMB8w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">安装采集脚本</h4>
<p>登陆 Func，点击脚本市场，选择官方脚本市场。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4b9ffbbdef0413caf4fe8ddd40bf0e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=DAjYxcJxlIcMQYn9xn24pd2pB00%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f096ae2650e4d1bbafebd9fad864a50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=H7tUjo%2FnBJOD%2Fz0Y3F3UMj3CABM%3D" alt="" loading="lazy"/></p>
<p>搜索 TencentCloud-PostgreSQL，安装脚本，填写相关信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c64fe8b44f94b1b8324b83775dfc4e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=DpZ30jRp2FcVGcA72I7lGS4Hk2U%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1adf30deb108407a9708c717ef3b9364~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=Zme%2FW%2Fv8Gak7cJ83PydPd291yTc%3D" alt="" loading="lazy"/></p>
<p>编辑 dataway_id 为连接器的 id，并且发布脚本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/418463456ef34070b03c1ae3ce79a64c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=utq7VhaPkaGXnDYxPNsrSKL92sY%3D" alt="" loading="lazy"/></p>
<p>查看定时任务已经添加。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/837aee5f2660448f8ae46f6369372a0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=oth5u1hVphvw%2B7xc56euVn6x0Pk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">关键指标</h3>










































































































































































<table><thead><tr><th>指标名</th><th>字段类型</th><th>中文说明</th></tr></thead><tbody><tr><td>2pc_sum</td><td>float</td><td>两阶段提交事务总数</td></tr><tr><td>ActiveConns_max</td><td>float</td><td>最大活跃连接数</td></tr><tr><td>Connections_avg</td><td>float</td><td>平均连接数</td></tr><tr><td>Cpu_max</td><td>float</td><td>CPU使用率峰值(%)</td></tr><tr><td>DataFileSize_max</td><td>float</td><td>数据文件大小峰值(GB)</td></tr><tr><td>Deadlocks_max</td><td>float</td><td>最大死锁次数</td></tr><tr><td>HitPercent_max</td><td>float</td><td>缓存命中率峰值(%)</td></tr><tr><td>IdleConns_avg</td><td>float</td><td>平均空闲连接数</td></tr><tr><td>IdleInXact_max</td><td>float</td><td>事务中空闲连接峰值</td></tr><tr><td>LogFileSize_max</td><td>float</td><td>日志文件大小峰值(GB)</td></tr><tr><td>Long2pc_max</td><td>float</td><td>最长两阶段提交数</td></tr><tr><td>LongQuery_max</td><td>float</td><td>最慢查询耗时(ms)</td></tr><tr><td>LongWaiting_max</td><td>float</td><td>最长等待锁耗时(ms)</td></tr><tr><td>LongXact_max</td><td>float</td><td>最长事务耗时(ms)</td></tr><tr><td>MemoryRate_max</td><td>float</td><td>内存使用率峰值(%)</td></tr><tr><td>Memory_max</td><td>float</td><td>内存使用量峰值(GB)</td></tr><tr><td>NewConnIn5s_max</td><td>float</td><td>5秒内新建连接峰值</td></tr><tr><td>OtherCalls_sum</td><td>float</td><td>其他调用总数</td></tr><tr><td>Qps_max</td><td>float</td><td>最大查询量(QPS)</td></tr><tr><td>ReadCalls_sum</td><td>float</td><td>读调用总数</td></tr><tr><td>ReadWriteCalls_sum</td><td>float</td><td>读写调用总数</td></tr><tr><td>SlowQueryCnt_max</td><td>float</td><td>慢查询数量峰值</td></tr><tr><td>SqlRuntimeAvg_avg</td><td>float</td><td>SQL平均执行时间(ms)</td></tr><tr><td>SqlRuntimeMax_avg</td><td>float</td><td>SQL最大执行时间(ms)</td></tr><tr><td>SqlRuntimeMin_avg</td><td>float</td><td>SQL最小执行时间(ms)</td></tr><tr><td>StorageRate_max</td><td>float</td><td>存储使用率峰值(%)</td></tr><tr><td>TempFileSize_max</td><td>float</td><td>临时文件大小峰值(GB)</td></tr><tr><td>Tps_avg</td><td>float</td><td>平均事务量(TPS)</td></tr><tr><td>Waiting_max</td><td>float</td><td>最大等待会话数</td></tr><tr><td>WriteCalls_sum</td><td>float</td><td>写调用总数</td></tr><tr><td>XactCommit_max</td><td>float</td><td>最大事务提交数</td></tr><tr><td>XactRollback_max</td><td>float</td><td>最大事务回滚数</td></tr></tbody></table>
<h3 data-id="heading-7">场景视图</h3>
<p>登录观测云控制台，点击「场景」 -「新建仪表板」，输入 “腾讯云 PostgreSQL 监控视图”， 选择 “腾讯云 PostgreSQL 监控视图”，点击 “确定” 即可添加视图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/357232f2194741c09b44c681ca6f4831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=Zu6OkgxJyYS61fdcB3OkQ6iZgXQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4d69cc5d5004e1289049053ff8262f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=83qaKHzHg%2FMW78N%2B6sThS3YRi8I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbbaf8a505464d489e37421b4313f1fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=le2c%2BMEdyYI2CY35Ph1t93Sf45s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0276f1d9dc3f40b8bdc8c5f96f9e62da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=BFlmMcuOIMWwj5XpkFRW4T8UiOM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">监控器（告警）</h3>
<p>观测云内置了监控器模板，可以选择从模版创建监控器，并开启适合业务的监控器以及时通知相关成员关注问题，触发条件、频率等信息可以依据实际业务进行调整。</p>
<p>登录观测云控制台，点击「监控」 -「新建监控器」-「官方模板库」，输入 “腾讯云 PostgreSQL”， 选择对应的监控器，点击 “确定” 即可添加。</p>
<h4 data-id="heading-9">腾讯云 PostgreSQLCPU 使用率过高</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/344db852a825432fa7a53a6f722fe762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=Lp9%2B2h2alQl5JfVuJ5bwuhIXirg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f479a0e7e6143cc96293d53580de0fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=eIgCXr6aGYp0l2tHkEyiIXag%2FV8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20daced269aa400cb035343f9afbf7f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=PDi9mQv97FVrEyP%2B%2Bev5wmejUaI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">腾讯云 PostgreSQL 内存使用率过高</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcc154d4e74e48b0bbfd414a2ce412e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=cYlEVOunPNYPqJoyh287G1UtEtM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbcd7f34b75d4619a82dabbd96092aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=vmR6qGVFuP9%2Fbu24nPMS%2FsXojh0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0f30341dd2f4a6c8afd240a9886d8c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768209664&amp;x-signature=BlDuiCqQRleEBiZwZXqjZ6eMT1Y%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">总结</h2>
<p>通过监控腾讯云 PostgreSQL 实例的关键性能指标，如 CPU 使用率（Cpu_max）、内存使用率（MemoryRate_max）以及实例健康状态等，能够全方位掌握腾讯云 PostgreSQL的运行状况，借助对这些核心指标的实时监控与分析，可快速定位资源瓶颈、性能异常及潜在故障，确保稳定的运行状态。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Coding全流程教程——0基础搭建“MEMO”健康打卡全栈Web应用(附提示词)]]></title>    <link>https://juejin.cn/post/7591655106723987456</link>    <guid>https://juejin.cn/post/7591655106723987456</guid>    <pubDate>2026-01-05T09:37:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591655106723987456" data-draft-id="7591465142452600884" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Coding全流程教程——0基础搭建“MEMO”健康打卡全栈Web应用(附提示词)"/> <meta itemprop="keywords" content="AI编程,小程序·云开发,MCP"/> <meta itemprop="datePublished" content="2026-01-05T09:37:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="腾讯云开发CloudBase"/> <meta itemprop="url" content="https://juejin.cn/user/2963939080036493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Coding全流程教程——0基础搭建“MEMO”健康打卡全栈Web应用(附提示词)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939080036493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    腾讯云开发CloudBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:37:18.000Z" title="Mon Jan 05 2026 09:37:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>CloudBase+AI Coding工具搭建一个手机 app 效果的全栈Web应用，全程没写一行代码，灵活修改功能需求和UI效果。</strong></p>
<p>2025年即将过去，在“自律”常令人疲惫的当下，健康管理能否如游戏般轻松上瘾？ MEMO  将目标拆解为“晨起喝一杯温水”这样的原子任务，并创新引入<strong>QQ式等级成长体系——</strong> 支持从星星到皇冠的每次升级，都可以是你坚持的即时正反馈。2026，复刻一个应用，把习惯养成变成一款爱上健康过程的“游戏”吧～</p>
<p>本教程中，我们将结合 <strong>CodeBuddy</strong> 智能编程与 <strong>CloudBase</strong> AI 原生后端一体化平台的服务能力，快速实现一个能自由定制任务和分享他人的自律小游戏。还能直接添加到手机主屏幕，即使是编程新手，也能在 30 分钟内完成，跟着教程开始你的尝试吧！</p>
<p><strong>各类AI Coding工具配置CloudBase指南：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2Fide-setup%2Fcursor" target="_blank" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/ide-setup/cursor" ref="nofollow noopener noreferrer">docs.cloudbase.net/ai/cloudbas…</a>
（包含Cursor 、CodeBuddy、Trae、Qoder、Gemini CLI、OpenAI Codex CLI、Google Antigravity、GitHub Copilot等21个AI Coding工具）</p>
<p><strong>AI开发流程简述：</strong></p>
<ol>
<li>下载CodeBuddy IDE，连接内置CloudBase MCP</li>
<li>设计需求文档，开发应用demo</li>
<li>用AI微调细节，部署网页到CloudBase</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b625f69f248e42608f1c3df4565e19d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=DoP4%2FRrcsH0%2BSnO%2F18sTBj6DFXA%3D" alt="录屏.gif" loading="lazy"/></p>
<h2 data-id="heading-0">一、准备工作</h2>
<ul>
<li>下载CodeBuddy IDE</li>
<li>Node.js &gt;= v18.15.0</li>
<li>开通CloudBase环境</li>
</ul>
<p><strong>在接下来的演示中，我将使用CloudBase这个一体化全栈云平台，快速构建具备后端能力和前后端交互的完整 Web 应用。</strong> CloudBase提供了开箱即用的后端云服务，涵盖云函数、数据库、存储、静态托管等核心能力，无需从零搭建和维护服务器，即可获得弹性、可靠的后端支持。尤其适合全栈及前端开发者快速实现应用闭环，专注业务逻辑而非基础设施。</p>
<h2 data-id="heading-1">二、实操步骤拆解</h2>
<h3 data-id="heading-2">步骤一：配置 CloudBase</h3>
<p><strong>CloudBase MCP</strong> 通过Model Context Protocol (MCP) 这个通用协议，像一座桥梁，让开发者用的AI编程助手（比如 CodeBuddy）能够安全、直接地访问和操作 CloudBase 的云端资源。</p>
<p>在AI Coding的场景中，借助<strong>CloudBase MCP</strong>，我们就能向AI直接描述需求，自动生成、操作和管理云上资源，例如创建数据库集合、部署云函数、配置权限等。</p>
<p>这意味着：</p>
<ol>
<li>无需熟悉手动配置：在 IDE 中通过对话即可完成资源对接，大幅降低手动配置成本；</li>
<li>无代码操控后端：即使不熟悉后端细节，也能通过 AI指令快速完成后端服务搭建与迭代；</li>
<li>与 AI 开发流深度适配：完美契合 AI Coding工作流，实现“描述即开发”，显著提升全栈开发速度。</li>
</ol>
<h4 data-id="heading-3">CloudBase产品介绍</h4>
<ul>
<li>CloudBase文档站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2F" target="_blank" title="https://docs.cloudbase.net/" ref="nofollow noopener noreferrer">docs.cloudbase.net/</a></li>
<li>CloudBase控制台（前往开通环境）：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftcb.cloud.tencent.com%2Fdev" target="_blank" title="https://tcb.cloud.tencent.com/dev" ref="nofollow noopener noreferrer">tcb.cloud.tencent.com/dev</a></li>
<li>CloudBase MCP官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2F" target="_blank" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/" ref="nofollow noopener noreferrer">docs.cloudbase.net/ai/cloudbas…</a></li>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FCloudBase-AI-ToolKit" target="_blank" title="https://github.com/TencentCloudBase/CloudBase-AI-ToolKit" ref="nofollow noopener noreferrer">github.com/TencentClou…</a></li>
</ul>
<h5 data-id="heading-4">方式一：连接集成CloudBase MCP</h5>
<p>在IDE的 <strong>“配置集成”</strong> 中找到CloudBase，点击后注册登录云环境完成连接。
<em>现在开通云环境系统就会自动发放6个月免费个人版套餐。</em></p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d900ecaa8f2a4d5495627f36d4d861f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=NMATNjSl2y4%2BoX4fcc9mrddPGbA%3D" alt="连接配置集成.jpg" width="70%" loading="lazy"/>
<h5 data-id="heading-5">方式二：手动配置CloudBase MCP</h5>
<p>进入 <strong>“设置”</strong> 板块，直接选择 <strong>“添加MCP”</strong> 或打开 <strong>“MCP市场”</strong> 手动配置CloudBase MCP。</p>
<p>选择添加MCP需要打开CloudBase的AI原生开发板块找到快速配置的代码，复制粘贴进图示位置，保存后就可以在 <strong>“我的MCP”</strong> 处控制MCP的开关；进入MCP市场可以直接查询到配置代码，按照提示的流程完成配置。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d88a801239144608a782e347eaea8e3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=O7fWHnQfaZctSqswY96twxA5Xc4%3D" alt="MCP配置.jpg" width="70%" loading="lazy"/>
<p>配置完成后，<strong>在 AI 对话框中输入：登录云开发</strong></p>
<p>AI 会自动引导你完成登录和环境选择。然后你可以开始使用自然语言描述需求，让 AI 帮你开发应用。</p>
<h3 data-id="heading-6">步骤二:  配置应用模板</h3>
<h4 data-id="heading-7">step 01创建项目文件夹</h4>
<p>点击IDE左上角 <strong>“文件”</strong> 打开你想要存项目的文件夹，再点击 <strong>“新建文件夹”</strong> 小图标创建新项目。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32b6850e640d4dcdb4087fe187329f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=V%2FQanvN6JhVBS2QUeKf11fM6X1g%3D" alt="b08a0ae5-4a8e-4890-be98-968b46d53840.png" width="70%" loading="lazy"/>
<h4 data-id="heading-8">step 02 拉取CloudBase预制应用模板</h4>
<p><strong>在对话框中输入指令：下载CloudBase的web应用模板</strong></p>
<p>我这里补充了“选择vue框架”，大家还可以根据需要选择react框架。</p>
<h3 data-id="heading-9">步骤三：开发网页实践</h3>
<h4 data-id="heading-10">step 01 自然语言描述开发任务</h4>
<p>在根目录点击新建文件，创建<strong>需求文档.md</strong>用于描述你的网页，然后把空文档添加进@(上下文），简单描述你的要求。</p>
<p><strong>参考提示词：</strong></p>
<ul>
<li><strong>UI风格：生成一个治愈系、莫兰迪配色的健康计划web网页。</strong></li>
<li><strong>主要功能：要求首页是当日健康任务列表，可以看到总计划完成进度，并且有打卡交互；再增加一个计划定制页，有确定目标、添加任务项（包含行为和频率）、计划完成时间三个板块。</strong></li>
<li><strong>特殊布局：页面布局适应移动端浏览器</strong></li>
</ul>
<p><strong>根据以上内容生成web应用开发需求文档，添加在需求文档.md中</strong>。</p>
<p>AI生成的结果可能一次完美，也可能需要你进行一两轮对话微调。如果对生成的UI不满意，可以在本地预览中选择要修改的组件，然后输入指令调整，例如“调整配色，更柔和一些”或“将打卡按钮放在卡片右下角”。这是AI协同开发的正常迭代过程。</p>
<p>如果对生成的文档进行了微调，记得ctrl+s保存，再<strong>把文档添加进@(上下文）</strong>，要求AI生成代码并预览页面。我增加了类似<strong>QQ登录等级</strong>的每日打卡等级机制，想要复刻可以参考文末提示词。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6315bba1f914456d9812a4ebea7c23ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=3R6WZ8werwsDrLkbL%2BBAzKXdibw%3D" alt="效果1.png" width="50%" loading="lazy"/>
<h4 data-id="heading-11">step 02 接入后端数据库</h4>
<p>普通网页的应用数据仅存在本地，换台手机或重装应用就可能清零。<strong>通过 CloudBase 将数据存入云端，健康打卡的进度会实时同步保存，每次打开都能接着之前的记录继续打卡。</strong></p>
<p>输入指令后<strong>AI自动完成创建数据表和前后端交互逻辑</strong>，添加测试数据后在控制台就可以看到如下图的记录，其中的openid字段是用户的唯一标识。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b62af7e4f9a1481281b3cae4cde92244~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=PQ5a5ISvRp%2FojpcxqYhQ0d1edBk%3D" alt="前后端交互.jpg" loading="lazy"/></p>
<h4 data-id="heading-12">step 03 接入用户登录体系</h4>
<p>如果觉得自己的精妙设计应该造福更多的人(👉ﾟヮﾟ)👉，可以用CloudBase实现登录功能，每位用户都能拥有自己独立且安全的计划列表，实现真正的多人使用。</p>
<p><strong>初始化CloudBase就能使用匿名登录，不用专门写登录功能，所以以上过程已经实现了能够多人使用的Web应用。</strong></p>
<p>匿名登录无需创建登录页，登录认证过程用户无感知，可以提高应用便利性和用户留存。CloudBase会自动为每位匿名访问的用户生成唯一的 openid，从而实现数据的自然隔离。下图展示了两个独立设备产生的数据记录，其 openid完全不同。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e57266f6b34a50988438de6cdf9110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=UArO83P6Ix1%2BvT%2BhHHOEbV6x1bU%3D" alt="数据库效果3.png" width="70%" loading="lazy"/>
<p>CloudBase还支持<strong>用户名密码登录、短信验证码登录、邮箱登录、微信授权登录和自定义登录</strong>，确保了用户可在手机、电脑等任何设备上安全登录，随时随地继续操作。向AI简单输入指令，实现的<strong>账号密码登录页面</strong>如下，一句话实现了几乎不需要调整的标准登录页面。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/924c1e6a6add4423a61d2f3fc6329531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=Mtyv8xpL6VfeiEMNRTydR4HjhhA%3D" alt="账号密码登录.png" width="50%" loading="lazy"/>
<h4 data-id="heading-13">step 04 项目部署</h4>
<p><strong>在对话框输入指令：部署到云环境</strong>
AI自动完成部署，返回可以被所有用户访问的网址。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76d0dddb8e92476d9f94c58137e4a71a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=%2BfYFIrf6n7tPTC7in7fORXUT5Xo%3D" alt="部署.png" width="50%" loading="lazy"/>
<h4 data-id="heading-14">step 05 网页保存到手机主屏幕</h4>
<p>将你的网页存成QQ浏览器标签，保存在手机主屏幕，就可以像打开APP一样快速打开了。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/020454082bcd4fe3b4193c960bd27219~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=JbINHDFcZk3MmkYetOs4VeSCUho%3D" alt="添加到主屏幕.gif" width="50%" loading="lazy"/>
<h2 data-id="heading-15">三、功能迭代</h2>
<p>自己用AI开发网页，想要更换色彩主题、添加新的功能，都可以通过CodeBuddy+CloudBase的组合实现。</p>
<ul>
<li><strong>自定义主题</strong>
给网页更换节日配色：圣诞配色</li>
</ul>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d18eb61ad8143d1953e38dc05b6bc76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=KJhJGlZGa8OslJbzDGWtTpvKyGc%3D" alt="圣诞主题.gif" width="50%" loading="lazy"/>
<ul>
<li><strong>接入大模型API</strong>
<strong>参考教程：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1NEsWzRE6U%2F%3Fshare_source%3Dcopy_web%26vd_source%3D068decbd00a3d00ff8662b6a358e5e1e%26objectId%3D2608662%26objectType%3D1%26contentType%3Dundefined" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.bilibili.com/video/BV1NEsWzRE6U/?share_source=copy_web&amp;vd_source=068decbd00a3d00ff8662b6a358e5e1e&amp;objectId=2608662&amp;objectType=1&amp;contentType=undefined" ref="nofollow noopener noreferrer">接入混元生图api - AI编程：从0到1开发一个AI试衣小程序！免费分享 | 含源码</a></li>
</ul>
<h2 data-id="heading-16">四、提示词总结</h2>
<p><strong>需求描述：</strong>
UI风格：生成一个治愈系、莫兰迪配色的健康计划web网页。
主要功能：要求首页是当日健康任务列表，可以看到总计划完成进度，并且有打卡交互；再增加一个计划定制页，有确定目标、添加任务项（包含行为和频率）、计划完成时间三个板块。
特殊布局：页面布局适应移动端浏览器
根据以上内容生成web应用开发需求文档，添加在需求文档.md中。</p>
<p><strong>QQ等级系统：</strong>
总进度的卡片改成QQ等级展示卡片。
等级图标设计：1个星星是1级，4个星星升为1个月亮（4级），4个月亮升为1个太阳（16级），4个太阳升为1个皇冠（64级），最高等级是256级，也就是4个皇冠；达成4个皇冠获得成就徽章，展示在卡片下方。
升级逻辑：完成当日所有任务打卡获得一颗星星。</p>
<p><strong>前后端交互：</strong>
在CloudBase数据库创建数据表，记录用户的健康计划和打卡进度，完成前后端交互逻辑。</p>
<p><strong>账号密码登录功能：</strong>
给项目增加账号密码的注册和登录功能，在后端数据库创建数据表管理用户信息。实现登录页和用户管理，首次访问时检验用户是否注册。</p>
<p><strong>项目部署：</strong>
部署到云环境</p>
<p><strong>更换网页主题：</strong>
配色主题换成圣诞节主题，页面元素使用复古红绿色</p>
<h2 data-id="heading-17">结语</h2>
<p>通过这篇教程，我们完成了一次从构思到部署的完整AI原生开发实践。</p>
<p>在复刻MEMO这一将健康管理游戏化的应用的过程中，亲身感受 CodeBuddy AI编程与CloudBase一体化智能后端协同作用的效果，全面提升开发效率。借助CloudBase MCP，你可以用自然语言直接操作云端资源，无需手动配置服务器、数据库或身份认证；使用CodeBuddy将你的产品描述，直接转化为可运行的前端代码与交互逻辑。不同水平的开发者都能实现在30分钟内构建一个具备多用户数据隔离、云端同步、可部署访问的全栈Web应用。</p>
<p>2026年，真正的“自律”或许不在于苦撑，而在于找到对的系统与工具，让自己持续获得正向反馈。在开发的世界里，这个工具就是能理解你意图的AI，与能瞬间实现意图的CloudBase云平台。现在就基于此项目，尝试用一句指令添加你想要的下一项功能吧！</p>
<h3 data-id="heading-18">附录</h3>
<p><strong>1. CloudBase产品介绍</strong></p>
<ul>
<li>CloudBase文档站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2F" target="_blank" title="https://docs.cloudbase.net/" ref="nofollow noopener noreferrer">docs.cloudbase.net/</a></li>
<li>CloudBase控制台（前往开通环境）：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftcb.cloud.tencent.com%2Fdev" target="_blank" title="https://tcb.cloud.tencent.com/dev" ref="nofollow noopener noreferrer">tcb.cloud.tencent.com/dev</a></li>
<li>CloudBaseMCP官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2F" target="_blank" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/" ref="nofollow noopener noreferrer">docs.cloudbase.net/ai/cloudbas…</a></li>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FCloudBase-AI-ToolKit" target="_blank" title="https://github.com/TencentCloudBase/CloudBase-AI-ToolKit" ref="nofollow noopener noreferrer">github.com/TencentClou…</a></li>
</ul>
<p><strong>2. 各类AI Coding工具配置CloudBase指南：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2Fide-setup%2Fcursor" target="_blank" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/ide-setup/cursor" ref="nofollow noopener noreferrer">docs.cloudbase.net/ai/cloudbas…</a>
（包含Cursor 、CodeBuddy、Trae、Qoder、Gemini CLI、OpenAI Codex CLI、Google Antigravity、GitHub Copilot等21个AI Coding工具）</p>
<p><strong>3. CodeBuddy IDE 下载地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fcopilot.tencent.com%2F" target="_blank" title="https://copilot.tencent.com/" ref="nofollow noopener noreferrer">copilot.tencent.com/</a></p>
<p>IDE界面核心是AI对话框，上方提供了一系列效率工具图标，从左到右依次是：@（添加上下文）、添加图片、添加Figma设计稿、组件库以及配置集成。左下角可切换智能体(Agent)模式与基础大模型对话模式。目前IDE内置的大模型有下图中是几种，本次教程将使用Claude-4.5-Opus演示。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703e709c4bbc46a8920bf3bb18f6b220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768210638&amp;x-signature=s85Ps0Ia28siQaB2UyjDCXT3qyA%3D" alt="下载IDE.jpg" width="50%" loading="lazy"/>
<p><strong>4. Node.js下载</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">//查看版本</span>
node --version
</code></pre>
<p>如果未安装，请从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fdownload" target="_blank" title="https://nodejs.org/en/download" ref="nofollow noopener noreferrer">Node.js 官网</a>下载安装。</p>
<p>保姆级安装教程指路：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FWHF__%2Farticle%2Fdetails%2F129362462" target="_blank" title="https://blog.csdn.net/WHF__/article/details/129362462" ref="nofollow noopener noreferrer">点击前往教程</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot + 执行管道：让业务流程清晰可控]]></title>    <link>https://juejin.cn/post/7591456613535432704</link>    <guid>https://juejin.cn/post/7591456613535432704</guid>    <pubDate>2026-01-05T08:35:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591456613535432704" data-draft-id="7591465142452289588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot + 执行管道：让业务流程清晰可控"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T08:35:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot + 执行管道：让业务流程清晰可控
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:35:38.000Z" title="Mon Jan 05 2026 08:35:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>不知道你有没有遇到过这种情况：一个订单创建的接口，刚上线的时候只有几十行代码，逻辑也很简单。但随着业务迭代，三个月后变成了这样：</p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">createOrder</span>(OrderRequest request) {
    <span class="hljs-comment">// 参数校验</span>
    if (request.getUserId() == null) {
        throw new <span class="hljs-built_in">IllegalArgumentException</span>("用户ID不能为空");
    }
    <span class="hljs-comment">// ... 省略 20 行校验代码</span>

    <span class="hljs-comment">// 权限校验</span>
    if (!checkPermission(request.getUserId())) {
        throw new <span class="hljs-built_in">ForbiddenException</span>("无权限");
    }

    <span class="hljs-comment">// 业务校验</span>
    if (getOrderCount(request.getUserId()) &gt;= <span class="hljs-number">10</span>) {
        throw new <span class="hljs-built_in">BusinessException</span>("订单数量超限");
    }
    <span class="hljs-comment">// ... 省略 15 行业务校验</span>

    <span class="hljs-comment">// 创建订单</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">buildOrder</span>(request);
    orderMapper<span class="hljs-selector-class">.insert</span>(order);

    <span class="hljs-comment">// 写操作日志</span>
    try {
        operateLogService<span class="hljs-selector-class">.log</span>(order.getId(), "CREATE");
    } catch (Exception e) {
        <span class="hljs-comment">// 日志失败不影响主流程</span>
        log<span class="hljs-selector-class">.error</span>("写日志失败", e);
    }

    <span class="hljs-comment">// 发送通知</span>
    try {
        notificationService<span class="hljs-selector-class">.send</span>(order);
    } catch (Exception e) {
        log<span class="hljs-selector-class">.error</span>("发送通知失败", e);
    }

    <span class="hljs-comment">// 异步风控检查</span>
    asyncRiskCheckService<span class="hljs-selector-class">.check</span>(order);
}
</code></pre>
<p>几百行代码，<code>if</code>、<code>try-catch</code> 到处都是。更可怕的是：</p>
<ul>
<li>• 日志写失败要不要抛异常？</li>
<li>• 通知发送失败要不要回滚订单？</li>
<li>• 新增一个"优惠券核销"逻辑加在哪里？</li>
<li>• 测试环境想关闭风控检查怎么搞？</li>
</ul>
<h2 data-id="heading-0">问题出在哪？</h2>
<p>仔细看看上面的代码，其实它想做的事情可以拆成这么几个步骤：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 校验参数
<span class="hljs-bullet">2.</span> 校验权限
<span class="hljs-bullet">3.</span> 校验业务规则
<span class="hljs-bullet">4.</span> 创建订单（核心）
<span class="hljs-bullet">5.</span> 记录日志
<span class="hljs-bullet">6.</span> 发送通知
<span class="hljs-bullet">7.</span> 风控检查
</code></pre>
<p>这些步骤有几个特点：</p>
<p><strong>有的必须成功</strong>：比如参数校验、订单创建<br/>
<strong>有的可以失败</strong>：比如日志记录、通知发送<br/>
<strong>有的同步执行</strong>：比如各种校验<br/>
<strong>有的异步执行</strong>：比如风控检查<br/>
<strong>有的可能要关闭</strong>：比如测试环境不需要风控</p>
<p>但现在的写法，所有这些逻辑都混在一起，<strong>顺序、失败策略、是否可选</strong>，全靠代码里的 <code>if</code> 和 <code>try-catch</code> 来控制，能不乱吗？</p>
<h2 data-id="heading-1">有没有更好的写法？</h2>
<p>如果把这些步骤抽象成一个个"节点"，然后用一个"管道"把它们串起来，会怎样？</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">PipelineNode</span>&lt;<span class="hljs-title">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span>(<span class="hljs-params">PipelineContext&lt;T&gt; context</span>)</span>;
}
</code></pre>
<p>每个节点只做一件事，不关心前后是谁，不关心自己是第几个执行。</p>
<p>然后定义一个管道来执行这些节点：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutionPipeline</span>&lt;<span class="hljs-title class_">T</span>&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">PipelineNode</span>&lt;<span class="hljs-type">T</span>&gt;&gt; nodes;

    <span class="hljs-keyword">public</span> void execute(<span class="hljs-type">T</span> data) {
        <span class="hljs-type">PipelineContext</span>&lt;<span class="hljs-type">T</span>&gt; ctx <span class="hljs-operator">=</span> new <span class="hljs-type">PipelineContext</span>&lt;&gt;(data);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">PipelineNode</span>&lt;<span class="hljs-type">T</span>&gt; node : nodes) {
            <span class="hljs-keyword">if</span> (ctx.isInterrupted()) {
                <span class="hljs-keyword">break</span>;
            }
            node.execute(ctx);
        }
    }
}
</code></pre>
<p>现在再看看订单创建怎么写：</p>
<pre><code class="hljs language-csharp" lang="csharp">Pipeline pipeline = Pipeline.builder()
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> ParamValidateNode())       <span class="hljs-comment">// 参数校验</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> PermissionCheckNode())     <span class="hljs-comment">// 权限校验</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> BusinessValidateNode())    <span class="hljs-comment">// 业务校验</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> CreateOrderNode())         <span class="hljs-comment">// 创建订单</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> OperateLogNode())          <span class="hljs-comment">// 写日志</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> NotificationNode())        <span class="hljs-comment">// 发通知</span>
    .<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> AsyncRiskCheckNode())      <span class="hljs-comment">// 风控检查</span>
    .build();

pipeline.execute(orderRequest);
</code></pre>
<p><strong>主流程只剩下 10 行代码，每个节点的逻辑独立封装。</strong></p>
<h2 data-id="heading-2">这样做有什么好处？</h2>
<h4 data-id="heading-3">1. 节点可插拔</h4>
<p>想加一个"优惠券核销"逻辑？加个节点就行了：</p>
<pre><code class="hljs language-csharp" lang="csharp">.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> CouponDeductNode())
</code></pre>
<p>想关闭某个功能？去掉对应节点，或者通过配置控制：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.add</span>(env.isProd() ? new <span class="hljs-built_in">RiskCheckNode</span>() : new <span class="hljs-built_in">SkipNode</span>())
</code></pre>
<h4 data-id="heading-4">2. 失败策略清晰</h4>
<p>在 <code>PipelineContext</code> 里定义好失败策略：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">FailureStrategy</span> {
    CONTINUE,    <span class="hljs-comment">// 失败后继续执行</span>
    STOP,        <span class="hljs-comment">// 失败后中断管道</span>
    ROLLBACK     <span class="hljs-comment">// 失败后回滚（需要配合事务）</span>
}
</code></pre>
<p>日志节点的失败策略是 <code>CONTINUE</code>，订单创建节点的失败策略是 <code>STOP</code>，一目了然。</p>
<h4 data-id="heading-5">3. 节点可复用</h4>
<p>参数校验节点、权限校验节点、日志节点，都可以在其他业务里复用。</p>
<h4 data-id="heading-6">4. 执行顺序可控</h4>
<p>节点的执行顺序由管道定义，不用在每个节点里写代码控制。</p>
<h2 data-id="heading-7">执行管道：一种工程化方案</h2>
<p>上面介绍的方案既<strong>执行管道（Execution Pipeline）</strong></p>
<p>它不是某个框架，而是一种工程设计模式：把一次业务执行拆成多个可插拔、有顺序、可控制的执行阶段，用统一机制串起来。</p>
<h2 data-id="heading-8">它跟 AOP、责任链有什么区别？</h2>
<p>你可能想到了 AOP、责任链、工作流引擎这些概念，它们确实有相似之处：</p>



































<table><thead><tr><th>方案</th><th>适用场景</th><th>局限性</th></tr></thead><tbody><tr><td>AOP</td><td>通用的横切逻辑（日志、事务）</td><td>顺序不直观，难以做流程控制</td></tr><tr><td>Filter/Interceptor</td><td>HTTP 请求级别的处理</td><td>只能用于请求处理</td></tr><tr><td>@Async</td><td>异步执行</td><td>只解决并发，不解决流程编排</td></tr><tr><td>责任链</td><td>动态组合处理逻辑</td><td>缺少工程化封装</td></tr><tr><td>工作流引擎</td><td>复杂的业务流程</td><td>太重，单机应用用不上</td></tr></tbody></table>
<p>执行管道可以说是<strong>工程化的责任链模式</strong>，专门用于解决单机应用内的业务流程编排问题。</p>
<h2 data-id="heading-9">什么时候用？</h2>
<p>不是所有场景都需要执行管道。如果你的代码：</p>
<ul>
<li>• 步骤固定、逻辑简单，直接写就行</li>
<li>• 流程复杂但不会变化，也没必要过度设计</li>
</ul>
<p>但当出现这些信号时，可以考虑：</p>
<ul>
<li>• 一个方法过长，不利于阅读维护</li>
<li>• 有多个"可选"或"异步"的执行步骤</li>
<li>• 经常需要插入新的执行逻辑</li>
<li>• 不同环境需要不同的执行流程</li>
</ul>
<p>执行管道特别适合<strong>单机应用内的复杂业务流程</strong>，比如订单创建、用户注册、数据导入等场景。</p>
<h2 data-id="heading-10">写在最后</h2>
<p>好的代码不是一次写成的，而是在不断重构中进化出来的。</p>
<p>如果你的项目里已经有了那种"巨无霸"方法，不用急着全部推倒重来。先试着把其中一个独立的逻辑抽成节点，然后逐步迁移，代码会越来越清晰。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-pipeline
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP 8.6 新特性预览，更简洁的语法与更严谨的类型控制]]></title>    <link>https://juejin.cn/post/7591510742648012843</link>    <guid>https://juejin.cn/post/7591510742648012843</guid>    <pubDate>2026-01-05T08:45:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742648012843" data-draft-id="7591510742647996459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP 8.6 新特性预览，更简洁的语法与更严谨的类型控制"/> <meta itemprop="keywords" content="后端,PHP"/> <meta itemprop="datePublished" content="2026-01-05T08:45:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP 8.6 新特性预览，更简洁的语法与更严谨的类型控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:45:54.000Z" title="Mon Jan 05 2026 08:45:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>PHP 8.5上线没多久，PHP 8.6的RFC（征求意见稿）就已逐步落地。我发现PHP正在变得越来越严谨，同时也在努力减少那些机械重复的样板代码。</p>
<p>按照PHP开发组的发布节奏，PHP 8.6 预计将在 2026年11月下旬正式发布。虽然距离正式版还有相当长的时间，但部分核心特性已经确定（Accepted），另有不少颇具实用价值的提案正在讨论中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc668e8617d646c480f5f66409904ac2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768207554&amp;x-signature=0k7UtQnTrX86YNBJphH8maR7ih4%3D" alt="" loading="lazy"/></p>
<p>以下是针对PHP 8.6新特性的技术解读，重点关注那些能直接改变日常编码习惯的功能。</p>
<h3 data-id="heading-0">已确定的核心特性 (Accepted)</h3>
<h4 data-id="heading-1">1. 部分函数应用 (Partial Function Application v2)</h4>
<p>这是PHP 8.6中最值得关注的语法改进。它允许在调用函数时，使用占位符 <code>?</code> 来跳过部分参数，从而直接生成一个闭包（Closure）。</p>
<p>在此之前，为了复用一个函数并固定某些参数，通常需要手动编写 <code>fn() =&gt; ...</code> 或者 <code>function() use (...)</code>。新语法让代码表达更直观，意图更清晰。</p>
<p><strong>代码对比：</strong></p>
<p>假设有一个发送通知的函数，需要传入渠道、用户ID和消息内容。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendNotification</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$channel</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$userId</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$message</span></span>): <span class="hljs-title">void</span>
</span>{
    <span class="hljs-comment">// 模拟发送逻辑</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"通过 [<span class="hljs-subst">{$channel}</span>] 发送给用户 [<span class="hljs-subst">{$userId}</span>]: <span class="hljs-subst">{$message}</span>"</span> . PHP_EOL;
}
</code></pre>
<p><strong>以前的写法：</strong></p>
<p>如果想创建一个专门发送短信的处理器，需要手动包裹一层闭包：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$smsSender</span> = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$uid</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$msg</span></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">sendNotification</span>(<span class="hljs-string">'SMS'</span>, <span class="hljs-variable">$uid</span>, <span class="hljs-variable">$msg</span>);
};

<span class="hljs-variable">$smsSender</span>(<span class="hljs-number">1001</span>, <span class="hljs-string">"验证码是 1234"</span>);
</code></pre>
<p><strong>PHP</strong> <strong>8.6 的写法：</strong></p>
<p>直接使用 <code>?</code> 占位符，PHP会自动返回一个闭包，保留已传参数的类型检查能力。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 固定第一个参数为 'SMS'，后续参数待定 (?)</span>
<span class="hljs-variable">$smsSender</span> = <span class="hljs-title function_ invoke__">sendNotification</span>(<span class="hljs-string">'SMS'</span>, ?, ?);

<span class="hljs-comment">// 调用生成的闭包</span>
<span class="hljs-variable">$smsSender</span>(<span class="hljs-number">1001</span>, <span class="hljs-string">"您的订单已发货"</span>); 
<span class="hljs-comment">// 输出: 通过 [SMS] 发送给用户 [1001]: 您的订单已发货</span>
</code></pre>
<p>这种特性能高效地处理数组回调。例如，结合 <code>array_map</code> 检查文件列表：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$files</span> = [<span class="hljs-string">'config.php'</span>, <span class="hljs-string">'index.php'</span>, <span class="hljs-string">'README.md'</span>];

<span class="hljs-comment">// 以前：array_map(fn($f) =&gt; hash_file('md5', $f), $files);</span>
<span class="hljs-comment">// 现在：直接生成计算md5的闭包</span>
<span class="hljs-variable">$hashes</span> = <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-title function_ invoke__">hash_file</span>(<span class="hljs-string">'md5'</span>, ?), <span class="hljs-variable">$files</span>);
</code></pre>
<h4 data-id="heading-2">2. 原生 clamp() 函数</h4>
<p>在处理数值范围限制时，开发者习惯了编写 <code>min(max($val, $min), $max)</code> 这种嵌套逻辑，或者自己封装辅助函数。PHP 8.6 将其标准化为原生的 <code>clamp()</code> 函数。</p>
<p><strong>功能描述：</strong></p>
<p>将数值限制在指定的最小和最大范围内。</p>
<ul>
<li>
<p>小于最小值，返回最小值。</p>
</li>
<li>
<p>大于最大值，返回最大值。</p>
</li>
<li>
<p>在范围内，返回原值。</p>
</li>
</ul>
<p><strong>应用场景：</strong></p>
<p>库存管理中防止超卖或出现负库存，或者UI开发中限制透明度（Opacity）范围。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$currentStock</span> = -<span class="hljs-number">5</span>; <span class="hljs-comment">// 异常数据</span>

<span class="hljs-comment">// 限制库存显示范围在 0 到 1000 之间</span>
<span class="hljs-comment">// 注意：如果 min &gt; max，该函数会抛出 ValueError，避免静默逻辑错误</span>
<span class="hljs-variable">$displayStock</span> = <span class="hljs-title function_ invoke__">clamp</span>(<span class="hljs-variable">$currentStock</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>); 

<span class="hljs-keyword">echo</span> <span class="hljs-variable">$displayStock</span>; <span class="hljs-comment">// 输出 0</span>
</code></pre>
<h3 data-id="heading-3">正在讨论与草案阶段的特性 (Under Discussion/Draft)</h3>
<p>以下特性尚未最终定案，但极有可能出现在PHP 8.6或后续版本中。它们反映了PHP未来的演进方向：类型安全与更现代的API。</p>
<h4 data-id="heading-4"><strong>增强的参数获取 (func_get_args_by_name)</strong></h4>
<p>传统的 <code>func_get_args()</code> 只能返回索引数组，导致命名参数（Named Arguments）的键名丢失。新提案建议增加 <code>func_get_args_by_name()</code>，在获取参数时保留参数名作为数组的键。这对于编写中间件或代理类非常有用。</p>
<h4 data-id="heading-5"><strong>可空与非空强制转换操作符</strong></h4>
<p>提案引入了两种新的转换语法：</p>
<ul>
<li>
<p><code>(?int) $var</code>: 允许 <code>null</code> 通过（保持为 <code>null</code>），非 <code>null</code> 值则按弱类型规则转换。</p>
</li>
<li>
<p><code>(!int) $var</code>: 拒绝 <code>null</code>（抛出错误），并要求值必须能被“干净”地转换，否则抛出异常。</p>
</li>
</ul>
<p>这比现有的 <code>(int)</code> 强制转换更安全，能有效防止数据污染。</p>
<h4 data-id="heading-6"><strong>BackedEnum 增加 values() 方法</strong></h4>
<p>枚举（Enum）在PHP 8.1引入后被广泛使用。目前要获取所有枚举值的列表，通常需要 <code>array_map</code> 配合 <code>cases()</code>。新提案建议给 <code>BackedEnum</code> 增加原生的 <code>values()</code> 方法，直接返回包含所有值的数组。</p>
<h4 data-id="heading-7"><strong>PDO</strong> <strong>断开连接 (pdo_disconnect)</strong></h4>
<p>终于可以在PDO对象上显式调用 <code>disconnect()</code> 来断开数据库连接，以及使用 <code>isConnected()</code> 检查状态，而不再依赖 <code>unset($pdo)</code> 或垃圾回收机制。</p>
<h4 data-id="heading-8"><strong>废弃模糊的</strong> <strong>标量</strong> <strong>转换</strong></h4>
<p>PHP 8.6 可能会对例如 <code>(int) "100 apples"</code> 这种包含非数字字符的字符串转换发出弃用警告（Deprecation Notice），推动开发者先验证数据（如使用 <code>ctype_digit</code>），再进行转换。</p>
<h3 data-id="heading-9">如何抢先体验 PHP 8.6？</h3>
<p>对于开发者而言，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">本地配置PHP开发环境</a>通常挺麻烦的，涉及源码编译、依赖管理以及与现有环境的冲突处理。为了在不破坏现有项目的前提下尝鲜新特性，推荐使用 <strong>ServBay</strong> 来管理开发环境。</p>
<p>ServBay 是一款专为开发者设计的集成化环境管理工具，它完美契合了PHP开发者的痛点：</p>
<ul>
<li><strong>率先支持</strong> <strong>PHP</strong> <strong>8.6-</strong> <strong>dev</strong>：无需等待漫长的正式版发布周期，ServBay 率先<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fphp" target="_blank" title="https://www.servbay.com/features/php" ref="nofollow noopener noreferrer">支持 PHP 8.6</a> 开发版本的安装选项。开发者可以立刻在本地测试 <code>Partial Function Application</code> 等新语法，验证现有代码库的兼容性。</li>
<li><strong>多版本共存与一键切换</strong>：ServBay 支持从古老的 <strong>PHP</strong> <strong>5.3</strong> 到最新的 <strong>PHP 8.6-</strong> <strong>dev</strong> 全系列版本。就算要维护老掉牙的项目，那也是完全没有问题的。</li>
<li><strong>一键启停与部署</strong>：复杂的环境配置被简化为图形化界面操作。无论是安装特定版本的PHP，还是启动/停止服务，均可一键完成，无需记忆繁琐的命令行指令。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6103e7a4b91b47cdbc9fe5473b800b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768207554&amp;x-signature=81UNDGNAU3Ct8mi0k7%2FAwPRrNGY%3D" alt="" loading="lazy"/></p>
<p>如果你希望紧跟PHP的技术潮流，同时保持开发环境的整洁与稳定，ServBay 是目前最高效的解决方案。</p>
<h3 data-id="heading-10">总结</h3>
<p>PHP 8.6 并没有激进地重写底层逻辑，而是专注于提升开发者体验。<code>Partial Function Application</code> 让函数式编程更流畅，<code>clamp</code> 填补了标准库的缺失，而各类类型安全的提案则表明 PHP 正朝着更严谨的工程化语言迈进。尽早了解并测试这些特性，将有助于我们在未来的版本迭代中保持代码的现代性与高质量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[老系统维护实录：用 PHP 正则 + CSS 绝对定位，优雅搞定面单打印“缝隙插针”需求]]></title>    <link>https://juejin.cn/post/7591681023907774473</link>    <guid>https://juejin.cn/post/7591681023907774473</guid>    <pubDate>2026-01-05T08:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591681023907774473" data-draft-id="7591670569910566958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老系统维护实录：用 PHP 正则 + CSS 绝对定位，优雅搞定面单打印“缝隙插针”需求"/> <meta itemprop="keywords" content="PHP"/> <meta itemprop="datePublished" content="2026-01-05T08:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hteng"/> <meta itemprop="url" content="https://juejin.cn/user/20219918824519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老系统维护实录：用 PHP 正则 + CSS 绝对定位，优雅搞定面单打印“缝隙插针”需求
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/20219918824519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hteng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:57:53.000Z" title="Mon Jan 05 2026 08:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">老系统维护实录：用 PHP 正则 + CSS 绝对定位，优雅搞定面单打印“缝隙插针”需求</h2>
<p>大家好，我是“世界上最好的语言”的使用者——一名 PHPer。</p>
<p>最近在维护公司内部的一个 WMS（仓储管理系统）时，接到了一个让人头秃的需求。业务方要求在现有的商品标签（面单）上，增加一个“定制文案”的展示。</p>
<p>听起来很简单对吧？但在十年前写的老系统里，这简直是灾难。今天分享一下我是如何在不动用 DOM 解析库的情况下，用 PHP 原生能力解决这个问题的。</p>
<h3 data-id="heading-1">😱 业务场景与痛点</h3>
<p>现有的面单打印逻辑非常古老，模版不是像现在的 Blade 或 Smarty 那样渲染的，而是直接在后端拼接了一大坨带有 <code>style</code> 内联样式的 HTML 字符串，存放在数据库里，取出来后直接吐给前端打印组件。</p>
<p><strong>需求具体是这样的：</strong></p>
<ol>
<li><strong>位置刁钻</strong>：要在“平台SKC编号”和“平台海外仓多属性”这两个字段中间，插入一个新的字段。</li>
<li><strong>空间有限</strong>：这个新字段最多只能展示 <strong>6 个字符</strong>的宽度，超长必须截断，不能换行。</li>
<li><strong>不能动老结构</strong>：原有的 HTML 结构是通过绝对定位（<code>position: absolute</code>）排版的，坐标写死在 <code>style</code> 里的，牵一发而动全身。</li>
</ol>
<p>面对着那一坨杂乱的 HTML 字符串，使用 <code>DOMDocument</code> 或 <code>SimpleHTMLDom</code> 解析不仅慢，还容易因为 HTML 标签不规范导致报错。这时候，PHP 强大的正则处理能力就派上用场了。</p>
<h3 data-id="heading-2">🛠️ 解决方案：PHP 正则手术刀</h3>
<p>我的思路是：<strong>找到“SKC编号”的闭合 <code>&lt;/div&gt;</code> 标签，在它后面无缝拼接我们要插入的新 <code>div</code>。</strong></p>
<h4 data-id="heading-3">1. 正则表达式的构建</h4>
<p>最关键的一步是如何精准定位。原有的 HTML 标签混杂着各种属性和换行符。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$pattern</span> = <span class="hljs-string">'/(&lt;div[^&gt;]*?data-title="平台SKC编号"[^&gt;]*?&gt;.*?&lt;\/div&gt;)/is'</span>;
</code></pre>
<p>这里有几个知识点值得分享：</p>
<ul>
<li><strong><code>[^&gt;]*?</code></strong> ：非贪婪匹配，确保我们匹配的是当前的 <code>div</code> 开始标签，防止跨越到下一个标签。</li>
<li><strong><code>data-title="..."</code></strong> ：利用业务特有的属性作为锚点，比用 class 靠谱，因为 class 可能会变，但业务标识一般不变。</li>
<li><strong><code>/is</code> 修饰符</strong>：<strong>这是重点！</strong>
<ul>
<li><code>i</code>：忽略大小写。</li>
<li><code>s</code>：<strong>让点号 <code>.</code> 可以匹配换行符</strong>。因为 HTML 源码中往往包含大量的换行和空格，如果不加这个修饰符，正则会直接失效。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">2. CSS 布局的魔法</h4>
<p>后端插入了 HTML 只是第一步，前端展示还得对齐。由于原有的布局是 <code>absolute</code>，我们新插入的元素也必须“悬浮”在指定坐标。</p>
<p>业务要求“最多展示6个字符”，这里我用了一个 CSS 小技巧：<code>em</code> 单位。</p>
<ul>
<li><code>width: 6em</code>：大约就是 6 个字符的宽度（取决于字体大小）。</li>
<li><code>overflow: hidden</code>：物理截断，防止内容撑破版面。</li>
<li><code>white-space: nowrap</code>：强制不换行。</li>
<li><code>z-index: 99</code>：确保新内容浮在最上层，不被背景遮挡。</li>
</ul>
<h4 data-id="heading-5">3. 最终代码实现</h4>
<p>直接上代码，干净利落：</p>
<pre><code class="hljs language-css" lang="css">&lt;?php
// 模拟原始 <span class="hljs-selector-tag">HTML</span> 字符串（一坨乱糟糟的代码）
$str = $originalHtmlFromDb; 

// 假设这是从订单数据中获取的定制文案
$customText = "Lukas, <span class="hljs-number">67</span>"; 

// 构建要插入的 <span class="hljs-selector-tag">HTML</span> 代码
// 注意 style 设置：
// <span class="hljs-number">1</span>. <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">4px</span>; (与左右元素高度对齐)
// <span class="hljs-number">2</span>. <span class="hljs-attribute">left</span>: <span class="hljs-number">110px</span>; (大致位于左侧和右侧元素中间，需要微调)
// <span class="hljs-number">3</span>. <span class="hljs-attribute">width</span>: <span class="hljs-number">6em</span>; (限制宽度约为<span class="hljs-number">6</span>个字符)
$insertHtml = sprintf(
    '&lt;<span class="hljs-selector-tag">div</span> class="dropitem" data-title="定制文案" style="<span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">4px</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">110px</span>; <span class="hljs-attribute">width</span>: <span class="hljs-number">6em</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">text-align</span>: center; <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-attribute">white-space</span>: nowrap; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">99</span>;"&gt;
        &lt;<span class="hljs-selector-tag">span</span> class="detail" style="<span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">700</span>;"&gt;%s&lt;/<span class="hljs-selector-tag">span</span>&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;',
    $customText
);

// 正则替换：将捕获到的 $<span class="hljs-number">1</span> (即 SKC 编号的 <span class="hljs-selector-tag">div</span>) 放回去，并在后面追加我们的新 <span class="hljs-selector-tag">div</span>
$result = preg_replace(
    '/(&lt;<span class="hljs-selector-tag">div</span><span class="hljs-selector-attr">[^&gt;]</span>*?data-title="平台SKC编号"<span class="hljs-selector-attr">[^&gt;]</span>*?&gt;.*?&lt;\/<span class="hljs-selector-tag">div</span>&gt;)/is', 
    '$<span class="hljs-number">1</span>' . $insertHtml, 
    $str
);

// 输出或保存结果
echo $result;
</code></pre>
<h3 data-id="heading-6">💡 总结</h3>
<p>虽然现在流行前后端分离，但在处理 ERP、WMS 这种涉及硬件打印、老旧报表系统的业务时，PHP 的字符串处理能力依然是“神”一般的存在。</p>
<p>通过 <code>preg_replace</code> 配合 <code>/s</code> 模式，我们可以在不动用繁重 DOM 解析库的情况下，像外科手术一样精准修改 HTML 结构。再配合一点点 CSS 的 <code>em</code> 和 <code>overflow</code> 技巧，完美满足了业务方“既要又要”的需求。</p>
<p>PHP 不死，它只是在闷声发大财（解决实际问题）。</p>
<p>如果你也遇到过这种老系统维护的坑，欢迎在评论区一起吐槽交流！👋</p>
<hr/>
<p><strong>标签：</strong> #PHP #正则表达式 #后端开发 #踩坑记录 #CSS</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端真有意思，又干了一年图片编辑器]]></title>    <link>https://juejin.cn/post/7591681023908151305</link>    <guid>https://juejin.cn/post/7591681023908151305</guid>    <pubDate>2026-01-05T09:46:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591681023908151305" data-draft-id="7591635567587557422" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端真有意思，又干了一年图片编辑器"/> <meta itemprop="keywords" content="前端,JavaScript,产品"/> <meta itemprop="datePublished" content="2026-01-05T09:46:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="愚坤秦少卫"/> <meta itemprop="url" content="https://juejin.cn/user/3843548383549214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端真有意思，又干了一年图片编辑器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548383549214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    愚坤秦少卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:46:29.000Z" title="Mon Jan 05 2026 09:46:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是一名前端工程师，也是开源图片编辑器<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fikuaitu%2Fvue-fabric-editor" target="_blank" title="https://github.com/ikuaitu/vue-fabric-editor" ref="nofollow noopener noreferrer">vue-fabric-editor</a>项目的作者，<strong>我是一名干了十几年的前端程序员，真的越干越觉得前端开发有意思</strong>。</p>
<p>图片编辑器截图：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2522cbae98b847cfb8c6546bcfa72f64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=fpz4Cpoyvk%2BxQggH46oQxihvrtU%3D" alt="Foxmail20260105052725.png" loading="lazy"/></p>
<p>从2025年孤军奋战到拉起几个人的小团队，现在已经2026年了，不知不觉一年就过去了，<strong>前端的创业小团队都能做出哪些有意思的项目</strong>，大家一起看看我们做的项目，也算是我们团队的年终总结了。</p>
<p><strong>项目列表：</strong></p>
<ol>
<li>POD样机</li>
<li>丝巾设计平台</li>
<li>吧唧设计/亚克力设计</li>
<li>盒型/刀版设计</li>
<li>印花设计</li>
<li>工艺仿真</li>
</ol>
<h2 data-id="heading-0">POD样机</h2>
<p>这是一个快速生成电商图片的场景，让用户上传一张图片，<strong>快速生成多个不同场景的图片</strong>，比如冰袖产品，只需要穿一张印花图片，就可以生成多个不同场景和不同穿戴角度的电商图片，可以用来快速上架到电商平台。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/732637b4e20f449281ffdf95c76cb172~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=Q0MBv0XoqC0Ic%2BAVghk4YKOX1Gc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb7eda2c574946058381c94cacb3f50e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=s6qXsnf2Q6lzlls%2FKiumiEMsfqQ%3D" alt="2.gif" loading="lazy"/></p>
<p>不仅仅是冰袖，<strong>还是支持更复杂的服装设计</strong>，同时生成工厂打印使用的刀版图，一次生成不同尺码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd36431c733b4d1795af8b3cdd6fc3f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=XDJJCB84xkri2xM%2BaHrM8L11GXA%3D" alt="3.gif" loading="lazy"/></p>
<p>当然，也支持3D的预览，不同面进行设计后进行3D渲染。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925c540208144b2384cd44996c9403b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=amlqa2ZP%2BiHvpsRy7plIM%2BjpFuw%3D" alt="4.gif" loading="lazy"/></p>
<h2 data-id="heading-1">丝巾设计平台</h2>
<p>这个平台是帮甲方开发的项目，主要的功能是实现各种印刷图案特效，让用户快速的实现丝巾设计，并且实现丝巾试戴效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06142a51c864064b5635aa4d95f78c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=I6PTClYGA%2Fi7Mo4iDnijIdHRBR4%3D" alt="5.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/200417e281b64cb389abae04fa663bbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=lxDj1rrwQuuXXVaR1bR75T6n7y4%3D" alt="7.gif" loading="lazy"/></p>
<p>丝巾试戴效果
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8b4238494249a6bf15cdc71f395cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=oHIoq7ThIWbY%2Fy85ygX1bHad7BY%3D" alt="8.gif" loading="lazy"/></p>
<p>当然，也有一些常见的AI设计功能，和图片处理相关的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e9d816dae374c8a91b6dd35cade9d03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=Qeom%2FgbZSPS63yjqXKEKiLYTrco%3D" alt="9.gif" loading="lazy"/></p>
<h2 data-id="heading-2">吧唧/亚克力设计</h2>
<p>这个项目我们从头开发了一套定制商城小程序，可以让用户在小程序中快速定制吧唧/亚克力钥匙扣产品，<strong>后端是Node.js + MySql的技术栈</strong>，微信支付等各种功能，<strong>Node.js还是经得起考验的</strong>。</p>
<p>这个项目对我们来说有几个重点</p>
<ol>
<li>小程序商城，支持SKU、阶梯价、物流、折扣、限购、支付等功能。</li>
<li>样机预览，白墨、烫金各种印刷工艺。</li>
<li>打印文件，要有打印机识别的专色通道和拼版功能。</li>
<li>自动刀线，自动根据图片生成刀线文件。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/699016bf4d014f278f5106531d46fe17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=UARxGMRRj81Q%2BR7zv67YsYcaSNE%3D" alt="Foxmail20260105023542.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f9229935bcb428ebc48ab8da1cffc4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=2MAkHyrj87WwJji626CfMaXvTd4%3D" alt="508880516-fbad98cb-24ff-431d-b4b7-314a4e1360e3.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61edc4fdeba845cf94c8a1b71e0c89fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=WZYVAsXv8ZTwaMTn8TrT7qsUL9A%3D" alt="20.gif" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87394c039af2437a9b43eb7e8f95fa79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=VLJhlF%2FTpsv5Br%2FBeztaxsNYvQ4%3D" alt="21.gif" loading="lazy"/></p>
<h2 data-id="heading-3">印花设计</h2>
<p>这个项目主要是让用户根据一张图片快速的生成瓷砖、面料相关的印花，快速实现印花效果，然后渲染到3D模型中，进行预览，确认效果后可以下载连续四方图用于印刷。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f84a486fbb4da3960bdf9254afa7f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=0TWoPBo6UErSFwWh4ksJviADIPs%3D" alt="12.gif" loading="lazy"/></p>
<h2 data-id="heading-4">盒型/刀版设计</h2>
<p>这个项目主要的功能是让客户根据现有的盒型，快速的修改长宽高后，生成新的刀版图和3D模型，用于快速的预览，需要实现平面刀版图和3D模型的参数化，来试实现参数调整后实时渲染的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f49a7a17ca041ca8176ea15e420930c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=pB2jMKw8oxYrjNH8f%2F3WAOyBrNU%3D" alt="13.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69688b9d44fb41cebbadae89ebee39ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=NZpYW6J2keRzu0ykaakaM0M9K1s%3D" alt="dd0184b8-77fe-477b-bf07-49271c70be47.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a35d2fcab6f8444fbd29eff25122d025~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=BUBvhdQurEU8F%2BvoNb98e4embyM%3D" alt="14.gif" loading="lazy"/></p>
<h2 data-id="heading-5">工艺仿真</h2>
<p>这一部分其实是调研的内容，主要是用3D来实现工艺仿真的效果，比如凹凸压痕、不同烫金材质，难度不大，不过涉及的细节比较多。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0572ba85d534974ab0372a9ed39a2ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=W4PbfPGmsiACehgSUJs9AwrxSyM%3D" alt="19_1766385962.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e41331db2654c508f041b4f190dfab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=YcVTpRPBv2nZTR6MggCJ9TINSNc%3D" alt="20_1766385966.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eed7d9689c8b4ca19ccd85ac8ac6ec41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=tBypZNXu%2F696jYivfUQXeIWku6M%3D" alt="20260105-155711.gif" loading="lazy"/></p>
<h2 data-id="heading-6">回顾</h2>
<p>这一年我们去杭州3次，在义乌待了2个月，回忆起来还历历在目为，有艰辛、有收获、有成长，<strong>最感激的是找到了志同道合的兄弟</strong>。</p>
<ol>
<li>新招实习生不出差，自己到客户现场开发。</li>
<li>钱塘江畔驻场开发，与韩国客户用翻译软件面聊。</li>
<li>连续3天联系中介解决团队住宿问题。</li>
<li>解决白墨专色，夜里在义乌杨村满大街找打印机。</li>
<li>解决色差问题对比到眼睛看花，国庆加班赶进度。</li>
<li>找到志同道合的兄弟，多个项目一起跑下来。</li>
</ol>
<p>日夜兼程</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25bcb4187caa4bf3a8201cc32498c881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=2N%2BhtutG%2Bh13XghCmGzj%2BjKFILU%3D" alt="Foxmail20260105045116.png" loading="lazy"/></p>
<p>驻场开发</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce276ab07cdf44feba501586bce0802e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=NFeLPIIUODh7Yf8bLh3afFpJgWA%3D" alt="Foxmail20260105045128.png" loading="lazy"/></p>
<p>驻扎工厂</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd363a29bc874949aaaec8be79073a5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=r3yW9qD3K4jrGLVPvGgq3tVXo2E%3D" alt="Foxmail20260105050020.png" loading="lazy"/></p>
<p>采购电脑和午休床</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d841c9d50c743f4852f9e2a4aff8c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=LjBq0oUPqXUk0XVg2HOGIb7FnL8%3D" alt="Foxmail20260105045657.png" loading="lazy"/></p>
<p>随着同事的加入，我们内部流程也更加规范，需求文档、技术方案、测试用例等等，自卖自夸一下 哈哈，<strong>团队虽小，小巧精悍</strong>，我们完全聚焦在编辑器、定制设计器领域，很多工厂项目让我们积累了宝贵的业务经验。</p>
<h2 data-id="heading-7">总结</h2>
<p>现在AI时代，大家都在唱衰前端，我们最近一年发现<strong>真的扎到场景和业务中，前端开发的机会还是挺大的</strong>，<strong>很多复杂的繁重的专业软件正在被慢慢解构，变成轻量的、简洁的在线软件</strong>，希望明年我们能啃下来更多有难度的项目，结合制造业，服务好更多客户，也祝福大家越来越好，找到自己热爱的事业。</p>
<p>大家感兴趣的可以点个赞和关注，持续向大家汇报进展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不用 Instruments 而在 Windows 环境下测试 iOS App]]></title>    <link>https://juejin.cn/post/7591680281905954843</link>    <guid>https://juejin.cn/post/7591680281905954843</guid>    <pubDate>2026-01-05T09:48:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591680281905954843" data-draft-id="7591681023908200457" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不用 Instruments 而在 Windows 环境下测试 iOS App"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T09:48:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是谁的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2390811467846089"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不用 Instruments 而在 Windows 环境下测试 iOS App
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2390811467846089/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是谁的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:48:41.000Z" title="Mon Jan 05 2026 09:48:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人一提 Windows + iOS，就会下意识联想到能不能写代码、能不能跑 Xcode。</p>
<p>但如果你的目标是测试，而不是编译或签名，其实关注点会完全不同。</p>
<p>在测试阶段，更常见的问题是：</p>
<ul>
<li>App 跑起来之后，资源状态是否正常</li>
<li>某些操作是否引发异常行为</li>
<li>长时间使用后有没有明显退化</li>
</ul>
<p>这些问题，并不一定非要 Xcode 才能回答。</p>
<p>在 Windows 上测试 iOS App 时，我比较常用的是 克魔（KeyMob）。为什么不用PerfDog性能狗？那当然是太贵了。</p>
<hr/>
<h2 data-id="heading-0">真机依然是核心，系统只是入口</h2>
<p>无论在哪个平台，iOS App 的测试核心始终是<strong>真机 iPhone</strong>。</p>
<p>Windows 并不是用来“替代手机”，而是作为一个观察和分析的窗口。</p>
<p>我比较认可的一种思路是：</p>
<ul>
<li>手机负责运行</li>
<li>Windows 负责看和分析</li>
</ul>
<p>只要信息能稳定拿到，系统本身并不是关键。</p>
<hr/>
<h2 data-id="heading-1">系统自带能力，先别忽略</h2>
<p>在工具之前，其实可以先用 iOS 系统本身提供的信息做基础判断。</p>
<p>例如：</p>
<ul>
<li>电池使用情况，能看到 App 的耗电占比</li>
<li>屏幕时间，能确认前后台使用时长</li>
</ul>
<p>这些数据虽然粗，但能快速判断“是不是这个 App 有异常趋势”。</p>
<p>当确认有问题，再进入更细的测试阶段。</p>
<hr/>
<h2 data-id="heading-2">Windows 上的性能观察，并不一定要“完整”</h2>
<p>很多人会纠结：没有 Instruments，是不是就没法做性能测试？</p>
<p>现实中，大部分测试并不需要极致精细的调用栈分析，而是需要回答一些更直观的问题：</p>
<ul>
<li>CPU 是否长期偏高</li>
<li>内存是否只涨不降</li>
<li>帧率是否在某些页面明显下降</li>
<li>网络是否在后台仍然活跃</li>
</ul>
<p>这些问题，更偏向“运行状态观察”。</p>
<hr/>
<h2 data-id="heading-3">使用 KeyMob，把状态直接拉到 Windows</h2>
<p>在 Windows 上测试 iOS App 时，我比较常用的是 <strong>克魔（KeyMob）</strong>。为什么不用PerfDog性能狗？那当然是太贵了。</p>
<p>它的使用方式很直接：</p>
<ul>
<li>iPhone 连接 Windows</li>
<li>App 正常运行</li>
<li>在电脑上实时看到性能变化</li>
</ul>
<p>KeyMob 提供的并不是单一数值，而是一段时间内的变化过程，比如：</p>
<ul>
<li>CPU、GPU 的波动</li>
<li>内存是否持续增长</li>
<li>网络活动是否符合预期</li>
<li>帧率在真实操作中的表现</li>
</ul>
<p>这对于测试阶段非常友好。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/609e29011c8f490d88790105408f3eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv6LCB55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211321&amp;x-signature=1qOIn76a1b9YGDz9Pv9%2FuKmUqME%3D" alt="性能监控" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">日志，在 Windows 测试中价值更高</h2>
<p>如果你没有 Xcode，日志的重要性会被放大。</p>
<p>在测试中，经常会遇到：</p>
<ul>
<li>某个操作后状态异常</li>
<li>但无法立即复现</li>
<li>或只在某些设备上出现</li>
</ul>
<p>这时，如果能在 Windows 上直接查看实时日志，定位成本会低很多。</p>
<p>KeyMob 的实时日志功能，基本覆盖了常见测试需求，不需要额外的 Mac 环境。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5960139c9783446b92467ec175c3b2af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv6LCB55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211321&amp;x-signature=qU5%2FBY6eB5RlMvi1iZzyJP5c9RI%3D" alt="实时日志" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">网络与文件，也是测试的一部分</h2>
<p>在 iOS App 测试中，性能并不总是唯一目标。</p>
<p>很多问题来自于：</p>
<ul>
<li>请求是否重复</li>
<li>缓存是否合理</li>
<li>数据文件是否异常增长</li>
</ul>
<p>通过 <strong>Charles / Fiddler</strong> 观察网络，再结合 KeyMob 的 iOS 文件管理功能，
在 Windows 上直接查看 App 的数据目录，有时反而比 Xcode 更直观。</p>
<hr/>
<h2 data-id="heading-6">Xcode 依然有价值，但不一定天天用</h2>
<p>需要说明的是，Xcode 和 Instruments 依然不可替代。</p>
<p>当你需要：</p>
<ul>
<li>精确定位某段代码</li>
<li>分析底层调用</li>
<li>处理复杂内存问题</li>
</ul>
<p>macOS 环境是必须的。</p>
<p>但在日常测试阶段，Windows + 真机 + 合适的工具组合，已经可以覆盖很大一部分工作量。</p>
<hr/>
<h2 data-id="heading-7">一种比较实际的 Windows 测试组合</h2>
<p>结合实际项目经验，常见的一种搭配是：</p>
<ul>
<li><strong>iPhone 真机</strong>：真实运行环境</li>
<li><strong>KeyMob（Windows）</strong>：性能、日志、使用记录、文件管理</li>
<li><strong>Charles / Fiddler</strong>：网络行为验证</li>
<li><strong>系统统计信息</strong>：趋势判断</li>
</ul>
<p>这样一套组合，更偏向“持续观察”，而不是一次性测试。
参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkeymob.com%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://keymob.com/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">keymob.com/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Comate开发我的第一个MCP——让Vibe Coding长长脑子]]></title>    <link>https://juejin.cn/post/7591655106724102144</link>    <guid>https://juejin.cn/post/7591655106724102144</guid>    <pubDate>2026-01-05T09:49:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591655106724102144" data-draft-id="7591456613535711232" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Comate开发我的第一个MCP——让Vibe Coding长长脑子"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-01-05T09:49:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Comate开发我的第一个MCP——让Vibe Coding长长脑子
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:49:06.000Z" title="Mon Jan 05 2026 09:49:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：</p>
<p>孙鹏，资深后端开发工程师，积极拥抱Vibe Coding，热衷于探索日常业务开发与AI IDE的组合方式，将AI赋能提效真正落实在一线业务开发场景中，擅长复盘总结AI Coding过程中的经验，从而使AI Coding与业务开发深度结合。作品「Recall Kit」入围“CCF程序员大会码力全开：AI加速营”活动决赛，并获得“最佳提效奖” 。</p>
</blockquote>
<p>最近Cursor的计费上调，让我不得不寻找新的AI IDE工具，之前已经试用过国内几款主流的AI IDE工具，效果都不是很理想。近期听说百度Comate的Zulu智能体编程最近有比较大升级，编程效果不错，正好手头有个<strong>开发MCP工具</strong>的想法，试试Comate能力的同时，也熟悉一下MCP工具的开发流程，一举多得。</p>
<p>简单说下对这个MCP工具的想法：<strong>可以记录自己在Vibe Coding过程中的踩坑经验，并在类似情况再次发生时，自动检索过去的经验，快速定位问题并解决，避免浪费开发者时间和大量token浪费。</strong> 下文是完整的实测记录与体会。</p>
<h2 data-id="heading-0">1. 🚀 开始</h2>
<p>那么就开始试试Comate的能力怎么样吧，也顺便验证一下它在复杂MCP流程中的稳定度。</p>
<h3 data-id="heading-1">1.1 📦 安装MCP</h3>
<p>开发前，先配置一下常用的两个MCP：Supabase和Context7。<strong>在Comate中配置MCP也非常简单：</strong> 展开AI侧边栏，点击右上角的MCP，在MCP市场搜索并添加就可以。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65153e7ae5894ac49ec2c0e81a542a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=ikVR1ON2jTKLE8%2B0TROcgdmp5nI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Supabase（Supabse是个开箱即用的数据库+后端平台，我会用它来存储我的‘踩坑经验’。）在MCP市场里找不到～没关系！点击右上角手动配置，打开json文件，手动添加就可以了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db104dc60e764394bffad6ef2fab877f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=Ldf2Dwq%2FfXRGDlurUdOt0FZNYkQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-2">1.2 🗂️ 文档生成</h3>
<p>正常来说，接下来我就可以直接和 Zulu 智能体对话，着手开发我的「AI 开发经验记录 MCP」了。不过，针对这个MCP工具我还有一些想法，比如有个后台管理，还要有搜索页面，加在一起就有些复杂了。<strong>针对这种复杂的项目，我习惯先使用Spec Kit工具先生成文档（包含项目章程、需求、设计、数据模型、任务拆分、验收清单等）</strong> ，生成后的文档如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eefb032ab20040508582567477b07d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=Iv%2B%2F3VEgM35fnyo%2FMKB7dMLB5sY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>后来，我了解到Comate也有Spec模式，试了一下非常好用！Comate的SPEC模式将开发过程以及关键产物全部呈现出来，可以随时查看、修改，甚至可以回退到上个步骤，让AI的工作不再是黑盒，而是一个可见可干预的协作过程</strong>。</p>
<h2 data-id="heading-3">2. 🤖 Zulu智能体启动</h2>
<p>等所有文档都生成完，终于轮到 Zulu 智能体真正发力了！我一口气把所有文档全塞给它，基本没再多解释。Zulu 会先把文档<strong>整体读一遍，搞清楚完整需求在干嘛</strong>，而不是只盯着某一小段指令。接着它把事情<strong>自动拆成了 7 个待办任务</strong>，还能分清先做什么、后做什么，就按优先级一个个往下实现。整个过程几乎不需要我反复指挥。这时候能明显感觉到 Comate 的价值不只是“帮你写代码”，而是<strong>真的在帮你接手一个开发任务</strong>：理解背景、拆任务、排顺序、持续推进，把一整段开发流程跑得很顺。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f021db9e22846b59215e3a6c652712f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=AQrrb1R4UPB6Ky2FjZ5l%2FhdOw9E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>整个Coding过程还是很出乎意料的，有时候 Comate 会觉得自己手里的信息还不太够，于是停下来确认一下，这其实挺正常的。这时候有个小窍门：<strong>如果你觉得整体思路没问题，只是不想被打断流程，直接回一句「继续」就行</strong>，Comate 会按现在的上下文接着往下跑。期间并没有什么卡点，非常顺<strong>利得将整个项目的功能都实现了一遍</strong>。当然并不是说整个项目就开发好了，但基本上也有60%~70%的完成度了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15340726f53d454b9779d62f6db60e08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=7w03T7LLLlHxMqAPohi10wt%2B8to%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>期间闹了个小乌龙，因为我对MCP的了解不够深入，以为MCP的client也需要开发，所以写在文档中了，其实这部分是不用开发的，浪费了不少请求次数。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4733b3e46fe47dead2e0554ea6837fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=F%2BGECCaJQ6HyfFh8tPEyULmKUhA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>接下来基本就是大家都很熟悉的流程了：启动 → 运行 → 报错 → 修复 → 再启动。但有了 Comate 之后，这个过程明显轻松了很多。一旦报错，直接把报错信息丢给 Comate，它能结合<strong>当前代码、上下文和刚才的改动</strong>一起看问题，而不是只给一些泛泛的猜测。很多时候它能很快定位到是哪一块逻辑不对、是配置问题还是代码本身有坑，然后直接给出可改的方案，甚至顺手把代码一起修了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0fd68a511584708a3271d91f912c220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=61%2BLoxTgEXhkCHwh4eEmfZswRBw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-4">3. 🌟 点名表扬</h2>
<p>开发期间最让我感到意外和好用的是这个功能：用 Comate 内置的浏览器改前端真的太爽了。可以直接在页面上<strong>点选具体元素</strong>，哪块不对点哪块，再用自然语言说一句要怎么改，基本就是“指哪改哪”。相比以前只能靠一段自然语言去描述「大概是左边那个按钮、上面那行字」，现在这种<strong>精准选中 + 自然语言修改</strong>的方式，效率高太多了，也几乎不会改错地方，整个过程很流畅。这个功能也是我另一个项目灵感来源，这里就不展开说了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f33b0f46b5e44faab84920d689de57a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=PO%2FiHpbIE93RTwkdiPHDi%2FZafn4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-5">4. 🧾总结</h2>
<p>Comate的Zulu智能体整体使用下来的感觉很好，个人专业版模式下响应速度很快，产出的代码质量也很高，不过在一些Bug修复、问题解决的能力上还有提升空间。“CCF程序员大会码力全开：AI加速营”比赛期间赠送的个人专业版权益次数比我预想得更加耐用一些，开发一个小项目不成问题。</p>
<p>不过期间IDE还是有些小问题，比如直接选择页面元素，使用浏览器打开后，选中的元素无法带回对话框内，只有在IDE内打开才行；另外不支持自定义命令让我很不习惯，之前自己整理了很多自定义命令都没用上。整体来看，它仍旧是当前国内体验最能打的AI IDE之一。</p>
<h2 data-id="heading-6">5. 🎬作品演示（Recall Kit）</h2>
<p><strong>首页</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88daf18fd73040a98c9380aa7e4ffa63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=VbuQT21sUkv96ZZ%2BjkvFg3glM1Q%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>搜索页（向量检索）</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e7c72c857134fc1864da1a9c6d915d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=9SQ5LKoA8djLVUJGv7GCO1dx%2F8c%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>后台</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2fdbb74355c4efea3de30a753cfda36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211346&amp;x-signature=F66PZaJ7tvDmoNcwvlwyFP6dY2U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>最后，附上产品演示视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1F3UnBjEfK%2Fvd_source%3D6925f72b567b69e9d2d49ef7d6f1c711%25EF%25BC%258C" target="_blank" title="https://www.bilibili.com/video/BV1F3UnBjEfK/vd_source=6925f72b567b69e9d2d49ef7d6f1c711%EF%BC%8C" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1F3…</a> 感兴趣的小伙伴可以试试看哦👉👉WEB端访问地址（演示账号：comate/comate666）：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.codeva-cn.com%3A3100%2F" target="_blank" title="http://www.codeva-cn.com:3100/" ref="nofollow noopener noreferrer">www.codeva-cn.com:3100/</a></p>
<p>一键下载Comate，感受AI编程的神奇吧～</p>
<p><strong>下载途径一：</strong> 百度搜索“文心快码”，官网下载Comate AI IDE；</p>
<p><strong>下载途径二：</strong> VS Code 或者 Jetbrains 系列 IDE 搜索并下载文心快码插件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Java基础整理】封装、继承、抽象、接口和多态]]></title>    <link>https://juejin.cn/post/7591439305262022691</link>    <guid>https://juejin.cn/post/7591439305262022691</guid>    <pubDate>2026-01-05T09:19:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591439305262022691" data-draft-id="7591456613535645696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Java基础整理】封装、继承、抽象、接口和多态"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-05T09:19:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乌日尼乐"/> <meta itemprop="url" content="https://juejin.cn/user/854736525882123"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Java基础整理】封装、继承、抽象、接口和多态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/854736525882123/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乌日尼乐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:19:58.000Z" title="Mon Jan 05 2026 09:19:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java面向对象编程：封装、继承、抽象、接口和多态</h2>
<h3 data-id="heading-1">摘要</h3>
<p>本文档详细介绍Java面向对象编程的五大核心概念：封装、继承、抽象类、接口和多态。通过理论阐述和代码示例，帮助读者深入理解Java面向对象编程的精髓和实际应用。</p>
<hr/>
<h3 data-id="heading-2">目录</h3>
<ol>
<li><a href="#%E5%B0%81%E8%A3%85" title="#%E5%B0%81%E8%A3%85">封装</a></li>
<li><a href="#%E7%BB%A7%E6%89%BF" title="#%E7%BB%A7%E6%89%BF">继承</a></li>
<li><a href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB" title="#%E6%8A%BD%E8%B1%A1%E7%B1%BB">抽象类</a></li>
<li><a href="#%E6%8E%A5%E5%8F%A3" title="#%E6%8E%A5%E5%8F%A3">接口</a></li>
<li><a href="#%E5%A4%9A%E6%80%81" title="#%E5%A4%9A%E6%80%81">多态</a></li>
</ol>
<hr/>
<h3 data-id="heading-3">封装</h3>
<h4 data-id="heading-4">定义</h4>
<p><strong>封装</strong>是指隐藏对象的属性和实现细节，仅对外提供公共访问方式。这是面向对象编程的基本原则之一。</p>
<h4 data-id="heading-5">权限修饰符</h4>
<p>Java提供了四种访问权限修饰符来控制成员的访问级别：</p>






























<table><thead><tr><th>修饰符</th><th>访问范围</th><th>描述</th></tr></thead><tbody><tr><td><code>private</code></td><td>仅本类内部</td><td>私有的，只在本类中有效</td></tr><tr><td><code>default</code>（默认）</td><td>同包内</td><td>包访问权限，同一包内可访问</td></tr><tr><td><code>protected</code></td><td>同包内 + 子类</td><td>保护的，只有子类可以调用</td></tr><tr><td><code>public</code></td><td>所有地方</td><td>公开的，对所有用户开放</td></tr></tbody></table>
<h4 data-id="heading-6">权限修饰符使用规则</h4>
<h5 data-id="heading-7">类的权限修饰符</h5>
<ul>
<li><strong>类</strong>只能使用 <code>public</code> 和 <code>default</code>（默认）权限修饰符</li>
<li><code>public</code> 类可以被任何地方访问</li>
<li><code>default</code> 类只能在同一包内被访问</li>
</ul>
<h5 data-id="heading-8">成员的权限修饰符</h5>
<ul>
<li><strong>成员变量和方法</strong>可以使用所有四种权限修饰符</li>
<li>权限修饰符置于类的成员定义前，限定其他对象的访问权限</li>
</ul>
<h4 data-id="heading-9">封装示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-comment">// 私有属性，外部无法直接访问</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    
    <span class="hljs-comment">// 公共的getter方法</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    
    <span class="hljs-comment">// 公共的setter方法，可以添加验证逻辑</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span> &amp;&amp; !name.trim().isEmpty()) {
            <span class="hljs-built_in">this</span>.name = name;
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-keyword">if</span> (age &gt; <span class="hljs-number">0</span> &amp;&amp; age &lt; <span class="hljs-number">150</span>) {
            <span class="hljs-built_in">this</span>.age = age;
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">继承</h3>
<h4 data-id="heading-11">定义</h4>
<p><strong>继承</strong>是类与类之间的关系，子类可以直接使用父类的方法和属性。在Java中使用 <code>extends</code> 关键字实现继承。</p>
<pre><code class="hljs language-java" lang="java">子类 extends 父类
</code></pre>
<h4 data-id="heading-12">继承的作用</h4>
<ol>
<li><strong>提高代码的复用性</strong> - 子类可以重用父类的代码</li>
<li><strong>建立类与类之间的关系</strong> - 形成继承层次结构</li>
</ol>
<h4 data-id="heading-13">继承使用注意事项</h4>
<p>⚠️ <strong>重要原则</strong>：千万不要为了获取其他类的功能、简化代码而继承！</p>
<ul>
<li>必须是类与类之间有关系或有共性才可以继承</li>
<li>继承应该体现"is-a"关系</li>
</ul>
<h4 data-id="heading-14">单继承</h4>
<p>Java只支持<strong>单继承</strong>，不支持多继承：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ✅ 正确：单继承</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> { }

<span class="hljs-comment">// ❌ 错误：多继承（Java不支持）</span>
<span class="hljs-comment">// class Dog extends Animal, Pet { }</span>
</code></pre>
<p><strong>为什么不支持多继承？</strong></p>
<ul>
<li>多继承容易带来隐患</li>
<li>当多个父类定义相同功能但内容不同时，子类对象不确定运行哪个</li>
<li>Java通过<strong>接口的多实现</strong>来完成多继承的表示</li>
</ul>
<h4 data-id="heading-15">成员变量访问</h4>
<p>当子类中出现与父类同名的成员变量时：</p>




















<table><thead><tr><th>关键字</th><th>访问对象</th><th>说明</th></tr></thead><tbody><tr><td><code>this</code></td><td>本类对象</td><td>访问子类中的同名变量</td></tr><tr><td><code>super</code></td><td>父类对象</td><td>访问父类中的同名变量</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"父类"</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"子类"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showNames</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"子类名称: "</span> + <span class="hljs-built_in">this</span>.name);    <span class="hljs-comment">// 输出: 子类</span>
        System.out.println(<span class="hljs-string">"父类名称: "</span> + <span class="hljs-built_in">super</span>.name);   <span class="hljs-comment">// 输出: 父类</span>
    }
}
</code></pre>
<h4 data-id="heading-16">方法重写（Override）</h4>
<p>当子类中出现与父类<strong>完全相同</strong>的方法时，子类对象调用该方法会运行子类方法的内容。</p>
<h5 data-id="heading-17">重载 vs 重写对比</h5>








































<table><thead><tr><th>特性</th><th>重载（Overload）</th><th>重写（Override）</th></tr></thead><tbody><tr><td>英文名</td><td>Overload</td><td>Override</td></tr><tr><td>发生位置</td><td>同一个类中</td><td>父子类之间</td></tr><tr><td>方法名</td><td>相同</td><td>相同</td></tr><tr><td>参数列表</td><td>不同</td><td>相同</td></tr><tr><td>返回值</td><td>可以不同</td><td>必须相同（或协变）</td></tr><tr><td>访问修饰符</td><td>可以不同</td><td>不能更严格</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"动物发出声音"</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// 建议使用注解</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"汪汪汪"</span>);
    }
}
</code></pre>
<h4 data-id="heading-18">构造函数与继承</h4>
<h5 data-id="heading-19">重要规则</h5>
<ol>
<li>子类对象初始化时，父类的构造函数也会运行</li>
<li>子类所有构造函数默认第一行都有隐式语句：<code>super();</code></li>
<li>会优先访问父类中的<strong>无参构造函数</strong></li>
</ol>
<h5 data-id="heading-20">构造函数调用顺序</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Parent</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"父类无参构造函数"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Parent</span><span class="hljs-params">(String name)</span> {
        System.out.println(<span class="hljs-string">"父类有参构造函数: "</span> + name);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Child</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 隐式调用 super();</span>
        System.out.println(<span class="hljs-string">"子类无参构造函数"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Child</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">super</span>(name);  <span class="hljs-comment">// 显式调用父类有参构造函数</span>
        System.out.println(<span class="hljs-string">"子类有参构造函数"</span>);
    }
}
</code></pre>
<h5 data-id="heading-21">特殊情况处理</h5>
<p>当父类没有无参构造函数时：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-comment">// 只有有参构造函数，没有无参构造函数</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Parent</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Child</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">"默认名称"</span>);  <span class="hljs-comment">// 必须显式调用父类构造函数</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Child</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">super</span>(name);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-22">抽象类</h3>
<h4 data-id="heading-23">定义</h4>
<p>当多个类中出现相同功能，但功能主体不同时，可以向上抽取。只抽取功能定义，而不抽取功能主体，这就形成了<strong>抽象类</strong>。</p>
<h4 data-id="heading-24">abstract修饰符</h4>




















<table><thead><tr><th>修饰对象</th><th>描述</th><th>特点</th></tr></thead><tbody><tr><td><strong>抽象类</strong></td><td>由<code>abstract</code>修饰的类</td><td>无法被直接实例化</td></tr><tr><td><strong>抽象方法</strong></td><td>由<code>abstract</code>修饰的方法</td><td>只有声明，没有实现</td></tr></tbody></table>
<h4 data-id="heading-25">抽象类的实现</h4>
<p>抽象类必须有子类<strong>完全重写所有抽象方法</strong>才能使用：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抽象类</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-comment">// 普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"动物在睡觉"</span>);
    }
    
    <span class="hljs-comment">// 抽象方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">move</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 具体实现类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"汪汪汪"</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">move</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"狗在跑"</span>);
    }
}
</code></pre>
<h4 data-id="heading-26">抽象类特点</h4>
<ol>
<li>✅ <strong>用<code>abstract</code>修饰</strong></li>
<li>✅ <strong>类中可以有抽象方法</strong></li>
<li>❌ <strong>无法被直接创建对象</strong></li>
<li>✅ <strong>可以有普通方法和成员变量</strong></li>
<li>✅ <strong>可以有构造方法</strong>（供子类调用）</li>
</ol>
<h4 data-id="heading-27">抽象类使用示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">protected</span> String color;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Shape</span><span class="hljs-params">(String color)</span> {
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-comment">// 抽象方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPerimeter</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// 普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayInfo</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"形状颜色: "</span> + color);
        System.out.println(<span class="hljs-string">"面积: "</span> + getArea());
        System.out.println(<span class="hljs-string">"周长: "</span> + getPerimeter());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> radius;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Circle</span><span class="hljs-params">(String color, <span class="hljs-type">double</span> radius)</span> {
        <span class="hljs-built_in">super</span>(color);
        <span class="hljs-built_in">this</span>.radius = radius;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Math.PI * radius * radius;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getPerimeter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * Math.PI * radius;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">接口</h3>
<h4 data-id="heading-29">定义</h4>
<p><strong>接口</strong>可以认为是一个特殊的抽象类，接口中的方法全部都是抽象方法。子类使用 <code>implements</code> 关键字来实现接口。</p>
<h4 data-id="heading-30">接口成员定义</h4>
<p>接口中的成员有固定的修饰符：</p>




















<table><thead><tr><th>成员类型</th><th>默认修饰符</th><th>说明</th></tr></thead><tbody><tr><td><strong>常量</strong></td><td><code>public static final</code></td><td>必须初始化，不可修改</td></tr><tr><td><strong>方法</strong></td><td><code>public abstract</code></td><td>抽象方法，无实现</td></tr></tbody></table>
<h5 data-id="heading-31">为什么是这些修饰符？</h5>
<ul>
<li><strong>public</strong>：接口需要被实现，必须公开</li>
<li><strong>static</strong>：接口不能被实例化，常量只能是静态的</li>
<li><strong>final</strong>：接口不能有对象，常量必须是固定的</li>
<li><strong>abstract</strong>：接口中只有抽象方法</li>
</ul>
<h4 data-id="heading-32">接口定义示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Drawable</span> {
    <span class="hljs-comment">// 常量（自动加上 public static final）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">MAX_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    
    <span class="hljs-comment">// 抽象方法（自动加上 public abstract）</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span>;
}
</code></pre>
<h4 data-id="heading-33">接口特点</h4>
<ol>
<li>❌ <strong>接口不能创建对象</strong>（因为有抽象方法）</li>
<li>✅ <strong>必须被子类完全实现</strong>所有抽象方法</li>
<li>✅ <strong>支持多实现</strong>（一个类可以实现多个接口）</li>
<li>✅ <strong>接口可以继承接口</strong>（支持多继承）</li>
</ol>
<h4 data-id="heading-34">接口多实现示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Swimmable</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 类可以实现多个接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Flyable</span>, Swimmable {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"鸭子在飞"</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swim</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"鸭子在游泳"</span>);
    }
}
</code></pre>
<h4 data-id="heading-35">接口继承接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">B</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 接口可以继承多个接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">C</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>, B {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 实现类必须实现所有方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">C</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* 实现A */</span> }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* 实现B */</span> }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* 实现C */</span> }
}
</code></pre>
<p>⚠️ <strong>注意</strong>：多个父接口不能有不同返回值类型的同名方法。</p>
<hr/>
<h3 data-id="heading-36">多态</h3>
<h4 data-id="heading-37">定义</h4>
<p><strong>多态</strong>可以理解为事物存在的多种体现形态。在Java中，父类的引用可以接收子类对象。</p>
<h4 data-id="heading-38">多态的体现</h4>
<p><strong>核心表现</strong>：父类的引用指向子类对象</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 最简单的例子</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// List是ArrayList的父接口</span>

<span class="hljs-comment">// 动物多态示例</span>
<span class="hljs-type">Animal</span> <span class="hljs-variable">animal1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();     <span class="hljs-comment">// 父类引用指向子类对象</span>
<span class="hljs-type">Animal</span> <span class="hljs-variable">animal2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();     <span class="hljs-comment">// 同一个引用类型，不同的实际对象</span>
</code></pre>
<h4 data-id="heading-39">多态的前提</h4>
<ol>
<li>✅ <strong>必须有继承关系</strong>（继承或实现）</li>
<li>✅ <strong>必须有方法重写</strong>（这样多态使用才有意义）</li>
</ol>
<h4 data-id="heading-40">多态的好处</h4>
<p><strong>提高程序的扩展性</strong>：前期定义父类引用，后期可以调用新的子类对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimalManager</span> {
    <span class="hljs-comment">// 面向父类编程，支持所有子类</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeAnimalSound</span><span class="hljs-params">(Animal animal)</span> {
        animal.makeSound();  <span class="hljs-comment">// 具体调用哪个取决于传入的对象类型</span>
    }
}

<span class="hljs-comment">// 使用时的扩展性</span>
<span class="hljs-type">AnimalManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnimalManager</span>();
manager.makeAnimalSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());    <span class="hljs-comment">// 输出: 汪汪汪</span>
manager.makeAnimalSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>());    <span class="hljs-comment">// 输出: 喵喵喵</span>
manager.makeAnimalSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>());   <span class="hljs-comment">// 新增类型，无需修改代码</span>
</code></pre>
<h4 data-id="heading-41">多态的局限性</h4>
<p><strong>只能访问父类成员</strong>：多态中只能使用父类的引用访问父类中的成员，无法获取子类特有成员。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> { System.out.println(<span class="hljs-string">"动物吃东西"</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> { System.out.println(<span class="hljs-string">"狗吃骨头"</span>); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bark</span><span class="hljs-params">()</span> { System.out.println(<span class="hljs-string">"汪汪汪"</span>); }  <span class="hljs-comment">// 子类特有方法</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPolymorphism</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
        animal.eat();     <span class="hljs-comment">// ✅ 可以调用，运行子类重写的方法</span>
        <span class="hljs-comment">// animal.bark(); // ❌ 编译错误！父类引用无法调用子类特有方法</span>
    }
}
</code></pre>
<h4 data-id="heading-42">多态中成员调用规则</h4>
<h5 data-id="heading-43">方法调用规则</h5>






























<table><thead><tr><th>情况</th><th>调用规则</th><th>示例</th></tr></thead><tbody><tr><td>子类重写了父类方法</td><td>调用子类方法</td><td><code>B子类的method1</code></td></tr><tr><td>子类没有重写</td><td>调用父类方法</td><td><code>A父类的method2</code></td></tr><tr><td>父类没有该方法</td><td>编译时错误</td><td>无法编译</td></tr><tr><td>静态方法</td><td>调用父类静态方法</td><td><code>A父类的static方法</code></td></tr></tbody></table>
<h5 data-id="heading-44">详细示例</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 定义父类A</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"A父类的method1"</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">method2</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"A父类的method2"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodS</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"A父类的static方法"</span>);
    }
}

<span class="hljs-comment">// 定义子类B继承了A</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">method1</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"B子类的method1"</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">method3</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"B子类的method3"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodS</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"B子类的static方法"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphismDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();
        a.method1();  <span class="hljs-comment">// 输出: B子类的method1 （子类重写了）</span>
        a.method2();  <span class="hljs-comment">// 输出: A父类的method2 （子类没重写）</span>
        a.methodS();  <span class="hljs-comment">// 输出: A父类的static方法 （静态方法看引用类型）</span>
        <span class="hljs-comment">// a.method3(); // 编译错误！父类引用无法获取子类特有成员</span>
    }
}
</code></pre>
<h5 data-id="heading-45">成员变量调用规则</h5>
<p><strong>重要</strong>：成员变量<strong>不存在重写</strong>，无论编译还是运行都参考引用类型（父类）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">"A父类"</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">"B子类"</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphismDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();
        System.out.println(a.s);  <span class="hljs-comment">// 输出: A父类</span>
    }
}
</code></pre>
<h4 data-id="heading-46">多态的应用</h4>
<h5 data-id="heading-47">类型转换</h5>
<h6 data-id="heading-48">向上转型（自动）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();  <span class="hljs-comment">// 自动向上转型</span>
</code></pre>
<h6 data-id="heading-49">向下转型（强制）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-type">Dog</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> (Dog) animal;     <span class="hljs-comment">// 强制向下转型</span>
dog.bark();                 <span class="hljs-comment">// 现在可以调用子类特有方法了</span>
</code></pre>
<h6 data-id="heading-50">安全的向下转型</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();

<span class="hljs-comment">// 使用 instanceof 判断类型</span>
<span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> Dog) {
    <span class="hljs-type">Dog</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> (Dog) animal;
    dog.bark();
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> Cat) {
    <span class="hljs-type">Cat</span> <span class="hljs-variable">cat</span> <span class="hljs-operator">=</span> (Cat) animal;
    cat.meow();
}
</code></pre>
<h5 data-id="heading-51">多态实际应用示例</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 图形绘制系统</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> radius;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Circle</span><span class="hljs-params">(<span class="hljs-type">double</span> radius)</span> { <span class="hljs-built_in">this</span>.radius = radius; }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> { System.out.println(<span class="hljs-string">"绘制圆形"</span>); }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> Math.PI * radius * radius; }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> width, height;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Rectangle</span><span class="hljs-params">(<span class="hljs-type">double</span> width, <span class="hljs-type">double</span> height)</span> {
        <span class="hljs-built_in">this</span>.width = width;
        <span class="hljs-built_in">this</span>.height = height;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> { System.out.println(<span class="hljs-string">"绘制矩形"</span>); }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getArea</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> width * height; }
}

<span class="hljs-comment">// 图形管理器 - 体现多态的威力</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ShapeManager</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawAllShapes</span><span class="hljs-params">(Shape[] shapes)</span> {
        <span class="hljs-keyword">for</span> (Shape shape : shapes) {
            shape.draw();  <span class="hljs-comment">// 多态调用，具体调用哪个draw取决于实际对象类型</span>
            System.out.println(<span class="hljs-string">"面积: "</span> + shape.getArea());
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphismApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Shape[] shapes = {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-number">5.0</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>(<span class="hljs-number">4.0</span>, <span class="hljs-number">6.0</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-number">3.0</span>)
        };
        
        <span class="hljs-type">ShapeManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShapeManager</span>();
        manager.drawAllShapes(shapes);  <span class="hljs-comment">// 多态的实际应用</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-52">总结</h3>
<h4 data-id="heading-53">Java面向对象五大特性关系图</h4>
<pre><code class="hljs language-markdown" lang="markdown">面向对象编程
├── 封装（Encapsulation）
│   ├── 隐藏内部实现
│   ├── 提供公共接口
│   └── 控制访问权限
├── 继承（Inheritance）
│   ├── 代码复用
│   ├── 建立类层次
│   └── 单继承限制
├── 抽象（Abstraction）
│   ├── 抽象类
│   ├── 抽象方法
│   └── 模板模式
├── 接口（Interface）
│   ├── 规范定义
│   ├── 多实现
│   └── 接口继承
└── 多态（Polymorphism）
<span class="hljs-code">    ├── 编译时多态（重载）
    ├── 运行时多态（重写）
    └── 类型转换
</span></code></pre>
<h4 data-id="heading-54">核心概念对比</h4>









































<table><thead><tr><th>概念</th><th>关键字</th><th>主要作用</th><th>特点</th></tr></thead><tbody><tr><td><strong>封装</strong></td><td><code>private/protected/public</code></td><td>隐藏实现细节</td><td>控制访问权限</td></tr><tr><td><strong>继承</strong></td><td><code>extends</code></td><td>代码复用</td><td>单继承，is-a关系</td></tr><tr><td><strong>抽象</strong></td><td><code>abstract</code></td><td>定义规范</td><td>不能实例化</td></tr><tr><td><strong>接口</strong></td><td><code>interface/implements</code></td><td>规范约束</td><td>多实现，全抽象</td></tr><tr><td><strong>多态</strong></td><td>重写<code>@Override</code></td><td>灵活扩展</td><td>父类引用指向子类对象</td></tr></tbody></table>
<h4 data-id="heading-55">设计原则</h4>
<ol>
<li><strong>封装原则</strong>：高内聚，低耦合</li>
<li><strong>继承原则</strong>：遵循is-a关系，避免为了复用而继承</li>
<li><strong>抽象原则</strong>：面向抽象编程，而非具体实现</li>
<li><strong>接口原则</strong>：依赖抽象，而非具体</li>
<li><strong>多态原则</strong>：开闭原则，对扩展开放，对修改关闭</li>
</ol>
<h4 data-id="heading-56">实战建议</h4>
<ol>
<li>
<p><strong>合理使用封装</strong>：</p>
<ul>
<li>成员变量设为private</li>
<li>提供public的getter/setter方法</li>
<li>在setter中添加验证逻辑</li>
</ul>
</li>
<li>
<p><strong>正确使用继承</strong>：</p>
<ul>
<li>确保是is-a关系</li>
<li>避免为了复用而继承</li>
<li>优先使用组合而非继承</li>
</ul>
</li>
<li>
<p><strong>善用抽象和接口</strong>：</p>
<ul>
<li>抽象类用于有共同实现的场景</li>
<li>接口用于定义规范和约束</li>
<li>面向接口编程</li>
</ul>
</li>
<li>
<p><strong>充分利用多态</strong>：</p>
<ul>
<li>参数和返回值使用父类型</li>
<li>利用多态实现可扩展的设计</li>
<li>合理使用类型转换</li>
</ul>
</li>
</ol>
<p>通过深入理解和实践这五大特性，能够编写出更加优雅、可维护和可扩展的Java代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust 像素级绘图入门：Pixels 库核心机制解析]]></title>    <link>https://juejin.cn/post/7591655106723823616</link>    <guid>https://juejin.cn/post/7591655106723823616</guid>    <pubDate>2026-01-05T09:25:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591655106723823616" data-draft-id="7591465142452502580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 像素级绘图入门：Pixels 库核心机制解析"/> <meta itemprop="keywords" content="后端,Rust"/> <meta itemprop="datePublished" content="2026-01-05T09:25:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日升月潜"/> <meta itemprop="url" content="https://juejin.cn/user/3373725557203608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 像素级绘图入门：Pixels 库核心机制解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3373725557203608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日升月潜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:25:57.000Z" title="Mon Jan 05 2026 09:25:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">Rust 像素级绘图入门：Pixels 库核心机制解析</h2>
<p>在现代游戏开发中，我们习惯了使用已经封装好的引擎（如 Bevy 或 Godot）。但如果你想回归原始，像 80 年代的工程师一样​<strong>直接控制屏幕上的每一个像素点</strong>​，那么 <code>pixels</code> 库是 Rust 生态中的首选。</p>
<p>我们将通过一个<strong>反弹方块</strong>的极简程序，来进行Pixels 库的学习。</p>
<h3 data-id="heading-1">一、完整代码</h3>
<h4 data-id="heading-2">1. 目录结构</h4>
<pre><code class="hljs language-rust" lang="rust">untitled8
├── src
│   └── main.rs
├── Cargo.lock
└── Cargo.toml
</code></pre>
<h4 data-id="heading-3">2. Cargo.toml</h4>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"untitled8"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2024"</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">pixels</span> = <span class="hljs-string">"0.15.0"</span>
<span class="hljs-attr">winit</span> = <span class="hljs-string">"0.30.12"</span>
</code></pre>
<h4 data-id="heading-4">3. main.rs</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#![windows_subsystem = <span class="hljs-string">"windows"</span>]</span>

<span class="hljs-keyword">use</span> pixels::{Pixels, SurfaceTexture};
<span class="hljs-keyword">use</span> std::sync::Arc;
<span class="hljs-keyword">use</span> winit::{
    application::ApplicationHandler,
    event::WindowEvent,
    event_loop::{ActiveEventLoop, EventLoop},
    window::{Window, WindowId},
};

<span class="hljs-comment">// 1. 定义逻辑分辨率</span>
<span class="hljs-keyword">const</span> WIDTH: <span class="hljs-type">u32</span> = <span class="hljs-number">320</span>;
<span class="hljs-keyword">const</span> HEIGHT: <span class="hljs-type">u32</span> = <span class="hljs-number">240</span>;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">BoxApp</span> {
    pixels: <span class="hljs-type">Option</span>&lt;Pixels&lt;<span class="hljs-symbol">'static</span>&gt;&gt;,
    window: <span class="hljs-type">Option</span>&lt;Arc&lt;Window&gt;&gt;,
    <span class="hljs-comment">// 方块的状态</span>
    box_x: <span class="hljs-type">f32</span>,
    box_y: <span class="hljs-type">f32</span>,
    vel_x: <span class="hljs-type">f32</span>,
    vel_y: <span class="hljs-type">f32</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ApplicationHandler</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">BoxApp</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">resumed</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, event_loop: &amp;ActiveEventLoop) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">window_attributes</span> = Window::<span class="hljs-title function_ invoke__">default_attributes</span>()
            .<span class="hljs-title function_ invoke__">with_title</span>(<span class="hljs-string">"Pixels 入门: 碰撞方块"</span>)
            .<span class="hljs-title function_ invoke__">with_inner_size</span>(winit::dpi::LogicalSize::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">640.0</span>, <span class="hljs-number">480.0</span>));

        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">window</span> = Arc::<span class="hljs-title function_ invoke__">new</span>(event_loop.<span class="hljs-title function_ invoke__">create_window</span>(window_attributes).<span class="hljs-title function_ invoke__">unwrap</span>());

        <span class="hljs-comment">// 2. 初始化 Pixels</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">surface_texture</span> = SurfaceTexture::<span class="hljs-title function_ invoke__">new</span>(
            window.<span class="hljs-title function_ invoke__">inner_size</span>().width,
            window.<span class="hljs-title function_ invoke__">inner_size</span>().height,
            window.<span class="hljs-title function_ invoke__">clone</span>()
        );
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">pixels</span> = Pixels::<span class="hljs-title function_ invoke__">new</span>(WIDTH, HEIGHT, surface_texture).<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Pixels error"</span>);

        <span class="hljs-keyword">self</span>.pixels = <span class="hljs-title function_ invoke__">Some</span>(pixels);
        <span class="hljs-keyword">self</span>.window = <span class="hljs-title function_ invoke__">Some</span>(window);
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">window_event</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _event_loop: &amp;ActiveEventLoop, _id: WindowId, event: WindowEvent) {
        <span class="hljs-keyword">match</span> event {
            WindowEvent::CloseRequested =&gt; _event_loop.<span class="hljs-title function_ invoke__">exit</span>(),
            WindowEvent::RedrawRequested =&gt; {
                <span class="hljs-comment">// 3. 更新逻辑 (物理移动)</span>
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">update</span>();
                <span class="hljs-comment">// 4. 执行渲染</span>
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">draw</span>();

                <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">as_ref</span>().<span class="hljs-title function_ invoke__">unwrap</span>().<span class="hljs-title function_ invoke__">request_redraw</span>();
            }
            _ =&gt; (),
        }
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">BoxApp</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">update</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.box_x += <span class="hljs-keyword">self</span>.vel_x;
        <span class="hljs-keyword">self</span>.box_y += <span class="hljs-keyword">self</span>.vel_y;

        <span class="hljs-comment">// 简单的碰撞检测：撞墙反弹</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.box_x &lt;= <span class="hljs-number">0.0</span> || <span class="hljs-keyword">self</span>.box_x &gt;= (WIDTH - <span class="hljs-number">20</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span> { <span class="hljs-keyword">self</span>.vel_x *= -<span class="hljs-number">1.0</span>; }
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.box_y &lt;= <span class="hljs-number">0.0</span> || <span class="hljs-keyword">self</span>.box_y &gt;= (HEIGHT - <span class="hljs-number">20</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span> { <span class="hljs-keyword">self</span>.vel_y *= -<span class="hljs-number">1.0</span>; }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">draw</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(pixels) = <span class="hljs-keyword">self</span>.pixels.<span class="hljs-title function_ invoke__">as_mut</span>() {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">frame</span> = pixels.<span class="hljs-title function_ invoke__">frame_mut</span>();

            <span class="hljs-comment">// --- 步骤 A: 清屏 (填充背景颜色) ---</span>
            <span class="hljs-keyword">for</span> <span class="hljs-variable">pixel</span> <span class="hljs-keyword">in</span> frame.<span class="hljs-title function_ invoke__">chunks_exact_mut</span>(<span class="hljs-number">4</span>) {
                pixel.<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;[<span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-number">46</span>, <span class="hljs-number">255</span>]); <span class="hljs-comment">// 深蓝色</span>
            }

            <span class="hljs-comment">// --- 步骤 B: 绘制方块 (手动操作像素) ---</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">box_size</span> = <span class="hljs-number">20</span>;
            <span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..box_size {
                <span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..box_size {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">px</span> = (<span class="hljs-keyword">self</span>.box_x <span class="hljs-keyword">as</span> <span class="hljs-type">i32</span> + x) <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">py</span> = (<span class="hljs-keyword">self</span>.box_y <span class="hljs-keyword">as</span> <span class="hljs-type">i32</span> + y) <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;

                    <span class="hljs-comment">// 计算在一维数组中的索引: (y * 宽度 + x) * 4字节(RGBA)</span>
                    <span class="hljs-keyword">if</span> px &lt; WIDTH <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> &amp;&amp; py &lt; HEIGHT <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">i</span> = (py * WIDTH <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> + px) * <span class="hljs-number">4</span>;
                        frame[i..i + <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;[<span class="hljs-number">255</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>]); <span class="hljs-comment">// 橙黄色</span>
                    }
                }
            }

            pixels.<span class="hljs-title function_ invoke__">render</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">event_loop</span> = EventLoop::<span class="hljs-title function_ invoke__">new</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">app</span> = BoxApp {
        pixels: <span class="hljs-literal">None</span>, window: <span class="hljs-literal">None</span>,
        box_x: <span class="hljs-number">150.0</span>, box_y: <span class="hljs-number">110.0</span>,
        vel_x: <span class="hljs-number">2.0</span>, vel_y: <span class="hljs-number">2.0</span>,
    };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = event_loop.<span class="hljs-title function_ invoke__">run_app</span>(&amp;<span class="hljs-keyword">mut</span> app);
}
</code></pre>
<p>‍</p>
<h3 data-id="heading-5">二、Pixels 入门</h3>
<h4 data-id="heading-6">1. 核心概念：像素缓冲区</h4>
<p>当你使用 <code>pixels</code>​ 库时，你面对的不再是一个复杂的图形 API，而是一个巨大的​<strong>一维字节数组（u8 Array）</strong> 。</p>
<p>每一个像素由 <strong>4 个连续的字节</strong> 组成，分别对应 <strong>R（红）、G（绿）、B（蓝）、A（透明度）</strong> 。 例如，数组中的前四个元素 <code>[255, 0, 0, 255]</code> 就在屏幕左上角定义了一个纯红色的像素点。</p>
<p>例：</p>
<pre><code class="hljs language-rust" lang="rust">frame = [像素<span class="hljs-number">0</span>, 像素<span class="hljs-number">1</span>, 像素<span class="hljs-number">2</span>, 像素<span class="hljs-number">3</span>, ..., 像素<span class="hljs-number">76799</span>]
</code></pre>
<p>每个像素占 4 个字节，所以实际的字节长度是：</p>
<pre><code class="hljs language-rust" lang="rust">总字节数 = WIDTH × HEIGHT × <span class="hljs-number">4</span>
        = <span class="hljs-number">320</span> × <span class="hljs-number">240</span> × <span class="hljs-number">4</span>
        = <span class="hljs-number">76</span>,<span class="hljs-number">800</span> × <span class="hljs-number">4</span>
        = <span class="hljs-number">307</span>,<span class="hljs-number">200</span> 字节
</code></pre>
<h4 data-id="heading-7">2. 逻辑分辨率 和 物理分辨率</h4>
<p>在代码开头，我们定义了两个常量：</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// 1. 定义逻辑分辨率</span>
<span class="hljs-keyword">const</span> WIDTH: <span class="hljs-type">u32</span> = <span class="hljs-number">320</span>;
<span class="hljs-keyword">const</span> HEIGHT: <span class="hljs-type">u32</span> = <span class="hljs-number">240</span>;
</code></pre>
<p>这是 <strong>逻辑分辨率</strong>。无论你的窗口拉伸到多大（物理分辨率），你在代码中处理的永远只有这 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>320</mn><mo>×</mo><mn>240</mn></mrow><annotation encoding="application/x-tex">320 \times 240</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">320</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">240</span></span></span></span></span> 个点。<code>pixels</code> 会自动处理缩放，并保持像素的“颗粒感”。</p>
<h4 data-id="heading-8">3. 初始化渲染环境</h4>
<p>在 <code>ApplicationHandler</code>​ 的<code> resumed</code>​ 方法中，是渲染环境诞生的时刻。这不仅仅是几行初始化代码，它实际上建立了一条<strong>逻辑像素 -&gt; GPU 纹理 -&gt; 窗口屏幕</strong>的映射通道。</p>
<h5 data-id="heading-9">3.1 创建表面纹理 (SurfaceTexture)</h5>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">surface_texture</span> = SurfaceTexture::<span class="hljs-title function_ invoke__">new</span>(
    window.<span class="hljs-title function_ invoke__">inner_size</span>().width, 
    window.<span class="hljs-title function_ invoke__">inner_size</span>().height, 
    window.<span class="hljs-title function_ invoke__">clone</span>()
);
</code></pre>
<p><code>SurfaceTexture</code>​ 是像素点的“目的地”。它关联了窗口的​<strong>实际物理尺寸</strong>。</p>
<ul>
<li><strong>窗口像素不等于逻辑像素</strong>：你的显示器可能是 4K 的，但你的游戏逻辑可能只需要 320x240。<code>SurfaceTexture</code> 负责捕捉窗口的大小变化，为后续的自动缩放做准备。</li>
</ul>
<h5 data-id="heading-10">3.2 初始化 Pixels 实例</h5>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">pixels</span> = Pixels::<span class="hljs-title function_ invoke__">new</span>(WIDTH, HEIGHT, surface_texture).<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Pixels error"</span>);
</code></pre>
<p>这是最关键的一步。<code>Pixels::new</code>​ 在内存中开辟了一个巨大的​<strong>一维字节数组</strong>。</p>
<ul>
<li><strong>参数 1 &amp; 2 (<strong>​</strong>​<code>WIDTH</code>​</strong>​ <strong>,</strong>  <strong>​<code>HEIGHT</code>​</strong>​ <strong>)</strong> ：定义了你的“画布”有多大。</li>
<li><strong>内部机制</strong>​：<code>pixels</code>​ 库会在后台创建一个 GPU 纹理（Texture）。当你调用渲染时，它会通过 ​<strong>WGPU</strong>（Rust 的高性能图形库）将你内存中的数组数据以极快的速度“推”给显卡。</li>
</ul>
<h5 data-id="heading-11">3.3 理解“映射通道”的三个层级</h5>





























<table><thead><tr><th><strong>层级</strong></th><th><strong>表现形式</strong></th><th><strong>职责</strong></th><th><strong>示例</strong></th></tr></thead><tbody><tr><td><strong>逻辑层 (CPU)</strong></td><td>​<code>Vec&lt;u8&gt;</code>(字节数组)</td><td>负责计算“这个点应该是红色还是蓝色”</td><td>​<code>frame[i..i+4].copy_from_slice(...)</code></td></tr><tr><td><strong>中转层 (GPU)</strong></td><td>Texture (纹理)</td><td>将数组转化为显存中的图像，利用硬件加速缩放</td><td>​<code>pixels.render()</code></td></tr><tr><td><strong>物理层 (屏幕)</strong></td><td>Window (窗口)</td><td>最终呈现在用户眼前的光点</td><td>​<code>window.request_redraw()</code></td></tr></tbody></table>
<h4 data-id="heading-12">4. 核心绘图循环：操作颜色字节数组</h4>
<p>很多图形库会提供 <code>draw_rect</code>​ 或 <code>draw_circle</code>​ 这样的高级 API，但 <code>pixels</code>​ 不同。它极其纯粹：它只给你一个巨大的、一维的 <code>[u8]</code>​ ​<strong>字节数组</strong>。</p>
<p>你的所有绘图行为，本质上都是在<strong>修改这个数组里的数字</strong>。</p>
<h5 data-id="heading-13">4.1 内存中的像素长什么样？</h5>
<p>当你初始化了一个 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>320</mn><mo>×</mo><mn>240</mn></mrow><annotation encoding="application/x-tex">320 \times 240</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">320</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">240</span></span></span></span></span> 的画布时，<code>pixels</code> 会在内存中准备一个长度为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>320</mn><mo>×</mo><mn>240</mn><mo>×</mo><mn>4</mn><mo>=</mo><mn>307</mn><mo separator="true">,</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">320 \times 240 \times 4 = 307,200</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">320</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">240</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"/><span class="mord">307</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">200</span></span></span></span></span> 字节的缓冲区。</p>
<p>每 <strong>4 个字节</strong> 构成一个像素点，分别代表 ​<strong>RGBA</strong>：</p>
<ul>
<li><strong>R</strong> (Red): 红色通道 (0-255)</li>
<li><strong>G</strong> (Green): 绿色通道 (0-255)</li>
<li><strong>B</strong> (Blue): 蓝色通道 (0-255)</li>
<li><strong>A</strong> (Alpha): 不透明度 (0-255)</li>
</ul>
<h5 data-id="heading-14">4.2 清屏：批量操作内存</h5>
<p>在每一帧开始时，我们通常需要擦除上一帧的内容。这在代码中表现为一次全数组的遍历：</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">frame</span> = pixels.<span class="hljs-title function_ invoke__">frame_mut</span>(); <span class="hljs-comment">// 获取内存缓冲区的可变引用</span>

<span class="hljs-comment">// 将数组按每 4 个元素（一个像素）切分，并进行填充</span>
<span class="hljs-keyword">for</span> <span class="hljs-variable">pixel</span> <span class="hljs-keyword">in</span> frame.<span class="hljs-title function_ invoke__">chunks_exact_mut</span>(<span class="hljs-number">4</span>) { 
    pixel.<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;[<span class="hljs-number">30</span>, <span class="hljs-number">30</span>, <span class="hljs-number">46</span>, <span class="hljs-number">255</span>]); <span class="hljs-comment">// 赋予一个深色背景</span>
}
</code></pre>
<p>这里利用了 Rust 的 <code>chunks_exact_mut</code>，它能高效地确保我们每次处理的都是完整的 RGBA 单元，避免了手动计算索引的繁琐。</p>
<h5 data-id="heading-15">4.3 定点打击：坐标到索引的数学转换</h5>
<p>显示器是一个二维平面 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>，但内存是线性的。如何精准地找到屏幕上坐标为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>x</mi><mo separator="true">,</mo><mi>p</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(px, py)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 的那个像素在数组里的位置？</p>
<p>我们需要一套<strong>空间到索引</strong>的转换公式：</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// 计算在一维数组中的起始索引</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">idx</span> = (py <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> * WIDTH <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> + px <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>) * <span class="hljs-number">4</span>;

<span class="hljs-comment">// 写入颜色数据</span>
frame[idx..idx+<span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;[<span class="hljs-number">255</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>]); <span class="hljs-comment">// 橙黄色</span>
</code></pre>
<h6 data-id="heading-16">公式拆解：</h6>
<ol>
<li><strong>​<code>py * WIDTH</code>​</strong>​：每一行有 <code>WIDTH</code>​ 个像素。如果你想在第 <code>py</code>​ 行画点，你必须先跳过前面整整 <code>py</code> 行的所有像素。</li>
<li><strong>​<code>+ px</code>​</strong>​：在当前行中，向右平移 <code>px</code> 个像素，找到目标点。</li>
<li><strong>​<code>* 4</code>​</strong>：因为每个像素在内存里实际上占用了 4 个字节，所以最终的字节偏移量需要乘以 4。</li>
</ol>
<h5 data-id="heading-17">4.4 “原始”操作方式的特点</h5>
<p>这种“原始”的操作方式赋予了开发者极高的自由度：</p>
<ul>
<li><strong>性能极高</strong>：你直接操作的是内存，没有复杂的对象封装和函数调用开销。</li>
<li><strong>算法透明</strong>：无论是画线、画圆，还是实现复古的滤镜效果（如扫描线、噪声），本质上都是在编写逻辑来决定哪些索引应该填入什么颜色。</li>
<li><strong>所见即所得</strong>​：当你调用 <code>pixels.render()</code> 时，显卡会直接读取这块缓冲区，将其投射到屏幕上。</li>
</ul>
<h3 data-id="heading-18">三、Pixels 进阶</h3>
<h4 data-id="heading-19">1. 碰撞检测：赋予像素物理规则</h4>
<p>有了画布和像素操作方法，下一步就是让物体“动起来”。在示例代码中，方块的移动和反弹逻辑集中在 <code>update()</code>​ 方法里。这其实是一个极简的<strong>物理引擎模拟</strong>。</p>
<h5 data-id="heading-20">1.1 运动的基本原理</h5>
<p>在每一帧渲染之前，我们都会更新方块的坐标。</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">update</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
    <span class="hljs-comment">// 每一帧，方块根据当前速度向量进行位移</span>
    <span class="hljs-keyword">self</span>.box_x += <span class="hljs-keyword">self</span>.vel_x;
    <span class="hljs-keyword">self</span>.box_y += <span class="hljs-keyword">self</span>.vel_y;
}
</code></pre>
<h5 data-id="heading-21">1.2 边缘碰撞检测 (AABB Collision)</h5>
<p>如果只让坐标增加，方块很快就会飞出屏幕。为了让它留在逻辑分辨率（320x240）内，我们需要设置“无形的墙”。</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// 简单的碰撞检测：撞墙反弹</span>
<span class="hljs-comment">// 检查水平边界 (X轴)</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.box_x &lt;= <span class="hljs-number">0.0</span> || <span class="hljs-keyword">self</span>.box_x &gt;= (WIDTH - <span class="hljs-number">20</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span> { 
    <span class="hljs-keyword">self</span>.vel_x *= -<span class="hljs-number">1.0</span>; <span class="hljs-comment">// 速度取反，实现反弹效果</span>
}

<span class="hljs-comment">// 检查垂直边界 (Y轴)</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.box_y &lt;= <span class="hljs-number">0.0</span> || <span class="hljs-keyword">self</span>.box_y &gt;= (HEIGHT - <span class="hljs-number">20</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span> { 
    <span class="hljs-keyword">self</span>.vel_y *= -<span class="hljs-number">1.0</span>; 
}
</code></pre>
<h6 data-id="heading-22">逻辑要点：</h6>
<ul>
<li><strong>左侧/上侧边界 (0.0)</strong> ：当方块坐标小于或等于 0 时，说明触碰了左边或顶边。</li>
<li><strong>右侧/下侧边界 (WIDTH - size)</strong> ​：注意，方块的坐标通常是它的​<strong>左上角</strong>。因此，检测右边界时，需要减去方块自身的尺寸（这里是 20 像素），否则方块会有一部分穿过墙壁才反弹。</li>
<li><strong>反弹原理</strong>​：通过 <code>vel *= -1.0</code>，我们将速度向量瞬间反向。如果原本向右跑（速度为正），撞墙后立刻变为向左跑（速度为负）。</li>
</ul>
<h5 data-id="heading-23">1.3 从逻辑坐标到渲染的安全检查</h5>
<p>在 <code>draw()</code> 函数中，有一个非常重要的细节，它防止了程序的崩溃：</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-keyword">if</span> px &lt; WIDTH <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> &amp;&amp; py &lt; HEIGHT <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">i</span> = (py * WIDTH <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> + px) * <span class="hljs-number">4</span>;
    frame[i..i + <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;[<span class="hljs-number">255</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>]);
}
</code></pre>
<p>为什么需要这个 if 判断？</p>
<p>虽然我们在 update 中做了碰撞检测，但在处理浮点数转整数（f32 到 usize）时，可能会因为精度问题或逻辑微调产生超出边界的索引。</p>
<ul>
<li>如果访问了 <code>frame</code>​ 数组之外的下标，Rust 会触发 <code>panic</code> 导致程序崩溃。</li>
<li>这个 <code>if</code> 语句就像一个护栏，确保只有在画布范围内的像素才会被写入颜色。</li>
</ul>
<h3 data-id="heading-24">四、结语：从像素点开始，构建你的无限世界</h3>
<p>通过这个简单的“碰撞方块”项目，我们不仅学会了如何使用 <code>pixels</code>​ 库，更重要的是，我们重新审视了图形开发的本质：<strong>所有的视觉奇观，归根结底都是内存中字节的艺术。</strong></p>
<p>虽然现代引擎提供了无数开箱即用的高级功能，但掌握这种“底层像素操作”的能力，就像是学会了分子层面的化学反应。无论是开发复古风格的独立游戏、编写自定义的图像处理算法，还是仅仅为了深入理解计算机图形学，<code>pixels</code> 库都为你提供了一个纯粹且高效的实验室。</p>
<p>‍</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MemoryBubble(内存泡泡) 戳泡泡清理 Mac 内存]]></title>    <link>https://juejin.cn/post/7591687981687898158</link>    <guid>https://juejin.cn/post/7591687981687898158</guid>    <pubDate>2026-01-05T09:50:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591687981687898158" data-draft-id="7591670569910861870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MemoryBubble(内存泡泡) 戳泡泡清理 Mac 内存"/> <meta itemprop="keywords" content="Mac,macOS"/> <meta itemprop="datePublished" content="2026-01-05T09:50:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ceelog"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006047560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MemoryBubble(内存泡泡) 戳泡泡清理 Mac 内存
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006047560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ceelog
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:50:21.000Z" title="Mon Jan 05 2026 09:50:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Mac 重度用户都懂那个旋转的彩虹转盘。Photoshop、Slack、十几个浏览器标签同时开着，内存常年飘红。</p>
<p>打开活动监视器？密密麻麻的进程列表像数学题。哪个占用高？哪个能杀？会不会误杀？</p>
<p>MemoryBubble 彻底改变了这种焦虑。</p>
<h2 data-id="heading-0">当进程变成了漂浮的气泡</h2>
<p>第一次打开 MemoryBubble，我愣住了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e55694e9f904f6e9bd3aa65d8149bb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2VlbG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211421&amp;x-signature=x783ypaCRO8FpkvVfbhpA73znEw%3D" alt="图片" loading="lazy"/></p>
<p>冷冰冰的进程数据变成了五彩气泡。它们在屏幕上漂浮、碰撞、弹跳。气泡大小对应内存占用。占了 2GB 的 Chrome 是最大的气泡，小工具是精致的小气泡。</p>
<p>更神奇的是鼠标互动。移动鼠标靠近，气泡会"感知"并躲开，像被水流搅动。这来自 SpriteKit 物理引擎。气泡碰撞、反弹，遵循真实物理规律。</p>
<p>我开始用鼠标"搅动"这些气泡。像小时候吹肥皂泡。莫名治愈。</p>
<p>真正上瘾的，是双击爆破的那一刻。</p>
<h2 data-id="heading-1">双击爆破，释放的不只是内存</h2>
<p>看到占用高的气泡？双击它。</p>
<p>"啵！"清脆的破裂音效响起。气泡炸裂成绚丽粒子，瞬间消失。侧边栏内存数值立刻下降，"今日已释放"数字跳动增长。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbe2e8906b034c6f8cd1ddfcebbc814c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2VlbG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211421&amp;x-signature=GnNiFouL6PjpGvtlHfg24EAeBg4%3D" alt="图片" loading="lazy"/></p>
<p>即时反馈的快感改变了一切。清理内存从"麻烦事"变成"解压行为"。我开始期待内存升高，因为又能爆破气泡了。</p>
<p>工作累了？打开 MemoryBubble。看气泡漂浮碰撞，用鼠标搅动它们。奇妙的宁静感。</p>
<p>5 种 Shader 背景主题：海洋波纹、极光流动、星云浩瀚、岩浆涌动、流体渐变。不再是冷冰冰的工具，而是艺术品。每次打开，都是视觉盛宴。</p>
<h2 data-id="heading-2">好看之外，它也足够专业</h2>
<p>担心只是"花架子"？你低估了它的专业能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da7e226b5b1945d8ad7c822cdaba760b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2VlbG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211421&amp;x-signature=LCy2sIF7iryqaIrE0XbluqU63Qw%3D" alt="图片" loading="lazy"/></p>
<p><strong>进程树模式</strong>：点击切换，立刻变成传统层级列表。父进程、子进程、内存占用，一目了然。专业用户需要的细节，全都有。</p>
<p><strong>优先级系统</strong>：为进程标记低、中、高优先级（绿、黄、红）。标记一次，自动记住。下次自动应用。需要清理？一键批量清理低优先级进程。</p>
<p><strong>实时监控</strong>：每 5 秒刷新数据。仪表盘显示内存占用百分比。"今日已释放"统计清理成果。数据可视化，有成就感。</p>
<h2 data-id="heading-3">原生性能，隐私安全</h2>
<p><strong>原生性能</strong>：SwiftUI 开发的 macOS 原生应用。流畅运行，资源占用极低。无沙盒设计，直接管理进程权限。清理更彻底。</p>
<p><strong>隐私安全</strong>：所有数据本地运行，零云端上传。进程数据、内存使用、清理记录，全在你的 Mac 上。隐私保障。</p>
<p><strong>细节打磨</strong>：纹理缓存确保渲染流畅。音频预加载让爆破音效即时响应。几十个气泡同时开，窗口拖动依然丝滑。</p>
<h2 data-id="heading-4">工具软件，也可以带来愉悦</h2>
<p>设计师、开发者、Mac 重度用户，经常与内存占用作斗争？试试 MemoryBubble。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa13adfce4041b2ac0cdac05578a115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2VlbG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211421&amp;x-signature=pWEtqxrIJDhgyDv%2F8RmxqtdcXXM%3D" alt="图片" loading="lazy"/></p>
<p>它证明了一件事：工具软件不必枯燥。效率与乐趣可以兼得。</p>
<p>清理内存变成爆破气泡的解压时刻。枯燥数据变成漂浮的艺术品。维护电脑性能，也可以是享受。</p>
<p>打开 MemoryBubble，让气泡在屏幕上起舞。你会爱上这种治愈感。</p>
<p>🔍 MemoryBubble.app</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js第二十章(MDX)]]></title>    <link>https://juejin.cn/post/7591670569911042094</link>    <guid>https://juejin.cn/post/7591670569911042094</guid>    <pubDate>2026-01-05T09:50:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591670569911042094" data-draft-id="7591694511245688870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第二十章(MDX)"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2026-01-05T09:50:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第二十章(MDX)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:50:53.000Z" title="Mon Jan 05 2026 09:50:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MDX</h2>
<p>MDX是一种将Markdown和React组件混合在一起的语法，它可以在Markdown中使用React组件，从而实现更复杂的页面。另外就是我们在编写技术文档或者博客的时候，配合SSG模式，更喜欢用<code>Markdown</code>来编写，MDX他正好将<code>Markdown</code>和<code>React</code>组件混合在一起，实在是方便至极。</p>
<h4 data-id="heading-1">安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash">npm install @next/mdx @mdx-js/loader @mdx-js/react @types/mdx
</code></pre>
<h4 data-id="heading-2">启用MDX功能</h4>
<h5 data-id="heading-3">1.next.config.js配置以下内容</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//next.config.js    </span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">import</span> createMDX <span class="hljs-keyword">from</span> <span class="hljs-string">'@next/mdx'</span>
<span class="hljs-keyword">const</span> withMDX = <span class="hljs-title function_">createMDX</span>({
    <span class="hljs-comment">//extension: /\.(md|mdx)$/ 默认只支持mdx文件,如果想额外支持md文件编写次行代码。</span>
});
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">reactCompiler</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">pageExtensions</span>: [<span class="hljs-string">'js'</span>, <span class="hljs-string">'jsx'</span>, <span class="hljs-string">'md'</span>, <span class="hljs-string">'mdx'</span>, <span class="hljs-string">'ts'</span>, <span class="hljs-string">'tsx'</span>],
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withMDX</span>(nextConfig);
</code></pre>
<h5 data-id="heading-4">2.根目录下面创建<code>mdx-components.tsx</code>文件</h5>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">MDXComponents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'mdx/types'</span>
 
<span class="hljs-keyword">const</span> <span class="hljs-attr">components</span>: <span class="hljs-title class_">MDXComponents</span> = {}
 
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useMDXComponents</span>(<span class="hljs-params"/>): <span class="hljs-title class_">MDXComponents</span> {
  <span class="hljs-keyword">return</span> components
}
</code></pre>
<h4 data-id="heading-5">创建文件</h4>
<pre><code class="hljs language-bash" lang="bash"> my-project
  ├── app
  │   └── mdx-page
  │       └── page.(mdx/md)
  |── mdx-components.(tsx/js)
  └── package.json
</code></pre>
<h4 data-id="heading-6">代码高亮</h4>
<p>打开编辑器-插件市场-搜索<code>MDX</code>-安装<code>MDX</code>插件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbfb3adcaa4b4a1f9216506f887f41f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211453&amp;x-signature=wvj8QSUX3iMR9q%2B1Dv8gKe42atE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">基础使用</h4>
<p>可以支持(<code>Markdown</code>语法 + <code>React</code>组件 + <code>HTML</code>标签)</p>
<pre><code class="hljs language-mdx" lang="mdx"># welcome to MDX

这是一段文字，**他加粗了**，并且有重点内容`important`。

- one
- two
- three


&lt;div className='bg-red-500'&gt;
  &lt;p&gt;自定义标签&lt;/p&gt;
&lt;/div&gt;
</code></pre>
<h4 data-id="heading-8">引入自定义组件</h4>
<p>引入自定义组件一定要跟md语法之间空一行，否则会报错</p>
<p>src/app/home/page.mdx</p>
<pre><code class="hljs language-mdx" lang="mdx">import MyComponent from './my-component'; //引入自定义组件一定要跟md语法之间空一行，否则会报错。

# welcome to MDX

这是一段文字，**他加粗了**，并且有重点内容`important`。

- one
- two
- three


&lt;div className='bg-red-500'&gt;
  &lt;p&gt;自定义标签&lt;/p&gt;
&lt;/div&gt;

&lt;MyComponent /&gt;
</code></pre>
<p>mdx文件无法实现一些复杂的交付逻辑，如果有复杂的交付逻辑，我们可以使用<code>React</code>组件来实现，然后在mdx文件中引入即可。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//src/app/home/my-component.tsx</span>
<span class="hljs-string">'use client'</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-9">全局样式</h4>
<p>如果你希望在这个项目中修改所有的MDX文件的样式，你可以使用<code>mdx-components.tsx</code>文件来修改。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//mdx-components.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">MDXComponents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'mdx/types'</span>
 
<span class="hljs-keyword">const</span> <span class="hljs-attr">components</span>: <span class="hljs-title class_">MDXComponents</span> = {
    <span class="hljs-attr">h1</span>: <span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-2xl text-red-400 font-bold'</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>, <span class="hljs-comment">//# 代表h1 你可以自定义修改样式</span>
    <span class="hljs-attr">li</span>: <span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'list-disc text-blue-500 list-inside'</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>, <span class="hljs-comment">//- 代表li 你可以自定义修改样式</span>
    <span class="hljs-comment">//...你可以自定义修改更多的样式</span>
}
 
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useMDXComponents</span>(<span class="hljs-params"/>): <span class="hljs-title class_">MDXComponents</span> {
  <span class="hljs-keyword">return</span> components
}
</code></pre>
<h4 data-id="heading-10">远程加载mdx/md文件</h4>
<p>如果你的MDX文件存储在远程服务器上，你可以使用<code>远程mdx</code>来加载文件。</p>
<pre><code class="hljs language-bash" lang="bash">npm install next-mdx-remote-client
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//src/app/home/page.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MDXRemote</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-mdx-remote-client/rsc'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://nextjs-docs-henna-six.vercel.app/xm.mdx'</span>) <span class="hljs-comment">//链接是彩蛋</span>
  <span class="hljs-keyword">const</span> source = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">text</span>()
  <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MDXRemote</span> <span class="hljs-attr">source</span>=<span class="hljs-string">{source}</span> /&gt;</span></span>
  );
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[android 绘制斜体文本的一种方式]]></title>    <link>https://juejin.cn/post/7591672090790232083</link>    <guid>https://juejin.cn/post/7591672090790232083</guid>    <pubDate>2026-01-05T09:59:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591672090790232083" data-draft-id="7591510742648373291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="android 绘制斜体文本的一种方式 "/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-05T09:59:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            android 绘制斜体文本的一种方式 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:59:56.000Z" title="Mon Jan 05 2026 09:59:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>直接给 TextPaint设置斜体 然后通过 StaticLayout绘制也可以绘制斜体。但是问题是 StaticLayout直接绘制有时候文本会被裁切,也就是绘制范围没法精准控制。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Rect</span> bounds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();
mTextPaint.<span class="hljs-title function_">getTextBounds</span>(c,<span class="hljs-number">0</span>,c.<span class="hljs-title function_">length</span>(),bounds);
canvas.<span class="hljs-title function_">save</span>();
canvas.<span class="hljs-title function_">translate</span>(bounds.<span class="hljs-title function_">width</span>()/2f, bounds.<span class="hljs-title function_">height</span>()/2f); <span class="hljs-comment">// 移动到你想要的中心点</span>
canvas.<span class="hljs-title function_">skew</span>(-<span class="hljs-number">0.</span>3f, <span class="hljs-number">0</span>);            <span class="hljs-comment">// 倾斜</span>
canvas.<span class="hljs-title function_">translate</span>(-bounds.<span class="hljs-title function_">width</span>()/2f, -bounds.<span class="hljs-title function_">height</span>()/2f); <span class="hljs-comment">// 移回原位置</span>
<span class="hljs-title class_">StaticLayout</span> itemStaticLayout = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticLayout</span>(c, mTextPaint, txtWidth,
<span class="hljs-title class_">Layout</span>.<span class="hljs-property">Alignment</span>.<span class="hljs-property">ALIGN_NORMAL</span>, <span class="hljs-number">1.</span>0F, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
itemStaticLayout.<span class="hljs-title function_">draw</span>(canvas);
canvas.<span class="hljs-title function_">restore</span>();
</code></pre>
<p>计算文本倾斜之后的宽度</p>
<pre><code class="hljs language-js" lang="js">float skewX = <span class="hljs-number">0.</span>3f;
float w = paint.<span class="hljs-title function_">measureText</span>(text);
float h = bounds.<span class="hljs-title function_">height</span>();
float skewWidth = w + h * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(skewX);

<span class="hljs-comment">// 让文字居中显示（考虑倾斜后的宽度）</span>
float startX = (canvasWidth - skewWidth) / <span class="hljs-number">2</span>;

canvas.<span class="hljs-title function_">save</span>();
canvas.<span class="hljs-title function_">translate</span>(pivotX, pivotY);
canvas.<span class="hljs-title function_">skew</span>(skewX, <span class="hljs-number">0</span>);
canvas.<span class="hljs-title function_">translate</span>(-pivotX, -pivotY);
canvas.<span class="hljs-title function_">drawText</span>(text, startX, baselineY, paint);
canvas.<span class="hljs-title function_">restore</span>();
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手教你测试VPS网络质量：详解测试IP与LookingGlass用法 (以RackNerd洛杉矶DC02为例)]]></title>    <link>https://juejin.cn/post/7591465142452043828</link>    <guid>https://juejin.cn/post/7591465142452043828</guid>    <pubDate>2026-01-05T08:00:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591465142452043828" data-draft-id="7591413526709485568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手教你测试VPS网络质量：详解测试IP与LookingGlass用法 (以RackNerd洛杉矶DC02为例)"/> <meta itemprop="keywords" content="网络协议,后端"/> <meta itemprop="datePublished" content="2026-01-05T08:00:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手教你测试VPS网络质量：详解测试IP与LookingGlass用法 (以RackNerd洛杉矶DC02为例)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:00:40.000Z" title="Mon Jan 05 2026 08:00:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在购买VPS（虚拟专用服务器）之前，最担心的莫过于买到“断流”、“高延迟”或者“绕路”的机器。光看商家的广告词是不够的，我们需要掌握硬核的测试方法。</p>
<p>本文将带你深入了解 <strong>测试IP</strong> 和 <strong>LookingGlass</strong> 的作用，并以热门的 <strong>RackNerd 洛杉矶 DC02 机房</strong> 为演示对象，教你如何像老手一样评估一台VPS的网络质量。</p>
<h2 data-id="heading-0">什么是测试IP和LookingGlass？</h2>
<p>在开始之前，我们需要明白这两个核心概念：</p>
<ol>
<li><strong>测试IP (Test IP)</strong>：<br/>
商家提供的一个特定IP地址，用于给用户测试从<strong>本地（你家）到服务器</strong>的连接质量。通过它，我们可以得知延迟（Ping值）、丢包率以及路由走向。</li>
<li><strong>LookingGlass (LG)</strong>：<br/>
这是一个Web工具，可以理解为服务器端的“透视镜”。它允许你直接在商家的服务器上执行网络命令（如Ping、Traceroute），或者从服务器下载文件。它的作用是测试<strong>从服务器到外部</strong>的网络质量，以及测试<strong>服务器的真实下行带宽</strong>。</li>
</ol>
<blockquote>
<p><strong>哪里可以找到这些信息？</strong><br/>
大多数商家会在官网隐藏角落发布，为了方便大家查找，我的<strong>传家宝VPS监控站</strong>整理了主流商家的测试信息。</p>
<p>比如本文演示的RackNerd，你可以直接在这里获取：<br/>
<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flegacyvps.com%2Fscanidc%3Fproviders%3DRackNerd" target="_blank" title="https://legacyvps.com/scanidc?providers=RackNerd" ref="nofollow noopener noreferrer">点击查看 RackNerd 实时监控与测试信息</a></strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/279acf429197448497f8a3099d2aa9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204988&amp;x-signature=I355rzqwJQ4Nhyt7GiQHJ3YlozI%3D" alt="image-PFxd.webp" loading="lazy"/></p>
<h2 data-id="heading-1">第一阶段：使用测试IP评估延迟与稳定性</h2>
<p>我们要做的第一件事，就是看看这台服务器“卡不卡”。我们将使用 RackNerd 洛杉矶 DC02 的官方测试IP进行演示。</p>
<blockquote>
<p>不同的时间测试的结果可能不一样，晚高峰的一般能反映出服务器的真实网络情况。</p>
</blockquote>
<h3 data-id="heading-2">1. 单次测试：使用 itdog.cn (IT狗)</h3>
<p>IT狗是一个非常优秀的在线测试工具，它可以模拟全国不同地区、不同运营商（电信、联通、移动）访问该IP的情况。</p>
<ul>
<li><strong>操作步骤</strong>：打开 <code>https://www.itdog.cn/ping/</code>，输入 RackNerd 的测试IP。</li>
<li><strong>关注重点</strong>：
<ul>
<li><strong>平均延迟</strong>：美国西海岸（如洛杉矶）到中国大陆，平均延迟在 <strong>130ms - 180ms</strong> 之间属于优秀表现。</li>
<li><strong>地区差异</strong>：查看你所在的地区（比如广东电信）的延迟是多少，这比全国平均值更重要。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec299d4e84f2465393895f1356055bd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204988&amp;x-signature=1dVNeZYtgrTlCJZ7Wwq7mgndI2k%3D" alt="image-TnvY.webp" loading="lazy"/></p>
<h3 data-id="heading-3">2. 持续测试与路由分析：使用 ping.pe</h3>
<p>单次Ping只能看到瞬间状态，想要知道网络稳不稳定，是否存在“晚高峰丢包”，我们需要使用 <code>https://ping.pe/</code>。</p>
<ul>
<li><strong>操作步骤</strong>：打开网站，在顶部输入框输入测试IP，点击 <code>Go</code>。</li>
<li><strong>如何看图（初级玩法）</strong>：
<ul>
<li>页面上方会出现色彩斑斓的图表。</li>
<li><strong>绿色部分</strong>：代表连接顺畅，延迟稳定。绿色越多，说明网络越平稳。</li>
<li><strong>红色部分</strong>：代表<strong>丢包 (Packet Loss)</strong>。红色方块越多，说明数据包在传输过程中丢失了，这会导致网页打不开、SSH断开。如果红色密集，说明该线路极不稳定。</li>
</ul>
</li>
</ul>
<p><img src="https://www.legacyvps.com/upload/img_zpT4Dm5T.png" alt="img_zpT4Dm5T.png" loading="lazy"/></p>
<ul>
<li><strong>查看路由（高级玩法）</strong>：
<ul>
<li>不要只看上面的图，往下滑动页面。ping.pe 会自动显示 <strong>MTR (My Traceroute)</strong> 数据。</li>
<li>观察最后几跳（最后几行），看IP归属地。你可以清晰地看到数据包是从国内哪个出口出去的（是北京出口、上海出口还是广州出口），以及是否绕道了其他国家（比如去美国洛杉矶，却先绕道了日本或欧洲）。直连线路通常优于绕路。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3497d99cf07742deb28fc98af3f519e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204988&amp;x-signature=Ok4H3DogkdtkVrlLZiJWef8AawU%3D" alt="image-ycij.webp" loading="lazy"/></p>
<h2 data-id="heading-4">第二阶段：使用 LookingGlass 测试真实网速与路由</h2>
<p>延迟低不代表速度快。要测试这台VPS能跑多宽的带宽，LookingGlass 是最权威的工具。</p>
<p><strong>演示地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flg-lax02.racknerd.com%2F" target="_blank" title="https://lg-lax02.racknerd.com/" ref="nofollow noopener noreferrer">RackNerd DC02 Looking Glass (lg-lax02.racknerd.com)</a></p>
<h3 data-id="heading-5">1. 真实下载测速</h3>
<p>这是最直观的“测速”方法。LookingGlass 通常提供 100MB、1GB 等大小的测试文件。</p>
<ul>
<li><strong>操作建议</strong>：在点击下载之前，<strong>请务必关闭你电脑上所有占用带宽的软件</strong>（如迅雷、Steam下载、挂着的视频、以及其他代理软件），以确保测试出的速度是你的宽带与服务器之间的真实上限。</li>
<li><strong>开始测试</strong>：点击下载 <code>1000MB.test</code> 文件。观察浏览器的下载速度。
<ul>
<li>如果你是 300M 的宽带，下载速度能达到 30MB/s 左右，说明线路质量极佳，带宽充足。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0d862262794e4c8dbf6778190054be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204988&amp;x-signature=y4vW8AuX%2Bv6gI4XKT18cCUQ%2BO0g%3D" alt="image-oOHp.webp" loading="lazy"/></p>
<h3 data-id="heading-6">2. LookingGlass 的三大法宝：Ping, Traceroute, MTR</h3>
<p>LookingGlass 界面通常包含这三个选项，它们是用来从服务器端发起测试的。</p>
<h4 data-id="heading-7">A. Ping (连通性测试)</h4>
<p>最基础的命令，测试服务器到你本地IP的延迟。</p>
<ul>
<li>
<p><strong>Windows/Linux 通用命令</strong>：</p>
<pre><code class="hljs language-xml" lang="xml">ping <span class="hljs-tag">&lt;<span class="hljs-name">你的本地IP</span>&gt;</span>
</code></pre>
<p>(注意：LookingGlass网页版里只需要输入你的IP，选择Ping即可)</p>
</li>
</ul>
<h4 data-id="heading-8">B. Traceroute (路由追踪)</h4>
<p>用于查看数据包从服务器出发，经过了哪些节点才到达你的电脑。这可以帮你判断回程路由是否绕路（有时候去程直连，回程绕路，依然会卡）。</p>
<ul>
<li>
<p><strong>Linux 下安装与使用</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># Ubuntu/Debian 安装</span>
apt-<span class="hljs-keyword">get</span> install traceroute
<span class="hljs-meta"># 使用</span>
traceroute www.google.com
</code></pre>
</li>
<li>
<p><strong>Windows 下使用</strong>：</p>
<pre><code class="hljs">tracert www.google.com
</code></pre>
</li>
</ul>
<h4 data-id="heading-9">C. MTR (网络诊断专家)</h4>
<p>MTR 是 Ping 和 Traceroute 的结合体。它会列出经过的所有节点，并持续对每个节点进行 Ping，能精准定位是哪个节点（骨干网还是机房网关）出现了丢包。</p>
<ul>
<li>
<p><strong>Linux 下安装与使用</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># Ubuntu/Debian 安装</span>
apt-<span class="hljs-keyword">get</span> install mtr
<span class="hljs-meta"># 使用 (通常需要root权限)</span>
mtr -r -c <span class="hljs-number">10</span> &lt;你的本地IP&gt;
<span class="hljs-meta"># -r 表示生成报告模式，-c 10 表示发送10个包</span>
</code></pre>
</li>
<li>
<p><strong>LookingGlass 中使用</strong>：选择 MTR 选项，输入你的IP，点击 Run。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2fb3498f7b04b0085682a05a9690b61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204988&amp;x-signature=NekctMo087zLZYzF43fJzY9r8T4%3D" alt="image-RlgH.webp" loading="lazy"/></p>
<h2 data-id="heading-10">综合评价与总结</h2>
<p>通过以上两套组合拳，我们就能给 RackNerd 洛杉矶 DC02 做一个完整的体检：</p>
<ol>
<li><strong>看 Ping.pe</strong>：如果全绿，说明不丢包，连接稳定。</li>
<li><strong>看 IT狗</strong>：如果平均延迟在 160ms 左右，且你的运营商延迟没有飙红，说明响应速度合格。</li>
<li><strong>看 LookingGlass 下载</strong>：如果下载速度能跑满你的本地带宽，说明商家没有虚标带宽，且邻居没有滥用网络。</li>
<li><strong>看 MTR</strong>：如果回程路由直连无绕路，说明线路优化较好。</li>
</ol>
<p>掌握了这些方法，你就不再是看运气买VPS的“小白”了。无论是 RackNerd 还是其他商家，记得在下单前，先去我的监控站找找测试IP验证一番！</p>
<p><strong>相关资源：</strong></p>
<ul>
<li><strong>LegacyVPS 监控站 (RackNerd 专区)</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Flegacyvps.com%2Fscanidc%3Fproviders%3DRackNerd" target="_blank" title="https://legacyvps.com/scanidc?providers=RackNerd" ref="nofollow noopener noreferrer">legacyvps.com/scanidc?pro…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再瞎转Base64了！一文打通前端二进制任督二脉]]></title>    <link>https://juejin.cn/post/7591681023907610633</link>    <guid>https://juejin.cn/post/7591681023907610633</guid>    <pubDate>2026-01-05T08:13:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591681023907610633" data-draft-id="7591670569910304814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再瞎转Base64了！一文打通前端二进制任督二脉"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T08:13:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端大鱼"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再瞎转Base64了！一文打通前端二进制任督二脉
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端大鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:13:38.000Z" title="Mon Jan 05 2026 08:13:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发一个图片上传功能时，小王遇到了这样的需求：用户上传图片后，需要在前端预览，同时将图片转为Base64传给后端。面对Base64、Blob、File这些概念，小王陷入了困惑。这其实是很多前端开发者都会遇到的场景。</p>
<p>今天，我们就来彻底搞懂这些二进制数据处理的核心概念，让你在工作中游刃有余。</p>
<h2 data-id="heading-0">一、核心概念：它们都是什么？</h2>
<h3 data-id="heading-1">1. ArrayBuffer：最底层的二进制容器</h3>
<p>ArrayBuffer是最基础的二进制数据容器，它本身不提供任何操作数据的方法，只是一个“原始二进制数据缓冲区”。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个16字节的ArrayBuffer</span>
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(buffer.<span class="hljs-property">byteLength</span>); <span class="hljs-comment">// 16</span>

<span class="hljs-comment">// 需要通过视图（TypedArray）来操作</span>
<span class="hljs-keyword">const</span> int32View = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int32Array</span>(buffer);
int32View[<span class="hljs-number">0</span>] = <span class="hljs-number">42</span>;
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>固定长度，创建后大小不可变</li>
<li>不能直接读写，需要借助TypedArray或DataView</li>
<li>内存中的原始二进制数据</li>
</ul>
<h3 data-id="heading-2">2. Blob：不可变的类文件对象</h3>
<p>Blob（Binary Large Object）表示不可变的原始数据，更像是“文件”的抽象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个文本Blob</span>
<span class="hljs-keyword">const</span> textBlob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-string">'Hello, World!'</span>], { <span class="hljs-attr">type</span>: <span class="hljs-string">'text/plain'</span> });

<span class="hljs-comment">// 创建一个图片Blob（通常来自Canvas）</span>
canvas.<span class="hljs-title function_">toBlob</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">blob</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(blob.<span class="hljs-property">size</span>); <span class="hljs-comment">// blob大小</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(blob.<span class="hljs-property">type</span>); <span class="hljs-comment">// 例如 'image/png'</span>
});

<span class="hljs-comment">// 从ArrayBuffer创建Blob</span>
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);
<span class="hljs-keyword">const</span> blobFromBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([buffer]);
</code></pre>
<p><strong>实际应用场景</strong>：</p>
<ul>
<li>文件下载</li>
<li>图片预览</li>
<li>分片上传大文件</li>
</ul>
<h3 data-id="heading-3">3. File：特殊的Blob，来自用户文件系统</h3>
<p>File继承自Blob，增加了文件名、最后修改时间等信息。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 通常来自&lt;input type="file"&gt;</span>
<span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'fileInput'</span>);
fileInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file.<span class="hljs-property">name</span>);     <span class="hljs-comment">// 文件名</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file.<span class="hljs-property">size</span>);     <span class="hljs-comment">// 文件大小</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file.<span class="hljs-property">type</span>);     <span class="hljs-comment">// MIME类型</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file.<span class="hljs-property">lastModified</span>); <span class="hljs-comment">// 最后修改时间</span>
});
</code></pre>
<h3 data-id="heading-4">4. Base64：二进制数据的文本表示</h3>
<p>Base64是一种将二进制数据编码为ASCII字符串的方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 将字符串转为Base64</span>
<span class="hljs-keyword">const</span> base64 = <span class="hljs-title function_">btoa</span>(<span class="hljs-string">'Hello World!'</span>); <span class="hljs-comment">// "SGVsbG8gV29ybGQh"</span>

<span class="hljs-comment">// 解码Base64</span>
<span class="hljs-keyword">const</span> original = <span class="hljs-title function_">atob</span>(base64); <span class="hljs-comment">// "Hello World!"</span>

<span class="hljs-comment">// 将二进制数据转为Base64</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">arrayBufferToBase64</span>(<span class="hljs-params">buffer</span>) {
  <span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
  <span class="hljs-keyword">let</span> binary = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bytes.<span class="hljs-property">byteLength</span>; i++) {
    binary += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(bytes[i]);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">btoa</span>(binary);
}
</code></pre>
<h3 data-id="heading-5">5. FileReader：读取文件内容的桥梁</h3>
<p>FileReader用于异步读取File或Blob对象的内容。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
<span class="hljs-keyword">const</span> file = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'fileInput'</span>).<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];

<span class="hljs-comment">// 读取为ArrayBuffer</span>
reader.<span class="hljs-title function_">readAsArrayBuffer</span>(file);
reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> arrayBuffer = e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
};

<span class="hljs-comment">// 读取为DataURL（Base64格式）</span>
reader.<span class="hljs-title function_">readAsDataURL</span>(file);
reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> dataURL = e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>; <span class="hljs-comment">// data:image/png;base64,...</span>
  img.<span class="hljs-property">src</span> = dataURL; <span class="hljs-comment">// 直接用于图片预览</span>
};

<span class="hljs-comment">// 读取为文本</span>
reader.<span class="hljs-title function_">readAsText</span>(file, <span class="hljs-string">'UTF-8'</span>);
</code></pre>
<h2 data-id="heading-6">二、实战应用：它们如何协同工作？</h2>
<h3 data-id="heading-7">场景1：图片上传预览</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用户选择图片后预览</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleImageUpload</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> file = event.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  
  <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'image/'</span>)) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请选择图片文件'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-comment">// 方式1：使用URL.createObjectURL（性能更好）</span>
  <span class="hljs-keyword">const</span> objectURL = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(file);
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'preview'</span>).<span class="hljs-property">src</span> = objectURL;
  
  <span class="hljs-comment">// 方式2：使用FileReader转为Base64</span>
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
  reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-keyword">const</span> base64 = e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'preview'</span>).<span class="hljs-property">src</span> = base64;
    <span class="hljs-comment">// 可以发送到后端</span>
    <span class="hljs-title function_">uploadToServer</span>(base64);
  };
  reader.<span class="hljs-title function_">readAsDataURL</span>(file);
}
</code></pre>
<h3 data-id="heading-8">场景2：文件下载</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建并下载文件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">downloadFile</span>(<span class="hljs-params">content, filename, contentType</span>) {
  <span class="hljs-comment">// 创建Blob</span>
  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([content], { <span class="hljs-attr">type</span>: contentType });
  
  <span class="hljs-comment">// 创建下载链接</span>
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
  <span class="hljs-keyword">const</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
  a.<span class="hljs-property">href</span> = url;
  a.<span class="hljs-property">download</span> = filename;
  
  <span class="hljs-comment">// 触发下载</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
  a.<span class="hljs-title function_">click</span>();
  
  <span class="hljs-comment">// 清理</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(a);
    <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
  }, <span class="hljs-number">100</span>);
}

<span class="hljs-comment">// 使用示例：下载JSON数据</span>
<span class="hljs-keyword">const</span> data = { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };
<span class="hljs-title function_">downloadFile</span>(
  <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>),
  <span class="hljs-string">'user-data.json'</span>,
  <span class="hljs-string">'application/json'</span>
);
</code></pre>
<h3 data-id="heading-9">场景3：处理二进制数据流</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从网络获取二进制数据并处理</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processBinaryData</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-comment">// 1. 获取ArrayBuffer</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
  <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">arrayBuffer</span>();
  
  <span class="hljs-comment">// 2. 转为TypedArray进行处理</span>
  <span class="hljs-keyword">const</span> uint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arrayBuffer);
  
  <span class="hljs-comment">// 3. 处理数据（例如，查找特定字节）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8Array.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (uint8Array[i] === <span class="hljs-number">0xFF</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`找到FF字节在位置: <span class="hljs-subst">${i}</span>`</span>);
    }
  }
  
  <span class="hljs-comment">// 4. 转为Blob用于下载或显示</span>
  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([uint8Array], { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/octet-stream'</span> });
  
  <span class="hljs-comment">// 5. 或者转为Base64</span>
  <span class="hljs-keyword">const</span> base64 = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
    reader.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(reader.<span class="hljs-property">result</span>);
    reader.<span class="hljs-title function_">readAsDataURL</span>(blob);
  });
  
  <span class="hljs-keyword">return</span> { arrayBuffer, blob, base64 };
}
</code></pre>
<h2 data-id="heading-10">三、性能与最佳实践</h2>
<h3 data-id="heading-11">1. 内存管理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误示例：不释放Blob URL会导致内存泄漏</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">memoryLeakExample</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> file = <span class="hljs-title function_">getSomeFile</span>();
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(file);
  <span class="hljs-comment">// 使用后必须释放！</span>
}

<span class="hljs-comment">// 正确做法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">correctExample</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> file = <span class="hljs-title function_">getSomeFile</span>();
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(file);
  
  <span class="hljs-comment">// 使用...</span>
  img.<span class="hljs-property">src</span> = url;
  
  <span class="hljs-comment">// 不再需要时立即释放</span>
  img.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
  };
}
</code></pre>
<h3 data-id="heading-12">2. 大文件处理</h3>
<p>对于大文件，避免一次性读取到内存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 分片读取大文件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readLargeFileInChunks</span>(<span class="hljs-params">file, chunkSize = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>) { <span class="hljs-comment">// 1MB</span>
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">while</span> (offset &lt; file.<span class="hljs-property">size</span>) {
    <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(offset, offset + chunkSize);
    <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> chunk.<span class="hljs-title function_">arrayBuffer</span>();
    
    <span class="hljs-comment">// 处理每个分片</span>
    <span class="hljs-title function_">processChunk</span>(arrayBuffer);
    
    chunks.<span class="hljs-title function_">push</span>(arrayBuffer);
    offset += chunkSize;
  }
  
  <span class="hljs-keyword">return</span> chunks;
}

<span class="hljs-comment">// 使用流API（更现代的方式）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processFileWithStream</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-keyword">const</span> stream = file.<span class="hljs-title function_">stream</span>();
  <span class="hljs-keyword">const</span> reader = stream.<span class="hljs-title function_">getReader</span>();
  
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
    
    <span class="hljs-comment">// value是Uint8Array</span>
    <span class="hljs-title function_">processChunk</span>(value);
  }
}
</code></pre>
<h2 data-id="heading-13">四、常见问题解答</h2>
<h3 data-id="heading-14">Q1: 什么时候用Base64，什么时候用Blob URL？</h3>
<ul>
<li><strong>Base64</strong>：需要文本格式传输时使用，如：
<ul>
<li>存储到localStorage</li>
<li>通过JSON传输</li>
<li>内嵌到CSS/HTML中</li>
</ul>
</li>
<li><strong>Blob URL</strong>：需要临时引用文件时使用，如：
<ul>
<li>图片/视频预览</li>
<li>文件下载</li>
<li>音频播放</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">Q2: ArrayBuffer和Blob有什么区别？</h3>






























<table><thead><tr><th>特性</th><th>ArrayBuffer</th><th>Blob</th></tr></thead><tbody><tr><td>可变性</td><td>可通过视图修改</td><td>不可变</td></tr><tr><td>用途</td><td>底层数据处理</td><td>文件表示</td></tr><tr><td>大小</td><td>创建时固定</td><td>可动态创建</td></tr><tr><td>方法</td><td>无直接方法</td><td>有slice等方法</td></tr></tbody></table>
<h3 data-id="heading-16">Q3: 大文件处理要注意什么？</h3>
<ol>
<li><strong>分片处理</strong>：避免一次性读取大文件到内存</li>
<li><strong>及时释放</strong>：使用完Blob URL后立即调用<code>revokeObjectURL()</code></li>
<li><strong>使用流API</strong>：现代浏览器支持Streams API，更高效</li>
<li><strong>Web Worker</strong>：在后台线程处理，避免阻塞UI</li>
</ol>
<h2 data-id="heading-17">总结</h2>
<p>掌握这些二进制数据处理技术，你就能轻松应对前端开发中的各种文件处理需求：</p>
<ul>
<li><strong>ArrayBuffer</strong>是基石，处理原始二进制数据</li>
<li><strong>Blob</strong>是文件的抽象，用于存储和传输</li>
<li><strong>File</strong>是用户文件的接口</li>
<li><strong>Base64</strong>是兼容文本系统的编码方式</li>
<li><strong>FileReader</strong>是读取文件的桥梁</li>
</ul>
<p>记住选择合适的技术栈：小文件用Base64方便，大文件用Blob高效，底层操作用ArrayBuffer。合理使用这些技术，能让你的应用性能更优，用户体验更好。</p>
<hr/>
<p>关注微信公众号" <strong>大前端历险记</strong>"，掌握更多前端开发干货姿势！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌握SOQL For Loops：高效处理大量Salesforce数据的艺术]]></title>    <link>https://juejin.cn/post/7591635567588769838</link>    <guid>https://juejin.cn/post/7591635567588769838</guid>    <pubDate>2026-01-05T08:19:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591635567588769838" data-draft-id="7591681023907217417" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌握SOQL For Loops：高效处理大量Salesforce数据的艺术"/> <meta itemprop="keywords" content="面试,后端"/> <meta itemprop="datePublished" content="2026-01-05T08:19:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UrbanJazzerati"/> <meta itemprop="url" content="https://juejin.cn/user/550205947391389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌握SOQL For Loops：高效处理大量Salesforce数据的艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/550205947391389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UrbanJazzerati
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:19:05.000Z" title="Mon Jan 05 2026 08:19:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SOQL For Loops的实际价值：不仅仅是循环中的DML操作</h2>
<blockquote>
<p>确实，我们很少建议在循环内执行DML操作。但SOQL For Loops的真正价值远不止于此。</p>
</blockquote>
<p>最佳实践通常不鼓励在循环内执行DML操作。但SOQL For Loops的真正价值其实在于它处理<strong>大量数据查询</strong>的能力，而不仅仅是关于DML操作。让我们重新审视这个功能的核心优势。</p>
<h3 data-id="heading-1">重新认识SOQL For Loops的价值</h3>
<h4 data-id="heading-2">1. 处理超大型数据集的关键工具</h4>
<p>想象一下这样的场景：你需要遍历5万条客户记录来生成一份分析报告。标准SOQL查询会一次性加载所有记录，很快就会触发堆大小限制（6MB或12MB，取决于环境）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 这将导致堆溢出！</span>
List&lt;Account&gt; allAccounts = [SELECT Id, Name, AnnualRevenue FROM Account];
<span class="hljs-keyword">for</span>(Account acc : allAccounts) {
    <span class="hljs-comment">// 处理逻辑</span>
}
</code></pre>
<p>SOQL For Loops优雅地解决了这个问题：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不会触发堆限制</span>
<span class="hljs-keyword">for</span> (List&lt;Account&gt; acc : [SELECT Id, Name, AnnualRevenue FROM Account]) {
    <span class="hljs-comment">// 逐批处理，每批200条记录</span>
    performAnalysis(acc);
}
</code></pre>
<h4 data-id="heading-3">2. 复杂数据处理的理想选择</h4>
<p>当处理涉及多个对象或复杂计算时，SOQL For Loops的价值更加明显：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 处理机会及其相关产品</span>
<span class="hljs-type">Decimal</span> <span class="hljs-variable">totalRevenue</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (Opportunity opp : [
    SELECT Id, Amount, 
           (SELECT UnitPrice, Quantity FROM OpportunityLineItems) <span class="hljs-comment">// 如果OPPLineItems超过200个，会出错！</span>
    FROM Opportunity 
    <span class="hljs-type">WHERE</span> <span class="hljs-variable">CloseDate</span> <span class="hljs-operator">=</span> THIS_YEAR
]) {
    <span class="hljs-comment">// 复杂计算逻辑</span>
    <span class="hljs-type">Decimal</span> <span class="hljs-variable">oppTotal</span> <span class="hljs-operator">=</span> opp.Amount != <span class="hljs-literal">null</span> ? opp.Amount : <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (OpportunityLineItem oli : opp.OpportunityLineItems) {
        oppTotal += oli.UnitPrice * oli.Quantity;
    }
    
    totalRevenue += oppTotal;
}
</code></pre>
<h3 data-id="heading-4">为什么不在循环中执行DML？</h3>
<p>最佳实践是：</p>
<ol>
<li><strong>收集数据，批量处理</strong></li>
<li><strong>避免在循环内单个执行DML</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不推荐：在循环内单个更新</span>
<span class="hljs-keyword">for</span> (Account acc : [SELECT Id, Name FROM Account <span class="hljs-type">WHERE</span> <span class="hljs-variable">Type</span> <span class="hljs-operator">=</span> <span class="hljs-string">'Prospect'</span>]) {
    acc.Status__c = <span class="hljs-string">'Converted'</span>;
    update acc; <span class="hljs-comment">// ❌ 每次循环都执行DML</span>
}

<span class="hljs-comment">// 推荐：收集后批量更新</span>
List&lt;Account&gt; accountsToUpdate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">List</span>&lt;Account&gt;();
<span class="hljs-keyword">for</span> (Account acc : [SELECT Id, Name FROM Account <span class="hljs-type">WHERE</span> <span class="hljs-variable">Type</span> <span class="hljs-operator">=</span> <span class="hljs-string">'Prospect'</span>]) {
    acc.Status__c = <span class="hljs-string">'Converted'</span>;
    accountsToUpdate.add(acc);
}
update accountsToUpdate; <span class="hljs-comment">// ✅ 一次批量更新</span>
</code></pre>
<h3 data-id="heading-5">SOQL For Loops的真正应用场景</h3>
<h4 data-id="heading-6">1. 数据导出和报表生成</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateCSVReport</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">csvData</span> <span class="hljs-operator">=</span> <span class="hljs-string">'Id,Name,AnnualRevenue,EmployeeCount\n'</span>;
    
    <span class="hljs-comment">// 处理数5万条记录而不会溢出</span>
    <span class="hljs-keyword">for</span> (Account acc : [
        SELECT Id, Name, AnnualRevenue, NumberOfEmployees 
        FROM Account 
        <span class="hljs-type">WHERE</span> <span class="hljs-variable">CreatedDate</span> <span class="hljs-operator">=</span> LAST_YEAR
    ]) {
        csvData += acc.Id + <span class="hljs-string">','</span> 
                 + acc.Name + <span class="hljs-string">','</span> 
                 + (acc.AnnualRevenue != <span class="hljs-literal">null</span> ? String.valueOf(acc.AnnualRevenue) : <span class="hljs-string">'0'</span>) + <span class="hljs-string">','</span>
                 + (acc.NumberOfEmployees != <span class="hljs-literal">null</span> ? String.valueOf(acc.NumberOfEmployees) : <span class="hljs-string">'0'</span>)
                 + <span class="hljs-string">'\n'</span>;
    }
    
    <span class="hljs-keyword">return</span> csvData;
}
</code></pre>
<h4 data-id="heading-7">2. 实时数据验证和清理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateAccountData</span><span class="hljs-params">()</span> {
    List&lt;String&gt; invalidRecords = <span class="hljs-keyword">new</span> <span class="hljs-title class_">List</span>&lt;String&gt;();
    
    <span class="hljs-comment">// 扫描大量数据，只收集问题记录</span>
    <span class="hljs-keyword">for</span> (Account acc : [
        SELECT Id, Name, Website, Phone 
        FROM Account 
        <span class="hljs-type">WHERE</span> <span class="hljs-variable">CreatedDate</span> <span class="hljs-operator">=</span> LAST_90_DAYS
    ]) {
        <span class="hljs-keyword">if</span> (!isValidWebsite(acc.Website) &amp;&amp; !isValidPhone(acc.Phone)) {
            invalidRecords.add(acc.Name + <span class="hljs-string">' ('</span> + acc.Id + <span class="hljs-string">')'</span>);
        }
    }
    
    <span class="hljs-comment">// 批量处理或发送通知</span>
    <span class="hljs-keyword">if</span> (!invalidRecords.isEmpty()) {
        sendValidationAlert(invalidRecords);
    }
}
</code></pre>
<h4 data-id="heading-8">3. 数据迁移和转换</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">migrateLegacyData</span><span class="hljs-params">()</span> {
    Map&lt;Id, Contact&gt; contactsToCreate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;Id, Contact&gt;();
    
    <span class="hljs-comment">// 处理旧系统中的大量联系人数据</span>
    <span class="hljs-keyword">for</span> (Legacy_Contact__c legacy : [
        SELECT Id, First_Name__c, Last_Name__c, Email__c, 
               Account__c, Legacy_Id__c 
        FROM Legacy_Contact__c 
        <span class="hljs-type">WHERE</span> <span class="hljs-variable">Migrated__c</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
        LIMIT <span class="hljs-number">50000</span>
    ]) {
        <span class="hljs-type">Contact</span> <span class="hljs-variable">newContact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(
            FirstName = legacy.First_Name__c,
            LastName = legacy.Last_Name__c,
            Email = legacy.Email__c,
            AccountId = legacy.Account__c,
            Legacy_Id__c = legacy.Legacy_Id__c
        );
        
        contactsToCreate.put(legacy.Id, newContact);
    }
    
    <span class="hljs-comment">// 批量创建新记录</span>
    insert contactsToCreate.values();
    
    <span class="hljs-comment">// 批量更新迁移状态</span>
    List&lt;Legacy_Contact__c&gt; toUpdate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">List</span>&lt;Legacy_Contact__c&gt;();
    <span class="hljs-keyword">for</span> (Id legacyId : contactsToCreate.keySet()) {
        toUpdate.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Legacy_Contact__c</span>(
            Id = legacyId,
            Migrated__c = <span class="hljs-literal">true</span>
        ));
    }
    update toUpdate;
}
</code></pre>
<h3 data-id="heading-9">性能对比：标准查询 vs SOQL For Loops</h3>



































<table><thead><tr><th>场景</th><th>标准查询</th><th>SOQL For Loops</th></tr></thead><tbody><tr><td>1,000条记录</td><td>✅ 适合</td><td>✅ 适合</td></tr><tr><td>50,000条记录</td><td>❌ 可能堆溢出</td><td>✅ 适合</td></tr><tr><td>复杂对象关系</td><td>❌ 风险高</td><td>✅ 适合</td></tr><tr><td>内存密集型操作</td><td>❌ 不适合</td><td>✅ 适合</td></tr><tr><td>实时API响应</td><td>✅ 适合</td><td>❌ 不适合（较慢）</td></tr></tbody></table>
<h3 data-id="heading-10">最佳实践总结</h3>
<ol>
<li><strong>使用SOQL For Loops处理超过10,000条记录的数据集</strong></li>
<li><strong>避免在循环内执行DML - 收集到列表后批量处理</strong></li>
<li><strong>对于子查询结果，使用嵌套循环处理</strong></li>
<li><strong>结合Batch Apex处理数百万级数据</strong></li>
<li><strong>在异步上下文中（如@future、Batchable）使用，避免同步超时</strong></li>
</ol>
<h3 data-id="heading-11">结论</h3>
<p>SOQL For Loops的真正价值不在于循环内的DML操作（我们确实应该避免这样做），而在于它提供了一种<strong>安全、高效处理大量数据</strong>的机制。它是Salesforce开发者工具箱中处理大数据场景的必备工具。</p>
<p>当你需要：</p>
<ul>
<li>处理超过堆限制的数据</li>
<li>执行复杂的数据遍历和计算</li>
<li>迁移或清理大量记录</li>
<li>生成大规模报表</li>
</ul>
<p>这时，SOQL For Loops就是你的最佳选择。</p>
<p>记住，优秀的工具需要正确的使用方式。SOQL For Loops不是用来在循环内执行DML的，而是用来<strong>安全地遍历大量数据</strong>，然后<strong>批量处理</strong>这些数据的聪明工具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让 AI 自动写 SQL、读文档，前端也能玩转 Agent！ langchain chains 模块解析]]></title>    <link>https://juejin.cn/post/7591680281905446939</link>    <guid>https://juejin.cn/post/7591680281905446939</guid>    <pubDate>2026-01-05T08:40:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591680281905446939" data-draft-id="7589250237069525002" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让 AI 自动写 SQL、读文档，前端也能玩转 Agent！ langchain chains 模块解析"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-05T08:40:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让 AI 自动写 SQL、读文档，前端也能玩转 Agent！ langchain chains 模块解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:40:38.000Z" title="Mon Jan 05 2026 08:40:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>注，langchain 更新速度很快，本文所有案例都经过试验，在 2025年12月可用！并且所有案例的 python 和 node.js 版本我都测试通过。</p>
<p>这是「写给小白学 AI」系列的第 5 篇文章，这个系列专门为刚接触人工智能的前端开发者和编程新手打造。如果你错过了之前的精彩内容，可以在这里补课：</p>
<ul>
<li><a href="https://juejin.cn/post/7573592127299108914" target="_blank" title="https://juejin.cn/post/7573592127299108914">打包票！前端和小白一定能明白的人工智能基础概念</a></li>
<li><a href="https://juejin.cn/post/7575162322241077248" target="_blank" title="https://juejin.cn/post/7575162322241077248">不易懂你打我！写给前端和小白的 大模型(ChatGPT) 工作基本原理！</a></li>
<li><a href="https://juejin.cn/post/7578416583213645874" target="_blank" title="https://juejin.cn/post/7578416583213645874">前端角度学 AI - 15 分钟入门 Python</a></li>
<li><a href="https://juejin.cn/post/7579935414423027758" target="_blank" title="https://juejin.cn/post/7579935414423027758">Prompt 还能哄女朋友！你真的知道如何问 ai 问题吗？</a></li>
<li><a href="https://juejin.cn/post/7582021506189328430" target="_blank" title="https://juejin.cn/post/7582021506189328430"> 神兵在手，AI Agent 起步不愁：写给小白的 LangChain 入门指南</a></li>
<li><a href="https://juejin.cn/post/7586657335881383963" target="_blank" title="https://juejin.cn/post/7586657335881383963">前端和小白都能看懂的 LangChain Model 模块核心实战指南</a></li>
</ul>
<p><strong>学习提示</strong>：案例使用的 node.js</p>
<p>LangChain Chains中的 Chains 模块，主要作用就是串联基础模块的功能，简单来说如果你用过 linux，你一定知道管道操作符，作用也是一模一样的，我们举个例子你就马上明白了。</p>
<p>下面是没有用 chains 模块，我们需要经历如下过程才能得到结果（使用了 json 解析器）伪代码：</p>
<pre><code class="hljs language-rust" lang="rust">定义 template <span class="hljs-punctuation">-&gt;</span> 将 template 的结果传入到大模型 <span class="hljs-punctuation">-&gt;</span> 调用大模型, 得到结果 <span class="hljs-punctuation">-&gt;</span> 传入 json解析器解析结果
</code></pre>
<p>我们拿一个 node.js 版本代码举例：</p>
<h2 data-id="heading-1"/>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ChatPromptTemplate</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/prompts"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">StructuredOutputParser</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/output_parsers"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-comment">/**
 * 1. 定义结构（强烈推荐）
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户姓名"</span>),
  <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户年龄"</span>),
});

<span class="hljs-comment">/**
 * 2. 创建 Parser
 * 本质：JsonOutputParser + Zod 校验
 */</span>
<span class="hljs-keyword">const</span> parser = <span class="hljs-title class_">StructuredOutputParser</span>.<span class="hljs-title function_">fromZodSchema</span>(<span class="hljs-title class_">UserSchema</span>);

<span class="hljs-comment">/**
 * 3. Prompt（必须注入 format instructions）
 */</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">ChatPromptTemplate</span>.<span class="hljs-title function_">fromMessages</span>([
  [<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个后端 API，请严格返回 JSON.\n${instructions}"</span>],
  [<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>],
]);

<span class="hljs-comment">/**
 * 4. 模型
 */</span>
<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MODEL_NAME</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">openAIApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>,
  <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_BASE_URL</span>,
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printResult</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> template = <span class="hljs-keyword">await</span> prompt.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-attr">input</span>: <span class="hljs-string">"生成一个用户对象"</span>,
    <span class="hljs-attr">instructions</span>: parser.<span class="hljs-title function_">getFormatInstructions</span>(),
  });

  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(template);

}

<span class="hljs-title function_">printResult</span>();
</code></pre>
<p>上面的代码如果改为 chains 语法（链式语法），主要变化体现在 printResult 函数上：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 2. 创建 Parser
 * 本质：JsonOutputParser + Zod 校验
 */</span>
<span class="hljs-keyword">const</span> parser = StructuredOutputParser.fromZodSchema(UserSchema);

<span class="hljs-keyword">const</span> prompt = ChatPromptTemplate.fromMessages([
  [<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个后端 API，请严格返回 JSON.\n${instructions}"</span>],
  [<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>],
]);

<span class="hljs-function"><span class="hljs-keyword">async</span> function <span class="hljs-title">printResult</span>()</span> {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> prompt.pipe(llm).pipe(parser).invoke({
    input: <span class="hljs-string">"生成一个用户对象"</span>,
    instructions: parser.getFormatInstructions(),
  });

</code></pre>
<p>如上，通过 prompt 的pipe方法，将 prompt（提示词模板），交接给 大模型（llm）,然后将大模型的输出，通过 pipe 方法传递给 parser，这里我们定义的其实是一个json parser，本质就是从大模型返回的数据中提取 json 数据（大模型返回的字段很多，json parser 只提取 返回的我们需要的 json 格式数据）。</p>
<p>其实这里基础的 chains 模块的知识就讲完了。也就是liangchain 把各个模块通过链式语法简化了使用方式。接下来我们介绍一些有意思的也是 chains 模块的方法。</p>
<h2 data-id="heading-2">create_sql_query_chain</h2>
<p>我们都说前端已死，意思是 ai 能替代很多前端工作，这里介绍的这个 chain，其实能替代不少后端工作。它就是：</p>
<p><code>create_sql_query_chain</code> 的职责非常单一、清晰：</p>
<blockquote>
<p><strong>将自然语言问题 → 转换为 SQL 查询语句（字符串）</strong></p>
</blockquote>
<p>这个完全可以当做一个业务上的辅助模块，帮助后端开发自动生成对应的 sql 语句。简单来说：我们直接用 langchain 中的 <code>create_sql_query_chain</code> 结合大模型，问：“最近 7 天每天新增的用户数量”，然后就会返回真正查询数据库的 sql 语句。</p>
<p>注：langchain文档变化非常快，以至于很多包导入方式跟文档不一样（最新文档也不行）。以下代码是看了源码才知道如何导入的。。。费了很大力气。</p>
<p>以下需要使用导入新的包 <code>@langchain/classic</code>, <code>typeorm</code>, 因为我本地起了一个 postgresql，所以还要下载 <code>pg</code> 这个 npm 包（导入适合你使用的数据库）。</p>
<p>其中我用的 new ChatOpenAI 的参数不知道的，请参考我之前的文章，</p>
<ul>
<li><a href="https://juejin.cn/post/7586657335881383963" target="_blank" title="https://juejin.cn/post/7586657335881383963">前端和小白都能看懂的 LangChain Model 模块核心实战指南</a></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SqlDatabase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/classic/sql_db"</span>;
<span class="hljs-keyword">import</span> { createSqlQueryChain } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/classic/chains/sql_db"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DataSource</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"typeorm"</span>;

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> datasource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSource</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">"postgres"</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-string">"localhost"</span>,
  <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,
  <span class="hljs-attr">username</span>: <span class="hljs-string">"xxx"</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">"xxx"</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">"xxx"</span>,
  <span class="hljs-comment">// schema: "public", // 默认为 public，如果使用其他 schema 请指定</span>
});

<span class="hljs-comment">// 2. 初始化 LangChain 数据库包装类</span>
<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title class_">SqlDatabase</span>.<span class="hljs-title function_">fromDataSourceParams</span>({
  <span class="hljs-attr">appDataSource</span>: datasource,
});


<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MODEL_NAME</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">openAIApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>,
  <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_BASE_URL</span>,
});

<span class="hljs-comment">// 4. 创建 SQL 生成链</span>
<span class="hljs-keyword">const</span> chain = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createSqlQueryChain</span>({
  llm,
  db,
  <span class="hljs-attr">dialect</span>: <span class="hljs-string">"postgres"</span>, <span class="hljs-comment">// 显式指定为 postgres</span>
});

<span class="hljs-comment">// 5. 测试生成</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> chain.<span class="hljs-title function_">invoke</span>({
  <span class="hljs-attr">question</span>: <span class="hljs-string">"User 表中有多少用户？"</span>,
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成的 SQL:"</span>, response);

</code></pre>
<p>生成的 SQL 如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"SELECT COUNT(*) FROM "</span>public<span class="hljs-string">"."</span>Use<span class="hljs-string">r""</span>
</code></pre>
<p>是不是还是挺方便的，哈哈。其实上面的代码拓展一下，在某种程度上能实现一个辅助程序员的 sql 生成库。在开发环境可用，生产环境肯定是不建议的，因为你不能百分百相信大模型的生成结果。</p>
<h2 data-id="heading-3">createStuffDocumentsChain</h2>
<p><code>createStuffDocumentsChain</code> 是一个用于将多个文档（Documents）“塞进”提示词（Prompt）中并发送给大模型（LLM）的辅助函数。它是构建 RAG（检索增强生成）应用的核心步骤之一。</p>
<p>以下是一个案例，一看就懂！</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { createStuffDocumentsChain } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/classic/chains/combine_documents"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Document</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/documents"</span>;


dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-comment">// 创建提示词模板给大模型</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">ChatPromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">`
    使用以下上下文回答用户的问题。
    如果你不知道答案，就说你不知道，不要尝试虚构。
    
    上下文: {context}
    
    问题: {input}
  `</span>);

<span class="hljs-comment">// 初始话大模型（我们用的 deepseek，充值10元能用很久）</span>
<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">MODEL_NAME</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">openAIApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>,
  <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_BASE_URL</span>,
});

<span class="hljs-comment">// 创建文档chain</span>
<span class="hljs-keyword">const</span> chain = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createStuffDocumentsChain</span>({
  llm,
  prompt,
});

<span class="hljs-comment">// 模拟一些文档数据</span>
<span class="hljs-keyword">const</span> docs = [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>({
    <span class="hljs-attr">pageContent</span>: <span class="hljs-string">"LangChain 是一个用于开发由语言模型驱动的应用的框架。"</span>,
  }),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>({
    <span class="hljs-attr">pageContent</span>: <span class="hljs-string">"它支持 Python 和 JavaScript/TypeScript 两种语言。"</span>,
  }),
];

<span class="hljs-comment">// 5. 测试生成</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> chain.<span class="hljs-title function_">invoke</span>({
  <span class="hljs-attr">input</span>: <span class="hljs-string">"LangChain 支持哪些编程语言？"</span>,
  <span class="hljs-attr">context</span>: docs,
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);

</code></pre>
<p>返回的结果是：</p>
<pre><code class="hljs">根据上下文，LangChain 支持 Python 和 JavaScript/TypeScript 两种编程语言。
</code></pre>
<h2 data-id="heading-4">欢迎一起交流</h2>
<p>欢迎大家一起进群讨论前端全栈技术和 ai agent ，一起进步！</p>
<p>我的微信: a2298613245</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis映射器模块详解]]></title>    <link>https://juejin.cn/post/7591304659131138086</link>    <guid>https://juejin.cn/post/7591304659131138086</guid>    <pubDate>2026-01-04T07:33:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591304659131138086" data-draft-id="7590469811408945179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis映射器模块详解"/> <meta itemprop="keywords" content="MyBatis"/> <meta itemprop="datePublished" content="2026-01-04T07:33:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis映射器模块详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T07:33:55.000Z" title="Sun Jan 04 2026 07:33:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从源码层面深入理解MyBatis Mapper的设计与实现</p>
</blockquote>
<h2 data-id="heading-0">一、MyBatis整体架构与映射器模块</h2>
<p>在深入映射器模块之前，我们先了解MyBatis的整体架构，以及映射器模块在其中的重要地位。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d998a12ef98f4a55ae7c66ea134914a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=uhRWk7utzEkhyO58TuHgEZBmiWw%3D" alt="" loading="lazy"/></p>
<p>从架构图可以看出，MyBatis采用了分层架构设计，而<strong>映射器模块（Mapper Interface）位于接口层</strong>，是用户与MyBatis交互的主要入口。它通过接口定义数据库操作，结合XML或注解配置SQL语句，利用动态代理技术自动实现接口，让开发者以面向对象的方式操作数据库。</p>
<h2 data-id="heading-1">1.1 映射器模块的核心职责</h2>
<p>映射器模块主要承担以下核心职责：</p>
<pre><code class="hljs language-sql" lang="sql">✅ 定义数据库操作接口 <span class="hljs-operator">-</span> 通过Java接口定义CRUD操作
✅ <span class="hljs-keyword">SQL</span>语句映射 <span class="hljs-operator">-</span> 将接口方法与<span class="hljs-keyword">SQL</span>语句关联
✅ 参数映射 <span class="hljs-operator">-</span> 将方法参数转换为<span class="hljs-keyword">SQL</span>参数
✅ 结果映射 <span class="hljs-operator">-</span> 将查询结果映射为Java对象
✅ 动态代理实现 <span class="hljs-operator">-</span> 自动生成接口实现类
</code></pre>
<h2 data-id="heading-2">1.2 为什么需要Mapper？</h2>
<p>传统的JDBC编程存在以下问题：</p>
<pre><code class="hljs language-ini" lang="ini">//传统JDBC方式
String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT * FROM t_user WHERE id = ?"</span><span class="hljs-comment">;</span>
PreparedStatement <span class="hljs-attr">stmt</span> = conn.prepareStatement(sql)<span class="hljs-comment">;</span>
stmt.setInt(1, userId)<span class="hljs-comment">;</span>
ResultSet <span class="hljs-attr">rs</span> = stmt.executeQuery()<span class="hljs-comment">;</span>
// 手动解析ResultSet并映射为对象...
</code></pre>
<p>这种方式的问题：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">1</span>、<span class="hljs-keyword">SQL</span>分散在代码中，难以维护
<span class="hljs-number">2</span>、参数设置和结果映射都是手工操作
<span class="hljs-number">3</span>、容易出现类型转换错误
<span class="hljs-number">4</span>、代码重复度高
</code></pre>
<p>使用Mapper后：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Mapper方式</span>
<span class="hljs-meta">@Select("SELECT * FROM t_user WHERE id = #{id}")</span>
User <span class="hljs-title function_">selectById</span><span class="hljs-params">(Long id)</span>;

<span class="hljs-comment">// 使用</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">1L</span>);
</code></pre>
<p>优势：</p>
<pre><code class="hljs language-sql" lang="sql">✅ <span class="hljs-keyword">SQL</span>与代码分离，易于维护
✅ 自动参数映射和结果映射
✅ 类型安全
✅ 代码简洁
</code></pre>
<h2 data-id="heading-3">1.3 Mapper的使用方式</h2>
<p>MyBatis支持两种Mapper配置方式：</p>




















<table><thead><tr><th>配置方式</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td>XML配置</td><td>SQL语句在XML文件中</td><td>复杂SQL、需要动态SQL</td></tr><tr><td>注解配置</td><td>SQL语句在注解中</td><td>简单SQL、快速开发</td></tr></tbody></table>
<h2 data-id="heading-4">二、Mapper接口架构</h2>
<p>MyBatis的映射器模块采用了接口+配置的设计模式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75c8e50cccba47ea8982290ff203ea76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=kj5%2Fsl1CSgdPimZOABaV2eFLm%2Bo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">2.1 Mapper接口定义</h2>
<p>Mapper是一个<strong>普通的Java接口，无需实现类</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">UserMapper</span> {
    <span class="hljs-comment">// 查询单个对象</span>
    <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">selectById</span>(Long id);

    <span class="hljs-comment">// 查询列表</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">selectAll</span>();

    <span class="hljs-comment">// 插入</span>
    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">insert</span>(User user);

    <span class="hljs-comment">// 更新</span>
    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">update</span>(User user);

    <span class="hljs-comment">// 删除</span>
    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">deleteById</span>(Long id);

    <span class="hljs-comment">// 复杂查询</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">selectByCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"name"</span>) String name,
                                  <span class="hljs-variable">@Param</span>(<span class="hljs-string">"age"</span>) Integer age);
}
</code></pre>
<h2 data-id="heading-6">2.2 Mapper接口特点</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-number">1</span>️⃣ 无需实现类 - <span class="hljs-title class_">MyBatis</span>通过动态代理自动生成实现
<span class="hljs-number">2</span>️⃣ 方法名与<span class="hljs-variable constant_">SQL</span> <span class="hljs-variable constant_">ID</span>对应 - 接口方法名即为<span class="hljs-title class_">MappedStatement</span>的<span class="hljs-variable constant_">ID</span>
<span class="hljs-number">3</span>️⃣ 参数灵活 - 支持单参数、多参数、对象参数
<span class="hljs-number">4</span>️⃣ 返回值多样 - 支持单对象、集合、<span class="hljs-title class_">Map</span>等
</code></pre>
<h2 data-id="heading-7">2.3 MapperRegistry注册中心</h2>
<p>MyBatis维护了Mapper接口的注册中心：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperRegistry</span> {
    <span class="hljs-comment">// Configuration对象</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Configuration</span> config;
    <span class="hljs-comment">// Mapper接口与代理工厂的映射</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Class</span>&lt;?&gt;, <span class="hljs-title class_">MapperProxyFactory</span>&lt;?&gt;&gt; knownMappers = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MapperRegistry</span>(<span class="hljs-title class_">Configuration</span> config) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = config;
    }

    <span class="hljs-comment">// 添加Mapper接口</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">addMapper</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">isInterface</span>()) {
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasMapper</span>(<span class="hljs-keyword">type</span>)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingException</span>(
                    <span class="hljs-string">"Type "</span> + <span class="hljs-keyword">type</span> + <span class="hljs-string">" is already known to the MapperRegistry."</span>
                );
            }
            <span class="hljs-built_in">boolean</span> loadCompleted = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 创建MapperProxyFactory</span>
                knownMappers.<span class="hljs-title function_">put</span>(<span class="hljs-keyword">type</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperProxyFactory</span>&lt;&gt;(<span class="hljs-keyword">type</span>));
                <span class="hljs-comment">// 解析Mapper注解</span>
                <span class="hljs-title class_">MapperAnnotationBuilder</span> parser = 
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperAnnotationBuilder</span>(config, <span class="hljs-keyword">type</span>);
                parser.<span class="hljs-title function_">parse</span>();
                loadCompleted = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">if</span> (!loadCompleted) {
                    knownMappers.<span class="hljs-title function_">remove</span>(<span class="hljs-keyword">type</span>);
                }
            }
        }
    }

    <span class="hljs-comment">// 获取Mapper实例</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getMapper</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span>, SqlSession sqlSession</span>) {
        final <span class="hljs-title class_">MapperProxyFactory</span>&lt;T&gt; mapperProxyFactory = 
            (<span class="hljs-title class_">MapperProxyFactory</span>&lt;T&gt;) knownMappers.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">type</span>);
        <span class="hljs-keyword">if</span> (mapperProxyFactory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingException</span>(
                <span class="hljs-string">"Type "</span> + <span class="hljs-keyword">type</span> + <span class="hljs-string">" is not known to the MapperRegistry."</span>
            );
        }
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> mapperProxyFactory.<span class="hljs-title function_">newInstance</span>(sqlSession);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingException</span>(
                <span class="hljs-string">"Error getting mapper instance. Cause: "</span> + e, e
            );
        }
    }

    <span class="hljs-comment">// 检查是否已注册</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasMapper</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">return</span> knownMappers.<span class="hljs-title function_">containsKey</span>(<span class="hljs-keyword">type</span>);
    }

    <span class="hljs-comment">// 获取所有Mapper接口</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Collection</span>&lt;<span class="hljs-title class_">Class</span>&lt;?&gt;&gt; <span class="hljs-title function_">getMappers</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">unmodifiableCollection</span>(knownMappers.<span class="hljs-title function_">keySet</span>());
    }
}
</code></pre>
<h2 data-id="heading-8">三、SQL语句映射</h2>
<p>MyBatis提供了灵活的SQL映射方式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbb120167124078a7130ed8b114d4e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=AhiaxNkP8QTM239HDTa0UfDNzq4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">3.1 XML配置方式</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span> ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
    <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mapper.UserMapper"</span>&gt;</span>

    <span class="hljs-comment">&lt;!--结果映射 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"BaseResultMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.example.entity.User"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"BIGINT"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"INTEGER"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"create_time"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"createTime"</span> 
                <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"TIMESTAMP"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-comment">&lt;!--查询单个用户 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectById"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span>
        SELECT id, name, email, age, create_time
        FROM t_user
        WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询所有用户 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectAll"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span>
        SELECT id, name, email, age, create_time
        FROM t_user
        ORDER BY id
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 插入用户 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.example.entity.User"</span> 
            <span class="hljs-attr">useGeneratedKeys</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span>&gt;</span>
        INSERT INTO t_user (name, email, age, create_time)
        VALUES (#{name}, #{email}, #{age}, NOW())
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-comment">&lt;!--更新用户 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"update"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.example.entity.User"</span>&gt;</span>
        UPDATE t_user
        SET name = #{name},
            email = #{email},
            age = #{age}
        WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-comment">&lt;!--删除用户 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deleteById"</span>&gt;</span>
        DELETE FROM t_user
        WHERE id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>

    <span class="hljs-comment">&lt;!--动态SQL查询 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByCondition"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span>
        SELECT id, name, email, age, create_time
        FROM t_user
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"name != null and name != ''"</span>&gt;</span>
                AND name LIKE CONCAT('%', #{name}, '%')
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"age != null"</span>&gt;</span>
                AND age = #{age}
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
        ORDER BY id
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>


















































<table><thead><tr><th>元素</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>select</td><td>查询语句</td><td>...</td></tr><tr><td>insert</td><td>插入语句</td><td>...</td></tr><tr><td>update</td><td>更新语句</td><td>...</td></tr><tr><td>delete</td><td>删除语句</td><td>...</td></tr><tr><td>resultMap</td><td>结果映射</td><td>...</td></tr><tr><td>sql</td><td>可重用的SQL片段</td><td>...</td></tr><tr><td>cache</td><td>缓存配置</td><td/></tr><tr><td>cache-ref</td><td>引用缓存</td><td/></tr></tbody></table>
<h2 data-id="heading-10">3.2 注解配置方式</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">UserMapper</span> {

    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT * FROM t_user WHERE id = #{id}"</span>)
    <span class="hljs-variable">@Results</span>(id = <span class="hljs-string">"userResult"</span>, value = {
        <span class="hljs-variable">@Result</span>(property = <span class="hljs-string">"id"</span>, column = <span class="hljs-string">"id"</span>, id = true),
        <span class="hljs-variable">@Result</span>(property = <span class="hljs-string">"name"</span>, column = <span class="hljs-string">"name"</span>),
        <span class="hljs-variable">@Result</span>(property = <span class="hljs-string">"email"</span>, column = <span class="hljs-string">"email"</span>),
        <span class="hljs-variable">@Result</span>(property = <span class="hljs-string">"age"</span>, column = <span class="hljs-string">"age"</span>),
        <span class="hljs-variable">@Result</span>(property = <span class="hljs-string">"createTime"</span>, column = <span class="hljs-string">"create_time"</span>)
    })
    User <span class="hljs-built_in">selectById</span>(Long id);

    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT * FROM t_user ORDER BY id"</span>)
    List&lt;User&gt; <span class="hljs-built_in">selectAll</span>();

    <span class="hljs-variable">@Insert</span>(<span class="hljs-string">"INSERT INTO t_user (name, email, age, create_time) "</span> +
            <span class="hljs-string">"VALUES (#{name}, #{email}, #{age}, NOW())"</span>)
    <span class="hljs-variable">@Options</span>(useGeneratedKeys = true, keyProperty = <span class="hljs-string">"id"</span>)
    int <span class="hljs-built_in">insert</span>(User user);

    <span class="hljs-variable">@Update</span>(<span class="hljs-string">"UPDATE t_user SET name = #{name}, email = #{email}, "</span> +
            <span class="hljs-string">"age = #{age} WHERE id = #{id}"</span>)
    int <span class="hljs-built_in">update</span>(User user);

    <span class="hljs-variable">@Delete</span>(<span class="hljs-string">"DELETE FROM t_user WHERE id = #{id}"</span>)
    int <span class="hljs-built_in">deleteById</span>(Long id);

    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"&lt;script&gt;"</span> +
            <span class="hljs-string">"SELECT * FROM t_user "</span> +
            <span class="hljs-string">"&lt;where&gt;"</span> +
            <span class="hljs-string">"&lt;if test='name != null'&gt;"</span> +
            <span class="hljs-string">"AND name LIKE CONCAT('%', #{name}, '%')"</span> +
            <span class="hljs-string">"&lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;if test='age != null'&gt;AND age = #{age}&lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;/where&gt;"</span> +
            <span class="hljs-string">"&lt;/script&gt;"</span>)
    List&lt;User&gt; <span class="hljs-built_in">selectByCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"name"</span>) String name, 
                                  <span class="hljs-variable">@Param</span>(<span class="hljs-string">"age"</span>) Integer age);
}
</code></pre>
<h2 data-id="heading-11">3.3 混合配置方式</h2>
<p>XML和注解可以混合使用：</p>
<pre><code class="hljs language-xml" lang="xml">public interface UserMapper {
    //注解方式：简单查询
    @Select("SELECT * FROM t_user WHERE id = #{id}")
    User selectById(Long id);

    //XML方式：复杂查询
    List<span class="hljs-tag">&lt;<span class="hljs-name">User</span>&gt;</span> selectByCondition(UserQuery query);
}
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mapper.UserMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 复杂查询使用XML --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByCondition"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span>
        SELECT * FROM t_user
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"name != null"</span>&gt;</span>
                AND name LIKE CONCAT('%', #{name}, '%')
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"age != null"</span>&gt;</span>
                AND age = #{age}
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">四、动态代理实现</h2>
<p>MyBatis通过JDK动态代理自动实现Mapper接口。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2714b0021d488fb25a9c490468ba56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=XPKSrAFbSmIz4O54Pd8ltK0%2Bt7o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">4.1 MapperProxyFactory代理工厂</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperProxyFactory</span>&lt;T&gt; {
    <span class="hljs-comment">// Mapper接口类型</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Class</span>&lt;T&gt; mapperInterface;
    <span class="hljs-comment">// 方法缓存</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Method</span>, <span class="hljs-title class_">MapperMethod</span>&gt; methodCache = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MapperProxyFactory</span>(<span class="hljs-title class_">Class</span>&lt;T&gt; mapperInterface) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapperInterface</span> = mapperInterface;
    }

    <span class="hljs-comment">//创建代理实例</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">newInstance</span>(<span class="hljs-params">SqlSession sqlSession</span>) {
        final <span class="hljs-title class_">MapperProxy</span>&lt;T&gt; mapperProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperProxy</span>&lt;&gt;(
            sqlSession, mapperInterface, methodCache
        );
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">newInstance</span>(mapperProxy);
    }

    <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
    <span class="hljs-keyword">protected</span> T <span class="hljs-title function_">newInstance</span>(<span class="hljs-params">MapperProxy&lt;T&gt; mapperProxy</span>) {
        <span class="hljs-comment">// 使用JDK动态代理创建代理对象</span>
        <span class="hljs-keyword">return</span> (T) <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">newProxyInstance</span>(
            mapperInterface.<span class="hljs-title function_">getClassLoader</span>(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{mapperInterface},
            mapperProxy
        );
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Class</span>&lt;T&gt; <span class="hljs-title function_">getMapperInterface</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> mapperInterface;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Method</span>, <span class="hljs-title class_">MapperMethod</span>&gt; <span class="hljs-title function_">getMethodCache</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> methodCache;
    }
}
</code></pre>
<h2 data-id="heading-14">4.2 MapperProxy代理类</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperProxy</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">implements</span> <span class="hljs-title">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SqlSession sqlSession;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Class&lt;T&gt; mapperInterface;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Method, MapperMethod&gt; methodCache;

    <span class="hljs-keyword">public</span> MapperProxy(SqlSession sqlSession, Class&lt;T&gt; mapperInterface, 
                       Map&lt;Method, MapperMethod&gt; methodCache) {
        <span class="hljs-keyword">this</span>.sqlSession = sqlSession;
        <span class="hljs-keyword">this</span>.mapperInterface = mapperInterface;
        <span class="hljs-keyword">this</span>.methodCache = methodCache;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object invoke(Object proxy, Method method, Object[] args) 
        throws Throwable {
        <span class="hljs-comment">// 1.如果是Object类的方法，直接执行</span>
        <span class="hljs-keyword">if</span> (Object.<span class="hljs-keyword">class</span>.equals(method.getDeclaringClass())) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-keyword">this</span>, args);
            } <span class="hljs-keyword">catch</span> (Throwable t) {
                <span class="hljs-keyword">throw</span> ExceptionUtil.unwrapThrowable(t);
            }
        }

        <span class="hljs-comment">//2.获取MapperMethod并执行</span>
        <span class="hljs-keyword">final</span> MapperMethod mapperMethod = cachedMapperMethod(method);
        <span class="hljs-keyword">return</span> mapperMethod.execute(sqlSession, args);
    }

    <span class="hljs-comment">//缓存MapperMethod</span>
    <span class="hljs-keyword">private</span> MapperMethod cachedMapperMethod(Method method) {
        <span class="hljs-keyword">return</span> methodCache.computeIfAbsent(method, 
            k -&gt; new MapperMethod(mapperInterface, method, 
                                  sqlSession.getConfiguration())
        );
    }
}
</code></pre>
<h2 data-id="heading-15">4.3 MapperMethod方法执行器</h2>
<pre><code class="hljs language-ini" lang="ini">public class MapperMethod {
    // SqlCommand封装了SQL命令信息
    private final SqlCommand command<span class="hljs-comment">;</span>
    // MethodSignature封装了方法签名信息
    private final MethodSignature method<span class="hljs-comment">;</span>

    public MapperMethod(Class&lt;?&gt; mapperInterface, Method method, 
                       Configuration config) {
        <span class="hljs-attr">this.command</span> = new SqlCommand(config, mapperInterface, method)<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.method</span> = new MethodSignature(config, mapperInterface, method)<span class="hljs-comment">;</span>
    }

    public Object execute(SqlSession sqlSession, Object<span class="hljs-section">[]</span> args) {
        Object result<span class="hljs-comment">;</span>

        switch (command.getType()) {
            case INSERT: {
                //插入操作
                Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
                <span class="hljs-attr">result</span> = rowCountResult(
                    sqlSession.insert(command.getName(), param)
                )<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            }
            case UPDATE: {
                //更新操作
                Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
                <span class="hljs-attr">result</span> = rowCountResult(
                    sqlSession.update(command.getName(), param)
                )<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            }
            case DELETE: {
                //删除操作
                Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
                <span class="hljs-attr">result</span> = rowCountResult(
                    sqlSession.delete(command.getName(), param)
                )<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            }
            case SELECT:
                if (method.returnsVoid() &amp;&amp; method.hasResultHandler()) {
                    // 有ResultHandler的查询
                    executeWithResultHandler(sqlSession, args)<span class="hljs-comment">;</span>
                    <span class="hljs-attr">result</span> = null<span class="hljs-comment">;</span>
                } else if (method.returnsMany()) {
                    //返回集合
                    <span class="hljs-attr">result</span> = executeForMany(sqlSession, args)<span class="hljs-comment">;</span>
                } else if (method.returnsMap()) {
                    //返回Map
                    <span class="hljs-attr">result</span> = executeForMap(sqlSession, args)<span class="hljs-comment">;</span>
                } else if (method.returnsCursor()) {
                    //返回Cursor
                    <span class="hljs-attr">result</span> = executeForCursor(sqlSession, args)<span class="hljs-comment">;</span>
                } else {
                    //返回单个对象
                    Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
                    <span class="hljs-attr">result</span> = sqlSession.selectOne(command.getName(), param)<span class="hljs-comment">;</span>
                    if (method.returnsOptional() &amp;&amp; 
                        (<span class="hljs-attr">result</span> == null || 
                         !method.getReturnType().equals(result.getClass()))) {
                        <span class="hljs-attr">result</span> = Optional.ofNullable(result)<span class="hljs-comment">;</span>
                    }
                }
                break<span class="hljs-comment">;</span>
            case FLUSH:
                <span class="hljs-attr">result</span> = sqlSession.flushStatements()<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            default:
                throw new BindingException(
                    "Unknown execution method for: " + command.getName()
                )<span class="hljs-comment">;</span>
        }

        if (<span class="hljs-attr">result</span> == null &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; 
            !method.returnsVoid()) {
            throw new BindingException(
                "Mapper method '" + command.getName() + 
                "' attempted to return null from a method with " +
                "a primitive return type (" + method.getReturnType() + ")."
            )<span class="hljs-comment">;</span>
        }
        return result<span class="hljs-comment">;</span>
    }

    // 执行返回多条的查询
    private &lt;E&gt; Object executeForMany(SqlSession sqlSession, Object<span class="hljs-section">[]</span> args) {
        List&lt;E&gt; result<span class="hljs-comment">;</span>
        Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
        if (method.hasRowBounds()) {
            RowBounds <span class="hljs-attr">rowBounds</span> = method.extractRowBounds(args)<span class="hljs-comment">;</span>
            <span class="hljs-attr">result</span> = sqlSession.selectList(
                command.getName(), param, rowBounds
            )<span class="hljs-comment">;</span>
        } else {
            <span class="hljs-attr">result</span> = sqlSession.selectList(command.getName(), param)<span class="hljs-comment">;</span>
        }
        return result<span class="hljs-comment">;</span>
    }

    // 执行返回Map的查询
    private &lt;K, V&gt; Map&lt;K, V&gt; executeForMap(SqlSession sqlSession, 
                                            Object<span class="hljs-section">[]</span> args) {
        Object <span class="hljs-attr">param</span> = method.convertArgsToSqlCommandParam(args)<span class="hljs-comment">;</span>
        Map&lt;K, V&gt; result<span class="hljs-comment">;</span>
        if (method.hasRowBounds()) {
            RowBounds <span class="hljs-attr">rowBounds</span> = method.extractRowBounds(args)<span class="hljs-comment">;</span>
            <span class="hljs-attr">result</span> = sqlSession.selectMap(
                command.getName(), param, method.getMapKey(), rowBounds
            )<span class="hljs-comment">;</span>
        } else {
            <span class="hljs-attr">result</span> = sqlSession.selectMap(
                command.getName(), param, method.getMapKey()
            )<span class="hljs-comment">;</span>
        }
        return result<span class="hljs-comment">;</span>
    }

    // 处理行数结果
    private Object rowCountResult(int rowCount) {
        final Object result<span class="hljs-comment">;</span>
        if (method.returnsVoid()) {
            <span class="hljs-attr">result</span> = null<span class="hljs-comment">;</span>
        } else if (Integer.TYPE.equals(method.getReturnType()) || 
                   Integer.class.equals(method.getReturnType())) {
            <span class="hljs-attr">result</span> = rowCount<span class="hljs-comment">;</span>
        } else if (Long.TYPE.equals(method.getReturnType()) || 
                   Long.class.equals(method.getReturnType())) {
            <span class="hljs-attr">result</span> = (long) rowCount<span class="hljs-comment">;</span>
        } else if (Boolean.TYPE.equals(method.getReturnType()) || 
                   Boolean.class.equals(method.getReturnType())) {
            <span class="hljs-attr">result</span> = rowCount &gt; <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        } else {
            throw new BindingException(
                "Mapper method '" + command.getName() + 
                "' has an unsupported return type: " + 
                method.getReturnType()
            )<span class="hljs-comment">;</span>
        }
        return result<span class="hljs-comment">;</span>
    }

    //内部类：SqlCommand
    public static class SqlCommand {
        private final String name<span class="hljs-comment">;</span>
        private final SqlCommandType type<span class="hljs-comment">;</span>

        public SqlCommand(Configuration configuration, 
                         Class&lt;?&gt; mapperInterface, Method method) {
            final String <span class="hljs-attr">methodName</span> = method.getName()<span class="hljs-comment">;</span>
            final Class&lt;?&gt; <span class="hljs-attr">declaringClass</span> = method.getDeclaringClass()<span class="hljs-comment">;</span>

            // 解析MappedStatement
            MappedStatement <span class="hljs-attr">ms</span> = resolveMappedStatement(
                mapperInterface, methodName, declaringClass, configuration
            )<span class="hljs-comment">;</span>

            if (<span class="hljs-attr">ms</span> == null) {
                if (method.getAnnotation(Flush.class) != null) {
                    <span class="hljs-attr">name</span> = null<span class="hljs-comment">;</span>
                    <span class="hljs-attr">type</span> = SqlCommandType.FLUSH<span class="hljs-comment">;</span>
                } else {
                    throw new BindingException(
                        "Invalid bound statement (not found): " + 
                        mapperInterface.getName() + "." + methodName
                    )<span class="hljs-comment">;</span>
                }
            } else {
                <span class="hljs-attr">name</span> = ms.getId()<span class="hljs-comment">;</span>
                <span class="hljs-attr">type</span> = ms.getSqlCommandType()<span class="hljs-comment">;</span>
                if (<span class="hljs-attr">type</span> == SqlCommandType.UNKNOWN) {
                    throw new BindingException(
                        "Unknown execution method for: " + name
                    )<span class="hljs-comment">;</span>
                }
            }
        }

        private MappedStatement resolveMappedStatement(
            Class&lt;?&gt; mapperInterface, String methodName, 
            Class&lt;?&gt; declaringClass, Configuration configuration) {
            String <span class="hljs-attr">statementId</span> = mapperInterface.getName() + <span class="hljs-string">"."</span> + methodName<span class="hljs-comment">;</span>
            if (configuration.hasStatement(statementId)) {
                return configuration.getMappedStatement(statementId)<span class="hljs-comment">;</span>
            }
            return null<span class="hljs-comment">;</span>
        }

        public String getName() {
            return name<span class="hljs-comment">;</span>
        }

        public SqlCommandType getType() {
            return type<span class="hljs-comment">;</span>
        }
    }

    //内部类：MethodSignature
    public static class MethodSignature {
        private final boolean returnsMany<span class="hljs-comment">;</span>
        private final boolean returnsMap<span class="hljs-comment">;</span>
        private final boolean returnsVoid<span class="hljs-comment">;</span>
        private final boolean returnsCursor<span class="hljs-comment">;</span>
        private final boolean returnsOptional<span class="hljs-comment">;</span>
        private final Class&lt;?&gt; returnType<span class="hljs-comment">;</span>
        private final String mapKey<span class="hljs-comment">;</span>
        private final Integer resultHandlerIndex<span class="hljs-comment">;</span>
        private final Integer rowBoundsIndex<span class="hljs-comment">;</span>
        private final ParamNameResolver paramNameResolver<span class="hljs-comment">;</span>

        public MethodSignature(Configuration configuration, 
                              Class&lt;?&gt; mapperInterface, Method method) {
            Type <span class="hljs-attr">resolvedReturnType</span> = typeParameterResolver(method)<span class="hljs-comment">;</span>

            // 解析返回类型
            if (resolvedReturnType instanceof Void) {
                <span class="hljs-attr">this.returnsVoid</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            } else if (Collection.class.isAssignableFrom(
                (Class&lt;?&gt;) resolvedReturnType) || 
                resolvedReturnType.isArray()) {
                <span class="hljs-attr">this.returnsMany</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            } else if (Map.class.isAssignableFrom(
                (Class&lt;?&gt;) resolvedReturnType)) {
                <span class="hljs-attr">this.returnsMap</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            } else {
                <span class="hljs-attr">this.returnsMany</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
                <span class="hljs-attr">this.returnsMap</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
            }
            // ... 省略其他初始化代码
        }

        public Object convertArgsToSqlCommandParam(Object<span class="hljs-section">[]</span> args) {
            return paramNameResolver.getNamedParams(args)<span class="hljs-comment">;</span>
        }

        public boolean hasRowBounds() {
            return rowBoundsIndex != null<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-16">4.4 代理执行流程</h2>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 调用Mapper接口方法
   ↓
<span class="hljs-bullet">2.</span> 触发MapperProxy.invoke()
   ↓
<span class="hljs-bullet">3.</span> 获取或创建MapperMethod
   ↓
<span class="hljs-bullet">4.</span> 执行MapperMethod.execute()
   ↓
<span class="hljs-bullet">5.</span> 根据SQL类型调用SqlSession方法
   ↓
<span class="hljs-bullet">6.</span> Executor执行SQL
   ↓
<span class="hljs-bullet">7.</span> 返回结果
</code></pre>
<h2 data-id="heading-17">五、Mapper注册流程</h2>
<p>Mapper接口需要注册到MyBatis才能使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e56894344dc4462bd1b15684e20d0e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=C%2BAfBqxlMS2uJWvlPoc%2F%2BYPanh8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18">5.1 注册方式</h2>
<pre><code class="hljs language-typescript" lang="typescript">&lt;configuration&gt;
    &lt;!-- 注册<span class="hljs-title class_">Mapper</span>接口 --&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
        <span class="hljs-comment">&lt;!--使用类路径 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.mapper.UserMapper"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!--使用包扫描 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.mapper"</span>/&gt;</span>

        <span class="hljs-comment">&lt;!--使用XML资源路径 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"com/example/mapper/UserMapper.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span></span>
&lt;/configuration&gt;
<span class="hljs-comment">// 创建Configuration</span>
<span class="hljs-title class_">Configuration</span> configuration = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();

<span class="hljs-comment">// 注册Mapper接口</span>
configuration.<span class="hljs-title function_">addMapper</span>(<span class="hljs-title class_">UserMapper</span>.<span class="hljs-property">class</span>);
configuration.<span class="hljs-title function_">addMapper</span>(<span class="hljs-title class_">OrderMapper</span>.<span class="hljs-property">class</span>);

<span class="hljs-comment">// 或者通过MapperRegistry</span>
<span class="hljs-title class_">MapperRegistry</span> mapperRegistry = configuration.<span class="hljs-title function_">getMapperRegistry</span>();
mapperRegistry.<span class="hljs-title function_">addMapper</span>(<span class="hljs-title class_">UserMapper</span>.<span class="hljs-property">class</span>);
<span class="hljs-title class_">SqlSessionFactoryBuilder</span> builder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>();

<span class="hljs-comment">// 通过InputStream</span>
<span class="hljs-title class_">SqlSessionFactory</span> factory = builder.<span class="hljs-title function_">build</span>(inputStream);

<span class="hljs-comment">// 通过Configuration</span>
<span class="hljs-title class_">Environment</span> environment = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Environment</span>(<span class="hljs-string">"development"</span>, ...);
<span class="hljs-title class_">Configuration</span> configuration = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(environment);
configuration.<span class="hljs-title function_">addMapper</span>(<span class="hljs-title class_">UserMapper</span>.<span class="hljs-property">class</span>);
<span class="hljs-title class_">SqlSessionFactory</span> factory = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().<span class="hljs-title function_">build</span>(configuration);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Configuration</span> {
    <span class="hljs-keyword">protected</span> final <span class="hljs-title class_">MapperRegistry</span> mapperRegistry = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapperRegistry</span>(<span class="hljs-variable language_">this</span>);

    <span class="hljs-comment">// 添加Mapper</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-built_in">void</span> <span class="hljs-title function_">addMapper</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span></span>) {
        mapperRegistry.<span class="hljs-title function_">addMapper</span>(<span class="hljs-keyword">type</span>);
    }

    <span class="hljs-comment">// 获取Mapper</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getMapper</span>(<span class="hljs-params">Class&lt;T&gt; <span class="hljs-keyword">type</span>, SqlSession sqlSession</span>) {
        <span class="hljs-keyword">return</span> mapperRegistry.<span class="hljs-title function_">getMapper</span>(<span class="hljs-keyword">type</span>, sqlSession);
    }

    <span class="hljs-comment">// 检查Mapper是否存在</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasMapper</span>(<span class="hljs-params">Class&lt;?&gt; <span class="hljs-keyword">type</span></span>) {
        <span class="hljs-keyword">return</span> mapperRegistry.<span class="hljs-title function_">hasMapper</span>(<span class="hljs-keyword">type</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MapperRegistry</span> <span class="hljs-title function_">getMapperRegistry</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> mapperRegistry;
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperScannerConfigurer</span> {
    <span class="hljs-comment">// 扫描包路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> basePackage;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span>(<span class="hljs-params">
        BeanDefinitionRegistry registry</span>) {
        <span class="hljs-comment">// 创建扫描器</span>
        <span class="hljs-title class_">ClassPathMapperScanner</span> scanner = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathMapperScanner</span>(registry);

        <span class="hljs-comment">// 设置扫描包</span>
        scanner.<span class="hljs-title function_">scan</span>(<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">tokenizeToStringArray</span>(
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">basePackage</span>,
            <span class="hljs-title class_">ConfigurableApplicationContext</span>.<span class="hljs-property">CONFIG_LOCATION_DELIMITERS</span>
        ));
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassPathMapperScanner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ClassPathBeanDefinitionScanner</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">BeanDefinitionHolder</span>&gt; <span class="hljs-title function_">doScan</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>... basePackages</span>) {
        <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">BeanDefinitionHolder</span>&gt; beanDefinitions = 
            <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">doScan</span>(basePackages);

        <span class="hljs-keyword">if</span> (beanDefinitions.<span class="hljs-title function_">isEmpty</span>()) {
            logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"No MyBatis mapper was found in '"</span> + 
                <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">toString</span>(basePackages) + 
                <span class="hljs-string">"' package. Please check your configuration."</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 处理BeanDefinition</span>
            <span class="hljs-title function_">processBeanDefinitions</span>(beanDefinitions);
        }

        <span class="hljs-keyword">return</span> beanDefinitions;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processBeanDefinitions</span>(<span class="hljs-params">
        <span class="hljs-built_in">Set</span>&lt;BeanDefinitionHolder&gt; beanDefinitions</span>) {
        <span class="hljs-title class_">GenericBeanDefinition</span> definition;
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">BeanDefinitionHolder</span> holder : beanDefinitions) {
            definition = (<span class="hljs-title class_">GenericBeanDefinition</span>) holder.<span class="hljs-title function_">getBeanDefinition</span>();

            <span class="hljs-comment">// 设置BeanClass为MapperFactoryBean</span>
            definition.<span class="hljs-title function_">getConstructorArgumentValues</span>()
                .<span class="hljs-title function_">addGenericArgumentValue</span>(definition.<span class="hljs-title function_">getBeanClassName</span>());
            definition.<span class="hljs-title function_">setBeanClass</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapperFactoryBean</span>.<span class="hljs-title function_">getClass</span>());

            <span class="hljs-comment">// ... 省略其他配置</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-19">六、Mapper执行流程</h2>
<p>理解Mapper的执行流程对于调试和优化至关重要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/175c30a73fe44186ab69deb68a0fafc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768116835&amp;x-signature=N%2Fi4UDa9YNZCjW89O%2BXz%2Fcpw80Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">6.1 完整执行流程</h2>
<pre><code class="hljs language-ini" lang="ini">//1.获取SqlSession
SqlSession <span class="hljs-attr">session</span> = sqlSessionFactory.openSession()<span class="hljs-comment">;</span>
try {
    //2.获取Mapper代理对象
    UserMapper <span class="hljs-attr">userMapper</span> = session.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
    //3.调用Mapper方法
    User <span class="hljs-attr">user</span> = userMapper.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>
    //4.使用结果
    System.out.println(user)<span class="hljs-comment">;</span>
    //5.提交事务
    session.commit()<span class="hljs-comment">;</span>
} finally {
    //6.关闭Session
    session.close()<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-21">6.2 详细执行步骤</h2>
<pre><code class="hljs language-css" lang="css">步骤<span class="hljs-number">1</span>: 获取Mapper代理对象
    session.<span class="hljs-built_in">getMapper</span>(UserMapper.class)
    ↓
    configuration.<span class="hljs-built_in">getMapper</span>(UserMapper.class, this)
    ↓
    mapperRegistry.<span class="hljs-built_in">getMapper</span>(UserMapper.class, this)
    ↓
    mapperProxyFactory.<span class="hljs-built_in">newInstance</span>(this)
    ↓
    Proxy.<span class="hljs-built_in">newProxyInstance</span>(...) → 创建代理对象
步骤<span class="hljs-number">2</span>: 调用Mapper方法
    userMapper.<span class="hljs-built_in">selectById</span>(<span class="hljs-number">1</span>L)
    ↓
    MapperProxy.<span class="hljs-built_in">invoke</span>(proxy, method, args)
    ↓
    <span class="hljs-built_in">cachedMapperMethod</span>(method)
    ↓
    mapperMethod.<span class="hljs-built_in">execute</span>(sqlSession, args)
步骤<span class="hljs-number">3</span>: 执行SQL
    SqlCommandType.SELECT
    ↓
    sqlSession.<span class="hljs-built_in">selectOne</span>(statementId, param)
    ↓
    executor.<span class="hljs-built_in">query</span>(ms, param, rowBounds, resultHandler)
    ↓
    创建CacheKey
    ↓
    查询缓存
    ↓
    查询数据库
    ↓
    映射结果
步骤<span class="hljs-number">4</span>: 返回结果
    处理ResultSet
    ↓
    ObjectFactory创建对象
    ↓
    ResultHandler映射
    ↓
    返回User对象
</code></pre>
<h2 data-id="heading-22">6.3 执行时序图</h2>
<pre><code class="hljs">应用 → MapperProxy → MapperMethod → SqlSession → 
Executor → StatementHandler → Database
</code></pre>
<h2 data-id="heading-23">6.4 异常处理</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">1L</span>);
} <span class="hljs-keyword">catch</span> (PersistenceException e) {
    <span class="hljs-comment">// 持久化异常</span>
    <span class="hljs-type">Throwable</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> e.getCause();
    <span class="hljs-keyword">if</span> (cause <span class="hljs-keyword">instanceof</span> SQLException) {
        <span class="hljs-comment">// 处理SQL异常</span>
        <span class="hljs-type">SQLException</span> <span class="hljs-variable">sqlEx</span> <span class="hljs-operator">=</span> (SQLException) cause;
        System.out.println(<span class="hljs-string">"SQL Error: "</span> + sqlEx.getMessage());
    }
} <span class="hljs-keyword">catch</span> (BindingException e) {
    <span class="hljs-comment">// 绑定异常：Mapper方法未找到</span>
    System.out.println(<span class="hljs-string">"Mapper method not found: "</span> + e.getMessage());
}
</code></pre>
<h2 data-id="heading-24">七、最佳实践</h2>
<h2 data-id="heading-25">7.1 Mapper设计建议</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>️⃣ 单一职责 - 每个Mapper对应一张表
<span class="hljs-number">2</span>️⃣ 命名规范 - 接口名与实体名对应
<span class="hljs-number">3</span>️⃣ 方法命名 - 使用语义化的方法名
<span class="hljs-number">4</span>️⃣ 参数设计 - 使用<span class="hljs-keyword">@Param</span>注解明确参数名
</code></pre>
<h2 data-id="heading-26">7.2 性能优化建议</h2>
<pre><code class="hljs">1️⃣ 合理使用缓存 - 二级缓存提升性能
2️⃣ 避免N+1查询 - 使用关联查询
3️⃣ 分页查询 - 使用RowBounds或PageHelper
4️⃣ 批量操作 - 使用BatchExecutor
</code></pre>
<h2 data-id="heading-27">7.3 常见问题解决</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span>错误：多参数未使用<span class="hljs-variable">@Param</span>
List<span class="hljs-operator">&lt;</span><span class="hljs-keyword">User</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span>(String name, <span class="hljs-type">Integer</span> age);

<span class="hljs-operator">/</span><span class="hljs-operator">/</span>正确：使用<span class="hljs-variable">@Param</span>
List<span class="hljs-operator">&lt;</span><span class="hljs-keyword">User</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span>(<span class="hljs-variable">@Param</span>("name") String name,
                 <span class="hljs-variable">@Param</span>("age") <span class="hljs-type">Integer</span> age);
<span class="hljs-operator">&lt;</span><span class="hljs-operator">!</span><span class="hljs-comment">--正确：使用resultMap --&gt;</span>
<span class="hljs-operator">&lt;</span>resultMap id<span class="hljs-operator">=</span>"BaseResultMap" type<span class="hljs-operator">=</span>"User"<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span>id <span class="hljs-keyword">column</span><span class="hljs-operator">=</span>"id" property<span class="hljs-operator">=</span>"id"<span class="hljs-operator">/</span><span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span><span class="hljs-keyword">result</span> <span class="hljs-keyword">column</span><span class="hljs-operator">=</span>"user_name" property<span class="hljs-operator">=</span>"name"<span class="hljs-operator">/</span><span class="hljs-operator">&gt;</span>
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>resultMap<span class="hljs-operator">&gt;</span>

<span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> id<span class="hljs-operator">=</span>"selectById" resultMap<span class="hljs-operator">=</span>"BaseResultMap"<span class="hljs-operator">&gt;</span>
    <span class="hljs-keyword">SELECT</span> id, user_name <span class="hljs-keyword">FROM</span> t_user <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #{id}
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span><span class="hljs-keyword">select</span><span class="hljs-operator">&gt;</span>
</code></pre>
<h2 data-id="heading-28">八、总结</h2>
<p>MyBatis的映射器模块通过接口+配置的方式，实现了优雅的数据库操作。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-number">1</span>️⃣ Mapper接口 <span class="hljs-operator">-</span> 定义数据库操作方法
<span class="hljs-number">2</span>️⃣ <span class="hljs-keyword">SQL</span>映射 <span class="hljs-operator">-</span> XML或注解配置<span class="hljs-keyword">SQL</span>语句
<span class="hljs-number">3</span>️⃣ 动态代理 <span class="hljs-operator">-</span> JDK动态代理自动实现接口
<span class="hljs-number">4</span>️⃣ MapperProxy <span class="hljs-operator">-</span> 拦截方法调用并执行<span class="hljs-keyword">SQL</span>
<span class="hljs-number">5</span>️⃣ MapperMethod <span class="hljs-operator">-</span> 封装方法执行逻辑
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告警的艺术：从 node_exporter 指标到生产级规则]]></title>    <link>https://juejin.cn/post/7590330924002312255</link>    <guid>https://juejin.cn/post/7590330924002312255</guid>    <pubDate>2026-01-04T02:45:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590330924002312255" data-draft-id="7590283328177504299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告警的艺术：从 node_exporter 指标到生产级规则"/> <meta itemprop="keywords" content="后端,监控,架构"/> <meta itemprop="datePublished" content="2026-01-04T02:45:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告警的艺术：从 node_exporter 指标到生产级规则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T02:45:43.000Z" title="Sun Jan 04 2026 02:45:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>凌晨 3 点，手机震动。</p>
<pre><code class="hljs language-makefile" lang="makefile">告警：server-01 CPU 使用率超过 80%
<span class="hljs-section">触发时间：03:12:45</span>
持续时长：2 分钟
</code></pre>
<p>你睁开惺忪的眼睛，登录服务器查看，发现只是 Jenkins 在跑定时编译任务。</p>
<p>这已经是本周第 12 次误报。</p>
<p>问题不在 Prometheus，也不在 node_exporter，而在<strong>告警规则的设计</strong>。</p>
<hr/>
<p>在<a href="https://juejin.cn/post/7589481566424596534" target="_blank" title="https://juejin.cn/post/7589481566424596534">《从 node-exporter 学如何写出可复用的监控指标》</a>中，我们学习了 node_exporter 的设计哲学：暴露事实，不是观点。</p>
<ul>
<li>CPU 暴露的是累计时间，不是使用率</li>
<li>内存暴露的是多个 Gauge，不是一个"使用率"</li>
<li>磁盘容量和 IO 分开设计</li>
</ul>
<p>这些"事实"很完整，但问题来了：<strong>有了指标，怎么变成告警？</strong></p>
<p>这不是简单设个阈值就行。你真的需要在 CPU 达到 80% 时立即告警吗？还是应该等它持续 10 分钟再打扰你？</p>
<p>本文聚焦一个核心问题：**基于 node_exporter 的数据，如何设计一套生产级的虚拟机告警规则？</p>
<h2 data-id="heading-0">1. 为什么需要告警规则的设计智慧</h2>
<h3 data-id="heading-1">1.1 Alertmanager 的局限</h3>
<p>很多人觉得 Prometheus 有 Alertmanager，为什么还要自研告警引擎？</p>
<p><strong>Alertmanager 的三个痛点：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Alertmanager 的配置</span>
<span class="hljs-attr">route:</span>
  <span class="hljs-attr">group_by:</span> [<span class="hljs-string">'alertname'</span>]
  <span class="hljs-attr">group_wait:</span> <span class="hljs-string">30s</span>
  <span class="hljs-attr">group_interval:</span> <span class="hljs-string">5m</span>
  <span class="hljs-attr">repeat_interval:</span> <span class="hljs-string">4h</span>
  <span class="hljs-attr">receiver:</span> <span class="hljs-string">'team-pager'</span>
</code></pre>

























<table><thead><tr><th>问题</th><th>表现</th><th>影响</th></tr></thead><tbody><tr><td><strong>配置复杂</strong></td><td>YAML 难理解</td><td>运维成本高，改规则要重启</td></tr><tr><td><strong>无状态可见</strong></td><td>不知道当前有哪些告警</td><td>无法追溯告警历史</td></tr><tr><td><strong>难以扩展</strong></td><td>加功能要改源码</td><td>无法融入业务逻辑</td></tr></tbody></table>
<p><strong>一个真实场景：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">运维：<span class="hljs-string">"CPU 使用率高的告警触发了多少次？"</span>
Alertmanager：<span class="hljs-string">"不知道，我不存历史。"</span>

运维：<span class="hljs-string">"这个告警持续多久了？"</span>
Alertmanager：<span class="hljs-string">"不知道，我只管通知。"</span>

运维：<span class="hljs-string">"能不能在发布窗口屏蔽告警？"</span>
Alertmanager：<span class="hljs-string">"可以，但要写复杂的 YAML。"</span>
</code></pre>
<p><strong>自研的价值：</strong></p>
<ul>
<li>Web UI 管理规则，不用改 YAML</li>
<li>数据库存储历史，可以分析趋势</li>
<li>灵活扩展，融入业务场景（如发布窗口自动静默）</li>
</ul>
<h3 data-id="heading-2">1.2 Google 的两个方法论</h3>
<p>Google SRE 给了我们两个黄金法则：</p>
<p><strong>USE 方法（资源监控）：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[Utilization&lt;br/&gt;利用率] --&gt; B[提前预警]
    C[Saturation&lt;br/&gt;饱和度] --&gt; D[确认拥塞]
    E[Errors&lt;br/&gt;错误] --&gt; F[确认故障]
    
    style A fill:#fff4e1
    style C fill:#ffe1f5
    style E fill:#ffcccc
</code></pre>
<ul>
<li><strong>Utilization</strong>：资源用了多少？（CPU 80% → 需要关注）</li>
<li><strong>Saturation</strong>：是否有排队？（IO 队列长 → 性能下降）</li>
<li><strong>Errors</strong>：是否有错误？（磁盘错误 → 硬件故障）</li>
</ul>
<p><strong>四个黄金信号（服务监控）：</strong></p>
<p>虽然虚拟机不是"服务"，但可以映射：</p>
<ul>
<li><strong>Latency</strong>：IO 延迟高 → 影响上层应用</li>
<li><strong>Traffic</strong>：网络流量异常 → 可能被攻击</li>
<li><strong>Errors</strong>：硬件错误 → 需要介入</li>
<li><strong>Saturation</strong>：资源饱和 → 需要扩容</li>
</ul>
<p><strong>启示：告警不是简单设阈值，而是要理解系统在不同阶段的表现。</strong></p>
<h3 data-id="heading-3">1.3 从指标到告警的核心挑战</h3>
<p>node_exporter 给了我们"事实"：</p>
<pre><code class="hljs language-ini" lang="ini">node_cpu_seconds_total{<span class="hljs-attr">mode</span>=<span class="hljs-string">"user"</span>} <span class="hljs-number">123456</span>   <span class="hljs-comment"># CPU 累计时间</span>
node_memory_MemAvailable_bytes 8388608000    <span class="hljs-comment"># 可用内存</span>
node_filesystem_avail_bytes 53687091200      <span class="hljs-comment"># 磁盘可用空间</span>
</code></pre>
<p>但这些是 Counter 和 Gauge，怎么变成告警？</p>
<p><strong>三个核心问题：</strong></p>
<ol>
<li><strong>阈值怎么定？</strong> —— 80% 合适还是 90% 合适？</li>
<li><strong>怎么过滤毛刺？</strong> —— 短暂峰值要不要告警？</li>
<li><strong>如何提前预警？</strong> —— 等到真出问题才告是不是太晚了？</li>
</ol>
<p>接下来，我们用 CPU、内存、磁盘、网络四个维度，看看如何设计告警规则。</p>
<hr/>
<h2 data-id="heading-4">2. CPU 告警：不只是设个 80%</h2>
<h3 data-id="heading-5">2.1 错误示例</h3>
<p>很多人第一反应是这样：</p>
<pre><code class="hljs language-promql" lang="promql"># 错误示例：CPU 使用率 &gt; 80% 就告警
(1 - avg(rate(node_cpu_seconds_total{mode="idle"}[5m]))) * 100 &gt; 80
</code></pre>
<p><strong>会发生什么？</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">10:00 - CPU 85%（代码编译，正常）  → 告警</span>
<span class="hljs-section">10:01 - CPU 60%（编译结束）        → 恢复</span>
<span class="hljs-section">10:05 - CPU 85%（定时任务，正常）  → 告警</span>
<span class="hljs-section">10:06 - CPU 50%                    → 恢复</span>

一天收到几十条告警，都是正常的业务波动。
</code></pre>
<p><strong>问题：</strong></p>
<ul>
<li>没有时间维度，瞬时峰值也告警</li>
<li>80% 的阈值太低，正常繁忙就会触发</li>
<li>不区分"临时忙"和"持续忙"</li>
</ul>
<h3 data-id="heading-6">2.2 正确示例 1：加上时间维度</h3>
<pre><code class="hljs language-promql" lang="promql"># 正确示例：CPU 持续 10 分钟 &gt; 90%
(1 - avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) by (instance)) * 100 &gt; 90
for: 10m
</code></pre>
<p><strong>改进点：</strong></p>

























<table><thead><tr><th>参数</th><th>值</th><th>作用</th></tr></thead><tbody><tr><td><code>[5m]</code></td><td>评估窗口</td><td>平滑 15 秒抓取间隔的抖动</td></tr><tr><td><code>&gt; 90</code></td><td>阈值提高</td><td>留 10% 缓冲，避免误报</td></tr><tr><td><code>for: 10m</code></td><td>持续时长</td><td>过滤临时波动（编译、备份）</td></tr></tbody></table>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[首次超过 90%] --&gt; B[观察 10 分钟]
    B --&gt; C{持续超过?}
    C --&gt;|是| D[触发告警]
    C --&gt;|否| E[取消]
    
    style A fill:#fff4e1
    style D fill:#ffcccc
    style E fill:#ccffcc
</code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>短暂的编译、备份不会告警</li>
<li>只有真正持续繁忙才告警</li>
<li>误报率从 80% 降到 &lt; 10%</li>
</ul>
<h3 data-id="heading-7">2.3 正确示例 2：区分 CPU 模式</h3>
<p>整机 CPU 告诉你"忙不忙"，但不知道"为什么忙"。</p>
<pre><code class="hljs language-promql" lang="promql"># 用户态 CPU 过高 → 应用代码效率问题
avg(rate(node_cpu_seconds_total{mode="user"}[5m])) by (instance) &gt; 0.8
for: 10m

# 系统态 CPU 过高 → 系统调用过多（网络/磁盘 IO）
avg(rate(node_cpu_seconds_total{mode="system"}[5m])) by (instance) &gt; 0.3
for: 10m

# iowait 过高 → 磁盘 IO 瓶颈
avg(rate(node_cpu_seconds_total{mode="iowait"}[5m])) by (instance) &gt; 0.2
for: 5m
</code></pre>
<p><strong>价值：不只知道"CPU 高"，还知道"为什么高"。</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">场景 <span class="hljs-number">1</span>：整机 CPU <span class="hljs-number">90</span><span class="hljs-comment">%，同时 user 高</span>
→ 运维：应用代码有问题，去排查业务

场景 <span class="hljs-number">2</span>：整机 CPU <span class="hljs-number">90</span><span class="hljs-comment">%，同时 iowait 高</span>
→ 运维：磁盘 IO 慢，去排查磁盘

场景 <span class="hljs-number">3</span>：整机 CPU <span class="hljs-number">90</span><span class="hljs-comment">%，同时 system 高</span>
→ 运维：系统调用多，可能是网络问题
</code></pre>
<p>这就是区分模式的价值：同样是 CPU 90%，但问题的根因完全不同，处理方式也不同。</p>
<hr/>
<h2 data-id="heading-8">3. 内存告警：Linux 的内存不是你想的那样</h2>
<h3 data-id="heading-9">3.1 错误示例</h3>
<pre><code class="hljs language-promql" lang="promql"># 错误示例：用 MemFree 计算使用率
(1 - node_memory_MemFree_bytes / node_memory_MemTotal_bytes) * 100 &gt; 90
</code></pre>
<p><strong>会发生什么？</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">16G 内存的服务器：
<span class="hljs-section">MemTotal: 16G</span>
<span class="hljs-section">MemFree:  1G   (真正空闲)</span>
<span class="hljs-section">Cached:   8G   (文件缓存，可释放)</span>

错误计算：使用率 = (16 - 1) / 16 = 93.75%
→ 告警：<span class="hljs-string">"内存不足！"</span>
→ 运维登录查看
→ 发现 8G 是 cache，随时可以释放
→ 误报！
</code></pre>
<p><strong>问题：不理解 Linux 内存管理机制。</strong></p>
<p>Linux 会把空闲内存用来做 cache，提升文件读取性能。这些 cache 在应用需要内存时会自动释放，不应该算作"已使用"。</p>
<h3 data-id="heading-10">3.2 正确示例 1：用 MemAvailable</h3>
<pre><code class="hljs language-promql" lang="promql"># 正确示例：用 MemAvailable 计算
(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 &gt; 90
for: 5m
</code></pre>
<p><strong>MemAvailable 是什么？</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">MemAvailable</span> = MemFree + 可回收的 Cache + 可回收的 Buffer
</code></pre>
<p>这才是真正可用的内存。</p>
<blockquote>
<p>注意：<code>node_memory_MemAvailable_bytes</code> 在 node_exporter v0.16+ 版本才可用。如果你的版本较旧，需要先升级。</p>
</blockquote>
<p><strong>对比：</strong></p>
<pre><code class="hljs language-ini" lang="ini">场景：16G 内存服务器

MemFree:      1G
Cached:       8G (可回收)
MemAvailable: 9G

用 MemFree：
使用率 = (16 - 1) / <span class="hljs-attr">16</span> = <span class="hljs-number">93.75</span>%  → 误报

用 MemAvailable：
使用率 = (16 - 9) / <span class="hljs-attr">16</span> = <span class="hljs-number">43.75</span>%  → 正确
</code></pre>
<h3 data-id="heading-11">3.3 正确示例 2：预测未来耗尽</h3>
<p>当前可用内存充足，但如果有内存泄漏，迟早会耗尽。</p>
<pre><code class="hljs language-promql" lang="promql"># 预测 4 小时后可用内存是否耗尽
predict_linear(node_memory_MemAvailable_bytes[1h], 4*3600) &lt; 0
for: 10m
</code></pre>
<p><strong>predict_linear 的原理：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[过去 1 小时数据] --&gt; B[线性回归]
    B --&gt; C[预测 4 小时后]
    C --&gt; D{&lt; 0?}
    D --&gt;|是| E[告警]
    
    style A fill:#e1f5ff
    style E fill:#ffcccc
</code></pre>
<p><strong>案例：</strong></p>
<pre><code class="hljs language-ini" lang="ini">10:00 - <span class="hljs-attr">MemAvailable</span> = <span class="hljs-number">10</span>G
10:30 - <span class="hljs-attr">MemAvailable</span> = <span class="hljs-number">8</span>G
11:00 - <span class="hljs-attr">MemAvailable</span> = <span class="hljs-number">6</span>G

每小时下降 4G
→ 预测 4 小时后：6G - <span class="hljs-attr">16G</span> = -<span class="hljs-number">10</span>G &lt; <span class="hljs-number">0</span>
→ 触发告警："预计 4 小时后内存耗尽"
</code></pre>
<p><strong>价值：提前 4 小时发现风险，而不是等到真的耗尽。</strong></p>
<p>这就是 <code>predict_linear()</code> 的威力：从"被动应对"变成"主动预防"。</p>
<hr/>
<h2 data-id="heading-12">4. 磁盘告警：当前值和未来趋势</h2>
<h3 data-id="heading-13">4.1 错误示例</h3>
<pre><code class="hljs language-promql" lang="promql"># 错误示例：磁盘使用率 &gt; 85% 就告警
(1 - node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 &gt; 85
</code></pre>
<p><strong>会发生什么？</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">场景 <span class="hljs-number">1</span>：磁盘使用率 <span class="hljs-number">86</span><span class="hljs-comment">%，但日志增长很快</span>
→ 触发告警
→ 运维去清理日志
→ 但 <span class="hljs-number">2</span> 小时后磁盘满了
→ 服务挂了

为什么？因为 <span class="hljs-number">85</span><span class="hljs-comment">% 的阈值太晚了！</span>
</code></pre>
<p><strong>问题：</strong></p>
<ul>
<li>不知道磁盘增长速度</li>
<li>等到 85% 再告警，可能来不及处理</li>
<li>没有考虑"未来会怎样"</li>
</ul>
<h3 data-id="heading-14">4.2 正确示例 1：预测式告警</h3>
<pre><code class="hljs language-promql" lang="promql"># 基于过去 6 小时数据，预测 24 小时后磁盘是否满
predict_linear(node_filesystem_avail_bytes[6h], 24*3600) &lt; 0
for: 1h
</code></pre>
<p><strong>价值：</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">场景 <span class="hljs-number">1</span>：磁盘使用率 <span class="hljs-number">82</span><span class="hljs-comment">%，但增长很快</span>
→ 规则 <span class="hljs-number">1</span> 告警：<span class="hljs-string">"预测 24h 后满"</span>
→ 运维：优先处理，明天就会满

场景 <span class="hljs-number">2</span>：磁盘使用率 <span class="hljs-number">82</span><span class="hljs-comment">%，但增长很慢</span>
→ 规则 <span class="hljs-number">1</span> 不告警：预测 <span class="hljs-number">7</span> 天后才满
→ 运维：不紧急，排期清理即可
</code></pre>
<p><strong>同样是 82%，但处理优先级完全不同。</strong></p>
<h3 data-id="heading-15">4.3 正确示例 2：容量和 IO 分开</h3>
<p>磁盘有两类问题：</p>
<ul>
<li><strong>容量问题</strong>：快满了</li>
<li><strong>性能问题</strong>：IO 慢了</li>
</ul>
<pre><code class="hljs language-promql" lang="promql"># 容量告警：使用率 &gt; 90%
# 注意：过滤掉临时目录和虚拟文件系统
(1 - node_filesystem_avail_bytes{
    fstype=~"ext4|xfs",
    mountpoint!~"/tmp|/var/lib/docker|/boot"
  } / node_filesystem_size_bytes) * 100 &gt; 90
for: 10m

# 性能告警：IO 使用率 &gt; 80%
rate(node_disk_io_time_seconds_total{device=~"sd.*|vd.*"}[5m]) &gt; 0.8
for: 10m

# 性能告警：IO 队列长度 &gt; 10
rate(node_disk_io_time_weighted_seconds_total{device=~"sd.*|vd.*"}[5m]) &gt; 10
for: 5m
</code></pre>
<p><strong>为什么要过滤路径？</strong></p>
<pre><code class="hljs language-diff" lang="diff">不需要告警的挂载点：
<span class="hljs-deletion">- /tmp：临时目录，满了也无所谓</span>
<span class="hljs-deletion">- /var/lib/docker：容器存储，由 Docker 管理</span>
<span class="hljs-deletion">- /boot：引导分区，通常很小且不会变化</span>

只关注业务数据盘：
<span class="hljs-deletion">- /：根分区</span>
<span class="hljs-deletion">- /data：数据分区</span>
<span class="hljs-deletion">- /home：用户目录</span>
</code></pre>
<p><strong>为什么要分开？</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">场景</span> <span class="hljs-number">1</span><span class="hljs-string">：磁盘使用率</span> <span class="hljs-number">50</span><span class="hljs-string">%，但</span> <span class="hljs-string">IO</span> <span class="hljs-string">队列很长</span>
<span class="hljs-string">→</span> <span class="hljs-string">容量充足，但性能差</span>
<span class="hljs-string">→</span> <span class="hljs-string">需要优化</span> <span class="hljs-string">IO（换</span> <span class="hljs-string">SSD、减少小文件操作）</span>

<span class="hljs-string">场景</span> <span class="hljs-number">2</span><span class="hljs-string">：磁盘使用率</span> <span class="hljs-number">95</span><span class="hljs-string">%，但</span> <span class="hljs-string">IO</span> <span class="hljs-string">正常</span>
<span class="hljs-string">→</span> <span class="hljs-string">容量不足，但性能正常</span>
<span class="hljs-string">→</span> <span class="hljs-string">需要清理磁盘或扩容</span>

<span class="hljs-string">两类问题，两种处理方式。</span>

<span class="hljs-string">**运维口诀**：容量看趋势，性能看队列。</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 5. 网络告警：流量和错误</span>

<span class="hljs-comment">### 5.1 错误示例</span>

<span class="hljs-string">```promql</span>
<span class="hljs-comment"># 错误示例：网络流量 &gt; 100MB/s 就告警</span>
<span class="hljs-string">rate(node_network_receive_bytes_total[5m])</span> <span class="hljs-string">/</span> <span class="hljs-number">1024</span> <span class="hljs-string">/</span> <span class="hljs-number">1024</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">100</span>
</code></pre>
<p><strong>问题：</strong></p>
<ul>
<li>100MB/s 对千兆网卡是正常的（125MB/s 满载）</li>
<li>没有区分"流量大"和"异常流量"</li>
<li>没有考虑错误率</li>
</ul>
<h3 data-id="heading-16">5.2 正确示例：流量 + 错误率</h3>
<pre><code class="hljs language-promql" lang="promql"># 网络流量超过带宽的 80%
# 注意：排除回环接口和虚拟接口
rate(node_network_receive_bytes_total{
    device!~"lo|docker.*|veth.*|br-.*"
  }[5m]) / (node_network_speed_bytes * 0.8) &gt; 1
for: 5m

# 网络错误率 &gt; 0.1%
rate(node_network_receive_errs_total{
    device!~"lo|docker.*|veth.*|br-.*"
  }[5m]) 
/ 
rate(node_network_receive_packets_total{
    device!~"lo|docker.*|veth.*|br-.*"
  }[5m]) &gt; 0.001
for: 5m
</code></pre>
<p><strong>为什么要过滤接口？</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">不需要监控的网络接口：
<span class="hljs-bullet">-</span> lo：回环接口，本地通信
<span class="hljs-bullet">-</span> docker0, br-<span class="hljs-emphasis">*：Docker 网桥
- veth*</span>：容器虚拟网卡

只监控物理网卡：
<span class="hljs-bullet">-</span> eth0, eth1：传统命名
<span class="hljs-bullet">-</span> ens<span class="hljs-emphasis">*, enp*</span>：systemd 命名
<span class="hljs-bullet">-</span> bond<span class="hljs-emphasis">*：网卡绑定
</span></code></pre>
<p><strong>改进点：</strong></p>
<ul>
<li>相对阈值（带宽的 80%）而不是绝对值</li>
<li>关注错误率，不只是流量</li>
<li>错误率 0.1% 很小，但可能是硬件问题的信号</li>
</ul>
<p><strong>场景：</strong></p>
<pre><code class="hljs">场景 1：流量高，错误率正常
→ 业务正常繁忙，无需告警

场景 2：流量正常，错误率高
→ 网卡/交换机有问题，需要排查硬件

场景 3：流量高，错误率也高
→ 可能是 DDoS 攻击或网络故障
</code></pre>
<hr/>
<h2 data-id="heading-17">6. 告警规则设计方法论</h2>
<p>基于上面的案例，可以总结出告警规则设计的三个维度：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A[告警规则设计] --&gt; B[时间维度]
    A --&gt; C[严重程度]
    A --&gt; D[业务上下文]
    
    B --&gt; E[评估窗口: 5m/15m&lt;br/&gt;平滑抖动]
    B --&gt; F[持续时长: for 10m&lt;br/&gt;过滤毛刺]
    
    C --&gt; G[P0: 服务不可用&lt;br/&gt;立即处理]
    C --&gt; H[P1: 性能下降&lt;br/&gt;1小时内]
    C --&gt; I[P2: 资源紧张&lt;br/&gt;当天处理]
    
    D --&gt; J[区分场景&lt;br/&gt;生产/测试]
    D --&gt; K[关联指标&lt;br/&gt;多维度判断]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffcccc
    style D fill:#ccffcc
</code></pre>
<h3 data-id="heading-18">6.1 时间维度</h3>
<p><strong>评估窗口 <code>[5m]</code>：</strong></p>
<ul>
<li>作用：平滑 15 秒抓取间隔的抖动</li>
<li>选择：CPU/内存用 5m，磁盘用 6h（变化慢）</li>
</ul>
<p><strong>持续时长 <code>for: 10m</code>：</strong></p>
<ul>
<li>作用：过滤短暂峰值</li>
<li>选择：CPU 用 10m，磁盘用 1h（不需要那么敏感）</li>
</ul>
<h3 data-id="heading-19">6.2 严重程度</h3>
<p><strong>三个级别：</strong></p>





























<table><thead><tr><th>级别</th><th>含义</th><th>响应时间</th><th>典型场景</th></tr></thead><tbody><tr><td>P0</td><td>服务不可用</td><td>立即</td><td>磁盘满、OOM</td></tr><tr><td>P1</td><td>性能下降</td><td>1 小时内</td><td>CPU 95%、内存 95%</td></tr><tr><td>P2</td><td>资源紧张</td><td>当天</td><td>CPU 85%、磁盘 80%</td></tr></tbody></table>
<p><strong>设计原则：</strong></p>
<ul>
<li>P0 的 <code>for</code> 更短（5m），不能等太久</li>
<li>P2 的 <code>for</code> 更长（30m），避免误报</li>
</ul>
<h3 data-id="heading-20">6.3 业务上下文</h3>
<p><strong>区分场景：</strong></p>
<pre><code class="hljs language-promql" lang="promql"># 生产环境 90% 告警
cpu_usage{env="prod"} &gt; 0.9

# 测试环境 95% 告警（更宽松）
cpu_usage{env="test"} &gt; 0.95
</code></pre>
<p><strong>关联指标：</strong></p>
<pre><code class="hljs language-promql" lang="promql"># CPU 高 + iowait 高 → 可能是磁盘慢
cpu_usage &gt; 0.9 and cpu_iowait &gt; 0.2

# CPU 高 + 网络流量高 → 可能是网络处理
cpu_usage &gt; 0.9 and network_traffic &gt; 100MB/s
</code></pre>
<p>这就是"因地制宜"的价值：不同场景用不同规则，不能一刀切。</p>
<hr/>
<h2 data-id="heading-21">7. 好的告警系统应该解决什么问题</h2>
<p>有了规则，还需要一个引擎来执行。好的告警系统应该解决这些问题：</p>
<h3 data-id="heading-22">7.1 Fingerprint：告警实例的唯一标识</h3>
<p>同一个规则可能命中多个实例：</p>
<pre><code class="hljs language-ini" lang="ini">规则: CPU 使用率 &gt; 90%

命中:
- {<span class="hljs-attr">instance</span>=<span class="hljs-string">"server-01"</span>, env=<span class="hljs-string">"prod"</span>} → Fingerprint = <span class="hljs-string">"abc123"</span>
- {<span class="hljs-attr">instance</span>=<span class="hljs-string">"server-02"</span>, env=<span class="hljs-string">"prod"</span>} → Fingerprint = <span class="hljs-string">"def456"</span>
</code></pre>
<p><strong>Fingerprint = hash(rule_id + labels)</strong></p>
<p>每个 Fingerprint 是一个独立的告警，需要单独追踪：</p>
<ul>
<li>什么时候开始的？</li>
<li>触发了几次？</li>
<li>现在状态如何？</li>
</ul>
<h3 data-id="heading-23">7.2 防抖动：避免告警风暴</h3>
<p><strong>两层防抖：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[首次命中] --&gt; B[pending&lt;br/&gt;观察期]
    B --&gt; C{持续 &gt;= for?}
    C --&gt;|是| D[firing&lt;br/&gt;确认告警]
    C --&gt;|否| A
    D --&gt; E{5分钟内重复?}
    E --&gt;|是| F[跳过处理]
    E --&gt;|否| G[写库/通知]
    
    style B fill:#fff4e1
    style D fill:#ffcccc
    style F fill:#cccccc
    style G fill:#ccffcc
</code></pre>
<p><strong>第一层：for_duration（规则层）</strong></p>
<ul>
<li>持续 10 分钟才从 pending 转为 firing</li>
<li>过滤短暂毛刺</li>
</ul>
<p><strong>第二层：时间窗口去重（消费层）</strong></p>
<ul>
<li>5 分钟内同一告警只处理一次</li>
<li>避免频繁写库和通知</li>
</ul>
<h3 data-id="heading-24">7.3 可扩展：插件化数据源</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[告警引擎] --&gt; B[Prometheus&lt;br/&gt;指标]
    A --&gt; C[日志扫描&lt;br/&gt;关键字]
    A --&gt; D[SQL 查询&lt;br/&gt;数据库]
    A --&gt; E[黑盒探测&lt;br/&gt;HTTP/TCP]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#ffcccc
    style E fill:#ccffcc
</code></pre>
<p>不只是 Prometheus 指标，还可以扩展：</p>
<ul>
<li>日志关键字（如"OutOfMemoryError"）</li>
<li>SQL 规则（如"超时订单 &gt; 100"）</li>
<li>黑盒探测（如"API 5xx 错误"）</li>
</ul>
<h3 data-id="heading-25">7.4 静默管理：计划性维护</h3>
<p><strong>场景：</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">晚上 <span class="hljs-number">22</span>:<span class="hljs-number">00</span>-<span class="hljs-number">23</span>:<span class="hljs-number">00</span> 发布新版本
→ 服务会重启
→ CPU 会短暂 <span class="hljs-number">100</span><span class="hljs-comment">%</span>
→ 不应该告警
</code></pre>
<p><strong>解决方案：时间窗口静默</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">静默规则:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"发布窗口"</span>
  <span class="hljs-attr">start:</span> <span class="hljs-string">"22:00"</span>
  <span class="hljs-attr">end:</span> <span class="hljs-string">"23:00"</span>
  <span class="hljs-attr">match:</span>
    <span class="hljs-attr">env:</span> <span class="hljs-string">"prod"</span>
    <span class="hljs-attr">service:</span> <span class="hljs-string">"api"</span>
</code></pre>
<p>在发布窗口内，匹配的告警自动静默，不发通知。</p>
<h3 data-id="heading-26">7.5 告警历史：可追溯和分析</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 历史告警表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> history_alerts (
  fingerprint <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>),
  rule_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>),
  start_at DATETIME,
  end_at DATETIME,
  duration <span class="hljs-type">INT</span>,
  trigger_count <span class="hljs-type">INT</span>
);
</code></pre>
<p><strong>价值：</strong></p>
<ul>
<li>查看某台服务器过去一周的告警次数</li>
<li>分析哪些规则误报率高</li>
<li>计算平均恢复时间（MTTR）</li>
</ul>
<p>告警历史不只是记录，更是持续改进的基础。没有数据就没有优化，好的系统要能自我进化。</p>
<hr/>
<h2 data-id="heading-27">8. 总结</h2>
<h3 data-id="heading-28">8.1 从指标到告警的核心思想</h3>
<p><strong>不是简单设阈值，而是：</strong></p>
<ol>
<li>
<p><strong>理解指标的本质</strong></p>
<ul>
<li>CPU 是累计时间，要用 rate() 转成使用率</li>
<li>内存要用 MemAvailable，不是 MemFree</li>
<li>磁盘要看趋势，不只看当前值</li>
</ul>
</li>
<li>
<p><strong>加上时间维度</strong></p>
<ul>
<li>评估窗口 <code>[5m]</code> 平滑抖动</li>
<li>持续时长 <code>for: 10m</code> 过滤毛刺</li>
</ul>
</li>
<li>
<p><strong>考虑业务上下文</strong></p>
<ul>
<li>区分生产和测试环境</li>
<li>关联多个指标（CPU + iowait）</li>
<li>预测未来（predict_linear）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-29">8.2 好的告警规则长什么样</h3>






























<table><thead><tr><th>维度</th><th>坏规则</th><th>好规则</th></tr></thead><tbody><tr><td><strong>阈值</strong></td><td>CPU &gt; 80%</td><td>CPU &gt; 90%，for: 10m</td></tr><tr><td><strong>指标</strong></td><td>只看一个指标</td><td>关联多个指标</td></tr><tr><td><strong>时间</strong></td><td>只看当前值</td><td>看趋势（predict_linear）</td></tr><tr><td><strong>上下文</strong></td><td>一刀切</td><td>区分场景（生产/测试）</td></tr></tbody></table>
<h3 data-id="heading-30">8.3 好的告警系统解决什么问题</h3>
<p><strong>五个核心能力：</strong></p>
<ol>
<li><strong>Fingerprint</strong> —— 每个告警实例有唯一标识</li>
<li><strong>防抖动</strong> —— 两层过滤（for + 时间窗口去重）</li>
<li><strong>可扩展</strong> —— 不只是 Prometheus，还能接其他数据源</li>
<li><strong>静默管理</strong> —— 计划性维护不告警</li>
<li><strong>历史追溯</strong> —— 可分析、可改进</li>
</ol>
<h3 data-id="heading-31">8.4 三个核心洞察</h3>
<p>看完这篇文章，记住这三点就够了：</p>
<p><strong>1. 好的告警要能定位问题</strong></p>
<p>不只说"CPU 高"，还要说"是 user 高还是 iowait 高"。不只告诉你有问题，还要告诉你什么问题。</p>
<p><strong>2. 好的告警要能预测未来</strong></p>
<p>用 <code>predict_linear()</code> 提前 4 小时、24 小时发现风险，而不是等到真的出问题才知道。从"被动应对"变成"主动预防"。</p>
<p><strong>3. 好的系统要能自我进化</strong></p>
<p>记录告警历史，分析误报率，持续优化规则。没有数据就没有改进，没有历史就没有进化。</p>
<hr/>
<h2 data-id="heading-32">附录：告警规则自查清单</h2>
<p>在上线告警规则前，用这个清单检查一遍：</p>
<h3 data-id="heading-33">CPU 告警</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否使用了 <code>rate()</code> 而不是直接用 Counter 值？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 阈值是否 &gt;= 90%（而不是 80%）？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否设置了 <code>for: 10m</code> 持续时长？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否区分了 user/system/iowait 模式？</li>
</ul>
<h3 data-id="heading-34">内存告警</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否使用了 <code>MemAvailable</code> 而不是 <code>MemFree</code>？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 版本是否 &gt;= node_exporter v0.16？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否使用了 <code>predict_linear()</code> 预测未来？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> P0 告警阈值是否 &gt;= 95%？</li>
</ul>
<h3 data-id="heading-35">磁盘告警</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 容量告警是否使用了 <code>predict_linear()</code>？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否过滤了 <code>/tmp</code>、<code>/boot</code> 等临时目录？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否只监控 <code>ext4</code> 和 <code>xfs</code> 文件系统？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否分别设置了容量告警和 IO 告警？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> IO 告警是否过滤了设备类型（如 <code>device=~"sd.*|vd.*"</code>）？</li>
</ul>
<h3 data-id="heading-36">网络告警</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否过滤了 <code>lo</code>、<code>docker0</code>、<code>veth*</code> 等虚拟接口？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 流量告警是否使用了相对阈值（带宽的 80%）？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否同时监控了流量和错误率？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 错误率阈值是否足够敏感（如 0.1%）？</li>
</ul>
<h3 data-id="heading-37">通用检查</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 所有规则是否都设置了 <code>for</code> 持续时长？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> P0/P1/P2 的严重级别是否合理？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否区分了生产和测试环境？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 规则名称是否清晰表达了告警内容？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 是否添加了 <code>annotations</code> 描述？</li>
</ul>
<hr/>
<h2 data-id="heading-38">快速参考：核心规则速查</h2>











































































<table><thead><tr><th>监控项</th><th>推荐规则</th><th>阈值</th><th>for</th><th>说明</th></tr></thead><tbody><tr><td><strong>CPU 整机</strong></td><td><code>(1 - avg(rate(node_cpu_seconds_total{mode="idle"}[5m]))) &gt; 0.9</code></td><td>90%</td><td>10m</td><td>基础告警</td></tr><tr><td><strong>CPU iowait</strong></td><td><code>avg(rate(node_cpu_seconds_total{mode="iowait"}[5m])) &gt; 0.2</code></td><td>20%</td><td>5m</td><td>磁盘瓶颈</td></tr><tr><td><strong>内存可用</strong></td><td><code>(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) &gt; 0.9</code></td><td>90%</td><td>5m</td><td>基础告警</td></tr><tr><td><strong>内存预测</strong></td><td><code>predict_linear(node_memory_MemAvailable_bytes[1h], 4*3600) &lt; 0</code></td><td>-</td><td>10m</td><td>提前预警</td></tr><tr><td><strong>磁盘容量</strong></td><td><code>(1 - node_filesystem_avail_bytes / node_filesystem_size_bytes) &gt; 0.9</code></td><td>90%</td><td>10m</td><td>基础告警</td></tr><tr><td><strong>磁盘预测</strong></td><td><code>predict_linear(node_filesystem_avail_bytes[6h], 24*3600) &lt; 0</code></td><td>-</td><td>1h</td><td>提前预警</td></tr><tr><td><strong>磁盘 IO</strong></td><td><code>rate(node_disk_io_time_seconds_total[5m]) &gt; 0.8</code></td><td>80%</td><td>10m</td><td>性能问题</td></tr><tr><td><strong>网络流量</strong></td><td><code>rate(node_network_receive_bytes_total[5m]) / node_network_speed_bytes &gt; 0.8</code></td><td>80%</td><td>5m</td><td>带宽瓶颈</td></tr><tr><td><strong>网络错误</strong></td><td><code>rate(node_network_receive_errs_total[5m]) / rate(node_network_receive_packets_total[5m]) &gt; 0.001</code></td><td>0.1%</td><td>5m</td><td>硬件问题</td></tr></tbody></table>
<hr/>
<p><strong>从 node_exporter 的指标，到生产级的告警规则，核心是一套设计思想：</strong></p>
<ul>
<li>理解本质（指标的含义）</li>
<li>加上时间（评估窗口 + 持续时长）</li>
<li>结合上下文（业务场景 + 关联指标）</li>
<li>持续迭代（追踪历史 + 质量改进）</li>
</ul>
<p>这不是一篇操作手册，而是一套方法论。掌握了这套思想，你就能设计出适合自己业务的告警规则。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot LiquibasePlus 数据库版本管理工具加强使用指南]]></title>    <link>https://juejin.cn/post/7590403249561583631</link>    <guid>https://juejin.cn/post/7590403249561583631</guid>    <pubDate>2026-01-04T01:59:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7590403249561583631" data-draft-id="7540566577622614079" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot LiquibasePlus 数据库版本管理工具加强使用指南"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2026-01-04T01:59:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="昵称为空C"/> <meta itemprop="url" content="https://juejin.cn/user/1267096172897005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot LiquibasePlus 数据库版本管理工具加强使用指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1267096172897005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    昵称为空C
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T01:59:52.000Z" title="Sun Jan 04 2026 01:59:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：本文主要介绍了基于<code>springboot</code>+<code>liquibase</code>的数据库版本管理工具的使用说明；案例封装了<code>liquibase</code>的功能进行了业务增强，让实际生成环境使用更省心。</p>
<h2 data-id="heading-0">直接使用会遇到的问题</h2>
<ul>
<li>异常退出导致<code>databasechangeloglock</code>锁表，需要手动清理数据。</li>
<li>无法满足多租户使用。</li>
<li>无法满足多数据库适配。</li>
</ul>
<h2 data-id="heading-1"><code>LiquibasePlus</code>封装案例</h2>
<blockquote>
<p>只是在<code>Liquibase</code>上做了功能增强。</p>
</blockquote>
<h3 data-id="heading-2"><code>pom.xml</code></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.liquibase<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>liquibase-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3"><code>LiquibaseApplication</code></h3>
<blockquote>
<p>启动类</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LiquibaseApplication</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">LiquibaseApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<h3 data-id="heading-4"><code>application.yml</code></h3>
<blockquote>
<p>配置文件</p>
</blockquote>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">super_admin</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">super_admin</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.8.134:30635/test_1?useSSL=false&amp;serverTimezone=UTC</span>
  <span class="hljs-attr">liquibase:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">liquibase-plus:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">super_admin</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">super_admin</span>
    <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://192.168.8.134:30635/test_1?useSSL=false&amp;serverTimezone=UTC</span>
    <span class="hljs-attr">change-log:</span> <span class="hljs-string">classpath*:sql/mysql/changelog.xml</span>
</code></pre>
<h3 data-id="heading-5"><code>SpringLiquibasePlusProperties</code></h3>
<blockquote>
<p>属性配置类</p>
</blockquote>
<pre><code class="hljs language-arduino" lang="arduino">@Data
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringLiquibasePlusProperties</span> {

    <span class="hljs-comment">/** 是否开启 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> enabled;
    <span class="hljs-comment">/** 驱动名称 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> driverClassName;
    <span class="hljs-comment">/** 链接地址 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> jdbcUrl;
    <span class="hljs-comment">/** 用户名 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> username;
    <span class="hljs-comment">/** 密码 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> password;
    <span class="hljs-comment">/** 数据库schema */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> schema;
    <span class="hljs-comment">/** 变更日志 */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> changeLog;

}
</code></pre>
<h3 data-id="heading-6"><code>SpringLiquibasePlusExecutor</code></h3>
<blockquote>
<p><code>liquibase</code>执行器</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Slf</span>4j
public class SpringLiquibasePlusExecutor {

    private final ResourceLoader resourceLoader;

    public <span class="hljs-built_in">SpringLiquibasePlusExecutor</span>(ResourceLoader resourceLoader) {
        this<span class="hljs-selector-class">.resourceLoader</span> = resourceLoader;
    }

    <span class="hljs-comment">/**
     * 初始化数据库
     * @param properties
     */</span>
    public void <span class="hljs-built_in">execute</span>(SpringLiquibasePlusProperties properties) throws Exception{
        <span class="hljs-built_in">try</span>(HikariDataSource hikariDataSource = this.buildDataSource(properties)) {
            SpringLiquibase liquibase = new <span class="hljs-built_in">SpringLiquibase</span>();
            liquibase<span class="hljs-selector-class">.setDataSource</span>(hikariDataSource);
            liquibase<span class="hljs-selector-class">.setResourceLoader</span>(resourceLoader);
            liquibase<span class="hljs-selector-class">.setDatabaseChangeLogTable</span>("databasechangelog");
            liquibase<span class="hljs-selector-class">.setDatabaseChangeLogLockTable</span>("databasechangeloglock");
            <span class="hljs-comment">//指定changelog的位置，这里使用的一个master文件引用其他文件的方式</span>
            liquibase<span class="hljs-selector-class">.setChangeLog</span>(properties.getChangeLog());
            liquibase<span class="hljs-selector-class">.setShouldRun</span>(true);
            <span class="hljs-comment">// 检查锁表的情况</span>
            <span class="hljs-built_in">removeTimeoutLock</span>(hikariDataSource, liquibase.getDatabaseChangeLogLockTable());
            liquibase<span class="hljs-selector-class">.afterPropertiesSet</span>();
        }
    }

    <span class="hljs-comment">/**
     * 构建数据源
     * @param properties
     * @return
     */</span>
    private HikariDataSource <span class="hljs-built_in">buildDataSource</span>(SpringLiquibasePlusProperties properties){
        HikariDataSource hikariDataSource = new <span class="hljs-built_in">HikariDataSource</span>();
        hikariDataSource<span class="hljs-selector-class">.setDriverClassName</span>(properties.getDriverClassName());
        hikariDataSource<span class="hljs-selector-class">.setJdbcUrl</span>(properties.getJdbcUrl());
        hikariDataSource<span class="hljs-selector-class">.setUsername</span>(properties.getUsername());
        hikariDataSource<span class="hljs-selector-class">.setPassword</span>(properties.getPassword());
        hikariDataSource<span class="hljs-selector-class">.setSchema</span>(properties.getSchema());
        hikariDataSource<span class="hljs-selector-class">.setMinimumIdle</span>(<span class="hljs-number">1</span>);
        hikariDataSource<span class="hljs-selector-class">.setMaximumPoolSize</span>(<span class="hljs-number">1</span>);
        return hikariDataSource;
    }

    <span class="hljs-comment">/**
     * 移除超时的锁
     * 如果要写得更好，先判断表存在没有，存在了再执行SQL语句，我这里捕获异常处理的
     * @param dataSource
     * @param tableName
     */</span>
    public void <span class="hljs-built_in">removeTimeoutLock</span>(DataSource dataSource, String tableName){
        <span class="hljs-comment">// 超时5分钟就认为超时，这里可以自己自定义</span>
        Timestamp lastDBLockTime = new <span class="hljs-built_in">Timestamp</span>(new java.util.Date()<span class="hljs-selector-class">.getTime</span>() - (<span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>));
        <span class="hljs-comment">// 这里的SQL语句需要按照自己的数据库方式来，现阶段我就遇到`oracle`写法不一样</span>
        String sql = String<span class="hljs-selector-class">.format</span>("UPDATE %s SET LOCKED = <span class="hljs-number">0</span>, LOCKGRANTED = NULL, LOCKEDBY = NULL WHERE LOCKED = <span class="hljs-number">1</span> AND LOCKGRANTED &lt; '%s'", tableName, lastDBLockTime);

        try (Connection connection = dataSource.getConnection(); Statement stmt = connection<span class="hljs-selector-class">.createStatement</span>()) {
            int updateCount = stmt<span class="hljs-selector-class">.executeUpdate</span>(sql);
            <span class="hljs-built_in">if</span>(updateCount &gt; <span class="hljs-number">0</span>){
                log<span class="hljs-selector-class">.info</span>("liquibase异常锁解除成功");
            }else {
                log<span class="hljs-selector-class">.info</span>("liquibase无异常锁");
            }
        } catch (Exception ex) {
            <span class="hljs-built_in">if</span>(!(ex instanceof SQLException)){
                <span class="hljs-comment">// 直接跳过不用处理异常了</span>
                log<span class="hljs-selector-class">.error</span>("liquibase解锁异常", ex);
            }else {
                log<span class="hljs-selector-class">.warn</span>("liquibase初次加载");
            }
        }
    }

}
</code></pre>
<h3 data-id="heading-7"><code>SpringLiquibasePlusConfig</code>启动配置</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Slf4j</span>
<span class="hljs-variable">@Configuration</span>
<span class="hljs-variable">@ConditionalOnProperty</span>(
        prefix = <span class="hljs-string">"spring.liquibase-plus"</span>,
        name = {<span class="hljs-string">"enabled"</span>}
)
public class SpringLiquibasePlusConfig {

    <span class="hljs-variable">@Autowired</span>
    private ResourceLoader resourceLoader;
    <span class="hljs-variable">@Autowired</span>
    private List&lt;CustomTaskChange&gt; customTaskChanges;

    <span class="hljs-variable">@Bean</span>
    <span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.liquibase-plus"</span>,ignoreUnknownFields = false)
    public SpringLiquibasePlusProperties <span class="hljs-built_in">springLiquibasePlusProperties</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SpringLiquibasePlusProperties</span>();
    }

    @<span class="hljs-selector-tag">Bean</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">SpringLiquibasePlusExecutor</span> <span class="hljs-selector-tag">springLiquibasePlusExecuter</span>(SpringLiquibasePlusProperties springLiquibasePlusProperties) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Exception</span> {
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"Liquibase CustomTaskChange size: {}, names: {}"</span>, customTaskChanges.<span class="hljs-built_in">size</span>(), customTaskChanges.<span class="hljs-built_in">stream</span>().<span class="hljs-built_in">map</span>(<span class="hljs-attribute">CustomTaskChange</span>::getClass).<span class="hljs-built_in">collect</span>(Collectors.<span class="hljs-built_in">toSet</span>()));
        <span class="hljs-selector-tag">customTaskChanges</span><span class="hljs-selector-class">.forEach</span>(<span class="hljs-attribute">CustomChange</span>::getConfirmationMessage);
        <span class="hljs-selector-tag">SpringLiquibasePlusExecutor</span> <span class="hljs-selector-tag">springLiquibasePlusExecutor</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SpringLiquibasePlusExecutor</span>(resourceLoader);
        <span class="hljs-selector-tag">springLiquibasePlusExecutor</span><span class="hljs-selector-class">.execute</span>(springLiquibasePlusProperties);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">springLiquibasePlusExecutor</span>;
    }

}
</code></pre>
<h3 data-id="heading-8"><code>V1_00_00_ClearCustomTaskChange</code></h3>
<blockquote>
<p><code>sql</code>中解决不了的，需要用<code>java</code>代码来进行版本管理的业务。</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">V1_00_00_ClearCustomTaskChange</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CustomTaskChange</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">JdbcTemplate</span> jdbcTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setJdbcTemplate</span>(<span class="hljs-params">JdbcTemplate jdbcTemplate</span>) {
        V1_00_00_ClearCustomTaskChange.<span class="hljs-property">jdbcTemplate</span> = jdbcTemplate;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-title class_">Database</span> database) throws <span class="hljs-title class_">CustomChangeException</span> {
        <span class="hljs-comment">// 这里写liquibase简单的sql语句做不了的复杂写法，我这里只做简单演示，这里强烈建议用jdbcTemplate查询其他的表，并且只查询自己需要的字段</span>
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; mapList = jdbcTemplate.<span class="hljs-title function_">queryForList</span>(<span class="hljs-string">"select * from school_01 where name = 'A'"</span>);
        <span class="hljs-keyword">if</span>(<span class="hljs-title class_">CollectionUtils</span>.<span class="hljs-title function_">isEmpty</span>(mapList)) {
            <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                jdbcTemplate.<span class="hljs-title function_">update</span>(<span class="hljs-string">"insert into school_01(id, name) values (?, ?)"</span>, i, <span class="hljs-string">"A"</span> + i);
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getConfirmationMessage</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"SUCCESS"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUp</span>() throws <span class="hljs-title class_">SetupException</span> {

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setFileOpener</span>(<span class="hljs-params">ResourceAccessor resourceAccessor</span>) {

    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ValidationErrors</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">Database database</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-9"><code>changelog.xml</code></h3>
<blockquote>
<p>主要的数据库版本管理文件</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">databaseChangeLog</span>
        <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"</span>&gt;</span>

    <span class="hljs-comment">&lt;!--  初始化表结构  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/sql/mysql/V1.00.00.sql"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">changeSet</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"V1.00.00-003-1"</span> <span class="hljs-attr">author</span>=<span class="hljs-string">"huzhihui"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">customChange</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.github.sp3.liquibase.config.custom.V1_00_00_ClearCustomTaskChange"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">changeSet</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/sql/mysql/V1.00.01.sql"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">databaseChangeLog</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10"><code>V1.00.00.sql</code></h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--liquibase formatted sql</span>

<span class="hljs-comment">--changeset huzhihui:V1.00.00-001-1</span>
<span class="hljs-comment">--preconditions onFail:MARK_RAN onError:MARK_RAN</span>
<span class="hljs-comment">--precondition-sql-check expectedResult:0 select count(1) from information_schema.tables where table_schema = (select database()) and table_name = 'school_01';</span>
<span class="hljs-comment">--comment 测试表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `school_01` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `time_zone` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `time_no_zone` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB;

<span class="hljs-comment">--changeset huzhihui:V1.00.00-002-1</span>
<span class="hljs-comment">--preconditions onFail:MARK_RAN onError:MARK_RAN</span>
<span class="hljs-comment">--precondition-sql-check expectedResult:0 select count(1) from information_schema.tables where table_schema = (select database()) and table_name = 'school_02';</span>
<span class="hljs-comment">--comment 测试表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `school_02` (
 `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
 `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
 `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
 `time_zone` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
 `time_no_zone` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
 <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<h3 data-id="heading-11"><code>V1.00.01.sql</code></h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--liquibase formatted sql</span>

<span class="hljs-comment">--changeset huzhihui:V1.00.01-001-1</span>
<span class="hljs-comment">--preconditions onFail:MARK_RAN onError:MARK_RAN</span>
<span class="hljs-comment">--precondition-sql-check expectedResult:0 select count(1) from information_schema.tables where table_schema = (select database()) and table_name = 'school_03';</span>
<span class="hljs-comment">--comment 测试表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `school_03` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `time_zone` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `time_no_zone` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<h2 data-id="heading-12">最终执行结果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71a3c708cc564645a333c548df64f9c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pi156ew5Li656m6Qw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768096792&amp;x-signature=%2FpDEi12m%2FVVZqTA0Y2RruqahNkQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3990f674ad474230ae6f8dc51bf5e86d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pi156ew5Li656m6Qw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768096792&amp;x-signature=60J%2FmmJaMwC%2FWXwv%2BsoX2zrDP6w%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed1cb86741334a758c66d34fde76e30f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pi156ew5Li656m6Qw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768096792&amp;x-signature=vEsepQ2L%2FEe7G0lkUZSCBE1W%2Bns%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5dff566ad5a4cfebd8e63bb9c540d84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pi156ew5Li656m6Qw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768096792&amp;x-signature=Os8ZEHQ4dF7QUm7Q5IR%2Fq5yam4w%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[复刻网页彩虹🌈镭射效果]]></title>    <link>https://juejin.cn/post/7591497387245436964</link>    <guid>https://juejin.cn/post/7591497387245436964</guid>    <pubDate>2026-01-05T08:54:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591497387245436964" data-draft-id="7591680281905365019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="复刻网页彩虹🌈镭射效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T08:54:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="龙在天"/> <meta itemprop="url" content="https://juejin.cn/user/3760787883819464"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            复刻网页彩虹🌈镭射效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3760787883819464/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    龙在天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:54:18.000Z" title="Mon Jan 05 2026 08:54:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">效果展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9771f1228eb94fae82ef24cceb403a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768208057&amp;x-signature=8Q88gjQ1Zmm9xhhzDbWTu6Euvi0%3D" alt="1.gif" loading="lazy"/></p>
<h2 data-id="heading-1">拆解代码</h2>
<h3 data-id="heading-2">容器布局</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"outer-glow"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"center"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- SVG箭头图标 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">search-bar</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">search-bar</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">中心svg元素</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M10 90 L50 10 L90 90 M50 75 A5 5 0 1 1 50 85 A5 5 0 1 1 50 75"</span> 
      <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#4CAF50"</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span> /&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b0c31131eb940b3a462e6eac3ae640e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768208057&amp;x-signature=htGue0xdsiEqmoPltCL%2BZYsHY%2Bk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">功能开关</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 检查URL参数</span>
<span class="hljs-keyword">const</span> beta = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"beta"</span>);
<span class="hljs-keyword">if</span> (beta) <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">"beta"</span>, beta);

<span class="hljs-comment">// 判断是否为beta版本</span>
<span class="hljs-keyword">const</span> isBeta = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">"beta"</span>);

<span class="hljs-comment">// 根据版本状态替换搜索栏</span>
<span class="hljs-keyword">if</span> (!isBeta) {
    <span class="hljs-keyword">const</span> comingSoon = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>);
    comingSoon.<span class="hljs-property">id</span> = <span class="hljs-string">'coming'</span>;
    comingSoon.<span class="hljs-property">innerText</span> = <span class="hljs-string">"Coming Soon..."</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>).<span class="hljs-title function_">replaceWith</span>(comingSoon);
}
</code></pre>
<h2 data-id="heading-5">数据配置</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> logos = [
    { 
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-google'</span>, 
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#4285F4'</span>, 
        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Search for images using a SERP provider'</span> 
    },
    { 
        <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/vercel.svg'</span>, 
        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Add a domain to a project on Vercel'</span> 
    },
    <span class="hljs-comment">// ... 更多工具配置</span>
];
</code></pre>
<h2 data-id="heading-6">动态图标</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createLogo</span>(<span class="hljs-params">logo, x, y</span>) {
    <span class="hljs-keyword">const</span> logoElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(logo.<span class="hljs-property">icon</span> ? <span class="hljs-string">'i'</span> : <span class="hljs-string">'img'</span>);
    logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${x}</span>px`</span>;
    logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${y}</span>px`</span>;
    
    <span class="hljs-comment">// 移动端适配</span>
    <span class="hljs-keyword">if</span> (isMobile) {
        logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-string">'16px'</span>;
        logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'16px'</span>;
        logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'16px'</span>;
    }
    
    <span class="hljs-comment">// 添加交互事件</span>
    logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>);
        searchInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'value'</span>, logo.<span class="hljs-property">placeholder</span>);
    });
}
</code></pre>
<h2 data-id="heading-7">曲线创建</h2>
<p>生成200条从中心向外辐射的贝塞尔曲线：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCurves</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> curves = [];
    <span class="hljs-keyword">const</span> numCurves = <span class="hljs-number">200</span>;
    <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numCurves; i++) {
        <span class="hljs-keyword">const</span> angle = (i / numCurves) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>;
        <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.4</span>;
        <span class="hljs-keyword">const</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * radius;
        <span class="hljs-keyword">const</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * radius;
        
        <span class="hljs-keyword">const</span> path = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElementNS</span>(<span class="hljs-string">'http://www.w3.org/2000/svg'</span>, <span class="hljs-string">'path'</span>);
        <span class="hljs-keyword">const</span> d = <span class="hljs-string">`M <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> Q <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> <span class="hljs-subst">${x}</span> <span class="hljs-subst">${y}</span>`</span>;
        path.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'d'</span>, d);
        path.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'stroke'</span>, <span class="hljs-string">`hsl(<span class="hljs-subst">${(i / numCurves) * <span class="hljs-number">360</span>}</span>, 70%, 50%)`</span>);
        svg.<span class="hljs-title function_">appendChild</span>(path);
        curves.<span class="hljs-title function_">push</span>({ path, <span class="hljs-attr">endX</span>: x, <span class="hljs-attr">endY</span>: y });
    }
    <span class="hljs-keyword">return</span> curves;
}
</code></pre>
<h3 data-id="heading-8">鼠标改曲线</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateCurves</span>(<span class="hljs-params">curves, mouseX, mouseY</span>) {
    <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
    
    curves.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">curve, index</span>) =&gt;</span> {
        <span class="hljs-comment">// 计算中点偏移</span>
        <span class="hljs-keyword">const</span> dx = curve.<span class="hljs-property">endX</span> - centerX;
        <span class="hljs-keyword">const</span> dy = curve.<span class="hljs-property">endY</span> - centerY;
        <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(dx * dx + dy * dy);
        
        <span class="hljs-keyword">const</span> midX = centerX + dx * <span class="hljs-number">0.5</span> + (mouseX - centerX) * <span class="hljs-number">0.1</span> * (distance / <span class="hljs-number">100</span>);
        <span class="hljs-keyword">const</span> midY = centerY + dy * <span class="hljs-number">0.5</span> + (mouseY - centerY) * <span class="hljs-number">0.1</span> * (distance / <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// 更新贝塞尔曲线路径</span>
        <span class="hljs-keyword">const</span> d = <span class="hljs-string">`M <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> Q <span class="hljs-subst">${midX}</span> <span class="hljs-subst">${midY}</span> <span class="hljs-subst">${curve.endX}</span> <span class="hljs-subst">${curve.endY}</span>`</span>;
        curve.<span class="hljs-property">path</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'d'</span>, d);
        
        <span class="hljs-comment">// 动态颜色变化</span>
        <span class="hljs-keyword">const</span> hue = (index / curves.<span class="hljs-property">length</span> * <span class="hljs-number">360</span> + (mouseX + mouseY) / <span class="hljs-number">5</span>) % <span class="hljs-number">360</span>;
        curve.<span class="hljs-property">path</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'stroke'</span>, <span class="hljs-string">`hsl(<span class="hljs-subst">${hue}</span>, 70%, 50%)`</span>);
    });
}
</code></pre>
<h3 data-id="heading-9">鼠标区域检测</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isPointInsideCircle</span>(<span class="hljs-params">x, y, centerX, centerY, radius</span>) {
    <span class="hljs-keyword">const</span> dx = x - centerX;
    <span class="hljs-keyword">const</span> dy = y - centerY;
    <span class="hljs-keyword">return</span> dx * dx + dy * dy &lt;= radius * radius;
}
</code></pre>
<h3 data-id="heading-10">自动动画</h3>
<p>鼠标离开交互区域，启动自动旋转动画：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">autoAnimate</span>(<span class="hljs-params">curves</span>) {
    <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.2</span>;
    
    autoAnimationAngle += <span class="hljs-number">0.02</span>;
    <span class="hljs-keyword">const</span> mouseX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(autoAnimationAngle) * radius;
    <span class="hljs-keyword">const</span> mouseY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(autoAnimationAngle) * radius;
    
    <span class="hljs-title function_">updateCurves</span>(curves, mouseX, mouseY);
    animationFrame = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">autoAnimate</span>(curves));
}
</code></pre>
<h3 data-id="heading-11">初始化与响应式处理</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 创建曲线和图标</span>
    <span class="hljs-keyword">const</span> curves = <span class="hljs-title function_">createCurves</span>();
    <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> circleRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.38</span>;
    
    <span class="hljs-comment">// 创建工具图标</span>
    logos.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">logo, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> angle = (index / logos.<span class="hljs-property">length</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>;
        <span class="hljs-keyword">const</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * circleRadius - <span class="hljs-number">16</span>;
        <span class="hljs-keyword">const</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * circleRadius - <span class="hljs-number">16</span>;
        <span class="hljs-title function_">createLogo</span>(logo, x, y);
    });
    
    <span class="hljs-comment">// 添加鼠标事件监听</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-comment">// 鼠标交互逻辑</span>
    });
}

<span class="hljs-comment">// 窗口大小变化时重新初始化</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
    svg.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
    container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.logo'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">logo</span> =&gt;</span> logo.<span class="hljs-title function_">remove</span>());
    <span class="hljs-title function_">cancelAnimationFrame</span>(animationFrame);
    <span class="hljs-title function_">init</span>();
});
</code></pre>
<h2 data-id="heading-12">完整代码</h2>
<h3 data-id="heading-13">html 部分</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"outer-glow"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-16 w-16"</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 100 100"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M10 90 L50 10 L90 90 M50 75 A5 5 0 1 1 50 85 A5 5 0 1 1 50 75"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#4CAF50"</span>
                    <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">search-bar</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">search-bar</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> beta = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"beta"</span>)
        <span class="hljs-keyword">if</span> (beta) {
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">"beta"</span>, beta)
        }

        <span class="hljs-keyword">const</span> isBeta = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">"beta"</span>)

        <span class="hljs-keyword">if</span> (!isBeta) {
            <span class="hljs-keyword">const</span> beta = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>)
            beta.<span class="hljs-property">id</span> = <span class="hljs-string">'coming'</span>
            beta.<span class="hljs-property">innerText</span> = <span class="hljs-string">"Coming Soon..."</span>;
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>).<span class="hljs-title function_">replaceWith</span>(beta);
        }

        <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>);
        <span class="hljs-keyword">const</span> svg = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'svg'</span>);
        <span class="hljs-keyword">const</span> center = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'center'</span>);

        <span class="hljs-keyword">const</span> isMobile = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt; <span class="hljs-number">1024</span>;

        <span class="hljs-keyword">const</span> logos = [
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-google'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#4285F4'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Search for images using a SERP provider'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-slack'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#4A154B'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Create a new channel in slack'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-npm'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#CB3837'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Search for a package on npm'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-youtube'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#FF0000'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'YouTube get videos of a channel'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-twitter'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#1DA1F2'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Get all my tweets'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-stripe-s'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#008CDD'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Create payment link on stripe'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-github'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#181717'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Create a new repository'</span> },
            { <span class="hljs-attr">icon</span>: <span class="hljs-string">'fa-cloudflare'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#F38020'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Configure DNS settings'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/vercel.svg'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Add a domain to a project on Vercel'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/anthropic.png'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Send a message to claude of Anthropic'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/groq.jpeg'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Create a groq chat completion for LLama 3.1'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/notion.png'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Create a new Notion Database'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/openai.svg'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Run text to speech on OpenAI'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/replicate.webp'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'List all my models on Replicate'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/supabase.png'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Show my supabase projects'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/google-analytics.svg'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Find my realtime statistics'</span> },
            { <span class="hljs-attr">src</span>: <span class="hljs-string">'logos/gmail.png'</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'List Gmail messages from a sender'</span> },

            <span class="hljs-comment">// not good enough yet!</span>

            <span class="hljs-comment">// { icon: 'fa-apple', color: '#A2AAAD', placeholder: 'Check iPhone battery health' },</span>
            <span class="hljs-comment">// { icon: 'fa-microsoft', color: '#00A4EF', placeholder: 'Schedule a Teams meeting' },</span>
            <span class="hljs-comment">// { icon: 'fa-amazon', color: '#FF9900', placeholder: 'Track my package' },</span>
            <span class="hljs-comment">// { icon: 'fa-jira', color: '#0052CC', placeholder: 'Create a new sprint' },</span>
            <span class="hljs-comment">// { icon: 'fa-trello', color: '#0052CC', placeholder: 'Add a new card to board' },</span>
            <span class="hljs-comment">// { icon: 'fa-linkedin', color: '#0A66C2', placeholder: 'Update my work experience' },</span>
            <span class="hljs-comment">// { icon: 'fa-whatsapp', color: '#25D366', placeholder: 'Start a group video call' },</span>
            <span class="hljs-comment">// { icon: 'fa-spotify', color: '#1ED760', placeholder: 'Create a workout playlist' },</span>
            <span class="hljs-comment">// { icon: 'fa-aws', color: '#232F3E', placeholder: 'Add a new object in simple storage service (s3)' },</span>

        ];

        <span class="hljs-keyword">let</span> animationFrame;
        <span class="hljs-keyword">let</span> isMouseInside = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">let</span> autoAnimationAngle = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">createLogo</span>(<span class="hljs-params">logo, x, y</span>) {
            <span class="hljs-keyword">const</span> logoElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(logo.<span class="hljs-property">icon</span> ? <span class="hljs-string">'i'</span> : <span class="hljs-string">'img'</span>);
            logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${x}</span>px`</span>;
            logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${y}</span>px`</span>;
            <span class="hljs-keyword">if</span> (isMobile) {
                logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-string">'16px'</span>
                logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'16px'</span>
                logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'16px'</span>
            }

            <span class="hljs-keyword">if</span> (logo.<span class="hljs-property">icon</span>) {

                logoElement.<span class="hljs-property">className</span> = <span class="hljs-string">`fab <span class="hljs-subst">${logo.icon}</span> logo`</span>;
                logoElement.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = logo.<span class="hljs-property">color</span>;
            } <span class="hljs-keyword">else</span> {
                logoElement.<span class="hljs-property">src</span> = logo.<span class="hljs-property">src</span>;
                logoElement.<span class="hljs-property">className</span> = <span class="hljs-string">`logo-image`</span>;
            }

            logoElement.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-placeholder'</span>, logo.<span class="hljs-property">placeholder</span>);

            container.<span class="hljs-title function_">appendChild</span>(logoElement);

            logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>);
                searchInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'value'</span>, logo.<span class="hljs-property">placeholder</span>);
            })

            <span class="hljs-keyword">if</span> (isBeta) {


                logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function">() =&gt;</span> {


                    <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>);
                    searchInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'placeholder'</span>, logo.<span class="hljs-property">placeholder</span>);
                });

                logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'search-bar'</span>);
                    searchInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'placeholder'</span>, <span class="hljs-string">'Search 5829+ Tools'</span>);
                });
            } <span class="hljs-keyword">else</span> {

                logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'coming'</span>).<span class="hljs-property">innerText</span> = logo.<span class="hljs-property">placeholder</span>;
                });

                logoElement.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'coming'</span>).<span class="hljs-property">innerText</span> = <span class="hljs-string">'Coming soon...'</span>;
                });

            }

        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCurves</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> curves = [];
            <span class="hljs-keyword">const</span> numCurves = <span class="hljs-number">200</span>;
            <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numCurves; i++) {
                <span class="hljs-keyword">const</span> angle = (i / numCurves) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.4</span>;
                <span class="hljs-keyword">const</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * radius;
                <span class="hljs-keyword">const</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * radius;

                <span class="hljs-keyword">const</span> path = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElementNS</span>(<span class="hljs-string">'http://www.w3.org/2000/svg'</span>, <span class="hljs-string">'path'</span>);
                <span class="hljs-keyword">const</span> d = <span class="hljs-string">`M <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> Q <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> <span class="hljs-subst">${x}</span> <span class="hljs-subst">${y}</span>`</span>;
                path.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'d'</span>, d);
                path.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'stroke'</span>, <span class="hljs-string">`hsl(<span class="hljs-subst">${(i / numCurves) * <span class="hljs-number">360</span>}</span>, 70%, 50%)`</span>);
                svg.<span class="hljs-title function_">appendChild</span>(path);
                curves.<span class="hljs-title function_">push</span>({ path, <span class="hljs-attr">endX</span>: x, <span class="hljs-attr">endY</span>: y });
            }

            <span class="hljs-keyword">return</span> curves;
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateCurves</span>(<span class="hljs-params">curves, mouseX, mouseY</span>) {
            <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;

            curves.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">curve, index</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> dx = curve.<span class="hljs-property">endX</span> - centerX;
                <span class="hljs-keyword">const</span> dy = curve.<span class="hljs-property">endY</span> - centerY;
                <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(dx * dx + dy * dy);

                <span class="hljs-keyword">const</span> midX = centerX + dx * <span class="hljs-number">0.5</span> + (mouseX - centerX) * <span class="hljs-number">0.1</span> * (distance / <span class="hljs-number">100</span>);
                <span class="hljs-keyword">const</span> midY = centerY + dy * <span class="hljs-number">0.5</span> + (mouseY - centerY) * <span class="hljs-number">0.1</span> * (distance / <span class="hljs-number">100</span>);

                <span class="hljs-keyword">const</span> d = <span class="hljs-string">`M <span class="hljs-subst">${centerX}</span> <span class="hljs-subst">${centerY}</span> Q <span class="hljs-subst">${midX}</span> <span class="hljs-subst">${midY}</span> <span class="hljs-subst">${curve.endX}</span> <span class="hljs-subst">${curve.endY}</span>`</span>;
                curve.<span class="hljs-property">path</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'d'</span>, d);

                <span class="hljs-keyword">const</span> hue = (index / curves.<span class="hljs-property">length</span> * <span class="hljs-number">360</span> + (mouseX + mouseY) / <span class="hljs-number">5</span>) % <span class="hljs-number">360</span>;
                curve.<span class="hljs-property">path</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'stroke'</span>, <span class="hljs-string">`hsl(<span class="hljs-subst">${hue}</span>, 70%, 50%)`</span>);
            });
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">isPointInsideCircle</span>(<span class="hljs-params">x, y, centerX, centerY, radius</span>) {
            <span class="hljs-keyword">const</span> dx = x - centerX;
            <span class="hljs-keyword">const</span> dy = y - centerY;
            <span class="hljs-keyword">return</span> dx * dx + dy * dy &lt;= radius * radius;
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">autoAnimate</span>(<span class="hljs-params">curves</span>) {
            <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.2</span>;

            autoAnimationAngle += <span class="hljs-number">0.02</span>;
            <span class="hljs-keyword">const</span> mouseX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(autoAnimationAngle) * radius;
            <span class="hljs-keyword">const</span> mouseY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(autoAnimationAngle) * radius;

            <span class="hljs-title function_">updateCurves</span>(curves, mouseX, mouseY);
            animationFrame = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">autoAnimate</span>(curves));
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> curves = <span class="hljs-title function_">createCurves</span>();
            <span class="hljs-keyword">const</span> centerX = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> centerY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">const</span> circleRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">0.38</span>;

            logos.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">logo, index</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> angle = (index / logos.<span class="hljs-property">length</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>;
                <span class="hljs-keyword">const</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * circleRadius - <span class="hljs-number">16</span>;
                <span class="hljs-keyword">const</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * circleRadius - <span class="hljs-number">16</span>;
                <span class="hljs-title function_">createLogo</span>(logo, x, y);
            });

            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPointInsideCircle</span>(e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>, centerX, centerY, circleRadius)) {
                    <span class="hljs-keyword">if</span> (!isMouseInside) {
                        isMouseInside = <span class="hljs-literal">true</span>;
                        <span class="hljs-title function_">cancelAnimationFrame</span>(animationFrame);
                    }
                    <span class="hljs-title function_">updateCurves</span>(curves, e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (isMouseInside) {
                        isMouseInside = <span class="hljs-literal">false</span>;
                        <span class="hljs-title function_">autoAnimate</span>(curves);
                    }
                }
            });

            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function">() =&gt;</span> {
                isMouseInside = <span class="hljs-literal">false</span>;
                <span class="hljs-title function_">autoAnimate</span>(curves);
            });



            <span class="hljs-comment">// Start with auto animation</span>
            <span class="hljs-title function_">autoAnimate</span>(curves);
        }

        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
            svg.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
            container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.logo'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">logo</span> =&gt;</span> logo.<span class="hljs-title function_">remove</span>());
            container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.logo-image'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">logo</span> =&gt;</span> logo.<span class="hljs-title function_">remove</span>());
            <span class="hljs-title function_">cancelAnimationFrame</span>(animationFrame);
            <span class="hljs-title function_">init</span>();
        });


        <span class="hljs-title function_">init</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">css 部分</h3>
<pre><code class="hljs language-css" lang="css">&lt;style&gt;<span class="hljs-selector-tag">body</span>,
        <span class="hljs-selector-tag">html</span> {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
            <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
        }

        <span class="hljs-selector-id">#container</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">position</span>: relative;
        }

        <span class="hljs-selector-id">#center</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>);
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }

        <span class="hljs-selector-class">.logo</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">32px</span>;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">5</span>;
            <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>));
            <span class="hljs-attribute">cursor</span>: pointer;
        }

        <span class="hljs-selector-class">.logo-image</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">32px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">5</span>;
            <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>));
            <span class="hljs-attribute">cursor</span>: pointer;
        }

        <span class="hljs-selector-class">.logo</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
        }

        <span class="hljs-selector-class">.logo-image</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
        }

        svg {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">pointer-events</span>: none;
        }

        path {
            fill: none;
            stroke-<span class="hljs-attribute">width</span>: <span class="hljs-number">2</span>;
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;
        }

        <span class="hljs-selector-id">#outer-glow</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">76%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">76%</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">radial-gradient</span>(circle, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>) <span class="hljs-number">0%</span>, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>) <span class="hljs-number">70%</span>);
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
        }
&lt;/style&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS App 中 SSL Pinning 场景下代理抓包失效的原因]]></title>    <link>https://juejin.cn/post/7591635567589015598</link>    <guid>https://juejin.cn/post/7591635567589015598</guid>    <pubDate>2026-01-05T09:02:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591635567589015598" data-draft-id="7591687981687685166" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS App 中 SSL Pinning 场景下代理抓包失效的原因"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T09:02:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是谁的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2390811467846089"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS App 中 SSL Pinning 场景下代理抓包失效的原因
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2390811467846089/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是谁的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:02:19.000Z" title="Mon Jan 05 2026 09:02:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我第一次认真面对 SSL Pinning，并不是因为想研究安全，而是因为一个接口问题卡了两天。</p>
<p>App 在测试环境一切正常，到了准生产环境，功能偶尔失效。日志没报错，接口返回码是 200，但页面状态明显不对。
习惯性打开抓包工具，却发现 HTTPS 请求连内容都看不到。</p>
<p>证书装了，信任也点了，该做的都做了。
这时候再说抓不到包，已经有点不准确了，更像是抓包路径本身被绕开了。</p>
<hr/>
<h2 data-id="heading-0"><strong>先确认一件事：你面对的是 Pinning，还是别的问题</strong></h2>
<p>在很多案例里，SSL Pinning 绕过这个判断来得太早。</p>
<p>我通常会先做三件很具体的事：</p>
<ul>
<li>在模拟器上跑一遍，看同一接口是否可抓</li>
<li>在真机上切不同网络环境（Wi-Fi / 热点），观察行为是否变化</li>
<li>打开最基础的网络日志，确认请求是否真的发出</li>
</ul>
<p>如果这些信息彼此矛盾，问题往往还没到 Pinning 这一层。</p>
<hr/>
<h2 data-id="heading-1"><strong>代理抓包失败，其实已经给了线索</strong></h2>
<p>当 Charles、Fiddler 这类代理工具表现为：</p>
<ul>
<li>只能看到 CONNECT</li>
<li>TLS 握手直接失败</li>
<li>或者请求完全不出现</li>
</ul>
<p>而 App 本身又能正常工作时，基本可以确认<strong>客户端对证书链有额外校验逻辑。</strong></p>
<p>这时继续折腾代理设置，意义不大。</p>
<hr/>
<h2 data-id="heading-2"><strong>换一个问题问法：不解密，能不能继续查</strong></h2>
<p>在这个节点，我会刻意放弃“马上看到明文”的目标，而是转向更基础的问题：</p>
<blockquote>
<p>这个请求在什么时间发出？
发了几次？
是否存在重试或异常断开？</p>
</blockquote>
<p>这类问题，不依赖 HTTPS 解密。</p>
<hr/>
<h2 data-id="heading-3"><strong>设备侧抓包，是继续推进的第一步</strong></h2>
<p>我在这一步使用 **抓包大师（Sniff Master）**的其中暴力抓取HTTPS，这并不是为了破解什么，而是为了确认通信行为是否存在。</p>
<p>暴力抓取HTTPS无需设置代理即可获取iOS设备上的HTTPS请求，并且能够自动解密HTTPS请求。要求被抓取的App必须使用iOS开发证书签名；</p>
<p>对于未重签名的应用（如iOS系统应用或部分第三方应用），只能看到请求地址和请求头，无法查看请求和返回的body部分。</p>
<p>软件的PIN码检测和双向证书验证无法阻止暴力抓包，也无法感知暴力抓包的使用。</p>
<p>具体做法很简单：</p>
<ul>
<li>
<p>iOS设备通过USB连接电脑，选择要抓包的设备后，在功能选择区选择HTTPS暴力抓包，然后在暴力抓包界面点击开始按钮。</p>
</li>
<li>
<p>如果只关注某个App，可以点击选择App按钮进行过滤。更多关于暴力抓包的设置与使用查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sniffmaster.net%2Ftutorial%2Fzh%2F2%2F2.html" target="_blank" title="https://www.sniffmaster.net/tutorial/zh/2/2.html" ref="nofollow noopener noreferrer">暴力抓包详细教程</a></p>
</li>
</ul>
<p>不需要设置代理，也不需要让系统信任任何证书。</p>
<p>如果在这里能看到稳定的数据流，至少可以确认：<strong>Pinning 没有阻断通信，只是阻断了中间人解密。</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d31a97763334188bda5bacfad13a307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv6LCB55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768208538&amp;x-signature=dignL6rcVXh99MvjrNPyxoCX7ac%3D" alt="https暴力抓包" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4"><strong>只看 HTTPS 层，很容易误判问题位置</strong></h2>
<p>有一次问题中，HTTPS 请求本身没有任何异常。
真正的问题在于，App 在 HTTPS 返回后，通过 TCP 长连接同步状态。</p>
<p>代理抓包工具只能看到“接口成功”，但功能仍然异常。
设备侧数据流抓包却能看到连接频繁中断。</p>
<p>这类问题，如果只纠结 SSL Pinning，很容易走偏。</p>
<hr/>
<h2 data-id="heading-5"><strong>数据流分析，让问题变得“可定位”</strong></h2>
<p>抓包大师支持查看 TCP / UDP 数据流，并能导出原始数据。
在这个阶段，我并不急着解析协议，而是关注几个指标：</p>
<ul>
<li>连接是否持续</li>
<li>数据包大小是否异常</li>
<li>是否存在规律性的断开</li>
</ul>
<p>这些信息，可以直接指导下一步是去看客户端逻辑，还是服务端行为。</p>
<hr/>
<h2 data-id="heading-6"><strong>拦截和修改，更像验证假设</strong></h2>
<p>当我已经大致判断问题原因时，才会用到请求/响应修改。</p>
<p>比如：</p>
<ul>
<li>模拟接口延迟</li>
<li>修改返回字段，观察客户端分支逻辑</li>
</ul>
<p>抓包大师支持通过拦截器和脚本完成这些操作，更适合在真机环境下验证判断，而不是用来“突破安全”。、
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc8ddc914cea4ae19ea3089ae81cef68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv6LCB55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768208538&amp;x-signature=waAoTM9rTE2OTyOwe2Nvz3TUl4w%3D" alt="拦截器" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 中的 useMemo 与 useCallback：性能优化的利器]]></title>    <link>https://juejin.cn/post/7591348605867278371</link>    <guid>https://juejin.cn/post/7591348605867278371</guid>    <pubDate>2026-01-05T04:50:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605867278371" data-draft-id="7591382440583004200" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 中的 useMemo 与 useCallback：性能优化的利器"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-05T04:50:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冻梨政哥"/> <meta itemprop="url" content="https://juejin.cn/user/2373184444182659"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 中的 useMemo 与 useCallback：性能优化的利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2373184444182659/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冻梨政哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T04:50:31.000Z" title="Mon Jan 05 2026 04:50:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React 中的 useMemo 与 useCallback：性能优化的利器</h2>
<p>在 React 开发中，随着组件复杂度提升，性能优化逐渐成为不可忽视的问题。当组件状态更新时，函数组件会重新执行，这可能导致不必要的计算或子组件重渲染。React 提供的<code>useMemo</code>和<code>useCallback</code>两个 Hooks，正是解决这类性能问题的关键工具。本文将结合实际代码，详细讲解它们的作用、用法及应用场景。</p>
<h3 data-id="heading-1">为什么需要性能优化？</h3>
<p>在 React 中，当组件的状态（<code>useState</code>）或上下文（<code>useContext</code>）发生变化时，组件会重新执行其函数体。这一机制确保了 UI 与数据的同步，但也可能带来副作用：</p>
<ul>
<li>组件内的计算逻辑会被重复执行（即使计算结果不变）</li>
<li>传递给子组件的 props （尤其是函数）会被重新创建，导致子组件不必要的重渲染</li>
</ul>
<p>例如，在未优化的情况下，当一个与计算逻辑无关的状态变化时，过滤列表或复杂计算会被重复执行；父组件传递的回调函数每次都会是新的引用，导致使用<code>memo</code>包装的子组件依然重渲染。
<code>useMemo</code>和<code>useCallback</code>正是为解决这些问题而生。</p>
<h3 data-id="heading-2">useMemo：缓存计算结果</h3>
<h4 data-id="heading-3">作用</h4>
<p><code>useMemo</code>用于缓存<strong>计算结果</strong>，避免组件重渲染时重复执行昂贵的计算逻辑。只有当依赖项发生变化时，才会重新计算结果。</p>
<h4 data-id="heading-4">用法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> 缓存的结果 = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-comment">// 计算逻辑（可能是昂贵的操作） </span>
    <span class="hljs-keyword">return</span> 计算结果; 
}, [依赖项数组]); <span class="hljs-comment">// 依赖项变化时，重新执行计算</span>
</code></pre>
<ul>
<li>第一个参数：一个函数，封装需要缓存结果的计算逻辑</li>
<li>第二个参数：依赖项数组，只有数组中的值发生变化时，才会重新执行第一个函数</li>
</ul>
<h4 data-id="heading-5">代码示例</h4>
<ol>
<li><strong>过滤列表优化</strong></li>
</ol>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[count,setCount]</span> = useState(0)<span class="hljs-comment">;</span>
const <span class="hljs-attr">list</span> = [<span class="hljs-string">'apple'</span>,<span class="hljs-string">'banana'</span>,<span class="hljs-string">'orange'</span>,<span class="hljs-string">'pear'</span>]<span class="hljs-comment">; </span>
const <span class="hljs-section">[keyword,setKeyword]</span> = useState('')<span class="hljs-comment">;</span>
// 用useMemo缓存过滤结果，仅当keyword变化时重新过滤 
const <span class="hljs-attr">filterList</span> = useMemo(() =&gt; { 
    return list.filter(<span class="hljs-attr">item</span> =&gt; item.includes(keyword)) 
}, <span class="hljs-section">[keyword]</span>)
return (
    &lt;input <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> value={keyword} <span class="hljs-literal">on</span>Change={e =&gt; setKeyword(e.target.value)}/&gt;
     {
        filterList.map(<span class="hljs-attr">item</span> =&gt; (
          &lt;li <span class="hljs-attr">key</span>={item}&gt;{item}&lt;/li&gt;
        ))
      }
    &lt;button <span class="hljs-attr">onClick</span>={() =&gt; setCount(count + <span class="hljs-number">1</span>)}&gt;count + <span class="hljs-number">1</span>&lt;/button&gt;
)
</code></pre>
<p>若不使用<code>useMemo</code>，每次组件重渲染（即使<code>count</code>变化，与过滤逻辑无关），<code>filter</code>都会重新执行。使用<code>useMemo</code>后，只有<code>keyword</code>变化时才会重新过滤，减少了不必要的计算。</p>
<ol start="2">
<li><strong>昂贵计算优化</strong></li>
</ol>
<pre><code class="hljs language-ini" lang="ini">// 模拟一个昂贵的计算（循环100万次） 
function slowSum(n) { 
    console.log('计算中...')<span class="hljs-comment">; </span>
    let <span class="hljs-attr">sum</span> = <span class="hljs-number">0</span><span class="hljs-comment">; </span>
    for(let <span class="hljs-attr">i</span>=<span class="hljs-number">0</span><span class="hljs-comment">;i&lt;n*1000000;i++){ </span>
        sum+=i<span class="hljs-comment">; </span>
    } 
    return sum<span class="hljs-comment">; </span>
} 
// 用useMemo缓存计算结果，仅当num变化时重新计算 
const <span class="hljs-attr">result</span> = useMemo(() =&gt; { 
    return slowSum(num)<span class="hljs-comment">; </span>
}, <span class="hljs-section">[num]</span>)
</code></pre>
<p><code>slowSum</code>是一个耗时计算，若不缓存，每次组件重渲染（如<code>count</code>或<code>keyword</code>变化）都会触发它。使用<code>useMemo</code>后，只有<code>num</code>变化时才会重新执行，显著提升性能。</p>
<h4 data-id="heading-6">应用场景</h4>
<ul>
<li>包含<strong>昂贵计算</strong>的逻辑（如大量循环、复杂数据处理）</li>
<li>需要作为<code>props</code>传递的<strong>计算属性</strong>（避免子组件因值频繁变化而重渲染）</li>
<li>依赖多个状态 / 变量的推导值（确保仅在依赖变化时更新）</li>
</ul>
<h3 data-id="heading-7">useCallback：缓存回调函数</h3>
<h4 data-id="heading-8">作用</h4>
<p><code>useCallback</code>用于缓存<strong>函数引用</strong>，避免组件重渲染时重复创建相同逻辑的函数。常与<code>memo</code>配合使用，防止子组件因接收的函数<code>props</code>变化而不必要地重渲染。</p>
<h4 data-id="heading-9">用法</h4>
<pre><code class="hljs language-scss" lang="scss">const 缓存的函数 = <span class="hljs-built_in">useCallback</span>(() =&gt; { 
    <span class="hljs-comment">// 函数逻辑 </span>
}, <span class="hljs-selector-attr">[依赖项数组]</span>); <span class="hljs-comment">// 依赖项变化时，重新创建函数</span>
</code></pre>
<ul>
<li>第一个参数：需要缓存的回调函数</li>
<li>第二个参数：依赖项数组，只有数组中的值发生变化时，才会重新创建函数</li>
</ul>
<h4 data-id="heading-10">代码示例</h4>
<ol>
<li><strong>子组件优化</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用memo包装子组件，使其仅在props真正变化时重渲染</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{count,handleClick}</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'child 重新渲染'</span>);
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
            子组件{count}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
})
</code></pre>
<ol start="2">
<li><strong>缓存回调函数</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用useCallback缓存handleClick，仅当count变化时重新创建 </span>
<span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'click'</span>); 
}, [count])
</code></pre>
<p>若不使用<code>useCallback</code>，每次父组件重渲染，<code>handleClick</code>都会是新的函数引用。即使<code>memo</code>包装了<code>Child</code>，由于<code>handleClick</code>变化，子组件依然会重渲染。使用<code>useCallback</code>后，只有<code>count</code>变化时<code>handleClick</code>才更新，因此当<code>num</code>变化时，子组件不会重新渲染。</p>
<h4 data-id="heading-11">应用场景</h4>
<ul>
<li>传递给子组件的<strong>回调函数</strong>（如<code>onClick</code>、<code>onChange</code>）</li>
<li>作为依赖项传入<code>useEffect</code>等 Hooks 的函数（避免<code>useEffect</code>不必要地触发）</li>
<li>配合<code>memo</code>、<code>useMemo</code>等优化手段，确保子组件仅在必要时重渲染</li>
</ul>
<h3 data-id="heading-12">总结</h3>
<p><code>useMemo</code>和<code>useCallback</code>都是 React 性能优化的核心工具，它们的本质是<strong>缓存</strong>：</p>
<ul>
<li><code>useMemo</code>缓存<strong>计算结果</strong>，解决 “重复计算” 问题</li>
<li><code>useCallback</code>缓存<strong>函数引用</strong>，解决 “子组件不必要重渲染” 问题</li>
</ul>
<p>使用时需注意：</p>
<ul>
<li>不要过度优化：简单计算或不频繁重渲染的组件无需使用，缓存本身也有开销</li>
<li>依赖项数组必须正确：遗漏依赖会导致缓存结果 / 函数过时，引发逻辑错误</li>
<li>结合场景使用：昂贵计算用<code>useMemo</code>，回调函数用<code>useCallback</code>配合<code>memo</code></li>
</ul>
<p>合理使用这两个 Hooks，能有效提升 React 应用的性能，尤其在复杂组件或高频更新场景中效果显著。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js基本概念理解]]></title>    <link>https://juejin.cn/post/7591544356001087498</link>    <guid>https://juejin.cn/post/7591544356001087498</guid>    <pubDate>2026-01-05T06:14:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591544356001087498" data-draft-id="7591510174047944755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js基本概念理解"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-05T06:14:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cj8140"/> <meta itemprop="url" content="https://juejin.cn/user/958429869388990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js基本概念理解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/958429869388990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cj8140
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:14:19.000Z" title="Mon Jan 05 2026 06:14:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。 Node.js 使用了一个事件驱动、非阻塞式 I/O 的模型，使其轻量又高效。</p>
</blockquote>
<p>这句话是 Node.js 的核心设计理念，我用<strong>餐厅服务员</strong>的比喻来帮你拆解理解：</p>
<hr/>
<h3 data-id="heading-0">一、整体比喻：Node.js 是一家"超高效快餐店"</h3>
<ul>
<li><strong>传统服务器</strong>（如PHP）：一个服务员从头到尾服务一桌客人（点单→做菜→上菜→结账），期间不能服务其他桌</li>
<li><strong>Node.js</strong>：一个服务员<strong>快速记录</strong>所有桌的订单，交给后厨（I/O操作）后，立刻服务下一桌，<strong>做好了通知他</strong>再去端菜</li>
</ul>
<hr/>
<h3 data-id="heading-1">二、分句详解</h3>
<h4 data-id="heading-2"><strong>1. "基于 Chrome V8 引擎"</strong></h4>
<p><strong>理解</strong>：Node.js 用 Chrome 浏览器的"发动机"来跑 JS 代码</p>

















<table><thead><tr><th>场景</th><th>解释</th></tr></thead><tbody><tr><td><strong>浏览器中的JS</strong></td><td>V8引擎解析JS → 操作DOM → 渲染页面</td></tr><tr><td><strong>Node.js中的JS</strong></td><td>V8引擎解析JS → <strong>操作文件/网络/数据库</strong> → 返回数据</td></tr></tbody></table>
<p><strong>好处</strong>：V8是C++写的，性能极高（JIT编译、垃圾回收优化），让JS运行速度接近原生代码</p>
<hr/>
<h4 data-id="heading-3"><strong>2. "事件驱动"</strong></h4>
<p><strong>理解</strong>：代码不是按顺序死板执行，而是 <strong>"有事我叫你，没事别管我"</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 传统方式：主动等待（阻塞）</span>
<span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'/file.txt'</span>); <span class="hljs-comment">// 干等文件读完</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);                         <span class="hljs-comment">// 才能执行这行</span>

<span class="hljs-comment">// ✅ Node.js方式：注册回调（事件驱动）</span>
fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'/file.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {  <span class="hljs-comment">// 告诉Node：读完文件"叫"我</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'文件读完了！'</span>, data);        <span class="hljs-comment">// 这个函数是"事件处理函数"</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'我先去干别的了...'</span>);          <span class="hljs-comment">// 不等待，立即执行</span>
</code></pre>
<p><strong>输出顺序</strong>：</p>
<pre><code class="hljs language-css" lang="css">我先去干别的了...
文件读完了！ <span class="hljs-selector-attr">[文件内容]</span>
</code></pre>
<p><strong>类比</strong>：你点外卖后<strong>不需要在门口干等</strong>，而是继续工作，外卖到了小哥<strong>打电话通知你</strong>（事件触发）</p>
<hr/>
<h4 data-id="heading-4"><strong>3. "非阻塞式 I/O"</strong></h4>
<p><strong>理解</strong>：I/O操作（文件、网络、数据库）就像<strong>烧水</strong>，Node.js 不会<strong>傻等水开</strong></p>
<ul>
<li><strong>阻塞式</strong>（同步）：站在水壶前，啥也不干，水开了才走</li>
<li><strong>非阻塞式</strong>（异步）：按下烧水按钮，<strong>立刻去做别的事</strong>，水壶响了（事件）再回来</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 同时发起1000个网络请求</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
  http.<span class="hljs-title function_">get</span>(<span class="hljs-string">'http://api.example.com'</span>, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { <span class="hljs-comment">// 非阻塞：发出请求就下一循环</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`请求<span class="hljs-subst">${i}</span>完成`</span>); <span class="hljs-comment">// 响应返回后自动执行回调</span>
  });
}
<span class="hljs-comment">// 1000个请求几乎瞬间发完，不需要等任何一个返回</span>
</code></pre>
<p><strong>关键</strong>：单线程的 Node.js 能同时处理数万个连接，<strong>不是靠多线程，而是靠不等待</strong></p>
<hr/>
<h3 data-id="heading-5">三、三者如何协同工作？</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 完整事件循环示意图</span>
┌─────────────────────────────────────┐
│        <span class="hljs-title class_">Node</span>.<span class="hljs-property">js</span> 主线程（单线程）       │
│  不断检查<span class="hljs-string">"事件队列"</span>（像前台接待员）    │
└─────────────────────────────────────┘
         ↑               ↓
    有新事件吗？       执行回调函数
         ↑               ↓
┌────────┴────────┬────────┴────────┐
│  文件系统完成   │   网络响应到达   │   数据库查询完成
│  (<span class="hljs-variable constant_">V8</span>不管这些)    │  (<span class="hljs-variable constant_">V8</span>不管这些)    │   (<span class="hljs-variable constant_">V8</span>不管这些)
└─────────────────┴─────────────────┘
</code></pre>
<p><strong>工作流程</strong>：</p>
<ol>
<li><strong>V8引擎</strong>：快速执行你的JS代码，注册回调函数</li>
<li><strong>非阻塞I/O</strong>：遇到耗时操作，交给<strong>操作系统内核</strong>或<strong>线程池</strong>处理，主线程立即继续</li>
<li><strong>事件驱动</strong>：操作完成后，内核通知 Node.js，V8执行对应的回调函数</li>
</ol>
<hr/>
<h3 data-id="heading-6">四、为什么"轻量又高效"？</h3>

























<table><thead><tr><th>传统多线程服务器 (Apache)</th><th>Node.js</th></tr></thead><tbody><tr><td>每个请求 = 一个线程（约2MB内存）</td><td>所有请求 = 一个线程（几KB内存）</td></tr><tr><td>10000个连接 ≈ 20GB内存</td><td>10000个连接 ≈ 几十MB内存</td></tr><tr><td>线程切换CPU开销大</td><td>无线程切换，CPU只做有用功</td></tr><tr><td>适合CPU密集型（如图像处理）</td><td>适合I/O密集型（API、聊天室、实时推送）</td></tr></tbody></table>
<p><strong>代价</strong>：如果回调函数里有<code>for(let i=0; i&lt;1000000000; i++)</code>这种CPU重计算，会<strong>卡住整个事件循环</strong>，后续所有请求都等待（这叫"阻塞事件循环"）。</p>
<hr/>
<h3 data-id="heading-7">五、一句话总结</h3>
<p><strong>Node.js = 用V8引擎跑JS + 单线程不等待 + 有事call back</strong></p>
<p>它就像一家<strong>只有一个服务员但永不空闲</strong>的餐厅，通过"事件通知"机制，用极少的资源处理海量并发，但<strong>不适合做需要长时间占用CPU的复杂计算</strong>（那种任务要交给其他语言或用Worker Threads）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Promise状态机与状态流转]]></title>    <link>https://juejin.cn/post/7591403124327645247</link>    <guid>https://juejin.cn/post/7591403124327645247</guid>    <pubDate>2026-01-05T06:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591403124327645247" data-draft-id="7591410544928735274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Promise状态机与状态流转"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T06:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Promise状态机与状态流转
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:44:29.000Z" title="Mon Jan 05 2026 06:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本专栏聚焦Promise的核心原理与高级应用，包含：
✓ Promise A+规范深度解读
✓ 手写实现与源码分析
✓ 异步编程设计模式
✓ 性能调优与错误处理</p>
</blockquote>
<blockquote>
<p>适合有JavaScript基础，希望深入异步编程的开发者。我们将用最少的篇幅，讲透最核心的知识。</p>
</blockquote>
<h2 data-id="heading-0">引言：Promise状态机</h2>
<p>在之前的文章中，我们曾提到Promise三种状态：<code>pending（待定）</code>、<code>fulfilled（兑现）</code>、<code>rejected（拒绝）</code>。而且还有一个关键特性：</p>
<ul>
<li>状态不可逆：一旦状态从pending变为fulfilled或rejected，就永远不会再改变。</li>
</ul>
<p>这是什么意思呢？我们可以举一个简单的例子来帮助大家理解：
我们可以把Promise当做一台自动贩卖机：我们投币（发起请求）后，贩卖机进入"pending"状态，最终要么出货（fulfilled），要么退币（rejected）。一旦出货或退币完成，状态就固定了，不会突然又变回处理中。</p>
<h2 data-id="heading-1">Promise的三态模型：状态流转</h2>
<h3 data-id="heading-2">状态定义与转换关系</h3>
<p>Promise规范明确定义了三种状态：<code>pending（待定）</code>、<code>fulfilled（兑现）</code>、<code>rejected（拒绝）</code>，它们构成了一个完整的有限状态机。我们先通过一段简单的代码示例，来观察Promise的状态流程：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 状态流转示意图</span>
<span class="hljs-comment">// 创建时 → pending</span>
<span class="hljs-comment">// pending → fulfilled (通过resolve)</span>
<span class="hljs-comment">// pending → rejected (通过reject)</span>

<span class="hljs-comment">// 创建Promise时的初始状态</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Promise创建，状态: pending'</span>);
    
    <span class="hljs-comment">// 1秒后状态转换</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> success = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>;
        
        <span class="hljs-keyword">if</span> (success) {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'操作成功'</span>);  <span class="hljs-comment">// pending → fulfilled</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态已变为: fulfilled'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'操作失败'</span>));  <span class="hljs-comment">// pending → rejected</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态已变为: rejected'</span>);
        }
        
        <span class="hljs-comment">// 注意：以下代码不会生效！</span>
        <span class="hljs-keyword">if</span> (!success) {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'重新尝试成功'</span>);  <span class="hljs-comment">// 无效！状态已锁定</span>
        }
    }, <span class="hljs-number">1000</span>);
});
</code></pre>
<h3 data-id="heading-3">状态详解</h3>
<h4 data-id="heading-4">Pending（待定状态）</h4>
<p><strong>Pending</strong> 为Promise的初始状态，也可以称为过渡状态，它可能被转为fulfilled或rejected，通常在创建Promise时默认即为pending状态，类似于订单已下单，但商家尚未发货。我们可以看下面一个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> { })
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myPromise)
</code></pre>
<p>上述代码中，我们创建了一个空函数对象，其输出结果为：<code>Promise { &lt;pending&gt; }</code>。这是Promise对象的最初始状态，在<code>pending</code>状态下，Promise可以被转换成<code>fulfilled</code>或<code>rejected</code>。</p>
<blockquote>
<p>注：Promise并不是一开始就必须处于<code>pending</code>状态，通过<code>Promise.resolve()</code>等静态方法，可以直接实例化一个<code>resolved</code>状态的Promise对象。</p>
</blockquote>
<blockquote>
<p>Promise相关实例化方法和静态方法在后面的文章中会详细讲解。</p>
</blockquote>
<h4 data-id="heading-5">Fulfilled（兑现状态）</h4>
<p>当 <code>resolve(value)</code> 被调用时，Promise对象的状态会被转换成<code>fulfilled</code>，同时会携带一个不可变的结果值，就好比订单已发货并签收。我们可以看下面一个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'Hello, World!'</span>))
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myPromise)
</code></pre>
<p>上述代码中，我们在Promise中产生了一个<code>resolve('Hello, World!')</code>的回调函数，其输出结果是：<code>Promise {&lt;fulfilled&gt;: 'Hello, World!'}</code> 。</p>
<blockquote>
<p>注：在不同的编辑器中，解析结果可能不一样，比如node.js环境中，会直接输出<code>Promise { 'Hello, World!'}</code> 。</p>
</blockquote>
<h4 data-id="heading-6">Rejected（拒绝状态）</h4>
<p>当<code>reject(reason)</code>被调用时，或同步抛出异常问题，Promise对象的状态会被转换成<code>rejected</code>，同时会携带一个拒绝原因（通常是Error对象），就好比订单因缺货等原因无法完成。我们可以看下面一个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'直接拒绝'</span>)))
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myPromise)
</code></pre>
<p>上述代码中，我们在Promise中产生了一个<code>reject(new Error('直接拒绝'))</code>的回调函数，其输出结果是：<code>Promise {&lt;rejected&gt;: Error: 直接拒绝</code> 。</p>
<blockquote>
<p>注：在不同的编辑器中，解析结果可能不一样，比如node.js环境中，会直接输出<code>Promise {&lt;rejected&gt;: Error: 直接拒绝}</code> 外，还是打印出堆栈跟踪信息。</p>
</blockquote>
<p>除了上述代码示例外，下面两种情况也会自动转成<code>rejected</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'同步异常导致拒绝'</span>);  <span class="hljs-comment">// 会被自动转换为reject</span>
})
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myPromise)
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'无效的JSON'</span>)
        } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-title function_">reject</span>(err)  <span class="hljs-comment">// 捕获异常并明确拒绝</span>
        }
    }, <span class="hljs-number">0</span>)
})
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myPromise)
</code></pre>
<h3 data-id="heading-7">不可变原则</h3>
<h4 data-id="heading-8">状态不可逆性</h4>
<p>这是Promise最重要的特性之一：状态一旦从 <code>pending</code> 变为 <code>fulfilled</code> 或 <code>rejected</code> ，就永远不会再次改变。我们可以看下面一个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 状态不可逆的证明</span>
<span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-comment">// 第一次状态改变</span>
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'第一次成功'</span>);

    <span class="hljs-comment">// 以下所有尝试都不会生效</span>
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'第二次成功'</span>);  <span class="hljs-comment">// 忽略</span>
    <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'尝试失败'</span>));  <span class="hljs-comment">// 忽略</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'延迟的成功'</span>);  <span class="hljs-comment">// 忽略</span>
    }, <span class="hljs-number">1000</span>);

    <span class="hljs-comment">// 甚至抛出异常也不会影响</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'异常被忽略'</span>);
});

myPromise
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只会收到:'</span>, value);  <span class="hljs-comment">// 输出: 第一次成功</span>
        <span class="hljs-keyword">return</span> value;
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'永远不会执行这里'</span>);  <span class="hljs-comment">// 因为状态已经是fulfilled</span>
    });
</code></pre>
<p>上述代码的执行结果只会是：<code>只会收到: 第一次成功</code> 。</p>
<h4 data-id="heading-9">值不可变性</h4>
<p>当Promise被决议后，其状态就会被确定，同时它所携带的值就固定不变了，无法从外部修改。我们来看下面一个例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'第一次设置的值'</span>) <span class="hljs-comment">// 有效</span>
    <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'尝试覆盖的值'</span>)   <span class="hljs-comment">// 被忽略</span>
    <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'尝试拒绝'</span>)) <span class="hljs-comment">// 被忽略</span>
})

myPromise.<span class="hljs-title function_">then</span>(
    <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'成功:'</span>, value), <span class="hljs-comment">// 输出: 成功: 第一次设置的值</span>
    <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'失败:'</span>, error.<span class="hljs-property">message</span>) <span class="hljs-comment">// 不会执行</span>
)
</code></pre>
<p>上述代码的执行结果只会是：<code>成功: 第一次设置的值</code> 。</p>
<h2 data-id="heading-10">结语</h2>
<p>本文主要介绍了Promise状态机与状态流转的相关概念，如果你在理解状态机模型或不可变原则时有任何疑问，或对于文章中错误的地方或者有任何问题，欢迎在评论区留言讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 缓存三剑客：useMemo、useCallback 与 memo 的正确打开方式]]></title>    <link>https://juejin.cn/post/7591439305261039651</link>    <guid>https://juejin.cn/post/7591439305261039651</guid>    <pubDate>2026-01-05T06:50:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591439305261039651" data-draft-id="7591465142451683380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" React 缓存三剑客：useMemo、useCallback 与 memo 的正确打开方式"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-05T06:50:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             React 缓存三剑客：useMemo、useCallback 与 memo 的正确打开方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:50:29.000Z" title="Mon Jan 05 2026 06:50:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 应用开发中，随着组件复杂度的提升，性能问题逐渐显现。尤其当组件中包含大量计算逻辑或频繁触发重渲染时，应用响应速度会明显下降。React 提供了 <code>useMemo</code> 和 <code>useCallback</code> 两个核心 Hook，配合 <code>React.memo</code>，可以有效避免不必要的重复计算和组件重渲染，显著提升应用性能。本文将通过三个典型 Demo，深入剖析这两个 Hook 的使用场景、原理及最佳实践。</p>
<hr/>
<h2 data-id="heading-0">一、昂贵计算的缓存：useMemo 的作用</h2>
<h3 data-id="heading-1">1.1 问题场景：无意义的重复计算</h3>
<p>考虑以下组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [x, setX] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> [y, setY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'xxx'</span>);
  <span class="hljs-comment">// 模拟大量的计算</span>
  <span class="hljs-keyword">let</span> a = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">100000000</span>; j++) {
    a += j;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'xxx'</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>x: {x}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>y: {y}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>a: {a}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setX(x + 1)}&gt;x + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setY(y + 1)}&gt;y + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>在这个组件中，每次点击按钮（无论是 <code>x + 1</code> 还是 <code>y + 1</code>），都会触发组件重新渲染。而每次渲染时，都会执行一次耗时的循环计算（1亿次加法）。然而，这个计算结果 <code>a</code> 实际上与 <code>x</code> 和 <code>y</code> 无关——它始终是固定的值（即 0 到 99999999 的累加和）。因此，这种重复计算完全是无意义的，严重浪费 CPU 资源。</p>
<h3 data-id="heading-2">1.2 解决方案：使用 useMemo 缓存结果</h3>
<p><code>useMemo</code> 的核心思想是<strong>记忆化（memoization）</strong> ：将计算结果缓存起来，只有当依赖项发生变化时才重新计算。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [x, setX] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> [y, setY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'xxx'</span>);
  <span class="hljs-keyword">const</span> memoA = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> a = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">100000000</span>; j++) {
      a += j;
    }
    <span class="hljs-keyword">return</span> a;
  }, []); <span class="hljs-comment">// 依赖项为空数组</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'xxx'</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>x: {x}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>y: {y}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>a: {memoA}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setX(x + 1)}&gt;x + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setY(y + 1)}&gt;y + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>关键点在于 <code>useMemo</code> 的第二个参数——<strong>依赖数组</strong>。这里传入空数组 <code>[]</code>，表示该计算<strong>不依赖任何外部变量</strong>，因此只在组件首次挂载时执行一次。后续无论 <code>x</code> 或 <code>y</code> 如何变化，<code>memoA</code> 都直接返回缓存的值，不再执行耗时循环。控制台输出的时间将从几百毫秒降至几乎为 0。</p>
<blockquote>
<p><strong>注意</strong>：<code>useMemo</code> 返回的是<strong>计算结果本身</strong>，而非副作用函数（这与 <code>useEffect</code> 不同）。必须用变量接收其返回值才能使用。</p>
</blockquote>
<h3 data-id="heading-3">1.3 动态依赖：让缓存“聪明”起来</h3>
<p>如果计算逻辑依赖于状态变量，就必须将该变量加入依赖数组：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">memoA</span> = useMemo(() =&gt; {
  let <span class="hljs-attr">a</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  for (let <span class="hljs-attr">j</span> = <span class="hljs-number">0</span><span class="hljs-comment">; j &lt; 100000000; j++) {</span>
    a += y<span class="hljs-comment">; // 计算依赖 y</span>
  }
  return a<span class="hljs-comment">;</span>
}, <span class="hljs-section">[y]</span>)<span class="hljs-comment">; // 依赖项为 [y]</span>
</code></pre>
<p>此时：</p>
<ul>
<li>当点击 <strong>x + 1</strong> 时，<code>y</code> 未变 → <code>useMemo</code> 返回缓存值 → 无计算开销。</li>
<li>当点击 <strong>y + 1</strong> 时，<code>y</code> 发生变化 → <code>useMemo</code> 重新执行计算 → 产生时间消耗。</li>
</ul>
<p>若错误地将依赖数组设为空 <code>[]</code>，则即使 <code>y</code> 改变，<code>useMemo</code> 仍会返回首次计算的旧值（因为闭包捕获了初始的 <code>y</code>），导致<strong>数据不一致</strong>。这就是典型的“闭包陷阱”——<strong>依赖数组必须包含回调函数中用到的所有外部变量</strong>。</p>
<hr/>
<h2 data-id="heading-4">二、避免子组件无谓重渲染：useCallback + React.memo</h2>
<h3 data-id="heading-5">2.1 问题根源：函数引用变化</h3>
<p>在组件通信中，父组件常需向子组件传递回调函数。但每次父组件重渲染时，都会创建一个<strong>全新的函数引用</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件每次渲染都会生成新函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'click'</span>);
};
</code></pre>
<p>即使函数逻辑完全相同，JavaScript 也会将其视为不同对象。当子组件使用 <code>React.memo</code> 优化时，浅比较会认为 <code>props</code> 发生了变化，从而触发不必要的重渲染。</p>
<h3 data-id="heading-6">2.2 React.memo：子组件的“守门员”</h3>
<p><code>React.memo</code> 是一个高阶组件，用于包裹函数组件。它通过<strong>浅比较 props</strong> 来决定是否跳过渲染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ count, handleClick }</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'child 重新渲染'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>{count} 子组件<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
});
</code></pre>
<ul>
<li>若 <code>count</code> 和 <code>handleClick</code> 的引用均未改变 → 跳过渲染。</li>
<li>若任一 prop 引用改变 → 重新渲染。</li>
</ul>
<h3 data-id="heading-7">2.3 useCallback：稳定函数引用</h3>
<p>为解决函数引用变化问题，<code>useCallback</code> 应运而生。它专门用于<strong>缓存函数引用</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">handleClick</span> = useCallback(() =&gt; {
  console.log('click')<span class="hljs-comment">;</span>
}, <span class="hljs-section">[count]</span>)<span class="hljs-comment">; // 依赖项为 [count]</span>
</code></pre>
<p>工作原理：</p>
<ul>
<li>
<p>首次渲染：创建函数并缓存。</p>
</li>
<li>
<p>后续渲染：</p>
<ul>
<li>若 <code>count</code> 未变 → 返回缓存的函数引用。</li>
<li>若 <code>count</code> 改变 → 创建新函数并更新缓存。</li>
</ul>
</li>
</ul>
<p>结合 <code>React.memo</code>，可实现精准渲染控制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [num, setNum] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'click'</span>);
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {count}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;count + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {num}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num + 1)}&gt;num + 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">count</span>=<span class="hljs-string">{count}</span> <span class="hljs-attr">handleClick</span>=<span class="hljs-string">{handleClick}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>测试行为：</p>
<ul>
<li>点击 <strong>num + 1</strong>：<code>count</code> 不变 → <code>handleClick</code> 引用不变 → <code>Child</code> 不重渲染。</li>
<li>点击 <strong>count + 1</strong>：<code>count</code> 改变 → <code>handleClick</code> 生成新引用 → <code>Child</code> 重渲染。</li>
</ul>
<blockquote>
<p><strong>关键点</strong>：<code>useCallback(fn, deps)</code> 等价于 <code>useMemo(() =&gt; fn, deps)</code>。前者是后者的语法糖，专用于函数缓存。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">三、核心概念对比与最佳实践</h2>
<h3 data-id="heading-9">3.1 useMemo vs useCallback</h3>






























<table><thead><tr><th>特性</th><th>useMemo</th><th>useCallback</th></tr></thead><tbody><tr><td><strong>用途</strong></td><td>缓存<strong>计算结果</strong>（值）</td><td>缓存<strong>函数引用</strong></td></tr><tr><td><strong>返回值</strong></td><td>回调函数的返回值</td><td>回调函数本身</td></tr><tr><td><strong>典型场景</strong></td><td>昂贵计算（如大数据处理、复杂过滤）</td><td>传递给子组件的回调函数</td></tr><tr><td><strong>等价写法</strong></td><td>—</td><td><code>useMemo(() =&gt; fn, deps)</code></td></tr></tbody></table>
<h3 data-id="heading-10">3.2 依赖数组的黄金法则</h3>
<p>无论是 <code>useMemo</code> 还是 <code>useCallback</code>，依赖数组都必须遵循：</p>
<ol>
<li><strong>完整性</strong>：包含回调中用到的所有外部变量（状态、props、其他 Hooks 的返回值等）。</li>
<li><strong>必要性</strong>：仅包含真正影响计算/函数行为的变量，避免过度依赖导致缓存失效。</li>
</ol>
<p>违反完整性会导致闭包陷阱（使用过期值）；过度依赖则削弱缓存效果。</p>
<h3 data-id="heading-11">3.3 性能优化的边界</h3>
<ul>
<li><strong>不要过早优化</strong>：仅对已知的性能瓶颈使用 <code>useMemo</code>/<code>useCallback</code>。简单计算或小型组件无需优化。</li>
<li><strong>避免滥用空依赖</strong>：<code>[]</code> 仅适用于完全静态的值。若计算涉及 props 或状态，必须正确声明依赖。</li>
<li><strong>React.memo 的局限性</strong>：仅对 props 进行浅比较。若 prop 是对象/数组，需确保其引用稳定（同样可用 <code>useMemo</code> 缓存）。</li>
</ul>
<hr/>
<h2 data-id="heading-12">四、总结</h2>
<p><code>useMemo</code> 和 <code>useCallback</code> 是 React 性能优化体系中的重要工具：</p>
<ul>
<li><strong><code>useMemo</code></strong> 通过缓存昂贵计算的结果，避免重复执行相同逻辑。</li>
<li><strong><code>useCallback</code></strong> 通过稳定函数引用，配合 <code>React.memo</code> 阻止子组件无谓重渲染。</li>
</ul>
<p>二者的核心机制均依赖于<strong>依赖数组的精确声明</strong>——这是避免 bug 与发挥性能优势的关键。在实际开发中，应结合具体场景判断是否需要优化，并始终遵循依赖声明的完整性原则。合理运用这些 Hook，能让 React 应用在保持代码简洁的同时，获得流畅的用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端虚拟列表滚动功能实现与核心知识点详解]]></title>    <link>https://juejin.cn/post/7591420438850519076</link>    <guid>https://juejin.cn/post/7591420438850519076</guid>    <pubDate>2026-01-05T06:59:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591420438850519076" data-draft-id="7591407298414706694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端虚拟列表滚动功能实现与核心知识点详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-05T06:59:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端er小Z"/> <meta itemprop="url" content="https://juejin.cn/user/871279852264302"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端虚拟列表滚动功能实现与核心知识点详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/871279852264302/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端er小Z
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:59:15.000Z" title="Mon Jan 05 2026 06:59:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>虚拟列表（Virtual List）是前端解决<strong>长列表渲染性能问题</strong>的核心方案，其核心思想是「只渲染可视区域内的列表项，而非全部数据」，可将上万条数据的列表渲染耗时从秒级降至毫秒级。本文从「<strong>核心原理→实现步骤→知识点拆解→进阶优化</strong>」全维度讲解，附完整可运行代码。</p>
<h2 data-id="heading-0">一、虚拟列表核心原理</h2>
<h3 data-id="heading-1">1. 为什么需要虚拟列表？</h3>
<p>普通长列表渲染的问题：</p>
<ul>
<li>DOM 节点过多：10000 条数据会生成 10000 个 DOM 节点，导致首次渲染慢、滚动卡顿（重排 / 重绘成本高）；</li>
<li>内存占用大：大量 DOM 节点占用浏览器内存，易引发页面崩溃。</li>
</ul>
<p>虚拟列表的解决思路：</p>
<ol>
<li><strong>固定容器高度</strong>：列表外层容器设置固定高度并开启滚动（<code>overflow: auto</code>）；</li>
<li><strong>计算可视区域</strong>：根据容器高度、列表项高度，计算「可视区域能显示的列表项数量」；</li>
<li><strong>只渲染可视项</strong>：从全量数据中截取可视区域内的部分数据，仅渲染这些数据对应的 DOM；</li>
<li><strong>滚动偏移模拟</strong>：通过「空白占位容器」模拟列表的整体滚动高度，通过「定位可视项容器」实现滚动时的位置对齐。</li>
</ol>
<h3 data-id="heading-2">2. 核心术语与公式</h3>


















































<table><thead><tr><th>术语</th><th>说明</th><th>核心公式</th></tr></thead><tbody><tr><td>容器可视高度（viewHeight）</td><td>列表外层容器的可见高度（如 500px）</td><td>-</td></tr><tr><td>列表项高度（itemHeight）</td><td>单个列表项的固定高度（如 50px，简化版虚拟列表假设高度固定）</td><td>-</td></tr><tr><td>可视项数量（visibleCount）</td><td>可视区域能显示的列表项数量（向上取整避免留白）</td><td><code>visibleCount = Math.ceil(viewHeight / itemHeight) + 2</code>（+2 为缓冲项）</td></tr><tr><td>滚动偏移量（scrollTop）</td><td>容器的滚动距离（<code>container.scrollTop</code>）</td><td>-</td></tr><tr><td>起始索引（startIndex）</td><td>可视区域第一个列表项的索引</td><td><code>startIndex = Math.floor(scrollTop / itemHeight)</code></td></tr><tr><td>结束索引（endIndex）</td><td>可视区域最后一个列表项的索引</td><td><code>endIndex = startIndex + visibleCount</code></td></tr><tr><td>占位高度（totalHeight）</td><td>模拟整个列表的高度（让滚动条显示正确）</td><td><code>totalHeight = 总数据长度 * itemHeight</code></td></tr><tr><td>可视项偏移（offsetTop）</td><td>可视项容器的垂直偏移（让可视项显示在正确位置）</td><td><code>offsetTop = startIndex * itemHeight</code></td></tr></tbody></table>
<h2 data-id="heading-3">二、基础版虚拟列表实现（固定高度）</h2>
<h3 data-id="heading-4">1. 完整代码（原生 JS 版）</h3>
<pre><code class="hljs language-js" lang="js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>基础版虚拟列表<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 1. 列表容器：固定高度、开启滚动、相对定位 */</span>
    <span class="hljs-selector-class">.virtual-list-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>; <span class="hljs-comment">/* 可视区域高度 */</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e6e6e6</span>;
      <span class="hljs-attribute">overflow</span>: auto;
      <span class="hljs-attribute">position</span>: relative;
    }
    <span class="hljs-comment">/* 2. 占位容器：模拟整个列表的高度，让滚动条正常显示 */</span>
    <span class="hljs-selector-class">.virtual-list-placeholder</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-comment">/* 高度由JS动态计算：总数据长度 * 列表项高度 */</span>
    }
    <span class="hljs-comment">/* 3. 可视项容器：绝对定位，通过top偏移显示在正确位置 */</span>
    <span class="hljs-selector-class">.virtual-list-items</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    }
    <span class="hljs-comment">/* 4. 列表项：固定高度 */</span>
    <span class="hljs-selector-class">.list-item</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* 单个列表项高度 */</span>
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 外层容器，固定高度 + 滚动 + 相对定位（作为子元素的定位参考） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 占位容器：模拟总高度 --&gt;</span>
     <span class="hljs-comment">&lt;!-- 占位容器，高度等于「总数据长度 × 列表项高度」，目的是让滚动条的长度和滚动范围与真实长列表一致 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-placeholder"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"placeholder"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 可视项容器：只渲染可视区域的列表项 --&gt;</span>
     <span class="hljs-comment">&lt;!-- 可视项容器，绝对定位，通过top属性偏移到当前滚动位置对应的区域，只渲染可视数据。 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-items"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"items"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 1. 模拟海量数据（10万条）</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TOTAL_DATA</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">100000</span> }, <span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> ({
      <span class="hljs-attr">id</span>: index,
      <span class="hljs-attr">content</span>: <span class="hljs-string">`列表项 <span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>`</span>
    }));

    <span class="hljs-comment">// 2. 核心配置</span>
    <span class="hljs-keyword">const</span> config = {
      <span class="hljs-attr">viewHeight</span>: <span class="hljs-number">500</span>, <span class="hljs-comment">// 容器可视高度（px）</span>
      <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>,  <span class="hljs-comment">// 单个列表项高度（px）</span>
      <span class="hljs-attr">buffer</span>: <span class="hljs-number">2</span>        <span class="hljs-comment">// 缓冲项数量（避免滚动时出现空白）</span>
    };

    <span class="hljs-comment">// 3. 获取DOM元素</span>
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>);
    <span class="hljs-keyword">const</span> placeholder = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'placeholder'</span>);
    <span class="hljs-keyword">const</span> items = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'items'</span>);

    <span class="hljs-comment">// 4. 初始化：设置占位容器高度</span>
    placeholder.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${TOTAL_DATA.length * config.itemHeight}</span>px`</span>;

    <span class="hljs-comment">// 5. 核心渲染函数：根据滚动位置渲染可视项</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 5.1 获取滚动偏移量 container.scrollTop 表示容器向上滚动的距离</span>
      <span class="hljs-keyword">const</span> scrollTop = container.<span class="hljs-property">scrollTop</span>;
      
      <span class="hljs-comment">// 5.2 计算可视项的起始/结束索引</span>
      <span class="hljs-comment">// 滚动偏移 150px → startIndex = 150/50 = 3（第 4 项）；</span>
      <span class="hljs-comment">// endIndex = 3+12 = 15（第 16 项）；</span>
      <span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(config.<span class="hljs-property">viewHeight</span> / config.<span class="hljs-property">itemHeight</span>) + config.<span class="hljs-property">buffer</span>;
      <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / config.<span class="hljs-property">itemHeight</span>)); <span class="hljs-comment">// 避免负数</span>
      <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>, startIndex + visibleCount);
      
      <span class="hljs-comment">// 5.3 截取可视区域的数据</span>
      <span class="hljs-comment">// 从 10 万条数据中截取第 3~15 项（仅 13 条）；</span>
      <span class="hljs-keyword">const</span> visibleData = <span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-title function_">slice</span>(startIndex, endIndex + <span class="hljs-number">1</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"scrollTop:"</span>,scrollTop)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"visibleCount:"</span>,visibleCount)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"startIndex:"</span>,startIndex)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"endIndex:"</span>,endIndex)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"======"</span>)
      
      <span class="hljs-comment">// 5.4 计算可视项容器的偏移（让可视项显示在正确位置）</span>
      <span class="hljs-comment">// 设置可视项偏移：items.style.top = 3×50 = 150px，让可视项容器对齐滚动位置</span>
      items.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${startIndex * config.itemHeight}</span>px`</span>;
      
      <span class="hljs-comment">// 5.5 渲染可视项（innerHTML简化版，实际可优化为DOM复用）</span>
      items.<span class="hljs-property">innerHTML</span> = visibleData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-string">`
        &lt;div class="list-item" data-id="<span class="hljs-subst">${item.id}</span>"&gt;
          <span class="hljs-subst">${item.content}</span>
        &lt;/div&gt;
      `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
    }

    <span class="hljs-comment">// 6. 监听滚动事件：滚动时重新渲染可视项</span>
    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">debounce</span>(renderVisibleItems));

    <span class="hljs-comment">// 7. 初始化渲染</span>
    <span class="hljs-title function_">renderVisibleItems</span>();


    <span class="hljs-comment">// 防抖函数 如果在16ms内多次执行滚动，则会重新计算时间</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay = <span class="hljs-number">16</span></span>) {
      <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
        <span class="hljs-built_in">clearTimeout</span>(timer);
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args), delay);
      };
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</span></code></pre>
<h3 data-id="heading-5">2. 核心逻辑拆解</h3>
<h4 data-id="heading-6">（1）DOM 结构设计</h4>
<ul>
<li><code>virtual-list-container</code>：外层容器，固定高度 + 滚动 + 相对定位（作为子元素的定位参考）；</li>
<li><code>virtual-list-placeholder</code>：占位容器，高度等于「总数据长度 × 列表项高度」，目的是让滚动条的长度和滚动范围与真实长列表一致；</li>
<li><code>virtual-list-items</code>：可视项容器，绝对定位，通过<code>top</code>属性偏移到当前滚动位置对应的区域，只渲染可视数据。</li>
</ul>
<h4 data-id="heading-7">（2）渲染函数核心步骤</h4>
<ol>
<li>
<p><strong>获取滚动偏移量</strong>：<code>container.scrollTop</code> 表示容器向上滚动的距离；</p>
</li>
<li>
<p><strong>计算可视项数量</strong>：<code>Math.ceil(500/50)+2 = 12</code>，即可视区域能显示 10 项，额外加 2 项缓冲（避免快速滚动时出现空白）；</p>
</li>
<li>
<p><strong>计算起始 / 结束索引</strong>：</p>
<ul>
<li>滚动偏移 150px → <code>startIndex = 150/50 = 3</code>（第 4 项）；</li>
<li><code>endIndex = 3+12 = 15</code>（第 16 项）；</li>
</ul>
</li>
<li>
<p><strong>截取可视数据</strong>：从 10 万条数据中截取第 3~15 项（仅 13 条）；</p>
</li>
<li>
<p><strong>设置可视项偏移</strong>：<code>items.style.top = 3×50 = 150px</code>，让可视项容器对齐滚动位置；</p>
</li>
<li>
<p><strong>渲染可视项</strong>：仅渲染 13 项 DOM，而非 10 万项。</p>
</li>
</ol>
<h2 data-id="heading-8">三、虚拟列表核心知识点拆解</h2>
<h3 data-id="heading-9">1. 滚动事件与性能优化</h3>
<ul>
<li><strong>scroll 事件的特性</strong>：滚动时会高频触发（每秒数十次），直接在事件回调中操作 DOM 会导致性能问题；</li>
<li><strong>优化方案</strong>：防抖（Debounce），减少渲染频率（如每 16ms 渲染一次，对应 60fps）：</li>
</ul>
<h3 data-id="heading-10">2. 定位方式与偏移计算</h3>
<ul>
<li><strong>绝对定位的作用</strong>：可视项容器（<code>virtual-list-items</code>）脱离文档流，仅在可视区域渲染，不影响占位容器的高度；</li>
<li><strong>top 偏移的意义</strong>：<code>startIndex × itemHeight</code> 保证可视项容器始终对齐滚动位置，例如滚动到第 100 项时，<code>top = 100×50 = 5000px</code>，可视项容器会定位到 5000px 位置，显示第 100~112 项。</li>
</ul>
<h3 data-id="heading-11">3. 固定高度 vs 动态高度</h3>
<p>基础版假设列表项高度固定，实际场景中列表项高度可能动态（如内容换行、不同类型项高度不同），解决方案：</p>
<h4 data-id="heading-12">（1）预估高度 + 修正</h4>
<ol>
<li>先按「预估高度」计算占位高度和偏移；</li>
<li>渲染后获取真实高度（<code>getBoundingClientRect()</code>）；</li>
<li>记录每个项的真实高度，滚动时用真实高度修正偏移。</li>
</ol>
<h4 data-id="heading-13">（2）核心代码示例（动态高度）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 存储每个项的真实高度（初始为预估高度）</span>
<span class="hljs-keyword">const</span> itemHeights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-property">length</span>).<span class="hljs-title function_">fill</span>(config.<span class="hljs-property">itemHeight</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> scrollTop = container.<span class="hljs-property">scrollTop</span>;
  
  <span class="hljs-comment">// 计算累计高度（替代固定高度的startIndex计算）</span>
  <span class="hljs-keyword">let</span> cumulativeHeight = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> startIndex = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// 找到滚动位置对应的起始索引</span>
  <span class="hljs-keyword">for</span> (; startIndex &lt; <span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-property">length</span>; startIndex++) {
    <span class="hljs-keyword">if</span> (cumulativeHeight &gt;= scrollTop) <span class="hljs-keyword">break</span>;
    cumulativeHeight += itemHeights[startIndex];
  }
  
  <span class="hljs-comment">// 计算可视项结束索引（累计高度超过可视高度）</span>
  <span class="hljs-keyword">let</span> endIndex = startIndex;
  <span class="hljs-keyword">let</span> visibleHeight = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (endIndex &lt; <span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-property">length</span> &amp;&amp; visibleHeight &lt; config.<span class="hljs-property">viewHeight</span> + config.<span class="hljs-property">buffer</span> * config.<span class="hljs-property">itemHeight</span>) {
    visibleHeight += itemHeights[endIndex];
    endIndex++;
  }
  
  <span class="hljs-comment">// 截取可视数据</span>
  <span class="hljs-keyword">const</span> visibleData = <span class="hljs-variable constant_">TOTAL_DATA</span>.<span class="hljs-title function_">slice</span>(startIndex, endIndex);
  
  <span class="hljs-comment">// 计算可视项容器的偏移（累计到startIndex的高度）</span>
  <span class="hljs-keyword">const</span> offsetTop = cumulativeHeight - itemHeights[startIndex];
  items.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${offsetTop}</span>px`</span>;
  
  <span class="hljs-comment">// 渲染后修正真实高度</span>
  items.<span class="hljs-property">innerHTML</span> = visibleData.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, idx</span>) =&gt;</span> <span class="hljs-string">`
    &lt;div class="list-item" data-id="<span class="hljs-subst">${item.id}</span>"&gt;<span class="hljs-subst">${item.content}</span>&lt;/div&gt;
  `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
  
  <span class="hljs-comment">// 渲染完成后获取真实高度并更新</span>
  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(items.<span class="hljs-property">children</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el, idx</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> realHeight = el.<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">height</span>;
    <span class="hljs-keyword">const</span> realIndex = startIndex + idx;
    itemHeights[realIndex] = realHeight;
  });
  
  <span class="hljs-comment">// 更新占位容器的总高度（动态累加）</span>
  <span class="hljs-keyword">const</span> totalHeight = itemHeights.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, height</span>) =&gt;</span> sum + height, <span class="hljs-number">0</span>);
  placeholder.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${totalHeight}</span>px`</span>;
}
</code></pre>
<h3 data-id="heading-14">4. 缓冲项（Buffer）的作用</h3>
<ul>
<li><strong>问题</strong>：快速滚动时，可视项还未渲染完成，会出现短暂空白；</li>
<li><strong>解决方案</strong>：在可视项前后各加 N 个缓冲项（通常 2~5 项），提前渲染部分数据，覆盖滚动的 “视觉延迟”；</li>
<li><strong>注意</strong>：缓冲项过多会增加 DOM 数量，过少则无法解决空白问题，需根据业务调整（一般 2~5 项）。</li>
</ul>
<h3 data-id="heading-15">5. DOM 复用（进阶优化）</h3>
<p>基础版每次渲染都用<code>innerHTML</code>重新生成 DOM，会销毁旧 DOM 并创建新 DOM，存在性能损耗。<strong>DOM 复用</strong>是更优方案：</p>
<ol>
<li>初始化时创建「可视项数量 + 缓冲项」的空 DOM 节点池；</li>
<li>滚动时仅更新节点的内容，而非销毁 / 创建节点；</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 初始化DOM池</span>
<span class="hljs-keyword">const</span> domPool = [];
<span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(config.<span class="hljs-property">viewHeight</span> / config.<span class="hljs-property">itemHeight</span>) + config.<span class="hljs-property">buffer</span>;
<span class="hljs-comment">// 创建空节点池</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; visibleCount; i++) {
  <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  el.<span class="hljs-property">className</span> = <span class="hljs-string">'list-item'</span>;
  domPool.<span class="hljs-title function_">push</span>(el);
  items.<span class="hljs-title function_">appendChild</span>(el);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ... 计算startIndex/endIndex/visibleData ...</span>
  
  <span class="hljs-comment">// 复用DOM节点：仅更新内容，不创建新节点</span>
  visibleData.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, idx</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> el = domPool[idx];
    el.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span> = item.<span class="hljs-property">id</span>;
    el.<span class="hljs-property">textContent</span> = item.<span class="hljs-property">content</span>;
  });
  
  <span class="hljs-comment">// 隐藏超出可视数据的节点（可选）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = visibleData.<span class="hljs-property">length</span>; i &lt; domPool.<span class="hljs-property">length</span>; i++) {
    domPool[i].<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  }
}
</code></pre>
<h2 data-id="heading-16">四、框架版虚拟列表（Vue3 示例）</h2>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-container"</span>
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"containerRef"</span>
    @<span class="hljs-attr">scroll</span>=<span class="hljs-string">"handleScroll"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-placeholder"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: totalHeight + 'px' }"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-list-items"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ top: offsetTop + 'px' }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in visibleData"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>
      &gt;</span>
        {{ item.content }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 配置</span>
<span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">viewHeight</span>: <span class="hljs-number">500</span>,
  <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>,
  <span class="hljs-attr">buffer</span>: <span class="hljs-number">2</span>
};

<span class="hljs-comment">// DOM引用</span>
<span class="hljs-keyword">const</span> containerRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
<span class="hljs-comment">// 响应式数据</span>
<span class="hljs-keyword">const</span> totalData = <span class="hljs-title function_">ref</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">100000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: i, <span class="hljs-attr">content</span>: <span class="hljs-string">`列表项 <span class="hljs-subst">${i+<span class="hljs-number">1</span>}</span>`</span> })));
<span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// 计算属性：总高度</span>
<span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> totalData.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> * config.<span class="hljs-property">itemHeight</span>);
<span class="hljs-comment">// 计算属性：可视项相关</span>
<span class="hljs-keyword">const</span> visibleData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(config.<span class="hljs-property">viewHeight</span> / config.<span class="hljs-property">itemHeight</span>) + config.<span class="hljs-property">buffer</span>;
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / config.<span class="hljs-property">itemHeight</span>));
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(totalData.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>, startIndex + visibleCount);
  <span class="hljs-keyword">return</span> totalData.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(startIndex, endIndex + <span class="hljs-number">1</span>);
});
<span class="hljs-comment">// 计算属性：可视项偏移</span>
<span class="hljs-keyword">const</span> offsetTop = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / config.<span class="hljs-property">itemHeight</span>));
  <span class="hljs-keyword">return</span> startIndex * config.<span class="hljs-property">itemHeight</span>;
});

<span class="hljs-comment">// 滚动事件处理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (containerRef.<span class="hljs-property">value</span>) {
    scrollTop.<span class="hljs-property">value</span> = containerRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span>;
  }
};

<span class="hljs-comment">// 初始化</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 防抖优化（可选）</span>
  <span class="hljs-keyword">const</span> debouncedHandleScroll = <span class="hljs-title function_">debounce</span>(handleScroll, <span class="hljs-number">16</span>);
  containerRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, debouncedHandleScroll);
});

<span class="hljs-comment">// 防抖函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay = <span class="hljs-number">16</span></span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timer);
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args), delay);
  };
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.virtual-list-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e6e6e6</span>;
  <span class="hljs-attribute">overflow</span>: auto;
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.virtual-list-placeholder</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-class">.virtual-list-items</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-class">.list-item</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-17">五、常见问题与避坑指南</h2>
<h3 data-id="heading-18">1. 滚动时出现空白</h3>
<ul>
<li>
<p><strong>原因</strong>：缓冲项不足、滚动防抖延迟过高、动态高度预估偏差；</p>
</li>
<li>
<p><strong>解决方案</strong>：</p>
<ul>
<li>增加缓冲项数量（如从 2 增至 5）；</li>
<li>降低防抖延迟（如 16ms，对应 60fps）；</li>
<li>动态高度场景下提前渲染更多缓冲项。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-19">2. 滚动条抖动</h3>
<ul>
<li>
<p><strong>原因</strong>：动态高度场景下，真实高度与预估高度偏差导致总高度频繁变化；</p>
</li>
<li>
<p><strong>解决方案</strong>：</p>
<ul>
<li>初始化时尽可能精准预估高度；</li>
<li>批量更新总高度（而非每次渲染都更新）；</li>
<li>限制总高度的更新频率。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">3. 大数据初始化卡顿</h3>
<ul>
<li>
<p><strong>原因</strong>：初始渲染时计算累计高度遍历全量数据；</p>
</li>
<li>
<p><strong>解决方案</strong>：</p>
<ul>
<li>分段初始化（先渲染前 100 项，后续滚动时再计算）；</li>
<li>使用 Web Worker 计算累计高度（避免阻塞主线程）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-21">4. 移动端滚动不流畅</h3>
<ul>
<li>
<p><strong>原因</strong>：移动端滚动有惯性，scroll 事件触发更频繁；</p>
</li>
<li>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用<code>passive: true</code>优化滚动事件（避免浏览器阻塞默认行为）：</li>
<li>开启硬件加速（<code>transform: translateZ(0)</code>）：</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js" lang="js">container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, debouncedHandleScroll, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
</code></pre>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">virtual</span>-list-items { <span class="hljs-attr">transform</span>: <span class="hljs-title function_">translateZ</span>(<span class="hljs-number">0</span>); }
</code></pre>
<h2 data-id="heading-22">六、总结</h2>
<p>虚拟列表的核心是「空间换时间」：用「占位容器 + 可视项容器」的 DOM 结构，换取「仅渲染可视区域 DOM」的性能提升。核心知识点可归纳为：</p>
<ol>
<li><strong>核心原理</strong>：可视区域计算 + 数据截取 + 偏移定位；</li>
<li><strong>性能优化</strong>：防抖、DOM 复用、缓冲项、硬件加速；</li>
<li><strong>适配场景</strong>：固定高度（简单）、动态高度（复杂）、加载更多（业务常用）；</li>
<li><strong>框架适配</strong>：利用响应式数据封装计算属性，简化滚动状态管理。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis常见问题排查手册]]></title>    <link>https://juejin.cn/post/7591670569910140974</link>    <guid>https://juejin.cn/post/7591670569910140974</guid>    <pubDate>2026-01-05T07:28:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591670569910140974" data-draft-id="7591635567588409390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Redis常见问题排查手册"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-05T07:28:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘻哈baby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Redis常见问题排查手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘻哈baby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:28:52.000Z" title="Mon Jan 05 2026 07:28:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Redis用着用着总会遇到各种问题：连接超时、内存暴涨、主从不同步、缓存雪崩...</p>
<p>这篇整理Redis常见问题的排查思路和解决方案，线上出问题时能快速定位。</p>
<hr/>
<h2 data-id="heading-1">一、连接问题</h2>
<h3 data-id="heading-2">1.1 连接超时</h3>
<p><strong>现象</strong>：客户端报<code>Connection timed out</code>或<code>JedisConnectionException</code></p>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查Redis是否存活</span>
redis-cli ping

<span class="hljs-comment"># 2. 检查端口是否监听</span>
ss -tlnp | grep 6379

<span class="hljs-comment"># 3. 检查连接数</span>
redis-cli info clients
<span class="hljs-comment"># connected_clients:150  ← 当前连接数</span>

<span class="hljs-comment"># 4. 查看最大连接数配置</span>
redis-cli config get maxclients
<span class="hljs-comment"># maxclients: 10000</span>

<span class="hljs-comment"># 5. 检查是否有慢查询阻塞</span>
redis-cli slowlog get 10
</code></pre>
<p><strong>常见原因</strong>：</p>
<ol>
<li><strong>连接数打满</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看客户端列表</span>
redis-cli client list

<span class="hljs-comment"># 找到空闲时间长的连接</span>
redis-cli client list | awk -F<span class="hljs-string">'[ =]'</span> <span class="hljs-string">'{print $4, $10}'</span> | <span class="hljs-built_in">sort</span> -k2 -rn | <span class="hljs-built_in">head</span>
</code></pre>
<p>解决：增大maxclients，或检查客户端连接池配置。</p>
<ol start="2">
<li><strong>网络问题</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试网络延迟</span>
redis-cli --latency

<span class="hljs-comment"># 持续监控</span>
redis-cli --latency-history
</code></pre>
<ol start="3">
<li><strong>Redis阻塞</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查阻塞操作</span>
redis-cli info stats | grep blocked
</code></pre>
<h3 data-id="heading-3">1.2 连接被拒绝</h3>
<p><strong>现象</strong>：<code>Connection refused</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查绑定地址</span>
redis-cli config get <span class="hljs-built_in">bind</span>
<span class="hljs-comment"># 如果是 127.0.0.1，远程无法连接</span>

<span class="hljs-comment"># 修改配置</span>
<span class="hljs-comment"># /etc/redis/redis.conf</span>
<span class="hljs-built_in">bind</span> 0.0.0.0  <span class="hljs-comment"># 或具体IP</span>

<span class="hljs-comment"># 检查防火墙</span>
iptables -L -n | grep 6379
firewall-cmd --list-ports | grep 6379
</code></pre>
<hr/>
<h2 data-id="heading-4">二、内存问题</h2>
<h3 data-id="heading-5">2.1 内存暴涨</h3>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看内存使用</span>
redis-cli info memory
<span class="hljs-comment"># used_memory_human: 2.5G</span>
<span class="hljs-comment"># used_memory_peak_human: 3.1G</span>
<span class="hljs-comment"># maxmemory_human: 4G</span>

<span class="hljs-comment"># 2. 查看各类型key的内存占用</span>
redis-cli memory doctor

<span class="hljs-comment"># 3. 分析大key</span>
redis-cli --bigkeys

<span class="hljs-comment"># 4. 扫描特定前缀的key数量</span>
redis-cli keys <span class="hljs-string">"user:*"</span> | <span class="hljs-built_in">wc</span> -l
<span class="hljs-comment"># 注意：生产环境用 scan 代替 keys</span>
redis-cli scan 0 match <span class="hljs-string">"user:*"</span> count 1000
</code></pre>
<p><strong>找出大key</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分析RDB文件（推荐）</span>
<span class="hljs-comment"># 安装 rdb-tools</span>
pip install rdbtools python-lzf

<span class="hljs-comment"># 导出大key报告</span>
rdb -c memory /var/lib/redis/dump.rdb --bytes 10240 -f memory.csv
</code></pre>
<p>或者用Redis自带命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看某个key的内存占用</span>
redis-cli memory usage mykey

<span class="hljs-comment"># 批量分析</span>
redis-cli --bigkeys -i 0.1  <span class="hljs-comment"># 每100ms扫描一次，降低影响</span>
</code></pre>
<h3 data-id="heading-6">2.2 内存淘汰</h3>
<p><strong>现象</strong>：写入失败，报<code>OOM command not allowed</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看淘汰策略</span>
redis-cli config get maxmemory-policy
<span class="hljs-comment"># volatile-lru / allkeys-lru / noeviction 等</span>

<span class="hljs-comment"># 查看淘汰统计</span>
redis-cli info stats | grep evicted
<span class="hljs-comment"># evicted_keys: 12345</span>
</code></pre>
<p><strong>淘汰策略说明</strong>：</p>

































<table><thead><tr><th>策略</th><th>说明</th></tr></thead><tbody><tr><td>noeviction</td><td>不淘汰，内存满了报错</td></tr><tr><td>volatile-lru</td><td>淘汰有过期时间的key（LRU）</td></tr><tr><td>allkeys-lru</td><td>淘汰所有key（LRU）</td></tr><tr><td>volatile-ttl</td><td>淘汰TTL最短的key</td></tr><tr><td>volatile-random</td><td>随机淘汰有过期时间的key</td></tr><tr><td>allkeys-random</td><td>随机淘汰</td></tr></tbody></table>
<p><strong>建议配置</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># redis.conf</span>
maxmemory 4gb
maxmemory-policy allkeys-lru
</code></pre>
<h3 data-id="heading-7">2.3 内存碎片</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看碎片率</span>
redis-cli info memory | grep mem_fragmentation_ratio
<span class="hljs-comment"># mem_fragmentation_ratio: 1.52</span>

<span class="hljs-comment"># 大于1.5说明碎片较多</span>
</code></pre>
<p>解决方案：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Redis 4.0+ 支持在线碎片整理</span>
redis-cli config <span class="hljs-built_in">set</span> activedefrag <span class="hljs-built_in">yes</span>

<span class="hljs-comment"># 或者重启Redis</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">三、主从问题</h2>
<h3 data-id="heading-9">3.1 主从不同步</h3>
<p><strong>现象</strong>：从库数据和主库不一致</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看复制状态</span>
redis-cli info replication

<span class="hljs-comment"># 主库显示</span>
role:master
connected_slaves:1
slave0:ip=192.168.1.2,port=6379,state=online,offset=123456,lag=0

<span class="hljs-comment"># 从库显示</span>
role:slave
master_link_status:up
master_last_io_seconds_ago:1
master_sync_in_progress:0
</code></pre>
<p><strong>关键指标</strong>：</p>
<ul>
<li><code>master_link_status</code>：up正常，down断开</li>
<li><code>master_last_io_seconds_ago</code>：与主库最后通信时间</li>
<li><code>lag</code>：复制延迟</li>
</ul>
<p><strong>常见原因</strong>：</p>
<ol>
<li><strong>网络问题</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从库上检查</span>
redis-cli info replication | grep master_link_down_since_seconds
</code></pre>
<ol start="2">
<li><strong>复制缓冲区溢出</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 主库配置</span>
redis-cli config get repl-backlog-size
<span class="hljs-comment"># 默认1MB，高并发写入需要调大</span>

<span class="hljs-comment"># 建议配置</span>
repl-backlog-size 256mb
</code></pre>
<ol start="3">
<li><strong>从库复制超时</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查超时配置</span>
redis-cli config get repl-timeout
<span class="hljs-comment"># 默认60秒</span>

<span class="hljs-comment"># 大数据量同步可能需要调大</span>
repl-timeout 300
</code></pre>
<h3 data-id="heading-10">3.2 主从切换后数据丢失</h3>
<p><strong>原因</strong>：异步复制导致主库写入未同步到从库就宕机了</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置最少从库数量</span>
min-replicas-to-write 1
min-replicas-max-lag 10

<span class="hljs-comment"># 含义：至少1个从库延迟不超过10秒，否则主库拒绝写入</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">四、性能问题</h2>
<h3 data-id="heading-12">4.1 慢查询</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看慢查询日志</span>
redis-cli slowlog get 10

<span class="hljs-comment"># 输出示例</span>
1) 1) (<span class="hljs-built_in">integer</span>) 123          <span class="hljs-comment"># ID</span>
   2) (<span class="hljs-built_in">integer</span>) 1609459200   <span class="hljs-comment"># 时间戳</span>
   3) (<span class="hljs-built_in">integer</span>) 15000        <span class="hljs-comment"># 耗时（微秒）</span>
   4) 1) <span class="hljs-string">"keys"</span>              <span class="hljs-comment"># 命令</span>
      2) <span class="hljs-string">"*"</span>

<span class="hljs-comment"># 配置慢查询阈值（微秒）</span>
redis-cli config <span class="hljs-built_in">set</span> slowlog-log-slower-than 10000  <span class="hljs-comment"># 10ms</span>
redis-cli config <span class="hljs-built_in">set</span> slowlog-max-len 1000
</code></pre>
<p><strong>常见慢操作</strong>：</p>



































<table><thead><tr><th>命令</th><th>问题</th><th>替代方案</th></tr></thead><tbody><tr><td>keys *</td><td>全库扫描</td><td>scan</td></tr><tr><td>hgetall</td><td>大hash</td><td>hscan / 只取需要的字段</td></tr><tr><td>smembers</td><td>大set</td><td>sscan</td></tr><tr><td>lrange 0 -1</td><td>大list</td><td>分页获取</td></tr><tr><td>del bigkey</td><td>阻塞删除</td><td>unlink（异步删除）</td></tr></tbody></table>
<h3 data-id="heading-13">4.2 热点key</h3>
<p><strong>现象</strong>：QPS很高但集群负载不均</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启热点key统计（Redis 4.0+）</span>
redis-cli --hotkeys

<span class="hljs-comment"># 或者用monitor采样（生产慎用）</span>
redis-cli monitor | <span class="hljs-built_in">head</span> -10000 &gt; monitor.log
awk <span class="hljs-string">'{print $4}'</span> monitor.log | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -rn | <span class="hljs-built_in">head</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<ol>
<li><strong>本地缓存</strong>：热点数据在应用层缓存</li>
<li><strong>读写分离</strong>：读请求分散到从库</li>
<li><strong>key拆分</strong>：<code>hotkey</code> → <code>hotkey:1</code>, <code>hotkey:2</code>...</li>
</ol>
<h3 data-id="heading-14">4.3 大key删除阻塞</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看key元素数量</span>
redis-cli llen mylist
redis-cli hlen myhash
redis-cli scard myset

<span class="hljs-comment"># 异步删除（Redis 4.0+）</span>
redis-cli <span class="hljs-built_in">unlink</span> bigkey

<span class="hljs-comment"># 或者分批删除</span>
<span class="hljs-comment"># Hash</span>
redis-cli hscan myhash 0 count 100
<span class="hljs-comment"># 然后 hdel 分批删</span>

<span class="hljs-comment"># List</span>
redis-cli ltrim mylist 0 -1001  <span class="hljs-comment"># 每次删1000个</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">五、持久化问题</h2>
<h3 data-id="heading-16">5.1 RDB持久化失败</h3>
<p><strong>现象</strong>：日志报<code>Background saving error</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看最近一次持久化状态</span>
redis-cli info persistence
<span class="hljs-comment"># rdb_last_bgsave_status: ok/err</span>
<span class="hljs-comment"># rdb_last_bgsave_time_sec: 5</span>

<span class="hljs-comment"># 查看日志</span>
<span class="hljs-built_in">tail</span> -100 /var/log/redis/redis-server.log
</code></pre>
<p><strong>常见原因</strong>：</p>
<ol>
<li><strong>磁盘空间不足</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">df</span> -h
</code></pre>
<ol start="2">
<li><strong>fork失败（内存不足）</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查overcommit配置</span>
<span class="hljs-built_in">cat</span> /proc/sys/vm/overcommit_memory
<span class="hljs-comment"># 0: 默认，可能导致fork失败</span>
<span class="hljs-comment"># 1: 允许overcommit</span>

<span class="hljs-comment"># 修改</span>
<span class="hljs-built_in">echo</span> 1 &gt; /proc/sys/vm/overcommit_memory
<span class="hljs-comment"># 或永久修改 /etc/sysctl.conf</span>
vm.overcommit_memory = 1
</code></pre>
<ol start="3">
<li><strong>透明大页导致延迟</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 禁用透明大页</span>
<span class="hljs-built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre>
<h3 data-id="heading-17">5.2 AOF重写阻塞</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看AOF状态</span>
redis-cli info persistence | grep aof

<span class="hljs-comment"># 手动触发重写</span>
redis-cli bgrewriteaof

<span class="hljs-comment"># 配置自动重写</span>
auto-aof-rewrite-percentage 100  <span class="hljs-comment"># 增长100%触发</span>
auto-aof-rewrite-min-size 64mb   <span class="hljs-comment"># 最小64MB才触发</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">六、集群问题</h2>
<h3 data-id="heading-19">6.1 集群状态异常</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看集群状态</span>
redis-cli cluster info
<span class="hljs-comment"># cluster_state:ok/fail</span>
<span class="hljs-comment"># cluster_slots_assigned:16384</span>
<span class="hljs-comment"># cluster_slots_ok:16384</span>
<span class="hljs-comment"># cluster_slots_fail:0</span>

<span class="hljs-comment"># 查看节点</span>
redis-cli cluster nodes
</code></pre>
<p><strong>常见问题</strong>：</p>
<ol>
<li><strong>slot未分配</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查slot覆盖</span>
redis-cli cluster slots

<span class="hljs-comment"># 手动分配</span>
redis-cli cluster addslots 0 1 2 ...
</code></pre>
<ol start="2">
<li><strong>节点故障</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看失败节点</span>
redis-cli cluster nodes | grep fail

<span class="hljs-comment"># 手动故障转移</span>
redis-cli cluster failover
</code></pre>
<h3 data-id="heading-20">6.2 MOVED/ASK错误</h3>
<p>客户端报<code>MOVED</code>或<code>ASK</code>错误，说明请求到了错误的节点。</p>
<p><strong>解决</strong>：使用集群模式的客户端</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 命令行用-c参数</span>
redis-cli -c -h host -p port

<span class="hljs-comment"># 客户端库要用cluster模式</span>
<span class="hljs-comment"># Java: JedisCluster</span>
<span class="hljs-comment"># Python: redis-py-cluster</span>
</code></pre>
<h3 data-id="heading-21">6.3 跨机房/跨网络访问</h3>
<p>多个机房部署的Redis需要互通，或者本地开发需要连远程Redis。</p>
<p><strong>方案1：SSH隧道</strong></p>
<pre><code class="hljs language-bash" lang="bash">ssh -L 6379:redis-server:6379 user@跳板机 -N
redis-cli -h 127.0.0.1
</code></pre>
<p><strong>方案2：VPN/组网</strong></p>
<p>如果经常需要访问多个内网Redis，用组网工具更方便。WireGuard、ZeroTier、星空组网这类工具配置一次，后续直接用内网IP访问，不用每次建隧道。</p>
<hr/>
<h2 data-id="heading-22">七、快速诊断脚本</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># redis_check.sh</span>

REDIS_CLI=<span class="hljs-string">"redis-cli"</span>
HOST=<span class="hljs-variable">${1:-127.0.0.1}</span>
PORT=<span class="hljs-variable">${2:-6379}</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Redis诊断 <span class="hljs-variable">$HOST</span>:<span class="hljs-variable">$PORT</span> ==="</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[1] 连通性"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> ping

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[2] 内存使用"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> info memory | grep -E <span class="hljs-string">"used_memory_human|maxmemory_human|mem_fragmentation_ratio"</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[3] 连接数"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> info clients | grep connected_clients

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[4] 复制状态"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> info replication | grep -E <span class="hljs-string">"role|master_link_status|connected_slaves"</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[5] 持久化"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> info persistence | grep -E <span class="hljs-string">"rdb_last_bgsave_status|aof_enabled"</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[6] 慢查询（最近5条）"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> slowlog get 5

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[7] Key数量"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> dbsize

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n[8] QPS"</span>
<span class="hljs-variable">$REDIS_CLI</span> -h <span class="hljs-variable">$HOST</span> -p <span class="hljs-variable">$PORT</span> info stats | grep instantaneous_ops_per_sec

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== 诊断完成 ==="</span>
</code></pre>
<hr/>
<h2 data-id="heading-23">总结</h2>
<p>Redis问题排查思路：</p>








































<table><thead><tr><th>问题类型</th><th>排查命令</th><th>关键指标</th></tr></thead><tbody><tr><td>连接问题</td><td>info clients</td><td>connected_clients</td></tr><tr><td>内存问题</td><td>info memory</td><td>used_memory, fragmentation</td></tr><tr><td>主从问题</td><td>info replication</td><td>master_link_status, lag</td></tr><tr><td>性能问题</td><td>slowlog get</td><td>慢查询命令</td></tr><tr><td>持久化</td><td>info persistence</td><td>rdb/aof状态</td></tr><tr><td>集群问题</td><td>cluster info</td><td>cluster_state</td></tr></tbody></table>
<p>核心命令：</p>
<pre><code class="hljs language-bash" lang="bash">redis-cli info          <span class="hljs-comment"># 整体状态</span>
redis-cli info memory   <span class="hljs-comment"># 内存</span>
redis-cli info clients  <span class="hljs-comment"># 连接</span>
redis-cli info replication  <span class="hljs-comment"># 主从</span>
redis-cli slowlog get 10    <span class="hljs-comment"># 慢查询</span>
redis-cli --bigkeys     <span class="hljs-comment"># 大key分析</span>
redis-cli monitor       <span class="hljs-comment"># 实时命令监控（慎用）</span>
</code></pre>
<p>遇到问题先看<code>info</code>，90%的问题都能从这里找到线索。</p>
<hr/>
<p>有问题评论区交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 KuiklyUI Canvas 打造天气预测图表]]></title>    <link>https://juejin.cn/post/7591544356000661514</link>    <guid>https://juejin.cn/post/7591544356000661514</guid>    <pubDate>2026-01-05T04:06:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591544356000661514" data-draft-id="7591403124327039039" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 KuiklyUI Canvas 打造天气预测图表"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-05T04:06:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我有与与症"/> <meta itemprop="url" content="https://juejin.cn/user/4466629837071787"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 KuiklyUI Canvas 打造天气预测图表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466629837071787/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我有与与症
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T04:06:55.000Z" title="Mon Jan 05 2026 04:06:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent-TDS%2FKuiklyUI%2Ftree%2Fmain%2Fdemo%2Fsrc%2FcommonMain%2Fkotlin%2Fcom%2Ftencent%2Fkuikly%2Fdemo%2Fpages%2FWeatherCanvasPage.kt" target="_blank" title="https://github.com/Tencent-TDS/KuiklyUI/tree/main/demo/src/commonMain/kotlin/com/tencent/kuikly/demo/pages/WeatherCanvasPage.kt" ref="nofollow noopener noreferrer">GitHub</a></p>
<p>从最早的 Android 入门教程，到 iOS SwiftUI 官方示例，再到 React、Flutter、鸿蒙... 天气应用几乎是所有 UI 框架的"Hello World Plus"——它足够简单，能让你快速上手；又足够丰富，涵盖了数据展示、图表绑定等核心技能。</p>
<p>今天，我们用 Kuikly 来完成这个demo：<strong>用一套 Kotlin 代码，画一个能在 Android、iOS、鸿蒙三端运行的雨量预测图表</strong>。</p>
<p>别担心，这篇文章专门为新手准备，我们会从最基础的概念讲起。准备好了吗？Let's go！</p>
<h2 data-id="heading-0">我们要做什么？</h2>
<p>先看看最终效果：一张带毛玻璃效果的卡片，上面有一条蓝色的曲线，展示未来 90 分钟的雨量变化。左边是雨量等级（暴雨、大雨、中雨、小雨），底部是时间轴（现在、30分钟、60分钟、90分钟）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c68b1f0aa84d8ca10c0cbe4dc07e15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5pyJ5LiO5LiO55eH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768190816&amp;x-signature=lpiki8bpadK%2BWe4vRMHG%2BlBULh4%3D" alt="image.png" loading="lazy"/></p>
<p>是不是很眼熟？没错，这就是各大天气 App 里那个"分钟级降水预报"的同款！</p>
<h2 data-id="heading-1">第一步：搭建页面骨架</h2>
<p>在 Kuikly 中，一个页面就是一个继承自 <code>BasePager</code> 的类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Page(<span class="hljs-string">"WeatherCanvasPage"</span>)</span>  <span class="hljs-comment">// 给页面取个名字，用于路由跳转</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherCanvasPage</span> : <span class="hljs-type">BasePager</span>() {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">()</span></span>: ViewBuilder {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">// 页面内容写在这里</span>
        }
    }
}
</code></pre>
<p><strong>tips</strong>：</p>
<ul>
<li>
<p><code>@Page("xxx")</code> 就像给页面起了个门牌号</p>
</li>
<li>
<p><code>body()</code> 方法返回页面的 UI 结构，所有组件都写在大括号里</p>
</li>
</ul>
<h2 data-id="heading-2">第二步：铺一张好看的背景图</h2>
<p>天气应用嘛，氛围感很重要！</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">()</span></span>: ViewBuilder {
    <span class="hljs-keyword">return</span> {
        attr {
            flex(<span class="hljs-number">1f</span>)  <span class="hljs-comment">// flex 弹性布局</span>
            backgroundColor(Color(<span class="hljs-number">0x436082</span>, <span class="hljs-number">1f</span>))  <span class="hljs-comment">// 蓝灰色底色</span>
        }

        <span class="hljs-comment">// 背景图</span>
        Image {
            attr {
                src(<span class="hljs-string">"https://qq-weather.cdn-go.cn/weather/latest/rain-bg/rain-comming.png"</span>)
                positionAbsolute()  <span class="hljs-comment">// 绝对定位</span>
                left(<span class="hljs-number">0f</span>); right(<span class="hljs-number">0f</span>); top(<span class="hljs-number">0f</span>); bottom(<span class="hljs-number">0f</span>)  <span class="hljs-comment">// 铺满全屏</span>
            }
        }
    }
}
</code></pre>
<p><strong>tips</strong>：</p>
<ul>
<li>
<p><code>attr { }</code> 用来设置组件样式，类似 CSS</p>
</li>
<li>
<p><code>positionAbsolute()</code> + 四边为 0 = 铺满父容器</p>
</li>
</ul>
<h2 data-id="heading-3">第三步：自定义组件</h2>
<p>接下来我们要添加图表卡片。但 <code>RainFallNodeCanvas</code> 不是内置组件，而是我们自己造的！</p>
<p>这就是 Kuikly 的魅力：<strong>把复杂 UI 封装成可复用的积木块</strong>。</p>
<p>一个自定义组件需要三样东西：</p>





















<table><thead><tr><th>组成部分</th><th>作用</th></tr></thead><tbody><tr><td>属性类 (Attr)</td><td>定义组件接收什么数据</td></tr><tr><td>组件类 (ComposeView)</td><td>定义组件长什么样</td></tr><tr><td>扩展函数</td><td>让组件用起来更顺手</td></tr></tbody></table>
<h3 data-id="heading-4">3.1 定义属性：这个组件需要什么数据？</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RainFallNodeAttr</span> : <span class="hljs-type">ComposeAttr</span>() {
    <span class="hljs-comment">// 雨量数据：24个点，代表未来90分钟的降水量</span>
    <span class="hljs-keyword">var</span> nodes: List&lt;<span class="hljs-built_in">Float</span>&gt; <span class="hljs-keyword">by</span> observable(
        listOf(<span class="hljs-number">1.3f</span>, <span class="hljs-number">2.6f</span>, <span class="hljs-number">4.2f</span>, <span class="hljs-number">5.1f</span>, <span class="hljs-number">3.5f</span>, ...)
    )
    
    <span class="hljs-comment">// 顶部提示文字</span>
    <span class="hljs-keyword">var</span> title: String <span class="hljs-keyword">by</span> observable(<span class="hljs-string">"雨渐大，30分钟后雨会停"</span>)
    
    <span class="hljs-comment">// Y轴标签</span>
    <span class="hljs-keyword">var</span> rainLevel1Title: String <span class="hljs-keyword">by</span> observable(<span class="hljs-string">"暴雨"</span>)
    <span class="hljs-keyword">var</span> rainLevel2Title: String <span class="hljs-keyword">by</span> observable(<span class="hljs-string">"大雨"</span>)
    <span class="hljs-keyword">var</span> rainLevel3Title: String <span class="hljs-keyword">by</span> observable(<span class="hljs-string">"中雨"</span>)
    <span class="hljs-keyword">var</span> rainLevel4Title: String <span class="hljs-keyword">by</span> observable(<span class="hljs-string">"小雨"</span>)
}
</code></pre>
<p><strong>划重点</strong>：<code>by observable(...)</code> 是 Kuikly 的响应式魔法！数据一变，UI 自动刷新，不用手动调用任何刷新方法。</p>
<h3 data-id="heading-5">3.2 定义组件：它长什么样？</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherRainFallNodeCanvas</span> : <span class="hljs-type">ComposeView</span>&lt;<span class="hljs-type">RainFallNodeAttr, ComposeEvent</span>&gt;() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> nodeAttr = RainFallNodeAttr()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">()</span></span>: ViewBuilder {
        <span class="hljs-keyword">val</span> ctx = <span class="hljs-keyword">this</span>
        <span class="hljs-keyword">return</span> {
            attr {
                size(<span class="hljs-number">335f</span>, <span class="hljs-number">250f</span>)  <span class="hljs-comment">// 卡片大小</span>
                borderRadius(BorderRectRadius(<span class="hljs-number">16f</span>, <span class="hljs-number">16f</span>, <span class="hljs-number">16f</span>, <span class="hljs-number">16f</span>))  <span class="hljs-comment">// 圆角</span>
            }

            <span class="hljs-comment">// 1. 毛玻璃背景</span>
            Blur {
                attr {
                    absolutePosition(<span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">0f</span>)
                    blurRadius(<span class="hljs-number">10.0f</span>)
                }
            }

            <span class="hljs-comment">// 2. 顶部提示文字</span>
            Text { attr { text(ctx.nodeAttr.title) } }

            <span class="hljs-comment">// 3. Canvas 画布（核心！）</span>
            Canvas({ ... }) { context, width, height -&gt;
                <span class="hljs-comment">// 在这里画曲线</span>
            }

            <span class="hljs-comment">// 4. Y轴标签：暴雨、大雨...</span>
            <span class="hljs-comment">// 5. X轴标签：现在、30分钟...</span>
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createAttr</span><span class="hljs-params">()</span></span> = nodeAttr
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createEvent</span><span class="hljs-params">()</span></span> = ComposeEvent()
}
</code></pre>
<h2 data-id="heading-6">第四步：用 Canvas 画曲线（核心！）</h2>
<p>Canvas 就是一块"画布"，你可以在上面画任何东西。</p>
<h3 data-id="heading-7">4.1 Canvas 基本用法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">Canvas(
    { attr { absolutePosition(<span class="hljs-number">55f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">24f</span>, <span class="hljs-number">0f</span>) } }
) { context, width, height -&gt;
    <span class="hljs-comment">// context = 画笔</span>
    <span class="hljs-comment">// width, height = 画布尺寸</span>
}
</code></pre>
<h3 data-id="heading-8">4.2 画一条丝滑的曲线</h3>
<p>直接用直线连接数据点会很丑（像心电图），我们用<strong>贝塞尔曲线</strong>让它丝滑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 设置画笔</span>
context.beginPath()
context.strokeStyle(Color(<span class="hljs-number">0x0085FF</span>, <span class="hljs-number">1f</span>))  <span class="hljs-comment">// 天空蓝</span>
context.lineWidth(<span class="hljs-number">5.0f</span>)                    <span class="hljs-comment">// 线条粗细</span>
context.lineCapRound()                     <span class="hljs-comment">// 圆头端点</span>
context.moveTo(<span class="hljs-number">0f</span>, height)                 <span class="hljs-comment">// 起点：左下角</span>

<span class="hljs-comment">// 2. 遍历数据点，画曲线</span>
<span class="hljs-keyword">for</span> ((index, node) <span class="hljs-keyword">in</span> nodeAttr.nodes.withIndex()) {
    <span class="hljs-keyword">val</span> x = index * width / <span class="hljs-number">24</span>                  <span class="hljs-comment">// X坐标</span>
    <span class="hljs-keyword">val</span> y = height - node * height / <span class="hljs-number">10</span>         <span class="hljs-comment">// Y坐标（数据映射）</span>
    
    <span class="hljs-comment">// 用贝塞尔曲线连接，比直线更丝滑</span>
    context.quadraticCurveTo(controlX, controlY, nextX, nextY)
}

<span class="hljs-comment">// 3. 完成绑定</span>
context.stroke()
</code></pre>
<p><strong>什么是贝塞尔曲线？</strong> 简单说：</p>
<ul>
<li>
<p>直线：A → B，走直线</p>
</li>
<li>
<p>贝塞尔：A → B，但要"绕过"控制点 C，形成弧线</p>
</li>
</ul>
<h3 data-id="heading-9">4.3 画虚线（参考线）</h3>
<p>没有虚线 API？没关系，手搓一个：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">renderDashLine</span><span class="hljs-params">(context: <span class="hljs-type">CanvasContext</span>, width: <span class="hljs-type">Float</span>, y: <span class="hljs-type">Float</span>)</span></span> {
    context.beginPath()
    context.strokeStyle(Color(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.2f</span>))  <span class="hljs-comment">// 半透明白</span>
    
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">10f</span>
    <span class="hljs-keyword">while</span> (x &lt; width) {
        context.lineTo(x + <span class="hljs-number">5f</span>, y)   <span class="hljs-comment">// 画 5 像素</span>
        x += <span class="hljs-number">7.5f</span>
        context.moveTo(x, y)        <span class="hljs-comment">// 跳过 2.5 像素</span>
    }
    context.stroke()
}
</code></pre>
<p>原理：画一段、跳一段、画一段、跳一段...</p>
<h2 data-id="heading-10">第五步：让组件更好用</h2>
<p>写个扩展函数，让自定义组件用起来和内置组件一样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> ViewContainer<span class="hljs-type">&lt;*, *&gt;</span>.<span class="hljs-title">RainFallNodeCanvas</span><span class="hljs-params">(
    <span class="hljs-keyword">init</span>: <span class="hljs-type">WeatherRainFallNodeCanvas</span>.() -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    addChild(WeatherRainFallNodeCanvas(), <span class="hljs-keyword">init</span>)
}
</code></pre>
<p>现在可以这样用了：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">RainFallNodeCanvas {
    attr {
        positionAbsolute()
        top(<span class="hljs-number">178.5f</span>)
        left(<span class="hljs-number">20f</span>)
    }
}
</code></pre>
<p>和 <code>Text</code>、<code>Image</code> 一模一样的写法！</p>
<h2 data-id="heading-11">总结</h2>
<p>恭喜完成 Kuikly "天气App"！回顾一下核心技能：</p>





































<table><thead><tr><th>技能</th><th>总结</th></tr></thead><tbody><tr><td>页面定义</td><td>继承 <code>BasePager</code> + <code>@Page</code> 注解</td></tr><tr><td>布局系统</td><td><code>attr { }</code> 设样式，<code>positionAbsolute()</code> 绝对定位</td></tr><tr><td>自定义组件</td><td>继承 <code>ComposeView</code>，定义 Attr + body()</td></tr><tr><td>响应式数据</td><td><code>by observable()</code> 数据变 → UI 自动刷新</td></tr><tr><td>Canvas bindbindbindbindbindbindbindind</td><td>回调式 API，拿到 context 就能画</td></tr><tr><td>贝塞尔曲线</td><td><code>quadraticCurveTo()</code> 让曲线更丝滑</td></tr><tr><td>毛玻璃效果</td><td><code>Blur</code> 组件一行搞定</td></tr></tbody></table>
<p>下次产品经理甩给你"参考天气 App 做个图表"的需求，你就可以自信地说：<strong>小场面！</strong></p>
<p>代码已经躺在 GitHub 上了，还不快去 Clone 下来跑一跑？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【车载Android】多媒体开发入门（上） - MediaSession]]></title>    <link>https://juejin.cn/post/7591407298414247942</link>    <guid>https://juejin.cn/post/7591407298414247942</guid>    <pubDate>2026-01-05T04:48:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591407298414247942" data-draft-id="7591334602427318335" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【车载Android】多媒体开发入门（上） - MediaSession"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2026-01-05T04:48:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林栩link"/> <meta itemprop="url" content="https://juejin.cn/user/870468939434039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【车载Android】多媒体开发入门（上） - MediaSession
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468939434039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林栩link
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T04:48:58.000Z" title="Mon Jan 05 2026 04:48:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>随着车载 Android 生态的成熟，多媒体已从独立的 App 演变为一项全局协同的服务，需实时联动桌面卡片、控制中心及语音助手，以实现无缝流转与智能交互。</p>
<p>在这套复杂的交互体系下，<strong>MediaSession</strong> 是 Android 媒体框架中连接播放端与控制端的核心组件。它是确保跨进程状态同步、响应全局指令的基石。本文将结合具体开发实践，探讨 MediaSession 在车载开发中的核心应用。</p>
<h2 data-id="heading-0">一、为什么必须用 MediaSession？</h2>
<p>你可能有这样一个问题，为什么多媒体开发建议使用<code>MediaSession</code>？很简单，如果不使用<code>MediaSession</code>，你会失去：</p>
<ul>
<li>锁屏播放控件</li>
<li>通知栏媒体通知（新版强制要求 MediaStyle + MediaSession）</li>
<li>耳机/蓝牙媒体键控制（播放、暂停、切歌）</li>
<li>Android Auto / Car App 支持</li>
<li>Wear OS 手表控制</li>
<li>Google Assistant 语音控制（如“嘿 Google，播放下一首”）</li>
<li>系统音量键独立控制媒体音量</li>
<li>PiP（画中画）视频控件联动</li>
</ul>
<p>一句话，如果你做音视频播放，不用 <code>MediaSession</code> 就等于放弃了 80% 的系统集成能力。</p>
<p>本文基于 Media3 框架编写，使用的类库如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">media3</span> = <span class="hljs-string">"1.8.0"</span>

<span class="hljs-attr">media3-exoplayer</span> = { group = <span class="hljs-string">"androidx.media3"</span>, name = <span class="hljs-string">"media3-exoplayer"</span>, version.ref = <span class="hljs-string">"media3"</span> }

<span class="hljs-attr">media3-ui</span> = { group = <span class="hljs-string">"androidx.media3"</span>, name = <span class="hljs-string">"media3-ui"</span>, version.ref = <span class="hljs-string">"media3"</span> }

<span class="hljs-attr">media3-session</span> = { group = <span class="hljs-string">"androidx.media3"</span>, name = <span class="hljs-string">"media3-session"</span>, version.ref = <span class="hljs-string">"media3"</span> }
</code></pre>
<h2 data-id="heading-1">二、核心组件一览</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee164566497e470ca9e13c6ddd30da88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5qCpbGluaw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768193338&amp;x-signature=Img%2B99lpAjkvBekk3f5dAE7YbYc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">服务端核心组件</h3>
<p><strong>MediaSessionService</strong></p>
<p>Media3 新增的 Service 基类，是整个音频后台运行的载体。它管理着 <code>MediaSession</code> 的生命周期。当系统（如蓝牙、通知栏）需要访问媒体信息时，它负责按需启动服务。</p>
<p>通过重写 <code>onGetSession(controllerInfo)</code>，可以精细控制哪些客户端（如 Auto、WearOS）有权连接你的会话。</p>
<p><strong>MediaSession</strong></p>
<p>媒体会话服务端的核心类，它是 <code>Player</code> 与外界沟通的桥梁。它将 Player 的状态（播放中、进度、音量）广播给系统，并接收来自外部的 <code>SessionCommand</code>（如锁屏点击）。</p>
<p><code>MediaSession</code> 是新项目首选。对于老项目，Media3 内部通过适配器自动处理了与 <code>MediaSessionCompat</code> 的兼容，开发者无需再手动处理繁琐的兼容逻辑。</p>
<p><strong>Player</strong></p>
<p><code>Player</code>是实际执行音视频解码、缓冲与渲染的核心组件。</p>
<p><code>MediaSession</code>并不限制 <code>Player</code> 的具体实现，只要实现了 <code>androidx.media3.common.Player</code> 接口即可，这使得切换不同播放引擎变得极其简单。</p>
<p><strong>MediaItem</strong></p>
<p>播放队列中的原子单元，不仅仅是数据的载体。通过内部的 <code>MediaMetadata</code>，它直接决定了锁屏界面的 UI 展示（标题、歌手、封面 URI）。</p>
<p>此外，它还承载了 DRM 加密配置、媒体流格式声明（MimeType）以及剪辑播放区域（Clipping）等逻辑。</p>
<hr/>
<h3 data-id="heading-3">客户端核心组件</h3>
<p><strong>SessionToken</strong></p>
<p><code>MediaSession</code> 的“身份识别令牌”。系统利用它在不同进程间定位你的 <code>MediaSessionService</code>。</p>
<p><strong>MediaController</strong></p>
<p>播放控制的控制器。通过 <code>SessionToken</code> 异步连接到服务端。一旦连接成功，它会镜像服务端 <code>Player</code> 的所有状态。</p>
<p>不仅是 App 内部的播放页 UI，系统层面的通知栏、锁屏控件、蓝牙车载协议、甚至 Google Assistant 的底层实现都是一个 <code>MediaController</code>。</p>
<hr/>
<h2 data-id="heading-4">三、入门级音视频播放器</h2>
<h3 data-id="heading-5">服务端</h3>
<p>实现 <code>MediaSessionService</code> 服务端代码通常分为四个核心步骤：<strong>搭建后台载体 -&gt; 初始化播放引擎 -&gt; 建立会话桥梁 -&gt; 注册服务。</strong></p>
<h4 data-id="heading-6">1. 创建 Service 并继承 <code>MediaSessionService</code></h4>
<p>这是服务端的基础，需要重写 <code>onGetSession</code> 方法，可以决定哪些客户端连接到你的会话。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaybackService</span> : <span class="hljs-type">MediaSessionService</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> mediaSession: MediaSession
    
    <span class="hljs-comment">// 当有控制器（如通知栏、锁屏或你的 Activity）尝试连接时调用</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onGetSession</span><span class="hljs-params">(controllerInfo: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>)</span></span>: MediaSession? {
        <span class="hljs-keyword">return</span> mediaSession
    }
}
</code></pre>
<h4 data-id="heading-7">2. 初始化 Player (如 ExoPlayer)</h4>
<p>在 <code>onCreate</code> 生命周期中初始化真正的播放器引擎。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onCreate()
    <span class="hljs-comment">// 这里初始化视频播放器</span>
    <span class="hljs-keyword">val</span> player = ExoPlayer.Builder(<span class="hljs-keyword">this</span>).build()
}
</code></pre>
<h4 data-id="heading-8">3. 构建并关联 <code>MediaSession</code></h4>
<p>将 <code>Player</code> 实例交给 <code>MediaSession</code> 托管，并设置 <code>SessionActivity</code>（点击通知栏跳转的页面）。</p>
<pre><code class="hljs language-scss" lang="scss">mediaSession = MediaSession<span class="hljs-selector-class">.Builder</span>(this, player)
            <span class="hljs-selector-class">.setId</span>(SESSION_ID)
            <span class="hljs-selector-class">.setCallback</span>(mediaSessionCallback)
            <span class="hljs-selector-class">.build</span>()
</code></pre>
<h4 data-id="heading-9">4. 初始化播放资源</h4>
<p>构建<code>MediaItem</code>。仅作示例, 实际应用中, 应根据业务逻辑, 从本地数据库或网络获取音视频信息后, 动态构建 <code>MediaItem</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initMediaItem</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 构建 MediaItem, 并设置到 ExoPlayer</span>
        <span class="hljs-keyword">val</span> mediaItem = MediaItem.Builder()
            .setUri(<span class="hljs-string">"https://media.w3.org/2010/05/sintel/trailer.mp4"</span>.toUri())
            .setMediaId(<span class="hljs-string">"123456"</span>)
            .setMediaMetadata(
                MediaMetadata.Builder()
                    .setTitle(<span class="hljs-string">"视频标题"</span>)
                    .build(),
            )
            .build()
        player.setMediaItem(mediaItem)
        player.prepare()
        player.playWhenReady = <span class="hljs-literal">true</span>
    }
</code></pre>
<h4 data-id="heading-10">5. 在 <code>AndroidManifest.xml</code> 中注册服务</h4>
<p><strong>这是最关键的一步</strong>。必须声明权限、Action 以及 <code>foregroundServiceType</code>（Android 10+ 要求）。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;uses-permission android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.permission.FOREGROUND_SERVICE"</span> /&gt;
&lt;uses-permission android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK"</span> /&gt;

&lt;service
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">".PlaybackService"</span>
    android:<span class="hljs-attr">foregroundServiceType</span>=<span class="hljs-string">"mediaPlayback"</span>
    android:<span class="hljs-attr">exported</span>=<span class="hljs-string">"true"</span>&gt;
    &lt;intent-filter&gt;
        &lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"androidx.media3.session.MediaSessionService"</span> /&gt;
    &lt;/intent-filter&gt;
&lt;/service&gt;
</code></pre>
<h4 data-id="heading-11">6. 生命周期管理</h4>
<p>为了防止内存泄漏，务必在 <code>onDestroy</code> 中释放资源。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
    player.release()
    mediaSession.release()
    <span class="hljs-keyword">super</span>.onDestroy()
}
</code></pre>
<p>完成上述步骤后，<code>Media3</code>会自动处理以下逻辑：</p>
<ul>
<li>
<p><strong>自动生成通知</strong>：只要 <code>Player</code> 开始播放，系统会自动弹出媒体通知和锁屏控件。</p>
</li>
<li>
<p><strong>状态同步</strong>：锁屏上的进度条、暂停按钮会自动响应 <code>Player</code> 的状态变化。</p>
</li>
</ul>
<h4 data-id="heading-12">7. 完整实现</h4>
<p>服务端<code>MediaSessionService</code>完整代码如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> SESSION_ID = <span class="hljs-string">"session_multimedia"</span>

<span class="hljs-meta">@OptIn(UnstableApi::class)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaybackService</span> : <span class="hljs-type">MediaSessionService</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> mediaSession: MediaSession
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> player: ExoPlayer
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mediaSessionCallback = <span class="hljs-keyword">object</span> : MediaSession.Callback {

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPlaybackResumption</span><span class="hljs-params">(
            mediaSession: <span class="hljs-type">MediaSession</span>,
            controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
        )</span></span>: ListenableFuture&lt;MediaSession.MediaItemsWithStartPosition&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onPlaybackResumption(mediaSession, controller)
        }

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onConnect</span><span class="hljs-params">(
            session: <span class="hljs-type">MediaSession</span>,
            controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
        )</span></span>: MediaSession.ConnectionResult {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onConnect(session, controller)
        }

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCustomCommand</span><span class="hljs-params">(
            session: <span class="hljs-type">MediaSession</span>,
            controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
            customCommand: <span class="hljs-type">SessionCommand</span>,
            args: <span class="hljs-type">Bundle</span>,
        )</span></span>: ListenableFuture&lt;SessionResult&gt; {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onCustomCommand(session, controller, customCommand, args)
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        initPlayer()
        initMediaSession()
        initMediaItem()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onGetSession</span><span class="hljs-params">(controllerInfo: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>)</span></span>: MediaSession? {
        <span class="hljs-keyword">return</span> mediaSession
    }


    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initPlayer</span><span class="hljs-params">()</span></span> {
        player = ExoPlayer.Builder(<span class="hljs-keyword">this</span>)
            .build()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initMediaSession</span><span class="hljs-params">()</span></span> {
        mediaSession = MediaSession.Builder(<span class="hljs-keyword">this</span>, player)
            .setId(SESSION_ID)
            .setCallback(mediaSessionCallback)
            .build()
    }

    <span class="hljs-comment">// 仅作示例, 实际应用中, 应根据业务逻辑, 从本地数据库或网络获取音视频信息后, 动态构建 MediaItem</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initMediaItem</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 构建 MediaItem, 并设置到 ExoPlayer</span>
        <span class="hljs-keyword">val</span> mediaItem = MediaItem.Builder()
            .setUri(<span class="hljs-string">"https://media.w3.org/2010/05/sintel/trailer.mp4"</span>.toUri())
            .setMediaId(<span class="hljs-string">"123456"</span>)
            .setMediaMetadata(
                MediaMetadata.Builder()
                    .setTitle(<span class="hljs-string">"视频标题"</span>)
                    .build(),
            )
            .build()
        player.setMediaItem(mediaItem)
        player.prepare()
        player.playWhenReady = <span class="hljs-literal">true</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
        player.release()
        mediaSession.release()
        <span class="hljs-keyword">super</span>.onDestroy()
    }
}
</code></pre>
<h3 data-id="heading-13">UI 端 / 客户端</h3>
<p>实现 Media3 客户端（通常是的 UI 界面，如 <code>Activity</code> 或 <code>Fragment</code>）主要围绕 <strong><code>MediaController</code></strong> 展开。</p>
<p>客户端的职责是：<strong>通过 Token 找到服务 -&gt; 建立连接 -&gt; 控制播放 -&gt; 监听状态并刷新 UI</strong>。</p>
<h4 data-id="heading-14">1. 定义 SessionToken</h4>
<p>首先，需要创建一个“令牌”来定位后台服务。</p>
<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">sessionToken</span> = SessionToken(context, ComponentName(context.packageName, <span class="hljs-string">"com.wj.player.PlaybackService"</span>)) // 服务端的包名、MediasessionService类名
</code></pre>
<h4 data-id="heading-15">2. 建立异步连接</h4>
<p><code>MediaController</code> 的创建是异步的，需要监听它的连接成功回调。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> controllerFuture: ListenableFuture&lt;MediaController&gt;? = <span class="hljs-literal">null</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mediaController: MediaController? = <span class="hljs-literal">null</span>

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStart</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onStart()
    controllerFuture = MediaController.Builder(context, sessionToken).buildAsync()
    controllerFuture?.addListener({
        <span class="hljs-comment">// 连接成功后，获取 controller 实例</span>
        mediaController = controllerFuture?.<span class="hljs-keyword">get</span>()
        <span class="hljs-comment">// 此时可以绑定监听器或直接控制播放</span>
        updateUI()
    }, MoreExecutors.directExecutor())
}
</code></pre>
<h4 data-id="heading-16">3. 控制播放 (如同操控本地 Player)</h4>
<p><code>MediaController</code>实现了<code>Player</code>接口，使用方式与 <code>ExoPlayer</code> 几乎完全一致，一些需要传入播放器才能使用的UI控件，可以直接传<code>MediaController</code>。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 播放</span>
mediaController?<span class="hljs-selector-class">.play</span>()

<span class="hljs-comment">// 切换下一曲</span>
mediaController?<span class="hljs-selector-class">.seekToNext</span>()

<span class="hljs-comment">// 调整进度</span>
mediaController?<span class="hljs-selector-class">.seekTo</span>(<span class="hljs-number">10000</span>L)
</code></pre>
<h4 data-id="heading-17">4. 监听状态更新 UI</h4>
<p>通过向 <code>mediaController</code> 添加 <code>Player.Listener</code>，可以实时感知歌曲切换、进度改变或播放状态变化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">mediaController?.addListener(<span class="hljs-keyword">object</span> : Player.Listener {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMediaItemTransition</span><span class="hljs-params">(mediaItem: <span class="hljs-type">MediaItem</span>?, reason: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// 当歌曲切换时，刷新界面的歌名、歌手和封面</span>
        updateSongInfo(mediaItem)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onIsPlayingChanged</span><span class="hljs-params">(isPlaying: <span class="hljs-type">Boolean</span>)</span></span> {
        <span class="hljs-comment">// 当播放/暂停状态改变时，切换播放按钮图标</span>
        playButton.setImageResource(<span class="hljs-keyword">if</span> (isPlaying) R.drawable.ic_pause <span class="hljs-keyword">else</span> R.drawable.ic_play)
    }
})
</code></pre>
<h4 data-id="heading-18">5. 断开连接与释放</h4>
<p>为了避免内存泄漏，在适当时机释放连接。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStop</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.onStop()
    controllerFuture?.let {
        MediaController.releaseFuture(it)
    }
    mediaController = <span class="hljs-literal">null</span>
}
</code></pre>
<h4 data-id="heading-19">6. 完整实现</h4>
<p>Compose UI 简要实现代码如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">PlayerScreen</span><span class="hljs-params">(viewModel: <span class="hljs-type">PlayerViewModel</span>, onBack: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">val</span> mediaItems <span class="hljs-keyword">by</span> viewModel.mediaItems.collectAsState()
    <span class="hljs-keyword">val</span> playerState <span class="hljs-keyword">by</span> viewModel.playerState.collectAsState()
    <span class="hljs-keyword">val</span> context = LocalContext.current
    <span class="hljs-keyword">val</span> mediaController = remember { mutableStateOf&lt;MediaController?&gt;(<span class="hljs-literal">null</span>) }
<span class="hljs-keyword">val</span> isControllerReady = remember { mutableStateOf(<span class="hljs-literal">false</span>) }

LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
<span class="hljs-keyword">val</span> sessionToken = SessionToken(context, ComponentName(context, PlaybackService::<span class="hljs-keyword">class</span>.java))
        <span class="hljs-keyword">val</span> controllerFuture = MediaController.Builder(context, sessionToken).buildAsync()
        controllerFuture.addListener(
            {
<span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">val</span> controller = controllerFuture.<span class="hljs-keyword">get</span>()
                    mediaController.value = controller
                    <span class="hljs-comment">// 添加监听器观察播放状态（仅在就绪后添加）</span>
                    controller.addListener(
                        <span class="hljs-keyword">object</span> : Player.Listener {
                            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onIsPlayingChanged</span><span class="hljs-params">(playing: <span class="hljs-type">Boolean</span>)</span></span> {
                                Log.e(<span class="hljs-string">"PlayScreen"</span>, <span class="hljs-string">"onIsPlayingChanged: <span class="hljs-variable">$playing</span>"</span>)
                            }

                            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPlaybackStateChanged</span><span class="hljs-params">(state: <span class="hljs-type">Int</span>)</span></span> {
                                Log.e(<span class="hljs-string">"PlayScreen"</span>, <span class="hljs-string">"onPlaybackStateChanged: <span class="hljs-variable">$state</span>"</span>)
                            }
                        },
                    )
                    isControllerReady.value = <span class="hljs-literal">true</span>  <span class="hljs-comment">// 标记就绪</span>
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    Log.e(<span class="hljs-string">"PlayerScreen"</span>, <span class="hljs-string">"MediaController build failed: <span class="hljs-subst">${e.message}</span>"</span>)
                    <span class="hljs-comment">// 在这里处理 UI 反馈，如显示错误 Toast</span>
                }
            } ,
            ContextCompat.getMainExecutor(context),
        )
    }

DisposableEffect(<span class="hljs-built_in">Unit</span>) {
onDispose {
mediaController.value?.release()
            isControllerReady.value = <span class="hljs-literal">false</span>
        }
}

<span class="hljs-comment">// 仅当控制器就绪时显示 PlayerControlView，否则显示加载 UI</span>
    <span class="hljs-keyword">if</span> (isControllerReady.value &amp;&amp; mediaController.value != <span class="hljs-literal">null</span>) {
        mediaController.value?.let { controller -&gt;
PlayerControlView(
                modifier = Modifier
                    .fillMaxSize()
                    .background(Color.Black),
                mediaPlayer = controller,
                onPlayPause = {
<span class="hljs-keyword">if</span> (playerState == PlayerState.Playing) {
                        controller.pause()
                        viewModel.pause()
                    } <span class="hljs-keyword">else</span> {
                        controller.play()
                        viewModel.play(mediaItems.first())
                    }
                } ,
                onSeek = { positionMs -&gt;
controller.seekTo(positionMs)
                } ,
                currentTime = controller.currentPosition,
                duration = controller.duration,
            )
        }
} <span class="hljs-keyword">else</span> {
        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
CircularProgressIndicator()
            Text(<span class="hljs-string">"Loading player..."</span>)
        }
}
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">PlayerControlView</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    mediaPlayer: <span class="hljs-type">Player</span>? = <span class="hljs-literal">null</span>,
)</span></span> {
    <span class="hljs-comment">// 中间播放区域</span>
    Box(
        modifier = modifier
            .fillMaxSize()
            .background(Color.Black)
            .padding(<span class="hljs-number">16.</span>dp),
    ) {
<span class="hljs-comment">// 视频区域 (使用AndroidView嵌入PlayerView)</span>
        AndroidView(
            modifier = Modifier.fillMaxSize(),
            factory = { context -&gt;
PlayerView(context).apply {
 player = mediaPlayer
                }
} ,
        )
    }
}
</code></pre>
<h2 data-id="heading-20">四、高级功能开发</h2>
<h3 data-id="heading-21">1. 锁屏控件增加自定义按钮</h3>
<p>首先，需要明确一个概念，在 Media3 (MediaSession) 中，锁屏控件的展示由系统根据<code>MediaSession</code>的状态自动处理，不需要多媒体应用实现自定义的<code>Notification</code>。所以要在锁屏界面或通知栏增加自定义按钮，核心思路是通过 <strong><code>CommandButton</code></strong> 定义按钮，并将其添加到 <strong><code>MediaSession</code></strong> 的布局中。</p>
<p><strong>第一步：自定义SessionCommand</strong></p>
<p>首先，需要为每个自定义按钮定义一个唯一的 <code>SessionCommand</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义按钮的 ID</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CUSTOM_COMMAND_FAVORITE = <span class="hljs-string">"ACTION_FAVORITE"</span>

<span class="hljs-comment">// 创建自定义 SessionCommand</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> favoriteCommand = SessionCommand(CUSTOM_COMMAND_FAVORITE, Bundle.EMPTY)
</code></pre>
<p><strong>第二步：创建 CommandButton</strong></p>
<p>使用 <code>CommandButton.Builder</code> 来配置按钮的图标、文字和对应的命令。</p>
<pre><code class="hljs language-scss" lang="scss">val favoriteButton = CommandButton<span class="hljs-selector-class">.Builder</span>()
    <span class="hljs-selector-class">.setDisplayName</span>("收藏")
    <span class="hljs-selector-class">.setIconResId</span>(R.drawable.ic_favorite) <span class="hljs-comment">// 你的图标资源</span>
    <span class="hljs-selector-class">.setSessionCommand</span>(favoriteCommand)
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<p><strong>第三步：设置 MediaSession 的自定义布局</strong></p>
<p>在构建 <code>MediaSession</code> 时，或者在运行时动态更新，需要通过 <code>setCustomLayout</code> 方法将按钮告诉系统。</p>
<pre><code class="hljs language-scss" lang="scss">val mediaSession = MediaSession<span class="hljs-selector-class">.Builder</span>(context, player)
    <span class="hljs-selector-class">.setCallback</span>(sessionCallback())
    <span class="hljs-selector-class">.setCustomLayout</span>(ImmutableList.of(favoriteButton)) <span class="hljs-comment">// 在这里添加自定义按钮列表</span>
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<p><strong>第四步：处理按钮点击事件</strong></p>
<p>重写 <code>MediaSession.Callback</code> 中的 <code>onConnect</code> 、<code>onCustomCommand</code> 方法，来设置自定义<code>SessionCommand</code>以及响应用户的点击操作。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mediaSessionCallback = <span class="hljs-keyword">object</span> : MediaSession.Callback {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onConnect</span><span class="hljs-params">(
        session: <span class="hljs-type">MediaSession</span>,
        controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
    )</span></span>: MediaSession.ConnectionResult {
        <span class="hljs-keyword">val</span> sessionCommands = MediaSession.ConnectionResult.DEFAULT_SESSION_COMMANDS.buildUpon()
            .add(favoriteCommand)
            .build()
        <span class="hljs-keyword">return</span> MediaSession.ConnectionResult.AcceptedResultBuilder(session)
            .setAvailableSessionCommands(sessionCommands)
            .build()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCustomCommand</span><span class="hljs-params">(
        session: <span class="hljs-type">MediaSession</span>,
        controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
        customCommand: <span class="hljs-type">SessionCommand</span>,
        args: <span class="hljs-type">Bundle</span>,
    )</span></span>: ListenableFuture&lt;SessionResult&gt; {

        <span class="hljs-keyword">if</span> (customCommand.customAction == CUSTOM_COMMAND_FAVORITE) {
            <span class="hljs-comment">// 执行你的逻辑，比如收藏歌曲</span>
            doFavorite()
        }

        <span class="hljs-keyword">return</span> Futures.immediateFuture(SessionResult(SessionResult.RESULT_SUCCESS))
    }
}
</code></pre>
<h3 data-id="heading-22">2. 细粒度的连接管理 (Access Control)</h3>
<p>多数时候我们不一定希望所有的外部设备（如所有的蓝牙手表或第三方助手）都能<strong>控制</strong>你的播放器。通过重写 <code>MediaSession.Callback</code> 中的 <code>onConnect</code>，可以进行权限校验。</p>
<ul>
<li><strong>实现方式</strong>：检查 <code>ControllerInfo</code> 中的包名或 UID。</li>
<li><strong>场景</strong>：只允许特定的 App 远程控制你的媒体，或者为不同的客户端（如 Android Auto 与 手机通知栏）提供不同的自定义按钮布局。</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onConnect</span><span class="hljs-params">(
    session: <span class="hljs-type">MediaSession</span>,
    controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>,
)</span></span>: MediaSession.ConnectionResult {
    Log.e(<span class="hljs-string">"PlaybackService"</span>, <span class="hljs-string">"onConnect <span class="hljs-subst">${controller.packageName}</span>"</span>)
    <span class="hljs-keyword">val</span> sessionCommands = MediaSession.ConnectionResult.DEFAULT_SESSION_COMMANDS.buildUpon()

    <span class="hljs-keyword">if</span> (controller.packageName != packageName) {
        sessionCommands.add(favoriteCommand)
    }

    <span class="hljs-keyword">return</span> MediaSession.ConnectionResult.AcceptedResultBuilder(session)
        .setAvailableSessionCommands(sessionCommands.build())
        .build()
}
</code></pre>
<h3 data-id="heading-23">3. MediaButtonReceiver 重定向 (媒体按键处理)</h3>
<p><code>MediaButtonReceiver</code> 是 Android 中处理媒体按键（如耳机线控、蓝牙遥控器上的播放/暂停键）的关键组件。在 Jetpack Media3 中，它的使用变得非常自动化。当用户按下媒体按键时，系统会发出一个 <code>ACTION_MEDIA_BUTTON</code> 的广播。</p>
<ul>
<li><strong>如果应用正在运行</strong>：<code>MediaSession</code> 会直接接收并处理。</li>
<li><strong>如果应用已被杀死</strong>：系统会根据清单文件（Manifest）中的配置，寻找能处理该广播的组件，从而<strong>重启你的后台服务</strong>，实现“一键恢复播放”。</li>
</ul>
<p>在 Media3 中，不需要手动编写广播接收器类，库已经内置了处理逻辑。</p>
<p><strong>第一步：在 AndroidManifest.xml 中注册</strong></p>
<p>需要让系统知道你的 <code>MediaSessionService</code> 能够处理媒体按键广播。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;service
    android:<span class="hljs-attr">name</span>=<span class="hljs-string">".PlaybackService"</span>
    android:<span class="hljs-attr">exported</span>=<span class="hljs-string">"true"</span>
    android:<span class="hljs-attr">foregroundServiceType</span>=<span class="hljs-string">"mediaPlayback"</span>&gt;
    &lt;intent-filter&gt;
        &lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"androidx.media3.session.MediaSessionService"</span> /&gt;
        &lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.intent.action.MEDIA_BUTTON"</span> /&gt;
    &lt;/intent-filter&gt;
&lt;/service&gt;

&lt;receiver android:<span class="hljs-attr">name</span>=<span class="hljs-string">"androidx.media3.session.MediaButtonReceiver"</span>
    android:<span class="hljs-attr">exported</span>=<span class="hljs-string">"true"</span>&gt;
    &lt;intent-filter&gt;
        &lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.intent.action.MEDIA_BUTTON"</span> /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre>
<p><strong>第二步：在 Service 中处理恢复逻辑</strong></p>
<p>当用户在应用关闭时按下播放键，<code>MediaSessionService</code> 会被系统唤醒。此时，需要告诉系统“播放什么”。在 <code>MediaSession.Callback</code> 中重写 <code>onPlaybackResumption</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySessionCallback</span> : <span class="hljs-type">MediaSession.Callback</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPlaybackResumption</span><span class="hljs-params">(
        session: <span class="hljs-type">MediaSession</span>,
        controller: <span class="hljs-type">MediaSession</span>.<span class="hljs-type">ControllerInfo</span>
    )</span></span>: ListenableFuture&lt;MediaSession.ConnectionResult&gt; {
       
        <span class="hljs-comment">// 1. 在这里加载用户上次退出的播放列表、进度等数据</span>
        <span class="hljs-keyword">val</span> lastMediaItems = loadLastPlayedList() 
        <span class="hljs-keyword">val</span> lastIndex = loadLastIndex()
        <span class="hljs-keyword">val</span> lastPosition = loadLastPosition()

        <span class="hljs-comment">// 2. 将数据设置给 Player</span>
        session.player.setMediaItems(lastMediaItems, lastIndex, lastPosition)
        session.player.prepare()

        <span class="hljs-comment">// 3. 返回接受连接的结果，告知系统已准备好恢复</span>
        <span class="hljs-keyword">return</span> Futures.immediateFuture(
            MediaSession.ConnectionResult.AcceptedResultBuilder(session).build()
        )
    }
}
</code></pre>
<h2 data-id="heading-24">五、附录</h2>
<h3 data-id="heading-25">MediaSession 常用API与使用场景说明</h3>
<hr/>
<h4 data-id="heading-26">1. 核心身份与回调</h4>
<ul>
<li>
<p><strong><code>setCallback(MediaSession.Callback callback)</code></strong></p>
<ul>
<li><strong>含义</strong>：设置会话回调，用于处理外部指令（如：点击锁屏的自定义按钮、搜索请求、尝试连接等）。</li>
<li><strong>场景</strong>：<strong>必用</strong>。如果你需要处理自定义按钮点击、鉴权、或者对特定的播放控制逻辑进行拦截，就必须实现并设置此回调。</li>
</ul>
</li>
<li>
<p><strong><code>setId(String id)</code></strong></p>
<ul>
<li><strong>含义</strong>：为 <code>MediaSession</code> 设置一个 ID。</li>
<li><strong>场景</strong>：同一个应用开启多个 <code>MediaSession</code> 时（例如一个播音乐，一个播播客），用于区分不同的会话。如果不设置，默认是空字符串。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-27">2. 界面展示与交互</h4>
<ul>
<li>
<p><strong><code>setSessionActivity(PendingIntent pendingIntent)</code></strong></p>
<ul>
<li><strong>含义</strong>：设置一个点击通知栏或锁屏界面时跳转的 <code>Activity</code>。</li>
<li><strong>场景</strong>：<strong>强烈建议设置</strong>。当用户在锁屏界面点击歌曲名称或封面时，系统会调用这个 <code>PendingIntent</code> 调起你的 App 播放界面。</li>
</ul>
</li>
<li>
<p><strong><code>setCustomLayout(List&lt;CommandButton&gt; buttons)</code></strong></p>
<ul>
<li><strong>含义</strong>：定义要在通知栏或锁屏上显示的自定义按钮列表。</li>
<li><strong>场景</strong>：当你除了“播放/暂停/上一曲/下一曲”之外，还想要“收藏”、“倍速”或“循环模式”按钮时使用。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-28">3. 数据与状态管理</h4>
<ul>
<li>
<p><strong><code>setExtras(Bundle extras)</code></strong></p>
<ul>
<li><strong>含义</strong>：存放自定义的元数据或配置信息。</li>
<li><strong>场景</strong>：用于向 <code>MediaController</code>（控制器端）传递一些非标准的数据信息。</li>
</ul>
</li>
<li>
<p><strong><code>setBitmapLoader(BitmapLoader bitmapLoader)</code></strong></p>
<ul>
<li><strong>含义</strong>：自定义图片加载逻辑。</li>
<li><strong>场景</strong>：默认情况下 Media3 使用简单的网络加载。如果你使用了 <strong>Glide</strong> 或 <strong>Coil</strong> 加载封面图，可以通过此方法集成，以确保封面能高效地显示在锁屏上。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-29">4. 周期管理</h4>
<ul>
<li>
<p><strong><code>setSessionExtras(Bundle extras)</code></strong></p>
<ul>
<li><strong>含义</strong>：与 <code>setExtras</code> 类似，但更侧重于在 Session 级别传递初始配置。</li>
</ul>
</li>
<li>
<p><strong><code>setPeriodicSessionExtrasInfoRefreshIntervalMs(long interval)</code></strong></p>
<ul>
<li>
<p><strong>含义</strong>：设置定期刷新 Session Extras 的时间间隔。</p>
</li>
<li>
<p><strong>场景</strong>：当你的会话状态（如特定的自定义业务状态）需要定时同步给所有连接的控制器时使用。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-30">5. 典型使用示例</h4>
<pre><code class="hljs language-scss" lang="scss">val session = MediaSession<span class="hljs-selector-class">.Builder</span>(context, player)
    <span class="hljs-comment">// 1. 设置点击通知跳转到哪个页面</span>
    <span class="hljs-selector-class">.setSessionActivity</span>(createPendingIntent()) 
    <span class="hljs-comment">// 2. 设置回调处理逻辑</span>
    <span class="hljs-selector-class">.setCallback</span>(MySessionCallback()) 
    <span class="hljs-comment">// 3. 设置锁屏/通知栏的自定义按钮</span>
    <span class="hljs-selector-class">.setCustomLayout</span>(listOf(favoriteButton, speedButton)) 
    <span class="hljs-comment">// 4. 定义 ID 方便调试或多实例管理</span>
    <span class="hljs-selector-class">.setId</span>("MusicSession") 
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<hr/>
<h3 data-id="heading-31">MediaItem 常用API与使用场景说明</h3>
<h4 data-id="heading-32">1. 基础资源定位</h4>
<p>这是最常用的部分，用于告诉播放器“播什么”。</p>
<ul>
<li>
<p><strong><code>setMediaId(String mediaId)</code></strong></p>
<ul>
<li><strong>含义</strong>：为媒体项设置唯一标识符。</li>
<li><strong>场景</strong>：在播放列表管理、从数据库恢复播放状态、或在 <code>MediaSession</code> 回调中识别歌曲时非常重要。如果不设置，默认使用 <code>URI</code>。</li>
</ul>
</li>
<li>
<p><strong><code>setUri(Uri uri / String uri)</code></strong></p>
<ul>
<li><strong>含义</strong>：媒体内容的实际路径。</li>
<li><strong>场景</strong>：指向本地文件路径、网络 HTTP 链接或 ContentProvider 的 URI。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-33">2. 媒体元数据</h4>
<p>用于 UI 展示，如锁屏界面、通知栏和蓝牙车载界面。</p>
<ul>
<li>
<p><strong><code>setMediaMetadata(MediaMetadata metadata)</code></strong></p>
<ul>
<li><strong>含义</strong>：传入一个 <code>MediaMetadata</code> 对象。</li>
<li><strong>常用内部属性</strong>：<code>setTitle()</code> (标题), <code>setArtist()</code> (艺术家), <code>setArtworkUri()</code> (封面图片地址)。</li>
<li><strong>场景</strong>：当你需要让锁屏控件显示歌曲名和封面图时使用。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-34">3. 自适应与高级配置</h4>
<p>用于处理加密视频、流媒体协议或特定类型的文件。</p>
<ul>
<li>
<p><strong><code>setDrmConfiguration(MediaItem.DrmConfiguration drmConfig)</code></strong></p>
<ul>
<li><strong>含义</strong>：设置数字版权管理（DRM）配置。</li>
<li><strong>场景</strong>：播放受保护的付费内容（如 Widevine, PlayReady 加密的视频）。</li>
</ul>
</li>
<li>
<p><strong><code>setMimeType(String mimeType)</code></strong></p>
<ul>
<li><strong>含义</strong>：显式指定媒体类型（如 <code>application/x-mpegURL</code> 对应 HLS）。</li>
<li><strong>场景</strong>：当 URI 后缀无法直接判断类型时（例如一个没有扩展名的流链接），设置此项能加快播放器解析速度。</li>
</ul>
</li>
<li>
<p><strong><code>setLiveConfiguration(MediaItem.LiveConfiguration liveConfig)</code></strong></p>
<ul>
<li><strong>含义</strong>：配置直播流参数（如最大/最小偏移偏移量、播放倍速）。</li>
<li><strong>场景</strong>：低延迟直播（Low-latency live streaming）。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-35">4. 剪辑与部分播放</h4>
<ul>
<li>
<p><strong><code>setClippingConfiguration(MediaItem.ClippingConfiguration config)</code></strong></p>
<ul>
<li><strong>含义</strong>：设置播放的起始和结束位置。</li>
<li><strong>场景</strong>：你只想播放长视频中的某一段（例如：从第 10 秒播到第 30 秒），而不需要手动去监听进度并停止。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-36">5. 附加组件</h4>
<ul>
<li>
<p><strong><code>setSubtitleConfigurations(List&lt;SubtitleConfiguration&gt; subtitles)</code></strong></p>
<ul>
<li><strong>含义</strong>：外挂字幕配置。</li>
<li><strong>场景</strong>：视频文件本身不含字幕，需要加载外部的 <code>.vtt</code> 或 <code>.srt</code> 文件时。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-37">6. 自定义数据</h4>
<ul>
<li>
<p><strong><code>setTag(Object tag)</code></strong></p>
<ul>
<li><strong>含义</strong>：挂载一个自定义的 Java/Kotlin 对象。</li>
<li><strong>场景</strong>：在 <code>onMediaItemTransition</code> 监听器中，你想快速获取该媒体项关联的业务模型对象（比如数据库里的 <code>User</code> 对象），而不想通过 <code>mediaId</code> 重新查询。</li>
</ul>
</li>
<li>
<p><strong><code>setCustomCacheKey(String cacheKey)</code></strong></p>
<ul>
<li><strong>含义</strong>：自定义缓存键。</li>
<li><strong>场景</strong>：如果多个不同 URI 指向同一个物理文件，通过设置相同的 Key 可以避免重复下载缓存。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-38">7. 典型使用示例</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">mediaItem</span> = <span class="hljs-selector-tag">MediaItem</span><span class="hljs-selector-class">.Builder</span>()
    <span class="hljs-selector-class">.setMediaId</span>(<span class="hljs-string">"song_101"</span>)
    <span class="hljs-selector-class">.setUri</span>(<span class="hljs-string">"https://example.com/music.mp3"</span>)
    <span class="hljs-selector-class">.setMediaMetadata</span>(
        MediaMetadata.<span class="hljs-built_in">Builder</span>()
            .<span class="hljs-built_in">setTitle</span>(<span class="hljs-string">"江南"</span>)
            .<span class="hljs-built_in">setArtist</span>(<span class="hljs-string">"林俊杰"</span>)
            .<span class="hljs-built_in">setArtworkUri</span>(Uri.<span class="hljs-built_in">parse</span>(<span class="hljs-string">"https://example.com/cover.jpg"</span>))
            .<span class="hljs-built_in">build</span>()
    )
    <span class="hljs-comment">// 假设只播前 30 秒作为试听</span>
    <span class="hljs-selector-class">.setClippingConfiguration</span>(
        MediaItem.ClippingConfiguration.<span class="hljs-built_in">Builder</span>()
            .<span class="hljs-built_in">setEndPositionMs</span>(<span class="hljs-number">30000</span>)
            .<span class="hljs-built_in">build</span>()
    )
    <span class="hljs-selector-class">.setTag</span>(myCustomObject) <span class="hljs-comment">// 绑定自定义业务数据</span>
    <span class="hljs-selector-class">.build</span>()

<span class="hljs-selector-tag">player</span><span class="hljs-selector-class">.setMediaItem</span>(mediaItem)
</code></pre>
<h2 data-id="heading-39">六、总结</h2>
<p>以上就是<code>MediaSession</code>入门级的知识总结，在车载应用开发中，大多数情况下都是开发一个客户端应用连接到<code>MediaSessionService</code>上，用于控制媒体中心的行为，那么本文涉及的内容已经基本够用。</p>
<p>下一篇，我们来讲讲多媒体开发过程最常见的<code>音频焦点</code>的处理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OKHTTP连接保持]]></title>    <link>https://juejin.cn/post/7591681023906988041</link>    <guid>https://juejin.cn/post/7591681023906988041</guid>    <pubDate>2026-01-05T06:21:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591681023906988041" data-draft-id="7591670569909665838" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OKHTTP连接保持"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-05T06:21:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GoldenPlayer"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453948119"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OKHTTP连接保持
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453948119/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GoldenPlayer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:21:44.000Z" title="Mon Jan 05 2026 06:21:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Retrofit2 本身并不包含缓存功能，且代码中目前也没有开启 OkHttp 的磁盘缓存功能</strong></p>
<p>观察到的“第二次请求特别快”，<strong>并不是因为数据被缓存了</strong>，而是因为 <strong>OkHttp 的连接池复用机制（Connection Pooling / Keep-Alive）</strong>。</p>
<p>下面详细解释为什么会这样，以及如果真的想要“缓存”该怎么做</p>
<h3 data-id="heading-0">1. 为什么第二次请求变快了？（连接复用）</h3>
<p>在网络请求中，建立连接是最耗时的步骤之一。</p>
<ul>
<li><strong>第一次请求</strong>：DNS 解析 -&gt; 建立 TCP 连接 (三次握手) -&gt; SSL/TLS 握手 (加密验证) -&gt; 发送数据 -&gt; 接收数据。</li>
<li><strong>第二次请求</strong>：由于 OkHttp 默认开启了<strong>连接池</strong>，它发现还在请求同一个域名（<code>BASE_URL</code>），且之前的连接还没有断开，它会直接跳过前面的握手步骤：<strong>直接利用已有连接发送数据 -&gt; 接收数据</strong>。</li>
</ul>
<p>这省去了几百毫秒甚至上秒的握手时间，所以会感觉“特别快”</p>
<p><strong>注意</strong>：这并不意味着数据被缓存了。如果手机断网，第二次请求依然会失败</p>
<h3 data-id="heading-1">2. Retrofit 和 OkHttp 的关系</h3>
<ul>
<li><strong>Retrofit</strong>：只是一个外壳（Wrapper），它负责把 Interface 方法转换成 HTTP 请求，解析 JSON 数据等。它不负责底层的网络传输，也不负责缓存。</li>
<li><strong>OkHttp</strong>：是 Retrofit 底下的引擎，它负责真正的网络传输和缓存</li>
</ul>
<h3 data-id="heading-2">3. 代码中为何没有缓存？</h3>
<p>在 HTTP 协议中，标准的缓存是基于磁盘的（Disk Cache）。要启用它，需要显式地给 <code>OkHttpClient</code> 配置一个 <code>Cache</code> 对象。</p>
<p>查看代码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">return</span> OkHttpClient.Builder()
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// 这里缺少了 .cache(cache) 的配置</span>
    .addInterceptor(logging)
    .addInterceptor(TokenHeaderInterceptor())
    .build()
</code></pre>
<p>因为没有配置 <code>.cache()</code>，OkHttp 不会将服务器返回的数据写入手机存储</p>
<h3 data-id="heading-3">4. 还有一个关键点：POST 请求通常不被缓存</h3>
<p><code>ApiService</code>，大部分请求是 <code>@POST</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@POST(<span class="hljs-string">"/v1/media/getRecapInfo"</span>)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getRecapInfo</span><span class="hljs-params">(...)</span></span>
</code></pre>
<p><strong>HTTP 标准缓存协议通常只针对 <code>GET</code> 请求有效。</strong>
对于 <code>POST</code> 请求（通常代表提交数据或获取非幂等数据），浏览器和 OkHttp 默认都不会去缓存结果</p>
<p>所以，即便开启了 OkHttp 的缓存， <code>getRecapInfo</code> 这种 POST 请求依然不会被缓存。这进一步印证感觉到的“快”纯粹是因为<strong>网络连接复用</strong></p>
<hr/>
<h3 data-id="heading-4">5. 如果想要真正的“数据缓存”该怎么做？</h3>
<p>如果希望在<strong>没网的时候也能读取上次的数据</strong>，或者减少服务器压力，有两种选择：</p>
<h4 data-id="heading-5">方案 A：开启 OkHttp 标准缓存（仅对 GET 有效）</h4>
<p>需要修改 <code>buildOkHttpClient</code>，传入 <code>Context</code> 来获取缓存路径：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 需要传入 context</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildOkHttpClient</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: OkHttpClient {
    <span class="hljs-comment">// 设置缓存大小，比如 10MB</span>
    <span class="hljs-keyword">val</span> cacheSize = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024L</span> 
    <span class="hljs-keyword">val</span> cache = Cache(File(context.cacheDir, <span class="hljs-string">"http_cache"</span>), cacheSize)

    <span class="hljs-keyword">return</span> OkHttpClient.Builder()
        .cache(cache) <span class="hljs-comment">// 开启缓存</span>
        <span class="hljs-comment">// ... 其他配置</span>
        .build()
}
</code></pre>
<p><em>前提：后端接口必须是 <code>GET</code> 请求，并且后端返回的 Header 中包含 <code>Cache-Control</code> 信息（比如 <code>max-age=60</code>）。</em></p>
<h4 data-id="heading-6">方案 B：业务层缓存（推荐，适合 POST 和复杂业务）</h4>
<p>既然接口多是 POST，且业务逻辑较重，建议不要依赖 HTTP 协议缓存，而是自己控制：</p>
<ol>
<li><strong>数据库缓存 (Room)</strong>：请求成功后，把 JSON 数据存入本地数据库（SQLite/Room）。下次请求前，先读数据库显示旧数据，同时去请求网络更新。</li>
<li><strong>RxJava 内存缓存</strong>：如果只是想在页面没销毁前缓存，可以使用 RxJava 的操作符。
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 示例：使用 replay(1).autoConnect() 让流变热，从而缓存最近一次的结果</span>
<span class="hljs-keyword">val</span> cachedObservable = apiService.getRecapInfo(req).replay(<span class="hljs-number">1</span>).autoConnect()
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<p>目前的框架<strong>没有缓存</strong>。</p>
<ul>
<li>第一次慢：建立连接 + 传输数据</li>
<li>第二次快：<strong>复用连接</strong> + 传输数据</li>
</ul>
<p>这就是 HTTP 协议中的 <strong>Keep-Alive（HTTP 持久连接）</strong> 机制</p>
<p>在 OkHttp 中，这个机制是通过 <strong><code>ConnectionPool</code>（连接池）</strong> 来实现的</p>
<h3 data-id="heading-8">1. 为什么叫“类似长连接”？</h3>
<p>严格来说，它不是像 WebSocket 那种一直不断的“永久长连接”，而是 <strong>“在一段时间内保持连接不断开”</strong>。</p>
<ul>
<li><strong>没有复用（短连接）</strong>：请求 -&gt; 建立连接(3次握手+TLS) -&gt; 传输 -&gt; <strong>断开连接</strong>。下次再请求，重新建立。</li>
<li><strong>连接池复用（Keep-Alive）</strong>：请求 -&gt; 建立连接 -&gt; 传输 -&gt; <strong>连接闲置放入池中</strong>（不断开）。
<ul>
<li>如果在 <strong>5分钟</strong>（默认）内又有请求 -&gt; <strong>直接复用该连接</strong>。</li>
<li>如果超过 5分钟 没人用 -&gt; 自动断开并回收。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">2. 配置在哪里？（默认配置）</h3>
<p>在代码中，没有显式配置它，因为 OkHttp <strong>默认</strong>已经帮你配置好了</p>
<p><strong>源码位置：</strong> <code>okhttp3.OkHttpClient.Builder</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// OkHttp 源码片段 (Kotlin 版本)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">var</span> connectionPool: ConnectionPool = ConnectionPool() <span class="hljs-comment">// 这里！默认创建了一个连接池</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>如果点进去看 <code>ConnectionPool</code> 的无参构造函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// okhttp3.ConnectionPool 源码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span>(
    maxIdleConnections: <span class="hljs-built_in">Int</span> = <span class="hljs-number">5</span>, <span class="hljs-comment">// 默认最大闲置连接数：5个</span>
    keepAliveDuration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">5</span>, <span class="hljs-comment">// 默认保持存活时间：5</span>
    timeUnit: TimeUnit = TimeUnit.MINUTES <span class="hljs-comment">// 单位：分钟</span>
) {
    <span class="hljs-comment">// 这意味着：默认情况下，OkHttp 会维护最多 5 个空闲连接，</span>
    <span class="hljs-comment">// 每个空闲连接如果不被使用，5 分钟后会被自动清理。</span>
}
</code></pre>
<p>如果想修改这个配置（比如为了优化性能，想让连接保持更久，或者允许更多并发闲置连接），可以这样写：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildOkHttpClient</span><span class="hljs-params">()</span></span>: OkHttpClient {
    <span class="hljs-comment">// 自定义连接池</span>
    <span class="hljs-keyword">val</span> myConnectionPool = ConnectionPool(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, TimeUnit.MINUTES)

    <span class="hljs-keyword">return</span> OkHttpClient.Builder()
        .connectionPool(myConnectionPool) <span class="hljs-comment">// 显式传入</span>
        <span class="hljs-comment">// ... 其他配置</span>
        .build()
}
</code></pre>
<hr/>
<h3 data-id="heading-10">3. 源码探究：它是如何“偷偷”复用的？</h3>
<p>既然对源码好奇，来看看 OkHttp 是如何管理这些连接的。核心逻辑在 <code>okhttp3.internal.connection</code> 包下。</p>
<h4 data-id="heading-11">A. 存：请求结束后不关连接</h4>
<p>当请求（比如 <code>getRecapInfo</code>）执行完毕拿到数据后，OkHttp 的底层流处理类（<code>StreamAllocation</code> 或新版的 <code>Exchange</code>）会调用 <code>release</code> 方法。</p>
<p>正常逻辑是关闭 Socket，但 OkHttp 做了一个判断：
<strong>“如果是 HTTP/1.1 且 header 里有 keep-alive，我不关 Socket，而是把它标记为 <code>idle</code>（闲置），放回 <code>ConnectionPool</code> 的双端队列（Deque）中。”</strong></p>
<h4 data-id="heading-12">B. 取：请求开始前先找连接</h4>
<p>当发起<strong>第二次</strong>请求时，OkHttp 不会立刻 <code>new Socket()</code></p>
<p>它会去 <code>ConnectionPool</code> 里找（源码类 <code>ExchangeFinder</code>）：</p>
<ol>
<li><strong>遍历池子</strong>：看有没有 host 和 port 都匹配的、而且是可以复用的连接</li>
<li><strong>找到了</strong>：直接返回这个 <code>RealConnection</code> 对象</li>
<li><strong>没找到</strong>：才去执行 TCP 三次握手和 TLS 握手（就是觉得耗时的那部分）</li>
</ol>
<h4 data-id="heading-13">C. 清理：后台线程自动打扫</h4>
<p>OkHttp 怎么知道什么时候关闭那些 5 分钟没用的连接？</p>
<p>在 <code>ConnectionPool</code> 内部，有一个<strong>静态的线程池</strong>（executor），专门运行一个 <code>cleanupRunnable</code> 任务。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ConnectionPool 伪代码逻辑</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> cleanupRunnable = Runnable {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// 1. 计算下一个连接多久过期</span>
        <span class="hljs-keyword">val</span> waitNanos = cleanup(System.nanoTime())
        
        <span class="hljs-comment">// 2. 如果池子空了，退出循环，线程结束</span>
        <span class="hljs-keyword">if</span> (waitNanos == -<span class="hljs-number">1L</span>) <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment">// 3. 还没到期，线程挂起等待（wait），到时间再醒来检查</span>
        <span class="hljs-keyword">if</span> (waitNanos &gt; <span class="hljs-number">0</span>) {
            lock.wait(waitNanos) 
        }
    }
}
</code></pre>
<p>这个设计非常精妙：<strong>如果没有空闲连接，清理线程是不运行的，完全不占资源。一旦有了空闲连接，它才会启动并计时。</strong></p>
<h3 data-id="heading-14">4. 为什么握手这么耗时？（直观对比）</h3>
<p>感觉到的“第一次慢，第二次快”，在 HTTPS 请求中差异巨大</p>
<p><strong>第一次请求（冷启动）：</strong></p>
<ol>
<li><strong>DNS</strong>：域名 -&gt; IP （几毫秒到几百毫秒）</li>
<li><strong>TCP 握手</strong>：SYN -&gt; SYN/ACK -&gt; ACK （1个 RTT，往返时延）</li>
<li><strong>TLS 握手</strong>（最贵）：
<ul>
<li>Client Hello</li>
<li>Server Hello + Certificate</li>
<li>Key Exchange</li>
<li>Finished</li>
<li><em>(如果是 TLS 1.2，这里至少消耗 2个 RTT。跨国网络下，这可能就是 500ms+ 的时间)</em></li>
</ul>
</li>
<li><strong>发送 HTTP 数据</strong></li>
<li><strong>接收数据</strong></li>
</ol>
<p><strong>第二次请求（复用）：</strong></p>
<ol>
<li>(跳过 DNS)</li>
<li>(跳过 TCP 握手)</li>
<li>(跳过 TLS 握手) -&gt; <strong>省下了最耗时的部分！</strong></li>
<li><strong>发送 HTTP 数据</strong></li>
<li><strong>接收数据</strong></li>
</ol>
<p>所以，在移动端开发中，保持 <code>OkHttpClient</code> 单例（像代码里做的 <code>object NetworkApi</code> + <code>lazy</code>）是非常重要的，这样才能利用连接池。如果每次请求都 <code>new OkHttpClient()</code>，连接池就会失效，每次都要重新握手，速度就会很慢</p>
<br/>
<p><strong>不需要显式设置，header中Keep-Alive默认是开启的。</strong> 而且，<strong>目前的日志里可能看不到这个 Header，是因为拦截器的位置原因</strong></p>
<p>下面一步步验证和揭秘</p>
<h3 data-id="heading-15">1. 为什么不需要设置？（协议默认值）</h3>
<ul>
<li><strong>HTTP/1.1 协议规定</strong>：只要是 HTTP/1.1，默认就是 <code>Keep-Alive</code>（持久连接）。除非显式发送 <code>Connection: close</code>，否则服务器和客户端都默契地保持连接。</li>
<li><strong>HTTP/2 协议规定</strong>：在 HTTP/2 中，连接复用是核心特性（Multiplexing），<code>Connection</code> header 甚至被视为非法或被忽略，因为连接默认就是持久且多路复用的。</li>
</ul>
<h3 data-id="heading-16">2. 为什么日志里可能看不到？（拦截器陷阱）</h3>
<p>现在的代码是这样写的：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ...</span>
.addInterceptor(logging) <span class="hljs-comment">// &lt;--- 注意这里</span>
<span class="hljs-comment">// ...</span>
</code></pre>
<p>这叫做 <strong>Application Interceptor（应用拦截器）</strong>。</p>
<p><strong>OkHttp 的工作流程是这样的：</strong></p>
<ol>
<li><strong>应用拦截器 (Application Interceptor)</strong>：就是 <code>logging</code>。这时候请求还是“原始”的，是代码里写的样子。<strong>OkHttp 还没来得及加默认 Header。</strong></li>
<li><strong>桥接拦截器 (BridgeInterceptor)</strong>：<strong>OkHttp 内部的一个拦截器。它负责补全 Header（比如 <code>Host</code>, <code>User-Agent</code>, <code>Gzip</code>, <code>Connection: Keep-Alive</code>）。</strong></li>
<li><strong>网络拦截器 (Network Interceptor)</strong>：在真正发包之前。</li>
<li><strong>发送网络请求</strong>。</li>
</ol>
<p><strong>结论</strong>：因为日志拦截器在第 1 步，而添加 <code>Keep-Alive</code> 发生在第 2 步，所以在日志里看不到它</p>
<h3 data-id="heading-17">3. 如何亲眼看到它？（两个方法）</h3>
<h4 data-id="heading-18">方法一：临时修改代码（最快验证）</h4>
<p>把代码中的 <code>addInterceptor(logging)</code> 改为 <code>addNetworkInterceptor(logging)</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// NetworkApi.kt 修改</span>

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildOkHttpClient</span><span class="hljs-params">()</span></span>: OkHttpClient {
    <span class="hljs-comment">// ... 前面省略</span>
    <span class="hljs-keyword">return</span> OkHttpClient.Builder()
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// 删掉这行 .addInterceptor(logging)</span>
        <span class="hljs-comment">// 改用下面这行：</span>
        .addNetworkInterceptor(logging) 
        .addInterceptor(TokenHeaderInterceptor())
        .build()
}
</code></pre>
<p><strong>重新运行并看日志：</strong>
会在 Header 里清晰地看到：
<code>Connection: Keep-Alive</code>
<code>Accept-Encoding: gzip</code> (OkHttp 也会自动帮加这个，之前看不到，现在能看到了)
<code>User-Agent: okhttp/4.x.x</code></p>
<p><em>验证完记得改回来，通常我们开发用 <code>addInterceptor</code> 就够了，<code>addNetworkInterceptor</code> 会打印一些底层的、解压前的数据，有时候比较乱</em></p>
<h4 data-id="heading-19">方法二：使用 Android Studio Network Inspector（不用改代码）</h4>
<ol>
<li>运行 App。</li>
<li>打开 Android Studio 底部的 <strong>App Inspection</strong> 或 <strong>Network Inspector</strong> 标签页。</li>
<li>点击发起一个网络请求。</li>
<li>点击左侧列表里的请求，查看右侧的 <strong>Request Headers</strong>。</li>
<li>会看到 <code>Connection: Keep-Alive</code> 赫然在列。这是最真实的、发给服务器的数据。</li>
</ol>
<hr/>
<h3 data-id="heading-20">4. 源码验证（核心证据）</h3>
<p>既然想看源码实现，这个逻辑在 <code>okhttp3.internal.http.BridgeInterceptor</code> 类中</p>
<p>OkHttp 的责任链模式中，<code>BridgeInterceptor</code> 专门负责把用户的请求转换为网络友好的请求</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// OkHttp 源码：BridgeInterceptor.kt</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BridgeInterceptor</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> cookieJar: CookieJar) : Interceptor {

  <span class="hljs-meta">@Throws(IOException::class)</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">intercept</span><span class="hljs-params">(chain: <span class="hljs-type">Interceptor</span>.<span class="hljs-type">Chain</span>)</span></span>: Response {
    <span class="hljs-keyword">val</span> userRequest = chain.request()
    <span class="hljs-keyword">val</span> requestBuilder = userRequest.newBuilder()

    <span class="hljs-comment">// ... 省略其他 Header 设置 (Content-Type, Content-Length 等)</span>

    <span class="hljs-comment">// 重点在这里！！！</span>
    <span class="hljs-keyword">if</span> (userRequest.header(<span class="hljs-string">"Connection"</span>) == <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// 如果用户没有自己设置 Connection Header，OkHttp 帮加上 Keep-Alive</span>
      requestBuilder.header(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"Keep-Alive"</span>)
    }

    <span class="hljs-comment">// ... 省略 Gzip 设置 (Accept-Encoding)</span>

    <span class="hljs-keyword">val</span> networkResponse = chain.proceed(requestBuilder.build())
    
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p><strong>代码逻辑解读：</strong>
它检查 <code>userRequest.header("Connection") == null</code>。
没有设置，所以它确实是空的
于是它执行 <code>requestBuilder.header("Connection", "Keep-Alive")</code>。</p>
<p>这就是为什么没写，但它确实存在，且 OkHttp 会帮助维护连接池的原因</p>
<br/>
<p><strong>设定：</strong></p>
<ul>
<li><strong>某个App</strong>：OkHttp 配置了 100 年的连接超时，极其自信地认为连接活着</li>
<li><strong>Server</strong>：现实且冷酷，60秒没收到数据，直接踢人</li>
<li><strong>Android 底层</strong>：负责搬运 TCP 数据包的系统内核</li>
</ul>
<p>当 Server 销毁连接（发送 TCP <code>FIN</code> 包）后，你的 App 会经历以下几个阶段的“挣扎”和“幻灭”：</p>
<hr/>
<h3 data-id="heading-21">第一阶段：Server 动手了（TCP FIN）</h3>
<ol>
<li><strong>服务器端</strong>：计时器到了，Nginx 发送一个 <strong><code>FIN</code></strong> (Finish) 包给你的手机，意思是：“我不玩了，挂电话吧”</li>
<li><strong>手机操作系统（Linux内核）</strong>：收到了 <code>FIN</code> 包
<ul>
<li>内核自动回复一个 <code>ACK</code></li>
<li>内核把这个 Socket 的状态标记为 <strong><code>CLOSE_WAIT</code></strong>（被动关闭等待）</li>
<li><strong>关键点</strong>：此时，你的 <strong>App 进程（Java层/OkHttp）可能还完全不知情！</strong> 除非 App 此时此刻正好在读写这个 Socket。如果 App 只是把它放在连接池里睡觉，App 根本收不到通知</li>
</ul>
</li>
</ol>
<h3 data-id="heading-22">第二阶段：App 醒来，取出“僵尸连接”</h3>
<p>过了 10 分钟，用户点了一个按钮。OkHttp 接到任务，去连接池找连接</p>
<ol>
<li><strong>OkHttp</strong>：看了一眼连接池：“嘿，这有个连接，过期时间是 2125 年。太棒了，还没过期！”</li>
<li><strong>健康检查（Crucial Step）</strong>：OkHttp 其实很鸡贼，它拿出来之前会<strong>试探性</strong>地检查一下连接是否健康（<code>isHealthy</code> 方法）。
<ul>
<li>它会尝试读取一下 Socket 的状态，或者判断 <code>socket.isClosed()</code>。</li>
<li><strong>悲剧的分岔路</strong>：
<ul>
<li><strong>情况 A（运气好）</strong>：OkHttp 发现 Socket 已经是 <code>CLOSE_WAIT</code> 或者输入流已经关闭了。它会叹口气：“唉，虽然没到 100 年，但它死了。” —— <strong>动作：默默销毁，重新建立新连接。</strong>（用户无感知，只是稍微慢一点点）。</li>
<li><strong>情况 B（运气差/竞态条件）</strong>：如果操作系统还没来得及同步状态，或者检测机制漏网，OkHttp 会误判它是健康的。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-23">第三阶段：向“僵尸”尸体开枪（写入数据）</h3>
<p>假设 OkHttp 误判连接是活的（或者连接被取出的那一毫秒是活的，下一毫秒 Server 的 FIN 到了）：</p>
<ol>
<li><strong>写入请求（Write）</strong>：OkHttp 开始往 <code>OutputStream</code> 里写 HTTP 请求头（GET /v1/...）。</li>
<li><strong>系统内核反应</strong>：
<ul>
<li>因为 Socket 处于 <code>CLOSE_WAIT</code> 或类似状态，或者 Server 那边已经发送了 <code>RST</code> (Reset，表示你发错人了，我不认识这个连接)</li>
<li>当试图往一个对方已经关闭的连接里写数据时，会触发 <strong><code>SocketException: Broken pipe</code></strong> （管道破裂）或者 <strong><code>SocketException: Software caused connection abort</code></strong>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-24">第四阶段：惊慌与补救（Retry）</h3>
<p>这时候 App 抛出了异常 <strong>会 Crash 吗？</strong></p>
<p><strong>通常不会 Crash，但会经历一次“剧烈震荡”</strong></p>
<p>OkHttp 默认开启了 <strong><code>retryOnConnectionFailure</code></strong>（失败重试）</p>
<ol>
<li><strong>捕获异常</strong>：OkHttp 的拦截器链条捕获到了这个 <code>SocketException</code>。</li>
<li><strong>判定</strong>：它会分析：“这是一个网络层面的路由故障？还是我复用的这个旧连接有问题？”
<ul>
<li>结论：“这大概率是因为我复用了旧连接，但旧连接坏了。”</li>
</ul>
</li>
<li><strong>亡羊补牢</strong>：
<ul>
<li>OkHttp 会<strong>立刻把这个 100 年的连接丢进垃圾桶（关闭 Socket）</strong>。</li>
<li><strong>重新走冷启动流程</strong>：DNS 解析 -&gt; TCP 握手 -&gt; TLS 握手 -&gt; 建立<strong>全新</strong>的连接。</li>
<li><strong>再次发送请求</strong>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-25">最终结果：用户的感知</h3>
<p>虽然设置了 100 年缓存想让 App 变快，但结果适得其反：</p>
<ol>
<li>
<p><strong>延迟增加（抖动）</strong>：</p>
<ul>
<li>正常复用：50ms。</li>
<li>正常新建：300ms。</li>
<li><strong>你的“僵尸”复用</strong>：50ms (尝试复用) + 10ms (报错) + 300ms (新建重试) = <strong>360ms</strong>。</li>
<li><strong>结论</strong>：比不缓存还要慢！</li>
</ul>
</li>
<li>
<p><strong>潜在的“请求失败”风险（POST 请求）</strong>：</p>
<ul>
<li>如果是 <code>GET</code> 请求，OkHttp 敢大胆重试。</li>
<li>如果是 <strong><code>POST</code> 请求</strong>（比如提交订单）：
<ul>
<li>OkHttp 可能会犹豫：“刚才那半截数据发出去了吗？服务器收到了吗？如果我重试，会不会导致用户重复下单？”</li>
<li>为了安全，OkHttp 有时会<strong>放弃重试</strong>，直接抛出异常给业务层。</li>
<li><strong>用户界面</strong>：弹出 Toast “网络请求失败”，用户一脸懵逼（明明信号满格）。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-26">总结</h3>
<p>如果设置 100 年超时：</p>
<ol>
<li><strong>服务端</strong>会无视你，到时间就把连接掐断（Close FD）。</li>
<li><strong>Android 底层</strong>知道连接断了，标记为不可用。</li>
<li><strong>App (OkHttp)</strong> 可能会被“连接池里的过期时间”欺骗，拿出一个<strong>已经死掉的连接</strong>试图使用。</li>
<li><strong>结果</strong>：写入失败 -&gt; 触发异常 -&gt; 触发重试（或者直接报错）。</li>
</ol>
<p>这就像保存了一张 100 年有效期的“餐厅订座券”，但去的时候，那家餐厅早就倒闭或者换锁了。你拿着券在门口干瞪眼（报错），最后还得重新找一家新餐厅（重建连接）</p>
<p><strong>所以，OkHttp 默认的 5 分钟，是经过精确计算的“保鲜期”。</strong> 超过 5 分钟，它假设这盘菜大概率馊了，宁愿倒掉也不给你吃，免得你拉肚子（报错）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[百度百舸面向百度天池超节点的大模型推理引擎优化，持续降低昆仑芯 XPU 的 token 成本]]></title>    <link>https://juejin.cn/post/7591403124327563327</link>    <guid>https://juejin.cn/post/7591403124327563327</guid>    <pubDate>2026-01-05T06:30:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591403124327563327" data-draft-id="7591407298414608390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="百度百舸面向百度天池超节点的大模型推理引擎优化，持续降低昆仑芯 XPU 的 token 成本"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-05T06:30:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="百度智能云技术站"/> <meta itemprop="url" content="https://juejin.cn/user/3472695814005120"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            百度百舸面向百度天池超节点的大模型推理引擎优化，持续降低昆仑芯 XPU 的 token 成本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3472695814005120/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    百度智能云技术站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:30:01.000Z" title="Mon Jan 05 2026 06:30:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>1. 背景</strong></h3>
<p>超节点作为一种创新的硬件架构，通过构建大规模全互联的 Scale-up 网络，有效突破了传统 8 卡节点在通信上的「互联墙」瓶颈，为上层业务提供了极致的互联带宽与统一显存池化能力，从而实现大模型推理服务性能的跨越式提升。</p>
<p>结合新硬件架构的特性，AI Infra 团队可以基于对上层模型算法特性的深度理解，进一步做 AI 工程上的软件优化，充分释放硬件潜能，在吞吐量、首 Token 延迟（TTFT）、每 Token 处理时间（TPOT）等核心指标上实现突破性增长。 这些 AI Infra 优化不仅显著提升了系统整体效率，更大幅降低了硬件的 Token 的成本，成为企业落地大模型的关键胜负手。</p>
<p>本文将深入拆解百度百舸在超节点部署方案设计与软件优化方面的技术实践，聚焦推理引擎策略、核心算子调优、高效通信调度等关键维度，全面揭示软硬协同如何释放昆仑芯超节点的澎湃算力的底层逻辑与工程密码。</p>
<h3 data-id="heading-1"><strong>2.</strong>  <strong>百度天池超节点部署方案</strong></h3>
<p>百度天池超节点将 32 张昆仑芯 XPU 全互联为更大的 Scale-up 域。在此基础上，为了规划 DeepSeek R1 模型在百度天池超节点的部署方案，我们综合考虑性能要求和资源使用，并在 SLA 与硬件资源上找到配置最优解。</p>
<p>在百度天池超节点上，百度百舸团队基于 SGLang 推理框架和 PD 分离的部署架构，对 DeepSeek R1 模型的推理服务进行深度适配与调优。</p>
<p>通过在部署层面对计算单元、并行策略与资源配比进行精细化规划，使模型计算特性与超节点硬件形态形成高度匹配，从而在严格满足 SLA 约束的前提下，最大化释放硬件算力效率，为后续推理全链路优化奠定基础。</p>
<ul>
<li>在 Prefill 侧，在线服务通常要求 TTFT 控制在 1s 以内，因此需要核算 Prefill 的配置能否满足这个要求，如果不能满足，则需要使用并行策略满足要求。此外，在平衡时延时还需要考虑吞吐，如果吞吐不达标也会造成 Decode 打不满的情况，进而降低 Decode 的吞吐性能；</li>
<li>在 Decode 侧，对单步生成时延（TPOT, Time Per Output Token）要求更为严苛，需低于 50ms 以保证流畅的用户体验，因此需要设计合适的并行策略以及 EP 规模，平衡性能与成本。除此之外，在 PD 分离架构下，Decode 节点需要承载大量的 KV Cache，KV Cache 的预留空间直接决定了系统能支持的最大上下文长度（Context Length）和最大并发数（Batch Size），因此在确保每张卡能放得下模型权重以外，也要为 KV Cache 预留足够的显存容量。</li>
</ul>
<p>综合上述计算特性与资源约束，我们制定了如下部署策略：</p>
<p><strong>Prefill 阶段：</strong></p>
<ul>
<li>
<p>高并行度换取低时延，采用 16 卡作为一个计算单元，使用 TP4（Tensor Parallelism = 4） + SP4（Sequence Parallelism = 4）并行策略。由于 DeepSeek R1 规模巨大，单卡执行大 Batch 的 Prefill 计算耗时极易突破 1s 阈值。通过 TP4 + SP4 将计算负载切分到 4 张卡上并行处理，可以近乎线性地降低单次前向计算时间，从而在保证 TTFT 达标的基础上，留出算力余量来提升 Batch Size，实现高吞吐；</p>
</li>
<li>
<p>对于 128K 等超长文本，我们会采用 TP16 + SP16 或者 TP32 + SP32 等更大的 TP 规模，降低 TTFT；</p>
</li>
<li>
<p>开启 Chunk Prefill，避免长序列请求影响短序列请求的 TTFT。</p>
</li>
</ul>
<p><strong>Decode 阶段：</strong></p>
<ul>
<li>最大化访存效率与通信优化，采用 32 卡作为一个计算单元（占满一个 P900 超节点），使用 TP1（不切分 Tensor Parallel）和 EP32（Expert Parallel）并行策略。由于 Decode 阶段是访存敏感型，且算子计算密度低，过高的 TP 会引入频繁的跨卡 AllReduce 通信，导致通信开销占比过高，严重拖累 TPOT。因此，我们策略性地放弃 TP 切分（TP1），转而利用 P900 的 32 卡大显存池，通过数据并行（DP）和专家并行（EP）来保证计算密度和显存容量，最大限度减少小算子的通信损耗。</li>
</ul>
<p><strong>在资源配比与专家策略上：</strong></p>
<ul>
<li>
<p>采用 2P1D 架构。即 1 个 P900 超节点（32 卡）承载 2 个 Prefill 实例（各 16 卡）；另 1 个 P900 超节点承载 1 个 Decode 实例（32 卡）；</p>
</li>
<li>
<p>在专家并行（EP）配置：Prefill (EP16)：单卡承载 16 个专家，利用高计算密度掩盖专家路由开销；Decode (EP32)：单卡承载 8 个专家。通过扩大 EP 规模至 32 卡，将模型专家分散存储，大幅降低了单卡权重显存占用，从而为 KV Cache 腾出宝贵的显存空间，支持更长的上下文；</p>
</li>
<li>
<p>共享专家（Shared Experts）：在 Decode 阶段采用全 DP（Data Parallel） 策略，即共享专家在每张卡上都有一份完整副本，确保这些高频访问的专家无需跨卡通信即可直接调用，进一步降低 TPOT。</p>
</li>
</ul>
<p><strong>量化与精度策略：</strong></p>
<ul>
<li>
<p>量化方案：在算子层面，整体采用 A8W8C16 (Activation 8-bit, Weight 8-bit, Compute / Accumulation 16-bit) 的量化方案，在保证精度稳定性的前提下提升推理性能；</p>
</li>
<li>
<p>MLA 优化：针对 MLA （Multi-Head Latent Attention）架构中的 FlashAttention （FA）算子，我们采用 FP16 精度，以确保长序列下注意力分数的数值稳定性，避免量化带来的精度溢出问题。</p>
</li>
</ul>
<p><strong>调度层面：</strong></p>
<ul>
<li>配合精细化 DP 均衡调度，最大程度的消除 idle batch 占比，避免因为调度问题导致 DP 负载不均，减少 Prefill 侧产生 idle batch 的比例，避免出现大量请求排队的问题，从而提高 Prefill 单卡吞吐。</li>
</ul>
<h3 data-id="heading-2"><strong>3. 百度天池超节点推理性能优化</strong></h3>
<p>基于上述部署方案，在满足 SLA 约束的前提下，为进一步提高 Prefill 和 Decode 的吞吐性能，我们根据各阶段的特性针对性地实施了优化策略：</p>
<ul>
<li>
<p>对于 Prefill 阶段，核心目标是降低 TTFT。由于其计算特性以大规模矩阵计算为主，整体属于计算密集型负载，在超节点架构下算子效率本身并非主要瓶颈。真正限制 Prefill 性能释放的，是计算与通信在时间轴上的串行排布。因此，Prefill 优化的核心思路是通过双流优化与通信优化，将通信开销掩盖在计算过程中，从而在 TTFT 达标的前提下提升整体吞吐；</p>
</li>
<li>
<p>而 Decode 阶段，核心目标是将 TPOT 稳定控制在 50ms 以下，这意味着 run batch 中每一层、每一个算子的执行时间都必须受到严格约束。在这一阶段，推理性能不再取决于单个算子是否足够快，而取决于整个执行链路中是否存在被放大的「微小空泡」。这就需要我们将 Decode 的执行流程进一步拆解为「主模型运行前的组 batch 过程、主模型运行、以及 MTP 投机推理」，再根据不同阶段的性能特征和瓶颈来源，采用相应的优化策略。</p>
</li>
</ul>
<p>基于上述思路，下面将分别对 Prefill 与 Decode 两个阶段的具体优化方法与效果进行详细展开。</p>
<h3 data-id="heading-3"><strong>3.1. Prefill 优化</strong></h3>
<h4 data-id="heading-4"><strong>3.1.1. Prefill Overlap 优化</strong></h4>
<p>Prefill 阶段因上下文长度较长，attention 与 MoE 模块的计算耗时较长，而 MLP 模块中 dispatch 与 combine 两次通信的耗时，与 Attention、MoE 的计算耗时相当。并且在昆仑芯算子的实现中，计算算子与通信算子可在独立资源上并行调度，因此 Prefill 阶段可通过开启双流优化，利用计算耗时掩盖通信耗时，从而缩短整体执行时间。</p>
<p>以「4K 定长上下文、batch=2」的请求为例，开启双流优化后，会将总计 8K 的输入 token（4K×2）拆分为两个 4K 的 micro batch。在 run batch 过程中，两个 micro batch 的 attention 与 MLP 计算交替执行；与此同时，当第一个 micro batch 进行计算时，第二个 micro batch 可同步执行 dispatch 或 combine 通信操作，具体流程如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec6a6b7220ae4c18b8ac7e0db21f6404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=zC3FVBDOX4JM%2FeofibC10URd%2BaY%3D" alt="" loading="lazy"/></p>
<p>这种计算与通信 overlap 的双流优化，在非超节点模式下虽能提升性能，但面对短序列场景时，计算耗时可能不足以完全掩盖通信耗时，便会导致计算资源的闲置，优化效果无法最大化体现。而在超节点模式下，通信耗时显著降低，attention 与 MLP 的计算耗时可完全覆盖 dispatch 与 combine 的通信耗时，便可减少性能空转（bubble），双流优化效果更优。</p>
<p>通过上述双流优化，Prefill 阶段的整体吞吐可提升约 20%。</p>
<h4 data-id="heading-5"><strong>3.1.2. Prefill 通信优化</strong></h4>
<p>由于 Prefill 采用 TP4，因此必然会引入通信过程，我们在通信策略优化的迭代过程如下图所示：</p>
<ul>
<li>
<p>方案一：q_down 和 kv_down 不做序列切分，重复计算；q_up 和 kv_up 按照 num_head 切 TP；MHA 部分也按照 num_head 切分；o_proj 切 TP；最后使用 AllReduce；MLP 部分使用序列切分，MLP 计算完成后 AllGather 聚合结果。</p>
</li>
<li>
<p>方案二：采用 TP + SP，q_down 和 kv_down 采用序列切分；然后 AllGather 汇聚 BS；q_up 和 kv_up 切 TP；MHA 部分按照 num_head 切分；o_proj 切 TP；最后使用 ReduceScatter；进入 MLP 后使用序列切分。</p>
</li>
<li>
<p>方案三：在方案二的基础上，MHA 后使用 AlltoAll；o_proj 不做 TP 切分，采用序列切分。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8067027cedd046a0bde89b2f89dc1059~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=QWVTV5K%2Bue0P%2FgAMqAkiWJR8oUA%3D" alt="" loading="lazy"/></p>
<p>使用方案一：</p>
<ul>
<li>q_down 和 kv_down 存在冗余计算，这部分单卡计算量是方案二和方案三的 4 倍；</li>
<li>通信的部分引入 AllReduce + AllGather，总通信量为: <strong>BS x 16128</strong></li>
<li>
<ul>
<li>AllReduce：</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4de97dd36694bd9a8b046c176b636ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=jmd2QD6kZ7QTfdeKty6kjLr0ddI%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<ul>
<li>AllGather：</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7636d1365514fbcb2661428297a9c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=x96S8mSVzEV4i9eMHNOccmFwmTA%3D" alt="" loading="lazy"/></p>
<p>使用方案二：</p>
<ul>
<li>通信的部分引入 AllGather + ReduceScatter，总通信量为: <strong>BS x 5772</strong></li>
<li>
<ul>
<li>AllGather <strong>：</strong></li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dfd19defbc1449da1bb83a0ad67e1d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=J0eh8usIl76yWKeQwuZMy7Qo9CM%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<ul>
<li>ReduceScatter：</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/350a6d711a714f4695be836c4e345635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=hqebGwQzn1VEY1bpM2YKkNNkSpQ%3D" alt="" loading="lazy"/></p>
<p>使用方案三：</p>
<ul>
<li>通信的部分引入了 AllGather + AlltoAll，总通信量为: <strong>BS x 3468</strong></li>
<li>
<ul>
<li>AllGather：</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e09df2a90720474d9d0284f5c93ad063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=V1XVijyoIsshtGcIxV%2BK9E%2BfgMU%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<ul>
<li>AlltoAll <strong>：</strong></li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27e7fe38e54b4b879af48a45803a0ddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=unsqCaoTQrMQAIpngFKSJg3EML8%3D" alt="" loading="lazy"/></p>
<p>可以看到：方案三的通信量最少，这也是我们所采用的 Prefill 通信方案。</p>
<h4 data-id="heading-6"><strong>3.1.3. Prefill 长序列优化</strong></h4>
<p>面向 128K 的长序列输入时，Prefill 的计算压力异常大。为此，我们充分利用了超节点更大 Scale up 域的优势，针对长序列 Prefill 使用了更大的 TP 范围（如 TP16 + SP16、TP32 + SP32）。借此，一方面可以减少单卡的计算量，缩短整体计算时间，从而降低 TTFT，另一方面可以降低单卡的显存使用量，提高 chunk size 的大小，从而进一步提高单卡吞吐。</p>
<p>在128K 长序列场景中，TTFT 可缩小 5 倍以上，单卡吞吐可提高 80%。</p>
<h3 data-id="heading-7"><strong>3.2. Decode 优化</strong></h3>
<p>Decode 阶段包含「主模型运行前的组 batch 过程、主模型运行、以及 MTP 投机推理」三个部分。基于各部分的业务逻辑分析，我们针对「主模型运行阶段」进行了主模型 Overlap 和算子优化，并针对「组 batch 和 MTP 投机推理」阶段进行了算子缝隙优化。</p>
<h4 data-id="heading-8"><strong>3.2.1. Decode 主模型 Overlap 优化</strong></h4>
<p>Decode 侧未开启双流优化，核心基于两方面考量：</p>
<ul>
<li>受 TPOT 约束，Decode 侧的 batch 通常较小，并且 Decode 属于访存密集型，小 batch 下 GEMM 运算的 TFLOPS 本就较低，拆分 batch 不仅难以获得显著收益，反而可能出现负收益；</li>
<li>依托百度天池超节点更高的通信效率，通信耗时在单层执行时间的占比不足 15%，且与计算耗时差距显著。此时通过双流优化掩盖通信耗时的收益有限，不足以抵消算子效率下降带来的额外开销。</li>
</ul>
<p>因此，Decode 侧未采用拆 batch 的方式，转而探索单流执行场景下的优化空间：寻找互不依赖、且可调度至不同资源并行执行（overlap）的算子组合。依此，我们将运行在 cluster 上的 combine 算子与运行在 SDNN 的共享专家（shared expert）计算进行并行调度：在 combine 算子执行期间，同步运行共享专家的计算逻辑，待二者均完成后，再执行路由专家与共享专家的结果合并。</p>
<p>下图中黄色表示运行在 cluster 上的算子，蓝色表示运行在 SDNN 上的算子。优化前所有的通信和计算算子都在一条 stream1 上运行；优化后 stream1 在 cluster 资源上运行 combine 通信算子的同时，并行的 stream2 在 SDNN 资源上运行共享专家，以实现资源的最大化复用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fc3ee4674a8499091db9db7904e4324~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=h5HCZwJTwo1khQ8W4wWsCbMKG5k%3D" alt="" loading="lazy"/></p>
<p>通过上述主模型的 Overlap 优化，Decode 阶段的TPOT 降低约 7%。</p>
<h4 data-id="heading-9"><strong>3.2.2. Decode 主模型算子优化</strong></h4>
<p>百度天池超节点更大的 Scale-up 域为大规模并行计算提供了极致的通信效率，因此计算算子的耗时会更加凸显。</p>
<h5 data-id="heading-10"><strong>3.2.2.1. Decode 主模型计算算子优化</strong></h5>
<p>除了前面提到的部分计算算子可以被通信 overlap 之外，我们针对 Decode 单层执行的所有算子做了 Trace 分析，尝试找出哪些算子存在瓶颈，及其是否有优化空间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a8bc4e57b5b49e1a575cc9bd4afd3ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=ktwiNl44U51DGnmUaRD8QJbF7RU%3D" alt="" loading="lazy"/></p>
<p>该表格主要列举了：Decode 单层执行的所有算子中，attention 所有算子在 attention 整体时间的占比。</p>
<p><em>特别说明：</em></p>
<ul>
<li><em>对照 DeepSeek 官方发布的在 H 卡的 decode trace 信息；</em></li>
<li><em>由于 DeepSeek 官方在 H 卡上 Decode 使用了双 micro batch overlap，而且 EP 规模与我们配置不同，因此我们只对比 attention 部分的算子占比；</em></li>
<li><em>虽然两个场景的 batch 大小不一样，但是输入长度一致，因此 attention 部分的算子占比也能说明各算子的性能表现。</em></li>
</ul>
<p>通过对比和分析，我们看到：</p>
<ul>
<li>q_k_up_absorb: bmm 和 v_up_absorb: bmm 这两个矩阵的吸收算子，百度天池超节点算子占比明显高于 H 卡表现。经过进一步分析，我们发现这两个部分的小算子太多，于是我们进行了算子融合优化，最终合成一个 fc_batch 的算子，节省了一倍以上的算子执行时间；<br/>
优化后的效果体现如下图所示：q_k_up_absorb: bmm 的算子占比从 7.422% 下降到 5.803%；v_up_absorb: bmm 的占比从 6.901% 下降到 4.910%</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/979d729d85314b0281dfd042bfb04442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=RhhFKX8OF6EuuYb89UhVL7jLrvk%3D" alt="" loading="lazy"/></p>
<ul>
<li>attn_mqa 算子的耗时显著高于其它算子，基于我们的过往经验判断，该算子具有一定的优化空间。对此，在做 fa 计算之前我们消除掉了不必要的 memcpy 操作和 reshape 等小算子；在 fa 计算之后，我们消除掉了量化 cast 操作，让后续 GEMM 算子的输入匹配 fa 算子的输出；</li>
<li>针对所有的 GEMM 算子，我们使用 autotune，让 GEMM 算子在不同的 batch size 和 sequence length 下自动使用最佳配置，保持最佳性能。</li>
</ul>
<p>通过主模型的计算算子优化，attention 部分总体时延降低 11.5%，Decode 阶段的 TPOT 降低约 8%。</p>
<h5 data-id="heading-11"><strong>3.2.2.2. Decode EP 通信算子优化</strong></h5>
<p>我们在通信算子的优化措施主要包括两方面：</p>
<ul>
<li>
<p>combine 及 dispatch 的数据传输优化：针对不同 EP 规模与传输 token 数量，算子自动选择最优发送策略，充分释放硬件资源潜力；</p>
</li>
<li>
<p>combine 算子优化：在 reduce 计算过程中，通过消除中间结果的冗余量化与存储步骤，直接提升 reduce 计算效率。</p>
</li>
</ul>
<p>经过以上优化，再结合硬件性能提升，通信时间在单层执行时间的占比从 40% 降到 15%，而整个 Decode 要进行 59 次（ 58 个 MoE 层 + 1 个 MTP 层）这样的通信，耗时可被显著压缩。</p>
<p>下图展示了 dispatch 与 combine 在不同 token 数量、EP 规模场景下的通信时延。从数据可见：在 EP32、96token 的典型场景中（该场景满足 TPOT &lt; 50ms)，dispatch 时延仅 80.419μs，combine 时延仅 105.466μs。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/383ca572e3874f5fb39fe2e3bb8d8861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=yEcVteD%2F1KCR%2FVjJUjxtn7JJhfk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12"><strong>3.2.3. Decode 算子缝隙优化</strong></h4>
<h5 data-id="heading-13"><strong>3.2.3.1. MTP 层缝隙优化</strong></h5>
<p>MTP 投机推理是 Decode 阶段降低 TPOT 的成熟且高效的技术路径：通过在主模型前引入 draft 模型，从而在 Decode 阶段可一次生成多个 token，降低 TPOT、提升吐字率，优化用户交互体验。</p>
<p>在我们的 MTP 方案实现中，主模型运行结束后会执行 verify 校验 —— 对比本次主模型输出 token 与上一轮 draft 模型的预测 token：若二者一致，则说明上一轮 draft 模型预测准确，且主模型基于该预测 token 生成的 token 同样有效，此时可将两个 token 同步输出。</p>
<p>整体流程如下图所示，由于 verify 的校验逻辑涉及大量 CPU 的 H2D 和 D2H 等同步操作，当下图中 CPU 执行 D2H-1 操作时，需等待 XPU 侧执行完 D2H-1 后才能执行 D2H-2 操作，此时会造成 D2H-2 的启动 （Launch）开销无法被掩盖，因此产生算子缝隙，同理，后续 MTP 层由于也无法被提前启动，同样会产生算子缝隙。</p>
<p>对此，我们对 verify 的过程进行优化 —— 消除掉一些 H2D 和 D2H 操作，并将 verify 过程拆成两个部分：将无法消除掉的包含 H2D 和 D2H 的 verify2 部分移动到 MTP 层后面，剩余 verify1 的部分和 MTP 层可被提前启动，以此消除掉算子缝隙。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9808bdad5d6482bbeb5b618b77b8bd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=FXJQ0UFbqoeNY%2BOsrkZo56XUNxs%3D" alt="" loading="lazy"/></p>
<p>经过优化后，TPOT 可降低约 5%。</p>
<h5 data-id="heading-14"><strong>3.2.3.2. 组 batch 缝隙优化</strong></h5>
<p>Decode 阶段在运行主模型前需执行组 batch 操作，该过程包含大量 CPU 操作且难以剔除。为此，我们通过提前启动下一个 batch 的 XPU 算子，使组 batch 操作与本次 batch 的 XPU 运算（run batch）重叠执行，从而掩盖组 batch 的耗时。</p>
<p>具体方案如下图所示（同一种颜色代表一个请求）：</p>
<ul>
<li>Process: CPU 侧的组 batch + 主模型启动操作；</li>
<li>Schedule: XPU 侧的主模型 + MTP 模型运算；</li>
<li>Post Process: 请求完全结束后的 CPU 后续处理。</li>
</ul>
<p>流程优化逻辑如下：当第一个请求的 XPU 算子执行时，提前启动下一个请求的组 batch 与算子启动流程，此时组 batch 耗时可被完全掩盖；第一个 batch 的 XPU 运算完成后，CPU 执行后续处理，随后触发已提前启动的下一个 XPU 算子。依此循环，组 batch 耗时可被彻底消除。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c55234dc85524118a40d72428e138867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m-5bqm5pm66IO95LqR5oqA5pyv56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768199401&amp;x-signature=5ONphNH8ad3Fa1PNNgjz2mn1hSQ%3D" alt="" loading="lazy"/></p>
<p>经过优化后，TPOT 可降低约 10%。</p>
<h2 data-id="heading-15"><strong>4. 总结与展望</strong></h2>
<p><strong>百度天池超节点推理性能优化实战成效</strong></p>
<p>百度天池超节点通过「PD 分离架构 - 硬件升级 - 软件深耕」的三阶优化路径，实现大模型推理性能的跨越式突破，充分验证了昆仑芯与百度百舸的软硬协同优势：</p>
<ul>
<li>
<p>第一阶段以架构革新破除性能瓶颈，在大规模部署场景下，通过 EP 分离 + PD 分离的创新架构设计，直接实现推理性能 10 倍跃升，为后续优化奠定坚实基础；</p>
</li>
<li>
<p>第二阶段聚焦硬件潜能释放与软件深度适配，将传统 8 卡全互联架构升级为 32 卡超节点全互联，并通过算子融合、通信调度等全栈软件优化，彻底激活硬件算力。</p>
</li>
</ul>
<p>在 4K 输入上下文场景下：</p>
<p>Prefill 阶段单卡吞吐达 4.1K，较 PD 分离架构下非超节点硬件形态的 P800 提升 45%；Decode 阶段单卡吞吐突破 1.006K，较前者实现了 168%的性能提升，且核心延迟指标 TPOT 仅为 47.6ms。</p>
<p><strong>未来展望</strong></p>
<p>在当前市场阶段，千亿参数级模型仍是主流。我们认为，32/64 卡规模的超节点能够很好的承载推理及训练对算力的需求 —— 它不仅通过大幅扩展 Scale-up 域显著提升了 EP 并行效率，更在成本控制上展现了极高的性价比。百度天池超节点是将极致性能与可落地性深度融合：以高稳定性、快速部署、极简运维构建高效交付闭环，真正实现「以 8 卡机的部署运维体验，兑现超节点的极致算力」。</p>
<p>未来，随着模型的发展与软硬件技术的日趋成熟，更大规模的超节点落地将是必然趋势。面对显存容量瓶颈、KV Cache 空间压力等挑战，我们将通过软硬件深度协同创新，持续支撑更大集群规模与更多样化模型部署需求。</p>
<p>在硬件层面，昆仑芯全新一代产品即将陆续面世，百度天池超节点的 Scale-up 域将进一步扩展至 512 卡规模，全力支撑万亿参数模型的极限挑战；而在软件层面，面向刚刚发布的 DeepSeek V3.2，以及未来大量模型的持续迭代，软件优化工作也将永不停歇。</p>
<p>通过硬件与软件的协同创新，百度智能云将不断突破超节点性能上限、下探每 Token 算力成本，既支撑企业快速落地超节点，更通过长期技术迭代与企业共同兑现超节点「越用越优」的业务价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent案例实践：三种智能体开发模式详解之一（手写代码）]]></title>    <link>https://juejin.cn/post/7591407298414493702</link>    <guid>https://juejin.cn/post/7591407298414493702</guid>    <pubDate>2026-01-05T06:04:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591407298414493702" data-draft-id="7591403124327399487" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent案例实践：三种智能体开发模式详解之一（手写代码）"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-01-05T06:04:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="木昆子"/> <meta itemprop="url" content="https://juejin.cn/user/825103640698564"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent案例实践：三种智能体开发模式详解之一（手写代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/825103640698564/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    木昆子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:04:30.000Z" title="Mon Jan 05 2026 06:04:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在大模型与智能体应用场景层出不穷的今天，作为一名不断学习的信息化数字化从业者，我们可以实践一下AI Agent基本开发流程，理论联系实践，以加深我们对AI Agent的了解。</p>
<h2 data-id="heading-0">一、案例描述</h2>
<h3 data-id="heading-1">1.1. 业务场景</h3>
<p>这里我们设计一个简单的场景：2025年，一位高三的同学在高考结束之后，借助AI Agent简单的查询了解一下2016年到2024的考生人数、录取人数、复读人数、普通高校数量、本科录取人数、专科录取人数这些基本信息，对历年高考考生规模做一个基本了解，借助小助手做一个简单分析预测。</p>
<p>基于这个场景，我们梳理一下我们的Agent需要实现的功能：用户输入自然语言查询高考录取相关信息，Agent自动生成查询SQL，查询完毕后附带简要分析输出，具体如下：</p>
<ul>
<li>结构化的数据需要后台运维，进行持久化存储，采用Mysql存储，涉及多张表的数据；</li>
<li>元数据结构采用ElasticSearch8存储，可向量化KNN匹配；</li>
<li>自然语言解析出查询SQL需要借助大模型匹配元数据结构，然后编写提示词生成SQL；</li>
<li>生成的SQL需要到Mysql查询数据；</li>
<li>查询完毕的数据还需要借助大模型分析一下返回。</li>
</ul>
<h3 data-id="heading-2">1.2. 数据准备</h3>
<p>对于高考信息，我们需要存储到Mysql的结构化的表中，以便搜索查询数据，表结构如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> college_entrance_examination;  
droptable college_entrance_admission;  
createtable college_entrance_examination (  
    examination_year              integerNOTNULL COMMENT <span class="hljs-string">'高考年份'</span>,  
    candidates_count              <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) NOTNULL COMMENT <span class="hljs-string">'考生人数(万人)'</span>,  
    retake_count                  <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'复读人数(万人)'</span>,  
    <span class="hljs-keyword">primary</span> key (examination_year)  
) comment <span class="hljs-string">'考生人数与复读人数信息表，包含字段：高考年份(主键)、考生人数(万人)、复读人数(万人)'</span>;  
  
createtable college_entrance_admission (  
    admission_year              integerNOTNULL COMMENT <span class="hljs-string">'录取年份'</span>,  
    admission_count               <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) NOTNULL COMMENT <span class="hljs-string">'录取人数(万人)'</span>,  
    university_count              <span class="hljs-type">integer</span> COMMENT <span class="hljs-string">'普通高中招生高校数'</span>,  
    undergraduate_admission_count    <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'本科录取人数(万人)'</span>,  
    specialty_admission_count   <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) COMMENT <span class="hljs-string">'专科录取人数(万人)'</span>,  
    <span class="hljs-keyword">primary</span> key (admission_year)  
) comment <span class="hljs-string">'录取人数与普通高校数信息表，包含字段：录取年份(主键)、录取人数(万人)、普通高中招生高校数、本科录取人数(万人)、专科录取人数(万人)'</span>;
</code></pre>
<p>数据如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> college_entrance_examination(  
    examination_year,candidates_count,retake_count  
) <span class="hljs-keyword">values</span>  
(<span class="hljs-number">2016</span>,<span class="hljs-number">940</span>,<span class="hljs-number">117</span>),  
(<span class="hljs-number">2017</span>,<span class="hljs-number">940</span>,<span class="hljs-number">143.39</span>),  
(<span class="hljs-number">2018</span>,<span class="hljs-number">975</span>,<span class="hljs-number">172.1</span>),  
(<span class="hljs-number">2019</span>,<span class="hljs-number">1031</span>,<span class="hljs-number">230.95</span>),  
(<span class="hljs-number">2020</span>,<span class="hljs-number">1071</span>,<span class="hljs-number">242.2</span>),  
(<span class="hljs-number">2021</span>,<span class="hljs-number">1078</span>,<span class="hljs-number">187</span>),  
(<span class="hljs-number">2022</span>,<span class="hljs-number">1193</span>,<span class="hljs-number">316.56</span>),  
(<span class="hljs-number">2023</span>,<span class="hljs-number">1291</span>,<span class="hljs-number">210</span>),  
(<span class="hljs-number">2024</span>,<span class="hljs-number">1342</span>,<span class="hljs-number">413</span>)  
;  
  
insertinto college_entrance_admission(  
    admission_year,admission_count,university_count,  
    undergraduate_admission_count,specialty_admission_count  
) <span class="hljs-keyword">values</span>  
(<span class="hljs-number">2016</span>,<span class="hljs-number">772</span>,<span class="hljs-number">2595</span>,<span class="hljs-number">405</span>,<span class="hljs-number">367</span>),  
(<span class="hljs-number">2017</span>,<span class="hljs-number">761.49</span>,<span class="hljs-number">2631</span>,<span class="hljs-number">410</span>,<span class="hljs-number">351</span>),  
(<span class="hljs-number">2018</span>,<span class="hljs-number">790.99</span>,<span class="hljs-number">2663</span>,<span class="hljs-number">422</span>,<span class="hljs-number">369</span>),  
(<span class="hljs-number">2019</span>,<span class="hljs-number">820</span>,<span class="hljs-number">2688</span>,<span class="hljs-number">431</span>,<span class="hljs-number">389</span>),  
(<span class="hljs-number">2020</span>,<span class="hljs-number">967.45</span>,<span class="hljs-number">2740</span>,<span class="hljs-number">443</span>,<span class="hljs-number">524.45</span>),  
(<span class="hljs-number">2021</span>,<span class="hljs-number">1001.32</span>,<span class="hljs-number">2759</span>,<span class="hljs-number">448.74</span>,<span class="hljs-number">552.58</span>),  
(<span class="hljs-number">2022</span>,<span class="hljs-number">1014.54</span>,<span class="hljs-number">2760</span>,<span class="hljs-number">467.18</span>,<span class="hljs-number">547.36</span>),  
(<span class="hljs-number">2023</span>,<span class="hljs-number">1058.21</span>,<span class="hljs-number">2820</span>,<span class="hljs-number">482.89</span>,<span class="hljs-number">575.32</span>),  
(<span class="hljs-number">2024</span>,<span class="hljs-number">1068.9</span>,<span class="hljs-number">2868</span>,<span class="hljs-number">478.16</span>, <span class="hljs-number">590.74</span>)  
;
</code></pre>
<p>注1：上述高考考生基本数据来源于互联网、教育局网站。</p>
<p>注2：具体业务上可能远远不止一个数据源、两张表，需要根据用户问题使用RAG检索匹配具体使用哪个数据源的哪个表，本次实践仅仅使用两张表模拟多数据源的业务场景，为语义匹配流程开发做一个学习与了解！</p>
<p>接下来我们分别用手写代码、基于LangChain框架、基于QwenAgent框架等三种不同的模式进行AI Agent的实践探索。</p>
<h2 data-id="heading-3">二、开发实践（手写代码）</h2>
<h3 data-id="heading-4">2.1. 总体架构</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87faecf36c9b4246a6fc6c5eff5d2a7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5piG5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768197870&amp;x-signature=oyaFsbxV0WKWV1tHKrBmcFNejW4%3D" alt="" loading="lazy"/></p>
<p>1、API服务(API Service)对智能体提供类似MCP的工具服务；</p>
<p>2、智能体(AI Data Analysis Agent)对用户输入的自然语言查数进行回答，执行过程中调用相应的API服务；</p>
<p>3、同时智能体具有简单的容错流程：未匹配到元数据时结束流程并进行提示、生成的SQL未查询到数据时结束流程并进行提示；</p>
<h3 data-id="heading-5">2.2. 实现流程</h3>
<p>按照我们上面的核心业务梳理实现流程，手写一个Workflow，主要是根据用户问题，先匹配数据源的表结构，再生成SQL、查数和分析。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cce8ff1f3c894390acaa8d6f295286ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyo5piG5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768197870&amp;x-signature=QQU3UdRknnUxIkDrlE%2FKEctgwt0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">2.3. 智能体代码实践</h4>
<p>具体开发实现如下(agent_service.py)：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys  
<span class="hljs-keyword">import</span> re  
<span class="hljs-keyword">import</span> json  
<span class="hljs-keyword">from</span> api_service <span class="hljs-keyword">import</span> QueryService,SemanticServce,AnalysisService  
  
<span class="hljs-comment"># metadata init  元数据初始向量化过程  </span>
definit():  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始执行方法init"</span>)  
    queryService = QueryService()  
    semanticService = SemanticServce()  
    <span class="hljs-comment"># 1. 从mysql中获取表结构元数据信息  </span>
    results = queryService.query(  
        <span class="hljs-string">"""  
        SELECT  
            t.TABLE_NAME AS '表名',  
            t.TABLE_COMMENT AS '表备注',  
            c.COLUMN_NAME AS '字段名',  
            c.COLUMN_TYPE AS '字段类型',  
            c.COLUMN_COMMENT AS '字段备注'  
        FROM  
            INFORMATION_SCHEMA.TABLES t  
        INNER JOIN  
            INFORMATION_SCHEMA.COLUMNS c  
            ON t.TABLE_NAME = c.TABLE_NAME AND t.TABLE_SCHEMA = c.TABLE_SCHEMA  
        WHERE  
            t.TABLE_SCHEMA = 'chaiys'  
            and t.table_name in ('college_entrance_admission','college_entrance_examination')  
        ORDER BY  
            t.TABLE_NAME,  
            c.ORDINAL_POSITION  
        """</span>  
    )  
    table_data = {}  
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> results:  
        table_name = row[<span class="hljs-number">0</span>]  
        <span class="hljs-keyword">if</span> table_name notin table_data:  
            table_data[table_name] = {  
                <span class="hljs-string">'表名'</span>: table_name,  
                <span class="hljs-string">'表备注'</span>: row[<span class="hljs-number">1</span>],  
                <span class="hljs-string">'字段列表'</span>: []  
            }  
          
        <span class="hljs-comment"># 添加字段信息  </span>
        table_data[table_name][<span class="hljs-string">'字段列表'</span>].append({  
            <span class="hljs-string">'字段名'</span>: row[<span class="hljs-number">2</span>],  
            <span class="hljs-string">'字段类型'</span>: row[<span class="hljs-number">3</span>],  
            <span class="hljs-string">'字段备注'</span>: row[<span class="hljs-number">4</span>]  
        })  
      
    <span class="hljs-built_in">print</span>(table_data)  
    semanticService.create_index()  
    <span class="hljs-comment"># 转换为列表形式  </span>
    <span class="hljs-keyword">for</span> table_name inlist(table_data.keys()):  
        table = table_data[table_name]  
        <span class="hljs-comment"># 2. 向量化表结构元数据信息并插入ES索引  </span>
        semanticService.vectorize_and_index(table_name, json.dumps(table, ensure_ascii=<span class="hljs-literal">False</span>))  
  
<span class="hljs-comment"># agent flow  智能体核心流程  </span>
defchat(user_query):  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"执行方法chat"</span>)  
    queryService = QueryService()  
    semanticService = SemanticServce()  
    analysisService = AnalysisService()  
    <span class="hljs-comment"># 1. 语义匹配  </span>
    table = semanticService.hybrid_search(user_query, <span class="hljs-number">1</span>)  
    ifnot table:  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"未匹配到字段"</span>)  
        <span class="hljs-keyword">return</span>  
    table_list = [t[<span class="hljs-string">"table_info"</span>] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> table]  
    prompt = <span class="hljs-string">f"""  
        你是一个MySQL专家。根据以下表结构信息：  
        <span class="hljs-subst">{table_list}</span>  
          
        用户查询："<span class="hljs-subst">{user_query}</span>"  
          
        生成标准MYSQL查询语句。  
        要求：  
        1. 只输出MYSQL语句，不要额外解释  
        2. 根据语义和字段类型，使用COUNT/SUM/AVG等聚合函数进行计算，非必须  
        3. 给生成的字段取一个简短的中文名称  
        输出格式：使用[]包含sql文本即可，不需要其他输出，便于解析，例如:[select 1 from dual]  
    """</span>  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"PROMPT=<span class="hljs-subst">{prompt}</span>"</span>)  
    <span class="hljs-comment"># 2. 大模型生成SQL  </span>
    str1 = analysisService.analysis(prompt)  
    sql = re.search(<span class="hljs-string">r'\[(.*?)\]'</span>, str1, re.DOTALL).group(<span class="hljs-number">1</span>).strip()  
      
    <span class="hljs-comment"># 3. 执行查询  </span>
    <span class="hljs-keyword">if</span> sql:  
        resultSet = queryService.query_with_column(sql)  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"resultSet=<span class="hljs-subst">{resultSet}</span>"</span>)  
          
        <span class="hljs-comment"># 基础分析  </span>
        prompt2 = <span class="hljs-string">f"""  
            根据以下表结构信息：  
            <span class="hljs-subst">{table_list}</span>  
            查询SQL：  
            <span class="hljs-subst">{sql}</span>  
            和以下数据信息：  
            <span class="hljs-subst">{resultSet}</span>  
              
            用户查询："<span class="hljs-subst">{user_query}</span>"  
              
            生成一段简要分析，加上一些预测总结的内容  
        """</span>  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"PROMPT=<span class="hljs-subst">{prompt2}</span>"</span>)  
        analysisService.analysis(prompt2)  
  
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:  
    <span class="hljs-comment"># 获取命令行参数  </span>
    args = sys.argv[<span class="hljs-number">1</span>:]  <span class="hljs-comment"># 第一个参数是脚本名，跳过  </span>
      
    ifnot args:  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"请提供参数：init或者chat+user_query"</span>)  
    <span class="hljs-keyword">elif</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">"init"</span>:  
        init()  
    <span class="hljs-keyword">elif</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">"chat"</span>:  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"user_query=<span class="hljs-subst">{args[<span class="hljs-number">1</span>]}</span>"</span>)  
        chat(args[<span class="hljs-number">1</span>])  
    <span class="hljs-keyword">else</span>:  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"未知参数: <span class="hljs-subst">{args[<span class="hljs-number">0</span>]}</span>"</span>)
</code></pre>
<h3 data-id="heading-7">2.4. API服务代码实践</h3>
<p>这里的API服务，指的是为智能体的实现提供服务调用，文件名称api_service.py。</p>
<h4 data-id="heading-8">2.4.1. 语义检索服务(Semantics API)</h4>
<p>语义服务有两个功能：</p>
<p>1、将元数据向量化到ES8，调用文本嵌入向量模型llama2向量化自然语言，生成4096高维向量;</p>
<p>2、自然语言匹配元数据返回，调用文本嵌入向量模型llama2向量化后，调用ES8使用KNN检索topK数据+分词检索topK数据，混合计算得分后返回最终topK,即简化版的外置检索增强生成(RAG);</p>
<p>具体开发实现如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests  
<span class="hljs-keyword">import</span> json  
<span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch  
  
<span class="hljs-comment"># Semantics API  </span>
classSemanticServce:  
    def__init__(self):  
        self.es_client = Elasticsearch(  
            hosts=[<span class="hljs-string">"https://localhost:9200"</span>],  
            basic_auth=(<span class="hljs-string">"elastic"</span>, <span class="hljs-string">"FxCZQXMLEoZLAIvsghQy"</span>),  
            ca_certs=<span class="hljs-string">"./es_http_ca.crt"</span>,  
            verify_certs=<span class="hljs-literal">True</span>  
        )  
        <span class="hljs-comment"># 向量化模型  </span>
        self.ollama_host = <span class="hljs-string">"http://localhost:11434/api/embeddings"</span>  
        self.metadata_index = <span class="hljs-string">"metadata_index"</span>  
        self.modal_name = <span class="hljs-string">"llama2"</span>  
        self.mapping = {  
            <span class="hljs-string">"mappings"</span>: {  
                <span class="hljs-string">"properties"</span>: {  
                    <span class="hljs-string">"table_info"</span>: {  
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,  
                        <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,  <span class="hljs-comment"># 中文分词  </span>
                        <span class="hljs-string">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>  
                    },  
                    <span class="hljs-string">"nomic_embedding"</span>: {  
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"dense_vector"</span>,  
                        <span class="hljs-string">"dims"</span>: <span class="hljs-number">4096</span>,  
                        <span class="hljs-string">"index"</span>: <span class="hljs-literal">True</span>,  
                        <span class="hljs-string">"similarity"</span>: <span class="hljs-string">"cosine"</span>,  
                    }  
                }  
            }  
        }  
  
    defget_embedding(self, text):  
        <span class="hljs-string">"""使用 Ollama 生成文本嵌入向量"""</span>  
        <span class="hljs-keyword">try</span>:  
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"调用大模型llama2向量化：<span class="hljs-subst">{text}</span>"</span>)  
            response = requests.post(self.ollama_host, json={<span class="hljs-string">"model"</span>: self.modal_name, <span class="hljs-string">"prompt"</span>: text})  
            response.raise_for_status()  
            embedding = response.json()[<span class="hljs-string">"embedding"</span>]  
            <span class="hljs-keyword">return</span> embedding  
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">f"嵌入生成失败: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)  
      
    defdelete_index(self):  
        <span class="hljs-string">"""安全删除索引"""</span>  
        <span class="hljs-keyword">try</span>:  
            ifself.es_client.indices.exists(index=self.metadata_index):  
                self.es_client.indices.delete(index=self.metadata_index)  
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"索引 <span class="hljs-subst">{self.metadata_index}</span> 删除成功"</span>)  
                returnTrue  
            returnNone  
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:  
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"删除索引失败: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(e).__name__}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)  
            returnFalse  
  
    defcreate_index(self):  
        self.delete_index()  
        <span class="hljs-string">"""创建支持nomic向量的索引"""</span>  
        self.es_client.indices.create(index=self.metadata_index, body=self.mapping)  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"索引 <span class="hljs-subst">{self.metadata_index}</span> 创建成功"</span>)  
      
    defvectorize_and_index(self, prompt, content):  
        <span class="hljs-string">"""生成文本嵌入向量并插入索引"""</span>  
        doc = {  
            <span class="hljs-string">"table_info"</span>: content,  
            <span class="hljs-string">"nomic_embedding"</span>: self.get_embedding(prompt)  
        }  
        self.es_client.index(index=self.metadata_index, document=doc)  
        self.es_client.indices.refresh(index=self.metadata_index)  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"表信息 <span class="hljs-subst">{prompt}</span>:<span class="hljs-subst">{content}</span> 向量化成功"</span>)  
      
    defsemantic_search(self, user_query, k):  
        <span class="hljs-string">"""执行语义相似度搜索"""</span>  
        query_embedding = self.get_embedding(user_query)  
          
        knn_query = {  
            <span class="hljs-string">"knn"</span>: {  
                <span class="hljs-string">"field"</span>: <span class="hljs-string">"nomic_embedding"</span>,  
                <span class="hljs-string">"query_vector"</span>: query_embedding,  
                <span class="hljs-string">"k"</span>: k,  
                <span class="hljs-string">"num_candidates"</span>: <span class="hljs-number">100</span><span class="hljs-comment"># 这就是ef_search参数  </span>
            },  
            <span class="hljs-string">"_source"</span>: [<span class="hljs-string">"table_info"</span>]  <span class="hljs-comment"># 返回原始问题  </span>
        }  
          
        response = self.es_client.search(index=self.metadata_index, body=knn_query)  
        table_info = [  
            {  
                <span class="hljs-string">"score"</span>: hit[<span class="hljs-string">"_score"</span>],  
                <span class="hljs-string">"table_info"</span>: hit[<span class="hljs-string">"_source"</span>][<span class="hljs-string">"table_info"</span>],  
                <span class="hljs-string">"id"</span>: hit[<span class="hljs-string">"_id"</span>]  
            }  
            <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> response[<span class="hljs-string">"hits"</span>][<span class="hljs-string">"hits"</span>]  
        ]  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"自然语言语义检索字段成功，匹配到的元数据信息：<span class="hljs-subst">{table_info}</span>"</span>)  
        <span class="hljs-keyword">return</span> table_info  
  
    defkeyword_search(self, user_query: <span class="hljs-built_in">str</span>, k) -&gt; <span class="hljs-built_in">list</span>:  
        <span class="hljs-string">"""基于分词的关键词匹配搜索"""</span>  
        search_query = {  
            <span class="hljs-string">"query"</span>: {  
                <span class="hljs-string">"bool"</span>: {  
                    <span class="hljs-string">"should"</span>: [  
                        {  
                            <span class="hljs-string">"match"</span>: {  
                                <span class="hljs-string">"table_info"</span>: {  
                                    <span class="hljs-string">"query"</span>: user_query,  
                                    <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,  <span class="hljs-comment"># 使用IK中文分词器  </span>
                                    <span class="hljs-string">"boost"</span>: <span class="hljs-number">1.0</span>  
                                }  
                            }  
                        },  
                        {  
                            <span class="hljs-string">"match_phrase"</span>: {  
                                <span class="hljs-string">"table_info"</span>: {  
                                    <span class="hljs-string">"query"</span>: user_query,  
                                    <span class="hljs-string">"slop"</span>: <span class="hljs-number">2</span>,  <span class="hljs-comment"># 允许短语间隔  </span>
                                    <span class="hljs-string">"boost"</span>: <span class="hljs-number">0.5</span>  
                                }  
                            }  
                        }  
                    ]  
                }  
            },  
            <span class="hljs-string">"size"</span>: k,  
            <span class="hljs-string">"_source"</span>: [<span class="hljs-string">"table_info"</span>],  
            <span class="hljs-string">"highlight"</span>: {  
                <span class="hljs-string">"fields"</span>: {  
                    <span class="hljs-string">"table_info"</span>: {}  <span class="hljs-comment"># 返回高亮片段  </span>
                }  
            }  
        }  
  
        response = self.es_client.search(index=self.metadata_index, body=search_query)  
  
        table_info = [  
            {  
                <span class="hljs-string">"score"</span>: hit[<span class="hljs-string">"_score"</span>],  
                <span class="hljs-string">"table_info"</span>: hit[<span class="hljs-string">"_source"</span>][<span class="hljs-string">"table_info"</span>],  
                <span class="hljs-string">"id"</span>: hit[<span class="hljs-string">"_id"</span>],  
                <span class="hljs-string">"highlight"</span>: hit.get(<span class="hljs-string">"highlight"</span>, {}).get(<span class="hljs-string">"table_info"</span>, [])  
            }  
            <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> response[<span class="hljs-string">"hits"</span>][<span class="hljs-string">"hits"</span>]  
        ]  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"自然语言分词搜索字段成功，匹配到的元数据信息：<span class="hljs-subst">{table_info}</span>"</span>)  
        <span class="hljs-keyword">return</span> table_info  
  
    defhybrid_search(self, user_query: <span class="hljs-built_in">str</span>, k, alpha: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.7</span>) -&gt; <span class="hljs-built_in">list</span>:  
        <span class="hljs-string">"""混合搜索（语义+关键词）"""</span>  
        <span class="hljs-comment"># 语义搜索  </span>
        semantic_results = self.semantic_search(user_query, k * <span class="hljs-number">2</span>)  
        semantic_map = {hit[<span class="hljs-string">"id"</span>]: hit <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> semantic_results}  
  
        <span class="hljs-comment"># 关键词搜索  </span>
        keyword_results = self.keyword_search(user_query, k * <span class="hljs-number">2</span>)  
        keyword_map = {hit[<span class="hljs-string">"id"</span>]: hit <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> keyword_results}  
  
        <span class="hljs-comment"># 合并结果  </span>
        all_ids = <span class="hljs-built_in">set</span>(semantic_map.keys()) | <span class="hljs-built_in">set</span>(keyword_map.keys())  
        combined = []  
  
        <span class="hljs-keyword">for</span> doc_id <span class="hljs-keyword">in</span> all_ids:  
            semantic_score = semantic_map.get(doc_id, {}).get(<span class="hljs-string">"score"</span>, <span class="hljs-number">0</span>)  
            keyword_score = keyword_map.get(doc_id, {}).get(<span class="hljs-string">"score"</span>, <span class="hljs-number">0</span>)  
  
            combined.append({  
                <span class="hljs-string">"id"</span>: doc_id,  
                <span class="hljs-string">"table_info"</span>: semantic_map.get(doc_id, keyword_map.get(doc_id))[<span class="hljs-string">"table_info"</span>],  
                <span class="hljs-string">"semantic_score"</span>: semantic_score,  
                <span class="hljs-string">"keyword_score"</span>: keyword_score,  
                <span class="hljs-string">"combined_score"</span>: alpha * semantic_score + (<span class="hljs-number">1</span> - alpha) * keyword_score,  
                <span class="hljs-string">"highlight"</span>: keyword_map.get(doc_id, {}).get(<span class="hljs-string">"highlight"</span>, [])  
            })  
  
        <span class="hljs-comment"># 按综合分数排序  </span>
        combined.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"combined_score"</span>], reverse=<span class="hljs-literal">True</span>)  
  
        table_info = combined[:k]  
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"自然语言混合检索字段成功，匹配到的元数据信息：<span class="hljs-subst">{table_info}</span>"</span>)  
        <span class="hljs-keyword">return</span> table_info
</code></pre>
<h4 data-id="heading-9">2.4.2. 大模型调用服务(Analysis API)</h4>
<p>大模型调用服务中，我们直接调用本地部署的deepseek-r1:32b大模型，根据传入的提示词进行处理，可以用于根据自然语言生成SQL即NL2SQL，也可以用于对查询结果数据进行简单总结和分析，具体开发实现如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests  
<span class="hljs-keyword">import</span> json  
<span class="hljs-comment"># Analysis API  </span>
classAnalysisService:  
    def__init__(self):  
        self.ollama_host = <span class="hljs-string">"http://localhost:11434/api/chat"</span>  
      
    defanalysis(self, prompt):  
        <span class="hljs-comment"># 发送POST请求  </span>
        <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>  
        <span class="hljs-comment"># 请求数据  </span>
        data = {  
            <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-r1:32b"</span>,  
            <span class="hljs-string">"messages"</span>: [  
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}  
            ],  
            <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>  
        }  
        <span class="hljs-keyword">with</span> requests.post(self.ollama_host, json=data, stream=<span class="hljs-literal">True</span>) <span class="hljs-keyword">as</span> response:  
            <span class="hljs-comment"># 处理流式响应  </span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response.iter_lines():  
                <span class="hljs-keyword">if</span> line:  
                    decoded_line = line.decode(<span class="hljs-string">'utf-8'</span>)  
                    <span class="hljs-keyword">try</span>:  
                        <span class="hljs-comment"># 解析JSON数据  </span>
                        chunk = json.loads(decoded_line)  
                        <span class="hljs-built_in">str</span> += chunk[<span class="hljs-string">'message'</span>][<span class="hljs-string">'content'</span>]  
                        <span class="hljs-comment"># 打印消息内容  </span>
                        <span class="hljs-built_in">print</span>(chunk[<span class="hljs-string">'message'</span>][<span class="hljs-string">'content'</span>], end=<span class="hljs-string">''</span>, flush=<span class="hljs-literal">True</span>)  
                    <span class="hljs-keyword">except</span> json.JSONDecodeError:  
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"无法解析JSON: <span class="hljs-subst">{decoded_line}</span>"</span>)  
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>
</code></pre>
<h4 data-id="heading-10">2.4.3. 数据查询服务(Query API)</h4>
<p>本服务主要是根据输入SQL连接数据库进行实际查询，智能体利用大模型服务生成SQL后，还需要调用此服务查询数据，具体开发实现如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pymysql  
<span class="hljs-keyword">import</span> requests  
<span class="hljs-keyword">import</span> json  
<span class="hljs-keyword">import</span> decimal  
<span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch  
  
<span class="hljs-comment"># Query API  </span>
classQueryService:  
    def__init__(self):  
        self.host = <span class="hljs-string">"127.0.0.1"</span>  
        self.username = <span class="hljs-string">"root"</span>  
        self.password = <span class="hljs-string">"XXXXX"</span>  
        self.database = <span class="hljs-string">"chaiys"</span>  
      
    defquery(self, sql):  
        <span class="hljs-keyword">global</span> conn  
        <span class="hljs-keyword">try</span>:  
            <span class="hljs-comment"># 连接MySQL获取表结构  </span>
            conn = pymysql.connect(host=self.host, port=<span class="hljs-number">3306</span>, user=self.username, password=self.password, database=self.database)  
            cursor = conn.cursor()  
            cursor.execute(sql)  
              
            <span class="hljs-comment"># 返回字段列表  </span>
            <span class="hljs-keyword">return</span> cursor.fetchall()  
        <span class="hljs-keyword">finally</span>:  
            conn.close()  
  
    defquery_with_column(self, sql):  
        <span class="hljs-keyword">global</span> conn  
        <span class="hljs-keyword">try</span>:  
            <span class="hljs-comment"># 连接MySQL获取表结构  </span>
            conn = pymysql.connect(  
                host=self.host,   
                user=self.username,   
                password=self.password,   
                database=self.database  
            )  
            cursor = conn.cursor()  
            cursor.execute(sql)  
              
            <span class="hljs-comment"># 获取字段名称  </span>
            columns = [col[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> cursor.description]  
            <span class="hljs-comment"># 获取数据  </span>
            data = cursor.fetchall()  
              
            <span class="hljs-comment"># 将数据转换为字典列表格式  </span>
            <span class="hljs-comment"># 将数据转换为字典列表格式  </span>
            result = []  
            <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> data:  
                <span class="hljs-comment"># 处理每个字段的值  </span>
                processed_row = []  
                <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> row:  
                    ifisinstance(value, decimal.Decimal):  
                        <span class="hljs-comment"># 转换为 float 或 str  </span>
                        processed_row.append(<span class="hljs-built_in">float</span>(value))  <span class="hljs-comment"># 或 str(value)  </span>
                    <span class="hljs-keyword">else</span>:  
                        processed_row.append(value)  
                result.append(<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(columns, processed_row)))  
                  
            <span class="hljs-keyword">return</span> result  
        <span class="hljs-keyword">finally</span>:  
            conn.close()
</code></pre>
<h3 data-id="heading-11">2.5. 测试结果</h3>
<p>我们设计一些简单的相关问题，进行提问测试：</p>
<p>问题1：2016年的考生人数有多少？</p>
<p>运行python agent_service.py chat '2016年的考生人数有多少？'，主要输出结果如下：</p>
<pre><code class="hljs language-text" lang="text">######### 第一步：元数据RAG检索结果 ##########  
[{'table_info': '{"表名": "college_entrance_examination", "表备注": "考生人数与复读人数信息表，包含字段：高考年份(主键)、考生人数(万人)、复读人数(万人)，考生人数是指参加高考的学生的数量，复读人数是指参加高考的复读学生的数量", "字段列表": [{"字段名": ...省略若干字段信息...}]}']}]  
  
########## 第二步：大模型调用NL2SQL ##########  
########## 提示词 ##########  
    你是一个MySQL专家。根据以下表结构信息：  
    ['{"表名": "college_entrance_examination", "表备注": "考生人数与复读人数信息表，包含字段：...省略...}]}']  
      
    用户查询："'2016年的考生人数有多少？'"  
      
    生成标准MYSQL查询语句。  
    要求：  
    1. 只输出MYSQL语句，不要额外解释  
    2. 根据语义和字段类型，使用COUNT/SUM/AVG等聚合函数进行计算，非必须  
    3. 给生成的字段取一个简短的中文名称  
    输出格式：使用[]包含sql文本即可，不需要其他输出，便于解析，例如:[select 1from dual]  
########## 结果 ##########  
&lt;think&gt;  
好，我来想想怎么解决这个问题。用户的问题是：“2016年的考生人数有多少？”首先，我需要理解问题中的关键词和要求。  
  
表名是college_entrance_examination，里面有关于高考的数据。字段有三个：examination_year（高考年份），candidates_count（考生人数，单位是万人），retake_count（复读人数，也是万人）。主键是examination_year，所以每个年份只有一条记录。  
  
用户问的是2016年的考生人数，也就是要查询candidates_count这一字段。因为这是一个具体的数值，并不需要聚合函数计算，直接查就可以了。  
  
所以，我需要写一个SELECT语句，从这个表中选取candidates_count，条件是examination_year等于2016年。同时，给结果的字段取个简短的名字，比如“考生人数”。  
  
检查一下数据类型，candidates_count是decimal(10,2)，所以不需要处理，直接显示就可以了。  
  
最后，拼装SQL语句就是：SELECT candidates_count AS 考生人数 FROM college_entrance_examination WHERE examination_year = 2016;  
  
这样就能准确地返回用户需要的信息了。  
&lt;/think&gt;  
  
[select candidates_count as 考生人数 from college_entrance_examination where examination_year=2016]执行SQL：select candidates_count as 考生人数 from college_entrance_examination where examination_year=2016  
  
########## 第三步：查询数据结果 ##########  
[{'考生人数': 940.0}]  
  
########## 第四步：数据分析 ##########  
########## 提示词 ##########  
        根据以下表结构信息：  
        ['{"表名": "college_entrance_examination", "表备注": "考生人数与复读人数信息表，包含字段：高考... 省略若干字段信息... "}]}']  
        查询SQL：  
        select candidates_count as 考生人数 from college_entrance_examination where examination_year=2016  
        和以下数据信息：  
        [{'考生人数': 940.0}]  
          
        用户查询："'2016年的考生人数有多少？'"  
          
        生成一段简要分析，加上一些预测总结的内容  
########## 结果 ##########  
&lt;think&gt;  
好的，我现在需要帮用户生成一个关于2016年高考考生人数的分析和预测。首先，我得仔细理解用户提供的信息。  
  
用户给出了表结构，里面包括了高考年份、考生人数和复读人数。查询语句是选中2016年的考生人数，结果得到940.0万人。那用户的问题就是问“2016年的考生人数有多少？”  
  
接下来，我需要分析这个数据。首先，...省略...  
  
然后，思考为什么用户会问这个问题...省略...政策影响等。  
  
接下来是预测部分。我需要基于2016年的数据进行合理的...省略...趋势。  
  
还要考虑可能的因素，比如...省略...  
  
最后，要总结一下。2016年的数据是...省略...  
&lt;/think&gt;  
  
### 数据分析与预测总结  
  
1. **数据分析**：  
   - 2016 年高考考生人数为 940 万人，这一数据反映了当年参加高考的学生总数。  
   - 高考考生人数的变化受多种因素影响，例如人口结构、教育政策调整以及复读人数的变化等。  
  
2. **预测总结**：  
   - 根据近年来高考报名人数的趋势，预计未来几年高考考生人数可能会继续保持增长趋势。这主要是由于适龄人口数量的增加以及教育资源普及率的提高。  
   - 复读人数也可能对总考生人数产生一定影响。如果复读人数逐年减少，可能会影响高考考生人数的增长速度。  
  
综上所述，2016 年高考考生人数为 940 万人，这一数据为我们了解当年高考的基本情况提供了重要参考。未来，高考考生人数可能会继续增长，但增速可能会趋于平稳。
</code></pre>
<p>可以看到，语义混合检索返回的一个表结构命中元数据考生人数信息表，正常生成SQL，并查询到考生人数，最后调用大模型简单分析返回。</p>
<p>问题2：2016年的录取人数有多少？</p>
<p>运行python agent_service.py chat '2016年的录取人数有多少？'，主要输出结果如下：</p>
<pre><code class="hljs language-text" lang="text">########## 第一步：元数据RAG检索结果 ##########
[{'table_info': '{"表名":"college_entrance_admission","表备注":"录取人数与普通高校数信息表，包含字段：录取年份(主键)、录取人数(万人)、普通高中招生高校数、本科录取人数(万人)、专科录取人数(万人)，录取人数是指录取或者招收、招录的学生的数量"...省略若干字

为了减少文字，表结构信息这里省略了，用户这个问题通过语义检索到的表（college_entrance_admission），和前面一个问题检索到的表（college_entrance_examination）不同，

########## 第二步：大模型调用NL2SQL ##########
########## 提示词 ##########
    你是一个MySQL专家。根据以下表结构信息：...省略若干字prompt和think过程
   
[select admission_count as 录取人数 from college_entrance_admission where admission_year=2016]执行SQL：select admission_count as 录取人数 from college_entrance_admission where admission_year=2016

########## 第三步：查询数据结果 ##########
[{'录取人数': 772.0}]

########## 第四步：数据分析 ##########
########## 提示词 ##########
    根据以下表结构信息：...省略若干字Prompt和think过程

2016年高考的录取人数为772.0万人。这一数据反映了当年全国范围内普通高校招生的整体情况。

**分析：**
- 从历史趋势来看，...省略若干字
- 录取人数的变化还可能...省略若干字

**预测总结：**
- 预计未来几年高考录取人数可能...省略若干字
</code></pre>
<p>可以看到，语义混合检索返回的一个表结构命中元数据录取人数信息表，正常生成SQL，并查询到录取人数的信息，最后调用大模型简单分析数据返回。</p>
<p>本文说明：本文因为太长所以分成三篇文章，这是第一篇，还有两篇分别描述基于LangChain 框架和QwenAgent框架的实践过程。</p>
<p>本文作者：Chaiys</p>
<p>本文原载：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FT1FxAIlraY6mRPjOQ54raA" target="_blank" title="https://mp.weixin.qq.com/s/T1FxAIlraY6mRPjOQ54raA" ref="nofollow noopener noreferrer">公众号“木昆子记录AI”</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我司最近在招聘：AI提示词工程师AI Prompt Engineer，有意者来]]></title>    <link>https://juejin.cn/post/7591670569910222894</link>    <guid>https://juejin.cn/post/7591670569910222894</guid>    <pubDate>2026-01-05T07:36:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591670569910222894" data-draft-id="7591403124327301183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我司最近在招聘：AI提示词工程师AI Prompt Engineer，有意者来"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-05T07:36:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="龙在天"/> <meta itemprop="url" content="https://juejin.cn/user/3760787883819464"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我司最近在招聘：AI提示词工程师AI Prompt Engineer，有意者来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3760787883819464/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    龙在天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:36:21.000Z" title="Mon Jan 05 2026 07:36:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是AI提示词工程师</h2>
<p>更好地帮人类与AI互动。依托AI大模型创作内容的工具来说，都离不开专业的AI提示词工程师。</p>
<p>科技进步 最直观 的 新工作岗位。</p>
<p>从名字上看，<code>提示词工程</code>。但是会更偏向 "杂家"。<br/>
懂<code>文学</code>、<code>计算机科学</code>、<code>数学</code>。还要有丰富的想象力，否则制作出来的内容会千篇一律。</p>
<p>大语言模型（LLM：Language Model）。关注提示词开发和优化，帮助用户将大语言模型，用于各场景和研究领域。</p>
<hr/>
<h2 data-id="heading-1">岗位重要性</h2>
<p>提升工程来<code>提升大语言模型</code>处理复杂任务场景的能力：<code>问答</code>和<code>算术推理</code>能力。可通过<code>提示工程设计</code>、研发强大的<code>工程技术</code>、实现和<code>大语言模型</code>和<code>其他生态工具</code>的高效接轨。</p>
<p>提示工程不仅仅是关于<code>设计</code>和<code>研发</code>提示词。<br/>
包含了与<code>大语言模型交互和研发</code>的各种技能和技术。</p>
<p>提示词<code>万能公式</code>:</p>
<pre><code class="hljs">角色（告诉AI工具需要完成什么工作）+
任务（在提示词中清楚地指明你希望生成的文本的目标或任务，如描述、解释、比较、总结等）+
要求（限定范围或主题、指定格式或结构、确定语气或风格、指定关键信息或要素）+
细节（个性化的风格、不同的口吻、不同的视角等）
</code></pre>
<p>基本逻辑：告诉AI<br/>
你是谁？<br/>
要做什么？<br/>
怎么做？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31deef0c913a4895b85f7de8f59ffdfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=yOSBmOuRboTtwiV7%2BoVIgsofbbY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f24fe51b77794b85a72a6056cc89b81a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=ClgosQa%2FfdRPS67ZVgZtyp84mSw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e1406f77d345cd818235f797179dfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=Z5p9VbZ9obplZkmQBbWJbD0fwW0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">学习路线</h2>
<h3 data-id="heading-3">成长路线图 &amp; 学习规划</h3>
<h4 data-id="heading-4">L1级别</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/193bfb5ceb6a4404b6d0e987497497a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=76ZQZm9GnKjNVMUrGuj4HZvnsw4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">L2级别</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a41961b827b4a448e568cc7a8a17933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=fg1YR%2BQnyb8DKUqt3OFzL2NV9Ro%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">L3级别</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c4f4fac805941d5a7e728c6ce561e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=Fz65dZASYvSLja5tQvd8ZGb1DGU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">L4级别</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b47cbb21ab7e4cdaa8bcca3d98d4579d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=6Jnmmu%2FJfoHcUe3q6W9uxuFpSPw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">书籍推荐</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18a12883ec7b40afbeefb50c28c93694~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zyo5aSp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768203380&amp;x-signature=yQfFSfMokDIbqidCcxftTESEOvA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">模型设置</h2>
<p>通过<code>API</code>或直接与大语言模型进行交互，用<code>提示词</code>。通过<code>配置一些参数</code>以获得不同的提示结果。<br/>
调整这些设置对于提高响应的可靠性。需要进行一些实验才能找出<code>适合的用例</code>的<code>正确设置</code>。</p>
<h3 data-id="heading-10">不同的LLM提供程序时会遇到的常见设置：</h3>
<h4 data-id="heading-11"><code>Temperature</code></h4>
<p><code>temperature</code>的参数值越小，模型就会返回越确定的一个结果。<br/>
如果调高该参数值，大语言模型可能会返回更随机的结果，也就是说这可能会带来更多样化或更具创造性的产出。<br/>
（调小<code>temperature</code>）实质上，你是在增加其他可能的<code>token</code>的权重。<br/>
在实际应用方面，对于质量保障（QA）等任务，我们可以设置更低的<code>temperature</code>值，以促使模型基于事实返回更真实和简洁的结果。<br/>
对于诗歌生成或其他创造性任务，适度地调高<code>temperature</code>参数值可能会更好。</p>
<h4 data-id="heading-12">Top_p</h4>
<p>使用<code>top_p</code>（与<code>temperature</code>一起称为核采样的技术），可以用来控制模型返回结果的确定性。要准确的或者事实的答案，就把参数值调低。<br/>
找更多样化的响应，将其值调高点。</p>
<p>用<code>Top P</code>意味着 <code>tokens</code> 中 包含 <code>top_p</code>概率质量 才会被考虑用于响应，较低的<code>top_p</code>值会选择最有信心的响应。这意味着较高的<code>top_p</code>值将使模型考虑更多可能的词语，包括不太可能的词语，从而导致更多样的输出。</p>
<p>一般，改 <code>Temperature</code>或者<code>Top P</code>其中一个参数就行，不用两个都改。</p>
<h4 data-id="heading-13">Max Length</h4>
<p>可以通过调整<code>max length</code>来控制大模型生成的<code>token</code>数。指定<code>Max Length</code>有助于防止大模型生成冗长或不相关的响应并控制成本。</p>
<h4 data-id="heading-14">Stop Sequences</h4>
<p><code>stop sequence</code>是一个字符串，可以阻止模型生成<code>token</code>，指定<code>stop sequences</code>是控制大模型响应长度和结构的另一种方法。例如，您可以通过添加“11”作为<code>stop sequence</code>去告诉模型生成不超过<code>10</code>个项的列表。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂 useRef：它到底在“存”什么？]]></title>    <link>https://juejin.cn/post/7591687981686997038</link>    <guid>https://juejin.cn/post/7591687981686997038</guid>    <pubDate>2026-01-05T07:39:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591687981686997038" data-draft-id="7589907831199432730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂 useRef：它到底在“存”什么？"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-05T07:39:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烟袅破辰"/> <meta itemprop="url" content="https://juejin.cn/user/1845419006243504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂 useRef：它到底在“存”什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1845419006243504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烟袅破辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:39:20.000Z" title="Mon Jan 05 2026 07:39:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 中，<code>useRef</code> 是一个看似简单却非常强大的 Hook。很多初学者会把它和 <code>useState</code> 混为一谈，认为它们都是“存储数据”的工具。但事实并非如此。</p>
<p>今天我们就通过两个实际例子，深入剖析 <code>useRef</code> 的真正作用：它不是一个状态容器，而是一个“跨渲染周期的引用容器”。</p>
<hr/>
<h2 data-id="heading-0">一、useRef 到底是用来干什么的？</h2>
<p>我们先看一段代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
        count++
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前值: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>这段代码中，<code>inputRef</code> 被用来获取 <code>&lt;input&gt;</code> 元素的 DOM 引用，并在组件挂载后自动聚焦。</p>
<p>这里的关键是：<br/>
<code>inputRef.current</code> 在组件重新渲染时不会被重置。即使 <code>count</code> 改变导致组件重新渲染，<code>inputRef</code> 依然指向同一个 DOM 节点。</p>
<p>这正是 <code>useRef</code> 的核心能力：持久化引用，不随渲染而销毁。</p>
<hr/>
<h2 data-id="heading-1">二、useRef 和 useState 的本质区别</h2>
<p>很多人会问：“既然都能存东西，为什么不直接用 useState？”</p>
<p>我们来对比一下：</p>






























<table><thead><tr><th>特性</th><th>useState</th><th>useRef</th></tr></thead><tbody><tr><td>是否触发重渲染</td><td>是</td><td>否</td></tr><tr><td>是否响应式</td><td>是</td><td>否</td></tr><tr><td>存储内容类型</td><td>状态数据（如用户输入、计数）</td><td>任意值（DOM、定时器、函数等）</td></tr><tr><td>使用场景</td><td>需要 UI 更新的数据</td><td>不需要 UI 更新的临时或持久引用</td></tr></tbody></table>
<p>示例 1：用 useRef 存储定时器 ID</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> intervalId = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~'</span>);
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId.<span class="hljs-property">current</span>);
  }

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前 intervalId:'</span>, intervalId.<span class="hljs-property">current</span>);
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>开始<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>停止<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>在这个例子中：</p>
<ul>
<li><code>intervalId.current</code> 保存了 <code>setInterval</code> 返回的 ID。</li>
<li>即使组件因为 <code>count</code> 变化而重新渲染，<code>intervalId.current</code> 仍然保留着原来的值。</li>
<li>因此 <code>stop()</code> 函数可以正确清除定时器。</li>
</ul>
<p>如果你改用 <code>useState</code> 来存这个 ID，每次更新都会触发重渲染，造成不必要的性能损耗。</p>
<hr/>
<h2 data-id="heading-2">三、如果不使用 useRef 会发生什么？</h2>
<p>我们来看一个错误版本：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick~~'</span>);
    }, <span class="hljs-number">1000</span>);
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">clearInterval</span>(intervalId);
  }

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前 intervalId:'</span>, intervalId);
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{start}</span>&gt;</span>开始<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{stop}</span>&gt;</span>停止<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>问题分析：</p>
<ol>
<li>点击「开始」→ 创建定时器，<code>intervalId</code> 被赋值为某个 ID（比如 12345）。</li>
<li>点击「+1」→ 组件重新渲染 → <code>let intervalId = null;</code> 执行 → <code>intervalId</code> 变成 <code>null</code>。</li>
<li>再点击「停止」→ <code>clearInterval(null)</code> → 无效！</li>
<li>定时器仍在运行，无法清除 → 内存泄漏！</li>
</ol>
<p>这就是为什么不能用普通变量或 <code>useState</code> 来存储非状态数据。</p>
<hr/>
<h2 data-id="heading-3">四、useRef 的三大典型应用场景</h2>
<ol>
<li>获取 DOM 节点引用</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">inputRef</span> = useRef(null)<span class="hljs-comment">;</span>
&lt;input <span class="hljs-attr">ref</span>={inputRef} /&gt;
</code></pre>
<p>用于操作 DOM，比如聚焦、滚动、获取值等。</p>
<ol start="2">
<li>存储可变对象（如定时器、WebSocket）</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">timerRef</span> = useRef()<span class="hljs-comment">;</span>
<span class="hljs-attr">timerRef.current</span> = setInterval(() =&gt; {}, <span class="hljs-number">1000</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>避免重复创建，确保能正确清理。</p>
<ol start="3">
<li>创建“持久化”的引用对象</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">prevValueRef</span> = useRef()<span class="hljs-comment">;</span>

function handleChange(value) {
  console.log('上一次的值:', prevValueRef.current)<span class="hljs-comment">;</span>
  <span class="hljs-attr">prevValueRef.current</span> = value<span class="hljs-comment">;</span>
}
</code></pre>
<p>在闭包中保持对旧值的访问。</p>
<hr/>
<h2 data-id="heading-4">五、总结：useRef 是什么？</h2>
<p><code>useRef</code> 并不是“状态”，而是 一个跨渲染周期的引用容器。</p>
<p>你可以把它想象成一个“保险箱”：</p>
<ul>
<li>组件反复重建，但保险箱一直存在；</li>
<li>你可以往里面放任何东西（DOM、ID、对象、函数）；</li>
<li>它不会触发重渲染，也不会影响 UI；</li>
<li>但它能帮你记住那些“不该被遗忘”的东西。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么"计算机网络"需要分层设计？——从物理层到应用层]]></title>    <link>https://juejin.cn/post/7591456613535121408</link>    <guid>https://juejin.cn/post/7591456613535121408</guid>    <pubDate>2026-01-05T07:45:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591456613535121408" data-draft-id="7591456613535105024" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么&quot;计算机网络&quot;需要分层设计？——从物理层到应用层"/> <meta itemprop="keywords" content="后端,面试,程序员"/> <meta itemprop="datePublished" content="2026-01-05T07:45:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限大6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么"计算机网络"需要分层设计？——从物理层到应用层
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限大6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:45:38.000Z" title="Mon Jan 05 2026 07:45:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🔗 为什么"计算机网络"需要分层设计？——从物理层到应用层 🌐</h2>
<blockquote>
<p>大家好，我是无限大，欢迎收看十万个为什么系列文章</p>
<p>希望今天的内容能对大家有所帮助</p>
</blockquote>
<p>想象一下：你在电脑上输入 <code>www.baidu.com</code>，几秒钟后就看到了百度首页——这个简单的操作背后，其实是<strong>几百个网络设备</strong>在协同工作！而支撑这些设备高效协作的，正是计算机网络的"分层设计"。</p>
<h3 data-id="heading-1">🤔 核心问题：网络分层的好处是什么？OSI 七层模型和 TCP/IP 四层模型有何区别？</h3>
<p>很多人觉得"网络分层"是个复杂的技术概念，其实它的本质很简单：<strong>把复杂的网络通信问题拆分成多个简单的小问题，每个层次负责解决一个特定的问题</strong>。</p>
<h4 data-id="heading-2">网络分层的"魔法"在哪里？</h4>
<ul>
<li>🧩 <strong>简化问题</strong>：把复杂的网络通信拆分成多个简单的层次</li>
<li>🔄 <strong>标准化</strong>：每个层次有明确的标准，不同厂商的设备可以互相通信</li>
<li>📦 <strong>模块化</strong>：每个层次可以独立发展，不用影响其他层次</li>
<li>🔧 <strong>易于维护</strong>：出现问题时，只需要排查对应的层次</li>
<li>🚀 <strong>提高效率</strong>：不同层次可以并行工作</li>
</ul>
<h3 data-id="heading-3">📜 从"混乱"到"有序"：网络分层的进化史</h3>
<h4 data-id="heading-4">1. 🌪️ 早期网络："一团糟"</h4>
<p>在计算机网络的早期，每个公司都有自己的网络协议，就像"每个国家都有自己的语言"：</p>
<ul>
<li><strong>IBM</strong>：使用 SNA 协议</li>
<li><strong>DEC</strong>：使用 DECnet 协议</li>
<li><strong>Apple</strong>：使用 AppleTalk 协议</li>
</ul>
<p><strong>结果</strong>：不同公司的网络设备无法互相通信，形成了一个个"网络孤岛"。</p>
<h4 data-id="heading-5">2. 📋 OSI 七层模型："完美的理论模型"</h4>
<p>1977年，国际标准化组织（ISO）提出了<strong>OSI七层模型</strong>，这是一个"完美的理论模型"，它将网络通信分为7个层次：</p>













































<table><thead><tr><th>层次</th><th>名称</th><th>主要功能</th></tr></thead><tbody><tr><td>7</td><td>应用层</td><td>为用户应用程序提供网络服务</td></tr><tr><td>6</td><td>表示层</td><td>数据格式转换、加密解密</td></tr><tr><td>5</td><td>会话层</td><td>建立、维护和管理会话</td></tr><tr><td>4</td><td>传输层</td><td>端到端的可靠传输</td></tr><tr><td>3</td><td>网络层</td><td>路由选择、IP地址</td></tr><tr><td>2</td><td>数据链路层</td><td>帧的封装与解封装、MAC地址</td></tr><tr><td>1</td><td>物理层</td><td>物理介质、比特流传输</td></tr></tbody></table>
<p><strong>理想很丰满，现实很骨感</strong>：</p>
<ul>
<li>OSI模型太复杂，实现成本高</li>
<li>标准制定过程太慢，跟不上技术发展</li>
<li>厂商们更愿意采用已有的TCP/IP协议</li>
</ul>
<h4 data-id="heading-6">3. 🚀 TCP/IP 四层模型："实用为王"</h4>
<p>在OSI模型提出的同时，美国国防部高级研究计划局（DARPA）正在开发<strong>TCP/IP协议栈</strong>，这是一个"实用主义"的设计：</p>






























<table><thead><tr><th>层次</th><th>名称</th><th>主要协议</th></tr></thead><tbody><tr><td>4</td><td>应用层</td><td>HTTP、FTP、SMTP、DNS</td></tr><tr><td>3</td><td>传输层</td><td>TCP、UDP</td></tr><tr><td>2</td><td>网络层</td><td>IP、ICMP、ARP</td></tr><tr><td>1</td><td>网络接口层</td><td>以太网、Wi-Fi、PPP</td></tr></tbody></table>
<p><strong>TCP/IP协议的优势</strong>：</p>
<ul>
<li>简单实用，易于实现</li>
<li>已经在ARPANET（互联网的前身）上得到验证</li>
<li>开放性好，免费使用</li>
<li>支持多种网络类型</li>
</ul>
<h4 data-id="heading-7">4. 🌐 现代网络："TCP/IP协议的天下"</h4>
<p>到了20世纪90年代，TCP/IP协议已经成为<strong>互联网的标准协议</strong>，几乎所有的网络设备都支持TCP/IP协议。</p>
<p>现在，当我们提到"网络分层"时，通常指的是<strong>TCP/IP四层模型</strong>，或者是结合了OSI七层模型优点的"TCP/IP五层模型"：</p>



































<table><thead><tr><th>五层模型</th><th>对应OSI层次</th><th>对应TCP/IP层次</th></tr></thead><tbody><tr><td>应用层</td><td>应用层、表示层、会话层</td><td>应用层</td></tr><tr><td>传输层</td><td>传输层</td><td>传输层</td></tr><tr><td>网络层</td><td>网络层</td><td>网络层</td></tr><tr><td>数据链路层</td><td>数据链路层</td><td>网络接口层</td></tr><tr><td>物理层</td><td>物理层</td><td>网络接口层</td></tr></tbody></table>
<h3 data-id="heading-8">🔧 技术原理：网络分层的"秘密武器"</h3>
<h4 data-id="heading-9">1. 📡 物理层："比特流的搬运工"</h4>
<p><strong>核心功能</strong>：负责在物理介质上传输原始的比特流（0和1）。</p>
<p><strong>物理层的"工具"</strong>：</p>
<ul>
<li>📱 物理介质：双绞线、光纤、无线电磁波</li>
<li>🛠️ 物理设备：网卡、交换机、路由器的物理接口</li>
<li>⚡ 传输技术：调制解调、编码解码、同步传输</li>
</ul>
<p><strong>举个例子</strong>：当你用网线连接电脑和路由器时，物理层负责把电脑发送的二进制数据转换成电信号，通过网线传输到路由器。</p>
<h4 data-id="heading-10">2. 🔗 数据链路层："帧的组装工"</h4>
<p><strong>核心功能</strong>：负责将网络层的数据包封装成"帧"，并在相邻节点之间传输。</p>
<p><strong>数据链路层的"工具"</strong>：</p>
<ul>
<li>📦 帧格式：以太网帧、PPP帧</li>
<li>🔍 MAC地址：每个网络设备的唯一标识符（比如 <code>00:11:22:33:44:55</code>）</li>
<li>🛡️ 差错控制：CRC校验</li>
<li>🔄 流量控制：防止发送方发送过快</li>
</ul>
<p><strong>举个例子</strong>：当电脑要发送数据时，数据链路层会给网络层的IP数据包加上"帧头"和"帧尾"，形成一个完整的"以太网帧"，然后通过物理层发送出去。</p>
<h4 data-id="heading-11">3. 🌍 网络层："数据包的导航员"</h4>
<p><strong>核心功能</strong>：负责将数据包从源主机发送到目标主机，主要解决"如何选择最佳路径"的问题。</p>
<p><strong>网络层的"工具"</strong>：</p>
<ul>
<li>🌐 IP地址：互联网上每个主机的唯一标识符（比如 <code>192.168.1.1</code>）</li>
<li>🗺️ 路由协议：RIP、OSPF、BGP</li>
<li>📡 ICMP协议：网络控制消息协议（比如 ping 命令）</li>
<li>🔄 ARP协议：地址解析协议（将IP地址转换为MAC地址）</li>
</ul>
<p><strong>举个例子</strong>：当你访问 <code>www.baidu.com</code> 时，网络层会负责找到从你的电脑到百度服务器的最佳路径，可能要经过多个路由器。</p>
<h4 data-id="heading-12">4. 🚚 传输层："端到端的可靠传输"</h4>
<p><strong>核心功能</strong>：负责在源主机和目标主机之间建立可靠的"端到端"连接，确保数据能够完整、有序地传输。</p>
<p><strong>传输层的"两大法宝"</strong>：</p>
<ul>
<li><strong>TCP协议</strong>：可靠的、面向连接的协议，适合传输重要数据（比如网页、邮件）</li>
<li><strong>UDP协议</strong>：不可靠的、无连接的协议，适合传输实时数据（比如视频、音频）</li>
</ul>
<p><strong>TCP协议的"可靠机制"</strong>：</p>
<ul>
<li>🔗 三次握手：建立可靠连接</li>
<li>📦 数据分段：将大数据分成多个小数据段</li>
<li>✅ 确认机制：收到数据后发送确认</li>
<li>🔄 重传机制：数据丢失后自动重传</li>
<li>⚡ 流量控制：根据接收方的能力调整发送速度</li>
<li>📊 拥塞控制：根据网络状况调整发送速度</li>
</ul>
<h4 data-id="heading-13">5. 🎮 应用层："用户的直接接口"</h4>
<p><strong>核心功能</strong>：为用户应用程序提供网络服务，是用户直接接触的层次。</p>
<p><strong>常见的应用层协议</strong>：</p>
<ul>
<li>🌐 HTTP/HTTPS：万维网服务</li>
<li>📧 SMTP/POP3/IMAP：电子邮件服务</li>
<li>📁 FTP/SFTP：文件传输服务</li>
<li>📱 DNS：域名解析服务</li>
<li>💬 SSH/Telnet：远程登录服务</li>
</ul>
<p><strong>举个例子</strong>：当你用浏览器访问网页时，浏览器会使用HTTP协议向服务器请求数据，服务器收到请求后，会返回HTML、CSS、JavaScript等文件，浏览器再把这些文件渲染成网页。</p>
<h3 data-id="heading-14">💻 代码实例：用Python实现简单的网络通信</h3>
<h4 data-id="heading-15">1. UDP通信示例</h4>
<p><strong>服务器端</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 创建UDP套接字</span>
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

<span class="hljs-comment"># 绑定IP和端口</span>
s.bind((<span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-number">8888</span>))

<span class="hljs-built_in">print</span>(<span class="hljs-string">"UDP服务器已启动，等待客户端连接..."</span>)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># 接收数据</span>
    data, addr = s.recvfrom(<span class="hljs-number">1024</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"收到来自 <span class="hljs-subst">{addr}</span> 的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>)
  
    <span class="hljs-comment"># 发送数据</span>
    s.sendto(<span class="hljs-string">f"你好，我是UDP服务器，我收到了你的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>), addr)
</code></pre>
<p><strong>客户端</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 创建UDP套接字</span>
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

<span class="hljs-comment"># 服务器IP和端口</span>
server_addr = (<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">8888</span>)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># 输入消息</span>
    message = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入要发送的消息（输入'quit'退出）："</span>)
  
    <span class="hljs-keyword">if</span> message == <span class="hljs-string">'quit'</span>:
        <span class="hljs-keyword">break</span>
  
    <span class="hljs-comment"># 发送数据</span>
    s.sendto(message.encode(<span class="hljs-string">'utf-8'</span>), server_addr)
  
    <span class="hljs-comment"># 接收数据</span>
    data, addr = s.recvfrom(<span class="hljs-number">1024</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"收到服务器的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>)

<span class="hljs-comment"># 关闭套接字</span>
s.close()
</code></pre>
<h4 data-id="heading-16">2. TCP通信示例</h4>
<p><strong>服务器端</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 创建TCP套接字</span>
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 绑定IP和端口</span>
s.bind((<span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-number">9999</span>))

<span class="hljs-comment"># 监听连接</span>
s.listen(<span class="hljs-number">5</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"TCP服务器已启动，等待客户端连接..."</span>)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># 接受连接</span>
    client_socket, client_addr = s.accept()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"客户端 <span class="hljs-subst">{client_addr}</span> 已连接"</span>)
  
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># 接收数据</span>
        data = client_socket.recv(<span class="hljs-number">1024</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            <span class="hljs-keyword">break</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"收到来自 <span class="hljs-subst">{client_addr}</span> 的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>)
      
        <span class="hljs-comment"># 发送数据</span>
        client_socket.send(<span class="hljs-string">f"你好，我是TCP服务器，我收到了你的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>.encode(<span class="hljs-string">'utf-8'</span>))
  
    <span class="hljs-comment"># 关闭客户端连接</span>
    client_socket.close()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"客户端 <span class="hljs-subst">{client_addr}</span> 已断开连接"</span>)
</code></pre>
<p><strong>客户端</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 创建TCP套接字</span>
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 服务器IP和端口</span>
server_addr = (<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">9999</span>)

<span class="hljs-comment"># 连接服务器</span>
s.connect(server_addr)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"已连接到TCP服务器"</span>)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># 输入消息</span>
    message = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入要发送的消息（输入'quit'退出）："</span>)
  
    <span class="hljs-keyword">if</span> message == <span class="hljs-string">'quit'</span>:
        <span class="hljs-keyword">break</span>
  
    <span class="hljs-comment"># 发送数据</span>
    s.send(message.encode(<span class="hljs-string">'utf-8'</span>))
  
    <span class="hljs-comment"># 接收数据</span>
    data = s.recv(<span class="hljs-number">1024</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"收到服务器的消息：<span class="hljs-subst">{data.decode(<span class="hljs-string">'utf-8'</span>)}</span>"</span>)

<span class="hljs-comment"># 关闭套接字</span>
s.close()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"已断开与服务器的连接"</span>)
</code></pre>
<h3 data-id="heading-17">📊 趣味对比：OSI七层模型 vs TCP/IP四层模型</h3>























































<table><thead><tr><th>对比项</th><th>OSI七层模型</th><th>TCP/IP四层模型</th></tr></thead><tbody><tr><td><strong>提出时间</strong></td><td>1977年</td><td>1970年代中期</td></tr><tr><td><strong>提出组织</strong></td><td>国际标准化组织（ISO）</td><td>美国国防部高级研究计划局（DARPA）</td></tr><tr><td><strong>设计理念</strong></td><td>理论优先，完美主义</td><td>实用优先，渐进主义</td></tr><tr><td><strong>层次数量</strong></td><td>7层</td><td>4层</td></tr><tr><td><strong>实现难度</strong></td><td>复杂，实现成本高</td><td>简单，实现成本低</td></tr><tr><td><strong>应用范围</strong></td><td>主要用于教学和理论研究</td><td>广泛应用于实际网络</td></tr><tr><td><strong>灵活性</strong></td><td>不够灵活，修改困难</td><td>灵活，容易扩展</td></tr><tr><td><strong>厂商支持</strong></td><td>有限</td><td>几乎所有厂商都支持</td></tr><tr><td><strong>标准成熟度</strong></td><td>标准完善但过于复杂</td><td>标准实用且不断发展</td></tr></tbody></table>
<h3 data-id="heading-18">🏢 网络分层的应用场景：无处不在的网络分层</h3>








































<table><thead><tr><th>应用场景</th><th>举例</th><th>网络分层的作用</th></tr></thead><tbody><tr><td>🌐 互联网</td><td>全球互联网</td><td>确保不同国家、不同厂商的设备可以互相通信</td></tr><tr><td>🛒 电商平台</td><td>淘宝、京东</td><td>确保订单数据、支付数据的可靠传输</td></tr><tr><td>📱 移动网络</td><td>4G、5G</td><td>确保手机可以随时随地接入互联网</td></tr><tr><td>🖥️ 企业网络</td><td>公司内部网络</td><td>确保公司内部设备的安全通信</td></tr><tr><td>🎮 游戏网络</td><td>王者荣耀、英雄联盟</td><td>确保游戏数据的实时传输</td></tr><tr><td>📺 视频直播</td><td>抖音、快手</td><td>确保视频流的流畅传输</td></tr></tbody></table>
<h3 data-id="heading-19">📈 数据支撑：网络分层的"硬核实力"</h3>
<ul>
<li>🌐 全球每天有超过<strong>50亿设备</strong>连接到互联网</li>
<li>📊 TCP/IP协议占互联网流量的<strong>95%以上</strong></li>
<li>⚡ 全球每天传输的数据量超过<strong>200亿GB</strong></li>
<li>🔄 平均每个网页加载需要<strong>100-200个HTTP请求</strong></li>
<li>📱 全球有超过<strong>60亿</strong>移动互联网用户</li>
</ul>
<h3 data-id="heading-20">⚠️ 常见误区纠正：网络分层不是"银弹"！</h3>
<h4 data-id="heading-21">1. "OSI七层模型是最好的？"</h4>
<p><strong>错！</strong> OSI七层模型是一个"完美的理论模型"，但在实际应用中，TCP/IP四层模型更实用。</p>
<h4 data-id="heading-22">2. "网络分层越多越好？"</h4>
<p><strong>错！</strong> 分层过多会导致效率降低，因为每个层次都需要添加额外的头部信息，增加了数据传输的开销。</p>
<h4 data-id="heading-23">3. "TCP协议比UDP协议好？"</h4>
<p><strong>不一定！</strong> TCP适合传输重要数据（比如网页、邮件），但UDP适合传输实时数据（比如视频、音频），因为UDP的延迟更低。</p>
<h4 data-id="heading-24">4. "IP地址就是MAC地址？"</h4>
<p><strong>错！</strong> IP地址是网络层的地址，用于在互联网上标识主机；MAC地址是数据链路层的地址，用于在局域网内标识设备。</p>
<h4 data-id="heading-25">5. "网络分层只适用于有线网络？"</h4>
<p><strong>错！</strong> 网络分层同样适用于无线网络，比如Wi-Fi网络也采用了OSI七层模型或TCP/IP四层模型。</p>
<h3 data-id="heading-26">🔮 未来展望：网络分层的发展趋势</h3>
<h4 data-id="heading-27">1. 🚀 软件定义网络（SDN）</h4>
<p>SDN将网络的"控制平面"和"数据平面"分离，实现了网络的"软件化"管理：</p>
<ul>
<li>🎮 集中式控制：通过控制器统一管理网络</li>
<li>📝 可编程性：网络可以通过软件进行编程</li>
<li>🚀 灵活性：可以快速调整网络配置</li>
</ul>
<h4 data-id="heading-28">2. 🔒 网络功能虚拟化（NFV）</h4>
<p>NFV将传统的网络设备（比如路由器、防火墙）虚拟化，运行在通用服务器上：</p>
<ul>
<li>💰 降低成本：不需要购买专用硬件</li>
<li>🚀 快速部署：可以快速部署新的网络功能</li>
<li>🔄 弹性扩展：可以根据需求动态扩展网络功能</li>
</ul>
<h4 data-id="heading-29">3. ☁️ 云原生网络</h4>
<p>随着云计算的普及，云原生网络将成为未来的发展方向：</p>
<ul>
<li>🌐 容器网络：Docker、Kubernetes的网络方案</li>
<li>🛡️ 服务网格：Istio、Linkerd等服务网格技术</li>
<li>🚀 Serverless网络：无需管理服务器的网络服务</li>
</ul>
<h4 data-id="heading-30">4. 5G/6G网络</h4>
<p>5G和6G网络将带来更高的速度、更低的延迟和更多的连接数：</p>
<ul>
<li>⚡ 5G速度可达10Gbps，延迟低至1ms</li>
<li>📱 6G速度可达100Gbps，延迟低至0.1ms</li>
<li>🔗 支持大规模物联网设备连接</li>
</ul>
<h3 data-id="heading-31">🎓 互动小测验：你答对了吗？</h3>


















































<table><thead><tr><th>问题</th><th>答案</th><th>你答对了吗？</th></tr></thead><tbody><tr><td>OSI七层模型的最底层是什么？</td><td>物理层</td><td>✅/❌</td></tr><tr><td>TCP/IP四层模型的最高层是什么？</td><td>应用层</td><td>✅/❌</td></tr><tr><td>负责可靠传输的协议是什么？</td><td>TCP</td><td>✅/❌</td></tr><tr><td>负责域名解析的协议是什么？</td><td>DNS</td><td>✅/❌</td></tr><tr><td>IP地址属于哪个层次？</td><td>网络层</td><td>✅/❌</td></tr><tr><td>MAC地址属于哪个层次？</td><td>数据链路层</td><td>✅/❌</td></tr><tr><td>ping命令使用的是什么协议？</td><td>ICMP</td><td>✅/❌</td></tr><tr><td>网页浏览使用的是什么协议？</td><td>HTTP/HTTPS</td><td>✅/❌</td></tr></tbody></table>
<h3 data-id="heading-32">🎯 结语：网络分层——计算机网络的"骨架"</h3>
<p>计算机网络的分层设计，就像<strong>建筑物的骨架</strong>，它为整个网络提供了"结构支撑"，让复杂的网络通信变得"有序"和"高效"。</p>
<p><strong>记住</strong>：网络分层的核心思想是"分而治之"——把复杂的问题拆分成多个简单的小问题，每个层次负责解决一个特定的问题。</p>
<p>下次当你使用电脑上网、用手机刷短视频、用平板看电影时，不妨想想背后的网络分层设计——正是这些看不见的"层次"，让我们的数字生活变得更加便捷和丰富！</p>
<h3 data-id="heading-33">💬 互动话题</h3>
<ol>
<li>你知道你家的网络是如何连接到互联网的吗？</li>
<li>你觉得未来的网络会是什么样子？</li>
<li>你遇到过最奇葩的网络问题是什么？最后是怎么解决的？</li>
</ol>
<p>快来评论区聊聊你的想法！💬 点赞收藏不迷路，咱们下期继续探索计算机的"十万个为什么"！🎉</p>
<p><strong>关注我</strong>，下期带你解锁更多计算机的"奇葩冷知识"！🤓</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次 Druid 慢查询超时问题的源码排查]]></title>    <link>https://juejin.cn/post/7591687981687062574</link>    <guid>https://juejin.cn/post/7591687981687062574</guid>    <pubDate>2026-01-05T07:45:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591687981687062574" data-draft-id="7591670569909960750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次 Druid 慢查询超时问题的源码排查"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-05T07:45:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙熟"/> <meta itemprop="url" content="https://juejin.cn/user/993614243042766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次 Druid 慢查询超时问题的源码排查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614243042766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙熟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:45:33.000Z" title="Mon Jan 05 2026 07:45:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">现象</h2>
<p>生产环境遇到以下报错：</p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">Error</span> querying database.  Cause: com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure
The last packet successfully received from the <span class="hljs-built_in">server</span> was <span class="hljs-number">18</span>,<span class="hljs-number">860</span> milliseconds ago. 
The last packet sent successfully <span class="hljs-keyword">to</span> the <span class="hljs-built_in">server</span> was <span class="hljs-number">18</span>,<span class="hljs-number">868</span> milliseconds ago.
</code></pre>
<blockquote>
<p>询问 AI 后，得到的分析是"链接长时间未使用，被回收了"。</p>
</blockquote>
<h2 data-id="heading-1">复现</h2>
<p>根据报错信息，猜测可能是超过 10 秒的慢 SQL 就会报错。
为了验证，准备了一个测试接口，只执行一个耗时 30 秒的查询：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> SLEEP(<span class="hljs-number">30</span>)
</code></pre>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ede18873c3f94ec5b195c6bf2f2311c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ54af:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204770&amp;x-signature=C7VUpsSSIYDw1O1dFcEM8mnhaAk%3D" alt="image.png" loading="lazy"/>
<strong>测试结果：</strong> 每次执行到 10 秒左右，果然报错，复现成功！</p>
</blockquote>
<h2 data-id="heading-2">初步解决</h2>
<p>咨询 AI 后，尝试通过设置 <code>socketTimeout</code> 来解决。在 JDBC 连接串中增加 <code>socketTimeout=60000</code>（60 秒）配置后，问题确实消失了。
但问题是：<strong>为什么？</strong> 追问 AI 具体原因，得到的回答却含糊不清，解释不清根本原因。于是决定自己翻源码。</p>
<h2 data-id="heading-3">深入源码</h2>
<p>首先查看 Druid 源码中的 <code>socketTimeout</code> 配置，发现默认值是 0，理论上应该没有超时限制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> socketTimeout; <span class="hljs-comment">// milliSeconds</span>
</code></pre>
<p>于是猜测是在启动时通过 <code>setSocketTimeout</code> 进行了赋值。在所有调用处打断点 debug 启动，发现并没有走进这些设置方法。
然而，进入 <code>com.alibaba.druid.pool.DruidAbstractDataSource#createPhysicalConnection()</code> 创建连接时，发现 <code>socketTimeout</code> 的值已经是 <code>10000</code>（10秒）了！</p>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f115af41f94944d0b827dbce11b9d66f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ54af:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204770&amp;x-signature=Jcr3lOp6vRfk6Ccjctr1dRNrv3c%3D" alt="image.png" loading="lazy"/>
既然不是运行时赋值的，那只能是<strong>类加载时成员变量的默认值</strong>了。</p>
</blockquote>
<p>终于，在 <code>com.alibaba.druid.pool.DruidDataSource.java</code> 的 <code>init()</code> 方法中，找到了以下代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (socketTimeout == <span class="hljs-number">0</span>) {
    socketTimeout = DEFAULT_TIME_SOCKET_TIMEOUT_MILLIS;
}
</code></pre>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61de556118614cce9f42b95ca11600e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ54af:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204770&amp;x-signature=HFJ1QxNlC9hKZM240dB%2FssZcWLk%3D" alt="image.png" loading="lazy"/>
这就是罪魁祸首了，那么Druid是从什么时候开始加入的这个默认配置呢，以及为什么要加呢？</p>
</blockquote>
<h2 data-id="heading-4">版本考古</h2>
<p>是从哪个版本开始有了这个默认 10 秒的配置呢？于是开始了版本追溯。</p>
<h3 data-id="heading-5">1. 从 1.2.20 追溯</h3>
<p>由于我当前使用的是1.2.20，所以从此版本往前对比源码，发现官方源码是从 1.2.15 增加的默认值设置逻辑，于是想当然地认为：<strong>1.2.14 版本应该没有这个限制</strong>。但测试 1.2.14 发现依然会 10 秒超时，debug 到createPhysicalConnection()中发现socketTimeout值仍然是 10 秒。</p>
<h3 data-id="heading-6">2. 从 1.2.14 继续往前追溯</h3>
<p>继续查找，发现 1.2.14的<code>DruidAbstractDataSource</code> 类中，直接在成员变量声明时就设置了默认值：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">socketTimeout</span> <span class="hljs-operator">=</span> DEFAULT_TIME_SOCKET_TIMEOUT_MILLIS; <span class="hljs-comment">// milliSeconds</span>
</code></pre>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5ded0ca02dd46108575f90b0db5796b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ54af:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204770&amp;x-signature=LIKqG95Oc75DzSOd2vnauPudOZU%3D" alt="image.png" loading="lazy"/>
PS: 1.2.13之后的源码仓库都有个core层，1.2.12之前的源码仓库是没有的，当时还以为1.2.12没有这个类呢<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fdruid%2Fblob%2F1.2.13%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Falibaba%2Fdruid%2Fpool%2FDruidAbstractDataSource.java" target="_blank" title="https://github.com/alibaba/druid/blob/1.2.13/core/src/main/java/com/alibaba/druid/pool/DruidAbstractDataSource.java" ref="nofollow noopener noreferrer">druid/<strong>core</strong>/src/main/java/com/alibaba/druid/pool/DruidAbstractDataSource.java at 1.2.13 · alibaba/druid · GitHub</a>，结果1.2.12也有，继续往前找。</p>
</blockquote>
<h3 data-id="heading-7">3. 终于找到“清白”版本</h3>
<p>继续往前追溯，在 <strong>1.2.11</strong> 版本中，终于没找到这个默认配置！
测试验证：</p>
<ul>
<li>使用 <strong>1.2.11</strong>：执行 <code>SELECT SLEEP(30)</code>，正常等待 30 秒后返回结果。</li>
<li>使用 <strong>1.2.12+</strong>：10 秒超时报错。</li>
</ul>
<h2 data-id="heading-8">结论与思考</h2>
<p>最终确认：<strong>Druid 从 1.2.12 版本开始，默认将 <code>socketTimeout</code> 设置为 10 秒。</strong>
为什么 Druid 要加这个默认配置呢？查看官方 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Fdruid%2Freleases" target="_blank" title="https://github.com/alibaba/druid/releases" ref="nofollow noopener noreferrer">Release Notes</a>：</p>
<blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e46ca4c501be40929b13abf39b21193a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ54af:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768204770&amp;x-signature=pL%2FlHzQvZlB5TFHm7t1VDpv2uIc%3D" alt="image.png" loading="lazy"/>
官方说明明确提到：<strong>增加默认 10 秒超时，是为了减少因为网络丢包时导致的连接池无法创建链接的问题。</strong>
这是一个为了提升连接池健壮性的防御性配置，但在某些需要执行长耗时 SQL 的场景下，反而导致了超时问题。</p>
</blockquote>
<h2 data-id="heading-9">解决方案</h2>
<p>在 Druid 配置中显式设置 <code>socketTimeout</code> 为更大的值即可解决：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-attr">socket-timeout:</span> <span class="hljs-number">60000</span> <span class="hljs-comment"># 60秒</span>
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p>这次排查从现象复现，到 AI 辅助定位，再到源码调试和版本考古，最终找到了问题的根本原因。技术问题的排查，往往需要一点"考古"精神，追根溯源，才能知其然更知其所以然。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[英语学废了？这个让10万+用户上瘾的神器，让我2个月从哑巴英语到流利对话！]]></title>    <link>https://juejin.cn/post/7591670569910272046</link>    <guid>https://juejin.cn/post/7591670569910272046</guid>    <pubDate>2026-01-05T07:51:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591670569910272046" data-draft-id="7591687981687078958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="英语学废了？这个让10万+用户上瘾的神器，让我2个月从哑巴英语到流利对话！"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-05T07:51:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            英语学废了？这个让10万+用户上瘾的神器，让我2个月从哑巴英语到流利对话！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:51:18.000Z" title="Mon Jan 05 2026 07:51:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>不知道大家有没有这种感觉：英语学了十几年，六级证书都泛黄了，一见到老外还是只会"How are you? I'm fine, thank you, and you?" 这个无限循环？背单词书背到abandon就真的abandon了，看美剧不带字幕跟看天书一样，在会议上被点名说"Can you share your thoughts?"时，恨不得找个地缝钻进去...</p>
<p>别问我怎么知道的，问就是我经历过！作为一名英语学渣，我曾经尝试过：</p>
<ul>
<li>百词斩打卡300天，结果只记得打卡动作</li>
<li>花2万报线下班，结果去了20次就放在那里吃灰</li>
<li>逼自己看《经济学人》，结果5分钟刷3次手机</li>
<li>收藏了100个学习方法，结果收藏夹成了英语公墓</li>
</ul>
<p>直到有一天，我无意间在GitHub trending上刷到了一个叫"earthworm"的开源项目，它的官网julebu.co彻底颠覆了我对英语学习的认知——<strong>原来学英语可以像打游戏一样上瘾！</strong> 从那天起，我每天的快乐从刷抖音变成了"刷英语"，2个月后，我居然能跟外国客户开30分钟的会不卡壳！今天必须把这个宝藏分享给大家！</p>
<hr/>
<h2 data-id="heading-0">一、句乐部（julebu.co）到底是个啥玩意儿？</h2>
<p>说白了，<strong>句乐部就是一个把英语学习变成消除类游戏的在线平台</strong>。它的名字就很妙——"句乐部"，谐音"俱乐部"，意思是让你乐在其中的句子练习社区。</p>
<p>它背后的理念超级硬核：基于语言学大佬Stephen Krashen的"i+1"理论（在你现有水平上增加一点点难度）、"以终为始"的逆向学习法，以及通过高频重复建立"肌肉记忆"。但用起来却简单到爆——就是让你像玩《开心消消乐》一样，把零散的单词连成正确的句子。</p>
<p><strong>官网地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjulebu.co%2Faff%2FRQH6MRYL" target="_blank" title="https://julebu.co/aff/RQH6MRYL" ref="nofollow noopener noreferrer">julebu.co/</a> （点进去记得收藏，不然你会后悔的！）</p>
<p><strong>GitHub开源地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcuixueshe%2Fearthworm" target="_blank" title="https://github.com/cuixueshe/earthworm" ref="nofollow noopener noreferrer">github.com/cuixueshe/e…</a> （ star数已经破万了，程序员兄弟们可以去瞻仰代码）</p>
<hr/>
<h2 data-id="heading-1">二、让我彻底沦陷的5大变态功能</h2>
<h3 data-id="heading-2">1. <strong>游戏化设计：学习=打怪升级</strong></h3>
<p>一打开julebu.co，你会发现这界面跟百词斩那种枯燥的flashcard完全不同！它有：</p>
<ul>
<li><strong>连词成句的消除玩法</strong>：单词像方块一样掉下来，你得按正确顺序点击，完成句子后会有"combo"连击特效</li>
<li><strong>即时反馈音效</strong>：每点对一个词都有"叮"的爽感音效，错了会有震动提示，支持自定义键盘音效</li>
<li><strong>进度可视化</strong>：清晰的学习路径，看着自己的等级从Lv.1菜鸟升到Lv.20高手，成就感爆棚</li>
</ul>
<p>我媳妇最开始还笑话我："多大的人了还玩游戏？"结果她在我旁边看了10分钟，第二天偷偷问我："那个...julebu.co叫啥来着？我也想试试..."</p>
<h3 data-id="heading-3">2. <strong>情境化学习：告别"哑巴英语"</strong></h3>
<p>传统背单词最大的坑是啥？就是背了"apple"只知道是"苹果"，但开会时想说"问题的核心"死活想不起来用"the core of the issue"。</p>
<p>julebu.co的句子库涵盖了：</p>
<ul>
<li><strong>商务场景</strong>：negotiate terms, facilitate communication, streamline processes</li>
<li><strong>日常对话</strong>：catch up over coffee, weather small talk, express empathy</li>
<li><strong>学术写作</strong>：the study demonstrates, empirical evidence suggests, contrary to popular belief</li>
<li><strong>考试高频</strong>：四六级、雅思托福的真题句式拆解</li>
</ul>
<p>每个句子都有真实语境，学完就能用。我上周给老板写邮件，顺手用了个"streamline the workflow"，老板还以为我去偷师了MBA课程！</p>
<h3 data-id="heading-4">3. <strong>肌肉记忆训练：重复到脱口而出</strong></h3>
<p>最变态的是它的重复机制。你以为点过一次就完事了？Too naive！</p>
<p>一个句子会<strong>在不同场景下变着花样出现5-8次</strong>：</p>
<ul>
<li>第一次：给你中文提示，连英文</li>
<li>第二次：给出首字母填空</li>
<li>第三次：完全听音频默写</li>
<li>第四次：换个相似句式让你举一反三</li>
<li>第五次：在段落中识别这个句型</li>
</ul>
<p>这种"螺旋式重复"让我的大脑形成了条件反射。现在听到"既然..."，嘴比脑子快，直接蹦出"Since..."，而不是先想"既然=since"。</p>
<h3 data-id="heading-5">4. <strong>开源免费+社区驱动</strong></h3>
<p>作为程序员，我必须吹爆它的开源属性！julebu.co背后的earthworm项目完全开源，意味着：</p>
<ul>
<li><strong>免费使用</strong>：所有核心功能不收一分钱</li>
<li><strong>数据透明</strong>：你的学习数据完全属于自己</li>
<li><strong>社区贡献</strong>：有能力的可以提交PR改进功能</li>
<li><strong>私有化部署</strong>：企业或学校可以搭建自己的版本</li>
</ul>
<p>我同事他们公司就给团队部署了一套内网版，每天午休时间大家PK积分榜，办公室学习氛围直接拉满！</p>
<h3 data-id="heading-6">5. <strong>碎片化时间+跨平台同步</strong></h3>
<p>等电梯的3分钟、地铁上的15分钟、蹲坑的5分钟...这些原本被短视频侵占的时间，现在都能刷几个句子。而且<strong>手机、平板、电脑进度实时同步</strong>，我上班在电脑上刷的，下班路上手机接着来，无缝衔接。</p>
<hr/>
<h2 data-id="heading-7">三、真实案例：他们是怎么用julebu.co逆袭的</h2>
<h3 data-id="heading-8"><strong>案例1：二本学渣逆袭雅思7.5，拿下UCL offer</strong></h3>
<p>主角：小李，某二本院校大三学生
背景：英语四级428分飘过，词汇量测试3500词，目标申请英国G5</p>
<p><strong>血泪史</strong>：
小李第一次雅思模考5分，听力听不懂，阅读做不完，写作只会简单句。他报过某哥的网课，买过*维机经，光资料就花了5000+，但成绩一直卡在5.5上不去。最崩溃的是，他发现自己连"increase steadily"和"increase sharply"都分不清。</p>
<p><strong>julebu.co逆袭之路</strong>  ：</p>
<ol>
<li><strong>第1周</strong>：每天2小时，刷完基础句型200句，发现原来自己连主谓宾结构都不扎实</li>
<li><strong>第2-4周</strong>：主攻雅思高频句型，把《剑桥真题》里的长难句拆解成julebu.co的练习题，每天重复50句</li>
<li><strong>第5-8周</strong>：配合听力跟读，把句乐部里练熟的句子主动用在口语和写作中</li>
<li><strong>第9-12周</strong>：模考发现阅读速度提升2倍，写作能自然使用复杂句式</li>
</ol>
<p><strong>成果</strong>：
3个月后雅思首考7.5分（听力8，阅读7.5，写作7，口语7）！他总结说："julebu.co让我建立了句型库，考试时不是现场造句，而是直接调用现成的句式，反应速度快了3倍！"</p>
<p>现在小李在UCL读硕士，还成了校园里的julebu.co推广大使，说每次写论文卡壳时，还会去刷几遍学术句型找找感觉。</p>
<h3 data-id="heading-9"><strong>案例2：30岁打工人从"英语恐惧症"到跨国项目组长</strong></h3>
<p>主角：张哥，某互联网公司运营，30岁
背景：工作6年，英语荒废，每次跨国会议都开静音+闭麦，被领导暗示"职业发展受限"</p>
<p><strong>血泪史</strong>：
张哥大学时英语还行，但工作后完全用不上。去年公司被外企收购，所有会议变双语。他最怕的就是那句："Can you give us a brief update?" 每次都得提前写好稿子念，被外国同事评价"too scripted"（太生硬）。</p>
<p>最尴尬的是有一次，他想表达"这个数据有问题"，结果说成"This data has some problems"，对方一脸懵逼。后来才知道地道说法是"There seems to be a discrepancy in the data."</p>
<p><strong>julebu.co逆袭之路</strong>  ：</p>
<ol>
<li><strong>第1个月</strong>：利用通勤时间刷商务场景句型，把《商务英语900句》导入julebu.co定制课程</li>
<li><strong>第2个月</strong>：在句乐部社区找到"外企会议"专题，每天模拟跟读20个会议高频句</li>
<li><strong>第3个月</strong>：开始主动在会议中套用练过的句式，比如"Let me loop back to..." "To piggyback on what [同事] said..."</li>
<li><strong>第4个月</strong>：能即兴发言3-5分钟，不再需要提前写逐字稿</li>
</ol>
<p><strong>成果</strong>：
半年后，张哥被提拔为亚太区项目协调人，薪资涨了40%！他说："julebu.co最牛的是让我形成了'句型直觉'，现在开会时脑子里是成块的句子，而不是单个单词。"</p>
<p>现在他每天早上8点准时在julebu.co打卡，还拉了个"打工人英语自救"微信群，每天分享学习心得。</p>
<h3 data-id="heading-10"><strong>案例3：全职宝妈零基础，6个月能陪娃读英文绘本</strong></h3>
<p>主角：王姐，35岁，全职妈妈
背景：高中毕业，十几年没碰英语，娃上双语幼儿园，她想陪读但力不从心</p>
<p><strong>血泪史</strong>：
王姐说最怕娃问她："妈妈，这个单词怎么读？" 她只能搪塞："妈妈去给你倒杯水...". 看着别的家长用英语跟娃无障碍交流，她既羡慕又焦虑。报过线下班，但接送孩子+家务根本坚持不下来。</p>
<p><strong>julebu.co逆袭之路</strong>  ：</p>
<ol>
<li><strong>第1-2周</strong>：从julebu.co的"kids"主题开始，每天利用娃午睡时间刷30分钟</li>
<li><strong>第1个月</strong>：掌握200个亲子生活高频句，如"Put on your shoes" "Let's tidy up the toys"</li>
<li><strong>第2-3个月</strong>：进阶到绘本句型，把《Brown Bear》《The Very Hungry Caterpillar》里的句子拆成练习</li>
<li><strong>第4-6个月</strong>：能完整读下分级读物RAZ Level D，娃的英语老师都惊讶"妈妈进步好大"</li>
</ol>
<p><strong>成果</strong>：
现在王姐是幼儿园家长圈的"英语达人"，还开了个公众号分享"宝妈英语速成法"。她说："julebu.co就像我的私人外教，随时随地能练，而且句子都特实用，娃一听就知道啥意思。"</p>
<p>最让她感动的是，娃现在会说："Mommy, you speak English so well!" 这句话她可是在julebu.co上练了20遍才说顺溜的！</p>
<hr/>
<h2 data-id="heading-11">四、julebu.co vs 传统工具：碾压级对比</h2>



























































<table><thead><tr><th>维度</th><th>传统背单词APP</th><th>线下培训班</th><th>julebu.co</th></tr></thead><tbody><tr><td><strong>价格</strong></td><td>部分收费</td><td>几千到几万</td><td>完全免费（开源）</td></tr><tr><td><strong>时间灵活性</strong></td><td>碎片时间可用</td><td>固定时间地点</td><td>随时随地，3分钟也能练</td></tr><tr><td><strong>学习方法</strong></td><td>孤立记单词</td><td>老师讲解</td><td>情境化句子，肌肉记忆</td></tr><tr><td><strong>坚持难度</strong></td><td>容易放弃</td><td>容易缺课</td><td>游戏化上瘾机制</td></tr><tr><td><strong>实用性</strong></td><td>会背不会用</td><td>理论偏多</td><td>直接掌握整句输出</td></tr><tr><td><strong>反馈速度</strong></td><td>延迟反馈</td><td>课上反馈</td><td>即时音效+可视化</td></tr><tr><td><strong>数据所有权</strong></td><td>平台控制</td><td>-</td><td>开源，数据可导出</td></tr><tr><td><strong>社区氛围</strong></td><td>较弱</td><td>线下同学</td><td>GitHub+Discord活跃社区</td></tr></tbody></table>
<p><strong>一句话总结</strong>：传统工具是"学英语"，julebu.co是"用英语"。前者给你一堆砖头，后者直接给你盖好的房子，拎包入住！</p>
<hr/>
<h2 data-id="heading-12">五、不同人群的定制化打法</h2>
<h3 data-id="heading-13"><strong>🎓 学生党（四六级/考研/雅思托福）</strong></h3>
<p><strong>核心策略</strong>：把真题长难句导入julebu.co</p>
<ul>
<li><strong>四六级</strong>：刷完近10年真题的阅读长难句，保证阅读速度提升50%</li>
<li><strong>考研英语</strong>：重点攻克唐迟《阅读的逻辑》里的典型句型</li>
<li><strong>雅思托福</strong>：配合听力材料，把听不懂的句子变成julebu.co练习题</li>
</ul>
<p><strong>每日时长</strong>：1-2小时，考前一个月可增至3小时</p>
<p><strong>效果预期</strong>：3个月阅读从错10个到错2个，写作从5分到7分</p>
<h3 data-id="heading-14"><strong>💼 职场人士（外企/跨境电商/国际业务）</strong></h3>
<p><strong>核心策略</strong>：场景化突击</p>
<ul>
<li><strong>会议场景</strong>：练熟"表态""打断""总结"三大功能句</li>
<li><strong>邮件写作</strong>：掌握20个高分替换句型（如用"kindly remind"代替"please remember"）</li>
<li><strong>谈判场景</strong>：背诵30个缓和语气的缓冲句</li>
</ul>
<p><strong>每日时长</strong>：通勤30分钟+工作间隙15分钟</p>
<p><strong>效果预期</strong>：2个月能主动发言，6个月能主导会议</p>
<h3 data-id="heading-15"><strong>👶 家长（陪娃英语/亲子互动）</strong></h3>
<p><strong>核心策略</strong>：生活化场景</p>
<ul>
<li><strong>早晨起床</strong>：Put on your clothes/Brush your teeth/Breakfast is ready</li>
<li><strong>晚上睡前</strong>：Let's read a story/Time for bed/Sweet dreams</li>
<li><strong>情绪管理</strong>：Don't worry/It's okay to make mistakes/I'm proud of you</li>
</ul>
<p><strong>每日时长</strong>：娃看动画片时刷15分钟</p>
<p><strong>效果预期</strong>：1个月能简单指令，3个月能陪读绘本</p>
<hr/>
<h2 data-id="heading-16">六、高手私藏的使用技巧（建议收藏）</h2>
<h3 data-id="heading-17"><strong>技巧1：DIY专属词库</strong></h3>
<p>julebu.co支持自定义导入！把你工作中常用的句子整理成CSV：</p>
<pre><code class="hljs language-arduino" lang="arduino">中文,英文
<span class="hljs-string">"这个项目有风险"</span>,<span class="hljs-string">"There are potential risks associated with this project"</span>
<span class="hljs-string">"需要高层批准"</span>,<span class="hljs-string">"This requires approval from senior management"</span>
</code></pre>
<p>导入后就成了你的专属课程，针对性MAX！</p>
<h3 data-id="heading-18"><strong>技巧2：利用"遗忘曲线"设置复习</strong></h3>
<p>julebu.co会自动记录你的错误句子。每周日把本周错题导出，用Anki再复习一遍，形成双重保险。我保证你忘不掉！</p>
<h3 data-id="heading-19"><strong>技巧3：社群PK提升动力</strong></h3>
<p>加入julebu.co的Discord社区，参与"30天打卡挑战"。有陌生人监督，坚持成功率提升300%！而且社区里有大神分享《经济学人》句型包、《老友记》台词包等稀缺资源。</p>
<h3 data-id="heading-20"><strong>技巧4：跟读模式练口语</strong></h3>
<p>别只盯着屏幕点！julebu.co每个句子都有音频，点完句子后跟着读3遍。我用这招练了1个月，口音从Chinglish变成了"有点意思的国际范"。</p>
<h3 data-id="heading-21"><strong>技巧5：生产化输出</strong></h3>
<p>学过100个句子后，强迫自己每天用5个新句子发朋友圈（设为自己可见也行）。输出是检验输入的唯一标准！</p>
<hr/>
<h2 data-id="heading-22">七、如何开始你的逆袭之路？（手把手教程）</h2>
<p><strong>第一步：访问官网</strong>
直接戳这里 → <a href="https://link.juejin.cn?target=https%3A%2F%2Fjulebu.co%2Faff%2FRQH6MRYL" target="_blank" title="https://julebu.co/aff/RQH6MRYL" ref="nofollow noopener noreferrer">julebu.co/</a>（建议PC端体验更佳）</p>
<p><strong>第二步：注册账号</strong>
5秒搞定，支持GitHub一键登录（程序员福音）</p>
<p><strong>第三步：选择起点</strong></p>
<ul>
<li><strong>新手</strong>：从"基础句型"开始</li>
<li><strong>中级</strong>：直接刷"商务场景"</li>
<li><strong>高手</strong>：导入专业材料（法律文书、医学文献等）</li>
</ul>
<p><strong>第四步：设置每日目标</strong>
建议新手设为20句/天，适应后增至50句。记住：<strong>慢就是快，少即是多</strong>！</p>
<p><strong>第五步：加入社区</strong>
官网底部有Discord链接，进去先打个招呼#introduce-yourself，会有人带你飞</p>
<p><strong>第六步：坚持使用30天</strong>
这是最关键的！前3天可能没感觉，第7天开始上头，第30天你会来感谢我！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅]]></title>    <link>https://juejin.cn/post/7591465142451486772</link>    <guid>https://juejin.cn/post/7591465142451486772</guid>    <pubDate>2026-01-05T05:43:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591465142451486772" data-draft-id="7591330139083784207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-05T05:43:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="熊猫钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1303344484202867"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1303344484202867/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    熊猫钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T05:43:52.000Z" title="Mon Jan 05 2026 05:43:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我和TRAE的这一年：2025年从初识到羁绊的AI编程梦幻之旅</h2>
<p>2025年我初识TRAE，也是这一年刚刚加入掘金社区，认识了很多热心的小伙伴，有你们相伴的感觉真好。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9145f6881a9432b927a3460a07eee26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=4CFOMKnTOPu5UloMKAhY0jRFxaQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>今年的年终总结应该是特别的，这一年TRAE带给我的收获满满。</p>
<p>回首2025年，我不仅用TRAE编写了大量的代码，开发出了好几款应用，同时也用它撰写报告和制作分析图表，它总是能一次又一次带给我震撼和惊喜。</p>
<p>我相信，TRAE使我相信，AI的时代真的到来了！</p>
<h3 data-id="heading-1">一、TRAE ：开发与创作同行</h3>
<p>我初次使用TRAE是在VS Code IDE中安装Trae插件。开发了一款简单实用的Excel合并工具。</p>
<p>这是我第一次用TRAE，使用VibeCoding的感觉太奇妙了!~</p>
<p>因为我在日常办公和数据处理中，经常会需要对Excel文件资料进行合并，汇总分散在不同文件中的数据，这是一个常见但繁琐的任务，耗时耗力，传统的手动操作不仅效率低下，而且容易出错。专门写代码也需要花费不小的功夫去开发和调试，显得有些鸡肋，因此，我想利用AI工具快速开发一个Excel多文件多表合并工具。</p>
<p>我只是简单在Trae的聊天框中输入：
"请帮我在当前工程下完成一个Excel多文件多表合并工具。该工具支持Windows系统，无需安装，打开即可使用。"
Trae立即响应，建议使用Python的pandas库来处理Excel文件，并自动创建了一个新的Python脚本。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8881e20e18fc49a08253f16a52541884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=FCKxd4fWymZPutHk7iz0c2mIH04%3D" alt="在这里插入图片描述" loading="lazy"/>
Trae Builder模式初体验，我觉得它能够理解自然语言描述的项目需求，并自动生成可运行的代码框架，而且速度特别快，只用了十来分钟就完成了可用的程序功能。</p>
<p>感谢掘金社区这么一个平台的存在。</p>
<p>我把我的经历和感悟都写出了博客进行分享。</p>
<p>5月19日，我首次发布了两篇文章，心情忐忑又激动。
《对话即编程：如何用 Trae 的 @智能体 5 分钟修复一个复杂 Bug？》《从编程助手到AI工程师：Trae插件Builder模式实战Excel合并工具开发》</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a93df564f4a422e8062f8b5675de077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=DQHfGoZJyxEHh9xFwo0Q0cenqZ0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>以及之后创作了《 超快速开发！手把手教你基于Trae IDE 04.22构建智能磁盘清理工具——AI原生开发范式实践 》等文章，很快就都被推荐到掘金社区的首页。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35ef31d1109040b08ede7f9c30706a12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=Y7aSU9OI6BJ0JjMYBN2bGRx2nNI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>随后，更是获得了社区的多篇征文奖励，使我备受鼓舞。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d801475ebad44dba98bacdeff70f057~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=cgGl6ZXThmj8UgBRxw4MYilrios%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ae41ea9c2804c4f8cb595cc4f4ebdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=%2FcCcrgjsn1LVIRH1fEGcDiGKQes%3D" alt="w6.jpg" loading="lazy"/></p>
<p>社区的分享讨论，使我更加有信心利用先进的AI编程工具解决代码难题，提升工作效率。同时增加了与志同道合的小伙伴们的交流，社区的朋友们总是热情地解答我的问题，给予了我大量无私的帮助。</p>
<p>这一年我给TRAE.ai的公众号写了几篇文章，被授予了“年度创作之星”。这项珍贵的荣誉，给我的2025年画上了一个完美的句号。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09896cdba7884bb3a3b881bf693ddcce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=W7hupuERNh2rciHlQ6LeNwJdTJc%3D" alt="w4.jpg" loading="lazy"/></p>
<h3 data-id="heading-2">二、TRAE 年度报告：MVP书写感动！</h3>
<p>看到年度报告的那一刻，我有些惊讶。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f094ce9ae77241508c07ba3556459b92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=4pQ4KamvQGEUGkBFgScUR0iuGsk%3D" alt="w3.png" loading="lazy"/></p>
<p>创世神。全场MVP。超越99%用户的代码量。这些词组合在一起，我觉得对于我有些不可思议。</p>
<p>我真的只是一个新人，没想到这一年来，自己已经走过了这么远的路。</p>
<p>但屏幕上那个数字——172,106行代码，又实实在在地摆在那里。十倍于FC版《超级玛丽》的代码量，原来真的是TRAE伴随我一路风霜，它帮我一行一行敲出来的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59b48e9b9e754dc78c1456787bef820c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=qi00f%2FPTzRlMD619Mahus%2BQbJLA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>2026年1月4日，我写下这篇总结的最终版。距离我第一次使用TRAE，已经过去了220天。这220天里，TRAE不仅是我的开发工具，更像是我的伙伴，见证了我的成长与蜕变。</p>
<h3 data-id="heading-3">三、与TRAE朝夕相伴的日夜</h3>
<p>在这220天里，我见证了TRAE SOLO功能的多次更新：</p>
<ul>
<li><strong>AI代码补全增强</strong>：从简单的代码片段补全，到支持完整函数、类的生成，甚至能够理解项目上下文</li>
<li><strong>多语言支持优化</strong>：最初只支持Python、JavaScript等主流语言，现在已经支持Go、Java、Rust等多种语言</li>
<li><strong>调试能力提升</strong>：从只能生成代码，到能够协助调试、分析错误日志、提供修复方案</li>
<li><strong>项目管理功能</strong>：新增了项目模板、版本控制、协作功能，让SOLO开发也能享受团队级别的管理体验</li>
</ul>
<p>每次更新都让我感受到TRAE团队的用心，他们真正理解开发者的需求，并且快速响应。这种持续进化的能力，是TRAE最吸引我的地方之一。</p>
<p>90天的年度活跃天数，说多不多，说少也不少。但那些深夜里敲代码的时光，那些被bug折磨到抓狂的时刻，那些终于跑通程序时的兴奋，都真实地发生着。</p>
<p>6月2日那天，我写了12435行代码。现在回想起来，那天应该是在做"智能会议纪要助手"的第一个版本。为了实现实时转录功能，我和TRAE反复调试，从深夜10点一直到凌晨3点。当第一个完整的会议纪要生成出来时，我兴奋得像个孩子，立刻给朋友发了截图分享。</p>
<p>8月3日凌晨1点04分，我还沉迷在TRAE的世界里。那天是在修复项目中的一个bug。我和TRAE一起分析日志、调试代码，终于找到了问题所在：对话历史管理模块的缓存机制有问题。当我修复这个bug，夜色已深，我在疲倦中入睡，心情却异常安稳踏实。</p>
<p>10月26日那天，我在IDE里待了384分钟。那天是在优化"智能会议纪要助手"的性能，原来的模型处理长会议时会卡顿。我和TRAE一起尝试了多种优化方案，最终采用了分段处理和增量生成的方式，让系统能够流畅处理长达4小时的会议。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a444e077d34432783b75a05496b618f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=kpfVuIqFHSh1CwPDUcF6FW%2FgQNg%3D" alt="w4.png" loading="lazy"/></p>
<p>回想这一年，我的技能结构发生了巨大的变化。年初时，我还在为代码自动补全工具的小幅提升感到欣喜；到年中的TRAE黑客松，我已经能够利用AI平台在短时间内构建完整的应用；而到了年末，AI已经从单纯的辅助工具变成了我的"开发伙伴"。</p>
<p>黑客松之后，我开始认真思考如何将Demo转化为可用的产品。在开发项目的过程中，我经历了思维方式的深刻转变。</p>
<p>传统软件开发追求的是确定性和可控性——相同输入必须产生相同输出，每一步操作都应当可预测。而AI开发则建立在概率性基础上——相同的输入可能产生略有不同的输出，我们需要接受这种不确定性，并学会如何控制和优化它。</p>
<p>刚开始，这种不确定性让我很不适应。我习惯了精确控制每一行代码的执行结果，现在却要接受AI输出的"随机性"。但慢慢地，我发现这种不确定性其实是AI的魅力所在。它能够产生意想不到的创意，提供多样化的解决方案，让产品变得更加灵活和智能。</p>
<p>我学会了如何设计"容错"的系统，如何通过提示词工程引导AI输出期望的结果，如何建立质量评估机制来筛选AI生成的内容。这些经验成为了我2025年技术成长中最宝贵的财富。</p>
<p>更有趣的是，我发现独立开发者在AI应用方面表现最为积极。这主要得益于AI工具降低了技术门槛，使个人开发者也能实现原本需要团队才能完成的功能。这种趋势正在重塑整个软件开发生态，为更多创新提供了可能。</p>
<h3 data-id="heading-4">四、TRAE SOLO Hackathon线下活动：头脑风暴展示TRAE SOLO的魅力</h3>
<p>真正让我对TRAE产生质的认知的，是那场武汉场的TRAE SOLO黑客松。现在回想起来，TRAE SOLO功能的设计理念，其实早已预示了Vibe Coding的未来。</p>
<p>11月16日是一个值得纪念的周末，我有幸受邀参加了武汉场的TRAE SOLO Hackathon线下活动。当天上午的老师们的分享非常有趣，下午是我们battle的主场，武汉场的TRAE用户同伴也都很nice!</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d7e627048f3401cb85e39f42d66ecd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=GLrwBvukS3W3rtZaZS80wY0Vk9k%3D" alt="image.png" loading="lazy"/></p>
<p>值得一提的是，中午的盒饭和餐点真的很好吃！
晒一下我当天的伙食。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e05cb4cb1ba14b6188958e8b761389b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=4n%2B6jQC6qZvJIjlT2CT3QZLcYgY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在黑客松中，我仅用了半天3个小时就开发出了一个基本完整的应用：</p>
<p><strong>TRAE SOLO环游世界游戏轻应用</strong>：包含景点打卡系统、道具收集机制、道具交易系统、AI智能向导、成就系统等丰富功能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889668422e95419f803c04e4cdbee09a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=i0iVuLf0ZS4%2F2UvYT5tYKNwL0yE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b643070db7704433acedd1e01b5685d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=gmdnktAEQMpxcALhAaAKPnUTXsk%3D" alt="2.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d71ba9c6474c4ebe72d51cb780306d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=JiYOxg8rfrvFFZcucKqQkChIWow%3D" alt="3.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07842f276cc546929d7207ae2f24f3b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=cOO7M2JjdZnm1quWeCedTCI%2F%2BWs%3D" alt="image.png" loading="lazy"/></p>
<p>"环游世界"是一个与我以往开发办公应用实用工具为主相反的完全不同的尝试。</p>
<p>我想做一个游戏，让玩家通过对话的方式，在虚拟世界中旅行、探索、学习。这个想法听起来很简单，但实现起来需要复杂的对话系统、状态管理、内容生成。在传统开发模式下，这几乎是一个独立开发者无法完成的任务。</p>
<p>但TRAE SOLO改变了这一切。我能够快速集成智能对话系统，让NPC有自己的个性和记忆；能够轻松生成多样化的场景描述，从巴黎的埃菲尔铁塔到亚马逊的热带雨林；能够实现个性化的游戏体验，根据玩家的选择调整剧情走向。最让我感动的是，有玩家反馈说："这个游戏让我在屏幕前就感受到了世界的广阔"。</p>
<p>这个应用让我获得了二等奖的殊荣。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3a440dc5d94a6597c8a4f4daa3d04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54aK54yr6ZKT6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768196632&amp;x-signature=ur5g8hejqnlDefYcDY7PSqWDA6o%3D" alt="w5.jpg" loading="lazy"/></p>
<p>TRAE SOLO真正吸引我的地方，是它"一人即团队"的设计理念。在传统开发中，一个完整的项目需要前端、后端、测试等多个角色配合，而TRAE SOLO让我一个人就能完成整个开发流程。</p>
<p>最让我惊喜的是，TRAE SOLO不仅提供了强大的开发能力，还内置了<strong>轻应用发布</strong>功能，让我能够快速将作品分享给其他用户。这种"开发-发布-反馈"的闭环体验，极大地提升了我的开发热情。</p>
<h3 data-id="heading-5">写在最后：未来的展望</h3>
<p>创世神这个称号，听起来很厉害，但我知道，真正的"创世"不是写了多少代码，而是这些代码最终变成了什么。"智能会议纪要助手"帮助了很多人提高工作效率，"环游世界"游戏给玩家带来了快乐和启发，这些才是真正有价值的东西。</p>
<p>在这一年里，TRAE见证了我的技术成长。</p>
<p>新的一年就要来了，我对未来充满期待。我会继续写代码，继续学习，继续创造。我相信，在TRAE的陪伴下，我会创造出更多有价值的产品，结识更多有趣的人，经历更多精彩的故事。</p>
<p>就像TRAE说的，我们的冒险已经启程。220天只是开始，后面的路还很长。</p>
<p>——熊猫钓鱼，2026年1月5日</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python迭代器与生成器：优雅的惰性计算艺术]]></title>    <link>https://juejin.cn/post/7591506455972528182</link>    <guid>https://juejin.cn/post/7591506455972528182</guid>    <pubDate>2026-01-05T07:49:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591506455972528182" data-draft-id="7591497387245142052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python迭代器与生成器：优雅的惰性计算艺术"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-05T07:49:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python迭代器与生成器：优雅的惰性计算艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:49:23.000Z" title="Mon Jan 05 2026 07:49:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一、迭代器协议：<code>__iter__</code>和<code>__next__</code>的魔法</h2>
<h3 data-id="heading-1">迭代器的本质</h3>
<p>Python中的迭代器不是存储所有元素的容器，而是<strong>惰性计算</strong>的协议实现。核心在于两个方法：</p>
<ul>
<li><code>__iter__()</code>：返回迭代器自身</li>
<li><code>__next__()</code>：返回下一个元素，耗尽时抛出<code>StopIteration</code></li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDown</span>:
    <span class="hljs-string">"""自定义迭代器：倒计时"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, start</span>):
        self.current = start
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self  <span class="hljs-comment"># 迭代器必须返回自身</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> self.current &lt;= <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> StopIteration
        num = self.current
        self.current -= <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> num

<span class="hljs-comment"># 使用</span>
<span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> CountDown(<span class="hljs-number">5</span>):
    <span class="hljs-built_in">print</span>(num)  <span class="hljs-comment"># 输出: 5 4 3 2 1</span>
</code></pre>
<h3 data-id="heading-2">迭代器的优势</h3>
<ul>
<li><strong>内存高效</strong>：不一次性加载所有数据</li>
<li><strong>无限序列</strong>：可以表示无限长的序列</li>
<li><strong>通用接口</strong>：统一的<code>for</code>循环处理方式</li>
</ul>
<h2 data-id="heading-3">二、生成器：<code>yield</code>的暂停与恢复魔法</h2>
<h3 data-id="heading-4">生成器函数</h3>
<p>生成器是创建迭代器的<strong>语法糖</strong>，使用<code>yield</code>暂停函数执行并返回值：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci_generator</span>(<span class="hljs-params">limit</span>):
    <span class="hljs-string">"""生成斐波那契数列"""</span>
    a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> count &lt; limit:
        <span class="hljs-keyword">yield</span> a  <span class="hljs-comment"># 暂停执行，返回a</span>
        a, b = b, a + b
        count += <span class="hljs-number">1</span>

<span class="hljs-comment"># 生成器对象</span>
fib_gen = fibonacci_generator(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(fib_gen))  <span class="hljs-comment"># 0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(fib_gen))  <span class="hljs-comment"># 1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(fib_gen))  <span class="hljs-comment"># [1, 2, 3, 5, 8, 13, 21, 34]</span>
</code></pre>
<h3 data-id="heading-5">生成器表达式</h3>
<p>更简洁的生成器创建方式：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 传统列表推导（立即计算）</span>
squares_list = [x**<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>)]  <span class="hljs-comment"># 占用大量内存</span>

<span class="hljs-comment"># 生成器表达式（惰性计算）</span>
squares_gen = (x**<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>))  <span class="hljs-comment"># 几乎不占内存</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(squares_gen))  <span class="hljs-comment"># 0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(squares_gen))  <span class="hljs-comment"># 1</span>
</code></pre>
<h2 data-id="heading-6">三、<code>yield from</code>：生成器的委派机制</h2>
<h3 data-id="heading-7">简化嵌套生成器</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">chain_generators</span>(<span class="hljs-params">*iterables</span>):
    <span class="hljs-string">"""连接多个可迭代对象"""</span>
    <span class="hljs-keyword">for</span> iterable <span class="hljs-keyword">in</span> iterables:
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> iterable  <span class="hljs-comment"># 委派给子生成器</span>

<span class="hljs-comment"># 等效于：</span>
<span class="hljs-comment"># for item in iterable:</span>
<span class="hljs-comment">#     yield item</span>

result = <span class="hljs-built_in">list</span>(chain_generators([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-string">'ab'</span>, (<span class="hljs-literal">True</span>, <span class="hljs-literal">False</span>)))
<span class="hljs-comment"># [1, 2, 'a', 'b', True, False]</span>
</code></pre>
<h2 data-id="heading-8">四、生成器的高级用法</h2>
<h3 data-id="heading-9">1. 协程：双向通信</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">coroutine_generator</span>():
    <span class="hljs-string">"""接收外部数据的生成器"""</span>
    total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        value = <span class="hljs-keyword">yield</span> total  <span class="hljs-comment"># 暂停并接收发送的值</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">break</span>
        total += value

coro = coroutine_generator()
<span class="hljs-built_in">next</span>(coro)  <span class="hljs-comment"># 启动生成器（预激）</span>
<span class="hljs-built_in">print</span>(coro.send(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 10</span>
<span class="hljs-built_in">print</span>(coro.send(<span class="hljs-number">20</span>))  <span class="hljs-comment"># 30</span>
coro.close()  <span class="hljs-comment"># 关闭生成器</span>
</code></pre>
<h3 data-id="heading-10">2. 上下文管理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">managed_resource</span>():
    <span class="hljs-string">"""生成器实现的上下文管理器"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"获取资源"</span>)
    resource = <span class="hljs-string">"资源对象"</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> resource
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"释放资源"</span>)

<span class="hljs-keyword">with</span> managed_resource() <span class="hljs-keyword">as</span> r:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"使用 <span class="hljs-subst">{r}</span>"</span>)
</code></pre>
<h2 data-id="heading-11">五、性能对比：迭代器 vs 列表</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_memory_usage</span>():
    <span class="hljs-string">"""内存使用对比"""</span>
    <span class="hljs-comment"># 列表：一次性加载所有数据</span>
    list_data = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>)]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"列表内存: <span class="hljs-subst">{sys.getsizeof(list_data):,}</span> bytes"</span>)
    
    <span class="hljs-comment"># 生成器：惰性计算</span>
    gen_data = (i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成器内存: <span class="hljs-subst">{sys.getsizeof(gen_data):,}</span> bytes"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_performance</span>():
    <span class="hljs-string">"""性能对比"""</span>
    n = <span class="hljs-number">10_000_000</span>
    
    <span class="hljs-comment"># 列表推导</span>
    start = time.time()
    _ = [x**<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]
    list_time = time.time() - start
    
    <span class="hljs-comment"># 生成器表达式</span>
    start = time.time()
    _ = (x**<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n))
    gen_time = time.time() - start
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"列表推导: <span class="hljs-subst">{list_time:<span class="hljs-number">.3</span>f}</span>s"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成器表达式: <span class="hljs-subst">{gen_time:<span class="hljs-number">.3</span>f}</span>s"</span>)

test_memory_usage()
test_performance()
</code></pre>
<h2 data-id="heading-12">六、实用模式与陷阱</h2>
<h3 data-id="heading-13">1. 生成器的一次性使用</h3>
<pre><code class="hljs language-python" lang="python">gen = (x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(gen))  <span class="hljs-comment"># [0, 1, 2]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(gen))  <span class="hljs-comment"># [] ！已耗尽</span>
</code></pre>
<h3 data-id="heading-14">2. <code>itertools</code>模块的迭代器工具</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> islice, count, cycle

<span class="hljs-comment"># 无限序列的切片</span>
first_10 = <span class="hljs-built_in">list</span>(islice(count(<span class="hljs-number">10</span>), <span class="hljs-number">5</span>))  <span class="hljs-comment"># [10, 11, 12, 13, 14]</span>

<span class="hljs-comment"># 循环迭代器</span>
cycler = cycle(<span class="hljs-string">'ABC'</span>)
<span class="hljs-built_in">print</span>([<span class="hljs-built_in">next</span>(cycler) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>)])  <span class="hljs-comment"># ['A', 'B', 'C', 'A', 'B', 'C']</span>
</code></pre>
<h3 data-id="heading-15">3. 自定义可迭代对象</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessor</span>:
    <span class="hljs-string">"""分批处理大数据集"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data, batch_size</span>):
        self.data = data
        self.batch_size = batch_size
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""返回生成器迭代器"""</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(self.data), self.batch_size):
            <span class="hljs-keyword">yield</span> self.data[i:i + self.batch_size]

data = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>))
batcher = BatchProcessor(data, <span class="hljs-number">10</span>)
<span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> batcher:
    process(batch)  <span class="hljs-comment"># 每次处理10个元素</span>
</code></pre>
<h2 data-id="heading-16">总结</h2>
<p>迭代器和生成器是Python<strong>惰性计算哲学</strong>的体现，它们通过：</p>
<ol>
<li><strong>按需计算</strong>节省内存</li>
<li><strong>统一的迭代协议</strong>简化API设计</li>
<li><strong>生成器协程</strong>实现复杂控制流</li>
<li><strong>优雅的语法</strong>让代码更清晰</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python描述符协议：属性访问的底层魔法]]></title>    <link>https://juejin.cn/post/7591407298415149062</link>    <guid>https://juejin.cn/post/7591407298415149062</guid>    <pubDate>2026-01-05T07:53:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591407298415149062" data-draft-id="7591403124328153151" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python描述符协议：属性访问的底层魔法"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-05T07:53:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python描述符协议：属性访问的底层魔法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T07:53:16.000Z" title="Mon Jan 05 2026 07:53:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一、描述符协议：<code>__get__</code>、<code>__set__</code>、<code>__delete__</code></h2>
<h3 data-id="heading-1">描述符的本质</h3>
<p>描述符是实现了特定协议的类，它控制对其他对象属性的访问。这是Python属性、方法、静态方法等特性的基础：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidatedAttribute</span>:
    <span class="hljs-string">"""数据验证描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, validator</span>):
        self.validator = validator
        self.attr_name = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 稍后由__set_name__设置</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set_name__</span>(<span class="hljs-params">self, owner, name</span>):
        <span class="hljs-string">"""在描述符被赋值给类属性时调用（Python 3.6+）"""</span>
        self.attr_name = name
        self.storage_name = <span class="hljs-string">f"_<span class="hljs-subst">{name}</span>"</span>  <span class="hljs-comment"># 实际存储的私有属性名</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""获取属性值时调用"""</span>
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self  <span class="hljs-comment"># 通过类访问时返回描述符本身</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(obj, self.storage_name, <span class="hljs-literal">None</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-string">"""设置属性值时调用"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.validator(value):
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"Invalid value for <span class="hljs-subst">{self.attr_name}</span>: <span class="hljs-subst">{value}</span>"</span>)
        <span class="hljs-built_in">setattr</span>(obj, self.storage_name, value)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, obj</span>):
        <span class="hljs-string">"""删除属性时调用"""</span>
        <span class="hljs-built_in">delattr</span>(obj, self.storage_name)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">is_positive_number</span>(<span class="hljs-params">value</span>):
    <span class="hljs-string">"""验证函数：必须是正数"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">isinstance</span>(value, (<span class="hljs-built_in">int</span>, <span class="hljs-built_in">float</span>)) <span class="hljs-keyword">and</span> value &gt; <span class="hljs-number">0</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    <span class="hljs-comment"># 使用描述符</span>
    price = ValidatedAttribute(is_positive_number)
    quantity = ValidatedAttribute(is_positive_number)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, price, quantity</span>):
        self.name = name
        self.price = price  <span class="hljs-comment"># 触发__set__</span>
        self.quantity = quantity  <span class="hljs-comment"># 触发__set__</span>

<span class="hljs-comment"># 使用</span>
<span class="hljs-keyword">try</span>:
    p = Product(<span class="hljs-string">"Apple"</span>, <span class="hljs-number">10.5</span>, <span class="hljs-number">5</span>)
    <span class="hljs-built_in">print</span>(p.price)  <span class="hljs-comment"># 10.5，触发__get__</span>
    
    p.price = -<span class="hljs-number">5</span>  <span class="hljs-comment"># 触发__set__，抛出ValueError</span>
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"验证错误: <span class="hljs-subst">{e}</span>"</span>)

p.quantity = <span class="hljs-number">20</span>  <span class="hljs-comment"># 正常设置</span>
</code></pre>
<h2 data-id="heading-2">二、描述符的类型</h2>
<h3 data-id="heading-3">1. 数据描述符（实现<code>__set__</code>或<code>__delete__</code>）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggedAttribute</span>:
    <span class="hljs-string">"""记录所有访问的数据描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.data = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"读取 <span class="hljs-subst">{obj}</span>.<span class="hljs-subst">{self.attr_name}</span>"</span>)
        <span class="hljs-keyword">return</span> self.data.get(<span class="hljs-built_in">id</span>(obj))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"设置 <span class="hljs-subst">{obj}</span>.<span class="hljs-subst">{self.attr_name}</span> = <span class="hljs-subst">{value}</span>"</span>)
        self.data[<span class="hljs-built_in">id</span>(obj)] = value
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set_name__</span>(<span class="hljs-params">self, owner, name</span>):
        self.attr_name = name
</code></pre>
<h3 data-id="heading-4">2. 非数据描述符（只实现<code>__get__</code>）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedProperty</span>:
    <span class="hljs-string">"""属性缓存描述符（非数据描述符）"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):
        self.func = func
        self.name = func.__name__
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self
        
        <span class="hljs-comment"># 计算并缓存结果</span>
        value = self.func(obj)
        obj.__dict__[self.name] = value  <span class="hljs-comment"># 存储在实例字典中</span>
        <span class="hljs-keyword">return</span> value


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, radius</span>):
        self.radius = radius
    
<span class="hljs-meta">    @CachedProperty</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"计算面积..."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14159</span> * self.radius ** <span class="hljs-number">2</span>
    
<span class="hljs-meta">    @CachedProperty</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">circumference</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"计算周长..."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-number">3.14159</span> * self.radius

c = Circle(<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(c.area)  <span class="hljs-comment"># 计算面积... 78.53975</span>
<span class="hljs-built_in">print</span>(c.area)  <span class="hljs-comment"># 78.53975（从缓存读取，不再打印"计算面积..."）</span>
</code></pre>
<h2 data-id="heading-5">三、Python内置描述符的实现</h2>
<h3 data-id="heading-6">1. <code>property</code>装饰器的实现原理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperty</span>:
    <span class="hljs-string">"""简化版的property实现"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, fget=<span class="hljs-literal">None</span>, fset=<span class="hljs-literal">None</span>, fdel=<span class="hljs-literal">None</span></span>):
        self.fget = fget
        self.fset = fset
        self.fdel = fdel
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype=<span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self
        <span class="hljs-keyword">if</span> self.fget <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">"unreadable attribute"</span>)
        <span class="hljs-keyword">return</span> self.fget(obj)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-keyword">if</span> self.fset <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">"can't set attribute"</span>)
        self.fset(obj, value)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delete__</span>(<span class="hljs-params">self, obj</span>):
        <span class="hljs-keyword">if</span> self.fdel <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">"can't delete attribute"</span>)
        self.fdel(obj)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setter</span>(<span class="hljs-params">self, fset</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(self)(self.fget, fset, self.fdel)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">deleter</span>(<span class="hljs-params">self, fdel</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(self)(self.fget, self.fset, fdel)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):
        self._name = name
    
<span class="hljs-meta">    @MyProperty</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._name
    
<span class="hljs-meta">    @name.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> value:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"Name cannot be empty"</span>)
        self._name = value

p = Person(<span class="hljs-string">"Alice"</span>)
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># Alice</span>
p.name = <span class="hljs-string">"Bob"</span>
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># Bob</span>
</code></pre>
<h3 data-id="heading-7">2. 方法和静态方法的描述符实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> types

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMethod</span>:
    <span class="hljs-string">"""模拟方法描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):
        self.func = func
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self.func  <span class="hljs-comment"># 通过类访问</span>
        <span class="hljs-comment"># 绑定方法：将实例作为第一个参数</span>
        <span class="hljs-keyword">return</span> types.MethodType(self.func, obj)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStaticMethod</span>:
    <span class="hljs-string">"""模拟静态方法描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):
        self.func = func
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># 始终返回原始函数</span>
        <span class="hljs-keyword">return</span> self.func


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
<span class="hljs-meta">    @MyMethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">instance_method</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"实例方法，self=<span class="hljs-subst">{self}</span>"</span>
    
<span class="hljs-meta">    @MyStaticMethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">static_method</span>():
        <span class="hljs-keyword">return</span> <span class="hljs-string">"静态方法"</span>

obj = MyClass()
<span class="hljs-built_in">print</span>(obj.instance_method())  <span class="hljs-comment"># 实例方法，self=&lt;__main__.MyClass object&gt;</span>
<span class="hljs-built_in">print</span>(MyClass.static_method())  <span class="hljs-comment"># 静态方法</span>
</code></pre>
<h2 data-id="heading-8">四、描述符的应用场景</h2>
<h3 data-id="heading-9">1. ORM（对象关系映射）框架</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Field</span>:
    <span class="hljs-string">"""数据库字段描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, field_type, nullable=<span class="hljs-literal">True</span>, default=<span class="hljs-literal">None</span></span>):
        self.field_type = field_type
        self.nullable = nullable
        self.default = default
        self.name = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set_name__</span>(<span class="hljs-params">self, owner, name</span>):
        self.name = name
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self
        <span class="hljs-comment"># 从实例的__dict__中获取值</span>
        <span class="hljs-keyword">return</span> obj.__dict__.get(self.name, self.default)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self.nullable:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> cannot be null"</span>)
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, self.field_type):
            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> must be <span class="hljs-subst">{self.field_type}</span>"</span>)
        obj.__dict__[self.name] = value


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelMeta</span>(<span class="hljs-title class_ inherited__">type</span>):
    <span class="hljs-string">"""元类，用于收集描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, name, bases, attrs</span>):
        <span class="hljs-comment"># 收集所有Field描述符</span>
        fields = {}
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> attrs.items():
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, Field):
                fields[key] = value
        
        attrs[<span class="hljs-string">'_fields'</span>] = fields
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(cls, name, bases, attrs)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(metaclass=ModelMeta):
    <span class="hljs-built_in">id</span> = Field(<span class="hljs-built_in">int</span>, nullable=<span class="hljs-literal">False</span>)
    name = Field(<span class="hljs-built_in">str</span>, nullable=<span class="hljs-literal">False</span>)
    email = Field(<span class="hljs-built_in">str</span>, default=<span class="hljs-string">""</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, **kwargs</span>):
        <span class="hljs-keyword">for</span> field_name, field <span class="hljs-keyword">in</span> self._fields.items():
            value = kwargs.get(field_name, field.default)
            <span class="hljs-built_in">setattr</span>(self, field_name, value)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">to_dict</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> {name: <span class="hljs-built_in">getattr</span>(self, name) <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self._fields}

<span class="hljs-comment"># 使用</span>
user = User(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">"Alice"</span>)
<span class="hljs-built_in">print</span>(user.to_dict())  <span class="hljs-comment"># {'id': 1, 'name': 'Alice', 'email': ''}</span>
</code></pre>
<h3 data-id="heading-10">2. 类型检查和自动转换</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedAttribute</span>:
    <span class="hljs-string">"""类型检查和自动转换描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, expected_type, converter=<span class="hljs-literal">None</span></span>):
        self.expected_type = expected_type
        self.converter = converter
        self.storage_name = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set_name__</span>(<span class="hljs-params">self, owner, name</span>):
        self.storage_name = <span class="hljs-string">f"_<span class="hljs-subst">{name}</span>"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> self
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(obj, self.storage_name, <span class="hljs-literal">None</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">setattr</span>(obj, self.storage_name, <span class="hljs-literal">None</span>)
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># 尝试类型转换</span>
        <span class="hljs-keyword">if</span> self.converter <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, self.expected_type):
            <span class="hljs-keyword">try</span>:
                value = self.converter(value)
            <span class="hljs-keyword">except</span> (ValueError, TypeError):
                <span class="hljs-keyword">pass</span>
        
        <span class="hljs-comment"># 类型检查</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, self.expected_type):
            <span class="hljs-keyword">raise</span> TypeError(
                <span class="hljs-string">f"Expected <span class="hljs-subst">{self.expected_type.__name__}</span>, "</span>
                <span class="hljs-string">f"got <span class="hljs-subst">{<span class="hljs-built_in">type</span>(value).__name__}</span>"</span>
            )
        
        <span class="hljs-built_in">setattr</span>(obj, self.storage_name, value)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
    port = TypedAttribute(<span class="hljs-built_in">int</span>, converter=<span class="hljs-built_in">int</span>)
    timeout = TypedAttribute(<span class="hljs-built_in">float</span>, converter=<span class="hljs-built_in">float</span>)
    debug = TypedAttribute(<span class="hljs-built_in">bool</span>, converter=<span class="hljs-built_in">bool</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, **kwargs</span>):
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> kwargs.items():
            <span class="hljs-built_in">setattr</span>(self, key, value)

cfg = Config(port=<span class="hljs-string">"8080"</span>, timeout=<span class="hljs-string">"30.5"</span>, debug=<span class="hljs-string">"true"</span>)
<span class="hljs-built_in">print</span>(cfg.port)    <span class="hljs-comment"># 8080 (int)</span>
<span class="hljs-built_in">print</span>(cfg.timeout) <span class="hljs-comment"># 30.5 (float)</span>
<span class="hljs-built_in">print</span>(cfg.debug)   <span class="hljs-comment"># True (bool)</span>
</code></pre>
<h2 data-id="heading-11">五、描述符的查找顺序</h2>
<h3 data-id="heading-12">Python的属性查找链</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span>:
    <span class="hljs-string">"""演示属性查找顺序"""</span>
    class_descriptor = <span class="hljs-string">"类属性（描述符）"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.instance_attr = <span class="hljs-string">"实例属性"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-string">"""找不到属性时调用"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"__getattr__: <span class="hljs-subst">{name}</span>"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-string">"""总是首先调用"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"__getattribute__: <span class="hljs-subst">{name}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__getattribute__(name)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataDescriptor</span>:
    <span class="hljs-string">"""数据描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"数据描述符"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__set__</span>(<span class="hljs-params">self, obj, value</span>):
        <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NonDataDescriptor</span>:
    <span class="hljs-string">"""非数据描述符"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__get__</span>(<span class="hljs-params">self, obj, objtype</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"非数据描述符"</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>:
    data_desc = DataDescriptor()
    non_data_desc = NonDataDescriptor()

obj = Test()
obj.non_data_desc = <span class="hljs-string">"实例属性覆盖非数据描述符"</span>

<span class="hljs-built_in">print</span>(obj.data_desc)  <span class="hljs-comment"># "数据描述符"（优先于实例属性）</span>
<span class="hljs-built_in">print</span>(obj.non_data_desc)  <span class="hljs-comment"># "实例属性覆盖非数据描述符"</span>
</code></pre>
<h2 data-id="heading-13">总结</h2>
<p>描述符协议是Python最强大的特性之一，它实现了：</p>
<ol>
<li><strong>属性访问控制</strong>：验证、转换、记录属性访问</li>
<li><strong>方法绑定机制</strong>：将函数转换为绑定方法</li>
<li><strong>内置装饰器基础</strong>：<code>@property</code>、<code>@classmethod</code>、<code>@staticmethod</code></li>
<li><strong>框架和库的核心</strong>：Django的Model字段、SQLAlchemy的Column等</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 开发代码规范（优化完善版）]]></title>    <link>https://juejin.cn/post/7591687981687193646</link>    <guid>https://juejin.cn/post/7591687981687193646</guid>    <pubDate>2026-01-05T08:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591687981687193646" data-draft-id="7591544356001071114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 开发代码规范（优化完善版）"/> <meta itemprop="keywords" content="Flutter,代码规范"/> <meta itemprop="datePublished" content="2026-01-05T08:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卖火箭的小男孩"/> <meta itemprop="url" content="https://juejin.cn/user/4457847613830523"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 开发代码规范（优化完善版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4457847613830523/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卖火箭的小男孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T08:00:46.000Z" title="Mon Jan 05 2026 08:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter 开发代码规范（优化完善版）</h2>
<h3 data-id="heading-1">📋 目录</h3>
<ul>
<li><a href="#%E4%B8%80%E8%A7%84%E8%8C%83%E7%9B%AE%E6%A0%87" title="#%E4%B8%80%E8%A7%84%E8%8C%83%E7%9B%AE%E6%A0%87">一、规范目标</a></li>
<li><a href="#%E4%BA%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6" title="#%E4%BA%8C%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6">二、目录结构规范（强制）</a></li>
<li><a href="#%E4%B8%89%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6" title="#%E4%B8%89%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6">三、命名规范（强制）</a></li>
<li><a href="#%E5%9B%9B%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE" title="#%E5%9B%9B%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE">四、代码风格规范（强制+建议）</a></li>
<li><a href="#%E4%BA%94%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE" title="#%E4%BA%94%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE">五、状态管理规范（强制+建议）</a></li>
<li><a href="#%E5%85%ADgetx%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE" title="#%E5%85%ADgetx%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE">六、GetX使用规范（强制+建议）</a></li>
<li><a href="#%E4%B8%83%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6" title="#%E4%B8%83%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6">七、性能优化规范（强制）</a></li>
<li><a href="#%E5%85%AB%E8%B5%84%E6%BA%90%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6" title="#%E5%85%AB%E8%B5%84%E6%BA%90%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6">八、资源与配置规范（强制）</a></li>
<li><a href="#%E4%B9%9D%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%B4%A8%E9%87%8F%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE" title="#%E4%B9%9D%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%B4%A8%E9%87%8F%E8%A7%84%E8%8C%83%E5%BC%BA%E5%88%B6%E5%BB%BA%E8%AE%AE">九、测试与质量规范（强制+建议）</a></li>
<li><a href="#%E5%8D%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE" title="#%E5%8D%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE">十、最佳实践（建议）</a></li>
<li><a href="#%E5%8D%81%E4%B8%80%E8%A7%84%E8%8C%83%E8%90%BD%E5%9C%B0%E4%B8%8E%E7%BB%B4%E6%8A%A4" title="#%E5%8D%81%E4%B8%80%E8%A7%84%E8%8C%83%E8%90%BD%E5%9C%B0%E4%B8%8E%E7%BB%B4%E6%8A%A4">十一、规范落地与维护</a></li>
</ul>
<h3 data-id="heading-2">一、规范目标</h3>
<ol>
<li><strong>统一团队开发风格</strong>，降低协作成本，提升代码可读性、可维护性；</li>
<li><strong>规避常见性能问题</strong>，保障应用流畅性与稳定性；</li>
<li>符合 <strong>Dart/Flutter 官方最佳实践</strong>，兼容生态工具链（静态分析、测试、文档生成）；</li>
<li>明确<strong>边界规则</strong>（强制约束+建议规范），平衡规范严谨性与开发效率。</li>
</ol>
<h3 data-id="heading-3">二、目录结构规范（强制）</h3>
<p>基于 Flutter 工程特性，采用 <strong>功能+分层</strong> 混合结构，核心目录集中在 <code>lib/</code> 下。</p>
<h4 data-id="heading-4">项目结构示例</h4>
<pre><code class="hljs language-perl" lang="perl">lib/
├── app/                  <span class="hljs-comment"># 应用入口与全局配置</span>
│   ├── app.dart          <span class="hljs-comment"># 根组件（MyApp）</span>
│   ├── routes.dart       <span class="hljs-comment"># 路由配置（路由表+守卫）</span>
│   ├── theme.dart        <span class="hljs-comment"># 主题配置（亮色/暗色模式、全局样式）</span>
│   └── config.dart       <span class="hljs-comment"># 全局常量（环境变量、接口域名、第三方密钥）</span>
├── core/                 <span class="hljs-comment"># 核心能力层（通用业务+基础依赖）</span>
│   ├── network/          <span class="hljs-comment"># 网络请求（封装、拦截器、接口定义）</span>
│   │   ├── api.dart      <span class="hljs-comment"># 接口方法（按业务模块拆分，如 user_api.dart）</span>
│   │   ├── client.dart   <span class="hljs-comment"># dio 实例封装（拦截器、超时配置）</span>
│   │   └── model/        <span class="hljs-comment"># 接口模型（请求/响应实体，用 freezed/json_serializable）</span>
│   ├── storage/          <span class="hljs-comment"># 本地存储（统一封装）</span>
│   │   ├── sp_utils.dart <span class="hljs-comment"># SharedPreferences 封装</span>
│   │   └── hive_utils.dart <span class="hljs-comment"># Hive 数据库封装</span>
│   ├── <span class="hljs-keyword">state</span>/            <span class="hljs-comment"># 全局状态管理（如 AppBloc、UserProvider）</span>
│   └── utils/            <span class="hljs-comment"># 工具类（无业务依赖）</span>
│       ├── log_utils.dart <span class="hljs-comment"># 日志工具（替代 print）</span>
│       ├── toast_utils.dart <span class="hljs-comment"># 提示工具</span>
│       └── date_utils.dart <span class="hljs-comment"># 日期工具</span>
├── features/             <span class="hljs-comment"># 业务功能模块（按功能拆分，内部自治）</span>
│   ├── home/             <span class="hljs-comment"># 首页模块</span>
│   │   ├── presentation/ <span class="hljs-comment"># UI 层（页面+组件）</span>
│   │   │   ├── home_page.dart <span class="hljs-comment"># 页面组件</span>
│   │   │   └── widgets/  <span class="hljs-comment"># 模块内私有组件</span>
│   │   ├── <span class="hljs-keyword">state</span>/        <span class="hljs-comment"># 模块内状态（如 HomeBloc、HomeProvider）</span>
│   │   └── domain/       <span class="hljs-comment"># 业务逻辑（实体、仓库接口）</span>
│   └── user/             <span class="hljs-comment"># 用户模块（登录/注册/个人中心）</span>
│       ├── presentation/
│       ├── <span class="hljs-keyword">state</span>/
│       └── domain/
├── common/               <span class="hljs-comment"># 全局公共资源</span>
│   ├── widgets/          <span class="hljs-comment"># 全局复用组件（如 Button、Input、EmptyView）</span>
│   ├── res/              <span class="hljs-comment"># 静态资源（集中管理，避免硬编码）</span>
│   │   ├── images.dart   <span class="hljs-comment"># 图片路径常量（AssetImage 封装）</span>
│   │   ├── strings.dart  <span class="hljs-comment"># 字符串常量（支持国际化）</span>
│   │   ├── colors.dart   <span class="hljs-comment"># 颜色常量（主题色+功能色）</span>
│   │   └── dimens.dart   <span class="hljs-comment"># 尺寸常量（间距、字体大小）</span>
│   └── styles/           <span class="hljs-comment"># 全局样式（文本样式、圆角、阴影）</span>
└── main.dart             <span class="hljs-comment"># 程序入口（仅初始化 App 根组件）</span>
</code></pre>
<h4 data-id="heading-5">目录规范说明</h4>
<ol>
<li><strong>禁止</strong>在 <code>lib/</code> 根目录直接存放业务代码（仅保留 <code>main.dart</code>）；</li>
<li><code>features/</code> 按业务模块拆分，模块内遵循 <strong>UI-状态-业务</strong> 分层，确保高内聚低耦合；</li>
<li>公共组件/工具需区分 <strong>全局（common）</strong> 与 <strong>模块私有（features/xxx/widgets）</strong>，避免滥用全局；</li>
<li>静态资源（图片、字符串等）必须通过常量类引用，<strong>禁止硬编码</strong>（如 <code>Image.asset('images/icon.png')</code> → <code>Image.asset(Images.icon)</code>）。</li>
</ol>
<h3 data-id="heading-6">三、命名规范（强制）</h3>
<p>完全遵循 Dart 官方命名约定，补充 Flutter 特有场景规则：</p>



























































<table><thead><tr><th>类型</th><th>命名规则</th><th>示例</th><th>禁止示例</th></tr></thead><tbody><tr><td>类（Class/Widget）</td><td>大驼峰（PascalCase），名词/名词短语</td><td><code>HomePage</code>、<code>CustomButton</code>、<code>UserModel</code></td><td><code>home_page</code>、<code>custom_button</code></td></tr><tr><td>函数/方法</td><td>小驼峰（camelCase），动词/动词短语</td><td><code>getUserInfo()</code>、<code>showToast()</code></td><td><code>get_user_info()</code>、<code>ShowToast()</code></td></tr><tr><td>变量/参数</td><td>小驼峰（camelCase），名词/名词短语</td><td><code>userName</code>、<code>isLogin</code>、<code>itemCount</code></td><td><code>user_name</code>、<code>IsLogin</code></td></tr><tr><td>常量（const/final）</td><td>全大写+下划线（UPPER_SNAKE_CASE）</td><td><code>const MAX_COUNT = 10;</code>、<code>final API_BASE_URL = 'xxx'</code></td><td><code>maxCount</code>、<code>apiBaseUrl</code></td></tr><tr><td>枚举（enum）</td><td>枚举名：大驼峰；枚举值：小驼峰</td><td><code>enum LoginType { phone, wechat, qq }</code></td><td><code>enum login_type { Phone, Wechat }</code></td></tr><tr><td>路由名称</td><td>小写+下划线，格式：<code>/模块/页面</code></td><td><code>/user/login</code>、<code>/home/index</code></td><td><code>/User/Login</code>、<code>homeLogin</code></td></tr><tr><td>文件名</td><td>小写+下划线（snake_case），与类名对应</td><td><code>home_page.dart</code>（对应 <code>HomePage</code>）</td><td><code>HomePage.dart</code>、<code>homePage.dart</code></td></tr><tr><td>包名（package）</td><td>小写+下划线，全小写无大写</td><td><code>package:my_app/features/user</code></td><td><code>package:MyApp/Features/User</code></td></tr></tbody></table>
<h4 data-id="heading-7">特殊命名补充</h4>
<ol>
<li><strong>布尔变量</strong>建议前缀：<code>is</code>、<code>has</code>、<code>can</code>、<code>should</code>（如 <code>isVisible</code>、<code>hasPermission</code>）；</li>
<li><strong>回调函数</strong>命名：后缀 <code>Callback</code>，如 <code>OnLoginCallback</code>、<code>OnItemClickCallback</code>；</li>
<li><strong>状态管理</strong>相关：Bloc 类名后缀 <code>Bloc</code>（如 <code>CounterBloc</code>），状态类后缀 <code>State</code>（如 <code>CounterState</code>）；</li>
<li><strong>GetX控制器</strong>：类名后缀 <code>Controller</code>（如 <code>HomeController</code>、<code>UserController</code>）；</li>
<li>避免使用<strong>缩写</strong>（除非是通用缩写如 <code>API</code>、<code>UI</code>），<strong>禁止拼音</strong>命名（如 <code>shouyePage</code> → <code>homePage</code>）。</li>
</ol>
<h3 data-id="heading-8">四、代码风格规范（强制+建议）</h3>
<h4 data-id="heading-9">4.1 基础格式（强制）</h4>
<ol>
<li><strong>缩进</strong>：2 个空格（Dart 官方标准），禁止使用 Tab；</li>
<li><strong>行宽</strong>：单行长不超过 120 字符（超出需换行），IDE 开启自动换行；</li>
<li><strong>空行</strong>：
<ul>
<li>类/函数之间留 1 个空行；</li>
<li>函数内部逻辑块之间留 1 个空行；</li>
<li>避免连续空行（最多 1 个）；</li>
</ul>
</li>
<li><strong>括号</strong>：
<ul>
<li>类、函数、条件语句的左括号与声明在同一行，右括号单独成行；</li>
<li>单行条件语句可省略括号（但逻辑复杂时必须加）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">if</span> (isLogin) {
  navigateToHome();
}

<span class="hljs-comment">// 允许（单行简单逻辑）</span>
<span class="hljs-keyword">if</span> (isLogin) navigateToHome();

<span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">if</span> (isLogin)
{
  navigateToHome();
}
</code></pre>
</li>
<li><strong>分号</strong>：每条语句必须加分号（Dart 不是 JavaScript）；</li>
<li><strong>逗号</strong>：对象/数组最后一个元素后建议加逗号（IDE 自动格式化时更整洁）；
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> user = User(
  name: <span class="hljs-string">'张三'</span>,
  age: <span class="hljs-number">20</span>, <span class="hljs-comment">// 末尾逗号建议保留</span>
);
</code></pre>
</li>
</ol>
<h4 data-id="heading-10">4.2 Widget 开发规范（强制）</h4>
<ol>
<li><strong>优先使用 StatelessWidget</strong>：无状态组件性能更优，仅当需要维护状态时使用 StatefulWidget；</li>
<li><strong>Widget 拆分原则</strong>：
<ul>
<li>单个 Widget 代码不超过 100 行，超出则拆分为子 Widget（私有组件放 <code>widgets/</code> 目录）；</li>
<li>重复出现的 UI 片段（如列表项、按钮）必须提取为公共组件；</li>
<li>避免嵌套过深（建议不超过 4 层），使用 <code>Padding</code>/<code>SizedBox</code> 替代嵌套 <code>Container</code>，用 <code>Wrap</code> 替代多层 <code>Row/Column</code>；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 错误（嵌套过深）</span>
Container(
  child: Padding(
    padding: EdgeInsets.all(<span class="hljs-number">16</span>),
    child: Row(
      children: [
        Container(
          child: Text(<span class="hljs-string">'标题'</span>),
        ),
      ],
    ),
  ),
);

<span class="hljs-comment">// 正确（拆分+简化嵌套）</span>
Padding(
  padding: EdgeInsets.all(Dimens.p16),
  child: Row(
    children: [
      _buildTitleText(),
    ],
  ),
);

Widget _buildTitleText() =&gt; Text(Strings.title);
</code></pre>
</li>
<li><strong>build 方法规范</strong>：
<ul>
<li>禁止在 <code>build</code> 中执行耗时操作（如网络请求、数据库查询、复杂计算）；</li>
<li>禁止在 <code>build</code> 中创建临时对象（如 <code>List</code>、<code>Map</code>、<code>Style</code>），需缓存为 <code>final</code> 变量或提取为常量；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 错误（build 中创建 List）</span>
<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> ListView(
    children: [Text(<span class="hljs-string">'1'</span>), Text(<span class="hljs-string">'2'</span>)], <span class="hljs-comment">// 每次 build 重建 List</span>
  );
}

<span class="hljs-comment">// 正确（缓存为 final）</span>
<span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; _listItems = [Text(<span class="hljs-string">'1'</span>), Text(<span class="hljs-string">'2'</span>)];

<span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> ListView(children: _listItems);
}
</code></pre>
</li>
<li><strong>const 构造函数</strong>：
<ul>
<li>无状态 Widget 且构造参数均为常量时，必须使用 <code>const</code> 构造函数（减少重建开销）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">const</span> CustomButton({<span class="hljs-keyword">super</span>.key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onTap});

<span class="hljs-comment">// 调用时也需加 const（除非父组件非 const）</span>
<span class="hljs-keyword">const</span> CustomButton(onTap: _handleTap);
</code></pre>
</li>
<li><strong>命名参数</strong>：
<ul>
<li>Widget 构造函数仅使用命名参数（<code>{}</code> 包裹），必填参数加 <code>required</code> 关键字；</li>
<li>参数顺序：核心功能参数（如 <code>onTap</code>、<code>data</code>）在前，样式参数（如 <code>color</code>、<code>size</code>）在后；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">const</span> CustomButton({
  <span class="hljs-keyword">super</span>.key,
  <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onTap, <span class="hljs-comment">// 必填参数在前</span>
  <span class="hljs-keyword">this</span>.text = <span class="hljs-string">''</span>,
  <span class="hljs-keyword">this</span>.color = Colors.blue, <span class="hljs-comment">// 样式参数在后</span>
  <span class="hljs-keyword">this</span>.radius = <span class="hljs-number">8.0</span>,
});
</code></pre>
</li>
</ol>
<h4 data-id="heading-11">4.3 语法规范（强制）</h4>
<ol>
<li><strong>Null Safety 强制启用</strong>：
<ul>
<li>禁止使用 <code>dynamic</code> 类型（除非与第三方库兼容必须使用）；</li>
<li>可空类型必须显式声明（<code>String?</code>），非空类型必须初始化（或用 <code>late</code> 延迟初始化）；</li>
<li>避免滥用 <code>!</code> 空断言（优先用 <code>??</code>、<code>?.</code>、<code>if (xxx != null)</code> 安全访问）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 错误</span>
<span class="hljs-built_in">String</span> name; <span class="hljs-comment">// 非空类型未初始化</span>
<span class="hljs-built_in">print</span>(user!.name); <span class="hljs-comment">// 滥用 ! 断言</span>

<span class="hljs-comment">// 正确</span>
<span class="hljs-built_in">String?</span> name;
<span class="hljs-built_in">print</span>(user?.name ?? <span class="hljs-string">'默认名称'</span>); <span class="hljs-comment">// 安全访问+默认值</span>
</code></pre>
</li>
<li><strong>集合使用</strong>：
<ul>
<li>优先使用不可变集合（<code>const List</code>、<code>const Map</code>），可变集合需显式声明 <code>var</code> 或 <code>List&lt;T&gt;</code>；</li>
<li>禁止使用 <code>List()</code> 无参构造，用 <code>[]</code> 替代（更简洁）；</li>
</ul>
</li>
<li><strong>循环与条件</strong>：
<ul>
<li>简单条件用 <code>??</code>、<code>?.</code>、<code>if-else</code>，复杂条件提取为布尔变量（提升可读性）；</li>
<li>列表遍历优先用 <code>forEach</code>（简单逻辑）或 <code>map</code>（转换场景），避免嵌套循环；</li>
</ul>
</li>
<li><strong>扩展方法</strong>：
<ul>
<li>复用逻辑优先用 <code>extension</code> 扩展（如 <code>StringExtension</code>、<code>DateTimeExtension</code>），替代工具类静态方法；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确（扩展方法）</span>
<span class="hljs-keyword">extension</span> StringExtension <span class="hljs-keyword">on</span> <span class="hljs-built_in">String</span> {
  <span class="hljs-built_in">String</span> capitalize() =&gt; isEmpty ? <span class="hljs-keyword">this</span> : <span class="hljs-string">'<span class="hljs-subst">${<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].toUpperCase()}</span><span class="hljs-subst">${substring(<span class="hljs-number">1</span>)}</span>'</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-string">'hello'</span>.capitalize(); <span class="hljs-comment">// 比 StringUtils.capitalize('hello') 更简洁</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-12">4.4 注释规范（强制+建议）</h4>
<ol>
<li><strong>文档注释（强制）</strong>：
<ul>
<li>公开类、函数、常量必须加文档注释（<code>///</code> 开头，支持 DartDoc 生成文档）；</li>
<li>注释需说明 <strong>功能用途</strong> + <strong>参数含义</strong> + <strong>返回值</strong> + <strong>异常场景</strong>（必要时）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">自定义按钮组件</span></span>
<span class="hljs-comment">/// </span>
<span class="hljs-comment">/// <span class="markdown">[onTap]：点击回调（必填）</span></span>
<span class="hljs-comment">/// <span class="markdown">[text]：按钮文本（默认空字符串）</span></span>
<span class="hljs-comment">/// <span class="markdown">[color]：按钮背景色（默认蓝色）</span></span>
<span class="hljs-comment">/// <span class="markdown">返回：无</span></span>
<span class="hljs-keyword">const</span> CustomButton({
  <span class="hljs-keyword">super</span>.key,
  <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onTap,
  <span class="hljs-keyword">this</span>.text = <span class="hljs-string">''</span>,
  <span class="hljs-keyword">this</span>.color = Colors.blue,
});
</code></pre>
</li>
<li><strong>单行注释（建议）</strong>：
<ul>
<li>复杂逻辑、特殊处理（如兼容适配、临时方案）需加单行注释（<code>//</code> 开头）；</li>
<li>注释说明 <strong>为什么这么做</strong>，而非 <strong>做了什么</strong>（代码本身应体现做了什么）；</li>
</ul>
</li>
<li><strong>注释禁忌</strong>：
<ul>
<li>禁止注释无用代码（直接删除，版本控制可回溯）；</li>
<li>禁止冗余注释（如 <code>// 定义名称变量</code> → <code>String name;</code>）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">五、状态管理规范（强制+建议）</h3>
<h4 data-id="heading-14">5.1 方案选择（建议）</h4>
<p>根据项目复杂度选择合适的状态管理方案，团队统一使用一种核心方案：</p>






























<table><thead><tr><th>项目规模</th><th>推荐方案</th><th>适用场景</th></tr></thead><tbody><tr><td>小型项目</td><td>StatefulWidget + setState</td><td>仅需局部状态（如单个页面开关、计数器）</td></tr><tr><td>中型项目</td><td>Provider/Riverpod</td><td>跨组件状态共享（如用户信息、主题）</td></tr><tr><td>大型项目</td><td>Bloc/Cubit</td><td>复杂业务逻辑（如表单提交、流程控制）</td></tr><tr><td>快速迭代</td><td><strong>GetX（推荐使用）</strong></td><td>个人项目或小团队，需简化模板代码</td></tr></tbody></table>
<h4 data-id="heading-15">5.2 分层原则（强制）</h4>
<p>无论使用哪种方案，必须遵循 <strong>UI 层-状态层-数据层</strong> 分离：</p>
<ol>
<li><strong>UI 层（Widget）</strong>：仅负责渲染，不包含业务逻辑，通过状态层获取数据；</li>
<li><strong>状态层（Bloc/Provider/Controller）</strong>：管理状态，处理业务逻辑，不直接操作数据源；</li>
<li><strong>数据层（Repository/API）</strong>：负责数据获取（网络、本地存储），提供统一接口给状态层；</li>
</ol>
<h4 data-id="heading-16">5.3 状态管理禁忌（强制）</h4>
<ol>
<li>禁止在 Widget 中直接调用网络/存储接口（必须通过数据层）；</li>
<li>禁止全局状态滥用（优先使用局部状态，跨组件共享才用全局状态）；</li>
<li>禁止状态层持有 Widget 引用（如 <code>BuildContext</code>），通过回调/事件通信；</li>
<li><strong>Bloc 规范</strong>：
<ul>
<li>事件（Event）命名后缀 <code>Event</code>（如 <code>LoginEvent</code>），状态（State）命名后缀 <code>State</code>；</li>
<li>一个 Bloc 对应一个业务场景，避免超大 Bloc（拆分多个子 Bloc）；</li>
<li>状态必须是不可变的（使用 <code>freezed</code> 生成不可变类）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-17">六、GetX使用规范（强制+建议）</h3>
<h4 data-id="heading-18">6.1 项目结构适配</h4>
<p>当使用GetX时，建议在<code>features/</code>模块内调整目录结构，遵循GetX推荐的三层架构：</p>
<pre><code class="hljs language-bash" lang="bash">features/user/
├── data/                  <span class="hljs-comment"># 数据层</span>
│   ├── models/           <span class="hljs-comment"># 数据模型</span>
│   ├── repositories/     <span class="hljs-comment"># 数据仓库</span>
│   └── datasources/      <span class="hljs-comment"># 数据源（本地/远程）</span>
├── domain/               <span class="hljs-comment"># 业务逻辑层</span>
│   ├── usecases/        <span class="hljs-comment"># 用例</span>
│   └── repositories/    <span class="hljs-comment"># 仓库接口</span>
└── presentation/         <span class="hljs-comment"># 表现层</span>
    ├── controllers/     <span class="hljs-comment"># 控制器</span>
    ├── views/          <span class="hljs-comment"># 页面视图</span>
    ├── widgets/        <span class="hljs-comment"># 私有组件</span>
    └── bindings/       <span class="hljs-comment"># 绑定类</span>
</code></pre>
<h4 data-id="heading-19">6.2 Controller规范</h4>
<ol>
<li>
<p><strong>控制器命名与位置</strong>：</p>
<ul>
<li>控制器类名后缀必须为<code>Controller</code>（如<code>UserController</code>）；</li>
<li>控制器文件存放在对应模块的<code>presentation/controllers/</code>目录；</li>
<li>每个页面/功能对应一个控制器，避免超大控制器；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// features/user/presentation/controllers/user_controller.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-comment">// 状态变量</span>
  <span class="hljs-keyword">final</span> RxString userName = <span class="hljs-string">''</span>.obs;
  <span class="hljs-keyword">final</span> RxBool isLoading = <span class="hljs-keyword">false</span>.obs;
  <span class="hljs-keyword">final</span> RxList&lt;User&gt; userList = &lt;User&gt;[].obs;
  
  <span class="hljs-comment">// 计算属性</span>
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> formattedName =&gt; userName.value.toUpperCase();
  
  <span class="hljs-comment">// 生命周期</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onInit() {
    <span class="hljs-keyword">super</span>.onInit();
    loadUserData();
  }
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onClose() {
    <span class="hljs-comment">// 清理资源</span>
    <span class="hljs-keyword">super</span>.onClose();
  }
  
  <span class="hljs-comment">// 方法</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; loadUserData() <span class="hljs-keyword">async</span> {
    isLoading.value = <span class="hljs-keyword">true</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> users = <span class="hljs-keyword">await</span> userRepository.getUsers();
      userList.assignAll(users);
    } <span class="hljs-keyword">catch</span> (e) {
      Get.snackbar(<span class="hljs-string">'错误'</span>, <span class="hljs-string">'加载用户数据失败'</span>);
    } <span class="hljs-keyword">finally</span> {
      isLoading.value = <span class="hljs-keyword">false</span>;
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>状态管理</strong>：</p>
<ul>
<li>使用<code>.obs</code>创建响应式变量，变量名使用<code>Rx</code>前缀约定；</li>
<li>私有状态使用<code>_</code>前缀，公开状态提供getter方法；</li>
<li>使用<code>update()</code>方法触发UI更新（非响应式变量变更时）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-comment">// 响应式变量</span>
  <span class="hljs-keyword">final</span> RxInt _counter = <span class="hljs-number">0.</span>obs;
  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> counter =&gt; _counter.value;
  
  <span class="hljs-comment">// 非响应式变量</span>
  <span class="hljs-built_in">String</span> _searchKeyword = <span class="hljs-string">''</span>;
  
  <span class="hljs-keyword">void</span> increment() {
    _counter.value++;
  }
  
  <span class="hljs-keyword">void</span> updateKeyword(<span class="hljs-built_in">String</span> keyword) {
    _searchKeyword = keyword;
    update(); <span class="hljs-comment">// 手动触发更新</span>
  }
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-20">6.3 路由管理规范</h4>
<ol>
<li>
<p><strong>路由定义</strong>：</p>
<ul>
<li>使用GetX的路由管理系统，集中管理路由；</li>
<li>路由名称使用小写+下划线格式，与页面路径对应；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// app/routes.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppRoutes</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> splash = <span class="hljs-string">'/'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> home = <span class="hljs-string">'/home'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> login = <span class="hljs-string">'/login'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> userDetail = <span class="hljs-string">'/user/detail'</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;GetPage&gt; pages = [
    GetPage(
      name: splash,
      page: () =&gt; SplashScreen(),
      binding: SplashBinding(),
    ),
    GetPage(
      name: home,
      page: () =&gt; HomeScreen(),
      bindings: [HomeBinding(), UserBinding()],
      transition: Transition.fadeIn,
    ),
    GetPage(
      name: userDetail,
      page: () =&gt; UserDetailScreen(),
      binding: UserDetailBinding(),
      transition: Transition.rightToLeft,
    ),
  ];
}
</code></pre>
</li>
<li>
<p><strong>路由跳转</strong>：</p>
<ul>
<li>使用GetX提供的路由方法，保持统一；</li>
<li>带参数跳转时使用<code>arguments</code>传递对象；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 页面跳转</span>
Get.toNamed(AppRoutes.home);
Get.offNamed(AppRoutes.login); <span class="hljs-comment">// 关闭当前页面</span>
Get.offAllNamed(AppRoutes.home); <span class="hljs-comment">// 关闭所有页面</span>

<span class="hljs-comment">// 带参数跳转</span>
Get.toNamed(
  AppRoutes.userDetail,
  arguments: User(id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'张三'</span>),
  parameters: {<span class="hljs-string">'from'</span>: <span class="hljs-string">'home'</span>}, <span class="hljs-comment">// URL参数</span>
);

<span class="hljs-comment">// 获取参数</span>
<span class="hljs-keyword">final</span> user = Get.arguments <span class="hljs-keyword">as</span> User;
<span class="hljs-keyword">final</span> from = Get.parameters[<span class="hljs-string">'from'</span>];
</code></pre>
</li>
</ol>
<h4 data-id="heading-21">6.4 依赖管理规范</h4>
<ol>
<li>
<p><strong>Binding类使用</strong>：</p>
<ul>
<li>每个控制器对应一个Binding类，处理依赖注入；</li>
<li>Binding类名后缀为<code>Binding</code>，与控制器对应；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// features/user/presentation/bindings/user_binding.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserBinding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bindings</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dependencies() {
    <span class="hljs-comment">// 懒加载注入</span>
    Get.lazyPut&lt;UserRepository&gt;(
      () =&gt; UserRepositoryImpl(Get.find&lt;ApiClient&gt;()),
      fenix: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 页面关闭后不会被销毁，下次进入时重用</span>
    );
    
    <span class="hljs-comment">// 立即注入</span>
    Get.put&lt;UserController&gt;(
      UserController(Get.find&lt;UserRepository&gt;()),
      permanent: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 全局单例</span>
    );
  }
}
</code></pre>
</li>
<li>
<p><strong>依赖获取</strong>：</p>
<ul>
<li>使用<code>Get.find&lt;T&gt;()</code>获取依赖，避免直接new对象；</li>
<li>在控制器构造函数中注入依赖；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-keyword">final</span> UserRepository userRepository;
  
  UserController(<span class="hljs-keyword">this</span>.userRepository);
  
  <span class="hljs-comment">// 或者使用Get.find()延迟获取</span>
  UserRepository <span class="hljs-keyword">get</span> repo =&gt; Get.find&lt;UserRepository&gt;();
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-22">6.5 Widget使用规范</h4>
<ol>
<li>
<p><strong>响应式Widget</strong>：</p>
<ul>
<li>使用<code>Obx()</code>、<code>GetX()</code>或<code>GetBuilder</code>包裹响应式部分；</li>
<li>最小化响应范围，避免整个页面重建；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfile</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> UserController controller = Get.find&lt;UserController&gt;();
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      children: [
        <span class="hljs-comment">// 使用Obx响应式更新</span>
        Obx(() =&gt; Text(
          <span class="hljs-string">'用户数: <span class="hljs-subst">${controller.userCount.value}</span>'</span>,
          style: TextStyle(
            color: controller.isLoading.value 
              ? Colors.grey 
              : Colors.black,
          ),
        )),
        
        <span class="hljs-comment">// 使用GetBuilder手动更新</span>
        GetBuilder&lt;UserController&gt;(
          builder: (controller) {
            <span class="hljs-keyword">return</span> Text(<span class="hljs-string">'用户名: <span class="hljs-subst">${controller.userName}</span>'</span>);
          },
        ),
        
        <span class="hljs-comment">// 列表使用Obx</span>
        Obx(() =&gt; ListView.builder(
          shrinkWrap: <span class="hljs-keyword">true</span>,
          itemCount: controller.userList.length,
          itemBuilder: (context, index) {
            <span class="hljs-keyword">final</span> user = controller.userList[index];
            <span class="hljs-keyword">return</span> UserItem(user: user);
          },
        )),
      ],
    );
  }
}
</code></pre>
</li>
<li>
<p><strong>页面Widget规范</strong>：</p>
<ul>
<li>页面继承<code>GetView&lt;T&gt;</code>获取控制器；</li>
<li>使用<code>Get.put()</code>初始化控制器；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// features/user/presentation/views/user_screen.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetView</span>&lt;<span class="hljs-title">UserController</span>&gt; </span>{
  <span class="hljs-keyword">const</span> UserScreen({<span class="hljs-keyword">super</span>.key});
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// 自动获取控制器</span>
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Obx(() =&gt; Text(<span class="hljs-string">'用户(<span class="hljs-subst">${controller.userCount}</span>)'</span>)),
      ),
      body: controller.obx(
        (state) =&gt; _buildUserList(),
        onLoading: <span class="hljs-keyword">const</span> CircularProgressIndicator(),
        onError: (error) =&gt; ErrorView(error: error),
        onEmpty: <span class="hljs-keyword">const</span> EmptyView(),
      ),
    );
  }
  
  Widget _buildUserList() {
    <span class="hljs-keyword">return</span> RefreshIndicator(
      onRefresh: controller.loadUsers,
      child: ListView.builder(
        itemCount: controller.userList.length,
        itemBuilder: (context, index) {
          <span class="hljs-keyword">return</span> UserItem(user: controller.userList[index]);
        },
      ),
    );
  }
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-23">6.6 工具类使用规范</h4>
<ol>
<li>
<p><strong>GetX工具类</strong>：</p>
<ul>
<li>统一使用GetX提供的工具方法；</li>
<li>禁止混用原生方法与GetX方法；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 正确</span>
Get.snackbar(<span class="hljs-string">'标题'</span>, <span class="hljs-string">'消息内容'</span>);
Get.dialog(ConfirmDialog());
Get.bottomSheet(OptionsSheet());
Get.toNamed(<span class="hljs-string">'/detail'</span>);

<span class="hljs-comment">// 避免混用</span>
<span class="hljs-comment">// 错误：混用GetX和原生方法</span>
showDialog(context: context, builder: ...); <span class="hljs-comment">// 避免使用</span>
Navigator.push(context, ...); <span class="hljs-comment">// 避免使用</span>
</code></pre>
</li>
<li>
<p><strong>国际化</strong>：</p>
<ul>
<li>使用GetX的国际化方案；</li>
<li>统一管理翻译文件；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 使用</span>
Text(<span class="hljs-string">'title'</span>.tr);
Text(<span class="hljs-string">'greeting'</span>.trParams({<span class="hljs-string">'name'</span>: <span class="hljs-string">'张三'</span>}));

<span class="hljs-comment">// 切换语言</span>
Get.updateLocale(Locale(<span class="hljs-string">'zh'</span>, <span class="hljs-string">'CN'</span>));
</code></pre>
</li>
</ol>
<h4 data-id="heading-24">6.7 GetX最佳实践</h4>
<ol>
<li>
<p><strong>性能优化</strong>：</p>
<ul>
<li>使用<code>worker</code>监听状态变化，执行副作用；</li>
<li>使用<code>debounce</code>、<code>interval</code>避免频繁更新；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxController</span> </span>{
  <span class="hljs-keyword">final</span> RxString searchKeyword = <span class="hljs-string">''</span>.obs;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onInit() {
    <span class="hljs-keyword">super</span>.onInit();
    
    <span class="hljs-comment">// 监听搜索关键词变化，延迟500ms执行搜索</span>
    debounce(
      searchKeyword,
      (_) =&gt; performSearch(),
      time: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">500</span>),
    );
    
    <span class="hljs-comment">// 每隔1秒执行一次</span>
    interval(
      searchKeyword,
      (_) =&gt; logSearch(),
      time: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),
    );
  }
  
  <span class="hljs-keyword">void</span> performSearch() {
    <span class="hljs-comment">// 执行搜索逻辑</span>
  }
}
</code></pre>
</li>
<li>
<p><strong>状态持久化</strong>：</p>
<ul>
<li>使用<code>GetStorage</code>进行轻量级数据持久化；</li>
<li>重要数据使用<code>shared_preferences</code>或<code>hive</code>；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> box = GetStorage();

<span class="hljs-comment">// 保存数据</span>
box.write(<span class="hljs-string">'user_token'</span>, <span class="hljs-string">'abc123'</span>);

<span class="hljs-comment">// 读取数据</span>
<span class="hljs-built_in">String</span> token = box.read(<span class="hljs-string">'user_token'</span>);

<span class="hljs-comment">// 监听数据变化</span>
box.listen(() {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'数据发生变化'</span>);
});
</code></pre>
</li>
<li>
<p><strong>错误处理</strong>：</p>
<ul>
<li>统一使用GetX的错误处理机制；</li>
<li>全局异常捕获；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 全局配置</span>
<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 全局错误处理</span>
  Get.config(
    enableLog: <span class="hljs-keyword">true</span>,
    defaultPopGesture: <span class="hljs-keyword">true</span>,
    defaultTransition: Transition.cupertino,
  );
  
  <span class="hljs-comment">// 异常处理</span>
  FlutterError.onError = (details) {
    Get.snackbar(<span class="hljs-string">'错误'</span>, details.exception.toString());
  };
  
  runApp(MyApp());
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-25">七、性能优化规范（强制）</h3>
<h4 data-id="heading-26">7.1 渲染优化</h4>
<ol>
<li><strong>列表优化</strong>：
<ul>
<li>长列表必须使用 <code>ListView.builder</code>/<code>GridView.builder</code>（懒加载），禁止使用 <code>ListView(children: [...])</code>（一次性加载所有子项）；</li>
<li>列表项高度固定时，设置 <code>itemExtent</code> 提升性能；</li>
</ul>
</li>
<li><strong>图片优化</strong>：
<ul>
<li>图片资源按分辨率适配（<code>mipmap-mdpi</code>/<code>mipmap-hdpi</code> 等），避免使用超大图；</li>
<li>网络图片使用缓存（如 <code>cached_network_image</code>），设置占位图/错误图；</li>
<li>本地图片使用 <code>AssetImage</code> 而非 <code>FileImage</code>，并通过 <code>images.dart</code> 常量引用；</li>
</ul>
</li>
<li><strong>减少重绘</strong>：
<ul>
<li>频繁变化的 Widget 用 <code>RepaintBoundary</code> 包裹（隔离重绘区域）；</li>
<li>避免在 <code>AnimatedBuilder</code> 外部构建无关 Widget；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-27">7.2 内存优化</h4>
<ol>
<li><strong>资源释放</strong>：
<ul>
<li>订阅流（Stream）、Bloc 必须在 <code>dispose</code> 中取消订阅（使用 <code>cancel()</code> 或 <code>BlocListener</code> 自动管理）；</li>
<li>大文件（如视频、音频）使用后及时释放，避免内存泄漏；</li>
</ul>
</li>
<li><strong>避免内存泄漏场景</strong>：
<ul>
<li>禁止匿名函数/闭包持有 <code>BuildContext</code> 长期引用（如异步回调中）；</li>
<li>禁止静态变量持有 Widget/State 实例；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-28">7.3 代码执行优化</h4>
<ol>
<li><strong>异步操作</strong>：
<ul>
<li>网络请求、文件读写必须用异步（<code>async/await</code>），禁止同步阻塞；</li>
<li>多个独立异步任务用 <code>Future.wait</code> 并行执行（而非串行 <code>await</code>）；</li>
</ul>
</li>
<li><strong>计算优化</strong>：
<ul>
<li>复杂计算（如数据解析、加密）放在 <code>isolate</code> 中执行（避免阻塞 UI 线程）；</li>
<li>重复计算结果缓存（如 <code>final</code> 变量、<code>memoizer</code> 工具）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-29">八、资源与配置规范（强制）</h3>
<h4 data-id="heading-30">8.1 静态资源管理</h4>
<ol>
<li><strong>图片</strong>：
<ul>
<li>存放路径：<code>assets/images/</code>（按模块拆分，如 <code>assets/images/user/</code>）；</li>
<li>引用方式：通过 <code>common/res/images.dart</code> 常量封装，禁止硬编码路径；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// common/res/images.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Images</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> userAvatar = <span class="hljs-string">'assets/images/user/avatar.png'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> iconHome = <span class="hljs-string">'assets/images/home/icon_home.png'</span>;
}

<span class="hljs-comment">// 使用</span>
Image.asset(Images.userAvatar);
</code></pre>
</li>
<li><strong>字符串</strong>：
<ul>
<li>存放路径：<code>common/res/strings.dart</code>（支持国际化时用 <code>flutter_localizations</code>）；</li>
<li>禁止硬编码字符串（便于统一修改和国际化）；</li>
</ul>
</li>
<li><strong>颜色/尺寸</strong>：
<ul>
<li>颜色：区分主题色（<code>primaryColor</code>）、功能色（<code>successColor</code>/<code>errorColor</code>），禁止直接使用 <code>Colors.blue</code>（统一维护）；</li>
<li>尺寸：统一间距（<code>p8</code>/<code>p16</code>）、字体大小（<code>font14</code>/<code>font18</code>），避免魔法数字；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-31">8.2 路由管理</h4>
<ol>
<li><strong>路由配置</strong>：
<ul>
<li>集中管理路由表（<code>app/routes.dart</code>），使用命名路由（禁止直接 <code>Navigator.push(Builder...)</code>）；</li>
<li>路由名称格式：<code>/模块/页面</code>（如 <code>/user/login</code>、<code>/order/detail</code>）；</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// app/routes.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Routes</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> home = <span class="hljs-string">'/home/index'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> login = <span class="hljs-string">'/user/login'</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, WidgetBuilder&gt; routes = {
    home: (context) =&gt; <span class="hljs-keyword">const</span> HomePage(),
    login: (context) =&gt; <span class="hljs-keyword">const</span> LoginPage(),
  };
}
</code></pre>
</li>
<li><strong>路由跳转</strong>：
<ul>
<li>使用封装后的路由工具（如 <code>RouterUtils.push(context, Routes.login)</code>），统一处理动画、参数传递；</li>
<li>路由参数传递：优先使用强类型（如通过 <code>ModalRoute.of(context)?.settings.arguments</code> 封装模型），避免 <code>Map</code> 动态类型；</li>
</ul>
</li>
<li><strong>路由守卫</strong>：
<ul>
<li>全局路由守卫（如未登录拦截跳登录页）统一在 <code>MaterialApp.onGenerateRoute</code> 中处理；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-32">8.3 依赖管理</h4>
<ol>
<li><strong><code>pubspec.yaml</code> 规范</strong>：
<ul>
<li>依赖分组（<code>dependencies</code>/<code>dev_dependencies</code>），并按功能排序（如网络、状态管理、工具类）；</li>
<li>版本约束：核心依赖（如 <code>flutter_bloc</code>、<code>dio</code>）指定稳定版本（如 <code>^8.1.0</code>），避免使用 <code>any</code>；</li>
<li>定期更新依赖（<code>flutter pub upgrade</code>），并移除未使用的依赖（<code>flutter pub clean</code> + <code>dart pub deps</code> 检查）；</li>
</ul>
</li>
<li>禁止重复依赖：如已使用 <code>dio</code>，禁止再引入 <code>http</code> 库（统一网络请求工具）。</li>
</ol>
<h3 data-id="heading-33">九、测试与质量规范（强制+建议）</h3>
<h4 data-id="heading-34">9.1 测试规范（建议）</h4>
<ol>
<li><strong>测试分层</strong>：
<ul>
<li><strong>单元测试</strong>：测试工具类、业务逻辑（如 <code>utils/</code>、<code>domain/</code> 层），覆盖率≥80%；</li>
<li><strong>Widget 测试</strong>：测试核心 UI 组件（如 <code>common/widgets/</code>），验证渲染正确性；</li>
<li><strong>集成测试</strong>：测试关键业务流程（如登录→首页→下单）；</li>
</ul>
</li>
<li><strong>测试文件存放</strong>：
<ul>
<li>单元测试/Widget 测试：与被测试文件同目录，命名为 <code>xxx_test.dart</code>；</li>
<li>集成测试：放在 <code>integration_test/</code> 目录下；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-35">9.2 静态代码检查（强制）</h4>
<ol>
<li><strong>启用 lint 规则</strong>：
<ul>
<li>基础规则：使用 <code>flutter_lints</code>（官方推荐）；</li>
<li>增强规则：集成 <code>dart_code_metrics</code>，自定义强制规则（如禁止 <code>print</code>、禁止 <code>build</code> 中创建对象）；</li>
</ul>
</li>
<li><strong>配置文件</strong>：在 <code>analysis_options.yaml</code> 中配置规则，示例：
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">include:</span> <span class="hljs-string">package:flutter_lints/flutter.yaml</span>

<span class="hljs-attr">linter:</span>
  <span class="hljs-attr">rules:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">avoid_print</span> <span class="hljs-comment"># 禁止使用 print（用 log_utils 替代）</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">prefer_const_constructors</span> <span class="hljs-comment"># 强制使用 const 构造函数</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">no_logic_in_create_state</span> <span class="hljs-comment"># 禁止在 createState 中写逻辑</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">unused_import</span> <span class="hljs-comment"># 禁止未使用的导入</span>

<span class="hljs-attr">analyzer:</span>
  <span class="hljs-attr">exclude:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">build/</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">.dart_tool/</span>
</code></pre>
</li>
<li><strong>提交前检查</strong>：
<ul>
<li>必须执行 <code>flutter analyze</code>（静态分析无错误）；</li>
<li>必须执行 <code>flutter format .</code>（自动格式化代码）；</li>
</ul>
</li>
</ol>
<h4 data-id="heading-36">9.3 版本控制规范（强制）</h4>
<ol>
<li><strong>分支管理</strong>：
<ul>
<li><code>master</code>：生产环境分支（仅合并 <code>release</code>/<code>hotfix</code> 分支）；</li>
<li><code>feature</code>：开发分支（日常开发、合并 <code>feature</code> 分支）；</li>
<li><code>release/xxx</code>：上线分支（从 <code>master</code> 拉出，完成后合并回 <code>feature</code>）；</li>
<li><code>hotfix/xxx</code>：紧急修复分支（从 <code>master</code> 拉出，修复后合并 <code>master</code>）；</li>
<li><code>release</code>/<code>hotfix</code>：分支发布成功后合并到 <code>master</code>；</li>
</ul>
</li>
<li><strong>提交信息规范</strong>：
<ul>
<li>格式：<code>类型: 描述（英文，首字母小写）</code>；</li>
<li>类型：<code>feat</code>（新增功能）、<code>fix</code>（修复 bug）、<code>docs</code>（文档）、<code>style</code>（格式调整）、<code>refactor</code>（重构）、<code>test</code>（测试）、<code>chore</code>（依赖/构建调整）；</li>
<li>示例：<code>feat: add login page</code>、<code>fix: resolve login button unclickable issue</code>；</li>
</ul>
</li>
<li><strong>提交粒度</strong>：单次提交仅包含一个功能/修复，代码量不超过 300 行（便于 Code Review）。</li>
</ol>
<h3 data-id="heading-37">十、最佳实践（建议）</h3>
<ol>
<li><strong>国际化</strong>：使用 <code>flutter_localizations</code> + <code>intl</code> 库，字符串按语言拆分（<code>strings_en.dart</code>/<code>strings_zh.dart</code>）；</li>
<li><strong>主题适配</strong>：支持深色模式，全局样式通过 <code>Theme.of(context)</code> 获取（如 <code>Theme.of(context).primaryColor</code>）；</li>
<li><strong>错误处理</strong>：
<ul>
<li>统一网络错误（如 401 未授权、500 服务器错误）拦截处理；</li>
<li>全局异常捕获（<code>FlutterError.onError</code> + <code>runZonedGuarded</code>），收集崩溃日志；</li>
</ul>
</li>
<li><strong>代码复用</strong>：
<ul>
<li>公共逻辑提取为 <code>mixin</code>（如 <code>ToastMixin</code>、<code>LoadingMixin</code>），避免继承冗余；</li>
<li>表单验证逻辑封装为工具类（如 <code>FormValidator.validatePhone()</code>）；</li>
</ul>
</li>
<li><strong>工具推荐</strong>：
<ul>
<li>序列化：<code>freezed</code> + <code>json_serializable</code>（自动生成模型代码）；</li>
<li>路由：<code>auto_route</code>（类型安全路由，避免手动配置）；</li>
<li>日志：<code>logger</code>（替代 <code>print</code>，支持分级日志、格式化输出）；</li>
<li>代码生成：<code>build_runner</code>（自动化生成模板代码）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-38">十一、规范落地与维护</h3>
<ol>
<li><strong>工具保障</strong>：IDE 安装 <code>Flutter</code>/<code>Dart</code> 插件，开启自动格式化、lint 实时检查；</li>
<li><strong>CI/CD 集成</strong>：提交代码时触发 CI 流程（执行 <code>flutter analyze</code>、<code>flutter test</code>），不通过则禁止合并；</li>
<li><strong>定期复盘</strong>：每季度更新规范（适配 Flutter 新版本特性），团队内部分享违规案例与优化方案；</li>
<li><strong>新人培训</strong>：将规范纳入新人入职培训，配套示例项目（展示规范落地效果）。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go（GoLang）语言基础、知识速查]]></title>    <link>https://juejin.cn/post/7591635567588065326</link>    <guid>https://juejin.cn/post/7591635567588065326</guid>    <pubDate>2026-01-05T06:46:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591635567588065326" data-draft-id="7591544356001251338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go（GoLang）语言基础、知识速查"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-05T06:46:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gitboyzcf"/> <meta itemprop="url" content="https://juejin.cn/user/853651045488455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go（GoLang）语言基础、知识速查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/853651045488455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gitboyzcf
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T06:46:25.000Z" title="Mon Jan 05 2026 06:46:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读33分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bd58667e8fa4304aae9a0872b9add3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=0r%2B%2BJ7%2FFwW6zHm7b2IWYchSQgMw%3D" alt="1" loading="lazy"/></p>
<h2 data-id="heading-0">Go语言基础</h2>
<h3 data-id="heading-1">认识</h3>
<p><strong>Go（又称Golang）</strong> 由Google开发，于2009年首次公开发布。它旨在解决C++编译慢、并发复杂等问题以及提供简洁、高效、可靠的软件开发解决方案。</p>
<p>Golang由Google工程师Robert Griesemer、Rob Pike和Ken Thompson于2007年设计，2009年正式开源。</p>
<p>Golang是一种静态强类型、编译型、并发型 编程语言，特别适合 云计算、微服务、分布式系统 等领域。</p>
<p>支持最强大的<strong>并发、内存管理、垃圾回收机制</strong>等。</p>
<h4 data-id="heading-2">下载安装</h4>
<p>官网： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2F" target="_blank" title="https://go.dev/" ref="nofollow noopener noreferrer">go.dev/（英）</a></p>
<p>可访问 中国镜像站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgolang.google.cn%2F" target="_blank" title="https://golang.google.cn/" ref="nofollow noopener noreferrer">golang.google.cn/</a></p>
<blockquote>
<p>安装教程参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fazure%2Fdeveloper%2Fgo%2Fconfigure-visual-studio-code" target="_blank" title="https://learn.microsoft.com/zh-cn/azure/developer/go/configure-visual-studio-code" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/azure…</a></p>
</blockquote>
<p>以上步骤操作完重新打开VSCode就可以使用了</p>
<h3 data-id="heading-3">Go语言声明</h3>
<ul>
<li><strong>var（声明变量）</strong>
变量意为 可变的东西，就是赋值完还能继续赋值改变这个值
<blockquote>
<p>Go语言的变量声明格式为：var 变量名 变量类型 = 值</p>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span> <span class="hljs-comment">// 声明一个整型变量a并赋值为10</span>
	<span class="hljs-keyword">var</span> b <span class="hljs-type">int</span> <span class="hljs-comment">// 声明一个整型变量b，未赋值，默认值为0</span>
	<span class="hljs-keyword">var</span> c = <span class="hljs-number">20</span> <span class="hljs-comment">// 为声明类型，go会根据值自动推断类型</span>
	<span class="hljs-comment">// 短声明（语法糖 :=  与上面意思一致）</span>
	d := <span class="hljs-string">"短声明d"</span> <span class="hljs-comment">// 短声明一个d变量，赋值为字符串类型</span>
	<span class="hljs-comment">// 一行声明个多，相同类型或不同类型的变量</span>
	<span class="hljs-keyword">var</span> aa,bb,cc <span class="hljs-type">int</span> = <span class="hljs-number">11</span>,<span class="hljs-string">"22"</span>,<span class="hljs-number">33</span>
	<span class="hljs-comment">// 批量声明</span>
	<span class="hljs-keyword">var</span> (
	  e <span class="hljs-type">int</span> = <span class="hljs-number">1</span>
	  f = <span class="hljs-number">2</span>
	)
}
</code></pre>
变量作用域
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
)
<span class="hljs-comment">// 全局变量m</span>
<span class="hljs-keyword">var</span> m = <span class="hljs-number">100</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    n := <span class="hljs-number">10</span>
    m := <span class="hljs-number">200</span> <span class="hljs-comment">// 此处声明局部变量m</span>
    fmt.Println(m, n)
}
</code></pre>
</li>
<li><strong>const（声明常量）</strong>
相对于变量，常量是恒定不变的值，多用于定义程序运行期间不会改变的那些值。只是把var换成了const，常量在定义的时候必须赋值。
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> pi = <span class="hljs-number">3.1415</span>
 <span class="hljs-keyword">const</span> e = <span class="hljs-number">2.7182</span>
 <span class="hljs-comment">// 批量声明</span>
 <span class="hljs-keyword">const</span> (
    pi = <span class="hljs-number">3.1415</span>
    e = <span class="hljs-number">2.7182</span>
	)
 <span class="hljs-comment">// 使用iota 关键字进行递增计数</span>
 <span class="hljs-comment">//  iota 在const关键字出现时将被重置为 0</span>
  <span class="hljs-keyword">const</span> (
		n1 = <span class="hljs-literal">iota</span> <span class="hljs-comment">//0</span>
		n2        <span class="hljs-comment">//1</span>
		n3        <span class="hljs-comment">//2</span>
		n4        <span class="hljs-comment">//3</span>
	)
</code></pre>
</li>
</ul>
<h3 data-id="heading-4">关键字</h3>
<p>关键字是 Go 语言中预先保留的单词，在程序中有特殊含义，不能用来定义变量或常量名字。</p>















































<table><thead><tr><th/><th/><th/><th/><th/></tr></thead><tbody><tr><td>break</td><td>default</td><td>func</td><td>interface</td><td>select</td></tr><tr><td>case</td><td>defer</td><td>go</td><td>map</td><td>struct</td></tr><tr><td>chan</td><td>else</td><td>goto</td><td>package</td><td>switch</td></tr><tr><td>const</td><td>fallthrough</td><td>if</td><td>range</td><td>type</td></tr><tr><td>continue</td><td>for</td><td>import</td><td>return</td><td>var</td></tr></tbody></table>
<h3 data-id="heading-5">数据类型</h3>
<p>Go 语言中数据类型分为：<strong>基本数据类型</strong>和<strong>复合数据类型</strong></p>
<ul>
<li><strong>基本数据类型</strong>
整型、浮点型、布尔型、字符串</li>
<li><strong>复合数据类型</strong>
数组、切片、结构体、函数、map、通道（channel）、接口等</li>
</ul>
<h4 data-id="heading-6">基本数据类型</h4>
<h5 data-id="heading-7">整型</h5>
<p>整型的类型有很多中。我们可以根据具体的情况来进行定义
<strong>有符号整型</strong> ：<code>int8，int16，int32，int64</code>
<strong>无符号整型</strong> : <code>uint8, uint16, uint32, uint64</code></p>
<blockquote>
<p>提示！</p>
<ul>
<li><strong>有符号（Signed）</strong> → <strong>能赋值正数负数</strong>，但正数范围小。</li>
<li><strong>无符号（Unsigned）</strong> → <strong>只能赋值正数</strong>，但能存更大的正数。</li>
</ul>
</blockquote>
<p>如果我们直接写<code>int</code>也是可以的，它在不同的电脑操作系统中，<code>int</code>的大小是不一样的</p>
<p>32位操作系统：int -&gt; int32
64位操作系统：int -&gt; int64</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08b20b705c564b90b8d3dc3db52f51be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=bgjc0THknMHA%2Fnvn5aS7O2d8lSQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> num8 <span class="hljs-type">uint8</span> = <span class="hljs-number">128</span>
<span class="hljs-keyword">var</span> num16 <span class="hljs-type">uint16</span> = <span class="hljs-number">32768</span>
<span class="hljs-keyword">var</span> num32 <span class="hljs-type">uint32</span> = math.MaxUint32
<span class="hljs-keyword">var</span> num64 <span class="hljs-type">uint64</span> = math.MaxUint64
</code></pre>
<h5 data-id="heading-8">浮点型</h5>
<p>浮点型表示存储的数据是实数，如3.145</p>
<p>32位操作系统：<strong>float32</strong>
64位操作系统：<strong>float64</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> num1 <span class="hljs-type">float32</span> = math.MaxFloat32
<span class="hljs-keyword">var</span> num2 <span class="hljs-type">float64</span> = math.MaxFloat64
</code></pre>
<blockquote>
<p><strong>提示：</strong>
我们知道浮点数能表示的数值很大，但是浮点数的精度却没有那么大:</p>
<ul>
<li>float32 的精度只能提供大约 6 个十进制数(表示小数点后 6 位)的精度。</li>
<li>float64 的精度能提供大约 15 个十进制数(表示小数点后 15 位)的精度。</li>
</ul>
</blockquote>
<h5 data-id="heading-9">布尔值</h5>
<p>Go语言中以bool类型进行声明布尔型数据，布尔型数据只有<code>true</code>（真）<code>和false</code>（假）两个值。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> d <span class="hljs-type">bool</span> = <span class="hljs-literal">true</span>
f := <span class="hljs-literal">false</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>
       布尔类型变量的默认值为false。<br/>
Go 语言中不允许将整型强制转换为布尔型.<br/>
布尔型无法参与数值运算，也无法与其他类型进行转换。</p>
</blockquote>
<h5 data-id="heading-10">字符串</h5>
<p>字符串的值为双引号(" ")中的内容</p>
<pre><code class="hljs language-go" lang="go">s1 := <span class="hljs-string">"hello"</span>
s2 := <span class="hljs-string">"你好"</span>
</code></pre>
<h4 data-id="heading-11">复合数据类型</h4>
<h5 data-id="heading-12">数组</h5>
<p>是一种数据类型固定长度的序列，可以理解为一个存放数据的容器。</p>
<blockquote>
<ul>
<li>数组定义：<code>var a [len]int</code>，比如：<code>var a [5]int</code>，一旦定义，长度不能变。</li>
<li>数组可以通过下标进行访问，下标是从0开始，最后一个元素下标是：len-1</li>
<li>数组是<strong>值类型</strong>，<strong>赋值和传参会复制整个数组，而不是指针</strong>。因此改变副本的值，不会改变本身的值。</li>
</ul>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 数组初始化</span>
<span class="hljs-keyword">var</span> arr1 = [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
fmt.Println(arr1) <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 短声明</span>
arr2 := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>{<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>}
fmt.Println(arr2) <span class="hljs-comment">// [4, 5, 6]</span>

<span class="hljs-comment">// 部分初始化，为初始化为0值</span>
arr3 := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>}
fmt.Println(arr3) <span class="hljs-comment">// [1, 2, 0, 0, 0]</span>

<span class="hljs-comment">// 通过指定索引，方便对数组某几个元素赋值</span>
arr4 := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>{<span class="hljs-number">0</span>: <span class="hljs-number">1</span>, <span class="hljs-number">3</span>: <span class="hljs-number">4</span>}
fmt.Println(arr4) <span class="hljs-comment">// [1, 0, 0, 4, 0]</span>

<span class="hljs-comment">// 根据初始化的值，指定长度</span>
arr5 := [...]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
fmt.Println(arr5) <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 多维数组</span>
<span class="hljs-keyword">var</span> arr6 = [<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]<span class="hljs-type">int</span>{{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}, {<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>}}
fmt.Println(arr6) <span class="hljs-comment">// [[1 2 3] [4 5 6]]</span>
</code></pre>
<h5 data-id="heading-13">切片</h5>
<p>切片（Slice）是一个拥有相同类型元素的<strong>可变长度的序列</strong>。它是基于数组类型做的一层封装。它非常灵活，支持自动扩容。</p>
<p>切片是一个引用类型，它的内部结构包含<strong>指针、长度和容量</strong>。切片一般用于快速地操作一块数据集合。</p>
<blockquote>
<p><strong>格式</strong>：<code>var name []T</code></p>
<ul>
<li><strong>name</strong>：表示变量名</li>
<li><strong>T</strong>：表示切片中的元素类型</li>
</ul>
</blockquote>
<p>切片的定义方式与数组的定义方式的区别在于，数组在初始化的时候我们将一个具体大小给他设定了，而切片没有定义大小。</p>
<blockquote>
<p>使用内置<code>len()</code>函数求长度
使用内置<code>cap()</code>函数求容量</p>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> a []<span class="hljs-type">string</span>              <span class="hljs-comment">//声明一个字符串切片</span>
	<span class="hljs-keyword">var</span> b = []<span class="hljs-type">int</span>{}             <span class="hljs-comment">//声明一个整型切片并初始化</span>
	<span class="hljs-keyword">var</span> c = []<span class="hljs-type">bool</span>{<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>} <span class="hljs-comment">//声明一个布尔切片并初始化</span>
	<span class="hljs-comment">// 使用内置 make([]T, len, cap) 定义切片</span>
	numList := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
	fmt.Println(numList) <span class="hljs-comment">// [0 0 0]</span>
	fmt.Println(<span class="hljs-built_in">len</span>(numList)) <span class="hljs-comment">// 3</span>
	fmt.Println(<span class="hljs-built_in">cap</span>(numList)) <span class="hljs-comment">// 5</span>
	<span class="hljs-comment">// 通过数组进行切片截取</span>
	a := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
	<span class="hljs-comment">// 切片的底层就是一个数组，所以我们可以基于数组通过切片表达式得到切片（通过索引截取）</span>
	<span class="hljs-comment">// 格式：数组变量[起始位置:结束位置]</span>
	<span class="hljs-comment">// 切片中不包含结束位置的元素</span>
	s := a[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]
	fmt.Println(s) <span class="hljs-comment">// [2 3]</span>
	
	<span class="hljs-comment">/*
		a[2:]  // 等同于 a[2:len(a)]
		a[:3]  // 等同于 a[0:3]
		a[:]   // 等同于 a[0:len(a)]
	*/</span>
	
	<span class="hljs-comment">// 创建多维切片</span>
	nameList := [][]<span class="hljs-type">string</span>{
		{<span class="hljs-string">"1"</span>, <span class="hljs-string">"张三"</span>},
		{<span class="hljs-string">"2"</span>, <span class="hljs-string">"李四"</span>},
		{<span class="hljs-string">"3"</span>, <span class="hljs-string">"王二"</span>},
		{<span class="hljs-string">"4"</span>, <span class="hljs-string">"麻子"</span>},
	}	
	fmt.Println(nameList) <span class="hljs-comment">// [[1 张三] [2 李四] [3 王二] [4 麻子]]</span>
}
</code></pre>
<h6 data-id="heading-14">用append内置函数操作切片（切片追加）</h6>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
)
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> a = []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>}
    fmt.Printf(<span class="hljs-string">"slice a : %v\n"</span>, a) <span class="hljs-comment">// [1 2 3]</span>
    <span class="hljs-keyword">var</span> b = []<span class="hljs-type">int</span>{<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>}
    fmt.Printf(<span class="hljs-string">"slice b : %v\n"</span>, b) <span class="hljs-comment">// [4 5 6]</span>
    c := <span class="hljs-built_in">append</span>(a, b...)
    fmt.Printf(<span class="hljs-string">"slice c : %v\n"</span>, c) <span class="hljs-comment">// [1 2 3 4 5 6]</span>
    d := <span class="hljs-built_in">append</span>(c, <span class="hljs-number">7</span>)
    fmt.Printf(<span class="hljs-string">"slice d : %v\n"</span>, d) <span class="hljs-comment">// [1 2 3 4 5 6 7]</span>
    e := <span class="hljs-built_in">append</span>(d, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>)
    fmt.Printf(<span class="hljs-string">"slice e : %v\n"</span>, e) <span class="hljs-comment">// [1 2 3 4 5 6 7 8 9 10]</span>
}
</code></pre>
<p>超出原 slice.cap 限制，就会重新分配底层数组，即便<strong>原数组并未填满， 通常以 2 倍容量重新分配底层数组</strong>。</p>
<h5 data-id="heading-15">指针</h5>
<p>指针也是一种类型，也可以创建变量，称之为指针变量。指针变量的类型为 <code>*Type</code>，该指针指向一个 Type 类型的变量。指针变量最大的特点就是存储的某个实际变量的内存地址，通过记录某个变量的地址，从而间接的操作该变量。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659d7ffe2a7140baafe34b50e97bcebd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=Wi6iaU11NN5UQNzv4uaH1B%2F1Sps%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<blockquote>
<p><strong>指针声明获取格式</strong></p>
<ul>
<li>var 变量名 *类型 = new(类型)</li>
<li>填入值：*变量名 = 值</li>
<li>获取指针：&amp;变量名</li>
<li>获取值：*变量名</li>
</ul>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
)
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> num <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
	p := &amp;num <span class="hljs-comment">// 将地址值指针赋值给p变量</span>
	fmt.Println(p) <span class="hljs-comment">// 输出地址值指针 0x14000010230</span>
	fmt.Println(*p) <span class="hljs-comment">// 通过指针访问值  // 10</span>
	fmt.Println(&amp;num) <span class="hljs-comment">// 0x14000010230</span>
	fmt.Println(num) <span class="hljs-comment">// 10</span>
	

	<span class="hljs-comment">// 修改指针指向的值</span>
	*p = <span class="hljs-number">20</span>
	fmt.Println(num) <span class="hljs-comment">// 20</span>

	<span class="hljs-comment">// new 先创建指针分配好内存，再给指针写入值</span>
	<span class="hljs-keyword">var</span> p1 *<span class="hljs-type">int</span> = <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>)
	*p1 = <span class="hljs-number">30</span>
	fmt.Println(*p1) <span class="hljs-comment">// 30</span>
}
</code></pre>
<p>只需要记住两个符号：<code>&amp;</code>（取地址）和<code>*</code>（根据地址取值）。
<strong>总结</strong>： 取地址操作符&amp;和取值操作符<code>*</code>是一对互补操作符，<code>&amp;</code>取出地址，<code>*</code>根据地址取出地址指向的值。</p>
<blockquote>
<p><strong>变量、指针地址、指针变量、取地址、取值的相互关系和特性如下</strong>:</p>
<ol>
<li>对变量进行取地址（&amp;）操作，可以获得这个变量的指针变量。
&gt;2. 指针变量的值是指针地址。
&gt;3. 对指针变量进行取值（*）操作，可以获得指针变量指向的原变量的值。</li>
</ol>
</blockquote>
<h6 data-id="heading-16">空指针</h6>
<p>当一个指针被定义后没有分配到任何变量时，它的值为 <code>nil</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> p *<span class="hljs-type">string</span>
    fmt.Println(p)
    fmt.Printf(<span class="hljs-string">"p的值是%s/n"</span>, p)
    <span class="hljs-keyword">if</span> p != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"非空"</span>)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"空值"</span>)
    }
}
</code></pre>
<h5 data-id="heading-17">Map</h5>
<p><code>map</code>是一种无序的基于key-value的数据结构，Go语言中的map是引用类型。它类似于其他编程语言中的哈希表或字典，提供了快速的插入、删除和查找操作</p>
<p>map中的数据是<strong>无序排列</strong>
map中的key只能是<code>string|int</code>类型</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
)
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 定义方式</span>
	<span class="hljs-comment">// make方式  格式：name := make(map[KeyType]ValueType) 或者 make(map[KeyType]ValueType, [cap])</span>
	<span class="hljs-comment">// KeyType:表示键的类型。 ValueType:表示键对应的值的类型。 cap表示容量</span>
	make1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>) 
	fmt.Printf(make1) <span class="hljs-comment">// map[]</span>
	
	<span class="hljs-comment">// 通过字面量</span>
	<span class="hljs-keyword">var</span> userInfo1 <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
        <span class="hljs-string">"username"</span>: <span class="hljs-string">"zhangsan"</span>,
        <span class="hljs-string">"password"</span>: <span class="hljs-string">"123456"</span>,
    }
	<span class="hljs-comment">// 通过短声明</span>
	userInfo2 := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
        <span class="hljs-string">"username"</span>: <span class="hljs-string">"zhangsan"</span>,
        <span class="hljs-string">"password"</span>: <span class="hljs-string">"123456"</span>,
    }
    fmt.Printf(userInfo2) <span class="hljs-comment">// map[username:zhangsan password:123456]</span>
    
    userList := <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">string</span>{
	    <span class="hljs-number">1</span>: <span class="hljs-string">'张三'</span>,
	    <span class="hljs-number">2</span>: <span class="hljs-string">'李四'</span>,
	    <span class="hljs-number">3</span>: <span class="hljs-string">'王二'</span>,
    }
    <span class="hljs-comment">// 添加元素到map</span>
	userList[<span class="hljs-number">4</span>] = <span class="hljs-string">"麻子"</span>
	fmt.Println(userList) <span class="hljs-comment">// map[1:张三 2:李四 3:王二 4:麻子]</span>
	<span class="hljs-comment">// 更新map</span>
	userList[<span class="hljs-number">4</span>] = <span class="hljs-string">"mazi"</span>
	fmt.Println(userList) <span class="hljs-comment">// map[1:张三 2:李四 3:王二 4:mazi]</span>
	<span class="hljs-comment">// 获取元素</span>
	fmt.Println(userList[<span class="hljs-number">4</span>]) <span class="hljs-comment">// mazi</span>
	<span class="hljs-comment">// 删除元素</span>
	<span class="hljs-built_in">delete</span>(userList, <span class="hljs-number">4</span>)
	fmt.Println(userList) <span class="hljs-comment">// map[1:张三 2:李四 3:王二]</span>
	
	<span class="hljs-comment">//判断键值是否存在  value,ok := map[key]</span>
	u3, ok := userList[<span class="hljs-number">3</span>]
	fmt.Println(ok) <span class="hljs-comment">// true</span>
	fmt.Println(u3) <span class="hljs-comment">// 张三</span>

	u4, ok := userList[<span class="hljs-number">4</span>]
	fmt.Println(ok) <span class="hljs-comment">// false</span>
	fmt.Println(u4) <span class="hljs-comment">// </span>
	
	<span class="hljs-comment">// 循环map</span>
	<span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> m1 {
		<span class="hljs-comment">/*
		%s、%d都是占位符，%s是用于插入字符串类型，%d用于插入整数类型的值
		*/</span>
		fmt.Printf(<span class="hljs-string">"key: %s, value: %d\n"</span>, key, value)
	}
	
}

</code></pre>
<h3 data-id="heading-18">结构体</h3>
<blockquote>
<p><strong>理解</strong></p>
<ul>
<li>Go语言中没有“类”的概念，也不支持“类”的继承等面向对象的概念。Go语言中通过<strong>结构体</strong>的内嵌再配合接口比面向对象具有更高的扩展性和灵活性。</li>
<li>Go语言提供了一种自定义数据类型，可以封装多个基本数据类型，这种数据类型叫结构体，英文名称<strong>struct</strong>。 也就是我们可以通过struct来定义自己的类型了。</li>
</ul>
</blockquote>
<p>简单理解就是go语言中的类成为结构体，用<code>type</code>和<code>struct</code>关键字进行实现</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> 类型名 <span class="hljs-keyword">struct</span> {
	字段名 字段类型
	字段名 字段类型
	…
}
<span class="hljs-comment">/*
1.类型名：标识自定义结构体的名称，在同一个包内不能重复。
2.字段名：表示结构体字段名。结构体中的字段名必须唯一。
3.字段类型：表示结构体字段的具体类型。
*/</span>
</code></pre>
<p>结构体中字段大写开头表示可公开访问，小写表示私有（仅在定义当前结构体的包中可访问）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 创建结构体</span>
<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
	name <span class="hljs-type">string</span> <span class="hljs-comment">// 姓名</span>
	age  <span class="hljs-type">int</span>    <span class="hljs-comment">// 年龄</span>
}

<span class="hljs-keyword">type</span> Person2 <span class="hljs-keyword">struct</span> {
	name, age <span class="hljs-type">string</span> <span class="hljs-comment">// 声明多个同类型字段</span>
	sex       <span class="hljs-type">int</span>
}




<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	<span class="hljs-comment">// 实例化结构体</span>
	<span class="hljs-comment">// 按字段名称对每个字段进行初始化</span>
	persion := Person{name: <span class="hljs-string">"张三"</span>, age: <span class="hljs-number">30</span>}
	fmt.Println(persion) <span class="hljs-comment">// {张三 30}</span>

	<span class="hljs-comment">// 按字段顺序进行初始化</span>
	persion2 := Person2{<span class="hljs-string">"李四"</span>, <span class="hljs-string">"30"</span>, <span class="hljs-number">1</span>}
	fmt.Println(persion2) <span class="hljs-comment">// {李四 30 1}</span>
	
	
	<span class="hljs-comment">// 创建并实例化结构体</span>
	persion3 := <span class="hljs-keyword">struct</span> {
	  name <span class="hljs-type">string</span>
	  age <span class="hljs-type">int</span>
	  sex <span class="hljs-type">string</span>
	}{
	  name: <span class="hljs-string">"王二"</span>,
	  age: <span class="hljs-number">20</span>,
	  sex: <span class="hljs-string">"男"</span>
	}
	fmt.Println(persion3) <span class="hljs-comment">// {王二 20 男}</span>
	
	<span class="hljs-comment">// 实例化时未给值</span>
	<span class="hljs-keyword">var</span> person22 = Person2{}
	fmt.Println(person22) <span class="hljs-comment">// {  0}</span>
	
	<span class="hljs-comment">// 实例化未给全值</span>
	<span class="hljs-keyword">var</span> person222 = Person2{<span class="hljs-string">"李四"</span>, <span class="hljs-string">"30"</span>}
	fmt.Println(person22) <span class="hljs-comment">// {李四 30 0}</span>
	
	<span class="hljs-comment">// 通过 . 的方式对实例化后的结构体 进行改 删 查</span>
	person22.name = <span class="hljs-string">"李四"</span>
	person22.age = <span class="hljs-string">"30"</span>
	person22.sex = <span class="hljs-number">1</span>
	fmt.Println(person22) <span class="hljs-comment">// {李四 30 1}</span>
	
	<span class="hljs-comment">// 匿名属性结构体 多个相同类型会报错</span>
	<span class="hljs-keyword">type</span> Person3 <span class="hljs-keyword">struct</span> {
		<span class="hljs-type">string</span>
		<span class="hljs-type">int</span>
	}
	
	<span class="hljs-keyword">var</span> person33 = Person3{<span class="hljs-string">"王五"</span>, <span class="hljs-number">40</span>}
	fmt.Println(person33.<span class="hljs-type">string</span>) <span class="hljs-comment">// 王五</span>
	fmt.Println(person33.<span class="hljs-type">int</span>) <span class="hljs-comment">// 40</span>
	fmt.Println(person33) <span class="hljs-comment">// {王五 40}</span>
	
	<span class="hljs-comment">// 获取指针指针地址</span>
	<span class="hljs-keyword">var</span> person333 = &amp;Person33{<span class="hljs-string">"王五"</span>, <span class="hljs-number">30</span>}
	fmt.Println(person333) <span class="hljs-comment">// {王五 30}</span>
	fmt.Println((*person333).<span class="hljs-type">int</span>) <span class="hljs-comment">// 30</span>
	fmt.Println(person333.<span class="hljs-type">int</span>) <span class="hljs-comment">// 30</span>
	
}
</code></pre>
<h4 data-id="heading-19">方法和接收者</h4>
<p>Go语言中的方法（<em>Method</em>）是一种作用于特定类型变量的函数。这种特定类型变量叫做接收者（<em>Receiver</em>）。
<strong>接收者的概念就类似于其他语言中的this或者 self。</strong></p>
<p><strong>定义格式</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(接收者变量 接收者类型)</span></span> 方法名(参数列表) (返回参数) {
	函数体
}
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>接收者类型  就是定义的结构体</li>
<li>接收者变量   与定义普通变量相似就是随意定义一个名字，建议使用接收者类型的第一个字母 小写</li>
<li>方法名、参数列表、返回参数：具体格式与函数定义相同。函数后面会细讲</li>
</ul>
<p><strong>例子</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//Person 结构体</span>
<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    name <span class="hljs-type">string</span>
    age  <span class="hljs-type">int8</span>
}


<span class="hljs-comment">// 将Dream方法 绑定到Person 结构体下；可以理解为  Dream方法是属于Person的</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> Dream() {
    fmt.Printf(<span class="hljs-string">"%s的梦想是学好Go语言！\n"</span>, p.name)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Person)</span></span> SetName(n <span class="hljs-type">string</span>) {
 <span class="hljs-comment">// 这种方式不会修改实例后结构体的数据</span>
 p.name = n
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Person)</span></span> SetName2(n <span class="hljs-type">string</span>) {
 <span class="hljs-comment">// 这种使用指针接收器可以直接修改原实例数据</span>
 p.name = n
}



<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> p1 = Person{name: <span class="hljs-string">"zhangsan"</span>, age: <span class="hljs-number">24</span>}
    p1.Dream()
}
</code></pre>
<blockquote>
<p>方法与函数的区别是，函数不属于任何类型，方法属于特定的类型。</p>
</blockquote>
<h3 data-id="heading-20">函数</h3>
<p>函数用于功能代码块的封装，使用<code>func</code>关键字定义
<strong>格式</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> 函数名<span class="hljs-params">(参数列表, ...)</span></span> 返回值类型 {
	函数体
}
</code></pre>
<p><strong>参数解析</strong>：</p>
<ul>
<li>函数名：随便起名字，通常以小驼峰命名，比如：<code>funcName</code></li>
<li>参数列表：由一个或多个<strong>参数名 参数类型</strong>组成，比如: <code>a int,b string</code>；函数可以没有参数或接受多个参数。<strong>定义的这些参数相当于定义的变量，只有在当前函数内部使用</strong>；可以传递任意类型的参数</li>
<li>返回值类型：函数可以返回任意数量的返回值</li>
<li>函数体：编写正常的go语言代码即可</li>
</ul>
<p><strong>例子</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test</span><span class="hljs-params">(x, y <span class="hljs-type">int</span>, s <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">string</span>) {
    <span class="hljs-comment">// 类型相同的相邻参数，参数类型可合并。可以返回多个结果 多返回值必须用括号。</span>
    n := x + y          
    <span class="hljs-keyword">return</span> n, fmt.Sprintf(s, n)
}


<span class="hljs-comment">// 一个返回值类型可以省略括号</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sum</span><span class="hljs-params">(x <span class="hljs-type">int</span>, y <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
	<span class="hljs-keyword">return</span> x + y
}

<span class="hljs-comment">//无参数和返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printNum</span><span class="hljs-params">()</span></span> {
	fmt.Println(<span class="hljs-string">"go go go"</span>)
}


<span class="hljs-comment">// 以下方式的args都是一个slice（切片），可以用切片的方式去操作</span>
<span class="hljs-comment">// 注意点：在参数类型前面加 ... 表示一个切片，用来接收调用者传入的参数，切片参数必须放在参数列表最后</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myfunc1</span><span class="hljs-params">(args ...<span class="hljs-type">int</span>)</span></span> {    <span class="hljs-comment">//0个或多个int参数</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add1</span><span class="hljs-params">(a <span class="hljs-type">int</span>, args…<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {    <span class="hljs-comment">//1个或多个int参数</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add2</span><span class="hljs-params">(a <span class="hljs-type">int</span>, b <span class="hljs-type">int</span>, args…<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {    <span class="hljs-comment">//2个或多个int参数</span>
}

<span class="hljs-comment">// 使用...interface{}的方式可以传递多个任意类型的参数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">myfunc2</span><span class="hljs-params">(args ...<span class="hljs-keyword">interface</span>{})</span></span> {
}

<span class="hljs-comment">// 返回值添加变量</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">test2</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (sum <span class="hljs-type">int</span>, avg <span class="hljs-type">int</span>) {
	sum = a + b
	avg = sum / <span class="hljs-number">2</span>
	<span class="hljs-keyword">return</span>
}


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	testReturn, testStr := test(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"3"</span>)
	fmt.Println(testReturn, testStr) <span class="hljs-comment">// 3 3</span>
	fmt.Println(sum(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// 3</span>
	printNum()
	myfunc1()
	myfunc2(<span class="hljs-number">1</span>, <span class="hljs-literal">true</span>, <span class="hljs-string">"张三"</span>)
	
	sum, avg := test2(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
	fmt.Println(sum, avg) <span class="hljs-comment">// 30 15</span>
}
</code></pre>
<blockquote>
<p><strong>注意点</strong>：</p>
<ul>
<li><strong>基本类型参数传递</strong>：指在调用函数时将实际参数复制一份传递到函数中，这样在函数中如果对参数进行修改，将不会影响到实际参数。</li>
<li><strong>引用类型参数传递</strong>：是指在调用函数时将实际参数的地址传递到函数中，那么在函数中对参数所进行的修改，将影响到实际参数。</li>
</ul>
</blockquote>
<blockquote>
<p><strong>函数可见性</strong>：</p>
<ul>
<li>函数名首字母大写，对所有的包都是public，其他包可以导入当前包使用</li>
<li>函数名首字母小写，当前函数是private，其他包无法访问</li>
</ul>
</blockquote>
<h4 data-id="heading-21">匿名函数</h4>
<p><strong>格式</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(参数列表, ...)</span></span> 返回值类型 {
	函数体
}
</code></pre>
<p>多用于创建变量在把匿名函数赋值，函数当参数进行传递时</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"math"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    getSqrt := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a <span class="hljs-type">float64</span>)</span></span> <span class="hljs-type">float64</span> {
        <span class="hljs-keyword">return</span> math.Sqrt(a)
    }
    fmt.Println(getSqrt(<span class="hljs-number">4</span>)) <span class="hljs-comment">// 2</span>
    
    <span class="hljs-comment">// 匿名函数并自执行</span>
    result := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
	    <span class="hljs-keyword">return</span> a + b
	}(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
	fmt.Println(result) <span class="hljs-comment">// 输出 7</span>
	
	<span class="hljs-comment">// 命名返回值</span>
	<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fun4</span><span class="hljs-params">()</span></span> (res <span class="hljs-type">string</span>) {
	  <span class="hljs-keyword">return</span> <span class="hljs-comment">// 相当于先定义再赋值</span>
	  <span class="hljs-comment">//return "abc"</span>
	}
}
</code></pre>
<h4 data-id="heading-22">闭包、递归</h4>
<p><strong>闭包</strong>：与其他语言闭包概念一致，函数嵌套函数，内部函数引用外部函数的变量形成引用环境</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
)
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(base <span class="hljs-type">int</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        base += i
        <span class="hljs-keyword">return</span> base
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	tmp1 := add(<span class="hljs-number">10</span>)
	fmt.Println(tmp1(<span class="hljs-number">1</span>), tmp1(<span class="hljs-number">2</span>)) <span class="hljs-comment">// 11 13</span>
}

</code></pre>
<p><strong>递归</strong>：就是在运行的过程中调用自己。 一个函数调用自己，就叫做递归函数。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">factorial</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">if</span> i &lt;= <span class="hljs-number">1</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    }
    <span class="hljs-keyword">return</span> i * factorial(i<span class="hljs-number">-1</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> i <span class="hljs-type">int</span> = <span class="hljs-number">7</span>
    fmt.Printf(<span class="hljs-string">"Factorial of %d is %d\n"</span>, i, factorial(i)) <span class="hljs-comment">// Factorial of 7 is 5040</span>
}
</code></pre>
<h4 data-id="heading-23">延迟调用（defer）</h4>
<p>简单点说就是 <code>defer</code> 语句后面跟着的函数会延迟到当前函数执行完后再执行。</p>
<p>只能用于<strong>函数、结构体方法</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bookPrint</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"bookPrint方法"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">defer</span> bookPrint()
    fmt.Println(<span class="hljs-string">"main函数..."</span>)
}
<span class="hljs-comment">/*
 会先输出 main函数...
 在输出   bookPrint方法
*/</span>

</code></pre>
<p>注意点：</p>
<ul>
<li>使用 <code>defer</code> 只是延时调用函数，传递给函数里的变量，不应该受到后续程序的影响。</li>
<li><code>defer</code> 不仅能够延迟<strong>函数</strong>的执行，也能延迟<strong>方法</strong>的执行。</li>
<li>当一个函数内多次调用 <code>defer</code> 时，Go 会把 <code>defer</code> 调用放入到一个栈中，随后按照 <strong>后进先出</strong> 的顺序执行。</li>
</ul>
<h3 data-id="heading-24">包（package）</h3>
<p>Go 语言是使用包来<strong>组织源代码</strong>的， **包（package）**是多个 Go 源码的集合，一个包可以简单理解为一个存放多个.go 文件的文件夹。该文件夹下面的所有 go 文件都要在代码的第一行添加如下代码，声明该文件归属的包。</p>
<p><strong>Golang 中的包可以分为三种</strong>：1、系统内置包 2、自定义包 3、第三方包</p>
<blockquote>
<p><strong>系统内置包</strong>: Golang 语言给我们提供的内置包，引入后可以直接使用，如 fmt、strconv、strings、 sort、errors、time、encoding/json、os、io 等。
<strong>自定义包</strong>：开发者自己写的包
<strong>第三方包</strong>：属于自定义包的一种，需要下载安装到本地后才可以使用，如 "github.com/shopspring/decimal"包解决 float 精度丢失问题。</p>
</blockquote>
<p>在上面讲述的代码中都会看到，<code>package main</code>这段代码，这就是声明当前.go文件的包名</p>
<blockquote>
<p><strong>格式</strong></p>
<ul>
<li>声明当前.go文件的包名： <code>package pacakgeName</code></li>
<li>在当前文件中导入其他包时：<code>import "a/b/c"</code>，import后面是包的相对路径，从当前项目的根目录下指定</li>
</ul>
</blockquote>
<h4 data-id="heading-25">标识符可见性</h4>
<p>如果想在一个包中引用另外一个包里的标识符（如变量、常量、类型、函数等）时，该标识 符必须是对外可见的（public）。</p>
<p>在 Go 语言中只需要将标识符的<strong>首字母大写</strong>就可以让标识符对外可见了。</p>
<p>定义一个名为calc 的包</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> calc
 
<span class="hljs-comment">//首字母大小表示公有，首字母小写表示私有</span>
 
<span class="hljs-keyword">var</span> a = <span class="hljs-number">100</span> <span class="hljs-comment">//私有变量</span>
<span class="hljs-keyword">var</span> Age = <span class="hljs-number">20</span> <span class="hljs-comment">//公有变量</span>
 
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span><span class="hljs-params">(x, y <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> x + y
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Sum</span><span class="hljs-params">(x, y <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> x - y
}
</code></pre>
<p>main.go中引入这个包</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main
 
<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"demo02/calc"</span>
    ca <span class="hljs-string">"demo02/calc"</span> <span class="hljs-comment">// 有别名的包</span>
)
 
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    c := calc.Add(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>)
    c2 := ca.Add(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>)
    fmt.Println(c)
}
</code></pre>
<h4 data-id="heading-26">init() 函数</h4>
<p>每个包文件都有个固定的，init函数此函数没有参数也没有返回值 ，充当每个包的生命周期初始化，不能在代码中主动调用它。</p>
<p>编译执行顺序⬇️
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/512f202bd72445daaff9832cabd7e4cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=3s3fbFAPBQZQAdk3iSMfMCHqqqQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35768698cb1c479b83e5a15cd9543ee7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=lhqqd3W5CHplBzTcI8g1rKVIaCg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-27">流程控制</h3>
<h4 data-id="heading-28">条件语句</h4>
<blockquote>
<p><strong>格式</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> 布尔表达式 {
<span class="hljs-comment">/* 在布尔表达式为 true 时执行 */</span>
}
</code></pre>
</blockquote>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

   <span class="hljs-comment">/* 定义局部变量 */</span>
   <span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
   <span class="hljs-comment">/* 使用 if 语句判断布尔表达式 */</span>
   <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">20</span> {
       <span class="hljs-comment">/* 如果条件为 true 则执行以下语句 */</span>
       fmt.Printf(<span class="hljs-string">"a 小于 20\n"</span> ) <span class="hljs-comment">//  a 小于 20</span>
   }
   fmt.Printf(<span class="hljs-string">"a 的值为 : %d\n"</span>, a) <span class="hljs-comment">// a 的值为 : 10</span>

	score := <span class="hljs-number">88</span>  
	<span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">90</span> {  
	    fmt.Println(<span class="hljs-string">"成绩等级为A"</span>)  
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">80</span> {  
	    fmt.Println(<span class="hljs-string">"成绩等级为B"</span>)  
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">70</span> {  
	    fmt.Println(<span class="hljs-string">"成绩等级为C"</span>)  
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">60</span> {  
	    fmt.Println(<span class="hljs-string">"成绩等级为D"</span>)  
	} <span class="hljs-keyword">else</span> {  
	    fmt.Println(<span class="hljs-string">"成绩等级为E 成绩不及格"</span>)  
	}
	
	<span class="hljs-comment">// 简便用法</span>
	<span class="hljs-keyword">if</span> score := <span class="hljs-number">88</span>; score &gt;= <span class="hljs-number">60</span> {  
	    fmt.Println(<span class="hljs-string">"成绩及格"</span>)  
	}

}
</code></pre>
<h4 data-id="heading-29">选择语句</h4>
<p>与其他语言的<code>switch</code>相似</p>
<blockquote>
<p><strong>格式</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">switch</span> var1 {
  <span class="hljs-keyword">case</span> val1:
  ...
  <span class="hljs-keyword">case</span> val2:
  ...
  <span class="hljs-keyword">default</span>:
  ...
}
</code></pre>
</blockquote>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
   <span class="hljs-comment">/* 定义局部变量 */</span>
   <span class="hljs-keyword">var</span> grade <span class="hljs-type">string</span> = <span class="hljs-string">"B"</span>
   <span class="hljs-keyword">var</span> marks <span class="hljs-type">int</span> = <span class="hljs-number">90</span>

   <span class="hljs-keyword">switch</span> marks {
      <span class="hljs-keyword">case</span> <span class="hljs-number">90</span>: grade = <span class="hljs-string">"A"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">80</span>: grade = <span class="hljs-string">"B"</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">50</span>,<span class="hljs-number">60</span>,<span class="hljs-number">70</span> : grade = <span class="hljs-string">"C"</span>
      <span class="hljs-keyword">default</span>: grade = <span class="hljs-string">"D"</span>  
   }

	<span class="hljs-comment">//无表达式的switch</span>
   <span class="hljs-keyword">switch</span> {
      <span class="hljs-keyword">case</span> grade == <span class="hljs-string">"A"</span> :
         fmt.Printf(<span class="hljs-string">"优秀!\n"</span> )     
      <span class="hljs-keyword">case</span> grade == <span class="hljs-string">"B"</span>, grade == <span class="hljs-string">"C"</span> :
         fmt.Printf(<span class="hljs-string">"良好\n"</span> )      
      <span class="hljs-keyword">case</span> grade == <span class="hljs-string">"D"</span> :
         fmt.Printf(<span class="hljs-string">"及格\n"</span> )      
      <span class="hljs-keyword">case</span> grade == <span class="hljs-string">"F"</span>:
         fmt.Printf(<span class="hljs-string">"不及格\n"</span> )
      <span class="hljs-keyword">default</span>:
         fmt.Printf(<span class="hljs-string">"差\n"</span> )
   }
   fmt.Printf(<span class="hljs-string">"你的等级是 %s\n"</span>, grade )
   
   
   <span class="hljs-comment">// 结合fallthrough关键字</span>
    <span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>
    <span class="hljs-keyword">switch</span> k {
	    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
	        <span class="hljs-built_in">println</span>(<span class="hljs-string">"fallthrough"</span>)
	        <span class="hljs-keyword">fallthrough</span>
	        <span class="hljs-comment">/*
	            Go的switch非常灵活，表达式不必是常量或整数，执行的过程从上至下，直到找到匹配项；
	            而如果switch没有表达式，它会匹配true。
	            Go里面switch默认相当于每个case最后带有break，
	            匹配成功后不会自动向下执行其他case，而是跳出整个switch,
	            但是可以使用fallthrough强制执行后面的case代码。
	        */</span>
	    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
	        fmt.Println(<span class="hljs-string">"1"</span>)
	    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
	        fmt.Println(<span class="hljs-string">"2"</span>)
	    <span class="hljs-keyword">default</span>:
	        fmt.Println(<span class="hljs-string">"def"</span>)
    }
   
   
   <span class="hljs-comment">// 简便用法</span>
   <span class="hljs-keyword">switch</span> month := <span class="hljs-number">5</span>; month {
		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">12</span>:
		    fmt.Println(<span class="hljs-string">"该月份有 31 天"</span>)
		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>:
		    fmt.Println(<span class="hljs-string">"该月份有 30 天"</span>)
		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
		    fmt.Println(<span class="hljs-string">"该月份闰年为 29 天，非闰年为 28 天"</span>)
		<span class="hljs-keyword">default</span>:
		    fmt.Println(<span class="hljs-string">"输入有误！"</span>)
	}
}
</code></pre>
<h4 data-id="heading-30">循环语句</h4>
<p>在Go语言中只有一种循环<code>for</code></p>
<p>以下是常用的几种格式</p>
<blockquote>
<p><strong>格式</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">for</span> initialisation; condition; post {
  code
}
<span class="hljs-comment">// for 接一个条件表达式</span>
<span class="hljs-keyword">for</span> condition {
  code
}
<span class="hljs-comment">// for 接一个 range 表达式</span>
<span class="hljs-keyword">for</span> range_expression {
  code
}
<span class="hljs-comment">// for 不接表达式</span>
<span class="hljs-keyword">for</span> {
  code
}
</code></pre>
</blockquote>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 定义变量、条件判断、变量自增/自减 都放在一起，与其他语言类似</span>
	<span class="hljs-keyword">for</span> num := <span class="hljs-number">0</span>; num &lt; <span class="hljs-number">4</span>; num++ {
	    fmt.Println(num)
	}
	
	<span class="hljs-comment">// 接一个条件表达式</span>
	num := <span class="hljs-number">0</span>
	<span class="hljs-keyword">for</span> num &lt; <span class="hljs-number">4</span> {
	    fmt.Println(num)
	    num++
	}
	
	<span class="hljs-comment">// 接一个 range 表达式</span>
	<span class="hljs-comment">// for 循环的 range 格式可以对 切片(slice)、map、数组、字符串等进行迭代循环。</span>
	 s := <span class="hljs-string">"abc"</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> s {
        <span class="hljs-built_in">println</span>(s[i])
    }
    
    <span class="hljs-comment">// 忽略 index </span>
    <span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> s {
        <span class="hljs-built_in">println</span>(c)
    }
    
    <span class="hljs-comment">// 忽略全部返回值，仅迭代。</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> s {

    }
	
    m := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>{<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">2</span>}
    <span class="hljs-comment">// 返回 (key, value)。</span>
    <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> m {
        <span class="hljs-built_in">println</span>(k, v)
    }
    
    <span class="hljs-comment">// ！！注意，因a变量是数组，修改操作不会改变原数组。======</span>
    a := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>{<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>}

    <span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> a { <span class="hljs-comment">// index、value 都是从复制品中取出。</span>

        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> { <span class="hljs-comment">// 在修改前，我们先修改原数组。</span>
            a[<span class="hljs-number">1</span>], a[<span class="hljs-number">2</span>] = <span class="hljs-number">999</span>, <span class="hljs-number">999</span>
            fmt.Println(a) <span class="hljs-comment">// 确认修改有效，输出 [0, 999, 999]。</span>
        }

        a[i] = v + <span class="hljs-number">100</span> <span class="hljs-comment">// 使用复制品中取出的 value 修改原数组。</span>

    }

    fmt.Println(a) <span class="hljs-comment">// 输出 [100, 101, 102]。</span>
	
	<span class="hljs-comment">//for 不接表达式，以下写法会无限循环，可以使用 break 关键字结束</span>
	<span class="hljs-comment">// 第一种写法</span>
	<span class="hljs-keyword">for</span> {
	    code
	}
	<span class="hljs-comment">// 第二种写法</span>
	<span class="hljs-keyword">for</span> ;; {
	    code
	}
}
</code></pre>
<ul>
<li>循环语句支持以下控制关键字
<ol>
<li><code>break</code></li>
<li><code>continue</code></li>
</ol>
</li>
</ul>
<h4 data-id="heading-31">goto语句</h4>
<p><code>goto</code>语句用于无条件跳转，可以无条件地转移到程序中指定的行；它通过标签进行代码间的无条件跳转。</p>
<p><code>goto</code>后面接一个标签，这个标签的意义是告诉Go程序下一步要执行哪行的代码，</p>
<blockquote>
<p>格式</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">goto</span> 标签;
...
...
标签: 表达式;
</code></pre>
</blockquote>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

    <span class="hljs-keyword">goto</span> flag
    fmt.Println(<span class="hljs-string">"B"</span>)
flag:
    fmt.Println(<span class="hljs-string">"A"</span>)

}
</code></pre>
<pre><code class="hljs language-css" lang="css">执行结果，并不会输出 <span class="hljs-selector-tag">B</span> ，而只会输出 <span class="hljs-selector-tag">A</span>
</code></pre>
<p>构成循环</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    i := <span class="hljs-number">1</span>
 flag:
    <span class="hljs-keyword">if</span> i &lt;= <span class="hljs-number">5</span> {
        fmt.Println(i)
        i++
        <span class="hljs-keyword">goto</span> flag
    }
}
</code></pre>
<p>goto语句与标签之间不能有变量声明，否则编译错误。</p>
<h3 data-id="heading-32">接口</h3>
<p>**接口（interface）**定义了一个对象的行为规范，只定义规范不实现，由具体的对象来实现规范的细节。</p>
<blockquote>
<p>格式</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> 接口类型名 <span class="hljs-keyword">interface</span>{
  方法名<span class="hljs-number">1</span>( 参数列表<span class="hljs-number">1</span> ) 返回值列表<span class="hljs-number">1</span>
  方法名<span class="hljs-number">2</span>( 参数列表<span class="hljs-number">2</span> ) 返回值列表<span class="hljs-number">2</span>
  …
}
</code></pre>
</blockquote>
<p>我们来定义一个Sayer接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Sayer 接口</span>
<span class="hljs-keyword">type</span> Sayer <span class="hljs-keyword">interface</span> {
    say()
}
</code></pre>
<p>定义dog和cat两个结构体：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span> {}

<span class="hljs-keyword">type</span> cat <span class="hljs-keyword">struct</span> {}
</code></pre>
<p>因为Sayer接口里只有一个say方法，所以我们只需要给dog和cat 分别实现say方法就可以实现Sayer接口了。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// dog实现了Sayer接口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> say() {
    fmt.Println(<span class="hljs-string">"汪汪汪"</span>)
}

<span class="hljs-comment">// cat实现了Sayer接口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c cat)</span></span> say() {
    fmt.Println(<span class="hljs-string">"喵喵喵"</span>)
}
</code></pre>
<p>接口的实现就是这么简单，只要实现了接口中的所有方法，就实现了这个接口。</p>
<h4 data-id="heading-33">接口类型变量</h4>
<p><strong>接口类型变量能够存储所有实现了该接口的实例</strong>。 例如上面的示例中，Sayer类型的变量能够存储dog和cat类型的变量。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> x Sayer <span class="hljs-comment">// 声明一个Sayer类型的变量x</span>
    a := cat{}  <span class="hljs-comment">// 实例化一个cat</span>
    b := dog{}  <span class="hljs-comment">// 实例化一个dog</span>
    x = a       <span class="hljs-comment">// 可以把cat实例直接赋值给x</span>
    x.say()     <span class="hljs-comment">// 喵喵喵</span>
    x = b       <span class="hljs-comment">// 可以把dog实例直接赋值给x</span>
    x.say()     <span class="hljs-comment">// 汪汪汪</span>
}
</code></pre>
<p><strong>值接收者实现接口</strong> 接口类型变量 可以接受，普通结构体类型和指针结构体类型的赋值操作</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 值接收者实现接口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> move() {
    fmt.Println(<span class="hljs-string">"狗会动"</span>)
}
</code></pre>
<p><strong>指针接收者实现接口</strong> 接口类型变量  只能接受，指针结构体类型的赋值操作</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *dog)</span></span> move() {
    fmt.Println(<span class="hljs-string">"狗会动"</span>)
}
</code></pre>
<h4 data-id="heading-34">空接口</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> i <span class="hljs-keyword">interface</span>{}
fmt.Println(<span class="hljs-string">"类型：%T，值：%v\n"</span>, i, i) <span class="hljs-comment">// 类型：&lt;nil&gt;，值：&lt;nil&gt;</span>

i = <span class="hljs-number">123</span>
i = <span class="hljs-string">"123"</span>
i = <span class="hljs-literal">true</span>
i = <span class="hljs-number">3.14</span>
</code></pre>
<p>可以借助这一特性，使上面的 <code>i</code>变量<strong>可以接受任何类型的赋值操作</strong>，反之拥有<code>interface{}</code>类型的变量<strong>不能赋值</strong>给其他类型</p>
<h5 data-id="heading-35">类型断言</h5>
<p>判断空接口是什么类型，使用<code>x.(T)</code>语法</p>
<ul>
<li>x：表示类型为interface{}的变量</li>
<li>T：表示断言x可能是的类型。</li>
</ul>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> x <span class="hljs-keyword">interface</span>{}
    x = <span class="hljs-string">"zhangsan"</span>
    v, ok := x.(<span class="hljs-type">string</span>)
    <span class="hljs-keyword">if</span> ok {
        fmt.Println(v)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"类型断言失败"</span>)
    }
}
</code></pre>
<p>返回两个参数 ，第一个v是实际值，第二个ok是布尔值，<strong>意为当前x的值是否为string类型</strong></p>
<h3 data-id="heading-36">协程</h3>
<p><strong>协程（Coroutine）</strong> 是一种强大的<strong>程序设计结构</strong>，它允许多个任务在单个<strong>线程</strong><sup><a href="#user-content-fn-1" id="user-content-user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-1">1</a></sup>内<strong>并发</strong><sup><a href="#user-content-fn-2" id="user-content-user-content-fnref-2" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-2">2</a></sup>执行，通过协作式的任务切换来提高程序的性能和响应性。在<strong>Go语言中，协程被称为Goroutines</strong>，是语言层面的原生支持，使得并发编程变得异常简单和高效。</p>
<p><strong>一个线程上可以跑多个协程，协程是轻量级的线程。</strong></p>
<p>go语言中的<code>main</code>函数称为<strong>主协程</strong>，可以将协程理解为一个主协程中的多个子协程，主协程结束，子协程函数跟着结束</p>
<p>Goroutine是Go运行时管理的轻量级线程</p>
<h4 data-id="heading-37">如何开启goroutine</h4>
<p>调用函数的时候在前面加上<code>go关键字</code>，就可以为一个函数创建一个goroutine。</p>
<p>例子</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sing</span><span class="hljs-params">()</span></span> {
  fmt.Println(<span class="hljs-string">"唱歌"</span>)
  time.Sleep(<span class="hljs-number">1</span> * time.Second)
  fmt.Println(<span class="hljs-string">"唱歌结束"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  time.Sleep(<span class="hljs-number">2</span> * time.Second)
}

</code></pre>
<p>如果我把这个主线程中的延时去掉之后，你会发现程序没有任何输出就结束了</p>
<p>这是为什么呢</p>
<p>那是因为主线程结束协程自动结束，主线程不会等待协程的结束</p>
<h4 data-id="heading-38">WaitGroup</h4>
<p>我们只需要让主线程等待协程就可以了，它的用法是这样的</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"sync"</span>
  <span class="hljs-string">"time"</span>
)

<span class="hljs-keyword">var</span> (
  wait = sync.WaitGroup{}
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sing</span><span class="hljs-params">()</span></span> {
  fmt.Println(<span class="hljs-string">"唱歌"</span>)
  time.Sleep(<span class="hljs-number">1</span> * time.Second)
  fmt.Println(<span class="hljs-string">"唱歌结束"</span>)
  wait.Done()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  wait.Add(<span class="hljs-number">4</span>) <span class="hljs-comment">// 不能为负数</span>
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  <span class="hljs-keyword">go</span> sing()
  wait.Wait()
  fmt.Println(<span class="hljs-string">"主线程结束"</span>)
}

</code></pre>
<h3 data-id="heading-39">channel</h3>
<p>单纯地将函数并发执行是没有意义的。函数与函数间需要交换数据才能体现并发执行函数的意义。</p>
<p><strong>channel（通道）</strong> 是golang在goroutine之间的通讯方式</p>
<blockquote>
<p><strong>通道格式</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> 变量 <span class="hljs-keyword">chan</span> 元素类型
</code></pre>
</blockquote>
<h4 data-id="heading-40">创建channel</h4>
<p>通道是引用类型，通道类型的空值是<code>nil</code></p>
<p>声明的通道后需要使用<code> make(chan 元素类型, [缓冲大小])</code>函数初始化之后才能使用。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> ch <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>
	fmt.Println(ch) <span class="hljs-comment">// &lt;nil&gt;</span>
	
	<span class="hljs-comment">// 初始化通道</span>
	ch = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">//  初始化一个 有一个缓冲位的通道</span>
	
	<span class="hljs-comment">// 可以用短声明简写</span>
	ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>, <span class="hljs-number">2</span>)
}
</code></pre>
<h4 data-id="heading-41">操作channel</h4>
<p>通道有发送（send）、接收(receive）和关闭（close）三种操作</p>
<p><strong>注意：发送和接收都使用<code>&lt;</code>和<code>-</code> 拼接在一起的<code>&lt;-</code>操作符，只是通道变量在操作符的位置不同</strong></p>
<ul>
<li><strong>发送</strong>
将指定类型的值发送到此通道中</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 初始化通道</span>
	ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) 
	ch &lt;- <span class="hljs-number">10</span> <span class="hljs-comment">// 把10发送到ch中</span>
}
</code></pre>
<ul>
<li><strong>接收</strong>
从一个通道中接收值，获取值</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 初始化通道</span>
	ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) 
	ch &lt;- <span class="hljs-number">10</span>
	
	x := &lt;- ch <span class="hljs-comment">// 从ch中接收值并赋值给变量x</span>
	&lt;-ch       <span class="hljs-comment">// 从ch中接收值，忽略结果</span>
}
</code></pre>
<ul>
<li><strong>关闭</strong>
我们通过调用内置的<code>close</code>函数来关闭通道</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// 初始化通道</span>
	ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) 
	ch &lt;- <span class="hljs-number">10</span>
	
	x := &lt;- ch 
	&lt;-ch 
	
	<span class="hljs-built_in">close</span>(ch) <span class="hljs-comment">// 关闭当前ch通道</span>
}
</code></pre>
<h4 data-id="heading-42">无缓冲的通道</h4>
<p>在创建channel时使用<code>make()</code>创建，此方法的第二个参数不传则是<strong>无缓冲通道</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf8c7fb7a268495e9157ba98332a09af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=TPlX32jkX%2F0A8i44qPDF1su%2BrLc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>无缓冲的通道只有在有人接收值的时候才能发送值。<strong>就像你住的小区没有快递柜和代收点，快递员给你打电话必须要把这个物品送到你的手中</strong>，简单来说就是无缓冲的通道必须有接收才能发送。</p>
<p>没有接收者，可以被编译成功，但会报一个<strong>死锁</strong>的错误<code> fatal error: all goroutines are asleep - deadlock!</code></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)
    ch &lt;- <span class="hljs-number">10</span>
    fmt.Println(<span class="hljs-string">"发送成功"</span>)
    <span class="hljs-comment">// fatal error: all goroutines are asleep - deadlock!</span>
}
</code></pre>
<p>上面的代码会阻塞在<code>ch &lt;- 10</code>这一行代码形成死锁，那如何解决这个问题呢？</p>
<p>一种方法是启用一个goroutine去接收值，例如：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">recv</span><span class="hljs-params">(c <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> {
    ret := &lt;-c
    fmt.Println(<span class="hljs-string">"接收成功"</span>, ret)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)
    <span class="hljs-keyword">go</span> recv(ch) <span class="hljs-comment">// 启用goroutine从通道接收值</span>
    ch &lt;- <span class="hljs-number">10</span>
    fmt.Println(<span class="hljs-string">"发送成功"</span>)
}
</code></pre>
<h4 data-id="heading-43">有缓冲的通道</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd9b604ad80b4c2aad8ef837de0b837f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=dOFu%2FPaMm5Rw%2B7QQzzopkhB6e8o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>我们可以在使用<code>make</code>函数初始化通道的时候为其指定通道的容量
例如：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 创建一个容量为1的有缓冲区通道</span>
    ch &lt;- <span class="hljs-number">10</span>
    fmt.Println(<span class="hljs-string">"发送成功"</span>)
}
</code></pre>
<p>只要通道的容量大于零，那么该通道就是有缓冲的通道，通道的容量表示通道中能存放元素的数量。<strong>就像你小区的快递柜只有那么个多格子，格子满了就装不下了，就阻塞了，等到别人取走一个快递员就能往里面放一个</strong>。</p>
<h4 data-id="heading-44">单向通道</h4>
<p>就是限制通道在函数中只能发送或只能接收</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">counter</span><span class="hljs-params">(out <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++ {
        out &lt;- i
    }
    <span class="hljs-built_in">close</span>(out)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">squarer</span><span class="hljs-params">(out <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">int</span>, in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> in {
        out &lt;- i * i
    }
    <span class="hljs-built_in">close</span>(out)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printer</span><span class="hljs-params">(in &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> in {
        fmt.Println(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)
    ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)
    <span class="hljs-keyword">go</span> counter(ch1)
    <span class="hljs-keyword">go</span> squarer(ch2, ch1)
    printer(ch2)
}
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-number">1.</span><span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">int</span>是一个只能发送的通道，可以发送但是不能接收；
<span class="hljs-number">2.</span>&lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>是一个只能接收的通道，可以接收但是不能发送。
</code></pre>
<p>在函数传参及任何赋值操作中将双向通道转换为单向通道是可以的，但反过来是不可以的</p>
<h4 data-id="heading-45">select</h4>
<p>在某些场景下我们需要同时从多个通道接收数据。通道在接收数据时，如果没有数据可以接收将会发生阻塞。</p>
<p>Go内置了<code>select</code>关键字，可以同时响应多个通道的操作。</p>
<p>select的使用类似于switch语句，下面是格式：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> &lt;-chan1:
       <span class="hljs-comment">// 如果chan1成功读到数据，则进行该case处理语句</span>
    <span class="hljs-keyword">case</span> chan2 &lt;- <span class="hljs-number">1</span>:
       <span class="hljs-comment">// 如果成功向chan2写入数据，则进行该case处理语句</span>
    <span class="hljs-keyword">default</span>:
       <span class="hljs-comment">// 如果上面都没有成功，则进入default处理流程</span>
}
</code></pre>
<h3 data-id="heading-46">并发安全和锁</h3>
<p>当进行并发协程同时操作一个资源时，导致两者出现竞争，最后输出结果不一，称为<strong>并发不安全</strong></p>
<p>这是为什么呢？</p>
<blockquote>
<p>根本原因是CPU的调度方法为抢占式执行，随机调度</p>
</blockquote>
<p>怎样才能做到并发安全呢？可以使用<strong>锁（Lock）</strong> 的方式</p>
<p>举个并发不安全的例子：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">var</span> num <span class="hljs-type">int</span>
<span class="hljs-keyword">var</span> wait sync.WaitGroup

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
    num++
  }
  wait.Done()
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reduce</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
    num--
  }
  wait.Done()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  wait.Add(<span class="hljs-number">2</span>)
  <span class="hljs-keyword">go</span> add()
  <span class="hljs-keyword">go</span> reduce()
  wait.Wait()
  fmt.Println(num) <span class="hljs-comment">// ?</span>

}
</code></pre>
<p>可以看出两个协程函数<code>add、reduce</code> 对<code>num</code>同时去加减操作，正常情况下结果应该为 0，但是每次运行结果都不一样。</p>
<h4 data-id="heading-47">互斥锁</h4>
<p>Go语言中使用<code>sync</code>包的<code>Mutex</code>类型来实现互斥锁。 使用互斥锁来修复上面代码的问题</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">var</span> num <span class="hljs-type">int</span>
<span class="hljs-keyword">var</span> wait  sync.WaitGroup
<span class="hljs-keyword">var</span> lock  sync.Mutex

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">()</span></span> {
  <span class="hljs-comment">// 谁先抢到了这把锁，谁就把它锁上，一旦锁上，其他的线程就只能等着</span>
  lock.Lock()
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
    num++
  }
  lock.Unlock()
  wait.Done()
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reduce</span><span class="hljs-params">()</span></span> {
  lock.Lock()
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
    num--
  }
  lock.Unlock()
  wait.Done()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  wait.Add(<span class="hljs-number">2</span>)
  <span class="hljs-keyword">go</span> add()
  <span class="hljs-keyword">go</span> reduce()
  wait.Wait()
  fmt.Println(num)
}
</code></pre>
<h4 data-id="heading-48">读写互斥锁</h4>
<p>当我们读取一个资源时没有对资源进行写操作，不需要加锁；反之，有读取也有写入操作时可以使用<strong>读写互斥锁</strong></p>
<p><strong>读写锁适合读多写少的场景</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main
 
<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"sync"</span>
	<span class="hljs-string">"time"</span>
)
 
<span class="hljs-keyword">var</span> x <span class="hljs-type">int64</span>
<span class="hljs-keyword">var</span> wg sync.WaitGroup
<span class="hljs-keyword">var</span> lock sync.Mutex
<span class="hljs-keyword">var</span> rwlock sync.RWMutex
 
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">write</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">defer</span> wg.Done()
	<span class="hljs-comment">// lock.Lock() //加互斥锁</span>
	rwlock.Lock() <span class="hljs-comment">//加写锁</span>
	x++
	time.Sleep(time.Microsecond * <span class="hljs-number">10</span>)
	rwlock.Unlock() <span class="hljs-comment">//解写锁</span>
	<span class="hljs-comment">// lock.Unlock() //解互斥锁</span>
}
 
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">defer</span> wg.Done()
	<span class="hljs-comment">// lock.Lock()  //加互斥锁</span>
	rwlock.RLock() <span class="hljs-comment">//加读锁</span>
	time.Sleep(time.Millisecond)
	rwlock.RUnlock() <span class="hljs-comment">//解读锁</span>
	<span class="hljs-comment">// lock.Unlock() //解互斥锁</span>
}
 
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	start := time.Now()
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
		wg.Add(<span class="hljs-number">1</span>)
		<span class="hljs-keyword">go</span> write()
	}
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ {
		wg.Add(<span class="hljs-number">1</span>)
		<span class="hljs-keyword">go</span> read()
	}
	wg.Wait()
	end := time.Now()
	fmt.Println(end.Sub(start))
}
</code></pre>
<h4 data-id="heading-49">线程安全下的map</h4>
<p>如果我们在一个协程函数下，读写map就会引发一个错误</p>
<p>concurrent map read and map write</p>
<p>希望大家见到这个错误，就能知道，这个就是map的线程安全错误</p>
<p>Go语言的<code>sync</code>包中提供了一个开箱即用的并发安全版map——<code>sync.Map</code></p>
<p>sync.Map内置了诸如<code>Store、Load、LoadOrStore、Delete、Range</code>等操作方法。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"sync"</span>
  <span class="hljs-string">"time"</span>
)

<span class="hljs-keyword">var</span> wait sync.WaitGroup
<span class="hljs-keyword">var</span> mp = sync.Map{}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reader</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">for</span> {

    fmt.Println(mp.Load(<span class="hljs-string">"time"</span>))
  }
  wait.Done()
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">writer</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">for</span> {
    mp.Store(<span class="hljs-string">"time"</span>, time.Now().Format(<span class="hljs-string">"15:04:05"</span>))
  }
  wait.Done()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  wait.Add(<span class="hljs-number">2</span>)
  <span class="hljs-keyword">go</span> reader()
  <span class="hljs-keyword">go</span> writer()
  wait.Wait()
}

</code></pre>
<h3 data-id="heading-50">内置函数</h3>
<h4 data-id="heading-51">new</h4>
<p>new是一个内置的函数，用于分配内存</p>
<blockquote>
<p>*<em>函数签名：func new(Type) <em>Type</em></em></p>
<ol>
<li>Type表示类型，new函数只接受一个参数，这个参数是一个类型</li>
<li>*Type表示类型指针，new函数返回一个指向该类型内存地址的指针。</li>
</ol>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> a *<span class="hljs-type">int</span>
    a = <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>)
    *a = <span class="hljs-number">10</span>
    fmt.Println(*a) <span class="hljs-comment">// 10</span>
}
</code></pre>
<h4 data-id="heading-52">make</h4>
<p>make也是用于内存分配的，区别于new，它只用于**切片（slice）、map以及通道（channel）**的内存创建，它返回的类型就是这三个类型本身，而不是他们的指针类型，因为这三种类型就是引用类型，所以就没有必要返回他们的指针了</p>
<blockquote>
<p><strong>函数签名：func make(t Type, size ...IntegerType) Type</strong></p>
</blockquote>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> b <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>
    b = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)
    b[<span class="hljs-string">"测试"</span>] = <span class="hljs-number">100</span>
    fmt.Println(b) <span class="hljs-comment">// map[测试:100]</span>
}
</code></pre>
<blockquote>
<p><strong>new与make的区别</strong></p>
<ol>
<li>二者都是用来做内存分配的。</li>
<li>make只用于slice、map以及channel的初始化，返回的还是这三个引用类型本身；</li>
<li>而new用于类型的内存分配，并且内存对应的值为类型零值，返回的是指向类型的指针。</li>
</ol>
</blockquote>
<h2 data-id="heading-53">常用库解析</h2>
<h3 data-id="heading-54">fmt</h3>
<p>用于格式化输出文本</p>
<ol>
<li>%v：通用类型占位符。可以表示任意值的类型。</li>
<li>%d：10进制整数</li>
<li>%f：浮点数</li>
<li>%s：字符串</li>
<li>%t：布尔值</li>
<li>%c：字符（Unicode码点）</li>
<li>%p：指针地址</li>
<li>%e/%E：科学计数法</li>
<li>%b：二进制整数</li>
<li>%o：八进制整数</li>
<li>%x/%X：十六进制整数</li>
<li>%U：Unicode格式，表示为U+十六进制数</li>
<li>%T：打印值的类型</li>
</ol>
<h2 data-id="heading-55">Go Modules</h2>
<p>Go Module（go mod）是Go语言官方依赖管理工具，从<code>Go 1.11</code>版本开始引入，取代GOPATH模式，用于管理项目依赖、版本控制和模块发布。
‌</p>
<h3 data-id="heading-56">初始化模块</h3>
<p>在项目根目录下终端执行以下命令来初始化一个新的模块：</p>
<pre><code class="hljs language-bash" lang="bash">go mod init 项目名

<span class="hljs-comment"># 例如</span>
go mod init myproject
</code></pre>
<h3 data-id="heading-57">添加依赖</h3>
<p>当你在代码中导入外部包并运行<code>go build</code>或<code>go run</code>时，Go会自动下载依赖并记录到<code>go.mod</code>文件中。</p>
<pre><code class="hljs language-bash" lang="bash">go get 包名

<span class="hljs-comment"># 例如</span>
go get github.com/gin-gonic/gin <span class="hljs-comment"># 这会下载最新版本</span>

<span class="hljs-comment"># 指定版本可用</span>
go get github.com/gin-gonic/gin@v1.9.1
</code></pre>
<h3 data-id="heading-58">依赖管理常用命令</h3>
<p>日常开发中常用的<code>go mod</code>命令包括：</p>
<ul>
<li><strong>go mod tidy</strong>：清理未使用的依赖，补全缺失的依赖</li>
<li><strong>go mod download</strong>：下载所有<code>go.mod</code>中的依赖</li>
<li><strong>go mod vendor</strong>：将依赖复制到<code>vendor/</code>目录（可选）</li>
<li><strong>go mod verify</strong>：验证依赖是否被篡改</li>
<li><strong>go list -m all</strong>：列出当前模块的所有依赖</li>
<li><strong>go list -m -u all</strong>：检查依赖是否有新版本</li>
</ul>
<p><br/><br/><br/><br/>
<strong>到这里就结束了，后续还会更新 go 系列相关，还请持续关注！</strong>
<strong>感谢阅读，若有错误可以在下方评论区留言哦！！！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e3acee0de1a47da9d1b3a0a1399ab2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ2l0Ym95emNm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768200384&amp;x-signature=qRD2t47CI3atpPGQoLeMYD%2BtcnE%3D" alt="111" loading="lazy"/></p>
<h3 class="sr-only" id="user-content-footnote-label" data-id="heading-59">Footnotes</h3>
<ol>
<li id="user-content-user-content-fn-1">
<blockquote>
<p>线程是进程的一个执行实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位。
一个进程可以创建和撤销多个线程;同一个进程中的多个线程之间可以并发执行。</p>
</blockquote>
<a href="#user-content-fnref-1" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-1">↩</a>
</li>
<li id="user-content-user-content-fn-2">
<blockquote>
<p>多线程程序在一个核的cpu上运行，就是<strong>并发</strong>。
多线程程序在多个核的cpu上运行，就是<strong>并行</strong>。</p>
</blockquote>
<a href="#user-content-fnref-2" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-2">↩</a>
</li>
</ol>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>